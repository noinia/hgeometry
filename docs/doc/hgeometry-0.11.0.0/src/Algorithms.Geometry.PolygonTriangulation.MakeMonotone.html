<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell     #-}</span><span>
</span><span id="line-3"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- Module      :  Algorithms.Geometry.PolygonTriangulation.MakeMonotone</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- Copyright   :  (C) Frank Staals</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- License     :  see the LICENSE file</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- Maintainer  :  Frank Staals</span><span>
</span><span id="line-9"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-10"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Algorithms.Geometry.PolygonTriangulation.MakeMonotone</span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#makeMonotone"><span class="hs-identifier">makeMonotone</span></a></span><span>
</span><span id="line-11"></span><span>                                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#computeDiagonals"><span class="hs-identifier">computeDiagonals</span></a></span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span>                                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#VertexType"><span class="hs-identifier">VertexType</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span>                                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#classifyVertices"><span class="hs-identifier">classifyVertices</span></a></span><span>
</span><span id="line-16"></span><span>                                                            </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html"><span class="hs-identifier">Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#ordAt"><span class="hs-identifier">ordAt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#xCoordAt"><span class="hs-identifier">xCoordAt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.Types.html"><span class="hs-identifier">Algorithms.Geometry.PolygonTriangulation.Types</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.State.Strict</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Writer</span></span><span>                                       </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">WriterT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">execWriterT</span></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>                                                                             </span><span class="annot"><span class="hs-identifier">tell</span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Bifunctor</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.DList</span></span><span>                                                 </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DList</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Ext</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span>                                              </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">F</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.Geometry.LineSegment.html"><span class="hs-identifier">Data.Geometry.LineSegment</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.Geometry.PlanarSubdivision.Basic.html"><span class="hs-identifier">Data.Geometry.PlanarSubdivision.Basic</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.Geometry.Point.html"><span class="hs-identifier">Data.Geometry.Point</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.Geometry.Polygon.html"><span class="hs-identifier">Data.Geometry.Polygon</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.IntMap</span></span><span>                                                </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IntMap</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span>                                         </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Ord</span></span><span>                                                   </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Down</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">comparing</span></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span>                                                   </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SS</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set.Util</span></span><span>                                              </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SS</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Util</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector</span></span><span>                                                </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector.Circular</span></span><span>                                       </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CV</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector.Mutable</span></span><span>                                        </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">MV</span></span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-comment">-- import Debug.Trace</span><span>
</span><span id="line-45"></span><span class="hs-comment">----------------------------------------------------------------------------------</span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-keyword">data</span><span> </span><span id="VertexType"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#VertexType"><span class="hs-identifier hs-var">VertexType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Start"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Start"><span class="hs-identifier hs-var">Start</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Merge"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Merge"><span class="hs-identifier hs-var">Merge</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Split"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Split"><span class="hs-identifier hs-var">Split</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="End"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#End"><span class="hs-identifier hs-var">End</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Regular"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Regular"><span class="hs-identifier hs-var">Regular</span></a></span></span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679966183"><span id="local-6989586621679966185"><span id="local-6989586621679966187"><span class="annot"><span class="annottext">Int -&gt; VertexType -&gt; ShowS
[VertexType] -&gt; ShowS
VertexType -&gt; String
(Int -&gt; VertexType -&gt; ShowS)
-&gt; (VertexType -&gt; String)
-&gt; ([VertexType] -&gt; ShowS)
-&gt; Show VertexType
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [VertexType] -&gt; ShowS
$cshowList :: [VertexType] -&gt; ShowS
show :: VertexType -&gt; String
$cshow :: VertexType -&gt; String
showsPrec :: Int -&gt; VertexType -&gt; ShowS
$cshowsPrec :: Int -&gt; VertexType -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span id="local-6989586621679966174"><span id="local-6989586621679966176"><span id="local-6989586621679966178"><span id="local-6989586621679966180"><span class="annot"><span class="annottext">ReadPrec [VertexType]
ReadPrec VertexType
Int -&gt; ReadS VertexType
ReadS [VertexType]
(Int -&gt; ReadS VertexType)
-&gt; ReadS [VertexType]
-&gt; ReadPrec VertexType
-&gt; ReadPrec [VertexType]
-&gt; Read VertexType
forall a.
(Int -&gt; ReadS a)
-&gt; ReadS [a] -&gt; ReadPrec a -&gt; ReadPrec [a] -&gt; Read a
readListPrec :: ReadPrec [VertexType]
$creadListPrec :: ReadPrec [VertexType]
readPrec :: ReadPrec VertexType
$creadPrec :: ReadPrec VertexType
readList :: ReadS [VertexType]
$creadList :: ReadS [VertexType]
readsPrec :: Int -&gt; ReadS VertexType
$creadsPrec :: Int -&gt; ReadS VertexType
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Read</span></span></span></span></span></span><span class="hs-special">,</span><span id="local-6989586621679966169"><span id="local-6989586621679966171"><span class="annot"><span class="annottext">VertexType -&gt; VertexType -&gt; Bool
(VertexType -&gt; VertexType -&gt; Bool)
-&gt; (VertexType -&gt; VertexType -&gt; Bool) -&gt; Eq VertexType
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: VertexType -&gt; VertexType -&gt; Bool
$c/= :: VertexType -&gt; VertexType -&gt; Bool
== :: VertexType -&gt; VertexType -&gt; Bool
$c== :: VertexType -&gt; VertexType -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-comment">-- | assigns a vertex type to each vertex</span><span>
</span><span id="line-50"></span><span class="hs-comment">--</span><span>
</span><span id="line-51"></span><span class="hs-comment">-- pre: Both the outer boundary and the inner boundary of the polygon are given in CCW order.</span><span>
</span><span id="line-52"></span><span class="hs-comment">--</span><span>
</span><span id="line-53"></span><span class="hs-comment">-- running time: \(O(n)\).</span><span>
</span><span id="line-54"></span><span id="local-6989586621679966402"><span id="local-6989586621679966403"><span id="local-6989586621679966404"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#classifyVertices"><span class="hs-identifier hs-type">classifyVertices</span></a></span><span>                     </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679966404"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679966404"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span>                                     </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Polygon.Core.html#Polygon"><span class="hs-identifier hs-type">Polygon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966403"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966402"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966404"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-56"></span><span>                                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Polygon.Core.html#Polygon"><span class="hs-identifier hs-type">Polygon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966403"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679966402"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#VertexType"><span class="hs-identifier hs-type">VertexType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679966404"><span class="hs-identifier hs-type">r</span></a></span></span></span></span><span>
</span><span id="line-57"></span><span id="classifyVertices"><span class="annot"><span class="annottext">classifyVertices :: Polygon t p r -&gt; Polygon t (p :+ VertexType) r
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#classifyVertices"><span class="hs-identifier hs-var hs-var">classifyVertices</span></a></span></span><span> </span><span id="local-6989586621679966167"><span class="annot"><span class="annottext">p :: Polygon t p r
</span><a href="#local-6989586621679966167"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Data.Geometry.Polygon.Core.html#SimplePolygon"><span class="hs-identifier hs-type">SimplePolygon</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplePolygon p r -&gt; SimplePolygon (p :+ VertexType) r
forall r p.
(Num r, Ord r) =&gt;
SimplePolygon p r -&gt; SimplePolygon (p :+ VertexType) r
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#classifyVertices%27"><span class="hs-identifier hs-var">classifyVertices'</span></a></span><span> </span><span class="annot"><span class="annottext">Polygon t p r
SimplePolygon p r
</span><a href="#local-6989586621679966167"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-58"></span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#classifyVertices"><span class="hs-identifier hs-var">classifyVertices</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.Polygon.Core.html#MultiPolygon"><span class="hs-identifier hs-type">MultiPolygon</span></a></span><span> </span><span id="local-6989586621679966163"><span class="annot"><span class="annottext">vs :: SimplePolygon p r
</span><a href="#local-6989586621679966163"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span id="local-6989586621679966162"><span class="annot"><span class="annottext">h :: [SimplePolygon p r]
</span><a href="#local-6989586621679966162"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplePolygon (p :+ VertexType) r
-&gt; [SimplePolygon (p :+ VertexType) r]
-&gt; MultiPolygon (p :+ VertexType) r
forall p r.
SimplePolygon p r -&gt; [SimplePolygon p r] -&gt; MultiPolygon p r
</span><a href="Data.Geometry.Polygon.Core.html#MultiPolygon"><span class="hs-identifier hs-var">MultiPolygon</span></a></span><span> </span><span class="annot"><span class="annottext">SimplePolygon (p :+ VertexType) r
</span><a href="#local-6989586621679966161"><span class="hs-identifier hs-var">vs'</span></a></span><span> </span><span class="annot"><span class="annottext">[SimplePolygon (p :+ VertexType) r]
</span><a href="#local-6989586621679966160"><span class="hs-identifier hs-var">h'</span></a></span><span>
</span><span id="line-59"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-60"></span><span>    </span><span id="local-6989586621679966161"><span class="annot"><span class="annottext">vs' :: SimplePolygon (p :+ VertexType) r
</span><a href="#local-6989586621679966161"><span class="hs-identifier hs-var hs-var">vs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplePolygon p r -&gt; SimplePolygon (p :+ VertexType) r
forall r p.
(Num r, Ord r) =&gt;
SimplePolygon p r -&gt; SimplePolygon (p :+ VertexType) r
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#classifyVertices%27"><span class="hs-identifier hs-var">classifyVertices'</span></a></span><span> </span><span class="annot"><span class="annottext">SimplePolygon p r
</span><a href="#local-6989586621679966163"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-61"></span><span>    </span><span id="local-6989586621679966160"><span class="annot"><span class="annottext">h' :: [SimplePolygon (p :+ VertexType) r]
</span><a href="#local-6989586621679966160"><span class="hs-identifier hs-var hs-var">h'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SimplePolygon p r -&gt; SimplePolygon (p :+ VertexType) r)
-&gt; [SimplePolygon p r] -&gt; [SimplePolygon (p :+ VertexType) r]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((p :+ VertexType) -&gt; p :+ VertexType)
-&gt; SimplePolygon (p :+ VertexType) r
-&gt; SimplePolygon (p :+ VertexType) r
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(p :+ VertexType)
-&gt; ((p :+ VertexType) -&gt; p :+ VertexType) -&gt; p :+ VertexType
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span class="annot"><span class="annottext">(VertexType -&gt; Identity VertexType)
-&gt; (p :+ VertexType) -&gt; Identity (p :+ VertexType)
forall core extra extra'.
Lens (core :+ extra) (core :+ extra') extra extra'
</span><span class="hs-identifier hs-var">extra</span></span><span> </span><span class="annot"><span class="annottext">((VertexType -&gt; Identity VertexType)
 -&gt; (p :+ VertexType) -&gt; Identity (p :+ VertexType))
-&gt; (VertexType -&gt; VertexType)
-&gt; (p :+ VertexType)
-&gt; p :+ VertexType
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="annot"><span class="annottext">VertexType -&gt; VertexType
</span><a href="#local-6989586621679966155"><span class="hs-identifier hs-var">onHole</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SimplePolygon (p :+ VertexType) r
 -&gt; SimplePolygon (p :+ VertexType) r)
-&gt; (SimplePolygon p r -&gt; SimplePolygon (p :+ VertexType) r)
-&gt; SimplePolygon p r
-&gt; SimplePolygon (p :+ VertexType) r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SimplePolygon p r -&gt; SimplePolygon (p :+ VertexType) r
forall r p.
(Num r, Ord r) =&gt;
SimplePolygon p r -&gt; SimplePolygon (p :+ VertexType) r
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#classifyVertices%27"><span class="hs-identifier hs-var">classifyVertices'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[SimplePolygon p r]
</span><a href="#local-6989586621679966162"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-comment">-- the roles on hole vertices are slightly different</span><span>
</span><span id="line-64"></span><span>    </span><span id="local-6989586621679966155"><span class="annot"><span class="annottext">onHole :: VertexType -&gt; VertexType
</span><a href="#local-6989586621679966155"><span class="hs-identifier hs-var hs-var">onHole</span></a></span></span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Start"><span class="hs-identifier hs-type">Start</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VertexType
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Split"><span class="hs-identifier hs-var">Split</span></a></span><span>
</span><span id="line-65"></span><span>    </span><span class="annot"><a href="#local-6989586621679966155"><span class="hs-identifier hs-var">onHole</span></a></span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Merge"><span class="hs-identifier hs-type">Merge</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VertexType
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#End"><span class="hs-identifier hs-var">End</span></a></span><span>
</span><span id="line-66"></span><span>    </span><span class="annot"><a href="#local-6989586621679966155"><span class="hs-identifier hs-var">onHole</span></a></span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Split"><span class="hs-identifier hs-type">Split</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VertexType
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Start"><span class="hs-identifier hs-var">Start</span></a></span><span>
</span><span id="line-67"></span><span>    </span><span class="annot"><a href="#local-6989586621679966155"><span class="hs-identifier hs-var">onHole</span></a></span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#End"><span class="hs-identifier hs-type">End</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VertexType
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Merge"><span class="hs-identifier hs-var">Merge</span></a></span><span>
</span><span id="line-68"></span><span>    </span><span class="annot"><a href="#local-6989586621679966155"><span class="hs-identifier hs-var">onHole</span></a></span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Regular"><span class="hs-identifier hs-type">Regular</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VertexType
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Regular"><span class="hs-identifier hs-var">Regular</span></a></span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-comment">-- | assigns a vertex type to each vertex</span><span>
</span><span id="line-71"></span><span class="hs-comment">--</span><span>
</span><span id="line-72"></span><span class="hs-comment">-- pre: the polygon is given in CCW order</span><span>
</span><span id="line-73"></span><span class="hs-comment">--</span><span>
</span><span id="line-74"></span><span class="hs-comment">-- running time: \(O(n)\).</span><span>
</span><span id="line-75"></span><span id="local-6989586621679966551"><span id="local-6989586621679966552"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#classifyVertices%27"><span class="hs-identifier hs-type">classifyVertices'</span></a></span><span>                    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679966552"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679966552"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>                                     </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Polygon.Core.html#SimplePolygon"><span class="hs-identifier hs-type">SimplePolygon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966551"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966552"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-77"></span><span>                                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Polygon.Core.html#SimplePolygon"><span class="hs-identifier hs-type">SimplePolygon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679966551"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#VertexType"><span class="hs-identifier hs-type">VertexType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679966552"><span class="hs-identifier hs-type">r</span></a></span></span></span><span>
</span><span id="line-78"></span><span id="classifyVertices%27"><span class="annot"><span class="annottext">classifyVertices' :: SimplePolygon p r -&gt; SimplePolygon (p :+ VertexType) r
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#classifyVertices%27"><span class="hs-identifier hs-var hs-var">classifyVertices'</span></a></span></span><span> </span><span id="local-6989586621679966153"><span class="annot"><span class="annottext">poly :: SimplePolygon p r
</span><a href="#local-6989586621679966153"><span class="hs-identifier hs-var">poly</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-79"></span><span>    </span><span class="annot"><span class="annottext">CircularVector (Point 2 r :+ (p :+ VertexType))
-&gt; SimplePolygon (p :+ VertexType) r
forall r p. CircularVector (Point 2 r :+ p) -&gt; SimplePolygon p r
</span><a href="Data.Geometry.Polygon.Core.html#unsafeFromCircularVector"><span class="hs-identifier hs-var">unsafeFromCircularVector</span></a></span><span> </span><span class="annot"><span class="annottext">(CircularVector (Point 2 r :+ (p :+ VertexType))
 -&gt; SimplePolygon (p :+ VertexType) r)
-&gt; CircularVector (Point 2 r :+ (p :+ VertexType))
-&gt; SimplePolygon (p :+ VertexType) r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Point 2 r :+ p)
 -&gt; (Point 2 r :+ p)
 -&gt; (Point 2 r :+ p)
 -&gt; Point 2 r :+ (p :+ VertexType))
-&gt; CircularVector (Point 2 r :+ p)
-&gt; CircularVector (Point 2 r :+ p)
-&gt; CircularVector (Point 2 r :+ p)
-&gt; CircularVector (Point 2 r :+ (p :+ VertexType))
forall a b c d.
(a -&gt; b -&gt; c -&gt; d)
-&gt; CircularVector a
-&gt; CircularVector b
-&gt; CircularVector c
-&gt; CircularVector d
</span><span class="hs-identifier hs-var">CV.zipWith3</span></span><span> </span><span class="annot"><span class="annottext">(Point 2 r :+ p)
-&gt; (Point 2 r :+ p)
-&gt; (Point 2 r :+ p)
-&gt; Point 2 r :+ (p :+ VertexType)
forall r core.
(Ord r, Num r) =&gt;
(Point 2 r :+ core)
-&gt; (Point 2 r :+ core)
-&gt; (Point 2 r :+ core)
-&gt; Point 2 r :+ (core :+ VertexType)
</span><a href="#local-6989586621679966150"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
-&gt; CircularVector (Point 2 r :+ p)
-&gt; CircularVector (Point 2 r :+ p)
forall a. Int -&gt; CircularVector a -&gt; CircularVector a
</span><span class="hs-identifier hs-var">CV.rotateLeft</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">CircularVector (Point 2 r :+ p)
</span><a href="#local-6989586621679966148"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CircularVector (Point 2 r :+ p)
</span><a href="#local-6989586621679966148"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
-&gt; CircularVector (Point 2 r :+ p)
-&gt; CircularVector (Point 2 r :+ p)
forall a. Int -&gt; CircularVector a -&gt; CircularVector a
</span><span class="hs-identifier hs-var">CV.rotateRight</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">CircularVector (Point 2 r :+ p)
</span><a href="#local-6989586621679966148"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-81"></span><span>    </span><span id="local-6989586621679966148"><span class="annot"><span class="annottext">vs :: CircularVector (Point 2 r :+ p)
</span><a href="#local-6989586621679966148"><span class="hs-identifier hs-var hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplePolygon p r
</span><a href="#local-6989586621679966153"><span class="hs-identifier hs-var">poly</span></a></span><span> </span><span class="annot"><span class="annottext">SimplePolygon p r
-&gt; Getting
     (CircularVector (Point 2 r :+ p))
     (SimplePolygon p r)
     (CircularVector (Point 2 r :+ p))
-&gt; CircularVector (Point 2 r :+ p)
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (CircularVector (Point 2 r :+ p))
  (SimplePolygon p r)
  (CircularVector (Point 2 r :+ p))
forall (t :: PolygonType) p r.
Getter (Polygon t p r) (CircularVector (Point 2 r :+ p))
</span><a href="Data.Geometry.Polygon.Core.html#outerBoundaryVector"><span class="hs-identifier hs-var">outerBoundaryVector</span></a></span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-comment">-- is the angle larger than &gt; 180 degrees</span><span>
</span><span id="line-83"></span><span>    </span><span id="local-6989586621679966144"><span class="annot"><span class="annottext">largeInteriorAngle :: (Point 2 r :+ extra)
-&gt; (Point 2 r :+ extra) -&gt; (Point 2 r :+ extra) -&gt; Bool
</span><a href="#local-6989586621679966144"><span class="hs-identifier hs-var hs-var">largeInteriorAngle</span></a></span></span><span> </span><span id="local-6989586621679966143"><span class="annot"><span class="annottext">p :: Point 2 r :+ extra
</span><a href="#local-6989586621679966143"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679966142"><span class="annot"><span class="annottext">c :: Point 2 r :+ extra
</span><a href="#local-6989586621679966142"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679966141"><span class="annot"><span class="annottext">n :: Point 2 r :+ extra
</span><a href="#local-6989586621679966141"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; Point 2 r -&gt; CCW
forall r.
(Ord r, Num r) =&gt;
Point 2 r -&gt; Point 2 r -&gt; Point 2 r -&gt; CCW
</span><a href="Data.Geometry.Point.Orientation.Degenerate.html#ccw"><span class="hs-identifier hs-var">ccw</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r :+ extra
</span><a href="#local-6989586621679966143"><span class="hs-identifier hs-var">p</span></a></span><span class="annot"><span class="annottext">(Point 2 r :+ extra)
-&gt; Getting (Point 2 r) (Point 2 r :+ extra) (Point 2 r)
-&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting (Point 2 r) (Point 2 r :+ extra) (Point 2 r)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r :+ extra
</span><a href="#local-6989586621679966142"><span class="hs-identifier hs-var">c</span></a></span><span class="annot"><span class="annottext">(Point 2 r :+ extra)
-&gt; Getting (Point 2 r) (Point 2 r :+ extra) (Point 2 r)
-&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting (Point 2 r) (Point 2 r :+ extra) (Point 2 r)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r :+ extra
</span><a href="#local-6989586621679966141"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">(Point 2 r :+ extra)
-&gt; Getting (Point 2 r) (Point 2 r :+ extra) (Point 2 r)
-&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting (Point 2 r) (Point 2 r :+ extra) (Point 2 r)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-84"></span><span>           </span><span class="annot"><a href="Data.Geometry.Point.Orientation.Degenerate.html#CCW"><span class="hs-identifier hs-type">CCW</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-85"></span><span>           </span><span class="annot"><a href="Data.Geometry.Point.Orientation.Degenerate.html#CW"><span class="hs-identifier hs-type">CW</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-86"></span><span>           </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="hs-string">&quot;classifyVertices -&gt; largeInteriorAngle: colinear points&quot;</span></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span>    </span><span id="local-6989586621679966150"><span class="annot"><span class="annottext">f :: (Point 2 r :+ core)
-&gt; (Point 2 r :+ core)
-&gt; (Point 2 r :+ core)
-&gt; Point 2 r :+ (core :+ VertexType)
</span><a href="#local-6989586621679966150"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679966135"><span class="annot"><span class="annottext">p :: Point 2 r :+ core
</span><a href="#local-6989586621679966135"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679966134"><span class="annot"><span class="annottext">c :: Point 2 r :+ core
</span><a href="#local-6989586621679966134"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679966133"><span class="annot"><span class="annottext">n :: Point 2 r :+ core
</span><a href="#local-6989586621679966133"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ core
</span><a href="#local-6989586621679966134"><span class="hs-identifier hs-var">c</span></a></span><span class="annot"><span class="annottext">(Point 2 r :+ core)
-&gt; ((Point 2 r :+ core) -&gt; Point 2 r :+ (core :+ VertexType))
-&gt; Point 2 r :+ (core :+ VertexType)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span class="annot"><span class="annottext">(core -&gt; Identity (core :+ VertexType))
-&gt; (Point 2 r :+ core)
-&gt; Identity (Point 2 r :+ (core :+ VertexType))
forall core extra extra'.
Lens (core :+ extra) (core :+ extra') extra extra'
</span><span class="hs-identifier hs-var">extra</span></span><span> </span><span class="annot"><span class="annottext">((core -&gt; Identity (core :+ VertexType))
 -&gt; (Point 2 r :+ core)
 -&gt; Identity (Point 2 r :+ (core :+ VertexType)))
-&gt; (core -&gt; core :+ VertexType)
-&gt; (Point 2 r :+ core)
-&gt; Point 2 r :+ (core :+ VertexType)
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">core -&gt; VertexType -&gt; core :+ VertexType
forall core extra. core -&gt; extra -&gt; core :+ extra
</span><span class="hs-operator hs-var">:+</span></span><span> </span><span class="annot"><span class="annottext">VertexType
</span><a href="#local-6989586621679966131"><span class="hs-identifier hs-var">vt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-90"></span><span>        </span><span id="local-6989586621679966131"><span class="annot"><span class="annottext">vt :: VertexType
</span><a href="#local-6989586621679966131"><span class="hs-identifier hs-var hs-var">vt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r :+ core
</span><a href="#local-6989586621679966135"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">(Point 2 r :+ core) -&gt; (Point 2 r :+ core) -&gt; Ordering
forall r e.
Ord r =&gt;
(Point 2 r :+ e) -&gt; (Point 2 r :+ e) -&gt; Ordering
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#cmpSweep"><span class="hs-operator hs-var">`cmpSweep`</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ core
</span><a href="#local-6989586621679966134"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ core
</span><a href="#local-6989586621679966133"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">(Point 2 r :+ core) -&gt; (Point 2 r :+ core) -&gt; Ordering
forall r e.
Ord r =&gt;
(Point 2 r :+ e) -&gt; (Point 2 r :+ e) -&gt; Ordering
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#cmpSweep"><span class="hs-operator hs-var">`cmpSweep`</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ core
</span><a href="#local-6989586621679966134"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Point 2 r :+ core)
-&gt; (Point 2 r :+ core) -&gt; (Point 2 r :+ core) -&gt; Bool
forall r extra extra extra.
(Ord r, Num r) =&gt;
(Point 2 r :+ extra)
-&gt; (Point 2 r :+ extra) -&gt; (Point 2 r :+ extra) -&gt; Bool
</span><a href="#local-6989586621679966144"><span class="hs-identifier hs-var">largeInteriorAngle</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ core
</span><a href="#local-6989586621679966135"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ core
</span><a href="#local-6989586621679966134"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ core
</span><a href="#local-6989586621679966133"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-91"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VertexType
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Start"><span class="hs-identifier hs-var">Start</span></a></span><span>
</span><span id="line-92"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VertexType
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Split"><span class="hs-identifier hs-var">Split</span></a></span><span>
</span><span id="line-93"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">GT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VertexType
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#End"><span class="hs-identifier hs-var">End</span></a></span><span>
</span><span id="line-94"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">GT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VertexType
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Merge"><span class="hs-identifier hs-var">Merge</span></a></span><span>
</span><span id="line-95"></span><span>               </span><span class="hs-identifier">_</span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VertexType
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Regular"><span class="hs-identifier hs-var">Regular</span></a></span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="hs-comment">-- | p &lt; q = p.y &lt; q.y || p.y == q.y &amp;&amp; p.x &gt; q.y</span><span>
</span><span id="line-100"></span><span id="local-6989586621679966486"><span id="local-6989586621679966487"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#cmpSweep"><span class="hs-identifier hs-type">cmpSweep</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679966487"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679966487"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621679966486"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679966487"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621679966486"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ordering</span></span></span></span><span>
</span><span id="line-101"></span><span id="local-6989586621679966129"><span class="annot"><span class="annottext">p :: Point 2 r :+ e
</span><a href="#local-6989586621679966129"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="cmpSweep"><span class="annot"><span class="annottext">cmpSweep :: (Point 2 r :+ e) -&gt; (Point 2 r :+ e) -&gt; Ordering
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#cmpSweep"><span class="hs-operator hs-var hs-var">`cmpSweep`</span></a></span></span><span> </span><span id="local-6989586621679966128"><span class="annot"><span class="annottext">q :: Point 2 r :+ e
</span><a href="#local-6989586621679966128"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-102"></span><span>  </span><span class="annot"><span class="annottext">((Point 2 r :+ e) -&gt; r)
-&gt; (Point 2 r :+ e) -&gt; (Point 2 r :+ e) -&gt; Ordering
forall a b. Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering
</span><span class="hs-identifier hs-var">comparing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Point 2 r :+ e) -&gt; Getting r (Point 2 r :+ e) r -&gt; r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">(Point 2 r -&gt; Const r (Point 2 r))
-&gt; (Point 2 r :+ e) -&gt; Const r (Point 2 r :+ e)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="annot"><span class="annottext">((Point 2 r -&gt; Const r (Point 2 r))
 -&gt; (Point 2 r :+ e) -&gt; Const r (Point 2 r :+ e))
-&gt; ((r -&gt; Const r r) -&gt; Point 2 r -&gt; Const r (Point 2 r))
-&gt; Getting r (Point 2 r :+ e) r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(r -&gt; Const r r) -&gt; Point 2 r -&gt; Const r (Point 2 r)
forall (d :: Nat) (point :: Nat -&gt; * -&gt; *) r.
(2 &lt;= d, Arity d, AsAPoint point) =&gt;
Lens' (point d r) r
</span><a href="Data.Geometry.Point.Class.html#yCoord"><span class="hs-identifier hs-var">yCoord</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ e
</span><a href="#local-6989586621679966129"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ e
</span><a href="#local-6989586621679966128"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Ordering -&gt; Ordering -&gt; Ordering
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">((Point 2 r :+ e) -&gt; Down r)
-&gt; (Point 2 r :+ e) -&gt; (Point 2 r :+ e) -&gt; Ordering
forall a b. Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering
</span><span class="hs-identifier hs-var">comparing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r -&gt; Down r
forall a. a -&gt; Down a
</span><span class="hs-identifier hs-var">Down</span></span><span> </span><span class="annot"><span class="annottext">(r -&gt; Down r)
-&gt; ((Point 2 r :+ e) -&gt; r) -&gt; (Point 2 r :+ e) -&gt; Down r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Point 2 r :+ e) -&gt; Getting r (Point 2 r :+ e) r -&gt; r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">(Point 2 r -&gt; Const r (Point 2 r))
-&gt; (Point 2 r :+ e) -&gt; Const r (Point 2 r :+ e)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="annot"><span class="annottext">((Point 2 r -&gt; Const r (Point 2 r))
 -&gt; (Point 2 r :+ e) -&gt; Const r (Point 2 r :+ e))
-&gt; ((r -&gt; Const r r) -&gt; Point 2 r -&gt; Const r (Point 2 r))
-&gt; Getting r (Point 2 r :+ e) r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(r -&gt; Const r r) -&gt; Point 2 r -&gt; Const r (Point 2 r)
forall (d :: Nat) (point :: Nat -&gt; * -&gt; *) r.
(1 &lt;= d, Arity d, AsAPoint point) =&gt;
Lens' (point d r) r
</span><a href="Data.Geometry.Point.Class.html#xCoord"><span class="hs-identifier hs-var">xCoord</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ e
</span><a href="#local-6989586621679966129"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ e
</span><a href="#local-6989586621679966128"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="hs-keyword">type</span><span> </span><span id="Event"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Event"><span class="hs-identifier hs-var">Event</span></a></span></span><span> </span><span id="local-6989586621679966124"><span class="annot"><a href="#local-6989586621679966124"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679966124"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Two</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.LineSegment.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><a href="#local-6989586621679966124"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="hs-keyword">data</span><span> </span><span id="StatusStruct"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#StatusStruct"><span class="hs-identifier hs-var">StatusStruct</span></a></span></span><span> </span><span id="local-6989586621679966378"><span class="annot"><a href="#local-6989586621679966378"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SS"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#SS"><span class="hs-identifier hs-var">SS</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="_statusStruct"><span class="annot"><span class="annottext">StatusStruct r -&gt; Set (LineSegment 2 Int r)
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#_statusStruct"><span class="hs-identifier hs-var hs-var">_statusStruct</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SS.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.LineSegment.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><a href="#local-6989586621679966378"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span>                         </span><span class="hs-special">,</span><span> </span><span id="_helper"><span class="annot"><span class="annottext">StatusStruct r -&gt; IntMap Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#_helper"><span class="hs-identifier hs-var hs-var">_helper</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IntMap.IntMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span>                         </span><span class="hs-comment">-- ^ for every e_i, the id of the helper vertex</span><span>
</span><span id="line-112"></span><span>                         </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679966115"><span id="local-6989586621679966117"><span id="local-6989586621679966119"><span class="annot"><span class="annottext">Int -&gt; StatusStruct r -&gt; ShowS
[StatusStruct r] -&gt; ShowS
StatusStruct r -&gt; String
(Int -&gt; StatusStruct r -&gt; ShowS)
-&gt; (StatusStruct r -&gt; String)
-&gt; ([StatusStruct r] -&gt; ShowS)
-&gt; Show (StatusStruct r)
forall r. Show r =&gt; Int -&gt; StatusStruct r -&gt; ShowS
forall r. Show r =&gt; [StatusStruct r] -&gt; ShowS
forall r. Show r =&gt; StatusStruct r -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [StatusStruct r] -&gt; ShowS
$cshowList :: forall r. Show r =&gt; [StatusStruct r] -&gt; ShowS
show :: StatusStruct r -&gt; String
$cshow :: forall r. Show r =&gt; StatusStruct r -&gt; String
showsPrec :: Int -&gt; StatusStruct r -&gt; ShowS
$cshowsPrec :: forall r. Show r =&gt; Int -&gt; StatusStruct r -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span id="statusStruct"><span id="helper"><span id="local-6989586621679966257"><span id="local-6989586621679966378"><span class="hs-identifier">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">StatusStruct</span></span></span></span></span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span id="local-6989586621679966416"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#ix%27"><span class="hs-identifier hs-type">ix'</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="annot"><a href="#local-6989586621679966416"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679966416"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-116"></span><span id="ix%27"><span class="annot"><span class="annottext">ix' :: Int -&gt; Lens' (Vector a) a
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#ix%27"><span class="hs-identifier hs-var hs-var">ix'</span></a></span></span><span> </span><span id="local-6989586621679966111"><span class="annot"><span class="annottext">i :: Int
</span><a href="#local-6989586621679966111"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Traversing (-&gt;) f (Vector a) (Vector a) a a
-&gt; Over (-&gt;) f (Vector a) (Vector a) a a
forall (p :: * -&gt; * -&gt; *) (f :: * -&gt; *) s t a.
(HasCallStack, Conjoined p, Functor f) =&gt;
Traversing p f s t a a -&gt; Over p f s t a a
</span><span class="hs-identifier hs-var">singular</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Index (Vector a) -&gt; Traversal' (Vector a) (IxValue (Vector a))
forall m. Ixed m =&gt; Index m -&gt; Traversal' m (IxValue m)
</span><span class="hs-identifier hs-var">ix</span></span><span> </span><span class="annot"><span class="annottext">Int
Index (Vector a)
</span><a href="#local-6989586621679966111"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="hs-comment">{- HLINT ignore computeDiagonals -}</span><span>
</span><span id="line-119"></span><span class="hs-comment">-- | Given a polygon, find a set of non-intersecting diagonals that partition</span><span>
</span><span id="line-120"></span><span class="hs-comment">-- the polygon into y-monotone pieces.</span><span>
</span><span id="line-121"></span><span class="hs-comment">--</span><span>
</span><span id="line-122"></span><span class="hs-comment">-- running time: \(O(n\log n)\)</span><span>
</span><span id="line-123"></span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#computeDiagonals"><span class="hs-identifier hs-type">computeDiagonals</span></a></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679966323"><span class="annot"><a href="#local-6989586621679966323"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span id="local-6989586621679966324"><span class="annot"><a href="#local-6989586621679966324"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621679966322"><span class="annot"><a href="#local-6989586621679966322"><span class="hs-identifier hs-type">p</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679966324"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679966324"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>                    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Polygon.Core.html#Polygon"><span class="hs-identifier hs-type">Polygon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966323"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966322"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966324"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.Geometry.LineSegment.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679966322"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966324"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-125"></span><span id="computeDiagonals"><span class="annot"><span class="annottext">computeDiagonals :: Polygon t p r -&gt; [LineSegment 2 p r]
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#computeDiagonals"><span class="hs-identifier hs-var hs-var">computeDiagonals</span></a></span></span><span> </span><span id="local-6989586621679966108"><span class="annot"><span class="annottext">p' :: Polygon t p r
</span><a href="#local-6989586621679966108"><span class="hs-identifier hs-var">p'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 Int r -&gt; LineSegment 2 p r)
-&gt; [LineSegment 2 Int r] -&gt; [LineSegment 2 p r]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 Int r -&gt; LineSegment 2 p r
</span><a href="#local-6989586621679966107"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">([LineSegment 2 Int r] -&gt; [LineSegment 2 p r])
-&gt; (Polygon t (SP Int (p :+ VertexType)) r
    -&gt; [LineSegment 2 Int r])
-&gt; Polygon t (SP Int (p :+ VertexType)) r
-&gt; [LineSegment 2 p r]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Event r) -&gt; [LineSegment 2 Int r]
</span><a href="#local-6989586621679966106"><span class="hs-identifier hs-var">sweep</span></a></span><span>
</span><span id="line-126"></span><span>                    </span><span class="annot"><span class="annottext">(NonEmpty (Event r) -&gt; [LineSegment 2 Int r])
-&gt; (Polygon t (SP Int (p :+ VertexType)) r -&gt; NonEmpty (Event r))
-&gt; Polygon t (SP Int (p :+ VertexType)) r
-&gt; [LineSegment 2 Int r]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Event r -&gt; Event r -&gt; Ordering)
-&gt; NonEmpty (Event r) -&gt; NonEmpty (Event r)
forall a. (a -&gt; a -&gt; Ordering) -&gt; NonEmpty a -&gt; NonEmpty a
</span><span class="hs-identifier hs-var">NonEmpty.sortBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Event r -&gt; Event r -&gt; Ordering) -&gt; Event r -&gt; Event r -&gt; Ordering
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">Event r -&gt; Event r -&gt; Ordering
forall r e.
Ord r =&gt;
(Point 2 r :+ e) -&gt; (Point 2 r :+ e) -&gt; Ordering
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#cmpSweep"><span class="hs-identifier hs-var">cmpSweep</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>                    </span><span class="annot"><span class="annottext">(NonEmpty (Event r) -&gt; NonEmpty (Event r))
-&gt; (Polygon t (SP Int (p :+ VertexType)) r -&gt; NonEmpty (Event r))
-&gt; Polygon t (SP Int (p :+ VertexType)) r
-&gt; NonEmpty (Event r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Polygon t (Two (LineSegment 2 Int r)) r -&gt; NonEmpty (Event r)
forall (t :: PolygonType) p r.
Polygon t p r -&gt; NonEmpty (Point 2 r :+ p)
</span><a href="Data.Geometry.Polygon.Core.html#polygonVertices"><span class="hs-identifier hs-var">polygonVertices</span></a></span><span> </span><span class="annot"><span class="annottext">(Polygon t (Two (LineSegment 2 Int r)) r -&gt; NonEmpty (Event r))
-&gt; (Polygon t (SP Int (p :+ VertexType)) r
    -&gt; Polygon t (Two (LineSegment 2 Int r)) r)
-&gt; Polygon t (SP Int (p :+ VertexType)) r
-&gt; NonEmpty (Event r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Polygon t Int r -&gt; Polygon t (Two (LineSegment 2 Int r)) r
forall (t :: PolygonType) p r.
Polygon t p r -&gt; Polygon t (Two (LineSegment 2 p r)) r
</span><a href="Data.Geometry.Polygon.Core.html#withIncidentEdges"><span class="hs-identifier hs-var">withIncidentEdges</span></a></span><span>
</span><span id="line-128"></span><span>                    </span><span class="annot"><span class="annottext">(Polygon t Int r -&gt; Polygon t (Two (LineSegment 2 Int r)) r)
-&gt; (Polygon t (SP Int (p :+ VertexType)) r -&gt; Polygon t Int r)
-&gt; Polygon t (SP Int (p :+ VertexType)) r
-&gt; Polygon t (Two (LineSegment 2 Int r)) r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(SP Int (p :+ VertexType) -&gt; Int)
-&gt; Polygon t (SP Int (p :+ VertexType)) r -&gt; Polygon t Int r
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SP Int (p :+ VertexType)
-&gt; Getting Int (SP Int (p :+ VertexType)) Int -&gt; Int
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting Int (SP Int (p :+ VertexType)) Int
forall s t a b. Field1 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Polygon t (SP Int (p :+ VertexType)) r -&gt; [LineSegment 2 p r])
-&gt; Polygon t (SP Int (p :+ VertexType)) r -&gt; [LineSegment 2 p r]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Polygon t (SP Int (p :+ VertexType)) r
</span><a href="#local-6989586621679966100"><span class="hs-identifier hs-var">pg</span></a></span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-comment">-- remaps to get the p value rather than the vertexId</span><span>
</span><span id="line-131"></span><span>    </span><span id="local-6989586621679966107"><span class="annot"><span class="annottext">f :: LineSegment 2 Int r -&gt; LineSegment 2 p r
</span><a href="#local-6989586621679966107"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; p) -&gt; LineSegment 2 Int r -&gt; LineSegment 2 p r
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679966099"><span class="annot"><span class="annottext">i :: Int
</span><a href="#local-6989586621679966099"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Vector (STR (Point 2 r) p VertexType)
</span><a href="#local-6989586621679966098"><span class="hs-identifier hs-var">vertexInfo</span></a></span><span class="annot"><span class="annottext">Vector (STR (Point 2 r) p VertexType)
-&gt; Getting p (Vector (STR (Point 2 r) p VertexType)) p -&gt; p
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Int
-&gt; Lens'
     (Vector (STR (Point 2 r) p VertexType))
     (STR (Point 2 r) p VertexType)
forall a. Int -&gt; Lens' (Vector a) a
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#ix%27"><span class="hs-identifier hs-var">ix'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679966099"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">((STR (Point 2 r) p VertexType
  -&gt; Const p (STR (Point 2 r) p VertexType))
 -&gt; Vector (STR (Point 2 r) p VertexType)
 -&gt; Const p (Vector (STR (Point 2 r) p VertexType)))
-&gt; ((p -&gt; Const p p)
    -&gt; STR (Point 2 r) p VertexType
    -&gt; Const p (STR (Point 2 r) p VertexType))
-&gt; Getting p (Vector (STR (Point 2 r) p VertexType)) p
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(p -&gt; Const p p)
-&gt; STR (Point 2 r) p VertexType
-&gt; Const p (STR (Point 2 r) p VertexType)
forall s t a b. Field2 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_2</span></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span>    </span><span class="annot"><a href="#local-6989586621679966100"><span class="hs-identifier hs-type">pg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Geometry.Polygon.Core.html#Polygon"><span class="hs-identifier hs-type">Polygon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966323"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SP</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679966322"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#VertexType"><span class="hs-identifier hs-type">VertexType</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679966324"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-134"></span><span>    </span><span id="local-6989586621679966100"><span class="annot"><span class="annottext">pg :: Polygon t (SP Int (p :+ VertexType)) r
</span><a href="#local-6989586621679966100"><span class="hs-identifier hs-var hs-var">pg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Polygon t (p :+ VertexType) r
-&gt; Polygon t (SP Int (p :+ VertexType)) r
forall (t :: PolygonType) p r.
Polygon t p r -&gt; Polygon t (SP Int p) r
</span><a href="Data.Geometry.Polygon.Core.html#numberVertices"><span class="hs-identifier hs-var">numberVertices</span></a></span><span> </span><span class="annot"><span class="annottext">(Polygon t (p :+ VertexType) r
 -&gt; Polygon t (SP Int (p :+ VertexType)) r)
-&gt; (Polygon t p r -&gt; Polygon t (p :+ VertexType) r)
-&gt; Polygon t p r
-&gt; Polygon t (SP Int (p :+ VertexType)) r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Polygon t (p :+ VertexType) r -&gt; Polygon t (p :+ VertexType) r
forall r (t :: PolygonType) p.
(Eq r, Num r) =&gt;
Polygon t p r -&gt; Polygon t p r
</span><a href="#local-6989586621679966095"><span class="hs-identifier hs-var">holesToCW</span></a></span><span> </span><span class="annot"><span class="annottext">(Polygon t (p :+ VertexType) r -&gt; Polygon t (p :+ VertexType) r)
-&gt; (Polygon t p r -&gt; Polygon t (p :+ VertexType) r)
-&gt; Polygon t p r
-&gt; Polygon t (p :+ VertexType) r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Polygon t p r -&gt; Polygon t (p :+ VertexType) r
forall r (t :: PolygonType) p.
(Num r, Ord r) =&gt;
Polygon t p r -&gt; Polygon t (p :+ VertexType) r
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#classifyVertices"><span class="hs-identifier hs-var">classifyVertices</span></a></span><span> </span><span class="annot"><span class="annottext">(Polygon t p r -&gt; Polygon t (p :+ VertexType) r)
-&gt; (Polygon t p r -&gt; Polygon t p r)
-&gt; Polygon t p r
-&gt; Polygon t (p :+ VertexType) r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Polygon t p r -&gt; Polygon t p r
forall r (t :: PolygonType) p.
(Eq r, Num r) =&gt;
Polygon t p r -&gt; Polygon t p r
</span><a href="#local-6989586621679966094"><span class="hs-identifier hs-var">toCCW</span></a></span><span> </span><span class="annot"><span class="annottext">(Polygon t p r -&gt; Polygon t (SP Int (p :+ VertexType)) r)
-&gt; Polygon t p r -&gt; Polygon t (SP Int (p :+ VertexType)) r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Polygon t p r
</span><a href="#local-6989586621679966108"><span class="hs-identifier hs-var">p'</span></a></span><span>
</span><span id="line-135"></span><span>    </span><span class="annot"><a href="#local-6989586621679966098"><span class="hs-identifier hs-type">vertexInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STR</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679966324"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679966322"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#VertexType"><span class="hs-identifier hs-type">VertexType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>    </span><span id="local-6989586621679966098"><span class="annot"><span class="annottext">vertexInfo :: Vector (STR (Point 2 r) p VertexType)
</span><a href="#local-6989586621679966098"><span class="hs-identifier hs-var hs-var">vertexInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679966093"><span class="annot"><span class="annottext">vs :: NonEmpty (Point 2 r :+ SP Int (p :+ VertexType))
</span><a href="#local-6989586621679966093"><span class="hs-identifier hs-var hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Polygon t (SP Int (p :+ VertexType)) r
-&gt; NonEmpty (Point 2 r :+ SP Int (p :+ VertexType))
forall (t :: PolygonType) p r.
Polygon t p r -&gt; NonEmpty (Point 2 r :+ p)
</span><a href="Data.Geometry.Polygon.Core.html#polygonVertices"><span class="hs-identifier hs-var">polygonVertices</span></a></span><span> </span><span class="annot"><span class="annottext">Polygon t (SP Int (p :+ VertexType)) r
</span><a href="#local-6989586621679966100"><span class="hs-identifier hs-var">pg</span></a></span><span>
</span><span id="line-137"></span><span>                     </span><span id="local-6989586621679966092"><span class="annot"><span class="annottext">n :: Int
</span><a href="#local-6989586621679966092"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty (Point 2 r :+ SP Int (p :+ VertexType)) -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">F.length</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Point 2 r :+ SP Int (p :+ VertexType))
</span><a href="#local-6989586621679966093"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-138"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(forall s. ST s (MVector s (STR (Point 2 r) p VertexType)))
-&gt; Vector (STR (Point 2 r) p VertexType)
forall a. (forall s. ST s (MVector s a)) -&gt; Vector a
</span><span class="hs-identifier hs-var">V.create</span></span><span> </span><span class="annot"><span class="annottext">((forall s. ST s (MVector s (STR (Point 2 r) p VertexType)))
 -&gt; Vector (STR (Point 2 r) p VertexType))
-&gt; (forall s. ST s (MVector s (STR (Point 2 r) p VertexType)))
-&gt; Vector (STR (Point 2 r) p VertexType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-139"></span><span>                   </span><span id="local-6989586621679966089"><span class="annot"><span class="annottext">MVector s (STR (Point 2 r) p VertexType)
</span><a href="#local-6989586621679966089"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; ST s (MVector (PrimState (ST s)) (STR (Point 2 r) p VertexType))
forall (m :: * -&gt; *) a.
PrimMonad m =&gt;
Int -&gt; m (MVector (PrimState m) a)
</span><span class="hs-identifier hs-var">MV.new</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679966092"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-140"></span><span>                   </span><span class="annot"><span class="annottext">NonEmpty (Point 2 r :+ SP Int (p :+ VertexType))
-&gt; ((Point 2 r :+ SP Int (p :+ VertexType)) -&gt; ST s ()) -&gt; ST s ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Point 2 r :+ SP Int (p :+ VertexType))
</span><a href="#local-6989586621679966093"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">(((Point 2 r :+ SP Int (p :+ VertexType)) -&gt; ST s ()) -&gt; ST s ())
-&gt; ((Point 2 r :+ SP Int (p :+ VertexType)) -&gt; ST s ()) -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679966086"><span class="annot"><span class="annottext">pt :: Point 2 r
</span><a href="#local-6989586621679966086"><span class="hs-identifier hs-var">pt</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SP</span></span><span> </span><span id="local-6989586621679966084"><span class="annot"><span class="annottext">i :: Int
</span><a href="#local-6989586621679966084"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679966083"><span class="annot"><span class="annottext">p :: p
</span><a href="#local-6989586621679966083"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span id="local-6989586621679966082"><span class="annot"><span class="annottext">vt :: VertexType
</span><a href="#local-6989586621679966082"><span class="hs-identifier hs-var">vt</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-141"></span><span>                     </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) (STR (Point 2 r) p VertexType)
-&gt; Int -&gt; STR (Point 2 r) p VertexType -&gt; ST s ()
forall (m :: * -&gt; *) a.
PrimMonad m =&gt;
MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-identifier hs-var">MV.write</span></span><span> </span><span class="annot"><span class="annottext">MVector s (STR (Point 2 r) p VertexType)
MVector (PrimState (ST s)) (STR (Point 2 r) p VertexType)
</span><a href="#local-6989586621679966089"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679966084"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r -&gt; p -&gt; VertexType -&gt; STR (Point 2 r) p VertexType
forall a b c. a -&gt; b -&gt; c -&gt; STR a b c
</span><span class="hs-identifier hs-var">STR</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679966086"><span class="hs-identifier hs-var">pt</span></a></span><span> </span><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621679966083"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">VertexType
</span><a href="#local-6989586621679966082"><span class="hs-identifier hs-var">vt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>                   </span><span class="annot"><span class="annottext">MVector s (STR (Point 2 r) p VertexType)
-&gt; ST s (MVector s (STR (Point 2 r) p VertexType))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">MVector s (STR (Point 2 r) p VertexType)
</span><a href="#local-6989586621679966089"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span>    </span><span id="local-6989586621679966079"><span class="annot"><span class="annottext">initialSS :: StatusStruct r
</span><a href="#local-6989586621679966079"><span class="hs-identifier hs-var hs-var">initialSS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set (LineSegment 2 Int r) -&gt; IntMap Int -&gt; StatusStruct r
forall r. Set (LineSegment 2 Int r) -&gt; IntMap Int -&gt; StatusStruct r
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#SS"><span class="hs-identifier hs-var">SS</span></a></span><span> </span><span class="annot"><span class="annottext">Set (LineSegment 2 Int r)
forall a. Set a
</span><span class="hs-identifier hs-var">SS.empty</span></span><span> </span><span class="annot"><span class="annottext">IntMap Int
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span>    </span><span id="local-6989586621679966106"><span class="annot"><span class="annottext">sweep :: NonEmpty (Event r) -&gt; [LineSegment 2 Int r]
</span><a href="#local-6989586621679966106"><span class="hs-identifier hs-var hs-var">sweep</span></a></span></span><span>  </span><span id="local-6989586621679966077"><span class="annot"><span class="annottext">es :: NonEmpty (Event r)
</span><a href="#local-6989586621679966077"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Reader
   (Vector (STR (Point 2 r) p VertexType)) [LineSegment 2 Int r]
 -&gt; Vector (STR (Point 2 r) p VertexType) -&gt; [LineSegment 2 Int r])
-&gt; Vector (STR (Point 2 r) p VertexType)
-&gt; Reader
     (Vector (STR (Point 2 r) p VertexType)) [LineSegment 2 Int r]
-&gt; [LineSegment 2 Int r]
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">Reader
  (Vector (STR (Point 2 r) p VertexType)) [LineSegment 2 Int r]
-&gt; Vector (STR (Point 2 r) p VertexType) -&gt; [LineSegment 2 Int r]
forall r a. Reader r a -&gt; r -&gt; a
</span><span class="hs-identifier hs-var">runReader</span></span><span> </span><span class="annot"><span class="annottext">Vector (STR (Point 2 r) p VertexType)
</span><a href="#local-6989586621679966098"><span class="hs-identifier hs-var">vertexInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(Reader
   (Vector (STR (Point 2 r) p VertexType)) [LineSegment 2 Int r]
 -&gt; [LineSegment 2 Int r])
-&gt; Reader
     (Vector (STR (Point 2 r) p VertexType)) [LineSegment 2 Int r]
-&gt; [LineSegment 2 Int r]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">StateT
  (StatusStruct r)
  (Reader (Vector (STR (Point 2 r) p VertexType)))
  [LineSegment 2 Int r]
-&gt; StatusStruct r
-&gt; Reader
     (Vector (STR (Point 2 r) p VertexType)) [LineSegment 2 Int r]
forall (m :: * -&gt; *) s a. Monad m =&gt; StateT s m a -&gt; s -&gt; m a
</span><span class="hs-identifier hs-var">evalStateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty (Event r)
-&gt; StateT
     (StatusStruct r)
     (Reader (Vector (STR (Point 2 r) p VertexType)))
     [LineSegment 2 Int r]
</span><a href="#local-6989586621679966074"><span class="hs-identifier hs-var">sweep'</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Event r)
</span><a href="#local-6989586621679966077"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StatusStruct r
forall r. StatusStruct r
</span><a href="#local-6989586621679966079"><span class="hs-identifier hs-var">initialSS</span></a></span><span>
</span><span id="line-147"></span><span>    </span><span id="local-6989586621679966074"><span class="annot"><span class="annottext">sweep' :: NonEmpty (Event r)
-&gt; StateT
     (StatusStruct r)
     (Reader (Vector (STR (Point 2 r) p VertexType)))
     [LineSegment 2 Int r]
</span><a href="#local-6989586621679966074"><span class="hs-identifier hs-var hs-var">sweep'</span></a></span></span><span> </span><span id="local-6989586621679966073"><span class="annot"><span class="annottext">es :: NonEmpty (Event r)
</span><a href="#local-6989586621679966073"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DList (LineSegment 2 Int r) -&gt; [LineSegment 2 Int r]
forall a. DList a -&gt; [a]
</span><span class="hs-identifier hs-var">DList.toList</span></span><span> </span><span class="annot"><span class="annottext">(DList (LineSegment 2 Int r) -&gt; [LineSegment 2 Int r])
-&gt; StateT
     (StatusStruct r)
     (Reader (Vector (STR (Point 2 r) p VertexType)))
     (DList (LineSegment 2 Int r))
-&gt; StateT
     (StatusStruct r)
     (Reader (Vector (STR (Point 2 r) p VertexType)))
     [LineSegment 2 Int r]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">WriterT
  (DList (LineSegment 2 Int r))
  (StateT
     (StatusStruct r) (Reader (Vector (STR (Point 2 r) p VertexType))))
  ()
-&gt; StateT
     (StatusStruct r)
     (Reader (Vector (STR (Point 2 r) p VertexType)))
     (DList (LineSegment 2 Int r))
forall (m :: * -&gt; *) w a. Monad m =&gt; WriterT w m a -&gt; m w
</span><span class="hs-identifier hs-var">execWriterT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty (Event r)
-&gt; WriterT
     (DList (LineSegment 2 Int r))
     (StateT
        (StatusStruct r) (Reader (Vector (STR (Point 2 r) p VertexType))))
     ()
</span><a href="#local-6989586621679966070"><span class="hs-identifier hs-var">sweep''</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Event r)
</span><a href="#local-6989586621679966073"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span>    </span><span class="annot"><a href="#local-6989586621679966070"><span class="hs-identifier hs-type">sweep''</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966324"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Sweep"><span class="hs-identifier hs-type">Sweep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966322"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966324"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>    </span><span id="local-6989586621679966070"><span class="annot"><span class="annottext">sweep'' :: NonEmpty (Event r)
-&gt; WriterT
     (DList (LineSegment 2 Int r))
     (StateT
        (StatusStruct r) (Reader (Vector (STR (Point 2 r) p VertexType))))
     ()
</span><a href="#local-6989586621679966070"><span class="hs-identifier hs-var hs-var">sweep''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Event r
 -&gt; WriterT
      (DList (LineSegment 2 Int r))
      (StateT
         (StatusStruct r) (Reader (Vector (STR (Point 2 r) p VertexType))))
      ())
-&gt; NonEmpty (Event r)
-&gt; WriterT
     (DList (LineSegment 2 Int r))
     (StateT
        (StatusStruct r) (Reader (Vector (STR (Point 2 r) p VertexType))))
     ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Event r
-&gt; WriterT
     (DList (LineSegment 2 Int r))
     (StateT
        (StatusStruct r) (Reader (Vector (STR (Point 2 r) p VertexType))))
     ()
forall r p. (Fractional r, Ord r) =&gt; Event r -&gt; Sweep p r ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#handle"><span class="hs-identifier hs-var">handle</span></a></span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-comment">-- make everything counterclockwise</span><span>
</span><span id="line-153"></span><span>    </span><span id="local-6989586621679966094"><span class="annot"><span class="annottext">toCCW :: Polygon t p r -&gt; Polygon t p r
</span><a href="#local-6989586621679966094"><span class="hs-identifier hs-var hs-var">toCCW</span></a></span></span><span> </span><span id="local-6989586621679966067"><span class="annot"><span class="annottext">p :: Polygon t p r
</span><a href="#local-6989586621679966067"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Polygon t p r -&gt; Polygon t p r
forall r (t :: PolygonType) p.
(Eq r, Num r) =&gt;
Polygon t p r -&gt; Polygon t p r
</span><a href="Data.Geometry.Polygon.Core.html#toCounterClockWiseOrder%27"><span class="hs-identifier hs-var">toCounterClockWiseOrder'</span></a></span><span> </span><span class="annot"><span class="annottext">Polygon t p r
</span><a href="#local-6989586621679966067"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">Polygon t p r -&gt; (Polygon t p r -&gt; Polygon t p r) -&gt; Polygon t p r
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span class="annot"><span class="annottext">([Polygon 'Simple p r] -&gt; Identity [Polygon 'Simple p r])
-&gt; Polygon t p r -&gt; Identity (Polygon t p r)
forall (t :: PolygonType) p r.
Traversal' (Polygon t p r) [Polygon 'Simple p r]
</span><a href="Data.Geometry.Polygon.Core.html#polygonHoles%27"><span class="hs-identifier hs-var">polygonHoles'</span></a></span><span class="annot"><span class="annottext">(([Polygon 'Simple p r] -&gt; Identity [Polygon 'Simple p r])
 -&gt; Polygon t p r -&gt; Identity (Polygon t p r))
-&gt; ((Polygon 'Simple p r -&gt; Identity (Polygon 'Simple p r))
    -&gt; [Polygon 'Simple p r] -&gt; Identity [Polygon 'Simple p r])
-&gt; (Polygon 'Simple p r -&gt; Identity (Polygon 'Simple p r))
-&gt; Polygon t p r
-&gt; Identity (Polygon t p r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Polygon 'Simple p r -&gt; Identity (Polygon 'Simple p r))
-&gt; [Polygon 'Simple p r] -&gt; Identity [Polygon 'Simple p r]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">((Polygon 'Simple p r -&gt; Identity (Polygon 'Simple p r))
 -&gt; Polygon t p r -&gt; Identity (Polygon t p r))
-&gt; (Polygon 'Simple p r -&gt; Polygon 'Simple p r)
-&gt; Polygon t p r
-&gt; Polygon t p r
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="annot"><span class="annottext">Polygon 'Simple p r -&gt; Polygon 'Simple p r
forall r (t :: PolygonType) p.
(Eq r, Num r) =&gt;
Polygon t p r -&gt; Polygon t p r
</span><a href="Data.Geometry.Polygon.Core.html#toCounterClockWiseOrder%27"><span class="hs-identifier hs-var">toCounterClockWiseOrder'</span></a></span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-comment">-- make the holes clockwise:</span><span>
</span><span id="line-155"></span><span>    </span><span id="local-6989586621679966095"><span class="annot"><span class="annottext">holesToCW :: Polygon t p r -&gt; Polygon t p r
</span><a href="#local-6989586621679966095"><span class="hs-identifier hs-var hs-var">holesToCW</span></a></span></span><span> </span><span id="local-6989586621679966063"><span class="annot"><span class="annottext">p :: Polygon t p r
</span><a href="#local-6989586621679966063"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Polygon t p r
</span><a href="#local-6989586621679966063"><span class="hs-identifier hs-var">p</span></a></span><span class="annot"><span class="annottext">Polygon t p r -&gt; (Polygon t p r -&gt; Polygon t p r) -&gt; Polygon t p r
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span class="annot"><span class="annottext">([Polygon 'Simple p r] -&gt; Identity [Polygon 'Simple p r])
-&gt; Polygon t p r -&gt; Identity (Polygon t p r)
forall (t :: PolygonType) p r.
Traversal' (Polygon t p r) [Polygon 'Simple p r]
</span><a href="Data.Geometry.Polygon.Core.html#polygonHoles%27"><span class="hs-identifier hs-var">polygonHoles'</span></a></span><span class="annot"><span class="annottext">(([Polygon 'Simple p r] -&gt; Identity [Polygon 'Simple p r])
 -&gt; Polygon t p r -&gt; Identity (Polygon t p r))
-&gt; ((Polygon 'Simple p r -&gt; Identity (Polygon 'Simple p r))
    -&gt; [Polygon 'Simple p r] -&gt; Identity [Polygon 'Simple p r])
-&gt; (Polygon 'Simple p r -&gt; Identity (Polygon 'Simple p r))
-&gt; Polygon t p r
-&gt; Identity (Polygon t p r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Polygon 'Simple p r -&gt; Identity (Polygon 'Simple p r))
-&gt; [Polygon 'Simple p r] -&gt; Identity [Polygon 'Simple p r]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">((Polygon 'Simple p r -&gt; Identity (Polygon 'Simple p r))
 -&gt; Polygon t p r -&gt; Identity (Polygon t p r))
-&gt; (Polygon 'Simple p r -&gt; Polygon 'Simple p r)
-&gt; Polygon t p r
-&gt; Polygon t p r
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="annot"><span class="annottext">Polygon 'Simple p r -&gt; Polygon 'Simple p r
forall r (t :: PolygonType) p.
(Eq r, Num r) =&gt;
Polygon t p r -&gt; Polygon t p r
</span><a href="Data.Geometry.Polygon.Core.html#toClockwiseOrder%27"><span class="hs-identifier hs-var">toClockwiseOrder'</span></a></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="hs-comment">-- | Computes a set of diagionals that decompose the polygon into y-monotone</span><span>
</span><span id="line-160"></span><span class="hs-comment">-- pieces.</span><span>
</span><span id="line-161"></span><span class="hs-comment">--</span><span>
</span><span id="line-162"></span><span class="hs-comment">-- pre: the polygon boundary is given in counterClockwise order.</span><span>
</span><span id="line-163"></span><span class="hs-comment">--</span><span>
</span><span id="line-164"></span><span class="hs-comment">-- running time: \(O(n\log n)\)</span><span>
</span><span id="line-165"></span><span id="local-6989586621679966057"><span id="local-6989586621679966058"><span id="local-6989586621679966059"><span id="local-6989586621679966060"><span id="local-6989586621679966061"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#makeMonotone"><span class="hs-identifier hs-type">makeMonotone</span></a></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679966061"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679966061"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>                  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679966060"><span class="hs-identifier hs-type">proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966059"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Polygon.Core.html#Polygon"><span class="hs-identifier hs-type">Polygon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966058"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966057"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966061"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-167"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.PlanarSubdivision.Basic.html#PlanarSubdivision"><span class="hs-identifier hs-type">PlanarSubdivision</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966059"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966057"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.Types.html#PolygonEdgeType"><span class="hs-identifier hs-type">PolygonEdgeType</span></a></span><span> </span><span class="annot"><a href="Data.Geometry.PlanarSubdivision.Basic.html#PolygonFaceData"><span class="hs-identifier hs-type">PolygonFaceData</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966061"><span class="hs-identifier hs-type">r</span></a></span></span></span></span></span></span><span>
</span><span id="line-168"></span><span id="makeMonotone"><span class="annot"><span class="annottext">makeMonotone :: proxy s
-&gt; Polygon t p r
-&gt; PlanarSubdivision s p PolygonEdgeType PolygonFaceData r
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#makeMonotone"><span class="hs-identifier hs-var hs-var">makeMonotone</span></a></span></span><span> </span><span id="local-6989586621679966056"><span class="annot"><span class="annottext">px :: proxy s
</span><a href="#local-6989586621679966056"><span class="hs-identifier hs-var">px</span></a></span></span><span> </span><span id="local-6989586621679966055"><span class="annot"><span class="annottext">pg :: Polygon t p r
</span><a href="#local-6989586621679966055"><span class="hs-identifier hs-var">pg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679966054"><span class="annot"><span class="annottext">e :: LineSegment 2 p r
</span><a href="#local-6989586621679966054"><span class="hs-identifier hs-var">e</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679966053"><span class="annot"><span class="annottext">es :: [LineSegment 2 p r]
</span><a href="#local-6989586621679966053"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Polygon t p r -&gt; [LineSegment 2 p r]
forall (t :: PolygonType) p r. Polygon t p r -&gt; [LineSegment 2 p r]
</span><a href="Data.Geometry.Polygon.Core.html#listEdges"><span class="hs-identifier hs-var">listEdges</span></a></span><span> </span><span class="annot"><span class="annottext">Polygon t p r
</span><a href="#local-6989586621679966055"><span class="hs-identifier hs-var">pg</span></a></span><span>
</span><span id="line-169"></span><span>                     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">proxy s
-&gt; LineSegment 2 p r
-&gt; [LineSegment 2 p r]
-&gt; [LineSegment 2 p r]
-&gt; PlanarSubdivision s p PolygonEdgeType PolygonFaceData r
forall k (proxy :: k -&gt; *) r (s :: k) p.
(Fractional r, Ord r) =&gt;
proxy s
-&gt; LineSegment 2 p r
-&gt; [LineSegment 2 p r]
-&gt; [LineSegment 2 p r]
-&gt; PlanarSubdivision s p PolygonEdgeType PolygonFaceData r
</span><a href="Algorithms.Geometry.PolygonTriangulation.Types.html#constructSubdivision"><span class="hs-identifier hs-var">constructSubdivision</span></a></span><span> </span><span class="annot"><span class="annottext">proxy s
</span><a href="#local-6989586621679966056"><span class="hs-identifier hs-var">px</span></a></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621679966054"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621679966053"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Polygon t p r -&gt; [LineSegment 2 p r]
forall (t :: PolygonType) r p.
(Fractional r, Ord r) =&gt;
Polygon t p r -&gt; [LineSegment 2 p r]
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#computeDiagonals"><span class="hs-identifier hs-var">computeDiagonals</span></a></span><span> </span><span class="annot"><span class="annottext">Polygon t p r
</span><a href="#local-6989586621679966055"><span class="hs-identifier hs-var">pg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span class="hs-keyword">type</span><span> </span><span id="Sweep"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Sweep"><span class="hs-identifier hs-var">Sweep</span></a></span></span><span> </span><span id="local-6989586621679966050"><span class="annot"><a href="#local-6989586621679966050"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span id="local-6989586621679966049"><span class="annot"><a href="#local-6989586621679966049"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">WriterT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DList.DList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.LineSegment.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><a href="#local-6989586621679966049"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#StatusStruct"><span class="hs-identifier hs-type">StatusStruct</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966049"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#VertexInfo"><span class="hs-identifier hs-type">VertexInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966050"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966049"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span class="hs-keyword">type</span><span> </span><span id="VertexInfo"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#VertexInfo"><span class="hs-identifier hs-var">VertexInfo</span></a></span></span><span> </span><span id="local-6989586621679966048"><span class="annot"><a href="#local-6989586621679966048"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span id="local-6989586621679966047"><span class="annot"><a href="#local-6989586621679966047"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STR</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679966047"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679966048"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#VertexType"><span class="hs-identifier hs-type">VertexType</span></a></span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span id="local-6989586621679966248"><span id="local-6989586621679966249"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#tell%27"><span class="hs-identifier hs-type">tell'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Geometry.LineSegment.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><a href="#local-6989586621679966249"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Sweep"><span class="hs-identifier hs-type">Sweep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966248"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966249"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-179"></span><span id="tell%27"><span class="annot"><span class="annottext">tell' :: LineSegment 2 Int r -&gt; Sweep p r ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#tell%27"><span class="hs-identifier hs-var hs-var">tell'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DList (LineSegment 2 Int r) -&gt; Sweep p r ()
forall w (m :: * -&gt; *). MonadWriter w m =&gt; w -&gt; m ()
</span><span class="hs-identifier hs-var">tell</span></span><span> </span><span class="annot"><span class="annottext">(DList (LineSegment 2 Int r) -&gt; Sweep p r ())
-&gt; (LineSegment 2 Int r -&gt; DList (LineSegment 2 Int r))
-&gt; LineSegment 2 Int r
-&gt; Sweep p r ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 Int r -&gt; DList (LineSegment 2 Int r)
forall a. a -&gt; DList a
</span><span class="hs-identifier hs-var">DList.singleton</span></span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span id="local-6989586621679966291"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#getIdx"><span class="hs-identifier hs-type">getIdx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966291"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span><span>
</span><span id="line-182"></span><span id="getIdx"><span class="annot"><span class="annottext">getIdx :: Event r -&gt; Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#getIdx"><span class="hs-identifier hs-var hs-var">getIdx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Getting Int (Event r) Int -&gt; Event r -&gt; Int
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Two (LineSegment 2 Int r)
 -&gt; Const Int (Two (LineSegment 2 Int r)))
-&gt; Event r -&gt; Const Int (Event r)
forall core extra extra'.
Lens (core :+ extra) (core :+ extra') extra extra'
</span><span class="hs-identifier hs-var">extra</span></span><span class="annot"><span class="annottext">((Two (LineSegment 2 Int r)
  -&gt; Const Int (Two (LineSegment 2 Int r)))
 -&gt; Event r -&gt; Const Int (Event r))
-&gt; ((Int -&gt; Const Int Int)
    -&gt; Two (LineSegment 2 Int r)
    -&gt; Const Int (Two (LineSegment 2 Int r)))
-&gt; Getting Int (Event r) Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(LineSegment 2 Int r -&gt; Const Int (LineSegment 2 Int r))
-&gt; Two (LineSegment 2 Int r)
-&gt; Const Int (Two (LineSegment 2 Int r))
forall s t a b. Field1 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_1</span></span><span class="annot"><span class="annottext">((LineSegment 2 Int r -&gt; Const Int (LineSegment 2 Int r))
 -&gt; Two (LineSegment 2 Int r)
 -&gt; Const Int (Two (LineSegment 2 Int r)))
-&gt; ((Int -&gt; Const Int Int)
    -&gt; LineSegment 2 Int r -&gt; Const Int (LineSegment 2 Int r))
-&gt; (Int -&gt; Const Int Int)
-&gt; Two (LineSegment 2 Int r)
-&gt; Const Int (Two (LineSegment 2 Int r))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">((Point 2 r :+ Int) -&gt; Const Int (Point 2 r :+ Int))
-&gt; LineSegment 2 Int r -&gt; Const Int (LineSegment 2 Int r)
forall t. HasEnd t =&gt; Lens' t (EndCore t :+ EndExtra t)
</span><a href="Data.Geometry.Interval.html#end"><span class="hs-identifier hs-var">end</span></a></span><span class="annot"><span class="annottext">(((Point 2 r :+ Int) -&gt; Const Int (Point 2 r :+ Int))
 -&gt; LineSegment 2 Int r -&gt; Const Int (LineSegment 2 Int r))
-&gt; ((Int -&gt; Const Int Int)
    -&gt; (Point 2 r :+ Int) -&gt; Const Int (Point 2 r :+ Int))
-&gt; (Int -&gt; Const Int Int)
-&gt; LineSegment 2 Int r
-&gt; Const Int (LineSegment 2 Int r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Int -&gt; Const Int Int)
-&gt; (Point 2 r :+ Int) -&gt; Const Int (Point 2 r :+ Int)
forall core extra extra'.
Lens (core :+ extra) (core :+ extra') extra extra'
</span><span class="hs-identifier hs-var">extra</span></span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span id="local-6989586621679966292"><span id="local-6989586621679966293"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#getVertexType"><span class="hs-identifier hs-type">getVertexType</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Sweep"><span class="hs-identifier hs-type">Sweep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966293"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966292"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#VertexType"><span class="hs-identifier hs-type">VertexType</span></a></span></span></span><span>
</span><span id="line-185"></span><span id="getVertexType"><span class="annot"><span class="annottext">getVertexType :: Int -&gt; Sweep p r VertexType
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#getVertexType"><span class="hs-identifier hs-var hs-var">getVertexType</span></a></span></span><span> </span><span id="local-6989586621679966040"><span class="annot"><span class="annottext">v :: Int
</span><a href="#local-6989586621679966040"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Vector (VertexInfo p r) -&gt; VertexType) -&gt; Sweep p r VertexType
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector (VertexInfo p r)
-&gt; Getting VertexType (Vector (VertexInfo p r)) VertexType
-&gt; VertexType
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Int -&gt; Lens' (Vector (VertexInfo p r)) (VertexInfo p r)
forall a. Int -&gt; Lens' (Vector a) a
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#ix%27"><span class="hs-identifier hs-var">ix'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679966040"><span class="hs-identifier hs-var">v</span></a></span><span class="annot"><span class="annottext">((VertexInfo p r -&gt; Const VertexType (VertexInfo p r))
 -&gt; Vector (VertexInfo p r)
 -&gt; Const VertexType (Vector (VertexInfo p r)))
-&gt; ((VertexType -&gt; Const VertexType VertexType)
    -&gt; VertexInfo p r -&gt; Const VertexType (VertexInfo p r))
-&gt; Getting VertexType (Vector (VertexInfo p r)) VertexType
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(VertexType -&gt; Const VertexType VertexType)
-&gt; VertexInfo p r -&gt; Const VertexType (VertexInfo p r)
forall s t a b. Field3 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_3</span></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span id="local-6989586621679966287"><span id="local-6989586621679966288"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#getEventType"><span class="hs-identifier hs-type">getEventType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966288"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Sweep"><span class="hs-identifier hs-type">Sweep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966287"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966288"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#VertexType"><span class="hs-identifier hs-type">VertexType</span></a></span></span></span><span>
</span><span id="line-188"></span><span id="getEventType"><span class="annot"><span class="annottext">getEventType :: Event r -&gt; Sweep p r VertexType
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#getEventType"><span class="hs-identifier hs-var hs-var">getEventType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Sweep p r VertexType
forall p r. Int -&gt; Sweep p r VertexType
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#getVertexType"><span class="hs-identifier hs-var">getVertexType</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Sweep p r VertexType)
-&gt; (Event r -&gt; Int) -&gt; Event r -&gt; Sweep p r VertexType
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Event r -&gt; Int
forall r. Event r -&gt; Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#getIdx"><span class="hs-identifier hs-var">getIdx</span></a></span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span id="local-6989586621679966354"><span id="local-6989586621679966355"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#handle"><span class="hs-identifier hs-type">handle</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679966355"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679966355"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966355"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Sweep"><span class="hs-identifier hs-type">Sweep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966354"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966355"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-191"></span><span id="handle"><span class="annot"><span class="annottext">handle :: Event r -&gt; Sweep p r ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#handle"><span class="hs-identifier hs-var hs-var">handle</span></a></span></span><span> </span><span id="local-6989586621679966036"><span class="annot"><span class="annottext">e :: Event r
</span><a href="#local-6989586621679966036"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679966035"><span class="annot"><span class="annottext">i :: Int
</span><a href="#local-6989586621679966035"><span class="hs-identifier hs-var hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Event r -&gt; Int
forall r. Event r -&gt; Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#getIdx"><span class="hs-identifier hs-var">getIdx</span></a></span><span> </span><span class="annot"><span class="annottext">Event r
</span><a href="#local-6989586621679966036"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Event r -&gt; Sweep p r VertexType
forall r p. Event r -&gt; Sweep p r VertexType
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#getEventType"><span class="hs-identifier hs-var">getEventType</span></a></span><span> </span><span class="annot"><span class="annottext">Event r
</span><a href="#local-6989586621679966036"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Sweep p r VertexType
-&gt; (VertexType -&gt; Sweep p r ()) -&gt; Sweep p r ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-192"></span><span>    </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Start"><span class="hs-identifier hs-type">Start</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Event r -&gt; Sweep p r ()
forall r p. (Fractional r, Ord r) =&gt; Int -&gt; Event r -&gt; Sweep p r ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#handleStart"><span class="hs-identifier hs-var">handleStart</span></a></span><span>   </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679966035"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Event r
</span><a href="#local-6989586621679966036"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-193"></span><span>    </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#End"><span class="hs-identifier hs-type">End</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Event r -&gt; Sweep p r ()
forall r p. (Fractional r, Ord r) =&gt; Int -&gt; Event r -&gt; Sweep p r ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#handleEnd"><span class="hs-identifier hs-var">handleEnd</span></a></span><span>     </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679966035"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Event r
</span><a href="#local-6989586621679966036"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-194"></span><span>    </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Split"><span class="hs-identifier hs-type">Split</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Event r -&gt; Sweep p r ()
forall r p. (Fractional r, Ord r) =&gt; Int -&gt; Event r -&gt; Sweep p r ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#handleSplit"><span class="hs-identifier hs-var">handleSplit</span></a></span><span>   </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679966035"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Event r
</span><a href="#local-6989586621679966036"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-195"></span><span>    </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Merge"><span class="hs-identifier hs-type">Merge</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Event r -&gt; Sweep p r ()
forall r p. (Fractional r, Ord r) =&gt; Int -&gt; Event r -&gt; Sweep p r ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#handleMerge"><span class="hs-identifier hs-var">handleMerge</span></a></span><span>   </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679966035"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Event r
</span><a href="#local-6989586621679966036"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-196"></span><span>    </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Regular"><span class="hs-identifier hs-type">Regular</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Event r -&gt; Bool
forall r. Ord r =&gt; Int -&gt; Event r -&gt; Bool
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#isLeftVertex"><span class="hs-identifier hs-var">isLeftVertex</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679966035"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Event r
</span><a href="#local-6989586621679966036"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Event r -&gt; Sweep p r ()
forall r p. (Fractional r, Ord r) =&gt; Int -&gt; Event r -&gt; Sweep p r ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#handleRegularL"><span class="hs-identifier hs-var">handleRegularL</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679966035"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Event r
</span><a href="#local-6989586621679966036"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-197"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Event r -&gt; Sweep p r ()
forall r p. (Fractional r, Ord r) =&gt; Int -&gt; Event r -&gt; Sweep p r ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#handleRegularR"><span class="hs-identifier hs-var">handleRegularR</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679966035"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Event r
</span><a href="#local-6989586621679966036"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span id="local-6989586621679966267"><span id="local-6989586621679966268"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#insertAt"><span class="hs-identifier hs-type">insertAt</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679966268"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679966268"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679966268"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.LineSegment.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679966267"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966268"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-201"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SS.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.LineSegment.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679966267"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966268"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SS.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.LineSegment.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679966267"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966268"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-202"></span><span id="insertAt"><span class="annot"><span class="annottext">insertAt :: Point 2 r
-&gt; LineSegment 2 q r
-&gt; Set (LineSegment 2 q r)
-&gt; Set (LineSegment 2 q r)
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#insertAt"><span class="hs-identifier hs-var hs-var">insertAt</span></a></span></span><span> </span><span id="local-6989586621679966026"><span class="annot"><span class="annottext">v :: Point 2 r
</span><a href="#local-6989586621679966026"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 q r -&gt; LineSegment 2 q r -&gt; Ordering)
-&gt; LineSegment 2 q r
-&gt; Set (LineSegment 2 q r)
-&gt; Set (LineSegment 2 q r)
forall a. (a -&gt; a -&gt; Ordering) -&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">SS.insertBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r -&gt; LineSegment 2 q r -&gt; LineSegment 2 q r -&gt; Ordering
forall r p.
(Fractional r, Ord r) =&gt;
r -&gt; Compare (LineSegment 2 p r)
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#ordAt"><span class="hs-identifier hs-var">ordAt</span></a></span><span> </span><span class="annot"><span class="annottext">(r -&gt; LineSegment 2 q r -&gt; LineSegment 2 q r -&gt; Ordering)
-&gt; r -&gt; LineSegment 2 q r -&gt; LineSegment 2 q r -&gt; Ordering
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679966026"><span class="hs-identifier hs-var">v</span></a></span><span class="annot"><span class="annottext">Point 2 r -&gt; Getting r (Point 2 r) r -&gt; r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting r (Point 2 r) r
forall (d :: Nat) (point :: Nat -&gt; * -&gt; *) r.
(2 &lt;= d, Arity d, AsAPoint point) =&gt;
Lens' (point d r) r
</span><a href="Data.Geometry.Point.Class.html#yCoord"><span class="hs-identifier hs-var">yCoord</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span id="local-6989586621679966255"><span id="local-6989586621679966256"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#deleteAt"><span class="hs-identifier hs-type">deleteAt</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679966256"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679966256"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679966256"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.LineSegment.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679966255"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966256"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-205"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SS.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.LineSegment.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679966255"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966256"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SS.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.LineSegment.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679966255"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966256"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-206"></span><span id="deleteAt"><span class="annot"><span class="annottext">deleteAt :: Point 2 r
-&gt; LineSegment 2 p r
-&gt; Set (LineSegment 2 p r)
-&gt; Set (LineSegment 2 p r)
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#deleteAt"><span class="hs-identifier hs-var hs-var">deleteAt</span></a></span></span><span> </span><span id="local-6989586621679966023"><span class="annot"><span class="annottext">v :: Point 2 r
</span><a href="#local-6989586621679966023"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Ordering)
-&gt; LineSegment 2 p r
-&gt; Set (LineSegment 2 p r)
-&gt; Set (LineSegment 2 p r)
forall a. (a -&gt; a -&gt; Ordering) -&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">SS.deleteAllBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r -&gt; LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Ordering
forall r p.
(Fractional r, Ord r) =&gt;
r -&gt; Compare (LineSegment 2 p r)
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#ordAt"><span class="hs-identifier hs-var">ordAt</span></a></span><span> </span><span class="annot"><span class="annottext">(r -&gt; LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Ordering)
-&gt; r -&gt; LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Ordering
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679966023"><span class="hs-identifier hs-var">v</span></a></span><span class="annot"><span class="annottext">Point 2 r -&gt; Getting r (Point 2 r) r -&gt; r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting r (Point 2 r) r
forall (d :: Nat) (point :: Nat -&gt; * -&gt; *) r.
(2 &lt;= d, Arity d, AsAPoint point) =&gt;
Lens' (point d r) r
</span><a href="Data.Geometry.Point.Class.html#yCoord"><span class="hs-identifier hs-var">yCoord</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span id="local-6989586621679966283"><span id="local-6989586621679966284"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#handleStart"><span class="hs-identifier hs-type">handleStart</span></a></span><span>              </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679966284"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679966284"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span>                         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966284"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Sweep"><span class="hs-identifier hs-type">Sweep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966283"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966284"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-211"></span><span id="handleStart"><span class="annot"><span class="annottext">handleStart :: Int -&gt; Event r -&gt; Sweep p r ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#handleStart"><span class="hs-identifier hs-var hs-var">handleStart</span></a></span></span><span> </span><span id="local-6989586621679966021"><span class="annot"><span class="annottext">i :: Int
</span><a href="#local-6989586621679966021"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679966020"><span class="annot"><span class="annottext">v :: Point 2 r
</span><a href="#local-6989586621679966020"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span id="local-6989586621679966019"><span class="annot"><span class="annottext">adj :: Two (LineSegment 2 Int r)
</span><a href="#local-6989586621679966019"><span class="hs-identifier hs-var">adj</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(StatusStruct r -&gt; StatusStruct r) -&gt; Sweep p r ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((StatusStruct r -&gt; StatusStruct r) -&gt; Sweep p r ())
-&gt; (StatusStruct r -&gt; StatusStruct r) -&gt; Sweep p r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#SS"><span class="hs-identifier hs-type">SS</span></a></span><span> </span><span id="local-6989586621679966017"><span class="annot"><span class="annottext">t :: Set (LineSegment 2 Int r)
</span><a href="#local-6989586621679966017"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679966016"><span class="annot"><span class="annottext">h :: IntMap Int
</span><a href="#local-6989586621679966016"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-212"></span><span>                                </span><span class="annot"><span class="annottext">Set (LineSegment 2 Int r) -&gt; IntMap Int -&gt; StatusStruct r
forall r. Set (LineSegment 2 Int r) -&gt; IntMap Int -&gt; StatusStruct r
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#SS"><span class="hs-identifier hs-var">SS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
-&gt; LineSegment 2 Int r
-&gt; Set (LineSegment 2 Int r)
-&gt; Set (LineSegment 2 Int r)
forall r q.
(Ord r, Fractional r) =&gt;
Point 2 r
-&gt; LineSegment 2 q r
-&gt; Set (LineSegment 2 q r)
-&gt; Set (LineSegment 2 q r)
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#insertAt"><span class="hs-identifier hs-var">insertAt</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679966020"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Two (LineSegment 2 Int r)
</span><a href="#local-6989586621679966019"><span class="hs-identifier hs-var">adj</span></a></span><span class="annot"><span class="annottext">Two (LineSegment 2 Int r)
-&gt; Getting
     (LineSegment 2 Int r)
     (Two (LineSegment 2 Int r))
     (LineSegment 2 Int r)
-&gt; LineSegment 2 Int r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting
  (LineSegment 2 Int r)
  (Two (LineSegment 2 Int r))
  (LineSegment 2 Int r)
forall s t a b. Field2 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set (LineSegment 2 Int r)
</span><a href="#local-6989586621679966017"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span>                                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; IntMap Int -&gt; IntMap Int
forall a. Int -&gt; a -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IntMap.insert</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679966021"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679966021"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Int
</span><a href="#local-6989586621679966016"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span id="local-6989586621679966013"><span id="local-6989586621679966014"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#handleEnd"><span class="hs-identifier hs-type">handleEnd</span></a></span><span>              </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679966014"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679966014"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span>                       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966014"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Sweep"><span class="hs-identifier hs-type">Sweep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966013"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966014"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-217"></span><span id="handleEnd"><span class="annot"><span class="annottext">handleEnd :: Int -&gt; Event r -&gt; Sweep p r ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#handleEnd"><span class="hs-identifier hs-var hs-var">handleEnd</span></a></span></span><span> </span><span id="local-6989586621679966012"><span class="annot"><span class="annottext">i :: Int
</span><a href="#local-6989586621679966012"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679966011"><span class="annot"><span class="annottext">v :: Point 2 r
</span><a href="#local-6989586621679966011"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span id="local-6989586621679966010"><span class="annot"><span class="annottext">adj :: Two (LineSegment 2 Int r)
</span><a href="#local-6989586621679966010"><span class="hs-identifier hs-var">adj</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679966009"><span class="annot"><span class="annottext">iPred :: Int
</span><a href="#local-6989586621679966009"><span class="hs-identifier hs-var hs-var">iPred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Two (LineSegment 2 Int r)
</span><a href="#local-6989586621679966010"><span class="hs-identifier hs-var">adj</span></a></span><span class="annot"><span class="annottext">Two (LineSegment 2 Int r)
-&gt; Getting Int (Two (LineSegment 2 Int r)) Int -&gt; Int
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">(LineSegment 2 Int r -&gt; Const Int (LineSegment 2 Int r))
-&gt; Two (LineSegment 2 Int r)
-&gt; Const Int (Two (LineSegment 2 Int r))
forall s t a b. Field1 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_1</span></span><span class="annot"><span class="annottext">((LineSegment 2 Int r -&gt; Const Int (LineSegment 2 Int r))
 -&gt; Two (LineSegment 2 Int r)
 -&gt; Const Int (Two (LineSegment 2 Int r)))
-&gt; ((Int -&gt; Const Int Int)
    -&gt; LineSegment 2 Int r -&gt; Const Int (LineSegment 2 Int r))
-&gt; Getting Int (Two (LineSegment 2 Int r)) Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">((Point 2 r :+ Int) -&gt; Const Int (Point 2 r :+ Int))
-&gt; LineSegment 2 Int r -&gt; Const Int (LineSegment 2 Int r)
forall t. HasStart t =&gt; Lens' t (StartCore t :+ StartExtra t)
</span><a href="Data.Geometry.Interval.html#start"><span class="hs-identifier hs-var">start</span></a></span><span class="annot"><span class="annottext">(((Point 2 r :+ Int) -&gt; Const Int (Point 2 r :+ Int))
 -&gt; LineSegment 2 Int r -&gt; Const Int (LineSegment 2 Int r))
-&gt; ((Int -&gt; Const Int Int)
    -&gt; (Point 2 r :+ Int) -&gt; Const Int (Point 2 r :+ Int))
-&gt; (Int -&gt; Const Int Int)
-&gt; LineSegment 2 Int r
-&gt; Const Int (LineSegment 2 Int r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Int -&gt; Const Int Int)
-&gt; (Point 2 r :+ Int) -&gt; Const Int (Point 2 r :+ Int)
forall core extra extra'.
Lens (core :+ extra) (core :+ extra') extra extra'
</span><span class="hs-identifier hs-var">extra</span></span><span>  </span><span class="hs-comment">-- i-1</span><span>
</span><span id="line-218"></span><span>                            </span><span class="hs-comment">-- lookup p's helper; if it is a merge vertex</span><span>
</span><span id="line-219"></span><span>                            </span><span class="hs-comment">-- we insert a new segment</span><span>
</span><span id="line-220"></span><span>                            </span><span class="annot"><span class="annottext">Int -&gt; Point 2 r -&gt; Int -&gt; Sweep p r ()
forall r p. Int -&gt; Point 2 r -&gt; Int -&gt; Sweep p r ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#tellIfMerge"><span class="hs-identifier hs-var">tellIfMerge</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679966012"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679966011"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679966009"><span class="hs-identifier hs-var">iPred</span></a></span><span>
</span><span id="line-221"></span><span>                            </span><span class="hs-comment">-- delete e_{i-1} from the status struct</span><span>
</span><span id="line-222"></span><span>                            </span><span class="annot"><span class="annottext">(StatusStruct r -&gt; StatusStruct r) -&gt; Sweep p r ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((StatusStruct r -&gt; StatusStruct r) -&gt; Sweep p r ())
-&gt; (StatusStruct r -&gt; StatusStruct r) -&gt; Sweep p r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679966006"><span class="annot"><span class="annottext">ss :: StatusStruct r
</span><a href="#local-6989586621679966006"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-223"></span><span>                              </span><span class="annot"><span class="annottext">StatusStruct r
</span><a href="#local-6989586621679966006"><span class="hs-identifier hs-var">ss</span></a></span><span class="annot"><span class="annottext">StatusStruct r
-&gt; (StatusStruct r -&gt; StatusStruct r) -&gt; StatusStruct r
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span class="annot"><span class="annottext">(Set (LineSegment 2 Int r) -&gt; Identity (Set (LineSegment 2 Int r)))
-&gt; StatusStruct r -&gt; Identity (StatusStruct r)
forall r r.
Lens
  (StatusStruct r)
  (StatusStruct r)
  (Set (LineSegment 2 Int r))
  (Set (LineSegment 2 Int r))
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#statusStruct"><span class="hs-identifier hs-var">statusStruct</span></a></span><span> </span><span class="annot"><span class="annottext">((Set (LineSegment 2 Int r)
  -&gt; Identity (Set (LineSegment 2 Int r)))
 -&gt; StatusStruct r -&gt; Identity (StatusStruct r))
-&gt; (Set (LineSegment 2 Int r) -&gt; Set (LineSegment 2 Int r))
-&gt; StatusStruct r
-&gt; StatusStruct r
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
-&gt; LineSegment 2 Int r
-&gt; Set (LineSegment 2 Int r)
-&gt; Set (LineSegment 2 Int r)
forall r p.
(Fractional r, Ord r) =&gt;
Point 2 r
-&gt; LineSegment 2 p r
-&gt; Set (LineSegment 2 p r)
-&gt; Set (LineSegment 2 p r)
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#deleteAt"><span class="hs-identifier hs-var">deleteAt</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679966011"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Two (LineSegment 2 Int r)
</span><a href="#local-6989586621679966010"><span class="hs-identifier hs-var">adj</span></a></span><span class="annot"><span class="annottext">Two (LineSegment 2 Int r)
-&gt; Getting
     (LineSegment 2 Int r)
     (Two (LineSegment 2 Int r))
     (LineSegment 2 Int r)
-&gt; LineSegment 2 Int r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting
  (LineSegment 2 Int r)
  (Two (LineSegment 2 Int r))
  (LineSegment 2 Int r)
forall s t a b. Field1 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_1</span></span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span class="hs-comment">-- | Adds edge (i,j) if e_j's helper is a merge vertex</span><span>
</span><span id="line-226"></span><span id="local-6989586621679966258"><span id="local-6989586621679966259"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#tellIfMerge"><span class="hs-identifier hs-type">tellIfMerge</span></a></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679966259"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Sweep"><span class="hs-identifier hs-type">Sweep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966258"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966259"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-227"></span><span id="tellIfMerge"><span class="annot"><span class="annottext">tellIfMerge :: Int -&gt; Point 2 r -&gt; Int -&gt; Sweep p r ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#tellIfMerge"><span class="hs-identifier hs-var hs-var">tellIfMerge</span></a></span></span><span> </span><span id="local-6989586621679966005"><span class="annot"><span class="annottext">i :: Int
</span><a href="#local-6989586621679966005"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679966004"><span class="annot"><span class="annottext">v :: Point 2 r
</span><a href="#local-6989586621679966004"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679966003"><span class="annot"><span class="annottext">j :: Int
</span><a href="#local-6989586621679966003"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SP</span></span><span> </span><span id="local-6989586621679966002"><span class="annot"><span class="annottext">u :: Point 2 r :+ Int
</span><a href="#local-6989586621679966002"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621679966001"><span class="annot"><span class="annottext">ut :: VertexType
</span><a href="#local-6989586621679966001"><span class="hs-identifier hs-var">ut</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Sweep p r (SP (Point 2 r :+ Int) VertexType)
forall p r. Int -&gt; Sweep p r (SP (Point 2 r :+ Int) VertexType)
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#getHelper"><span class="hs-identifier hs-var">getHelper</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679966003"><span class="hs-identifier hs-var">j</span></a></span><span>
</span><span id="line-228"></span><span>                       </span><span class="annot"><span class="annottext">Bool -&gt; Sweep p r () -&gt; Sweep p r ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VertexType
</span><a href="#local-6989586621679966001"><span class="hs-identifier hs-var">ut</span></a></span><span> </span><span class="annot"><span class="annottext">VertexType -&gt; VertexType -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">VertexType
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Merge"><span class="hs-identifier hs-var">Merge</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LineSegment 2 Int r -&gt; Sweep p r ()
forall r p. LineSegment 2 Int r -&gt; Sweep p r ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#tell%27"><span class="hs-identifier hs-var">tell'</span></a></span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 Int r -&gt; Sweep p r ())
-&gt; LineSegment 2 Int r -&gt; Sweep p r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Point 2 r :+ Int) -&gt; (Point 2 r :+ Int) -&gt; LineSegment 2 Int r
forall (d :: Nat) r p.
(Point d r :+ p) -&gt; (Point d r :+ p) -&gt; LineSegment d p r
</span><a href="Data.Geometry.LineSegment.html#ClosedLineSegment"><span class="hs-identifier hs-var">ClosedLineSegment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679966004"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Int -&gt; Point 2 r :+ Int
forall core extra. core -&gt; extra -&gt; core :+ extra
</span><span class="hs-operator hs-var">:+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679966005"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ Int
</span><a href="#local-6989586621679966002"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span class="hs-comment">-- | Get the helper of edge i, and its vertex type</span><span>
</span><span id="line-231"></span><span id="local-6989586621679966251"><span id="local-6989586621679966252"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#getHelper"><span class="hs-identifier hs-type">getHelper</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Sweep"><span class="hs-identifier hs-type">Sweep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966252"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966251"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SP</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679966251"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#VertexType"><span class="hs-identifier hs-type">VertexType</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-232"></span><span id="getHelper"><span class="annot"><span class="annottext">getHelper :: Int -&gt; Sweep p r (SP (Point 2 r :+ Int) VertexType)
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#getHelper"><span class="hs-identifier hs-var hs-var">getHelper</span></a></span></span><span> </span><span id="local-6989586621679965997"><span class="annot"><span class="annottext">i :: Int
</span><a href="#local-6989586621679965997"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679965996"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679965996"><span class="hs-identifier hs-var">ui</span></a></span></span><span>         </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(StatusStruct r -&gt; Int)
-&gt; WriterT
     (DList (LineSegment 2 Int r))
     (StateT (StatusStruct r) (Reader (Vector (VertexInfo p r))))
     Int
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StatusStruct r -&gt; Getting (Endo Int) (StatusStruct r) Int -&gt; Int
forall s a. HasCallStack =&gt; s -&gt; Getting (Endo a) s a -&gt; a
</span><span class="hs-operator hs-var">^?!</span></span><span class="annot"><span class="annottext">(IntMap Int -&gt; Const (Endo Int) (IntMap Int))
-&gt; StatusStruct r -&gt; Const (Endo Int) (StatusStruct r)
forall r. Lens' (StatusStruct r) (IntMap Int)
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#helper"><span class="hs-identifier hs-var">helper</span></a></span><span class="annot"><span class="annottext">((IntMap Int -&gt; Const (Endo Int) (IntMap Int))
 -&gt; StatusStruct r -&gt; Const (Endo Int) (StatusStruct r))
-&gt; ((Int -&gt; Const (Endo Int) Int)
    -&gt; IntMap Int -&gt; Const (Endo Int) (IntMap Int))
-&gt; Getting (Endo Int) (StatusStruct r) Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">Index (IntMap Int)
-&gt; Traversal' (IntMap Int) (IxValue (IntMap Int))
forall m. Ixed m =&gt; Index m -&gt; Traversal' m (IxValue m)
</span><span class="hs-identifier hs-var">ix</span></span><span> </span><span class="annot"><span class="annottext">Int
Index (IntMap Int)
</span><a href="#local-6989586621679965997"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span>                 </span><span class="annot"><span class="hs-identifier hs-type">STR</span></span><span> </span><span id="local-6989586621679965993"><span class="annot"><span class="annottext">u :: Point 2 r
</span><a href="#local-6989586621679965993"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621679965992"><span class="annot"><span class="annottext">ut :: VertexType
</span><a href="#local-6989586621679965992"><span class="hs-identifier hs-var">ut</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Vector (VertexInfo p r) -&gt; VertexInfo p r)
-&gt; WriterT
     (DList (LineSegment 2 Int r))
     (StateT (StatusStruct r) (Reader (Vector (VertexInfo p r))))
     (VertexInfo p r)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector (VertexInfo p r)
-&gt; Getting
     (VertexInfo p r) (Vector (VertexInfo p r)) (VertexInfo p r)
-&gt; VertexInfo p r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Int -&gt; Lens' (Vector (VertexInfo p r)) (VertexInfo p r)
forall a. Int -&gt; Lens' (Vector a) a
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#ix%27"><span class="hs-identifier hs-var">ix'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679965996"><span class="hs-identifier hs-var">ui</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>                 </span><span class="annot"><span class="annottext">SP (Point 2 r :+ Int) VertexType
-&gt; Sweep p r (SP (Point 2 r :+ Int) VertexType)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(SP (Point 2 r :+ Int) VertexType
 -&gt; Sweep p r (SP (Point 2 r :+ Int) VertexType))
-&gt; SP (Point 2 r :+ Int) VertexType
-&gt; Sweep p r (SP (Point 2 r :+ Int) VertexType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Point 2 r :+ Int)
-&gt; VertexType -&gt; SP (Point 2 r :+ Int) VertexType
forall a b. a -&gt; b -&gt; SP a b
</span><span class="hs-identifier hs-var">SP</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679965993"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Int -&gt; Point 2 r :+ Int
forall core extra. core -&gt; extra -&gt; core :+ extra
</span><span class="hs-operator hs-var">:+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679965996"><span class="hs-identifier hs-var">ui</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">VertexType
</span><a href="#local-6989586621679965992"><span class="hs-identifier hs-var">ut</span></a></span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span id="local-6989586621679966216"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#lookupLE"><span class="hs-identifier hs-type">lookupLE</span></a></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679966216"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679966216"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>             </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679966216"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SS.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.LineSegment.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><a href="#local-6989586621679966216"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.LineSegment.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><a href="#local-6989586621679966216"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-240"></span><span id="lookupLE"><span class="annot"><span class="annottext">lookupLE :: Point 2 r
-&gt; Set (LineSegment 2 Int r) -&gt; Maybe (LineSegment 2 Int r)
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#lookupLE"><span class="hs-identifier hs-var hs-var">lookupLE</span></a></span></span><span> </span><span id="local-6989586621679965990"><span class="annot"><span class="annottext">v :: Point 2 r
</span><a href="#local-6989586621679965990"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679965989"><span class="annot"><span class="annottext">s :: Set (LineSegment 2 Int r)
</span><a href="#local-6989586621679965989"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679965988"><span class="annot"><span class="annottext">l :: Set (LineSegment 2 Int r)
</span><a href="#local-6989586621679965988"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679965987"><span class="annot"><span class="annottext">m :: Set (LineSegment 2 Int r)
</span><a href="#local-6989586621679965987"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 Int r -&gt; r)
-&gt; r
-&gt; Set (LineSegment 2 Int r)
-&gt; (Set (LineSegment 2 Int r), Set (LineSegment 2 Int r),
    Set (LineSegment 2 Int r))
forall b a.
Ord b =&gt;
(a -&gt; b) -&gt; b -&gt; Set a -&gt; (Set a, Set a, Set a)
</span><span class="hs-identifier hs-var">SS.splitOn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r -&gt; LineSegment 2 Int r -&gt; r
forall r p. (Fractional r, Ord r) =&gt; r -&gt; LineSegment 2 p r -&gt; r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#xCoordAt"><span class="hs-identifier hs-var">xCoordAt</span></a></span><span> </span><span class="annot"><span class="annottext">(r -&gt; LineSegment 2 Int r -&gt; r) -&gt; r -&gt; LineSegment 2 Int r -&gt; r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679965990"><span class="hs-identifier hs-var">v</span></a></span><span class="annot"><span class="annottext">Point 2 r -&gt; Getting r (Point 2 r) r -&gt; r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting r (Point 2 r) r
forall (d :: Nat) (point :: Nat -&gt; * -&gt; *) r.
(2 &lt;= d, Arity d, AsAPoint point) =&gt;
Lens' (point d r) r
</span><a href="Data.Geometry.Point.Class.html#yCoord"><span class="hs-identifier hs-var">yCoord</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679965990"><span class="hs-identifier hs-var">v</span></a></span><span class="annot"><span class="annottext">Point 2 r -&gt; Getting r (Point 2 r) r -&gt; r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting r (Point 2 r) r
forall (d :: Nat) (point :: Nat -&gt; * -&gt; *) r.
(1 &lt;= d, Arity d, AsAPoint point) =&gt;
Lens' (point d r) r
</span><a href="Data.Geometry.Point.Class.html#xCoord"><span class="hs-identifier hs-var">xCoord</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set (LineSegment 2 Int r)
</span><a href="#local-6989586621679965989"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-241"></span><span>               </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Set (LineSegment 2 Int r) -&gt; Maybe (LineSegment 2 Int r)
forall a. Set a -&gt; Maybe a
</span><span class="hs-identifier hs-var">SS.lookupMax</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set (LineSegment 2 Int r)
</span><a href="#local-6989586621679965988"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Set (LineSegment 2 Int r)
-&gt; Set (LineSegment 2 Int r) -&gt; Set (LineSegment 2 Int r)
forall a. Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`SS.join`</span></span><span> </span><span class="annot"><span class="annottext">Set (LineSegment 2 Int r)
</span><a href="#local-6989586621679965987"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span id="local-6989586621679965982"><span id="local-6989586621679965983"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#handleSplit"><span class="hs-identifier hs-type">handleSplit</span></a></span><span>              </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679965983"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679965983"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679965983"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Sweep"><span class="hs-identifier hs-type">Sweep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679965982"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679965983"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-245"></span><span id="handleSplit"><span class="annot"><span class="annottext">handleSplit :: Int -&gt; Event r -&gt; Sweep p r ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#handleSplit"><span class="hs-identifier hs-var hs-var">handleSplit</span></a></span></span><span> </span><span id="local-6989586621679965981"><span class="annot"><span class="annottext">i :: Int
</span><a href="#local-6989586621679965981"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679965980"><span class="annot"><span class="annottext">v :: Point 2 r
</span><a href="#local-6989586621679965980"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span id="local-6989586621679965979"><span class="annot"><span class="annottext">adj :: Two (LineSegment 2 Int r)
</span><a href="#local-6989586621679965979"><span class="hs-identifier hs-var">adj</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679965978"><span class="annot"><span class="annottext">LineSegment 2 Int r
</span><a href="#local-6989586621679965978"><span class="hs-identifier hs-var">ej</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(StatusStruct r -&gt; LineSegment 2 Int r)
-&gt; WriterT
     (DList (LineSegment 2 Int r))
     (StateT (StatusStruct r) (Reader (Vector (VertexInfo p r))))
     (LineSegment 2 Int r)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">((StatusStruct r -&gt; LineSegment 2 Int r)
 -&gt; WriterT
      (DList (LineSegment 2 Int r))
      (StateT (StatusStruct r) (Reader (Vector (VertexInfo p r))))
      (LineSegment 2 Int r))
-&gt; (StatusStruct r -&gt; LineSegment 2 Int r)
-&gt; WriterT
     (DList (LineSegment 2 Int r))
     (StateT (StatusStruct r) (Reader (Vector (VertexInfo p r))))
     (LineSegment 2 Int r)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679965977"><span class="annot"><span class="annottext">ss :: StatusStruct r
</span><a href="#local-6989586621679965977"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StatusStruct r
</span><a href="#local-6989586621679965977"><span class="hs-identifier hs-var">ss</span></a></span><span class="annot"><span class="annottext">StatusStruct r
-&gt; Getting
     (Endo (LineSegment 2 Int r)) (StatusStruct r) (LineSegment 2 Int r)
-&gt; LineSegment 2 Int r
forall s a. HasCallStack =&gt; s -&gt; Getting (Endo a) s a -&gt; a
</span><span class="hs-operator hs-var">^?!</span></span><span class="annot"><span class="annottext">(Set (LineSegment 2 Int r)
 -&gt; Const (Endo (LineSegment 2 Int r)) (Set (LineSegment 2 Int r)))
-&gt; StatusStruct r
-&gt; Const (Endo (LineSegment 2 Int r)) (StatusStruct r)
forall r r.
Lens
  (StatusStruct r)
  (StatusStruct r)
  (Set (LineSegment 2 Int r))
  (Set (LineSegment 2 Int r))
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#statusStruct"><span class="hs-identifier hs-var">statusStruct</span></a></span><span class="annot"><span class="annottext">((Set (LineSegment 2 Int r)
  -&gt; Const (Endo (LineSegment 2 Int r)) (Set (LineSegment 2 Int r)))
 -&gt; StatusStruct r
 -&gt; Const (Endo (LineSegment 2 Int r)) (StatusStruct r))
-&gt; ((LineSegment 2 Int r
     -&gt; Const (Endo (LineSegment 2 Int r)) (LineSegment 2 Int r))
    -&gt; Set (LineSegment 2 Int r)
    -&gt; Const (Endo (LineSegment 2 Int r)) (Set (LineSegment 2 Int r)))
-&gt; Getting
     (Endo (LineSegment 2 Int r)) (StatusStruct r) (LineSegment 2 Int r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Set (LineSegment 2 Int r) -&gt; Maybe (LineSegment 2 Int r))
-&gt; Optic'
     (-&gt;)
     (Const (Endo (LineSegment 2 Int r)))
     (Set (LineSegment 2 Int r))
     (Maybe (LineSegment 2 Int r))
forall (p :: * -&gt; * -&gt; *) (f :: * -&gt; *) s a.
(Profunctor p, Contravariant f) =&gt;
(s -&gt; a) -&gt; Optic' p f s a
</span><span class="hs-identifier hs-var">to</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
-&gt; Set (LineSegment 2 Int r) -&gt; Maybe (LineSegment 2 Int r)
forall r.
(Ord r, Fractional r) =&gt;
Point 2 r
-&gt; Set (LineSegment 2 Int r) -&gt; Maybe (LineSegment 2 Int r)
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#lookupLE"><span class="hs-identifier hs-var">lookupLE</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679965980"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">Optic'
  (-&gt;)
  (Const (Endo (LineSegment 2 Int r)))
  (Set (LineSegment 2 Int r))
  (Maybe (LineSegment 2 Int r))
-&gt; ((LineSegment 2 Int r
     -&gt; Const (Endo (LineSegment 2 Int r)) (LineSegment 2 Int r))
    -&gt; Maybe (LineSegment 2 Int r)
    -&gt; Const
         (Endo (LineSegment 2 Int r)) (Maybe (LineSegment 2 Int r)))
-&gt; (LineSegment 2 Int r
    -&gt; Const (Endo (LineSegment 2 Int r)) (LineSegment 2 Int r))
-&gt; Set (LineSegment 2 Int r)
-&gt; Const (Endo (LineSegment 2 Int r)) (Set (LineSegment 2 Int r))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(LineSegment 2 Int r
 -&gt; Const (Endo (LineSegment 2 Int r)) (LineSegment 2 Int r))
-&gt; Maybe (LineSegment 2 Int r)
-&gt; Const (Endo (LineSegment 2 Int r)) (Maybe (LineSegment 2 Int r))
forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span>
</span><span id="line-246"></span><span>                              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679965974"><span class="annot"><span class="annottext">j :: Int
</span><a href="#local-6989586621679965974"><span class="hs-identifier hs-var hs-var">j</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LineSegment 2 Int r
</span><a href="#local-6989586621679965978"><span class="hs-identifier hs-var">ej</span></a></span><span class="annot"><span class="annottext">LineSegment 2 Int r -&gt; Getting Int (LineSegment 2 Int r) Int -&gt; Int
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">((Point 2 r :+ Int) -&gt; Const Int (Point 2 r :+ Int))
-&gt; LineSegment 2 Int r -&gt; Const Int (LineSegment 2 Int r)
forall t. HasStart t =&gt; Lens' t (StartCore t :+ StartExtra t)
</span><a href="Data.Geometry.Interval.html#start"><span class="hs-identifier hs-var">start</span></a></span><span class="annot"><span class="annottext">(((Point 2 r :+ Int) -&gt; Const Int (Point 2 r :+ Int))
 -&gt; LineSegment 2 Int r -&gt; Const Int (LineSegment 2 Int r))
-&gt; ((Int -&gt; Const Int Int)
    -&gt; (Point 2 r :+ Int) -&gt; Const Int (Point 2 r :+ Int))
-&gt; Getting Int (LineSegment 2 Int r) Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Int -&gt; Const Int Int)
-&gt; (Point 2 r :+ Int) -&gt; Const Int (Point 2 r :+ Int)
forall core extra extra'.
Lens (core :+ extra) (core :+ extra') extra extra'
</span><span class="hs-identifier hs-var">extra</span></span><span>
</span><span id="line-247"></span><span>                              </span><span class="annot"><span class="hs-identifier hs-type">SP</span></span><span> </span><span id="local-6989586621679965973"><span class="annot"><span class="annottext">u :: Point 2 r :+ Int
</span><a href="#local-6989586621679965973"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Sweep p r (SP (Point 2 r :+ Int) VertexType)
forall p r. Int -&gt; Sweep p r (SP (Point 2 r :+ Int) VertexType)
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#getHelper"><span class="hs-identifier hs-var">getHelper</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679965974"><span class="hs-identifier hs-var">j</span></a></span><span>
</span><span id="line-248"></span><span>                              </span><span class="hs-comment">-- update the status struct:</span><span>
</span><span id="line-249"></span><span>                              </span><span class="hs-comment">-- insert the new edge into the status Struct and</span><span>
</span><span id="line-250"></span><span>                              </span><span class="hs-comment">-- set the helper of e_j to be v_i</span><span>
</span><span id="line-251"></span><span>                              </span><span class="annot"><span class="annottext">(StatusStruct r -&gt; StatusStruct r) -&gt; Sweep p r ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((StatusStruct r -&gt; StatusStruct r) -&gt; Sweep p r ())
-&gt; (StatusStruct r -&gt; StatusStruct r) -&gt; Sweep p r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#SS"><span class="hs-identifier hs-type">SS</span></a></span><span> </span><span id="local-6989586621679965972"><span class="annot"><span class="annottext">t :: Set (LineSegment 2 Int r)
</span><a href="#local-6989586621679965972"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679965971"><span class="annot"><span class="annottext">h :: IntMap Int
</span><a href="#local-6989586621679965971"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-252"></span><span>                                </span><span class="annot"><span class="annottext">Set (LineSegment 2 Int r) -&gt; IntMap Int -&gt; StatusStruct r
forall r. Set (LineSegment 2 Int r) -&gt; IntMap Int -&gt; StatusStruct r
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#SS"><span class="hs-identifier hs-var">SS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
-&gt; LineSegment 2 Int r
-&gt; Set (LineSegment 2 Int r)
-&gt; Set (LineSegment 2 Int r)
forall r q.
(Ord r, Fractional r) =&gt;
Point 2 r
-&gt; LineSegment 2 q r
-&gt; Set (LineSegment 2 q r)
-&gt; Set (LineSegment 2 q r)
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#insertAt"><span class="hs-identifier hs-var">insertAt</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679965980"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Two (LineSegment 2 Int r)
</span><a href="#local-6989586621679965979"><span class="hs-identifier hs-var">adj</span></a></span><span class="annot"><span class="annottext">Two (LineSegment 2 Int r)
-&gt; Getting
     (LineSegment 2 Int r)
     (Two (LineSegment 2 Int r))
     (LineSegment 2 Int r)
-&gt; LineSegment 2 Int r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting
  (LineSegment 2 Int r)
  (Two (LineSegment 2 Int r))
  (LineSegment 2 Int r)
forall s t a b. Field2 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set (LineSegment 2 Int r)
</span><a href="#local-6989586621679965972"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>                                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; IntMap Int -&gt; IntMap Int
forall a. Int -&gt; a -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IntMap.insert</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679965981"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679965981"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">(IntMap Int -&gt; IntMap Int)
-&gt; (IntMap Int -&gt; IntMap Int) -&gt; IntMap Int -&gt; IntMap Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; IntMap Int -&gt; IntMap Int
forall a. Int -&gt; a -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IntMap.insert</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679965974"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679965981"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">(IntMap Int -&gt; IntMap Int) -&gt; IntMap Int -&gt; IntMap Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IntMap Int
</span><a href="#local-6989586621679965971"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>                              </span><span class="hs-comment">-- return the diagonal</span><span>
</span><span id="line-255"></span><span>                              </span><span class="annot"><span class="annottext">LineSegment 2 Int r -&gt; Sweep p r ()
forall r p. LineSegment 2 Int r -&gt; Sweep p r ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#tell%27"><span class="hs-identifier hs-var">tell'</span></a></span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 Int r -&gt; Sweep p r ())
-&gt; LineSegment 2 Int r -&gt; Sweep p r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Point 2 r :+ Int) -&gt; (Point 2 r :+ Int) -&gt; LineSegment 2 Int r
forall (d :: Nat) r p.
(Point d r :+ p) -&gt; (Point d r :+ p) -&gt; LineSegment d p r
</span><a href="Data.Geometry.LineSegment.html#ClosedLineSegment"><span class="hs-identifier hs-var">ClosedLineSegment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679965980"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Int -&gt; Point 2 r :+ Int
forall core extra. core -&gt; extra -&gt; core :+ extra
</span><span class="hs-operator hs-var">:+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679965981"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ Int
</span><a href="#local-6989586621679965973"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span id="local-6989586621679965969"><span id="local-6989586621679965970"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#handleMerge"><span class="hs-identifier hs-type">handleMerge</span></a></span><span>              </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679965970"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679965970"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679965970"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Sweep"><span class="hs-identifier hs-type">Sweep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679965969"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679965970"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-258"></span><span id="handleMerge"><span class="annot"><span class="annottext">handleMerge :: Int -&gt; Event r -&gt; Sweep p r ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#handleMerge"><span class="hs-identifier hs-var hs-var">handleMerge</span></a></span></span><span> </span><span id="local-6989586621679965968"><span class="annot"><span class="annottext">i :: Int
</span><a href="#local-6989586621679965968"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679965967"><span class="annot"><span class="annottext">v :: Point 2 r
</span><a href="#local-6989586621679965967"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span id="local-6989586621679965966"><span class="annot"><span class="annottext">adj :: Two (LineSegment 2 Int r)
</span><a href="#local-6989586621679965966"><span class="hs-identifier hs-var">adj</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679965965"><span class="annot"><span class="annottext">ePred :: Int
</span><a href="#local-6989586621679965965"><span class="hs-identifier hs-var hs-var">ePred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Two (LineSegment 2 Int r)
</span><a href="#local-6989586621679965966"><span class="hs-identifier hs-var">adj</span></a></span><span class="annot"><span class="annottext">Two (LineSegment 2 Int r)
-&gt; Getting Int (Two (LineSegment 2 Int r)) Int -&gt; Int
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">(LineSegment 2 Int r -&gt; Const Int (LineSegment 2 Int r))
-&gt; Two (LineSegment 2 Int r)
-&gt; Const Int (Two (LineSegment 2 Int r))
forall s t a b. Field1 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_1</span></span><span class="annot"><span class="annottext">((LineSegment 2 Int r -&gt; Const Int (LineSegment 2 Int r))
 -&gt; Two (LineSegment 2 Int r)
 -&gt; Const Int (Two (LineSegment 2 Int r)))
-&gt; ((Int -&gt; Const Int Int)
    -&gt; LineSegment 2 Int r -&gt; Const Int (LineSegment 2 Int r))
-&gt; Getting Int (Two (LineSegment 2 Int r)) Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">((Point 2 r :+ Int) -&gt; Const Int (Point 2 r :+ Int))
-&gt; LineSegment 2 Int r -&gt; Const Int (LineSegment 2 Int r)
forall t. HasStart t =&gt; Lens' t (StartCore t :+ StartExtra t)
</span><a href="Data.Geometry.Interval.html#start"><span class="hs-identifier hs-var">start</span></a></span><span class="annot"><span class="annottext">(((Point 2 r :+ Int) -&gt; Const Int (Point 2 r :+ Int))
 -&gt; LineSegment 2 Int r -&gt; Const Int (LineSegment 2 Int r))
-&gt; ((Int -&gt; Const Int Int)
    -&gt; (Point 2 r :+ Int) -&gt; Const Int (Point 2 r :+ Int))
-&gt; (Int -&gt; Const Int Int)
-&gt; LineSegment 2 Int r
-&gt; Const Int (LineSegment 2 Int r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Int -&gt; Const Int Int)
-&gt; (Point 2 r :+ Int) -&gt; Const Int (Point 2 r :+ Int)
forall core extra extra'.
Lens (core :+ extra) (core :+ extra') extra extra'
</span><span class="hs-identifier hs-var">extra</span></span><span> </span><span class="hs-comment">-- i-1</span><span>
</span><span id="line-259"></span><span>                              </span><span class="annot"><span class="annottext">Int -&gt; Point 2 r -&gt; Int -&gt; Sweep p r ()
forall r p. Int -&gt; Point 2 r -&gt; Int -&gt; Sweep p r ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#tellIfMerge"><span class="hs-identifier hs-var">tellIfMerge</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679965968"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679965967"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679965965"><span class="hs-identifier hs-var">ePred</span></a></span><span>
</span><span id="line-260"></span><span>                              </span><span class="hs-comment">-- delete e_{i-1} from the status struct</span><span>
</span><span id="line-261"></span><span>                              </span><span class="annot"><span class="annottext">(StatusStruct r -&gt; StatusStruct r) -&gt; Sweep p r ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((StatusStruct r -&gt; StatusStruct r) -&gt; Sweep p r ())
-&gt; (StatusStruct r -&gt; StatusStruct r) -&gt; Sweep p r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679965964"><span class="annot"><span class="annottext">ss :: StatusStruct r
</span><a href="#local-6989586621679965964"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StatusStruct r
</span><a href="#local-6989586621679965964"><span class="hs-identifier hs-var">ss</span></a></span><span class="annot"><span class="annottext">StatusStruct r
-&gt; (StatusStruct r -&gt; StatusStruct r) -&gt; StatusStruct r
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span class="annot"><span class="annottext">(Set (LineSegment 2 Int r) -&gt; Identity (Set (LineSegment 2 Int r)))
-&gt; StatusStruct r -&gt; Identity (StatusStruct r)
forall r r.
Lens
  (StatusStruct r)
  (StatusStruct r)
  (Set (LineSegment 2 Int r))
  (Set (LineSegment 2 Int r))
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#statusStruct"><span class="hs-identifier hs-var">statusStruct</span></a></span><span> </span><span class="annot"><span class="annottext">((Set (LineSegment 2 Int r)
  -&gt; Identity (Set (LineSegment 2 Int r)))
 -&gt; StatusStruct r -&gt; Identity (StatusStruct r))
-&gt; (Set (LineSegment 2 Int r) -&gt; Set (LineSegment 2 Int r))
-&gt; StatusStruct r
-&gt; StatusStruct r
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
-&gt; LineSegment 2 Int r
-&gt; Set (LineSegment 2 Int r)
-&gt; Set (LineSegment 2 Int r)
forall r p.
(Fractional r, Ord r) =&gt;
Point 2 r
-&gt; LineSegment 2 p r
-&gt; Set (LineSegment 2 p r)
-&gt; Set (LineSegment 2 p r)
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#deleteAt"><span class="hs-identifier hs-var">deleteAt</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679965967"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Two (LineSegment 2 Int r)
</span><a href="#local-6989586621679965966"><span class="hs-identifier hs-var">adj</span></a></span><span class="annot"><span class="annottext">Two (LineSegment 2 Int r)
-&gt; Getting
     (LineSegment 2 Int r)
     (Two (LineSegment 2 Int r))
     (LineSegment 2 Int r)
-&gt; LineSegment 2 Int r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting
  (LineSegment 2 Int r)
  (Two (LineSegment 2 Int r))
  (LineSegment 2 Int r)
forall s t a b. Field1 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_1</span></span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>                              </span><span class="annot"><span class="annottext">Int -&gt; Point 2 r -&gt; Sweep p r ()
forall r p.
(Fractional r, Ord r) =&gt;
Int -&gt; Point 2 r -&gt; Sweep p r ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#connectToLeft"><span class="hs-identifier hs-var">connectToLeft</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679965968"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679965967"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span class="hs-comment">-- | finds the edge j to the left of v_i, and connect v_i to it if the helper</span><span>
</span><span id="line-265"></span><span class="hs-comment">-- of j is a merge vertex</span><span>
</span><span id="line-266"></span><span id="local-6989586621679966209"><span id="local-6989586621679966210"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#connectToLeft"><span class="hs-identifier hs-type">connectToLeft</span></a></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679966210"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679966210"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679966210"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Sweep"><span class="hs-identifier hs-type">Sweep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966209"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966210"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-267"></span><span id="connectToLeft"><span class="annot"><span class="annottext">connectToLeft :: Int -&gt; Point 2 r -&gt; Sweep p r ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#connectToLeft"><span class="hs-identifier hs-var hs-var">connectToLeft</span></a></span></span><span> </span><span id="local-6989586621679965962"><span class="annot"><span class="annottext">i :: Int
</span><a href="#local-6989586621679965962"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679965961"><span class="annot"><span class="annottext">v :: Point 2 r
</span><a href="#local-6989586621679965961"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679965960"><span class="annot"><span class="annottext">LineSegment 2 Int r
</span><a href="#local-6989586621679965960"><span class="hs-identifier hs-var">ej</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(StatusStruct r -&gt; LineSegment 2 Int r)
-&gt; WriterT
     (DList (LineSegment 2 Int r))
     (StateT (StatusStruct r) (Reader (Vector (VertexInfo p r))))
     (LineSegment 2 Int r)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">((StatusStruct r -&gt; LineSegment 2 Int r)
 -&gt; WriterT
      (DList (LineSegment 2 Int r))
      (StateT (StatusStruct r) (Reader (Vector (VertexInfo p r))))
      (LineSegment 2 Int r))
-&gt; (StatusStruct r -&gt; LineSegment 2 Int r)
-&gt; WriterT
     (DList (LineSegment 2 Int r))
     (StateT (StatusStruct r) (Reader (Vector (VertexInfo p r))))
     (LineSegment 2 Int r)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679965959"><span class="annot"><span class="annottext">ss :: StatusStruct r
</span><a href="#local-6989586621679965959"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StatusStruct r
</span><a href="#local-6989586621679965959"><span class="hs-identifier hs-var">ss</span></a></span><span class="annot"><span class="annottext">StatusStruct r
-&gt; Getting
     (Endo (LineSegment 2 Int r)) (StatusStruct r) (LineSegment 2 Int r)
-&gt; LineSegment 2 Int r
forall s a. HasCallStack =&gt; s -&gt; Getting (Endo a) s a -&gt; a
</span><span class="hs-operator hs-var">^?!</span></span><span class="annot"><span class="annottext">(Set (LineSegment 2 Int r)
 -&gt; Const (Endo (LineSegment 2 Int r)) (Set (LineSegment 2 Int r)))
-&gt; StatusStruct r
-&gt; Const (Endo (LineSegment 2 Int r)) (StatusStruct r)
forall r r.
Lens
  (StatusStruct r)
  (StatusStruct r)
  (Set (LineSegment 2 Int r))
  (Set (LineSegment 2 Int r))
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#statusStruct"><span class="hs-identifier hs-var">statusStruct</span></a></span><span class="annot"><span class="annottext">((Set (LineSegment 2 Int r)
  -&gt; Const (Endo (LineSegment 2 Int r)) (Set (LineSegment 2 Int r)))
 -&gt; StatusStruct r
 -&gt; Const (Endo (LineSegment 2 Int r)) (StatusStruct r))
-&gt; ((LineSegment 2 Int r
     -&gt; Const (Endo (LineSegment 2 Int r)) (LineSegment 2 Int r))
    -&gt; Set (LineSegment 2 Int r)
    -&gt; Const (Endo (LineSegment 2 Int r)) (Set (LineSegment 2 Int r)))
-&gt; Getting
     (Endo (LineSegment 2 Int r)) (StatusStruct r) (LineSegment 2 Int r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Set (LineSegment 2 Int r) -&gt; Maybe (LineSegment 2 Int r))
-&gt; Optic'
     (-&gt;)
     (Const (Endo (LineSegment 2 Int r)))
     (Set (LineSegment 2 Int r))
     (Maybe (LineSegment 2 Int r))
forall (p :: * -&gt; * -&gt; *) (f :: * -&gt; *) s a.
(Profunctor p, Contravariant f) =&gt;
(s -&gt; a) -&gt; Optic' p f s a
</span><span class="hs-identifier hs-var">to</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
-&gt; Set (LineSegment 2 Int r) -&gt; Maybe (LineSegment 2 Int r)
forall r.
(Ord r, Fractional r) =&gt;
Point 2 r
-&gt; Set (LineSegment 2 Int r) -&gt; Maybe (LineSegment 2 Int r)
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#lookupLE"><span class="hs-identifier hs-var">lookupLE</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679965961"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">Optic'
  (-&gt;)
  (Const (Endo (LineSegment 2 Int r)))
  (Set (LineSegment 2 Int r))
  (Maybe (LineSegment 2 Int r))
-&gt; ((LineSegment 2 Int r
     -&gt; Const (Endo (LineSegment 2 Int r)) (LineSegment 2 Int r))
    -&gt; Maybe (LineSegment 2 Int r)
    -&gt; Const
         (Endo (LineSegment 2 Int r)) (Maybe (LineSegment 2 Int r)))
-&gt; (LineSegment 2 Int r
    -&gt; Const (Endo (LineSegment 2 Int r)) (LineSegment 2 Int r))
-&gt; Set (LineSegment 2 Int r)
-&gt; Const (Endo (LineSegment 2 Int r)) (Set (LineSegment 2 Int r))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(LineSegment 2 Int r
 -&gt; Const (Endo (LineSegment 2 Int r)) (LineSegment 2 Int r))
-&gt; Maybe (LineSegment 2 Int r)
-&gt; Const (Endo (LineSegment 2 Int r)) (Maybe (LineSegment 2 Int r))
forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span>
</span><span id="line-268"></span><span>                       </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679965958"><span class="annot"><span class="annottext">j :: Int
</span><a href="#local-6989586621679965958"><span class="hs-identifier hs-var hs-var">j</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LineSegment 2 Int r
</span><a href="#local-6989586621679965960"><span class="hs-identifier hs-var">ej</span></a></span><span class="annot"><span class="annottext">LineSegment 2 Int r -&gt; Getting Int (LineSegment 2 Int r) Int -&gt; Int
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">((Point 2 r :+ Int) -&gt; Const Int (Point 2 r :+ Int))
-&gt; LineSegment 2 Int r -&gt; Const Int (LineSegment 2 Int r)
forall t. HasStart t =&gt; Lens' t (StartCore t :+ StartExtra t)
</span><a href="Data.Geometry.Interval.html#start"><span class="hs-identifier hs-var">start</span></a></span><span class="annot"><span class="annottext">(((Point 2 r :+ Int) -&gt; Const Int (Point 2 r :+ Int))
 -&gt; LineSegment 2 Int r -&gt; Const Int (LineSegment 2 Int r))
-&gt; ((Int -&gt; Const Int Int)
    -&gt; (Point 2 r :+ Int) -&gt; Const Int (Point 2 r :+ Int))
-&gt; Getting Int (LineSegment 2 Int r) Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Int -&gt; Const Int Int)
-&gt; (Point 2 r :+ Int) -&gt; Const Int (Point 2 r :+ Int)
forall core extra extra'.
Lens (core :+ extra) (core :+ extra') extra extra'
</span><span class="hs-identifier hs-var">extra</span></span><span>
</span><span id="line-269"></span><span>                       </span><span class="annot"><span class="annottext">Int -&gt; Point 2 r -&gt; Int -&gt; Sweep p r ()
forall r p. Int -&gt; Point 2 r -&gt; Int -&gt; Sweep p r ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#tellIfMerge"><span class="hs-identifier hs-var">tellIfMerge</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679965962"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679965961"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679965958"><span class="hs-identifier hs-var">j</span></a></span><span>
</span><span id="line-270"></span><span>                       </span><span class="annot"><span class="annottext">(StatusStruct r -&gt; StatusStruct r) -&gt; Sweep p r ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((StatusStruct r -&gt; StatusStruct r) -&gt; Sweep p r ())
-&gt; (StatusStruct r -&gt; StatusStruct r) -&gt; Sweep p r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679965957"><span class="annot"><span class="annottext">ss :: StatusStruct r
</span><a href="#local-6989586621679965957"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StatusStruct r
</span><a href="#local-6989586621679965957"><span class="hs-identifier hs-var">ss</span></a></span><span class="annot"><span class="annottext">StatusStruct r
-&gt; (StatusStruct r -&gt; StatusStruct r) -&gt; StatusStruct r
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span class="annot"><span class="annottext">(IntMap Int -&gt; Identity (IntMap Int))
-&gt; StatusStruct r -&gt; Identity (StatusStruct r)
forall r. Lens' (StatusStruct r) (IntMap Int)
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#helper"><span class="hs-identifier hs-var">helper</span></a></span><span> </span><span class="annot"><span class="annottext">((IntMap Int -&gt; Identity (IntMap Int))
 -&gt; StatusStruct r -&gt; Identity (StatusStruct r))
-&gt; (IntMap Int -&gt; IntMap Int) -&gt; StatusStruct r -&gt; StatusStruct r
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; IntMap Int -&gt; IntMap Int
forall a. Int -&gt; a -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IntMap.insert</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679965958"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679965962"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span class="hs-comment">-- | returns True if v the interior of the polygon is to the right of v</span><span>
</span><span id="line-273"></span><span id="local-6989586621679966282"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#isLeftVertex"><span class="hs-identifier hs-type">isLeftVertex</span></a></span><span>              </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679966282"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966282"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-274"></span><span id="isLeftVertex"><span class="annot"><span class="annottext">isLeftVertex :: Int -&gt; Event r -&gt; Bool
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#isLeftVertex"><span class="hs-identifier hs-var hs-var">isLeftVertex</span></a></span></span><span> </span><span id="local-6989586621679965956"><span class="annot"><span class="annottext">i :: Int
</span><a href="#local-6989586621679965956"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679965955"><span class="annot"><span class="annottext">v :: Point 2 r
</span><a href="#local-6989586621679965955"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span id="local-6989586621679965954"><span class="annot"><span class="annottext">adj :: Two (LineSegment 2 Int r)
</span><a href="#local-6989586621679965954"><span class="hs-identifier hs-var">adj</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Two (LineSegment 2 Int r)
</span><a href="#local-6989586621679965954"><span class="hs-identifier hs-var">adj</span></a></span><span class="annot"><span class="annottext">Two (LineSegment 2 Int r)
-&gt; Getting
     (Point 2 r :+ Int) (Two (LineSegment 2 Int r)) (Point 2 r :+ Int)
-&gt; Point 2 r :+ Int
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">(LineSegment 2 Int r
 -&gt; Const (Point 2 r :+ Int) (LineSegment 2 Int r))
-&gt; Two (LineSegment 2 Int r)
-&gt; Const (Point 2 r :+ Int) (Two (LineSegment 2 Int r))
forall s t a b. Field1 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_1</span></span><span class="annot"><span class="annottext">((LineSegment 2 Int r
  -&gt; Const (Point 2 r :+ Int) (LineSegment 2 Int r))
 -&gt; Two (LineSegment 2 Int r)
 -&gt; Const (Point 2 r :+ Int) (Two (LineSegment 2 Int r)))
-&gt; (((Point 2 r :+ Int)
     -&gt; Const (Point 2 r :+ Int) (Point 2 r :+ Int))
    -&gt; LineSegment 2 Int r
    -&gt; Const (Point 2 r :+ Int) (LineSegment 2 Int r))
-&gt; Getting
     (Point 2 r :+ Int) (Two (LineSegment 2 Int r)) (Point 2 r :+ Int)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">((Point 2 r :+ Int) -&gt; Const (Point 2 r :+ Int) (Point 2 r :+ Int))
-&gt; LineSegment 2 Int r
-&gt; Const (Point 2 r :+ Int) (LineSegment 2 Int r)
forall t. HasStart t =&gt; Lens' t (StartCore t :+ StartExtra t)
</span><a href="Data.Geometry.Interval.html#start"><span class="hs-identifier hs-var">start</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Point 2 r :+ Int) -&gt; (Point 2 r :+ Int) -&gt; Ordering
forall r e.
Ord r =&gt;
(Point 2 r :+ e) -&gt; (Point 2 r :+ e) -&gt; Ordering
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#cmpSweep"><span class="hs-operator hs-var">`cmpSweep`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679965955"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Int -&gt; Point 2 r :+ Int
forall core extra. core -&gt; extra -&gt; core :+ extra
</span><span class="hs-operator hs-var">:+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679965956"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-275"></span><span>                              </span><span class="annot"><span class="hs-identifier hs-type">GT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-276"></span><span>                              </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-277"></span><span>  </span><span class="hs-comment">-- if the predecessor occurs before the sweep, this must be a left vertex</span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span id="local-6989586621679965952"><span id="local-6989586621679965953"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#handleRegularL"><span class="hs-identifier hs-type">handleRegularL</span></a></span><span>              </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679965953"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679965953"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679965953"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Sweep"><span class="hs-identifier hs-type">Sweep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679965952"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679965953"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-280"></span><span id="handleRegularL"><span class="annot"><span class="annottext">handleRegularL :: Int -&gt; Event r -&gt; Sweep p r ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#handleRegularL"><span class="hs-identifier hs-var hs-var">handleRegularL</span></a></span></span><span> </span><span id="local-6989586621679965951"><span class="annot"><span class="annottext">i :: Int
</span><a href="#local-6989586621679965951"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679965950"><span class="annot"><span class="annottext">v :: Point 2 r
</span><a href="#local-6989586621679965950"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span id="local-6989586621679965949"><span class="annot"><span class="annottext">adj :: Two (LineSegment 2 Int r)
</span><a href="#local-6989586621679965949"><span class="hs-identifier hs-var">adj</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679965948"><span class="annot"><span class="annottext">ePred :: Int
</span><a href="#local-6989586621679965948"><span class="hs-identifier hs-var hs-var">ePred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Two (LineSegment 2 Int r)
</span><a href="#local-6989586621679965949"><span class="hs-identifier hs-var">adj</span></a></span><span class="annot"><span class="annottext">Two (LineSegment 2 Int r)
-&gt; Getting Int (Two (LineSegment 2 Int r)) Int -&gt; Int
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">(LineSegment 2 Int r -&gt; Const Int (LineSegment 2 Int r))
-&gt; Two (LineSegment 2 Int r)
-&gt; Const Int (Two (LineSegment 2 Int r))
forall s t a b. Field1 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_1</span></span><span class="annot"><span class="annottext">((LineSegment 2 Int r -&gt; Const Int (LineSegment 2 Int r))
 -&gt; Two (LineSegment 2 Int r)
 -&gt; Const Int (Two (LineSegment 2 Int r)))
-&gt; ((Int -&gt; Const Int Int)
    -&gt; LineSegment 2 Int r -&gt; Const Int (LineSegment 2 Int r))
-&gt; Getting Int (Two (LineSegment 2 Int r)) Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">((Point 2 r :+ Int) -&gt; Const Int (Point 2 r :+ Int))
-&gt; LineSegment 2 Int r -&gt; Const Int (LineSegment 2 Int r)
forall t. HasStart t =&gt; Lens' t (StartCore t :+ StartExtra t)
</span><a href="Data.Geometry.Interval.html#start"><span class="hs-identifier hs-var">start</span></a></span><span class="annot"><span class="annottext">(((Point 2 r :+ Int) -&gt; Const Int (Point 2 r :+ Int))
 -&gt; LineSegment 2 Int r -&gt; Const Int (LineSegment 2 Int r))
-&gt; ((Int -&gt; Const Int Int)
    -&gt; (Point 2 r :+ Int) -&gt; Const Int (Point 2 r :+ Int))
-&gt; (Int -&gt; Const Int Int)
-&gt; LineSegment 2 Int r
-&gt; Const Int (LineSegment 2 Int r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Int -&gt; Const Int Int)
-&gt; (Point 2 r :+ Int) -&gt; Const Int (Point 2 r :+ Int)
forall core extra extra'.
Lens (core :+ extra) (core :+ extra') extra extra'
</span><span class="hs-identifier hs-var">extra</span></span><span> </span><span class="hs-comment">-- i-1</span><span>
</span><span id="line-281"></span><span>                                 </span><span class="annot"><span class="annottext">Int -&gt; Point 2 r -&gt; Int -&gt; Sweep p r ()
forall r p. Int -&gt; Point 2 r -&gt; Int -&gt; Sweep p r ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#tellIfMerge"><span class="hs-identifier hs-var">tellIfMerge</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679965951"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679965950"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679965948"><span class="hs-identifier hs-var">ePred</span></a></span><span>
</span><span id="line-282"></span><span>                                 </span><span class="hs-comment">-- delete e_{i-1} from the status struct</span><span>
</span><span id="line-283"></span><span>                                 </span><span class="annot"><span class="annottext">(StatusStruct r -&gt; StatusStruct r) -&gt; Sweep p r ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((StatusStruct r -&gt; StatusStruct r) -&gt; Sweep p r ())
-&gt; (StatusStruct r -&gt; StatusStruct r) -&gt; Sweep p r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679965947"><span class="annot"><span class="annottext">ss :: StatusStruct r
</span><a href="#local-6989586621679965947"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-284"></span><span>                                   </span><span class="annot"><span class="annottext">StatusStruct r
</span><a href="#local-6989586621679965947"><span class="hs-identifier hs-var">ss</span></a></span><span class="annot"><span class="annottext">StatusStruct r
-&gt; (StatusStruct r -&gt; StatusStruct r) -&gt; StatusStruct r
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span class="annot"><span class="annottext">(Set (LineSegment 2 Int r) -&gt; Identity (Set (LineSegment 2 Int r)))
-&gt; StatusStruct r -&gt; Identity (StatusStruct r)
forall r r.
Lens
  (StatusStruct r)
  (StatusStruct r)
  (Set (LineSegment 2 Int r))
  (Set (LineSegment 2 Int r))
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#statusStruct"><span class="hs-identifier hs-var">statusStruct</span></a></span><span> </span><span class="annot"><span class="annottext">((Set (LineSegment 2 Int r)
  -&gt; Identity (Set (LineSegment 2 Int r)))
 -&gt; StatusStruct r -&gt; Identity (StatusStruct r))
-&gt; (Set (LineSegment 2 Int r) -&gt; Set (LineSegment 2 Int r))
-&gt; StatusStruct r
-&gt; StatusStruct r
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
-&gt; LineSegment 2 Int r
-&gt; Set (LineSegment 2 Int r)
-&gt; Set (LineSegment 2 Int r)
forall r p.
(Fractional r, Ord r) =&gt;
Point 2 r
-&gt; LineSegment 2 p r
-&gt; Set (LineSegment 2 p r)
-&gt; Set (LineSegment 2 p r)
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#deleteAt"><span class="hs-identifier hs-var">deleteAt</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679965950"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Two (LineSegment 2 Int r)
</span><a href="#local-6989586621679965949"><span class="hs-identifier hs-var">adj</span></a></span><span class="annot"><span class="annottext">Two (LineSegment 2 Int r)
-&gt; Getting
     (LineSegment 2 Int r)
     (Two (LineSegment 2 Int r))
     (LineSegment 2 Int r)
-&gt; LineSegment 2 Int r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting
  (LineSegment 2 Int r)
  (Two (LineSegment 2 Int r))
  (LineSegment 2 Int r)
forall s t a b. Field1 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_1</span></span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>                                 </span><span class="hs-comment">-- insert a e_i in the status struct, and set its helper</span><span>
</span><span id="line-286"></span><span>                                 </span><span class="hs-comment">-- to be v_i</span><span>
</span><span id="line-287"></span><span>                                 </span><span class="annot"><span class="annottext">(StatusStruct r -&gt; StatusStruct r) -&gt; Sweep p r ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((StatusStruct r -&gt; StatusStruct r) -&gt; Sweep p r ())
-&gt; (StatusStruct r -&gt; StatusStruct r) -&gt; Sweep p r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#SS"><span class="hs-identifier hs-type">SS</span></a></span><span> </span><span id="local-6989586621679965946"><span class="annot"><span class="annottext">t :: Set (LineSegment 2 Int r)
</span><a href="#local-6989586621679965946"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679965945"><span class="annot"><span class="annottext">h :: IntMap Int
</span><a href="#local-6989586621679965945"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-288"></span><span>                                     </span><span class="annot"><span class="annottext">Set (LineSegment 2 Int r) -&gt; IntMap Int -&gt; StatusStruct r
forall r. Set (LineSegment 2 Int r) -&gt; IntMap Int -&gt; StatusStruct r
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#SS"><span class="hs-identifier hs-var">SS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
-&gt; LineSegment 2 Int r
-&gt; Set (LineSegment 2 Int r)
-&gt; Set (LineSegment 2 Int r)
forall r q.
(Ord r, Fractional r) =&gt;
Point 2 r
-&gt; LineSegment 2 q r
-&gt; Set (LineSegment 2 q r)
-&gt; Set (LineSegment 2 q r)
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#insertAt"><span class="hs-identifier hs-var">insertAt</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679965950"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Two (LineSegment 2 Int r)
</span><a href="#local-6989586621679965949"><span class="hs-identifier hs-var">adj</span></a></span><span class="annot"><span class="annottext">Two (LineSegment 2 Int r)
-&gt; Getting
     (LineSegment 2 Int r)
     (Two (LineSegment 2 Int r))
     (LineSegment 2 Int r)
-&gt; LineSegment 2 Int r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting
  (LineSegment 2 Int r)
  (Two (LineSegment 2 Int r))
  (LineSegment 2 Int r)
forall s t a b. Field2 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set (LineSegment 2 Int r)
</span><a href="#local-6989586621679965946"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span>                                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; IntMap Int -&gt; IntMap Int
forall a. Int -&gt; a -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IntMap.insert</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679965951"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679965951"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Int
</span><a href="#local-6989586621679965945"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span id="local-6989586621679965943"><span id="local-6989586621679965944"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#handleRegularR"><span class="hs-identifier hs-type">handleRegularR</span></a></span><span>            </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679965944"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679965944"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679965944"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#Sweep"><span class="hs-identifier hs-type">Sweep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679965943"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679965944"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-292"></span><span id="handleRegularR"><span class="annot"><span class="annottext">handleRegularR :: Int -&gt; Event r -&gt; Sweep p r ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#handleRegularR"><span class="hs-identifier hs-var hs-var">handleRegularR</span></a></span></span><span> </span><span id="local-6989586621679965942"><span class="annot"><span class="annottext">i :: Int
</span><a href="#local-6989586621679965942"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679965941"><span class="annot"><span class="annottext">v :: Point 2 r
</span><a href="#local-6989586621679965941"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Point 2 r -&gt; Sweep p r ()
forall r p.
(Fractional r, Ord r) =&gt;
Int -&gt; Point 2 r -&gt; Sweep p r ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.MakeMonotone.html#connectToLeft"><span class="hs-identifier hs-var">connectToLeft</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679965942"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679965941"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-293"></span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span>
</span><span id="line-297"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span>
</span><span id="line-300"></span><span class="hs-comment">-- testPolygon :: SimplePolygon Int Rational</span><span>
</span><span id="line-301"></span><span class="hs-comment">-- testPolygon = fromPoints [ Point2 20 20 :+ 1</span><span>
</span><span id="line-302"></span><span class="hs-comment">--                          , Point2 18 19 :+ 2</span><span>
</span><span id="line-303"></span><span class="hs-comment">--                          , Point2 16 25 :+ 3</span><span>
</span><span id="line-304"></span><span class="hs-comment">--                          , Point2 13 23 :+ 4</span><span>
</span><span id="line-305"></span><span class="hs-comment">--                          , Point2 10 24 :+ 5</span><span>
</span><span id="line-306"></span><span class="hs-comment">--                          , Point2 6  22 :+ 6</span><span>
</span><span id="line-307"></span><span class="hs-comment">--                          , Point2 8  21 :+ 7</span><span>
</span><span id="line-308"></span><span class="hs-comment">--                          , Point2 7  18 :+ 8</span><span>
</span><span id="line-309"></span><span class="hs-comment">--                          , Point2 2  19 :+ 9</span><span>
</span><span id="line-310"></span><span class="hs-comment">--                          , Point2 1  10 :+ 10</span><span>
</span><span id="line-311"></span><span class="hs-comment">--                          , Point2 3  5  :+ 11</span><span>
</span><span id="line-312"></span><span class="hs-comment">--                          , Point2 11 7  :+ 12</span><span>
</span><span id="line-313"></span><span class="hs-comment">--                          , Point2 15 1  :+ 13</span><span>
</span><span id="line-314"></span><span class="hs-comment">--                          , Point2 12 15 :+ 14</span><span>
</span><span id="line-315"></span><span class="hs-comment">--                          , Point2 15 12 :+ 15</span><span>
</span><span id="line-316"></span><span class="hs-comment">--                          ]</span><span>
</span><span id="line-317"></span><span>
</span><span id="line-318"></span><span class="hs-comment">-- vertexTypes = [Start,Merge,Start,Merge,Start,Regular,Regular,Merge,Start,Regular,End,Split,End,Split,End]</span><span>
</span><span id="line-319"></span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span class="hs-comment">-- loadT = do pgs &lt;- readAllFrom &quot;/Users/frank/tmp/testPoly.ipe&quot;</span><span>
</span><span id="line-322"></span><span class="hs-comment">--                         :: IO [SimplePolygon () Rational :+ IpeAttributes Path Rational]</span><span>
</span><span id="line-323"></span><span class="hs-comment">--            mapM_ print pgs</span><span>
</span><span id="line-324"></span><span class="hs-comment">--            let diags = map (computeDiagonals . (^.core)) pgs</span><span>
</span><span id="line-325"></span><span class="hs-comment">--                f = asIpeGroup . map (asIpeObject' mempty)</span><span>
</span><span id="line-326"></span><span class="hs-comment">--                out = [ asIpeGroup $ map (\(pg :+ a) -&gt; asIpeObject pg a) pgs</span><span>
</span><span id="line-327"></span><span class="hs-comment">--                      , asIpeGroup $ map f diags</span><span>
</span><span id="line-328"></span><span class="hs-comment">--                      ]</span><span>
</span><span id="line-329"></span><span class="hs-comment">--                outFile = &quot;/Users/frank/tmp/out.ipe&quot;</span><span>
</span><span id="line-330"></span><span class="hs-comment">--            writeIpeFile outFile . singlePageFromContent $ out</span><span>
</span><span id="line-331"></span><span>
</span><span id="line-332"></span><span>
</span><span id="line-333"></span><span class="hs-comment">-- myPoly :: Polygon Multi () Rational</span><span>
</span><span id="line-334"></span><span class="hs-comment">-- myPoly = MultiPolygon (CC.fromList $ read &quot;[Point2 [16 % 1,80 % 1] :+ (),Point2 [16 % 1,16 % 1] :+ (),Point2 [144 % 1,16 % 1] :+ (),Point2 [144 % 1,80 % 1] :+ ()]&quot;</span><span>
</span><span id="line-335"></span><span class="hs-comment">--                       )</span><span>
</span><span id="line-336"></span><span class="hs-comment">--   [ fromPoints $ read &quot;[Point2 [88 % 1,48 % 1] :+ (),Point2 [112 % 1,40 % 1] :+ (),Point2 [112 % 1,48 % 1] :+ (),Point2 [80 % 1,56 % 1] :+ ()]&quot;</span><span>
</span><span id="line-337"></span><span class="hs-comment">--   , fromPoints $ read &quot;[Point2 [32 % 1,64 % 1] :+ (),Point2 [32 % 1,32 % 1] :+ (),Point2 [64 % 1,32 % 1] :+ (),Point2 [64 % 1,64 % 1] :+ ()]&quot;</span><span>
</span><span id="line-338"></span><span class="hs-comment">--   ]</span><span>
</span><span id="line-339"></span></pre></body></html>