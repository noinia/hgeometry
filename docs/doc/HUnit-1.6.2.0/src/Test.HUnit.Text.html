<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | Text-based test controller for running HUnit tests and reporting</span><span>
</span><span id="line-2"></span><span class="hs-comment">--   results as text, usually to a terminal.</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Test.HUnit.Text</span><span>
</span><span id="line-5"></span><span class="hs-special">(</span><span>
</span><span id="line-6"></span><span>  </span><span class="annot"><a href="Test.HUnit.Text.html#PutText"><span class="hs-identifier">PutText</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-7"></span><span>  </span><span class="annot"><a href="Test.HUnit.Text.html#putTextToHandle"><span class="hs-identifier">putTextToHandle</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.HUnit.Text.html#putTextToShowS"><span class="hs-identifier">putTextToShowS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>  </span><span class="annot"><a href="Test.HUnit.Text.html#runTestText"><span class="hs-identifier">runTestText</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>  </span><span class="annot"><a href="Test.HUnit.Text.html#showPath"><span class="hs-identifier">showPath</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.HUnit.Text.html#showCounts"><span class="hs-identifier">showCounts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>  </span><span class="annot"><a href="Test.HUnit.Text.html#runTestTT"><span class="hs-identifier">runTestTT</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>  </span><span class="annot"><a href="Test.HUnit.Text.html#runTestTTAndExit"><span class="hs-identifier">runTestTTAndExit</span></a></span><span>
</span><span id="line-12"></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">where</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Test.HUnit.Base.html"><span class="hs-identifier">Test.HUnit.Base</span></a></span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.CallStack</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">when</span></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Handle</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">stderr</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">hPutStr</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">hPutStrLn</span></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Exit</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">exitSuccess</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">exitFailure</span></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-comment">-- | As the general text-based test controller ('runTestText') executes a</span><span>
</span><span id="line-24"></span><span class="hs-comment">--   test, it reports each test case start, error, and failure by</span><span>
</span><span id="line-25"></span><span class="hs-comment">--   constructing a string and passing it to the function embodied in a</span><span>
</span><span id="line-26"></span><span class="hs-comment">--   'PutText'.  A report string is known as a \&quot;line\&quot;, although it includes</span><span>
</span><span id="line-27"></span><span class="hs-comment">--   no line terminator; the function in a 'PutText' is responsible for</span><span>
</span><span id="line-28"></span><span class="hs-comment">--   terminating lines appropriately.  Besides the line, the function</span><span>
</span><span id="line-29"></span><span class="hs-comment">--   receives a flag indicating the intended \&quot;persistence\&quot; of the line:</span><span>
</span><span id="line-30"></span><span class="hs-comment">--   'True' indicates that the line should be part of the final overall</span><span>
</span><span id="line-31"></span><span class="hs-comment">--   report; 'False' indicates that the line merely indicates progress of</span><span>
</span><span id="line-32"></span><span class="hs-comment">--   the test execution.  Each progress line shows the current values of</span><span>
</span><span id="line-33"></span><span class="hs-comment">--   the cumulative test execution counts; a final, persistent line shows</span><span>
</span><span id="line-34"></span><span class="hs-comment">--   the final count values.</span><span>
</span><span id="line-35"></span><span class="hs-comment">--</span><span>
</span><span id="line-36"></span><span class="hs-comment">--   The 'PutText' function is also passed, and returns, an arbitrary state</span><span>
</span><span id="line-37"></span><span class="hs-comment">--   value (called 'st' here).  The initial state value is given in the</span><span>
</span><span id="line-38"></span><span class="hs-comment">--   'PutText'; the final value is returned by 'runTestText'.</span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="hs-keyword">data</span><span> </span><span id="PutText"><span class="annot"><a href="Test.HUnit.Text.html#PutText"><span class="hs-identifier hs-var">PutText</span></a></span></span><span> </span><span id="local-6989586621679035104"><span class="annot"><a href="#local-6989586621679035104"><span class="hs-identifier hs-type">st</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PutText"><span class="annot"><a href="Test.HUnit.Text.html#PutText"><span class="hs-identifier hs-var">PutText</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679035104"><span class="hs-identifier hs-type">st</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679035104"><span class="hs-identifier hs-type">st</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679035104"><span class="hs-identifier hs-type">st</span></a></span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-comment">-- | Two reporting schemes are defined here.  @putTextToHandle@ writes</span><span>
</span><span id="line-44"></span><span class="hs-comment">-- report lines to a given handle.  'putTextToShowS' accumulates</span><span>
</span><span id="line-45"></span><span class="hs-comment">-- persistent lines for return as a whole by 'runTestText'.</span><span>
</span><span id="line-46"></span><span class="hs-comment">--</span><span>
</span><span id="line-47"></span><span class="hs-comment">-- @putTextToHandle@ writes persistent lines to the given handle,</span><span>
</span><span id="line-48"></span><span class="hs-comment">-- following each by a newline character.  In addition, if the given flag</span><span>
</span><span id="line-49"></span><span class="hs-comment">-- is @True@, it writes progress lines to the handle as well.  A progress</span><span>
</span><span id="line-50"></span><span class="hs-comment">-- line is written with no line termination, so that it can be</span><span>
</span><span id="line-51"></span><span class="hs-comment">-- overwritten by the next report line.  As overwriting involves writing</span><span>
</span><span id="line-52"></span><span class="hs-comment">-- carriage return and blank characters, its proper effect is usually</span><span>
</span><span id="line-53"></span><span class="hs-comment">-- only obtained on terminal devices.</span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="annot"><a href="Test.HUnit.Text.html#putTextToHandle"><span class="hs-identifier hs-type">putTextToHandle</span></a></span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-comment">-- ^ Write progress lines to handle?</span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.HUnit.Text.html#PutText"><span class="hs-identifier hs-type">PutText</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-59"></span><span id="putTextToHandle"><span class="annot"><span class="annottext">putTextToHandle :: Handle -&gt; Bool -&gt; PutText Int
</span><a href="Test.HUnit.Text.html#putTextToHandle"><span class="hs-identifier hs-var hs-var">putTextToHandle</span></a></span></span><span> </span><span id="local-6989586621679035032"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679035032"><span class="hs-identifier hs-var">handle</span></a></span></span><span> </span><span id="local-6989586621679035031"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679035031"><span class="hs-identifier hs-var">showProgress</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall st. (String -&gt; Bool -&gt; st -&gt; IO st) -&gt; st -&gt; PutText st
</span><a href="Test.HUnit.Text.html#PutText"><span class="hs-identifier hs-var">PutText</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool -&gt; Int -&gt; IO Int
</span><a href="#local-6989586621679035030"><span class="hs-identifier hs-var">put</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679035029"><span class="hs-identifier hs-var">initCnt</span></a></span><span>
</span><span id="line-60"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-61"></span><span>  </span><span id="local-6989586621679035029"><span class="annot"><span class="annottext">initCnt :: Int
</span><a href="#local-6989586621679035029"><span class="hs-identifier hs-var hs-var">initCnt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679035031"><span class="hs-identifier hs-var">showProgress</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-62"></span><span>  </span><span id="local-6989586621679035030"><span class="annot"><span class="annottext">put :: String -&gt; Bool -&gt; Int -&gt; IO Int
</span><a href="#local-6989586621679035030"><span class="hs-identifier hs-var hs-var">put</span></a></span></span><span> </span><span id="local-6989586621679035010"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679035010"><span class="hs-identifier hs-var">line</span></a></span></span><span> </span><span id="local-6989586621679035009"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679035009"><span class="hs-identifier hs-var">pers</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679035009"><span class="hs-identifier hs-var">pers</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handle -&gt; String -&gt; IO ()
</span><span class="hs-identifier hs-var">hPutStrLn</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679035032"><span class="hs-identifier hs-var">handle</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679035010"><span class="hs-identifier hs-var">line</span></a></span><span class="hs-special">)</span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>  </span><span class="annot"><a href="#local-6989586621679035030"><span class="hs-identifier hs-var">put</span></a></span><span> </span><span id="local-6989586621679035008"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679035008"><span class="hs-identifier hs-var">line</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span id="local-6989586621679035007"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679035007"><span class="hs-identifier hs-var">cnt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; String -&gt; IO ()
</span><span class="hs-identifier hs-var">hPutStrLn</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679035032"><span class="hs-identifier hs-var">handle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; String
</span><a href="#local-6989586621679035006"><span class="hs-identifier hs-var">erase</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679035007"><span class="hs-identifier hs-var">cnt</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679035008"><span class="hs-identifier hs-var">line</span></a></span><span class="hs-special">)</span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-64"></span><span>  </span><span class="annot"><a href="#local-6989586621679035030"><span class="hs-identifier hs-var">put</span></a></span><span> </span><span id="local-6989586621679035005"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679035005"><span class="hs-identifier hs-var">line</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; String -&gt; IO ()
</span><span class="hs-identifier hs-var">hPutStr</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679035032"><span class="hs-identifier hs-var">handle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\r'</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679035005"><span class="hs-identifier hs-var">line</span></a></span><span class="hs-special">)</span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679035005"><span class="hs-identifier hs-var">line</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-comment">-- The &quot;erasing&quot; strategy with a single '\r' relies on the fact that the</span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-comment">-- lengths of successive summary lines are monotonically nondecreasing.</span><span>
</span><span id="line-67"></span><span>  </span><span id="local-6989586621679035006"><span class="annot"><span class="annottext">erase :: Int -&gt; String
</span><a href="#local-6989586621679035006"><span class="hs-identifier hs-var hs-var">erase</span></a></span></span><span> </span><span id="local-6989586621679035001"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679035001"><span class="hs-identifier hs-var">cnt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679035001"><span class="hs-identifier hs-var">cnt</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\r&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679035001"><span class="hs-identifier hs-var">cnt</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">' '</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\r&quot;</span></span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-comment">-- | Accumulates persistent lines (dropping progess lines) for return by</span><span>
</span><span id="line-71"></span><span class="hs-comment">--   'runTestText'.  The accumulated lines are represented by a</span><span>
</span><span id="line-72"></span><span class="hs-comment">--   @'ShowS' ('String' -&gt; 'String')@ function whose first argument is the</span><span>
</span><span id="line-73"></span><span class="hs-comment">--   string to be appended to the accumulated report lines.</span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span class="annot"><a href="Test.HUnit.Text.html#putTextToShowS"><span class="hs-identifier hs-type">putTextToShowS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Test.HUnit.Text.html#PutText"><span class="hs-identifier hs-type">PutText</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ShowS</span></span><span>
</span><span id="line-76"></span><span id="putTextToShowS"><span class="annot"><span class="annottext">putTextToShowS :: PutText ShowS
</span><a href="Test.HUnit.Text.html#putTextToShowS"><span class="hs-identifier hs-var hs-var">putTextToShowS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall st. (String -&gt; Bool -&gt; st -&gt; IO st) -&gt; st -&gt; PutText st
</span><a href="Test.HUnit.Text.html#PutText"><span class="hs-identifier hs-var">PutText</span></a></span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {t}.
Monad m =&gt;
String -&gt; Bool -&gt; (String -&gt; t) -&gt; m (String -&gt; t)
</span><a href="#local-6989586621679034999"><span class="hs-identifier hs-var">put</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-77"></span><span> </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679034999"><span class="annot"><span class="annottext">put :: String -&gt; Bool -&gt; (String -&gt; t) -&gt; m (String -&gt; t)
</span><a href="#local-6989586621679034999"><span class="hs-identifier hs-var hs-var">put</span></a></span></span><span> </span><span id="local-6989586621679034995"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679034995"><span class="hs-identifier hs-var">line</span></a></span></span><span> </span><span id="local-6989586621679034994"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679034994"><span class="hs-identifier hs-var">pers</span></a></span></span><span> </span><span id="local-6989586621679034993"><span class="annot"><span class="annottext">String -&gt; t
</span><a href="#local-6989586621679034993"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679034994"><span class="hs-identifier hs-var">pers</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall {t}. (String -&gt; t) -&gt; String -&gt; String -&gt; t
</span><a href="#local-6989586621679034992"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; t
</span><a href="#local-6989586621679034993"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679034995"><span class="hs-identifier hs-var">line</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; t
</span><a href="#local-6989586621679034993"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>       </span><span id="local-6989586621679034992"><span class="annot"><span class="annottext">acc :: (String -&gt; t) -&gt; String -&gt; String -&gt; t
</span><a href="#local-6989586621679034992"><span class="hs-identifier hs-var hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621679034991"><span class="annot"><span class="annottext">String -&gt; t
</span><a href="#local-6989586621679034991"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679034990"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679034990"><span class="hs-identifier hs-var">line</span></a></span></span><span> </span><span id="local-6989586621679034989"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679034989"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; t
</span><a href="#local-6989586621679034991"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679034990"><span class="hs-identifier hs-var">line</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\n'</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679034989"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-comment">-- | Executes a test, processing each report line according to the given</span><span>
</span><span id="line-82"></span><span class="hs-comment">--   reporting scheme.  The reporting scheme's state is threaded through calls</span><span>
</span><span id="line-83"></span><span class="hs-comment">--   to the reporting scheme's function and finally returned, along with final</span><span>
</span><span id="line-84"></span><span class="hs-comment">--   count values.</span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span id="local-6989586621679035089"><span class="annot"><a href="Test.HUnit.Text.html#runTestText"><span class="hs-identifier hs-type">runTestText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Test.HUnit.Text.html#PutText"><span class="hs-identifier hs-type">PutText</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679035089"><span class="hs-identifier hs-type">st</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.HUnit.Base.html#Test"><span class="hs-identifier hs-type">Test</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.HUnit.Base.html#Counts"><span class="hs-identifier hs-type">Counts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679035089"><span class="hs-identifier hs-type">st</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-87"></span><span id="runTestText"><span class="annot"><span class="annottext">runTestText :: forall st. PutText st -&gt; Test -&gt; IO (Counts, st)
</span><a href="Test.HUnit.Text.html#runTestText"><span class="hs-identifier hs-var hs-var">runTestText</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.HUnit.Text.html#PutText"><span class="hs-identifier hs-type">PutText</span></a></span><span> </span><span id="local-6989586621679034985"><span class="annot"><span class="annottext">String -&gt; Bool -&gt; st -&gt; IO st
</span><a href="#local-6989586621679034985"><span class="hs-identifier hs-var">put</span></a></span></span><span> </span><span id="local-6989586621679034984"><span class="annot"><span class="annottext">st
</span><a href="#local-6989586621679034984"><span class="hs-identifier hs-var">us0</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679034983"><span class="annot"><span class="annottext">Test
</span><a href="#local-6989586621679034983"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-88"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679034982"><span class="annot"><span class="annottext">Counts
</span><a href="#local-6989586621679034982"><span class="hs-identifier hs-var">counts'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679034981"><span class="annot"><span class="annottext">st
</span><a href="#local-6989586621679034981"><span class="hs-identifier hs-var">us1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall us.
ReportStart us
-&gt; ReportProblem us
-&gt; ReportProblem us
-&gt; us
-&gt; Test
-&gt; IO (Counts, us)
</span><a href="Test.HUnit.Base.html#performTest"><span class="hs-identifier hs-var">performTest</span></a></span><span> </span><span class="annot"><span class="annottext">State -&gt; st -&gt; IO st
</span><a href="#local-6989586621679034979"><span class="hs-identifier hs-var">reportStart</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SrcLoc -&gt; String -&gt; State -&gt; st -&gt; IO st
</span><a href="#local-6989586621679034978"><span class="hs-identifier hs-var">reportError</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SrcLoc -&gt; String -&gt; State -&gt; st -&gt; IO st
</span><a href="#local-6989586621679034977"><span class="hs-identifier hs-var">reportFailure</span></a></span><span> </span><span class="annot"><span class="annottext">st
</span><a href="#local-6989586621679034984"><span class="hs-identifier hs-var">us0</span></a></span><span> </span><span class="annot"><span class="annottext">Test
</span><a href="#local-6989586621679034983"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-89"></span><span>  </span><span id="local-6989586621679034976"><span class="annot"><span class="annottext">st
</span><a href="#local-6989586621679034976"><span class="hs-identifier hs-var">us2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool -&gt; st -&gt; IO st
</span><a href="#local-6989586621679034985"><span class="hs-identifier hs-var">put</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Counts -&gt; String
</span><a href="Test.HUnit.Text.html#showCounts"><span class="hs-identifier hs-var">showCounts</span></a></span><span> </span><span class="annot"><span class="annottext">Counts
</span><a href="#local-6989586621679034982"><span class="hs-identifier hs-var">counts'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">st
</span><a href="#local-6989586621679034981"><span class="hs-identifier hs-var">us1</span></a></span><span>
</span><span id="line-90"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Counts
</span><a href="#local-6989586621679034982"><span class="hs-identifier hs-var">counts'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">st
</span><a href="#local-6989586621679034976"><span class="hs-identifier hs-var">us2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-92"></span><span>  </span><span id="local-6989586621679034979"><span class="annot"><span class="annottext">reportStart :: State -&gt; st -&gt; IO st
</span><a href="#local-6989586621679034979"><span class="hs-identifier hs-var hs-var">reportStart</span></a></span></span><span> </span><span id="local-6989586621679034975"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679034975"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span id="local-6989586621679034974"><span class="annot"><span class="annottext">st
</span><a href="#local-6989586621679034974"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool -&gt; st -&gt; IO st
</span><a href="#local-6989586621679034985"><span class="hs-identifier hs-var">put</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Counts -&gt; String
</span><a href="Test.HUnit.Text.html#showCounts"><span class="hs-identifier hs-var">showCounts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">State -&gt; Counts
</span><a href="Test.HUnit.Base.html#counts"><span class="hs-identifier hs-var">counts</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679034975"><span class="hs-identifier hs-var">ss</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">st
</span><a href="#local-6989586621679034974"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-93"></span><span>  </span><span id="local-6989586621679034978"><span class="annot"><span class="annottext">reportError :: Maybe SrcLoc -&gt; String -&gt; State -&gt; st -&gt; IO st
</span><a href="#local-6989586621679034978"><span class="hs-identifier hs-var hs-var">reportError</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Maybe SrcLoc -&gt; String -&gt; State -&gt; st -&gt; IO st
</span><a href="#local-6989586621679034972"><span class="hs-identifier hs-var">reportProblem</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Error:&quot;</span></span><span>   </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Error in:   &quot;</span></span><span>
</span><span id="line-94"></span><span>  </span><span id="local-6989586621679034977"><span class="annot"><span class="annottext">reportFailure :: Maybe SrcLoc -&gt; String -&gt; State -&gt; st -&gt; IO st
</span><a href="#local-6989586621679034977"><span class="hs-identifier hs-var hs-var">reportFailure</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Maybe SrcLoc -&gt; String -&gt; State -&gt; st -&gt; IO st
</span><a href="#local-6989586621679034972"><span class="hs-identifier hs-var">reportProblem</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Failure:&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Failure in: &quot;</span></span><span>
</span><span id="line-95"></span><span>  </span><span id="local-6989586621679034972"><span class="annot"><span class="annottext">reportProblem :: String -&gt; String -&gt; Maybe SrcLoc -&gt; String -&gt; State -&gt; st -&gt; IO st
</span><a href="#local-6989586621679034972"><span class="hs-identifier hs-var hs-var">reportProblem</span></a></span></span><span> </span><span id="local-6989586621679034971"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679034971"><span class="hs-identifier hs-var">p0</span></a></span></span><span> </span><span id="local-6989586621679034970"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679034970"><span class="hs-identifier hs-var">p1</span></a></span></span><span> </span><span id="local-6989586621679034969"><span class="annot"><span class="annottext">Maybe SrcLoc
</span><a href="#local-6989586621679034969"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621679034968"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679034968"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621679034967"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679034967"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span id="local-6989586621679034966"><span class="annot"><span class="annottext">st
</span><a href="#local-6989586621679034966"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool -&gt; st -&gt; IO st
</span><a href="#local-6989586621679034985"><span class="hs-identifier hs-var">put</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679034965"><span class="hs-identifier hs-var">line</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">st
</span><a href="#local-6989586621679034966"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-96"></span><span>   </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679034965"><span class="annot"><span class="annottext">line :: String
</span><a href="#local-6989586621679034965"><span class="hs-identifier hs-var hs-var">line</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;### &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679034964"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679034963"><span class="hs-identifier hs-var">path'</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Maybe SrcLoc -&gt; String
</span><a href="Test.HUnit.Text.html#formatLocation"><span class="hs-identifier hs-var">formatLocation</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SrcLoc
</span><a href="#local-6989586621679034969"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679034968"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-97"></span><span>         </span><span id="local-6989586621679034964"><span class="annot"><span class="annottext">kind :: String
</span><a href="#local-6989586621679034964"><span class="hs-identifier hs-var hs-var">kind</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679034963"><span class="hs-identifier hs-var">path'</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679034971"><span class="hs-identifier hs-var">p0</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679034970"><span class="hs-identifier hs-var">p1</span></a></span><span>
</span><span id="line-98"></span><span>         </span><span id="local-6989586621679034963"><span class="annot"><span class="annottext">path' :: String
</span><a href="#local-6989586621679034963"><span class="hs-identifier hs-var hs-var">path'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Path -&gt; String
</span><a href="Test.HUnit.Text.html#showPath"><span class="hs-identifier hs-var">showPath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">State -&gt; Path
</span><a href="Test.HUnit.Base.html#path"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679034967"><span class="hs-identifier hs-var">ss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="annot"><a href="Test.HUnit.Text.html#formatLocation"><span class="hs-identifier hs-type">formatLocation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SrcLoc</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-101"></span><span id="formatLocation"><span class="annot"><span class="annottext">formatLocation :: Maybe SrcLoc -&gt; String
</span><a href="Test.HUnit.Text.html#formatLocation"><span class="hs-identifier hs-var hs-var">formatLocation</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe SrcLoc
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-102"></span><span class="annot"><a href="Test.HUnit.Text.html#formatLocation"><span class="hs-identifier hs-var">formatLocation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679034958"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621679034958"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; String
</span><span class="hs-identifier hs-var">srcLocFile</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621679034958"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;:&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc -&gt; Int
</span><span class="hs-identifier hs-var">srcLocStartLine</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621679034958"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n&quot;</span></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="hs-comment">-- | Converts test execution counts to a string.</span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="annot"><a href="Test.HUnit.Text.html#showCounts"><span class="hs-identifier hs-type">showCounts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Test.HUnit.Base.html#Counts"><span class="hs-identifier hs-type">Counts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-107"></span><span id="showCounts"><span class="annot"><span class="annottext">showCounts :: Counts -&gt; String
</span><a href="Test.HUnit.Text.html#showCounts"><span class="hs-identifier hs-var hs-var">showCounts</span></a></span></span><span> </span><span class="annot"><a href="Test.HUnit.Base.html#Counts"><span class="hs-identifier hs-type">Counts</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cases :: Counts -&gt; Int
</span><a href="Test.HUnit.Base.html#cases"><span class="hs-identifier hs-var">cases</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679034952"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679034952"><span class="hs-identifier hs-var">cases'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tried :: Counts -&gt; Int
</span><a href="Test.HUnit.Base.html#tried"><span class="hs-identifier hs-var">tried</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679034950"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679034950"><span class="hs-identifier hs-var">tried'</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-108"></span><span>                   </span><span class="annot"><span class="annottext">errors :: Counts -&gt; Int
</span><a href="Test.HUnit.Base.html#errors"><span class="hs-identifier hs-var">errors</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679034948"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679034948"><span class="hs-identifier hs-var">errors'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">failures :: Counts -&gt; Int
</span><a href="Test.HUnit.Base.html#failures"><span class="hs-identifier hs-var">failures</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679034946"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679034946"><span class="hs-identifier hs-var">failures'</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-109"></span><span>  </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Cases: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679034952"><span class="hs-identifier hs-var">cases'</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  Tried: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679034950"><span class="hs-identifier hs-var">tried'</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-110"></span><span>  </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  Errors: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679034948"><span class="hs-identifier hs-var">errors'</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  Failures: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679034946"><span class="hs-identifier hs-var">failures'</span></a></span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="hs-comment">-- | Converts a test case path to a string, separating adjacent elements by</span><span>
</span><span id="line-114"></span><span class="hs-comment">--   the colon (\':\'). An element of the path is quoted (as with 'show') when</span><span>
</span><span id="line-115"></span><span class="hs-comment">--   there is potential ambiguity.</span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span class="annot"><a href="Test.HUnit.Text.html#showPath"><span class="hs-identifier hs-type">showPath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Test.HUnit.Base.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-118"></span><span id="showPath"><span class="annot"><span class="annottext">showPath :: Path -&gt; String
</span><a href="Test.HUnit.Text.html#showPath"><span class="hs-identifier hs-var hs-var">showPath</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-119"></span><span class="annot"><a href="Test.HUnit.Text.html#showPath"><span class="hs-identifier hs-var">showPath</span></a></span><span> </span><span id="local-6989586621679034945"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679034945"><span class="hs-identifier hs-var">nodes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; a -&gt; a) -&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">foldl1</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><a href="#local-6989586621679034943"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Node -&gt; String
</span><a href="#local-6989586621679034942"><span class="hs-identifier hs-var">showNode</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679034945"><span class="hs-identifier hs-var">nodes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span> </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679034943"><span class="annot"><span class="annottext">f :: String -&gt; ShowS
</span><a href="#local-6989586621679034943"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679034941"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679034941"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679034940"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679034940"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679034940"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;:&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679034941"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-121"></span><span>       </span><span id="local-6989586621679034942"><span class="annot"><span class="annottext">showNode :: Node -&gt; String
</span><a href="#local-6989586621679034942"><span class="hs-identifier hs-var hs-var">showNode</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.HUnit.Base.html#ListItem"><span class="hs-identifier hs-type">ListItem</span></a></span><span> </span><span id="local-6989586621679034933"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679034933"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679034933"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-122"></span><span>       </span><span class="annot"><a href="#local-6989586621679034942"><span class="hs-identifier hs-var">showNode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.HUnit.Base.html#Label"><span class="hs-identifier hs-type">Label</span></a></span><span> </span><span id="local-6989586621679034931"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679034931"><span class="hs-keyword hs-var">label</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><a href="#local-6989586621679034930"><span class="hs-keyword hs-var">safe</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679034931"><span class="hs-keyword hs-var">label</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679034931"><span class="hs-keyword hs-var">label</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span>       </span><span id="local-6989586621679034930"><span class="annot"><span class="annottext">safe :: String -&gt; ShowS
</span><a href="#local-6989586621679034930"><span class="hs-keyword hs-var hs-var">safe</span></a></span></span><span> </span><span id="local-6989586621679034924"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679034924"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679034923"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679034923"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">':'</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679034924"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679034924"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679034923"><span class="hs-identifier hs-var">ss</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679034923"><span class="hs-identifier hs-var">ss</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679034924"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span class="hs-comment">-- | Provides the \&quot;standard\&quot; text-based test controller. Reporting is made to</span><span>
</span><span id="line-127"></span><span class="hs-comment">--   standard error, and progress reports are included. For possible</span><span>
</span><span id="line-128"></span><span class="hs-comment">--   programmatic use, the final counts are returned.</span><span>
</span><span id="line-129"></span><span class="hs-comment">--</span><span>
</span><span id="line-130"></span><span class="hs-comment">--   The \&quot;TT\&quot; in the name suggests \&quot;Text-based reporting to the Terminal\&quot;.</span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="annot"><a href="Test.HUnit.Text.html#runTestTT"><span class="hs-identifier hs-type">runTestTT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Test.HUnit.Base.html#Test"><span class="hs-identifier hs-type">Test</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Test.HUnit.Base.html#Counts"><span class="hs-identifier hs-type">Counts</span></a></span><span>
</span><span id="line-133"></span><span id="runTestTT"><span class="annot"><span class="annottext">runTestTT :: Test -&gt; IO Counts
</span><a href="Test.HUnit.Text.html#runTestTT"><span class="hs-identifier hs-var hs-var">runTestTT</span></a></span></span><span> </span><span id="local-6989586621679034919"><span class="annot"><span class="annottext">Test
</span><a href="#local-6989586621679034919"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679034918"><span class="annot"><span class="annottext">Counts
</span><a href="#local-6989586621679034918"><span class="hs-identifier hs-var">counts'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall st. PutText st -&gt; Test -&gt; IO (Counts, st)
</span><a href="Test.HUnit.Text.html#runTestText"><span class="hs-identifier hs-var">runTestText</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handle -&gt; Bool -&gt; PutText Int
</span><a href="Test.HUnit.Text.html#putTextToHandle"><span class="hs-identifier hs-var">putTextToHandle</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><span class="hs-identifier hs-var">stderr</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Test
</span><a href="#local-6989586621679034919"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-134"></span><span>                 </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Counts
</span><a href="#local-6989586621679034918"><span class="hs-identifier hs-var">counts'</span></a></span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span class="hs-comment">-- | Convenience wrapper for 'runTestTT'.</span><span>
</span><span id="line-137"></span><span class="hs-comment">--   Simply runs 'runTestTT' and then exits back to the OS,</span><span>
</span><span id="line-138"></span><span class="hs-comment">--   using 'exitSuccess' if there were no errors or failures,</span><span>
</span><span id="line-139"></span><span class="hs-comment">--   or 'exitFailure' if there were. For example:</span><span>
</span><span id="line-140"></span><span class="hs-comment">--</span><span>
</span><span id="line-141"></span><span class="hs-comment">--   &gt; tests :: Test</span><span>
</span><span id="line-142"></span><span class="hs-comment">--   &gt; tests = ...</span><span>
</span><span id="line-143"></span><span class="hs-comment">--   &gt;</span><span>
</span><span id="line-144"></span><span class="hs-comment">--   &gt; main :: IO ()</span><span>
</span><span id="line-145"></span><span class="hs-comment">--   &gt; main = runTestTTAndExit tests</span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span class="annot"><a href="Test.HUnit.Text.html#runTestTTAndExit"><span class="hs-identifier hs-type">runTestTTAndExit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Test.HUnit.Base.html#Test"><span class="hs-identifier hs-type">Test</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span id="runTestTTAndExit"><span class="annot"><span class="annottext">runTestTTAndExit :: Test -&gt; IO ()
</span><a href="Test.HUnit.Text.html#runTestTTAndExit"><span class="hs-identifier hs-var hs-var">runTestTTAndExit</span></a></span></span><span> </span><span id="local-6989586621679034917"><span class="annot"><span class="annottext">Test
</span><a href="#local-6989586621679034917"><span class="hs-identifier hs-var">tests</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-149"></span><span>  </span><span id="local-6989586621679034916"><span class="annot"><span class="annottext">Counts
</span><a href="#local-6989586621679034916"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Test -&gt; IO Counts
</span><a href="Test.HUnit.Text.html#runTestTT"><span class="hs-identifier hs-var">runTestTT</span></a></span><span> </span><span class="annot"><span class="annottext">Test
</span><a href="#local-6989586621679034917"><span class="hs-identifier hs-var">tests</span></a></span><span>
</span><span id="line-150"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Counts -&gt; Int
</span><a href="Test.HUnit.Base.html#errors"><span class="hs-identifier hs-var">errors</span></a></span><span> </span><span class="annot"><span class="annottext">Counts
</span><a href="#local-6989586621679034916"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Counts -&gt; Int
</span><a href="Test.HUnit.Base.html#failures"><span class="hs-identifier hs-var">failures</span></a></span><span> </span><span class="annot"><span class="annottext">Counts
</span><a href="#local-6989586621679034916"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall a. IO a
</span><span class="hs-identifier hs-var">exitSuccess</span></span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall a. IO a
</span><span class="hs-identifier hs-var">exitFailure</span></span><span>
</span><span id="line-153"></span></pre></body></html>