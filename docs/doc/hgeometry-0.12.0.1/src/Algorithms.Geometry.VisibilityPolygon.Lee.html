<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span id="%24con2tag_ATFSOXBqYBsKjioO5xhuTv"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-2"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- Module      :  Algorithms.Geometry.VisibilityPolygon.Lee</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- Copyright   :  (C) Frank Staals</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- License     :  see the LICENSE file</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- Maintainer  :  Frank Staals</span><span>
</span><span id="line-8"></span><span class="hs-comment">--</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- \(O(n\log n)\) time algorithm to compute the visibility polygon of</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- a point inside a polygon (possibly containing holes) with \(n\)</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- vertices, or among a set of \(n\) disjoint segments. The alogirhtm</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- used is the the rotational sweepline algorithm by Lee, described</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- in:</span><span>
</span><span id="line-14"></span><span class="hs-comment">--</span><span>
</span><span id="line-15"></span><span class="hs-comment">-- D. T. Lee. Proximity and reachability in the plane. Report R-831, Dept. Elect.</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- Engrg., Univ. Illinois, Urbana, IL, 1978.</span><span>
</span><span id="line-17"></span><span class="hs-comment">--</span><span>
</span><span id="line-18"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-19"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Algorithms.Geometry.VisibilityPolygon.Lee</span><span>
</span><span id="line-20"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#visibilityPolygon"><span class="hs-identifier">visibilityPolygon</span></a></span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#visibilitySweep"><span class="hs-identifier">visibilitySweep</span></a></span><span>
</span><span id="line-22"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#VisibilityPolygon"><span class="hs-identifier">VisibilityPolygon</span></a></span><span>
</span><span id="line-23"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Definer"><span class="hs-identifier">Definer</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#StarShapedPolygon"><span class="hs-identifier">StarShapedPolygon</span></a></span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#compareAroundEndPoint"><span class="hs-identifier">compareAroundEndPoint</span></a></span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(&lt;=&lt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Bifunctor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">first</span></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Ext</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">F</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Function</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">on</span></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.Geometry.HalfLine.html"><span class="hs-identifier">Data.Geometry.HalfLine</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.Geometry.Line.html"><span class="hs-identifier">Data.Geometry.Line</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.Geometry.LineSegment.html"><span class="hs-identifier">Data.Geometry.LineSegment</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.Geometry.Point.html"><span class="hs-identifier">Data.Geometry.Point</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.Geometry.Polygon.html"><span class="hs-identifier">Data.Geometry.Polygon</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.Geometry.Vector.html"><span class="hs-identifier">Data.Geometry.Vector</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Intersection</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.Util</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mapMaybe</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isJust</span></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Ord</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">comparing</span></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.RealNumber.Rational</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Semigroup.Foldable</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set.Util</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Util</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Vinyl.CoRec</span></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Debug.Trace</span></span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-keyword">type</span><span> </span><span id="R"><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#R"><span class="hs-identifier hs-var">R</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RealNumber</span></span><span> </span><span class="annot"><span class="hs-number">5</span></span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="hs-keyword">type</span><span> </span><span id="StarShapedPolygon"><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#StarShapedPolygon"><span class="hs-identifier hs-var">StarShapedPolygon</span></a></span></span><span> </span><span id="local-6989586621680037618"><span class="annot"><a href="#local-6989586621680037618"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span id="local-6989586621680037617"><span class="annot"><a href="#local-6989586621680037617"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.Geometry.Polygon.Core.html#SimplePolygon"><span class="hs-identifier hs-type">SimplePolygon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037618"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037617"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-comment">-- | Vertices of the visibility polgyon are either original vertices</span><span>
</span><span id="line-61"></span><span class="hs-comment">-- or defined by some vertex and an edge</span><span>
</span><span id="line-62"></span><span class="hs-keyword">type</span><span> </span><span id="Definer"><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Definer"><span class="hs-identifier hs-var">Definer</span></a></span></span><span> </span><span id="local-6989586621680037616"><span class="annot"><a href="#local-6989586621680037616"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span id="local-6989586621680037615"><span class="annot"><a href="#local-6989586621680037615"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621680037614"><span class="annot"><a href="#local-6989586621680037614"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621680037616"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037614"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680037616"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037616"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037614"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680037615"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-keyword">type</span><span> </span><span id="VisibilityPolygon"><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#VisibilityPolygon"><span class="hs-identifier hs-var">VisibilityPolygon</span></a></span></span><span> </span><span id="local-6989586621680037613"><span class="annot"><a href="#local-6989586621680037613"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span id="local-6989586621680037612"><span class="annot"><a href="#local-6989586621680037612"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621680037611"><span class="annot"><a href="#local-6989586621680037611"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#StarShapedPolygon"><span class="hs-identifier hs-type">StarShapedPolygon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Definer"><span class="hs-identifier hs-type">Definer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037613"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037612"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037611"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680037611"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-comment">-- | We either insert or delete segments</span><span>
</span><span id="line-67"></span><span class="hs-keyword">data</span><span> </span><span id="Action"><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Action"><span class="hs-identifier hs-var">Action</span></a></span></span><span> </span><span id="local-6989586621680037782"><span class="annot"><a href="#local-6989586621680037782"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Insert"><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Insert"><span class="hs-identifier hs-var">Insert</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621680037782"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Delete"><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Delete"><span class="hs-identifier hs-var">Delete</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621680037782"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680037603"><span id="local-6989586621680037605"><span id="local-6989586621680037607"><span class="annot"><span class="annottext">Int -&gt; Action a -&gt; ShowS
[Action a] -&gt; ShowS
Action a -&gt; String
(Int -&gt; Action a -&gt; ShowS)
-&gt; (Action a -&gt; String) -&gt; ([Action a] -&gt; ShowS) -&gt; Show (Action a)
forall a. Show a =&gt; Int -&gt; Action a -&gt; ShowS
forall a. Show a =&gt; [Action a] -&gt; ShowS
forall a. Show a =&gt; Action a -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [Action a] -&gt; ShowS
$cshowList :: forall a. Show a =&gt; [Action a] -&gt; ShowS
show :: Action a -&gt; String
$cshow :: forall a. Show a =&gt; Action a -&gt; String
showsPrec :: Int -&gt; Action a -&gt; ShowS
$cshowsPrec :: forall a. Show a =&gt; Int -&gt; Action a -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span id="local-6989586621680037598"><span id="local-6989586621680037600"><span class="annot"><span class="annottext">Action a -&gt; Action a -&gt; Bool
(Action a -&gt; Action a -&gt; Bool)
-&gt; (Action a -&gt; Action a -&gt; Bool) -&gt; Eq (Action a)
forall a. Eq a =&gt; Action a -&gt; Action a -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: Action a -&gt; Action a -&gt; Bool
$c/= :: forall a. Eq a =&gt; Action a -&gt; Action a -&gt; Bool
== :: Action a -&gt; Action a -&gt; Bool
$c== :: forall a. Eq a =&gt; Action a -&gt; Action a -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span id="local-6989586621680037582"><span id="local-6989586621680037584"><span id="local-6989586621680037586"><span id="local-6989586621680037588"><span id="local-6989586621680037590"><span id="local-6989586621680037592"><span id="local-6989586621680037594"><span class="annot"><span class="annottext">Eq (Action a)
Eq (Action a) =&gt;
(Action a -&gt; Action a -&gt; Ordering)
-&gt; (Action a -&gt; Action a -&gt; Bool)
-&gt; (Action a -&gt; Action a -&gt; Bool)
-&gt; (Action a -&gt; Action a -&gt; Bool)
-&gt; (Action a -&gt; Action a -&gt; Bool)
-&gt; (Action a -&gt; Action a -&gt; Action a)
-&gt; (Action a -&gt; Action a -&gt; Action a)
-&gt; Ord (Action a)
Action a -&gt; Action a -&gt; Bool
Action a -&gt; Action a -&gt; Ordering
Action a -&gt; Action a -&gt; Action a
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall a. Ord a =&gt; Eq (Action a)
forall a. Ord a =&gt; Action a -&gt; Action a -&gt; Bool
forall a. Ord a =&gt; Action a -&gt; Action a -&gt; Ordering
forall a. Ord a =&gt; Action a -&gt; Action a -&gt; Action a
min :: Action a -&gt; Action a -&gt; Action a
$cmin :: forall a. Ord a =&gt; Action a -&gt; Action a -&gt; Action a
max :: Action a -&gt; Action a -&gt; Action a
$cmax :: forall a. Ord a =&gt; Action a -&gt; Action a -&gt; Action a
&gt;= :: Action a -&gt; Action a -&gt; Bool
$c&gt;= :: forall a. Ord a =&gt; Action a -&gt; Action a -&gt; Bool
&gt; :: Action a -&gt; Action a -&gt; Bool
$c&gt; :: forall a. Ord a =&gt; Action a -&gt; Action a -&gt; Bool
&lt;= :: Action a -&gt; Action a -&gt; Bool
$c&lt;= :: forall a. Ord a =&gt; Action a -&gt; Action a -&gt; Bool
&lt; :: Action a -&gt; Action a -&gt; Bool
$c&lt; :: forall a. Ord a =&gt; Action a -&gt; Action a -&gt; Bool
compare :: Action a -&gt; Action a -&gt; Ordering
$ccompare :: forall a. Ord a =&gt; Action a -&gt; Action a -&gt; Ordering
$cp1Ord :: forall a. Ord a =&gt; Eq (Action a)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span id="local-6989586621680037771"><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#isInsert"><span class="hs-identifier hs-type">isInsert</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037771"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-70"></span><span id="isInsert"><span class="annot"><span class="annottext">isInsert :: Action a -&gt; Bool
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#isInsert"><span class="hs-identifier hs-var hs-var">isInsert</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-71"></span><span>  </span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Insert"><span class="hs-identifier hs-type">Insert</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-72"></span><span>  </span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Delete"><span class="hs-identifier hs-type">Delete</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span id="local-6989586621680037773"><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#extract"><span class="hs-identifier hs-type">extract</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037773"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680037773"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-75"></span><span id="extract"><span class="annot"><span class="annottext">extract :: Action a -&gt; a
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#extract"><span class="hs-identifier hs-var hs-var">extract</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-76"></span><span>  </span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Insert"><span class="hs-identifier hs-type">Insert</span></a></span><span> </span><span id="local-6989586621680037578"><span class="annot"><span class="annottext">x :: a
</span><a href="#local-6989586621680037578"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680037578"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-77"></span><span>  </span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Delete"><span class="hs-identifier hs-type">Delete</span></a></span><span> </span><span id="local-6989586621680037577"><span class="annot"><span class="annottext">x :: a
</span><a href="#local-6989586621680037577"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680037577"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-comment">-- | An event corresponds to some orientation at which the set of segments</span><span>
</span><span id="line-80"></span><span class="hs-comment">-- intersected by the ray changes (this orientation is defined by a point)</span><span>
</span><span id="line-81"></span><span class="hs-keyword">data</span><span> </span><span id="Event"><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Event"><span class="hs-identifier hs-var">Event</span></a></span></span><span> </span><span id="local-6989586621680037843"><span class="annot"><a href="#local-6989586621680037843"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span id="local-6989586621680037842"><span class="annot"><a href="#local-6989586621680037842"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621680037841"><span class="annot"><a href="#local-6989586621680037841"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Event"><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Event"><span class="hs-identifier hs-var">Event</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="_eventVtx"><span class="annot"><span class="annottext">Event p e r -&gt; Point 2 r :+ p
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#_eventVtx"><span class="hs-identifier hs-var hs-var">_eventVtx</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037841"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680037843"><span class="hs-identifier hs-type">p</span></a></span><span>
</span><span id="line-82"></span><span>                         </span><span class="hs-special">,</span><span> </span><span id="_actions"><span class="annot"><span class="annottext">Event p e r -&gt; NonEmpty (Action (LineSegment 2 p r :+ e))
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#_actions"><span class="hs-identifier hs-var hs-var">_actions</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037843"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037841"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680037842"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span>                         </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621680037568"><span id="local-6989586621680037570"><span id="local-6989586621680037572"><span class="annot"><span class="annottext">Int -&gt; Event p e r -&gt; ShowS
[Event p e r] -&gt; ShowS
Event p e r -&gt; String
(Int -&gt; Event p e r -&gt; ShowS)
-&gt; (Event p e r -&gt; String)
-&gt; ([Event p e r] -&gt; ShowS)
-&gt; Show (Event p e r)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall p e r.
(Show r, Show p, Show e) =&gt;
Int -&gt; Event p e r -&gt; ShowS
forall p e r. (Show r, Show p, Show e) =&gt; [Event p e r] -&gt; ShowS
forall p e r. (Show r, Show p, Show e) =&gt; Event p e r -&gt; String
showList :: [Event p e r] -&gt; ShowS
$cshowList :: forall p e r. (Show r, Show p, Show e) =&gt; [Event p e r] -&gt; ShowS
show :: Event p e r -&gt; String
$cshow :: forall p e r. (Show r, Show p, Show e) =&gt; Event p e r -&gt; String
showsPrec :: Int -&gt; Event p e r -&gt; ShowS
$cshowsPrec :: forall p e r.
(Show r, Show p, Show e) =&gt;
Int -&gt; Event p e r -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span>
</span><span id="line-84"></span><span id="eventVtx"><span id="actions"><span id="local-6989586621680037794"><span id="local-6989586621680037841"><span id="local-6989586621680037842"><span id="local-6989586621680037843"><span class="hs-identifier">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Event</span></span></span></span></span></span></span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="hs-comment">-- | The status structure maintains the subset of segments currently</span><span>
</span><span id="line-87"></span><span class="hs-comment">-- intersected by the ray that starts in the query point q, in order</span><span>
</span><span id="line-88"></span><span class="hs-comment">-- of increasing distance along the ray.</span><span>
</span><span id="line-89"></span><span class="hs-keyword">type</span><span> </span><span id="Status"><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Status"><span class="hs-identifier hs-var">Status</span></a></span></span><span> </span><span id="local-6989586621680037565"><span class="annot"><a href="#local-6989586621680037565"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span id="local-6989586621680037564"><span class="annot"><a href="#local-6989586621680037564"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621680037563"><span class="annot"><a href="#local-6989586621680037563"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037565"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037563"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680037564"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="hs-comment">-- | Computes the visibility polygon of a point q in a polygon with</span><span>
</span><span id="line-99"></span><span class="hs-comment">-- \(n\) vertices.</span><span>
</span><span id="line-100"></span><span class="hs-comment">--</span><span>
</span><span id="line-101"></span><span class="hs-comment">-- pre: q lies strictly inside the polygon</span><span>
</span><span id="line-102"></span><span class="hs-comment">--</span><span>
</span><span id="line-103"></span><span class="hs-comment">-- running time: \(O(n\log n)\)</span><span>
</span><span id="line-104"></span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#visibilityPolygon"><span class="hs-identifier hs-type">visibilityPolygon</span></a></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680037641"><span class="annot"><a href="#local-6989586621680037641"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span id="local-6989586621680037642"><span class="annot"><a href="#local-6989586621680037642"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span id="local-6989586621680037643"><span class="annot"><a href="#local-6989586621680037643"><span class="hs-identifier hs-type">r</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680037643"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621680037643"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>                       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037643"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-106"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Polygon.Core.html#Polygon"><span class="hs-identifier hs-type">Polygon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037642"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037641"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037643"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-107"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#StarShapedPolygon"><span class="hs-identifier hs-type">StarShapedPolygon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Definer"><span class="hs-identifier hs-type">Definer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037641"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680037643"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680037643"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-108"></span><span id="visibilityPolygon"><span class="annot"><span class="annottext">visibilityPolygon :: Point 2 r -&gt; Polygon t p r -&gt; StarShapedPolygon (Definer p () r) r
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#visibilityPolygon"><span class="hs-identifier hs-var hs-var">visibilityPolygon</span></a></span></span><span> </span><span id="local-6989586621680037562"><span class="annot"><span class="annottext">q :: Point 2 r
</span><a href="#local-6989586621680037562"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621680037561"><span class="annot"><span class="annottext">pg :: Polygon t p r
</span><a href="#local-6989586621680037561"><span class="hs-identifier hs-var">pg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-109"></span><span>    </span><span class="annot"><span class="annottext">[Point 2 r :+ Definer p () r]
-&gt; StarShapedPolygon (Definer p () r) r
forall p r. (Eq r, Num r) =&gt; [Point 2 r :+ p] -&gt; SimplePolygon p r
</span><a href="Data.Geometry.Polygon.Core.html#fromPoints"><span class="hs-identifier hs-var">fromPoints</span></a></span><span> </span><span class="annot"><span class="annottext">([Point 2 r :+ Definer p () r]
 -&gt; StarShapedPolygon (Definer p () r) r)
-&gt; (Polygon t p r -&gt; [Point 2 r :+ Definer p () r])
-&gt; Polygon t p r
-&gt; StarShapedPolygon (Definer p () r) r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Vector 2 r
-&gt; Maybe (Point 2 r)
-&gt; Point 2 r
-&gt; [LineSegment 2 p r :+ ()]
-&gt; [Point 2 r :+ Definer p () r]
forall p r e.
(Ord r, Fractional r) =&gt;
Vector 2 r
-&gt; Maybe (Point 2 r)
-&gt; Point 2 r
-&gt; [LineSegment 2 p r :+ e]
-&gt; [Point 2 r :+ Definer p e r]
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#visibilitySweep"><span class="hs-identifier hs-var">visibilitySweep</span></a></span><span> </span><span class="annot"><span class="annottext">Vector 2 r
</span><a href="#local-6989586621680037558"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Point 2 r)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037562"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">([LineSegment 2 p r :+ ()] -&gt; [Point 2 r :+ Definer p () r])
-&gt; (Polygon t p r -&gt; [LineSegment 2 p r :+ ()])
-&gt; Polygon t p r
-&gt; [Point 2 r :+ Definer p () r]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r -&gt; LineSegment 2 p r :+ ())
-&gt; [LineSegment 2 p r] -&gt; [LineSegment 2 p r :+ ()]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r -&gt; LineSegment 2 p r :+ ()
forall a. a -&gt; a :+ ()
</span><span class="hs-identifier hs-var">ext</span></span><span> </span><span class="annot"><span class="annottext">([LineSegment 2 p r] -&gt; [LineSegment 2 p r :+ ()])
-&gt; (Polygon t p r -&gt; [LineSegment 2 p r])
-&gt; Polygon t p r
-&gt; [LineSegment 2 p r :+ ()]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Polygon t p r -&gt; [LineSegment 2 p r]
forall (t :: PolygonType) p r. Polygon t p r -&gt; [LineSegment 2 p r]
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#closedEdges"><span class="hs-identifier hs-var">closedEdges</span></a></span><span> </span><span class="annot"><span class="annottext">(Polygon t p r -&gt; StarShapedPolygon (Definer p () r) r)
-&gt; Polygon t p r -&gt; StarShapedPolygon (Definer p () r) r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Polygon t p r
</span><a href="#local-6989586621680037561"><span class="hs-identifier hs-var">pg</span></a></span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-111"></span><span>    </span><span id="local-6989586621680037558"><span class="annot"><span class="annottext">v :: Vector 2 r
</span><a href="#local-6989586621680037558"><span class="hs-identifier hs-var hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Point 2 r -&gt; Point 2 r -&gt; Vector 2 r)
-&gt; (Point 2 r, Point 2 r) -&gt; Vector 2 r
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; Point 2 r -&gt; Vector 2 r
forall r.
Fractional r =&gt;
Point 2 r -&gt; Point 2 r -&gt; Point 2 r -&gt; Vector 2 r
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#startingDirection"><span class="hs-identifier hs-var">startingDirection</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037562"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Point 2 r, Point 2 r) -&gt; Vector 2 r)
-&gt; (Polygon t p r -&gt; (Point 2 r, Point 2 r))
-&gt; Polygon t p r
-&gt; Vector 2 r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; NonEmpty (Point 2 r :+ p) -&gt; (Point 2 r, Point 2 r)
forall r p.
(Ord r, Num r) =&gt;
Point 2 r -&gt; NonEmpty (Point 2 r :+ p) -&gt; (Point 2 r, Point 2 r)
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#consecutive"><span class="hs-identifier hs-var">consecutive</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037562"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (Point 2 r :+ p) -&gt; (Point 2 r, Point 2 r))
-&gt; (Polygon t p r -&gt; NonEmpty (Point 2 r :+ p))
-&gt; Polygon t p r
-&gt; (Point 2 r, Point 2 r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Polygon t p r -&gt; NonEmpty (Point 2 r :+ p)
forall (t :: PolygonType) p r.
Polygon t p r -&gt; NonEmpty (Point 2 r :+ p)
</span><a href="Data.Geometry.Polygon.Core.html#polygonVertices"><span class="hs-identifier hs-var">polygonVertices</span></a></span><span> </span><span class="annot"><span class="annottext">(Polygon t p r -&gt; Vector 2 r) -&gt; Polygon t p r -&gt; Vector 2 r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Polygon t p r
</span><a href="#local-6989586621680037561"><span class="hs-identifier hs-var">pg</span></a></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span class="hs-comment">-- | Computes the visibility polgyon from a vertex</span><span>
</span><span id="line-136"></span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#visibilityPolygonFromVertex"><span class="hs-identifier hs-type">visibilityPolygonFromVertex</span></a></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680037637"><span class="annot"><a href="#local-6989586621680037637"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span id="local-6989586621680037636"><span class="annot"><a href="#local-6989586621680037636"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span id="local-6989586621680037638"><span class="annot"><a href="#local-6989586621680037638"><span class="hs-identifier hs-type">r</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680037638"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621680037638"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621680037638"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621680037637"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>                                 </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Polygon.Core.html#Polygon"><span class="hs-identifier hs-type">Polygon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037636"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037637"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037638"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-138"></span><span>                                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-comment">-- ^ from the i^th vertex on the outer boundary</span><span>
</span><span id="line-139"></span><span>                                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#VisibilityPolygon"><span class="hs-identifier hs-type">VisibilityPolygon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037637"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680037638"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-140"></span><span id="visibilityPolygonFromVertex"><span class="annot"><span class="annottext">visibilityPolygonFromVertex :: Polygon t p r -&gt; Int -&gt; VisibilityPolygon p () r
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#visibilityPolygonFromVertex"><span class="hs-identifier hs-var hs-var">visibilityPolygonFromVertex</span></a></span></span><span> </span><span id="local-6989586621680037550"><span class="annot"><span class="annottext">pg :: Polygon t p r
</span><a href="#local-6989586621680037550"><span class="hs-identifier hs-var">pg</span></a></span></span><span> </span><span id="local-6989586621680037549"><span class="annot"><span class="annottext">i :: Int
</span><a href="#local-6989586621680037549"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-141"></span><span>    </span><span class="annot"><span class="annottext">[Point 2 r :+ Definer p () r] -&gt; VisibilityPolygon p () r
forall p r. (Eq r, Num r) =&gt; [Point 2 r :+ p] -&gt; SimplePolygon p r
</span><a href="Data.Geometry.Polygon.Core.html#fromPoints"><span class="hs-identifier hs-var">fromPoints</span></a></span><span> </span><span class="annot"><span class="annottext">([Point 2 r :+ Definer p () r] -&gt; VisibilityPolygon p () r)
-&gt; ([LineSegment 2 p r] -&gt; [Point 2 r :+ Definer p () r])
-&gt; [LineSegment 2 p r]
-&gt; VisibilityPolygon p () r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Vector 2 r
-&gt; Maybe (Point 2 r)
-&gt; Point 2 r
-&gt; [LineSegment 2 p r :+ ()]
-&gt; [Point 2 r :+ Definer p () r]
forall p r e.
(Ord r, Fractional r) =&gt;
Vector 2 r
-&gt; Maybe (Point 2 r)
-&gt; Point 2 r
-&gt; [LineSegment 2 p r :+ e]
-&gt; [Point 2 r :+ Definer p e r]
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#visibilitySweep"><span class="hs-identifier hs-var">visibilitySweep</span></a></span><span> </span><span class="annot"><span class="annottext">Vector 2 r
</span><a href="#local-6989586621680037548"><span class="hs-identifier hs-var">sv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r -&gt; Maybe (Point 2 r)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037547"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037546"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">([LineSegment 2 p r :+ ()] -&gt; [Point 2 r :+ Definer p () r])
-&gt; ([LineSegment 2 p r] -&gt; [LineSegment 2 p r :+ ()])
-&gt; [LineSegment 2 p r]
-&gt; [Point 2 r :+ Definer p () r]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r -&gt; LineSegment 2 p r :+ ())
-&gt; [LineSegment 2 p r] -&gt; [LineSegment 2 p r :+ ()]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r -&gt; LineSegment 2 p r :+ ()
forall a. a -&gt; a :+ ()
</span><span class="hs-identifier hs-var">ext</span></span><span> </span><span class="annot"><span class="annottext">([LineSegment 2 p r] -&gt; VisibilityPolygon p () r)
-&gt; [LineSegment 2 p r] -&gt; VisibilityPolygon p () r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621680037545"><span class="hs-identifier hs-var">segs</span></a></span><span>
</span><span id="line-142"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680037546"><span class="annot"><span class="annottext">v :: Point 2 r
</span><a href="#local-6989586621680037546"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Polygon t p r
</span><a href="#local-6989586621680037550"><span class="hs-identifier hs-var">pg</span></a></span><span class="annot"><span class="annottext">Polygon t p r
-&gt; Getting (Point 2 r :+ p) (Polygon t p r) (Point 2 r :+ p)
-&gt; Point 2 r :+ p
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Int -&gt; Getter (Polygon t p r) (Point 2 r :+ p)
forall (t :: PolygonType) p r.
Int -&gt; Getter (Polygon t p r) (Point 2 r :+ p)
</span><a href="Data.Geometry.Polygon.Core.html#outerVertex"><span class="hs-identifier hs-var">outerVertex</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680037549"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-144"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680037547"><span class="annot"><span class="annottext">w :: Point 2 r
</span><a href="#local-6989586621680037547"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Polygon t p r
</span><a href="#local-6989586621680037550"><span class="hs-identifier hs-var">pg</span></a></span><span class="annot"><span class="annottext">Polygon t p r
-&gt; Getting (Point 2 r :+ p) (Polygon t p r) (Point 2 r :+ p)
-&gt; Point 2 r :+ p
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Int -&gt; Getter (Polygon t p r) (Point 2 r :+ p)
forall (t :: PolygonType) p r.
Int -&gt; Getter (Polygon t p r) (Point 2 r :+ p)
</span><a href="Data.Geometry.Polygon.Core.html#outerVertex"><span class="hs-identifier hs-var">outerVertex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680037549"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680037541"><span class="annot"><span class="annottext">u :: Point 2 r
</span><a href="#local-6989586621680037541"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Polygon t p r
</span><a href="#local-6989586621680037550"><span class="hs-identifier hs-var">pg</span></a></span><span class="annot"><span class="annottext">Polygon t p r
-&gt; Getting (Point 2 r :+ p) (Polygon t p r) (Point 2 r :+ p)
-&gt; Point 2 r :+ p
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Int -&gt; Getter (Polygon t p r) (Point 2 r :+ p)
forall (t :: PolygonType) p r.
Int -&gt; Getter (Polygon t p r) (Point 2 r :+ p)
</span><a href="Data.Geometry.Polygon.Core.html#outerVertex"><span class="hs-identifier hs-var">outerVertex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680037549"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span>    </span><span class="hs-comment">-- rotates the polygon so that u becomes the focus, and gets all</span><span>
</span><span id="line-148"></span><span>    </span><span class="hs-comment">-- other vertices. Takes the next CCW vertex around v, starting</span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-comment">-- form the direction indicated by v.</span><span>
</span><span id="line-150"></span><span>    </span><span id="local-6989586621680037539"><span class="annot"><span class="annottext">z :: Point 2 r
</span><a href="#local-6989586621680037539"><span class="hs-identifier hs-var hs-var">z</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680037538"><span class="annot"><span class="annottext">u' :: Point 2 r :+ p
</span><a href="#local-6989586621680037538"><span class="hs-identifier hs-var">u'</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span id="local-6989586621680037536"><span class="annot"><span class="annottext">rest :: [Point 2 r :+ p]
</span><a href="#local-6989586621680037536"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; NonEmpty (Point 2 r :+ p) -&gt; NonEmpty (Point 2 r :+ p)
forall b a. (Show b, Show a) =&gt; a -&gt; b -&gt; b
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#traceShowIdWith"><span class="hs-identifier hs-var">traceShowIdWith</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;vertices&quot;</span></span><span>
</span><span id="line-151"></span><span>                       </span><span class="annot"><span class="annottext">(NonEmpty (Point 2 r :+ p) -&gt; NonEmpty (Point 2 r :+ p))
-&gt; NonEmpty (Point 2 r :+ p) -&gt; NonEmpty (Point 2 r :+ p)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>  </span><span class="annot"><span class="annottext">Polygon t p r -&gt; NonEmpty (Point 2 r :+ p)
forall (t :: PolygonType) p r.
Polygon t p r -&gt; NonEmpty (Point 2 r :+ p)
</span><a href="Data.Geometry.Polygon.Core.html#polygonVertices"><span class="hs-identifier hs-var">polygonVertices</span></a></span><span> </span><span class="annot"><span class="annottext">(Polygon t p r -&gt; NonEmpty (Point 2 r :+ p))
-&gt; Polygon t p r -&gt; NonEmpty (Point 2 r :+ p)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Polygon t p r
</span><a href="#local-6989586621680037550"><span class="hs-identifier hs-var">pg</span></a></span><span class="annot"><span class="annottext">Polygon t p r -&gt; (Polygon t p r -&gt; Polygon t p r) -&gt; Polygon t p r
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span class="annot"><span class="annottext">(SimplePolygon p r -&gt; Identity (SimplePolygon p r))
-&gt; Polygon t p r -&gt; Identity (Polygon t p r)
forall (t :: PolygonType) p r.
Lens' (Polygon t p r) (SimplePolygon p r)
</span><a href="Data.Geometry.Polygon.Core.html#outerBoundary"><span class="hs-identifier hs-var">outerBoundary</span></a></span><span> </span><span class="annot"><span class="annottext">((SimplePolygon p r -&gt; Identity (SimplePolygon p r))
 -&gt; Polygon t p r -&gt; Identity (Polygon t p r))
-&gt; (SimplePolygon p r -&gt; SimplePolygon p r)
-&gt; Polygon t p r
-&gt; Polygon t p r
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SimplePolygon p r -&gt; SimplePolygon p r
forall p r. Int -&gt; SimplePolygon p r -&gt; SimplePolygon p r
</span><a href="Data.Geometry.Polygon.Core.html#rotateRight"><span class="hs-identifier hs-var">rotateRight</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680037549"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">String -&gt; Point 2 r -&gt; Point 2 r
forall b a. (Show b, Show a) =&gt; a -&gt; b -&gt; b
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#traceShowIdWith"><span class="hs-identifier hs-var">traceShowIdWith</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;z&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Point 2 r -&gt; Point 2 r) -&gt; Point 2 r -&gt; Point 2 r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Vector 2 r -&gt; Point 2 r -&gt; [Point 2 r :+ p] -&gt; Point 2 r
forall r p.
(Ord r, Num r) =&gt;
Vector 2 r -&gt; Point 2 r -&gt; [Point 2 r :+ p] -&gt; Point 2 r
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#consecutiveFrom"><span class="hs-identifier hs-var">consecutiveFrom</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037541"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; Diff (Point 2) r
forall (p :: * -&gt; *) a. (Affine p, Num a) =&gt; p a -&gt; p a -&gt; Diff p a
</span><span class="hs-operator hs-var">.-.</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037546"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037546"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Point 2 r :+ p] -&gt; [Point 2 r :+ p]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">List.init</span></span><span> </span><span class="annot"><span class="annottext">[Point 2 r :+ p]
</span><a href="#local-6989586621680037536"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>           </span><span class="hs-comment">-- the last vertex in rest is v; so kill that</span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span>    </span><span id="local-6989586621680037548"><span class="annot"><span class="annottext">sv :: Vector 2 r
</span><a href="#local-6989586621680037548"><span class="hs-identifier hs-var hs-var">sv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; Point 2 r -&gt; Vector 2 r
forall r.
Fractional r =&gt;
Point 2 r -&gt; Point 2 r -&gt; Point 2 r -&gt; Vector 2 r
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#startingDirection"><span class="hs-identifier hs-var">startingDirection</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037546"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037541"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037539"><span class="hs-identifier hs-var">z</span></a></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span>    </span><span id="local-6989586621680037545"><span class="annot"><span class="annottext">segs :: [LineSegment 2 p r]
</span><a href="#local-6989586621680037545"><span class="hs-identifier hs-var hs-var">segs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 (SP Int p) r -&gt; LineSegment 2 p r)
-&gt; [LineSegment 2 (SP Int p) r] -&gt; [LineSegment 2 p r]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SP Int p -&gt; p) -&gt; LineSegment 2 (SP Int p) r -&gt; LineSegment 2 p r
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SP Int p -&gt; Getting p (SP Int p) p -&gt; p
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting p (SP Int p) p
forall s t a b. Field2 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_2</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>         </span><span class="annot"><span class="annottext">([LineSegment 2 (SP Int p) r] -&gt; [LineSegment 2 p r])
-&gt; (Polygon t (SP Int p) r -&gt; [LineSegment 2 (SP Int p) r])
-&gt; Polygon t (SP Int p) r
-&gt; [LineSegment 2 p r]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 (SP Int p) r -&gt; Bool)
-&gt; [LineSegment 2 (SP Int p) r] -&gt; [LineSegment 2 (SP Int p) r]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; (LineSegment 2 (SP Int p) r -&gt; Bool)
-&gt; LineSegment 2 (SP Int p) r
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; LineSegment 2 (SP Int p) r -&gt; Bool
forall a r. Int -&gt; LineSegment 2 (SP Int a) r -&gt; Bool
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#incidentTo"><span class="hs-identifier hs-var">incidentTo</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680037549"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>         </span><span class="annot"><span class="annottext">([LineSegment 2 (SP Int p) r] -&gt; [LineSegment 2 (SP Int p) r])
-&gt; (Polygon t (SP Int p) r -&gt; [LineSegment 2 (SP Int p) r])
-&gt; Polygon t (SP Int p) r
-&gt; [LineSegment 2 (SP Int p) r]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Polygon t (SP Int p) r -&gt; [LineSegment 2 (SP Int p) r]
forall (t :: PolygonType) p r. Polygon t p r -&gt; [LineSegment 2 p r]
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#closedEdges"><span class="hs-identifier hs-var">closedEdges</span></a></span><span> </span><span class="annot"><span class="annottext">(Polygon t (SP Int p) r -&gt; [LineSegment 2 p r])
-&gt; Polygon t (SP Int p) r -&gt; [LineSegment 2 p r]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Polygon t p r -&gt; Polygon t (SP Int p) r
forall (t :: PolygonType) p r.
Polygon t p r -&gt; Polygon t (SP Int p) r
</span><a href="Data.Geometry.Polygon.Core.html#numberVertices"><span class="hs-identifier hs-var">numberVertices</span></a></span><span> </span><span class="annot"><span class="annottext">Polygon t p r
</span><a href="#local-6989586621680037550"><span class="hs-identifier hs-var">pg</span></a></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span id="visibilityPolygonFromVertex%27"><span class="annot"><span class="annottext">visibilityPolygonFromVertex' :: Point 2 r
-&gt; Vector 2 r
-&gt; Maybe (Point 2 r)
-&gt; [LineSegment 2 p r :+ e]
-&gt; [Point 2 r :+ Definer p e r]
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#visibilityPolygonFromVertex%27"><span class="hs-identifier hs-var hs-var">visibilityPolygonFromVertex'</span></a></span></span><span> </span><span id="local-6989586621680037522"><span class="annot"><span class="annottext">q :: Point 2 r
</span><a href="#local-6989586621680037522"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621680037521"><span class="annot"><span class="annottext">sv :: Vector 2 r
</span><a href="#local-6989586621680037521"><span class="hs-identifier hs-var">sv</span></a></span></span><span> </span><span id="local-6989586621680037520"><span class="annot"><span class="annottext">mt :: Maybe (Point 2 r)
</span><a href="#local-6989586621680037520"><span class="hs-identifier hs-var">mt</span></a></span></span><span> </span><span id="local-6989586621680037519"><span class="annot"><span class="annottext">segs :: [LineSegment 2 p r :+ e]
</span><a href="#local-6989586621680037519"><span class="hs-identifier hs-var">segs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point 2 r
-&gt; Status p e r -&gt; [Event p e r] -&gt; [Point 2 r :+ Definer p e r]
forall (t :: * -&gt; *) r p e.
(Foldable t, Ord r, Fractional r) =&gt;
Point 2 r
-&gt; Status p e r -&gt; t (Event p e r) -&gt; [Point 2 r :+ Definer p e r]
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#sweep"><span class="hs-identifier hs-var">sweep</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037522"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Status p e r
</span><a href="#local-6989586621680037517"><span class="hs-identifier hs-var">statusStruct</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; [Event p e r] -&gt; [Event p e r]
forall b a. (Show b, Show a) =&gt; a -&gt; b -&gt; b
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#traceShowIdWith"><span class="hs-identifier hs-var">traceShowIdWith</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;events&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Event p e r]
</span><a href="#local-6989586621680037516"><span class="hs-identifier hs-var">events</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-163"></span><span>    </span><span id="local-6989586621680037515"><span class="annot"><span class="annottext">v :: a
</span><a href="#local-6989586621680037515"><span class="hs-identifier hs-var hs-var">v</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span>    </span><span class="hs-comment">-- lazily test if the segment intersects the initial ray</span><span>
</span><span id="line-166"></span><span>    </span><span id="local-6989586621680037513"><span class="annot"><span class="annottext">segs' :: [LineSegment 2 p r :+ (Maybe r, e)]
</span><a href="#local-6989586621680037513"><span class="hs-identifier hs-var hs-var">segs'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point 2 r
-&gt; HalfLine 2 r
-&gt; [LineSegment 2 p r :+ e]
-&gt; [LineSegment 2 p r :+ (Maybe r, e)]
forall r p b.
(Ord r, Fractional r) =&gt;
Point 2 r
-&gt; HalfLine 2 r
-&gt; [LineSegment 2 p r :+ b]
-&gt; [LineSegment 2 p r :+ (Maybe r, b)]
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#labelWithDistances"><span class="hs-identifier hs-var">labelWithDistances</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037522"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">HalfLine 2 r
</span><a href="#local-6989586621680037511"><span class="hs-identifier hs-var">initialRay</span></a></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r :+ e]
</span><a href="#local-6989586621680037519"><span class="hs-identifier hs-var">segs</span></a></span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span>    </span><span id="local-6989586621680037516"><span class="annot"><span class="annottext">events :: [Event p e r]
</span><a href="#local-6989586621680037516"><span class="hs-identifier hs-var hs-var">events</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point 2 r
-&gt; Vector 2 r
-&gt; ([Event p e r] -&gt; [Event p e r])
-&gt; [LineSegment 2 p r :+ (Maybe r, e)]
-&gt; [Event p e r]
forall r (t :: * -&gt; *) p1 e1 p2 e2.
(Ord r, Num r, Foldable t) =&gt;
Point 2 r
-&gt; Vector 2 r
-&gt; ([Event p1 e1 r] -&gt; [Event p2 e2 r])
-&gt; t (LineSegment 2 p1 r :+ (Maybe r, e1))
-&gt; [Event p2 e2 r]
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#computeEvents"><span class="hs-identifier hs-var">computeEvents</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037522"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Vector 2 r
</span><a href="#local-6989586621680037521"><span class="hs-identifier hs-var">sv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
-&gt; Vector 2 r
-&gt; Maybe (Point 2 r)
-&gt; [Event p e r]
-&gt; [Event p e r]
forall r a e.
(Ord r, Num r) =&gt;
Point 2 r
-&gt; Vector 2 r
-&gt; Maybe (Point 2 r)
-&gt; [Event a e r]
-&gt; [Event a e r]
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#untilEnd"><span class="hs-identifier hs-var">untilEnd</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037522"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Vector 2 r
</span><a href="#local-6989586621680037521"><span class="hs-identifier hs-var">sv</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Point 2 r)
</span><a href="#local-6989586621680037520"><span class="hs-identifier hs-var">mt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r :+ (Maybe r, e)]
</span><a href="#local-6989586621680037513"><span class="hs-identifier hs-var">segs'</span></a></span><span>
</span><span id="line-169"></span><span>        </span><span class="hs-comment">-- take only until the end of the range (if defined)</span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span>    </span><span id="local-6989586621680037511"><span class="annot"><span class="annottext">initialRay :: HalfLine 2 r
</span><a href="#local-6989586621680037511"><span class="hs-identifier hs-var hs-var">initialRay</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; HalfLine 2 r -&gt; HalfLine 2 r
forall b a. (Show b, Show a) =&gt; a -&gt; b -&gt; b
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#traceShowIdWith"><span class="hs-identifier hs-var">traceShowIdWith</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ray&quot;</span></span><span> </span><span class="annot"><span class="annottext">(HalfLine 2 r -&gt; HalfLine 2 r) -&gt; HalfLine 2 r -&gt; HalfLine 2 r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Vector 2 r -&gt; HalfLine 2 r
forall (d :: Nat) r. Point d r -&gt; Vector d r -&gt; HalfLine d r
</span><a href="Data.Geometry.HalfLine.html#HalfLine"><span class="hs-identifier hs-var">HalfLine</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037522"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Vector 2 r
</span><a href="#local-6989586621680037521"><span class="hs-identifier hs-var">sv</span></a></span><span>
</span><span id="line-172"></span><span>    </span><span id="local-6989586621680037517"><span class="annot"><span class="annottext">statusStruct :: Status p e r
</span><a href="#local-6989586621680037517"><span class="hs-identifier hs-var hs-var">statusStruct</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Status p e r -&gt; Status p e r
forall b a. (Show b, Show a) =&gt; a -&gt; b -&gt; b
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#traceShowIdWith"><span class="hs-identifier hs-var">traceShowIdWith</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;initialSS&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Status p e r -&gt; Status p e r) -&gt; Status p e r -&gt; Status p e r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r :+ (Maybe r, e)] -&gt; Status p e r
forall r p e.
(Ord r, Fractional r) =&gt;
[LineSegment 2 p r :+ (Maybe r, e)] -&gt; Status p e r
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#mkInitialSS"><span class="hs-identifier hs-var">mkInitialSS</span></a></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r :+ (Maybe r, e)]
</span><a href="#local-6989586621680037513"><span class="hs-identifier hs-var">segs'</span></a></span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span class="hs-comment">-- | Test if the line segment is incident to a point with the given</span><span>
</span><span id="line-176"></span><span class="hs-comment">-- index.</span><span>
</span><span id="line-177"></span><span id="local-6989586621680037907"><span id="local-6989586621680037908"><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#incidentTo"><span class="hs-identifier hs-type">incidentTo</span></a></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SP</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><a href="#local-6989586621680037908"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680037907"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-178"></span><span id="incidentTo"><span class="annot"><span class="annottext">incidentTo :: Int -&gt; LineSegment 2 (SP Int a) r -&gt; Bool
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#incidentTo"><span class="hs-identifier hs-var hs-var">incidentTo</span></a></span></span><span> </span><span id="local-6989586621680037506"><span class="annot"><span class="annottext">i :: Int
</span><a href="#local-6989586621680037506"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680037505"><span class="annot"><span class="annottext">s :: LineSegment 2 (SP Int a) r
</span><a href="#local-6989586621680037505"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LineSegment 2 (SP Int a) r
</span><a href="#local-6989586621680037505"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">LineSegment 2 (SP Int a) r
-&gt; Getting Int (LineSegment 2 (SP Int a) r) Int -&gt; Int
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">((Point 2 r :+ SP Int a) -&gt; Const Int (Point 2 r :+ SP Int a))
-&gt; LineSegment 2 (SP Int a) r
-&gt; Const Int (LineSegment 2 (SP Int a) r)
forall t. HasStart t =&gt; Lens' t (StartCore t :+ StartExtra t)
</span><a href="Data.Geometry.Interval.html#start"><span class="hs-identifier hs-var">start</span></a></span><span class="annot"><span class="annottext">(((Point 2 r :+ SP Int a) -&gt; Const Int (Point 2 r :+ SP Int a))
 -&gt; LineSegment 2 (SP Int a) r
 -&gt; Const Int (LineSegment 2 (SP Int a) r))
-&gt; ((Int -&gt; Const Int Int)
    -&gt; (Point 2 r :+ SP Int a) -&gt; Const Int (Point 2 r :+ SP Int a))
-&gt; Getting Int (LineSegment 2 (SP Int a) r) Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(SP Int a -&gt; Const Int (SP Int a))
-&gt; (Point 2 r :+ SP Int a) -&gt; Const Int (Point 2 r :+ SP Int a)
forall core extra extra'.
Lens (core :+ extra) (core :+ extra') extra extra'
</span><span class="hs-identifier hs-var">extra</span></span><span class="annot"><span class="annottext">((SP Int a -&gt; Const Int (SP Int a))
 -&gt; (Point 2 r :+ SP Int a) -&gt; Const Int (Point 2 r :+ SP Int a))
-&gt; ((Int -&gt; Const Int Int) -&gt; SP Int a -&gt; Const Int (SP Int a))
-&gt; (Int -&gt; Const Int Int)
-&gt; (Point 2 r :+ SP Int a)
-&gt; Const Int (Point 2 r :+ SP Int a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Int -&gt; Const Int Int) -&gt; SP Int a -&gt; Const Int (SP Int a)
forall s t a b. Field1 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_1</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680037506"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 (SP Int a) r
</span><a href="#local-6989586621680037505"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">LineSegment 2 (SP Int a) r
-&gt; Getting Int (LineSegment 2 (SP Int a) r) Int -&gt; Int
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">((Point 2 r :+ SP Int a) -&gt; Const Int (Point 2 r :+ SP Int a))
-&gt; LineSegment 2 (SP Int a) r
-&gt; Const Int (LineSegment 2 (SP Int a) r)
forall t. HasEnd t =&gt; Lens' t (EndCore t :+ EndExtra t)
</span><a href="Data.Geometry.Interval.html#end"><span class="hs-identifier hs-var">end</span></a></span><span class="annot"><span class="annottext">(((Point 2 r :+ SP Int a) -&gt; Const Int (Point 2 r :+ SP Int a))
 -&gt; LineSegment 2 (SP Int a) r
 -&gt; Const Int (LineSegment 2 (SP Int a) r))
-&gt; ((Int -&gt; Const Int Int)
    -&gt; (Point 2 r :+ SP Int a) -&gt; Const Int (Point 2 r :+ SP Int a))
-&gt; Getting Int (LineSegment 2 (SP Int a) r) Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(SP Int a -&gt; Const Int (SP Int a))
-&gt; (Point 2 r :+ SP Int a) -&gt; Const Int (Point 2 r :+ SP Int a)
forall core extra extra'.
Lens (core :+ extra) (core :+ extra') extra extra'
</span><span class="hs-identifier hs-var">extra</span></span><span class="annot"><span class="annottext">((SP Int a -&gt; Const Int (SP Int a))
 -&gt; (Point 2 r :+ SP Int a) -&gt; Const Int (Point 2 r :+ SP Int a))
-&gt; ((Int -&gt; Const Int Int) -&gt; SP Int a -&gt; Const Int (SP Int a))
-&gt; (Int -&gt; Const Int Int)
-&gt; (Point 2 r :+ SP Int a)
-&gt; Const Int (Point 2 r :+ SP Int a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Int -&gt; Const Int Int) -&gt; SP Int a -&gt; Const Int (SP Int a)
forall s t a b. Field1 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_1</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680037506"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span class="hs-comment">-- | computes a (partial) visibility polygon of a set of \(n\)</span><span>
</span><span id="line-189"></span><span class="hs-comment">-- disjoint segments. The input segments are allowed to share</span><span>
</span><span id="line-190"></span><span class="hs-comment">-- endpoints, but no intersections or no endpoints in the interior of</span><span>
</span><span id="line-191"></span><span class="hs-comment">-- other segments. The input vector indicates the starting direction,</span><span>
</span><span id="line-192"></span><span class="hs-comment">-- the Maybe point indicates up to which point/dicrection (CCW) of the</span><span>
</span><span id="line-193"></span><span class="hs-comment">-- starting vector we should compute the visibility polygon.</span><span>
</span><span id="line-194"></span><span class="hs-comment">--</span><span>
</span><span id="line-195"></span><span class="hs-comment">-- pre : - all line segments are considered closed.</span><span>
</span><span id="line-196"></span><span class="hs-comment">--       - no singleton linesegments exactly pointing away from q.</span><span>
</span><span id="line-197"></span><span class="hs-comment">--       - for every orientattion the visibility is blocked somewhere, i.e.</span><span>
</span><span id="line-198"></span><span class="hs-comment">--            no rays starting in the query point q that are disjoint from all segments.</span><span>
</span><span id="line-199"></span><span class="hs-comment">--       - no vertices at staring direction sv</span><span>
</span><span id="line-200"></span><span class="hs-comment">--</span><span>
</span><span id="line-201"></span><span class="hs-comment">-- running time: \(O(n\log n)\)</span><span>
</span><span id="line-202"></span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#visibilitySweep"><span class="hs-identifier hs-type">visibilitySweep</span></a></span><span>              </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680037978"><span class="annot"><a href="#local-6989586621680037978"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span id="local-6989586621680037979"><span class="annot"><a href="#local-6989586621680037979"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621680037977"><span class="annot"><a href="#local-6989586621680037977"><span class="hs-identifier hs-type">e</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680037979"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621680037979"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>                             </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Vector.VectorFamily.html#Vector"><span class="hs-identifier hs-type">Vector</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037979"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-comment">-- ^ starting direction of the sweep</span><span>
</span><span id="line-204"></span><span>                             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037979"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>                             </span><span class="hs-comment">-- ^ -- point indicating the last point to sweep to</span><span>
</span><span id="line-206"></span><span>                             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037979"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-comment">-- ^ the point form which we compute the visibility polgyon</span><span>
</span><span id="line-207"></span><span>                             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037978"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037979"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680037977"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-208"></span><span>                             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037979"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Definer"><span class="hs-identifier hs-type">Definer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037978"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037977"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037979"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-209"></span><span id="visibilitySweep"><span class="annot"><span class="annottext">visibilitySweep :: Vector 2 r
-&gt; Maybe (Point 2 r)
-&gt; Point 2 r
-&gt; [LineSegment 2 p r :+ e]
-&gt; [Point 2 r :+ Definer p e r]
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#visibilitySweep"><span class="hs-identifier hs-var hs-var">visibilitySweep</span></a></span></span><span> </span><span id="local-6989586621680037499"><span class="annot"><span class="annottext">sv :: Vector 2 r
</span><a href="#local-6989586621680037499"><span class="hs-identifier hs-var">sv</span></a></span></span><span> </span><span id="local-6989586621680037498"><span class="annot"><span class="annottext">mt :: Maybe (Point 2 r)
</span><a href="#local-6989586621680037498"><span class="hs-identifier hs-var">mt</span></a></span></span><span> </span><span id="local-6989586621680037497"><span class="annot"><span class="annottext">q :: Point 2 r
</span><a href="#local-6989586621680037497"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621680037496"><span class="annot"><span class="annottext">segs :: [LineSegment 2 p r :+ e]
</span><a href="#local-6989586621680037496"><span class="hs-identifier hs-var">segs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point 2 r
-&gt; Status p e r -&gt; [Event p e r] -&gt; [Point 2 r :+ Definer p e r]
forall (t :: * -&gt; *) r p e.
(Foldable t, Ord r, Fractional r) =&gt;
Point 2 r
-&gt; Status p e r -&gt; t (Event p e r) -&gt; [Point 2 r :+ Definer p e r]
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#sweep"><span class="hs-identifier hs-var">sweep</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037497"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Status p e r
</span><a href="#local-6989586621680037495"><span class="hs-identifier hs-var">statusStruct</span></a></span><span> </span><span class="annot"><span class="annottext">[Event p e r]
</span><a href="#local-6989586621680037494"><span class="hs-identifier hs-var">events</span></a></span><span>
</span><span id="line-210"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-211"></span><span>    </span><span class="hs-comment">-- lazily test if the segment intersects the initial ray</span><span>
</span><span id="line-212"></span><span>    </span><span id="local-6989586621680037493"><span class="annot"><span class="annottext">segs' :: [LineSegment 2 p r :+ (Maybe r, e)]
</span><a href="#local-6989586621680037493"><span class="hs-identifier hs-var hs-var">segs'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point 2 r
-&gt; HalfLine 2 r
-&gt; [LineSegment 2 p r :+ e]
-&gt; [LineSegment 2 p r :+ (Maybe r, e)]
forall r p b.
(Ord r, Fractional r) =&gt;
Point 2 r
-&gt; HalfLine 2 r
-&gt; [LineSegment 2 p r :+ b]
-&gt; [LineSegment 2 p r :+ (Maybe r, b)]
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#labelWithDistances"><span class="hs-identifier hs-var">labelWithDistances</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037497"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">HalfLine 2 r
</span><a href="#local-6989586621680037492"><span class="hs-identifier hs-var">initialRay</span></a></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r :+ e]
</span><a href="#local-6989586621680037496"><span class="hs-identifier hs-var">segs</span></a></span><span>
</span><span id="line-213"></span><span>    </span><span id="local-6989586621680037494"><span class="annot"><span class="annottext">events :: [Event p e r]
</span><a href="#local-6989586621680037494"><span class="hs-identifier hs-var hs-var">events</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point 2 r
-&gt; Vector 2 r
-&gt; ([Event p e r] -&gt; [Event p e r])
-&gt; [LineSegment 2 p r :+ (Maybe r, e)]
-&gt; [Event p e r]
forall r (t :: * -&gt; *) p1 e1 p2 e2.
(Ord r, Num r, Foldable t) =&gt;
Point 2 r
-&gt; Vector 2 r
-&gt; ([Event p1 e1 r] -&gt; [Event p2 e2 r])
-&gt; t (LineSegment 2 p1 r :+ (Maybe r, e1))
-&gt; [Event p2 e2 r]
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#computeEvents"><span class="hs-identifier hs-var">computeEvents</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037497"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Vector 2 r
</span><a href="#local-6989586621680037499"><span class="hs-identifier hs-var">sv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
-&gt; Vector 2 r
-&gt; Maybe (Point 2 r)
-&gt; [Event p e r]
-&gt; [Event p e r]
forall r a e.
(Ord r, Num r) =&gt;
Point 2 r
-&gt; Vector 2 r
-&gt; Maybe (Point 2 r)
-&gt; [Event a e r]
-&gt; [Event a e r]
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#untilEnd"><span class="hs-identifier hs-var">untilEnd</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037497"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Vector 2 r
</span><a href="#local-6989586621680037499"><span class="hs-identifier hs-var">sv</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Point 2 r)
</span><a href="#local-6989586621680037498"><span class="hs-identifier hs-var">mt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r :+ (Maybe r, e)]
</span><a href="#local-6989586621680037493"><span class="hs-identifier hs-var">segs'</span></a></span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span>    </span><span id="local-6989586621680037492"><span class="annot"><span class="annottext">initialRay :: HalfLine 2 r
</span><a href="#local-6989586621680037492"><span class="hs-identifier hs-var hs-var">initialRay</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Vector 2 r -&gt; HalfLine 2 r
forall (d :: Nat) r. Point d r -&gt; Vector d r -&gt; HalfLine d r
</span><a href="Data.Geometry.HalfLine.html#HalfLine"><span class="hs-identifier hs-var">HalfLine</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037497"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Vector 2 r
</span><a href="#local-6989586621680037499"><span class="hs-identifier hs-var">sv</span></a></span><span>
</span><span id="line-216"></span><span>    </span><span id="local-6989586621680037495"><span class="annot"><span class="annottext">statusStruct :: Status p e r
</span><a href="#local-6989586621680037495"><span class="hs-identifier hs-var hs-var">statusStruct</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r :+ (Maybe r, e)] -&gt; Status p e r
forall r p e.
(Ord r, Fractional r) =&gt;
[LineSegment 2 p r :+ (Maybe r, e)] -&gt; Status p e r
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#mkInitialSS"><span class="hs-identifier hs-var">mkInitialSS</span></a></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r :+ (Maybe r, e)]
</span><a href="#local-6989586621680037493"><span class="hs-identifier hs-var">segs'</span></a></span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span class="hs-comment">-- | Take until the ending point if defined. We can use that the list</span><span>
</span><span id="line-219"></span><span class="hs-comment">-- of events appears in sorted order in the cyclic orientation around</span><span>
</span><span id="line-220"></span><span class="hs-comment">-- the query point q</span><span>
</span><span id="line-221"></span><span id="local-6989586621680037879"><span id="local-6989586621680037880"><span id="local-6989586621680037881"><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#untilEnd"><span class="hs-identifier hs-type">untilEnd</span></a></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680037881"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621680037881"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>              </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037881"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-comment">-- ^ query point</span><span>
</span><span id="line-223"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Vector.VectorFamily.html#Vector"><span class="hs-identifier hs-type">Vector</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037881"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-comment">-- ^ starting direction</span><span>
</span><span id="line-224"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037881"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ possible ending point</span><span>
</span><span id="line-225"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037880"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037879"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037881"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037880"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037879"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037881"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-226"></span><span id="untilEnd"><span class="annot"><span class="annottext">untilEnd :: Point 2 r
-&gt; Vector 2 r
-&gt; Maybe (Point 2 r)
-&gt; [Event a e r]
-&gt; [Event a e r]
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#untilEnd"><span class="hs-identifier hs-var hs-var">untilEnd</span></a></span></span><span> </span><span id="local-6989586621680037491"><span class="annot"><span class="annottext">q :: Point 2 r
</span><a href="#local-6989586621680037491"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621680037490"><span class="annot"><span class="annottext">sv :: Vector 2 r
</span><a href="#local-6989586621680037490"><span class="hs-identifier hs-var">sv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-227"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Event a e r] -&gt; [Event a e r]
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-228"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680037488"><span class="annot"><span class="annottext">t :: Point 2 r
</span><a href="#local-6989586621680037488"><span class="hs-identifier hs-var">t</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Event a e r -&gt; Bool) -&gt; [Event a e r] -&gt; [Event a e r]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">List.takeWhile</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680037486"><span class="annot"><span class="annottext">e :: Event a e r
</span><a href="#local-6989586621680037486"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Vector 2 r
-&gt; (Point 2 r :+ ())
-&gt; (Point 2 r :+ a)
-&gt; (Point 2 r :+ ())
-&gt; Ordering
forall r c a b.
(Ord r, Num r) =&gt;
Vector 2 r
-&gt; (Point 2 r :+ c)
-&gt; (Point 2 r :+ a)
-&gt; (Point 2 r :+ b)
-&gt; Ordering
</span><a href="Data.Geometry.Point.Orientation.Degenerate.html#ccwCmpAroundWith%27"><span class="hs-identifier hs-var">ccwCmpAroundWith'</span></a></span><span> </span><span class="annot"><span class="annottext">Vector 2 r
</span><a href="#local-6989586621680037490"><span class="hs-identifier hs-var">sv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r :+ ()
forall a. a -&gt; a :+ ()
</span><span class="hs-identifier hs-var">ext</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037491"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Event a e r
</span><a href="#local-6989586621680037486"><span class="hs-identifier hs-var">e</span></a></span><span class="annot"><span class="annottext">Event a e r
-&gt; Getting (Point 2 r :+ a) (Event a e r) (Point 2 r :+ a)
-&gt; Point 2 r :+ a
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting (Point 2 r :+ a) (Event a e r) (Point 2 r :+ a)
forall p e r. Lens' (Event p e r) (Point 2 r :+ p)
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#eventVtx"><span class="hs-identifier hs-var">eventVtx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r :+ ()
forall a. a -&gt; a :+ ()
</span><span class="hs-identifier hs-var">ext</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037488"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ordering -&gt; Ordering -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">LT</span></span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span class="hs-comment">-- | Runs the actual sweep</span><span>
</span><span id="line-231"></span><span id="local-6989586621680037896"><span id="local-6989586621680037897"><span id="local-6989586621680037898"><span id="local-6989586621680037899"><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#sweep"><span class="hs-identifier hs-type">sweep</span></a></span><span>                </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621680037899"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680037898"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621680037898"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>                     </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037898"><span class="hs-identifier hs-type">r</span></a></span><span>    </span><span class="hs-comment">-- ^ query point</span><span>
</span><span id="line-233"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Status"><span class="hs-identifier hs-type">Status</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037897"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037896"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037898"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-comment">-- ^ initial status structure</span><span>
</span><span id="line-234"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680037899"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037897"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037896"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037898"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ events to handle</span><span>
</span><span id="line-235"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037898"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Definer"><span class="hs-identifier hs-type">Definer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037897"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037896"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037898"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span></span></span></span></span><span>
</span><span id="line-236"></span><span id="sweep"><span class="annot"><span class="annottext">sweep :: Point 2 r
-&gt; Status p e r -&gt; t (Event p e r) -&gt; [Point 2 r :+ Definer p e r]
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#sweep"><span class="hs-identifier hs-var hs-var">sweep</span></a></span></span><span> </span><span id="local-6989586621680037484"><span class="annot"><span class="annottext">q :: Point 2 r
</span><a href="#local-6989586621680037484"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621680037483"><span class="annot"><span class="annottext">statusStruct :: Status p e r
</span><a href="#local-6989586621680037483"><span class="hs-identifier hs-var">statusStruct</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Status p e r, [Point 2 r :+ Definer p e r])
-&gt; [Point 2 r :+ Definer p e r]
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((Status p e r, [Point 2 r :+ Definer p e r])
 -&gt; [Point 2 r :+ Definer p e r])
-&gt; (t (Event p e r)
    -&gt; (Status p e r, [Point 2 r :+ Definer p e r]))
-&gt; t (Event p e r)
-&gt; [Point 2 r :+ Definer p e r]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Status p e r, [Point 2 r :+ Definer p e r])
 -&gt; Event p e r -&gt; (Status p e r, [Point 2 r :+ Definer p e r]))
-&gt; (Status p e r, [Point 2 r :+ Definer p e r])
-&gt; t (Event p e r)
-&gt; (Status p e r, [Point 2 r :+ Definer p e r])
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">List.foldl'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
-&gt; (Status p e r, [Point 2 r :+ Definer p e r])
-&gt; Event p e r
-&gt; (Status p e r, [Point 2 r :+ Definer p e r])
forall r p e.
(Ord r, Fractional r) =&gt;
Point 2 r
-&gt; (Status p e r, [Point 2 r :+ Definer p e r])
-&gt; Event p e r
-&gt; (Status p e r, [Point 2 r :+ Definer p e r])
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#handleEvent"><span class="hs-identifier hs-var">handleEvent</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037484"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Status p e r
</span><a href="#local-6989586621680037483"><span class="hs-identifier hs-var">statusStruct</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span class="hs-comment">-- | Computes the events in the sweep</span><span>
</span><span id="line-240"></span><span id="local-6989586621680037882"><span id="local-6989586621680037883"><span id="local-6989586621680037884"><span id="local-6989586621680037885"><span id="local-6989586621680037886"><span id="local-6989586621680037887"><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#computeEvents"><span class="hs-identifier hs-type">computeEvents</span></a></span><span>                </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680037887"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621680037887"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621680037886"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>                             </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037887"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-comment">-- ^ query point</span><span>
</span><span id="line-242"></span><span>                             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Vector.VectorFamily.html#Vector"><span class="hs-identifier hs-type">Vector</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037887"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-comment">-- ^ starting direction</span><span>
</span><span id="line-243"></span><span>                             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037885"><span class="hs-identifier hs-type">p1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037884"><span class="hs-identifier hs-type">e1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037887"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037883"><span class="hs-identifier hs-type">p2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037882"><span class="hs-identifier hs-type">e2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037887"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ until where to take the vents</span><span>
</span><span id="line-244"></span><span>                             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680037886"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037885"><span class="hs-identifier hs-type">p1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037887"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621680037887"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680037884"><span class="hs-identifier hs-type">e1</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>                             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037883"><span class="hs-identifier hs-type">p2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037882"><span class="hs-identifier hs-type">e2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037887"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span></span></span></span></span></span></span><span>
</span><span id="line-246"></span><span id="computeEvents"><span class="annot"><span class="annottext">computeEvents :: Point 2 r
-&gt; Vector 2 r
-&gt; ([Event p1 e1 r] -&gt; [Event p2 e2 r])
-&gt; t (LineSegment 2 p1 r :+ (Maybe r, e1))
-&gt; [Event p2 e2 r]
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#computeEvents"><span class="hs-identifier hs-var hs-var">computeEvents</span></a></span></span><span> </span><span id="local-6989586621680037480"><span class="annot"><span class="annottext">q :: Point 2 r
</span><a href="#local-6989586621680037480"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621680037479"><span class="annot"><span class="annottext">sv :: Vector 2 r
</span><a href="#local-6989586621680037479"><span class="hs-identifier hs-var">sv</span></a></span></span><span> </span><span id="local-6989586621680037478"><span class="annot"><span class="annottext">takeUntil :: [Event p1 e1 r] -&gt; [Event p2 e2 r]
</span><a href="#local-6989586621680037478"><span class="hs-identifier hs-var">takeUntil</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-247"></span><span>     </span><span class="annot"><span class="annottext">(NonEmpty (Event p2 e2 r) -&gt; Event p2 e2 r)
-&gt; [NonEmpty (Event p2 e2 r)] -&gt; [Event p2 e2 r]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r -&gt; NonEmpty (Event p2 e2 r) -&gt; Event p2 e2 r
forall r p e.
(Ord r, Num r) =&gt;
Point 2 r -&gt; NonEmpty (Event p e r) -&gt; Event p e r
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#combine"><span class="hs-identifier hs-var">combine</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037480"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span>   </span><span class="annot"><span class="annottext">([NonEmpty (Event p2 e2 r)] -&gt; [Event p2 e2 r])
-&gt; (t (LineSegment 2 p1 r :+ (Maybe r, e1))
    -&gt; [NonEmpty (Event p2 e2 r)])
-&gt; t (LineSegment 2 p1 r :+ (Maybe r, e1))
-&gt; [Event p2 e2 r]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Event p2 e2 r -&gt; Event p2 e2 r -&gt; Ordering)
-&gt; [Event p2 e2 r] -&gt; [NonEmpty (Event p2 e2 r)]
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [NonEmpty a]
</span><span class="hs-identifier hs-var">List.groupBy'</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680037475"><span class="annot"><span class="annottext">a :: Event p2 e2 r
</span><a href="#local-6989586621680037475"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680037474"><span class="annot"><span class="annottext">b :: Event p2 e2 r
</span><a href="#local-6989586621680037474"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Vector 2 r
-&gt; (Point 2 r :+ ())
-&gt; (Point 2 r :+ p2)
-&gt; (Point 2 r :+ p2)
-&gt; Ordering
forall r c a b.
(Ord r, Num r) =&gt;
Vector 2 r
-&gt; (Point 2 r :+ c)
-&gt; (Point 2 r :+ a)
-&gt; (Point 2 r :+ b)
-&gt; Ordering
</span><a href="Data.Geometry.Point.Orientation.Degenerate.html#ccwCmpAroundWith%27"><span class="hs-identifier hs-var">ccwCmpAroundWith'</span></a></span><span> </span><span class="annot"><span class="annottext">Vector 2 r
</span><a href="#local-6989586621680037479"><span class="hs-identifier hs-var">sv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r :+ ()
forall a. a -&gt; a :+ ()
</span><span class="hs-identifier hs-var">ext</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037480"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Event p2 e2 r
</span><a href="#local-6989586621680037475"><span class="hs-identifier hs-var">a</span></a></span><span class="annot"><span class="annottext">Event p2 e2 r
-&gt; Getting (Point 2 r :+ p2) (Event p2 e2 r) (Point 2 r :+ p2)
-&gt; Point 2 r :+ p2
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting (Point 2 r :+ p2) (Event p2 e2 r) (Point 2 r :+ p2)
forall p e r. Lens' (Event p e r) (Point 2 r :+ p)
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#eventVtx"><span class="hs-identifier hs-var">eventVtx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Event p2 e2 r
</span><a href="#local-6989586621680037474"><span class="hs-identifier hs-var">b</span></a></span><span class="annot"><span class="annottext">Event p2 e2 r
-&gt; Getting (Point 2 r :+ p2) (Event p2 e2 r) (Point 2 r :+ p2)
-&gt; Point 2 r :+ p2
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting (Point 2 r :+ p2) (Event p2 e2 r) (Point 2 r :+ p2)
forall p e r. Lens' (Event p e r) (Point 2 r :+ p)
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#eventVtx"><span class="hs-identifier hs-var">eventVtx</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>   </span><span class="annot"><span class="annottext">([Event p2 e2 r] -&gt; [NonEmpty (Event p2 e2 r)])
-&gt; (t (LineSegment 2 p1 r :+ (Maybe r, e1)) -&gt; [Event p2 e2 r])
-&gt; t (LineSegment 2 p1 r :+ (Maybe r, e1))
-&gt; [NonEmpty (Event p2 e2 r)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Event p1 e1 r] -&gt; [Event p2 e2 r]
</span><a href="#local-6989586621680037478"><span class="hs-identifier hs-var">takeUntil</span></a></span><span>
</span><span id="line-250"></span><span>   </span><span class="annot"><span class="annottext">([Event p1 e1 r] -&gt; [Event p2 e2 r])
-&gt; (t (LineSegment 2 p1 r :+ (Maybe r, e1)) -&gt; [Event p1 e1 r])
-&gt; t (LineSegment 2 p1 r :+ (Maybe r, e1))
-&gt; [Event p2 e2 r]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Event p1 e1 r -&gt; Event p1 e1 r -&gt; Ordering)
-&gt; [Event p1 e1 r] -&gt; [Event p1 e1 r]
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">List.sortBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Point 2 r :+ p1) -&gt; (Point 2 r :+ p1) -&gt; Ordering
</span><a href="#local-6989586621680037472"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">((Point 2 r :+ p1) -&gt; (Point 2 r :+ p1) -&gt; Ordering)
-&gt; (Event p1 e1 r -&gt; Point 2 r :+ p1)
-&gt; Event p1 e1 r
-&gt; Event p1 e1 r
-&gt; Ordering
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Event p1 e1 r
-&gt; Getting (Point 2 r :+ p1) (Event p1 e1 r) (Point 2 r :+ p1)
-&gt; Point 2 r :+ p1
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting (Point 2 r :+ p1) (Event p1 e1 r) (Point 2 r :+ p1)
forall p e r. Lens' (Event p e r) (Point 2 r :+ p)
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#eventVtx"><span class="hs-identifier hs-var">eventVtx</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>   </span><span class="annot"><span class="annottext">([Event p1 e1 r] -&gt; [Event p1 e1 r])
-&gt; (t (LineSegment 2 p1 r :+ (Maybe r, e1)) -&gt; [Event p1 e1 r])
-&gt; t (LineSegment 2 p1 r :+ (Maybe r, e1))
-&gt; [Event p1 e1 r]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((LineSegment 2 p1 r :+ (Maybe r, e1)) -&gt; [Event p1 e1 r])
-&gt; t (LineSegment 2 p1 r :+ (Maybe r, e1)) -&gt; [Event p1 e1 r]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector 2 r
-&gt; Point 2 r
-&gt; (LineSegment 2 p1 r :+ (Maybe r, e1))
-&gt; [Event p1 e1 r]
forall r p e.
(Ord r, Num r) =&gt;
Vector 2 r
-&gt; Point 2 r
-&gt; (LineSegment 2 p r :+ (Maybe r, e))
-&gt; [Event p e r]
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#mkEvent"><span class="hs-identifier hs-var">mkEvent</span></a></span><span> </span><span class="annot"><span class="annottext">Vector 2 r
</span><a href="#local-6989586621680037479"><span class="hs-identifier hs-var">sv</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037480"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-253"></span><span>    </span><span id="local-6989586621680037472"><span class="annot"><span class="annottext">cmp :: (Point 2 r :+ p1) -&gt; (Point 2 r :+ p1) -&gt; Ordering
</span><a href="#local-6989586621680037472"><span class="hs-identifier hs-var hs-var">cmp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector 2 r
-&gt; (Point 2 r :+ ())
-&gt; (Point 2 r :+ p1)
-&gt; (Point 2 r :+ p1)
-&gt; Ordering
forall r c a b.
(Ord r, Num r) =&gt;
Vector 2 r
-&gt; (Point 2 r :+ c)
-&gt; (Point 2 r :+ a)
-&gt; (Point 2 r :+ b)
-&gt; Ordering
</span><a href="Data.Geometry.Point.Orientation.Degenerate.html#ccwCmpAroundWith%27"><span class="hs-identifier hs-var">ccwCmpAroundWith'</span></a></span><span> </span><span class="annot"><span class="annottext">Vector 2 r
</span><a href="#local-6989586621680037479"><span class="hs-identifier hs-var">sv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r :+ ()
forall a. a -&gt; a :+ ()
</span><span class="hs-identifier hs-var">ext</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037480"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Point 2 r :+ p1) -&gt; (Point 2 r :+ p1) -&gt; Ordering)
-&gt; ((Point 2 r :+ p1) -&gt; (Point 2 r :+ p1) -&gt; Ordering)
-&gt; (Point 2 r :+ p1)
-&gt; (Point 2 r :+ p1)
-&gt; Ordering
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Point 2 r :+ ())
-&gt; (Point 2 r :+ p1) -&gt; (Point 2 r :+ p1) -&gt; Ordering
forall r (d :: Nat) c p q.
(Ord r, Num r, Arity d) =&gt;
(Point d r :+ c)
-&gt; (Point d r :+ p) -&gt; (Point d r :+ q) -&gt; Ordering
</span><a href="Data.Geometry.Point.Internal.html#cmpByDistanceTo%27"><span class="hs-identifier hs-var">cmpByDistanceTo'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r :+ ()
forall a. a -&gt; a :+ ()
</span><span class="hs-identifier hs-var">ext</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037480"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>
</span><span id="line-255"></span><span class="hs-comment">-- | Given multiple events happening at the same orientation, combine</span><span>
</span><span id="line-256"></span><span class="hs-comment">-- them into a single event.</span><span>
</span><span id="line-257"></span><span id="local-6989586621680037820"><span id="local-6989586621680037821"><span id="local-6989586621680037822"><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#combine"><span class="hs-identifier hs-type">combine</span></a></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680037822"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621680037822"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037822"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037821"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037820"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037822"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037821"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037820"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037822"><span class="hs-identifier hs-type">r</span></a></span></span></span></span><span>
</span><span id="line-258"></span><span id="combine"><span class="annot"><span class="annottext">combine :: Point 2 r -&gt; NonEmpty (Event p e r) -&gt; Event p e r
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#combine"><span class="hs-identifier hs-var hs-var">combine</span></a></span></span><span> </span><span id="local-6989586621680037468"><span class="annot"><span class="annottext">q :: Point 2 r
</span><a href="#local-6989586621680037468"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621680037467"><span class="annot"><span class="annottext">es :: NonEmpty (Event p e r)
</span><a href="#local-6989586621680037467"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Point 2 r :+ p)
-&gt; NonEmpty (Action (LineSegment 2 p r :+ e)) -&gt; Event p e r
forall p e r.
(Point 2 r :+ p)
-&gt; NonEmpty (Action (LineSegment 2 p r :+ e)) -&gt; Event p e r
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Event"><span class="hs-identifier hs-var">Event</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680037466"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Action (LineSegment 2 p r :+ e))
</span><a href="#local-6989586621680037465"><span class="hs-identifier hs-var">acts</span></a></span><span>
</span><span id="line-259"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-260"></span><span>    </span><span id="local-6989586621680037465"><span class="annot"><span class="annottext">acts :: NonEmpty (Action (LineSegment 2 p r :+ e))
</span><a href="#local-6989586621680037465"><span class="hs-identifier hs-var hs-var">acts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Event p e r -&gt; NonEmpty (Action (LineSegment 2 p r :+ e)))
-&gt; NonEmpty (Event p e r)
-&gt; NonEmpty (Action (LineSegment 2 p r :+ e))
forall (t :: * -&gt; *) m a.
(Foldable1 t, Semigroup m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Event p e r
-&gt; Getting
     (NonEmpty (Action (LineSegment 2 p r :+ e)))
     (Event p e r)
     (NonEmpty (Action (LineSegment 2 p r :+ e)))
-&gt; NonEmpty (Action (LineSegment 2 p r :+ e))
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting
  (NonEmpty (Action (LineSegment 2 p r :+ e)))
  (Event p e r)
  (NonEmpty (Action (LineSegment 2 p r :+ e)))
forall p e r e.
Lens
  (Event p e r)
  (Event p e r)
  (NonEmpty (Action (LineSegment 2 p r :+ e)))
  (NonEmpty (Action (LineSegment 2 p r :+ e)))
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#actions"><span class="hs-identifier hs-var">actions</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty (Event p e r)
</span><a href="#local-6989586621680037467"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-261"></span><span>    </span><span id="local-6989586621680037466"><span class="annot"><span class="annottext">p :: Point 2 r :+ p
</span><a href="#local-6989586621680037466"><span class="hs-identifier hs-var hs-var">p</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Point 2 r :+ p) -&gt; (Point 2 r :+ p) -&gt; Ordering)
-&gt; NonEmpty (Point 2 r :+ p) -&gt; Point 2 r :+ p
forall (t :: * -&gt; *) a.
Foldable t =&gt;
(a -&gt; a -&gt; Ordering) -&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">F.minimumBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Point 2 r :+ ())
-&gt; (Point 2 r :+ p) -&gt; (Point 2 r :+ p) -&gt; Ordering
forall r (d :: Nat) c p q.
(Ord r, Num r, Arity d) =&gt;
(Point d r :+ c)
-&gt; (Point d r :+ p) -&gt; (Point d r :+ q) -&gt; Ordering
</span><a href="Data.Geometry.Point.Internal.html#cmpByDistanceTo%27"><span class="hs-identifier hs-var">cmpByDistanceTo'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r :+ ()
forall a. a -&gt; a :+ ()
</span><span class="hs-identifier hs-var">ext</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037468"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(NonEmpty (Point 2 r :+ p) -&gt; Point 2 r :+ p)
-&gt; (NonEmpty (Event p e r) -&gt; NonEmpty (Point 2 r :+ p))
-&gt; NonEmpty (Event p e r)
-&gt; Point 2 r :+ p
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Event p e r -&gt; Point 2 r :+ p)
-&gt; NonEmpty (Event p e r) -&gt; NonEmpty (Point 2 r :+ p)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Event p e r
-&gt; Getting (Point 2 r :+ p) (Event p e r) (Point 2 r :+ p)
-&gt; Point 2 r :+ p
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting (Point 2 r :+ p) (Event p e r) (Point 2 r :+ p)
forall p e r. Lens' (Event p e r) (Point 2 r :+ p)
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#eventVtx"><span class="hs-identifier hs-var">eventVtx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(NonEmpty (Event p e r) -&gt; Point 2 r :+ p)
-&gt; NonEmpty (Event p e r) -&gt; Point 2 r :+ p
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Event p e r)
</span><a href="#local-6989586621680037467"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span class="hs-comment">-- | Constructs the at most two events resulting from this segement.</span><span>
</span><span id="line-264"></span><span id="local-6989586621680037809"><span id="local-6989586621680037810"><span id="local-6989586621680037811"><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#mkEvent"><span class="hs-identifier hs-type">mkEvent</span></a></span><span>                                      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680037811"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621680037811"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span>                                             </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Vector.VectorFamily.html#Vector"><span class="hs-identifier hs-type">Vector</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037811"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-comment">-- ^ starting direction</span><span>
</span><span id="line-266"></span><span>                                             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037811"><span class="hs-identifier hs-type">r</span></a></span><span>  </span><span class="hs-comment">-- ^ query point</span><span>
</span><span id="line-267"></span><span>                                             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037810"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037811"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621680037811"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680037809"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>                                             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037810"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037809"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037811"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-269"></span><span id="mkEvent"><span class="annot"><span class="annottext">mkEvent :: Vector 2 r
-&gt; Point 2 r
-&gt; (LineSegment 2 p r :+ (Maybe r, e))
-&gt; [Event p e r]
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#mkEvent"><span class="hs-identifier hs-var hs-var">mkEvent</span></a></span></span><span> </span><span id="local-6989586621680037462"><span class="annot"><span class="annottext">sv :: Vector 2 r
</span><a href="#local-6989586621680037462"><span class="hs-identifier hs-var">sv</span></a></span></span><span> </span><span id="local-6989586621680037461"><span class="annot"><span class="annottext">q :: Point 2 r
</span><a href="#local-6989586621680037461"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680037460"><span class="annot"><span class="annottext">s :: LineSegment 2 p r
</span><a href="#local-6989586621680037460"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment%27"><span class="hs-identifier hs-type">LineSegment'</span></a></span><span> </span><span id="local-6989586621680037458"><span class="annot"><span class="annottext">u :: Point 2 r :+ p
</span><a href="#local-6989586621680037458"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621680037457"><span class="annot"><span class="annottext">v :: Point 2 r :+ p
</span><a href="#local-6989586621680037457"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680037456"><span class="annot"><span class="annottext">d :: Maybe r
</span><a href="#local-6989586621680037456"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680037455"><span class="annot"><span class="annottext">e :: e
</span><a href="#local-6989586621680037455"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Point 2 r :+ p) -&gt; (Point 2 r :+ p) -&gt; Ordering
</span><a href="#local-6989586621680037454"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680037458"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680037457"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-270"></span><span>                                                 </span><span class="annot"><span class="hs-identifier hs-type">LT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Point 2 r :+ p)
-&gt; NonEmpty (Action (LineSegment 2 p r :+ e)) -&gt; Event p e r
forall p e r.
(Point 2 r :+ p)
-&gt; NonEmpty (Action (LineSegment 2 p r :+ e)) -&gt; Event p e r
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Event"><span class="hs-identifier hs-var">Event</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680037458"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Action (LineSegment 2 p r :+ e))
</span><a href="#local-6989586621680037453"><span class="hs-identifier hs-var">insert</span></a></span><span>
</span><span id="line-271"></span><span>                                                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Point 2 r :+ p)
-&gt; NonEmpty (Action (LineSegment 2 p r :+ e)) -&gt; Event p e r
forall p e r.
(Point 2 r :+ p)
-&gt; NonEmpty (Action (LineSegment 2 p r :+ e)) -&gt; Event p e r
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Event"><span class="hs-identifier hs-var">Event</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680037457"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Action (LineSegment 2 p r :+ e))
</span><a href="#local-6989586621680037452"><span class="hs-identifier hs-var">delete</span></a></span><span>
</span><span id="line-272"></span><span>                                                       </span><span class="hs-special">]</span><span>
</span><span id="line-273"></span><span>                                                 </span><span class="annot"><span class="hs-identifier hs-type">GT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Point 2 r :+ p)
-&gt; NonEmpty (Action (LineSegment 2 p r :+ e)) -&gt; Event p e r
forall p e r.
(Point 2 r :+ p)
-&gt; NonEmpty (Action (LineSegment 2 p r :+ e)) -&gt; Event p e r
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Event"><span class="hs-identifier hs-var">Event</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680037457"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Action (LineSegment 2 p r :+ e))
</span><a href="#local-6989586621680037453"><span class="hs-identifier hs-var">insert</span></a></span><span>
</span><span id="line-274"></span><span>                                                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Point 2 r :+ p)
-&gt; NonEmpty (Action (LineSegment 2 p r :+ e)) -&gt; Event p e r
forall p e r.
(Point 2 r :+ p)
-&gt; NonEmpty (Action (LineSegment 2 p r :+ e)) -&gt; Event p e r
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Event"><span class="hs-identifier hs-var">Event</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680037458"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Action (LineSegment 2 p r :+ e))
</span><a href="#local-6989586621680037452"><span class="hs-identifier hs-var">delete</span></a></span><span>
</span><span id="line-275"></span><span>                                                       </span><span class="hs-special">]</span><span>
</span><span id="line-276"></span><span>                                                 </span><span class="annot"><span class="hs-identifier hs-type">EQ</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- zero length segment, just skip</span><span>
</span><span id="line-277"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-278"></span><span>    </span><span id="local-6989586621680037454"><span class="annot"><span class="annottext">cmp :: (Point 2 r :+ p) -&gt; (Point 2 r :+ p) -&gt; Ordering
</span><a href="#local-6989586621680037454"><span class="hs-identifier hs-var hs-var">cmp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector 2 r
-&gt; (Point 2 r :+ ())
-&gt; (Point 2 r :+ p)
-&gt; (Point 2 r :+ p)
-&gt; Ordering
forall r c a b.
(Ord r, Num r) =&gt;
Vector 2 r
-&gt; (Point 2 r :+ c)
-&gt; (Point 2 r :+ a)
-&gt; (Point 2 r :+ b)
-&gt; Ordering
</span><a href="Data.Geometry.Point.Orientation.Degenerate.html#ccwCmpAroundWith%27"><span class="hs-identifier hs-var">ccwCmpAroundWith'</span></a></span><span> </span><span class="annot"><span class="annottext">Vector 2 r
</span><a href="#local-6989586621680037462"><span class="hs-identifier hs-var">sv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r :+ ()
forall a. a -&gt; a :+ ()
</span><span class="hs-identifier hs-var">ext</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037461"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Point 2 r :+ p) -&gt; (Point 2 r :+ p) -&gt; Ordering)
-&gt; ((Point 2 r :+ p) -&gt; (Point 2 r :+ p) -&gt; Ordering)
-&gt; (Point 2 r :+ p)
-&gt; (Point 2 r :+ p)
-&gt; Ordering
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Point 2 r :+ ())
-&gt; (Point 2 r :+ p) -&gt; (Point 2 r :+ p) -&gt; Ordering
forall r (d :: Nat) c p q.
(Ord r, Num r, Arity d) =&gt;
(Point d r :+ c)
-&gt; (Point d r :+ p) -&gt; (Point d r :+ q) -&gt; Ordering
</span><a href="Data.Geometry.Point.Internal.html#cmpByDistanceTo%27"><span class="hs-identifier hs-var">cmpByDistanceTo'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r :+ ()
forall a. a -&gt; a :+ ()
</span><span class="hs-identifier hs-var">ext</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037461"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>    </span><span id="local-6989586621680037451"><span class="annot"><span class="annottext">s' :: LineSegment 2 p r :+ e
</span><a href="#local-6989586621680037451"><span class="hs-identifier hs-var hs-var">s'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621680037460"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r -&gt; e -&gt; LineSegment 2 p r :+ e
forall core extra. core -&gt; extra -&gt; core :+ extra
</span><span class="hs-operator hs-var">:+</span></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621680037455"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-280"></span><span>
</span><span id="line-281"></span><span>    </span><span id="local-6989586621680037453"><span class="annot"><span class="annottext">insert :: NonEmpty (Action (LineSegment 2 p r :+ e))
</span><a href="#local-6989586621680037453"><span class="hs-identifier hs-var hs-var">insert</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Maybe r -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe r
</span><a href="#local-6989586621680037456"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r :+ e) -&gt; Action (LineSegment 2 p r :+ e)
forall a. a -&gt; Action a
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Delete"><span class="hs-identifier hs-var">Delete</span></a></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r :+ e
</span><a href="#local-6989586621680037451"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r :+ e) -&gt; Action (LineSegment 2 p r :+ e)
forall a. a -&gt; Action a
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Insert"><span class="hs-identifier hs-var">Insert</span></a></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r :+ e
</span><a href="#local-6989586621680037451"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Action (LineSegment 2 p r :+ e)
-&gt; [Action (LineSegment 2 p r :+ e)]
-&gt; NonEmpty (Action (LineSegment 2 p r :+ e))
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-282"></span><span>    </span><span id="local-6989586621680037452"><span class="annot"><span class="annottext">delete :: NonEmpty (Action (LineSegment 2 p r :+ e))
</span><a href="#local-6989586621680037452"><span class="hs-identifier hs-var hs-var">delete</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Maybe r -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe r
</span><a href="#local-6989586621680037456"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r :+ e) -&gt; Action (LineSegment 2 p r :+ e)
forall a. a -&gt; Action a
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Insert"><span class="hs-identifier hs-var">Insert</span></a></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r :+ e
</span><a href="#local-6989586621680037451"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r :+ e) -&gt; Action (LineSegment 2 p r :+ e)
forall a. a -&gt; Action a
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Delete"><span class="hs-identifier hs-var">Delete</span></a></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r :+ e
</span><a href="#local-6989586621680037451"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Action (LineSegment 2 p r :+ e)
-&gt; [Action (LineSegment 2 p r :+ e)]
-&gt; NonEmpty (Action (LineSegment 2 p r :+ e))
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span>
</span><span id="line-285"></span><span class="hs-comment">-- | Handles an event, computes the new status structure and output polygon.</span><span>
</span><span id="line-286"></span><span id="local-6989586621680037829"><span id="local-6989586621680037830"><span id="local-6989586621680037831"><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#handleEvent"><span class="hs-identifier hs-type">handleEvent</span></a></span><span>                                  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680037831"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621680037831"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span>                                             </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037831"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-288"></span><span>                                             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Status"><span class="hs-identifier hs-type">Status</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037830"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037829"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037831"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037831"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Definer"><span class="hs-identifier hs-type">Definer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037830"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037829"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037831"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span>                                             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037830"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037829"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037831"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-290"></span><span>                                             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Status"><span class="hs-identifier hs-type">Status</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037830"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037829"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037831"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037831"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Definer"><span class="hs-identifier hs-type">Definer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037830"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037829"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037831"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-291"></span><span id="handleEvent"><span class="annot"><span class="annottext">handleEvent :: Point 2 r
-&gt; (Status p e r, [Point 2 r :+ Definer p e r])
-&gt; Event p e r
-&gt; (Status p e r, [Point 2 r :+ Definer p e r])
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#handleEvent"><span class="hs-identifier hs-var hs-var">handleEvent</span></a></span></span><span> </span><span id="local-6989586621680037450"><span class="annot"><span class="annottext">q :: Point 2 r
</span><a href="#local-6989586621680037450"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680037449"><span class="annot"><span class="annottext">ss :: Status p e r
</span><a href="#local-6989586621680037449"><span class="hs-identifier hs-var">ss</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680037448"><span class="annot"><span class="annottext">out :: [Point 2 r :+ Definer p e r]
</span><a href="#local-6989586621680037448"><span class="hs-identifier hs-var">out</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680037447"><span class="annot"><span class="annottext">p :: Point 2 r
</span><a href="#local-6989586621680037447"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span id="local-6989586621680037446"><span class="annot"><span class="annottext">z :: p
</span><a href="#local-6989586621680037446"><span class="hs-identifier hs-var">z</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680037445"><span class="annot"><span class="annottext">acts :: NonEmpty (Action (LineSegment 2 p r :+ e))
</span><a href="#local-6989586621680037445"><span class="hs-identifier hs-var">acts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Status p e r
</span><a href="#local-6989586621680037444"><span class="hs-identifier hs-var">ss'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Point 2 r :+ Definer p e r]
</span><a href="#local-6989586621680037443"><span class="hs-identifier hs-var">newVtx</span></a></span><span> </span><span class="annot"><span class="annottext">[Point 2 r :+ Definer p e r]
-&gt; [Point 2 r :+ Definer p e r] -&gt; [Point 2 r :+ Definer p e r]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Point 2 r :+ Definer p e r]
</span><a href="#local-6989586621680037448"><span class="hs-identifier hs-var">out</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-292"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-293"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680037442"><span class="annot"><span class="annottext">ins :: [LineSegment 2 p r :+ e]
</span><a href="#local-6989586621680037442"><span class="hs-identifier hs-var">ins</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680037441"><span class="annot"><span class="annottext">dels :: [LineSegment 2 p r :+ e]
</span><a href="#local-6989586621680037441"><span class="hs-identifier hs-var">dels</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Action (LineSegment 2 p r :+ e)] -&gt; [LineSegment 2 p r :+ e])
-&gt; ([Action (LineSegment 2 p r :+ e)] -&gt; [LineSegment 2 p r :+ e])
-&gt; ([Action (LineSegment 2 p r :+ e)],
    [Action (LineSegment 2 p r :+ e)])
-&gt; ([LineSegment 2 p r :+ e], [LineSegment 2 p r :+ e])
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Action (LineSegment 2 p r :+ e) -&gt; LineSegment 2 p r :+ e)
-&gt; [Action (LineSegment 2 p r :+ e)] -&gt; [LineSegment 2 p r :+ e]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Action (LineSegment 2 p r :+ e) -&gt; LineSegment 2 p r :+ e
forall a. Action a -&gt; a
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#extract"><span class="hs-identifier hs-var">extract</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Action (LineSegment 2 p r :+ e) -&gt; LineSegment 2 p r :+ e)
-&gt; [Action (LineSegment 2 p r :+ e)] -&gt; [LineSegment 2 p r :+ e]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Action (LineSegment 2 p r :+ e) -&gt; LineSegment 2 p r :+ e
forall a. Action a -&gt; a
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#extract"><span class="hs-identifier hs-var">extract</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(([Action (LineSegment 2 p r :+ e)],
  [Action (LineSegment 2 p r :+ e)])
 -&gt; ([LineSegment 2 p r :+ e], [LineSegment 2 p r :+ e]))
-&gt; (NonEmpty (Action (LineSegment 2 p r :+ e))
    -&gt; ([Action (LineSegment 2 p r :+ e)],
        [Action (LineSegment 2 p r :+ e)]))
-&gt; NonEmpty (Action (LineSegment 2 p r :+ e))
-&gt; ([LineSegment 2 p r :+ e], [LineSegment 2 p r :+ e])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Action (LineSegment 2 p r :+ e) -&gt; Bool)
-&gt; NonEmpty (Action (LineSegment 2 p r :+ e))
-&gt; ([Action (LineSegment 2 p r :+ e)],
    [Action (LineSegment 2 p r :+ e)])
forall a. (a -&gt; Bool) -&gt; NonEmpty a -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">NonEmpty.partition</span></span><span> </span><span class="annot"><span class="annottext">Action (LineSegment 2 p r :+ e) -&gt; Bool
forall a. Action a -&gt; Bool
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#isInsert"><span class="hs-identifier hs-var">isInsert</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (Action (LineSegment 2 p r :+ e))
 -&gt; ([LineSegment 2 p r :+ e], [LineSegment 2 p r :+ e]))
-&gt; NonEmpty (Action (LineSegment 2 p r :+ e))
-&gt; ([LineSegment 2 p r :+ e], [LineSegment 2 p r :+ e])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Action (LineSegment 2 p r :+ e))
</span><a href="#local-6989586621680037445"><span class="hs-identifier hs-var">acts</span></a></span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span>    </span><span id="local-6989586621680037444"><span class="annot"><span class="annottext">ss' :: Status p e r
</span><a href="#local-6989586621680037444"><span class="hs-identifier hs-var hs-var">ss'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Status p e r -&gt; [LineSegment 2 p r :+ e] -&gt; Status p e r)
-&gt; [LineSegment 2 p r :+ e] -&gt; Status p e r -&gt; Status p e r
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((LineSegment 2 p r :+ e) -&gt; Status p e r -&gt; Status p e r)
-&gt; Status p e r -&gt; [LineSegment 2 p r :+ e] -&gt; Status p e r
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
-&gt; Point 2 r
-&gt; (LineSegment 2 p r :+ e)
-&gt; Status p e r
-&gt; Status p e r
forall r p e.
(Ord r, Fractional r) =&gt;
Point 2 r
-&gt; Point 2 r
-&gt; (LineSegment 2 p r :+ e)
-&gt; Status p e r
-&gt; Status p e r
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#insertAt"><span class="hs-identifier hs-var">insertAt</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037450"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037447"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r :+ e]
</span><a href="#local-6989586621680037442"><span class="hs-identifier hs-var">ins</span></a></span><span>
</span><span id="line-296"></span><span>        </span><span class="annot"><span class="annottext">(Status p e r -&gt; Status p e r)
-&gt; (Status p e r -&gt; Status p e r) -&gt; Status p e r -&gt; Status p e r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Status p e r -&gt; [LineSegment 2 p r :+ e] -&gt; Status p e r)
-&gt; [LineSegment 2 p r :+ e] -&gt; Status p e r -&gt; Status p e r
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((LineSegment 2 p r :+ e) -&gt; Status p e r -&gt; Status p e r)
-&gt; Status p e r -&gt; [LineSegment 2 p r :+ e] -&gt; Status p e r
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
-&gt; Point 2 r
-&gt; (LineSegment 2 p r :+ e)
-&gt; Status p e r
-&gt; Status p e r
forall r p e.
(Ord r, Fractional r) =&gt;
Point 2 r
-&gt; Point 2 r
-&gt; (LineSegment 2 p r :+ e)
-&gt; Status p e r
-&gt; Status p e r
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#deleteAt"><span class="hs-identifier hs-var">deleteAt</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037450"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037447"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r :+ e]
</span><a href="#local-6989586621680037441"><span class="hs-identifier hs-var">dels</span></a></span><span>
</span><span id="line-297"></span><span>        </span><span class="annot"><span class="annottext">(Status p e r -&gt; Status p e r) -&gt; Status p e r -&gt; Status p e r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Status p e r
</span><a href="#local-6989586621680037449"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span>    </span><span id="local-6989586621680037443"><span class="annot"><span class="annottext">newVtx :: [Point 2 r :+ Definer p e r]
</span><a href="#local-6989586621680037443"><span class="hs-identifier hs-var hs-var">newVtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680037434"><span class="annot"><span class="annottext">a :: Point 2 r
</span><a href="#local-6989586621680037434"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span id="local-6989586621680037433"><span class="annot"><span class="annottext">sa :: LineSegment 2 p r :+ e
</span><a href="#local-6989586621680037433"><span class="hs-identifier hs-var">sa</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point 2 r
-&gt; Point 2 r
-&gt; Status p e r
-&gt; Point 2 r :+ (LineSegment 2 p r :+ e)
forall p r e.
(Ord r, Fractional r) =&gt;
Point 2 r
-&gt; Point 2 r
-&gt; Status p e r
-&gt; Point 2 r :+ (LineSegment 2 p r :+ e)
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#firstHitAt%27"><span class="hs-identifier hs-var">firstHitAt'</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037450"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037447"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Status p e r
</span><a href="#local-6989586621680037449"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-300"></span><span>                 </span><span class="hs-special">(</span><span id="local-6989586621680037431"><span class="annot"><span class="annottext">b :: Point 2 r
</span><a href="#local-6989586621680037431"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span id="local-6989586621680037430"><span class="annot"><span class="annottext">sb :: LineSegment 2 p r :+ e
</span><a href="#local-6989586621680037430"><span class="hs-identifier hs-var">sb</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point 2 r
-&gt; Point 2 r
-&gt; Status p e r
-&gt; Point 2 r :+ (LineSegment 2 p r :+ e)
forall p r e.
(Ord r, Fractional r) =&gt;
Point 2 r
-&gt; Point 2 r
-&gt; Status p e r
-&gt; Point 2 r :+ (LineSegment 2 p r :+ e)
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#firstHitAt%27"><span class="hs-identifier hs-var">firstHitAt'</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037450"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037447"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Status p e r
</span><a href="#local-6989586621680037444"><span class="hs-identifier hs-var">ss'</span></a></span><span>
</span><span id="line-301"></span><span>                 </span><span id="local-6989586621680037429"><span class="annot"><span class="annottext">ae :: p
</span><a href="#local-6989586621680037429"><span class="hs-identifier hs-var hs-var">ae</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; (LineSegment 2 p r :+ e) -&gt; p
forall (d :: Nat) r p extra.
(ImplicitPeano (Peano d), Eq r,
 ArityPeano (Peano (FromPeano (Peano d))),
 KnownNat (FromPeano (Peano d)), KnownNat d,
 Peano (FromPeano (Peano d) + 1)
 ~ 'S (Peano (FromPeano (Peano d)))) =&gt;
Point d r -&gt; (LineSegment d p r :+ extra) -&gt; p
</span><a href="#local-6989586621680037428"><span class="hs-identifier hs-var">valOf</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037434"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r :+ e
</span><a href="#local-6989586621680037433"><span class="hs-identifier hs-var">sa</span></a></span><span>
</span><span id="line-302"></span><span>                 </span><span id="local-6989586621680037427"><span class="annot"><span class="annottext">be :: p
</span><a href="#local-6989586621680037427"><span class="hs-identifier hs-var hs-var">be</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; (LineSegment 2 p r :+ e) -&gt; p
forall (d :: Nat) r p extra.
(ImplicitPeano (Peano d), Eq r,
 ArityPeano (Peano (FromPeano (Peano d))),
 KnownNat (FromPeano (Peano d)), KnownNat d,
 Peano (FromPeano (Peano d) + 1)
 ~ 'S (Peano (FromPeano (Peano d)))) =&gt;
Point d r -&gt; (LineSegment d p r :+ extra) -&gt; p
</span><a href="#local-6989586621680037428"><span class="hs-identifier hs-var">valOf</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037431"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r :+ e
</span><a href="#local-6989586621680037430"><span class="hs-identifier hs-var">sb</span></a></span><span>
</span><span id="line-303"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037434"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037431"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037434"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037447"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-304"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- new window of the output polygon discovered</span><span>
</span><span id="line-305"></span><span>                                   </span><span class="hs-comment">-- figure out who is the closest vertex, (the reflex vtx)</span><span>
</span><span id="line-306"></span><span>                                   </span><span class="hs-comment">-- and add the appropriate two vertices</span><span>
</span><span id="line-307"></span><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; r
forall r (d :: Nat).
(Num r, Arity d) =&gt;
Point d r -&gt; Point d r -&gt; r
</span><a href="Data.Geometry.Point.Internal.html#squaredEuclideanDist"><span class="hs-identifier hs-var">squaredEuclideanDist</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037450"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037434"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">r -&gt; r -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; r
forall r (d :: Nat).
(Num r, Arity d) =&gt;
Point d r -&gt; Point d r -&gt; r
</span><a href="Data.Geometry.Point.Internal.html#squaredEuclideanDist"><span class="hs-identifier hs-var">squaredEuclideanDist</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037450"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037431"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-308"></span><span>                      </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037431"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Definer p e r -&gt; Point 2 r :+ Definer p e r
forall core extra. core -&gt; extra -&gt; core :+ extra
</span><span class="hs-operator hs-var">:+</span></span><span> </span><span class="annot"><span class="annottext">(Point 2 r :+ p, LineSegment 2 p r :+ e) -&gt; Definer p e r
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037434"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; p -&gt; Point 2 r :+ p
forall core extra. core -&gt; extra -&gt; core :+ extra
</span><span class="hs-operator hs-var">:+</span></span><span> </span><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621680037429"><span class="hs-identifier hs-var">ae</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r :+ e
</span><a href="#local-6989586621680037430"><span class="hs-identifier hs-var">sb</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037434"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Definer p e r -&gt; Point 2 r :+ Definer p e r
forall core extra. core -&gt; extra -&gt; core :+ extra
</span><span class="hs-operator hs-var">:+</span></span><span> </span><span class="annot"><span class="annottext">p -&gt; Definer p e r
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span>  </span><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621680037429"><span class="hs-identifier hs-var">ae</span></a></span><span>  </span><span class="hs-comment">-- a must be a vertex!</span><span>
</span><span id="line-310"></span><span>                               </span><span class="hs-special">]</span><span>
</span><span id="line-311"></span><span>                      </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037431"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Definer p e r -&gt; Point 2 r :+ Definer p e r
forall core extra. core -&gt; extra -&gt; core :+ extra
</span><span class="hs-operator hs-var">:+</span></span><span> </span><span class="annot"><span class="annottext">p -&gt; Definer p e r
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span>  </span><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621680037427"><span class="hs-identifier hs-var">be</span></a></span><span>
</span><span id="line-312"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037434"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Definer p e r -&gt; Point 2 r :+ Definer p e r
forall core extra. core -&gt; extra -&gt; core :+ extra
</span><span class="hs-operator hs-var">:+</span></span><span> </span><span class="annot"><span class="annottext">(Point 2 r :+ p, LineSegment 2 p r :+ e) -&gt; Definer p e r
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037431"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; p -&gt; Point 2 r :+ p
forall core extra. core -&gt; extra -&gt; core :+ extra
</span><span class="hs-operator hs-var">:+</span></span><span> </span><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621680037427"><span class="hs-identifier hs-var">be</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r :+ e
</span><a href="#local-6989586621680037433"><span class="hs-identifier hs-var">sa</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>                               </span><span class="hs-special">]</span><span>
</span><span id="line-314"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037447"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Definer p e r -&gt; Point 2 r :+ Definer p e r
forall core extra. core -&gt; extra -&gt; core :+ extra
</span><span class="hs-operator hs-var">:+</span></span><span> </span><span class="annot"><span class="annottext">p -&gt; Definer p e r
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621680037446"><span class="hs-identifier hs-var">z</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-315"></span><span>                    </span><span class="hs-comment">-- sweeping over a regular vertex of the visibility polygon</span><span>
</span><span id="line-316"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- sweeping over a vertex not in output</span><span>
</span><span id="line-317"></span><span>
</span><span id="line-318"></span><span>    </span><span id="local-6989586621680037428"><span class="annot"><span class="annottext">valOf :: Point d r -&gt; (LineSegment d p r :+ extra) -&gt; p
</span><a href="#local-6989586621680037428"><span class="hs-identifier hs-var hs-var">valOf</span></a></span></span><span> </span><span id="local-6989586621680037423"><span class="annot"><span class="annottext">a :: Point d r
</span><a href="#local-6989586621680037423"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment%27"><span class="hs-identifier hs-type">LineSegment'</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680037422"><span class="annot"><span class="annottext">b :: Point d r
</span><a href="#local-6989586621680037422"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span id="local-6989586621680037421"><span class="annot"><span class="annottext">be :: p
</span><a href="#local-6989586621680037421"><span class="hs-identifier hs-var">be</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span id="local-6989586621680037420"><span class="annot"><span class="annottext">ce :: p
</span><a href="#local-6989586621680037420"><span class="hs-identifier hs-var">ce</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Point d r
</span><a href="#local-6989586621680037423"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Point d r -&gt; Point d r -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Point d r
</span><a href="#local-6989586621680037422"><span class="hs-identifier hs-var">b</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621680037421"><span class="hs-identifier hs-var">be</span></a></span><span>
</span><span id="line-319"></span><span>                                                     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621680037420"><span class="hs-identifier hs-var">ce</span></a></span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-324"></span><span>
</span><span id="line-325"></span><span class="hs-comment">-- | Given two points q and p, and a status structure retrieve the</span><span>
</span><span id="line-326"></span><span class="hs-comment">-- first segment in the status structure intersected by the ray from q</span><span>
</span><span id="line-327"></span><span class="hs-comment">-- through p.</span><span>
</span><span id="line-328"></span><span class="hs-comment">--</span><span>
</span><span id="line-329"></span><span class="hs-comment">-- pre: all segments in the status structure should intersect the ray</span><span>
</span><span id="line-330"></span><span class="hs-comment">--      from q through p (in a point), in that order.</span><span>
</span><span id="line-331"></span><span class="hs-comment">--</span><span>
</span><span id="line-332"></span><span class="hs-comment">-- running time: \(O(\log n)\)</span><span>
</span><span id="line-333"></span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#firstHitAt"><span class="hs-identifier hs-type">firstHitAt</span></a></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680037711"><span class="annot"><a href="#local-6989586621680037711"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span id="local-6989586621680037712"><span class="annot"><a href="#local-6989586621680037712"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621680037710"><span class="annot"><a href="#local-6989586621680037710"><span class="hs-identifier hs-type">e</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680037712"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621680037712"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span>               </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037712"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037712"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-335"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Status"><span class="hs-identifier hs-type">Status</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037711"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037710"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037712"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-336"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037712"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037711"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037712"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680037710"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span id="firstHitAt"><span class="annot"><span class="annottext">firstHitAt :: Point 2 r
-&gt; Point 2 r
-&gt; Status p e r
-&gt; Maybe (Point 2 r :+ (LineSegment 2 p r :+ e))
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#firstHitAt"><span class="hs-identifier hs-var hs-var">firstHitAt</span></a></span></span><span> </span><span id="local-6989586621680037418"><span class="annot"><span class="annottext">q :: Point 2 r
</span><a href="#local-6989586621680037418"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621680037417"><span class="annot"><span class="annottext">p :: Point 2 r
</span><a href="#local-6989586621680037417"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r :+ e)
-&gt; Maybe (Point 2 r :+ (LineSegment 2 p r :+ e))
</span><a href="#local-6989586621680037416"><span class="hs-identifier hs-var">computeIntersectionPoint</span></a></span><span> </span><span class="annot"><span class="annottext">((LineSegment 2 p r :+ e)
 -&gt; Maybe (Point 2 r :+ (LineSegment 2 p r :+ e)))
-&gt; (Status p e r -&gt; Maybe (LineSegment 2 p r :+ e))
-&gt; Status p e r
-&gt; Maybe (Point 2 r :+ (LineSegment 2 p r :+ e))
forall (m :: * -&gt; *) b c a.
Monad m =&gt;
(b -&gt; m c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&lt;=&lt;</span></span><span> </span><span class="annot"><span class="annottext">Status p e r -&gt; Maybe (LineSegment 2 p r :+ e)
forall a. Set a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Set.lookupMin</span></span><span>
</span><span id="line-338"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-339"></span><span>    </span><span id="local-6989586621680037416"><span class="annot"><span class="annottext">computeIntersectionPoint :: (LineSegment 2 p r :+ e)
-&gt; Maybe (Point 2 r :+ (LineSegment 2 p r :+ e))
</span><a href="#local-6989586621680037416"><span class="hs-identifier hs-var hs-var">computeIntersectionPoint</span></a></span></span><span> </span><span id="local-6989586621680037414"><span class="annot"><span class="annottext">s :: LineSegment 2 p r :+ e
</span><a href="#local-6989586621680037414"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Point 2 r -&gt; Point 2 r :+ (LineSegment 2 p r :+ e))
-&gt; Maybe (Point 2 r)
-&gt; Maybe (Point 2 r :+ (LineSegment 2 p r :+ e))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
-&gt; (LineSegment 2 p r :+ e)
-&gt; Point 2 r :+ (LineSegment 2 p r :+ e)
forall core extra. core -&gt; extra -&gt; core :+ extra
</span><span class="hs-operator hs-var">:+</span></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r :+ e
</span><a href="#local-6989586621680037414"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (Point 2 r)
 -&gt; Maybe (Point 2 r :+ (LineSegment 2 p r :+ e)))
-&gt; (CoRec Identity '[NoIntersection, Point 2 r, Line 2 r]
    -&gt; Maybe (Point 2 r))
-&gt; CoRec Identity '[NoIntersection, Point 2 r, Line 2 r]
-&gt; Maybe (Point 2 r :+ (LineSegment 2 p r :+ e))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (ts :: [*]).
NatToInt (RIndex (Point 2 r) ts) =&gt;
CoRec Identity ts -&gt; Maybe (Point 2 r)
forall t (ts :: [*]).
NatToInt (RIndex t ts) =&gt;
CoRec Identity ts -&gt; Maybe t
</span><span class="hs-identifier hs-var">asA</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037712"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-340"></span><span>                               </span><span class="annot"><span class="annottext">(CoRec Identity '[NoIntersection, Point 2 r, Line 2 r]
 -&gt; Maybe (Point 2 r :+ (LineSegment 2 p r :+ e)))
-&gt; CoRec Identity '[NoIntersection, Point 2 r, Line 2 r]
-&gt; Maybe (Point 2 r :+ (LineSegment 2 p r :+ e))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r
-&gt; Line
     (Dimension (LineSegment 2 p r)) (NumType (LineSegment 2 p r))
forall t.
HasSupportingLine t =&gt;
t -&gt; Line (Dimension t) (NumType t)
</span><a href="Data.Geometry.Line.Internal.html#supportingLine"><span class="hs-identifier hs-var">supportingLine</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LineSegment 2 p r :+ e
</span><a href="#local-6989586621680037414"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">(LineSegment 2 p r :+ e)
-&gt; Getting
     (LineSegment 2 p r) (LineSegment 2 p r :+ e) (LineSegment 2 p r)
-&gt; LineSegment 2 p r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting
  (LineSegment 2 p r) (LineSegment 2 p r :+ e) (LineSegment 2 p r)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Line 2 r -&gt; Line 2 r -&gt; Intersection (Line 2 r) (Line 2 r)
forall g h. IsIntersectableWith g h =&gt; g -&gt; h -&gt; Intersection g h
</span><span class="hs-operator hs-var">`intersect`</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; Line 2 r
forall r (d :: Nat).
(Num r, Arity d) =&gt;
Point d r -&gt; Point d r -&gt; Line d r
</span><a href="Data.Geometry.Line.Internal.html#lineThrough"><span class="hs-identifier hs-var">lineThrough</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037417"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037418"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-341"></span><span>
</span><span id="line-342"></span><span class="hs-comment">-- | Given two points q and p, and a status structure retrieve the</span><span>
</span><span id="line-343"></span><span class="hs-comment">-- first segment in the status structure intersected by the ray from q</span><span>
</span><span id="line-344"></span><span class="hs-comment">-- through p.</span><span>
</span><span id="line-345"></span><span class="hs-comment">--</span><span>
</span><span id="line-346"></span><span class="hs-comment">-- pre: - all segments in the status structure should intersect the ray</span><span>
</span><span id="line-347"></span><span class="hs-comment">--        from q through p (in a point), in that order.</span><span>
</span><span id="line-348"></span><span class="hs-comment">--      - the status structure is non-empty</span><span>
</span><span id="line-349"></span><span class="hs-comment">--</span><span>
</span><span id="line-350"></span><span class="hs-comment">-- running time: \(O(\log n)\)</span><span>
</span><span id="line-351"></span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#firstHitAt%27"><span class="hs-identifier hs-type">firstHitAt'</span></a></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680037761"><span class="annot"><a href="#local-6989586621680037761"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span id="local-6989586621680037762"><span class="annot"><a href="#local-6989586621680037762"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621680037760"><span class="annot"><a href="#local-6989586621680037760"><span class="hs-identifier hs-type">e</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680037762"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621680037762"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span>                  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037762"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037762"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-353"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Status"><span class="hs-identifier hs-type">Status</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037761"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037760"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037762"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-354"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037762"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037761"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037762"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680037760"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-355"></span><span id="firstHitAt%27"><span class="annot"><span class="annottext">firstHitAt' :: Point 2 r
-&gt; Point 2 r
-&gt; Status p e r
-&gt; Point 2 r :+ (LineSegment 2 p r :+ e)
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#firstHitAt%27"><span class="hs-identifier hs-var hs-var">firstHitAt'</span></a></span></span><span> </span><span id="local-6989586621680037408"><span class="annot"><span class="annottext">q :: Point 2 r
</span><a href="#local-6989586621680037408"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621680037407"><span class="annot"><span class="annottext">p :: Point 2 r
</span><a href="#local-6989586621680037407"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621680037406"><span class="annot"><span class="annottext">s :: Status p e r
</span><a href="#local-6989586621680037406"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Point 2 r
-&gt; Point 2 r
-&gt; Status p e r
-&gt; Maybe (Point 2 r :+ (LineSegment 2 p r :+ e))
forall p r e.
(Ord r, Fractional r) =&gt;
Point 2 r
-&gt; Point 2 r
-&gt; Status p e r
-&gt; Maybe (Point 2 r :+ (LineSegment 2 p r :+ e))
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#firstHitAt"><span class="hs-identifier hs-var">firstHitAt</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037408"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037407"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Status p e r
</span><a href="#local-6989586621680037406"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-356"></span><span>                      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680037405"><span class="annot"><span class="annottext">x :: Point 2 r :+ (LineSegment 2 p r :+ e)
</span><a href="#local-6989586621680037405"><span class="hs-identifier hs-var">x</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ (LineSegment 2 p r :+ e)
</span><a href="#local-6989586621680037405"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-357"></span><span>                      </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Point 2 r :+ (LineSegment 2 p r :+ e)
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="hs-string">&quot;firstHitAt: precondition failed!&quot;</span></span><span>
</span><span id="line-358"></span><span>
</span><span id="line-359"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-360"></span><span class="hs-comment">-- * Status Structure Operations</span><span>
</span><span id="line-361"></span><span>
</span><span id="line-362"></span><span class="hs-comment">-- | Insert a new segment into the status structure, depending on the</span><span>
</span><span id="line-363"></span><span class="hs-comment">-- (distance from q to to the) intersection point with the ray from q</span><span>
</span><span id="line-364"></span><span class="hs-comment">-- through p</span><span>
</span><span id="line-365"></span><span class="hs-comment">--</span><span>
</span><span id="line-366"></span><span class="hs-comment">-- pre: all segments in the status structure should intersect the ray</span><span>
</span><span id="line-367"></span><span class="hs-comment">--      from q through p, in that order.</span><span>
</span><span id="line-368"></span><span class="hs-comment">--</span><span>
</span><span id="line-369"></span><span class="hs-comment">-- \(O(\log n)\)</span><span>
</span><span id="line-370"></span><span id="local-6989586621680037763"><span id="local-6989586621680037764"><span id="local-6989586621680037765"><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#insertAt"><span class="hs-identifier hs-type">insertAt</span></a></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680037765"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621680037765"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-371"></span><span>             </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037765"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037765"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037764"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037765"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680037763"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-372"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Status"><span class="hs-identifier hs-type">Status</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037764"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037763"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037765"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Status"><span class="hs-identifier hs-type">Status</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037764"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037763"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037765"><span class="hs-identifier hs-type">r</span></a></span></span></span></span><span>
</span><span id="line-373"></span><span id="insertAt"><span class="annot"><span class="annottext">insertAt :: Point 2 r
-&gt; Point 2 r
-&gt; (LineSegment 2 p r :+ e)
-&gt; Status p e r
-&gt; Status p e r
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#insertAt"><span class="hs-identifier hs-var hs-var">insertAt</span></a></span></span><span> </span><span id="local-6989586621680037403"><span class="annot"><span class="annottext">q :: Point 2 r
</span><a href="#local-6989586621680037403"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621680037402"><span class="annot"><span class="annottext">p :: Point 2 r
</span><a href="#local-6989586621680037402"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((LineSegment 2 p r :+ e) -&gt; (LineSegment 2 p r :+ e) -&gt; Ordering)
-&gt; (LineSegment 2 p r :+ e) -&gt; Status p e r -&gt; Status p e r
forall a. (a -&gt; a -&gt; Ordering) -&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.insertBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
-&gt; Point 2 r
-&gt; (LineSegment 2 p r :+ e)
-&gt; (LineSegment 2 p r :+ e)
-&gt; Ordering
forall p r e.
(Ord r, Fractional r) =&gt;
Point 2 r
-&gt; Point 2 r
-&gt; (LineSegment 2 p r :+ e)
-&gt; (LineSegment 2 p r :+ e)
-&gt; Ordering
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#compareByDistanceToAt"><span class="hs-identifier hs-var">compareByDistanceToAt</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037403"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037402"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">((LineSegment 2 p r :+ e) -&gt; (LineSegment 2 p r :+ e) -&gt; Ordering)
-&gt; ((LineSegment 2 p r :+ e)
    -&gt; (LineSegment 2 p r :+ e) -&gt; Ordering)
-&gt; (LineSegment 2 p r :+ e)
-&gt; (LineSegment 2 p r :+ e)
-&gt; Ordering
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">((LineSegment 2 p r :+ e) -&gt; (LineSegment 2 p r :+ e) -&gt; Ordering)
-&gt; (LineSegment 2 p r :+ e) -&gt; (LineSegment 2 p r :+ e) -&gt; Ordering
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
-&gt; (LineSegment 2 p r :+ e) -&gt; (LineSegment 2 p r :+ e) -&gt; Ordering
forall p r e.
(Ord r, Fractional r) =&gt;
Point 2 r
-&gt; (LineSegment 2 p r :+ e) -&gt; (LineSegment 2 p r :+ e) -&gt; Ordering
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#compareAroundEndPoint"><span class="hs-identifier hs-var">compareAroundEndPoint</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037403"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-374"></span><span>  </span><span class="hs-comment">-- if two segments have the same distance, they must share and endpoint</span><span>
</span><span id="line-375"></span><span>  </span><span class="hs-comment">-- so we use the CCW ordering around this common endpoint to determine</span><span>
</span><span id="line-376"></span><span>  </span><span class="hs-comment">-- the order.</span><span>
</span><span id="line-377"></span><span>
</span><span id="line-378"></span><span class="hs-comment">-- | Delete a segment from the status structure, depending on the</span><span>
</span><span id="line-379"></span><span class="hs-comment">-- (distance from q to to the) intersection point with the ray from q</span><span>
</span><span id="line-380"></span><span class="hs-comment">-- through p</span><span>
</span><span id="line-381"></span><span class="hs-comment">--</span><span>
</span><span id="line-382"></span><span class="hs-comment">-- pre: all segments in the status structure should intersect the ray</span><span>
</span><span id="line-383"></span><span class="hs-comment">--      from q through p, in that order.</span><span>
</span><span id="line-384"></span><span class="hs-comment">--</span><span>
</span><span id="line-385"></span><span class="hs-comment">-- \(O(\log n)\)</span><span>
</span><span id="line-386"></span><span id="local-6989586621680037397"><span id="local-6989586621680037398"><span id="local-6989586621680037399"><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#deleteAt"><span class="hs-identifier hs-type">deleteAt</span></a></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680037399"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621680037399"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-387"></span><span>             </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037399"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037399"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037398"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037399"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680037397"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-388"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Status"><span class="hs-identifier hs-type">Status</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037398"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037397"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037399"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Status"><span class="hs-identifier hs-type">Status</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037398"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037397"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037399"><span class="hs-identifier hs-type">r</span></a></span></span></span></span><span>
</span><span id="line-389"></span><span id="deleteAt"><span class="annot"><span class="annottext">deleteAt :: Point 2 r
-&gt; Point 2 r
-&gt; (LineSegment 2 p r :+ e)
-&gt; Status p e r
-&gt; Status p e r
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#deleteAt"><span class="hs-identifier hs-var hs-var">deleteAt</span></a></span></span><span> </span><span id="local-6989586621680037396"><span class="annot"><span class="annottext">q :: Point 2 r
</span><a href="#local-6989586621680037396"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621680037395"><span class="annot"><span class="annottext">p :: Point 2 r
</span><a href="#local-6989586621680037395"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((LineSegment 2 p r :+ e) -&gt; (LineSegment 2 p r :+ e) -&gt; Ordering)
-&gt; (LineSegment 2 p r :+ e) -&gt; Status p e r -&gt; Status p e r
forall a. (a -&gt; a -&gt; Ordering) -&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.deleteAllBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
-&gt; Point 2 r
-&gt; (LineSegment 2 p r :+ e)
-&gt; (LineSegment 2 p r :+ e)
-&gt; Ordering
forall p r e.
(Ord r, Fractional r) =&gt;
Point 2 r
-&gt; Point 2 r
-&gt; (LineSegment 2 p r :+ e)
-&gt; (LineSegment 2 p r :+ e)
-&gt; Ordering
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#compareByDistanceToAt"><span class="hs-identifier hs-var">compareByDistanceToAt</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037396"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037395"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">((LineSegment 2 p r :+ e) -&gt; (LineSegment 2 p r :+ e) -&gt; Ordering)
-&gt; ((LineSegment 2 p r :+ e)
    -&gt; (LineSegment 2 p r :+ e) -&gt; Ordering)
-&gt; (LineSegment 2 p r :+ e)
-&gt; (LineSegment 2 p r :+ e)
-&gt; Ordering
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
-&gt; (LineSegment 2 p r :+ e) -&gt; (LineSegment 2 p r :+ e) -&gt; Ordering
forall p r e.
(Ord r, Fractional r) =&gt;
Point 2 r
-&gt; (LineSegment 2 p r :+ e) -&gt; (LineSegment 2 p r :+ e) -&gt; Ordering
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#compareAroundEndPoint"><span class="hs-identifier hs-var">compareAroundEndPoint</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037396"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-390"></span><span>  </span><span class="hs-comment">-- if two segments have the same distance, we use the ccw order around their common</span><span>
</span><span id="line-391"></span><span>  </span><span class="hs-comment">-- (end) point.</span><span>
</span><span id="line-392"></span><span>
</span><span id="line-393"></span><span class="hs-comment">-- FIXME: If there are somehow segmetns that would continue at p as</span><span>
</span><span id="line-394"></span><span class="hs-comment">-- well, they are also deleted.</span><span>
</span><span id="line-395"></span><span>
</span><span id="line-396"></span><span>
</span><span id="line-397"></span><span class="hs-comment">-- | Given a list of line segments, each labeled with the distance</span><span>
</span><span id="line-398"></span><span class="hs-comment">-- from their intersection point with the initial ray to the query</span><span>
</span><span id="line-399"></span><span class="hs-comment">-- point, build the initial status structure.</span><span>
</span><span id="line-400"></span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#mkInitialSS"><span class="hs-identifier hs-type">mkInitialSS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680037876"><span class="annot"><a href="#local-6989586621680037876"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621680037875"><span class="annot"><a href="#local-6989586621680037875"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span id="local-6989586621680037874"><span class="annot"><a href="#local-6989586621680037874"><span class="hs-identifier hs-type">e</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680037876"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621680037876"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-401"></span><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037875"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037876"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621680037876"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680037874"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Status"><span class="hs-identifier hs-type">Status</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037875"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037874"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037876"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-402"></span><span id="mkInitialSS"><span class="annot"><span class="annottext">mkInitialSS :: [LineSegment 2 p r :+ (Maybe r, e)] -&gt; Status p e r
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#mkInitialSS"><span class="hs-identifier hs-var hs-var">mkInitialSS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((r :+ (LineSegment 2 p r :+ e)) -&gt; LineSegment 2 p r :+ e)
-&gt; Set (r :+ (LineSegment 2 p r :+ e)) -&gt; Status p e r
forall a b. (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.mapMonotonic</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(r :+ (LineSegment 2 p r :+ e))
-&gt; Getting
     (LineSegment 2 p r :+ e)
     (r :+ (LineSegment 2 p r :+ e))
     (LineSegment 2 p r :+ e)
-&gt; LineSegment 2 p r :+ e
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting
  (LineSegment 2 p r :+ e)
  (r :+ (LineSegment 2 p r :+ e))
  (LineSegment 2 p r :+ e)
forall core extra extra'.
Lens (core :+ extra) (core :+ extra') extra extra'
</span><span class="hs-identifier hs-var">extra</span></span><span class="hs-special">)</span><span>
</span><span id="line-403"></span><span>            </span><span class="annot"><span class="annottext">(Set (r :+ (LineSegment 2 p r :+ e)) -&gt; Status p e r)
-&gt; ([LineSegment 2 p r :+ (Maybe r, e)]
    -&gt; Set (r :+ (LineSegment 2 p r :+ e)))
-&gt; [LineSegment 2 p r :+ (Maybe r, e)]
-&gt; Status p e r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((r :+ (LineSegment 2 p r :+ e))
 -&gt; Set (r :+ (LineSegment 2 p r :+ e))
 -&gt; Set (r :+ (LineSegment 2 p r :+ e)))
-&gt; Set (r :+ (LineSegment 2 p r :+ e))
-&gt; [r :+ (LineSegment 2 p r :+ e)]
-&gt; Set (r :+ (LineSegment 2 p r :+ e))
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((r :+ (LineSegment 2 p r :+ e))
 -&gt; (r :+ (LineSegment 2 p r :+ e)) -&gt; Ordering)
-&gt; (r :+ (LineSegment 2 p r :+ e))
-&gt; Set (r :+ (LineSegment 2 p r :+ e))
-&gt; Set (r :+ (LineSegment 2 p r :+ e))
forall a. (a -&gt; a -&gt; Ordering) -&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.insertBy</span></span><span> </span><span class="annot"><span class="annottext">(((r :+ (LineSegment 2 p r :+ e))
  -&gt; (r :+ (LineSegment 2 p r :+ e)) -&gt; Ordering)
 -&gt; (r :+ (LineSegment 2 p r :+ e))
 -&gt; Set (r :+ (LineSegment 2 p r :+ e))
 -&gt; Set (r :+ (LineSegment 2 p r :+ e)))
-&gt; ((r :+ (LineSegment 2 p r :+ e))
    -&gt; (r :+ (LineSegment 2 p r :+ e)) -&gt; Ordering)
-&gt; (r :+ (LineSegment 2 p r :+ e))
-&gt; Set (r :+ (LineSegment 2 p r :+ e))
-&gt; Set (r :+ (LineSegment 2 p r :+ e))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((r :+ (LineSegment 2 p r :+ e)) -&gt; r)
-&gt; (r :+ (LineSegment 2 p r :+ e))
-&gt; (r :+ (LineSegment 2 p r :+ e))
-&gt; Ordering
forall a b. Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering
</span><span class="hs-identifier hs-var">comparing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(r :+ (LineSegment 2 p r :+ e))
-&gt; Getting r (r :+ (LineSegment 2 p r :+ e)) r -&gt; r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting r (r :+ (LineSegment 2 p r :+ e)) r
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set (r :+ (LineSegment 2 p r :+ e))
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span>
</span><span id="line-404"></span><span>            </span><span class="annot"><span class="annottext">([r :+ (LineSegment 2 p r :+ e)]
 -&gt; Set (r :+ (LineSegment 2 p r :+ e)))
-&gt; ([LineSegment 2 p r :+ (Maybe r, e)]
    -&gt; [r :+ (LineSegment 2 p r :+ e)])
-&gt; [LineSegment 2 p r :+ (Maybe r, e)]
-&gt; Set (r :+ (LineSegment 2 p r :+ e))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((LineSegment 2 p r :+ (Maybe r, e))
 -&gt; Maybe (r :+ (LineSegment 2 p r :+ e)))
-&gt; [LineSegment 2 p r :+ (Maybe r, e)]
-&gt; [r :+ (LineSegment 2 p r :+ e)]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680037391"><span class="annot"><span class="annottext">s :: LineSegment 2 p r
</span><a href="#local-6989586621680037391"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680037390"><span class="annot"><span class="annottext">md :: Maybe r
</span><a href="#local-6989586621680037390"><span class="hs-identifier hs-var">md</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680037389"><span class="annot"><span class="annottext">e :: e
</span><a href="#local-6989586621680037389"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r -&gt; (LineSegment 2 p r :+ e) -&gt; r :+ (LineSegment 2 p r :+ e)
forall core extra. core -&gt; extra -&gt; core :+ extra
</span><span class="hs-operator hs-var">:+</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621680037391"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r -&gt; e -&gt; LineSegment 2 p r :+ e
forall core extra. core -&gt; extra -&gt; core :+ extra
</span><span class="hs-operator hs-var">:+</span></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621680037389"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(r -&gt; r :+ (LineSegment 2 p r :+ e))
-&gt; Maybe r -&gt; Maybe (r :+ (LineSegment 2 p r :+ e))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe r
</span><a href="#local-6989586621680037390"><span class="hs-identifier hs-var">md</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-405"></span><span>
</span><span id="line-406"></span><span class="hs-comment">-- | Given q, the initial ray, and a segment s, computes if the</span><span>
</span><span id="line-407"></span><span class="hs-comment">-- segment intersects the initial, rightward ray starting in q, and if</span><span>
</span><span id="line-408"></span><span class="hs-comment">-- so returns the (squared) distance from q to that point together</span><span>
</span><span id="line-409"></span><span class="hs-comment">-- with the segment.</span><span>
</span><span id="line-410"></span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#initialIntersection"><span class="hs-identifier hs-type">initialIntersection</span></a></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680037674"><span class="annot"><a href="#local-6989586621680037674"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621680037673"><span class="annot"><a href="#local-6989586621680037673"><span class="hs-identifier hs-type">p</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680037674"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621680037674"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-411"></span><span>                            </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037674"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.HalfLine.html#HalfLine"><span class="hs-identifier hs-type">HalfLine</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037674"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037673"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037674"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-412"></span><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621680037674"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-413"></span><span id="initialIntersection"><span class="annot"><span class="annottext">initialIntersection :: Point 2 r -&gt; HalfLine 2 r -&gt; LineSegment 2 p r -&gt; Maybe r
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#initialIntersection"><span class="hs-identifier hs-var hs-var">initialIntersection</span></a></span></span><span> </span><span id="local-6989586621680037386"><span class="annot"><span class="annottext">q :: Point 2 r
</span><a href="#local-6989586621680037386"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621680037385"><span class="annot"><span class="annottext">ray :: HalfLine 2 r
</span><a href="#local-6989586621680037385"><span class="hs-identifier hs-var">ray</span></a></span></span><span> </span><span id="local-6989586621680037384"><span class="annot"><span class="annottext">s :: LineSegment 2 p r
</span><a href="#local-6989586621680037384"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-414"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall (ts :: [*]).
NatToInt (RIndex (Point 2 r) ts) =&gt;
CoRec Identity ts -&gt; Maybe (Point 2 r)
forall t (ts :: [*]).
NatToInt (RIndex t ts) =&gt;
CoRec Identity ts -&gt; Maybe t
</span><span class="hs-identifier hs-var">asA</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037674"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CoRec Identity '[NoIntersection, Point 2 r, LineSegment 2 () r]
 -&gt; Maybe (Point 2 r))
-&gt; CoRec Identity '[NoIntersection, Point 2 r, LineSegment 2 () r]
-&gt; Maybe (Point 2 r)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 () r
</span><a href="#local-6989586621680037383"><span class="hs-identifier hs-var">seg</span></a></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 () r
-&gt; HalfLine 2 r -&gt; Intersection (LineSegment 2 () r) (HalfLine 2 r)
forall g h. IsIntersectableWith g h =&gt; g -&gt; h -&gt; Intersection g h
</span><span class="hs-operator hs-var">`intersect`</span></span><span> </span><span class="annot"><span class="annottext">HalfLine 2 r
</span><a href="#local-6989586621680037385"><span class="hs-identifier hs-var">ray</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-415"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe r
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-416"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680037382"><span class="annot"><span class="annottext">z :: Point 2 r
</span><a href="#local-6989586621680037382"><span class="hs-identifier hs-var">z</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">r -&gt; Maybe r
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(r -&gt; Maybe r) -&gt; r -&gt; Maybe r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; r
forall r (d :: Nat).
(Num r, Arity d) =&gt;
Point d r -&gt; Point d r -&gt; r
</span><a href="Data.Geometry.Point.Internal.html#squaredEuclideanDist"><span class="hs-identifier hs-var">squaredEuclideanDist</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037386"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037382"><span class="hs-identifier hs-var">z</span></a></span><span>
</span><span id="line-417"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-418"></span><span>    </span><span id="local-6989586621680037383"><span class="annot"><span class="annottext">seg :: LineSegment 2 () r
</span><a href="#local-6989586621680037383"><span class="hs-identifier hs-var hs-var">seg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(p -&gt; ()) -&gt; LineSegment 2 p r -&gt; LineSegment 2 () r
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; p -&gt; ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621680037384"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-419"></span><span>
</span><span id="line-420"></span><span class="hs-comment">-- | Labels the segments with the distance from q to their</span><span>
</span><span id="line-421"></span><span class="hs-comment">-- intersection point with the ray.</span><span>
</span><span id="line-422"></span><span id="local-6989586621680037888"><span id="local-6989586621680037889"><span id="local-6989586621680037890"><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#labelWithDistances"><span class="hs-identifier hs-type">labelWithDistances</span></a></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680037890"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621680037890"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-423"></span><span>                         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037890"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.HalfLine.html#HalfLine"><span class="hs-identifier hs-type">HalfLine</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037890"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037889"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037890"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680037888"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-424"></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037889"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037890"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621680037890"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680037888"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-425"></span><span id="labelWithDistances"><span class="annot"><span class="annottext">labelWithDistances :: Point 2 r
-&gt; HalfLine 2 r
-&gt; [LineSegment 2 p r :+ b]
-&gt; [LineSegment 2 p r :+ (Maybe r, b)]
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#labelWithDistances"><span class="hs-identifier hs-var hs-var">labelWithDistances</span></a></span></span><span> </span><span id="local-6989586621680037380"><span class="annot"><span class="annottext">q :: Point 2 r
</span><a href="#local-6989586621680037380"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621680037379"><span class="annot"><span class="annottext">ray :: HalfLine 2 r
</span><a href="#local-6989586621680037379"><span class="hs-identifier hs-var">ray</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((LineSegment 2 p r :+ b) -&gt; LineSegment 2 p r :+ (Maybe r, b))
-&gt; [LineSegment 2 p r :+ b] -&gt; [LineSegment 2 p r :+ (Maybe r, b)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680037378"><span class="annot"><span class="annottext">s :: LineSegment 2 p r
</span><a href="#local-6989586621680037378"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span id="local-6989586621680037377"><span class="annot"><span class="annottext">e :: b
</span><a href="#local-6989586621680037377"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621680037378"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r
-&gt; (Maybe r, b) -&gt; LineSegment 2 p r :+ (Maybe r, b)
forall core extra. core -&gt; extra -&gt; core :+ extra
</span><span class="hs-operator hs-var">:+</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r -&gt; HalfLine 2 r -&gt; LineSegment 2 p r -&gt; Maybe r
forall r p.
(Ord r, Fractional r) =&gt;
Point 2 r -&gt; HalfLine 2 r -&gt; LineSegment 2 p r -&gt; Maybe r
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#initialIntersection"><span class="hs-identifier hs-var">initialIntersection</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037380"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">HalfLine 2 r
</span><a href="#local-6989586621680037379"><span class="hs-identifier hs-var">ray</span></a></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621680037378"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680037377"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-426"></span><span>
</span><span id="line-427"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-428"></span><span class="hs-comment">-- * Comparators for the rotating ray</span><span>
</span><span id="line-429"></span><span>
</span><span id="line-430"></span><span class="hs-comment">-- | Given two points q and p, and two segments a and b that are guaranteed to</span><span>
</span><span id="line-431"></span><span class="hs-comment">-- intersect the ray from q through p once, order the segments by their</span><span>
</span><span id="line-432"></span><span class="hs-comment">-- intersection point</span><span>
</span><span id="line-433"></span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#compareByDistanceToAt"><span class="hs-identifier hs-type">compareByDistanceToAt</span></a></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680037702"><span class="annot"><a href="#local-6989586621680037702"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span id="local-6989586621680037703"><span class="annot"><a href="#local-6989586621680037703"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621680037701"><span class="annot"><a href="#local-6989586621680037701"><span class="hs-identifier hs-type">e</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680037703"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621680037703"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-434"></span><span>                          </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037703"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037703"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-435"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037702"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037703"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680037701"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-436"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037702"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037703"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680037701"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-437"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ordering</span></span><span>
</span><span id="line-438"></span><span id="compareByDistanceToAt"><span class="annot"><span class="annottext">compareByDistanceToAt :: Point 2 r
-&gt; Point 2 r
-&gt; (LineSegment 2 p r :+ e)
-&gt; (LineSegment 2 p r :+ e)
-&gt; Ordering
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#compareByDistanceToAt"><span class="hs-identifier hs-var hs-var">compareByDistanceToAt</span></a></span></span><span> </span><span id="local-6989586621680037376"><span class="annot"><span class="annottext">q :: Point 2 r
</span><a href="#local-6989586621680037376"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621680037375"><span class="annot"><span class="annottext">p :: Point 2 r
</span><a href="#local-6989586621680037375"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((LineSegment 2 p r :+ e) -&gt; Maybe r)
-&gt; (LineSegment 2 p r :+ e) -&gt; (LineSegment 2 p r :+ e) -&gt; Ordering
forall a b. Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering
</span><span class="hs-identifier hs-var">comparing</span></span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r :+ e) -&gt; Maybe r
</span><a href="#local-6989586621680037374"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-439"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-440"></span><span>    </span><span id="local-6989586621680037374"><span class="annot"><span class="annottext">f :: (LineSegment 2 p r :+ e) -&gt; Maybe r
</span><a href="#local-6989586621680037374"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680037373"><span class="annot"><span class="annottext">s :: LineSegment 2 p r
</span><a href="#local-6989586621680037373"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Point 2 r -&gt; r) -&gt; Maybe (Point 2 r) -&gt; Maybe r
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; r
forall r (d :: Nat).
(Num r, Arity d) =&gt;
Point d r -&gt; Point d r -&gt; r
</span><a href="Data.Geometry.Point.Internal.html#squaredEuclideanDist"><span class="hs-identifier hs-var">squaredEuclideanDist</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037376"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-441"></span><span>               </span><span class="annot"><span class="annottext">(Maybe (Point 2 r) -&gt; Maybe r)
-&gt; (CoRec Identity '[NoIntersection, Point 2 r, Line 2 r]
    -&gt; Maybe (Point 2 r))
-&gt; CoRec Identity '[NoIntersection, Point 2 r, Line 2 r]
-&gt; Maybe r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (ts :: [*]).
NatToInt (RIndex (Point 2 r) ts) =&gt;
CoRec Identity ts -&gt; Maybe (Point 2 r)
forall t (ts :: [*]).
NatToInt (RIndex t ts) =&gt;
CoRec Identity ts -&gt; Maybe t
</span><span class="hs-identifier hs-var">asA</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037703"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-442"></span><span>               </span><span class="annot"><span class="annottext">(CoRec Identity '[NoIntersection, Point 2 r, Line 2 r] -&gt; Maybe r)
-&gt; CoRec Identity '[NoIntersection, Point 2 r, Line 2 r] -&gt; Maybe r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r
-&gt; Line
     (Dimension (LineSegment 2 p r)) (NumType (LineSegment 2 p r))
forall t.
HasSupportingLine t =&gt;
t -&gt; Line (Dimension t) (NumType t)
</span><a href="Data.Geometry.Line.Internal.html#supportingLine"><span class="hs-identifier hs-var">supportingLine</span></a></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621680037373"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Line 2 r -&gt; Line 2 r -&gt; Intersection (Line 2 r) (Line 2 r)
forall g h. IsIntersectableWith g h =&gt; g -&gt; h -&gt; Intersection g h
</span><span class="hs-operator hs-var">`intersect`</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; Line 2 r
forall r (d :: Nat).
(Num r, Arity d) =&gt;
Point d r -&gt; Point d r -&gt; Line d r
</span><a href="Data.Geometry.Line.Internal.html#lineThrough"><span class="hs-identifier hs-var">lineThrough</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037375"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037376"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-443"></span><span>
</span><span id="line-444"></span><span class="hs-comment">-- | Given two segments that share an endpoint, order them by their</span><span>
</span><span id="line-445"></span><span class="hs-comment">-- order around this common endpoint. I.e. if uv and uw share endpoint</span><span>
</span><span id="line-446"></span><span class="hs-comment">-- u we uv is considered smaller iff v is smaller than w in the</span><span>
</span><span id="line-447"></span><span class="hs-comment">-- counterclockwise order around u (treating the direction from q to</span><span>
</span><span id="line-448"></span><span class="hs-comment">-- the common endpoint as zero).</span><span>
</span><span id="line-449"></span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#compareAroundEndPoint"><span class="hs-identifier hs-type">compareAroundEndPoint</span></a></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680037699"><span class="annot"><a href="#local-6989586621680037699"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span id="local-6989586621680037700"><span class="annot"><a href="#local-6989586621680037700"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621680037698"><span class="annot"><a href="#local-6989586621680037698"><span class="hs-identifier hs-type">e</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680037700"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621680037700"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-450"></span><span>                       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037700"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-451"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037699"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037700"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680037698"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-452"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037699"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037700"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680037698"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-453"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ordering</span></span><span>
</span><span id="line-454"></span><span id="compareAroundEndPoint"><span class="annot"><span class="annottext">compareAroundEndPoint :: Point 2 r
-&gt; (LineSegment 2 p r :+ e) -&gt; (LineSegment 2 p r :+ e) -&gt; Ordering
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#compareAroundEndPoint"><span class="hs-identifier hs-var hs-var">compareAroundEndPoint</span></a></span></span><span> </span><span id="local-6989586621680037372"><span class="annot"><span class="annottext">q :: Point 2 r
</span><a href="#local-6989586621680037372"><span class="hs-identifier hs-var">q</span></a></span></span><span>
</span><span id="line-455"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment%27"><span class="hs-identifier hs-type">LineSegment'</span></a></span><span> </span><span id="local-6989586621680037371"><span class="annot"><span class="annottext">a :: Point 2 r :+ p
</span><a href="#local-6989586621680037371"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680037370"><span class="annot"><span class="annottext">b :: Point 2 r :+ p
</span><a href="#local-6989586621680037370"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><span id="line-456"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment%27"><span class="hs-identifier hs-type">LineSegment'</span></a></span><span> </span><span id="local-6989586621680037369"><span class="annot"><span class="annottext">s :: Point 2 r :+ p
</span><a href="#local-6989586621680037369"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621680037368"><span class="annot"><span class="annottext">t :: Point 2 r :+ p
</span><a href="#local-6989586621680037368"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><span id="line-457"></span><span>    </span><span class="hs-comment">-- traceshow (&quot;comapreAroundEndPoint &quot;, sa, sb) False = undefined</span><span>
</span><span id="line-458"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680037371"><span class="hs-identifier hs-var">a</span></a></span><span class="annot"><span class="annottext">(Point 2 r :+ p)
-&gt; Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r) -&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680037369"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">(Point 2 r :+ p)
-&gt; Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r) -&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector 2 r
-&gt; (Point 2 r :+ p)
-&gt; (Point 2 r :+ p)
-&gt; (Point 2 r :+ p)
-&gt; Ordering
forall r c a b.
(Ord r, Num r) =&gt;
Vector 2 r
-&gt; (Point 2 r :+ c)
-&gt; (Point 2 r :+ a)
-&gt; (Point 2 r :+ b)
-&gt; Ordering
</span><a href="Data.Geometry.Point.Orientation.Degenerate.html#ccwCmpAroundWith%27"><span class="hs-identifier hs-var">ccwCmpAroundWith'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680037371"><span class="hs-identifier hs-var">a</span></a></span><span class="annot"><span class="annottext">(Point 2 r :+ p)
-&gt; Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r) -&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; Diff (Point 2) r
forall (p :: * -&gt; *) a. (Affine p, Num a) =&gt; p a -&gt; p a -&gt; Diff p a
</span><span class="hs-operator hs-var">.-.</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037372"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680037371"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680037370"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680037368"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-459"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680037371"><span class="hs-identifier hs-var">a</span></a></span><span class="annot"><span class="annottext">(Point 2 r :+ p)
-&gt; Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r) -&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680037368"><span class="hs-identifier hs-var">t</span></a></span><span class="annot"><span class="annottext">(Point 2 r :+ p)
-&gt; Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r) -&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector 2 r
-&gt; (Point 2 r :+ p)
-&gt; (Point 2 r :+ p)
-&gt; (Point 2 r :+ p)
-&gt; Ordering
forall r c a b.
(Ord r, Num r) =&gt;
Vector 2 r
-&gt; (Point 2 r :+ c)
-&gt; (Point 2 r :+ a)
-&gt; (Point 2 r :+ b)
-&gt; Ordering
</span><a href="Data.Geometry.Point.Orientation.Degenerate.html#ccwCmpAroundWith%27"><span class="hs-identifier hs-var">ccwCmpAroundWith'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680037371"><span class="hs-identifier hs-var">a</span></a></span><span class="annot"><span class="annottext">(Point 2 r :+ p)
-&gt; Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r) -&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; Diff (Point 2) r
forall (p :: * -&gt; *) a. (Affine p, Num a) =&gt; p a -&gt; p a -&gt; Diff p a
</span><span class="hs-operator hs-var">.-.</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037372"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680037371"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680037370"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680037369"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-460"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680037370"><span class="hs-identifier hs-var">b</span></a></span><span class="annot"><span class="annottext">(Point 2 r :+ p)
-&gt; Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r) -&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680037369"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">(Point 2 r :+ p)
-&gt; Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r) -&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector 2 r
-&gt; (Point 2 r :+ p)
-&gt; (Point 2 r :+ p)
-&gt; (Point 2 r :+ p)
-&gt; Ordering
forall r c a b.
(Ord r, Num r) =&gt;
Vector 2 r
-&gt; (Point 2 r :+ c)
-&gt; (Point 2 r :+ a)
-&gt; (Point 2 r :+ b)
-&gt; Ordering
</span><a href="Data.Geometry.Point.Orientation.Degenerate.html#ccwCmpAroundWith%27"><span class="hs-identifier hs-var">ccwCmpAroundWith'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680037370"><span class="hs-identifier hs-var">b</span></a></span><span class="annot"><span class="annottext">(Point 2 r :+ p)
-&gt; Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r) -&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; Diff (Point 2) r
forall (p :: * -&gt; *) a. (Affine p, Num a) =&gt; p a -&gt; p a -&gt; Diff p a
</span><span class="hs-operator hs-var">.-.</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037372"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680037370"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680037371"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680037368"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-461"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680037370"><span class="hs-identifier hs-var">b</span></a></span><span class="annot"><span class="annottext">(Point 2 r :+ p)
-&gt; Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r) -&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680037368"><span class="hs-identifier hs-var">t</span></a></span><span class="annot"><span class="annottext">(Point 2 r :+ p)
-&gt; Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r) -&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector 2 r
-&gt; (Point 2 r :+ p)
-&gt; (Point 2 r :+ p)
-&gt; (Point 2 r :+ p)
-&gt; Ordering
forall r c a b.
(Ord r, Num r) =&gt;
Vector 2 r
-&gt; (Point 2 r :+ c)
-&gt; (Point 2 r :+ a)
-&gt; (Point 2 r :+ b)
-&gt; Ordering
</span><a href="Data.Geometry.Point.Orientation.Degenerate.html#ccwCmpAroundWith%27"><span class="hs-identifier hs-var">ccwCmpAroundWith'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680037370"><span class="hs-identifier hs-var">b</span></a></span><span class="annot"><span class="annottext">(Point 2 r :+ p)
-&gt; Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r) -&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; Diff (Point 2) r
forall (p :: * -&gt; *) a. (Affine p, Num a) =&gt; p a -&gt; p a -&gt; Diff p a
</span><span class="hs-operator hs-var">.-.</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037372"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680037370"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680037371"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680037369"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-462"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Ordering
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="hs-string">&quot;compareAroundEndPoint: precondition failed!&quot;</span></span><span>
</span><span id="line-463"></span><span>
</span><span id="line-464"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-465"></span><span class="hs-comment">-- * Helper functions for polygon operations</span><span>
</span><span id="line-466"></span><span>
</span><span id="line-467"></span><span class="hs-comment">-- | Given q, and two consecutive points u and v, Computes a direction</span><span>
</span><span id="line-468"></span><span class="hs-comment">-- for the initial ray, i.e. a &quot;generic&quot; ray that does not go through</span><span>
</span><span id="line-469"></span><span class="hs-comment">-- any vertices.</span><span>
</span><span id="line-470"></span><span id="local-6989586621680037962"><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#startingDirection"><span class="hs-identifier hs-type">startingDirection</span></a></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621680037962"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037962"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037962"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037962"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Vector.VectorFamily.html#Vector"><span class="hs-identifier hs-type">Vector</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037962"><span class="hs-identifier hs-type">r</span></a></span></span><span>
</span><span id="line-471"></span><span id="startingDirection"><span class="annot"><span class="annottext">startingDirection :: Point 2 r -&gt; Point 2 r -&gt; Point 2 r -&gt; Vector 2 r
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#startingDirection"><span class="hs-identifier hs-var hs-var">startingDirection</span></a></span></span><span> </span><span id="local-6989586621680037367"><span class="annot"><span class="annottext">q :: Point 2 r
</span><a href="#local-6989586621680037367"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621680037366"><span class="annot"><span class="annottext">u :: Point 2 r
</span><a href="#local-6989586621680037366"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621680037365"><span class="annot"><span class="annottext">w :: Point 2 r
</span><a href="#local-6989586621680037365"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037364"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; Diff (Point 2) r
forall (p :: * -&gt; *) a. (Affine p, Num a) =&gt; p a -&gt; p a -&gt; Diff p a
</span><span class="hs-operator hs-var">.-.</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037367"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-472"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-473"></span><span>    </span><span id="local-6989586621680037364"><span class="annot"><span class="annottext">v :: Point 2 r
</span><a href="#local-6989586621680037364"><span class="hs-identifier hs-var hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037366"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Diff (Point 2) r -&gt; Point 2 r
forall (p :: * -&gt; *) a. (Affine p, Num a) =&gt; p a -&gt; Diff p a -&gt; p a
</span><span class="hs-operator hs-var">.+^</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037365"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; Diff (Point 2) r
forall (p :: * -&gt; *) a. (Affine p, Num a) =&gt; p a -&gt; p a -&gt; Diff p a
</span><span class="hs-operator hs-var">.-.</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037366"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Vector 2 r -&gt; r -&gt; Vector 2 r
forall (f :: * -&gt; *) a.
(Functor f, Fractional a) =&gt;
f a -&gt; a -&gt; f a
</span><span class="hs-operator hs-var">^/</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- point in the middle between u and w</span><span>
</span><span id="line-474"></span><span>        </span><span class="hs-comment">-- note: the segment between u and w could pass on the wrong side of q</span><span>
</span><span id="line-475"></span><span>        </span><span class="hs-comment">-- (i.e. so that does not &quot;cover&quot; the CCW but the CW range between u and w)</span><span>
</span><span id="line-476"></span><span>        </span><span class="hs-comment">-- however, in that case there is apparently nothing on the CCW side opposite</span><span>
</span><span id="line-477"></span><span>        </span><span class="hs-comment">-- to v, as u and w are supposed to be the first two events. This means the</span><span>
</span><span id="line-478"></span><span>        </span><span class="hs-comment">-- precondition does not hold.</span><span>
</span><span id="line-479"></span><span>
</span><span id="line-480"></span><span class="hs-comment">-- | finds two consecutive vertices in the clockwise order around the</span><span>
</span><span id="line-481"></span><span class="hs-comment">-- given point q. I.e. there are no other points in between the two</span><span>
</span><span id="line-482"></span><span class="hs-comment">-- returned points.</span><span>
</span><span id="line-483"></span><span id="local-6989586621680037960"><span id="local-6989586621680037961"><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#consecutive"><span class="hs-identifier hs-type">consecutive</span></a></span><span>                   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680037961"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621680037961"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037961"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037961"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680037960"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-484"></span><span>                              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037961"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037961"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-485"></span><span id="consecutive"><span class="annot"><span class="annottext">consecutive :: Point 2 r -&gt; NonEmpty (Point 2 r :+ p) -&gt; (Point 2 r, Point 2 r)
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#consecutive"><span class="hs-identifier hs-var hs-var">consecutive</span></a></span></span><span> </span><span id="local-6989586621680037361"><span class="annot"><span class="annottext">q :: Point 2 r
</span><a href="#local-6989586621680037361"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680037360"><span class="annot"><span class="annottext">p :: Point 2 r
</span><a href="#local-6989586621680037360"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span id="local-6989586621680037359"><span class="annot"><span class="annottext">pts :: [Point 2 r :+ p]
</span><a href="#local-6989586621680037359"><span class="hs-identifier hs-var">pts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037360"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Vector 2 r -&gt; Point 2 r -&gt; [Point 2 r :+ p] -&gt; Point 2 r
forall r p.
(Ord r, Num r) =&gt;
Vector 2 r -&gt; Point 2 r -&gt; [Point 2 r :+ p] -&gt; Point 2 r
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#consecutiveFrom"><span class="hs-identifier hs-var">consecutiveFrom</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037360"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; Diff (Point 2) r
forall (p :: * -&gt; *) a. (Affine p, Num a) =&gt; p a -&gt; p a -&gt; Diff p a
</span><span class="hs-operator hs-var">.-.</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037361"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037361"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">[Point 2 r :+ p]
</span><a href="#local-6989586621680037359"><span class="hs-identifier hs-var">pts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-486"></span><span>
</span><span id="line-487"></span><span class="hs-comment">-- | pre: input list is non-empty</span><span>
</span><span id="line-488"></span><span id="local-6989586621680037927"><span id="local-6989586621680037928"><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#consecutiveFrom"><span class="hs-identifier hs-type">consecutiveFrom</span></a></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680037928"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621680037928"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-489"></span><span>                    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Vector.VectorFamily.html#Vector"><span class="hs-identifier hs-type">Vector</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037928"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-comment">-- ^ starting vector</span><span>
</span><span id="line-490"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037928"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-comment">-- ^ query point</span><span>
</span><span id="line-491"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037928"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680037927"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037928"><span class="hs-identifier hs-type">r</span></a></span></span></span><span>
</span><span id="line-492"></span><span id="consecutiveFrom"><span class="annot"><span class="annottext">consecutiveFrom :: Vector 2 r -&gt; Point 2 r -&gt; [Point 2 r :+ p] -&gt; Point 2 r
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#consecutiveFrom"><span class="hs-identifier hs-var hs-var">consecutiveFrom</span></a></span></span><span> </span><span id="local-6989586621680037358"><span class="annot"><span class="annottext">v :: Vector 2 r
</span><a href="#local-6989586621680037358"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680037357"><span class="annot"><span class="annottext">q :: Point 2 r
</span><a href="#local-6989586621680037357"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r)
-&gt; (Point 2 r :+ p) -&gt; Point 2 r
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span> </span><span class="annot"><span class="annottext">((Point 2 r :+ p) -&gt; Point 2 r)
-&gt; ([Point 2 r :+ p] -&gt; Point 2 r :+ p)
-&gt; [Point 2 r :+ p]
-&gt; Point 2 r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Point 2 r :+ p) -&gt; (Point 2 r :+ p) -&gt; Ordering)
-&gt; [Point 2 r :+ p] -&gt; Point 2 r :+ p
forall (t :: * -&gt; *) a.
Foldable t =&gt;
(a -&gt; a -&gt; Ordering) -&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">List.minimumBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector 2 r
-&gt; (Point 2 r :+ ())
-&gt; (Point 2 r :+ p)
-&gt; (Point 2 r :+ p)
-&gt; Ordering
forall r c a b.
(Ord r, Num r) =&gt;
Vector 2 r
-&gt; (Point 2 r :+ c)
-&gt; (Point 2 r :+ a)
-&gt; (Point 2 r :+ b)
-&gt; Ordering
</span><a href="Data.Geometry.Point.Orientation.Degenerate.html#ccwCmpAroundWith%27"><span class="hs-identifier hs-var">ccwCmpAroundWith'</span></a></span><span> </span><span class="annot"><span class="annottext">Vector 2 r
</span><a href="#local-6989586621680037358"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r :+ ()
forall a. a -&gt; a :+ ()
</span><span class="hs-identifier hs-var">ext</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680037357"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-493"></span><span>
</span><span id="line-494"></span><span class="hs-comment">-- | Gets the edges of the polygon as closed line segments.</span><span>
</span><span id="line-495"></span><span id="local-6989586621680037969"><span id="local-6989586621680037970"><span id="local-6989586621680037971"><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#closedEdges"><span class="hs-identifier hs-type">closedEdges</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Geometry.Polygon.Core.html#Polygon"><span class="hs-identifier hs-type">Polygon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037971"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037970"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037969"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680037970"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680037969"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-496"></span><span id="closedEdges"><span class="annot"><span class="annottext">closedEdges :: Polygon t p r -&gt; [LineSegment 2 p r]
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#closedEdges"><span class="hs-identifier hs-var hs-var">closedEdges</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r -&gt; LineSegment 2 p r)
-&gt; [LineSegment 2 p r] -&gt; [LineSegment 2 p r]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r -&gt; LineSegment 2 p r
forall (d :: Nat) p r. LineSegment d p r -&gt; LineSegment d p r
</span><a href="#local-6989586621680037355"><span class="hs-identifier hs-var">asClosed</span></a></span><span> </span><span class="annot"><span class="annottext">([LineSegment 2 p r] -&gt; [LineSegment 2 p r])
-&gt; (Polygon t p r -&gt; [LineSegment 2 p r])
-&gt; Polygon t p r
-&gt; [LineSegment 2 p r]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Polygon t p r -&gt; [LineSegment 2 p r]
forall (t :: PolygonType) p r. Polygon t p r -&gt; [LineSegment 2 p r]
</span><a href="Data.Geometry.Polygon.Core.html#listEdges"><span class="hs-identifier hs-var">listEdges</span></a></span><span>
</span><span id="line-497"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-498"></span><span>    </span><span id="local-6989586621680037355"><span class="annot"><span class="annottext">asClosed :: LineSegment d p r -&gt; LineSegment d p r
</span><a href="#local-6989586621680037355"><span class="hs-identifier hs-var hs-var">asClosed</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment%27"><span class="hs-identifier hs-type">LineSegment'</span></a></span><span> </span><span id="local-6989586621680037353"><span class="annot"><span class="annottext">u :: Point d r :+ p
</span><a href="#local-6989586621680037353"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621680037352"><span class="annot"><span class="annottext">v :: Point d r :+ p
</span><a href="#local-6989586621680037352"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Point d r :+ p) -&gt; (Point d r :+ p) -&gt; LineSegment d p r
forall (d :: Nat) r p.
(Point d r :+ p) -&gt; (Point d r :+ p) -&gt; LineSegment d p r
</span><a href="Data.Geometry.LineSegment.Internal.html#ClosedLineSegment"><span class="hs-identifier hs-var">ClosedLineSegment</span></a></span><span> </span><span class="annot"><span class="annottext">Point d r :+ p
</span><a href="#local-6989586621680037353"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Point d r :+ p
</span><a href="#local-6989586621680037352"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-499"></span><span>
</span><span id="line-500"></span><span>
</span><span id="line-501"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-502"></span><span class="hs-comment">-- * Generic Helper functions</span><span>
</span><span id="line-503"></span><span>
</span><span id="line-504"></span><span>
</span><span id="line-505"></span><span>
</span><span id="line-506"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-507"></span><span>
</span><span id="line-508"></span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#test"><span class="hs-identifier hs-type">test</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#StarShapedPolygon"><span class="hs-identifier hs-type">StarShapedPolygon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#Definer"><span class="hs-identifier hs-type">Definer</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#R"><span class="hs-identifier hs-type">R</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#R"><span class="hs-identifier hs-type">R</span></a></span><span>
</span><span id="line-509"></span><span id="test"><span class="annot"><span class="annottext">test :: StarShapedPolygon (Definer Int () R) R
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#test"><span class="hs-identifier hs-var hs-var">test</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point 2 R
-&gt; Polygon 'Simple Int R -&gt; StarShapedPolygon (Definer Int () R) R
forall p (t :: PolygonType) r.
(Ord r, Fractional r) =&gt;
Point 2 r -&gt; Polygon t p r -&gt; StarShapedPolygon (Definer p () r) r
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#visibilityPolygon"><span class="hs-identifier hs-var">visibilityPolygon</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 R
forall (d :: Nat) r. (Arity d, Num r) =&gt; Point d r
</span><a href="Data.Geometry.Point.Internal.html#origin"><span class="hs-identifier hs-var">origin</span></a></span><span> </span><span class="annot"><span class="annottext">Polygon 'Simple Int R
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#testPg"><span class="hs-identifier hs-var">testPg</span></a></span><span>
</span><span id="line-510"></span><span>
</span><span id="line-511"></span><span id="testVtx"><span class="annot"><span class="annottext">testVtx :: StarShapedPolygon (Definer Int () R) R
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#testVtx"><span class="hs-identifier hs-var hs-var">testVtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Polygon 'Simple Int R
-&gt; Int -&gt; StarShapedPolygon (Definer Int () R) R
forall p (t :: PolygonType) r.
(Ord r, Fractional r, Show r, Show p) =&gt;
Polygon t p r -&gt; Int -&gt; VisibilityPolygon p () r
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#visibilityPolygonFromVertex"><span class="hs-identifier hs-var">visibilityPolygonFromVertex</span></a></span><span> </span><span class="annot"><span class="annottext">Polygon 'Simple Int R
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#testPg"><span class="hs-identifier hs-var">testPg</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-512"></span><span>
</span><span id="line-513"></span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#testPg"><span class="hs-identifier hs-type">testPg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Geometry.Polygon.Core.html#SimplePolygon"><span class="hs-identifier hs-type">SimplePolygon</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#R"><span class="hs-identifier hs-type">R</span></a></span><span>
</span><span id="line-514"></span><span id="testPg"><span class="annot"><span class="annottext">testPg :: Polygon 'Simple Int R
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#testPg"><span class="hs-identifier hs-var hs-var">testPg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Point 2 R :+ Int] -&gt; Polygon 'Simple Int R
forall p r. (Eq r, Num r) =&gt; [Point 2 r :+ p] -&gt; SimplePolygon p r
</span><a href="Data.Geometry.Polygon.Core.html#fromPoints"><span class="hs-identifier hs-var">fromPoints</span></a></span><span> </span><span class="annot"><span class="annottext">([Point 2 R :+ Int] -&gt; Polygon 'Simple Int R)
-&gt; [Point 2 R :+ Int] -&gt; Polygon 'Simple Int R
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Point 2 R -&gt; Int -&gt; Point 2 R :+ Int)
-&gt; [Point 2 R] -&gt; [Int] -&gt; [Point 2 R :+ Int]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">Point 2 R -&gt; Int -&gt; Point 2 R :+ Int
forall core extra. core -&gt; extra -&gt; core :+ extra
</span><span class="hs-operator hs-var">(:+)</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">R -&gt; R -&gt; Point 2 R
forall r. r -&gt; r -&gt; Point 2 r
</span><a href="Data.Geometry.Point.Internal.html#Point2"><span class="hs-identifier hs-var">Point2</span></a></span><span> </span><span class="annot"><span class="hs-number">3</span></span><span>    </span><span class="annot"><span class="hs-number">1</span></span><span>
</span><span id="line-515"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">R -&gt; R -&gt; Point 2 R
forall r. r -&gt; r -&gt; Point 2 r
</span><a href="Data.Geometry.Point.Internal.html#Point2"><span class="hs-identifier hs-var">Point2</span></a></span><span> </span><span class="annot"><span class="hs-number">3</span></span><span>    </span><span class="annot"><span class="hs-number">2</span></span><span>
</span><span id="line-516"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">R -&gt; R -&gt; Point 2 R
forall r. r -&gt; r -&gt; Point 2 r
</span><a href="Data.Geometry.Point.Internal.html#Point2"><span class="hs-identifier hs-var">Point2</span></a></span><span> </span><span class="annot"><span class="hs-number">4</span></span><span>    </span><span class="annot"><span class="hs-number">2</span></span><span>
</span><span id="line-517"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">R -&gt; R -&gt; Point 2 R
forall r. r -&gt; r -&gt; Point 2 r
</span><a href="Data.Geometry.Point.Internal.html#Point2"><span class="hs-identifier hs-var">Point2</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span>    </span><span class="annot"><span class="hs-number">4</span></span><span>
</span><span id="line-518"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">R -&gt; R -&gt; Point 2 R
forall r. r -&gt; r -&gt; Point 2 r
</span><a href="Data.Geometry.Point.Internal.html#Point2"><span class="hs-identifier hs-var">Point2</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-number">4</span></span><span>
</span><span id="line-519"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">R -&gt; R -&gt; Point 2 R
forall r. r -&gt; r -&gt; Point 2 r
</span><a href="Data.Geometry.Point.Internal.html#Point2"><span class="hs-identifier hs-var">Point2</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span>    </span><span class="annot"><span class="hs-number">2</span></span><span>
</span><span id="line-520"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">R -&gt; R -&gt; Point 2 R
forall r. r -&gt; r -&gt; Point 2 r
</span><a href="Data.Geometry.Point.Internal.html#Point2"><span class="hs-identifier hs-var">Point2</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="hs-number">3</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-521"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">R -&gt; R -&gt; Point 2 R
forall r. r -&gt; r -&gt; Point 2 r
</span><a href="Data.Geometry.Point.Internal.html#Point2"><span class="hs-identifier hs-var">Point2</span></a></span><span> </span><span class="annot"><span class="hs-number">4</span></span><span>    </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-522"></span><span>                                   </span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-523"></span><span>
</span><span id="line-524"></span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#testPg2"><span class="hs-identifier hs-type">testPg2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Geometry.Polygon.Core.html#SimplePolygon"><span class="hs-identifier hs-type">SimplePolygon</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#R"><span class="hs-identifier hs-type">R</span></a></span><span>
</span><span id="line-525"></span><span id="testPg2"><span class="annot"><span class="annottext">testPg2 :: Polygon 'Simple Int R
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#testPg2"><span class="hs-identifier hs-var hs-var">testPg2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Point 2 R :+ Int] -&gt; Polygon 'Simple Int R
forall p r. (Eq r, Num r) =&gt; [Point 2 r :+ p] -&gt; SimplePolygon p r
</span><a href="Data.Geometry.Polygon.Core.html#fromPoints"><span class="hs-identifier hs-var">fromPoints</span></a></span><span> </span><span class="annot"><span class="annottext">([Point 2 R :+ Int] -&gt; Polygon 'Simple Int R)
-&gt; [Point 2 R :+ Int] -&gt; Polygon 'Simple Int R
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Point 2 R -&gt; Int -&gt; Point 2 R :+ Int)
-&gt; [Point 2 R] -&gt; [Int] -&gt; [Point 2 R :+ Int]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">Point 2 R -&gt; Int -&gt; Point 2 R :+ Int
forall core extra. core -&gt; extra -&gt; core :+ extra
</span><span class="hs-operator hs-var">(:+)</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">R -&gt; R -&gt; Point 2 R
forall r. r -&gt; r -&gt; Point 2 r
</span><a href="Data.Geometry.Point.Internal.html#Point2"><span class="hs-identifier hs-var">Point2</span></a></span><span> </span><span class="annot"><span class="hs-number">3</span></span><span>    </span><span class="annot"><span class="hs-number">1</span></span><span>
</span><span id="line-526"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">R -&gt; R -&gt; Point 2 R
forall r. r -&gt; r -&gt; Point 2 r
</span><a href="Data.Geometry.Point.Internal.html#Point2"><span class="hs-identifier hs-var">Point2</span></a></span><span> </span><span class="annot"><span class="hs-number">3</span></span><span>    </span><span class="annot"><span class="hs-number">2</span></span><span>
</span><span id="line-527"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">R -&gt; R -&gt; Point 2 R
forall r. r -&gt; r -&gt; Point 2 r
</span><a href="Data.Geometry.Point.Internal.html#Point2"><span class="hs-identifier hs-var">Point2</span></a></span><span> </span><span class="annot"><span class="hs-number">4</span></span><span>    </span><span class="annot"><span class="hs-number">2</span></span><span>
</span><span id="line-528"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">R -&gt; R -&gt; Point 2 R
forall r. r -&gt; r -&gt; Point 2 r
</span><a href="Data.Geometry.Point.Internal.html#Point2"><span class="hs-identifier hs-var">Point2</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span>    </span><span class="annot"><span class="hs-number">4</span></span><span>
</span><span id="line-529"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">R -&gt; R -&gt; Point 2 R
forall r. r -&gt; r -&gt; Point 2 r
</span><a href="Data.Geometry.Point.Internal.html#Point2"><span class="hs-identifier hs-var">Point2</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-number">4</span></span><span>
</span><span id="line-530"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">R -&gt; R -&gt; Point 2 R
forall r. r -&gt; r -&gt; Point 2 r
</span><a href="Data.Geometry.Point.Internal.html#Point2"><span class="hs-identifier hs-var">Point2</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span>    </span><span class="annot"><span class="hs-number">2.1</span></span><span>
</span><span id="line-531"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">R -&gt; R -&gt; Point 2 R
forall r. r -&gt; r -&gt; Point 2 r
</span><a href="Data.Geometry.Point.Internal.html#Point2"><span class="hs-identifier hs-var">Point2</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="hs-number">3</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-532"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">R -&gt; R -&gt; Point 2 R
forall r. r -&gt; r -&gt; Point 2 r
</span><a href="Data.Geometry.Point.Internal.html#Point2"><span class="hs-identifier hs-var">Point2</span></a></span><span> </span><span class="annot"><span class="hs-number">4</span></span><span>    </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-533"></span><span>                                    </span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-534"></span><span>
</span><span id="line-535"></span><span>
</span><span id="line-536"></span><span>
</span><span id="line-537"></span><span id="traceShowIdWith"><span class="annot"><span class="annottext">traceShowIdWith :: a -&gt; b -&gt; b
</span><a href="Algorithms.Geometry.VisibilityPolygon.Lee.html#traceShowIdWith"><span class="hs-identifier hs-var hs-var">traceShowIdWith</span></a></span></span><span> </span><span id="local-6989586621680037343"><span class="annot"><span class="annottext">x :: a
</span><a href="#local-6989586621680037343"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680037342"><span class="annot"><span class="annottext">y :: b
</span><a href="#local-6989586621680037342"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(String, b) -&gt; b -&gt; b
forall a b. Show a =&gt; a -&gt; b -&gt; b
</span><span class="hs-identifier hs-var">traceShow</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680037343"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680037342"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680037342"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-538"></span></pre></body></html>