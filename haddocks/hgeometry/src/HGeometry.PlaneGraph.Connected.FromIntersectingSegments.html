<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-2"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- Module      :  HGeometry.PlaneGraph.Connected.FromIntersectingSegments</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- Copyright   :  (C) Frank Staals</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- License     :  see the LICENSE file</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- Maintainer  :  Frank Staals</span><span>
</span><span id="line-7"></span><span class="hs-comment">--</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- Computing a Connected Plane graph from a set of intersecting line</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- segments.</span><span>
</span><span id="line-10"></span><span class="hs-comment">--</span><span>
</span><span id="line-11"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-12"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="HGeometry.PlaneGraph.Connected.FromIntersectingSegments.html"><span class="hs-identifier">HGeometry.PlaneGraph.Connected.FromIntersectingSegments</span></a></span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="HGeometry.PlaneGraph.Connected.FromIntersectingSegments.html#fromIntersectingSegments"><span class="hs-identifier">fromIntersectingSegments</span></a></span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable1</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.cabal/store/ghc-9.12.2-9b33/indexed-traversable-0.1.4-abf18009c8aa238896def64882e8e8d1f618d0164d9214ba36444910f4d62193/share/doc/html/src/Data.Foldable1.WithIndex.html"><span class="hs-identifier">Data.Foldable1.WithIndex</span></a></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.cabal/store/ghc-9.12.2-9b33/monoidal-containers-0.6.6.0-45b60b594b42f183c88f541def99d5378a9f6d3bceec6ae95a9027298e34d367/share/doc/html/src/Data.Map.Monoidal.html"><span class="hs-identifier">Data.Map.Monoidal</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">MonoidalMap</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.cabal/store/ghc-9.12.2-9b33/semialign-1.3.1-ad15642489224f7e945797300a0b1eca31785c10fbb9993a16f8f207ea2547f7/share/doc/html/src/Data.Semialign.html"><span class="hs-identifier">Data.Semialign</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Sequence</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Seq</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.cabal/store/ghc-9.12.2-9b33/lens-5.3.5-af8f0435b03c00f06f5d03b52ea927527529d0c03b8a7eee42e07e484fdea6cb/share/doc/html/src/Control.Lens.html"><span class="hs-identifier">Control.Lens</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">HGeometry.Intersection</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">HGeometry.LineSegment</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">HGeometry.LineSegment.Intersection.BentleyOttmann</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Map.NonEmpty.Monoidal.html"><span class="hs-identifier">HGeometry.Map.NonEmpty.Monoidal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Map.NonEmpty.Monoidal.html#MonoidalNEMap"><span class="hs-identifier">MonoidalNEMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="HGeometry.PlaneGraph.Connected.Type.html"><span class="hs-identifier">HGeometry.PlaneGraph.Connected.Type</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">HGeometry.Point</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Ext.html"><span class="hs-identifier">HGeometry.Ext</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Sequence.NonEmpty.html"><span class="hs-identifier">HGeometry.Sequence.NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Sequence.NonEmpty.html#ViewL1"><span class="hs-identifier">ViewL1</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Sequence.NonEmpty.html#asViewL1"><span class="hs-identifier">asViewL1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Sequence.NonEmpty.html#singletonL1"><span class="hs-identifier">singletonL1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Map.NonEmpty.Monoidal.html"><span class="hs-identifier">HGeometry.Map.NonEmpty.Monoidal</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">MonoidalNEMap</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hiraffe-0.1/doc/html/hiraffe/src/Hiraffe.PlanarGraph.Connected.html"><span class="hs-identifier">Hiraffe.PlanarGraph.Connected</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">zipWith</span></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Coerce</span></span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-comment">-- |  Construct A connected PlaneGraph from a set of intersecting segments.</span><span>
</span><span id="line-40"></span><span class="hs-comment">--</span><span>
</span><span id="line-41"></span><span class="hs-comment">-- \( O((n+k)\log n) \), where \(n\) is the number of segments, and \(k\) is the number</span><span>
</span><span id="line-42"></span><span class="hs-comment">-- of intersections.</span><span>
</span><span id="line-43"></span><span class="hs-comment">--</span><span>
</span><span id="line-44"></span><span class="hs-comment">-- pre: the segments actually form a connected graph.</span><span>
</span><span id="line-45"></span><span class="annot"><a href="HGeometry.PlaneGraph.Connected.FromIntersectingSegments.html#fromIntersectingSegments"><span class="hs-identifier hs-type">fromIntersectingSegments</span></a></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679480984"><span class="annot"><a href="#local-6989586621679480984"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621679480968"><span class="annot"><a href="#local-6989586621679480968"><span class="hs-identifier hs-type">nonEmpty</span></a></span></span><span> </span><span id="local-6989586621679480970"><span class="annot"><a href="#local-6989586621679480970"><span class="hs-identifier hs-type">ix</span></a></span></span><span> </span><span id="local-6989586621679480972"><span class="annot"><a href="#local-6989586621679480972"><span class="hs-identifier hs-type">lineSegment</span></a></span></span><span> </span><span id="local-6989586621679480978"><span class="annot"><a href="#local-6989586621679480978"><span class="hs-identifier hs-type">segment</span></a></span></span><span> </span><span id="local-6989586621679480975"><span class="annot"><a href="#local-6989586621679480975"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621679480973"><span class="annot"><a href="#local-6989586621679480973"><span class="hs-identifier hs-type">point</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-46"></span><span>                                 </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable1</span></span><span> </span><span class="annot"><a href="#local-6989586621679480968"><span class="hs-identifier hs-type">nonEmpty</span></a></span><span>
</span><span id="line-47"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.cabal/store/ghc-9.12.2-9b33/indexed-traversable-0.1.4-abf18009c8aa238896def64882e8e8d1f618d0164d9214ba36444910f4d62193/share/doc/html/src/WithIndex.html#FunctorWithIndex"><span class="hs-identifier hs-type">FunctorWithIndex</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679480970"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679480968"><span class="hs-identifier hs-type">nonEmpty</span></a></span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LineSegment_</span></span><span> </span><span class="annot"><a href="#local-6989586621679480972"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679480973"><span class="hs-identifier hs-type">point</span></a></span><span>
</span><span id="line-50"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Point_</span></span><span> </span><span class="annot"><a href="#local-6989586621679480973"><span class="hs-identifier hs-type">point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679480975"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679480975"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679480975"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-51"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Intersection</span></span><span> </span><span class="annot"><a href="#local-6989586621679480972"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679480972"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-52"></span><span>                                   </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LineSegmentLineSegmentIntersection</span></span><span> </span><span class="annot"><a href="#local-6989586621679480978"><span class="hs-identifier hs-type">segment</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LineSegment_</span></span><span> </span><span class="annot"><a href="#local-6989586621679480978"><span class="hs-identifier hs-type">segment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679480973"><span class="hs-identifier hs-type">point</span></a></span><span>
</span><span id="line-54"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IsIntersectableWith</span></span><span> </span><span class="annot"><a href="#local-6989586621679480972"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679480972"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-55"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679480970"><span class="hs-identifier hs-type">ix</span></a></span><span>
</span><span id="line-56"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasOnSegment</span></span><span> </span><span class="annot"><a href="#local-6989586621679480972"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span>
</span><span id="line-57"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StartPointOf</span></span><span> </span><span class="annot"><a href="#local-6989586621679480972"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">EndPointOf</span></span><span> </span><span class="annot"><a href="#local-6989586621679480972"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679480972"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="hs-comment">-- FIXME</span><span>
</span><span id="line-61"></span><span>                                 </span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>                              </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679480968"><span class="hs-identifier hs-type">nonEmpty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679480972"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-63"></span><span>                              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="HGeometry.PlaneGraph.Connected.Type.html#CPlaneGraph"><span class="hs-identifier hs-type">CPlaneGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679480984"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Point</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679480975"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Ext.html#%3A%2B"><span class="hs-operator hs-type">:+</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Seq.Seq</span></span><span> </span><span class="annot"><a href="#local-6989586621679480973"><span class="hs-identifier hs-type">point</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>                                               </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Sequence.NonEmpty.html#ViewL1"><span class="hs-identifier hs-type">ViewL1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679480972"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>                                               </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span id="fromIntersectingSegments"><span class="annot"><span class="annottext">fromIntersectingSegments :: forall {k} (s :: k) (nonEmpty :: * -&gt; *) ix lineSegment segment r
       point.
(Foldable1 nonEmpty, FunctorWithIndex ix nonEmpty,
 LineSegment_ lineSegment point, Point_ point 2 r, Ord r,
 Fractional r,
 Intersection lineSegment lineSegment
 ~ Maybe (LineSegmentLineSegmentIntersection segment),
 LineSegment_ segment point,
 IsIntersectableWith lineSegment lineSegment, Ord ix,
 HasOnSegment lineSegment 2,
 StartPointOf lineSegment ~ EndPointOf lineSegment,
 Eq lineSegment) =&gt;
nonEmpty lineSegment
-&gt; CPlaneGraph s (Point 2 r :+ Seq point) (ViewL1 lineSegment) ()
</span><a href="HGeometry.PlaneGraph.Connected.FromIntersectingSegments.html#fromIntersectingSegments"><span class="hs-identifier hs-var hs-var">fromIntersectingSegments</span></a></span></span><span> </span><span id="local-6989586621679481495"><span class="annot"><span class="annottext">nonEmpty lineSegment
</span><a href="#local-6989586621679481495"><span class="hs-identifier hs-var">segs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">nonEmpty lineSegment
-&gt; Intersections r lineSegment
-&gt; CPlaneGraph s (Point 2 r :+ Seq point) (ViewL1 lineSegment) ()
forall {k} (s :: k) (nonEmpty :: * -&gt; *) lineSegment r point
       planeGraph.
(Foldable1 nonEmpty, LineSegment_ lineSegment point,
 Point_ point 2 r, Ord r, Num r,
 IsIntersectableWith lineSegment lineSegment,
 OrdArounds lineSegment, Eq lineSegment,
 planeGraph
 ~ CPlaneGraph
     s (Point 2 r :+ Seq point) (ViewL1 lineSegment) ()) =&gt;
nonEmpty lineSegment -&gt; Intersections r lineSegment -&gt; planeGraph
</span><a href="HGeometry.PlaneGraph.Connected.FromIntersectingSegments.html#fromIntersections"><span class="hs-identifier hs-var">fromIntersections</span></a></span><span> </span><span class="annot"><span class="annottext">nonEmpty lineSegment
</span><a href="#local-6989586621679481495"><span class="hs-identifier hs-var">segs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">nonEmpty lineSegment -&gt; Intersections r lineSegment
forall (bag :: * -&gt; *) lineSegment seg point r.
(LineSegment_ lineSegment point, Point_ point 2 r, Ord r,
 Fractional r, Foldable bag, Functor bag, Eq lineSegment,
 HasOnSegment lineSegment 2, IntersectConstraints seg lineSegment,
 LineSegment_ seg point,
 StartPointOf lineSegment ~ EndPointOf lineSegment) =&gt;
bag lineSegment -&gt; Intersections r lineSegment
</span><span class="hs-identifier hs-var">intersections</span></span><span> </span><span class="annot"><span class="annottext">nonEmpty lineSegment
</span><a href="#local-6989586621679481495"><span class="hs-identifier hs-var">segs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="hs-comment">----------------------------------------</span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-comment">-- | Construct A connected PlaneGraph from a set of intersecting</span><span>
</span><span id="line-71"></span><span class="hs-comment">-- segments. This assumes we are actually given the intersections as</span><span>
</span><span id="line-72"></span><span class="hs-comment">-- well.</span><span>
</span><span id="line-73"></span><span class="hs-comment">--</span><span>
</span><span id="line-74"></span><span class="hs-comment">-- \( O((n+k)\log n) \), where \(n\) is the number of segments, and \(k\) is the number</span><span>
</span><span id="line-75"></span><span class="hs-comment">-- of intersections.</span><span>
</span><span id="line-76"></span><span class="hs-comment">--</span><span>
</span><span id="line-77"></span><span class="hs-comment">-- pre: the segments actually form a connected graph.</span><span>
</span><span id="line-78"></span><span class="hs-comment">--</span><span>
</span><span id="line-79"></span><span class="hs-comment">-- note: this implementation uses that the lineSegment type is Orderable. Consider using</span><span>
</span><span id="line-80"></span><span class="hs-comment">-- 'ByIndex Int segment' to order by some Identifier, rather than ordering by the raw segments.</span><span>
</span><span id="line-81"></span><span class="annot"><a href="HGeometry.PlaneGraph.Connected.FromIntersectingSegments.html#fromIntersections"><span class="hs-identifier hs-type">fromIntersections</span></a></span><span>             </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679481060"><span class="annot"><a href="#local-6989586621679481060"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621679481055"><span class="annot"><a href="#local-6989586621679481055"><span class="hs-identifier hs-type">nonEmpty</span></a></span></span><span> </span><span id="local-6989586621679481056"><span class="annot"><a href="#local-6989586621679481056"><span class="hs-identifier hs-type">lineSegment</span></a></span></span><span> </span><span id="local-6989586621679481058"><span class="annot"><a href="#local-6989586621679481058"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621679481057"><span class="annot"><a href="#local-6989586621679481057"><span class="hs-identifier hs-type">point</span></a></span></span><span> </span><span id="local-6989586621679481059"><span class="annot"><a href="#local-6989586621679481059"><span class="hs-identifier hs-type">planeGraph</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-82"></span><span>                                   </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable1</span></span><span> </span><span class="annot"><a href="#local-6989586621679481055"><span class="hs-identifier hs-type">nonEmpty</span></a></span><span>
</span><span id="line-83"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LineSegment_</span></span><span> </span><span class="annot"><a href="#local-6989586621679481056"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481057"><span class="hs-identifier hs-type">point</span></a></span><span>
</span><span id="line-84"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Point_</span></span><span> </span><span class="annot"><a href="#local-6989586621679481057"><span class="hs-identifier hs-type">point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679481058"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679481058"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679481058"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-85"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IsIntersectableWith</span></span><span> </span><span class="annot"><a href="#local-6989586621679481056"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481056"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-86"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OrdArounds</span></span><span> </span><span class="annot"><a href="#local-6989586621679481056"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-87"></span><span>                                   </span><span class="hs-comment">-- , Ord lineSegment</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679481056"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="hs-comment">-- FIXME: not sure where this is coming from</span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679481059"><span class="hs-identifier hs-type">planeGraph</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="HGeometry.PlaneGraph.Connected.Type.html#CPlaneGraph"><span class="hs-identifier hs-type">CPlaneGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481060"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Point</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679481058"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Ext.html#%3A%2B"><span class="hs-operator hs-type">:+</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Seq.Seq</span></span><span> </span><span class="annot"><a href="#local-6989586621679481057"><span class="hs-identifier hs-type">point</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>                                                                </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Sequence.NonEmpty.html#ViewL1"><span class="hs-identifier hs-type">ViewL1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481056"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>                                                                </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span>                                   </span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>                              </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679481055"><span class="hs-identifier hs-type">nonEmpty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481056"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-96"></span><span>                              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Intersections</span></span><span> </span><span class="annot"><a href="#local-6989586621679481058"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481056"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-97"></span><span>                              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679481059"><span class="hs-identifier hs-type">planeGraph</span></a></span><span>
</span><span id="line-98"></span><span id="fromIntersections"><span class="annot"><span class="annottext">fromIntersections :: forall {k} (s :: k) (nonEmpty :: * -&gt; *) lineSegment r point
       planeGraph.
(Foldable1 nonEmpty, LineSegment_ lineSegment point,
 Point_ point 2 r, Ord r, Num r,
 IsIntersectableWith lineSegment lineSegment,
 OrdArounds lineSegment, Eq lineSegment,
 planeGraph
 ~ CPlaneGraph
     s (Point 2 r :+ Seq point) (ViewL1 lineSegment) ()) =&gt;
nonEmpty lineSegment -&gt; Intersections r lineSegment -&gt; planeGraph
</span><a href="HGeometry.PlaneGraph.Connected.FromIntersectingSegments.html#fromIntersections"><span class="hs-identifier hs-var hs-var">fromIntersections</span></a></span></span><span> </span><span id="local-6989586621679481923"><span class="annot"><span class="annottext">nonEmpty lineSegment
</span><a href="#local-6989586621679481923"><span class="hs-identifier hs-var">segs</span></a></span></span><span> </span><span id="local-6989586621679481924"><span class="annot"><span class="annottext">Intersections r lineSegment
</span><a href="#local-6989586621679481924"><span class="hs-identifier hs-var">inters</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MonoidalNEMap
  (Point 2 r)
  (VertexId s, Point 2 r :+ Seq point,
   NonEmpty (VertexId s, ViewL1 lineSegment))
-&gt; planeGraph
forall graph (nonEmpty :: * -&gt; *) (h :: * -&gt; *) vi v e.
(ConstructableGraph_ graph, Foldable1 nonEmpty, Functor nonEmpty,
 Foldable h, Functor h, vi ~ VertexIx graph, v ~ Vertex graph,
 e ~ Edge graph, GraphFromAdjListExtraConstraints graph h) =&gt;
nonEmpty (vi, v, h (vi, e)) -&gt; graph
forall (nonEmpty :: * -&gt; *) (h :: * -&gt; *) vi v e.
(Foldable1 nonEmpty, Functor nonEmpty, Foldable h, Functor h,
 vi ~ VertexIx planeGraph, v ~ Vertex planeGraph,
 e ~ Edge planeGraph,
 GraphFromAdjListExtraConstraints planeGraph h) =&gt;
nonEmpty (vi, v, h (vi, e)) -&gt; planeGraph
</span><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hiraffe-0.1/doc/html/hiraffe/src/Hiraffe.Graph.Class.html#fromAdjacencyLists"><span class="hs-identifier hs-var">fromAdjacencyLists</span></a></span><span> </span><span class="annot"><span class="annottext">MonoidalNEMap
  (Point 2 r)
  (VertexIx planeGraph, Point 2 r :+ Seq point,
   NonEmpty (VertexIx planeGraph, ViewL1 lineSegment))
MonoidalNEMap
  (Point 2 r)
  (VertexId s, Point 2 r :+ Seq point,
   NonEmpty (VertexId s, ViewL1 lineSegment))
</span><a href="#local-6989586621679481926"><span class="hs-identifier hs-var">adjLists</span></a></span><span>
</span><span id="line-99"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-100"></span><span>    </span><span class="hs-comment">-- | Map every Point to its vertexId</span><span>
</span><span id="line-101"></span><span>    </span><span class="annot"><a href="#local-6989586621679481927"><span class="hs-identifier hs-type">vertexMapping</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Map.NonEmpty.Monoidal.html#MonoidalNEMap"><span class="hs-identifier hs-type">MonoidalNEMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Point</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679481058"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hiraffe-0.1/doc/html/hiraffe/src/Hiraffe.Graph.Class.html#VertexIx"><span class="hs-identifier hs-type">VertexIx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481059"><span class="hs-identifier hs-type">planeGraph</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>    </span><span id="local-6989586621679481927"><span class="annot"><span class="annottext">vertexMapping :: MonoidalNEMap (Point 2 r) (VertexIx planeGraph)
</span><a href="#local-6989586621679481927"><span class="hs-identifier hs-var hs-var">vertexMapping</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MonoidalNEMap (Point 2 r) Int
-&gt; MonoidalNEMap (Point 2 r) (VertexIx planeGraph)
forall a b. Coercible a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">coerce</span></span><span> </span><span class="annot"><span class="annottext">(MonoidalNEMap (Point 2 r) Int
 -&gt; MonoidalNEMap (Point 2 r) (VertexIx planeGraph))
-&gt; MonoidalNEMap (Point 2 r) Int
-&gt; MonoidalNEMap (Point 2 r) (VertexIx planeGraph)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MonoidalNEMap (Point 2 r) (Associated lineSegment)
-&gt; MonoidalNEMap (Point 2 r) Int
forall k v. MonoidalNEMap k v -&gt; MonoidalNEMap k Int
</span><a href="HGeometry.PlaneGraph.Connected.FromIntersectingSegments.html#assignIndex"><span class="hs-identifier hs-var">assignIndex</span></a></span><span> </span><span class="annot"><span class="annottext">MonoidalNEMap (Point 2 r) (Associated lineSegment)
</span><a href="#local-6989586621679481929"><span class="hs-identifier hs-var">vertexLocations</span></a></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-comment">-- | For each vertex location, collect the segment endpoints</span><span>
</span><span id="line-105"></span><span>    </span><span class="annot"><a href="#local-6989586621679481930"><span class="hs-identifier hs-type">segmentEndPoints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Map.NonEmpty.Monoidal.html#MonoidalNEMap"><span class="hs-identifier hs-type">MonoidalNEMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Point</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679481058"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Sequence.NonEmpty.html#ViewL1"><span class="hs-identifier hs-type">ViewL1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481057"><span class="hs-identifier hs-type">point</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span>    </span><span id="local-6989586621679481930"><span class="annot"><span class="annottext">segmentEndPoints :: MonoidalNEMap (Point 2 r) (ViewL1 point)
</span><a href="#local-6989586621679481930"><span class="hs-identifier hs-var hs-var">segmentEndPoints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(lineSegment -&gt; MonoidalNEMap (Point 2 r) (ViewL1 point))
-&gt; nonEmpty lineSegment -&gt; MonoidalNEMap (Point 2 r) (ViewL1 point)
forall m a. Semigroup m =&gt; (a -&gt; m) -&gt; nonEmpty a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable1 t, Semigroup m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap1</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LineSegment_</span></span><span> </span><span id="local-6989586621679481933"><span class="annot"><span class="annottext">point
</span><a href="#local-6989586621679481933"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679481934"><span class="annot"><span class="annottext">point
</span><a href="#local-6989586621679481934"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-107"></span><span>                                   </span><span class="annot"><span class="annottext">Point 2 r
-&gt; ViewL1 point -&gt; MonoidalNEMap (Point 2 r) (ViewL1 point)
forall k v. k -&gt; v -&gt; MonoidalNEMap k v
</span><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Map.NonEmpty.Monoidal.html#singleton"><span class="hs-identifier hs-var">MonoidalNEMap.singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">point
</span><a href="#local-6989586621679481933"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">point -&gt; Getting (Point 2 r) point (Point 2 r) -&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.12.2-9b33/lens-5.3.5-af8f0435b03c00f06f5d03b52ea927527529d0c03b8a7eee42e07e484fdea6cb/share/doc/html/src/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">Getting (Point 2 r) point (Point 2 r)
forall point (d :: Nat) r.
Point_ point d r =&gt;
Lens' point (Point d r)
Lens' point (Point 2 r)
</span><span class="hs-identifier hs-var">asPoint</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">point -&gt; ViewL1 point
forall a. a -&gt; ViewL1 a
</span><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Sequence.NonEmpty.html#singletonL1"><span class="hs-identifier hs-var">singletonL1</span></a></span><span> </span><span class="annot"><span class="annottext">point
</span><a href="#local-6989586621679481933"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span>                                </span><span class="annot"><span class="annottext">MonoidalNEMap (Point 2 r) (ViewL1 point)
-&gt; MonoidalNEMap (Point 2 r) (ViewL1 point)
-&gt; MonoidalNEMap (Point 2 r) (ViewL1 point)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
-&gt; ViewL1 point -&gt; MonoidalNEMap (Point 2 r) (ViewL1 point)
forall k v. k -&gt; v -&gt; MonoidalNEMap k v
</span><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Map.NonEmpty.Monoidal.html#singleton"><span class="hs-identifier hs-var">MonoidalNEMap.singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">point
</span><a href="#local-6989586621679481934"><span class="hs-identifier hs-var">t</span></a></span><span class="annot"><span class="annottext">point -&gt; Getting (Point 2 r) point (Point 2 r) -&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.12.2-9b33/lens-5.3.5-af8f0435b03c00f06f5d03b52ea927527529d0c03b8a7eee42e07e484fdea6cb/share/doc/html/src/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">Getting (Point 2 r) point (Point 2 r)
forall point (d :: Nat) r.
Point_ point d r =&gt;
Lens' point (Point d r)
Lens' point (Point 2 r)
</span><span class="hs-identifier hs-var">asPoint</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">point -&gt; ViewL1 point
forall a. a -&gt; ViewL1 a
</span><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Sequence.NonEmpty.html#singletonL1"><span class="hs-identifier hs-var">singletonL1</span></a></span><span> </span><span class="annot"><span class="annottext">point
</span><a href="#local-6989586621679481934"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>                                </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">nonEmpty lineSegment
</span><a href="#local-6989586621679481923"><span class="hs-identifier hs-var">segs</span></a></span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span>    </span><span class="annot"><a href="#local-6989586621679481929"><span class="hs-identifier hs-type">vertexLocations</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Map.NonEmpty.Monoidal.html#MonoidalNEMap"><span class="hs-identifier hs-type">MonoidalNEMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Point</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679481058"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Associated</span></span><span> </span><span class="annot"><a href="#local-6989586621679481056"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>    </span><span id="local-6989586621679481929"><span class="annot"><span class="annottext">vertexLocations :: MonoidalNEMap (Point 2 r) (Associated lineSegment)
</span><a href="#local-6989586621679481929"><span class="hs-identifier hs-var hs-var">vertexLocations</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(lineSegment -&gt; MonoidalNEMap (Point 2 r) (Associated lineSegment))
-&gt; nonEmpty lineSegment
-&gt; MonoidalNEMap (Point 2 r) (Associated lineSegment)
forall m a. Semigroup m =&gt; (a -&gt; m) -&gt; nonEmpty a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable1 t, Semigroup m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap1</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679481938"><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679481938"><span class="hs-identifier hs-var">seg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Point 2 r
-&gt; Associated lineSegment
-&gt; MonoidalNEMap (Point 2 r) (Associated lineSegment)
forall k v. k -&gt; v -&gt; MonoidalNEMap k v
</span><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Map.NonEmpty.Monoidal.html#singleton"><span class="hs-identifier hs-var">MonoidalNEMap.singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679481938"><span class="hs-identifier hs-var">seg</span></a></span><span class="annot"><span class="annottext">lineSegment
-&gt; Getting (Point 2 r) lineSegment (Point 2 r) -&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.12.2-9b33/lens-5.3.5-af8f0435b03c00f06f5d03b52ea927527529d0c03b8a7eee42e07e484fdea6cb/share/doc/html/src/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">(point -&gt; Const (Point 2 r) point)
-&gt; lineSegment -&gt; Const (Point 2 r) lineSegment
forall seg p. HasStart seg p =&gt; Lens' seg p
Lens' lineSegment point
</span><span class="hs-identifier hs-var">start</span></span><span class="annot"><span class="annottext">((point -&gt; Const (Point 2 r) point)
 -&gt; lineSegment -&gt; Const (Point 2 r) lineSegment)
-&gt; Getting (Point 2 r) point (Point 2 r)
-&gt; Getting (Point 2 r) lineSegment (Point 2 r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">Getting (Point 2 r) point (Point 2 r)
forall point (d :: Nat) r.
Point_ point d r =&gt;
Lens' point (Point d r)
Lens' point (Point 2 r)
</span><span class="hs-identifier hs-var">asPoint</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">lineSegment -&gt; Associated lineSegment
forall lineSegment. lineSegment -&gt; Associated lineSegment
</span><span class="hs-identifier hs-var">mkAroundStart</span></span><span> </span><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679481938"><span class="hs-identifier hs-var">seg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span>                                     </span><span class="annot"><span class="annottext">MonoidalNEMap (Point 2 r) (Associated lineSegment)
-&gt; MonoidalNEMap (Point 2 r) (Associated lineSegment)
-&gt; MonoidalNEMap (Point 2 r) (Associated lineSegment)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
-&gt; Associated lineSegment
-&gt; MonoidalNEMap (Point 2 r) (Associated lineSegment)
forall k v. k -&gt; v -&gt; MonoidalNEMap k v
</span><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Map.NonEmpty.Monoidal.html#singleton"><span class="hs-identifier hs-var">MonoidalNEMap.singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679481938"><span class="hs-identifier hs-var">seg</span></a></span><span class="annot"><span class="annottext">lineSegment
-&gt; Getting (Point 2 r) lineSegment (Point 2 r) -&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.12.2-9b33/lens-5.3.5-af8f0435b03c00f06f5d03b52ea927527529d0c03b8a7eee42e07e484fdea6cb/share/doc/html/src/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">(point -&gt; Const (Point 2 r) point)
-&gt; lineSegment -&gt; Const (Point 2 r) lineSegment
forall seg p. HasEnd seg p =&gt; Lens' seg p
Lens' lineSegment point
</span><span class="hs-identifier hs-var">end</span></span><span class="annot"><span class="annottext">((point -&gt; Const (Point 2 r) point)
 -&gt; lineSegment -&gt; Const (Point 2 r) lineSegment)
-&gt; Getting (Point 2 r) point (Point 2 r)
-&gt; Getting (Point 2 r) lineSegment (Point 2 r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">Getting (Point 2 r) point (Point 2 r)
forall point (d :: Nat) r.
Point_ point d r =&gt;
Lens' point (Point d r)
Lens' point (Point 2 r)
</span><span class="hs-identifier hs-var">asPoint</span></span><span class="hs-special">)</span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">lineSegment -&gt; Associated lineSegment
forall lineSegment. lineSegment -&gt; Associated lineSegment
</span><span class="hs-identifier hs-var">mkAroundEnd</span></span><span> </span><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679481938"><span class="hs-identifier hs-var">seg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>                               </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">nonEmpty lineSegment
</span><a href="#local-6989586621679481923"><span class="hs-identifier hs-var">segs</span></a></span><span>
</span><span id="line-115"></span><span>                    </span><span class="annot"><span class="annottext">MonoidalNEMap (Point 2 r) (Associated lineSegment)
-&gt; Intersections r lineSegment
-&gt; MonoidalNEMap (Point 2 r) (Associated lineSegment)
forall k v.
(Ord k, Semigroup v) =&gt;
MonoidalNEMap k v -&gt; Map k v -&gt; MonoidalNEMap k v
</span><a href="HGeometry.PlaneGraph.Connected.FromIntersectingSegments.html#%3C%3E%3E"><span class="hs-operator hs-var">&lt;&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Intersections r lineSegment
</span><a href="#local-6989586621679481924"><span class="hs-identifier hs-var">inters</span></a></span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-comment">-- | Compute, for each input segment its canonical line segment;</span><span>
</span><span id="line-118"></span><span>    </span><span class="hs-comment">-- i.e. if there are duplicate segments; we all represent them using the same ClosedLineSegment</span><span>
</span><span id="line-119"></span><span>    </span><span class="annot"><a href="#local-6989586621679481945"><span class="hs-identifier hs-type">canonicalSegmentMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Map.NonEmpty.Monoidal.html#MonoidalNEMap"><span class="hs-identifier hs-type">MonoidalNEMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ClosedLineSegment</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Point</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679481058"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Sequence.NonEmpty.html#ViewL1"><span class="hs-identifier hs-type">ViewL1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481056"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>    </span><span id="local-6989586621679481945"><span class="annot"><span class="annottext">canonicalSegmentMap :: MonoidalNEMap (ClosedLineSegment (Point 2 r)) (ViewL1 lineSegment)
</span><a href="#local-6989586621679481945"><span class="hs-identifier hs-var hs-var">canonicalSegmentMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-121"></span><span>      </span><span class="annot"><span class="annottext">(lineSegment
 -&gt; MonoidalNEMap
      (ClosedLineSegment (Point 2 r)) (ViewL1 lineSegment))
-&gt; nonEmpty lineSegment
-&gt; MonoidalNEMap
     (ClosedLineSegment (Point 2 r)) (ViewL1 lineSegment)
forall m a. Semigroup m =&gt; (a -&gt; m) -&gt; nonEmpty a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable1 t, Semigroup m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap1</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679481946"><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679481946"><span class="hs-identifier hs-var">seg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ClosedLineSegment (Point 2 r)
-&gt; ViewL1 lineSegment
-&gt; MonoidalNEMap
     (ClosedLineSegment (Point 2 r)) (ViewL1 lineSegment)
forall k v. k -&gt; v -&gt; MonoidalNEMap k v
</span><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Map.NonEmpty.Monoidal.html#singleton"><span class="hs-identifier hs-var">MonoidalNEMap.singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">lineSegment
-&gt; ClosedLineSegment (Point (Dimension point) (NumType point))
forall {p} {p} {s}.
(Dimension p ~ Dimension p, NumType p ~ NumType p, HasEnd s p,
 HasStart s p, Point_ p (Dimension p) (NumType p),
 Point_ p (Dimension p) (NumType p),
 Ord (Vector (Dimension p) (NumType p))) =&gt;
s -&gt; ClosedLineSegment (Point (Dimension p) (NumType p))
</span><a href="#local-6989586621679481947"><span class="hs-identifier hs-var">toKey</span></a></span><span> </span><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679481946"><span class="hs-identifier hs-var">seg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">lineSegment -&gt; ViewL1 lineSegment
forall a. a -&gt; ViewL1 a
</span><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Sequence.NonEmpty.html#singletonL1"><span class="hs-identifier hs-var">singletonL1</span></a></span><span> </span><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679481946"><span class="hs-identifier hs-var">seg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">nonEmpty lineSegment
</span><a href="#local-6989586621679481923"><span class="hs-identifier hs-var">segs</span></a></span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span>    </span><span id="local-6989586621679481947"><span class="annot"><span class="annottext">toKey :: s -&gt; ClosedLineSegment (Point (Dimension p) (NumType p))
</span><a href="#local-6989586621679481947"><span class="hs-identifier hs-var hs-var">toKey</span></a></span></span><span> </span><span id="local-6989586621679482081"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679482081"><span class="hs-identifier hs-var">seg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679482082"><span class="annot"><span class="annottext">s :: Point (Dimension p) (NumType p)
</span><a href="#local-6989586621679482082"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679482081"><span class="hs-identifier hs-var">seg</span></a></span><span class="annot"><span class="annottext">s
-&gt; Getting
     (Point (Dimension p) (NumType p))
     s
     (Point (Dimension p) (NumType p))
-&gt; Point (Dimension p) (NumType p)
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.12.2-9b33/lens-5.3.5-af8f0435b03c00f06f5d03b52ea927527529d0c03b8a7eee42e07e484fdea6cb/share/doc/html/src/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">(p -&gt; Const (Point (Dimension p) (NumType p)) p)
-&gt; s -&gt; Const (Point (Dimension p) (NumType p)) s
forall seg p. HasStart seg p =&gt; Lens' seg p
Lens' s p
</span><span class="hs-identifier hs-var">start</span></span><span class="annot"><span class="annottext">((p -&gt; Const (Point (Dimension p) (NumType p)) p)
 -&gt; s -&gt; Const (Point (Dimension p) (NumType p)) s)
-&gt; ((Point (Dimension p) (NumType p)
     -&gt; Const
          (Point (Dimension p) (NumType p))
          (Point (Dimension p) (NumType p)))
    -&gt; p -&gt; Const (Point (Dimension p) (NumType p)) p)
-&gt; Getting
     (Point (Dimension p) (NumType p))
     s
     (Point (Dimension p) (NumType p))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Point (Dimension p) (NumType p)
 -&gt; Const
      (Point (Dimension p) (NumType p))
      (Point (Dimension p) (NumType p)))
-&gt; p -&gt; Const (Point (Dimension p) (NumType p)) p
forall point (d :: Nat) r.
Point_ point d r =&gt;
Lens' point (Point d r)
Lens' p (Point (Dimension p) (NumType p))
</span><span class="hs-identifier hs-var">asPoint</span></span><span>
</span><span id="line-124"></span><span>                    </span><span id="local-6989586621679482083"><span class="annot"><span class="annottext">t :: Point (Dimension p) (NumType p)
</span><a href="#local-6989586621679482083"><span class="hs-identifier hs-var hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679482081"><span class="hs-identifier hs-var">seg</span></a></span><span class="annot"><span class="annottext">s
-&gt; Getting
     (Point (Dimension p) (NumType p))
     s
     (Point (Dimension p) (NumType p))
-&gt; Point (Dimension p) (NumType p)
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.12.2-9b33/lens-5.3.5-af8f0435b03c00f06f5d03b52ea927527529d0c03b8a7eee42e07e484fdea6cb/share/doc/html/src/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">(p -&gt; Const (Point (Dimension p) (NumType p)) p)
-&gt; s -&gt; Const (Point (Dimension p) (NumType p)) s
forall seg p. HasEnd seg p =&gt; Lens' seg p
Lens' s p
</span><span class="hs-identifier hs-var">end</span></span><span class="annot"><span class="annottext">((p -&gt; Const (Point (Dimension p) (NumType p)) p)
 -&gt; s -&gt; Const (Point (Dimension p) (NumType p)) s)
-&gt; ((Point (Dimension p) (NumType p)
     -&gt; Const
          (Point (Dimension p) (NumType p))
          (Point (Dimension p) (NumType p)))
    -&gt; p -&gt; Const (Point (Dimension p) (NumType p)) p)
-&gt; Getting
     (Point (Dimension p) (NumType p))
     s
     (Point (Dimension p) (NumType p))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Point (Dimension p) (NumType p)
 -&gt; Const
      (Point (Dimension p) (NumType p))
      (Point (Dimension p) (NumType p)))
-&gt; p -&gt; Const (Point (Dimension p) (NumType p)) p
forall point (d :: Nat) r.
Point_ point d r =&gt;
Lens' point (Point d r)
Lens' p (Point (Dimension p) (NumType p))
</span><span class="hs-identifier hs-var">asPoint</span></span><span>
</span><span id="line-125"></span><span>                </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Point (Dimension p) (NumType p)
</span><a href="#local-6989586621679482082"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Point (Dimension p) (NumType p)
-&gt; Point (Dimension p) (NumType p) -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Point (Dimension p) (NumType p)
</span><a href="#local-6989586621679482083"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Point (Dimension p) (NumType p)
-&gt; Point (Dimension p) (NumType p)
-&gt; ClosedLineSegment (Point (Dimension p) (NumType p))
forall point. point -&gt; point -&gt; ClosedLineSegment point
</span><span class="hs-identifier hs-var">ClosedLineSegment</span></span><span> </span><span class="annot"><span class="annottext">Point (Dimension p) (NumType p)
</span><a href="#local-6989586621679482082"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Point (Dimension p) (NumType p)
</span><a href="#local-6989586621679482083"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Point (Dimension p) (NumType p)
-&gt; Point (Dimension p) (NumType p)
-&gt; ClosedLineSegment (Point (Dimension p) (NumType p))
forall point. point -&gt; point -&gt; ClosedLineSegment point
</span><span class="hs-identifier hs-var">ClosedLineSegment</span></span><span> </span><span class="annot"><span class="annottext">Point (Dimension p) (NumType p)
</span><a href="#local-6989586621679482083"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Point (Dimension p) (NumType p)
</span><a href="#local-6989586621679482082"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span>    </span><span class="hs-comment">-- the canonical segments themselves</span><span>
</span><span id="line-128"></span><span>    </span><span id="local-6989586621679482086"><span class="annot"><span class="annottext">canonicalSegments :: NESet (ClosedLineSegment (Point 2 r))
</span><a href="#local-6989586621679482086"><span class="hs-identifier hs-var hs-var">canonicalSegments</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MonoidalNEMap (ClosedLineSegment (Point 2 r)) (ViewL1 lineSegment)
-&gt; NESet (ClosedLineSegment (Point 2 r))
forall k v. MonoidalNEMap k v -&gt; NESet k
</span><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Map.NonEmpty.Monoidal.html#keysSet"><span class="hs-identifier hs-var">MonoidalNEMap.keysSet</span></a></span><span> </span><span class="annot"><span class="annottext">MonoidalNEMap (ClosedLineSegment (Point 2 r)) (ViewL1 lineSegment)
</span><a href="#local-6989586621679481945"><span class="hs-identifier hs-var">canonicalSegmentMap</span></a></span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-comment">-- | Computes the vertices along each segment.</span><span>
</span><span id="line-131"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-132"></span><span>    </span><span class="hs-comment">-- We actually represent every original input segment by a canonical ClosedLineSegment</span><span>
</span><span id="line-133"></span><span>    </span><span class="hs-comment">-- to appropriately handle duplicate input segments.</span><span>
</span><span id="line-134"></span><span>    </span><span class="annot"><a href="#local-6989586621679482088"><span class="hs-identifier hs-type">verticesBySegment</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Map.NonEmpty.Monoidal.html#MonoidalNEMap"><span class="hs-identifier hs-type">MonoidalNEMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ClosedLineSegment</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Point</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679481058"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span>                                       </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Sequence.NonEmpty.html#ViewL1"><span class="hs-identifier hs-type">ViewL1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hiraffe-0.1/doc/html/hiraffe/src/Hiraffe.Graph.Class.html#VertexIx"><span class="hs-identifier hs-type">VertexIx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481059"><span class="hs-identifier hs-type">planeGraph</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>    </span><span id="local-6989586621679482088"><span class="annot"><span class="annottext">verticesBySegment :: MonoidalNEMap
  (ClosedLineSegment (Point 2 r)) (ViewL1 (VertexIx planeGraph))
</span><a href="#local-6989586621679482088"><span class="hs-identifier hs-var hs-var">verticesBySegment</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-137"></span><span>        </span><span class="annot"><span class="annottext">(ClosedLineSegment (Point 2 r)
 -&gt; Seq (Point 2 r) -&gt; ViewL1 (VertexIx planeGraph))
-&gt; MonoidalNEMap (ClosedLineSegment (Point 2 r)) (Seq (Point 2 r))
-&gt; MonoidalNEMap
     (ClosedLineSegment (Point 2 r)) (ViewL1 (VertexIx planeGraph))
forall a b.
(ClosedLineSegment (Point 2 r) -&gt; a -&gt; b)
-&gt; MonoidalNEMap (ClosedLineSegment (Point 2 r)) a
-&gt; MonoidalNEMap (ClosedLineSegment (Point 2 r)) b
forall i (f :: * -&gt; *) a b.
FunctorWithIndex i f =&gt;
(i -&gt; a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///home/runner/.cabal/store/ghc-9.12.2-9b33/indexed-traversable-0.1.4-abf18009c8aa238896def64882e8e8d1f618d0164d9214ba36444910f4d62193/share/doc/html/src/WithIndex.html#imap"><span class="hs-identifier hs-var">imap</span></a></span><span> </span><span class="annot"><span class="annottext">ClosedLineSegment (Point 2 r)
-&gt; Seq (Point 2 r) -&gt; ViewL1 (VertexIx planeGraph)
ClosedLineSegment (Point 2 r)
-&gt; Seq (Point 2 r) -&gt; ViewL1 (VertexId s)
</span><a href="#local-6989586621679482090"><span class="hs-identifier hs-var">collect</span></a></span><span> </span><span class="annot"><span class="annottext">(MonoidalNEMap (ClosedLineSegment (Point 2 r)) (Seq (Point 2 r))
 -&gt; MonoidalNEMap
      (ClosedLineSegment (Point 2 r)) (ViewL1 (VertexIx planeGraph)))
-&gt; MonoidalNEMap (ClosedLineSegment (Point 2 r)) (Seq (Point 2 r))
-&gt; MonoidalNEMap
     (ClosedLineSegment (Point 2 r)) (ViewL1 (VertexIx planeGraph))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(lineSegment -&gt; ClosedLineSegment (Point 2 r))
-&gt; NESet (ClosedLineSegment (Point 2 r))
-&gt; Intersections r lineSegment
-&gt; MonoidalNEMap (ClosedLineSegment (Point 2 r)) (Seq (Point 2 r))
forall lineSegment (nonEmpty :: * -&gt; *) richSegment r.
(Ord lineSegment, Foldable1 nonEmpty) =&gt;
(richSegment -&gt; lineSegment)
-&gt; nonEmpty lineSegment
-&gt; Intersections r richSegment
-&gt; MonoidalNEMap lineSegment (Seq (Point 2 r))
</span><a href="HGeometry.PlaneGraph.Connected.FromIntersectingSegments.html#interiorIntersectionsBySegment"><span class="hs-identifier hs-var">interiorIntersectionsBySegment</span></a></span><span> </span><span class="annot"><span class="annottext">lineSegment -&gt; ClosedLineSegment (Point 2 r)
lineSegment
-&gt; ClosedLineSegment (Point (Dimension point) (NumType point))
forall {p} {p} {s}.
(Dimension p ~ Dimension p, NumType p ~ NumType p, HasEnd s p,
 HasStart s p, Point_ p (Dimension p) (NumType p),
 Point_ p (Dimension p) (NumType p),
 Ord (Vector (Dimension p) (NumType p))) =&gt;
s -&gt; ClosedLineSegment (Point (Dimension p) (NumType p))
</span><a href="#local-6989586621679481947"><span class="hs-identifier hs-var">toKey</span></a></span><span> </span><span class="annot"><span class="annottext">NESet (ClosedLineSegment (Point 2 r))
</span><a href="#local-6989586621679482086"><span class="hs-identifier hs-var">canonicalSegments</span></a></span><span> </span><span class="annot"><span class="annottext">Intersections r lineSegment
</span><a href="#local-6989586621679481924"><span class="hs-identifier hs-var">inters</span></a></span><span>
</span><span id="line-138"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-139"></span><span>        </span><span id="local-6989586621679482090"><span class="annot"><span class="annottext">collect :: ClosedLineSegment (Point 2 r)
-&gt; Seq (Point 2 r) -&gt; ViewL1 (VertexId s)
</span><a href="#local-6989586621679482090"><span class="hs-identifier hs-var hs-var">collect</span></a></span></span><span> </span><span id="local-6989586621679482092"><span class="annot"><span class="annottext">ClosedLineSegment (Point 2 r)
</span><a href="#local-6989586621679482092"><span class="hs-identifier hs-var">seg</span></a></span></span><span> </span><span id="local-6989586621679482093"><span class="annot"><span class="annottext">Seq (Point 2 r)
</span><a href="#local-6989586621679482093"><span class="hs-identifier hs-var">interiorPts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MonoidalNEMap (Point 2 r) (VertexIx planeGraph)
MonoidalNEMap (Point 2 r) (VertexId s)
</span><a href="#local-6989586621679481927"><span class="hs-identifier hs-var">vertexMapping</span></a></span><span> </span><span class="annot"><span class="annottext">MonoidalNEMap (Point 2 r) (VertexId s) -&gt; Point 2 r -&gt; VertexId s
forall k v. Ord k =&gt; MonoidalNEMap k v -&gt; k -&gt; v
</span><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Map.NonEmpty.Monoidal.html#%21"><span class="hs-operator hs-var">MonoidalNEMap.!</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Point 2 r -&gt; VertexId s)
-&gt; ViewL1 (Point 2 r) -&gt; ViewL1 (VertexId s)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span>
</span><span id="line-140"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClosedLineSegment (Point 2 r)
</span><a href="#local-6989586621679482092"><span class="hs-identifier hs-var">seg</span></a></span><span class="annot"><span class="annottext">ClosedLineSegment (Point 2 r)
-&gt; Getting (Point 2 r) (ClosedLineSegment (Point 2 r)) (Point 2 r)
-&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.12.2-9b33/lens-5.3.5-af8f0435b03c00f06f5d03b52ea927527529d0c03b8a7eee42e07e484fdea6cb/share/doc/html/src/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">Getting (Point 2 r) (ClosedLineSegment (Point 2 r)) (Point 2 r)
forall seg p. HasStart seg p =&gt; Lens' seg p
Lens' (ClosedLineSegment (Point 2 r)) (Point 2 r)
</span><span class="hs-identifier hs-var">start</span></span><span class="annot"><span class="annottext">Getting (Point 2 r) (ClosedLineSegment (Point 2 r)) (Point 2 r)
-&gt; ((Point 2 r -&gt; Const (Point 2 r) (Point 2 r))
    -&gt; Point 2 r -&gt; Const (Point 2 r) (Point 2 r))
-&gt; Getting (Point 2 r) (ClosedLineSegment (Point 2 r)) (Point 2 r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Point 2 r -&gt; Const (Point 2 r) (Point 2 r))
-&gt; Point 2 r -&gt; Const (Point 2 r) (Point 2 r)
forall point (d :: Nat) r.
Point_ point d r =&gt;
Lens' point (Point d r)
Lens' (Point 2 r) (Point 2 r)
</span><span class="hs-identifier hs-var">asPoint</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Seq (Point 2 r) -&gt; ViewL1 (Point 2 r)
forall a. a -&gt; Seq a -&gt; ViewL1 a
</span><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Sequence.NonEmpty.html#%3A%3C%3C"><span class="hs-operator hs-var">:&lt;&lt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Seq (Point 2 r)
</span><a href="#local-6989586621679482097"><span class="hs-identifier hs-var">interiorPts'</span></a></span><span> </span><span class="annot"><span class="annottext">Seq (Point 2 r) -&gt; Point 2 r -&gt; Seq (Point 2 r)
forall a. Seq a -&gt; a -&gt; Seq a
</span><span class="hs-operator hs-var">Seq.|&gt;</span></span><span> </span><span class="annot"><span class="annottext">ClosedLineSegment (Point 2 r)
</span><a href="#local-6989586621679482092"><span class="hs-identifier hs-var">seg</span></a></span><span class="annot"><span class="annottext">ClosedLineSegment (Point 2 r)
-&gt; Getting (Point 2 r) (ClosedLineSegment (Point 2 r)) (Point 2 r)
-&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.12.2-9b33/lens-5.3.5-af8f0435b03c00f06f5d03b52ea927527529d0c03b8a7eee42e07e484fdea6cb/share/doc/html/src/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">Getting (Point 2 r) (ClosedLineSegment (Point 2 r)) (Point 2 r)
forall seg p. HasEnd seg p =&gt; Lens' seg p
Lens' (ClosedLineSegment (Point 2 r)) (Point 2 r)
</span><span class="hs-identifier hs-var">end</span></span><span class="annot"><span class="annottext">Getting (Point 2 r) (ClosedLineSegment (Point 2 r)) (Point 2 r)
-&gt; ((Point 2 r -&gt; Const (Point 2 r) (Point 2 r))
    -&gt; Point 2 r -&gt; Const (Point 2 r) (Point 2 r))
-&gt; Getting (Point 2 r) (ClosedLineSegment (Point 2 r)) (Point 2 r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Point 2 r -&gt; Const (Point 2 r) (Point 2 r))
-&gt; Point 2 r -&gt; Const (Point 2 r) (Point 2 r)
forall point (d :: Nat) r.
Point_ point d r =&gt;
Lens' point (Point d r)
Lens' (Point 2 r) (Point 2 r)
</span><span class="hs-identifier hs-var">asPoint</span></span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-142"></span><span>            </span><span id="local-6989586621679482097"><span class="annot"><span class="annottext">interiorPts' :: Seq (Point 2 r)
</span><a href="#local-6989586621679482097"><span class="hs-identifier hs-var hs-var">interiorPts'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Point 2 r -&gt; r) -&gt; Seq (Point 2 r) -&gt; Seq (Point 2 r)
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Seq a -&gt; Seq a
</span><span class="hs-identifier hs-var">Seq.sortOn</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; r
</span><a href="#local-6989586621679482100"><span class="hs-identifier hs-var">alongSegment</span></a></span><span> </span><span class="annot"><span class="annottext">Seq (Point 2 r)
</span><a href="#local-6989586621679482093"><span class="hs-identifier hs-var">interiorPts</span></a></span><span>
</span><span id="line-143"></span><span>            </span><span class="hs-comment">-- | We want to sort the points, which all lie on the segment, along the segment</span><span>
</span><span id="line-144"></span><span>            </span><span class="hs-comment">-- to this end we essentially compare their distance to the starting point.</span><span>
</span><span id="line-145"></span><span>            </span><span class="hs-comment">-- however, instead of explicitly computing this distance, it suffices to compare</span><span>
</span><span id="line-146"></span><span>            </span><span class="hs-comment">-- the x-coordinates or y-coordiantes of the points themselves, depending on the</span><span>
</span><span id="line-147"></span><span>            </span><span class="hs-comment">-- orientation of the segment. (since a segment is xy-monotone)</span><span>
</span><span id="line-148"></span><span>            </span><span class="annot"><a href="#local-6989586621679482100"><span class="hs-identifier hs-type">alongSegment</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Point</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679481058"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679481058"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-149"></span><span>            </span><span id="local-6989586621679482100"><span class="annot"><span class="annottext">alongSegment :: Point 2 r -&gt; r
</span><a href="#local-6989586621679482100"><span class="hs-identifier hs-var hs-var">alongSegment</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClosedLineSegment (Point 2 r)
</span><a href="#local-6989586621679482092"><span class="hs-identifier hs-var">seg</span></a></span><span class="annot"><span class="annottext">ClosedLineSegment (Point 2 r)
-&gt; Getting r (ClosedLineSegment (Point 2 r)) r -&gt; r
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.12.2-9b33/lens-5.3.5-af8f0435b03c00f06f5d03b52ea927527529d0c03b8a7eee42e07e484fdea6cb/share/doc/html/src/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">(Point 2 r -&gt; Const r (Point 2 r))
-&gt; ClosedLineSegment (Point 2 r)
-&gt; Const r (ClosedLineSegment (Point 2 r))
forall seg p. HasStart seg p =&gt; Lens' seg p
Lens' (ClosedLineSegment (Point 2 r)) (Point 2 r)
</span><span class="hs-identifier hs-var">start</span></span><span class="annot"><span class="annottext">((Point 2 r -&gt; Const r (Point 2 r))
 -&gt; ClosedLineSegment (Point 2 r)
 -&gt; Const r (ClosedLineSegment (Point 2 r)))
-&gt; ((r -&gt; Const r r) -&gt; Point 2 r -&gt; Const r (Point 2 r))
-&gt; Getting r (ClosedLineSegment (Point 2 r)) r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(r -&gt; Const r r) -&gt; Point 2 r -&gt; Const r (Point 2 r)
forall (d :: Nat) point r.
(1 &lt;= d, Point_ point d r) =&gt;
IndexedLens' Int point r
IndexedLens' Int (Point 2 r) r
</span><span class="hs-identifier hs-var">xCoord</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">r -&gt; r -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClosedLineSegment (Point 2 r)
</span><a href="#local-6989586621679482092"><span class="hs-identifier hs-var">seg</span></a></span><span class="annot"><span class="annottext">ClosedLineSegment (Point 2 r)
-&gt; Getting r (ClosedLineSegment (Point 2 r)) r -&gt; r
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.12.2-9b33/lens-5.3.5-af8f0435b03c00f06f5d03b52ea927527529d0c03b8a7eee42e07e484fdea6cb/share/doc/html/src/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">(Point 2 r -&gt; Const r (Point 2 r))
-&gt; ClosedLineSegment (Point 2 r)
-&gt; Const r (ClosedLineSegment (Point 2 r))
forall seg p. HasEnd seg p =&gt; Lens' seg p
Lens' (ClosedLineSegment (Point 2 r)) (Point 2 r)
</span><span class="hs-identifier hs-var">end</span></span><span class="annot"><span class="annottext">((Point 2 r -&gt; Const r (Point 2 r))
 -&gt; ClosedLineSegment (Point 2 r)
 -&gt; Const r (ClosedLineSegment (Point 2 r)))
-&gt; ((r -&gt; Const r r) -&gt; Point 2 r -&gt; Const r (Point 2 r))
-&gt; Getting r (ClosedLineSegment (Point 2 r)) r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(r -&gt; Const r r) -&gt; Point 2 r -&gt; Const r (Point 2 r)
forall (d :: Nat) point r.
(1 &lt;= d, Point_ point d r) =&gt;
IndexedLens' Int point r
IndexedLens' Int (Point 2 r) r
</span><span class="hs-identifier hs-var">xCoord</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-150"></span><span>              </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">LT</span></span><span>                                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">((r -&gt; Const r r) -&gt; Point 2 r -&gt; Const r (Point 2 r))
-&gt; Point 2 r -&gt; r
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><a href="file:///home/runner/.cabal/store/ghc-9.12.2-9b33/lens-5.3.5-af8f0435b03c00f06f5d03b52ea927527529d0c03b8a7eee42e07e484fdea6cb/share/doc/html/src/Control.Lens.Getter.html#view"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">(r -&gt; Const r r) -&gt; Point 2 r -&gt; Const r (Point 2 r)
forall (d :: Nat) point r.
(1 &lt;= d, Point_ point d r) =&gt;
IndexedLens' Int point r
IndexedLens' Int (Point 2 r) r
</span><span class="hs-identifier hs-var">xCoord</span></span><span>
</span><span id="line-151"></span><span>              </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span>                                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">r -&gt; r
forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">negate</span></span><span> </span><span class="annot"><span class="annottext">(r -&gt; r) -&gt; (Point 2 r -&gt; r) -&gt; Point 2 r -&gt; r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((r -&gt; Const r r) -&gt; Point 2 r -&gt; Const r (Point 2 r))
-&gt; Point 2 r -&gt; r
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><a href="file:///home/runner/.cabal/store/ghc-9.12.2-9b33/lens-5.3.5-af8f0435b03c00f06f5d03b52ea927527529d0c03b8a7eee42e07e484fdea6cb/share/doc/html/src/Control.Lens.Getter.html#view"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">(r -&gt; Const r r) -&gt; Point 2 r -&gt; Const r (Point 2 r)
forall (d :: Nat) point r.
(1 &lt;= d, Point_ point d r) =&gt;
IndexedLens' Int point r
IndexedLens' Int (Point 2 r) r
</span><span class="hs-identifier hs-var">xCoord</span></span><span>
</span><span id="line-152"></span><span>              </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ClosedLineSegment (Point 2 r)
</span><a href="#local-6989586621679482092"><span class="hs-identifier hs-var">seg</span></a></span><span class="annot"><span class="annottext">ClosedLineSegment (Point 2 r)
-&gt; Getting r (ClosedLineSegment (Point 2 r)) r -&gt; r
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.12.2-9b33/lens-5.3.5-af8f0435b03c00f06f5d03b52ea927527529d0c03b8a7eee42e07e484fdea6cb/share/doc/html/src/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">(Point 2 r -&gt; Const r (Point 2 r))
-&gt; ClosedLineSegment (Point 2 r)
-&gt; Const r (ClosedLineSegment (Point 2 r))
forall seg p. HasStart seg p =&gt; Lens' seg p
Lens' (ClosedLineSegment (Point 2 r)) (Point 2 r)
</span><span class="hs-identifier hs-var">start</span></span><span class="annot"><span class="annottext">((Point 2 r -&gt; Const r (Point 2 r))
 -&gt; ClosedLineSegment (Point 2 r)
 -&gt; Const r (ClosedLineSegment (Point 2 r)))
-&gt; ((r -&gt; Const r r) -&gt; Point 2 r -&gt; Const r (Point 2 r))
-&gt; Getting r (ClosedLineSegment (Point 2 r)) r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(r -&gt; Const r r) -&gt; Point 2 r -&gt; Const r (Point 2 r)
forall (d :: Nat) point r.
(2 &lt;= d, Point_ point d r) =&gt;
IndexedLens' Int point r
IndexedLens' Int (Point 2 r) r
</span><span class="hs-identifier hs-var">yCoord</span></span><span> </span><span class="annot"><span class="annottext">r -&gt; r -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">ClosedLineSegment (Point 2 r)
</span><a href="#local-6989586621679482092"><span class="hs-identifier hs-var">seg</span></a></span><span class="annot"><span class="annottext">ClosedLineSegment (Point 2 r)
-&gt; Getting r (ClosedLineSegment (Point 2 r)) r -&gt; r
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.12.2-9b33/lens-5.3.5-af8f0435b03c00f06f5d03b52ea927527529d0c03b8a7eee42e07e484fdea6cb/share/doc/html/src/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">(Point 2 r -&gt; Const r (Point 2 r))
-&gt; ClosedLineSegment (Point 2 r)
-&gt; Const r (ClosedLineSegment (Point 2 r))
forall seg p. HasEnd seg p =&gt; Lens' seg p
Lens' (ClosedLineSegment (Point 2 r)) (Point 2 r)
</span><span class="hs-identifier hs-var">end</span></span><span class="annot"><span class="annottext">((Point 2 r -&gt; Const r (Point 2 r))
 -&gt; ClosedLineSegment (Point 2 r)
 -&gt; Const r (ClosedLineSegment (Point 2 r)))
-&gt; ((r -&gt; Const r r) -&gt; Point 2 r -&gt; Const r (Point 2 r))
-&gt; Getting r (ClosedLineSegment (Point 2 r)) r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(r -&gt; Const r r) -&gt; Point 2 r -&gt; Const r (Point 2 r)
forall (d :: Nat) point r.
(2 &lt;= d, Point_ point d r) =&gt;
IndexedLens' Int point r
IndexedLens' Int (Point 2 r) r
</span><span class="hs-identifier hs-var">yCoord</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">((r -&gt; Const r r) -&gt; Point 2 r -&gt; Const r (Point 2 r))
-&gt; Point 2 r -&gt; r
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><a href="file:///home/runner/.cabal/store/ghc-9.12.2-9b33/lens-5.3.5-af8f0435b03c00f06f5d03b52ea927527529d0c03b8a7eee42e07e484fdea6cb/share/doc/html/src/Control.Lens.Getter.html#view"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">(r -&gt; Const r r) -&gt; Point 2 r -&gt; Const r (Point 2 r)
forall (d :: Nat) point r.
(2 &lt;= d, Point_ point d r) =&gt;
IndexedLens' Int point r
IndexedLens' Int (Point 2 r) r
</span><span class="hs-identifier hs-var">yCoord</span></span><span>
</span><span id="line-153"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">r -&gt; r
forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">negate</span></span><span> </span><span class="annot"><span class="annottext">(r -&gt; r) -&gt; (Point 2 r -&gt; r) -&gt; Point 2 r -&gt; r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((r -&gt; Const r r) -&gt; Point 2 r -&gt; Const r (Point 2 r))
-&gt; Point 2 r -&gt; r
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><a href="file:///home/runner/.cabal/store/ghc-9.12.2-9b33/lens-5.3.5-af8f0435b03c00f06f5d03b52ea927527529d0c03b8a7eee42e07e484fdea6cb/share/doc/html/src/Control.Lens.Getter.html#view"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">(r -&gt; Const r r) -&gt; Point 2 r -&gt; Const r (Point 2 r)
forall (d :: Nat) point r.
(2 &lt;= d, Point_ point d r) =&gt;
IndexedLens' Int point r
IndexedLens' Int (Point 2 r) r
</span><span class="hs-identifier hs-var">yCoord</span></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span>    </span><span class="hs-comment">-- | For every vertex, collect its neighbours</span><span>
</span><span id="line-156"></span><span>    </span><span class="annot"><a href="#local-6989586621679482105"><span class="hs-identifier hs-type">neighbours</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Map.NonEmpty.Monoidal.html#MonoidalNEMap"><span class="hs-identifier hs-type">MonoidalNEMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hiraffe-0.1/doc/html/hiraffe/src/Hiraffe.Graph.Class.html#VertexIx"><span class="hs-identifier hs-type">VertexIx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481059"><span class="hs-identifier hs-type">planeGraph</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Map.NonEmpty.Monoidal.html#MonoidalNEMap"><span class="hs-identifier hs-type">MonoidalNEMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hiraffe-0.1/doc/html/hiraffe/src/Hiraffe.Graph.Class.html#VertexIx"><span class="hs-identifier hs-type">VertexIx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481059"><span class="hs-identifier hs-type">planeGraph</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Sequence.NonEmpty.html#ViewL1"><span class="hs-identifier hs-type">ViewL1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481056"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>    </span><span id="local-6989586621679482105"><span class="annot"><span class="annottext">neighbours :: MonoidalNEMap
  (VertexIx planeGraph)
  (MonoidalNEMap (VertexIx planeGraph) (ViewL1 lineSegment))
</span><a href="#local-6989586621679482105"><span class="hs-identifier hs-var hs-var">neighbours</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ClosedLineSegment (Point 2 r)
 -&gt; ViewL1 (VertexId s)
 -&gt; MonoidalNEMap
      (VertexId s) (MonoidalNEMap (VertexId s) (ViewL1 lineSegment)))
-&gt; MonoidalNEMap
     (ClosedLineSegment (Point 2 r)) (ViewL1 (VertexId s))
-&gt; MonoidalNEMap
     (VertexId s) (MonoidalNEMap (VertexId s) (ViewL1 lineSegment))
forall m a.
Semigroup m =&gt;
(ClosedLineSegment (Point 2 r) -&gt; a -&gt; m)
-&gt; MonoidalNEMap (ClosedLineSegment (Point 2 r)) a -&gt; m
forall i (f :: * -&gt; *) m a.
(Foldable1WithIndex i f, Semigroup m) =&gt;
(i -&gt; a -&gt; m) -&gt; f a -&gt; m
</span><a href="file:///home/runner/.cabal/store/ghc-9.12.2-9b33/indexed-traversable-0.1.4-abf18009c8aa238896def64882e8e8d1f618d0164d9214ba36444910f4d62193/share/doc/html/src/WithIndex.html#ifoldMap1"><span class="hs-identifier hs-var">ifoldMap1</span></a></span><span> </span><span class="annot"><span class="annottext">ClosedLineSegment (Point 2 r)
-&gt; ViewL1 (VertexId s)
-&gt; MonoidalNEMap
     (VertexId s) (MonoidalNEMap (VertexId s) (ViewL1 lineSegment))
</span><a href="#local-6989586621679482107"><span class="hs-identifier hs-var">collect</span></a></span><span> </span><span class="annot"><span class="annottext">MonoidalNEMap
  (ClosedLineSegment (Point 2 r)) (ViewL1 (VertexIx planeGraph))
MonoidalNEMap (ClosedLineSegment (Point 2 r)) (ViewL1 (VertexId s))
</span><a href="#local-6989586621679482088"><span class="hs-identifier hs-var">verticesBySegment</span></a></span><span>
</span><span id="line-159"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-160"></span><span>        </span><span id="local-6989586621679482107"><span class="annot"><span class="annottext">collect :: ClosedLineSegment (Point 2 r)
-&gt; ViewL1 (VertexId s)
-&gt; MonoidalNEMap
     (VertexId s) (MonoidalNEMap (VertexId s) (ViewL1 lineSegment))
</span><a href="#local-6989586621679482107"><span class="hs-identifier hs-var hs-var">collect</span></a></span></span><span> </span><span id="local-6989586621679482108"><span class="annot"><span class="annottext">ClosedLineSegment (Point 2 r)
</span><a href="#local-6989586621679482108"><span class="hs-identifier hs-var">canonicalSeg</span></a></span></span><span> </span><span id="local-6989586621679482109"><span class="annot"><span class="annottext">verts :: ViewL1 (VertexId s)
</span><a href="#local-6989586621679482109"><span class="hs-identifier hs-var">verts</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">VertexId s
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Sequence.NonEmpty.html#%3A%3C%3C"><span class="hs-operator hs-type">:&lt;&lt;</span></a></span><span> </span><span id="local-6989586621679482110"><span class="annot"><span class="annottext">Seq (VertexId s)
</span><a href="#local-6989586621679482110"><span class="hs-identifier hs-var">rest'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Seq (VertexId s) -&gt; Maybe (ViewL1 (VertexId s))
forall a. Seq a -&gt; Maybe (ViewL1 a)
</span><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Sequence.NonEmpty.html#asViewL1"><span class="hs-identifier hs-var">asViewL1</span></a></span><span> </span><span class="annot"><span class="annottext">Seq (VertexId s)
</span><a href="#local-6989586621679482110"><span class="hs-identifier hs-var">rest'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-161"></span><span>            </span><span class="annot"><span class="annottext">Maybe (ViewL1 (VertexId s))
</span><span class="hs-identifier hs-var">Nothing</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-162"></span><span>              </span><span class="annot"><span class="annottext">[Char]
-&gt; MonoidalNEMap
     (VertexId s) (MonoidalNEMap (VertexId s) (ViewL1 lineSegment))
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;fromIntersections. absurd. every seg should have at least 2 vertices&quot;</span></span><span>
</span><span id="line-163"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679482112"><span class="annot"><span class="annottext">ViewL1 (VertexId s)
</span><a href="#local-6989586621679482112"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ViewL1
  (MonoidalNEMap
     (VertexId s) (MonoidalNEMap (VertexId s) (ViewL1 lineSegment)))
-&gt; MonoidalNEMap
     (VertexId s) (MonoidalNEMap (VertexId s) (ViewL1 lineSegment))
forall m. Semigroup m =&gt; ViewL1 m -&gt; m
forall (t :: * -&gt; *) m. (Foldable1 t, Semigroup m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold1</span></span><span> </span><span class="annot"><span class="annottext">(ViewL1
   (MonoidalNEMap
      (VertexId s) (MonoidalNEMap (VertexId s) (ViewL1 lineSegment)))
 -&gt; MonoidalNEMap
      (VertexId s) (MonoidalNEMap (VertexId s) (ViewL1 lineSegment)))
-&gt; ViewL1
     (MonoidalNEMap
        (VertexId s) (MonoidalNEMap (VertexId s) (ViewL1 lineSegment)))
-&gt; MonoidalNEMap
     (VertexId s) (MonoidalNEMap (VertexId s) (ViewL1 lineSegment))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(VertexId s
 -&gt; VertexId s
 -&gt; MonoidalNEMap
      (VertexId s) (MonoidalNEMap (VertexId s) (ViewL1 lineSegment)))
-&gt; ViewL1 (VertexId s)
-&gt; ViewL1 (VertexId s)
-&gt; ViewL1
     (MonoidalNEMap
        (VertexId s) (MonoidalNEMap (VertexId s) (ViewL1 lineSegment)))
forall a b c. (a -&gt; b -&gt; c) -&gt; ViewL1 a -&gt; ViewL1 b -&gt; ViewL1 c
forall (f :: * -&gt; *) a b c.
Zip f =&gt;
(a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c
</span><a href="file:///home/runner/.cabal/store/ghc-9.12.2-9b33/semialign-1.3.1-ad15642489224f7e945797300a0b1eca31785c10fbb9993a16f8f207ea2547f7/share/doc/html/src/Data.Semialign.Internal.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a></span><span> </span><span class="annot"><span class="annottext">VertexId s
-&gt; VertexId s
-&gt; MonoidalNEMap
     (VertexId s) (MonoidalNEMap (VertexId s) (ViewL1 lineSegment))
</span><a href="#local-6989586621679482115"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">ViewL1 (VertexId s)
</span><a href="#local-6989586621679482109"><span class="hs-identifier hs-var">verts</span></a></span><span> </span><span class="annot"><span class="annottext">ViewL1 (VertexId s)
</span><a href="#local-6989586621679482112"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-164"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-165"></span><span>            </span><span class="hs-comment">-- This canonical segment represents a bunch of actual segments, associate</span><span>
</span><span id="line-166"></span><span>            </span><span class="hs-comment">-- the vertices with those line segments (rather than the canonical one)</span><span>
</span><span id="line-167"></span><span>            </span><span id="local-6989586621679482116"><span class="annot"><span class="annottext">theSegs :: ViewL1 lineSegment
</span><a href="#local-6989586621679482116"><span class="hs-identifier hs-var hs-var">theSegs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MonoidalNEMap (ClosedLineSegment (Point 2 r)) (ViewL1 lineSegment)
</span><a href="#local-6989586621679481945"><span class="hs-identifier hs-var">canonicalSegmentMap</span></a></span><span> </span><span class="annot"><span class="annottext">MonoidalNEMap (ClosedLineSegment (Point 2 r)) (ViewL1 lineSegment)
-&gt; ClosedLineSegment (Point 2 r) -&gt; ViewL1 lineSegment
forall k v. Ord k =&gt; MonoidalNEMap k v -&gt; k -&gt; v
</span><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Map.NonEmpty.Monoidal.html#%21"><span class="hs-operator hs-var">MonoidalNEMap.!</span></a></span><span> </span><span class="annot"><span class="annottext">ClosedLineSegment (Point 2 r)
</span><a href="#local-6989586621679482108"><span class="hs-identifier hs-var">canonicalSeg</span></a></span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span>            </span><span id="local-6989586621679482115"><span class="annot"><span class="annottext">f :: VertexId s
-&gt; VertexId s
-&gt; MonoidalNEMap
     (VertexId s) (MonoidalNEMap (VertexId s) (ViewL1 lineSegment))
</span><a href="#local-6989586621679482115"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679482117"><span class="annot"><span class="annottext">VertexId s
</span><a href="#local-6989586621679482117"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621679482118"><span class="annot"><span class="annottext">VertexId s
</span><a href="#local-6989586621679482118"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VertexId s
-&gt; MonoidalNEMap (VertexId s) (ViewL1 lineSegment)
-&gt; MonoidalNEMap
     (VertexId s) (MonoidalNEMap (VertexId s) (ViewL1 lineSegment))
forall k v. k -&gt; v -&gt; MonoidalNEMap k v
</span><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Map.NonEmpty.Monoidal.html#singleton"><span class="hs-identifier hs-var">MonoidalNEMap.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">VertexId s
</span><a href="#local-6989586621679482117"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VertexId s
-&gt; ViewL1 lineSegment
-&gt; MonoidalNEMap (VertexId s) (ViewL1 lineSegment)
forall k v. k -&gt; v -&gt; MonoidalNEMap k v
</span><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Map.NonEmpty.Monoidal.html#singleton"><span class="hs-identifier hs-var">MonoidalNEMap.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">VertexId s
</span><a href="#local-6989586621679482118"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">ViewL1 lineSegment
</span><a href="#local-6989586621679482116"><span class="hs-identifier hs-var">theSegs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>                 </span><span class="annot"><span class="annottext">MonoidalNEMap
  (VertexId s) (MonoidalNEMap (VertexId s) (ViewL1 lineSegment))
-&gt; MonoidalNEMap
     (VertexId s) (MonoidalNEMap (VertexId s) (ViewL1 lineSegment))
-&gt; MonoidalNEMap
     (VertexId s) (MonoidalNEMap (VertexId s) (ViewL1 lineSegment))
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">VertexId s
-&gt; MonoidalNEMap (VertexId s) (ViewL1 lineSegment)
-&gt; MonoidalNEMap
     (VertexId s) (MonoidalNEMap (VertexId s) (ViewL1 lineSegment))
forall k v. k -&gt; v -&gt; MonoidalNEMap k v
</span><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Map.NonEmpty.Monoidal.html#singleton"><span class="hs-identifier hs-var">MonoidalNEMap.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">VertexId s
</span><a href="#local-6989586621679482118"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VertexId s
-&gt; ViewL1 lineSegment
-&gt; MonoidalNEMap (VertexId s) (ViewL1 lineSegment)
forall k v. k -&gt; v -&gt; MonoidalNEMap k v
</span><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Map.NonEmpty.Monoidal.html#singleton"><span class="hs-identifier hs-var">MonoidalNEMap.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">VertexId s
</span><a href="#local-6989586621679482117"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">ViewL1 lineSegment
</span><a href="#local-6989586621679482116"><span class="hs-identifier hs-var">theSegs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span>    </span><span class="hs-comment">-- I think this already automatically takes care of colinear semgents as well, as we</span><span>
</span><span id="line-173"></span><span>    </span><span class="hs-comment">-- are using a NESet to collect the neighbours of each vertex.</span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span>    </span><span class="hs-comment">-- | Construct the final adjacency lists</span><span>
</span><span id="line-176"></span><span>    </span><span class="annot"><a href="#local-6989586621679481926"><span class="hs-identifier hs-type">adjLists</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Map.NonEmpty.Monoidal.html#MonoidalNEMap"><span class="hs-identifier hs-type">MonoidalNEMap</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span>
</span><span id="line-177"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hiraffe-0.1/doc/html/hiraffe/src/Hiraffe.Graph.Class.html#VertexIx"><span class="hs-identifier hs-type">VertexIx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481059"><span class="hs-identifier hs-type">planeGraph</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Point</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679481058"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Ext.html#%3A%2B"><span class="hs-operator hs-type">:+</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Seq.Seq</span></span><span> </span><span class="annot"><a href="#local-6989586621679481057"><span class="hs-identifier hs-type">point</span></a></span><span>
</span><span id="line-178"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hiraffe-0.1/doc/html/hiraffe/src/Hiraffe.Graph.Class.html#VertexIx"><span class="hs-identifier hs-type">VertexIx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481059"><span class="hs-identifier hs-type">planeGraph</span></a></span><span>
</span><span id="line-179"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Sequence.NonEmpty.html#ViewL1"><span class="hs-identifier hs-type">ViewL1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481056"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-180"></span><span>                             </span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>    </span><span id="local-6989586621679481926"><span class="annot"><span class="annottext">adjLists :: MonoidalNEMap
  (Point 2 r)
  (VertexIx planeGraph, Point 2 r :+ Seq point,
   NonEmpty (VertexIx planeGraph, ViewL1 lineSegment))
</span><a href="#local-6989586621679481926"><span class="hs-identifier hs-var hs-var">adjLists</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Point 2 r
 -&gt; VertexIx planeGraph
 -&gt; (VertexIx planeGraph, Point 2 r :+ Seq point,
     NonEmpty (VertexIx planeGraph, ViewL1 lineSegment)))
-&gt; MonoidalNEMap (Point 2 r) (VertexIx planeGraph)
-&gt; MonoidalNEMap
     (Point 2 r)
     (VertexIx planeGraph, Point 2 r :+ Seq point,
      NonEmpty (VertexIx planeGraph, ViewL1 lineSegment))
forall a b.
(Point 2 r -&gt; a -&gt; b)
-&gt; MonoidalNEMap (Point 2 r) a -&gt; MonoidalNEMap (Point 2 r) b
forall i (f :: * -&gt; *) a b.
FunctorWithIndex i f =&gt;
(i -&gt; a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///home/runner/.cabal/store/ghc-9.12.2-9b33/indexed-traversable-0.1.4-abf18009c8aa238896def64882e8e8d1f618d0164d9214ba36444910f4d62193/share/doc/html/src/WithIndex.html#imap"><span class="hs-identifier hs-var">imap</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
-&gt; VertexIx planeGraph
-&gt; (VertexIx planeGraph, Point 2 r :+ Seq point,
    NonEmpty (VertexIx planeGraph, ViewL1 lineSegment))
</span><a href="#local-6989586621679482120"><span class="hs-identifier hs-var">buildVertex</span></a></span><span> </span><span class="annot"><span class="annottext">MonoidalNEMap (Point 2 r) (VertexIx planeGraph)
</span><a href="#local-6989586621679481927"><span class="hs-identifier hs-var">vertexMapping</span></a></span><span>
</span><span id="line-183"></span><span>    </span><span id="local-6989586621679482120"><span class="annot"><span class="annottext">buildVertex :: Point 2 r
-&gt; VertexIx planeGraph
-&gt; (VertexIx planeGraph, Point 2 r :+ Seq point,
    NonEmpty (VertexIx planeGraph, ViewL1 lineSegment))
</span><a href="#local-6989586621679482120"><span class="hs-identifier hs-var hs-var">buildVertex</span></a></span></span><span> </span><span id="local-6989586621679482121"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679482121"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679482122"><span class="annot"><span class="annottext">VertexIx planeGraph
</span><a href="#local-6989586621679482122"><span class="hs-identifier hs-var">vi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VertexIx planeGraph
</span><a href="#local-6989586621679482122"><span class="hs-identifier hs-var">vi</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679482121"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Seq point -&gt; Point 2 r :+ Seq point
forall core extra. core -&gt; extra -&gt; core :+ extra
</span><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Ext.html#%3A%2B"><span class="hs-operator hs-var">:+</span></a></span><span> </span><span class="annot"><span class="annottext">Seq point
</span><a href="#local-6989586621679482124"><span class="hs-identifier hs-var">segEndpts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MonoidalNEMap (VertexIx planeGraph) (ViewL1 lineSegment)
-&gt; NonEmpty (VertexIx planeGraph, ViewL1 lineSegment)
forall k v. MonoidalNEMap k v -&gt; NonEmpty (k, v)
</span><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Map.NonEmpty.Monoidal.html#assocs"><span class="hs-identifier hs-var">MonoidalNEMap.assocs</span></a></span><span> </span><span class="annot"><span class="annottext">(MonoidalNEMap (VertexIx planeGraph) (ViewL1 lineSegment)
 -&gt; NonEmpty (VertexIx planeGraph, ViewL1 lineSegment))
-&gt; MonoidalNEMap (VertexIx planeGraph) (ViewL1 lineSegment)
-&gt; NonEmpty (VertexIx planeGraph, ViewL1 lineSegment)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MonoidalNEMap
  (VertexIx planeGraph)
  (MonoidalNEMap (VertexIx planeGraph) (ViewL1 lineSegment))
</span><a href="#local-6989586621679482105"><span class="hs-identifier hs-var">neighbours</span></a></span><span> </span><span class="annot"><span class="annottext">MonoidalNEMap
  (VertexIx planeGraph)
  (MonoidalNEMap (VertexIx planeGraph) (ViewL1 lineSegment))
-&gt; VertexIx planeGraph
-&gt; MonoidalNEMap (VertexIx planeGraph) (ViewL1 lineSegment)
forall k v. Ord k =&gt; MonoidalNEMap k v -&gt; k -&gt; v
</span><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Map.NonEmpty.Monoidal.html#%21"><span class="hs-operator hs-var">MonoidalNEMap.!</span></a></span><span> </span><span class="annot"><span class="annottext">VertexIx planeGraph
</span><a href="#local-6989586621679482122"><span class="hs-identifier hs-var">vi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-185"></span><span>        </span><span id="local-6989586621679482124"><span class="annot"><span class="annottext">segEndpts :: Seq point
</span><a href="#local-6989586621679482124"><span class="hs-identifier hs-var hs-var">segEndpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MonoidalNEMap (Point 2 r) (ViewL1 point)
</span><a href="#local-6989586621679481930"><span class="hs-identifier hs-var">segmentEndPoints</span></a></span><span> </span><span class="annot"><span class="annottext">MonoidalNEMap (Point 2 r) (ViewL1 point)
-&gt; Point 2 r -&gt; Maybe (ViewL1 point)
forall k v. Ord k =&gt; MonoidalNEMap k v -&gt; k -&gt; Maybe v
</span><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Map.NonEmpty.Monoidal.html#%21%3F"><span class="hs-operator hs-var">MonoidalNEMap.!?</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679482121"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-186"></span><span>                      </span><span class="annot"><span class="annottext">Maybe (ViewL1 point)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Seq point
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-187"></span><span>                      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679482127"><span class="annot"><span class="annottext">point
</span><a href="#local-6989586621679482127"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Sequence.NonEmpty.html#%3A%3C%3C"><span class="hs-operator hs-type">:&lt;&lt;</span></a></span><span> </span><span id="local-6989586621679482128"><span class="annot"><span class="annottext">Seq point
</span><a href="#local-6989586621679482128"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">point
</span><a href="#local-6989586621679482127"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">point -&gt; Seq point -&gt; Seq point
forall a. a -&gt; Seq a -&gt; Seq a
</span><span class="hs-operator hs-var">Seq.&lt;|</span></span><span> </span><span class="annot"><span class="annottext">Seq point
</span><a href="#local-6989586621679482128"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="hs-comment">-- | Computes the interior intersections on each segment.</span><span>
</span><span id="line-190"></span><span class="hs-comment">--</span><span>
</span><span id="line-191"></span><span class="hs-comment">-- O((n+k)\log n)</span><span>
</span><span id="line-192"></span><span id="local-6989586621679481190"><span id="local-6989586621679481191"><span id="local-6989586621679481192"><span id="local-6989586621679481193"><span class="annot"><a href="HGeometry.PlaneGraph.Connected.FromIntersectingSegments.html#interiorIntersectionsBySegment"><span class="hs-identifier hs-type">interiorIntersectionsBySegment</span></a></span><span>                   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679481190"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-193"></span><span>                                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable1</span></span><span> </span><span class="annot"><a href="#local-6989586621679481191"><span class="hs-identifier hs-type">nonEmpty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-194"></span><span>                                                 </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679481192"><span class="hs-identifier hs-type">richSegment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679481190"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span>                                                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679481191"><span class="hs-identifier hs-type">nonEmpty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481190"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-196"></span><span>                                                    </span><span class="annot"><span class="hs-comment">-- ^ all input segments</span></span><span>
</span><span id="line-197"></span><span>                                                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Intersections</span></span><span> </span><span class="annot"><a href="#local-6989586621679481193"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481192"><span class="hs-identifier hs-type">richSegment</span></a></span><span>
</span><span id="line-198"></span><span>                                                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Map.NonEmpty.Monoidal.html#MonoidalNEMap"><span class="hs-identifier hs-type">MonoidalNEMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481190"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Seq.Seq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Point</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679481193"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-199"></span><span id="interiorIntersectionsBySegment"><span class="annot"><span class="annottext">interiorIntersectionsBySegment :: forall lineSegment (nonEmpty :: * -&gt; *) richSegment r.
(Ord lineSegment, Foldable1 nonEmpty) =&gt;
(richSegment -&gt; lineSegment)
-&gt; nonEmpty lineSegment
-&gt; Intersections r richSegment
-&gt; MonoidalNEMap lineSegment (Seq (Point 2 r))
</span><a href="HGeometry.PlaneGraph.Connected.FromIntersectingSegments.html#interiorIntersectionsBySegment"><span class="hs-identifier hs-var hs-var">interiorIntersectionsBySegment</span></a></span></span><span> </span><span id="local-6989586621679482149"><span class="annot"><span class="annottext">richSegment -&gt; lineSegment
</span><a href="#local-6989586621679482149"><span class="hs-identifier hs-var">toKey</span></a></span></span><span> </span><span id="local-6989586621679482150"><span class="annot"><span class="annottext">nonEmpty lineSegment
</span><a href="#local-6989586621679482150"><span class="hs-identifier hs-var">segs</span></a></span></span><span> </span><span id="local-6989586621679482151"><span class="annot"><span class="annottext">Intersections r richSegment
</span><a href="#local-6989586621679482151"><span class="hs-identifier hs-var">inters</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-200"></span><span>        </span><span class="annot"><span class="annottext">(lineSegment
 -&gt; MonoidalNEMap lineSegment (Seq (PointF (Vector 2 r))))
-&gt; nonEmpty lineSegment
-&gt; MonoidalNEMap lineSegment (Seq (PointF (Vector 2 r)))
forall m a. Semigroup m =&gt; (a -&gt; m) -&gt; nonEmpty a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable1 t, Semigroup m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(lineSegment
 -&gt; Seq (PointF (Vector 2 r))
 -&gt; MonoidalNEMap lineSegment (Seq (PointF (Vector 2 r))))
-&gt; Seq (PointF (Vector 2 r))
-&gt; lineSegment
-&gt; MonoidalNEMap lineSegment (Seq (PointF (Vector 2 r)))
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">lineSegment
-&gt; Seq (PointF (Vector 2 r))
-&gt; MonoidalNEMap lineSegment (Seq (PointF (Vector 2 r)))
forall k v. k -&gt; v -&gt; MonoidalNEMap k v
</span><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Map.NonEmpty.Monoidal.html#singleton"><span class="hs-identifier hs-var">MonoidalNEMap.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">Seq (PointF (Vector 2 r))
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">nonEmpty lineSegment
</span><a href="#local-6989586621679482150"><span class="hs-identifier hs-var">segs</span></a></span><span>
</span><span id="line-201"></span><span>    </span><span class="annot"><span class="annottext">MonoidalNEMap lineSegment (Seq (PointF (Vector 2 r)))
-&gt; Map lineSegment (Seq (PointF (Vector 2 r)))
-&gt; MonoidalNEMap lineSegment (Seq (PointF (Vector 2 r)))
forall k v.
(Ord k, Semigroup v) =&gt;
MonoidalNEMap k v -&gt; Map k v -&gt; MonoidalNEMap k v
</span><a href="HGeometry.PlaneGraph.Connected.FromIntersectingSegments.html#%3C%3E%3E"><span class="hs-operator hs-var">&lt;&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">MonoidalMap lineSegment (Seq (PointF (Vector 2 r)))
-&gt; Map lineSegment (Seq (PointF (Vector 2 r)))
forall a b. Coercible a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">coerce</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PointF (Vector 2 r)
 -&gt; Associated richSegment
 -&gt; MonoidalMap lineSegment (Seq (PointF (Vector 2 r))))
-&gt; Intersections r richSegment
-&gt; MonoidalMap lineSegment (Seq (PointF (Vector 2 r)))
forall m a.
Monoid m =&gt;
(PointF (Vector 2 r) -&gt; a -&gt; m) -&gt; Map (PointF (Vector 2 r)) a -&gt; m
forall i (f :: * -&gt; *) m a.
(FoldableWithIndex i f, Monoid m) =&gt;
(i -&gt; a -&gt; m) -&gt; f a -&gt; m
</span><a href="file:///home/runner/.cabal/store/ghc-9.12.2-9b33/indexed-traversable-0.1.4-abf18009c8aa238896def64882e8e8d1f618d0164d9214ba36444910f4d62193/share/doc/html/src/WithIndex.html#ifoldMap"><span class="hs-identifier hs-var">ifoldMap</span></a></span><span> </span><span class="annot"><span class="annottext">PointF (Vector 2 r)
-&gt; Associated richSegment
-&gt; MonoidalMap lineSegment (Seq (PointF (Vector 2 r)))
</span><a href="#local-6989586621679482154"><span class="hs-identifier hs-var">construct</span></a></span><span> </span><span class="annot"><span class="annottext">Intersections r richSegment
</span><a href="#local-6989586621679482151"><span class="hs-identifier hs-var">inters</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-203"></span><span>    </span><span id="local-6989586621679482154"><span class="annot"><span class="annottext">construct :: PointF (Vector 2 r)
-&gt; Associated richSegment
-&gt; MonoidalMap lineSegment (Seq (PointF (Vector 2 r)))
</span><a href="#local-6989586621679482154"><span class="hs-identifier hs-var hs-var">construct</span></a></span></span><span> </span><span id="local-6989586621679482155"><span class="annot"><span class="annottext">PointF (Vector 2 r)
</span><a href="#local-6989586621679482155"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679482156"><span class="annot"><span class="annottext">Associated richSegment
</span><a href="#local-6989586621679482156"><span class="hs-identifier hs-var">assoc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-204"></span><span>      </span><span class="annot"><span class="annottext">(AroundIntersection richSegment
 -&gt; MonoidalMap lineSegment (Seq (PointF (Vector 2 r))))
-&gt; Set (AroundIntersection richSegment)
-&gt; MonoidalMap lineSegment (Seq (PointF (Vector 2 r)))
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; Set a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679482158"><span class="annot"><span class="annottext">AroundIntersection richSegment
</span><a href="#local-6989586621679482158"><span class="hs-identifier hs-var">seg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">lineSegment
-&gt; Seq (PointF (Vector 2 r))
-&gt; MonoidalMap lineSegment (Seq (PointF (Vector 2 r)))
forall k a. k -&gt; a -&gt; MonoidalMap k a
</span><a href="file:///home/runner/.cabal/store/ghc-9.12.2-9b33/monoidal-containers-0.6.6.0-45b60b594b42f183c88f541def99d5378a9f6d3bceec6ae95a9027298e34d367/share/doc/html/src/Data.Map.Monoidal.html#singleton"><span class="hs-identifier hs-var">MonoidalMap.singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">richSegment -&gt; lineSegment
</span><a href="#local-6989586621679482149"><span class="hs-identifier hs-var">toKey</span></a></span><span> </span><span class="annot"><span class="annottext">(richSegment -&gt; lineSegment) -&gt; richSegment -&gt; lineSegment
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AroundIntersection richSegment -&gt; richSegment
forall a b. Coercible a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">coerce</span></span><span> </span><span class="annot"><span class="annottext">AroundIntersection richSegment
</span><a href="#local-6989586621679482158"><span class="hs-identifier hs-var">seg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PointF (Vector 2 r) -&gt; Seq (PointF (Vector 2 r))
forall a. a -&gt; Seq a
</span><span class="hs-identifier hs-var">Seq.singleton</span></span><span> </span><span class="annot"><span class="annottext">PointF (Vector 2 r)
</span><a href="#local-6989586621679482155"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Associated richSegment
</span><a href="#local-6989586621679482156"><span class="hs-identifier hs-var">assoc</span></a></span><span class="annot"><span class="annottext">Associated richSegment
-&gt; Getting
     (Set (AroundIntersection richSegment))
     (Associated richSegment)
     (Set (AroundIntersection richSegment))
-&gt; Set (AroundIntersection richSegment)
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.12.2-9b33/lens-5.3.5-af8f0435b03c00f06f5d03b52ea927527529d0c03b8a7eee42e07e484fdea6cb/share/doc/html/src/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">Getting
  (Set (AroundIntersection richSegment))
  (Associated richSegment)
  (Set (AroundIntersection richSegment))
forall lineSegment (f :: * -&gt; *).
Functor f =&gt;
(Set (AroundIntersection lineSegment)
 -&gt; f (Set (AroundIntersection lineSegment)))
-&gt; Associated lineSegment -&gt; f (Associated lineSegment)
</span><span class="hs-identifier hs-var">interiorTo</span></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span class="annot"><span class="hs-comment">-- | Assign each element in the map a unique Integer key (in the range \([0,n)\) )</span></span><span>
</span><span id="line-209"></span><span id="local-6989586621679481153"><span id="local-6989586621679481154"><span class="annot"><a href="HGeometry.PlaneGraph.Connected.FromIntersectingSegments.html#assignIndex"><span class="hs-identifier hs-type">assignIndex</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Map.NonEmpty.Monoidal.html#MonoidalNEMap"><span class="hs-identifier hs-type">MonoidalNEMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481153"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481154"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Map.NonEmpty.Monoidal.html#MonoidalNEMap"><span class="hs-identifier hs-type">MonoidalNEMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481153"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span></span><span>
</span><span id="line-210"></span><span id="assignIndex"><span class="annot"><span class="annottext">assignIndex :: forall k v. MonoidalNEMap k v -&gt; MonoidalNEMap k Int
</span><a href="HGeometry.PlaneGraph.Connected.FromIntersectingSegments.html#assignIndex"><span class="hs-identifier hs-var hs-var">assignIndex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int, MonoidalNEMap k Int) -&gt; MonoidalNEMap k Int
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((Int, MonoidalNEMap k Int) -&gt; MonoidalNEMap k Int)
-&gt; (MonoidalNEMap k v -&gt; (Int, MonoidalNEMap k Int))
-&gt; MonoidalNEMap k v
-&gt; MonoidalNEMap k Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; k -&gt; v -&gt; (Int, Int))
-&gt; Int -&gt; MonoidalNEMap k v -&gt; (Int, MonoidalNEMap k Int)
forall k a b c.
(a -&gt; k -&gt; b -&gt; (a, c))
-&gt; a -&gt; MonoidalNEMap k b -&gt; (a, MonoidalNEMap k c)
</span><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Map.NonEmpty.Monoidal.html#mapAccumWithKey"><span class="hs-identifier hs-var">MonoidalNEMap.mapAccumWithKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679482168"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482168"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="annot"><span class="annottext">k
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">v
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">succ</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482168"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482168"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span>
</span><span id="line-213"></span><span class="annot"><span class="hs-comment">-- | Helper to combine a nonempty monoidal map with an additional map</span></span><span>
</span><span id="line-214"></span><span id="local-6989586621679481176"><span id="local-6989586621679481177"><span class="annot"><a href="HGeometry.PlaneGraph.Connected.FromIntersectingSegments.html#%3C%3E%3E"><span class="hs-operator hs-type">(&lt;&gt;&gt;)</span></a></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679481176"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="#local-6989586621679481177"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Map.NonEmpty.Monoidal.html#MonoidalNEMap"><span class="hs-identifier hs-type">MonoidalNEMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481176"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481177"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="annot"><a href="#local-6989586621679481176"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481177"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Map.NonEmpty.Monoidal.html#MonoidalNEMap"><span class="hs-identifier hs-type">MonoidalNEMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481176"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481177"><span class="hs-identifier hs-type">v</span></a></span></span></span><span>
</span><span id="line-215"></span><span id="local-6989586621679482176"><span class="annot"><span class="annottext">MonoidalNEMap k v
</span><a href="#local-6989586621679482176"><span class="hs-identifier hs-var">base</span></a></span></span><span> </span><span id="%3C%3E%3E"><span class="annot"><span class="annottext">&lt;&gt;&gt; :: forall k v.
(Ord k, Semigroup v) =&gt;
MonoidalNEMap k v -&gt; Map k v -&gt; MonoidalNEMap k v
</span><a href="HGeometry.PlaneGraph.Connected.FromIntersectingSegments.html#%3C%3E%3E"><span class="hs-operator hs-var hs-var">&lt;&gt;&gt;</span></a></span></span><span> </span><span id="local-6989586621679482177"><span class="annot"><span class="annottext">Map k v
</span><a href="#local-6989586621679482177"><span class="hs-identifier hs-var">new</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((k, v) -&gt; MonoidalNEMap k v -&gt; MonoidalNEMap k v)
-&gt; MonoidalNEMap k v -&gt; [(k, v)] -&gt; MonoidalNEMap k v
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(k -&gt; v -&gt; MonoidalNEMap k v -&gt; MonoidalNEMap k v)
-&gt; (k, v) -&gt; MonoidalNEMap k v -&gt; MonoidalNEMap k v
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">k -&gt; v -&gt; MonoidalNEMap k v -&gt; MonoidalNEMap k v
forall k v.
(Ord k, Semigroup v) =&gt;
k -&gt; v -&gt; MonoidalNEMap k v -&gt; MonoidalNEMap k v
</span><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.12.2/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Map.NonEmpty.Monoidal.html#insert"><span class="hs-identifier hs-var">MonoidalNEMap.insert</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MonoidalNEMap k v
</span><a href="#local-6989586621679482176"><span class="hs-identifier hs-var">base</span></a></span><span> </span><span class="annot"><span class="annottext">([(k, v)] -&gt; MonoidalNEMap k v) -&gt; [(k, v)] -&gt; MonoidalNEMap k v
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map k v -&gt; [(k, v)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toAscList</span></span><span> </span><span class="annot"><span class="annottext">Map k v
</span><a href="#local-6989586621679482177"><span class="hs-identifier hs-var">new</span></a></span><span>
</span><span id="line-216"></span></pre></body></html>