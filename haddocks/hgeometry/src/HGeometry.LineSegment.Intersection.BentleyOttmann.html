<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-2"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- Module      :  HGeometry.LineSegment.Intersection.BentleyOttmann</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- Copyright   :  (C) Frank Staals</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- License     :  see the LICENSE file</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- Maintainer  :  Frank Staals</span><span>
</span><span id="line-8"></span><span class="hs-comment">--</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- The \(O((n+k)\log n)\) time line segment intersection algorithm by Bentley</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- and Ottmann.</span><span>
</span><span id="line-11"></span><span class="hs-comment">--</span><span>
</span><span id="line-12"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-13"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html"><span class="hs-identifier">HGeometry.LineSegment.Intersection.BentleyOttmann</span></a></span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#intersections"><span class="hs-identifier">intersections</span></a></span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#interiorIntersections"><span class="hs-identifier">interiorIntersections</span></a></span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.Types.html#Intersections"><span class="hs-identifier">Intersections</span></a></span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.Types.html#intersectionPoints"><span class="hs-identifier">intersectionPoints</span></a></span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.Types.html#Associated"><span class="hs-identifier">Associated</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.Types.html#startPointOf"><span class="hs-identifier">startPointOf</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.Types.html#endPointOf"><span class="hs-identifier">endPointOf</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.Types.html#interiorTo"><span class="hs-identifier">interiorTo</span></a></span><span>
</span><span id="line-20"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.Types.html#associatedSegments"><span class="hs-identifier">associatedSegments</span></a></span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.Types.html#AroundEnd"><span class="hs-identifier">AroundEnd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.Types.html#AroundStart"><span class="hs-identifier">AroundStart</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.Types.html#AroundIntersection"><span class="hs-identifier">AroundIntersection</span></a></span><span>
</span><span id="line-23"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.Types.html#isInteriorIntersection"><span class="hs-identifier">isInteriorIntersection</span></a></span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.Types.html#IntersectionPoint"><span class="hs-identifier">IntersectionPoint</span></a></span><span>
</span><span id="line-26"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.Types.html#intersectionPointOf"><span class="hs-identifier">intersectionPointOf</span></a></span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.Types.html#intersectionPoint"><span class="hs-identifier">intersectionPoint</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.Types.html#associatedSegs"><span class="hs-identifier">associatedSegs</span></a></span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.Types.html#IntersectConstraints"><span class="hs-identifier">IntersectConstraints</span></a></span><span>
</span><span id="line-31"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.Types.html#OrdArounds"><span class="hs-identifier">OrdArounds</span></a></span><span>
</span><span id="line-32"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.html/Control.Lens.html"><span class="hs-identifier">Control.Lens</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.At.html/Control.Lens.At.html#contains"><span class="hs-identifier">contains</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Coerce</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">F</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Function</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">on</span></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Ord</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">comparing</span></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">EQ</span></span><span> </span><span class="hs-comment">-- event queue</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SS</span></span><span> </span><span class="hs-comment">-- status struct</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/vector-0.13.2.0-469fa586d848648e0ac6b4063215d74fc75db3883d0b743c4f65af91e864edda/share/doc/html/src/Data.Vector.html/Data.Vector.html"><span class="hs-identifier">Data.Vector</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Vector</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Foldable.Sort.html/HGeometry.Foldable.Sort.html"><span class="hs-identifier">HGeometry.Foldable.Sort</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">HGeometry.Intersection</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">HGeometry.Interval.Class</span></span><span>
</span><span id="line-51"></span><span class="hs-comment">-- import           HGeometry.Interval.EndPoint</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">HGeometry.LineSegment</span></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.Types.html"><span class="hs-identifier">HGeometry.LineSegment.Intersection.Types</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">HGeometry.Point</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">HGeometry.Properties</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NumType</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Dimension</span></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Set.Util.html/HGeometry.Set.Util.html"><span class="hs-identifier">HGeometry.Set.Util</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SS</span></span><span> </span><span class="hs-comment">-- status struct</span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="hs-comment">-- import           Debug.Trace</span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="hs-comment">-- | Compute all intersections</span><span>
</span><span id="line-63"></span><span class="hs-comment">--</span><span>
</span><span id="line-64"></span><span class="hs-comment">-- \(O((n+k)\log n)\), where \(k\) is the number of intersections.</span><span>
</span><span id="line-65"></span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#intersections"><span class="hs-identifier hs-type">intersections</span></a></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679489205"><span class="annot"><a href="#local-6989586621679489205"><span class="hs-identifier hs-type">lineSegment</span></a></span></span><span> </span><span id="local-6989586621679489206"><span class="annot"><a href="#local-6989586621679489206"><span class="hs-identifier hs-type">point</span></a></span></span><span> </span><span id="local-6989586621679489208"><span class="annot"><a href="#local-6989586621679489208"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621679489212"><span class="annot"><a href="#local-6989586621679489212"><span class="hs-identifier hs-type">f</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-66"></span><span>                      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LineSegment_</span></span><span> </span><span class="annot"><a href="#local-6989586621679489205"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489206"><span class="hs-identifier hs-type">point</span></a></span><span>
</span><span id="line-67"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Point_</span></span><span> </span><span class="annot"><a href="#local-6989586621679489206"><span class="hs-identifier hs-type">point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679489208"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-68"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679489205"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-69"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679489208"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679489208"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-70"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasOnSegment</span></span><span> </span><span class="annot"><a href="#local-6989586621679489205"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span>
</span><span id="line-71"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.Types.html#IntersectConstraints"><span class="hs-identifier hs-type">IntersectConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489205"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-72"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679489212"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="annot"><a href="#local-6989586621679489212"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-73"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StartPointOf</span></span><span> </span><span class="annot"><a href="#local-6989586621679489205"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">EndPointOf</span></span><span> </span><span class="annot"><a href="#local-6989586621679489205"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-74"></span><span>                      </span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span>                   </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679489212"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489205"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.Types.html#Intersections"><span class="hs-identifier hs-type">Intersections</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489208"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489205"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-76"></span><span id="intersections"><span class="annot"><span class="annottext">intersections :: forall lineSegment point r (f :: * -&gt; *).
(LineSegment_ lineSegment point, Point_ point 2 r, Eq lineSegment,
 Ord r, Fractional r, HasOnSegment lineSegment 2,
 IntersectConstraints lineSegment, Foldable f, Functor f,
 StartPointOf lineSegment ~ EndPointOf lineSegment) =&gt;
f lineSegment -&gt; Intersections r lineSegment
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#intersections"><span class="hs-identifier hs-var hs-var">intersections</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Associated (Flipped lineSegment) -&gt; Associated lineSegment)
-&gt; Map (Point 2 r) (Associated (Flipped lineSegment))
-&gt; Map (Point 2 r) (Associated lineSegment)
forall a b. (a -&gt; b) -&gt; Map (Point 2 r) a -&gt; Map (Point 2 r) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Associated (Flipped lineSegment) -&gt; Associated lineSegment
forall lineSegment point r.
(LineSegment_ lineSegment point, Point_ point 2 r, Fractional r,
 Ord r, IntersectConstraints lineSegment,
 StartPointOf lineSegment ~ EndPointOf lineSegment) =&gt;
Associated (Flipped lineSegment) -&gt; Associated lineSegment
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#unflipSegs"><span class="hs-identifier hs-var">unflipSegs</span></a></span><span> </span><span class="annot"><span class="annottext">(Map (Point 2 r) (Associated (Flipped lineSegment))
 -&gt; Map (Point 2 r) (Associated lineSegment))
-&gt; (f lineSegment
    -&gt; Map (Point 2 r) (Associated (Flipped lineSegment)))
-&gt; f lineSegment
-&gt; Map (Point 2 r) (Associated lineSegment)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">f (Flipped lineSegment)
-&gt; Map (Point 2 r) (Associated (Flipped lineSegment))
forall lineSegment point r (f :: * -&gt; *).
(LineSegment_ lineSegment point, Point_ point 2 r, Eq lineSegment,
 Ord r, Fractional r, HasOnSegment lineSegment 2,
 IntersectConstraints lineSegment,
 StartPointOf lineSegment ~ EndPointOf lineSegment, Foldable f) =&gt;
f lineSegment -&gt; Intersections r lineSegment
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#intersections%27"><span class="hs-identifier hs-var">intersections'</span></a></span><span> </span><span class="annot"><span class="annottext">(f (Flipped lineSegment)
 -&gt; Map (Point 2 r) (Associated (Flipped lineSegment)))
-&gt; (f lineSegment -&gt; f (Flipped lineSegment))
-&gt; f lineSegment
-&gt; Map (Point 2 r) (Associated (Flipped lineSegment))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(lineSegment -&gt; Flipped lineSegment)
-&gt; f lineSegment -&gt; f (Flipped lineSegment)
forall a b. (a -&gt; b) -&gt; f a -&gt; f b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">lineSegment -&gt; Flipped lineSegment
forall lineSegment point r.
(LineSegment_ lineSegment point, Point_ point 2 r, Ord r,
 StartPointOf lineSegment ~ EndPointOf lineSegment) =&gt;
lineSegment -&gt; Flipped lineSegment
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#tagFlipped"><span class="hs-identifier hs-var">tagFlipped</span></a></span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-comment">-- where</span><span>
</span><span id="line-78"></span><span>  </span><span class="hs-comment">--   intersections'' :: f (Flipped lineSegment) -&gt; Intersections r (Flipped lineSegment)</span><span>
</span><span id="line-79"></span><span>  </span><span class="hs-comment">--   intersections'' = intersections'</span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="hs-comment">-- intersections segs = fmap unflipSegs . merge $ sweep pts SS.empty</span><span>
</span><span id="line-83"></span><span class="hs-comment">--   where</span><span>
</span><span id="line-84"></span><span class="hs-comment">--     pts = EQ.fromAscList . groupStarts . sort . foldMap (asEventPts . tagFlipped) $ segs</span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span id="local-6989586621679489288"><span id="local-6989586621679489289"><span id="local-6989586621679489290"><span id="local-6989586621679489291"><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#intersections%27"><span class="hs-identifier hs-type">intersections'</span></a></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LineSegment_</span></span><span> </span><span class="annot"><a href="#local-6989586621679489288"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489289"><span class="hs-identifier hs-type">point</span></a></span><span>
</span><span id="line-88"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Point_</span></span><span> </span><span class="annot"><a href="#local-6989586621679489289"><span class="hs-identifier hs-type">point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679489290"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-89"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679489288"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-90"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679489290"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679489290"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-91"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasOnSegment</span></span><span> </span><span class="annot"><a href="#local-6989586621679489288"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span>
</span><span id="line-92"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.Types.html#IntersectConstraints"><span class="hs-identifier hs-type">IntersectConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489288"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-93"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StartPointOf</span></span><span> </span><span class="annot"><a href="#local-6989586621679489288"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">EndPointOf</span></span><span> </span><span class="annot"><a href="#local-6989586621679489288"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-94"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679489291"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-95"></span><span>                      </span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>                   </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679489291"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489288"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.Types.html#Intersections"><span class="hs-identifier hs-type">Intersections</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489290"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489288"><span class="hs-identifier hs-type">lineSegment</span></a></span></span></span></span></span><span>
</span><span id="line-97"></span><span id="intersections%27"><span class="annot"><span class="annottext">intersections' :: forall lineSegment point r (f :: * -&gt; *).
(LineSegment_ lineSegment point, Point_ point 2 r, Eq lineSegment,
 Ord r, Fractional r, HasOnSegment lineSegment 2,
 IntersectConstraints lineSegment,
 StartPointOf lineSegment ~ EndPointOf lineSegment, Foldable f) =&gt;
f lineSegment -&gt; Intersections r lineSegment
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#intersections%27"><span class="hs-identifier hs-var hs-var">intersections'</span></a></span></span><span> </span><span id="local-6989586621679490095"><span class="annot"><span class="annottext">f lineSegment
</span><a href="#local-6989586621679490095"><span class="hs-identifier hs-var">segs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[IntersectionPoint (Point 2 r) lineSegment]
-&gt; Intersections r lineSegment
forall r lineSegment.
(Ord r, Fractional r) =&gt;
[IntersectionPoint (Point 2 r) lineSegment]
-&gt; Intersections r lineSegment
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#merge"><span class="hs-identifier hs-var">merge</span></a></span><span> </span><span class="annot"><span class="annottext">([IntersectionPoint (Point 2 r) lineSegment]
 -&gt; Intersections r lineSegment)
-&gt; [IntersectionPoint (Point 2 r) lineSegment]
-&gt; Intersections r lineSegment
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EventQueue r lineSegment
-&gt; StatusStructure r lineSegment
-&gt; [IntersectionPoint (Point 2 r) lineSegment]
forall lineSegment point r.
(LineSegment_ lineSegment point, Point_ point 2 r, Ord r,
 Fractional r, IntersectConstraints lineSegment,
 HasOnSegment lineSegment 2) =&gt;
EventQueue r lineSegment
-&gt; StatusStructure r lineSegment
-&gt; [IntersectionPoint (Point 2 r) lineSegment]
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#sweep"><span class="hs-identifier hs-var">sweep</span></a></span><span> </span><span class="annot"><span class="annottext">EventQueue r lineSegment
</span><a href="#local-6989586621679490098"><span class="hs-identifier hs-var">pts</span></a></span><span> </span><span class="annot"><span class="annottext">StatusStructure r lineSegment
forall a. Set a
</span><span class="hs-identifier hs-var">SS.empty</span></span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-99"></span><span>    </span><span id="local-6989586621679490098"><span class="annot"><span class="annottext">pts :: EventQueue r lineSegment
</span><a href="#local-6989586621679490098"><span class="hs-identifier hs-var hs-var">pts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Event r lineSegment] -&gt; EventQueue r lineSegment
forall a. Eq a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">EQ.fromAscList</span></span><span> </span><span class="annot"><span class="annottext">([Event r lineSegment] -&gt; EventQueue r lineSegment)
-&gt; (f lineSegment -&gt; [Event r lineSegment])
-&gt; f lineSegment
-&gt; EventQueue r lineSegment
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Vector (Event r lineSegment) -&gt; [Event r lineSegment]
forall r lineSegment.
Eq r =&gt;
Vector (Event r lineSegment) -&gt; [Event r lineSegment]
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#groupStarts"><span class="hs-identifier hs-var">groupStarts</span></a></span><span> </span><span class="annot"><span class="annottext">(Vector (Event r lineSegment) -&gt; [Event r lineSegment])
-&gt; (f lineSegment -&gt; Vector (Event r lineSegment))
-&gt; f lineSegment
-&gt; [Event r lineSegment]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Event r lineSegment] -&gt; Vector (Event r lineSegment)
forall (vector :: * -&gt; *) (f :: * -&gt; *) a.
(Foldable f, Vector vector a, Ord a) =&gt;
f a -&gt; vector a
</span><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Foldable.Sort.html/HGeometry.Foldable.Sort.html#sort"><span class="hs-identifier hs-var">sort</span></a></span><span> </span><span class="annot"><span class="annottext">([Event r lineSegment] -&gt; Vector (Event r lineSegment))
-&gt; (f lineSegment -&gt; [Event r lineSegment])
-&gt; f lineSegment
-&gt; Vector (Event r lineSegment)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(lineSegment -&gt; [Event r lineSegment])
-&gt; f lineSegment -&gt; [Event r lineSegment]
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; f a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">lineSegment -&gt; [Event r lineSegment]
forall lineSegment point r.
(LineSegment_ lineSegment point, Point_ point 2 r) =&gt;
lineSegment -&gt; [Event r lineSegment]
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#asEventPts"><span class="hs-identifier hs-var">asEventPts</span></a></span><span> </span><span class="annot"><span class="annottext">(f lineSegment -&gt; EventQueue r lineSegment)
-&gt; f lineSegment -&gt; EventQueue r lineSegment
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">f lineSegment
</span><a href="#local-6989586621679490095"><span class="hs-identifier hs-var">segs</span></a></span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span class="hs-comment">-- | Computes all intersection points p s.t. p lies in the interior of at least</span><span>
</span><span id="line-103"></span><span class="hs-comment">-- one of the segments.</span><span>
</span><span id="line-104"></span><span class="hs-comment">--</span><span>
</span><span id="line-105"></span><span class="hs-comment">--  \(O((n+k)\log n)\), where \(k\) is the number of intersections.</span><span>
</span><span id="line-106"></span><span id="local-6989586621679489334"><span id="local-6989586621679489335"><span id="local-6989586621679489336"><span id="local-6989586621679489337"><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#interiorIntersections"><span class="hs-identifier hs-type">interiorIntersections</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LineSegment_</span></span><span> </span><span class="annot"><a href="#local-6989586621679489334"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489335"><span class="hs-identifier hs-type">point</span></a></span><span>
</span><span id="line-107"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Point_</span></span><span> </span><span class="annot"><a href="#local-6989586621679489335"><span class="hs-identifier hs-type">point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679489336"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-108"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679489334"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-109"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679489336"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679489336"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-110"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.Types.html#IntersectConstraints"><span class="hs-identifier hs-type">IntersectConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489334"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-111"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StartPointOf</span></span><span> </span><span class="annot"><a href="#local-6989586621679489334"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">EndPointOf</span></span><span> </span><span class="annot"><a href="#local-6989586621679489334"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-112"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasOnSegment</span></span><span> </span><span class="annot"><a href="#local-6989586621679489334"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span>
</span><span id="line-113"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679489337"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="annot"><a href="#local-6989586621679489337"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-114"></span><span>                         </span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>                      </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679489337"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489334"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.Types.html#Intersections"><span class="hs-identifier hs-type">Intersections</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489336"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489334"><span class="hs-identifier hs-type">lineSegment</span></a></span></span></span></span></span><span>
</span><span id="line-116"></span><span id="interiorIntersections"><span class="annot"><span class="annottext">interiorIntersections :: forall lineSegment point r (f :: * -&gt; *).
(LineSegment_ lineSegment point, Point_ point 2 r, Eq lineSegment,
 Ord r, Fractional r, IntersectConstraints lineSegment,
 StartPointOf lineSegment ~ EndPointOf lineSegment,
 HasOnSegment lineSegment 2, Foldable f, Functor f) =&gt;
f lineSegment -&gt; Intersections r lineSegment
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#interiorIntersections"><span class="hs-identifier hs-var hs-var">interiorIntersections</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Associated lineSegment -&gt; Bool)
-&gt; Map (Point 2 r) (Associated lineSegment)
-&gt; Map (Point 2 r) (Associated lineSegment)
forall a k. (a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.filter</span></span><span> </span><span class="annot"><span class="annottext">Associated lineSegment -&gt; Bool
forall lineSegment. Associated lineSegment -&gt; Bool
</span><a href="HGeometry.LineSegment.Intersection.Types.html#isInteriorIntersection"><span class="hs-identifier hs-var">isInteriorIntersection</span></a></span><span> </span><span class="annot"><span class="annottext">(Map (Point 2 r) (Associated lineSegment)
 -&gt; Map (Point 2 r) (Associated lineSegment))
-&gt; (f lineSegment -&gt; Map (Point 2 r) (Associated lineSegment))
-&gt; f lineSegment
-&gt; Map (Point 2 r) (Associated lineSegment)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">f lineSegment -&gt; Map (Point 2 r) (Associated lineSegment)
forall lineSegment point r (f :: * -&gt; *).
(LineSegment_ lineSegment point, Point_ point 2 r, Eq lineSegment,
 Ord r, Fractional r, HasOnSegment lineSegment 2,
 IntersectConstraints lineSegment, Foldable f, Functor f,
 StartPointOf lineSegment ~ EndPointOf lineSegment) =&gt;
f lineSegment -&gt; Intersections r lineSegment
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#intersections"><span class="hs-identifier hs-var">intersections</span></a></span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="annot"><span class="hs-comment">-- | Computes the event points for a given line segment</span></span><span>
</span><span id="line-121"></span><span id="local-6989586621679489331"><span id="local-6989586621679489332"><span id="local-6989586621679489333"><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#asEventPts"><span class="hs-identifier hs-type">asEventPts</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LineSegment_</span></span><span> </span><span class="annot"><a href="#local-6989586621679489331"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489332"><span class="hs-identifier hs-type">point</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Point_</span></span><span> </span><span class="annot"><a href="#local-6989586621679489332"><span class="hs-identifier hs-type">point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679489333"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>             </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679489331"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489333"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489331"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-123"></span><span id="asEventPts"><span class="annot"><span class="annottext">asEventPts :: forall lineSegment point r.
(LineSegment_ lineSegment point, Point_ point 2 r) =&gt;
lineSegment -&gt; [Event r lineSegment]
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#asEventPts"><span class="hs-identifier hs-var hs-var">asEventPts</span></a></span></span><span> </span><span id="local-6989586621679490148"><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679490148"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; EventType lineSegment -&gt; Event r lineSegment
forall r lineSegment.
Point 2 r -&gt; EventType lineSegment -&gt; Event r lineSegment
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-var">Event</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679490148"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">lineSegment
-&gt; Getting (Point 2 r) lineSegment (Point 2 r) -&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">(point -&gt; Const (Point 2 r) point)
-&gt; lineSegment -&gt; Const (Point 2 r) lineSegment
forall seg p. HasStart seg p =&gt; Lens' seg p
Lens' lineSegment point
</span><span class="hs-identifier hs-var">start</span></span><span class="annot"><span class="annottext">((point -&gt; Const (Point 2 r) point)
 -&gt; lineSegment -&gt; Const (Point 2 r) lineSegment)
-&gt; ((Point 2 r -&gt; Const (Point 2 r) (Point 2 r))
    -&gt; point -&gt; Const (Point 2 r) point)
-&gt; Getting (Point 2 r) lineSegment (Point 2 r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Point 2 r -&gt; Const (Point 2 r) (Point 2 r))
-&gt; point -&gt; Const (Point 2 r) point
forall point (d :: Nat) r.
Point_ point d r =&gt;
Lens' point (Point d r)
Lens' point (Point 2 r)
</span><span class="hs-identifier hs-var">asPoint</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty lineSegment -&gt; EventType lineSegment
forall s. NonEmpty s -&gt; EventType s
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-var">Start</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty lineSegment -&gt; EventType lineSegment)
-&gt; NonEmpty lineSegment -&gt; EventType lineSegment
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679490148"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">lineSegment -&gt; [lineSegment] -&gt; NonEmpty lineSegment
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; EventType lineSegment -&gt; Event r lineSegment
forall r lineSegment.
Point 2 r -&gt; EventType lineSegment -&gt; Event r lineSegment
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-var">Event</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679490148"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">lineSegment
-&gt; Getting (Point 2 r) lineSegment (Point 2 r) -&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">(point -&gt; Const (Point 2 r) point)
-&gt; lineSegment -&gt; Const (Point 2 r) lineSegment
forall seg p. HasEnd seg p =&gt; Lens' seg p
Lens' lineSegment point
</span><span class="hs-identifier hs-var">end</span></span><span class="annot"><span class="annottext">((point -&gt; Const (Point 2 r) point)
 -&gt; lineSegment -&gt; Const (Point 2 r) lineSegment)
-&gt; ((Point 2 r -&gt; Const (Point 2 r) (Point 2 r))
    -&gt; point -&gt; Const (Point 2 r) point)
-&gt; Getting (Point 2 r) lineSegment (Point 2 r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Point 2 r -&gt; Const (Point 2 r) (Point 2 r))
-&gt; point -&gt; Const (Point 2 r) point
forall point (d :: Nat) r.
Point_ point d r =&gt;
Lens' point (Point d r)
Lens' point (Point 2 r)
</span><span class="hs-identifier hs-var">asPoint</span></span><span class="hs-special">)</span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">lineSegment -&gt; EventType lineSegment
forall s. s -&gt; EventType s
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#End"><span class="hs-identifier hs-var">End</span></a></span><span> </span><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679490148"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>               </span><span class="hs-special">]</span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span class="annot"><span class="hs-comment">-- | Group the segments with the intersection points</span></span><span>
</span><span id="line-128"></span><span id="local-6989586621679489309"><span id="local-6989586621679489310"><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#merge"><span class="hs-identifier hs-type">merge</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679489309"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679489309"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span>      </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.Types.html#IntersectionPoint"><span class="hs-identifier hs-type">IntersectionPoint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Point</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679489309"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679489310"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.Types.html#Intersections"><span class="hs-identifier hs-type">Intersections</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489309"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489310"><span class="hs-identifier hs-type">lineSegment</span></a></span></span></span><span>
</span><span id="line-130"></span><span id="merge"><span class="annot"><span class="annottext">merge :: forall r lineSegment.
(Ord r, Fractional r) =&gt;
[IntersectionPoint (Point 2 r) lineSegment]
-&gt; Intersections r lineSegment
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#merge"><span class="hs-identifier hs-var hs-var">merge</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IntersectionPoint (Point 2 r) lineSegment
 -&gt; Intersections r lineSegment)
-&gt; [IntersectionPoint (Point 2 r) lineSegment]
-&gt; Intersections r lineSegment
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; [a] -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679490168"><span class="annot"><span class="annottext">IntersectionPoint (Point 2 r) lineSegment
</span><a href="#local-6989586621679490168"><span class="hs-identifier hs-var">ip</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Associated lineSegment -&gt; Intersections r lineSegment
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IntersectionPoint (Point 2 r) lineSegment
</span><a href="#local-6989586621679490168"><span class="hs-identifier hs-var">ip</span></a></span><span class="annot"><span class="annottext">IntersectionPoint (Point 2 r) lineSegment
-&gt; Getting
     (Point 2 r) (IntersectionPoint (Point 2 r) lineSegment) (Point 2 r)
-&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">Getting
  (Point 2 r) (IntersectionPoint (Point 2 r) lineSegment) (Point 2 r)
forall point lineSegment point' (f :: * -&gt; *).
Functor f =&gt;
(point -&gt; f point')
-&gt; IntersectionPoint point lineSegment
-&gt; f (IntersectionPoint point' lineSegment)
</span><a href="HGeometry.LineSegment.Intersection.Types.html#intersectionPoint"><span class="hs-identifier hs-var">intersectionPoint</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IntersectionPoint (Point 2 r) lineSegment
</span><a href="#local-6989586621679490168"><span class="hs-identifier hs-var">ip</span></a></span><span class="annot"><span class="annottext">IntersectionPoint (Point 2 r) lineSegment
-&gt; Getting
     (Associated lineSegment)
     (IntersectionPoint (Point 2 r) lineSegment)
     (Associated lineSegment)
-&gt; Associated lineSegment
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">Getting
  (Associated lineSegment)
  (IntersectionPoint (Point 2 r) lineSegment)
  (Associated lineSegment)
forall point lineSegment lineSegment' (f :: * -&gt; *).
Functor f =&gt;
(Associated lineSegment -&gt; f (Associated lineSegment'))
-&gt; IntersectionPoint point lineSegment
-&gt; f (IntersectionPoint point lineSegment')
</span><a href="HGeometry.LineSegment.Intersection.Types.html#associatedSegs"><span class="hs-identifier hs-var">associatedSegs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span id="local-6989586621679489323"><span id="local-6989586621679489324"><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#groupStarts"><span class="hs-identifier hs-type">groupStarts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679489323"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/vector-0.13.2.0-469fa586d848648e0ac6b4063215d74fc75db3883d0b743c4f65af91e864edda/share/doc/html/src/Data.Vector.html/Data.Vector.html#Vector"><span class="hs-identifier hs-type">Vector.Vector</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489323"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489324"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489323"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489324"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-133"></span><span id="groupStarts"><span class="annot"><span class="annottext">groupStarts :: forall r lineSegment.
Eq r =&gt;
Vector (Event r lineSegment) -&gt; [Event r lineSegment]
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#groupStarts"><span class="hs-identifier hs-var hs-var">groupStarts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Event r lineSegment] -&gt; [Event r lineSegment]
forall r lineSegment.
Eq r =&gt;
[Event r lineSegment] -&gt; [Event r lineSegment]
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#groupStarts%27"><span class="hs-identifier hs-var">groupStarts'</span></a></span><span> </span><span class="annot"><span class="annottext">([Event r lineSegment] -&gt; [Event r lineSegment])
-&gt; (Vector (Event r lineSegment) -&gt; [Event r lineSegment])
-&gt; Vector (Event r lineSegment)
-&gt; [Event r lineSegment]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Vector (Event r lineSegment) -&gt; [Event r lineSegment]
forall a. Vector a -&gt; [a]
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/vector-0.13.2.0-469fa586d848648e0ac6b4063215d74fc75db3883d0b743c4f65af91e864edda/share/doc/html/src/Data.Vector.html/Data.Vector.html#toList"><span class="hs-identifier hs-var">Vector.toList</span></a></span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span class="hs-comment">-- | Group the startpoints such that segments with the same start point</span><span>
</span><span id="line-136"></span><span class="hs-comment">-- correspond to one event.</span><span>
</span><span id="line-137"></span><span id="local-6989586621679489392"><span id="local-6989586621679489393"><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#groupStarts%27"><span class="hs-identifier hs-type">groupStarts'</span></a></span><span>                          </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679489392"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489392"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489393"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489392"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489393"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-138"></span><span id="groupStarts%27"><span class="annot"><span class="annottext">groupStarts' :: forall r lineSegment.
Eq r =&gt;
[Event r lineSegment] -&gt; [Event r lineSegment]
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#groupStarts%27"><span class="hs-identifier hs-var hs-var">groupStarts'</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-139"></span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#groupStarts%27"><span class="hs-identifier hs-var">groupStarts'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span id="local-6989586621679490182"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679490182"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-type">Start</span></a></span><span> </span><span id="local-6989586621679490183"><span class="annot"><span class="annottext">NonEmpty lineSegment
</span><a href="#local-6989586621679490183"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679490184"><span class="annot"><span class="annottext">[Event r lineSegment]
</span><a href="#local-6989586621679490184"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; EventType lineSegment -&gt; Event r lineSegment
forall r lineSegment.
Point 2 r -&gt; EventType lineSegment -&gt; Event r lineSegment
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-var">Event</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679490182"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty lineSegment -&gt; EventType lineSegment
forall s. NonEmpty s -&gt; EventType s
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-var">Start</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty lineSegment
</span><a href="#local-6989586621679490185"><span class="hs-identifier hs-var">ss</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Event r lineSegment
-&gt; [Event r lineSegment] -&gt; [Event r lineSegment]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Event r lineSegment] -&gt; [Event r lineSegment]
forall r lineSegment.
Eq r =&gt;
[Event r lineSegment] -&gt; [Event r lineSegment]
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#groupStarts%27"><span class="hs-identifier hs-var">groupStarts'</span></a></span><span> </span><span class="annot"><span class="annottext">[Event r lineSegment]
</span><a href="#local-6989586621679490186"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-141"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679490187"><span class="annot"><span class="annottext">[Event r lineSegment]
</span><a href="#local-6989586621679490187"><span class="hs-identifier hs-var">ss'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679490186"><span class="annot"><span class="annottext">[Event r lineSegment]
</span><a href="#local-6989586621679490186"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Event r lineSegment -&gt; Bool)
-&gt; [Event r lineSegment]
-&gt; ([Event r lineSegment], [Event r lineSegment])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">List.span</span></span><span> </span><span class="annot"><span class="annottext">Event r lineSegment -&gt; Bool
</span><a href="#local-6989586621679490189"><span class="hs-identifier hs-var">sameStart</span></a></span><span> </span><span class="annot"><span class="annottext">[Event r lineSegment]
</span><a href="#local-6989586621679490184"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-comment">-- FIXME: this seems to keep the segments on decreasing y, increasing x. shouldn't we</span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-comment">-- sort them cyclically around p instead?</span><span>
</span><span id="line-144"></span><span>    </span><span id="local-6989586621679490185"><span class="annot"><span class="annottext">ss :: NonEmpty lineSegment
</span><a href="#local-6989586621679490185"><span class="hs-identifier hs-var hs-var">ss</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679490190"><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679490190"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span id="local-6989586621679490191"><span class="annot"><span class="annottext">[lineSegment]
</span><a href="#local-6989586621679490191"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty lineSegment
</span><a href="#local-6989586621679490183"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-145"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679490190"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">lineSegment -&gt; [lineSegment] -&gt; NonEmpty lineSegment
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[lineSegment]
</span><a href="#local-6989586621679490191"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[lineSegment] -&gt; [lineSegment] -&gt; [lineSegment]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(Event r lineSegment -&gt; [lineSegment])
-&gt; [Event r lineSegment] -&gt; [lineSegment]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">Event r lineSegment -&gt; [lineSegment]
forall r lineSegment. Event r lineSegment -&gt; [lineSegment]
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#startSegs"><span class="hs-identifier hs-var">startSegs</span></a></span><span> </span><span class="annot"><span class="annottext">[Event r lineSegment]
</span><a href="#local-6989586621679490187"><span class="hs-identifier hs-var">ss'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span>    </span><span id="local-6989586621679490189"><span class="annot"><span class="annottext">sameStart :: Event r lineSegment -&gt; Bool
</span><a href="#local-6989586621679490189"><span class="hs-identifier hs-var hs-var">sameStart</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span id="local-6989586621679490194"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679490194"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-type">Start</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty lineSegment
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679490182"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679490194"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-148"></span><span>    </span><span class="annot"><a href="#local-6989586621679490189"><span class="hs-identifier hs-var">sameStart</span></a></span><span> </span><span class="annot"><span class="annottext">Event r lineSegment
</span><span class="hs-identifier">_</span></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-149"></span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#groupStarts%27"><span class="hs-identifier hs-var">groupStarts'</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679490195"><span class="annot"><span class="annottext">Event r lineSegment
</span><a href="#local-6989586621679490195"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679490196"><span class="annot"><span class="annottext">[Event r lineSegment]
</span><a href="#local-6989586621679490196"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Event r lineSegment
</span><a href="#local-6989586621679490195"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Event r lineSegment
-&gt; [Event r lineSegment] -&gt; [Event r lineSegment]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Event r lineSegment] -&gt; [Event r lineSegment]
forall r lineSegment.
Eq r =&gt;
[Event r lineSegment] -&gt; [Event r lineSegment]
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#groupStarts%27"><span class="hs-identifier hs-var">groupStarts'</span></a></span><span> </span><span class="annot"><span class="annottext">[Event r lineSegment]
</span><a href="#local-6989586621679490196"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-152"></span><span class="annot"><span class="hs-comment">-- * Data type for Events</span></span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="annot"><span class="hs-comment">-- | Type of segment</span></span><span>
</span><span id="line-155"></span><span class="hs-keyword">data</span><span> </span><span id="EventType"><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#EventType"><span class="hs-identifier hs-var">EventType</span></a></span></span><span> </span><span id="local-6989586621679489369"><span class="annot"><a href="#local-6989586621679489369"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Start"><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-var">Start</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><a href="#local-6989586621679489369"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-glyph">|</span><span> </span><span id="Intersection"><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Intersection"><span class="hs-identifier hs-var">Intersection</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="End"><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#End"><span class="hs-identifier hs-var">End</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="#local-6989586621679489369"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679490200"><span id="local-6989586621679490208"><span id="local-6989586621679490212"><span class="annot"><span class="annottext">Int -&gt; EventType s -&gt; ShowS
[EventType s] -&gt; ShowS
EventType s -&gt; String
(Int -&gt; EventType s -&gt; ShowS)
-&gt; (EventType s -&gt; String)
-&gt; ([EventType s] -&gt; ShowS)
-&gt; Show (EventType s)
forall s. Show s =&gt; Int -&gt; EventType s -&gt; ShowS
forall s. Show s =&gt; [EventType s] -&gt; ShowS
forall s. Show s =&gt; EventType s -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: forall s. Show s =&gt; Int -&gt; EventType s -&gt; ShowS
showsPrec :: Int -&gt; EventType s -&gt; ShowS
$cshow :: forall s. Show s =&gt; EventType s -&gt; String
show :: EventType s -&gt; String
$cshowList :: forall s. Show s =&gt; [EventType s] -&gt; ShowS
showList :: [EventType s] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679489413"><span id="local-6989586621679490218"><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#EventType"><span class="hs-identifier hs-type">EventType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489413"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-158"></span><span>  </span><span id="local-6989586621679490226"><span class="annot"><span class="annottext">EventType s
</span><a href="#local-6989586621679490226"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679490227"><span class="annot"><span class="annottext">== :: EventType s -&gt; EventType s -&gt; Bool
</span><span class="hs-operator hs-var hs-var hs-var">==</span></span></span><span> </span><span id="local-6989586621679490228"><span class="annot"><span class="annottext">EventType s
</span><a href="#local-6989586621679490228"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EventType s
</span><a href="#local-6989586621679490226"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">EventType s -&gt; EventType s -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="annot"><span class="annottext">EventType s
</span><a href="#local-6989586621679490228"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Ordering -&gt; Ordering -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679489414"><span id="local-6989586621679490234"><span id="local-6989586621679490237"><span id="local-6989586621679490240"><span id="local-6989586621679490243"><span id="local-6989586621679490246"><span id="local-6989586621679490249"><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#EventType"><span class="hs-identifier hs-type">EventType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489414"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-type">Start</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>    </span><span id="local-6989586621679490252"><span class="annot"><span class="annottext">compare :: EventType s -&gt; EventType s -&gt; Ordering
</span><span class="hs-operator hs-var hs-var hs-var">`compare`</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-type">Start</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span>
</span><span id="line-162"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-type">Start</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>    </span><span class="annot"><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="annot"><span class="annottext">EventType s
</span><span class="hs-identifier">_</span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">LT</span></span><span>
</span><span id="line-163"></span><span>  </span><span class="annot"><span class="annottext">EventType s
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Intersection"><span class="hs-identifier hs-var">Intersection</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-type">Start</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span>
</span><span id="line-164"></span><span>  </span><span class="annot"><span class="annottext">EventType s
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Intersection"><span class="hs-identifier hs-var">Intersection</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="annot"><span class="annottext">EventType s
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Intersection"><span class="hs-identifier hs-var">Intersection</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span>
</span><span id="line-165"></span><span>  </span><span class="annot"><span class="annottext">EventType s
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Intersection"><span class="hs-identifier hs-var">Intersection</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#End"><span class="hs-identifier hs-type">End</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">LT</span></span><span>
</span><span id="line-166"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#End"><span class="hs-identifier hs-type">End</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>      </span><span class="annot"><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#End"><span class="hs-identifier hs-type">End</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span>
</span><span id="line-167"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#End"><span class="hs-identifier hs-type">End</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>      </span><span class="annot"><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="annot"><span class="annottext">EventType s
</span><span class="hs-identifier">_</span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span class="annot"><span class="hs-comment">-- | The actual event consists of a point and its type</span></span><span>
</span><span id="line-170"></span><span class="hs-keyword">data</span><span> </span><span id="Event"><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-var">Event</span></a></span></span><span> </span><span id="local-6989586621679489358"><span class="annot"><a href="#local-6989586621679489358"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621679489359"><span class="annot"><a href="#local-6989586621679489359"><span class="hs-identifier hs-type">lineSegment</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Event"><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-var">Event</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="eventPoint"><span class="annot"><span class="annottext">forall r lineSegment. Event r lineSegment -&gt; Point 2 r
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#eventPoint"><span class="hs-identifier hs-var hs-var">eventPoint</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Point</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679489358"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span id="eventType"><span class="annot"><span class="annottext">forall r lineSegment. Event r lineSegment -&gt; EventType lineSegment
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#eventType"><span class="hs-identifier hs-var hs-var">eventType</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#EventType"><span class="hs-identifier hs-type">EventType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489359"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span>                                 </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679490258"><span id="local-6989586621679490267"><span id="local-6989586621679490271"><span class="annot"><span class="annottext">Int -&gt; Event r lineSegment -&gt; ShowS
[Event r lineSegment] -&gt; ShowS
Event r lineSegment -&gt; String
(Int -&gt; Event r lineSegment -&gt; ShowS)
-&gt; (Event r lineSegment -&gt; String)
-&gt; ([Event r lineSegment] -&gt; ShowS)
-&gt; Show (Event r lineSegment)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall r lineSegment.
(Show r, Show lineSegment) =&gt;
Int -&gt; Event r lineSegment -&gt; ShowS
forall r lineSegment.
(Show r, Show lineSegment) =&gt;
[Event r lineSegment] -&gt; ShowS
forall r lineSegment.
(Show r, Show lineSegment) =&gt;
Event r lineSegment -&gt; String
$cshowsPrec :: forall r lineSegment.
(Show r, Show lineSegment) =&gt;
Int -&gt; Event r lineSegment -&gt; ShowS
showsPrec :: Int -&gt; Event r lineSegment -&gt; ShowS
$cshow :: forall r lineSegment.
(Show r, Show lineSegment) =&gt;
Event r lineSegment -&gt; String
show :: Event r lineSegment -&gt; String
$cshowList :: forall r lineSegment.
(Show r, Show lineSegment) =&gt;
[Event r lineSegment] -&gt; ShowS
showList :: [Event r lineSegment] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span id="local-6989586621679490303"><span id="local-6989586621679490308"><span class="annot"><span class="annottext">Event r lineSegment -&gt; Event r lineSegment -&gt; Bool
(Event r lineSegment -&gt; Event r lineSegment -&gt; Bool)
-&gt; (Event r lineSegment -&gt; Event r lineSegment -&gt; Bool)
-&gt; Eq (Event r lineSegment)
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
forall r lineSegment.
Eq r =&gt;
Event r lineSegment -&gt; Event r lineSegment -&gt; Bool
$c== :: forall r lineSegment.
Eq r =&gt;
Event r lineSegment -&gt; Event r lineSegment -&gt; Bool
== :: Event r lineSegment -&gt; Event r lineSegment -&gt; Bool
$c/= :: forall r lineSegment.
Eq r =&gt;
Event r lineSegment -&gt; Event r lineSegment -&gt; Bool
/= :: Event r lineSegment -&gt; Event r lineSegment -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679489306"><span id="local-6989586621679489307"><span id="local-6989586621679490316"><span id="local-6989586621679490319"><span id="local-6989586621679490322"><span id="local-6989586621679490325"><span id="local-6989586621679490328"><span id="local-6989586621679490331"><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679489306"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489306"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489307"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-175"></span><span>  </span><span class="hs-comment">-- decreasing on the y-coord, then increasing on x-coord, and increasing on event-type</span><span>
</span><span id="line-176"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span id="local-6989586621679490352"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679490352"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679490353"><span class="annot"><span class="annottext">EventType lineSegment
</span><a href="#local-6989586621679490353"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679490354"><span class="annot"><span class="annottext">compare :: Event r lineSegment -&gt; Event r lineSegment -&gt; Ordering
</span><span class="hs-operator hs-var hs-var hs-var">`compare`</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span id="local-6989586621679490355"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679490355"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621679490356"><span class="annot"><span class="annottext">EventType lineSegment
</span><a href="#local-6989586621679490356"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; Ordering
forall point r.
(Point_ point 2 r, Ord r) =&gt;
point -&gt; point -&gt; Ordering
</span><a href="HGeometry.LineSegment.Intersection.Types.html#ordPoints"><span class="hs-identifier hs-var">ordPoints</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679490352"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679490355"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-177"></span><span>                                        </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EventType lineSegment
</span><a href="#local-6989586621679490353"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">EventType lineSegment -&gt; EventType lineSegment -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="annot"><span class="annottext">EventType lineSegment
</span><a href="#local-6989586621679490356"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-178"></span><span>                                        </span><span id="local-6989586621679490358"><span class="annot"><span class="annottext">Ordering
</span><a href="#local-6989586621679490358"><span class="hs-identifier hs-var">x</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><a href="#local-6989586621679490358"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span class="annot"><span class="hs-comment">-- | Get the segments that start at the given event point</span></span><span>
</span><span id="line-181"></span><span id="local-6989586621679489404"><span id="local-6989586621679489405"><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#startSegs"><span class="hs-identifier hs-type">startSegs</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489404"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489405"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679489405"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-182"></span><span id="startSegs"><span class="annot"><span class="annottext">startSegs :: forall r lineSegment. Event r lineSegment -&gt; [lineSegment]
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#startSegs"><span class="hs-identifier hs-var hs-var">startSegs</span></a></span></span><span> </span><span id="local-6989586621679490359"><span class="annot"><span class="annottext">Event r lineSegment
</span><a href="#local-6989586621679490359"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Event r lineSegment -&gt; EventType lineSegment
forall r lineSegment. Event r lineSegment -&gt; EventType lineSegment
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#eventType"><span class="hs-identifier hs-var">eventType</span></a></span><span> </span><span class="annot"><span class="annottext">Event r lineSegment
</span><a href="#local-6989586621679490359"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-183"></span><span>                </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-type">Start</span></a></span><span> </span><span id="local-6989586621679490360"><span class="annot"><span class="annottext">NonEmpty lineSegment
</span><a href="#local-6989586621679490360"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NonEmpty lineSegment -&gt; [lineSegment]
forall a. NonEmpty a -&gt; [a]
</span><span class="hs-identifier hs-var">NonEmpty.toList</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty lineSegment
</span><a href="#local-6989586621679490360"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-184"></span><span>                </span><span class="annot"><span class="annottext">EventType lineSegment
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-187"></span><span class="annot"><span class="hs-comment">-- * The Main Sweep</span></span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="hs-keyword">type</span><span> </span><span id="EventQueue"><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#EventQueue"><span class="hs-identifier hs-var">EventQueue</span></a></span></span><span>      </span><span id="local-6989586621679490362"><span class="annot"><a href="#local-6989586621679490362"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621679490363"><span class="annot"><a href="#local-6989586621679490363"><span class="hs-identifier hs-type">lineSegment</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EQ.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679490362"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679490363"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span class="hs-keyword">type</span><span> </span><span id="StatusStructure"><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#StatusStructure"><span class="hs-identifier hs-var">StatusStructure</span></a></span></span><span> </span><span id="local-6989586621679490364"><span class="annot"><a href="#local-6989586621679490364"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621679490365"><span class="annot"><a href="#local-6989586621679490365"><span class="hs-identifier hs-type">lineSegment</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SS.Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679490365"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span class="annot"><span class="hs-comment">-- | Run the sweep handling all events</span></span><span>
</span><span id="line-193"></span><span id="local-6989586621679489317"><span id="local-6989586621679489318"><span id="local-6989586621679489319"><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#sweep"><span class="hs-identifier hs-type">sweep</span></a></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LineSegment_</span></span><span> </span><span class="annot"><a href="#local-6989586621679489317"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489318"><span class="hs-identifier hs-type">point</span></a></span><span>
</span><span id="line-194"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Point_</span></span><span> </span><span class="annot"><a href="#local-6989586621679489318"><span class="hs-identifier hs-type">point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679489319"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-195"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679489319"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679489319"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-196"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.Types.html#IntersectConstraints"><span class="hs-identifier hs-type">IntersectConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489317"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-197"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasOnSegment</span></span><span> </span><span class="annot"><a href="#local-6989586621679489317"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span>
</span><span id="line-198"></span><span>               </span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#EventQueue"><span class="hs-identifier hs-type">EventQueue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489319"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489317"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#StatusStructure"><span class="hs-identifier hs-type">StatusStructure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489319"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489317"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-200"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.Types.html#IntersectionPoint"><span class="hs-identifier hs-type">IntersectionPoint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Point</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679489319"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679489317"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-201"></span><span id="sweep"><span class="annot"><span class="annottext">sweep :: forall lineSegment point r.
(LineSegment_ lineSegment point, Point_ point 2 r, Ord r,
 Fractional r, IntersectConstraints lineSegment,
 HasOnSegment lineSegment 2) =&gt;
EventQueue r lineSegment
-&gt; StatusStructure r lineSegment
-&gt; [IntersectionPoint (Point 2 r) lineSegment]
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#sweep"><span class="hs-identifier hs-var hs-var">sweep</span></a></span></span><span> </span><span id="local-6989586621679490381"><span class="annot"><span class="annottext">EventQueue r lineSegment
</span><a href="#local-6989586621679490381"><span class="hs-identifier hs-var">eq</span></a></span></span><span> </span><span id="local-6989586621679490382"><span class="annot"><span class="annottext">StatusStructure r lineSegment
</span><a href="#local-6989586621679490382"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EventQueue r lineSegment
-&gt; Maybe (Event r lineSegment, EventQueue r lineSegment)
forall a. Set a -&gt; Maybe (a, Set a)
</span><span class="hs-identifier hs-var">EQ.minView</span></span><span> </span><span class="annot"><span class="annottext">EventQueue r lineSegment
</span><a href="#local-6989586621679490381"><span class="hs-identifier hs-var">eq</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-202"></span><span>                </span><span class="annot"><span class="annottext">Maybe (Event r lineSegment, EventQueue r lineSegment)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-203"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679490384"><span class="annot"><span class="annottext">Event r lineSegment
</span><a href="#local-6989586621679490384"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679490385"><span class="annot"><span class="annottext">EventQueue r lineSegment
</span><a href="#local-6989586621679490385"><span class="hs-identifier hs-var">eq'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Event r lineSegment
-&gt; EventQueue r lineSegment
-&gt; StatusStructure r lineSegment
-&gt; [IntersectionPoint (Point 2 r) lineSegment]
forall lineSegment point r.
(LineSegment_ lineSegment point, Point_ point 2 r, Ord r,
 Fractional r, IntersectConstraints lineSegment,
 HasOnSegment lineSegment 2) =&gt;
Event r lineSegment
-&gt; EventQueue r lineSegment
-&gt; StatusStructure r lineSegment
-&gt; [IntersectionPoint (Point 2 r) lineSegment]
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#handle"><span class="hs-identifier hs-var">handle</span></a></span><span> </span><span class="annot"><span class="annottext">Event r lineSegment
</span><a href="#local-6989586621679490384"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">EventQueue r lineSegment
</span><a href="#local-6989586621679490385"><span class="hs-identifier hs-var">eq'</span></a></span><span> </span><span class="annot"><span class="annottext">StatusStructure r lineSegment
</span><a href="#local-6989586621679490382"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span id="local-6989586621679489453"><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#isOpen"><span class="hs-identifier hs-type">isOpen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EndPoint_</span></span><span> </span><span class="annot"><a href="#local-6989586621679489453"><span class="hs-identifier hs-type">endPoint</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679489453"><span class="hs-identifier hs-type">endPoint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-206"></span><span id="isOpen"><span class="annot"><span class="annottext">isOpen :: forall endPoint. EndPoint_ endPoint =&gt; endPoint -&gt; Bool
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#isOpen"><span class="hs-identifier hs-var hs-var">isOpen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EndPointType -&gt; EndPointType -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">EndPointType
</span><span class="hs-identifier hs-var">Open</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(EndPointType -&gt; Bool)
-&gt; (endPoint -&gt; EndPointType) -&gt; endPoint -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">endPoint -&gt; EndPointType
forall endPoint. EndPoint_ endPoint =&gt; endPoint -&gt; EndPointType
</span><span class="hs-identifier hs-var">endPointType</span></span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span id="local-6989586621679490394"><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#isClosed"><span class="hs-identifier hs-type">isClosed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EndPoint_</span></span><span> </span><span class="annot"><a href="#local-6989586621679490394"><span class="hs-identifier hs-type">endPoint</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679490394"><span class="hs-identifier hs-type">endPoint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-209"></span><span id="isClosed"><span class="annot"><span class="annottext">isClosed :: forall endPoint. EndPoint_ endPoint =&gt; endPoint -&gt; Bool
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#isClosed"><span class="hs-identifier hs-var hs-var">isClosed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EndPointType -&gt; EndPointType -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">EndPointType
</span><span class="hs-identifier hs-var">Closed</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(EndPointType -&gt; Bool)
-&gt; (endPoint -&gt; EndPointType) -&gt; endPoint -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">endPoint -&gt; EndPointType
forall endPoint. EndPoint_ endPoint =&gt; endPoint -&gt; EndPointType
</span><span class="hs-identifier hs-var">endPointType</span></span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span class="annot"><span class="hs-comment">-- | Handle an event point</span></span><span>
</span><span id="line-212"></span><span id="local-6989586621679489450"><span id="local-6989586621679489451"><span id="local-6989586621679489452"><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#handle"><span class="hs-identifier hs-type">handle</span></a></span><span>                           </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LineSegment_</span></span><span> </span><span class="annot"><a href="#local-6989586621679489450"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489451"><span class="hs-identifier hs-type">point</span></a></span><span>
</span><span id="line-213"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Point_</span></span><span> </span><span class="annot"><a href="#local-6989586621679489451"><span class="hs-identifier hs-type">point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679489452"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-214"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679489452"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679489452"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-215"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.Types.html#IntersectConstraints"><span class="hs-identifier hs-type">IntersectConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489450"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-216"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasOnSegment</span></span><span> </span><span class="annot"><a href="#local-6989586621679489450"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span>
</span><span id="line-217"></span><span>                                    </span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>                                 </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489452"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489450"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-219"></span><span>                                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#EventQueue"><span class="hs-identifier hs-type">EventQueue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489452"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489450"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#StatusStructure"><span class="hs-identifier hs-type">StatusStructure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489452"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489450"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-220"></span><span>                                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.Types.html#IntersectionPoint"><span class="hs-identifier hs-type">IntersectionPoint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Point</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679489452"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679489450"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-221"></span><span id="handle"><span class="annot"><span class="annottext">handle :: forall lineSegment point r.
(LineSegment_ lineSegment point, Point_ point 2 r, Ord r,
 Fractional r, IntersectConstraints lineSegment,
 HasOnSegment lineSegment 2) =&gt;
Event r lineSegment
-&gt; EventQueue r lineSegment
-&gt; StatusStructure r lineSegment
-&gt; [IntersectionPoint (Point 2 r) lineSegment]
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#handle"><span class="hs-identifier hs-var hs-var">handle</span></a></span></span><span> </span><span id="local-6989586621679490639"><span class="annot"><span class="annottext">e :: Event r lineSegment
</span><a href="#local-6989586621679490639"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Event r lineSegment -&gt; Point 2 r
forall r lineSegment. Event r lineSegment -&gt; Point 2 r
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#eventPoint"><span class="hs-identifier hs-var">eventPoint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679490640"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679490640"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679490641"><span class="annot"><span class="annottext">EventQueue r lineSegment
</span><a href="#local-6989586621679490641"><span class="hs-identifier hs-var">eq</span></a></span></span><span> </span><span id="local-6989586621679490642"><span class="annot"><span class="annottext">StatusStructure r lineSegment
</span><a href="#local-6989586621679490642"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[IntersectionPoint (Point 2 r) lineSegment]
</span><a href="#local-6989586621679490643"><span class="hs-identifier hs-var">toReport</span></a></span><span> </span><span class="annot"><span class="annottext">[IntersectionPoint (Point 2 r) lineSegment]
-&gt; [IntersectionPoint (Point 2 r) lineSegment]
-&gt; [IntersectionPoint (Point 2 r) lineSegment]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">EventQueue r lineSegment
-&gt; StatusStructure r lineSegment
-&gt; [IntersectionPoint (Point 2 r) lineSegment]
forall lineSegment point r.
(LineSegment_ lineSegment point, Point_ point 2 r, Ord r,
 Fractional r, IntersectConstraints lineSegment,
 HasOnSegment lineSegment 2) =&gt;
EventQueue r lineSegment
-&gt; StatusStructure r lineSegment
-&gt; [IntersectionPoint (Point 2 r) lineSegment]
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#sweep"><span class="hs-identifier hs-var">sweep</span></a></span><span> </span><span class="annot"><span class="annottext">EventQueue r lineSegment
</span><a href="#local-6989586621679490644"><span class="hs-identifier hs-var">eq'</span></a></span><span> </span><span class="annot"><span class="annottext">StatusStructure r lineSegment
</span><a href="#local-6989586621679490645"><span class="hs-identifier hs-var">ss'</span></a></span><span>
</span><span id="line-222"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-223"></span><span>    </span><span id="local-6989586621679490646"><span class="annot"><span class="annottext">starts :: [lineSegment]
</span><a href="#local-6989586621679490646"><span class="hs-identifier hs-var hs-var">starts</span></a></span></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Event r lineSegment -&gt; [lineSegment]
forall r lineSegment. Event r lineSegment -&gt; [lineSegment]
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#startSegs"><span class="hs-identifier hs-var">startSegs</span></a></span><span> </span><span class="annot"><span class="annottext">Event r lineSegment
</span><a href="#local-6989586621679490639"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-224"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679490647"><span class="annot"><span class="annottext">StatusStructure r lineSegment
</span><a href="#local-6989586621679490647"><span class="hs-identifier hs-var">before</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679490648"><span class="annot"><span class="annottext">[lineSegment]
</span><a href="#local-6989586621679490648"><span class="hs-identifier hs-var">contains'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679490649"><span class="annot"><span class="annottext">StatusStructure r lineSegment
</span><a href="#local-6989586621679490649"><span class="hs-identifier hs-var">after</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point 2 r
-&gt; StatusStructure r lineSegment
-&gt; (StatusStructure r lineSegment, [lineSegment],
    StatusStructure r lineSegment)
forall lineSegment point r.
(LineSegment_ lineSegment point, HasOnSegment lineSegment 2,
 Point_ point 2 r, Ord r, Fractional r) =&gt;
Point 2 r
-&gt; StatusStructure r lineSegment
-&gt; (StatusStructure r lineSegment, [lineSegment],
    StatusStructure r lineSegment)
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#extractContains"><span class="hs-identifier hs-var">extractContains</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679490640"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">StatusStructure r lineSegment
</span><a href="#local-6989586621679490642"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-225"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679490651"><span class="annot"><span class="annottext">[lineSegment]
</span><a href="#local-6989586621679490651"><span class="hs-identifier hs-var">ends</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679490652"><span class="annot"><span class="annottext">[lineSegment]
</span><a href="#local-6989586621679490652"><span class="hs-identifier hs-var">contains</span></a></span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(lineSegment -&gt; Bool)
-&gt; [lineSegment] -&gt; ([lineSegment], [lineSegment])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">List.partition</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r -&gt; lineSegment -&gt; Bool
forall lineSegment point r.
(LineSegment_ lineSegment point, Point_ point 2 r, Eq r) =&gt;
Point 2 r -&gt; lineSegment -&gt; Bool
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#endsAt"><span class="hs-identifier hs-var">endsAt</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679490640"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[lineSegment]
</span><a href="#local-6989586621679490648"><span class="hs-identifier hs-var">contains'</span></a></span><span>
</span><span id="line-226"></span><span>    </span><span class="hs-comment">-- starting segments, exluding those that have an open starting point</span><span>
</span><span id="line-227"></span><span>    </span><span class="hs-comment">-- starts' = filter (isClosedStart p) starts</span><span>
</span><span id="line-228"></span><span>    </span><span id="local-6989586621679490655"><span class="annot"><span class="annottext">starts' :: [lineSegment]
</span><a href="#local-6989586621679490655"><span class="hs-identifier hs-var hs-var">starts'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; [lineSegment] -&gt; [lineSegment]
forall lineSegment point r a.
(LineSegment_ lineSegment point, Point_ point 2 r, Ord r, Num r,
 HasIntersectionWith lineSegment lineSegment) =&gt;
a -&gt; [lineSegment] -&gt; [lineSegment]
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#shouldReport"><span class="hs-identifier hs-var">shouldReport</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679490640"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">([lineSegment] -&gt; [lineSegment]) -&gt; [lineSegment] -&gt; [lineSegment]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure r lineSegment -&gt; [lineSegment]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">SS.toAscList</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure r lineSegment
</span><a href="#local-6989586621679490658"><span class="hs-identifier hs-var">newSegs</span></a></span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span>    </span><span class="hs-comment">-- If we just inserted open-ended segments that start here, then</span><span>
</span><span id="line-231"></span><span>    </span><span class="hs-comment">-- don't consider them to be &quot;contained&quot; segments.</span><span>
</span><span id="line-232"></span><span>    </span><span id="local-6989586621679490659"><span class="annot"><span class="annottext">pureContains :: [lineSegment]
</span><a href="#local-6989586621679490659"><span class="hs-identifier hs-var hs-var">pureContains</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-233"></span><span>      </span><span class="annot"><span class="annottext">(lineSegment -&gt; Bool) -&gt; [lineSegment] -&gt; [lineSegment]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679490660"><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679490660"><span class="hs-identifier hs-var">seg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">StartPointOf lineSegment -&gt; Bool
forall endPoint. EndPoint_ endPoint =&gt; endPoint -&gt; Bool
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#isOpen"><span class="hs-identifier hs-var">isOpen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679490660"><span class="hs-identifier hs-var">seg</span></a></span><span class="annot"><span class="annottext">lineSegment
-&gt; Getting
     (StartPointOf lineSegment) lineSegment (StartPointOf lineSegment)
-&gt; StartPointOf lineSegment
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">Getting
  (StartPointOf lineSegment) lineSegment (StartPointOf lineSegment)
forall seg p. HasStartPoint seg p =&gt; Lens' seg p
Lens' lineSegment (StartPointOf lineSegment)
</span><span class="hs-identifier hs-var">startPoint</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679490640"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679490660"><span class="hs-identifier hs-var">seg</span></a></span><span class="annot"><span class="annottext">lineSegment
-&gt; Getting (Point 2 r) lineSegment (Point 2 r) -&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">(point -&gt; Const (Point 2 r) point)
-&gt; lineSegment -&gt; Const (Point 2 r) lineSegment
forall seg p. HasStart seg p =&gt; Lens' seg p
Lens' lineSegment point
</span><span class="hs-identifier hs-var">start</span></span><span class="annot"><span class="annottext">((point -&gt; Const (Point 2 r) point)
 -&gt; lineSegment -&gt; Const (Point 2 r) lineSegment)
-&gt; ((Point 2 r -&gt; Const (Point 2 r) (Point 2 r))
    -&gt; point -&gt; Const (Point 2 r) point)
-&gt; Getting (Point 2 r) lineSegment (Point 2 r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Point 2 r -&gt; Const (Point 2 r) (Point 2 r))
-&gt; point -&gt; Const (Point 2 r) point
forall point (d :: Nat) r.
Point_ point d r =&gt;
Lens' point (Point d r)
Lens' point (Point 2 r)
</span><span class="hs-identifier hs-var">asPoint</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[lineSegment]
</span><a href="#local-6989586621679490652"><span class="hs-identifier hs-var">contains</span></a></span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span>    </span><span class="hs-comment">-- any (closed) ending segments at this event point.</span><span>
</span><span id="line-236"></span><span>    </span><span id="local-6989586621679490664"><span class="annot"><span class="annottext">closedEnds :: [lineSegment]
</span><a href="#local-6989586621679490664"><span class="hs-identifier hs-var hs-var">closedEnds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(lineSegment -&gt; Bool) -&gt; [lineSegment] -&gt; [lineSegment]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EndPointOf lineSegment -&gt; Bool
forall endPoint. EndPoint_ endPoint =&gt; endPoint -&gt; Bool
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#isClosed"><span class="hs-identifier hs-var">isClosed</span></a></span><span> </span><span class="annot"><span class="annottext">(EndPointOf lineSegment -&gt; Bool)
-&gt; (lineSegment -&gt; EndPointOf lineSegment) -&gt; lineSegment -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (EndPointOf lineSegment) lineSegment (EndPointOf lineSegment)
-&gt; lineSegment -&gt; EndPointOf lineSegment
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#view"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">Getting
  (EndPointOf lineSegment) lineSegment (EndPointOf lineSegment)
forall seg p. HasEndPoint seg p =&gt; Lens' seg p
Lens' lineSegment (EndPointOf lineSegment)
</span><span class="hs-identifier hs-var">endPoint</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[lineSegment]
</span><a href="#local-6989586621679490651"><span class="hs-identifier hs-var">ends</span></a></span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span>    </span><span id="local-6989586621679490643"><span class="annot"><span class="annottext">toReport :: [IntersectionPoint (Point 2 r) lineSegment]
</span><a href="#local-6989586621679490643"><span class="hs-identifier hs-var hs-var">toReport</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[lineSegment]
</span><a href="#local-6989586621679490655"><span class="hs-identifier hs-var">starts'</span></a></span><span> </span><span class="annot"><span class="annottext">[lineSegment] -&gt; [lineSegment] -&gt; [lineSegment]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[lineSegment]
</span><a href="#local-6989586621679490664"><span class="hs-identifier hs-var">closedEnds</span></a></span><span> </span><span class="annot"><span class="annottext">[lineSegment] -&gt; [lineSegment] -&gt; [lineSegment]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[lineSegment]
</span><a href="#local-6989586621679490659"><span class="hs-identifier hs-var">pureContains</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-239"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">lineSegment
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">lineSegment
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[lineSegment]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Point 2 r
-&gt; [lineSegment]
-&gt; [lineSegment]
-&gt; IntersectionPoint (Point 2 r) lineSegment
forall lineSegment endPoint r point.
(LineSegment_ lineSegment endPoint, Point_ endPoint 2 r,
 Point_ point 2 r, Eq r, OrdArounds lineSegment) =&gt;
point
-&gt; [lineSegment]
-&gt; [lineSegment]
-&gt; IntersectionPoint point lineSegment
</span><a href="HGeometry.LineSegment.Intersection.Types.html#mkIntersectionPoint"><span class="hs-identifier hs-var">mkIntersectionPoint</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679490640"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[lineSegment]
</span><a href="#local-6989586621679490655"><span class="hs-identifier hs-var">starts'</span></a></span><span> </span><span class="annot"><span class="annottext">[lineSegment] -&gt; [lineSegment] -&gt; [lineSegment]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[lineSegment]
</span><a href="#local-6989586621679490664"><span class="hs-identifier hs-var">closedEnds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[lineSegment]
</span><a href="#local-6989586621679490659"><span class="hs-identifier hs-var">pureContains</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-240"></span><span>                 </span><span class="annot"><span class="annottext">[lineSegment]
</span><span class="hs-identifier">_</span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span>    </span><span class="hs-comment">-- new status structure</span><span>
</span><span id="line-243"></span><span>    </span><span id="local-6989586621679490645"><span class="annot"><span class="annottext">ss' :: StatusStructure r lineSegment
</span><a href="#local-6989586621679490645"><span class="hs-identifier hs-var hs-var">ss'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StatusStructure r lineSegment
</span><a href="#local-6989586621679490647"><span class="hs-identifier hs-var">before</span></a></span><span> </span><span class="annot"><span class="annottext">StatusStructure r lineSegment
-&gt; StatusStructure r lineSegment -&gt; StatusStructure r lineSegment
forall a. Set a -&gt; Set a -&gt; Set a
</span><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Set.Util.html/HGeometry.Set.Util.html#join"><span class="hs-operator hs-var">`SS.join`</span></a></span><span> </span><span class="annot"><span class="annottext">StatusStructure r lineSegment
</span><a href="#local-6989586621679490658"><span class="hs-identifier hs-var">newSegs</span></a></span><span> </span><span class="annot"><span class="annottext">StatusStructure r lineSegment
-&gt; StatusStructure r lineSegment -&gt; StatusStructure r lineSegment
forall a. Set a -&gt; Set a -&gt; Set a
</span><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Set.Util.html/HGeometry.Set.Util.html#join"><span class="hs-operator hs-var">`SS.join`</span></a></span><span> </span><span class="annot"><span class="annottext">StatusStructure r lineSegment
</span><a href="#local-6989586621679490649"><span class="hs-identifier hs-var">after</span></a></span><span>
</span><span id="line-244"></span><span>    </span><span id="local-6989586621679490658"><span class="annot"><span class="annottext">newSegs :: StatusStructure r lineSegment
</span><a href="#local-6989586621679490658"><span class="hs-identifier hs-var hs-var">newSegs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; [lineSegment] -&gt; StatusStructure r lineSegment
forall lineSegment point r.
(LineSegment_ lineSegment point, Point_ point 2 r, Ord r,
 Fractional r) =&gt;
Point 2 r -&gt; [lineSegment] -&gt; StatusStructure r lineSegment
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#toStatusStruct"><span class="hs-identifier hs-var">toStatusStruct</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679490640"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">([lineSegment] -&gt; StatusStructure r lineSegment)
-&gt; [lineSegment] -&gt; StatusStructure r lineSegment
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[lineSegment]
</span><a href="#local-6989586621679490646"><span class="hs-identifier hs-var">starts</span></a></span><span> </span><span class="annot"><span class="annottext">[lineSegment] -&gt; [lineSegment] -&gt; [lineSegment]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[lineSegment]
</span><a href="#local-6989586621679490652"><span class="hs-identifier hs-var">contains</span></a></span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span>    </span><span class="hs-comment">-- the new eeventqueue</span><span>
</span><span id="line-247"></span><span>    </span><span id="local-6989586621679490644"><span class="annot"><span class="annottext">eq' :: EventQueue r lineSegment
</span><a href="#local-6989586621679490644"><span class="hs-identifier hs-var hs-var">eq'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Event r lineSegment
 -&gt; EventQueue r lineSegment -&gt; EventQueue r lineSegment)
-&gt; EventQueue r lineSegment
-&gt; [Event r lineSegment]
-&gt; EventQueue r lineSegment
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">Event r lineSegment
-&gt; EventQueue r lineSegment -&gt; EventQueue r lineSegment
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">EQ.insert</span></span><span> </span><span class="annot"><span class="annottext">EventQueue r lineSegment
</span><a href="#local-6989586621679490641"><span class="hs-identifier hs-var">eq</span></a></span><span> </span><span class="annot"><span class="annottext">[Event r lineSegment]
</span><a href="#local-6989586621679490672"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-248"></span><span>    </span><span class="hs-comment">-- the new events:</span><span>
</span><span id="line-249"></span><span>    </span><span id="local-6989586621679490672"><span class="annot"><span class="annottext">es :: [Event r lineSegment]
</span><a href="#local-6989586621679490672"><span class="hs-identifier hs-var hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">StatusStructure r lineSegment -&gt; Bool
forall a. Set a -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">F.null</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure r lineSegment
</span><a href="#local-6989586621679490658"><span class="hs-identifier hs-var">newSegs</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Event r lineSegment) -&gt; [Event r lineSegment]
forall a. Maybe a -&gt; [a]
</span><span class="hs-identifier hs-var">maybeToList</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Event r lineSegment) -&gt; [Event r lineSegment])
-&gt; Maybe (Event r lineSegment) -&gt; [Event r lineSegment]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(lineSegment -&gt; lineSegment -&gt; Maybe (Event r lineSegment))
-&gt; Maybe lineSegment
-&gt; Maybe lineSegment
-&gt; Maybe (Event r lineSegment)
forall {m :: * -&gt; *} {t} {t} {b}.
Monad m =&gt;
(t -&gt; t -&gt; m b) -&gt; m t -&gt; m t -&gt; m b
</span><a href="#local-6989586621679490675"><span class="hs-identifier hs-var">app</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
-&gt; lineSegment -&gt; lineSegment -&gt; Maybe (Event r lineSegment)
forall lineSegment point r.
(LineSegment_ lineSegment point, Point_ point 2 r, Ord r,
 Fractional r, IsIntersectableWith lineSegment lineSegment,
 Intersection lineSegment lineSegment
 ~ Maybe (LineSegmentLineSegmentIntersection lineSegment)) =&gt;
Point 2 r
-&gt; lineSegment -&gt; lineSegment -&gt; Maybe (Event r lineSegment)
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#findNewEvent"><span class="hs-identifier hs-var">findNewEvent</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679490640"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe lineSegment
</span><a href="#local-6989586621679490677"><span class="hs-identifier hs-var">sl</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe lineSegment
</span><a href="#local-6989586621679490678"><span class="hs-identifier hs-var">sr</span></a></span><span>
</span><span id="line-250"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679490679"><span class="annot"><span class="annottext">s' :: Maybe lineSegment
</span><a href="#local-6989586621679490679"><span class="hs-identifier hs-var hs-var">s'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StatusStructure r lineSegment -&gt; Maybe lineSegment
forall a. Set a -&gt; Maybe a
</span><span class="hs-identifier hs-var">SS.lookupMin</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure r lineSegment
</span><a href="#local-6989586621679490658"><span class="hs-identifier hs-var">newSegs</span></a></span><span>
</span><span id="line-251"></span><span>                               </span><span id="local-6989586621679490681"><span class="annot"><span class="annottext">s'' :: Maybe lineSegment
</span><a href="#local-6989586621679490681"><span class="hs-identifier hs-var hs-var">s''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StatusStructure r lineSegment -&gt; Maybe lineSegment
forall a. Set a -&gt; Maybe a
</span><span class="hs-identifier hs-var">SS.lookupMax</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure r lineSegment
</span><a href="#local-6989586621679490658"><span class="hs-identifier hs-var">newSegs</span></a></span><span>
</span><span id="line-252"></span><span>                           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[Maybe (Event r lineSegment)] -&gt; [Event r lineSegment]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(lineSegment -&gt; lineSegment -&gt; Maybe (Event r lineSegment))
-&gt; Maybe lineSegment
-&gt; Maybe lineSegment
-&gt; Maybe (Event r lineSegment)
forall {m :: * -&gt; *} {t} {t} {b}.
Monad m =&gt;
(t -&gt; t -&gt; m b) -&gt; m t -&gt; m t -&gt; m b
</span><a href="#local-6989586621679490675"><span class="hs-identifier hs-var">app</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
-&gt; lineSegment -&gt; lineSegment -&gt; Maybe (Event r lineSegment)
forall lineSegment point r.
(LineSegment_ lineSegment point, Point_ point 2 r, Ord r,
 Fractional r, IsIntersectableWith lineSegment lineSegment,
 Intersection lineSegment lineSegment
 ~ Maybe (LineSegmentLineSegmentIntersection lineSegment)) =&gt;
Point 2 r
-&gt; lineSegment -&gt; lineSegment -&gt; Maybe (Event r lineSegment)
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#findNewEvent"><span class="hs-identifier hs-var">findNewEvent</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679490640"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe lineSegment
</span><a href="#local-6989586621679490677"><span class="hs-identifier hs-var">sl</span></a></span><span>  </span><span class="annot"><span class="annottext">Maybe lineSegment
</span><a href="#local-6989586621679490679"><span class="hs-identifier hs-var">s'</span></a></span><span>
</span><span id="line-253"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(lineSegment -&gt; lineSegment -&gt; Maybe (Event r lineSegment))
-&gt; Maybe lineSegment
-&gt; Maybe lineSegment
-&gt; Maybe (Event r lineSegment)
forall {m :: * -&gt; *} {t} {t} {b}.
Monad m =&gt;
(t -&gt; t -&gt; m b) -&gt; m t -&gt; m t -&gt; m b
</span><a href="#local-6989586621679490675"><span class="hs-identifier hs-var">app</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
-&gt; lineSegment -&gt; lineSegment -&gt; Maybe (Event r lineSegment)
forall lineSegment point r.
(LineSegment_ lineSegment point, Point_ point 2 r, Ord r,
 Fractional r, IsIntersectableWith lineSegment lineSegment,
 Intersection lineSegment lineSegment
 ~ Maybe (LineSegmentLineSegmentIntersection lineSegment)) =&gt;
Point 2 r
-&gt; lineSegment -&gt; lineSegment -&gt; Maybe (Event r lineSegment)
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#findNewEvent"><span class="hs-identifier hs-var">findNewEvent</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679490640"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe lineSegment
</span><a href="#local-6989586621679490681"><span class="hs-identifier hs-var">s''</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe lineSegment
</span><a href="#local-6989586621679490678"><span class="hs-identifier hs-var">sr</span></a></span><span>
</span><span id="line-254"></span><span>                                        </span><span class="hs-special">]</span><span>
</span><span id="line-255"></span><span>    </span><span id="local-6989586621679490677"><span class="annot"><span class="annottext">sl :: Maybe lineSegment
</span><a href="#local-6989586621679490677"><span class="hs-identifier hs-var hs-var">sl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StatusStructure r lineSegment -&gt; Maybe lineSegment
forall a. Set a -&gt; Maybe a
</span><span class="hs-identifier hs-var">SS.lookupMax</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure r lineSegment
</span><a href="#local-6989586621679490647"><span class="hs-identifier hs-var">before</span></a></span><span>
</span><span id="line-256"></span><span>    </span><span id="local-6989586621679490678"><span class="annot"><span class="annottext">sr :: Maybe lineSegment
</span><a href="#local-6989586621679490678"><span class="hs-identifier hs-var hs-var">sr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StatusStructure r lineSegment -&gt; Maybe lineSegment
forall a. Set a -&gt; Maybe a
</span><span class="hs-identifier hs-var">SS.lookupMin</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure r lineSegment
</span><a href="#local-6989586621679490649"><span class="hs-identifier hs-var">after</span></a></span><span>
</span><span id="line-257"></span><span>
</span><span id="line-258"></span><span>    </span><span id="local-6989586621679490675"><span class="annot"><span class="annottext">app :: (t -&gt; t -&gt; m b) -&gt; m t -&gt; m t -&gt; m b
</span><a href="#local-6989586621679490675"><span class="hs-identifier hs-var hs-var">app</span></a></span></span><span> </span><span id="local-6989586621679490693"><span class="annot"><span class="annottext">t -&gt; t -&gt; m b
</span><a href="#local-6989586621679490693"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679490694"><span class="annot"><span class="annottext">m t
</span><a href="#local-6989586621679490694"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679490695"><span class="annot"><span class="annottext">m t
</span><a href="#local-6989586621679490695"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621679490696"><span class="annot"><a href="#local-6989586621679490696"><span class="hs-identifier hs-var">x'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m t
</span><a href="#local-6989586621679490694"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">;</span><span> </span><span id="local-6989586621679490697"><span class="annot"><a href="#local-6989586621679490697"><span class="hs-identifier hs-var">y'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621679490695"><span class="hs-identifier hs-type">y</span></a></span><span> </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="#local-6989586621679490693"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679490696"><span class="hs-identifier hs-type">x'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679490697"><span class="hs-identifier hs-type">y'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span class="hs-comment">-- | Given the starting point p, and the segments that either start in</span><span>
</span><span id="line-261"></span><span class="hs-comment">-- p, or continue in p, in left to right order along a line just</span><span>
</span><span id="line-262"></span><span class="hs-comment">-- epsilon below p, figure out which segments we should report as</span><span>
</span><span id="line-263"></span><span class="hs-comment">-- intersecting at p.</span><span>
</span><span id="line-264"></span><span class="hs-comment">--</span><span>
</span><span id="line-265"></span><span class="hs-comment">-- in partcular; those that:</span><span>
</span><span id="line-266"></span><span class="hs-comment">-- - have a closed endpoint at p</span><span>
</span><span id="line-267"></span><span class="hs-comment">-- - those that have an open endpoint at p and have an intersection</span><span>
</span><span id="line-268"></span><span class="hs-comment">--   with a segment eps below p. Those segments thus overlap wtih</span><span>
</span><span id="line-269"></span><span class="hs-comment">--   their predecessor or successor in the cyclic order.</span><span>
</span><span id="line-270"></span><span id="local-6989586621679489477"><span id="local-6989586621679489478"><span id="local-6989586621679489479"><span id="local-6989586621679489480"><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#shouldReport"><span class="hs-identifier hs-type">shouldReport</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LineSegment_</span></span><span> </span><span class="annot"><a href="#local-6989586621679489477"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489478"><span class="hs-identifier hs-type">point</span></a></span><span>
</span><span id="line-271"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Point_</span></span><span> </span><span class="annot"><a href="#local-6989586621679489478"><span class="hs-identifier hs-type">point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679489479"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-272"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679489479"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679489479"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-273"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasIntersectionWith</span></span><span> </span><span class="annot"><a href="#local-6989586621679489477"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489477"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-274"></span><span>                  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679489480"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679489477"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679489477"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">]</span></span></span></span></span><span>
</span><span id="line-275"></span><span id="shouldReport"><span class="annot"><span class="annottext">shouldReport :: forall lineSegment point r a.
(LineSegment_ lineSegment point, Point_ point 2 r, Ord r, Num r,
 HasIntersectionWith lineSegment lineSegment) =&gt;
a -&gt; [lineSegment] -&gt; [lineSegment]
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#shouldReport"><span class="hs-identifier hs-var hs-var">shouldReport</span></a></span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(lineSegment -&gt; Bool)
-&gt; (lineSegment -&gt; lineSegment -&gt; Bool)
-&gt; [lineSegment]
-&gt; [lineSegment]
forall a. (a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#overlapsOr"><span class="hs-identifier hs-var">overlapsOr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StartPointOf lineSegment -&gt; Bool
forall endPoint. EndPoint_ endPoint =&gt; endPoint -&gt; Bool
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#isClosed"><span class="hs-identifier hs-var">isClosed</span></a></span><span> </span><span class="annot"><span class="annottext">(StartPointOf lineSegment -&gt; Bool)
-&gt; (lineSegment -&gt; StartPointOf lineSegment) -&gt; lineSegment -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (StartPointOf lineSegment) lineSegment (StartPointOf lineSegment)
-&gt; lineSegment -&gt; StartPointOf lineSegment
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#view"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">Getting
  (StartPointOf lineSegment) lineSegment (StartPointOf lineSegment)
forall seg p. HasStartPoint seg p =&gt; Lens' seg p
Lens' lineSegment (StartPointOf lineSegment)
</span><span class="hs-identifier hs-var">startPoint</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">lineSegment -&gt; lineSegment -&gt; Bool
forall g h. HasIntersectionWith g h =&gt; g -&gt; h -&gt; Bool
</span><span class="hs-identifier hs-var">intersects</span></span><span>
</span><span id="line-276"></span><span>
</span><span id="line-277"></span><span class="hs-comment">-- | split the status structure, extracting the segments that contain p.</span><span>
</span><span id="line-278"></span><span class="hs-comment">-- the result is (before,contains,after)</span><span>
</span><span id="line-279"></span><span id="local-6989586621679489471"><span id="local-6989586621679489472"><span id="local-6989586621679489473"><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#extractContains"><span class="hs-identifier hs-type">extractContains</span></a></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LineSegment_</span></span><span> </span><span class="annot"><a href="#local-6989586621679489471"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489472"><span class="hs-identifier hs-type">point</span></a></span><span>
</span><span id="line-280"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasOnSegment</span></span><span> </span><span class="annot"><a href="#local-6989586621679489471"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span>
</span><span id="line-281"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Point_</span></span><span> </span><span class="annot"><a href="#local-6989586621679489472"><span class="hs-identifier hs-type">point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679489473"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-282"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679489473"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679489473"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-283"></span><span>                        </span><span class="hs-special">)</span><span>
</span><span id="line-284"></span><span>                     </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Point</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679489473"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#StatusStructure"><span class="hs-identifier hs-type">StatusStructure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489473"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489471"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-285"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#StatusStructure"><span class="hs-identifier hs-type">StatusStructure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489473"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489471"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679489471"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#StatusStructure"><span class="hs-identifier hs-type">StatusStructure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489473"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489471"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-286"></span><span id="extractContains"><span class="annot"><span class="annottext">extractContains :: forall lineSegment point r.
(LineSegment_ lineSegment point, HasOnSegment lineSegment 2,
 Point_ point 2 r, Ord r, Fractional r) =&gt;
Point 2 r
-&gt; StatusStructure r lineSegment
-&gt; (StatusStructure r lineSegment, [lineSegment],
    StatusStructure r lineSegment)
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#extractContains"><span class="hs-identifier hs-var hs-var">extractContains</span></a></span></span><span> </span><span id="local-6989586621679490873"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679490873"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679490874"><span class="annot"><span class="annottext">StatusStructure r lineSegment
</span><a href="#local-6989586621679490874"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StatusStructure r lineSegment
</span><a href="#local-6989586621679490875"><span class="hs-identifier hs-var">before</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StatusStructure r lineSegment -&gt; [lineSegment]
forall a. Set a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">F.toList</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure r lineSegment
</span><a href="#local-6989586621679490877"><span class="hs-identifier hs-var">mid1</span></a></span><span> </span><span class="annot"><span class="annottext">[lineSegment] -&gt; [lineSegment] -&gt; [lineSegment]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure r lineSegment -&gt; [lineSegment]
forall a. Set a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">F.toList</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure r lineSegment
</span><a href="#local-6989586621679490878"><span class="hs-identifier hs-var">mid2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StatusStructure r lineSegment
</span><a href="#local-6989586621679490879"><span class="hs-identifier hs-var">after</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-288"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679490875"><span class="annot"><span class="annottext">StatusStructure r lineSegment
</span><a href="#local-6989586621679490875"><span class="hs-identifier hs-var">before</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679490877"><span class="annot"><span class="annottext">StatusStructure r lineSegment
</span><a href="#local-6989586621679490877"><span class="hs-identifier hs-var">mid1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679490880"><span class="annot"><span class="annottext">StatusStructure r lineSegment
</span><a href="#local-6989586621679490880"><span class="hs-identifier hs-var">after'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(lineSegment -&gt; r)
-&gt; r
-&gt; StatusStructure r lineSegment
-&gt; (StatusStructure r lineSegment, StatusStructure r lineSegment,
    StatusStructure r lineSegment)
forall b a.
Ord b =&gt;
(a -&gt; b) -&gt; b -&gt; Set a -&gt; (Set a, Set a, Set a)
</span><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Set.Util.html/HGeometry.Set.Util.html#splitOn"><span class="hs-identifier hs-var">SS.splitOn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r -&gt; lineSegment -&gt; r
forall r lineSegment point.
(Fractional r, Ord r, LineSegment_ lineSegment point,
 Point_ point 2 r) =&gt;
r -&gt; lineSegment -&gt; r
</span><span class="hs-identifier hs-var">xCoordAt</span></span><span> </span><span class="annot"><span class="annottext">(r -&gt; lineSegment -&gt; r) -&gt; r -&gt; lineSegment -&gt; r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679490873"><span class="hs-identifier hs-var">p</span></a></span><span class="annot"><span class="annottext">Point 2 r -&gt; Getting r (Point 2 r) r -&gt; r
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">Getting r (Point 2 r) r
forall (d :: Nat) point r.
(2 &lt;= d, Point_ point d r) =&gt;
IndexedLens' Int point r
IndexedLens' Int (Point 2 r) r
</span><span class="hs-identifier hs-var">yCoord</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679490873"><span class="hs-identifier hs-var">p</span></a></span><span class="annot"><span class="annottext">Point 2 r -&gt; Getting r (Point 2 r) r -&gt; r
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">Getting r (Point 2 r) r
forall (d :: Nat) point r.
(1 &lt;= d, Point_ point d r) =&gt;
IndexedLens' Int point r
IndexedLens' Int (Point 2 r) r
</span><span class="hs-identifier hs-var">xCoord</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StatusStructure r lineSegment
</span><a href="#local-6989586621679490874"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-289"></span><span>    </span><span class="hs-comment">-- Make sure to also select the horizontal segments containing p</span><span>
</span><span id="line-290"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679490878"><span class="annot"><span class="annottext">StatusStructure r lineSegment
</span><a href="#local-6989586621679490878"><span class="hs-identifier hs-var">mid2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679490879"><span class="annot"><span class="annottext">StatusStructure r lineSegment
</span><a href="#local-6989586621679490879"><span class="hs-identifier hs-var">after</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(lineSegment -&gt; Bool)
-&gt; StatusStructure r lineSegment
-&gt; (StatusStructure r lineSegment, StatusStructure r lineSegment)
forall a. (a -&gt; Bool) -&gt; Set a -&gt; (Set a, Set a)
</span><span class="hs-identifier hs-var">SS.spanAntitone</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r -&gt; lineSegment -&gt; Bool
forall lineSegment (d :: Nat) r point.
(HasOnSegment lineSegment d, Ord r, Point_ point d r,
 r ~ NumType lineSegment, d ~ Dimension lineSegment) =&gt;
point -&gt; lineSegment -&gt; Bool
forall r point.
(Ord r, Point_ point 2 r, r ~ NumType lineSegment,
 2 ~ Dimension lineSegment) =&gt;
point -&gt; lineSegment -&gt; Bool
</span><span class="hs-identifier hs-var">onSegment</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679490873"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StatusStructure r lineSegment
</span><a href="#local-6989586621679490880"><span class="hs-identifier hs-var">after'</span></a></span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span class="hs-comment">-- | Given a point and the linesegements that contain it. Create a piece of</span><span>
</span><span id="line-293"></span><span class="hs-comment">-- status structure for it.</span><span>
</span><span id="line-294"></span><span id="local-6989586621679489495"><span id="local-6989586621679489496"><span id="local-6989586621679489497"><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#toStatusStruct"><span class="hs-identifier hs-type">toStatusStruct</span></a></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LineSegment_</span></span><span> </span><span class="annot"><a href="#local-6989586621679489495"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489496"><span class="hs-identifier hs-type">point</span></a></span><span>
</span><span id="line-295"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Point_</span></span><span> </span><span class="annot"><a href="#local-6989586621679489496"><span class="hs-identifier hs-type">point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679489497"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-296"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679489497"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679489497"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-297"></span><span>                       </span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>                    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Point</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679489497"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679489495"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#StatusStructure"><span class="hs-identifier hs-type">StatusStructure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489497"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489495"><span class="hs-identifier hs-type">lineSegment</span></a></span></span></span></span><span>
</span><span id="line-299"></span><span id="toStatusStruct"><span class="annot"><span class="annottext">toStatusStruct :: forall lineSegment point r.
(LineSegment_ lineSegment point, Point_ point 2 r, Ord r,
 Fractional r) =&gt;
Point 2 r -&gt; [lineSegment] -&gt; StatusStructure r lineSegment
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#toStatusStruct"><span class="hs-identifier hs-var hs-var">toStatusStruct</span></a></span></span><span> </span><span id="local-6989586621679491170"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679491170"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679491171"><span class="annot"><span class="annottext">[lineSegment]
</span><a href="#local-6989586621679491171"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set lineSegment
</span><a href="#local-6989586621679491172"><span class="hs-identifier hs-var">ss</span></a></span><span> </span><span class="annot"><span class="annottext">Set lineSegment -&gt; Set lineSegment -&gt; Set lineSegment
forall a. Set a -&gt; Set a -&gt; Set a
</span><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Set.Util.html/HGeometry.Set.Util.html#join"><span class="hs-operator hs-var">`SS.join`</span></a></span><span> </span><span class="annot"><span class="annottext">Set lineSegment
</span><a href="#local-6989586621679491173"><span class="hs-identifier hs-var">hors</span></a></span><span>
</span><span id="line-300"></span><span>  </span><span class="hs-comment">-- ss { SS.nav = ordAtNav $ p^.yCoord } `SS.join` hors</span><span>
</span><span id="line-301"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-302"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679491174"><span class="annot"><span class="annottext">[lineSegment]
</span><a href="#local-6989586621679491174"><span class="hs-identifier hs-var">hors'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679491175"><span class="annot"><span class="annottext">[lineSegment]
</span><a href="#local-6989586621679491175"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(lineSegment -&gt; Bool)
-&gt; [lineSegment] -&gt; ([lineSegment], [lineSegment])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">List.partition</span></span><span> </span><span class="annot"><span class="annottext">lineSegment -&gt; Bool
forall {p} {p} {s}.
(NumType p ~ NumType p,
 Assert
   (OrdCond (CmpNat 2 (Dimension p)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat 2 (Dimension p)) 'True 'True 'False)
   (TypeError ...),
 Eq (NumType p), HasStart s p, HasEnd s p,
 Point_ p (Dimension p) (NumType p),
 Point_ p (Dimension p) (NumType p)) =&gt;
s -&gt; Bool
</span><a href="#local-6989586621679491176"><span class="hs-identifier hs-var">isHorizontal</span></a></span><span> </span><span class="annot"><span class="annottext">[lineSegment]
</span><a href="#local-6989586621679491171"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-303"></span><span>    </span><span id="local-6989586621679491172"><span class="annot"><span class="annottext">ss :: Set lineSegment
</span><a href="#local-6989586621679491172"><span class="hs-identifier hs-var hs-var">ss</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(lineSegment -&gt; lineSegment -&gt; Ordering)
-&gt; [lineSegment] -&gt; Set lineSegment
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; Set a
</span><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Set.Util.html/HGeometry.Set.Util.html#fromListBy"><span class="hs-identifier hs-var">SS.fromListBy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r -&gt; lineSegment -&gt; lineSegment -&gt; Ordering
forall r lineSegment point.
(Num r, Ord r, LineSegment_ lineSegment point, Point_ point 2 r) =&gt;
r -&gt; lineSegment -&gt; lineSegment -&gt; Ordering
</span><span class="hs-identifier hs-var">ordAtY</span></span><span> </span><span class="annot"><span class="annottext">(r -&gt; lineSegment -&gt; lineSegment -&gt; Ordering)
-&gt; r -&gt; lineSegment -&gt; lineSegment -&gt; Ordering
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[lineSegment] -&gt; r
</span><a href="#local-6989586621679491179"><span class="hs-identifier hs-var">maxY</span></a></span><span> </span><span class="annot"><span class="annottext">[lineSegment]
</span><a href="#local-6989586621679491171"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[lineSegment]
</span><a href="#local-6989586621679491175"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-304"></span><span>    </span><span id="local-6989586621679491173"><span class="annot"><span class="annottext">hors :: Set lineSegment
</span><a href="#local-6989586621679491173"><span class="hs-identifier hs-var hs-var">hors</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(lineSegment -&gt; lineSegment -&gt; Ordering)
-&gt; [lineSegment] -&gt; Set lineSegment
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; Set a
</span><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Set.Util.html/HGeometry.Set.Util.html#fromListBy"><span class="hs-identifier hs-var">SS.fromListBy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(lineSegment -&gt; r) -&gt; lineSegment -&gt; lineSegment -&gt; Ordering
forall a b. Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering
</span><span class="hs-identifier hs-var">comparing</span></span><span> </span><span class="annot"><span class="annottext">lineSegment -&gt; r
forall lineSegment point r.
(LineSegment_ lineSegment point, Point_ point 2 r, Ord r) =&gt;
lineSegment -&gt; r
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#rightEndpoint"><span class="hs-identifier hs-var">rightEndpoint</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[lineSegment]
</span><a href="#local-6989586621679491174"><span class="hs-identifier hs-var">hors'</span></a></span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span>    </span><span id="local-6989586621679491176"><span class="annot"><span class="annottext">isHorizontal :: s -&gt; Bool
</span><a href="#local-6989586621679491176"><span class="hs-identifier hs-var hs-var">isHorizontal</span></a></span></span><span> </span><span id="local-6989586621679491323"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679491323"><span class="hs-identifier hs-var">s</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679491323"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">s -&gt; Getting (NumType p) s (NumType p) -&gt; NumType p
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">(p -&gt; Const (NumType p) p) -&gt; s -&gt; Const (NumType p) s
forall seg p. HasStart seg p =&gt; Lens' seg p
Lens' s p
</span><span class="hs-identifier hs-var">start</span></span><span class="annot"><span class="annottext">((p -&gt; Const (NumType p) p) -&gt; s -&gt; Const (NumType p) s)
-&gt; ((NumType p -&gt; Const (NumType p) (NumType p))
    -&gt; p -&gt; Const (NumType p) p)
-&gt; Getting (NumType p) s (NumType p)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(NumType p -&gt; Const (NumType p) (NumType p))
-&gt; p -&gt; Const (NumType p) p
forall (d :: Nat) point r.
(2 &lt;= d, Point_ point d r) =&gt;
IndexedLens' Int point r
IndexedLens' Int p (NumType p)
</span><span class="hs-identifier hs-var">yCoord</span></span><span> </span><span class="annot"><span class="annottext">NumType p -&gt; NumType p -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679491323"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">s -&gt; Getting (NumType p) s (NumType p) -&gt; NumType p
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">(p -&gt; Const (NumType p) p) -&gt; s -&gt; Const (NumType p) s
forall seg p. HasEnd seg p =&gt; Lens' seg p
Lens' s p
</span><span class="hs-identifier hs-var">end</span></span><span class="annot"><span class="annottext">((p -&gt; Const (NumType p) p) -&gt; s -&gt; Const (NumType p) s)
-&gt; ((NumType p -&gt; Const (NumType p) (NumType p))
    -&gt; p -&gt; Const (NumType p) p)
-&gt; Getting (NumType p) s (NumType p)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(NumType p -&gt; Const (NumType p) (NumType p))
-&gt; p -&gt; Const (NumType p) p
forall (d :: Nat) point r.
(2 &lt;= d, Point_ point d r) =&gt;
IndexedLens' Int point r
IndexedLens' Int p (NumType p)
</span><span class="hs-identifier hs-var">yCoord</span></span><span>
</span><span id="line-307"></span><span>
</span><span id="line-308"></span><span>    </span><span class="hs-comment">-- ordAtY' q sa sb = ordAtY q sa sb</span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span>    </span><span class="hs-comment">-- find the y coord of the first interesting thing below the sweep at y</span><span>
</span><span id="line-311"></span><span>    </span><span id="local-6989586621679491179"><span class="annot"><span class="annottext">maxY :: [lineSegment] -&gt; r
</span><a href="#local-6989586621679491179"><span class="hs-identifier hs-var hs-var">maxY</span></a></span></span><span> </span><span id="local-6989586621679491324"><span class="annot"><span class="annottext">[lineSegment]
</span><a href="#local-6989586621679491324"><span class="hs-identifier hs-var">segs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[r] -&gt; r
forall a. Ord a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Ord a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">maximum</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679491326"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-312"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679491327"><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679491327"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[lineSegment]
</span><a href="#local-6989586621679491324"><span class="hs-identifier hs-var">segs</span></a></span><span>
</span><span id="line-313"></span><span>                        </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679491326"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679491326"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679491327"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">lineSegment -&gt; Getting r lineSegment r -&gt; r
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">(point -&gt; Const r point) -&gt; lineSegment -&gt; Const r lineSegment
forall seg p. HasStart seg p =&gt; Lens' seg p
Lens' lineSegment point
</span><span class="hs-identifier hs-var">start</span></span><span class="annot"><span class="annottext">((point -&gt; Const r point) -&gt; lineSegment -&gt; Const r lineSegment)
-&gt; ((r -&gt; Const r r) -&gt; point -&gt; Const r point)
-&gt; Getting r lineSegment r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(r -&gt; Const r r) -&gt; point -&gt; Const r point
forall (d :: Nat) point r.
(2 &lt;= d, Point_ point d r) =&gt;
IndexedLens' Int point r
IndexedLens' Int point r
</span><span class="hs-identifier hs-var">yCoord</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679491327"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">lineSegment -&gt; Getting r lineSegment r -&gt; r
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">(point -&gt; Const r point) -&gt; lineSegment -&gt; Const r lineSegment
forall seg p. HasEnd seg p =&gt; Lens' seg p
Lens' lineSegment point
</span><span class="hs-identifier hs-var">end</span></span><span class="annot"><span class="annottext">((point -&gt; Const r point) -&gt; lineSegment -&gt; Const r lineSegment)
-&gt; ((r -&gt; Const r r) -&gt; point -&gt; Const r point)
-&gt; Getting r lineSegment r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(r -&gt; Const r r) -&gt; point -&gt; Const r point
forall (d :: Nat) point r.
(2 &lt;= d, Point_ point d r) =&gt;
IndexedLens' Int point r
IndexedLens' Int point r
</span><span class="hs-identifier hs-var">yCoord</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679491326"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">r -&gt; r -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679491170"><span class="hs-identifier hs-var">p</span></a></span><span class="annot"><span class="annottext">Point 2 r -&gt; Getting r (Point 2 r) r -&gt; r
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">Getting r (Point 2 r) r
forall (d :: Nat) point r.
(2 &lt;= d, Point_ point d r) =&gt;
IndexedLens' Int point r
IndexedLens' Int (Point 2 r) r
</span><span class="hs-identifier hs-var">yCoord</span></span><span>
</span><span id="line-314"></span><span>                        </span><span class="hs-special">]</span><span>
</span><span id="line-315"></span><span>    </span><span class="hs-comment">-- fixme, why can't segs be empty</span><span>
</span><span id="line-316"></span><span>
</span><span id="line-317"></span><span class="annot"><span class="hs-comment">-- | Get the right endpoint of a segment</span></span><span>
</span><span id="line-318"></span><span id="local-6989586621679489559"><span id="local-6989586621679489560"><span id="local-6989586621679489561"><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#rightEndpoint"><span class="hs-identifier hs-type">rightEndpoint</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LineSegment_</span></span><span> </span><span class="annot"><a href="#local-6989586621679489559"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489560"><span class="hs-identifier hs-type">point</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Point_</span></span><span> </span><span class="annot"><a href="#local-6989586621679489560"><span class="hs-identifier hs-type">point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679489561"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679489561"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679489559"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679489561"><span class="hs-identifier hs-type">r</span></a></span></span></span></span><span>
</span><span id="line-319"></span><span id="rightEndpoint"><span class="annot"><span class="annottext">rightEndpoint :: forall lineSegment point r.
(LineSegment_ lineSegment point, Point_ point 2 r, Ord r) =&gt;
lineSegment -&gt; r
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#rightEndpoint"><span class="hs-identifier hs-var hs-var">rightEndpoint</span></a></span></span><span> </span><span id="local-6989586621679491462"><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679491462"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679491462"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">lineSegment -&gt; Getting r lineSegment r -&gt; r
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">(point -&gt; Const r point) -&gt; lineSegment -&gt; Const r lineSegment
forall seg p. HasStart seg p =&gt; Lens' seg p
Lens' lineSegment point
</span><span class="hs-identifier hs-var">start</span></span><span class="annot"><span class="annottext">((point -&gt; Const r point) -&gt; lineSegment -&gt; Const r lineSegment)
-&gt; ((r -&gt; Const r r) -&gt; point -&gt; Const r point)
-&gt; Getting r lineSegment r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(r -&gt; Const r r) -&gt; point -&gt; Const r point
forall (d :: Nat) point r.
(1 &lt;= d, Point_ point d r) =&gt;
IndexedLens' Int point r
IndexedLens' Int point r
</span><span class="hs-identifier hs-var">xCoord</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">r -&gt; r -&gt; r
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`max`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679491462"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">lineSegment -&gt; Getting r lineSegment r -&gt; r
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">(point -&gt; Const r point) -&gt; lineSegment -&gt; Const r lineSegment
forall seg p. HasEnd seg p =&gt; Lens' seg p
Lens' lineSegment point
</span><span class="hs-identifier hs-var">end</span></span><span class="annot"><span class="annottext">((point -&gt; Const r point) -&gt; lineSegment -&gt; Const r lineSegment)
-&gt; ((r -&gt; Const r r) -&gt; point -&gt; Const r point)
-&gt; Getting r lineSegment r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(r -&gt; Const r r) -&gt; point -&gt; Const r point
forall (d :: Nat) point r.
(1 &lt;= d, Point_ point d r) =&gt;
IndexedLens' Int point r
IndexedLens' Int point r
</span><span class="hs-identifier hs-var">xCoord</span></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span class="annot"><span class="hs-comment">-- | Test if a segment ends at p</span></span><span>
</span><span id="line-322"></span><span id="local-6989586621679489474"><span id="local-6989586621679489475"><span id="local-6989586621679489476"><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#endsAt"><span class="hs-identifier hs-type">endsAt</span></a></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LineSegment_</span></span><span> </span><span class="annot"><a href="#local-6989586621679489474"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489475"><span class="hs-identifier hs-type">point</span></a></span><span>
</span><span id="line-323"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Point_</span></span><span> </span><span class="annot"><a href="#local-6989586621679489475"><span class="hs-identifier hs-type">point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679489476"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-324"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679489476"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-325"></span><span>                </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Point</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679489476"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679489474"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span></span><span>
</span><span id="line-326"></span><span id="endsAt"><span class="annot"><span class="annottext">endsAt :: forall lineSegment point r.
(LineSegment_ lineSegment point, Point_ point 2 r, Eq r) =&gt;
Point 2 r -&gt; lineSegment -&gt; Bool
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#endsAt"><span class="hs-identifier hs-var hs-var">endsAt</span></a></span></span><span> </span><span id="local-6989586621679491475"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679491475"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679491476"><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679491476"><span class="hs-identifier hs-var">seg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679491476"><span class="hs-identifier hs-var">seg</span></a></span><span class="annot"><span class="annottext">lineSegment
-&gt; Getting (Point 2 r) lineSegment (Point 2 r) -&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">(point -&gt; Const (Point 2 r) point)
-&gt; lineSegment -&gt; Const (Point 2 r) lineSegment
forall seg p. HasEnd seg p =&gt; Lens' seg p
Lens' lineSegment point
</span><span class="hs-identifier hs-var">end</span></span><span class="annot"><span class="annottext">((point -&gt; Const (Point 2 r) point)
 -&gt; lineSegment -&gt; Const (Point 2 r) lineSegment)
-&gt; ((Point 2 r -&gt; Const (Point 2 r) (Point 2 r))
    -&gt; point -&gt; Const (Point 2 r) point)
-&gt; Getting (Point 2 r) lineSegment (Point 2 r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Point 2 r -&gt; Const (Point 2 r) (Point 2 r))
-&gt; point -&gt; Const (Point 2 r) point
forall point (d :: Nat) r.
Point_ point d r =&gt;
Lens' point (Point d r)
Lens' point (Point 2 r)
</span><span class="hs-identifier hs-var">asPoint</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679491475"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-327"></span><span>  </span><span class="hs-comment">-- all (\q -&gt; ordPoints (q^.core) p /= GT) [a,b]</span><span>
</span><span id="line-328"></span><span>
</span><span id="line-329"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-330"></span><span class="annot"><span class="hs-comment">-- * Finding New events</span></span><span>
</span><span id="line-331"></span><span>
</span><span id="line-332"></span><span class="annot"><span class="hs-comment">-- | Find all events</span></span><span>
</span><span id="line-333"></span><span id="local-6989586621679489507"><span id="local-6989586621679489508"><span id="local-6989586621679489509"><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#findNewEvent"><span class="hs-identifier hs-type">findNewEvent</span></a></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LineSegment_</span></span><span> </span><span class="annot"><a href="#local-6989586621679489507"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489508"><span class="hs-identifier hs-type">point</span></a></span><span>
</span><span id="line-334"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Point_</span></span><span> </span><span class="annot"><a href="#local-6989586621679489508"><span class="hs-identifier hs-type">point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679489509"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679489509"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679489509"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-335"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IsIntersectableWith</span></span><span> </span><span class="annot"><a href="#local-6989586621679489507"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489507"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-336"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Intersection</span></span><span> </span><span class="annot"><a href="#local-6989586621679489507"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489507"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span>
</span><span id="line-337"></span><span>                              </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LineSegmentLineSegmentIntersection</span></span><span> </span><span class="annot"><a href="#local-6989586621679489507"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>                      </span><span class="hs-special">)</span><span>
</span><span id="line-339"></span><span>                   </span><span class="hs-glyph">=&gt;</span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Point</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679489509"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679489507"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679489507"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-340"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489509"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489507"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-341"></span><span id="findNewEvent"><span class="annot"><span class="annottext">findNewEvent :: forall lineSegment point r.
(LineSegment_ lineSegment point, Point_ point 2 r, Ord r,
 Fractional r, IsIntersectableWith lineSegment lineSegment,
 Intersection lineSegment lineSegment
 ~ Maybe (LineSegmentLineSegmentIntersection lineSegment)) =&gt;
Point 2 r
-&gt; lineSegment -&gt; lineSegment -&gt; Maybe (Event r lineSegment)
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#findNewEvent"><span class="hs-identifier hs-var hs-var">findNewEvent</span></a></span></span><span> </span><span id="local-6989586621679491536"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679491536"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679491537"><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679491537"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679491538"><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679491538"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679491537"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">lineSegment -&gt; lineSegment -&gt; Intersection lineSegment lineSegment
forall g h. IsIntersectableWith g h =&gt; g -&gt; h -&gt; Intersection g h
</span><span class="hs-operator hs-var">`intersect`</span></span><span> </span><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679491538"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (LineSegmentLineSegmentIntersection lineSegment)
-&gt; (LineSegmentLineSegmentIntersection lineSegment
    -&gt; Maybe (Event r lineSegment))
-&gt; Maybe (Event r lineSegment)
forall a b. Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-342"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">LineSegment_x_LineSegment_Point</span></span><span> </span><span id="local-6989586621679491541"><span class="annot"><span class="annottext">Point 2 (NumType lineSegment)
</span><a href="#local-6989586621679491541"><span class="hs-identifier hs-var">q</span></a></span></span><span>
</span><span id="line-343"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; Ordering
forall point r.
(Point_ point 2 r, Ord r) =&gt;
point -&gt; point -&gt; Ordering
</span><a href="HGeometry.LineSegment.Intersection.Types.html#ordPoints"><span class="hs-identifier hs-var">ordPoints</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
Point 2 (NumType lineSegment)
</span><a href="#local-6989586621679491541"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621679491536"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Ordering -&gt; Ordering -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Event r lineSegment -&gt; Maybe (Event r lineSegment)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r -&gt; EventType lineSegment -&gt; Event r lineSegment
forall r lineSegment.
Point 2 r -&gt; EventType lineSegment -&gt; Event r lineSegment
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-var">Event</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
Point 2 (NumType lineSegment)
</span><a href="#local-6989586621679491541"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">EventType lineSegment
forall s. EventType s
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Intersection"><span class="hs-identifier hs-var">Intersection</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Event r lineSegment)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-345"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">LineSegment_x_LineSegment_LineSegment</span></span><span> </span><span class="annot"><span class="annottext">lineSegment
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Event r lineSegment)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-346"></span><span>    </span><span class="hs-comment">-- full segment intersectsions are handled at insertion time</span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span class="hs-comment">-- type R = Rational</span><span>
</span><span id="line-349"></span><span>
</span><span id="line-350"></span><span class="hs-comment">-- seg1, seg2 :: LineSegment 2 () R</span><span>
</span><span id="line-351"></span><span class="hs-comment">-- seg1 = ClosedLineSegment (ext $ Point2 0 0) (ext $ Point2 0 10)</span><span>
</span><span id="line-352"></span><span class="hs-comment">-- seg2 = ClosedLineSegment (ext $ Point2 0 1) (ext $ Point2 0 5)</span><span>
</span><span id="line-353"></span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-356"></span><span class="annot"><span class="hs-comment">-- *</span></span><span>
</span><span id="line-357"></span><span>
</span><span id="line-358"></span><span class="hs-comment">-- | Given a predicate p on elements, and a predicate q on</span><span>
</span><span id="line-359"></span><span class="hs-comment">-- (neighbouring) pairs of elements, filter the elements that satisfy</span><span>
</span><span id="line-360"></span><span class="hs-comment">-- p, or together with one of their neighbours satisfy q.</span><span>
</span><span id="line-361"></span><span id="local-6989586621679489518"><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#overlapsOr"><span class="hs-identifier hs-type">overlapsOr</span></a></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679489518"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>
</span><span id="line-362"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679489518"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679489518"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>
</span><span id="line-363"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679489518"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-364"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679489518"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-365"></span><span id="overlapsOr"><span class="annot"><span class="annottext">overlapsOr :: forall a. (a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#overlapsOr"><span class="hs-identifier hs-var hs-var">overlapsOr</span></a></span></span><span> </span><span id="local-6989586621679491543"><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621679491543"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679491544"><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
</span><a href="#local-6989586621679491544"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a, Bool) -&gt; a) -&gt; [(a, Bool)] -&gt; [a]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(a, Bool) -&gt; a
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">([(a, Bool)] -&gt; [a]) -&gt; ([a] -&gt; [(a, Bool)]) -&gt; [a] -&gt; [a]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((a, Bool) -&gt; Bool) -&gt; [(a, Bool)] -&gt; [(a, Bool)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">(a, Bool) -&gt; Bool
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">([(a, Bool)] -&gt; [(a, Bool)])
-&gt; ([a] -&gt; [(a, Bool)]) -&gt; [a] -&gt; [(a, Bool)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(((a, Bool), Bool) -&gt; (a, Bool))
-&gt; [((a, Bool), Bool)] -&gt; [(a, Bool)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679491547"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679491547"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679491548"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679491548"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621679491549"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679491549"><span class="hs-identifier hs-var">b'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679491547"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679491548"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679491549"><span class="hs-identifier hs-var">b'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-366"></span><span>               </span><span class="annot"><span class="annottext">([((a, Bool), Bool)] -&gt; [(a, Bool)])
-&gt; ([a] -&gt; [((a, Bool), Bool)]) -&gt; [a] -&gt; [(a, Bool)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((a, Bool) -&gt; (a, Bool) -&gt; Bool)
-&gt; [(a, Bool)] -&gt; [((a, Bool), Bool)]
forall a. (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [(a, Bool)]
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#overlapsWithNeighbour"><span class="hs-identifier hs-var">overlapsWithNeighbour</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
</span><a href="#local-6989586621679491544"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; a -&gt; Bool)
-&gt; ((a, Bool) -&gt; a) -&gt; (a, Bool) -&gt; (a, Bool) -&gt; Bool
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="annot"><span class="annottext">(a, Bool) -&gt; a
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span>
</span><span id="line-367"></span><span>               </span><span class="annot"><span class="annottext">([(a, Bool)] -&gt; [((a, Bool), Bool)])
-&gt; ([a] -&gt; [(a, Bool)]) -&gt; [a] -&gt; [((a, Bool), Bool)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; (a, Bool)) -&gt; [a] -&gt; [(a, Bool)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679491552"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679491552"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679491552"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621679491543"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679491552"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span>
</span><span id="line-369"></span><span class="hs-comment">-- | Given a predicate, test and a list, annotate each element whether</span><span>
</span><span id="line-370"></span><span class="hs-comment">-- it, together with one of its neighbors satisifies the predicate.</span><span>
</span><span id="line-371"></span><span id="local-6989586621679489581"><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#overlapsWithNeighbour"><span class="hs-identifier hs-type">overlapsWithNeighbour</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679489581"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679489581"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679489581"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679489581"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span class="hs-special">]</span></span><span>
</span><span id="line-372"></span><span id="overlapsWithNeighbour"><span class="annot"><span class="annottext">overlapsWithNeighbour :: forall a. (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [(a, Bool)]
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#overlapsWithNeighbour"><span class="hs-identifier hs-var hs-var">overlapsWithNeighbour</span></a></span></span><span> </span><span id="local-6989586621679491553"><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
</span><a href="#local-6989586621679491553"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [(a, Bool)]
</span><a href="#local-6989586621679491554"><span class="hs-identifier hs-var">go0</span></a></span><span>
</span><span id="line-373"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-374"></span><span>    </span><span id="local-6989586621679491554"><span class="annot"><span class="annottext">go0 :: [a] -&gt; [(a, Bool)]
</span><a href="#local-6989586621679491554"><span class="hs-identifier hs-var hs-var">go0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-375"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-376"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679491555"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679491555"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679491556"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679491556"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; Bool -&gt; [a] -&gt; [(a, Bool)]
</span><a href="#local-6989586621679491557"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679491555"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679491556"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-377"></span><span>
</span><span id="line-378"></span><span>    </span><span id="local-6989586621679491557"><span class="annot"><span class="annottext">go :: a -&gt; Bool -&gt; [a] -&gt; [(a, Bool)]
</span><a href="#local-6989586621679491557"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679491558"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679491558"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679491559"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679491559"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-379"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679491558"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679491559"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-380"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679491560"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679491560"><span class="hs-identifier hs-var">y</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679491561"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679491561"><span class="hs-identifier hs-var">ys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679491562"><span class="annot"><span class="annottext">b' :: Bool
</span><a href="#local-6989586621679491562"><span class="hs-identifier hs-var hs-var">b'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
</span><a href="#local-6989586621679491553"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679491558"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679491560"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-381"></span><span>                </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679491558"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679491559"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679491562"><span class="hs-identifier hs-var">b'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(a, Bool) -&gt; [(a, Bool)] -&gt; [(a, Bool)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Bool -&gt; [a] -&gt; [(a, Bool)]
</span><a href="#local-6989586621679491557"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679491560"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679491562"><span class="hs-identifier hs-var">b'</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679491561"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-382"></span><span>
</span><span id="line-383"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-386"></span><span class="annot"><span class="hs-comment">-- * Flipping and unflipping</span></span><span>
</span><span id="line-387"></span><span>
</span><span id="line-388"></span><span class="hs-keyword">data</span><span> </span><span id="Flipped"><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-var">Flipped</span></a></span></span><span> </span><span id="local-6989586621679489635"><span class="annot"><a href="#local-6989586621679489635"><span class="hs-identifier hs-type">segment</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="NotFlipped"><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#NotFlipped"><span class="hs-identifier hs-var">NotFlipped</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679489635"><span class="hs-identifier hs-type">segment</span></a></span><span>
</span><span id="line-389"></span><span>                     </span><span class="hs-glyph">|</span><span> </span><span id="Flipped"><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-var">Flipped</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679489635"><span class="hs-identifier hs-type">segment</span></a></span><span>
</span><span id="line-390"></span><span>                     </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679491567"><span id="local-6989586621679491573"><span id="local-6989586621679491577"><span class="annot"><span class="annottext">Int -&gt; Flipped segment -&gt; ShowS
[Flipped segment] -&gt; ShowS
Flipped segment -&gt; String
(Int -&gt; Flipped segment -&gt; ShowS)
-&gt; (Flipped segment -&gt; String)
-&gt; ([Flipped segment] -&gt; ShowS)
-&gt; Show (Flipped segment)
forall segment. Show segment =&gt; Int -&gt; Flipped segment -&gt; ShowS
forall segment. Show segment =&gt; [Flipped segment] -&gt; ShowS
forall segment. Show segment =&gt; Flipped segment -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: forall segment. Show segment =&gt; Int -&gt; Flipped segment -&gt; ShowS
showsPrec :: Int -&gt; Flipped segment -&gt; ShowS
$cshow :: forall segment. Show segment =&gt; Flipped segment -&gt; String
show :: Flipped segment -&gt; String
$cshowList :: forall segment. Show segment =&gt; [Flipped segment] -&gt; ShowS
showList :: [Flipped segment] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span id="local-6989586621679491581"><span id="local-6989586621679491588"><span class="annot"><span class="annottext">Flipped segment -&gt; Flipped segment -&gt; Bool
(Flipped segment -&gt; Flipped segment -&gt; Bool)
-&gt; (Flipped segment -&gt; Flipped segment -&gt; Bool)
-&gt; Eq (Flipped segment)
forall segment.
Eq segment =&gt;
Flipped segment -&gt; Flipped segment -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: forall segment.
Eq segment =&gt;
Flipped segment -&gt; Flipped segment -&gt; Bool
== :: Flipped segment -&gt; Flipped segment -&gt; Bool
$c/= :: forall segment.
Eq segment =&gt;
Flipped segment -&gt; Flipped segment -&gt; Bool
/= :: Flipped segment -&gt; Flipped segment -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span id="local-6989586621679491591"><span id="local-6989586621679491593"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; Flipped a -&gt; Flipped b)
-&gt; (forall a b. a -&gt; Flipped b -&gt; Flipped a) -&gt; Functor Flipped
forall a b. a -&gt; Flipped b -&gt; Flipped a
forall a b. (a -&gt; b) -&gt; Flipped a -&gt; Flipped b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall a b. (a -&gt; b) -&gt; Flipped a -&gt; Flipped b
fmap :: forall a b. (a -&gt; b) -&gt; Flipped a -&gt; Flipped b
$c&lt;$ :: forall a b. a -&gt; Flipped b -&gt; Flipped a
&lt;$ :: forall a b. a -&gt; Flipped b -&gt; Flipped a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-391"></span><span>
</span><span id="line-392"></span><span class="annot"><span class="hs-comment">-- | Access the underlying segment</span></span><span>
</span><span id="line-393"></span><span id="local-6989586621679489594"><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#rawSegment"><span class="hs-identifier hs-type">rawSegment</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.Type.html/Control.Lens.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-type">Flipped</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489594"><span class="hs-identifier hs-type">segment</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679489594"><span class="hs-identifier hs-type">segment</span></a></span></span><span>
</span><span id="line-394"></span><span id="rawSegment"><span class="annot"><span class="annottext">rawSegment :: forall segment (f :: * -&gt; *).
Functor f =&gt;
(segment -&gt; f segment) -&gt; Flipped segment -&gt; f (Flipped segment)
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#rawSegment"><span class="hs-identifier hs-var hs-var">rawSegment</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Flipped segment -&gt; segment)
-&gt; (Flipped segment -&gt; segment -&gt; Flipped segment)
-&gt; Lens (Flipped segment) (Flipped segment) segment segment
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.Lens.html/Control.Lens.Lens.html#lens"><span class="hs-identifier hs-var">lens</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-395"></span><span>                      </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#NotFlipped"><span class="hs-identifier hs-type">NotFlipped</span></a></span><span> </span><span id="local-6989586621679491602"><span class="annot"><span class="annottext">segment
</span><a href="#local-6989586621679491602"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">segment
</span><a href="#local-6989586621679491602"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-396"></span><span>                      </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-type">Flipped</span></a></span><span> </span><span id="local-6989586621679491603"><span class="annot"><span class="annottext">segment
</span><a href="#local-6989586621679491603"><span class="hs-identifier hs-var">s</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">segment
</span><a href="#local-6989586621679491603"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-397"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-398"></span><span>                  </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679491604"><span class="annot"><span class="annottext">Flipped segment
</span><a href="#local-6989586621679491604"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span id="local-6989586621679491605"><span class="annot"><span class="annottext">segment
</span><a href="#local-6989586621679491605"><span class="hs-identifier hs-var">seg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">segment
</span><a href="#local-6989586621679491605"><span class="hs-identifier hs-var">seg</span></a></span><span> </span><span class="annot"><span class="annottext">segment -&gt; Flipped segment -&gt; Flipped segment
forall a b. a -&gt; Flipped b -&gt; Flipped a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">Flipped segment
</span><a href="#local-6989586621679491604"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>
</span><span id="line-400"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="NumType"><span class="annot"><span class="hs-identifier hs-var">NumType</span></span></span><span>   </span><span id="local-6989586621679491606"><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-type">Flipped</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679491606"><span class="hs-identifier hs-type">segment</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NumType</span></span><span> </span><span class="annot"><a href="#local-6989586621679491606"><span class="hs-identifier hs-type">segment</span></a></span><span>
</span><span id="line-401"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="Dimension"><span class="annot"><span class="hs-identifier hs-var">Dimension</span></span></span><span> </span><span id="local-6989586621679491607"><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-type">Flipped</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679491607"><span class="hs-identifier hs-type">segment</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dimension</span></span><span> </span><span class="annot"><a href="#local-6989586621679491607"><span class="hs-identifier hs-type">segment</span></a></span><span>
</span><span id="line-402"></span><span>
</span><span id="line-403"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="Intersection"><span class="annot"><span class="hs-identifier hs-var">Intersection</span></span></span><span> </span><span id="local-6989586621679491608"><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-type">Flipped</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679491608"><span class="hs-identifier hs-type">segment</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-type">Flipped</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679491608"><span class="hs-identifier hs-type">segment</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-404"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LineSegmentLineSegmentIntersection</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-type">Flipped</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679491608"><span class="hs-identifier hs-type">segment</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-405"></span><span>
</span><span id="line-406"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679489604"><span id="local-6989586621679489605"><span class="annot"><span class="hs-identifier hs-type">HasStart</span></span><span> </span><span class="annot"><a href="#local-6989586621679489604"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489605"><span class="hs-identifier hs-type">point</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasStart</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-type">Flipped</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489604"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679489605"><span class="hs-identifier hs-type">point</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-407"></span><span>  </span><span id="local-6989586621679491617"><span class="annot"><span class="annottext">start :: Lens' (Flipped lineSegment) point
</span><span class="hs-identifier hs-var hs-var hs-var">start</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(lineSegment -&gt; f lineSegment)
-&gt; Flipped lineSegment -&gt; f (Flipped lineSegment)
forall segment (f :: * -&gt; *).
Functor f =&gt;
(segment -&gt; f segment) -&gt; Flipped segment -&gt; f (Flipped segment)
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#rawSegment"><span class="hs-identifier hs-var">rawSegment</span></a></span><span class="annot"><span class="annottext">((lineSegment -&gt; f lineSegment)
 -&gt; Flipped lineSegment -&gt; f (Flipped lineSegment))
-&gt; ((point -&gt; f point) -&gt; lineSegment -&gt; f lineSegment)
-&gt; (point -&gt; f point)
-&gt; Flipped lineSegment
-&gt; f (Flipped lineSegment)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(point -&gt; f point) -&gt; lineSegment -&gt; f lineSegment
forall seg p. HasStart seg p =&gt; Lens' seg p
Lens' lineSegment point
</span><span class="hs-identifier hs-var">start</span></span><span>
</span><span id="line-408"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679489609"><span id="local-6989586621679489610"><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasStartPoint</span></span><span> </span><span class="annot"><a href="#local-6989586621679489609"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489610"><span class="hs-identifier hs-type">endPoint</span></a></span><span>
</span><span id="line-409"></span><span>         </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasStartPoint</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-type">Flipped</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489609"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679489610"><span class="hs-identifier hs-type">endPoint</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-410"></span><span>  </span><span id="local-6989586621679491626"><span class="annot"><span class="annottext">startPoint :: Lens' (Flipped lineSegment) endPoint
</span><span class="hs-identifier hs-var hs-var hs-var">startPoint</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(lineSegment -&gt; f lineSegment)
-&gt; Flipped lineSegment -&gt; f (Flipped lineSegment)
forall segment (f :: * -&gt; *).
Functor f =&gt;
(segment -&gt; f segment) -&gt; Flipped segment -&gt; f (Flipped segment)
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#rawSegment"><span class="hs-identifier hs-var">rawSegment</span></a></span><span class="annot"><span class="annottext">((lineSegment -&gt; f lineSegment)
 -&gt; Flipped lineSegment -&gt; f (Flipped lineSegment))
-&gt; ((endPoint -&gt; f endPoint) -&gt; lineSegment -&gt; f lineSegment)
-&gt; (endPoint -&gt; f endPoint)
-&gt; Flipped lineSegment
-&gt; f (Flipped lineSegment)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(endPoint -&gt; f endPoint) -&gt; lineSegment -&gt; f lineSegment
forall seg p. HasStartPoint seg p =&gt; Lens' seg p
Lens' lineSegment endPoint
</span><span class="hs-identifier hs-var">startPoint</span></span><span>
</span><span id="line-411"></span><span>
</span><span id="line-412"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679489614"><span id="local-6989586621679489615"><span class="annot"><span class="hs-identifier hs-type">HasEnd</span></span><span> </span><span class="annot"><a href="#local-6989586621679489614"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489615"><span class="hs-identifier hs-type">point</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasEnd</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-type">Flipped</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489614"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679489615"><span class="hs-identifier hs-type">point</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-413"></span><span>  </span><span id="local-6989586621679491635"><span class="annot"><span class="annottext">end :: Lens' (Flipped lineSegment) point
</span><span class="hs-identifier hs-var hs-var hs-var">end</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(lineSegment -&gt; f lineSegment)
-&gt; Flipped lineSegment -&gt; f (Flipped lineSegment)
forall segment (f :: * -&gt; *).
Functor f =&gt;
(segment -&gt; f segment) -&gt; Flipped segment -&gt; f (Flipped segment)
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#rawSegment"><span class="hs-identifier hs-var">rawSegment</span></a></span><span class="annot"><span class="annottext">((lineSegment -&gt; f lineSegment)
 -&gt; Flipped lineSegment -&gt; f (Flipped lineSegment))
-&gt; ((point -&gt; f point) -&gt; lineSegment -&gt; f lineSegment)
-&gt; (point -&gt; f point)
-&gt; Flipped lineSegment
-&gt; f (Flipped lineSegment)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(point -&gt; f point) -&gt; lineSegment -&gt; f lineSegment
forall seg p. HasEnd seg p =&gt; Lens' seg p
Lens' lineSegment point
</span><span class="hs-identifier hs-var">end</span></span><span>
</span><span id="line-414"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679489619"><span id="local-6989586621679489620"><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasEndPoint</span></span><span> </span><span class="annot"><a href="#local-6989586621679489619"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489620"><span class="hs-identifier hs-type">endPoint</span></a></span><span>
</span><span id="line-415"></span><span>         </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasEndPoint</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-type">Flipped</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489619"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679489620"><span class="hs-identifier hs-type">endPoint</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-416"></span><span>  </span><span id="local-6989586621679491644"><span class="annot"><span class="annottext">endPoint :: Lens' (Flipped lineSegment) endPoint
</span><span class="hs-identifier hs-var hs-var hs-var">endPoint</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(lineSegment -&gt; f lineSegment)
-&gt; Flipped lineSegment -&gt; f (Flipped lineSegment)
forall segment (f :: * -&gt; *).
Functor f =&gt;
(segment -&gt; f segment) -&gt; Flipped segment -&gt; f (Flipped segment)
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#rawSegment"><span class="hs-identifier hs-var">rawSegment</span></a></span><span class="annot"><span class="annottext">((lineSegment -&gt; f lineSegment)
 -&gt; Flipped lineSegment -&gt; f (Flipped lineSegment))
-&gt; ((endPoint -&gt; f endPoint) -&gt; lineSegment -&gt; f lineSegment)
-&gt; (endPoint -&gt; f endPoint)
-&gt; Flipped lineSegment
-&gt; f (Flipped lineSegment)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(endPoint -&gt; f endPoint) -&gt; lineSegment -&gt; f lineSegment
forall seg p. HasEndPoint seg p =&gt; Lens' seg p
Lens' lineSegment endPoint
</span><span class="hs-identifier hs-var">endPoint</span></span><span>
</span><span id="line-417"></span><span>
</span><span id="line-418"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="StartPointOf"><span class="annot"><span class="hs-identifier hs-var">StartPointOf</span></span></span><span> </span><span id="local-6989586621679491645"><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-type">Flipped</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679491645"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StartPointOf</span></span><span> </span><span class="annot"><a href="#local-6989586621679491645"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-419"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="EndPointOf"><span class="annot"><span class="hs-identifier hs-var">EndPointOf</span></span></span><span>   </span><span id="local-6989586621679491646"><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-type">Flipped</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679491646"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EndPointOf</span></span><span>   </span><span class="annot"><a href="#local-6989586621679491646"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-420"></span><span>
</span><span id="line-421"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679489624"><span id="local-6989586621679489625"><span class="annot"><span class="hs-identifier hs-type">IntervalLike_</span></span><span> </span><span class="annot"><a href="#local-6989586621679489624"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489625"><span class="hs-identifier hs-type">point</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IntervalLike_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-type">Flipped</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489624"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679489625"><span class="hs-identifier hs-type">point</span></a></span></span></span><span>
</span><span id="line-422"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679489273"><span id="local-6989586621679489274"><span class="annot"><span class="hs-identifier hs-type">LineSegment_</span></span><span> </span><span class="annot"><a href="#local-6989586621679489273"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489274"><span class="hs-identifier hs-type">point</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LineSegment_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-type">Flipped</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489273"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679489274"><span class="hs-identifier hs-type">point</span></a></span></span></span><span>
</span><span id="line-423"></span><span>
</span><span id="line-424"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679489633"><span id="local-6989586621679489634"><span id="local-6989586621679491702"><span class="annot"><span class="hs-identifier hs-type">ConstructableLineSegment_</span></span><span> </span><span class="annot"><a href="#local-6989586621679489633"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489634"><span class="hs-identifier hs-type">point</span></a></span><span>
</span><span id="line-425"></span><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ConstructableLineSegment_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-type">Flipped</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489633"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679489634"><span class="hs-identifier hs-type">point</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-426"></span><span>  </span><span id="local-6989586621679491710"><span class="annot"><span class="annottext">uncheckedLineSegment :: point -&gt; point -&gt; Flipped lineSegment
</span><a href="#local-6989586621679491710"><span class="hs-identifier hs-var hs-var hs-var">uncheckedLineSegment</span></a></span></span><span> </span><span id="local-6989586621679491712"><span class="annot"><span class="annottext">point
</span><a href="#local-6989586621679491712"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679491713"><span class="annot"><span class="annottext">point
</span><a href="#local-6989586621679491713"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">lineSegment -&gt; Flipped lineSegment
forall segment. segment -&gt; Flipped segment
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#NotFlipped"><span class="hs-identifier hs-var">NotFlipped</span></a></span><span> </span><span class="annot"><span class="annottext">(lineSegment -&gt; Flipped lineSegment)
-&gt; lineSegment -&gt; Flipped lineSegment
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">point -&gt; point -&gt; lineSegment
forall lineSegment point.
ConstructableLineSegment_ lineSegment point =&gt;
point -&gt; point -&gt; lineSegment
</span><span class="hs-identifier hs-var">uncheckedLineSegment</span></span><span> </span><span class="annot"><span class="annottext">point
</span><a href="#local-6989586621679491712"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">point
</span><a href="#local-6989586621679491713"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-427"></span><span>
</span><span id="line-428"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679489637"><span class="annot"><a href="#local-6989586621679489637"><span class="hs-identifier hs-type">segment</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`HasIntersectionWith`</span></span><span> </span><span class="annot"><a href="#local-6989586621679489637"><span class="hs-identifier hs-type">segment</span></a></span><span>
</span><span id="line-429"></span><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-type">Flipped</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489637"><span class="hs-identifier hs-type">segment</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">`HasIntersectionWith`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-type">Flipped</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489637"><span class="hs-identifier hs-type">segment</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-430"></span><span>  </span><span id="local-6989586621679491721"><span class="annot"><span class="annottext">Flipped segment
</span><a href="#local-6989586621679491721"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679491722"><span class="annot"><span class="annottext">intersects :: Flipped segment -&gt; Flipped segment -&gt; Bool
</span><span class="hs-operator hs-var hs-var hs-var">`intersects`</span></span></span><span> </span><span id="local-6989586621679491723"><span class="annot"><span class="annottext">Flipped segment
</span><a href="#local-6989586621679491723"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Flipped segment
</span><a href="#local-6989586621679491721"><span class="hs-identifier hs-var">a</span></a></span><span class="annot"><span class="annottext">Flipped segment
-&gt; Getting segment (Flipped segment) segment -&gt; segment
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">Getting segment (Flipped segment) segment
forall segment (f :: * -&gt; *).
Functor f =&gt;
(segment -&gt; f segment) -&gt; Flipped segment -&gt; f (Flipped segment)
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#rawSegment"><span class="hs-identifier hs-var">rawSegment</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">segment -&gt; segment -&gt; Bool
forall g h. HasIntersectionWith g h =&gt; g -&gt; h -&gt; Bool
</span><span class="hs-operator hs-var">`intersects`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Flipped segment
</span><a href="#local-6989586621679491723"><span class="hs-identifier hs-var">b</span></a></span><span class="annot"><span class="annottext">Flipped segment
-&gt; Getting segment (Flipped segment) segment -&gt; segment
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">Getting segment (Flipped segment) segment
forall segment (f :: * -&gt; *).
Functor f =&gt;
(segment -&gt; f segment) -&gt; Flipped segment -&gt; f (Flipped segment)
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#rawSegment"><span class="hs-identifier hs-var">rawSegment</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-431"></span><span>
</span><span id="line-432"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679489276"><span class="annot"><span class="hs-identifier hs-type">HasOnSegment</span></span><span> </span><span class="annot"><a href="#local-6989586621679489276"><span class="hs-identifier hs-type">segment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasOnSegment</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-type">Flipped</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489276"><span class="hs-identifier hs-type">segment</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-number">2</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-433"></span><span>  </span><span id="local-6989586621679491745"><span class="annot"><span class="annottext">onSegment :: forall r point.
(Ord r, Point_ point 2 r, r ~ NumType (Flipped segment),
 2 ~ Dimension (Flipped segment)) =&gt;
point -&gt; Flipped segment -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var">onSegment</span></span></span><span> </span><span id="local-6989586621679491746"><span class="annot"><span class="annottext">point
</span><a href="#local-6989586621679491746"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621679491747"><span class="annot"><span class="annottext">Flipped segment
</span><a href="#local-6989586621679491747"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">point -&gt; segment -&gt; Bool
forall lineSegment (d :: Nat) r point.
(HasOnSegment lineSegment d, Ord r, Point_ point d r,
 r ~ NumType lineSegment, d ~ Dimension lineSegment) =&gt;
point -&gt; lineSegment -&gt; Bool
forall r point.
(Ord r, Point_ point 2 r, r ~ NumType segment,
 2 ~ Dimension segment) =&gt;
point -&gt; segment -&gt; Bool
</span><span class="hs-identifier hs-var">onSegment</span></span><span> </span><span class="annot"><span class="annottext">point
</span><a href="#local-6989586621679491746"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Flipped segment
</span><a href="#local-6989586621679491747"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">Flipped segment
-&gt; Getting segment (Flipped segment) segment -&gt; segment
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">Getting segment (Flipped segment) segment
forall segment (f :: * -&gt; *).
Functor f =&gt;
(segment -&gt; f segment) -&gt; Flipped segment -&gt; f (Flipped segment)
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#rawSegment"><span class="hs-identifier hs-var">rawSegment</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-434"></span><span>
</span><span id="line-435"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679489277"><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679489277"><span class="hs-identifier hs-type">segment</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`IsIntersectableWith`</span></span><span> </span><span class="annot"><a href="#local-6989586621679489277"><span class="hs-identifier hs-type">segment</span></a></span><span>
</span><span id="line-436"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Intersection</span></span><span> </span><span class="annot"><a href="#local-6989586621679489277"><span class="hs-identifier hs-type">segment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489277"><span class="hs-identifier hs-type">segment</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LineSegmentLineSegmentIntersection</span></span><span> </span><span class="annot"><a href="#local-6989586621679489277"><span class="hs-identifier hs-type">segment</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-437"></span><span>         </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-type">Flipped</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489277"><span class="hs-identifier hs-type">segment</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">`IsIntersectableWith`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-type">Flipped</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489277"><span class="hs-identifier hs-type">segment</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-438"></span><span>  </span><span id="local-6989586621679491761"><span class="annot"><span class="annottext">Flipped segment
</span><a href="#local-6989586621679491761"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679491762"><span class="annot"><span class="annottext">intersect :: Flipped segment
-&gt; Flipped segment
-&gt; Intersection (Flipped segment) (Flipped segment)
</span><span class="hs-operator hs-var hs-var hs-var">`intersect`</span></span></span><span> </span><span id="local-6989586621679491763"><span class="annot"><span class="annottext">Flipped segment
</span><a href="#local-6989586621679491763"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">segment -&gt; segment -&gt; Intersection segment segment
forall g h. IsIntersectableWith g h =&gt; g -&gt; h -&gt; Intersection g h
</span><span class="hs-identifier hs-var">intersect</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Flipped segment
</span><a href="#local-6989586621679491761"><span class="hs-identifier hs-var">a</span></a></span><span class="annot"><span class="annottext">Flipped segment
-&gt; Getting segment (Flipped segment) segment -&gt; segment
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">Getting segment (Flipped segment) segment
forall segment (f :: * -&gt; *).
Functor f =&gt;
(segment -&gt; f segment) -&gt; Flipped segment -&gt; f (Flipped segment)
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#rawSegment"><span class="hs-identifier hs-var">rawSegment</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Flipped segment
</span><a href="#local-6989586621679491763"><span class="hs-identifier hs-var">b</span></a></span><span class="annot"><span class="annottext">Flipped segment
-&gt; Getting segment (Flipped segment) segment -&gt; segment
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">Getting segment (Flipped segment) segment
forall segment (f :: * -&gt; *).
Functor f =&gt;
(segment -&gt; f segment) -&gt; Flipped segment -&gt; f (Flipped segment)
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#rawSegment"><span class="hs-identifier hs-var">rawSegment</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (LineSegmentLineSegmentIntersection segment)
-&gt; (LineSegmentLineSegmentIntersection segment
    -&gt; LineSegmentLineSegmentIntersection (Flipped segment))
-&gt; Maybe (LineSegmentLineSegmentIntersection (Flipped segment))
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-439"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">LineSegment_x_LineSegment_Point</span></span><span> </span><span id="local-6989586621679491765"><span class="annot"><span class="annottext">Point 2 (NumType segment)
</span><a href="#local-6989586621679491765"><span class="hs-identifier hs-var">p</span></a></span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Point 2 (NumType (Flipped segment))
-&gt; LineSegmentLineSegmentIntersection (Flipped segment)
forall lineSegment.
Point 2 (NumType lineSegment)
-&gt; LineSegmentLineSegmentIntersection lineSegment
</span><span class="hs-identifier hs-var">LineSegment_x_LineSegment_Point</span></span><span> </span><span class="annot"><span class="annottext">Point 2 (NumType segment)
Point 2 (NumType (Flipped segment))
</span><a href="#local-6989586621679491765"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-440"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">LineSegment_x_LineSegment_LineSegment</span></span><span> </span><span id="local-6989586621679491766"><span class="annot"><span class="annottext">segment
</span><a href="#local-6989586621679491766"><span class="hs-identifier hs-var">seg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-441"></span><span>      </span><span class="annot"><span class="annottext">Flipped segment
-&gt; LineSegmentLineSegmentIntersection (Flipped segment)
forall lineSegment.
lineSegment -&gt; LineSegmentLineSegmentIntersection lineSegment
</span><span class="hs-identifier hs-var">LineSegment_x_LineSegment_LineSegment</span></span><span> </span><span class="annot"><span class="annottext">(Flipped segment
 -&gt; LineSegmentLineSegmentIntersection (Flipped segment))
-&gt; Flipped segment
-&gt; LineSegmentLineSegmentIntersection (Flipped segment)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">segment -&gt; Flipped segment
forall segment. segment -&gt; Flipped segment
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#NotFlipped"><span class="hs-identifier hs-var">NotFlipped</span></a></span><span> </span><span class="annot"><span class="annottext">segment
</span><a href="#local-6989586621679491766"><span class="hs-identifier hs-var">seg</span></a></span><span>
</span><span id="line-442"></span><span>    </span><span class="hs-comment">-- TODO: maybe we should actually unflip segments a and b rather than use rawSegment</span><span>
</span><span id="line-443"></span><span>
</span><span id="line-444"></span><span>
</span><span id="line-445"></span><span class="hs-comment">-- type instance Intersection (geom :+ Flipped) (geom :+ Flipped) =</span><span>
</span><span id="line-446"></span><span class="hs-comment">--   Maybe (LineSegmentLineSegmentIntersection (geom :+ Flipped))</span><span>
</span><span id="line-447"></span><span>
</span><span id="line-448"></span><span class="hs-comment">-- instance IsIntersectableWith geomA geomB</span><span>
</span><span id="line-449"></span><span class="hs-comment">--          =&gt; IsIntersectableWith (geomA :+ extra) (geomB :+ extra) where</span><span>
</span><span id="line-450"></span><span class="hs-comment">--   ga `intersect` gb = (ga^.core) `intersect` (gb^.core)</span><span>
</span><span id="line-451"></span><span>
</span><span id="line-452"></span><span>
</span><span id="line-453"></span><span>
</span><span id="line-454"></span><span class="hs-comment">-- | Make sure the 'start' endpoint occurs before the end-endpoints in</span><span>
</span><span id="line-455"></span><span class="hs-comment">-- terms of the sweep order.</span><span>
</span><span id="line-456"></span><span id="local-6989586621679489292"><span id="local-6989586621679489293"><span id="local-6989586621679489294"><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#tagFlipped"><span class="hs-identifier hs-type">tagFlipped</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LineSegment_</span></span><span> </span><span class="annot"><a href="#local-6989586621679489292"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489293"><span class="hs-identifier hs-type">point</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Point_</span></span><span> </span><span class="annot"><a href="#local-6989586621679489293"><span class="hs-identifier hs-type">point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679489294"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679489294"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-457"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StartPointOf</span></span><span> </span><span class="annot"><a href="#local-6989586621679489292"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">EndPointOf</span></span><span> </span><span class="annot"><a href="#local-6989586621679489292"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-458"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-459"></span><span>             </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679489292"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-type">Flipped</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489292"><span class="hs-identifier hs-type">lineSegment</span></a></span></span></span></span><span>
</span><span id="line-460"></span><span id="tagFlipped"><span class="annot"><span class="annottext">tagFlipped :: forall lineSegment point r.
(LineSegment_ lineSegment point, Point_ point 2 r, Ord r,
 StartPointOf lineSegment ~ EndPointOf lineSegment) =&gt;
lineSegment -&gt; Flipped lineSegment
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#tagFlipped"><span class="hs-identifier hs-var hs-var">tagFlipped</span></a></span></span><span> </span><span id="local-6989586621679491849"><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679491849"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679491849"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">lineSegment -&gt; Getting point lineSegment point -&gt; point
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">Getting point lineSegment point
forall seg p. HasStart seg p =&gt; Lens' seg p
Lens' lineSegment point
</span><span class="hs-identifier hs-var">start</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">point -&gt; point -&gt; Ordering
forall point r.
(Point_ point 2 r, Ord r) =&gt;
point -&gt; point -&gt; Ordering
</span><a href="HGeometry.LineSegment.Intersection.Types.html#ordPoints"><span class="hs-operator hs-var">`ordPoints`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679491849"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">lineSegment -&gt; Getting point lineSegment point -&gt; point
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">Getting point lineSegment point
forall seg p. HasEnd seg p =&gt; Lens' seg p
Lens' lineSegment point
</span><span class="hs-identifier hs-var">end</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-461"></span><span>                 </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">lineSegment -&gt; Flipped lineSegment
forall segment. segment -&gt; Flipped segment
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-var">Flipped</span></a></span><span> </span><span class="annot"><span class="annottext">(lineSegment -&gt; Flipped lineSegment)
-&gt; lineSegment -&gt; Flipped lineSegment
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">lineSegment -&gt; lineSegment
forall lineSegment point.
(LineSegment_ lineSegment point,
 StartPointOf lineSegment ~ EndPointOf lineSegment) =&gt;
lineSegment -&gt; lineSegment
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#flipSeg"><span class="hs-identifier hs-var">flipSeg</span></a></span><span> </span><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679491849"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-462"></span><span>                 </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">lineSegment -&gt; Flipped lineSegment
forall segment. segment -&gt; Flipped segment
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#NotFlipped"><span class="hs-identifier hs-var">NotFlipped</span></a></span><span> </span><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679491849"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-463"></span><span>
</span><span id="line-464"></span><span class="annot"><span class="hs-comment">-- | Flips the segment</span></span><span>
</span><span id="line-465"></span><span id="local-6989586621679489649"><span id="local-6989586621679489650"><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#flipSeg"><span class="hs-identifier hs-type">flipSeg</span></a></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LineSegment_</span></span><span> </span><span class="annot"><a href="#local-6989586621679489649"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489650"><span class="hs-identifier hs-type">point</span></a></span><span>
</span><span id="line-466"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StartPointOf</span></span><span> </span><span class="annot"><a href="#local-6989586621679489649"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">EndPointOf</span></span><span> </span><span class="annot"><a href="#local-6989586621679489649"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-467"></span><span>               </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679489649"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679489649"><span class="hs-identifier hs-type">lineSegment</span></a></span></span></span><span>
</span><span id="line-468"></span><span id="flipSeg"><span class="annot"><span class="annottext">flipSeg :: forall lineSegment point.
(LineSegment_ lineSegment point,
 StartPointOf lineSegment ~ EndPointOf lineSegment) =&gt;
lineSegment -&gt; lineSegment
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#flipSeg"><span class="hs-identifier hs-var hs-var">flipSeg</span></a></span></span><span> </span><span id="local-6989586621679491867"><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679491867"><span class="hs-identifier hs-var">seg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679491867"><span class="hs-identifier hs-var">seg</span></a></span><span class="annot"><span class="annottext">lineSegment -&gt; (lineSegment -&gt; lineSegment) -&gt; lineSegment
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span class="annot"><span class="annottext">(EndPointOf lineSegment -&gt; Identity (EndPointOf lineSegment))
-&gt; lineSegment -&gt; Identity lineSegment
forall seg p. HasStartPoint seg p =&gt; Lens' seg p
Lens' lineSegment (EndPointOf lineSegment)
</span><span class="hs-identifier hs-var">startPoint</span></span><span> </span><span class="annot"><span class="annottext">((EndPointOf lineSegment -&gt; Identity (EndPointOf lineSegment))
 -&gt; lineSegment -&gt; Identity lineSegment)
-&gt; EndPointOf lineSegment -&gt; lineSegment -&gt; lineSegment
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.Setter.html/Control.Lens.Setter.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679491867"><span class="hs-identifier hs-var">seg</span></a></span><span class="annot"><span class="annottext">lineSegment
-&gt; Getting
     (EndPointOf lineSegment) lineSegment (EndPointOf lineSegment)
-&gt; EndPointOf lineSegment
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">Getting
  (EndPointOf lineSegment) lineSegment (EndPointOf lineSegment)
forall seg p. HasEndPoint seg p =&gt; Lens' seg p
Lens' lineSegment (EndPointOf lineSegment)
</span><span class="hs-identifier hs-var">endPoint</span></span><span class="hs-special">)</span><span>
</span><span id="line-469"></span><span>                 </span><span class="annot"><span class="annottext">lineSegment -&gt; (lineSegment -&gt; lineSegment) -&gt; lineSegment
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span class="annot"><span class="annottext">(EndPointOf lineSegment -&gt; Identity (EndPointOf lineSegment))
-&gt; lineSegment -&gt; Identity lineSegment
forall seg p. HasEndPoint seg p =&gt; Lens' seg p
Lens' lineSegment (EndPointOf lineSegment)
</span><span class="hs-identifier hs-var">endPoint</span></span><span>   </span><span class="annot"><span class="annottext">((EndPointOf lineSegment -&gt; Identity (EndPointOf lineSegment))
 -&gt; lineSegment -&gt; Identity lineSegment)
-&gt; EndPointOf lineSegment -&gt; lineSegment -&gt; lineSegment
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.Setter.html/Control.Lens.Setter.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">lineSegment
</span><a href="#local-6989586621679491867"><span class="hs-identifier hs-var">seg</span></a></span><span class="annot"><span class="annottext">lineSegment
-&gt; Getting
     (EndPointOf lineSegment) lineSegment (EndPointOf lineSegment)
-&gt; EndPointOf lineSegment
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">Getting
  (EndPointOf lineSegment) lineSegment (EndPointOf lineSegment)
forall seg p. HasStartPoint seg p =&gt; Lens' seg p
Lens' lineSegment (EndPointOf lineSegment)
</span><span class="hs-identifier hs-var">startPoint</span></span><span class="hs-special">)</span><span>
</span><span id="line-470"></span><span>
</span><span id="line-471"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-472"></span><span>
</span><span id="line-473"></span><span class="annot"><span class="hs-comment">-- | test if the segment is flipped or not.</span></span><span>
</span><span id="line-474"></span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#isFlipped"><span class="hs-identifier hs-type">isFlipped</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679489662"><span class="annot"><a href="#local-6989586621679489662"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621679489663"><span class="annot"><a href="#local-6989586621679489663"><span class="hs-identifier hs-type">lineSegment</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-475"></span><span>             </span><span class="annot"><span class="hs-identifier hs-type">Coercible</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679489662"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-type">Flipped</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489663"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-type">Flipped</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489663"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-476"></span><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679489662"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-type">Flipped</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489663"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-477"></span><span id="isFlipped"><span class="annot"><span class="annottext">isFlipped :: forall (f :: * -&gt; *) lineSegment.
Coercible (f (Flipped lineSegment)) (Flipped lineSegment) =&gt;
f (Flipped lineSegment) -&gt; Bool
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#isFlipped"><span class="hs-identifier hs-var hs-var">isFlipped</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-478"></span><span>                </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-type">Flipped</span></a></span><span> </span><span class="annot"><span class="annottext">lineSegment
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-479"></span><span>                </span><span class="annot"><span class="annottext">Flipped lineSegment
</span><span class="hs-identifier">_</span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Flipped lineSegment -&gt; Bool)
-&gt; (f (Flipped lineSegment) -&gt; Flipped lineSegment)
-&gt; f (Flipped lineSegment)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Coercible a b =&gt; a -&gt; b
forall a b. Coercible a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">coerce</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-type">Flipped</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489663"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-480"></span><span>
</span><span id="line-481"></span><span class="annot"><span class="hs-comment">-- | Unflips the segments in an associated.</span></span><span>
</span><span id="line-482"></span><span id="local-6989586621679489282"><span id="local-6989586621679489283"><span id="local-6989586621679489284"><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#unflipSegs"><span class="hs-identifier hs-type">unflipSegs</span></a></span><span>                       </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LineSegment_</span></span><span> </span><span class="annot"><a href="#local-6989586621679489282"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489283"><span class="hs-identifier hs-type">point</span></a></span><span>
</span><span id="line-483"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Point_</span></span><span> </span><span class="annot"><a href="#local-6989586621679489283"><span class="hs-identifier hs-type">point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679489284"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-484"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679489284"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679489284"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-485"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.Types.html#IntersectConstraints"><span class="hs-identifier hs-type">IntersectConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489282"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-486"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StartPointOf</span></span><span> </span><span class="annot"><a href="#local-6989586621679489282"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">EndPointOf</span></span><span> </span><span class="annot"><a href="#local-6989586621679489282"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-487"></span><span>                                    </span><span class="hs-special">)</span><span>
</span><span id="line-488"></span><span>                                 </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.Types.html#Associated"><span class="hs-identifier hs-type">Associated</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-type">Flipped</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489282"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-489"></span><span>                                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="HGeometry.LineSegment.Intersection.Types.html#Associated"><span class="hs-identifier hs-type">Associated</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489282"><span class="hs-identifier hs-type">lineSegment</span></a></span></span></span></span><span>
</span><span id="line-490"></span><span id="unflipSegs"><span class="annot"><span class="annottext">unflipSegs :: forall lineSegment point r.
(LineSegment_ lineSegment point, Point_ point 2 r, Fractional r,
 Ord r, IntersectConstraints lineSegment,
 StartPointOf lineSegment ~ EndPointOf lineSegment) =&gt;
Associated (Flipped lineSegment) -&gt; Associated lineSegment
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#unflipSegs"><span class="hs-identifier hs-var hs-var">unflipSegs</span></a></span></span><span> </span><span id="local-6989586621679491916"><span class="annot"><span class="annottext">Associated (Flipped lineSegment)
</span><a href="#local-6989586621679491916"><span class="hs-identifier hs-var">assocs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set (AroundStart lineSegment)
-&gt; Set (AroundEnd lineSegment)
-&gt; Set (AroundIntersection lineSegment)
-&gt; Associated lineSegment
forall lineSegment.
Set (AroundStart lineSegment)
-&gt; Set (AroundEnd lineSegment)
-&gt; Set (AroundIntersection lineSegment)
-&gt; Associated lineSegment
</span><a href="HGeometry.LineSegment.Intersection.Types.html#Associated"><span class="hs-identifier hs-var">Associated</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set (AroundStart (Flipped lineSegment))
-&gt; Set (AroundStart lineSegment)
forall (f :: * -&gt; *) lineSegment.
Functor f =&gt;
Set (f (Flipped lineSegment)) -&gt; Set (f lineSegment)
</span><a href="#local-6989586621679491918"><span class="hs-identifier hs-var">dropFlipped</span></a></span><span> </span><span class="annot"><span class="annottext">Set (AroundStart (Flipped lineSegment))
</span><a href="#local-6989586621679491919"><span class="hs-identifier hs-var">ss1</span></a></span><span> </span><span class="annot"><span class="annottext">Set (AroundStart lineSegment)
-&gt; Set (AroundStart lineSegment) -&gt; Set (AroundStart lineSegment)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set (AroundEnd (Flipped lineSegment))
-&gt; Set (AroundStart lineSegment)
forall (f :: * -&gt; *) lineSegment (g :: * -&gt; *) point.
(Functor f, Coercible (f lineSegment) (g lineSegment),
 LineSegment_ lineSegment point,
 StartPointOf lineSegment ~ EndPointOf lineSegment) =&gt;
Set (f (Flipped lineSegment)) -&gt; Set (g lineSegment)
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#unflipSegs%27"><span class="hs-identifier hs-var">unflipSegs'</span></a></span><span> </span><span class="annot"><span class="annottext">Set (AroundEnd (Flipped lineSegment))
</span><a href="#local-6989586621679491921"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-491"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set (AroundEnd (Flipped lineSegment))
-&gt; Set (AroundEnd lineSegment)
forall (f :: * -&gt; *) lineSegment.
Functor f =&gt;
Set (f (Flipped lineSegment)) -&gt; Set (f lineSegment)
</span><a href="#local-6989586621679491918"><span class="hs-identifier hs-var">dropFlipped</span></a></span><span> </span><span class="annot"><span class="annottext">Set (AroundEnd (Flipped lineSegment))
</span><a href="#local-6989586621679491922"><span class="hs-identifier hs-var">es1</span></a></span><span> </span><span class="annot"><span class="annottext">Set (AroundEnd lineSegment)
-&gt; Set (AroundEnd lineSegment) -&gt; Set (AroundEnd lineSegment)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set (AroundStart (Flipped lineSegment))
-&gt; Set (AroundEnd lineSegment)
forall (f :: * -&gt; *) lineSegment (g :: * -&gt; *) point.
(Functor f, Coercible (f lineSegment) (g lineSegment),
 LineSegment_ lineSegment point,
 StartPointOf lineSegment ~ EndPointOf lineSegment) =&gt;
Set (f (Flipped lineSegment)) -&gt; Set (g lineSegment)
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#unflipSegs%27"><span class="hs-identifier hs-var">unflipSegs'</span></a></span><span> </span><span class="annot"><span class="annottext">Set (AroundStart (Flipped lineSegment))
</span><a href="#local-6989586621679491923"><span class="hs-identifier hs-var">ss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-492"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set (AroundIntersection (Flipped lineSegment))
-&gt; Set (AroundIntersection lineSegment)
forall (f :: * -&gt; *) lineSegment.
Functor f =&gt;
Set (f (Flipped lineSegment)) -&gt; Set (f lineSegment)
</span><a href="#local-6989586621679491918"><span class="hs-identifier hs-var">dropFlipped</span></a></span><span> </span><span class="annot"><span class="annottext">Set (AroundIntersection (Flipped lineSegment))
</span><a href="#local-6989586621679491924"><span class="hs-identifier hs-var">is1</span></a></span><span> </span><span class="annot"><span class="annottext">Set (AroundIntersection lineSegment)
-&gt; Set (AroundIntersection lineSegment)
-&gt; Set (AroundIntersection lineSegment)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set (AroundIntersection (Flipped lineSegment))
-&gt; Set (AroundIntersection lineSegment)
forall (f :: * -&gt; *) lineSegment (g :: * -&gt; *) point.
(Functor f, Coercible (f lineSegment) (g lineSegment),
 LineSegment_ lineSegment point,
 StartPointOf lineSegment ~ EndPointOf lineSegment) =&gt;
Set (f (Flipped lineSegment)) -&gt; Set (g lineSegment)
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#unflipSegs%27"><span class="hs-identifier hs-var">unflipSegs'</span></a></span><span> </span><span class="annot"><span class="annottext">Set (AroundIntersection (Flipped lineSegment))
</span><a href="#local-6989586621679491925"><span class="hs-identifier hs-var">is</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-493"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-494"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679491923"><span class="annot"><span class="annottext">Set (AroundStart (Flipped lineSegment))
</span><a href="#local-6989586621679491923"><span class="hs-identifier hs-var">ss</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679491919"><span class="annot"><span class="annottext">Set (AroundStart (Flipped lineSegment))
</span><a href="#local-6989586621679491919"><span class="hs-identifier hs-var">ss1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(AroundStart (Flipped lineSegment) -&gt; Bool)
-&gt; Set (AroundStart (Flipped lineSegment))
-&gt; (Set (AroundStart (Flipped lineSegment)),
    Set (AroundStart (Flipped lineSegment)))
forall a. (a -&gt; Bool) -&gt; Set a -&gt; (Set a, Set a)
</span><span class="hs-identifier hs-var">Set.partition</span></span><span> </span><span class="annot"><span class="annottext">AroundStart (Flipped lineSegment) -&gt; Bool
forall (f :: * -&gt; *) lineSegment.
Coercible (f (Flipped lineSegment)) (Flipped lineSegment) =&gt;
f (Flipped lineSegment) -&gt; Bool
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#isFlipped"><span class="hs-identifier hs-var">isFlipped</span></a></span><span> </span><span class="annot"><span class="annottext">(Set (AroundStart (Flipped lineSegment))
 -&gt; (Set (AroundStart (Flipped lineSegment)),
     Set (AroundStart (Flipped lineSegment))))
-&gt; Set (AroundStart (Flipped lineSegment))
-&gt; (Set (AroundStart (Flipped lineSegment)),
    Set (AroundStart (Flipped lineSegment)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Associated (Flipped lineSegment)
</span><a href="#local-6989586621679491916"><span class="hs-identifier hs-var">assocs</span></a></span><span class="annot"><span class="annottext">Associated (Flipped lineSegment)
-&gt; Getting
     (Set (AroundStart (Flipped lineSegment)))
     (Associated (Flipped lineSegment))
     (Set (AroundStart (Flipped lineSegment)))
-&gt; Set (AroundStart (Flipped lineSegment))
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">Getting
  (Set (AroundStart (Flipped lineSegment)))
  (Associated (Flipped lineSegment))
  (Set (AroundStart (Flipped lineSegment)))
forall lineSegment (f :: * -&gt; *).
Functor f =&gt;
(Set (AroundStart lineSegment)
 -&gt; f (Set (AroundStart lineSegment)))
-&gt; Associated lineSegment -&gt; f (Associated lineSegment)
</span><a href="HGeometry.LineSegment.Intersection.Types.html#startPointOf"><span class="hs-identifier hs-var">startPointOf</span></a></span><span>
</span><span id="line-495"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679491921"><span class="annot"><span class="annottext">Set (AroundEnd (Flipped lineSegment))
</span><a href="#local-6989586621679491921"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679491922"><span class="annot"><span class="annottext">Set (AroundEnd (Flipped lineSegment))
</span><a href="#local-6989586621679491922"><span class="hs-identifier hs-var">es1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(AroundEnd (Flipped lineSegment) -&gt; Bool)
-&gt; Set (AroundEnd (Flipped lineSegment))
-&gt; (Set (AroundEnd (Flipped lineSegment)),
    Set (AroundEnd (Flipped lineSegment)))
forall a. (a -&gt; Bool) -&gt; Set a -&gt; (Set a, Set a)
</span><span class="hs-identifier hs-var">Set.partition</span></span><span> </span><span class="annot"><span class="annottext">AroundEnd (Flipped lineSegment) -&gt; Bool
forall (f :: * -&gt; *) lineSegment.
Coercible (f (Flipped lineSegment)) (Flipped lineSegment) =&gt;
f (Flipped lineSegment) -&gt; Bool
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#isFlipped"><span class="hs-identifier hs-var">isFlipped</span></a></span><span> </span><span class="annot"><span class="annottext">(Set (AroundEnd (Flipped lineSegment))
 -&gt; (Set (AroundEnd (Flipped lineSegment)),
     Set (AroundEnd (Flipped lineSegment))))
-&gt; Set (AroundEnd (Flipped lineSegment))
-&gt; (Set (AroundEnd (Flipped lineSegment)),
    Set (AroundEnd (Flipped lineSegment)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Associated (Flipped lineSegment)
</span><a href="#local-6989586621679491916"><span class="hs-identifier hs-var">assocs</span></a></span><span class="annot"><span class="annottext">Associated (Flipped lineSegment)
-&gt; Getting
     (Set (AroundEnd (Flipped lineSegment)))
     (Associated (Flipped lineSegment))
     (Set (AroundEnd (Flipped lineSegment)))
-&gt; Set (AroundEnd (Flipped lineSegment))
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">Getting
  (Set (AroundEnd (Flipped lineSegment)))
  (Associated (Flipped lineSegment))
  (Set (AroundEnd (Flipped lineSegment)))
forall lineSegment (f :: * -&gt; *).
Functor f =&gt;
(Set (AroundEnd lineSegment) -&gt; f (Set (AroundEnd lineSegment)))
-&gt; Associated lineSegment -&gt; f (Associated lineSegment)
</span><a href="HGeometry.LineSegment.Intersection.Types.html#endPointOf"><span class="hs-identifier hs-var">endPointOf</span></a></span><span>
</span><span id="line-496"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679491925"><span class="annot"><span class="annottext">Set (AroundIntersection (Flipped lineSegment))
</span><a href="#local-6989586621679491925"><span class="hs-identifier hs-var">is</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679491924"><span class="annot"><span class="annottext">Set (AroundIntersection (Flipped lineSegment))
</span><a href="#local-6989586621679491924"><span class="hs-identifier hs-var">is1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(AroundIntersection (Flipped lineSegment) -&gt; Bool)
-&gt; Set (AroundIntersection (Flipped lineSegment))
-&gt; (Set (AroundIntersection (Flipped lineSegment)),
    Set (AroundIntersection (Flipped lineSegment)))
forall a. (a -&gt; Bool) -&gt; Set a -&gt; (Set a, Set a)
</span><span class="hs-identifier hs-var">Set.partition</span></span><span> </span><span class="annot"><span class="annottext">AroundIntersection (Flipped lineSegment) -&gt; Bool
forall (f :: * -&gt; *) lineSegment.
Coercible (f (Flipped lineSegment)) (Flipped lineSegment) =&gt;
f (Flipped lineSegment) -&gt; Bool
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#isFlipped"><span class="hs-identifier hs-var">isFlipped</span></a></span><span> </span><span class="annot"><span class="annottext">(Set (AroundIntersection (Flipped lineSegment))
 -&gt; (Set (AroundIntersection (Flipped lineSegment)),
     Set (AroundIntersection (Flipped lineSegment))))
-&gt; Set (AroundIntersection (Flipped lineSegment))
-&gt; (Set (AroundIntersection (Flipped lineSegment)),
    Set (AroundIntersection (Flipped lineSegment)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Associated (Flipped lineSegment)
</span><a href="#local-6989586621679491916"><span class="hs-identifier hs-var">assocs</span></a></span><span class="annot"><span class="annottext">Associated (Flipped lineSegment)
-&gt; Getting
     (Set (AroundIntersection (Flipped lineSegment)))
     (Associated (Flipped lineSegment))
     (Set (AroundIntersection (Flipped lineSegment)))
-&gt; Set (AroundIntersection (Flipped lineSegment))
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span class="annot"><span class="annottext">Getting
  (Set (AroundIntersection (Flipped lineSegment)))
  (Associated (Flipped lineSegment))
  (Set (AroundIntersection (Flipped lineSegment)))
forall lineSegment (f :: * -&gt; *).
Functor f =&gt;
(Set (AroundIntersection lineSegment)
 -&gt; f (Set (AroundIntersection lineSegment)))
-&gt; Associated lineSegment -&gt; f (Associated lineSegment)
</span><a href="HGeometry.LineSegment.Intersection.Types.html#interiorTo"><span class="hs-identifier hs-var">interiorTo</span></a></span><span>
</span><span id="line-497"></span><span>
</span><span id="line-498"></span><span>    </span><span class="hs-comment">-- | For segments that are not acutally flipped, we can just drop the flipped bit</span><span>
</span><span id="line-499"></span><span>    </span><span id="local-6989586621679489671"><span id="local-6989586621679489672"><span class="annot"><a href="#local-6989586621679491918"><span class="hs-identifier hs-type">dropFlipped</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="annot"><a href="#local-6989586621679489671"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-500"></span><span>                </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679489671"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-type">Flipped</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489672"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679489671"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489672"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-501"></span><span>    </span><span id="local-6989586621679491918"><span class="annot"><span class="annottext">dropFlipped :: forall (f :: * -&gt; *) lineSegment.
Functor f =&gt;
Set (f (Flipped lineSegment)) -&gt; Set (f lineSegment)
</span><a href="#local-6989586621679491918"><span class="hs-identifier hs-var hs-var">dropFlipped</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(f (Flipped lineSegment) -&gt; f lineSegment)
-&gt; Set (f (Flipped lineSegment)) -&gt; Set (f lineSegment)
forall a b. (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.mapMonotonic</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Flipped lineSegment -&gt; lineSegment)
-&gt; f (Flipped lineSegment) -&gt; f lineSegment
forall a b. (a -&gt; b) -&gt; f a -&gt; f b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">((Flipped lineSegment -&gt; lineSegment)
 -&gt; f (Flipped lineSegment) -&gt; f lineSegment)
-&gt; (Flipped lineSegment -&gt; lineSegment)
-&gt; f (Flipped lineSegment)
-&gt; f lineSegment
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Getting lineSegment (Flipped lineSegment) lineSegment
-&gt; Flipped lineSegment -&gt; lineSegment
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#view"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">Getting lineSegment (Flipped lineSegment) lineSegment
forall segment (f :: * -&gt; *).
Functor f =&gt;
(segment -&gt; f segment) -&gt; Flipped segment -&gt; f (Flipped segment)
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#rawSegment"><span class="hs-identifier hs-var">rawSegment</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-502"></span><span>
</span><span id="line-503"></span><span class="hs-comment">-- | For flipped segs we unflip them (and appropriately coerce the so that they remain in</span><span>
</span><span id="line-504"></span><span class="hs-comment">-- the same order. I.e. if they were sorted around the start point they are now sorted</span><span>
</span><span id="line-505"></span><span class="hs-comment">-- around the endpoint.</span><span>
</span><span id="line-506"></span><span id="local-6989586621679489673"><span id="local-6989586621679489674"><span id="local-6989586621679489675"><span id="local-6989586621679489676"><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#unflipSegs%27"><span class="hs-identifier hs-type">unflipSegs'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="annot"><a href="#local-6989586621679489673"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Coercible</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679489673"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489674"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679489675"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489674"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-507"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LineSegment_</span></span><span> </span><span class="annot"><a href="#local-6989586621679489674"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489676"><span class="hs-identifier hs-type">point</span></a></span><span>
</span><span id="line-508"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StartPointOf</span></span><span> </span><span class="annot"><a href="#local-6989586621679489674"><span class="hs-identifier hs-type">lineSegment</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">EndPointOf</span></span><span> </span><span class="annot"><a href="#local-6989586621679489674"><span class="hs-identifier hs-type">lineSegment</span></a></span><span>
</span><span id="line-509"></span><span>               </span><span class="hs-special">)</span><span>
</span><span id="line-510"></span><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679489673"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-type">Flipped</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489674"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679489675"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679489674"><span class="hs-identifier hs-type">lineSegment</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-511"></span><span id="unflipSegs%27"><span class="annot"><span class="annottext">unflipSegs' :: forall (f :: * -&gt; *) lineSegment (g :: * -&gt; *) point.
(Functor f, Coercible (f lineSegment) (g lineSegment),
 LineSegment_ lineSegment point,
 StartPointOf lineSegment ~ EndPointOf lineSegment) =&gt;
Set (f (Flipped lineSegment)) -&gt; Set (g lineSegment)
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#unflipSegs%27"><span class="hs-identifier hs-var hs-var">unflipSegs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(f (Flipped lineSegment) -&gt; g lineSegment)
-&gt; Set (f (Flipped lineSegment)) -&gt; Set (g lineSegment)
forall a b. (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.mapMonotonic</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f lineSegment -&gt; g lineSegment
forall a b. Coercible a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">coerce</span></span><span> </span><span class="annot"><span class="annottext">(f lineSegment -&gt; g lineSegment)
-&gt; (f (Flipped lineSegment) -&gt; f lineSegment)
-&gt; f (Flipped lineSegment)
-&gt; g lineSegment
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Flipped lineSegment -&gt; lineSegment)
-&gt; f (Flipped lineSegment) -&gt; f lineSegment
forall a b. (a -&gt; b) -&gt; f a -&gt; f b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">lineSegment -&gt; lineSegment
forall lineSegment point.
(LineSegment_ lineSegment point,
 StartPointOf lineSegment ~ EndPointOf lineSegment) =&gt;
lineSegment -&gt; lineSegment
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#flipSeg"><span class="hs-identifier hs-var">flipSeg</span></a></span><span> </span><span class="annot"><span class="annottext">(lineSegment -&gt; lineSegment)
-&gt; (Flipped lineSegment -&gt; lineSegment)
-&gt; Flipped lineSegment
-&gt; lineSegment
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Getting lineSegment (Flipped lineSegment) lineSegment
-&gt; Flipped lineSegment -&gt; lineSegment
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#view"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">Getting lineSegment (Flipped lineSegment) lineSegment
forall segment (f :: * -&gt; *).
Functor f =&gt;
(segment -&gt; f segment) -&gt; Flipped segment -&gt; f (Flipped segment)
</span><a href="HGeometry.LineSegment.Intersection.BentleyOttmann.html#rawSegment"><span class="hs-identifier hs-var">rawSegment</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-512"></span></pre></body></html>