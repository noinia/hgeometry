<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-2"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- Module      :  HGeometry.Polygon.Triangulation.Types</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- Copyright   :  (C) Frank Staals</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- License     :  see the LICENSE file</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- Maintainer  :  Frank Staals</span><span>
</span><span id="line-7"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-8"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="HGeometry.Polygon.Triangulation.Types.html"><span class="hs-identifier">HGeometry.Polygon.Triangulation.Types</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.html/Control.Lens.html"><span class="hs-identifier">Control.Lens</span></a></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Coerce</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Lens.Util.html/HGeometry.Lens.Util.html"><span class="hs-identifier">HGeometry.Lens.Util</span></a></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="HGeometry.PlaneGraph.html"><span class="hs-identifier">HGeometry.PlaneGraph</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">HGeometry.Point</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="HGeometry.Polygon.Class.html"><span class="hs-identifier">HGeometry.Polygon.Class</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="HGeometry.Polygon.Simple.Class.html"><span class="hs-identifier">HGeometry.Polygon.Simple.Class</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">HGeometry.Vector</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hiraffe-0.1/doc/html/hiraffe/src/Hiraffe.PlanarGraph.html/Hiraffe.PlanarGraph.html"><span class="hs-identifier">Hiraffe.PlanarGraph</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PlanarGraph</span></span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-comment">-- import qualified Data.Foldable as F</span><span>
</span><span id="line-24"></span><span class="hs-comment">-- import Debug.Trace</span><span>
</span><span id="line-25"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="annot"><span class="hs-comment">-- | After triangulation, edges are either from the original polygon or a new diagonal.</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">data</span><span> </span><span id="PolygonEdgeType"><span class="annot"><a href="HGeometry.Polygon.Triangulation.Types.html#PolygonEdgeType"><span class="hs-identifier hs-var">PolygonEdgeType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Original"><span class="annot"><a href="HGeometry.Polygon.Triangulation.Types.html#Original"><span class="hs-identifier hs-var">Original</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Diagonal"><span class="annot"><a href="HGeometry.Polygon.Triangulation.Types.html#Diagonal"><span class="hs-identifier hs-var">Diagonal</span></a></span></span><span>
</span><span id="line-29"></span><span>                     </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679538741"><span id="local-6989586621679538743"><span id="local-6989586621679538747"><span class="annot"><span class="annottext">Int -&gt; PolygonEdgeType -&gt; ShowS
[PolygonEdgeType] -&gt; ShowS
PolygonEdgeType -&gt; String
(Int -&gt; PolygonEdgeType -&gt; ShowS)
-&gt; (PolygonEdgeType -&gt; String)
-&gt; ([PolygonEdgeType] -&gt; ShowS)
-&gt; Show PolygonEdgeType
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; PolygonEdgeType -&gt; ShowS
showsPrec :: Int -&gt; PolygonEdgeType -&gt; ShowS
$cshow :: PolygonEdgeType -&gt; String
show :: PolygonEdgeType -&gt; String
$cshowList :: [PolygonEdgeType] -&gt; ShowS
showList :: [PolygonEdgeType] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span id="local-6989586621679538752"><span id="local-6989586621679538756"><span id="local-6989586621679538759"><span id="local-6989586621679538764"><span class="annot"><span class="annottext">ReadPrec [PolygonEdgeType]
ReadPrec PolygonEdgeType
Int -&gt; ReadS PolygonEdgeType
ReadS [PolygonEdgeType]
(Int -&gt; ReadS PolygonEdgeType)
-&gt; ReadS [PolygonEdgeType]
-&gt; ReadPrec PolygonEdgeType
-&gt; ReadPrec [PolygonEdgeType]
-&gt; Read PolygonEdgeType
forall a.
(Int -&gt; ReadS a)
-&gt; ReadS [a] -&gt; ReadPrec a -&gt; ReadPrec [a] -&gt; Read a
$creadsPrec :: Int -&gt; ReadS PolygonEdgeType
readsPrec :: Int -&gt; ReadS PolygonEdgeType
$creadList :: ReadS [PolygonEdgeType]
readList :: ReadS [PolygonEdgeType]
$creadPrec :: ReadPrec PolygonEdgeType
readPrec :: ReadPrec PolygonEdgeType
$creadListPrec :: ReadPrec [PolygonEdgeType]
readListPrec :: ReadPrec [PolygonEdgeType]
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Read</span></span></span></span></span></span><span class="hs-special">,</span><span id="local-6989586621679538771"><span id="local-6989586621679538776"><span class="annot"><span class="annottext">PolygonEdgeType -&gt; PolygonEdgeType -&gt; Bool
(PolygonEdgeType -&gt; PolygonEdgeType -&gt; Bool)
-&gt; (PolygonEdgeType -&gt; PolygonEdgeType -&gt; Bool)
-&gt; Eq PolygonEdgeType
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: PolygonEdgeType -&gt; PolygonEdgeType -&gt; Bool
== :: PolygonEdgeType -&gt; PolygonEdgeType -&gt; Bool
$c/= :: PolygonEdgeType -&gt; PolygonEdgeType -&gt; Bool
/= :: PolygonEdgeType -&gt; PolygonEdgeType -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span class="hs-comment">-- | Data type that expresses whether or not we are inside or outside the</span><span>
</span><span id="line-32"></span><span class="hs-comment">-- polygon.</span><span>
</span><span id="line-33"></span><span class="hs-keyword">data</span><span> </span><span id="PolygonFaceData"><span class="annot"><a href="HGeometry.Polygon.Triangulation.Types.html#PolygonFaceData"><span class="hs-identifier hs-var">PolygonFaceData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Inside"><span class="annot"><a href="HGeometry.Polygon.Triangulation.Types.html#Inside"><span class="hs-identifier hs-var">Inside</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Outside"><span class="annot"><a href="HGeometry.Polygon.Triangulation.Types.html#Outside"><span class="hs-identifier hs-var">Outside</span></a></span></span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679538783"><span id="local-6989586621679538785"><span id="local-6989586621679538789"><span class="annot"><span class="annottext">Int -&gt; PolygonFaceData -&gt; ShowS
[PolygonFaceData] -&gt; ShowS
PolygonFaceData -&gt; String
(Int -&gt; PolygonFaceData -&gt; ShowS)
-&gt; (PolygonFaceData -&gt; String)
-&gt; ([PolygonFaceData] -&gt; ShowS)
-&gt; Show PolygonFaceData
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; PolygonFaceData -&gt; ShowS
showsPrec :: Int -&gt; PolygonFaceData -&gt; ShowS
$cshow :: PolygonFaceData -&gt; String
show :: PolygonFaceData -&gt; String
$cshowList :: [PolygonFaceData] -&gt; ShowS
showList :: [PolygonFaceData] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span id="local-6989586621679538792"><span id="local-6989586621679538796"><span id="local-6989586621679538799"><span id="local-6989586621679538803"><span class="annot"><span class="annottext">ReadPrec [PolygonFaceData]
ReadPrec PolygonFaceData
Int -&gt; ReadS PolygonFaceData
ReadS [PolygonFaceData]
(Int -&gt; ReadS PolygonFaceData)
-&gt; ReadS [PolygonFaceData]
-&gt; ReadPrec PolygonFaceData
-&gt; ReadPrec [PolygonFaceData]
-&gt; Read PolygonFaceData
forall a.
(Int -&gt; ReadS a)
-&gt; ReadS [a] -&gt; ReadPrec a -&gt; ReadPrec [a] -&gt; Read a
$creadsPrec :: Int -&gt; ReadS PolygonFaceData
readsPrec :: Int -&gt; ReadS PolygonFaceData
$creadList :: ReadS [PolygonFaceData]
readList :: ReadS [PolygonFaceData]
$creadPrec :: ReadPrec PolygonFaceData
readPrec :: ReadPrec PolygonFaceData
$creadListPrec :: ReadPrec [PolygonFaceData]
readListPrec :: ReadPrec [PolygonFaceData]
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Read</span></span></span></span></span></span><span class="hs-special">,</span><span id="local-6989586621679538806"><span id="local-6989586621679538810"><span class="annot"><span class="annottext">PolygonFaceData -&gt; PolygonFaceData -&gt; Bool
(PolygonFaceData -&gt; PolygonFaceData -&gt; Bool)
-&gt; (PolygonFaceData -&gt; PolygonFaceData -&gt; Bool)
-&gt; Eq PolygonFaceData
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: PolygonFaceData -&gt; PolygonFaceData -&gt; Bool
== :: PolygonFaceData -&gt; PolygonFaceData -&gt; Bool
$c/= :: PolygonFaceData -&gt; PolygonFaceData -&gt; Bool
/= :: PolygonFaceData -&gt; PolygonFaceData -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-keyword">type</span><span> </span><span id="Diagonal"><span class="annot"><a href="HGeometry.Polygon.Triangulation.Types.html#Diagonal"><span class="hs-identifier hs-var">Diagonal</span></a></span></span><span> </span><span id="local-6989586621679538813"><span class="annot"><a href="#local-6989586621679538813"><span class="hs-identifier hs-type">polygon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hiraffe-0.1/doc/html/hiraffe/src/Hiraffe.Graph.Class.html/Hiraffe.Graph.Class.html#VertexIx"><span class="hs-identifier hs-type">VertexIx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538813"><span class="hs-identifier hs-type">polygon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="hs-comment">{-

-- | Given a list of original edges and a list of diagonals, creates a
-- planar-subdivision
--
--
-- running time: \(O(n\log n)\)
constructSubdivision               :: forall s r p. (Fractional r, Ord r)
                                   =&gt; LineSegment 2 p r -- ^ A counter-clockwise
                                                      -- edge along the outer
                                                      -- boundary
                                   -&gt; [LineSegment 2 p r] -- ^ remaining original edges
                                   -&gt; [LineSegment 2 p r] -- ^ diagonals
                                   -&gt; PlanarSubdivision s
                                         p PolygonEdgeType PolygonFaceData r
constructSubdivision e origs diags = fromPlaneGraph $ constructGraph e origs diags

-- constructSubdivision px e origs diags =
--     subdiv &amp; rawVertexData.traverse.dataVal  %~ NonEmpty.head
--            &amp; rawFaceData                     %~ V.zipWith zipF faceData'
--            &amp; rawDartData.traverse.dataVal    %~ snd
--   where
--     subdiv :: PlanarSubdivision s (NonEmpty p) (Bool,PolygonEdgeType) () r
--     subdiv = fromConnectedSegments px $ e' : origs' &lt;&gt; diags'

--     diags' = (:+ (True, Diagonal)) &lt;$&gt; diags
--     origs' = (:+ (False,Original)) &lt;$&gt; origs
--     e'     = e :+ (True, Original)

--     -- the darts incident to internal faces
--     queryDarts = concatMap shouldQuery . F.toList . edges' $ subdiv
--     shouldQuery d = case subdiv^.dataOf d of
--                       (True, Original) -&gt; [d]
--                       (True, Diagonal) -&gt; [d, twin d]
--                       _                -&gt; []

--     -- the interior faces
--     intFaces = flip leftFace subdiv &lt;$&gt; queryDarts
--     faceData' = V.create $ do
--                   v' &lt;- MV.replicate (numFaces subdiv) Outside
--                   forM_ intFaces $ \(PG.FaceId (PG.VertexId f)) -&gt;
--                     MV.write v' f Inside
--                   pure v'

--     -- set the inside/outside data value
--     zipF x rfd = rfd&amp;dataVal .~ x
-- -- TODO: Idea: generalize the face data assignment into a function
-- -- that does something like: [(Dart, fLeft, fRight] -&gt; FaceData

-}</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-comment">-- fromConnectedSegments       :: ( Foldable1 f</span><span>
</span><span id="line-91"></span><span class="hs-comment">--                                , LineSegment_ lineSegment vertex</span><span>
</span><span id="line-92"></span><span class="hs-comment">--                                , Point_ vertex 2 r, Ord r, Num r</span><span>
</span><span id="line-93"></span><span class="hs-comment">--                                )</span><span>
</span><span id="line-94"></span><span class="hs-comment">--                             =&gt; f lineSegment -&gt; PlaneGraph s (NonEmpty vertex) lineSegment ()</span><span>
</span><span id="line-95"></span><span class="hs-comment">-- fromConnectedSegments segs = fromAdjacencyLists adjLists</span><span>
</span><span id="line-96"></span><span class="hs-comment">--   where</span><span>
</span><span id="line-97"></span><span class="hs-comment">--     adjLists = Map.fromListWith (&lt;&gt;) . concatMap f . zipWith g [0..] . F.toList $ ss</span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="hs-comment">--     mkVertex</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span class="hs-comment">--   fromadjacencylists</span><span>
</span><span id="line-104"></span><span class="hs-comment">--   where</span><span>
</span><span id="line-105"></span><span class="hs-comment">-- planarGraph dts &amp; PG.vertexData .~ vxData</span><span>
</span><span id="line-106"></span><span class="hs-comment">--   where</span><span>
</span><span id="line-107"></span><span class="hs-comment">--     pts         = M.fromListWith (&lt;&gt;) . concatMap f . zipWith g [0..] . F.toList $ ss</span><span>
</span><span id="line-108"></span><span class="hs-comment">--     f (s :+ e)  = [ ( s^.start.core</span><span>
</span><span id="line-109"></span><span class="hs-comment">--                     , SP (sing $ s^.start.extra) [(s^.end.core)   :+ h Positive e])</span><span>
</span><span id="line-110"></span><span class="hs-comment">--                   , ( s^.end.core</span><span>
</span><span id="line-111"></span><span class="hs-comment">--                     , SP (sing $ s^.end.extra)   [(s^.start.core) :+ h Negative e])</span><span>
</span><span id="line-112"></span><span class="hs-comment">--                   ]</span><span>
</span><span id="line-113"></span><span class="hs-comment">--     g i (s :+ e) = s :+ (Arc i :+ e)</span><span>
</span><span id="line-114"></span><span class="hs-comment">--     h d (a :+ e) = (Dart a d, e)</span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="hs-comment">--     sing x = x NonEmpty.:| []</span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="hs-comment">--     vts    = map (\(p,sp) -&gt; (p,map (^.extra) . sortAround' (ext p) &lt;$&gt; sp))</span><span>
</span><span id="line-119"></span><span class="hs-comment">--            . M.assocs $ pts</span><span>
</span><span id="line-120"></span><span class="hs-comment">--     -- vertex Data</span><span>
</span><span id="line-121"></span><span class="hs-comment">--     vxData = V.fromList . map (\(p,sp) -&gt; VertexData p (sp^._1)) $ vts</span><span>
</span><span id="line-122"></span><span class="hs-comment">--     -- The darts</span><span>
</span><span id="line-123"></span><span class="hs-comment">--     dts    = map (^._2._2) vts</span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span class="hs-comment">-- | Given a list of original edges and a list of diagonals, creates a</span><span>
</span><span id="line-128"></span><span class="hs-comment">-- planar-subdivision. The vertexId's will remain unchanged.</span><span>
</span><span id="line-129"></span><span class="hs-comment">--</span><span>
</span><span id="line-130"></span><span class="hs-comment">--</span><span>
</span><span id="line-131"></span><span class="hs-comment">-- running time: \(O(n\log n)\)</span><span>
</span><span id="line-132"></span><span class="annot"><a href="HGeometry.Polygon.Triangulation.Types.html#constructGraph"><span class="hs-identifier hs-type">constructGraph</span></a></span><span>          </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679538609"><span class="annot"><a href="#local-6989586621679538609"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621679538602"><span class="annot"><a href="#local-6989586621679538602"><span class="hs-identifier hs-type">polygon</span></a></span></span><span> </span><span id="local-6989586621679538603"><span class="annot"><a href="#local-6989586621679538603"><span class="hs-identifier hs-type">point</span></a></span></span><span> </span><span id="local-6989586621679538604"><span class="annot"><a href="#local-6989586621679538604"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621679538607"><span class="annot"><a href="#local-6989586621679538607"><span class="hs-identifier hs-type">f</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-133"></span><span>                           </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="HGeometry.Polygon.Simple.Class.html#SimplePolygon_"><span class="hs-identifier hs-type">SimplePolygon_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538602"><span class="hs-identifier hs-type">polygon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538603"><span class="hs-identifier hs-type">point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538604"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Point_</span></span><span> </span><span class="annot"><a href="#local-6989586621679538603"><span class="hs-identifier hs-type">point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621679538604"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-134"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679538607"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679538604"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679538604"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-135"></span><span>                           </span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>                        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679538602"><span class="hs-identifier hs-type">polygon</span></a></span><span>
</span><span id="line-137"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679538607"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="HGeometry.Polygon.Triangulation.Types.html#Diagonal"><span class="hs-identifier hs-type">Diagonal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538602"><span class="hs-identifier hs-type">polygon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="HGeometry.PlaneGraph.Connected.Type.html#CPlaneGraph"><span class="hs-identifier hs-type">CPlaneGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538609"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538603"><span class="hs-identifier hs-type">point</span></a></span><span> </span><span class="annot"><a href="HGeometry.Polygon.Triangulation.Types.html#PolygonEdgeType"><span class="hs-identifier hs-type">PolygonEdgeType</span></a></span><span> </span><span class="annot"><a href="HGeometry.Polygon.Triangulation.Types.html#PolygonFaceData"><span class="hs-identifier hs-type">PolygonFaceData</span></a></span><span>
</span><span id="line-139"></span><span id="constructGraph"><span class="annot"><span class="annottext">constructGraph :: forall {k} (s :: k) polygon point r (f :: * -&gt; *).
(SimplePolygon_ polygon point r, Point_ point 2 r, Foldable f,
 Ord r, Num r) =&gt;
polygon
-&gt; f (Diagonal polygon)
-&gt; CPlaneGraph s point PolygonEdgeType PolygonFaceData
</span><a href="HGeometry.Polygon.Triangulation.Types.html#constructGraph"><span class="hs-identifier hs-var hs-var">constructGraph</span></a></span></span><span> </span><span id="local-6989586621679538896"><span class="annot"><span class="annottext">polygon
</span><a href="#local-6989586621679538896"><span class="hs-identifier hs-var">pg</span></a></span></span><span> </span><span id="local-6989586621679538897"><span class="annot"><span class="annottext">f (Diagonal polygon)
</span><a href="#local-6989586621679538897"><span class="hs-identifier hs-var">diags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CPlaneGraph s point PolygonEdgeType ()
</span><a href="#local-6989586621679538898"><span class="hs-identifier hs-var">gr</span></a></span><span class="annot"><span class="annottext">CPlaneGraph s point PolygonEdgeType ()
-&gt; (CPlaneGraph s point PolygonEdgeType ()
    -&gt; CPlaneGraph s point PolygonEdgeType PolygonFaceData)
-&gt; CPlaneGraph s point PolygonEdgeType PolygonFaceData
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span class="annot"><span class="annottext">Indexed (FaceId s) () (Identity PolygonFaceData)
-&gt; CPlaneGraph s point PolygonEdgeType ()
-&gt; Identity (CPlaneGraph s point PolygonEdgeType PolygonFaceData)
Indexed
  (FaceId s)
  (Face (CPlaneGraph s point PolygonEdgeType ()))
  (Identity
     (Face (CPlaneGraph s point PolygonEdgeType PolygonFaceData)))
-&gt; CPlaneGraph s point PolygonEdgeType ()
-&gt; Identity (CPlaneGraph s point PolygonEdgeType PolygonFaceData)
forall graph graph'.
HasFaces graph graph' =&gt;
IndexedTraversal1
  (FaceIx graph) graph graph' (Face graph) (Face graph')
IndexedTraversal1
  (FaceIx (CPlaneGraph s point PolygonEdgeType ()))
  (CPlaneGraph s point PolygonEdgeType ())
  (CPlaneGraph s point PolygonEdgeType PolygonFaceData)
  (Face (CPlaneGraph s point PolygonEdgeType ()))
  (Face (CPlaneGraph s point PolygonEdgeType PolygonFaceData))
</span><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hiraffe-0.1/doc/html/hiraffe/src/Hiraffe.PlanarGraph.Class.html/Hiraffe.PlanarGraph.Class.html#faces"><span class="hs-identifier hs-var">faces</span></a></span><span> </span><span class="annot"><span class="annottext">(Indexed (FaceId s) () (Identity PolygonFaceData)
 -&gt; CPlaneGraph s point PolygonEdgeType ()
 -&gt; Identity (CPlaneGraph s point PolygonEdgeType PolygonFaceData))
-&gt; (FaceId s -&gt; () -&gt; PolygonFaceData)
-&gt; CPlaneGraph s point PolygonEdgeType ()
-&gt; CPlaneGraph s point PolygonEdgeType PolygonFaceData
forall i s t a b.
AnIndexedSetter i s t a b -&gt; (i -&gt; a -&gt; b) -&gt; s -&gt; t
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.1-69c3/lens-5.3.3-ce13621ca90282c7ffe4fce28e3082324aec22dc8cdfa5fe56a4cc94c1bcacc4/share/doc/html/src/Control.Lens.Setter.html/Control.Lens.Setter.html#%25%40~"><span class="hs-operator hs-var">%@~</span></a></span><span> </span><span class="annot"><span class="annottext">FaceId s -&gt; () -&gt; PolygonFaceData
</span><a href="#local-6989586621679538902"><span class="hs-identifier hs-var">computeFaceLabel</span></a></span><span>
</span><span id="line-140"></span><span class="hs-comment">-- constructGraph pg diags = gr&amp;faces %@~ computeFaceLabel</span><span>
</span><span id="line-141"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-comment">-- | Note that we use fromAdjacencyLists</span><span>
</span><span id="line-143"></span><span>    </span><span id="local-6989586621679538898"><span class="annot"><span class="annottext">gr :: CPlaneGraph s point PolygonEdgeType ()
</span><a href="#local-6989586621679538898"><span class="hs-identifier hs-var hs-var">gr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty
  (VertexIdIn 'Primal s, point,
   NonEmpty (VertexIdIn 'Primal s, PolygonEdgeType))
-&gt; CPlaneGraph s point PolygonEdgeType ()
forall graph (f :: * -&gt; *) (h :: * -&gt; *) vi v e.
(ConstructableGraph_ graph, Foldable1 f, Functor f, Foldable h,
 Functor h, vi ~ VertexIx graph, v ~ Vertex graph, e ~ Edge graph,
 GraphFromAdjListExtraConstraints graph h) =&gt;
f (vi, v, h (vi, e)) -&gt; graph
forall (f :: * -&gt; *) (h :: * -&gt; *) vi v e.
(Foldable1 f, Functor f, Foldable h, Functor h,
 vi ~ VertexIx (CPlaneGraph s point PolygonEdgeType ()),
 v ~ Vertex (CPlaneGraph s point PolygonEdgeType ()),
 e ~ Edge (CPlaneGraph s point PolygonEdgeType ()),
 GraphFromAdjListExtraConstraints
   (CPlaneGraph s point PolygonEdgeType ()) h) =&gt;
f (vi, v, h (vi, e)) -&gt; CPlaneGraph s point PolygonEdgeType ()
</span><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hiraffe-0.1/doc/html/hiraffe/src/Hiraffe.Graph.Class.html/Hiraffe.Graph.Class.html#fromAdjacencyLists"><span class="hs-identifier hs-var">fromAdjacencyLists</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty
  (VertexIdIn 'Primal s, point,
   NonEmpty (VertexIdIn 'Primal s, PolygonEdgeType))
</span><a href="#local-6989586621679538904"><span class="hs-identifier hs-var">adjLists</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="HGeometry.PlaneGraph.Connected.Type.html#CPlaneGraph"><span class="hs-identifier hs-type">CPlaneGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538609"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538603"><span class="hs-identifier hs-type">point</span></a></span><span> </span><span class="annot"><a href="HGeometry.Polygon.Triangulation.Types.html#PolygonEdgeType"><span class="hs-identifier hs-type">PolygonEdgeType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span>    </span><span id="local-6989586621679538904"><span class="annot"><span class="annottext">adjLists :: NonEmpty
  (VertexIdIn 'Primal s, point,
   NonEmpty (VertexIdIn 'Primal s, PolygonEdgeType))
</span><a href="#local-6989586621679538904"><span class="hs-identifier hs-var hs-var">adjLists</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Int, (Int, Int))
 -&gt; (point, (point, point))
 -&gt; (VertexIdIn 'Primal s, point,
     NonEmpty (VertexIdIn 'Primal s, PolygonEdgeType)))
-&gt; ((Int, (Int, Int)), (point, (point, point)))
-&gt; (VertexIdIn 'Primal s, point,
    NonEmpty (VertexIdIn 'Primal s, PolygonEdgeType))
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">(Int, (Int, Int))
-&gt; (point, (point, point))
-&gt; (VertexIdIn 'Primal s, point,
    NonEmpty (VertexIdIn 'Primal s, PolygonEdgeType))
(VertexIx polygon, (VertexIx polygon, VertexIx polygon))
-&gt; (point, (point, point))
-&gt; (VertexIdIn 'Primal s, point,
    NonEmpty (VertexIdIn 'Primal s, PolygonEdgeType))
</span><a href="#local-6989586621679538906"><span class="hs-identifier hs-var">collectDiags</span></a></span><span> </span><span class="annot"><span class="annottext">(((Int, (Int, Int)), (point, (point, point)))
 -&gt; (VertexIdIn 'Primal s, point,
     NonEmpty (VertexIdIn 'Primal s, PolygonEdgeType)))
-&gt; NonEmpty ((Int, (Int, Int)), (point, (point, point)))
-&gt; NonEmpty
     (VertexIdIn 'Primal s, point,
      NonEmpty (VertexIdIn 'Primal s, PolygonEdgeType))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IndexedGetting
  (Int, (Int, Int))
  (NonEmptyDList ((Int, (Int, Int)), (point, (point, point))))
  polygon
  (point, (point, point))
-&gt; polygon -&gt; NonEmpty ((Int, (Int, Int)), (point, (point, point)))
forall i a s.
IndexedGetting i (NonEmptyDList (i, a)) s a -&gt; s -&gt; NonEmpty (i, a)
</span><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hgeometry-combinatorial-1.0.0.0/doc/html/hgeometry-combinatorial/src/HGeometry.Lens.Util.html/HGeometry.Lens.Util.html#itoNonEmptyOf"><span class="hs-identifier hs-var">itoNonEmptyOf</span></a></span><span> </span><span class="annot"><span class="annottext">IndexedGetting
  (Int, (Int, Int))
  (NonEmptyDList ((Int, (Int, Int)), (point, (point, point))))
  polygon
  (point, (point, point))
Indexed
  (Int, (Int, Int))
  (Vertex polygon, (Vertex polygon, Vertex polygon))
  (Const
     (NonEmptyDList ((Int, (Int, Int)), (point, (point, point))))
     (Vertex polygon, (Vertex polygon, Vertex polygon)))
-&gt; polygon
-&gt; Const
     (NonEmptyDList ((Int, (Int, Int)), (point, (point, point))))
     polygon
forall polygon.
(HasOuterBoundary polygon, VertexIx polygon ~ Int) =&gt;
IndexedFold1
  (VertexIx polygon, (VertexIx polygon, VertexIx polygon))
  polygon
  (Vertex polygon, (Vertex polygon, Vertex polygon))
IndexedFold1
  (VertexIx polygon, (VertexIx polygon, VertexIx polygon))
  polygon
  (Vertex polygon, (Vertex polygon, Vertex polygon))
</span><a href="HGeometry.Polygon.Class.html#outerBoundaryWithNeighbours"><span class="hs-identifier hs-var">outerBoundaryWithNeighbours</span></a></span><span> </span><span class="annot"><span class="annottext">polygon
</span><a href="#local-6989586621679538896"><span class="hs-identifier hs-var">pg</span></a></span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span>    </span><span class="annot"><a href="#local-6989586621679538906"><span class="hs-identifier hs-type">collectDiags</span></a></span><span>                  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hiraffe-0.1/doc/html/hiraffe/src/Hiraffe.Graph.Class.html/Hiraffe.Graph.Class.html#VertexIx"><span class="hs-identifier hs-type">VertexIx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538602"><span class="hs-identifier hs-type">polygon</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hiraffe-0.1/doc/html/hiraffe/src/Hiraffe.Graph.Class.html/Hiraffe.Graph.Class.html#VertexIx"><span class="hs-identifier hs-type">VertexIx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538602"><span class="hs-identifier hs-type">polygon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hiraffe-0.1/doc/html/hiraffe/src/Hiraffe.Graph.Class.html/Hiraffe.Graph.Class.html#VertexIx"><span class="hs-identifier hs-type">VertexIx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538602"><span class="hs-identifier hs-type">polygon</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>                                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679538603"><span class="hs-identifier hs-type">point</span></a></span><span class="hs-special">,</span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679538603"><span class="hs-identifier hs-type">point</span></a></span><span class="hs-special">,</span><span>            </span><span class="annot"><a href="#local-6989586621679538603"><span class="hs-identifier hs-type">point</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>                                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hiraffe-0.1/doc/html/hiraffe/src/Hiraffe.PlanarGraph.Connected.Core.html/Hiraffe.PlanarGraph.Connected.Core.html#VertexIdIn"><span class="hs-identifier hs-type">VertexIdIn</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hiraffe-0.1/doc/html/hiraffe/src/Hiraffe.PlanarGraph.World.html/Hiraffe.PlanarGraph.World.html#Primal"><span class="hs-identifier hs-type">Primal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538609"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-150"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679538603"><span class="hs-identifier hs-type">point</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hiraffe-0.1/doc/html/hiraffe/src/Hiraffe.PlanarGraph.Connected.Core.html/Hiraffe.PlanarGraph.Connected.Core.html#VertexIdIn"><span class="hs-identifier hs-type">VertexIdIn</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hiraffe-0.1/doc/html/hiraffe/src/Hiraffe.PlanarGraph.World.html/Hiraffe.PlanarGraph.World.html#Primal"><span class="hs-identifier hs-type">Primal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538609"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span class="annot"><a href="HGeometry.Polygon.Triangulation.Types.html#PolygonEdgeType"><span class="hs-identifier hs-type">PolygonEdgeType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>                                     </span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>    </span><span id="local-6989586621679538906"><span class="annot"><span class="annottext">collectDiags :: (VertexIx polygon, (VertexIx polygon, VertexIx polygon))
-&gt; (point, (point, point))
-&gt; (VertexIdIn 'Primal s, point,
    NonEmpty (VertexIdIn 'Primal s, PolygonEdgeType))
</span><a href="#local-6989586621679538906"><span class="hs-identifier hs-var hs-var">collectDiags</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679538910"><span class="annot"><span class="annottext">VertexIx polygon
</span><a href="#local-6989586621679538910"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679538911"><span class="annot"><span class="annottext">VertexIx polygon
</span><a href="#local-6989586621679538911"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679538912"><span class="annot"><span class="annottext">VertexIx polygon
</span><a href="#local-6989586621679538912"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679538913"><span class="annot"><span class="annottext">point
</span><a href="#local-6989586621679538913"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">(point, point)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int, point, NonEmpty (Int, PolygonEdgeType))
-&gt; (VertexIdIn 'Primal s, point,
    NonEmpty (VertexIdIn 'Primal s, PolygonEdgeType))
forall a b. Coercible a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">coerce</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
VertexIx polygon
</span><a href="#local-6989586621679538910"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">point
</span><a href="#local-6989586621679538913"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
VertexIx polygon
</span><a href="#local-6989586621679538911"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PolygonEdgeType
</span><a href="HGeometry.Polygon.Triangulation.Types.html#Original"><span class="hs-identifier hs-var">Original</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int, PolygonEdgeType)
-&gt; [(Int, PolygonEdgeType)] -&gt; NonEmpty (Int, PolygonEdgeType)
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
VertexIx polygon
</span><a href="#local-6989586621679538912"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PolygonEdgeType
</span><a href="HGeometry.Polygon.Triangulation.Types.html#Original"><span class="hs-identifier hs-var">Original</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int, PolygonEdgeType)
-&gt; [(Int, PolygonEdgeType)] -&gt; [(Int, PolygonEdgeType)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [(Int, PolygonEdgeType)]
</span><a href="#local-6989586621679538915"><span class="hs-identifier hs-var">diagonalsOf</span></a></span><span> </span><span class="annot"><span class="annottext">Int
VertexIx polygon
</span><a href="#local-6989586621679538910"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-comment">-- get the diagonals incident to vertex u</span><span>
</span><span id="line-155"></span><span>    </span><span id="local-6989586621679538915"><span class="annot"><span class="annottext">diagonalsOf :: Int -&gt; [(Int, PolygonEdgeType)]
</span><a href="#local-6989586621679538915"><span class="hs-identifier hs-var hs-var">diagonalsOf</span></a></span></span><span> </span><span id="local-6989586621679538916"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679538916"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Int, PolygonEdgeType)]
-&gt; Maybe [(Int, PolygonEdgeType)] -&gt; [(Int, PolygonEdgeType)]
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Maybe [(Int, PolygonEdgeType)] -&gt; [(Int, PolygonEdgeType)])
-&gt; Maybe [(Int, PolygonEdgeType)] -&gt; [(Int, PolygonEdgeType)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Map Int [(Int, PolygonEdgeType)]
-&gt; Maybe [(Int, PolygonEdgeType)]
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679538916"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int [(Int, PolygonEdgeType)]
Map (VertexIx polygon) [(VertexIx polygon, PolygonEdgeType)]
</span><a href="#local-6989586621679538918"><span class="hs-identifier hs-var">diags'</span></a></span><span>
</span><span id="line-156"></span><span>    </span><span class="hs-comment">-- associate every diagonal with its endpoints</span><span>
</span><span id="line-157"></span><span>    </span><span class="annot"><a href="#local-6989586621679538918"><span class="hs-identifier hs-type">diags'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hiraffe-0.1/doc/html/hiraffe/src/Hiraffe.Graph.Class.html/Hiraffe.Graph.Class.html#VertexIx"><span class="hs-identifier hs-type">VertexIx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538602"><span class="hs-identifier hs-type">polygon</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/hgeometry/hgeometry/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hiraffe-0.1/doc/html/hiraffe/src/Hiraffe.Graph.Class.html/Hiraffe.Graph.Class.html#VertexIx"><span class="hs-identifier hs-type">VertexIx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538602"><span class="hs-identifier hs-type">polygon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="HGeometry.Polygon.Triangulation.Types.html#PolygonEdgeType"><span class="hs-identifier hs-type">PolygonEdgeType</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-158"></span><span>    </span><span id="local-6989586621679538918"><span class="annot"><span class="annottext">diags' :: Map (VertexIx polygon) [(VertexIx polygon, PolygonEdgeType)]
</span><a href="#local-6989586621679538918"><span class="hs-identifier hs-var hs-var">diags'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Vector 2 Int
 -&gt; Map Int [(Int, PolygonEdgeType)]
 -&gt; Map Int [(Int, PolygonEdgeType)])
-&gt; Map Int [(Int, PolygonEdgeType)]
-&gt; f (Vector 2 Int)
-&gt; Map Int [(Int, PolygonEdgeType)]
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; f a -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Vector2</span></span><span> </span><span id="local-6989586621679538921"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679538921"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621679538922"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679538922"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([(Int, PolygonEdgeType)]
 -&gt; [(Int, PolygonEdgeType)] -&gt; [(Int, PolygonEdgeType)])
-&gt; Int
-&gt; [(Int, PolygonEdgeType)]
-&gt; Map Int [(Int, PolygonEdgeType)]
-&gt; Map Int [(Int, PolygonEdgeType)]
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insertWith</span></span><span> </span><span class="annot"><span class="annottext">[(Int, PolygonEdgeType)]
-&gt; [(Int, PolygonEdgeType)] -&gt; [(Int, PolygonEdgeType)]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679538921"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679538922"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PolygonEdgeType
</span><a href="HGeometry.Polygon.Triangulation.Types.html#Diagonal"><span class="hs-identifier hs-var">Diagonal</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-159"></span><span>                                    </span><span class="annot"><span class="annottext">(Map Int [(Int, PolygonEdgeType)]
 -&gt; Map Int [(Int, PolygonEdgeType)])
-&gt; (Map Int [(Int, PolygonEdgeType)]
    -&gt; Map Int [(Int, PolygonEdgeType)])
-&gt; Map Int [(Int, PolygonEdgeType)]
-&gt; Map Int [(Int, PolygonEdgeType)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">([(Int, PolygonEdgeType)]
 -&gt; [(Int, PolygonEdgeType)] -&gt; [(Int, PolygonEdgeType)])
-&gt; Int
-&gt; [(Int, PolygonEdgeType)]
-&gt; Map Int [(Int, PolygonEdgeType)]
-&gt; Map Int [(Int, PolygonEdgeType)]
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insertWith</span></span><span> </span><span class="annot"><span class="annottext">[(Int, PolygonEdgeType)]
-&gt; [(Int, PolygonEdgeType)] -&gt; [(Int, PolygonEdgeType)]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679538922"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679538921"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PolygonEdgeType
</span><a href="HGeometry.Polygon.Triangulation.Types.html#Diagonal"><span class="hs-identifier hs-var">Diagonal</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-160"></span><span>                   </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Int [(Int, PolygonEdgeType)]
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span> </span><span class="annot"><span class="annottext">f (Vector 2 Int)
f (Diagonal polygon)
</span><a href="#local-6989586621679538897"><span class="hs-identifier hs-var">diags</span></a></span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span>    </span><span id="local-6989586621679538926"><span class="annot"><span class="annottext">theOuterFaceId :: FaceIx (CPlaneGraph s point PolygonEdgeType ())
</span><a href="#local-6989586621679538926"><span class="hs-identifier hs-var hs-var">theOuterFaceId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CPlaneGraph s point PolygonEdgeType ()
-&gt; FaceIx (CPlaneGraph s point PolygonEdgeType ())
forall planeGraph vertex.
PlaneGraph_ planeGraph vertex =&gt;
planeGraph -&gt; FaceIx planeGraph
</span><a href="HGeometry.PlaneGraph.Class.html#outerFaceId"><span class="hs-identifier hs-var">outerFaceId</span></a></span><span> </span><span class="annot"><span class="annottext">CPlaneGraph s point PolygonEdgeType ()
</span><a href="#local-6989586621679538898"><span class="hs-identifier hs-var">gr</span></a></span><span>
</span><span id="line-163"></span><span>    </span><span id="local-6989586621679538902"><span class="annot"><span class="annottext">computeFaceLabel :: FaceId s -&gt; () -&gt; PolygonFaceData
</span><a href="#local-6989586621679538902"><span class="hs-identifier hs-var hs-var">computeFaceLabel</span></a></span></span><span> </span><span id="local-6989586621679538928"><span class="annot"><span class="annottext">FaceId s
</span><a href="#local-6989586621679538928"><span class="hs-identifier hs-var">fi</span></a></span></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-164"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">FaceId s
</span><a href="#local-6989586621679538928"><span class="hs-identifier hs-var">fi</span></a></span><span> </span><span class="annot"><span class="annottext">FaceId s -&gt; FaceId s -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">FaceId s
FaceIx (CPlaneGraph s point PolygonEdgeType ())
</span><a href="#local-6989586621679538926"><span class="hs-identifier hs-var">theOuterFaceId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PolygonFaceData
</span><a href="HGeometry.Polygon.Triangulation.Types.html#Outside"><span class="hs-identifier hs-var">Outside</span></a></span><span>
</span><span id="line-165"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PolygonFaceData
</span><a href="HGeometry.Polygon.Triangulation.Types.html#Inside"><span class="hs-identifier hs-var">Inside</span></a></span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span class="hs-comment">-- -constructSubdivision px e origs diags =</span><span>
</span><span id="line-170"></span><span class="hs-comment">-- -    subdiv &amp; planeGraph.PG.vertexData.traverse        %~ NonEmpty.head</span><span>
</span><span id="line-171"></span><span class="hs-comment">-- -           &amp; planeGraph.PG.faceData                   .~ faceData'</span><span>
</span><span id="line-172"></span><span class="hs-comment">-- -           &amp; planeGraph.PG.rawDartData.traverse.eData %~ snd</span><span>
</span><span id="line-173"></span><span class="hs-comment">-- -  where</span><span>
</span><span id="line-174"></span><span class="hs-comment">-- -    subdiv = fromConnectedSegments px $ e' : origs' &lt;&gt; diags'</span><span>
</span><span id="line-175"></span><span class="hs-comment">-- -</span><span>
</span><span id="line-176"></span><span class="hs-comment">-- -    diags' = (:+ EdgeData Visible (True, Diagonal)) &lt;$&gt; diags</span><span>
</span><span id="line-177"></span><span class="hs-comment">-- -    origs' = (:+ EdgeData Visible (False,Original)) &lt;$&gt; origs</span><span>
</span><span id="line-178"></span><span class="hs-comment">-- -    e'     = e :+ EdgeData Visible (True, Original)</span><span>
</span><span id="line-179"></span><span class="hs-comment">-- -</span><span>
</span><span id="line-180"></span><span class="hs-comment">-- -    g = subdiv^.planeGraph</span><span>
</span><span id="line-181"></span><span class="hs-comment">-- -</span><span>
</span><span id="line-182"></span><span class="hs-comment">-- -    -- the darts incident to internal faces</span><span>
</span><span id="line-183"></span><span class="hs-comment">-- -    queryDarts = concatMap shouldQuery . F.toList . PG.edges' $ g</span><span>
</span><span id="line-184"></span><span class="hs-comment">-- -    shouldQuery d = case g^.dataOf d.eData of</span><span>
</span><span id="line-185"></span><span class="hs-comment">-- -                      (True, Original) -&gt; [d]</span><span>
</span><span id="line-186"></span><span class="hs-comment">-- -                      (True, Diagonal) -&gt; [d, twin d]</span><span>
</span><span id="line-187"></span><span class="hs-comment">-- -                      _                -&gt; []</span><span>
</span><span id="line-188"></span><span class="hs-comment">-- -</span><span>
</span><span id="line-189"></span><span class="hs-comment">-- -    -- the interior faces</span><span>
</span><span id="line-190"></span><span class="hs-comment">-- -    intFaces = flip PG.leftFace g &lt;$&gt; queryDarts</span><span>
</span><span id="line-191"></span><span class="hs-comment">-- -    faceData' = V.create $ do</span><span>
</span><span id="line-192"></span><span class="hs-comment">-- -                  v' &lt;- MV.replicate (PG.numFaces g) (FaceData [] Outside)</span><span>
</span><span id="line-193"></span><span class="hs-comment">-- -                  forM_ intFaces $ \(PG.FaceId (PG.VertexId f)) -&gt;</span><span>
</span><span id="line-194"></span><span class="hs-comment">-- -                    MV.write v' f (FaceData [] Inside)</span><span>
</span><span id="line-195"></span><span class="hs-comment">-- -                  pure v'</span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-199"></span></pre></body></html>