<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP, ForeignFunctionInterface #-}</span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &gt;= 709
</span><span class="hs-pragma">{-# LANGUAGE Safe #-}</span><span class="hs-cpp">
#else
</span><span class="hs-pragma">{-# LANGUAGE Trustworthy #-}</span><span class="hs-cpp">
#endif
</span><span class="hs-pragma">{-# LANGUAGE InterruptibleFFI #-}</span><span class="hs-cpp">

#include &lt;ghcplatform.h&gt;
</span><span class="hs-cpp">
#if defined(javascript_HOST_ARCH)
</span><span class="hs-pragma">{-# LANGUAGE JavaScriptFFI #-}</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-15"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-17"></span><span class="hs-comment">-- Module      :  System.Process</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- Copyright   :  (c) The University of Glasgow 2004-2008</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- License     :  BSD-style (see the file libraries/base/LICENSE)</span><span>
</span><span id="line-20"></span><span class="hs-comment">--</span><span>
</span><span id="line-21"></span><span class="hs-comment">-- Maintainer  :  libraries@haskell.org</span><span>
</span><span id="line-22"></span><span class="hs-comment">-- Stability   :  experimental</span><span>
</span><span id="line-23"></span><span class="hs-comment">-- Portability :  non-portable (requires concurrency)</span><span>
</span><span id="line-24"></span><span class="hs-comment">--</span><span>
</span><span id="line-25"></span><span class="hs-comment">-- Operations for creating and interacting with sub-processes.</span><span>
</span><span id="line-26"></span><span class="hs-comment">--</span><span>
</span><span id="line-27"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-comment">-- TODO:</span><span>
</span><span id="line-30"></span><span class="hs-comment">--      * Flag to control whether exiting the parent also kills the child.</span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="System.Process.html"><span class="hs-identifier">System.Process</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-33"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Running sub-processes</span></span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><a href="System.Process.html#createProcess"><span class="hs-identifier">createProcess</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>    </span><span class="annot"><a href="System.Process.Internals.html#createProcess_"><span class="hs-identifier">createProcess_</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>    </span><span class="annot"><a href="System.Process.html#shell"><span class="hs-identifier">shell</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Process.html#proc"><span class="hs-identifier">proc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>    </span><span class="annot"><a href="System.Process.Common.html#CreateProcess"><span class="hs-identifier">CreateProcess</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>    </span><span class="annot"><a href="System.Process.Common.html#CmdSpec"><span class="hs-identifier">CmdSpec</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>    </span><span class="annot"><a href="System.Process.Common.html#StdStream"><span class="hs-identifier">StdStream</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>    </span><span class="annot"><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier">ProcessHandle</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Simpler functions for common tasks</span></span><span>
</span><span id="line-43"></span><span>    </span><span class="annot"><a href="System.Process.html#callProcess"><span class="hs-identifier">callProcess</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>    </span><span class="annot"><a href="System.Process.html#callCommand"><span class="hs-identifier">callCommand</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>    </span><span class="annot"><a href="System.Process.html#spawnProcess"><span class="hs-identifier">spawnProcess</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>    </span><span class="annot"><a href="System.Process.html#spawnCommand"><span class="hs-identifier">spawnCommand</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>    </span><span class="annot"><a href="System.Process.html#readCreateProcess"><span class="hs-identifier">readCreateProcess</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>    </span><span class="annot"><a href="System.Process.html#readProcess"><span class="hs-identifier">readProcess</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>    </span><span class="annot"><a href="System.Process.html#readCreateProcessWithExitCode"><span class="hs-identifier">readCreateProcessWithExitCode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>    </span><span class="annot"><a href="System.Process.html#readProcessWithExitCode"><span class="hs-identifier">readProcessWithExitCode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>    </span><span class="annot"><a href="System.Process.html#withCreateProcess"><span class="hs-identifier">withCreateProcess</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>    </span><span class="annot"><a href="System.Process.html#cleanupProcess"><span class="hs-identifier">cleanupProcess</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Related utilities</span></span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><a href="System.Process.html#showCommandForUser"><span class="hs-identifier">showCommandForUser</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>    </span><span class="annot"><a href="System.Process.html#Pid"><span class="hs-identifier">Pid</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>    </span><span class="annot"><a href="System.Process.html#getPid"><span class="hs-identifier">getPid</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>    </span><span class="annot"><a href="System.Process.html#getCurrentPid"><span class="hs-identifier">getCurrentPid</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Secure process creation on Windows</span></span><span>
</span><span id="line-61"></span><span>    </span><span class="annot"><span class="hs-comment">-- $windows-mitigations</span></span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Control-C handling on Unix</span></span><span>
</span><span id="line-64"></span><span>    </span><span class="annot"><span class="hs-comment">-- $ctlc-handling</span></span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Process completion</span></span><span>
</span><span id="line-67"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Notes about @exec@ on Windows</span></span><span>
</span><span id="line-68"></span><span>    </span><span class="annot"><span class="hs-comment">-- $exec-on-windows</span></span><span>
</span><span id="line-69"></span><span>    </span><span class="annot"><a href="System.Process.html#waitForProcess"><span class="hs-identifier">waitForProcess</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><a href="System.Process.html#getProcessExitCode"><span class="hs-identifier">getProcessExitCode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>    </span><span class="annot"><a href="System.Process.html#terminateProcess"><span class="hs-identifier">terminateProcess</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-72"></span><span>    </span><span class="annot"><a href="System.Process.Internals.html#interruptProcessGroupOf"><span class="hs-identifier">interruptProcessGroupOf</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Interprocess communication</span></span><span>
</span><span id="line-75"></span><span>    </span><span class="annot"><a href="System.Process.Internals.html#createPipe"><span class="hs-identifier">createPipe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-76"></span><span>    </span><span class="annot"><a href="System.Process.Internals.html#createPipeFd"><span class="hs-identifier">createPipeFd</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Old deprecated functions</span></span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-comment">-- | These functions pre-date 'createProcess' which is much more</span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-comment">-- flexible.</span><span>
</span><span id="line-81"></span><span>    </span><span class="annot"><a href="System.Process.html#runProcess"><span class="hs-identifier">runProcess</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-82"></span><span>    </span><span class="annot"><a href="System.Process.html#runCommand"><span class="hs-identifier">runCommand</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-83"></span><span>    </span><span class="annot"><a href="System.Process.html#runInteractiveProcess"><span class="hs-identifier">runInteractiveProcess</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-84"></span><span>    </span><span class="annot"><a href="System.Process.html#runInteractiveCommand"><span class="hs-identifier">runInteractiveCommand</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-85"></span><span>    </span><span class="annot"><a href="System.Process.html#system"><span class="hs-identifier">system</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-86"></span><span>    </span><span class="annot"><a href="System.Process.html#rawSystem"><span class="hs-identifier">rawSystem</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-87"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Prelude.html"><span class="hs-identifier">Prelude</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mapM</span></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="System.Process.Internals.html"><span class="hs-identifier">System.Process.Internals</span></a></span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Concurrent.html"><span class="hs-identifier">Control.Concurrent</span></a></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../deepseq-1.5.1.0-6837/src/Control.DeepSeq.html"><span class="hs-identifier">Control.DeepSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../deepseq-1.5.1.0-6837/src/Control.DeepSeq.html#rnf"><span class="hs-identifier">rnf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Exception.html"><span class="hs-identifier">Control.Exception</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-cpp">
#if !defined(javascript_HOST_ARCH)
</span><span>                           </span><span class="annot"><span class="hs-identifier">allowInterrupt</span></span><span class="hs-special">,</span><span class="hs-cpp">
#endif
</span><span>                           </span><span class="annot"><span class="hs-identifier">bracket</span></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Exception.html"><span class="hs-identifier">Control.Exception</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Foreign.html"><span class="hs-identifier">Foreign</span></a></span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Foreign.C.html"><span class="hs-identifier">Foreign.C</span></a></span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/System.Exit.html"><span class="hs-identifier">System.Exit</span></a></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">ExitCode</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/System.IO.html"><span class="hs-identifier">System.IO</span></a></span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/System.IO.Error.html"><span class="hs-identifier">System.IO.Error</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mkIOError</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ioeSetErrorString</span></span><span class="hs-special">)</span><span class="hs-cpp">

#if defined(javascript_HOST_ARCH)
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.Process.JavaScript</span><span class="hs-special">(</span><span class="hs-identifier">getProcessId</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">getCurrentProcessId</span><span class="hs-special">)</span><span class="hs-cpp">
#elif defined(mingw32_HOST_OS)
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.Win32.Process</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">getProcessId</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">getCurrentProcessId</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ProcessId</span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../unix-2.8.6.0-c07b/src/System.Posix.Process.html"><span class="hs-identifier">System.Posix.Process</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../unix-2.8.6.0-c07b/src/System.Posix.Process.Common.html#getProcessID"><span class="hs-identifier">getProcessID</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/System.Posix.Types.html"><span class="hs-identifier">System.Posix.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">CPid</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-118"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/GHC.IO.Exception.html"><span class="hs-identifier">GHC.IO.Exception</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">ioException</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">IOErrorType</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span class="hs-cpp">

#if defined(wasm32_HOST_ARCH)
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.IO.Exception</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">unsupportedOperation</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.IO.Error</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-125"></span><span class="hs-comment">-- | The platform specific type for a process identifier.</span><span>
</span><span id="line-126"></span><span class="hs-comment">--</span><span>
</span><span id="line-127"></span><span class="hs-comment">-- This is always an integral type. Width and signedness are platform specific.</span><span>
</span><span id="line-128"></span><span class="hs-comment">--</span><span>
</span><span id="line-129"></span><span class="hs-comment">-- @since 1.6.3.0</span><span class="hs-cpp">
#if defined(javascript_HOST_ARCH)
</span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">Pid</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Int</span><span class="hs-cpp">
#elif defined(mingw32_HOST_OS)
</span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">Pid</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ProcessId</span><span class="hs-cpp">
#else
</span><span class="hs-keyword">type</span><span> </span><span id="Pid"><span class="annot"><a href="System.Process.html#Pid"><span class="hs-identifier hs-var">Pid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CPid</span></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-138"></span><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><span id="line-139"></span><span class="hs-comment">-- createProcess</span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span class="hs-comment">-- | Construct a 'CreateProcess' record for passing to 'createProcess',</span><span>
</span><span id="line-142"></span><span class="hs-comment">-- representing a raw command with arguments.</span><span>
</span><span id="line-143"></span><span class="hs-comment">--</span><span>
</span><span id="line-144"></span><span class="hs-comment">-- See 'RawCommand' for precise semantics of the specified @FilePath@.</span><span>
</span><span id="line-145"></span><span class="annot"><a href="System.Process.html#proc"><span class="hs-identifier hs-type">proc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="System.Process.Common.html#CreateProcess"><span class="hs-identifier hs-type">CreateProcess</span></a></span><span>
</span><span id="line-146"></span><span id="proc"><span class="annot"><span class="annottext">proc :: String -&gt; [String] -&gt; CreateProcess
</span><a href="System.Process.html#proc"><span class="hs-identifier hs-var hs-var">proc</span></a></span></span><span> </span><span id="local-6989586621679056789"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056789"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span id="local-6989586621679056790"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679056790"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="System.Process.Common.html#CreateProcess"><span class="hs-identifier hs-type">CreateProcess</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cmdspec :: CmdSpec
</span><a href="System.Process.Common.html#cmdspec"><span class="hs-identifier hs-var">cmdspec</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; CmdSpec
</span><a href="System.Process.Common.html#RawCommand"><span class="hs-identifier hs-var">RawCommand</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056789"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679056790"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-147"></span><span>                                </span><span class="annot"><span class="annottext">cwd :: Maybe String
</span><a href="System.Process.Common.html#cwd"><span class="hs-identifier hs-var">cwd</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-148"></span><span>                                </span><span class="annot"><span class="annottext">env :: Maybe [(String, String)]
</span><a href="System.Process.Common.html#env"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe [(String, String)]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-149"></span><span>                                </span><span class="annot"><span class="annottext">std_in :: StdStream
</span><a href="System.Process.Common.html#std_in"><span class="hs-identifier hs-var">std_in</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StdStream
</span><a href="System.Process.Common.html#Inherit"><span class="hs-identifier hs-var">Inherit</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-150"></span><span>                                </span><span class="annot"><span class="annottext">std_out :: StdStream
</span><a href="System.Process.Common.html#std_out"><span class="hs-identifier hs-var">std_out</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StdStream
</span><a href="System.Process.Common.html#Inherit"><span class="hs-identifier hs-var">Inherit</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-151"></span><span>                                </span><span class="annot"><span class="annottext">std_err :: StdStream
</span><a href="System.Process.Common.html#std_err"><span class="hs-identifier hs-var">std_err</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StdStream
</span><a href="System.Process.Common.html#Inherit"><span class="hs-identifier hs-var">Inherit</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-152"></span><span>                                </span><span class="annot"><span class="annottext">close_fds :: Bool
</span><a href="System.Process.Common.html#close_fds"><span class="hs-identifier hs-var">close_fds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span>
</span><span id="line-153"></span><span>                                </span><span class="annot"><span class="annottext">create_group :: Bool
</span><a href="System.Process.Common.html#create_group"><span class="hs-identifier hs-var">create_group</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span>
</span><span id="line-154"></span><span>                                </span><span class="annot"><span class="annottext">delegate_ctlc :: Bool
</span><a href="System.Process.Common.html#delegate_ctlc"><span class="hs-identifier hs-var">delegate_ctlc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span>
</span><span id="line-155"></span><span>                                </span><span class="annot"><span class="annottext">detach_console :: Bool
</span><a href="System.Process.Common.html#detach_console"><span class="hs-identifier hs-var">detach_console</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span>
</span><span id="line-156"></span><span>                                </span><span class="annot"><span class="annottext">create_new_console :: Bool
</span><a href="System.Process.Common.html#create_new_console"><span class="hs-identifier hs-var">create_new_console</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span>
</span><span id="line-157"></span><span>                                </span><span class="annot"><span class="annottext">new_session :: Bool
</span><a href="System.Process.Common.html#new_session"><span class="hs-identifier hs-var">new_session</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span>
</span><span id="line-158"></span><span>                                </span><span class="annot"><span class="annottext">child_group :: Maybe GroupID
</span><a href="System.Process.Common.html#child_group"><span class="hs-identifier hs-var">child_group</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe GroupID
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-159"></span><span>                                </span><span class="annot"><span class="annottext">child_user :: Maybe UserID
</span><a href="System.Process.Common.html#child_user"><span class="hs-identifier hs-var">child_user</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe UserID
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-160"></span><span>                                </span><span class="annot"><span class="annottext">use_process_jobs :: Bool
</span><a href="System.Process.Common.html#use_process_jobs"><span class="hs-identifier hs-var">use_process_jobs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span class="hs-comment">-- | Construct a 'CreateProcess' record for passing to 'createProcess',</span><span>
</span><span id="line-163"></span><span class="hs-comment">-- representing a command to be passed to the shell.</span><span>
</span><span id="line-164"></span><span class="annot"><a href="System.Process.html#shell"><span class="hs-identifier hs-type">shell</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="System.Process.Common.html#CreateProcess"><span class="hs-identifier hs-type">CreateProcess</span></a></span><span>
</span><span id="line-165"></span><span id="shell"><span class="annot"><span class="annottext">shell :: String -&gt; CreateProcess
</span><a href="System.Process.html#shell"><span class="hs-identifier hs-var hs-var">shell</span></a></span></span><span> </span><span id="local-6989586621679056807"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056807"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="System.Process.Common.html#CreateProcess"><span class="hs-identifier hs-type">CreateProcess</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cmdspec :: CmdSpec
</span><a href="System.Process.Common.html#cmdspec"><span class="hs-identifier hs-var">cmdspec</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; CmdSpec
</span><a href="System.Process.Common.html#ShellCommand"><span class="hs-identifier hs-var">ShellCommand</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056807"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-166"></span><span>                            </span><span class="annot"><span class="annottext">cwd :: Maybe String
</span><a href="System.Process.Common.html#cwd"><span class="hs-identifier hs-var">cwd</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-167"></span><span>                            </span><span class="annot"><span class="annottext">env :: Maybe [(String, String)]
</span><a href="System.Process.Common.html#env"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe [(String, String)]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-168"></span><span>                            </span><span class="annot"><span class="annottext">std_in :: StdStream
</span><a href="System.Process.Common.html#std_in"><span class="hs-identifier hs-var">std_in</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StdStream
</span><a href="System.Process.Common.html#Inherit"><span class="hs-identifier hs-var">Inherit</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-169"></span><span>                            </span><span class="annot"><span class="annottext">std_out :: StdStream
</span><a href="System.Process.Common.html#std_out"><span class="hs-identifier hs-var">std_out</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StdStream
</span><a href="System.Process.Common.html#Inherit"><span class="hs-identifier hs-var">Inherit</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-170"></span><span>                            </span><span class="annot"><span class="annottext">std_err :: StdStream
</span><a href="System.Process.Common.html#std_err"><span class="hs-identifier hs-var">std_err</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StdStream
</span><a href="System.Process.Common.html#Inherit"><span class="hs-identifier hs-var">Inherit</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-171"></span><span>                            </span><span class="annot"><span class="annottext">close_fds :: Bool
</span><a href="System.Process.Common.html#close_fds"><span class="hs-identifier hs-var">close_fds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span>
</span><span id="line-172"></span><span>                            </span><span class="annot"><span class="annottext">create_group :: Bool
</span><a href="System.Process.Common.html#create_group"><span class="hs-identifier hs-var">create_group</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span>
</span><span id="line-173"></span><span>                            </span><span class="annot"><span class="annottext">delegate_ctlc :: Bool
</span><a href="System.Process.Common.html#delegate_ctlc"><span class="hs-identifier hs-var">delegate_ctlc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span>
</span><span id="line-174"></span><span>                            </span><span class="annot"><span class="annottext">detach_console :: Bool
</span><a href="System.Process.Common.html#detach_console"><span class="hs-identifier hs-var">detach_console</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span>
</span><span id="line-175"></span><span>                            </span><span class="annot"><span class="annottext">create_new_console :: Bool
</span><a href="System.Process.Common.html#create_new_console"><span class="hs-identifier hs-var">create_new_console</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span>
</span><span id="line-176"></span><span>                            </span><span class="annot"><span class="annottext">new_session :: Bool
</span><a href="System.Process.Common.html#new_session"><span class="hs-identifier hs-var">new_session</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span>
</span><span id="line-177"></span><span>                            </span><span class="annot"><span class="annottext">child_group :: Maybe GroupID
</span><a href="System.Process.Common.html#child_group"><span class="hs-identifier hs-var">child_group</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe GroupID
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-178"></span><span>                            </span><span class="annot"><span class="annottext">child_user :: Maybe UserID
</span><a href="System.Process.Common.html#child_user"><span class="hs-identifier hs-var">child_user</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe UserID
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-179"></span><span>                            </span><span class="annot"><span class="annottext">use_process_jobs :: Bool
</span><a href="System.Process.Common.html#use_process_jobs"><span class="hs-identifier hs-var">use_process_jobs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span class="annot"><span class="hs-comment">{- |
This is the most general way to spawn an external process.  The
process can be a command line to be executed by a shell or a raw command
with a list of arguments.  The stdin, stdout, and stderr streams of
the new process may individually be attached to new pipes, to existing
'Handle's, or just inherited from the parent (the default.)

The details of how to create the process are passed in the
'CreateProcess' record.  To make it easier to construct a
'CreateProcess', the functions 'proc' and 'shell' are supplied that
fill in the fields with default values which can be overriden as
needed.

'createProcess' returns @(/mb_stdin_hdl/, /mb_stdout_hdl/, /mb_stderr_hdl/, /ph/)@,
where

 * if @'std_in' == 'CreatePipe'@, then @/mb_stdin_hdl/@ will be @Just /h/@,
   where @/h/@ is the write end of the pipe connected to the child
   process's @stdin@.

 * otherwise, @/mb_stdin_hdl/ == Nothing@

Similarly for @/mb_stdout_hdl/@ and @/mb_stderr_hdl/@.

For example, to execute a simple @ls@ command:

&gt;   r &lt;- createProcess (proc &quot;ls&quot; [])

To create a pipe from which to read the output of @ls@:

&gt;   (_, Just hout, _, _) &lt;-
&gt;       createProcess (proc &quot;ls&quot; []){ std_out = CreatePipe }

To also set the directory in which to run @ls@:

&gt;   (_, Just hout, _, _) &lt;-
&gt;       createProcess (proc &quot;ls&quot; []){ cwd = Just &quot;/home/bob&quot;,
&gt;                                     std_out = CreatePipe }

Note that @Handle@s provided for @std_in@, @std_out@, or @std_err@ via the
@UseHandle@ constructor will be closed by calling this function. This is not
always the desired behavior. In cases where you would like to leave the
@Handle@ open after spawning the child process, please use 'createProcess_'
instead. All created @Handle@s are initially in text mode; if you need them
to be in binary mode then use 'hSetBinaryMode'.

@/ph/@ contains a handle to the running process.  On Windows
'use_process_jobs' can be set in CreateProcess in order to create a
Win32 Job object to monitor a process tree's progress.  If it is set
then that job is also returned inside @/ph/@.  @/ph/@ can be used to
kill all running sub-processes.  This feature has been available since
1.5.0.0.

-}</span></span><span>
</span><span id="line-235"></span><span class="annot"><a href="System.Process.html#createProcess"><span class="hs-identifier hs-type">createProcess</span></a></span><span>
</span><span id="line-236"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.Process.Common.html#CreateProcess"><span class="hs-identifier hs-type">CreateProcess</span></a></span><span>
</span><span id="line-237"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-type">ProcessHandle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span id="createProcess"><span class="annot"><span class="annottext">createProcess :: CreateProcess
-&gt; IO (Maybe Handle, Maybe Handle, Maybe Handle, ProcessHandle)
</span><a href="System.Process.html#createProcess"><span class="hs-identifier hs-var hs-var">createProcess</span></a></span></span><span> </span><span id="local-6989586621679056811"><span class="annot"><span class="annottext">CreateProcess
</span><a href="#local-6989586621679056811"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-239"></span><span>  </span><span id="local-6989586621679056812"><span class="annot"><a href="#local-6989586621679056812"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String
-&gt; CreateProcess
-&gt; IO (Maybe Handle, Maybe Handle, Maybe Handle, ProcessHandle)
</span><a href="System.Process.Internals.html#createProcess_"><span class="hs-identifier hs-var">createProcess_</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;createProcess&quot;</span></span><span> </span><span class="annot"><span class="annottext">CreateProcess
</span><a href="#local-6989586621679056811"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-240"></span><span>  </span><span class="annot"><a href="#local-6989586621679056813"><span class="hs-identifier hs-type">maybeCloseStd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="System.Process.Common.html#std_in"><span class="hs-identifier hs-var">std_in</span></a></span><span>  </span><span class="annot"><a href="#local-6989586621679056811"><span class="hs-identifier hs-type">cp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>  </span><span class="annot"><a href="#local-6989586621679056813"><span class="hs-identifier hs-type">maybeCloseStd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="System.Process.Common.html#std_out"><span class="hs-identifier hs-var">std_out</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056811"><span class="hs-identifier hs-type">cp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>  </span><span class="annot"><a href="#local-6989586621679056813"><span class="hs-identifier hs-type">maybeCloseStd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="System.Process.Common.html#std_err"><span class="hs-identifier hs-var">std_err</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056811"><span class="hs-identifier hs-type">cp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621679056812"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-244"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-245"></span><span>  </span><span class="annot"><a href="#local-6989586621679056813"><span class="hs-identifier hs-type">maybeCloseStd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.Process.Common.html#StdStream"><span class="hs-identifier hs-type">StdStream</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>  </span><span id="local-6989586621679056813"><span class="annot"><span class="annottext">maybeCloseStd :: StdStream -&gt; IO ()
</span><a href="#local-6989586621679056813"><span class="hs-identifier hs-var hs-var">maybeCloseStd</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="System.Process.Common.html#UseHandle"><span class="hs-identifier hs-type">UseHandle</span></a></span><span> </span><span id="local-6989586621679056815"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679056815"><span class="hs-identifier hs-var">hdl</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679056815"><span class="hs-identifier hs-var">hdl</span></a></span><span> </span><span class="annot"><span class="annottext">Handle -&gt; Handle -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><span class="hs-identifier hs-var">stdin</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679056815"><span class="hs-identifier hs-var">hdl</span></a></span><span> </span><span class="annot"><span class="annottext">Handle -&gt; Handle -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><span class="hs-identifier hs-var">stdout</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679056815"><span class="hs-identifier hs-var">hdl</span></a></span><span> </span><span class="annot"><span class="annottext">Handle -&gt; Handle -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><span class="hs-identifier hs-var">stderr</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO ()
</span><span class="hs-identifier hs-var">hClose</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679056815"><span class="hs-identifier hs-var">hdl</span></a></span><span>
</span><span id="line-248"></span><span>  </span><span class="annot"><a href="#local-6989586621679056813"><span class="hs-identifier hs-var">maybeCloseStd</span></a></span><span> </span><span class="annot"><span class="annottext">StdStream
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span class="hs-comment">-- | A 'C.bracket'-style resource handler for 'createProcess'.</span><span>
</span><span id="line-251"></span><span class="hs-comment">--</span><span>
</span><span id="line-252"></span><span class="hs-comment">-- Does automatic cleanup when the action finishes. If there is an exception</span><span>
</span><span id="line-253"></span><span class="hs-comment">-- in the body then it ensures that the process gets terminated and any</span><span>
</span><span id="line-254"></span><span class="hs-comment">-- 'CreatePipe' 'Handle's are closed. In particular this means that if the</span><span>
</span><span id="line-255"></span><span class="hs-comment">-- Haskell thread is killed (e.g. 'killThread'), that the external process is</span><span>
</span><span id="line-256"></span><span class="hs-comment">-- also terminated.</span><span>
</span><span id="line-257"></span><span class="hs-comment">--</span><span>
</span><span id="line-258"></span><span class="hs-comment">-- e.g.</span><span>
</span><span id="line-259"></span><span class="hs-comment">--</span><span>
</span><span id="line-260"></span><span class="hs-comment">-- &gt; withCreateProcess (proc cmd args) { ... }  $ \stdin stdout stderr ph -&gt; do</span><span>
</span><span id="line-261"></span><span class="hs-comment">-- &gt;   ...</span><span>
</span><span id="line-262"></span><span class="hs-comment">--</span><span>
</span><span id="line-263"></span><span class="hs-comment">-- @since 1.4.3.0</span><span>
</span><span id="line-264"></span><span id="local-6989586621679056527"><span class="annot"><a href="System.Process.html#withCreateProcess"><span class="hs-identifier hs-type">withCreateProcess</span></a></span><span>
</span><span id="line-265"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.Process.Common.html#CreateProcess"><span class="hs-identifier hs-type">CreateProcess</span></a></span><span>
</span><span id="line-266"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-type">ProcessHandle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679056527"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-267"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679056527"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-268"></span><span id="withCreateProcess"><span class="annot"><span class="annottext">withCreateProcess :: forall a.
CreateProcess
-&gt; (Maybe Handle
    -&gt; Maybe Handle -&gt; Maybe Handle -&gt; ProcessHandle -&gt; IO a)
-&gt; IO a
</span><a href="System.Process.html#withCreateProcess"><span class="hs-identifier hs-var hs-var">withCreateProcess</span></a></span></span><span> </span><span id="local-6989586621679056823"><span class="annot"><span class="annottext">CreateProcess
</span><a href="#local-6989586621679056823"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679056824"><span class="annot"><span class="annottext">Maybe Handle
-&gt; Maybe Handle -&gt; Maybe Handle -&gt; ProcessHandle -&gt; IO a
</span><a href="#local-6989586621679056824"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-269"></span><span>    </span><span class="annot"><span class="annottext">IO (Maybe Handle, Maybe Handle, Maybe Handle, ProcessHandle)
-&gt; ((Maybe Handle, Maybe Handle, Maybe Handle, ProcessHandle)
    -&gt; IO ())
-&gt; ((Maybe Handle, Maybe Handle, Maybe Handle, ProcessHandle)
    -&gt; IO a)
-&gt; IO a
forall a b c. IO a -&gt; (a -&gt; IO b) -&gt; (a -&gt; IO c) -&gt; IO c
</span><span class="hs-identifier hs-var">C.bracket</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CreateProcess
-&gt; IO (Maybe Handle, Maybe Handle, Maybe Handle, ProcessHandle)
</span><a href="System.Process.html#createProcess"><span class="hs-identifier hs-var">createProcess</span></a></span><span> </span><span class="annot"><span class="annottext">CreateProcess
</span><a href="#local-6989586621679056823"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe Handle, Maybe Handle, Maybe Handle, ProcessHandle) -&gt; IO ()
</span><a href="System.Process.html#cleanupProcess"><span class="hs-identifier hs-var">cleanupProcess</span></a></span><span>
</span><span id="line-270"></span><span>              </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679056825"><span class="annot"><span class="annottext">Maybe Handle
</span><a href="#local-6989586621679056825"><span class="hs-identifier hs-var">m_in</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679056826"><span class="annot"><span class="annottext">Maybe Handle
</span><a href="#local-6989586621679056826"><span class="hs-identifier hs-var">m_out</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679056827"><span class="annot"><span class="annottext">Maybe Handle
</span><a href="#local-6989586621679056827"><span class="hs-identifier hs-var">m_err</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679056828"><span class="annot"><span class="annottext">ProcessHandle
</span><a href="#local-6989586621679056828"><span class="hs-identifier hs-var">ph</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Handle
-&gt; Maybe Handle -&gt; Maybe Handle -&gt; ProcessHandle -&gt; IO a
</span><a href="#local-6989586621679056824"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Handle
</span><a href="#local-6989586621679056825"><span class="hs-identifier hs-var">m_in</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Handle
</span><a href="#local-6989586621679056826"><span class="hs-identifier hs-var">m_out</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Handle
</span><a href="#local-6989586621679056827"><span class="hs-identifier hs-var">m_err</span></a></span><span> </span><span class="annot"><span class="annottext">ProcessHandle
</span><a href="#local-6989586621679056828"><span class="hs-identifier hs-var">ph</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span class="hs-comment">-- wrapper so we can get exceptions with the appropriate function name.</span><span>
</span><span id="line-273"></span><span id="local-6989586621679056532"><span class="annot"><a href="System.Process.html#withCreateProcess_"><span class="hs-identifier hs-type">withCreateProcess_</span></a></span><span>
</span><span id="line-274"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-275"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="System.Process.Common.html#CreateProcess"><span class="hs-identifier hs-type">CreateProcess</span></a></span><span>
</span><span id="line-276"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-type">ProcessHandle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679056532"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679056532"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-278"></span><span id="withCreateProcess_"><span class="annot"><span class="annottext">withCreateProcess_ :: forall a.
String
-&gt; CreateProcess
-&gt; (Maybe Handle
    -&gt; Maybe Handle -&gt; Maybe Handle -&gt; ProcessHandle -&gt; IO a)
-&gt; IO a
</span><a href="System.Process.html#withCreateProcess_"><span class="hs-identifier hs-var hs-var">withCreateProcess_</span></a></span></span><span> </span><span id="local-6989586621679056830"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056830"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621679056831"><span class="annot"><span class="annottext">CreateProcess
</span><a href="#local-6989586621679056831"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679056832"><span class="annot"><span class="annottext">Maybe Handle
-&gt; Maybe Handle -&gt; Maybe Handle -&gt; ProcessHandle -&gt; IO a
</span><a href="#local-6989586621679056832"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-279"></span><span>    </span><span class="annot"><span class="annottext">IO (Maybe Handle, Maybe Handle, Maybe Handle, ProcessHandle)
-&gt; ((Maybe Handle, Maybe Handle, Maybe Handle, ProcessHandle)
    -&gt; IO ())
-&gt; ((Maybe Handle, Maybe Handle, Maybe Handle, ProcessHandle)
    -&gt; IO a)
-&gt; IO a
forall a b c. IO a -&gt; (a -&gt; IO b) -&gt; (a -&gt; IO c) -&gt; IO c
</span><span class="hs-identifier hs-var">C.bracketOnError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
-&gt; CreateProcess
-&gt; IO (Maybe Handle, Maybe Handle, Maybe Handle, ProcessHandle)
</span><a href="System.Process.Internals.html#createProcess_"><span class="hs-identifier hs-var">createProcess_</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056830"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">CreateProcess
</span><a href="#local-6989586621679056831"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe Handle, Maybe Handle, Maybe Handle, ProcessHandle) -&gt; IO ()
</span><a href="System.Process.html#cleanupProcess"><span class="hs-identifier hs-var">cleanupProcess</span></a></span><span>
</span><span id="line-280"></span><span>                     </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679056834"><span class="annot"><span class="annottext">Maybe Handle
</span><a href="#local-6989586621679056834"><span class="hs-identifier hs-var">m_in</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679056835"><span class="annot"><span class="annottext">Maybe Handle
</span><a href="#local-6989586621679056835"><span class="hs-identifier hs-var">m_out</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679056836"><span class="annot"><span class="annottext">Maybe Handle
</span><a href="#local-6989586621679056836"><span class="hs-identifier hs-var">m_err</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679056837"><span class="annot"><span class="annottext">ProcessHandle
</span><a href="#local-6989586621679056837"><span class="hs-identifier hs-var">ph</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Handle
-&gt; Maybe Handle -&gt; Maybe Handle -&gt; ProcessHandle -&gt; IO a
</span><a href="#local-6989586621679056832"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Handle
</span><a href="#local-6989586621679056834"><span class="hs-identifier hs-var">m_in</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Handle
</span><a href="#local-6989586621679056835"><span class="hs-identifier hs-var">m_out</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Handle
</span><a href="#local-6989586621679056836"><span class="hs-identifier hs-var">m_err</span></a></span><span> </span><span class="annot"><span class="annottext">ProcessHandle
</span><a href="#local-6989586621679056837"><span class="hs-identifier hs-var">ph</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span class="hs-comment">-- | Cleans up the process.</span><span>
</span><span id="line-283"></span><span class="hs-comment">--</span><span>
</span><span id="line-284"></span><span class="hs-comment">-- This function is meant to be invoked from any application level cleanup</span><span>
</span><span id="line-285"></span><span class="hs-comment">-- handler. It terminates the process, and closes any 'CreatePipe' 'handle's.</span><span>
</span><span id="line-286"></span><span class="hs-comment">--</span><span>
</span><span id="line-287"></span><span class="hs-comment">-- @since 1.6.4.0</span><span>
</span><span id="line-288"></span><span class="annot"><a href="System.Process.html#cleanupProcess"><span class="hs-identifier hs-type">cleanupProcess</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-type">ProcessHandle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-290"></span><span id="cleanupProcess"><span class="annot"><span class="annottext">cleanupProcess :: (Maybe Handle, Maybe Handle, Maybe Handle, ProcessHandle) -&gt; IO ()
</span><a href="System.Process.html#cleanupProcess"><span class="hs-identifier hs-var hs-var">cleanupProcess</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679056838"><span class="annot"><span class="annottext">Maybe Handle
</span><a href="#local-6989586621679056838"><span class="hs-identifier hs-var">mb_stdin</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679056839"><span class="annot"><span class="annottext">Maybe Handle
</span><a href="#local-6989586621679056839"><span class="hs-identifier hs-var">mb_stdout</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679056840"><span class="annot"><span class="annottext">Maybe Handle
</span><a href="#local-6989586621679056840"><span class="hs-identifier hs-var">mb_stderr</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-291"></span><span>                </span><span id="local-6989586621679056841"><span class="annot"><span class="annottext">ph :: ProcessHandle
</span><a href="#local-6989586621679056841"><span class="hs-identifier hs-var">ph</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-type">ProcessHandle</span></a></span><span> </span><span class="annot"><span class="annottext">MVar ProcessHandle__
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679056843"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679056843"><span class="hs-identifier hs-var">delegating_ctlc</span></a></span></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-292"></span><span>    </span><span class="annot"><span class="annottext">ProcessHandle -&gt; IO ()
</span><a href="System.Process.html#terminateProcess"><span class="hs-identifier hs-var">terminateProcess</span></a></span><span> </span><span class="annot"><span class="annottext">ProcessHandle
</span><a href="#local-6989586621679056841"><span class="hs-identifier hs-var">ph</span></a></span><span>
</span><span id="line-293"></span><span>    </span><span class="hs-comment">-- Note, it's important that other threads that might be reading/writing</span><span>
</span><span id="line-294"></span><span>    </span><span class="hs-comment">-- these handles also get killed off, since otherwise they might be holding</span><span>
</span><span id="line-295"></span><span>    </span><span class="hs-comment">-- the handle lock and prevent us from closing, leading to deadlock.</span><span>
</span><span id="line-296"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; (Handle -&gt; IO ()) -&gt; Maybe Handle -&gt; IO ()
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO () -&gt; IO ()
</span><a href="System.Process.Internals.html#ignoreSigPipe"><span class="hs-identifier hs-var">ignoreSigPipe</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; (Handle -&gt; IO ()) -&gt; Handle -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO ()
</span><span class="hs-identifier hs-var">hClose</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Handle
</span><a href="#local-6989586621679056838"><span class="hs-identifier hs-var">mb_stdin</span></a></span><span>
</span><span id="line-297"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; (Handle -&gt; IO ()) -&gt; Maybe Handle -&gt; IO ()
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO ()
</span><span class="hs-identifier hs-var">hClose</span></span><span> </span><span class="annot"><span class="annottext">Maybe Handle
</span><a href="#local-6989586621679056839"><span class="hs-identifier hs-var">mb_stdout</span></a></span><span>
</span><span id="line-298"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; (Handle -&gt; IO ()) -&gt; Maybe Handle -&gt; IO ()
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO ()
</span><span class="hs-identifier hs-var">hClose</span></span><span> </span><span class="annot"><span class="annottext">Maybe Handle
</span><a href="#local-6989586621679056840"><span class="hs-identifier hs-var">mb_stderr</span></a></span><span>
</span><span id="line-299"></span><span>    </span><span class="hs-comment">-- terminateProcess does not guarantee that it terminates the process.</span><span>
</span><span id="line-300"></span><span>    </span><span class="hs-comment">-- Indeed on Unix it's SIGTERM, which asks nicely but does not guarantee</span><span>
</span><span id="line-301"></span><span>    </span><span class="hs-comment">-- that it stops. If it doesn't stop, we don't want to hang, so we wait</span><span>
</span><span id="line-302"></span><span>    </span><span class="hs-comment">-- asynchronously using forkIO.</span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span>    </span><span class="hs-comment">-- However we want to end the Ctl-C handling synchronously, so we'll do</span><span>
</span><span id="line-305"></span><span>    </span><span class="hs-comment">-- that synchronously, and set delegating_ctlc as False for the</span><span>
</span><span id="line-306"></span><span>    </span><span class="hs-comment">-- waitForProcess (which would otherwise end the Ctl-C delegation itself).</span><span>
</span><span id="line-307"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679056843"><span class="hs-identifier hs-var">delegating_ctlc</span></a></span><span>
</span><span id="line-308"></span><span>      </span><span class="annot"><span class="annottext">IO ()
</span><a href="System.Process.Posix.html#stopDelegateControlC"><span class="hs-identifier hs-var">stopDelegateControlC</span></a></span><span>
</span><span id="line-309"></span><span>    </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO ThreadId
</span><span class="hs-identifier hs-var">forkIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProcessHandle -&gt; IO ExitCode
</span><a href="System.Process.html#waitForProcess"><span class="hs-identifier hs-var">waitForProcess</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProcessHandle -&gt; ProcessHandle
</span><a href="#local-6989586621679056850"><span class="hs-identifier hs-var">resetCtlcDelegation</span></a></span><span> </span><span class="annot"><span class="annottext">ProcessHandle
</span><a href="#local-6989586621679056841"><span class="hs-identifier hs-var">ph</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO ExitCode -&gt; IO () -&gt; IO ()
forall a b. IO a -&gt; IO b -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-311"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-312"></span><span>    </span><span id="local-6989586621679056850"><span class="annot"><span class="annottext">resetCtlcDelegation :: ProcessHandle -&gt; ProcessHandle
</span><a href="#local-6989586621679056850"><span class="hs-identifier hs-var hs-var">resetCtlcDelegation</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-type">ProcessHandle</span></a></span><span> </span><span id="local-6989586621679056851"><span class="annot"><span class="annottext">MVar ProcessHandle__
</span><a href="#local-6989586621679056851"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679056852"><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621679056852"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MVar ProcessHandle__ -&gt; Bool -&gt; MVar () -&gt; ProcessHandle
</span><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-var">ProcessHandle</span></a></span><span> </span><span class="annot"><span class="annottext">MVar ProcessHandle__
</span><a href="#local-6989586621679056851"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621679056852"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><span id="line-315"></span><span class="hs-comment">-- spawnProcess/spawnCommand</span><span>
</span><span id="line-316"></span><span>
</span><span id="line-317"></span><span class="hs-comment">-- | Creates a new process to run the specified raw command with the given</span><span>
</span><span id="line-318"></span><span class="hs-comment">-- arguments. It does not wait for the program to finish, but returns the</span><span>
</span><span id="line-319"></span><span class="hs-comment">-- 'ProcessHandle'.</span><span>
</span><span id="line-320"></span><span class="hs-comment">--</span><span>
</span><span id="line-321"></span><span class="hs-comment">-- @since 1.2.0.0</span><span>
</span><span id="line-322"></span><span class="annot"><a href="System.Process.html#spawnProcess"><span class="hs-identifier hs-type">spawnProcess</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-type">ProcessHandle</span></a></span><span>
</span><span id="line-323"></span><span id="spawnProcess"><span class="annot"><span class="annottext">spawnProcess :: String -&gt; [String] -&gt; IO ProcessHandle
</span><a href="System.Process.html#spawnProcess"><span class="hs-identifier hs-var hs-var">spawnProcess</span></a></span></span><span> </span><span id="local-6989586621679056853"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056853"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span id="local-6989586621679056854"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679056854"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-324"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679056855"><span class="annot"><a href="#local-6989586621679056855"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String
-&gt; CreateProcess
-&gt; IO (Maybe Handle, Maybe Handle, Maybe Handle, ProcessHandle)
</span><a href="System.Process.Internals.html#createProcess_"><span class="hs-identifier hs-var">createProcess_</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;spawnProcess&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; CreateProcess
</span><a href="System.Process.html#proc"><span class="hs-identifier hs-var">proc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056853"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679056854"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-325"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621679056855"><span class="hs-identifier hs-type">p</span></a></span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span class="hs-comment">-- | Creates a new process to run the specified shell command.</span><span>
</span><span id="line-328"></span><span class="hs-comment">-- It does not wait for the program to finish, but returns the 'ProcessHandle'.</span><span>
</span><span id="line-329"></span><span class="hs-comment">--</span><span>
</span><span id="line-330"></span><span class="hs-comment">-- @since 1.2.0.0</span><span>
</span><span id="line-331"></span><span class="annot"><a href="System.Process.html#spawnCommand"><span class="hs-identifier hs-type">spawnCommand</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-type">ProcessHandle</span></a></span><span>
</span><span id="line-332"></span><span id="spawnCommand"><span class="annot"><span class="annottext">spawnCommand :: String -&gt; IO ProcessHandle
</span><a href="System.Process.html#spawnCommand"><span class="hs-identifier hs-var hs-var">spawnCommand</span></a></span></span><span> </span><span id="local-6989586621679056856"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056856"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-333"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679056857"><span class="annot"><a href="#local-6989586621679056857"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String
-&gt; CreateProcess
-&gt; IO (Maybe Handle, Maybe Handle, Maybe Handle, ProcessHandle)
</span><a href="System.Process.Internals.html#createProcess_"><span class="hs-identifier hs-var">createProcess_</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;spawnCommand&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; CreateProcess
</span><a href="System.Process.html#shell"><span class="hs-identifier hs-var">shell</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056856"><span class="hs-identifier hs-var">cmd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621679056857"><span class="hs-identifier hs-type">p</span></a></span><span>
</span><span id="line-335"></span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><span id="line-338"></span><span class="hs-comment">-- callProcess/callCommand</span><span>
</span><span id="line-339"></span><span>
</span><span id="line-340"></span><span class="hs-comment">-- | Creates a new process to run the specified command with the given</span><span>
</span><span id="line-341"></span><span class="hs-comment">-- arguments, and wait for it to finish.  If the command returns a non-zero</span><span>
</span><span id="line-342"></span><span class="hs-comment">-- exit code, an exception is raised.</span><span>
</span><span id="line-343"></span><span class="hs-comment">--</span><span>
</span><span id="line-344"></span><span class="hs-comment">-- If an asynchronous exception is thrown to the thread executing</span><span>
</span><span id="line-345"></span><span class="hs-comment">-- @callProcess@, the forked process will be terminated and</span><span>
</span><span id="line-346"></span><span class="hs-comment">-- @callProcess@ will wait (block) until the process has been</span><span>
</span><span id="line-347"></span><span class="hs-comment">-- terminated.</span><span>
</span><span id="line-348"></span><span class="hs-comment">--</span><span>
</span><span id="line-349"></span><span class="hs-comment">-- @since 1.2.0.0</span><span>
</span><span id="line-350"></span><span class="annot"><a href="System.Process.html#callProcess"><span class="hs-identifier hs-type">callProcess</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-351"></span><span id="callProcess"><span class="annot"><span class="annottext">callProcess :: String -&gt; [String] -&gt; IO ()
</span><a href="System.Process.html#callProcess"><span class="hs-identifier hs-var hs-var">callProcess</span></a></span></span><span> </span><span id="local-6989586621679056858"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056858"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span id="local-6989586621679056859"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679056859"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-352"></span><span>    </span><span id="local-6989586621679056860"><span class="annot"><a href="#local-6989586621679056860"><span class="hs-identifier hs-var">exit_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String
-&gt; CreateProcess
-&gt; (Maybe Handle
    -&gt; Maybe Handle -&gt; Maybe Handle -&gt; ProcessHandle -&gt; IO ExitCode)
-&gt; IO ExitCode
forall a.
String
-&gt; CreateProcess
-&gt; (Maybe Handle
    -&gt; Maybe Handle -&gt; Maybe Handle -&gt; ProcessHandle -&gt; IO a)
-&gt; IO a
</span><a href="System.Process.html#withCreateProcess_"><span class="hs-identifier hs-var">withCreateProcess_</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;callProcess&quot;</span></span><span>
</span><span id="line-353"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; CreateProcess
</span><a href="System.Process.html#proc"><span class="hs-identifier hs-var">proc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056858"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679056859"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="System.Process.Common.html#delegate_ctlc"><span class="hs-identifier hs-var">delegate_ctlc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">((Maybe Handle
  -&gt; Maybe Handle -&gt; Maybe Handle -&gt; ProcessHandle -&gt; IO ExitCode)
 -&gt; IO ExitCode)
-&gt; (Maybe Handle
    -&gt; Maybe Handle -&gt; Maybe Handle -&gt; ProcessHandle -&gt; IO ExitCode)
-&gt; IO ExitCode
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Maybe Handle
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe Handle
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe Handle
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679056861"><span class="annot"><span class="annottext">ProcessHandle
</span><a href="#local-6989586621679056861"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-354"></span><span>                   </span><span class="annot"><span class="annottext">ProcessHandle -&gt; IO ExitCode
</span><a href="System.Process.html#waitForProcess"><span class="hs-identifier hs-var">waitForProcess</span></a></span><span> </span><span class="annot"><span class="annottext">ProcessHandle
</span><a href="#local-6989586621679056861"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-355"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621679056860"><span class="hs-identifier hs-type">exit_code</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-356"></span><span>      </span><span class="annot"><span class="annottext">ExitCode
</span><span class="hs-identifier hs-var">ExitSuccess</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-357"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">ExitFailure</span></span><span> </span><span id="local-6989586621679056864"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679056864"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; [String] -&gt; Int -&gt; IO ()
forall a. String -&gt; String -&gt; [String] -&gt; Int -&gt; IO a
</span><a href="System.Process.html#processFailedException"><span class="hs-identifier hs-var">processFailedException</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;callProcess&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056858"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679056859"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679056864"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-358"></span><span>
</span><span id="line-359"></span><span class="hs-comment">-- | Creates a new process to run the specified shell command.  If the</span><span>
</span><span id="line-360"></span><span class="hs-comment">-- command returns a non-zero exit code, an exception is raised.</span><span>
</span><span id="line-361"></span><span class="hs-comment">--</span><span>
</span><span id="line-362"></span><span class="hs-comment">-- If an asynchronous exception is thrown to the thread executing</span><span>
</span><span id="line-363"></span><span class="hs-comment">-- @callCommand@, the forked process will be terminated and</span><span>
</span><span id="line-364"></span><span class="hs-comment">-- @callCommand@ will wait (block) until the process has been</span><span>
</span><span id="line-365"></span><span class="hs-comment">-- terminated.</span><span>
</span><span id="line-366"></span><span class="hs-comment">--</span><span>
</span><span id="line-367"></span><span class="hs-comment">-- @since 1.2.0.0</span><span>
</span><span id="line-368"></span><span class="annot"><a href="System.Process.html#callCommand"><span class="hs-identifier hs-type">callCommand</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span id="callCommand"><span class="annot"><span class="annottext">callCommand :: String -&gt; IO ()
</span><a href="System.Process.html#callCommand"><span class="hs-identifier hs-var hs-var">callCommand</span></a></span></span><span> </span><span id="local-6989586621679056866"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056866"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-370"></span><span>    </span><span id="local-6989586621679056867"><span class="annot"><a href="#local-6989586621679056867"><span class="hs-identifier hs-var">exit_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String
-&gt; CreateProcess
-&gt; (Maybe Handle
    -&gt; Maybe Handle -&gt; Maybe Handle -&gt; ProcessHandle -&gt; IO ExitCode)
-&gt; IO ExitCode
forall a.
String
-&gt; CreateProcess
-&gt; (Maybe Handle
    -&gt; Maybe Handle -&gt; Maybe Handle -&gt; ProcessHandle -&gt; IO a)
-&gt; IO a
</span><a href="System.Process.html#withCreateProcess_"><span class="hs-identifier hs-var">withCreateProcess_</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;callCommand&quot;</span></span><span>
</span><span id="line-371"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; CreateProcess
</span><a href="System.Process.html#shell"><span class="hs-identifier hs-var">shell</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056866"><span class="hs-identifier hs-var">cmd</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="System.Process.Common.html#delegate_ctlc"><span class="hs-identifier hs-var">delegate_ctlc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">((Maybe Handle
  -&gt; Maybe Handle -&gt; Maybe Handle -&gt; ProcessHandle -&gt; IO ExitCode)
 -&gt; IO ExitCode)
-&gt; (Maybe Handle
    -&gt; Maybe Handle -&gt; Maybe Handle -&gt; ProcessHandle -&gt; IO ExitCode)
-&gt; IO ExitCode
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Maybe Handle
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe Handle
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe Handle
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679056868"><span class="annot"><span class="annottext">ProcessHandle
</span><a href="#local-6989586621679056868"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-372"></span><span>                   </span><span class="annot"><span class="annottext">ProcessHandle -&gt; IO ExitCode
</span><a href="System.Process.html#waitForProcess"><span class="hs-identifier hs-var">waitForProcess</span></a></span><span> </span><span class="annot"><span class="annottext">ProcessHandle
</span><a href="#local-6989586621679056868"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-373"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621679056867"><span class="hs-identifier hs-type">exit_code</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-374"></span><span>      </span><span class="annot"><span class="annottext">ExitCode
</span><span class="hs-identifier hs-var">ExitSuccess</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">ExitFailure</span></span><span> </span><span id="local-6989586621679056869"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679056869"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; [String] -&gt; Int -&gt; IO ()
forall a. String -&gt; String -&gt; [String] -&gt; Int -&gt; IO a
</span><a href="System.Process.html#processFailedException"><span class="hs-identifier hs-var">processFailedException</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;callCommand&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056866"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679056869"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-376"></span><span>
</span><span id="line-377"></span><span id="local-6989586621679056550"><span class="annot"><a href="System.Process.html#processFailedException"><span class="hs-identifier hs-type">processFailedException</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679056550"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-378"></span><span id="processFailedException"><span class="annot"><span class="annottext">processFailedException :: forall a. String -&gt; String -&gt; [String] -&gt; Int -&gt; IO a
</span><a href="System.Process.html#processFailedException"><span class="hs-identifier hs-var hs-var">processFailedException</span></a></span></span><span> </span><span id="local-6989586621679056879"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056879"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621679056880"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056880"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span id="local-6989586621679056881"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679056881"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621679056882"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679056882"><span class="hs-identifier hs-var">exit_code</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-379"></span><span>      </span><span class="annot"><span class="annottext">IOError -&gt; IO a
forall a. HasCallStack =&gt; IOError -&gt; IO a
</span><span class="hs-identifier hs-var">ioError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IOErrorType -&gt; String -&gt; Maybe Handle -&gt; Maybe String -&gt; IOError
</span><span class="hs-identifier hs-var">mkIOError</span></span><span> </span><span class="annot"><span class="annottext">IOErrorType
</span><span class="hs-identifier hs-var">OtherError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056879"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056880"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-380"></span><span>                                     </span><span class="annot"><span class="annottext">(String -&gt; String) -&gt; [String] -&gt; String
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">' '</span></span><span class="annot"><span class="annottext">Char -&gt; String -&gt; String
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String -&gt; String) -&gt; (String -&gt; String) -&gt; String -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679056881"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-381"></span><span>                                     </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; (exit &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679056882"><span class="hs-identifier hs-var">exit_code</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;)&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-382"></span><span>                                 </span><span class="annot"><span class="annottext">Maybe Handle
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-383"></span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><span id="line-386"></span><span class="hs-comment">-- Secure process creation on Windows</span><span>
</span><span id="line-387"></span><span>
</span><span id="line-388"></span><span class="hs-comment">-- $windows-migitations</span><span>
</span><span id="line-389"></span><span class="hs-comment">--</span><span>
</span><span id="line-390"></span><span class="hs-comment">-- In general it is strongly advised that any untrusted user input be validated before</span><span>
</span><span id="line-391"></span><span class="hs-comment">-- being passed to a subprocess. One must be especially careful on Windows due to the</span><span>
</span><span id="line-392"></span><span class="hs-comment">-- crude nature of the platform's argument passing scheme. Specifically, unlike POSIX</span><span>
</span><span id="line-393"></span><span class="hs-comment">-- platforms, Windows treats the command-line not as a sequence of arguments but rather</span><span>
</span><span id="line-394"></span><span class="hs-comment">-- as a single string. It is therefore the responsibility of the called process to tokenize</span><span>
</span><span id="line-395"></span><span class="hs-comment">-- this string into distinct arguments.</span><span>
</span><span id="line-396"></span><span class="hs-comment">--</span><span>
</span><span id="line-397"></span><span class="hs-comment">-- While various programs on Windows tend to differ in their precise argument splitting</span><span>
</span><span id="line-398"></span><span class="hs-comment">-- behavior, the scheme used by @process@'s 'RawCommand' 'CmdSpec' should work for</span><span>
</span><span id="line-399"></span><span class="hs-comment">-- most reasonable programs. If you find that 'RawCommand' doesn't provide</span><span>
</span><span id="line-400"></span><span class="hs-comment">-- the behavior you need, it is recommended to instead compose your command-line</span><span>
</span><span id="line-401"></span><span class="hs-comment">-- manually and rather using the 'shell' 'CmdSpec'.</span><span>
</span><span id="line-402"></span><span class="hs-comment">--</span><span>
</span><span id="line-403"></span><span class="hs-comment">-- Additionally, the idiosyncratic escaping and string interpolation behavior of</span><span>
</span><span id="line-404"></span><span class="hs-comment">-- the Windows @cmd.exe@ command interpreter is known to introduce considerable</span><span>
</span><span id="line-405"></span><span class="hs-comment">-- complication to secure process creation. For this reason, @process@ implements</span><span>
</span><span id="line-406"></span><span class="hs-comment">-- specific argument escaping logic when the executable's file extension suggests</span><span>
</span><span id="line-407"></span><span class="hs-comment">-- that it is a batch file (e.g. @.bat@ or @.cmd@). However, this is not a</span><span>
</span><span id="line-408"></span><span class="hs-comment">-- completely reliable mitigation as Windows will also silently execute batch files</span><span>
</span><span id="line-409"></span><span class="hs-comment">-- when starting executables lacking a file extension (e.g. @callProcess &quot;hello&quot; []@</span><span>
</span><span id="line-410"></span><span class="hs-comment">-- when a @hello.bat@ is present in @PATH@). For this reason, users are encouraged to</span><span>
</span><span id="line-411"></span><span class="hs-comment">-- specify the file extension of invoked executables where possible, especially</span><span>
</span><span id="line-412"></span><span class="hs-comment">-- when untrusted input is involved.</span><span>
</span><span id="line-413"></span><span class="hs-comment">--</span><span>
</span><span id="line-414"></span><span class="hs-comment">-- Users passed untrusted input to subprocesses on Windows are encouraged to review</span><span>
</span><span id="line-415"></span><span class="hs-comment">-- &lt;https://flatt.tech/research/posts/batbadbut-you-cant-securely-execute-commands-on-windows/&gt;</span><span>
</span><span id="line-416"></span><span class="hs-comment">-- for guidance on how to safely navigate these waters.</span><span>
</span><span id="line-417"></span><span>
</span><span id="line-418"></span><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><span id="line-419"></span><span class="hs-comment">-- Control-C handling on Unix</span><span>
</span><span id="line-420"></span><span>
</span><span id="line-421"></span><span class="hs-comment">-- $ctlc-handling</span><span>
</span><span id="line-422"></span><span class="hs-comment">--</span><span>
</span><span id="line-423"></span><span class="hs-comment">-- When running an interactive console process (such as a shell, console-based</span><span>
</span><span id="line-424"></span><span class="hs-comment">-- text editor or ghci), we typically want that process to be allowed to handle</span><span>
</span><span id="line-425"></span><span class="hs-comment">-- Ctl-C keyboard interrupts how it sees fit. For example, while most programs</span><span>
</span><span id="line-426"></span><span class="hs-comment">-- simply quit on a Ctl-C, some handle it specially. To allow this to happen,</span><span>
</span><span id="line-427"></span><span class="hs-comment">-- use the @'delegate_ctlc' = True@ option in the 'CreateProcess' options.</span><span>
</span><span id="line-428"></span><span class="hs-comment">--</span><span>
</span><span id="line-429"></span><span class="hs-comment">-- The gory details:</span><span>
</span><span id="line-430"></span><span class="hs-comment">--</span><span>
</span><span id="line-431"></span><span class="hs-comment">-- By default Ctl-C will generate a @SIGINT@ signal, causing a 'UserInterrupt'</span><span>
</span><span id="line-432"></span><span class="hs-comment">-- exception to be sent to the main Haskell thread of your program, which if</span><span>
</span><span id="line-433"></span><span class="hs-comment">-- not specially handled will terminate the program. Normally, this is exactly</span><span>
</span><span id="line-434"></span><span class="hs-comment">-- what is wanted: an orderly shutdown of the program in response to Ctl-C.</span><span>
</span><span id="line-435"></span><span class="hs-comment">--</span><span>
</span><span id="line-436"></span><span class="hs-comment">-- Of course when running another interactive program in the console then we</span><span>
</span><span id="line-437"></span><span class="hs-comment">-- want to let that program handle Ctl-C. Under Unix however, Ctl-C sends</span><span>
</span><span id="line-438"></span><span class="hs-comment">-- @SIGINT@ to every process using the console. The standard solution is that</span><span>
</span><span id="line-439"></span><span class="hs-comment">-- while running an interactive program, ignore @SIGINT@ in the parent, and let</span><span>
</span><span id="line-440"></span><span class="hs-comment">-- it be handled in the child process. If that process then terminates due to</span><span>
</span><span id="line-441"></span><span class="hs-comment">-- the @SIGINT@ signal, then at that point treat it as if we had received the</span><span>
</span><span id="line-442"></span><span class="hs-comment">-- @SIGINT@ ourselves and begin an orderly shutdown.</span><span>
</span><span id="line-443"></span><span class="hs-comment">--</span><span>
</span><span id="line-444"></span><span class="hs-comment">-- This behaviour is implemented by 'createProcess' (and</span><span>
</span><span id="line-445"></span><span class="hs-comment">-- 'waitForProcess' \/ 'getProcessExitCode') when the @'delegate_ctlc' = True@</span><span>
</span><span id="line-446"></span><span class="hs-comment">-- option is set. In particular, the @SIGINT@ signal will be ignored until</span><span>
</span><span id="line-447"></span><span class="hs-comment">-- 'waitForProcess' returns (or 'getProcessExitCode' returns a non-Nothing</span><span>
</span><span id="line-448"></span><span class="hs-comment">-- result), so it becomes especially important to use 'waitForProcess' for every</span><span>
</span><span id="line-449"></span><span class="hs-comment">-- processes created.</span><span>
</span><span id="line-450"></span><span class="hs-comment">--</span><span>
</span><span id="line-451"></span><span class="hs-comment">-- In addition, in 'delegate_ctlc' mode, 'waitForProcess' and</span><span>
</span><span id="line-452"></span><span class="hs-comment">-- 'getProcessExitCode' will throw a 'UserInterrupt' exception if the process</span><span>
</span><span id="line-453"></span><span class="hs-comment">-- terminated with @'ExitFailure' (-SIGINT)@. Typically you will not want to</span><span>
</span><span id="line-454"></span><span class="hs-comment">-- catch this exception, but let it propagate, giving a normal orderly shutdown.</span><span>
</span><span id="line-455"></span><span class="hs-comment">-- One detail to be aware of is that the 'UserInterrupt' exception is thrown</span><span>
</span><span id="line-456"></span><span class="hs-comment">-- /synchronously/ in the thread that calls 'waitForProcess', whereas normally</span><span>
</span><span id="line-457"></span><span class="hs-comment">-- @SIGINT@ causes the exception to be thrown /asynchronously/ to the main</span><span>
</span><span id="line-458"></span><span class="hs-comment">-- thread.</span><span>
</span><span id="line-459"></span><span class="hs-comment">--</span><span>
</span><span id="line-460"></span><span class="hs-comment">-- For even more detail on this topic, see</span><span>
</span><span id="line-461"></span><span class="hs-comment">-- &lt;http://www.cons.org/cracauer/sigint.html &quot;Proper handling of SIGINT/SIGQUIT&quot;&gt;.</span><span>
</span><span id="line-462"></span><span>
</span><span id="line-463"></span><span class="hs-comment">-- $exec-on-windows</span><span>
</span><span id="line-464"></span><span class="hs-comment">--</span><span>
</span><span id="line-465"></span><span class="hs-comment">-- Note that processes which use the POSIX @exec@ system call (e.g. @gcc@)</span><span>
</span><span id="line-466"></span><span class="hs-comment">-- require special care on Windows. Specifically, the @msvcrt@ C runtime used</span><span>
</span><span id="line-467"></span><span class="hs-comment">-- frequently on Windows emulates @exec@ in a non-POSIX compliant manner, where</span><span>
</span><span id="line-468"></span><span class="hs-comment">-- the caller will be terminated (with exit code 0) and execution will continue</span><span>
</span><span id="line-469"></span><span class="hs-comment">-- in a new process. As a result, on Windows it will appear as though a child</span><span>
</span><span id="line-470"></span><span class="hs-comment">-- process which has called @exec@ has terminated despite the fact that the</span><span>
</span><span id="line-471"></span><span class="hs-comment">-- process would still be running on a POSIX-compliant platform.</span><span>
</span><span id="line-472"></span><span class="hs-comment">--</span><span>
</span><span id="line-473"></span><span class="hs-comment">-- Since many programs do use @exec@, the @process@ library exposes the</span><span>
</span><span id="line-474"></span><span class="hs-comment">-- 'use_process_jobs' flag to make it possible to reliably detect when such a</span><span>
</span><span id="line-475"></span><span class="hs-comment">-- process completes. When this flag is set a 'ProcessHandle' will not be</span><span>
</span><span id="line-476"></span><span class="hs-comment">-- deemed to be \&quot;finished\&quot; until all processes spawned by it have</span><span>
</span><span id="line-477"></span><span class="hs-comment">-- terminated (except those spawned by the child with the</span><span>
</span><span id="line-478"></span><span class="hs-comment">-- @CREATE_BREAKAWAY_FROM_JOB@ @CreateProcess@ flag).</span><span>
</span><span id="line-479"></span><span class="hs-comment">--</span><span>
</span><span id="line-480"></span><span class="hs-comment">-- Note, however, that, because of platform limitations, the exit code returned</span><span>
</span><span id="line-481"></span><span class="hs-comment">-- by @waitForProcess@ and @getProcessExitCode@ cannot not be relied upon when</span><span>
</span><span id="line-482"></span><span class="hs-comment">-- the child uses @exec@, even when 'use_process_jobs' is used. Specifically,</span><span>
</span><span id="line-483"></span><span class="hs-comment">-- these functions will return the exit code of the *original child* (which</span><span>
</span><span id="line-484"></span><span class="hs-comment">-- always exits with code 0, since it called @exec@), not the exit code of the</span><span>
</span><span id="line-485"></span><span class="hs-comment">-- process which carried on with execution after @exec@. This is different from</span><span>
</span><span id="line-486"></span><span class="hs-comment">-- the behavior prescribed by POSIX but is the best approximation that can be</span><span>
</span><span id="line-487"></span><span class="hs-comment">-- realised under the restrictions of the Windows process model.</span><span>
</span><span id="line-488"></span><span>
</span><span id="line-489"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-490"></span><span>
</span><span id="line-491"></span><span class="hs-comment">-- | @readProcess@ forks an external process, reads its standard output</span><span>
</span><span id="line-492"></span><span class="hs-comment">-- strictly, blocking until the process terminates, and returns the output</span><span>
</span><span id="line-493"></span><span class="hs-comment">-- string. The external process inherits the standard error.</span><span>
</span><span id="line-494"></span><span class="hs-comment">--</span><span>
</span><span id="line-495"></span><span class="hs-comment">-- If an asynchronous exception is thrown to the thread executing</span><span>
</span><span id="line-496"></span><span class="hs-comment">-- @readProcess@, the forked process will be terminated and @readProcess@ will</span><span>
</span><span id="line-497"></span><span class="hs-comment">-- wait (block) until the process has been terminated.</span><span>
</span><span id="line-498"></span><span class="hs-comment">--</span><span>
</span><span id="line-499"></span><span class="hs-comment">-- Output is returned strictly, so this is not suitable for launching processes</span><span>
</span><span id="line-500"></span><span class="hs-comment">-- that require interaction over the standard file streams.</span><span>
</span><span id="line-501"></span><span class="hs-comment">--</span><span>
</span><span id="line-502"></span><span class="hs-comment">-- This function throws an 'IOError' if the process 'ExitCode' is</span><span>
</span><span id="line-503"></span><span class="hs-comment">-- anything other than 'ExitSuccess'. If instead you want to get the</span><span>
</span><span id="line-504"></span><span class="hs-comment">-- 'ExitCode' then use 'readProcessWithExitCode'.</span><span>
</span><span id="line-505"></span><span class="hs-comment">--</span><span>
</span><span id="line-506"></span><span class="hs-comment">-- Users of this function should compile with @-threaded@ if they</span><span>
</span><span id="line-507"></span><span class="hs-comment">-- want other Haskell threads to keep running while waiting on</span><span>
</span><span id="line-508"></span><span class="hs-comment">-- the result of readProcess.</span><span>
</span><span id="line-509"></span><span class="hs-comment">--</span><span>
</span><span id="line-510"></span><span class="hs-comment">-- &gt;  &gt; readProcess &quot;date&quot; [] []</span><span>
</span><span id="line-511"></span><span class="hs-comment">-- &gt;  &quot;Thu Feb  7 10:03:39 PST 2008\n&quot;</span><span>
</span><span id="line-512"></span><span class="hs-comment">--</span><span>
</span><span id="line-513"></span><span class="hs-comment">-- The arguments are:</span><span>
</span><span id="line-514"></span><span class="hs-comment">--</span><span>
</span><span id="line-515"></span><span class="hs-comment">-- * The command to run, which must be in the $PATH, or an absolute or relative path</span><span>
</span><span id="line-516"></span><span class="hs-comment">--</span><span>
</span><span id="line-517"></span><span class="hs-comment">-- * A list of separate command line arguments to the program.  See 'RawCommand' for</span><span>
</span><span id="line-518"></span><span class="hs-comment">--   further discussion of Windows semantics.</span><span>
</span><span id="line-519"></span><span class="hs-comment">--</span><span>
</span><span id="line-520"></span><span class="hs-comment">-- * A string to pass on standard input to the forked process.</span><span>
</span><span id="line-521"></span><span class="hs-comment">--</span><span>
</span><span id="line-522"></span><span class="annot"><a href="System.Process.html#readProcess"><span class="hs-identifier hs-type">readProcess</span></a></span><span>
</span><span id="line-523"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>                 </span><span class="annot"><span class="hs-comment">-- ^ Filename of the executable (see 'RawCommand' for details)</span></span><span>
</span><span id="line-524"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span>                 </span><span class="annot"><span class="hs-comment">-- ^ any arguments</span></span><span>
</span><span id="line-525"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>                   </span><span class="annot"><span class="hs-comment">-- ^ standard input</span></span><span>
</span><span id="line-526"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>                </span><span class="annot"><span class="hs-comment">-- ^ stdout</span></span><span>
</span><span id="line-527"></span><span id="readProcess"><span class="annot"><span class="annottext">readProcess :: String -&gt; [String] -&gt; String -&gt; IO String
</span><a href="System.Process.html#readProcess"><span class="hs-identifier hs-var hs-var">readProcess</span></a></span></span><span> </span><span id="local-6989586621679056887"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056887"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span id="local-6989586621679056888"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679056888"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CreateProcess -&gt; String -&gt; IO String
</span><a href="System.Process.html#readCreateProcess"><span class="hs-identifier hs-var">readCreateProcess</span></a></span><span> </span><span class="annot"><span class="annottext">(CreateProcess -&gt; String -&gt; IO String)
-&gt; CreateProcess -&gt; String -&gt; IO String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; CreateProcess
</span><a href="System.Process.html#proc"><span class="hs-identifier hs-var">proc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056887"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679056888"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-528"></span><span>
</span><span id="line-529"></span><span class="hs-comment">-- | @readCreateProcess@ works exactly like 'readProcess' except that it</span><span>
</span><span id="line-530"></span><span class="hs-comment">-- lets you pass 'CreateProcess' giving better flexibility.</span><span>
</span><span id="line-531"></span><span class="hs-comment">--</span><span>
</span><span id="line-532"></span><span class="hs-comment">-- &gt;  &gt; readCreateProcess ((shell &quot;pwd&quot;) { cwd = Just &quot;/etc/&quot; }) &quot;&quot;</span><span>
</span><span id="line-533"></span><span class="hs-comment">-- &gt;  &quot;/etc\n&quot;</span><span>
</span><span id="line-534"></span><span class="hs-comment">--</span><span>
</span><span id="line-535"></span><span class="hs-comment">-- Note that @Handle@s provided for @std_in@ or @std_out@ via the CreateProcess</span><span>
</span><span id="line-536"></span><span class="hs-comment">-- record will be ignored.</span><span>
</span><span id="line-537"></span><span class="hs-comment">--</span><span>
</span><span id="line-538"></span><span class="hs-comment">-- @since 1.2.3.0</span><span>
</span><span id="line-539"></span><span>
</span><span id="line-540"></span><span class="annot"><a href="System.Process.html#readCreateProcess"><span class="hs-identifier hs-type">readCreateProcess</span></a></span><span>
</span><span id="line-541"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.Process.Common.html#CreateProcess"><span class="hs-identifier hs-type">CreateProcess</span></a></span><span>
</span><span id="line-542"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>                   </span><span class="annot"><span class="hs-comment">-- ^ standard input</span></span><span>
</span><span id="line-543"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>                </span><span class="annot"><span class="hs-comment">-- ^ stdout</span></span><span>
</span><span id="line-544"></span><span id="readCreateProcess"><span class="annot"><span class="annottext">readCreateProcess :: CreateProcess -&gt; String -&gt; IO String
</span><a href="System.Process.html#readCreateProcess"><span class="hs-identifier hs-var hs-var">readCreateProcess</span></a></span></span><span> </span><span id="local-6989586621679056889"><span class="annot"><span class="annottext">CreateProcess
</span><a href="#local-6989586621679056889"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span id="local-6989586621679056890"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056890"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-545"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679056891"><span class="annot"><span class="annottext">cp_opts :: CreateProcess
</span><a href="#local-6989586621679056891"><span class="hs-identifier hs-var hs-var hs-var">cp_opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CreateProcess
</span><a href="#local-6989586621679056889"><span class="hs-identifier hs-var">cp</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-546"></span><span>                    </span><span class="annot"><a href="System.Process.Common.html#std_in"><span class="hs-identifier hs-var">std_in</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="System.Process.Common.html#CreatePipe"><span class="hs-identifier hs-type">CreatePipe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-547"></span><span>                    </span><span class="annot"><a href="System.Process.Common.html#std_out"><span class="hs-identifier hs-var">std_out</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="System.Process.Common.html#CreatePipe"><span class="hs-identifier hs-type">CreatePipe</span></a></span><span>
</span><span id="line-548"></span><span>                  </span><span class="hs-special">}</span><span>
</span><span id="line-549"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679056892"><span class="annot"><a href="#local-6989586621679056892"><span class="hs-identifier hs-var">ex</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679056893"><span class="annot"><a href="#local-6989586621679056893"><span class="hs-identifier hs-var">output</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String
-&gt; CreateProcess
-&gt; (Maybe Handle
    -&gt; Maybe Handle
    -&gt; Maybe Handle
    -&gt; ProcessHandle
    -&gt; IO (ExitCode, String))
-&gt; IO (ExitCode, String)
forall a.
String
-&gt; CreateProcess
-&gt; (Maybe Handle
    -&gt; Maybe Handle -&gt; Maybe Handle -&gt; ProcessHandle -&gt; IO a)
-&gt; IO a
</span><a href="System.Process.html#withCreateProcess_"><span class="hs-identifier hs-var">withCreateProcess_</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;readCreateProcess&quot;</span></span><span> </span><span class="annot"><span class="annottext">CreateProcess
</span><a href="#local-6989586621679056891"><span class="hs-identifier hs-var">cp_opts</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe Handle
  -&gt; Maybe Handle
  -&gt; Maybe Handle
  -&gt; ProcessHandle
  -&gt; IO (ExitCode, String))
 -&gt; IO (ExitCode, String))
-&gt; (Maybe Handle
    -&gt; Maybe Handle
    -&gt; Maybe Handle
    -&gt; ProcessHandle
    -&gt; IO (ExitCode, String))
-&gt; IO (ExitCode, String)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-550"></span><span>      </span><span class="hs-glyph">\</span><span id="local-6989586621679056894"><span class="annot"><span class="annottext">Maybe Handle
</span><a href="#local-6989586621679056894"><span class="hs-identifier hs-var">mb_inh</span></a></span></span><span> </span><span id="local-6989586621679056895"><span class="annot"><span class="annottext">Maybe Handle
</span><a href="#local-6989586621679056895"><span class="hs-identifier hs-var">mb_outh</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Handle
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679056896"><span class="annot"><span class="annottext">ProcessHandle
</span><a href="#local-6989586621679056896"><span class="hs-identifier hs-var">ph</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-551"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Handle
</span><a href="#local-6989586621679056894"><span class="hs-identifier hs-var">mb_inh</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Handle
</span><a href="#local-6989586621679056895"><span class="hs-identifier hs-var">mb_outh</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-552"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679056897"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679056897"><span class="hs-identifier hs-var">inh</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679056898"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679056898"><span class="hs-identifier hs-var">outh</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-553"></span><span>
</span><span id="line-554"></span><span>            </span><span class="hs-comment">-- fork off a thread to start consuming the output</span><span>
</span><span id="line-555"></span><span>            </span><span id="local-6989586621679056899"><span class="annot"><a href="#local-6989586621679056899"><span class="hs-identifier hs-var">output</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO String
</span><span class="hs-identifier hs-var">hGetContents</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679056898"><span class="hs-identifier hs-var">outh</span></a></span><span>
</span><span id="line-556"></span><span>            </span><span class="annot"><a href="System.Process.Internals.html#withForkWait"><span class="hs-identifier hs-type">withForkWait</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">C.evaluate</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="../../deepseq-1.5.1.0-6837/src/Control.DeepSeq.html#rnf"><span class="hs-identifier hs-type">rnf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056899"><span class="hs-identifier hs-type">output</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679056903"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679056903"><span class="hs-identifier hs-var">waitOut</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-557"></span><span>
</span><span id="line-558"></span><span>              </span><span class="hs-comment">-- now write any input</span><span>
</span><span id="line-559"></span><span>              </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056890"><span class="hs-identifier hs-var">input</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-560"></span><span>                </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
</span><a href="System.Process.Internals.html#ignoreSigPipe"><span class="hs-identifier hs-var">ignoreSigPipe</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Handle -&gt; String -&gt; IO ()
</span><span class="hs-identifier hs-var">hPutStr</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679056897"><span class="hs-identifier hs-var">inh</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056890"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-561"></span><span>              </span><span class="hs-comment">-- hClose performs implicit hFlush, and thus may trigger a SIGPIPE</span><span>
</span><span id="line-562"></span><span>              </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
</span><a href="System.Process.Internals.html#ignoreSigPipe"><span class="hs-identifier hs-var">ignoreSigPipe</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO ()
</span><span class="hs-identifier hs-var">hClose</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679056897"><span class="hs-identifier hs-var">inh</span></a></span><span>
</span><span id="line-563"></span><span>
</span><span id="line-564"></span><span>              </span><span class="hs-comment">-- wait on the output</span><span>
</span><span id="line-565"></span><span>              </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679056903"><span class="hs-identifier hs-var">waitOut</span></a></span><span>
</span><span id="line-566"></span><span>              </span><span class="annot"><span class="annottext">Handle -&gt; IO ()
</span><span class="hs-identifier hs-var">hClose</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679056898"><span class="hs-identifier hs-var">outh</span></a></span><span>
</span><span id="line-567"></span><span>
</span><span id="line-568"></span><span>            </span><span class="hs-comment">-- wait on the process</span><span>
</span><span id="line-569"></span><span>            </span><span id="local-6989586621679056907"><span class="annot"><a href="#local-6989586621679056907"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="System.Process.html#waitForProcess"><span class="hs-identifier hs-type">waitForProcess</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056896"><span class="hs-identifier hs-type">ph</span></a></span><span>
</span><span id="line-570"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679056907"><span class="hs-identifier hs-type">ex</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679056899"><span class="hs-identifier hs-type">output</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-571"></span><span>
</span><span id="line-572"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Handle
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe Handle
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO (ExitCode, String)
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;readCreateProcess: Failed to get a stdin handle.&quot;</span></span><span>
</span><span id="line-573"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Handle
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe Handle
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO (ExitCode, String)
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;readCreateProcess: Failed to get a stdout handle.&quot;</span></span><span>
</span><span id="line-574"></span><span>
</span><span id="line-575"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621679056892"><span class="hs-identifier hs-type">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-576"></span><span>     </span><span class="annot"><span class="annottext">ExitCode
</span><span class="hs-identifier hs-var">ExitSuccess</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056893"><span class="hs-identifier hs-var">output</span></a></span><span>
</span><span id="line-577"></span><span>     </span><span class="annot"><span class="hs-identifier hs-type">ExitFailure</span></span><span> </span><span id="local-6989586621679056909"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679056909"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; [String] -&gt; Int -&gt; IO String
forall a. String -&gt; String -&gt; [String] -&gt; Int -&gt; IO a
</span><a href="System.Process.html#processFailedException"><span class="hs-identifier hs-var">processFailedException</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;readCreateProcess&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056910"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679056911"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679056909"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-578"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-579"></span><span>    </span><span id="local-6989586621679056910"><span class="annot"><span class="annottext">cmd :: String
</span><a href="#local-6989586621679056910"><span class="hs-identifier hs-var hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CreateProcess
</span><a href="#local-6989586621679056889"><span class="hs-identifier hs-var">cp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-580"></span><span>            </span><span class="annot"><a href="System.Process.Common.html#CreateProcess"><span class="hs-identifier hs-type">CreateProcess</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cmdspec :: CreateProcess -&gt; CmdSpec
</span><a href="System.Process.Common.html#cmdspec"><span class="hs-identifier hs-var">cmdspec</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="System.Process.Common.html#ShellCommand"><span class="hs-identifier hs-type">ShellCommand</span></a></span><span> </span><span id="local-6989586621679056912"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056912"><span class="hs-identifier hs-var">sc</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056912"><span class="hs-identifier hs-var">sc</span></a></span><span>
</span><span id="line-581"></span><span>            </span><span class="annot"><a href="System.Process.Common.html#CreateProcess"><span class="hs-identifier hs-type">CreateProcess</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cmdspec :: CreateProcess -&gt; CmdSpec
</span><a href="System.Process.Common.html#cmdspec"><span class="hs-identifier hs-var">cmdspec</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="System.Process.Common.html#RawCommand"><span class="hs-identifier hs-type">RawCommand</span></a></span><span> </span><span id="local-6989586621679056913"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056913"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056913"><span class="hs-identifier hs-var">fp</span></a></span><span>
</span><span id="line-582"></span><span>    </span><span id="local-6989586621679056911"><span class="annot"><span class="annottext">args :: [String]
</span><a href="#local-6989586621679056911"><span class="hs-identifier hs-var hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CreateProcess
</span><a href="#local-6989586621679056889"><span class="hs-identifier hs-var">cp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-583"></span><span>             </span><span class="annot"><a href="System.Process.Common.html#CreateProcess"><span class="hs-identifier hs-type">CreateProcess</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cmdspec :: CreateProcess -&gt; CmdSpec
</span><a href="System.Process.Common.html#cmdspec"><span class="hs-identifier hs-var">cmdspec</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="System.Process.Common.html#ShellCommand"><span class="hs-identifier hs-type">ShellCommand</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-584"></span><span>             </span><span class="annot"><a href="System.Process.Common.html#CreateProcess"><span class="hs-identifier hs-type">CreateProcess</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cmdspec :: CreateProcess -&gt; CmdSpec
</span><a href="System.Process.Common.html#cmdspec"><span class="hs-identifier hs-var">cmdspec</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="System.Process.Common.html#RawCommand"><span class="hs-identifier hs-type">RawCommand</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679056914"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679056914"><span class="hs-identifier hs-var">args'</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679056914"><span class="hs-identifier hs-var">args'</span></a></span><span>
</span><span id="line-585"></span><span>
</span><span id="line-586"></span><span>
</span><span id="line-587"></span><span class="hs-comment">-- | @readProcessWithExitCode@ is like 'readProcess' but with two differences:</span><span>
</span><span id="line-588"></span><span class="hs-comment">--</span><span>
</span><span id="line-589"></span><span class="hs-comment">--  * it returns the 'ExitCode' of the process, and does not throw any</span><span>
</span><span id="line-590"></span><span class="hs-comment">--    exception if the code is not 'ExitSuccess'.</span><span>
</span><span id="line-591"></span><span class="hs-comment">--</span><span>
</span><span id="line-592"></span><span class="hs-comment">--  * it reads and returns the output from process' standard error handle,</span><span>
</span><span id="line-593"></span><span class="hs-comment">--    rather than the process inheriting the standard error handle.</span><span>
</span><span id="line-594"></span><span class="hs-comment">--</span><span>
</span><span id="line-595"></span><span class="hs-comment">-- On Unix systems, see 'waitForProcess' for the meaning of exit codes</span><span>
</span><span id="line-596"></span><span class="hs-comment">-- when the process died as the result of a signal.</span><span>
</span><span id="line-597"></span><span class="hs-comment">--</span><span>
</span><span id="line-598"></span><span class="annot"><a href="System.Process.html#readProcessWithExitCode"><span class="hs-identifier hs-type">readProcessWithExitCode</span></a></span><span>
</span><span id="line-599"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>                 </span><span class="annot"><span class="hs-comment">-- ^ Filename of the executable (see 'RawCommand' for details)</span></span><span>
</span><span id="line-600"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span>                 </span><span class="annot"><span class="hs-comment">-- ^ any arguments</span></span><span>
</span><span id="line-601"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>                   </span><span class="annot"><span class="hs-comment">-- ^ standard input</span></span><span>
</span><span id="line-602"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ExitCode</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ exitcode, stdout, stderr</span></span><span>
</span><span id="line-603"></span><span id="readProcessWithExitCode"><span class="annot"><span class="annottext">readProcessWithExitCode :: String -&gt; [String] -&gt; String -&gt; IO (ExitCode, String, String)
</span><a href="System.Process.html#readProcessWithExitCode"><span class="hs-identifier hs-var hs-var">readProcessWithExitCode</span></a></span></span><span> </span><span id="local-6989586621679056915"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056915"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span id="local-6989586621679056916"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679056916"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-604"></span><span>    </span><span class="annot"><span class="annottext">CreateProcess -&gt; String -&gt; IO (ExitCode, String, String)
</span><a href="System.Process.html#readCreateProcessWithExitCode"><span class="hs-identifier hs-var">readCreateProcessWithExitCode</span></a></span><span> </span><span class="annot"><span class="annottext">(CreateProcess -&gt; String -&gt; IO (ExitCode, String, String))
-&gt; CreateProcess -&gt; String -&gt; IO (ExitCode, String, String)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; CreateProcess
</span><a href="System.Process.html#proc"><span class="hs-identifier hs-var">proc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056915"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679056916"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-605"></span><span>
</span><span id="line-606"></span><span class="hs-comment">-- | @readCreateProcessWithExitCode@ works exactly like 'readProcessWithExitCode' except that it</span><span>
</span><span id="line-607"></span><span class="hs-comment">-- lets you pass 'CreateProcess' giving better flexibility.</span><span>
</span><span id="line-608"></span><span class="hs-comment">--</span><span>
</span><span id="line-609"></span><span class="hs-comment">-- Note that @Handle@s provided for @std_in@, @std_out@, or @std_err@ via the CreateProcess</span><span>
</span><span id="line-610"></span><span class="hs-comment">-- record will be ignored.</span><span>
</span><span id="line-611"></span><span class="hs-comment">--</span><span>
</span><span id="line-612"></span><span class="hs-comment">-- @since 1.2.3.0</span><span>
</span><span id="line-613"></span><span class="annot"><a href="System.Process.html#readCreateProcessWithExitCode"><span class="hs-identifier hs-type">readCreateProcessWithExitCode</span></a></span><span>
</span><span id="line-614"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.Process.Common.html#CreateProcess"><span class="hs-identifier hs-type">CreateProcess</span></a></span><span>
</span><span id="line-615"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>                      </span><span class="annot"><span class="hs-comment">-- ^ standard input</span></span><span>
</span><span id="line-616"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ExitCode</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ exitcode, stdout, stderr</span></span><span>
</span><span id="line-617"></span><span id="readCreateProcessWithExitCode"><span class="annot"><span class="annottext">readCreateProcessWithExitCode :: CreateProcess -&gt; String -&gt; IO (ExitCode, String, String)
</span><a href="System.Process.html#readCreateProcessWithExitCode"><span class="hs-identifier hs-var hs-var">readCreateProcessWithExitCode</span></a></span></span><span> </span><span id="local-6989586621679056917"><span class="annot"><span class="annottext">CreateProcess
</span><a href="#local-6989586621679056917"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span id="local-6989586621679056918"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056918"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-618"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679056919"><span class="annot"><span class="annottext">cp_opts :: CreateProcess
</span><a href="#local-6989586621679056919"><span class="hs-identifier hs-var hs-var">cp_opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CreateProcess
</span><a href="#local-6989586621679056917"><span class="hs-identifier hs-var">cp</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-619"></span><span>                    </span><span class="annot"><a href="System.Process.Common.html#std_in"><span class="hs-identifier hs-var">std_in</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="System.Process.Common.html#CreatePipe"><span class="hs-identifier hs-type">CreatePipe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-620"></span><span>                    </span><span class="annot"><a href="System.Process.Common.html#std_out"><span class="hs-identifier hs-var">std_out</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="System.Process.Common.html#CreatePipe"><span class="hs-identifier hs-type">CreatePipe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-621"></span><span>                    </span><span class="annot"><a href="System.Process.Common.html#std_err"><span class="hs-identifier hs-var">std_err</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="System.Process.Common.html#CreatePipe"><span class="hs-identifier hs-type">CreatePipe</span></a></span><span>
</span><span id="line-622"></span><span>                  </span><span class="hs-special">}</span><span>
</span><span id="line-623"></span><span>    </span><span class="annot"><span class="annottext">String
-&gt; CreateProcess
-&gt; (Maybe Handle
    -&gt; Maybe Handle
    -&gt; Maybe Handle
    -&gt; ProcessHandle
    -&gt; IO (ExitCode, String, String))
-&gt; IO (ExitCode, String, String)
forall a.
String
-&gt; CreateProcess
-&gt; (Maybe Handle
    -&gt; Maybe Handle -&gt; Maybe Handle -&gt; ProcessHandle -&gt; IO a)
-&gt; IO a
</span><a href="System.Process.html#withCreateProcess_"><span class="hs-identifier hs-var">withCreateProcess_</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;readCreateProcessWithExitCode&quot;</span></span><span> </span><span class="annot"><span class="annottext">CreateProcess
</span><a href="#local-6989586621679056919"><span class="hs-identifier hs-var">cp_opts</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe Handle
  -&gt; Maybe Handle
  -&gt; Maybe Handle
  -&gt; ProcessHandle
  -&gt; IO (ExitCode, String, String))
 -&gt; IO (ExitCode, String, String))
-&gt; (Maybe Handle
    -&gt; Maybe Handle
    -&gt; Maybe Handle
    -&gt; ProcessHandle
    -&gt; IO (ExitCode, String, String))
-&gt; IO (ExitCode, String, String)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-624"></span><span>      </span><span class="hs-glyph">\</span><span id="local-6989586621679056920"><span class="annot"><span class="annottext">Maybe Handle
</span><a href="#local-6989586621679056920"><span class="hs-identifier hs-var">mb_inh</span></a></span></span><span> </span><span id="local-6989586621679056921"><span class="annot"><span class="annottext">Maybe Handle
</span><a href="#local-6989586621679056921"><span class="hs-identifier hs-var">mb_outh</span></a></span></span><span> </span><span id="local-6989586621679056922"><span class="annot"><span class="annottext">Maybe Handle
</span><a href="#local-6989586621679056922"><span class="hs-identifier hs-var">mb_errh</span></a></span></span><span> </span><span id="local-6989586621679056923"><span class="annot"><span class="annottext">ProcessHandle
</span><a href="#local-6989586621679056923"><span class="hs-identifier hs-var">ph</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-625"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Handle
</span><a href="#local-6989586621679056920"><span class="hs-identifier hs-var">mb_inh</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Handle
</span><a href="#local-6989586621679056921"><span class="hs-identifier hs-var">mb_outh</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Handle
</span><a href="#local-6989586621679056922"><span class="hs-identifier hs-var">mb_errh</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-626"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679056924"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679056924"><span class="hs-identifier hs-var">inh</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679056925"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679056925"><span class="hs-identifier hs-var">outh</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679056926"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679056926"><span class="hs-identifier hs-var">errh</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-627"></span><span>
</span><span id="line-628"></span><span>            </span><span id="local-6989586621679056927"><span class="annot"><a href="#local-6989586621679056927"><span class="hs-identifier hs-var">out</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO String
</span><span class="hs-identifier hs-var">hGetContents</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679056925"><span class="hs-identifier hs-var">outh</span></a></span><span>
</span><span id="line-629"></span><span>            </span><span id="local-6989586621679056928"><span class="annot"><a href="#local-6989586621679056928"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">hGetContents</span></span><span> </span><span class="annot"><a href="#local-6989586621679056926"><span class="hs-identifier hs-type">errh</span></a></span><span>
</span><span id="line-630"></span><span>
</span><span id="line-631"></span><span>            </span><span class="hs-comment">-- fork off threads to start consuming stdout &amp; stderr</span><span>
</span><span id="line-632"></span><span>            </span><span class="annot"><a href="System.Process.Internals.html#withForkWait"><span class="hs-identifier hs-type">withForkWait</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">C.evaluate</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="../../deepseq-1.5.1.0-6837/src/Control.DeepSeq.html#rnf"><span class="hs-identifier hs-type">rnf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056927"><span class="hs-identifier hs-type">out</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679056929"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679056929"><span class="hs-identifier hs-var">waitOut</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-633"></span><span>             </span><span class="annot"><span class="annottext">IO () -&gt; (IO () -&gt; IO ()) -&gt; IO ()
forall a. IO () -&gt; (IO () -&gt; IO a) -&gt; IO a
</span><a href="System.Process.Internals.html#withForkWait"><span class="hs-identifier hs-var">withForkWait</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
</span><span class="hs-identifier hs-var">C.evaluate</span></span><span> </span><span class="annot"><span class="annottext">(() -&gt; IO ()) -&gt; () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ()
forall a. NFData a =&gt; a -&gt; ()
</span><a href="../../deepseq-1.5.1.0-6837/src/Control.DeepSeq.html#rnf"><span class="hs-identifier hs-var">rnf</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056928"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((IO () -&gt; IO ()) -&gt; IO ()) -&gt; (IO () -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679056930"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679056930"><span class="hs-identifier hs-var">waitErr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-634"></span><span>
</span><span id="line-635"></span><span>              </span><span class="hs-comment">-- now write any input</span><span>
</span><span id="line-636"></span><span>              </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056918"><span class="hs-identifier hs-var">input</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-637"></span><span>                </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
</span><a href="System.Process.Internals.html#ignoreSigPipe"><span class="hs-identifier hs-var">ignoreSigPipe</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Handle -&gt; String -&gt; IO ()
</span><span class="hs-identifier hs-var">hPutStr</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679056924"><span class="hs-identifier hs-var">inh</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056918"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-638"></span><span>              </span><span class="hs-comment">-- hClose performs implicit hFlush, and thus may trigger a SIGPIPE</span><span>
</span><span id="line-639"></span><span>              </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
</span><a href="System.Process.Internals.html#ignoreSigPipe"><span class="hs-identifier hs-var">ignoreSigPipe</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO ()
</span><span class="hs-identifier hs-var">hClose</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679056924"><span class="hs-identifier hs-var">inh</span></a></span><span>
</span><span id="line-640"></span><span>
</span><span id="line-641"></span><span>              </span><span class="hs-comment">-- wait on the output</span><span>
</span><span id="line-642"></span><span>              </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679056929"><span class="hs-identifier hs-var">waitOut</span></a></span><span>
</span><span id="line-643"></span><span>              </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679056930"><span class="hs-identifier hs-var">waitErr</span></a></span><span>
</span><span id="line-644"></span><span>
</span><span id="line-645"></span><span>              </span><span class="annot"><span class="annottext">Handle -&gt; IO ()
</span><span class="hs-identifier hs-var">hClose</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679056925"><span class="hs-identifier hs-var">outh</span></a></span><span>
</span><span id="line-646"></span><span>              </span><span class="annot"><span class="annottext">Handle -&gt; IO ()
</span><span class="hs-identifier hs-var">hClose</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679056926"><span class="hs-identifier hs-var">errh</span></a></span><span>
</span><span id="line-647"></span><span>
</span><span id="line-648"></span><span>            </span><span class="hs-comment">-- wait on the process</span><span>
</span><span id="line-649"></span><span>            </span><span id="local-6989586621679056931"><span class="annot"><a href="#local-6989586621679056931"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="System.Process.html#waitForProcess"><span class="hs-identifier hs-type">waitForProcess</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056923"><span class="hs-identifier hs-type">ph</span></a></span><span>
</span><span id="line-650"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679056931"><span class="hs-identifier hs-type">ex</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679056927"><span class="hs-identifier hs-type">out</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679056928"><span class="hs-identifier hs-type">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-651"></span><span>
</span><span id="line-652"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Handle
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe Handle
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe Handle
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO (ExitCode, String, String)
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;readCreateProcessWithExitCode: Failed to get a stdin handle.&quot;</span></span><span>
</span><span id="line-653"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Handle
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe Handle
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe Handle
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO (ExitCode, String, String)
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;readCreateProcessWithExitCode: Failed to get a stdout handle.&quot;</span></span><span>
</span><span id="line-654"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Handle
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe Handle
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe Handle
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO (ExitCode, String, String)
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;readCreateProcessWithExitCode: Failed to get a stderr handle.&quot;</span></span><span>
</span><span id="line-655"></span><span>
</span><span id="line-656"></span><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><span id="line-657"></span><span class="hs-comment">-- showCommandForUser</span><span>
</span><span id="line-658"></span><span>
</span><span id="line-659"></span><span class="hs-comment">-- | Given a program @/p/@ and arguments @/args/@,</span><span>
</span><span id="line-660"></span><span class="hs-comment">--   @showCommandForUser /p/ /args/@ returns a string suitable for pasting</span><span>
</span><span id="line-661"></span><span class="hs-comment">--   into @\/bin\/sh@ (on Unix systems) or @CMD.EXE@ (on Windows).</span><span>
</span><span id="line-662"></span><span class="annot"><a href="System.Process.html#showCommandForUser"><span class="hs-identifier hs-type">showCommandForUser</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-663"></span><span id="showCommandForUser"><span class="annot"><span class="annottext">showCommandForUser :: String -&gt; [String] -&gt; String
</span><a href="System.Process.html#showCommandForUser"><span class="hs-identifier hs-var hs-var">showCommandForUser</span></a></span></span><span> </span><span id="local-6989586621679056932"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056932"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span id="local-6989586621679056933"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679056933"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unwords</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String -&gt; String) -&gt; [String] -&gt; [String]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="System.Process.Internals.html#translate"><span class="hs-identifier hs-var">translate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679056932"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679056933"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-664"></span><span>
</span><span id="line-665"></span><span>
</span><span id="line-666"></span><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><span id="line-667"></span><span class="hs-comment">-- getPid</span><span>
</span><span id="line-668"></span><span>
</span><span id="line-669"></span><span class="hs-comment">-- | Returns the PID (process ID) of a subprocess.</span><span>
</span><span id="line-670"></span><span class="hs-comment">--</span><span>
</span><span id="line-671"></span><span class="hs-comment">-- 'Nothing' is returned if the handle was already closed. Otherwise a</span><span>
</span><span id="line-672"></span><span class="hs-comment">-- PID is returned that remains valid as long as the handle is open.</span><span>
</span><span id="line-673"></span><span class="hs-comment">-- The operating system may reuse the PID as soon as the last handle to</span><span>
</span><span id="line-674"></span><span class="hs-comment">-- the process is closed.</span><span>
</span><span id="line-675"></span><span class="hs-comment">--</span><span>
</span><span id="line-676"></span><span class="hs-comment">-- @since 1.6.3.0</span><span>
</span><span id="line-677"></span><span class="annot"><a href="System.Process.html#getPid"><span class="hs-identifier hs-type">getPid</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-type">ProcessHandle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="System.Process.html#Pid"><span class="hs-identifier hs-type">Pid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-678"></span><span id="getPid"><span class="annot"><span class="annottext">getPid :: ProcessHandle -&gt; IO (Maybe Pid)
</span><a href="System.Process.html#getPid"><span class="hs-identifier hs-var hs-var">getPid</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-type">ProcessHandle</span></a></span><span> </span><span id="local-6989586621679056936"><span class="annot"><span class="annottext">MVar ProcessHandle__
</span><a href="#local-6989586621679056936"><span class="hs-identifier hs-var">mh</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-679"></span><span>  </span><span id="local-6989586621679056937"><span class="annot"><a href="#local-6989586621679056937"><span class="hs-identifier hs-var">p_</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MVar ProcessHandle__ -&gt; IO ProcessHandle__
forall a. MVar a -&gt; IO a
</span><span class="hs-identifier hs-var">readMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar ProcessHandle__
</span><a href="#local-6989586621679056936"><span class="hs-identifier hs-var">mh</span></a></span><span>
</span><span id="line-680"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621679056937"><span class="hs-identifier hs-type">p_</span></a></span><span> </span><span class="hs-keyword">of</span><span class="hs-cpp">
#if defined(javascript_HOST_ARCH)
</span><span>    </span><span class="hs-identifier">OpenHandle</span><span> </span><span class="hs-identifier">h</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-683"></span><span>      </span><span class="hs-identifier">pid</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getProcessId</span><span> </span><span class="hs-identifier">h</span><span>
</span><span id="line-684"></span><span>      </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">pid</span><span class="hs-cpp">
#elif defined(mingw32_HOST_OS)
</span><span>    </span><span class="hs-identifier">OpenHandle</span><span> </span><span class="hs-identifier">h</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-687"></span><span>      </span><span class="hs-identifier">pid</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getProcessId</span><span> </span><span class="hs-identifier">h</span><span>
</span><span id="line-688"></span><span>      </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">pid</span><span class="hs-cpp">
#else
</span><span>    </span><span class="annot"><a href="System.Process.Common.html#OpenHandle"><span class="hs-identifier hs-type">OpenHandle</span></a></span><span> </span><span id="local-6989586621679056940"><span class="annot"><span class="annottext">Pid
</span><a href="#local-6989586621679056940"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Pid -&gt; IO (Maybe Pid)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Pid -&gt; IO (Maybe Pid)) -&gt; Maybe Pid -&gt; IO (Maybe Pid)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pid -&gt; Maybe Pid
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Pid
</span><a href="#local-6989586621679056940"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-cpp">
#endif
</span><span>    </span><span class="annot"><span class="annottext">ProcessHandle__
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Pid -&gt; IO (Maybe Pid)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Pid
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-693"></span><span>
</span><span id="line-694"></span><span>
</span><span id="line-695"></span><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><span id="line-696"></span><span class="hs-comment">-- getCurrentPid</span><span>
</span><span id="line-697"></span><span>
</span><span id="line-698"></span><span class="hs-comment">-- | Returns the PID (process ID) of the current process. On POSIX systems,</span><span>
</span><span id="line-699"></span><span class="hs-comment">-- this calls 'getProcessID' from &quot;System.Posix.Process&quot; in the @unix@ package.</span><span>
</span><span id="line-700"></span><span class="hs-comment">-- On Windows, this calls 'getCurrentProcessId' from &quot;System.Win32.Process&quot; in</span><span>
</span><span id="line-701"></span><span class="hs-comment">-- the @Win32@ package.</span><span>
</span><span id="line-702"></span><span class="hs-comment">--</span><span>
</span><span id="line-703"></span><span class="hs-comment">-- @since 1.6.12.0</span><span>
</span><span id="line-704"></span><span class="annot"><a href="System.Process.html#getCurrentPid"><span class="hs-identifier hs-type">getCurrentPid</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="System.Process.html#Pid"><span class="hs-identifier hs-type">Pid</span></a></span><span>
</span><span id="line-705"></span><span id="getCurrentPid"><span class="annot"><span class="annottext">getCurrentPid :: IO Pid
</span><a href="System.Process.html#getCurrentPid"><span class="hs-identifier hs-var hs-var">getCurrentPid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span class="hs-cpp">
#if defined(javascript_HOST_ARCH)
</span><span>    </span><span class="hs-identifier">getCurrentProcessId</span><span class="hs-cpp">
#elif defined(mingw32_HOST_OS)
</span><span>    </span><span class="hs-identifier">getCurrentProcessId</span><span class="hs-cpp">
#else
</span><span>    </span><span class="annot"><span class="annottext">IO Pid
</span><a href="../../unix-2.8.6.0-c07b/src/System.Posix.Process.Common.html#getProcessID"><span class="hs-identifier hs-var">getProcessID</span></a></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-714"></span><span>
</span><span id="line-715"></span><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><span id="line-716"></span><span class="hs-comment">-- waitForProcess</span><span>
</span><span id="line-717"></span><span>
</span><span id="line-718"></span><span class="annot"><span class="hs-comment">{- | Waits for the specified process to terminate, and returns its exit code.
On Unix systems, may throw 'UserInterrupt' when using 'delegate_ctlc'.

GHC Note: in order to call @waitForProcess@ without blocking all the
other threads in the system, you must compile the program with
@-threaded@.

Note that it is safe to call @waitForProcess@ for the same process in multiple
threads. When the process ends, threads blocking on this call will wake in
FIFO order. When using 'delegate_ctlc' and the process is interrupted, only
the first waiting thread will throw 'UserInterrupt'.

(/Since: 1.2.0.0/) On Unix systems, a negative value @'ExitFailure' -/signum/@
indicates that the child was terminated by signal @/signum/@.
The signal numbers are platform-specific, so to test for a specific signal use
the constants provided by &quot;System.Posix.Signals&quot; in the @unix@ package.
Note: core dumps are not reported, use &quot;System.Posix.Process&quot; if you need this
detail.

-}</span></span><span>
</span><span id="line-738"></span><span class="annot"><a href="System.Process.html#waitForProcess"><span class="hs-identifier hs-type">waitForProcess</span></a></span><span>
</span><span id="line-739"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-type">ProcessHandle</span></a></span><span>
</span><span id="line-740"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExitCode</span></span><span>
</span><span id="line-741"></span><span id="waitForProcess"><span class="annot"><span class="annottext">waitForProcess :: ProcessHandle -&gt; IO ExitCode
</span><a href="System.Process.html#waitForProcess"><span class="hs-identifier hs-var hs-var">waitForProcess</span></a></span></span><span> </span><span id="local-6989586621679056941"><span class="annot"><span class="annottext">ph :: ProcessHandle
</span><a href="#local-6989586621679056941"><span class="hs-identifier hs-var">ph</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-type">ProcessHandle</span></a></span><span> </span><span class="annot"><span class="annottext">MVar ProcessHandle__
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679056942"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679056942"><span class="hs-identifier hs-var">delegating_ctlc</span></a></span></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO ExitCode -&gt; IO ExitCode
forall {b}. IO b -&gt; IO b
</span><a href="#local-6989586621679056943"><span class="hs-identifier hs-var">lockWaitpid</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ExitCode -&gt; IO ExitCode) -&gt; IO ExitCode -&gt; IO ExitCode
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-742"></span><span>  </span><span id="local-6989586621679056944"><span class="annot"><a href="#local-6989586621679056944"><span class="hs-identifier hs-var">p_</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ProcessHandle
-&gt; (ProcessHandle__ -&gt; IO (ProcessHandle__, ProcessHandle__))
-&gt; IO ProcessHandle__
forall a.
ProcessHandle
-&gt; (ProcessHandle__ -&gt; IO (ProcessHandle__, a)) -&gt; IO a
</span><a href="System.Process.Common.html#modifyProcessHandle"><span class="hs-identifier hs-var">modifyProcessHandle</span></a></span><span> </span><span class="annot"><span class="annottext">ProcessHandle
</span><a href="#local-6989586621679056941"><span class="hs-identifier hs-var">ph</span></a></span><span> </span><span class="annot"><span class="annottext">((ProcessHandle__ -&gt; IO (ProcessHandle__, ProcessHandle__))
 -&gt; IO ProcessHandle__)
-&gt; (ProcessHandle__ -&gt; IO (ProcessHandle__, ProcessHandle__))
-&gt; IO ProcessHandle__
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679056946"><span class="annot"><span class="annottext">ProcessHandle__
</span><a href="#local-6989586621679056946"><span class="hs-identifier hs-var">p_</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ProcessHandle__, ProcessHandle__)
-&gt; IO (ProcessHandle__, ProcessHandle__)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProcessHandle__
</span><a href="#local-6989586621679056946"><span class="hs-identifier hs-var">p_</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">ProcessHandle__
</span><a href="#local-6989586621679056946"><span class="hs-identifier hs-var">p_</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-743"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621679056944"><span class="hs-identifier hs-type">p_</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-744"></span><span>    </span><span class="annot"><a href="System.Process.Common.html#ClosedHandle"><span class="hs-identifier hs-type">ClosedHandle</span></a></span><span> </span><span id="local-6989586621679056948"><span class="annot"><span class="annottext">ExitCode
</span><a href="#local-6989586621679056948"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExitCode -&gt; IO ExitCode
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ExitCode
</span><a href="#local-6989586621679056948"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-745"></span><span>    </span><span class="annot"><a href="System.Process.Common.html#OpenHandle"><span class="hs-identifier hs-type">OpenHandle</span></a></span><span> </span><span id="local-6989586621679056949"><span class="annot"><span class="annottext">Pid
</span><a href="#local-6989586621679056949"><span class="hs-identifier hs-var">h</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-746"></span><span>        </span><span class="hs-comment">-- don't hold the MVar while we call c_waitForProcess...</span><span>
</span><span id="line-747"></span><span>        </span><span id="local-6989586621679056950"><span class="annot"><a href="#local-6989586621679056950"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Pid -&gt; IO ExitCode
</span><a href="#local-6989586621679056951"><span class="hs-identifier hs-var">waitForProcess'</span></a></span><span> </span><span class="annot"><span class="annottext">Pid
</span><a href="#local-6989586621679056949"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-748"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679056952"><span class="annot"><a href="#local-6989586621679056952"><span class="hs-identifier hs-var">e'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679056953"><span class="annot"><a href="#local-6989586621679056953"><span class="hs-identifier hs-var">was_open</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="System.Process.Common.html#modifyProcessHandle"><span class="hs-identifier hs-type">modifyProcessHandle</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056941"><span class="hs-identifier hs-type">ph</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679056954"><span class="annot"><span class="annottext">ProcessHandle__
</span><a href="#local-6989586621679056954"><span class="hs-identifier hs-var">p_'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-749"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ProcessHandle__
</span><a href="#local-6989586621679056954"><span class="hs-identifier hs-var">p_'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-750"></span><span>            </span><span class="annot"><a href="System.Process.Common.html#ClosedHandle"><span class="hs-identifier hs-type">ClosedHandle</span></a></span><span> </span><span id="local-6989586621679056955"><span class="annot"><span class="annottext">ExitCode
</span><a href="#local-6989586621679056955"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ProcessHandle__, (ExitCode, Bool))
-&gt; IO (ProcessHandle__, (ExitCode, Bool))
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProcessHandle__
</span><a href="#local-6989586621679056954"><span class="hs-identifier hs-var">p_'</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExitCode
</span><a href="#local-6989586621679056955"><span class="hs-identifier hs-var">e'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-751"></span><span>            </span><span class="annot"><a href="System.Process.Common.html#OpenExtHandle"><span class="hs-identifier hs-type">OpenExtHandle</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO (ProcessHandle__, (ExitCode, Bool))
forall a. String -&gt; IO a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;waitForProcess(OpenExtHandle): this cannot happen&quot;</span></span><span>
</span><span id="line-752"></span><span>            </span><span class="annot"><a href="System.Process.Common.html#OpenHandle"><span class="hs-identifier hs-type">OpenHandle</span></a></span><span> </span><span id="local-6989586621679056957"><span class="annot"><span class="annottext">Pid
</span><a href="#local-6989586621679056957"><span class="hs-identifier hs-var">ph'</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-753"></span><span>              </span><span class="annot"><span class="annottext">Pid -&gt; IO ()
</span><a href="System.Process.Posix.html#closePHANDLE"><span class="hs-identifier hs-var">closePHANDLE</span></a></span><span> </span><span class="annot"><span class="annottext">Pid
</span><a href="#local-6989586621679056957"><span class="hs-identifier hs-var">ph'</span></a></span><span>
</span><span id="line-754"></span><span>              </span><span class="annot"><span class="annottext">(ProcessHandle__, (ExitCode, Bool))
-&gt; IO (ProcessHandle__, (ExitCode, Bool))
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExitCode -&gt; ProcessHandle__
</span><a href="System.Process.Common.html#ClosedHandle"><span class="hs-identifier hs-var">ClosedHandle</span></a></span><span> </span><span class="annot"><span class="annottext">ExitCode
</span><a href="#local-6989586621679056950"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExitCode
</span><a href="#local-6989586621679056950"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-755"></span><span>        </span><span class="hs-comment">-- endDelegateControlC after closing the handle, since it</span><span>
</span><span id="line-756"></span><span>        </span><span class="hs-comment">-- may throw UserInterrupt</span><span>
</span><span id="line-757"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679056953"><span class="hs-identifier hs-type">was_open</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><a href="#local-6989586621679056942"><span class="hs-identifier hs-type">delegating_ctlc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-758"></span><span>          </span><span class="annot"><a href="System.Process.Posix.html#endDelegateControlC"><span class="hs-identifier hs-type">endDelegateControlC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056950"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-759"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621679056952"><span class="hs-identifier hs-type">e'</span></a></span><span class="hs-cpp">
#if defined(mingw32_HOST_OS)
</span><span>    </span><span class="hs-identifier">OpenExtHandle</span><span> </span><span class="hs-identifier">h</span><span> </span><span class="hs-identifier">job</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-762"></span><span>        </span><span class="hs-comment">-- First wait for completion of the job...</span><span>
</span><span id="line-763"></span><span>        </span><span class="hs-identifier">waitForJobCompletion</span><span> </span><span class="hs-identifier">job</span><span>
</span><span id="line-764"></span><span>        </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">waitForProcess'</span><span> </span><span class="hs-identifier">h</span><span>
</span><span id="line-765"></span><span>        </span><span class="hs-identifier">e'</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">modifyProcessHandle</span><span> </span><span class="hs-identifier">ph</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">p_'</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-766"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">p_'</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-767"></span><span>            </span><span class="hs-identifier">ClosedHandle</span><span> </span><span class="hs-identifier">e'</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">p_'</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">e'</span><span class="hs-special">)</span><span>
</span><span id="line-768"></span><span>            </span><span class="hs-identifier">OpenHandle</span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">fail</span><span> </span><span class="hs-string">&quot;waitForProcess(OpenHandle): this cannot happen&quot;</span><span>
</span><span id="line-769"></span><span>            </span><span class="hs-identifier">OpenExtHandle</span><span> </span><span class="hs-identifier">ph'</span><span> </span><span class="hs-identifier">job'</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-770"></span><span>              </span><span class="hs-identifier">closePHANDLE</span><span> </span><span class="hs-identifier">ph'</span><span>
</span><span id="line-771"></span><span>              </span><span class="hs-identifier">closePHANDLE</span><span> </span><span class="hs-identifier">job'</span><span>
</span><span id="line-772"></span><span>              </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ClosedHandle</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span>
</span><span id="line-773"></span><span>        </span><span class="hs-comment">-- omit endDelegateControlC since it's a no-op on Windows</span><span>
</span><span id="line-774"></span><span>        </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">e'</span><span class="hs-cpp">
#else
</span><span>    </span><span class="annot"><a href="System.Process.Common.html#OpenExtHandle"><span class="hs-identifier hs-type">OpenExtHandle</span></a></span><span> </span><span class="annot"><span class="annottext">Pid
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679056960"><span class="annot"><span class="annottext">Pid
</span><a href="#local-6989586621679056960"><span class="hs-identifier hs-var">_job</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-777"></span><span>        </span><span class="annot"><span class="annottext">ExitCode -&gt; IO ExitCode
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ExitCode -&gt; IO ExitCode) -&gt; ExitCode -&gt; IO ExitCode
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ExitCode
</span><span class="hs-identifier hs-var">ExitFailure</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-780"></span><span>    </span><span class="hs-comment">-- If more than one thread calls `waitpid` at a time, `waitpid` will</span><span>
</span><span id="line-781"></span><span>    </span><span class="hs-comment">-- return the exit code to one of them and (-1) to the rest of them,</span><span>
</span><span id="line-782"></span><span>    </span><span class="hs-comment">-- causing an exception to be thrown.</span><span>
</span><span id="line-783"></span><span>    </span><span class="hs-comment">-- Cf. https://github.com/haskell/process/issues/46, and</span><span>
</span><span id="line-784"></span><span>    </span><span class="hs-comment">-- https://github.com/haskell/process/pull/58 for further discussion</span><span>
</span><span id="line-785"></span><span>    </span><span id="local-6989586621679056943"><span class="annot"><span class="annottext">lockWaitpid :: IO b -&gt; IO b
</span><a href="#local-6989586621679056943"><span class="hs-identifier hs-var hs-var">lockWaitpid</span></a></span></span><span> </span><span id="local-6989586621679056961"><span class="annot"><span class="annottext">IO b
</span><a href="#local-6989586621679056961"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MVar () -&gt; (() -&gt; IO b) -&gt; IO b
forall a b. MVar a -&gt; (a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">withMVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProcessHandle -&gt; MVar ()
</span><a href="System.Process.Common.html#waitpidLock"><span class="hs-identifier hs-var">waitpidLock</span></a></span><span> </span><span class="annot"><span class="annottext">ProcessHandle
</span><a href="#local-6989586621679056941"><span class="hs-identifier hs-var">ph</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((() -&gt; IO b) -&gt; IO b) -&gt; (() -&gt; IO b) -&gt; IO b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO b
</span><a href="#local-6989586621679056961"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-786"></span><span>
</span><span id="line-787"></span><span>    </span><span class="annot"><a href="#local-6989586621679056951"><span class="hs-identifier hs-type">waitForProcess'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.Process.Common.html#PHANDLE"><span class="hs-identifier hs-type">PHANDLE</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExitCode</span></span><span>
</span><span id="line-788"></span><span>    </span><span id="local-6989586621679056951"><span class="annot"><span class="annottext">waitForProcess' :: Pid -&gt; IO ExitCode
</span><a href="#local-6989586621679056951"><span class="hs-identifier hs-var hs-var">waitForProcess'</span></a></span></span><span> </span><span id="local-6989586621679056965"><span class="annot"><span class="annottext">Pid
</span><a href="#local-6989586621679056965"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Ptr CInt -&gt; IO ExitCode) -&gt; IO ExitCode
forall a b. Storable a =&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">alloca</span></span><span> </span><span class="annot"><span class="annottext">((Ptr CInt -&gt; IO ExitCode) -&gt; IO ExitCode)
-&gt; (Ptr CInt -&gt; IO ExitCode) -&gt; IO ExitCode
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679056967"><span class="annot"><span class="annottext">Ptr CInt
</span><a href="#local-6989586621679056967"><span class="hs-identifier hs-var">pret</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span class="hs-cpp">
#if defined(javascript_HOST_ARCH)
</span><span>      </span><span class="hs-identifier">throwErrnoIfMinus1Retry_</span><span> </span><span class="hs-string">&quot;waitForProcess&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">C.interruptible</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">c_waitForProcess</span><span> </span><span class="hs-identifier">h</span><span> </span><span class="hs-identifier">pret</span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span>      </span><span class="annot"><span class="annottext">String -&gt; IO CInt -&gt; IO ()
forall a. (Eq a, Num a) =&gt; String -&gt; IO a -&gt; IO ()
</span><span class="hs-identifier hs-var">throwErrnoIfMinus1Retry_</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;waitForProcess&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO ()
</span><span class="hs-identifier hs-var">allowInterrupt</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO CInt -&gt; IO CInt
forall a b. IO a -&gt; IO b -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pid -&gt; Ptr CInt -&gt; IO CInt
</span><a href="System.Process.html#c_waitForProcess"><span class="hs-identifier hs-var">c_waitForProcess</span></a></span><span> </span><span class="annot"><span class="annottext">Pid
</span><a href="#local-6989586621679056965"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr CInt
</span><a href="#local-6989586621679056967"><span class="hs-identifier hs-var">pret</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>      </span><span class="annot"><span class="annottext">CInt -&gt; ExitCode
</span><a href="#local-6989586621679056970"><span class="hs-identifier hs-var">mkExitCode</span></a></span><span> </span><span class="annot"><span class="annottext">(CInt -&gt; ExitCode) -&gt; IO CInt -&gt; IO ExitCode
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Ptr CInt -&gt; IO CInt
forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><span class="hs-identifier hs-var">peek</span></span><span> </span><span class="annot"><span class="annottext">Ptr CInt
</span><a href="#local-6989586621679056967"><span class="hs-identifier hs-var">pret</span></a></span><span>
</span><span id="line-795"></span><span>
</span><span id="line-796"></span><span>    </span><span class="annot"><a href="#local-6989586621679056970"><span class="hs-identifier hs-type">mkExitCode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CInt</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExitCode</span></span><span>
</span><span id="line-797"></span><span>    </span><span id="local-6989586621679056970"><span class="annot"><span class="annottext">mkExitCode :: CInt -&gt; ExitCode
</span><a href="#local-6989586621679056970"><span class="hs-identifier hs-var hs-var">mkExitCode</span></a></span></span><span> </span><span id="local-6989586621679056973"><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679056973"><span class="hs-identifier hs-var">code</span></a></span></span><span>
</span><span id="line-798"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679056973"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">CInt -&gt; CInt -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">CInt
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExitCode
</span><span class="hs-identifier hs-var">ExitSuccess</span></span><span>
</span><span id="line-799"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ExitCode
</span><span class="hs-identifier hs-var">ExitFailure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CInt -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679056973"><span class="hs-identifier hs-var">code</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-800"></span><span>
</span><span id="line-801"></span><span>
</span><span id="line-802"></span><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><span id="line-803"></span><span class="hs-comment">-- getProcessExitCode</span><span>
</span><span id="line-804"></span><span>
</span><span id="line-805"></span><span class="annot"><span class="hs-comment">{- |
This is a non-blocking version of 'waitForProcess'.  If the process is
still running, 'Nothing' is returned.  If the process has exited, then
@'Just' e@ is returned where @e@ is the exit code of the process.

On Unix systems, see 'waitForProcess' for the meaning of exit codes
when the process died as the result of a signal. May throw
'UserInterrupt' when using 'delegate_ctlc'.
-}</span></span><span>
</span><span id="line-814"></span><span>
</span><span id="line-815"></span><span class="annot"><a href="System.Process.html#getProcessExitCode"><span class="hs-identifier hs-type">getProcessExitCode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-type">ProcessHandle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExitCode</span></span><span class="hs-special">)</span><span>
</span><span id="line-816"></span><span id="getProcessExitCode"><span class="annot"><span class="annottext">getProcessExitCode :: ProcessHandle -&gt; IO (Maybe ExitCode)
</span><a href="System.Process.html#getProcessExitCode"><span class="hs-identifier hs-var hs-var">getProcessExitCode</span></a></span></span><span> </span><span id="local-6989586621679056974"><span class="annot"><span class="annottext">ph :: ProcessHandle
</span><a href="#local-6989586621679056974"><span class="hs-identifier hs-var">ph</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-type">ProcessHandle</span></a></span><span> </span><span class="annot"><span class="annottext">MVar ProcessHandle__
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679056975"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679056975"><span class="hs-identifier hs-var">delegating_ctlc</span></a></span></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Maybe ExitCode) -&gt; IO (Maybe ExitCode)
</span><a href="#local-6989586621679056976"><span class="hs-identifier hs-var">tryLockWaitpid</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe ExitCode) -&gt; IO (Maybe ExitCode))
-&gt; IO (Maybe ExitCode) -&gt; IO (Maybe ExitCode)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-817"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679056977"><span class="annot"><a href="#local-6989586621679056977"><span class="hs-identifier hs-var">m_e</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679056978"><span class="annot"><a href="#local-6989586621679056978"><span class="hs-identifier hs-var">was_open</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ProcessHandle
-&gt; (ProcessHandle__
    -&gt; IO (ProcessHandle__, (Maybe ExitCode, Bool)))
-&gt; IO (Maybe ExitCode, Bool)
forall a.
ProcessHandle
-&gt; (ProcessHandle__ -&gt; IO (ProcessHandle__, a)) -&gt; IO a
</span><a href="System.Process.Common.html#modifyProcessHandle"><span class="hs-identifier hs-var">modifyProcessHandle</span></a></span><span> </span><span class="annot"><span class="annottext">ProcessHandle
</span><a href="#local-6989586621679056974"><span class="hs-identifier hs-var">ph</span></a></span><span> </span><span class="annot"><span class="annottext">((ProcessHandle__ -&gt; IO (ProcessHandle__, (Maybe ExitCode, Bool)))
 -&gt; IO (Maybe ExitCode, Bool))
-&gt; (ProcessHandle__
    -&gt; IO (ProcessHandle__, (Maybe ExitCode, Bool)))
-&gt; IO (Maybe ExitCode, Bool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679056979"><span class="annot"><span class="annottext">ProcessHandle__
</span><a href="#local-6989586621679056979"><span class="hs-identifier hs-var">p_</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-818"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ProcessHandle__
</span><a href="#local-6989586621679056979"><span class="hs-identifier hs-var">p_</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-819"></span><span>      </span><span class="annot"><a href="System.Process.Common.html#ClosedHandle"><span class="hs-identifier hs-type">ClosedHandle</span></a></span><span> </span><span id="local-6989586621679056980"><span class="annot"><span class="annottext">ExitCode
</span><a href="#local-6989586621679056980"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ProcessHandle__, (Maybe ExitCode, Bool))
-&gt; IO (ProcessHandle__, (Maybe ExitCode, Bool))
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProcessHandle__
</span><a href="#local-6989586621679056979"><span class="hs-identifier hs-var">p_</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExitCode -&gt; Maybe ExitCode
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ExitCode
</span><a href="#local-6989586621679056980"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-820"></span><span>      </span><span id="local-6989586621679056981"><span class="annot"><span class="annottext">ProcessHandle__
</span><a href="#local-6989586621679056981"><span class="hs-identifier hs-var">open</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-821"></span><span>        </span><span class="annot"><span class="annottext">(Ptr CInt -&gt; IO (ProcessHandle__, (Maybe ExitCode, Bool)))
-&gt; IO (ProcessHandle__, (Maybe ExitCode, Bool))
forall a b. Storable a =&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">alloca</span></span><span> </span><span class="annot"><span class="annottext">((Ptr CInt -&gt; IO (ProcessHandle__, (Maybe ExitCode, Bool)))
 -&gt; IO (ProcessHandle__, (Maybe ExitCode, Bool)))
-&gt; (Ptr CInt -&gt; IO (ProcessHandle__, (Maybe ExitCode, Bool)))
-&gt; IO (ProcessHandle__, (Maybe ExitCode, Bool))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679056982"><span class="annot"><span class="annottext">Ptr CInt
</span><a href="#local-6989586621679056982"><span class="hs-identifier hs-var">pExitCode</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-822"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ProcessHandle__ -&gt; Maybe Pid
</span><a href="#local-6989586621679056983"><span class="hs-identifier hs-var">getHandle</span></a></span><span> </span><span class="annot"><span class="annottext">ProcessHandle__
</span><a href="#local-6989586621679056981"><span class="hs-identifier hs-var">open</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-823"></span><span>            </span><span class="annot"><span class="annottext">Maybe Pid
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ProcessHandle__, (Maybe ExitCode, Bool))
-&gt; IO (ProcessHandle__, (Maybe ExitCode, Bool))
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProcessHandle__
</span><a href="#local-6989586621679056979"><span class="hs-identifier hs-var">p_</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe ExitCode
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-824"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679056984"><span class="annot"><span class="annottext">Pid
</span><a href="#local-6989586621679056984"><span class="hs-identifier hs-var">h</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-825"></span><span>                </span><span id="local-6989586621679056985"><span class="annot"><a href="#local-6989586621679056985"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO CInt -&gt; IO CInt
forall a. (Eq a, Num a) =&gt; String -&gt; IO a -&gt; IO a
</span><span class="hs-identifier hs-var">throwErrnoIfMinus1Retry</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getProcessExitCode&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO CInt -&gt; IO CInt) -&gt; IO CInt -&gt; IO CInt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-826"></span><span>                                        </span><span class="annot"><span class="annottext">Pid -&gt; Ptr CInt -&gt; IO CInt
</span><a href="System.Process.html#c_getProcessExitCode"><span class="hs-identifier hs-var">c_getProcessExitCode</span></a></span><span> </span><span class="annot"><span class="annottext">Pid
</span><a href="#local-6989586621679056984"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr CInt
</span><a href="#local-6989586621679056982"><span class="hs-identifier hs-var">pExitCode</span></a></span><span>
</span><span id="line-827"></span><span>                </span><span id="local-6989586621679056988"><span class="annot"><a href="#local-6989586621679056988"><span class="hs-identifier hs-var">code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">peek</span></span><span> </span><span class="annot"><a href="#local-6989586621679056982"><span class="hs-identifier hs-type">pExitCode</span></a></span><span>
</span><span id="line-828"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621679056985"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-829"></span><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679056979"><span class="hs-identifier hs-type">p_</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-830"></span><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-831"></span><span>                        </span><span class="annot"><a href="System.Process.Posix.html#closePHANDLE"><span class="hs-identifier hs-type">closePHANDLE</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056984"><span class="hs-identifier hs-type">h</span></a></span><span>
</span><span id="line-832"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679056993"><span class="annot"><a href="#local-6989586621679056993"><span class="hs-identifier hs-var hs-var">e</span></a></span></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679056988"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">CInt -&gt; CInt -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">CInt
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExitCode
</span><span class="hs-identifier hs-var">ExitSuccess</span></span><span>
</span><span id="line-833"></span><span>                               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ExitCode
</span><span class="hs-identifier hs-var">ExitFailure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CInt -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679056988"><span class="hs-identifier hs-var">code</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-834"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="System.Process.Common.html#ClosedHandle"><span class="hs-identifier hs-type">ClosedHandle</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056993"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621679056993"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-835"></span><span>  </span><span class="hs-comment">-- endDelegateControlC after closing the handle, since it</span><span>
</span><span id="line-836"></span><span>  </span><span class="hs-comment">-- may throw UserInterrupt</span><span>
</span><span id="line-837"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621679056977"><span class="hs-identifier hs-type">m_e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-838"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679056994"><span class="annot"><span class="annottext">ExitCode
</span><a href="#local-6989586621679056994"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679056978"><span class="hs-identifier hs-var">was_open</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679056975"><span class="hs-identifier hs-var">delegating_ctlc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExitCode -&gt; IO ()
</span><a href="System.Process.Posix.html#endDelegateControlC"><span class="hs-identifier hs-var">endDelegateControlC</span></a></span><span> </span><span class="annot"><span class="annottext">ExitCode
</span><a href="#local-6989586621679056994"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-839"></span><span>    </span><span class="annot"><span class="annottext">Maybe ExitCode
</span><span class="hs-identifier">_</span></span><span>                                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-840"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621679056977"><span class="hs-identifier hs-type">m_e</span></a></span><span>
</span><span id="line-841"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span class="annot"><a href="#local-6989586621679056983"><span class="hs-identifier hs-type">getHandle</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.Process.Common.html#ProcessHandle__"><span class="hs-identifier hs-type">ProcessHandle__</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="System.Process.Common.html#PHANDLE"><span class="hs-identifier hs-type">PHANDLE</span></a></span><span>
</span><span id="line-842"></span><span>          </span><span id="local-6989586621679056983"><span class="annot"><span class="annottext">getHandle :: ProcessHandle__ -&gt; Maybe Pid
</span><a href="#local-6989586621679056983"><span class="hs-identifier hs-var hs-var">getHandle</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="System.Process.Common.html#OpenHandle"><span class="hs-identifier hs-type">OpenHandle</span></a></span><span>        </span><span id="local-6989586621679056995"><span class="annot"><span class="annottext">Pid
</span><a href="#local-6989586621679056995"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pid -&gt; Maybe Pid
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Pid
</span><a href="#local-6989586621679056995"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-843"></span><span>          </span><span class="annot"><a href="#local-6989586621679056983"><span class="hs-identifier hs-var">getHandle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="System.Process.Common.html#ClosedHandle"><span class="hs-identifier hs-type">ClosedHandle</span></a></span><span>      </span><span class="annot"><span class="annottext">ExitCode
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Pid
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-844"></span><span>          </span><span class="annot"><a href="#local-6989586621679056983"><span class="hs-identifier hs-var">getHandle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="System.Process.Common.html#OpenExtHandle"><span class="hs-identifier hs-type">OpenExtHandle</span></a></span><span>   </span><span id="local-6989586621679056996"><span class="annot"><span class="annottext">Pid
</span><a href="#local-6989586621679056996"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="annot"><span class="annottext">Pid
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pid -&gt; Maybe Pid
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Pid
</span><a href="#local-6989586621679056996"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-845"></span><span>
</span><span id="line-846"></span><span>          </span><span class="hs-comment">-- If somebody is currently holding the waitpid lock, we don't want to</span><span>
</span><span id="line-847"></span><span>          </span><span class="hs-comment">-- accidentally remove the pid from the process table.</span><span>
</span><span id="line-848"></span><span>          </span><span class="hs-comment">-- Try acquiring the waitpid lock. If it is held, we are done</span><span>
</span><span id="line-849"></span><span>          </span><span class="hs-comment">-- since that means the process is still running and we can return</span><span>
</span><span id="line-850"></span><span>          </span><span class="hs-comment">-- `Nothing`. If it is not held, acquire it so we can run the</span><span>
</span><span id="line-851"></span><span>          </span><span class="hs-comment">-- (non-blocking) call to `waitpid` without worrying about any</span><span>
</span><span id="line-852"></span><span>          </span><span class="hs-comment">-- other threads calling it at the same time.</span><span>
</span><span id="line-853"></span><span>          </span><span class="annot"><a href="#local-6989586621679056976"><span class="hs-identifier hs-type">tryLockWaitpid</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExitCode</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExitCode</span></span><span class="hs-special">)</span><span>
</span><span id="line-854"></span><span>          </span><span id="local-6989586621679056976"><span class="annot"><span class="annottext">tryLockWaitpid :: IO (Maybe ExitCode) -&gt; IO (Maybe ExitCode)
</span><a href="#local-6989586621679056976"><span class="hs-identifier hs-var hs-var">tryLockWaitpid</span></a></span></span><span> </span><span id="local-6989586621679056997"><span class="annot"><span class="annottext">IO (Maybe ExitCode)
</span><a href="#local-6989586621679056997"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Maybe ())
-&gt; (Maybe () -&gt; IO ())
-&gt; (Maybe () -&gt; IO (Maybe ExitCode))
-&gt; IO (Maybe ExitCode)
forall a b c. IO a -&gt; (a -&gt; IO b) -&gt; (a -&gt; IO c) -&gt; IO c
</span><span class="hs-identifier hs-var">bracket</span></span><span> </span><span class="annot"><span class="annottext">IO (Maybe ())
</span><a href="#local-6989586621679056998"><span class="hs-identifier hs-var">acquire</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe () -&gt; IO ()
</span><a href="#local-6989586621679056999"><span class="hs-identifier hs-var">release</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe () -&gt; IO (Maybe ExitCode)
</span><a href="#local-6989586621679057000"><span class="hs-identifier hs-var">between</span></a></span><span>
</span><span id="line-855"></span><span>            </span><span class="hs-keyword">where</span><span>
</span><span id="line-856"></span><span>              </span><span id="local-6989586621679056998"><span class="annot"><span class="annottext">acquire :: IO (Maybe ())
</span><a href="#local-6989586621679056998"><span class="hs-identifier hs-var hs-var">acquire</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MVar () -&gt; IO (Maybe ())
forall a. MVar a -&gt; IO (Maybe a)
</span><span class="hs-identifier hs-var">tryTakeMVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProcessHandle -&gt; MVar ()
</span><a href="System.Process.Common.html#waitpidLock"><span class="hs-identifier hs-var">waitpidLock</span></a></span><span> </span><span class="annot"><span class="annottext">ProcessHandle
</span><a href="#local-6989586621679056974"><span class="hs-identifier hs-var">ph</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-857"></span><span>              </span><span id="local-6989586621679056999"><span class="annot"><span class="annottext">release :: Maybe () -&gt; IO ()
</span><a href="#local-6989586621679056999"><span class="hs-identifier hs-var hs-var">release</span></a></span></span><span> </span><span id="local-6989586621679057003"><span class="annot"><span class="annottext">Maybe ()
</span><a href="#local-6989586621679057003"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ()
</span><a href="#local-6989586621679057003"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-858"></span><span>                </span><span class="annot"><span class="annottext">Maybe ()
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-859"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MVar () -&gt; () -&gt; IO ()
forall a. MVar a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">putMVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProcessHandle -&gt; MVar ()
</span><a href="System.Process.Common.html#waitpidLock"><span class="hs-identifier hs-var">waitpidLock</span></a></span><span> </span><span class="annot"><span class="annottext">ProcessHandle
</span><a href="#local-6989586621679056974"><span class="hs-identifier hs-var">ph</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-860"></span><span>              </span><span id="local-6989586621679057000"><span class="annot"><span class="annottext">between :: Maybe () -&gt; IO (Maybe ExitCode)
</span><a href="#local-6989586621679057000"><span class="hs-identifier hs-var hs-var">between</span></a></span></span><span> </span><span id="local-6989586621679057006"><span class="annot"><span class="annottext">Maybe ()
</span><a href="#local-6989586621679057006"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ()
</span><a href="#local-6989586621679057006"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-861"></span><span>                </span><span class="annot"><span class="annottext">Maybe ()
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ExitCode -&gt; IO (Maybe ExitCode)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe ExitCode
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-862"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO (Maybe ExitCode)
</span><a href="#local-6989586621679056997"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-863"></span><span>
</span><span id="line-864"></span><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><span id="line-865"></span><span class="hs-comment">-- terminateProcess</span><span>
</span><span id="line-866"></span><span>
</span><span id="line-867"></span><span class="hs-comment">-- | Attempts to terminate the specified process.  This function should</span><span>
</span><span id="line-868"></span><span class="hs-comment">-- not be used under normal circumstances - no guarantees are given regarding</span><span>
</span><span id="line-869"></span><span class="hs-comment">-- how cleanly the process is terminated.  To check whether the process</span><span>
</span><span id="line-870"></span><span class="hs-comment">-- has indeed terminated, use 'getProcessExitCode'.</span><span>
</span><span id="line-871"></span><span class="hs-comment">--</span><span>
</span><span id="line-872"></span><span class="hs-comment">-- On Unix systems, 'terminateProcess' sends the process the SIGTERM signal.</span><span>
</span><span id="line-873"></span><span class="hs-comment">-- On Windows systems, if `use_process_jobs` is `True` then the Win32 @TerminateJobObject@</span><span>
</span><span id="line-874"></span><span class="hs-comment">-- function is called to kill all processes associated with the job and passing the</span><span>
</span><span id="line-875"></span><span class="hs-comment">-- exit code of 1 to each of them. Otherwise if `use_process_jobs` is `False` then the</span><span>
</span><span id="line-876"></span><span class="hs-comment">-- Win32 @TerminateProcess@ function is called, passing an exit code of 1.</span><span>
</span><span id="line-877"></span><span class="hs-comment">--</span><span>
</span><span id="line-878"></span><span class="hs-comment">-- Note: on Windows, if the process was a shell command created by</span><span>
</span><span id="line-879"></span><span class="hs-comment">-- 'createProcess' with 'shell', or created by 'runCommand' or</span><span>
</span><span id="line-880"></span><span class="hs-comment">-- 'runInteractiveCommand', then 'terminateProcess' will only</span><span>
</span><span id="line-881"></span><span class="hs-comment">-- terminate the shell, not the command itself.  On Unix systems, both</span><span>
</span><span id="line-882"></span><span class="hs-comment">-- processes are in a process group and will be terminated together.</span><span>
</span><span id="line-883"></span><span>
</span><span id="line-884"></span><span class="annot"><a href="System.Process.html#terminateProcess"><span class="hs-identifier hs-type">terminateProcess</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-type">ProcessHandle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-885"></span><span id="terminateProcess"><span class="annot"><span class="annottext">terminateProcess :: ProcessHandle -&gt; IO ()
</span><a href="System.Process.html#terminateProcess"><span class="hs-identifier hs-var hs-var">terminateProcess</span></a></span></span><span> </span><span id="local-6989586621679057007"><span class="annot"><span class="annottext">ProcessHandle
</span><a href="#local-6989586621679057007"><span class="hs-identifier hs-var">ph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-886"></span><span>  </span><span class="annot"><span class="annottext">ProcessHandle -&gt; (ProcessHandle__ -&gt; IO ()) -&gt; IO ()
forall a. ProcessHandle -&gt; (ProcessHandle__ -&gt; IO a) -&gt; IO a
</span><a href="System.Process.Common.html#withProcessHandle"><span class="hs-identifier hs-var">withProcessHandle</span></a></span><span> </span><span class="annot"><span class="annottext">ProcessHandle
</span><a href="#local-6989586621679057007"><span class="hs-identifier hs-var">ph</span></a></span><span> </span><span class="annot"><span class="annottext">((ProcessHandle__ -&gt; IO ()) -&gt; IO ())
-&gt; (ProcessHandle__ -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679057009"><span class="annot"><span class="annottext">ProcessHandle__
</span><a href="#local-6989586621679057009"><span class="hs-identifier hs-var">p_</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-887"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ProcessHandle__
</span><a href="#local-6989586621679057009"><span class="hs-identifier hs-var">p_</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-888"></span><span>      </span><span class="annot"><a href="System.Process.Common.html#ClosedHandle"><span class="hs-identifier hs-type">ClosedHandle</span></a></span><span>  </span><span class="annot"><span class="annottext">ExitCode
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-cpp">
#if defined(mingw32_HOST_OS)
</span><span>      </span><span class="hs-identifier">OpenExtHandle</span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">terminateJobUnsafe</span><span> </span><span class="hs-identifier">p_</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator">&gt;&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span>      </span><span class="annot"><a href="System.Process.Common.html#OpenExtHandle"><span class="hs-identifier hs-type">OpenExtHandle</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;terminateProcess with OpenExtHandle should not happen on POSIX.&quot;</span></span><span class="hs-cpp">
#endif
</span><span>      </span><span class="annot"><a href="System.Process.Common.html#OpenHandle"><span class="hs-identifier hs-type">OpenHandle</span></a></span><span>    </span><span id="local-6989586621679057010"><span class="annot"><span class="annottext">Pid
</span><a href="#local-6989586621679057010"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-895"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO CInt -&gt; IO ()
forall a. (Eq a, Num a) =&gt; String -&gt; IO a -&gt; IO ()
</span><span class="hs-identifier hs-var">throwErrnoIfMinus1Retry_</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;terminateProcess&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO CInt -&gt; IO ()) -&gt; IO CInt -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pid -&gt; IO CInt
</span><a href="System.Process.html#c_terminateProcess"><span class="hs-identifier hs-var">c_terminateProcess</span></a></span><span> </span><span class="annot"><span class="annottext">Pid
</span><a href="#local-6989586621679057010"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-896"></span><span>        </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-897"></span><span>        </span><span class="hs-comment">-- does not close the handle, we might want to try terminating it</span><span>
</span><span id="line-898"></span><span>        </span><span class="hs-comment">-- again, or get its exit code.</span><span>
</span><span id="line-899"></span><span>
</span><span id="line-900"></span><span>
</span><span id="line-901"></span><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><span id="line-902"></span><span class="hs-comment">-- Interface to C bits</span><span class="hs-cpp">

#if defined(wasm32_HOST_ARCH)
</span><span>
</span><span id="line-906"></span><span class="hs-identifier">c_terminateProcess</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">PHANDLE</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><span id="line-907"></span><span class="hs-identifier">c_terminateProcess</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ioError</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ioeSetLocation</span><span> </span><span class="hs-identifier">unsupportedOperation</span><span> </span><span class="hs-string">&quot;terminateProcess&quot;</span><span class="hs-special">)</span><span>
</span><span id="line-908"></span><span>
</span><span id="line-909"></span><span class="hs-identifier">c_getProcessExitCode</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">PHANDLE</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><span id="line-910"></span><span class="hs-identifier">c_getProcessExitCode</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ioError</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ioeSetLocation</span><span> </span><span class="hs-identifier">unsupportedOperation</span><span> </span><span class="hs-string">&quot;getProcessExitCode&quot;</span><span class="hs-special">)</span><span>
</span><span id="line-911"></span><span>
</span><span id="line-912"></span><span class="hs-identifier">c_waitForProcess</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">PHANDLE</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><span id="line-913"></span><span class="hs-identifier">c_waitForProcess</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ioError</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ioeSetLocation</span><span> </span><span class="hs-identifier">unsupportedOperation</span><span> </span><span class="hs-string">&quot;waitForProcess&quot;</span><span class="hs-special">)</span><span class="hs-cpp">

#elif defined(javascript_HOST_ARCH)
</span><span>
</span><span id="line-917"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">javascript</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;h$process_terminateProcess&quot;</span><span>
</span><span id="line-918"></span><span>  </span><span class="hs-identifier">c_terminateProcess</span><span>
</span><span id="line-919"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">PHANDLE</span><span>
</span><span id="line-920"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Int</span><span>
</span><span id="line-921"></span><span>
</span><span id="line-922"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">javascript</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;h$process_getProcessExitCode&quot;</span><span>
</span><span id="line-923"></span><span>  </span><span class="hs-identifier">c_getProcessExitCode</span><span>
</span><span id="line-924"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">PHANDLE</span><span>
</span><span id="line-925"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">Int</span><span>
</span><span id="line-926"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Int</span><span>
</span><span id="line-927"></span><span>
</span><span id="line-928"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">javascript</span><span> </span><span class="hs-keyword">interruptible</span><span> </span><span class="hs-string">&quot;h$process_waitForProcess&quot;</span><span>
</span><span id="line-929"></span><span>  </span><span class="hs-identifier">c_waitForProcess</span><span>
</span><span id="line-930"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">PHANDLE</span><span>
</span><span id="line-931"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><span id="line-932"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span class="hs-cpp">

#else
</span><span>
</span><span id="line-936"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-keyword">unsafe</span></span><span> </span><span class="annot"><span class="hs-string">&quot;terminateProcess&quot;</span></span><span>
</span><span id="line-937"></span><span>  </span><span id="c_terminateProcess"><span class="annot"><a href="System.Process.html#c_terminateProcess"><span class="hs-identifier hs-var">c_terminateProcess</span></a></span></span><span>
</span><span id="line-938"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.Process.Common.html#PHANDLE"><span class="hs-identifier hs-type">PHANDLE</span></a></span><span>
</span><span id="line-939"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CInt</span></span><span>
</span><span id="line-940"></span><span>
</span><span id="line-941"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-keyword">unsafe</span></span><span> </span><span class="annot"><span class="hs-string">&quot;getProcessExitCode&quot;</span></span><span>
</span><span id="line-942"></span><span>  </span><span id="c_getProcessExitCode"><span class="annot"><a href="System.Process.html#c_getProcessExitCode"><span class="hs-identifier hs-var">c_getProcessExitCode</span></a></span></span><span>
</span><span id="line-943"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.Process.Common.html#PHANDLE"><span class="hs-identifier hs-type">PHANDLE</span></a></span><span>
</span><span id="line-944"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CInt</span></span><span>
</span><span id="line-945"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CInt</span></span><span>
</span><span id="line-946"></span><span>
</span><span id="line-947"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-keyword">interruptible</span></span><span> </span><span class="annot"><span class="hs-string">&quot;waitForProcess&quot;</span></span><span> </span><span class="hs-comment">-- NB. safe - can block</span><span>
</span><span id="line-948"></span><span>  </span><span id="c_waitForProcess"><span class="annot"><a href="System.Process.html#c_waitForProcess"><span class="hs-identifier hs-var">c_waitForProcess</span></a></span></span><span>
</span><span id="line-949"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.Process.Common.html#PHANDLE"><span class="hs-identifier hs-type">PHANDLE</span></a></span><span>
</span><span id="line-950"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CInt</span></span><span>
</span><span id="line-951"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CInt</span></span><span class="hs-cpp">

#endif
</span><span>
</span><span id="line-955"></span><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><span id="line-956"></span><span class="hs-comment">-- Old deprecated variants</span><span>
</span><span id="line-957"></span><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><span id="line-958"></span><span>
</span><span id="line-959"></span><span class="hs-comment">-- TODO: We're not going to mark these functions as DEPRECATED immediately in</span><span>
</span><span id="line-960"></span><span class="hs-comment">-- process-1.2.0.0. That's because some of their replacements have not been</span><span>
</span><span id="line-961"></span><span class="hs-comment">-- around for all that long. But they should eventually be marked with a</span><span>
</span><span id="line-962"></span><span class="hs-comment">-- suitable DEPRECATED pragma after a release or two.</span><span>
</span><span id="line-963"></span><span>
</span><span id="line-964"></span><span>
</span><span id="line-965"></span><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><span id="line-966"></span><span class="hs-comment">-- runCommand</span><span>
</span><span id="line-967"></span><span>
</span><span id="line-968"></span><span class="hs-comment">--TODO: in a later release {-# DEPRECATED runCommand &quot;Use 'spawnCommand' instead&quot; #-}</span><span>
</span><span id="line-969"></span><span>
</span><span id="line-970"></span><span class="annot"><span class="hs-comment">{- | Runs a command using the shell.
 -}</span></span><span>
</span><span id="line-972"></span><span class="annot"><a href="System.Process.html#runCommand"><span class="hs-identifier hs-type">runCommand</span></a></span><span>
</span><span id="line-973"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-974"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-type">ProcessHandle</span></a></span><span>
</span><span id="line-975"></span><span>
</span><span id="line-976"></span><span id="runCommand"><span class="annot"><span class="annottext">runCommand :: String -&gt; IO ProcessHandle
</span><a href="System.Process.html#runCommand"><span class="hs-identifier hs-var hs-var">runCommand</span></a></span></span><span> </span><span id="local-6989586621679057012"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679057012"><span class="hs-identifier hs-var">string</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-977"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679057013"><span class="annot"><a href="#local-6989586621679057013"><span class="hs-identifier hs-var">ph</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String
-&gt; CreateProcess
-&gt; IO (Maybe Handle, Maybe Handle, Maybe Handle, ProcessHandle)
</span><a href="System.Process.Internals.html#createProcess_"><span class="hs-identifier hs-var">createProcess_</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;runCommand&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; CreateProcess
</span><a href="System.Process.html#shell"><span class="hs-identifier hs-var">shell</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679057012"><span class="hs-identifier hs-var">string</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-978"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621679057013"><span class="hs-identifier hs-type">ph</span></a></span><span>
</span><span id="line-979"></span><span>
</span><span id="line-980"></span><span>
</span><span id="line-981"></span><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><span id="line-982"></span><span class="hs-comment">-- runProcess</span><span>
</span><span id="line-983"></span><span>
</span><span id="line-984"></span><span class="hs-comment">--TODO: in a later release {-# DEPRECATED runProcess &quot;Use 'spawnProcess' or 'createProcess' instead&quot; #-}</span><span>
</span><span id="line-985"></span><span>
</span><span id="line-986"></span><span class="annot"><span class="hs-comment">{- | Runs a raw command, optionally specifying 'Handle's from which to
     take the @stdin@, @stdout@ and @stderr@ channels for the new
     process (otherwise these handles are inherited from the current
     process).

     Any 'Handle's passed to 'runProcess' are placed immediately in the
     closed state.

     Note: consider using the more general 'createProcess' instead of
     'runProcess'.
-}</span></span><span>
</span><span id="line-997"></span><span class="annot"><a href="System.Process.html#runProcess"><span class="hs-identifier hs-type">runProcess</span></a></span><span>
</span><span id="line-998"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>                   </span><span class="annot"><span class="hs-comment">-- ^ Filename of the executable (see 'RawCommand' for details)</span></span><span>
</span><span id="line-999"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span>                   </span><span class="annot"><span class="hs-comment">-- ^ Arguments to pass to the executable</span></span><span>
</span><span id="line-1000"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>             </span><span class="annot"><span class="hs-comment">-- ^ Optional path to the working directory</span></span><span>
</span><span id="line-1001"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Optional environment (otherwise inherit)</span></span><span>
</span><span id="line-1002"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span>               </span><span class="annot"><span class="hs-comment">-- ^ Handle to use for @stdin@ (Nothing =&gt; use existing @stdin@)</span></span><span>
</span><span id="line-1003"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span>               </span><span class="annot"><span class="hs-comment">-- ^ Handle to use for @stdout@ (Nothing =&gt; use existing @stdout@)</span></span><span>
</span><span id="line-1004"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span>               </span><span class="annot"><span class="hs-comment">-- ^ Handle to use for @stderr@ (Nothing =&gt; use existing @stderr@)</span></span><span>
</span><span id="line-1005"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-type">ProcessHandle</span></a></span><span>
</span><span id="line-1006"></span><span>
</span><span id="line-1007"></span><span id="runProcess"><span class="annot"><span class="annottext">runProcess :: String
-&gt; [String]
-&gt; Maybe String
-&gt; Maybe [(String, String)]
-&gt; Maybe Handle
-&gt; Maybe Handle
-&gt; Maybe Handle
-&gt; IO ProcessHandle
</span><a href="System.Process.html#runProcess"><span class="hs-identifier hs-var hs-var">runProcess</span></a></span></span><span> </span><span id="local-6989586621679057014"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679057014"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span id="local-6989586621679057015"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679057015"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621679057016"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679057016"><span class="hs-identifier hs-var">mb_cwd</span></a></span></span><span> </span><span id="local-6989586621679057017"><span class="annot"><span class="annottext">Maybe [(String, String)]
</span><a href="#local-6989586621679057017"><span class="hs-identifier hs-var">mb_env</span></a></span></span><span> </span><span id="local-6989586621679057018"><span class="annot"><span class="annottext">Maybe Handle
</span><a href="#local-6989586621679057018"><span class="hs-identifier hs-var">mb_stdin</span></a></span></span><span> </span><span id="local-6989586621679057019"><span class="annot"><span class="annottext">Maybe Handle
</span><a href="#local-6989586621679057019"><span class="hs-identifier hs-var">mb_stdout</span></a></span></span><span> </span><span id="local-6989586621679057020"><span class="annot"><span class="annottext">Maybe Handle
</span><a href="#local-6989586621679057020"><span class="hs-identifier hs-var">mb_stderr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1008"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679057021"><span class="annot"><a href="#local-6989586621679057021"><span class="hs-identifier hs-var">ph</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1009"></span><span>      </span><span class="annot"><span class="annottext">String
-&gt; CreateProcess
-&gt; IO (Maybe Handle, Maybe Handle, Maybe Handle, ProcessHandle)
</span><a href="System.Process.Internals.html#createProcess_"><span class="hs-identifier hs-var">createProcess_</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;runProcess&quot;</span></span><span>
</span><span id="line-1010"></span><span>         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; CreateProcess
</span><a href="System.Process.html#proc"><span class="hs-identifier hs-var">proc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679057014"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679057015"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span class="hs-special">{</span><span> </span><span class="annot"><a href="System.Process.Common.html#cwd"><span class="hs-identifier hs-var">cwd</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679057016"><span class="hs-identifier hs-type">mb_cwd</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1011"></span><span>                          </span><span class="annot"><a href="System.Process.Common.html#env"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679057017"><span class="hs-identifier hs-type">mb_env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1012"></span><span>                          </span><span class="annot"><a href="System.Process.Common.html#std_in"><span class="hs-identifier hs-var">std_in</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679057022"><span class="hs-identifier hs-type">mbToStd</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057018"><span class="hs-identifier hs-type">mb_stdin</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1013"></span><span>                          </span><span class="annot"><a href="System.Process.Common.html#std_out"><span class="hs-identifier hs-var">std_out</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679057022"><span class="hs-identifier hs-type">mbToStd</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057019"><span class="hs-identifier hs-type">mb_stdout</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1014"></span><span>                          </span><span class="annot"><a href="System.Process.Common.html#std_err"><span class="hs-identifier hs-var">std_err</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679057022"><span class="hs-identifier hs-type">mbToStd</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057020"><span class="hs-identifier hs-type">mb_stderr</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1015"></span><span>  </span><span class="annot"><a href="#local-6989586621679057023"><span class="hs-identifier hs-type">maybeClose</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057018"><span class="hs-identifier hs-type">mb_stdin</span></a></span><span>
</span><span id="line-1016"></span><span>  </span><span class="annot"><a href="#local-6989586621679057023"><span class="hs-identifier hs-type">maybeClose</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057019"><span class="hs-identifier hs-type">mb_stdout</span></a></span><span>
</span><span id="line-1017"></span><span>  </span><span class="annot"><a href="#local-6989586621679057023"><span class="hs-identifier hs-type">maybeClose</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057020"><span class="hs-identifier hs-type">mb_stderr</span></a></span><span>
</span><span id="line-1018"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621679057021"><span class="hs-identifier hs-type">ph</span></a></span><span>
</span><span id="line-1019"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1020"></span><span>  </span><span class="annot"><a href="#local-6989586621679057023"><span class="hs-identifier hs-type">maybeClose</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1021"></span><span>  </span><span id="local-6989586621679057023"><span class="annot"><span class="annottext">maybeClose :: Maybe Handle -&gt; IO ()
</span><a href="#local-6989586621679057023"><span class="hs-identifier hs-var hs-var">maybeClose</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span>  </span><span id="local-6989586621679057024"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679057024"><span class="hs-identifier hs-var">hdl</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1022"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679057024"><span class="hs-identifier hs-var">hdl</span></a></span><span> </span><span class="annot"><span class="annottext">Handle -&gt; Handle -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><span class="hs-identifier hs-var">stdin</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679057024"><span class="hs-identifier hs-var">hdl</span></a></span><span> </span><span class="annot"><span class="annottext">Handle -&gt; Handle -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><span class="hs-identifier hs-var">stdout</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679057024"><span class="hs-identifier hs-var">hdl</span></a></span><span> </span><span class="annot"><span class="annottext">Handle -&gt; Handle -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><span class="hs-identifier hs-var">stderr</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO ()
</span><span class="hs-identifier hs-var">hClose</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679057024"><span class="hs-identifier hs-var">hdl</span></a></span><span>
</span><span id="line-1023"></span><span>  </span><span class="annot"><a href="#local-6989586621679057023"><span class="hs-identifier hs-var">maybeClose</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Handle
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1024"></span><span>
</span><span id="line-1025"></span><span>  </span><span class="annot"><a href="#local-6989586621679057022"><span class="hs-identifier hs-type">mbToStd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="System.Process.Common.html#StdStream"><span class="hs-identifier hs-type">StdStream</span></a></span><span>
</span><span id="line-1026"></span><span>  </span><span id="local-6989586621679057022"><span class="annot"><span class="annottext">mbToStd :: Maybe Handle -&gt; StdStream
</span><a href="#local-6989586621679057022"><span class="hs-identifier hs-var hs-var">mbToStd</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Handle
</span><span class="hs-identifier hs-var">Nothing</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StdStream
</span><a href="System.Process.Common.html#Inherit"><span class="hs-identifier hs-var">Inherit</span></a></span><span>
</span><span id="line-1027"></span><span>  </span><span class="annot"><a href="#local-6989586621679057022"><span class="hs-identifier hs-var">mbToStd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679057025"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679057025"><span class="hs-identifier hs-var">hdl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; StdStream
</span><a href="System.Process.Common.html#UseHandle"><span class="hs-identifier hs-var">UseHandle</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679057025"><span class="hs-identifier hs-var">hdl</span></a></span><span>
</span><span id="line-1028"></span><span>
</span><span id="line-1029"></span><span>
</span><span id="line-1030"></span><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><span id="line-1031"></span><span class="hs-comment">-- runInteractiveCommand</span><span>
</span><span id="line-1032"></span><span>
</span><span id="line-1033"></span><span class="hs-comment">--TODO: in a later release {-# DEPRECATED runInteractiveCommand &quot;Use 'createProcess' instead&quot; #-}</span><span>
</span><span id="line-1034"></span><span>
</span><span id="line-1035"></span><span class="annot"><span class="hs-comment">{- | Runs a command using the shell, and returns 'Handle's that may
     be used to communicate with the process via its @stdin@, @stdout@,
     and @stderr@ respectively.
-}</span></span><span>
</span><span id="line-1039"></span><span class="annot"><a href="System.Process.html#runInteractiveCommand"><span class="hs-identifier hs-type">runInteractiveCommand</span></a></span><span>
</span><span id="line-1040"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-1041"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span class="hs-special">,</span><span class="annot"><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-type">ProcessHandle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1042"></span><span>
</span><span id="line-1043"></span><span id="runInteractiveCommand"><span class="annot"><span class="annottext">runInteractiveCommand :: String -&gt; IO (Handle, Handle, Handle, ProcessHandle)
</span><a href="System.Process.html#runInteractiveCommand"><span class="hs-identifier hs-var hs-var">runInteractiveCommand</span></a></span></span><span> </span><span id="local-6989586621679057026"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679057026"><span class="hs-identifier hs-var">string</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1044"></span><span>  </span><span class="annot"><span class="annottext">String
-&gt; CreateProcess -&gt; IO (Handle, Handle, Handle, ProcessHandle)
</span><a href="System.Process.html#runInteractiveProcess1"><span class="hs-identifier hs-var">runInteractiveProcess1</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;runInteractiveCommand&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; CreateProcess
</span><a href="System.Process.html#shell"><span class="hs-identifier hs-var">shell</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679057026"><span class="hs-identifier hs-var">string</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1045"></span><span>
</span><span id="line-1046"></span><span>
</span><span id="line-1047"></span><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><span id="line-1048"></span><span class="hs-comment">-- runInteractiveProcess</span><span>
</span><span id="line-1049"></span><span>
</span><span id="line-1050"></span><span class="hs-comment">--TODO: in a later release {-# DEPRECATED runInteractiveCommand &quot;Use 'createProcess' instead&quot; #-}</span><span>
</span><span id="line-1051"></span><span>
</span><span id="line-1052"></span><span class="annot"><span class="hs-comment">{- | Runs a raw command, and returns 'Handle's that may be used to communicate
     with the process via its @stdin@, @stdout@ and @stderr@ respectively.

    For example, to start a process and feed a string to its stdin:

&gt;   (inp,out,err,pid) &lt;- runInteractiveProcess &quot;...&quot;
&gt;   forkIO (hPutStr inp str)
-}</span></span><span>
</span><span id="line-1060"></span><span class="annot"><a href="System.Process.html#runInteractiveProcess"><span class="hs-identifier hs-type">runInteractiveProcess</span></a></span><span>
</span><span id="line-1061"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>                   </span><span class="annot"><span class="hs-comment">-- ^ Filename of the executable (see 'RawCommand' for details)</span></span><span>
</span><span id="line-1062"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span>                   </span><span class="annot"><span class="hs-comment">-- ^ Arguments to pass to the executable</span></span><span>
</span><span id="line-1063"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>             </span><span class="annot"><span class="hs-comment">-- ^ Optional path to the working directory</span></span><span>
</span><span id="line-1064"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Optional environment (otherwise inherit)</span></span><span>
</span><span id="line-1065"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span class="hs-special">,</span><span class="annot"><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-type">ProcessHandle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1066"></span><span>
</span><span id="line-1067"></span><span id="runInteractiveProcess"><span class="annot"><span class="annottext">runInteractiveProcess :: String
-&gt; [String]
-&gt; Maybe String
-&gt; Maybe [(String, String)]
-&gt; IO (Handle, Handle, Handle, ProcessHandle)
</span><a href="System.Process.html#runInteractiveProcess"><span class="hs-identifier hs-var hs-var">runInteractiveProcess</span></a></span></span><span> </span><span id="local-6989586621679057028"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679057028"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span id="local-6989586621679057029"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679057029"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621679057030"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679057030"><span class="hs-identifier hs-var">mb_cwd</span></a></span></span><span> </span><span id="local-6989586621679057031"><span class="annot"><span class="annottext">Maybe [(String, String)]
</span><a href="#local-6989586621679057031"><span class="hs-identifier hs-var">mb_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1068"></span><span>  </span><span class="annot"><span class="annottext">String
-&gt; CreateProcess -&gt; IO (Handle, Handle, Handle, ProcessHandle)
</span><a href="System.Process.html#runInteractiveProcess1"><span class="hs-identifier hs-var">runInteractiveProcess1</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;runInteractiveProcess&quot;</span></span><span>
</span><span id="line-1069"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; CreateProcess
</span><a href="System.Process.html#proc"><span class="hs-identifier hs-var">proc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679057028"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679057029"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span class="hs-special">{</span><span> </span><span class="annot"><a href="System.Process.Common.html#cwd"><span class="hs-identifier hs-var">cwd</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679057030"><span class="hs-identifier hs-type">mb_cwd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Process.Common.html#env"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679057031"><span class="hs-identifier hs-type">mb_env</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1070"></span><span>
</span><span id="line-1071"></span><span class="annot"><a href="System.Process.html#runInteractiveProcess1"><span class="hs-identifier hs-type">runInteractiveProcess1</span></a></span><span>
</span><span id="line-1072"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-1073"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="System.Process.Common.html#CreateProcess"><span class="hs-identifier hs-type">CreateProcess</span></a></span><span>
</span><span id="line-1074"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span class="hs-special">,</span><span class="annot"><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-type">ProcessHandle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1075"></span><span id="runInteractiveProcess1"><span class="annot"><span class="annottext">runInteractiveProcess1 :: String
-&gt; CreateProcess -&gt; IO (Handle, Handle, Handle, ProcessHandle)
</span><a href="System.Process.html#runInteractiveProcess1"><span class="hs-identifier hs-var hs-var">runInteractiveProcess1</span></a></span></span><span> </span><span id="local-6989586621679057032"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679057032"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621679057033"><span class="annot"><span class="annottext">CreateProcess
</span><a href="#local-6989586621679057033"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1076"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679057034"><span class="annot"><a href="#local-6989586621679057034"><span class="hs-identifier hs-var">mb_in</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057035"><span class="annot"><a href="#local-6989586621679057035"><span class="hs-identifier hs-var">mb_out</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057036"><span class="annot"><a href="#local-6989586621679057036"><span class="hs-identifier hs-var">mb_err</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679057037"><span class="annot"><a href="#local-6989586621679057037"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1077"></span><span>      </span><span class="annot"><span class="annottext">String
-&gt; CreateProcess
-&gt; IO (Maybe Handle, Maybe Handle, Maybe Handle, ProcessHandle)
</span><a href="System.Process.Internals.html#createProcess_"><span class="hs-identifier hs-var">createProcess_</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679057032"><span class="hs-identifier hs-var">fun</span></a></span><span>
</span><span id="line-1078"></span><span>           </span><span class="annot"><span class="annottext">CreateProcess
</span><a href="#local-6989586621679057033"><span class="hs-identifier hs-var">cmd</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="System.Process.Common.html#std_in"><span class="hs-identifier hs-var">std_in</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="System.Process.Common.html#CreatePipe"><span class="hs-identifier hs-type">CreatePipe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1079"></span><span>                </span><span class="annot"><a href="System.Process.Common.html#std_out"><span class="hs-identifier hs-var">std_out</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="System.Process.Common.html#CreatePipe"><span class="hs-identifier hs-type">CreatePipe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1080"></span><span>                </span><span class="annot"><a href="System.Process.Common.html#std_err"><span class="hs-identifier hs-var">std_err</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="System.Process.Common.html#CreatePipe"><span class="hs-identifier hs-type">CreatePipe</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1081"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fromJust</span></span><span> </span><span class="annot"><a href="#local-6989586621679057034"><span class="hs-identifier hs-type">mb_in</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">fromJust</span></span><span> </span><span class="annot"><a href="#local-6989586621679057035"><span class="hs-identifier hs-type">mb_out</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">fromJust</span></span><span> </span><span class="annot"><a href="#local-6989586621679057036"><span class="hs-identifier hs-type">mb_err</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679057037"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1082"></span><span>
</span><span id="line-1083"></span><span>
</span><span id="line-1084"></span><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><span id="line-1085"></span><span class="hs-comment">-- system &amp; rawSystem</span><span>
</span><span id="line-1086"></span><span>
</span><span id="line-1087"></span><span class="hs-comment">--TODO: in a later release {-# DEPRECATED system &quot;Use 'callCommand' (or 'spawnCommand' and 'waitForProcess') instead&quot; #-}</span><span>
</span><span id="line-1088"></span><span>
</span><span id="line-1089"></span><span class="annot"><span class="hs-comment">{-|
Computation @system cmd@ returns the exit code produced when the
operating system runs the shell command @cmd@.

This computation may fail with one of the following
'System.IO.Error.IOErrorType' exceptions:

[@PermissionDenied@]
The process has insufficient privileges to perform the operation.

[@ResourceExhausted@]
Insufficient resources are available to perform the operation.

[@UnsupportedOperation@]
The implementation does not support system calls.

On Windows, 'system' passes the command to the Windows command
interpreter (@CMD.EXE@ or @COMMAND.COM@), hence Unixy shell tricks
will not work.

On Unix systems, see 'waitForProcess' for the meaning of exit codes
when the process died as the result of a signal.
-}</span></span><span>
</span><span id="line-1112"></span><span class="annot"><a href="System.Process.html#system"><span class="hs-identifier hs-type">system</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExitCode</span></span><span>
</span><span id="line-1113"></span><span id="system"><span class="annot"><span class="annottext">system :: String -&gt; IO ExitCode
</span><a href="System.Process.html#system"><span class="hs-identifier hs-var hs-var">system</span></a></span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IOError -&gt; IO ExitCode
forall a. HasCallStack =&gt; IOError -&gt; IO a
</span><span class="hs-identifier hs-var">ioException</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IOError -&gt; String -&gt; IOError
</span><span class="hs-identifier hs-var">ioeSetErrorString</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IOErrorType -&gt; String -&gt; Maybe Handle -&gt; Maybe String -&gt; IOError
</span><span class="hs-identifier hs-var">mkIOError</span></span><span> </span><span class="annot"><span class="annottext">IOErrorType
</span><span class="hs-identifier hs-var">InvalidArgument</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;system&quot;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Handle
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;null command&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1114"></span><span class="annot"><a href="System.Process.html#system"><span class="hs-identifier hs-var">system</span></a></span><span> </span><span id="local-6989586621679057040"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679057040"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1115"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679057041"><span class="annot"><a href="#local-6989586621679057041"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String
-&gt; CreateProcess
-&gt; IO (Maybe Handle, Maybe Handle, Maybe Handle, ProcessHandle)
</span><a href="System.Process.Internals.html#createProcess_"><span class="hs-identifier hs-var">createProcess_</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;system&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; CreateProcess
</span><a href="System.Process.html#shell"><span class="hs-identifier hs-var">shell</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679057040"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="System.Process.Common.html#delegate_ctlc"><span class="hs-identifier hs-var">delegate_ctlc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1116"></span><span>  </span><span class="annot"><a href="System.Process.html#waitForProcess"><span class="hs-identifier hs-type">waitForProcess</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057041"><span class="hs-identifier hs-type">p</span></a></span><span>
</span><span id="line-1117"></span><span>
</span><span id="line-1118"></span><span>
</span><span id="line-1119"></span><span class="hs-comment">--TODO: in a later release {-# DEPRECATED rawSystem &quot;Use 'callProcess' (or 'spawnProcess' and 'waitForProcess') instead&quot; #-}</span><span>
</span><span id="line-1120"></span><span>
</span><span id="line-1121"></span><span class="annot"><span class="hs-comment">{-|
The computation @'rawSystem' /cmd/ /args/@ runs the operating system command
@/cmd/@ in such a way that it receives as arguments the @/args/@ strings
exactly as given, with no funny escaping or shell meta-syntax expansion.
It will therefore behave more portably between operating systems than 'system'.

The return codes and possible failures are the same as for 'system'.
-}</span></span><span>
</span><span id="line-1129"></span><span class="annot"><a href="System.Process.html#rawSystem"><span class="hs-identifier hs-type">rawSystem</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExitCode</span></span><span>
</span><span id="line-1130"></span><span id="rawSystem"><span class="annot"><span class="annottext">rawSystem :: String -&gt; [String] -&gt; IO ExitCode
</span><a href="System.Process.html#rawSystem"><span class="hs-identifier hs-var hs-var">rawSystem</span></a></span></span><span> </span><span id="local-6989586621679057042"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679057042"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span id="local-6989586621679057043"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679057043"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1131"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679057044"><span class="annot"><a href="#local-6989586621679057044"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String
-&gt; CreateProcess
-&gt; IO (Maybe Handle, Maybe Handle, Maybe Handle, ProcessHandle)
</span><a href="System.Process.Internals.html#createProcess_"><span class="hs-identifier hs-var">createProcess_</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rawSystem&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; CreateProcess
</span><a href="System.Process.html#proc"><span class="hs-identifier hs-var">proc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679057042"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679057043"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="System.Process.Common.html#delegate_ctlc"><span class="hs-identifier hs-var">delegate_ctlc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1132"></span><span>  </span><span class="annot"><a href="System.Process.html#waitForProcess"><span class="hs-identifier hs-type">waitForProcess</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679057044"><span class="hs-identifier hs-type">p</span></a></span><span>
</span><span id="line-1133"></span></pre></body></html>