<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-comment">-- This file is included by &quot;Data.ByteString.ReadInt&quot;, after defining</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- &quot;BYTESTRING_STRICT&quot;.  The two modules are largely identical, except for the</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- choice of ByteString type and the loops in `readNatural`, where the lazy</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- version needs to nest the inner loop inside a loop over the constituent</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- chunks.</span><span class="hs-cpp">

#ifdef BYTESTRING_STRICT
</span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data.ByteString.ReadNat</span><span class="hs-cpp">
#else
</span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Data.ByteString.Lazy.ReadNat.html"><span class="hs-identifier">Data.ByteString.Lazy.ReadNat</span></a></span><span class="hs-cpp">
#endif
</span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Data.ByteString.Lazy.ReadNat.html#readInteger"><span class="hs-identifier">readInteger</span></a></span><span>
</span><span id="line-15"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.ByteString.Lazy.ReadNat.html#readNatural"><span class="hs-identifier">readNatural</span></a></span><span>
</span><span id="line-16"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Data.ByteString.Internal.html"><span class="hs-identifier">Data.ByteString.Internal</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BI</span></span><span class="hs-cpp">
#ifdef BYTESTRING_STRICT
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.ByteString</span><span class="hs-cpp">
#else
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.ByteString.Lazy.html"><span class="hs-identifier">Data.ByteString.Lazy</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.ByteString.Lazy.Internal.html"><span class="hs-identifier">Data.ByteString.Lazy.Internal</span></a></span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Bits.html"><span class="hs-identifier">Data.Bits</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">finiteBitSize</span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.ByteString.Internal.html"><span class="hs-identifier">Data.ByteString.Internal</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Data.ByteString.Internal.Type.html#BS"><span class="hs-identifier">BS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">plusForeignPtr</span></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Word.html"><span class="hs-identifier">Data.Word</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Foreign.ForeignPtr.html"><span class="hs-identifier">Foreign.ForeignPtr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ForeignPtr</span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Foreign.Ptr.html"><span class="hs-identifier">Foreign.Ptr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Ptr</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">minusPtr</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">plusPtr</span></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Foreign.Storable.html"><span class="hs-identifier">Foreign.Storable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Storable</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Numeric.Natural.html"><span class="hs-identifier">Numeric.Natural</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Natural</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-comment">----- Public API</span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-comment">-- | 'readInteger' reads an 'Integer' from the beginning of the 'ByteString'.</span><span>
</span><span id="line-36"></span><span class="hs-comment">-- If there is no 'Integer' at the beginning of the string, it returns</span><span>
</span><span id="line-37"></span><span class="hs-comment">-- 'Nothing', otherwise it just returns the 'Integer' read, and the rest of</span><span>
</span><span id="line-38"></span><span class="hs-comment">-- the string.</span><span>
</span><span id="line-39"></span><span class="hs-comment">--</span><span>
</span><span id="line-40"></span><span class="hs-comment">-- 'readInteger' does not ignore leading whitespace, the value must start</span><span>
</span><span id="line-41"></span><span class="hs-comment">-- immediately at the beginning of the input string.</span><span>
</span><span id="line-42"></span><span class="hs-comment">--</span><span>
</span><span id="line-43"></span><span class="hs-comment">-- ==== __Examples__</span><span>
</span><span id="line-44"></span><span class="hs-comment">-- &gt;&gt;&gt; readInteger &quot;-000111222333444555666777888999 all done&quot;</span><span>
</span><span id="line-45"></span><span class="hs-comment">-- Just (-111222333444555666777888999,&quot; all done&quot;)</span><span>
</span><span id="line-46"></span><span class="hs-comment">-- &gt;&gt;&gt; readInteger &quot;+1: readInteger also accepts a leading '+'&quot;</span><span>
</span><span id="line-47"></span><span class="hs-comment">-- Just (1, &quot;: readInteger also accepts a leading '+'&quot;)</span><span>
</span><span id="line-48"></span><span class="hs-comment">-- &gt;&gt;&gt; readInteger &quot;not a decimal number&quot;</span><span>
</span><span id="line-49"></span><span class="hs-comment">-- Nothing</span><span>
</span><span id="line-50"></span><span class="hs-comment">--</span><span>
</span><span id="line-51"></span><span class="annot"><a href="Data.ByteString.Lazy.ReadNat.html#readInteger"><span class="hs-identifier hs-type">readInteger</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span id="readInteger"><span class="annot"><span class="annottext">readInteger :: ByteString -&gt; Maybe (Integer, ByteString)
</span><a href="Data.ByteString.Lazy.ReadNat.html#readInteger"><span class="hs-identifier hs-var hs-var">readInteger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679125947"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679125947"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679125948"><span class="annot"><a href="#local-6989586621679125948"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679125949"><span class="annot"><a href="#local-6989586621679125949"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe (Word8, ByteString)
</span><a href="Data.ByteString.Lazy.html#uncons"><span class="hs-identifier hs-var">uncons</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679125947"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679125951"><span class="annot"><a href="#local-6989586621679125951"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word
</span><a href="Data.ByteString.Lazy.ReadNat.html#fromDigit"><span class="hs-identifier hs-var">fromDigit</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679125948"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="#local-6989586621679125951"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-type">&lt;=</span></a></span><span>    </span><span class="annot"><span class="hs-number">9</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679125954"><span class="hs-identifier hs-type">unsigned</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679125951"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679125949"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-comment">-- leading digit</span><span>
</span><span id="line-56"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="#local-6989586621679125948"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-type">==</span></a></span><span> </span><span class="annot"><span class="hs-number">0x2d</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679125955"><span class="hs-identifier hs-type">negative</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679125949"><span class="hs-identifier hs-type">s</span></a></span><span>   </span><span class="hs-comment">-- minus sign</span><span>
</span><span id="line-57"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="#local-6989586621679125948"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-type">==</span></a></span><span> </span><span class="annot"><span class="hs-number">0x2b</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679125956"><span class="hs-identifier hs-type">positive</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679125949"><span class="hs-identifier hs-type">s</span></a></span><span>   </span><span class="hs-comment">-- plus sign</span><span>
</span><span id="line-58"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>      </span><span class="hs-comment">-- not a number</span><span>
</span><span id="line-59"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-60"></span><span>    </span><span class="annot"><a href="#local-6989586621679125954"><span class="hs-identifier hs-type">unsigned</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Word"><span class="hs-identifier hs-type">Word</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>    </span><span id="local-6989586621679125954"><span class="annot"><span class="annottext">unsigned :: Word -&gt; ByteString -&gt; Maybe (Integer, ByteString)
</span><a href="#local-6989586621679125954"><span class="hs-identifier hs-var hs-var">unsigned</span></a></span></span><span> </span><span id="local-6989586621679125957"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679125957"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621679125958"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679125958"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-62"></span><span>         </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621679125959"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679125959"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679125960"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679125960"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word -&gt; ByteString -&gt; (Natural, ByteString)
</span><a href="Data.ByteString.Lazy.ReadNat.html#_readDecimal"><span class="hs-identifier hs-var">_readDecimal</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679125957"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679125958"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-63"></span><span>             </span><span class="hs-glyph">!</span><span id="local-6989586621679125964"><span class="annot"><span class="annottext">i :: Integer
</span><a href="#local-6989586621679125964"><span class="hs-identifier hs-var hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><span class="hs-identifier hs-var">toInteger</span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679125959"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-64"></span><span>          </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Integer, ByteString) -&gt; Maybe (Integer, ByteString)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679125964"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679125960"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span>    </span><span class="annot"><a href="#local-6989586621679125956"><span class="hs-identifier hs-type">positive</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>    </span><span id="local-6989586621679125956"><span class="annot"><span class="annottext">positive :: ByteString -&gt; Maybe (Integer, ByteString)
</span><a href="#local-6989586621679125956"><span class="hs-identifier hs-var hs-var">positive</span></a></span></span><span> </span><span id="local-6989586621679125965"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679125965"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-68"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679125966"><span class="annot"><a href="#local-6989586621679125966"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679125967"><span class="annot"><a href="#local-6989586621679125967"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe (Word8, ByteString)
</span><a href="Data.ByteString.Lazy.html#uncons"><span class="hs-identifier hs-var">uncons</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679125965"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-69"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679125968"><span class="annot"><a href="#local-6989586621679125968"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word
</span><a href="Data.ByteString.Lazy.ReadNat.html#fromDigit"><span class="hs-identifier hs-var">fromDigit</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679125966"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-70"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="#local-6989586621679125968"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-type">&lt;=</span></a></span><span>    </span><span class="annot"><span class="hs-number">9</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679125954"><span class="hs-identifier hs-type">unsigned</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679125968"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679125967"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-71"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span>    </span><span class="annot"><a href="#local-6989586621679125955"><span class="hs-identifier hs-type">negative</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span>    </span><span id="local-6989586621679125955"><span class="annot"><span class="annottext">negative :: ByteString -&gt; Maybe (Integer, ByteString)
</span><a href="#local-6989586621679125955"><span class="hs-identifier hs-var hs-var">negative</span></a></span></span><span> </span><span id="local-6989586621679125969"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679125969"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-75"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679125970"><span class="annot"><a href="#local-6989586621679125970"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679125971"><span class="annot"><a href="#local-6989586621679125971"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe (Word8, ByteString)
</span><a href="Data.ByteString.Lazy.html#uncons"><span class="hs-identifier hs-var">uncons</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679125969"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-76"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679125972"><span class="annot"><a href="#local-6989586621679125972"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word
</span><a href="Data.ByteString.Lazy.ReadNat.html#fromDigit"><span class="hs-identifier hs-var">fromDigit</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679125970"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-77"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="#local-6989586621679125972"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#%3E"><span class="hs-operator hs-type">&gt;</span></a></span><span>     </span><span class="annot"><span class="hs-number">9</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-78"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679125974"><span class="annot"><a href="#local-6989586621679125974"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679125975"><span class="annot"><a href="#local-6989586621679125975"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.ByteString.Lazy.ReadNat.html#_readDecimal"><span class="hs-identifier hs-type">_readDecimal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679125972"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679125971"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-79"></span><span>                              </span><span class="hs-glyph">!</span><span id="local-6989586621679125979"><span class="annot"><a href="#local-6989586621679125979"><span class="hs-identifier hs-var hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">negate</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Integer) -&gt; Integer -&gt; Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><span class="hs-identifier hs-var">toInteger</span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679125974"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-80"></span><span>                           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679125979"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679125975"><span class="hs-identifier hs-type">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="hs-comment">-- | 'readNatural' reads a 'Natural' number from the beginning of the</span><span>
</span><span id="line-83"></span><span class="hs-comment">-- 'ByteString'.  If there is no 'Natural' number at the beginning of the</span><span>
</span><span id="line-84"></span><span class="hs-comment">-- string, it returns 'Nothing', otherwise it just returns the number read, and</span><span>
</span><span id="line-85"></span><span class="hs-comment">-- the rest of the string.</span><span>
</span><span id="line-86"></span><span class="hs-comment">--</span><span>
</span><span id="line-87"></span><span class="hs-comment">-- 'readNatural' does not ignore leading whitespace, the value must start with</span><span>
</span><span id="line-88"></span><span class="hs-comment">-- a decimal digit immediately at the beginning of the input string.  Leading</span><span>
</span><span id="line-89"></span><span class="hs-comment">-- @+@ signs are not accepted.</span><span>
</span><span id="line-90"></span><span class="hs-comment">--</span><span>
</span><span id="line-91"></span><span class="hs-comment">-- ==== __Examples__</span><span>
</span><span id="line-92"></span><span class="hs-comment">-- &gt;&gt;&gt; readNatural &quot;000111222333444555666777888999 all done&quot;</span><span>
</span><span id="line-93"></span><span class="hs-comment">-- Just (111222333444555666777888999,&quot; all done&quot;)</span><span>
</span><span id="line-94"></span><span class="hs-comment">-- &gt;&gt;&gt; readNatural &quot;+000111222333444555666777888999 explicit sign&quot;</span><span>
</span><span id="line-95"></span><span class="hs-comment">-- Nothing</span><span>
</span><span id="line-96"></span><span class="hs-comment">-- &gt;&gt;&gt; readNatural &quot;not a decimal number&quot;</span><span>
</span><span id="line-97"></span><span class="hs-comment">-- Nothing</span><span>
</span><span id="line-98"></span><span class="hs-comment">--</span><span>
</span><span id="line-99"></span><span class="annot"><a href="Data.ByteString.Lazy.ReadNat.html#readNatural"><span class="hs-identifier hs-type">readNatural</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span id="readNatural"><span class="annot"><span class="annottext">readNatural :: ByteString -&gt; Maybe (Natural, ByteString)
</span><a href="Data.ByteString.Lazy.ReadNat.html#readNatural"><span class="hs-identifier hs-var hs-var">readNatural</span></a></span></span><span> </span><span id="local-6989586621679125980"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679125980"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-101"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679125981"><span class="annot"><a href="#local-6989586621679125981"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679125982"><span class="annot"><a href="#local-6989586621679125982"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe (Word8, ByteString)
</span><a href="Data.ByteString.Lazy.html#uncons"><span class="hs-identifier hs-var">uncons</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679125980"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-102"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679125983"><span class="annot"><a href="#local-6989586621679125983"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word
</span><a href="Data.ByteString.Lazy.ReadNat.html#fromDigit"><span class="hs-identifier hs-var">fromDigit</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679125981"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="#local-6989586621679125983"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-type">&lt;=</span></a></span><span>    </span><span class="annot"><span class="hs-number">9</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$!</span></span><span> </span><span class="annot"><a href="Data.ByteString.Lazy.ReadNat.html#_readDecimal"><span class="hs-identifier hs-type">_readDecimal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679125983"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679125982"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-104"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="hs-comment">----- Internal implementation</span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="hs-comment">-- | Intermediate result from scanning a chunk, final output is</span><span>
</span><span id="line-109"></span><span class="hs-comment">-- obtained via `convert` after all the chunks are processed.</span><span>
</span><span id="line-110"></span><span class="hs-comment">--</span><span>
</span><span id="line-111"></span><span class="hs-keyword">data</span><span> </span><span id="Result"><span class="annot"><a href="Data.ByteString.Lazy.ReadNat.html#Result"><span class="hs-identifier hs-var">Result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Result"><span class="annot"><a href="Data.ByteString.Lazy.ReadNat.html#Result"><span class="hs-identifier hs-var">Result</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>      </span><span class="hs-comment">-- Bytes consumed</span><span>
</span><span id="line-112"></span><span>                     </span><span class="hs-glyph">!</span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Word"><span class="hs-identifier hs-type">Word</span></a></span><span>     </span><span class="hs-comment">-- Value of LSW</span><span>
</span><span id="line-113"></span><span>                     </span><span class="hs-glyph">!</span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>      </span><span class="hs-comment">-- Digits in LSW</span><span>
</span><span id="line-114"></span><span>                     </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- Little endian MSW list</span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="annot"><a href="Data.ByteString.Lazy.ReadNat.html#_readDecimal"><span class="hs-identifier hs-type">_readDecimal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Word"><span class="hs-identifier hs-type">Word</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span id="_readDecimal"><span class="annot"><span class="annottext">_readDecimal :: Word -&gt; ByteString -&gt; (Natural, ByteString)
</span><a href="Data.ByteString.Lazy.ReadNat.html#_readDecimal"><span class="hs-identifier hs-var hs-var">_readDecimal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-118"></span><span>    </span><span class="hs-comment">-- Having read one digit, we're about to read the 2nd So the digit count</span><span>
</span><span id="line-119"></span><span>    </span><span class="hs-comment">-- up to 'safeLog' starts at 2.</span><span>
</span><span id="line-120"></span><span>    </span><span class="annot"><span class="annottext">[Natural] -&gt; Int -&gt; Word -&gt; ByteString -&gt; (Natural, ByteString)
</span><a href="#local-6989586621679125986"><span class="hs-identifier hs-var">consume</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-121"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-122"></span><span>    </span><span class="annot"><a href="#local-6989586621679125986"><span class="hs-identifier hs-type">consume</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Word"><span class="hs-identifier hs-type">Word</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-123"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.ByteString.Lazy.Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#ifdef BYTESTRING_STRICT
</span><span>    </span><span class="hs-identifier">consume</span><span> </span><span class="hs-identifier">ns</span><span> </span><span class="hs-identifier">cnt</span><span> </span><span class="hs-identifier">acc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BS</span><span> </span><span class="hs-identifier">fp</span><span> </span><span class="hs-identifier">len</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-126"></span><span>        </span><span class="hs-comment">-- Having read one digit, we're about to read the 2nd</span><span>
</span><span id="line-127"></span><span>        </span><span class="hs-comment">-- So the digit count up to 'safeLog' starts at 2.</span><span>
</span><span id="line-128"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">natdigits</span><span> </span><span class="hs-identifier">fp</span><span> </span><span class="hs-identifier">len</span><span> </span><span class="hs-identifier">acc</span><span> </span><span class="hs-identifier">cnt</span><span> </span><span class="hs-identifier">ns</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-129"></span><span>            </span><span class="hs-identifier">Result</span><span> </span><span class="hs-identifier">used</span><span> </span><span class="hs-identifier">acc'</span><span> </span><span class="hs-identifier">cnt'</span><span> </span><span class="hs-identifier">ns'</span><span>
</span><span id="line-130"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">used</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">len</span><span>
</span><span id="line-131"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">convert</span><span> </span><span class="hs-identifier">acc'</span><span> </span><span class="hs-identifier">cnt'</span><span> </span><span class="hs-identifier">ns'</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">empty</span><span>
</span><span id="line-132"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span>
</span><span id="line-133"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">convert</span><span> </span><span class="hs-identifier">acc'</span><span> </span><span class="hs-identifier">cnt'</span><span> </span><span class="hs-identifier">ns'</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-134"></span><span>                     </span><span class="hs-identifier">BS</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fp</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">plusForeignPtr</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">used</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">len</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">used</span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span>    </span><span class="hs-comment">-- All done</span><span>
</span><span id="line-137"></span><span>    </span><span id="local-6989586621679125986"><span class="annot"><span class="annottext">consume :: [Natural] -&gt; Int -&gt; Word -&gt; ByteString -&gt; (Natural, ByteString)
</span><a href="#local-6989586621679125986"><span class="hs-identifier hs-var hs-var">consume</span></a></span></span><span> </span><span id="local-6989586621679125987"><span class="annot"><span class="annottext">[Natural]
</span><a href="#local-6989586621679125987"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span id="local-6989586621679125988"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679125988"><span class="hs-identifier hs-var">cnt</span></a></span></span><span> </span><span id="local-6989586621679125989"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679125989"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="Data.ByteString.Lazy.Internal.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int -&gt; [Natural] -&gt; ByteString -&gt; (Natural, ByteString)
forall {b}. Word -&gt; Int -&gt; [Natural] -&gt; b -&gt; (Natural, b)
</span><a href="#local-6989586621679125991"><span class="hs-identifier hs-var">convert</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679125989"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679125988"><span class="hs-identifier hs-var">cnt</span></a></span><span> </span><span class="annot"><span class="annottext">[Natural]
</span><a href="#local-6989586621679125987"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="Data.ByteString.Lazy.Internal.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-138"></span><span>    </span><span class="hs-comment">-- Process next chunk</span><span>
</span><span id="line-139"></span><span>    </span><span class="annot"><a href="#local-6989586621679125986"><span class="hs-identifier hs-var">consume</span></a></span><span> </span><span id="local-6989586621679125992"><span class="annot"><span class="annottext">[Natural]
</span><a href="#local-6989586621679125992"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span id="local-6989586621679125993"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679125993"><span class="hs-identifier hs-var">cnt</span></a></span></span><span> </span><span id="local-6989586621679125994"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679125994"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.ByteString.Lazy.Internal.html#Chunk"><span class="hs-identifier hs-type">Chunk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.ByteString.Internal.Type.html#BS"><span class="hs-identifier hs-type">BS</span></a></span><span> </span><span id="local-6989586621679125996"><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679125996"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span id="local-6989586621679125997"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679125997"><span class="hs-identifier hs-var">len</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679125998"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679125998"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ForeignPtr Word8 -&gt; Int -&gt; Word -&gt; Int -&gt; [Natural] -&gt; Result
</span><a href="Data.ByteString.Lazy.ReadNat.html#natdigits"><span class="hs-identifier hs-var">natdigits</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679125996"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679125997"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679125994"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679125993"><span class="hs-identifier hs-var">cnt</span></a></span><span> </span><span class="annot"><span class="annottext">[Natural]
</span><a href="#local-6989586621679125992"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-141"></span><span>            </span><span class="annot"><a href="Data.ByteString.Lazy.ReadNat.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span id="local-6989586621679126000"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126000"><span class="hs-identifier hs-var">used</span></a></span></span><span> </span><span id="local-6989586621679126001"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679126001"><span class="hs-identifier hs-var">acc'</span></a></span></span><span> </span><span id="local-6989586621679126002"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126002"><span class="hs-identifier hs-var">cnt'</span></a></span></span><span> </span><span id="local-6989586621679126003"><span class="annot"><span class="annottext">[Natural]
</span><a href="#local-6989586621679126003"><span class="hs-identifier hs-var">ns'</span></a></span></span><span>
</span><span id="line-142"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126000"><span class="hs-identifier hs-var">used</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679125997"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="hs-comment">-- process more chunks</span><span>
</span><span id="line-143"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Natural] -&gt; Int -&gt; Word -&gt; ByteString -&gt; (Natural, ByteString)
</span><a href="#local-6989586621679125986"><span class="hs-identifier hs-var">consume</span></a></span><span> </span><span class="annot"><span class="annottext">[Natural]
</span><a href="#local-6989586621679126003"><span class="hs-identifier hs-var">ns'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126002"><span class="hs-identifier hs-var">cnt'</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679126001"><span class="hs-identifier hs-var">acc'</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679125998"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-144"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>   </span><span class="hs-comment">-- ran into a non-digit</span><span>
</span><span id="line-145"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679126005"><span class="annot"><span class="annottext">c :: ByteString
</span><a href="#local-6989586621679126005"><span class="hs-identifier hs-var hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
</span><a href="Data.ByteString.Lazy.Internal.html#Chunk"><span class="hs-identifier hs-var">Chunk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ForeignPtr Word8 -&gt; Int -&gt; ByteString
</span><a href="Data.ByteString.Internal.Type.html#BS"><span class="hs-identifier hs-var">BS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679125996"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignPtr Word8 -&gt; Int -&gt; ForeignPtr Word8
forall a b. ForeignPtr a -&gt; Int -&gt; ForeignPtr b
</span><span class="hs-operator hs-var">`plusForeignPtr`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126000"><span class="hs-identifier hs-var">used</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679125997"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126000"><span class="hs-identifier hs-var">used</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679125998"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-146"></span><span>                      </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int -&gt; [Natural] -&gt; ByteString -&gt; (Natural, ByteString)
forall {b}. Word -&gt; Int -&gt; [Natural] -&gt; b -&gt; (Natural, b)
</span><a href="#local-6989586621679125991"><span class="hs-identifier hs-var">convert</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679126001"><span class="hs-identifier hs-var">acc'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126002"><span class="hs-identifier hs-var">cnt'</span></a></span><span> </span><span class="annot"><span class="annottext">[Natural]
</span><a href="#local-6989586621679126003"><span class="hs-identifier hs-var">ns'</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679126005"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-cpp">
#endif
</span><span>    </span><span id="local-6989586621679125991"><span class="annot"><span class="annottext">convert :: Word -&gt; Int -&gt; [Natural] -&gt; b -&gt; (Natural, b)
</span><a href="#local-6989586621679125991"><span class="hs-identifier hs-var hs-var">convert</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679126006"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679126006"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679126007"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126007"><span class="hs-identifier hs-var">cnt</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679126008"><span class="annot"><span class="annottext">[Natural]
</span><a href="#local-6989586621679126008"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span id="local-6989586621679126009"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679126009"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-149"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679126010"><span class="annot"><span class="annottext">n :: Natural
</span><a href="#local-6989586621679126010"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int -&gt; [Natural] -&gt; Natural
</span><a href="#local-6989586621679126011"><span class="hs-identifier hs-var">combine</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679126006"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126007"><span class="hs-identifier hs-var">cnt</span></a></span><span> </span><span class="annot"><span class="annottext">[Natural]
</span><a href="#local-6989586621679126008"><span class="hs-identifier hs-var">ns</span></a></span><span>
</span><span id="line-150"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679126010"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679126009"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-comment">-- | Merge least-significant word with reduction of of little-endian tail.</span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-comment">-- The input is:</span><span>
</span><span id="line-155"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-156"></span><span>    </span><span class="hs-comment">-- * Least significant digits as a 'Word' (LSW)</span><span>
</span><span id="line-157"></span><span>    </span><span class="hs-comment">-- * The number of digits that went into the LSW</span><span>
</span><span id="line-158"></span><span>    </span><span class="hs-comment">-- * All the remaining digit groups ('safeLog' digits each),</span><span>
</span><span id="line-159"></span><span>    </span><span class="hs-comment">--   in little-endian order</span><span>
</span><span id="line-160"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-161"></span><span>    </span><span class="hs-comment">-- The result is obtained by pairwise recursive combining of all the</span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-comment">-- full size digit groups, followed by multiplication by @10^cnt@ and</span><span>
</span><span id="line-163"></span><span>    </span><span class="hs-comment">-- addition of the LSW.</span><span>
</span><span id="line-164"></span><span>    </span><span class="annot"><a href="#local-6989586621679126011"><span class="hs-identifier hs-type">combine</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Word"><span class="hs-identifier hs-type">Word</span></a></span><span>      </span><span class="hs-comment">-- ^ value of LSW</span><span>
</span><span id="line-165"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>       </span><span class="hs-comment">-- ^ count of digits in LSW</span><span>
</span><span id="line-166"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ tail elements (base @10^'safeLog'@)</span><span>
</span><span id="line-167"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span>
</span><span id="line-168"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="#local-6989586621679126011"><span class="hs-pragma hs-type">combine</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-169"></span><span>    </span><span id="local-6989586621679126011"><span class="annot"><span class="annottext">combine :: Word -&gt; Int -&gt; [Natural] -&gt; Natural
</span><a href="#local-6989586621679126011"><span class="hs-identifier hs-var hs-var">combine</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679126012"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679126012"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Natural
</span><a href="Data.ByteString.Lazy.ReadNat.html#wordToNatural"><span class="hs-identifier hs-var">wordToNatural</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679126012"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-170"></span><span>    </span><span class="annot"><a href="#local-6989586621679126011"><span class="hs-identifier hs-var">combine</span></a></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679126014"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679126014"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679126015"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126015"><span class="hs-identifier hs-var">cnt</span></a></span></span><span> </span><span id="local-6989586621679126016"><span class="annot"><span class="annottext">[Natural]
</span><a href="#local-6989586621679126016"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-171"></span><span>        </span><span class="annot"><span class="annottext">Word -&gt; Natural
</span><a href="Data.ByteString.Lazy.ReadNat.html#wordToNatural"><span class="hs-identifier hs-var">wordToNatural</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">10</span></span><span class="annot"><span class="annottext">Word -&gt; Int -&gt; Word
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126015"><span class="hs-identifier hs-var">cnt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; [Natural] -&gt; Natural
</span><a href="#local-6989586621679126019"><span class="hs-identifier hs-var">combine1</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="Data.ByteString.Lazy.ReadNat.html#safeBase"><span class="hs-identifier hs-var">safeBase</span></a></span><span> </span><span class="annot"><span class="annottext">[Natural]
</span><a href="#local-6989586621679126016"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Natural
</span><a href="Data.ByteString.Lazy.ReadNat.html#wordToNatural"><span class="hs-identifier hs-var">wordToNatural</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679126014"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span>    </span><span class="hs-comment">-- | Recursive reduction of little-endian sequence of 'Natural'-valued</span><span>
</span><span id="line-174"></span><span>    </span><span class="hs-comment">-- /digits/ in base @base@ (a power of 10).  The base is squared after</span><span>
</span><span id="line-175"></span><span>    </span><span class="hs-comment">-- each round.  This shows better asymptotic performance than one word</span><span>
</span><span id="line-176"></span><span>    </span><span class="hs-comment">-- at a time multiply-add folds.  See:</span><span>
</span><span id="line-177"></span><span>    </span><span class="hs-comment">-- &lt;https://gmplib.org/manual/Multiplication-Algorithms&gt;</span><span>
</span><span id="line-178"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-179"></span><span>    </span><span class="annot"><a href="#local-6989586621679126019"><span class="hs-identifier hs-type">combine1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span>
</span><span id="line-180"></span><span>    </span><span id="local-6989586621679126019"><span class="annot"><span class="annottext">combine1 :: Natural -&gt; [Natural] -&gt; Natural
</span><a href="#local-6989586621679126019"><span class="hs-identifier hs-var hs-var">combine1</span></a></span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-special">[</span><span id="local-6989586621679126021"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679126021"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679126021"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-181"></span><span>    </span><span class="annot"><a href="#local-6989586621679126019"><span class="hs-identifier hs-var">combine1</span></a></span><span> </span><span id="local-6989586621679126022"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679126022"><span class="hs-identifier hs-var">base</span></a></span></span><span> </span><span id="local-6989586621679126023"><span class="annot"><span class="annottext">[Natural]
</span><a href="#local-6989586621679126023"><span class="hs-identifier hs-var">ns</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; [Natural] -&gt; Natural
</span><a href="#local-6989586621679126019"><span class="hs-identifier hs-var">combine1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679126022"><span class="hs-identifier hs-var">base</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679126022"><span class="hs-identifier hs-var">base</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; [Natural] -&gt; [Natural]
</span><a href="#local-6989586621679126024"><span class="hs-identifier hs-var">combine2</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679126022"><span class="hs-identifier hs-var">base</span></a></span><span> </span><span class="annot"><span class="annottext">[Natural]
</span><a href="#local-6989586621679126023"><span class="hs-identifier hs-var">ns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span>    </span><span class="hs-comment">-- | One round pairwise merge of numbers in base @base@.</span><span>
</span><span id="line-184"></span><span>    </span><span class="annot"><a href="#local-6989586621679126024"><span class="hs-identifier hs-type">combine2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span class="hs-special">]</span><span>
</span><span id="line-185"></span><span>    </span><span id="local-6989586621679126024"><span class="annot"><span class="annottext">combine2 :: Natural -&gt; [Natural] -&gt; [Natural]
</span><a href="#local-6989586621679126024"><span class="hs-identifier hs-var hs-var">combine2</span></a></span></span><span> </span><span id="local-6989586621679126025"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679126025"><span class="hs-identifier hs-var">base</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679126026"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679126026"><span class="hs-identifier hs-var">n</span></a></span></span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621679126027"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679126027"><span class="hs-identifier hs-var">m</span></a></span></span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621679126028"><span class="annot"><span class="annottext">[Natural]
</span><a href="#local-6989586621679126028"><span class="hs-identifier hs-var">ns</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679126031"><span class="annot"><span class="annottext">t :: Natural
</span><a href="#local-6989586621679126031"><span class="hs-identifier hs-var hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679126027"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679126025"><span class="hs-identifier hs-var">base</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679126026"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679126031"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; [Natural] -&gt; [Natural]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; [Natural] -&gt; [Natural]
</span><a href="#local-6989586621679126024"><span class="hs-identifier hs-var">combine2</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679126025"><span class="hs-identifier hs-var">base</span></a></span><span> </span><span class="annot"><span class="annottext">[Natural]
</span><a href="#local-6989586621679126028"><span class="hs-identifier hs-var">ns</span></a></span><span>
</span><span id="line-186"></span><span>    </span><span class="annot"><a href="#local-6989586621679126024"><span class="hs-identifier hs-var">combine2</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-identifier">_</span></span><span>    </span><span id="local-6989586621679126032"><span class="annot"><span class="annottext">[Natural]
</span><a href="#local-6989586621679126032"><span class="hs-identifier hs-var">ns</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Natural]
</span><a href="#local-6989586621679126032"><span class="hs-identifier hs-var">ns</span></a></span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span class="hs-comment">-- The intermediate representation is a little-endian sequence in base</span><span>
</span><span id="line-189"></span><span class="hs-comment">-- @10^'safeLog'@, prefixed by an initial element in base @10^cnt@ for some</span><span>
</span><span id="line-190"></span><span class="hs-comment">-- @cnt@ between 1 and 'safeLog'.  The final result is obtained by recursive</span><span>
</span><span id="line-191"></span><span class="hs-comment">-- pairwise merging of the tail followed by a final multiplication by @10^cnt@</span><span>
</span><span id="line-192"></span><span class="hs-comment">-- and addition of the head.</span><span>
</span><span id="line-193"></span><span class="hs-comment">--</span><span>
</span><span id="line-194"></span><span class="annot"><a href="Data.ByteString.Lazy.ReadNat.html#natdigits"><span class="hs-identifier hs-type">natdigits</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ForeignPtr</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ Input chunk</span></span><span>
</span><span id="line-195"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>              </span><span class="annot"><span class="hs-comment">-- ^ Chunk length</span></span><span>
</span><span id="line-196"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Word"><span class="hs-identifier hs-type">Word</span></a></span><span>             </span><span class="annot"><span class="hs-comment">-- ^ accumulated element</span></span><span>
</span><span id="line-197"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>              </span><span class="annot"><span class="hs-comment">-- ^ partial digit count</span></span><span>
</span><span id="line-198"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span class="hs-special">]</span><span>        </span><span class="annot"><span class="hs-comment">-- ^ accumulated MSB elements</span></span><span>
</span><span id="line-199"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.ByteString.Lazy.ReadNat.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span>
</span><span id="line-200"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.ByteString.Lazy.ReadNat.html#natdigits"><span class="hs-pragma hs-type">natdigits</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-201"></span><span id="natdigits"><span class="annot"><span class="annottext">natdigits :: ForeignPtr Word8 -&gt; Int -&gt; Word -&gt; Int -&gt; [Natural] -&gt; Result
</span><a href="Data.ByteString.Lazy.ReadNat.html#natdigits"><span class="hs-identifier hs-var hs-var">natdigits</span></a></span></span><span> </span><span id="local-6989586621679126033"><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679126033"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span id="local-6989586621679126034"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126034"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679126035"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679126035"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621679126036"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126036"><span class="hs-identifier hs-var">cnt</span></a></span></span><span> </span><span id="local-6989586621679126037"><span class="annot"><span class="annottext">[Natural]
</span><a href="#local-6989586621679126037"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-202"></span><span>    </span><span class="annot"><span class="annottext">IO Result -&gt; Result
forall a. IO a -&gt; a
</span><a href="Data.ByteString.Internal.Type.html#accursedUnutterablePerformIO"><span class="hs-identifier hs-var">BI.accursedUnutterablePerformIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Result -&gt; Result) -&gt; IO Result -&gt; Result
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-203"></span><span>        </span><span class="annot"><span class="annottext">ForeignPtr Word8 -&gt; (Ptr Word8 -&gt; IO Result) -&gt; IO Result
forall a b. ForeignPtr a -&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">BI.unsafeWithForeignPtr</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679126033"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">((Ptr Word8 -&gt; IO Result) -&gt; IO Result)
-&gt; (Ptr Word8 -&gt; IO Result) -&gt; IO Result
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679126040"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679126040"><span class="hs-identifier hs-var">ptr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-204"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679126041"><span class="annot"><span class="annottext">end :: Ptr b
</span><a href="#local-6989586621679126041"><span class="hs-identifier hs-var hs-var">end</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679126040"><span class="hs-identifier hs-var">ptr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Int -&gt; Ptr b
forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><span class="hs-operator hs-var">`plusPtr`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126034"><span class="hs-identifier hs-var">len</span></a></span><span>
</span><span id="line-205"></span><span>            </span><span class="annot"><span class="annottext">Ptr Word8
-&gt; Ptr Word8 -&gt; Word -&gt; Int -&gt; [Natural] -&gt; Ptr Word8 -&gt; IO Result
forall {b}.
Ptr b
-&gt; Ptr Word8 -&gt; Word -&gt; Int -&gt; [Natural] -&gt; Ptr Word8 -&gt; IO Result
</span><a href="#local-6989586621679126042"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679126040"><span class="hs-identifier hs-var">ptr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
forall {b}. Ptr b
</span><a href="#local-6989586621679126041"><span class="hs-identifier hs-var">end</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679126035"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126036"><span class="hs-identifier hs-var">cnt</span></a></span><span> </span><span class="annot"><span class="annottext">[Natural]
</span><a href="#local-6989586621679126037"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679126040"><span class="hs-identifier hs-var">ptr</span></a></span><span>
</span><span id="line-206"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-207"></span><span>    </span><span id="local-6989586621679126042"><span class="annot"><span class="annottext">go :: Ptr b
-&gt; Ptr Word8 -&gt; Word -&gt; Int -&gt; [Natural] -&gt; Ptr Word8 -&gt; IO Result
</span><a href="#local-6989586621679126042"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679126055"><span class="annot"><span class="annottext">Ptr b
</span><a href="#local-6989586621679126055"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679126056"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679126056"><span class="hs-identifier hs-var">end</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int -&gt; [Natural] -&gt; Ptr Word8 -&gt; IO Result
</span><a href="#local-6989586621679126057"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-208"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-209"></span><span>        </span><span class="annot"><a href="#local-6989586621679126057"><span class="hs-identifier hs-type">loop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Word"><span class="hs-identifier hs-type">Word</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Data.ByteString.Lazy.ReadNat.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span>
</span><span id="line-210"></span><span>        </span><span id="local-6989586621679126057"><span class="annot"><span class="annottext">loop :: Word -&gt; Int -&gt; [Natural] -&gt; Ptr Word8 -&gt; IO Result
</span><a href="#local-6989586621679126057"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679126058"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679126058"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679126059"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126059"><span class="hs-identifier hs-var">cnt</span></a></span></span><span> </span><span id="local-6989586621679126060"><span class="annot"><span class="annottext">[Natural]
</span><a href="#local-6989586621679126060"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679126061"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679126061"><span class="hs-identifier hs-var">ptr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO Word
</span><a href="#local-6989586621679126062"><span class="hs-identifier hs-var">getDigit</span></a></span><span> </span><span class="annot"><span class="annottext">IO Word -&gt; (Word -&gt; IO Result) -&gt; IO Result
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679126063"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679126063"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-211"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679126063"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#%3E"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">9</span></span><span>
</span><span id="line-212"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Result -&gt; IO Result
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Result -&gt; IO Result) -&gt; Result -&gt; IO Result
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word -&gt; Int -&gt; [Natural] -&gt; Result
</span><a href="Data.ByteString.Lazy.ReadNat.html#Result"><span class="hs-identifier hs-var">Result</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679126061"><span class="hs-identifier hs-var">ptr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Ptr b -&gt; Int
forall a b. Ptr a -&gt; Ptr b -&gt; Int
</span><span class="hs-operator hs-var">`minusPtr`</span></span><span> </span><span class="annot"><span class="annottext">Ptr b
</span><a href="#local-6989586621679126055"><span class="hs-identifier hs-var">start</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679126058"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126059"><span class="hs-identifier hs-var">cnt</span></a></span><span> </span><span class="annot"><span class="annottext">[Natural]
</span><a href="#local-6989586621679126060"><span class="hs-identifier hs-var">ns</span></a></span><span>
</span><span id="line-213"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126059"><span class="hs-identifier hs-var">cnt</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#%3C"><span class="hs-operator hs-var">&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Data.ByteString.Lazy.ReadNat.html#safeLog"><span class="hs-identifier hs-var">safeLog</span></a></span><span>
</span><span id="line-214"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int -&gt; [Natural] -&gt; Ptr Word8 -&gt; IO Result
</span><a href="#local-6989586621679126057"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">10</span></span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679126058"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679126063"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679126059"><span class="hs-identifier hs-var">cnt</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Natural]
</span><a href="#local-6989586621679126060"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="annot"><span class="annottext">(Ptr Word8 -&gt; IO Result) -&gt; Ptr Word8 -&gt; IO Result
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679126061"><span class="hs-identifier hs-var">ptr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Int -&gt; Ptr Word8
forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><span class="hs-operator hs-var">`plusPtr`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-215"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-216"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679126066"><span class="annot"><span class="annottext">acc' :: Natural
</span><a href="#local-6989586621679126066"><span class="hs-identifier hs-var hs-var">acc'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Natural
</span><a href="Data.ByteString.Lazy.ReadNat.html#wordToNatural"><span class="hs-identifier hs-var">wordToNatural</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679126058"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-217"></span><span>                     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int -&gt; [Natural] -&gt; Ptr Word8 -&gt; IO Result
</span><a href="#local-6989586621679126057"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679126063"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679126066"><span class="hs-identifier hs-var">acc'</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; [Natural] -&gt; [Natural]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Natural]
</span><a href="#local-6989586621679126060"><span class="hs-identifier hs-var">ns</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Ptr Word8 -&gt; IO Result) -&gt; Ptr Word8 -&gt; IO Result
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679126061"><span class="hs-identifier hs-var">ptr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Int -&gt; Ptr Word8
forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><span class="hs-operator hs-var">`plusPtr`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-218"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-219"></span><span>            </span><span id="local-6989586621679126062"><span class="annot"><span class="annottext">getDigit :: IO Word
</span><a href="#local-6989586621679126062"><span class="hs-identifier hs-var hs-var">getDigit</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679126061"><span class="hs-identifier hs-var">ptr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Ptr Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679126056"><span class="hs-identifier hs-var">end</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word
</span><a href="Data.ByteString.Lazy.ReadNat.html#fromDigit"><span class="hs-identifier hs-var">fromDigit</span></a></span><span> </span><span class="annot"><span class="annottext">(Word8 -&gt; Word) -&gt; IO Word8 -&gt; IO Word
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; IO Word8
forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><span class="hs-identifier hs-var">peek</span></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679126061"><span class="hs-identifier hs-var">ptr</span></a></span><span>
</span><span id="line-220"></span><span>                     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word -&gt; IO Word
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">10</span></span><span>  </span><span class="hs-comment">-- End of input</span><span>
</span><span id="line-221"></span><span>            </span><span class="hs-pragma">{-# NOINLINE</span><span> </span><span class="annot"><a href="#local-6989586621679126062"><span class="hs-pragma hs-type">getDigit</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-222"></span><span>            </span><span class="hs-comment">-- 'getDigit' makes it possible to implement a single success</span><span>
</span><span id="line-223"></span><span>            </span><span class="hs-comment">-- exit point from the loop.  If instead we return 'Result'</span><span>
</span><span id="line-224"></span><span>            </span><span class="hs-comment">-- from multiple places, when 'natdigits' is inlined we get (at</span><span>
</span><span id="line-225"></span><span>            </span><span class="hs-comment">-- least GHC 8.10 through 9.2) for each exit path a separate</span><span>
</span><span id="line-226"></span><span>            </span><span class="hs-comment">-- join point implementing the continuation code.  GHC ticket</span><span>
</span><span id="line-227"></span><span>            </span><span class="hs-comment">-- &lt;https://gitlab.haskell.org/ghc/ghc/-/issues/20739&gt;.</span><span>
</span><span id="line-228"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-229"></span><span>            </span><span class="hs-comment">-- The NOINLINE pragma is required to avoid inlining branches</span><span>
</span><span id="line-230"></span><span>            </span><span class="hs-comment">-- that would restore multiple exit points.</span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span class="hs-comment">----- Misc functions</span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span class="hs-comment">-- | Largest decimal digit count that never overflows the accumulator</span><span>
</span><span id="line-235"></span><span class="hs-comment">-- The base 10 logarithm of 2 is ~0.30103, therefore 2^n has at least</span><span>
</span><span id="line-236"></span><span class="hs-comment">-- @1 + floor (0.3 n)@ decimal digits.  Therefore @floor (0.3 n)@,</span><span>
</span><span id="line-237"></span><span class="hs-comment">-- digits cannot overflow the upper bound of an @n-bit@ word.</span><span>
</span><span id="line-238"></span><span class="hs-comment">--</span><span>
</span><span id="line-239"></span><span class="annot"><a href="Data.ByteString.Lazy.ReadNat.html#safeLog"><span class="hs-identifier hs-type">safeLog</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-240"></span><span id="safeLog"><span class="annot"><span class="annottext">safeLog :: Int
</span><a href="Data.ByteString.Lazy.ReadNat.html#safeLog"><span class="hs-identifier hs-var hs-var">safeLog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">forall b. FiniteBits b =&gt; b -&gt; Int
</span><span class="hs-identifier hs-var">finiteBitSize</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Word"><span class="hs-identifier hs-type">Word</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span class="annot"><span class="hs-comment">-- | 10-power base for little-endian sequence of ~Word-sized &quot;digits&quot;</span></span><span>
</span><span id="line-243"></span><span class="annot"><a href="Data.ByteString.Lazy.ReadNat.html#safeBase"><span class="hs-identifier hs-type">safeBase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span>
</span><span id="line-244"></span><span id="safeBase"><span class="annot"><span class="annottext">safeBase :: Natural
</span><a href="Data.ByteString.Lazy.ReadNat.html#safeBase"><span class="hs-identifier hs-var hs-var">safeBase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Int -&gt; Natural
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Data.ByteString.Lazy.ReadNat.html#safeLog"><span class="hs-identifier hs-var">safeLog</span></a></span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span class="annot"><a href="Data.ByteString.Lazy.ReadNat.html#fromDigit"><span class="hs-identifier hs-type">fromDigit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Word"><span class="hs-identifier hs-type">Word</span></a></span><span>
</span><span id="line-247"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.ByteString.Lazy.ReadNat.html#fromDigit"><span class="hs-pragma hs-type">fromDigit</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-248"></span><span id="fromDigit"><span class="annot"><span class="annottext">fromDigit :: Word8 -&gt; Word
</span><a href="Data.ByteString.Lazy.ReadNat.html#fromDigit"><span class="hs-identifier hs-var hs-var">fromDigit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679126080"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679126080"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679126080"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0x30</span></span><span> </span><span class="hs-comment">-- i.e. w - '0'</span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span class="annot"><a href="Data.ByteString.Lazy.ReadNat.html#wordToNatural"><span class="hs-identifier hs-type">wordToNatural</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Word"><span class="hs-identifier hs-type">Word</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span>
</span><span id="line-251"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.ByteString.Lazy.ReadNat.html#wordToNatural"><span class="hs-pragma hs-type">wordToNatural</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-252"></span><span id="wordToNatural"><span class="annot"><span class="annottext">wordToNatural :: Word -&gt; Natural
</span><a href="Data.ByteString.Lazy.ReadNat.html#wordToNatural"><span class="hs-identifier hs-var hs-var">wordToNatural</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span>
</span><span id="line-253"></span></pre></body></html>