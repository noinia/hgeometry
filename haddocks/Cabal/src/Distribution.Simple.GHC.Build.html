<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Distribution.Simple.GHC.Build.html"><span class="hs-identifier">Distribution.Simple.GHC.Build</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.14.1.0-ebb2/src/Distribution.Compat.Prelude.html"><span class="hs-identifier">Distribution.Compat.Prelude</span></a></span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Prelude.html"><span class="hs-identifier">Prelude</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.IO.Class.html"><span class="hs-identifier">Control.Monad.IO.Class</span></a></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.14.1.0-ebb2/src/Distribution.PackageDescription.html"><span class="hs-identifier">Distribution.PackageDescription</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PD</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../Cabal-syntax-3.14.1.0-ebb2/src/Distribution.Types.Executable.html#buildInfo"><span class="hs-identifier">buildInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Distribution.Simple.Build.Inputs.html"><span class="hs-identifier">Distribution.Simple.Build.Inputs</span></a></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Distribution.Simple.Flag.html"><span class="hs-identifier">Distribution.Simple.Flag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier">Flag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Distribution.Simple.GHC.Build.ExtraSources.html"><span class="hs-identifier">Distribution.Simple.GHC.Build.ExtraSources</span></a></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Distribution.Simple.GHC.Build.Link.html"><span class="hs-identifier">Distribution.Simple.GHC.Build.Link</span></a></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Distribution.Simple.GHC.Build.Modules.html"><span class="hs-identifier">Distribution.Simple.GHC.Build.Modules</span></a></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Distribution.Simple.GHC.Build.Utils.html"><span class="hs-identifier">Distribution.Simple.GHC.Build.Utils</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Distribution.Simple.GHC.Build.Utils.html#compilerBuildWay"><span class="hs-identifier">compilerBuildWay</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Distribution.Simple.GHC.Build.Utils.html#isHaskell"><span class="hs-identifier">isHaskell</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Distribution.Simple.GHC.Build.Utils.html#withDynFLib"><span class="hs-identifier">withDynFLib</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Distribution.Simple.LocalBuildInfo.html"><span class="hs-identifier">Distribution.Simple.LocalBuildInfo</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Distribution.Simple.Program.Builtin.html"><span class="hs-identifier">Distribution.Simple.Program.Builtin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Distribution.Simple.Program.Builtin.html#ghcProgram"><span class="hs-identifier">ghcProgram</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Distribution.Simple.Program.Db.html"><span class="hs-identifier">Distribution.Simple.Program.Db</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Distribution.Simple.Program.Db.html#requireProgram"><span class="hs-identifier">requireProgram</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Distribution.Simple.Utils.html"><span class="hs-identifier">Distribution.Simple.Utils</span></a></span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Distribution.Types.ComponentLocalBuildInfo.html"><span class="hs-identifier">Distribution.Types.ComponentLocalBuildInfo</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Distribution.Types.PackageName.Magic.html"><span class="hs-identifier">Distribution.Types.PackageName.Magic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Distribution.Types.PackageName.Magic.html#fakePackageId"><span class="hs-identifier">fakePackageId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Distribution.Types.ParStrat.html"><span class="hs-identifier">Distribution.Types.ParStrat</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Distribution.Utils.NubList.html"><span class="hs-identifier">Distribution.Utils.NubList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Distribution.Utils.NubList.html#fromNubListR"><span class="hs-identifier">fromNubListR</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.14.1.0-ebb2/src/Distribution.Utils.Path.html"><span class="hs-identifier">Distribution.Utils.Path</span></a></span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.html"><span class="hs-identifier">System.FilePath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#splitDirectories"><span class="hs-identifier">splitDirectories</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-comment">{- Note [Build Target Dir vs Target Dir]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Where to place the build result (targetDir) and the build artifacts (buildTargetDir).

\* For libraries, targetDir == buildTargetDir, where both the library and
artifacts are put together.

\* For executables or foreign libs, buildTargetDir == targetDir/&lt;name-of-target-dir&gt;-tmp, where
    the targetDir is the location where the target (e.g. the executable) is written to
    and buildTargetDir is where the compilation artifacts (e.g. Main.o) will live
  Arguably, this difference should not exist (#9498) (TODO)

For instance, for a component `cabal-benchmarks`:
  targetDir == &lt;buildDir&gt;/cabal-benchmarks
  buildTargetDir == &lt;buildDir&gt;/cabal-benchmarks/cabal-benchmarks-tmp

Or, for a library `Cabal`:
  targetDir == &lt;buildDir&gt;/.
  buildTargetDir == targetDir

Furthermore, we need to account for the limit of characters in ghc
invocations that different OSes constrain us to. Cabal invocations can
rapidly reach this limit, in part, due to the long length of cabal v2
prefixes. To minimize the likelihood, we use
`tryMakeRelativeToWorkingDir` to shorten the paths used in invocations
(see da6321bb).

However, in executables, we don't do this. It seems that we don't need to do it
for executable-like components because the linking step, instead of passing as
an argument the path to each module, it simply passes the module name, the sources dir, and --make.
RM: I believe we can use --make + module names instead of paths-to-objects
for linking libraries too (2024-01) (TODO)
-}</span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="hs-comment">-- | The main build phase of building a component.</span><span>
</span><span id="line-64"></span><span class="hs-comment">-- Includes building Haskell modules, extra build sources, and linking.</span><span>
</span><span id="line-65"></span><span class="annot"><a href="Distribution.Simple.GHC.Build.html#build"><span class="hs-identifier hs-type">build</span></a></span><span>
</span><span id="line-66"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a></span><span> </span><span class="annot"><a href="Distribution.Types.ParStrat.html#ParStrat"><span class="hs-identifier hs-type">ParStrat</span></a></span><span>
</span><span id="line-67"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.14.1.0-ebb2/src/Distribution.Types.PackageDescription.html#PackageDescription"><span class="hs-identifier hs-type">PackageDescription</span></a></span><span>
</span><span id="line-68"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Distribution.Simple.Build.Inputs.html#PreBuildComponentInputs"><span class="hs-identifier hs-type">PreBuildComponentInputs</span></a></span><span>
</span><span id="line-69"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ The context and component being built in it.</span></span><span>
</span><span id="line-70"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span id="build"><span class="annot"><span class="annottext">build :: Flag ParStrat
-&gt; PackageDescription -&gt; PreBuildComponentInputs -&gt; IO ()
</span><a href="Distribution.Simple.GHC.Build.html#build"><span class="hs-identifier hs-var hs-var">build</span></a></span></span><span> </span><span id="local-6989586621679554001"><span class="annot"><span class="annottext">Flag ParStrat
</span><a href="#local-6989586621679554001"><span class="hs-identifier hs-var">numJobs</span></a></span></span><span> </span><span id="local-6989586621679554002"><span class="annot"><span class="annottext">PackageDescription
</span><a href="#local-6989586621679554002"><span class="hs-identifier hs-var">pkg_descr</span></a></span></span><span> </span><span id="local-6989586621679554003"><span class="annot"><span class="annottext">PreBuildComponentInputs
</span><a href="#local-6989586621679554003"><span class="hs-identifier hs-var">pbci</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-72"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-73"></span><span>    </span><span id="local-6989586621679554004"><span class="annot"><span class="annottext">verbosity :: Verbosity
</span><a href="#local-6989586621679554004"><span class="hs-identifier hs-var hs-var hs-var">verbosity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreBuildComponentInputs -&gt; Verbosity
</span><a href="Distribution.Simple.Build.Inputs.html#buildVerbosity"><span class="hs-identifier hs-var">buildVerbosity</span></a></span><span> </span><span class="annot"><span class="annottext">PreBuildComponentInputs
</span><a href="#local-6989586621679554003"><span class="hs-identifier hs-var">pbci</span></a></span><span>
</span><span id="line-74"></span><span>    </span><span id="local-6989586621679554006"><span class="annot"><span class="annottext">isLib :: Bool
</span><a href="#local-6989586621679554006"><span class="hs-identifier hs-var hs-var hs-var">isLib</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreBuildComponentInputs -&gt; Bool
</span><a href="Distribution.Simple.Build.Inputs.html#buildIsLib"><span class="hs-identifier hs-var">buildIsLib</span></a></span><span> </span><span class="annot"><span class="annottext">PreBuildComponentInputs
</span><a href="#local-6989586621679554003"><span class="hs-identifier hs-var">pbci</span></a></span><span>
</span><span id="line-75"></span><span>    </span><span id="local-6989586621679554008"><span class="annot"><span class="annottext">lbi :: LocalBuildInfo
</span><a href="#local-6989586621679554008"><span class="hs-identifier hs-var hs-var hs-var">lbi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreBuildComponentInputs -&gt; LocalBuildInfo
</span><a href="Distribution.Simple.Build.Inputs.html#localBuildInfo"><span class="hs-identifier hs-var">localBuildInfo</span></a></span><span> </span><span class="annot"><span class="annottext">PreBuildComponentInputs
</span><a href="#local-6989586621679554003"><span class="hs-identifier hs-var">pbci</span></a></span><span>
</span><span id="line-76"></span><span>    </span><span id="local-6989586621679554010"><span class="annot"><span class="annottext">bi :: BuildInfo
</span><a href="#local-6989586621679554010"><span class="hs-identifier hs-var hs-var hs-var">bi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreBuildComponentInputs -&gt; BuildInfo
</span><a href="Distribution.Simple.Build.Inputs.html#buildBI"><span class="hs-identifier hs-var">buildBI</span></a></span><span> </span><span class="annot"><span class="annottext">PreBuildComponentInputs
</span><a href="#local-6989586621679554003"><span class="hs-identifier hs-var">pbci</span></a></span><span>
</span><span id="line-77"></span><span>    </span><span id="local-6989586621679554012"><span class="annot"><span class="annottext">clbi :: ComponentLocalBuildInfo
</span><a href="#local-6989586621679554012"><span class="hs-identifier hs-var hs-var hs-var">clbi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreBuildComponentInputs -&gt; ComponentLocalBuildInfo
</span><a href="Distribution.Simple.Build.Inputs.html#buildCLBI"><span class="hs-identifier hs-var">buildCLBI</span></a></span><span> </span><span class="annot"><span class="annottext">PreBuildComponentInputs
</span><a href="#local-6989586621679554003"><span class="hs-identifier hs-var">pbci</span></a></span><span>
</span><span id="line-78"></span><span>    </span><span id="local-6989586621679554014"><span class="annot"><span class="annottext">isIndef :: Bool
</span><a href="#local-6989586621679554014"><span class="hs-identifier hs-var hs-var hs-var">isIndef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ComponentLocalBuildInfo -&gt; Bool
</span><a href="Distribution.Types.ComponentLocalBuildInfo.html#componentIsIndefinite"><span class="hs-identifier hs-var">componentIsIndefinite</span></a></span><span> </span><span class="annot"><span class="annottext">ComponentLocalBuildInfo
</span><a href="#local-6989586621679554012"><span class="hs-identifier hs-var">clbi</span></a></span><span>
</span><span id="line-79"></span><span>    </span><span id="local-6989586621679554016"><span class="annot"><span class="annottext">mbWorkDir :: Maybe (SymbolicPath CWD ('Dir Pkg))
</span><a href="#local-6989586621679554016"><span class="hs-identifier hs-var hs-var hs-var">mbWorkDir</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocalBuildInfo -&gt; Maybe (SymbolicPath CWD ('Dir Pkg))
</span><a href="Distribution.Simple.LocalBuildInfo.html#mbWorkDirLBI"><span class="hs-identifier hs-var">mbWorkDirLBI</span></a></span><span> </span><span class="annot"><span class="annottext">LocalBuildInfo
</span><a href="#local-6989586621679554008"><span class="hs-identifier hs-var">lbi</span></a></span><span>
</span><span id="line-80"></span><span>    </span><span id="local-6989586621679554018"><span class="annot"><span class="annottext">i :: SymbolicPathX allowAbsolute Pkg to -&gt; FilePath
</span><a href="#local-6989586621679554018"><span class="hs-identifier hs-var hs-var hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocalBuildInfo -&gt; SymbolicPathX allowAbsolute Pkg to -&gt; FilePath
forall (allowAbsolute :: AllowAbsolute) (to :: FileOrDir).
LocalBuildInfo -&gt; SymbolicPathX allowAbsolute Pkg to -&gt; FilePath
</span><a href="Distribution.Simple.LocalBuildInfo.html#interpretSymbolicPathLBI"><span class="hs-identifier hs-var">interpretSymbolicPathLBI</span></a></span><span> </span><span class="annot"><span class="annottext">LocalBuildInfo
</span><a href="#local-6989586621679554008"><span class="hs-identifier hs-var">lbi</span></a></span><span> </span><span class="hs-comment">-- See Note [Symbolic paths] in Distribution.Utils.Path</span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-comment">-- Create a few directories for building the component</span><span>
</span><span id="line-83"></span><span>  </span><span class="hs-comment">-- See Note [Build Target Dir vs Target Dir]</span><span>
</span><span id="line-84"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679554020"><span class="hs-identifier hs-type">targetDir0</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.14.1.0-ebb2/src/Distribution.Utils.Path.html#SymbolicPath"><span class="hs-identifier hs-type">SymbolicPath</span></a></span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.14.1.0-ebb2/src/Distribution.Utils.Path.html#Pkg"><span class="hs-identifier hs-type">Pkg</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="../../Cabal-syntax-3.14.1.0-ebb2/src/Distribution.Utils.Path.html#Dir"><span class="hs-identifier hs-type">Dir</span></a></span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.14.1.0-ebb2/src/Distribution.Utils.Path.html#Build"><span class="hs-identifier hs-type">Build</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span>      </span><span id="local-6989586621679554020"><span class="annot"><span class="annottext">targetDir0 :: SymbolicPath Pkg ('Dir Build)
</span><a href="#local-6989586621679554020"><span class="hs-identifier hs-var hs-var hs-var">targetDir0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocalBuildInfo
-&gt; ComponentLocalBuildInfo -&gt; SymbolicPath Pkg ('Dir Build)
</span><a href="Distribution.Simple.LocalBuildInfo.html#componentBuildDir"><span class="hs-identifier hs-var">componentBuildDir</span></a></span><span> </span><span class="annot"><span class="annottext">LocalBuildInfo
</span><a href="#local-6989586621679554008"><span class="hs-identifier hs-var">lbi</span></a></span><span> </span><span class="annot"><span class="annottext">ComponentLocalBuildInfo
</span><a href="#local-6989586621679554012"><span class="hs-identifier hs-var">clbi</span></a></span><span>
</span><span id="line-86"></span><span>      </span><span class="annot"><a href="#local-6989586621679554022"><span class="hs-identifier hs-type">buildTargetDir0</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.14.1.0-ebb2/src/Distribution.Utils.Path.html#SymbolicPath"><span class="hs-identifier hs-type">SymbolicPath</span></a></span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.14.1.0-ebb2/src/Distribution.Utils.Path.html#Pkg"><span class="hs-identifier hs-type">Pkg</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="../../Cabal-syntax-3.14.1.0-ebb2/src/Distribution.Utils.Path.html#Dir"><span class="hs-identifier hs-type">Dir</span></a></span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.14.1.0-ebb2/src/Distribution.Utils.Path.html#Artifacts"><span class="hs-identifier hs-type">Artifacts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>      </span><span id="local-6989586621679554022"><span class="annot"><span class="annottext">buildTargetDir0 :: SymbolicPath Pkg ('Dir Artifacts)
</span><a href="#local-6989586621679554022"><span class="hs-identifier hs-var hs-var hs-var">buildTargetDir0</span></a></span></span><span>
</span><span id="line-88"></span><span>        </span><span class="hs-comment">-- Libraries use the target dir for building (see above)</span><span>
</span><span id="line-89"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679554006"><span class="hs-identifier hs-var">isLib</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SymbolicPath Pkg ('Dir Build) -&gt; SymbolicPath Pkg ('Dir Artifacts)
forall (allowAbsolute :: AllowAbsolute) from (to1 :: FileOrDir)
       (to2 :: FileOrDir).
SymbolicPathX allowAbsolute from to1
-&gt; SymbolicPathX allowAbsolute from to2
</span><a href="../../Cabal-syntax-3.14.1.0-ebb2/src/Distribution.Utils.Path.html#coerceSymbolicPath"><span class="hs-identifier hs-var">coerceSymbolicPath</span></a></span><span> </span><span class="annot"><span class="annottext">SymbolicPath Pkg ('Dir Build)
</span><a href="#local-6989586621679554020"><span class="hs-identifier hs-var">targetDir0</span></a></span><span>
</span><span id="line-90"></span><span>        </span><span class="hs-comment">-- In other cases, use targetDir/&lt;name-of-target-dir&gt;-tmp</span><span>
</span><span id="line-91"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679554024"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679554024"><span class="hs-identifier hs-var">targetDirName</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[FilePath] -&gt; [FilePath]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">([FilePath] -&gt; [FilePath]) -&gt; [FilePath] -&gt; [FilePath]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath]
</span><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#splitDirectories"><span class="hs-identifier hs-var">splitDirectories</span></a></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; [FilePath]) -&gt; FilePath -&gt; [FilePath]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SymbolicPath Pkg ('Dir Build) -&gt; FilePath
forall (allowAbsolute :: AllowAbsolute) from (to :: FileOrDir).
SymbolicPathX allowAbsolute from to -&gt; FilePath
</span><a href="../../Cabal-syntax-3.14.1.0-ebb2/src/Distribution.Utils.Path.html#getSymbolicPath"><span class="hs-identifier hs-var">getSymbolicPath</span></a></span><span> </span><span class="annot"><span class="annottext">SymbolicPath Pkg ('Dir Build)
</span><a href="#local-6989586621679554020"><span class="hs-identifier hs-var">targetDir0</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-92"></span><span>            </span><span class="annot"><span class="annottext">SymbolicPath Pkg ('Dir Build)
-&gt; SymbolicPathX 'AllowAbsolute Pkg ('Dir (ZonkAny 0))
forall (allowAbsolute :: AllowAbsolute) from (to1 :: FileOrDir)
       (to2 :: FileOrDir).
SymbolicPathX allowAbsolute from to1
-&gt; SymbolicPathX allowAbsolute from to2
</span><a href="../../Cabal-syntax-3.14.1.0-ebb2/src/Distribution.Utils.Path.html#coerceSymbolicPath"><span class="hs-identifier hs-var">coerceSymbolicPath</span></a></span><span> </span><span class="annot"><span class="annottext">SymbolicPath Pkg ('Dir Build)
</span><a href="#local-6989586621679554020"><span class="hs-identifier hs-var">targetDir0</span></a></span><span> </span><span class="annot"><span class="annottext">SymbolicPathX 'AllowAbsolute Pkg ('Dir (ZonkAny 0))
-&gt; RelativePath (ZonkAny 0) ('Dir Artifacts)
-&gt; SymbolicPath Pkg ('Dir Artifacts)
forall p q r. PathLike p q r =&gt; p -&gt; q -&gt; r
</span><a href="../../Cabal-syntax-3.14.1.0-ebb2/src/Distribution.Utils.Path.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; RelativePath (ZonkAny 0) ('Dir Artifacts)
forall from (to :: FileOrDir).
HasCallStack =&gt;
FilePath -&gt; RelativePath from to
</span><a href="../../Cabal-syntax-3.14.1.0-ebb2/src/Distribution.Utils.Path.html#makeRelativePathEx"><span class="hs-identifier hs-var">makeRelativePathEx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679554024"><span class="hs-identifier hs-var">targetDirName</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;-tmp&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SymbolicPath Pkg ('Dir Artifacts)
forall a. HasCallStack =&gt; FilePath -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;GHC.build: targetDir is empty&quot;</span></span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span>  </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
forall a. IO a -&gt; IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-96"></span><span>    </span><span class="annot"><span class="annottext">Verbosity -&gt; Bool -&gt; FilePath -&gt; IO ()
</span><a href="Distribution.Simple.Utils.html#createDirectoryIfMissingVerbose"><span class="hs-identifier hs-var">createDirectoryIfMissingVerbose</span></a></span><span> </span><span class="annot"><span class="annottext">Verbosity
</span><a href="#local-6989586621679554004"><span class="hs-identifier hs-var">verbosity</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; IO ()) -&gt; FilePath -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SymbolicPath Pkg ('Dir Build) -&gt; FilePath
forall {allowAbsolute :: AllowAbsolute} {to :: FileOrDir}.
SymbolicPathX allowAbsolute Pkg to -&gt; FilePath
</span><a href="#local-6989586621679554018"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">SymbolicPath Pkg ('Dir Build)
</span><a href="#local-6989586621679554020"><span class="hs-identifier hs-var">targetDir0</span></a></span><span>
</span><span id="line-97"></span><span>    </span><span class="annot"><span class="annottext">Verbosity -&gt; Bool -&gt; FilePath -&gt; IO ()
</span><a href="Distribution.Simple.Utils.html#createDirectoryIfMissingVerbose"><span class="hs-identifier hs-var">createDirectoryIfMissingVerbose</span></a></span><span> </span><span class="annot"><span class="annottext">Verbosity
</span><a href="#local-6989586621679554004"><span class="hs-identifier hs-var">verbosity</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; IO ()) -&gt; FilePath -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SymbolicPath Pkg ('Dir Artifacts) -&gt; FilePath
forall {allowAbsolute :: AllowAbsolute} {to :: FileOrDir}.
SymbolicPathX allowAbsolute Pkg to -&gt; FilePath
</span><a href="#local-6989586621679554018"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">SymbolicPath Pkg ('Dir Artifacts)
</span><a href="#local-6989586621679554022"><span class="hs-identifier hs-var">buildTargetDir0</span></a></span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span>  </span><span class="hs-comment">-- See Note [Build Target Dir vs Target Dir] as well</span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679554032"><span class="annot"><span class="annottext">targetDir :: SymbolicPath Pkg ('Dir Build)
</span><a href="#local-6989586621679554032"><span class="hs-identifier hs-var hs-var hs-var">targetDir</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SymbolicPath Pkg ('Dir Build)
</span><a href="#local-6989586621679554020"><span class="hs-identifier hs-var">targetDir0</span></a></span><span> </span><span class="hs-comment">-- NB: no 'makeRelative'</span><span>
</span><span id="line-101"></span><span>  </span><span id="local-6989586621679554033"><span class="annot"><a href="#local-6989586621679554033"><span class="hs-identifier hs-var">buildTargetDir</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-102"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679554006"><span class="hs-identifier hs-var">isLib</span></a></span><span>
</span><span id="line-103"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="hs-comment">-- NB: this might fail to make the buildTargetDir relative,</span><span>
</span><span id="line-104"></span><span>      </span><span class="hs-comment">-- as noted in #9776. Oh well.</span><span>
</span><span id="line-105"></span><span>        </span><span class="annot"><span class="annottext">Maybe (SymbolicPath CWD ('Dir Pkg))
-&gt; SymbolicPath Pkg ('Dir Artifacts)
-&gt; IO (SymbolicPath Pkg ('Dir Artifacts))
forall dir (to :: FileOrDir).
Maybe (SymbolicPath CWD ('Dir dir))
-&gt; SymbolicPath dir to -&gt; IO (SymbolicPath dir to)
</span><a href="../../Cabal-syntax-3.14.1.0-ebb2/src/Distribution.Utils.Path.html#tryMakeRelative"><span class="hs-identifier hs-var">tryMakeRelative</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SymbolicPath CWD ('Dir Pkg))
</span><a href="#local-6989586621679554016"><span class="hs-identifier hs-var">mbWorkDir</span></a></span><span> </span><span class="annot"><span class="annottext">SymbolicPath Pkg ('Dir Artifacts)
</span><a href="#local-6989586621679554022"><span class="hs-identifier hs-var">buildTargetDir0</span></a></span><span>
</span><span id="line-106"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">SymbolicPath Pkg ('Dir Artifacts)
-&gt; IO (SymbolicPath Pkg ('Dir Artifacts))
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">SymbolicPath Pkg ('Dir Artifacts)
</span><a href="#local-6989586621679554022"><span class="hs-identifier hs-var">buildTargetDir0</span></a></span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-comment">-- To preserve the previous behaviour, we don't use relative dirs for</span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-comment">-- executables. Historically, this isn't needed to reduce the CLI limit</span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-comment">-- (unlike for libraries) because we link executables with the module names</span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-comment">-- instead of passing the path to object file -- that's something else we</span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-comment">-- can now fix after the refactor lands.</span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679554035"><span class="annot"><a href="#local-6989586621679554035"><span class="hs-identifier hs-var">ghcProg</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Distribution.Simple.Program.Db.html#requireProgram"><span class="hs-identifier hs-type">requireProgram</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679554004"><span class="hs-identifier hs-type">verbosity</span></a></span><span> </span><span class="annot"><a href="Distribution.Simple.Program.Builtin.html#ghcProgram"><span class="hs-identifier hs-type">ghcProgram</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Distribution.Types.LocalBuildInfo.html#withPrograms"><span class="hs-identifier hs-var">withPrograms</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679554008"><span class="hs-identifier hs-type">lbi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span>  </span><span class="hs-comment">-- Ways which are wanted from configuration flags</span><span>
</span><span id="line-116"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679554037"><span class="annot"><a href="#local-6989586621679554037"><span class="hs-identifier hs-var">wantedWays</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679554038"><span class="annot"><a href="#local-6989586621679554038"><span class="hs-identifier hs-var">wantedLibWays</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679554039"><span class="annot"><a href="#local-6989586621679554039"><span class="hs-identifier hs-var">wantedFLibWay</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679554040"><span class="annot"><a href="#local-6989586621679554040"><span class="hs-identifier hs-var">wantedExeWay</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Distribution.Types.LocalBuildInfo.html#buildWays"><span class="hs-identifier hs-type">buildWays</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679554008"><span class="hs-identifier hs-type">lbi</span></a></span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-comment">-- Ways which are needed due to the compiler configuration</span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679554042"><span class="annot"><a href="#local-6989586621679554042"><span class="hs-identifier hs-var hs-var">doingTH</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuildInfo -&gt; Bool
</span><a href="../../Cabal-syntax-3.14.1.0-ebb2/src/Distribution.Types.BuildInfo.html#usesTemplateHaskellOrQQ"><span class="hs-identifier hs-var">usesTemplateHaskellOrQQ</span></a></span><span> </span><span class="annot"><span class="annottext">BuildInfo
</span><a href="#local-6989586621679554010"><span class="hs-identifier hs-var">bi</span></a></span><span>
</span><span id="line-120"></span><span>      </span><span id="local-6989586621679554044"><span class="annot"><a href="#local-6989586621679554044"><span class="hs-identifier hs-var hs-var">defaultGhcWay</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Compiler -&gt; BuildWay
</span><a href="Distribution.Simple.GHC.Build.Utils.html#compilerBuildWay"><span class="hs-identifier hs-var">compilerBuildWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreBuildComponentInputs -&gt; Compiler
</span><a href="Distribution.Simple.Build.Inputs.html#buildCompiler"><span class="hs-identifier hs-var">buildCompiler</span></a></span><span> </span><span class="annot"><span class="annottext">PreBuildComponentInputs
</span><a href="#local-6989586621679554003"><span class="hs-identifier hs-var">pbci</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>      </span><span id="local-6989586621679554046"><span class="annot"><a href="#local-6989586621679554046"><span class="hs-identifier hs-var hs-var">wantedModBuildWays</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PreBuildComponentInputs -&gt; Component
</span><a href="Distribution.Simple.Build.Inputs.html#buildComponent"><span class="hs-identifier hs-var">buildComponent</span></a></span><span> </span><span class="annot"><span class="annottext">PreBuildComponentInputs
</span><a href="#local-6989586621679554003"><span class="hs-identifier hs-var">pbci</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-122"></span><span>        </span><span class="annot"><a href="../../Cabal-syntax-3.14.1.0-ebb2/src/Distribution.Types.Component.html#CLib"><span class="hs-identifier hs-type">CLib</span></a></span><span> </span><span class="annot"><span class="annottext">Library
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; [BuildWay]
</span><a href="#local-6989586621679554038"><span class="hs-identifier hs-var">wantedLibWays</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679554014"><span class="hs-identifier hs-var">isIndef</span></a></span><span>
</span><span id="line-123"></span><span>        </span><span class="annot"><a href="../../Cabal-syntax-3.14.1.0-ebb2/src/Distribution.Types.Component.html#CFLib"><span class="hs-identifier hs-type">CFLib</span></a></span><span> </span><span id="local-6989586621679554050"><span class="annot"><span class="annottext">ForeignLib
</span><a href="#local-6989586621679554050"><span class="hs-identifier hs-var">fl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Bool -&gt; BuildWay
</span><a href="#local-6989586621679554039"><span class="hs-identifier hs-var">wantedFLibWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ForeignLib -&gt; Bool
</span><a href="Distribution.Simple.GHC.Build.Utils.html#withDynFLib"><span class="hs-identifier hs-var">withDynFLib</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignLib
</span><a href="#local-6989586621679554050"><span class="hs-identifier hs-var">fl</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-124"></span><span>        </span><span class="annot"><a href="../../Cabal-syntax-3.14.1.0-ebb2/src/Distribution.Types.Component.html#CExe"><span class="hs-identifier hs-type">CExe</span></a></span><span> </span><span class="annot"><span class="annottext">Executable
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BuildWay
</span><a href="#local-6989586621679554040"><span class="hs-identifier hs-var">wantedExeWay</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-125"></span><span>        </span><span class="annot"><a href="../../Cabal-syntax-3.14.1.0-ebb2/src/Distribution.Types.Component.html#CTest"><span class="hs-identifier hs-type">CTest</span></a></span><span> </span><span class="annot"><span class="annottext">TestSuite
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BuildWay
</span><a href="#local-6989586621679554040"><span class="hs-identifier hs-var">wantedExeWay</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-126"></span><span>        </span><span class="annot"><a href="../../Cabal-syntax-3.14.1.0-ebb2/src/Distribution.Types.Component.html#CBench"><span class="hs-identifier hs-type">CBench</span></a></span><span> </span><span class="annot"><span class="annottext">Benchmark
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BuildWay
</span><a href="#local-6989586621679554040"><span class="hs-identifier hs-var">wantedExeWay</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-127"></span><span>      </span><span id="local-6989586621679554058"><span class="annot"><a href="#local-6989586621679554058"><span class="hs-identifier hs-var hs-var">finalModBuildWays</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-128"></span><span>        </span><span class="annot"><span class="annottext">[BuildWay]
</span><a href="#local-6989586621679554046"><span class="hs-identifier hs-var">wantedModBuildWays</span></a></span><span>
</span><span id="line-129"></span><span>          </span><span class="annot"><span class="annottext">[BuildWay] -&gt; [BuildWay] -&gt; [BuildWay]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BuildWay
</span><a href="#local-6989586621679554044"><span class="hs-identifier hs-var">defaultGhcWay</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679554042"><span class="hs-identifier hs-var">doingTH</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">BuildWay
</span><a href="#local-6989586621679554044"><span class="hs-identifier hs-var">defaultGhcWay</span></a></span><span> </span><span class="annot"><span class="annottext">BuildWay -&gt; [BuildWay] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`notElem`</span></span><span> </span><span class="annot"><span class="annottext">[BuildWay]
</span><a href="#local-6989586621679554046"><span class="hs-identifier hs-var">wantedModBuildWays</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-130"></span><span>      </span><span id="local-6989586621679554061"><span class="annot"><a href="#local-6989586621679554061"><span class="hs-identifier hs-var hs-var">compNameStr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ComponentName -&gt; FilePath
</span><a href="../../Cabal-syntax-3.14.1.0-ebb2/src/Distribution.Types.ComponentName.html#showComponentName"><span class="hs-identifier hs-var">showComponentName</span></a></span><span> </span><span class="annot"><span class="annottext">(ComponentName -&gt; FilePath) -&gt; ComponentName -&gt; FilePath
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Component -&gt; ComponentName
</span><a href="../../Cabal-syntax-3.14.1.0-ebb2/src/Distribution.Types.Component.html#componentName"><span class="hs-identifier hs-var">componentName</span></a></span><span> </span><span class="annot"><span class="annottext">(Component -&gt; ComponentName) -&gt; Component -&gt; ComponentName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PreBuildComponentInputs -&gt; Component
</span><a href="Distribution.Simple.Build.Inputs.html#buildComponent"><span class="hs-identifier hs-var">buildComponent</span></a></span><span> </span><span class="annot"><span class="annottext">PreBuildComponentInputs
</span><a href="#local-6989586621679554003"><span class="hs-identifier hs-var">pbci</span></a></span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Distribution.Simple.Utils.html#info"><span class="hs-identifier hs-type">info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679554004"><span class="hs-identifier hs-type">verbosity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;Wanted module build ways(&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621679554061"><span class="hs-identifier hs-type">compNameStr</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;): &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621679554046"><span class="hs-identifier hs-type">wantedModBuildWays</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Distribution.Simple.Utils.html#info"><span class="hs-identifier hs-type">info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679554004"><span class="hs-identifier hs-type">verbosity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;Final module build ways(&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621679554061"><span class="hs-identifier hs-type">compNameStr</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;): &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621679554058"><span class="hs-identifier hs-type">finalModBuildWays</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>  </span><span class="hs-comment">-- We need a separate build and link phase, and C sources must be compiled</span><span>
</span><span id="line-135"></span><span>  </span><span class="hs-comment">-- after Haskell modules, because C sources may depend on stub headers</span><span>
</span><span id="line-136"></span><span>  </span><span class="hs-comment">-- generated from compiling Haskell modules (#842, #3294).</span><span>
</span><span id="line-137"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679554066"><span class="annot"><a href="#local-6989586621679554066"><span class="hs-identifier hs-var">mbMainFile</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679554067"><span class="annot"><a href="#local-6989586621679554067"><span class="hs-identifier hs-var">inputModules</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Distribution.Simple.GHC.Build.Modules.html#componentInputs"><span class="hs-identifier hs-type">componentInputs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679554033"><span class="hs-identifier hs-type">buildTargetDir</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679554002"><span class="hs-identifier hs-type">pkg_descr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679554003"><span class="hs-identifier hs-type">pbci</span></a></span><span>
</span><span id="line-138"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679554071"><span class="annot"><a href="#local-6989586621679554071"><span class="hs-identifier hs-var">hsMainFile</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679554072"><span class="annot"><a href="#local-6989586621679554072"><span class="hs-identifier hs-var">nonHsMainFile</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-139"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621679554066"><span class="hs-identifier hs-type">mbMainFile</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-140"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679554073"><span class="annot"><span class="annottext">SymbolicPath Pkg 'File
</span><a href="#local-6989586621679554073"><span class="hs-identifier hs-var">mainFile</span></a></span></span><span>
</span><span id="line-141"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PackageDescription -&gt; PackageIdentifier
</span><a href="../../Cabal-syntax-3.14.1.0-ebb2/src/Distribution.Types.PackageDescription.html#package"><span class="hs-identifier hs-var">PD.package</span></a></span><span> </span><span class="annot"><span class="annottext">PackageDescription
</span><a href="#local-6989586621679554002"><span class="hs-identifier hs-var">pkg_descr</span></a></span><span> </span><span class="annot"><span class="annottext">PackageIdentifier -&gt; PackageIdentifier -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">PackageIdentifier
</span><a href="Distribution.Types.PackageName.Magic.html#fakePackageId"><span class="hs-identifier hs-var">fakePackageId</span></a></span><span>
</span><span id="line-142"></span><span>                </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Bool
</span><a href="Distribution.Simple.GHC.Build.Utils.html#isHaskell"><span class="hs-identifier hs-var">isHaskell</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SymbolicPath Pkg 'File -&gt; FilePath
forall (allowAbsolute :: AllowAbsolute) from (to :: FileOrDir).
SymbolicPathX allowAbsolute from to -&gt; FilePath
</span><a href="../../Cabal-syntax-3.14.1.0-ebb2/src/Distribution.Utils.Path.html#getSymbolicPath"><span class="hs-identifier hs-var">getSymbolicPath</span></a></span><span> </span><span class="annot"><span class="annottext">SymbolicPath Pkg 'File
</span><a href="#local-6989586621679554073"><span class="hs-identifier hs-var">mainFile</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-143"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SymbolicPath Pkg 'File -&gt; Maybe (SymbolicPath Pkg 'File)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">SymbolicPath Pkg 'File
</span><a href="#local-6989586621679554073"><span class="hs-identifier hs-var">mainFile</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (SymbolicPath Pkg 'File)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-145"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (SymbolicPath Pkg 'File)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SymbolicPath Pkg 'File -&gt; Maybe (SymbolicPath Pkg 'File)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">SymbolicPath Pkg 'File
</span><a href="#local-6989586621679554073"><span class="hs-identifier hs-var">mainFile</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>          </span><span class="annot"><span class="annottext">Maybe (SymbolicPath Pkg 'File)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (SymbolicPath Pkg 'File)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (SymbolicPath Pkg 'File)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span>  </span><span id="local-6989586621679554076"><span class="annot"><a href="#local-6989586621679554076"><span class="hs-identifier hs-var">buildOpts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Distribution.Simple.GHC.Build.Modules.html#buildHaskellModules"><span class="hs-identifier hs-type">buildHaskellModules</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679554001"><span class="hs-identifier hs-type">numJobs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679554035"><span class="hs-identifier hs-type">ghcProg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679554071"><span class="hs-identifier hs-type">hsMainFile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679554067"><span class="hs-identifier hs-type">inputModules</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679554033"><span class="hs-identifier hs-type">buildTargetDir</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679554058"><span class="hs-identifier hs-type">finalModBuildWays</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679554003"><span class="hs-identifier hs-type">pbci</span></a></span><span>
</span><span id="line-148"></span><span>  </span><span id="local-6989586621679554078"><span class="annot"><a href="#local-6989586621679554078"><span class="hs-identifier hs-var">extraSources</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Distribution.Simple.GHC.Build.ExtraSources.html#buildAllExtraSources"><span class="hs-identifier hs-type">buildAllExtraSources</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679554072"><span class="hs-identifier hs-type">nonHsMainFile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679554035"><span class="hs-identifier hs-type">ghcProg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679554033"><span class="hs-identifier hs-type">buildTargetDir</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679554037"><span class="hs-identifier hs-type">wantedWays</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679554003"><span class="hs-identifier hs-type">pbci</span></a></span><span>
</span><span id="line-149"></span><span>  </span><span class="annot"><a href="Distribution.Simple.GHC.Build.Link.html#linkOrLoadComponent"><span class="hs-identifier hs-type">linkOrLoadComponent</span></a></span><span>
</span><span id="line-150"></span><span>    </span><span class="annot"><a href="#local-6989586621679554035"><span class="hs-identifier hs-type">ghcProg</span></a></span><span>
</span><span id="line-151"></span><span>    </span><span class="annot"><a href="#local-6989586621679554002"><span class="hs-identifier hs-type">pkg_descr</span></a></span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Distribution.Utils.NubList.html#fromNubListR"><span class="hs-identifier hs-var">fromNubListR</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679554078"><span class="hs-identifier hs-type">extraSources</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679554033"><span class="hs-identifier hs-type">buildTargetDir</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679554032"><span class="hs-identifier hs-type">targetDir</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679554037"><span class="hs-identifier hs-type">wantedWays</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679554076"><span class="hs-identifier hs-type">buildOpts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span>    </span><span class="annot"><a href="#local-6989586621679554003"><span class="hs-identifier hs-type">pbci</span></a></span><span>
</span><span id="line-156"></span></pre></body></html>