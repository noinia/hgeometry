<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span id="local-6989586621679485242"><span id="local-6989586621679485243"></span></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE MultiWayIf #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE TupleSections #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Distribution.Simple.GHC.Build.Modules.html"><span class="hs-identifier">Distribution.Simple.GHC.Build.Modules</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Distribution.Simple.GHC.Build.Modules.html#buildHaskellModules"><span class="hs-identifier">buildHaskellModules</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Distribution.Simple.GHC.Build.Modules.html#BuildWay"><span class="hs-identifier">BuildWay</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Distribution.Simple.GHC.Build.Modules.html#buildWayPrefix"><span class="hs-identifier">buildWayPrefix</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.20.0.0-4014/src//Control.Monad.IO.Class.html/Control.Monad.IO.Class.html"><span class="hs-identifier">Control.Monad.IO.Class</span></a></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Compat.Prelude.html/Distribution.Compat.Prelude.html"><span class="hs-identifier">Distribution.Compat.Prelude</span></a></span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.20.0.0-4014/src//Data.List.html/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">sortOn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(\\)</span></span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.7-7628/src//Data.Set.html/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.CabalSpecVersion.html/Distribution.CabalSpecVersion.html"><span class="hs-identifier">Distribution.CabalSpecVersion</span></a></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.ModuleName.html/Distribution.ModuleName.html"><span class="hs-identifier">Distribution.ModuleName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.ModuleName.html/Distribution.ModuleName.html#ModuleName"><span class="hs-identifier">ModuleName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.PackageDescription.html/Distribution.PackageDescription.html"><span class="hs-identifier">Distribution.PackageDescription</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PD</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Pretty.html/Distribution.Pretty.html"><span class="hs-identifier">Distribution.Pretty</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Distribution.Simple.Build.Inputs.html"><span class="hs-identifier">Distribution.Simple.Build.Inputs</span></a></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Distribution.Simple.Compiler.html"><span class="hs-identifier">Distribution.Simple.Compiler</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Distribution.Simple.GHC.Build.Utils.html"><span class="hs-identifier">Distribution.Simple.GHC.Build.Utils</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Distribution.Simple.GHC.Internal.html"><span class="hs-identifier">Distribution.Simple.GHC.Internal</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Internal</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Distribution.Simple.Hpc.html"><span class="hs-identifier">Distribution.Simple.Hpc</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Hpc</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Distribution.Simple.LocalBuildInfo.html"><span class="hs-identifier">Distribution.Simple.LocalBuildInfo</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Distribution.Simple.Program.GHC.html"><span class="hs-identifier">Distribution.Simple.Program.GHC</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Distribution.Simple.Program.Types.html"><span class="hs-identifier">Distribution.Simple.Program.Types</span></a></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Distribution.Simple.Setup.Common.html"><span class="hs-identifier">Distribution.Simple.Setup.Common</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Distribution.Simple.Utils.html"><span class="hs-identifier">Distribution.Simple.Utils</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.Benchmark.html/Distribution.Types.Benchmark.html"><span class="hs-identifier">Distribution.Types.Benchmark</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.BenchmarkInterface.html/Distribution.Types.BenchmarkInterface.html"><span class="hs-identifier">Distribution.Types.BenchmarkInterface</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.BuildInfo.html/Distribution.Types.BuildInfo.html"><span class="hs-identifier">Distribution.Types.BuildInfo</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.Executable.html/Distribution.Types.Executable.html"><span class="hs-identifier">Distribution.Types.Executable</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.ForeignLib.html/Distribution.Types.ForeignLib.html"><span class="hs-identifier">Distribution.Types.ForeignLib</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Distribution.Types.PackageName.Magic.html"><span class="hs-identifier">Distribution.Types.PackageName.Magic</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Distribution.Types.ParStrat.html"><span class="hs-identifier">Distribution.Types.ParStrat</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.TestSuite.html/Distribution.Types.TestSuite.html"><span class="hs-identifier">Distribution.Types.TestSuite</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.TestSuiteInterface.html/Distribution.Types.TestSuiteInterface.html"><span class="hs-identifier">Distribution.Types.TestSuiteInterface</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Distribution.Utils.NubList.html"><span class="hs-identifier">Distribution.Utils.NubList</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../filepath-1.5.2.0-8683/src//System.FilePath.html/System.FilePath.html"><span class="hs-identifier">System.FilePath</span></a></span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-comment">{-
Note [Building Haskell Modules accounting for TH]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

There are multiple ways in which we may want to build our Haskell modules:
  * The static way (-static)
  * The dynamic/shared way (-dynamic)
  * The profiled way (-prof)

For libraries, we may /want/ to build modules in all three ways, or in any combination, depending on user options.
For executables, we just /want/ to build the executable in the requested way.

In practice, however, we may /need/ to build modules in additional ways beyonds the ones that were requested.
This can happen because of Template Haskell.

When we're using Template Haskell, we /need/ to additionally build modules with
the used GHC's default/vanilla ABI. This is because the code that TH needs to
run at compile time needs to be the vanilla ABI so it can be loaded up and run
by the compiler. With dynamic-by-default GHC the TH object files loaded at
compile-time need to be .dyn_o instead of .o.

  * If the GHC is dynamic by default, that means we may need to also build
  the dynamic way in addition the wanted way.

  * If the GHC is static by default, we may need to build statically additionally.

Of course, if the /wanted/ way is the way additionally /needed/ for TH, we don't need to do extra work.

If it turns out that in the end we need to build both statically and
dynamically, we want to make use of GHC's -static -dynamic-too capability, which
builds modules in the two ways in a single invocation.

If --dynamic-too is not supported by the GHC, then we need to be careful about
the order in which modules are built. Specifically, we must first build the
modules for TH with the vanilla ABI, and only afterwards the desired
(non-default) ways.

A few examples:

To build an executable with profiling, with a dynamic by default GHC, and TH is used:
  * Build dynamic (needed) objects
  * Build profiled objects

To build a library with profiling and dynamically, with a static by default GHC, and TH is used:
  * Build dynamic (wanted) and static (needed) objects together with --dynamic-too
  * Build profiled objects

To build an executable statically, with a static by default GHC, regardless of whether TH is used:
  * Simply build static objects

-}</span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="annot"><span class="hs-comment">-- | Compile the Haskell modules of the component being built.</span></span><span>
</span><span id="line-92"></span><span class="annot"><a href="Distribution.Simple.GHC.Build.Modules.html#buildHaskellModules"><span class="hs-identifier hs-type">buildHaskellModules</span></a></span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a></span><span> </span><span class="annot"><a href="Distribution.Types.ParStrat.html#ParStrat"><span class="hs-identifier hs-type">ParStrat</span></a></span><span>
</span><span id="line-94"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ The parallelism strategy (e.g. num of jobs)</span></span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Distribution.Simple.Program.Types.html#ConfiguredProgram"><span class="hs-identifier hs-type">ConfiguredProgram</span></a></span><span>
</span><span id="line-96"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ The GHC configured program</span></span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.PackageDescription.html/Distribution.Types.PackageDescription.html#PackageDescription"><span class="hs-identifier hs-type">PD.PackageDescription</span></a></span><span>
</span><span id="line-98"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ The package description</span></span><span>
</span><span id="line-99"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-comment">-- ^ The path to the build directory for this target, which</span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-comment">-- has already been created.</span><span>
</span><span id="line-102"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers-0.7-7628/src//Data.Set.Internal.html/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set.Set</span></a></span><span> </span><span class="annot"><a href="Distribution.Simple.GHC.Build.Modules.html#BuildWay"><span class="hs-identifier hs-type">BuildWay</span></a></span><span>
</span><span id="line-103"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ The set of wanted build ways according to user options</span></span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Distribution.Simple.Build.Inputs.html#PreBuildComponentInputs"><span class="hs-identifier hs-type">PreBuildComponentInputs</span></a></span><span>
</span><span id="line-105"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ The context and component being built in it.</span></span><span>
</span><span id="line-106"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Distribution.Simple.GHC.Build.Modules.html#BuildWay"><span class="hs-identifier hs-type">BuildWay</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Distribution.Simple.Program.GHC.html#GhcOptions"><span class="hs-identifier hs-type">GhcOptions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-comment">-- ^ Returns a mapping from build ways to the 'GhcOptions' used in the</span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-comment">-- invocation used to compile the component in that 'BuildWay'.</span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-comment">-- This can be useful in, eg, a linker invocation, in which we want to use the</span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-comment">-- same options and list the same inputs as those used for building.</span><span>
</span><span id="line-111"></span><span id="buildHaskellModules"><span class="annot"><span class="annottext">buildHaskellModules :: Flag ParStrat
-&gt; ConfiguredProgram
-&gt; PackageDescription
-&gt; FilePath
-&gt; Set BuildWay
-&gt; PreBuildComponentInputs
-&gt; IO (BuildWay -&gt; GhcOptions)
</span><a href="Distribution.Simple.GHC.Build.Modules.html#buildHaskellModules"><span class="hs-identifier hs-var hs-var">buildHaskellModules</span></a></span></span><span> </span><span id="local-6989586621679485271"><span class="annot"><span class="annottext">Flag ParStrat
</span><a href="#local-6989586621679485271"><span class="hs-identifier hs-var">numJobs</span></a></span></span><span> </span><span id="local-6989586621679485272"><span class="annot"><span class="annottext">ConfiguredProgram
</span><a href="#local-6989586621679485272"><span class="hs-identifier hs-var">ghcProg</span></a></span></span><span> </span><span id="local-6989586621679485273"><span class="annot"><span class="annottext">PackageDescription
</span><a href="#local-6989586621679485273"><span class="hs-identifier hs-var">pkg_descr</span></a></span></span><span> </span><span id="local-6989586621679485274"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679485274"><span class="hs-identifier hs-var">buildTargetDir</span></a></span></span><span> </span><span id="local-6989586621679485275"><span class="annot"><span class="annottext">Set BuildWay
</span><a href="#local-6989586621679485275"><span class="hs-identifier hs-var">wantedWays</span></a></span></span><span> </span><span id="local-6989586621679485276"><span class="annot"><span class="annottext">PreBuildComponentInputs
</span><a href="#local-6989586621679485276"><span class="hs-identifier hs-var">pbci</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-comment">-- See Note [Building Haskell Modules accounting for TH]</span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-115"></span><span>    </span><span id="local-6989586621679485277"><span class="annot"><span class="annottext">verbosity :: Verbosity
</span><a href="#local-6989586621679485277"><span class="hs-identifier hs-var hs-var hs-var">verbosity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreBuildComponentInputs -&gt; Verbosity
</span><a href="Distribution.Simple.Build.Inputs.html#buildVerbosity"><span class="hs-identifier hs-var">buildVerbosity</span></a></span><span> </span><span class="annot"><span class="annottext">PreBuildComponentInputs
</span><a href="#local-6989586621679485276"><span class="hs-identifier hs-var">pbci</span></a></span><span>
</span><span id="line-116"></span><span>    </span><span id="local-6989586621679485279"><span class="annot"><span class="annottext">isLib :: Bool
</span><a href="#local-6989586621679485279"><span class="hs-identifier hs-var hs-var hs-var">isLib</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreBuildComponentInputs -&gt; Bool
</span><a href="Distribution.Simple.Build.Inputs.html#buildIsLib"><span class="hs-identifier hs-var">buildIsLib</span></a></span><span> </span><span class="annot"><span class="annottext">PreBuildComponentInputs
</span><a href="#local-6989586621679485276"><span class="hs-identifier hs-var">pbci</span></a></span><span>
</span><span id="line-117"></span><span>    </span><span id="local-6989586621679485281"><span class="annot"><span class="annottext">clbi :: ComponentLocalBuildInfo
</span><a href="#local-6989586621679485281"><span class="hs-identifier hs-var hs-var hs-var">clbi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreBuildComponentInputs -&gt; ComponentLocalBuildInfo
</span><a href="Distribution.Simple.Build.Inputs.html#buildCLBI"><span class="hs-identifier hs-var">buildCLBI</span></a></span><span> </span><span class="annot"><span class="annottext">PreBuildComponentInputs
</span><a href="#local-6989586621679485276"><span class="hs-identifier hs-var">pbci</span></a></span><span>
</span><span id="line-118"></span><span>    </span><span id="local-6989586621679485283"><span class="annot"><span class="annottext">lbi :: LocalBuildInfo
</span><a href="#local-6989586621679485283"><span class="hs-identifier hs-var hs-var hs-var">lbi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreBuildComponentInputs -&gt; LocalBuildInfo
</span><a href="Distribution.Simple.Build.Inputs.html#localBuildInfo"><span class="hs-identifier hs-var">localBuildInfo</span></a></span><span> </span><span class="annot"><span class="annottext">PreBuildComponentInputs
</span><a href="#local-6989586621679485276"><span class="hs-identifier hs-var">pbci</span></a></span><span>
</span><span id="line-119"></span><span>    </span><span id="local-6989586621679485285"><span class="annot"><span class="annottext">bi :: BuildInfo
</span><a href="#local-6989586621679485285"><span class="hs-identifier hs-var hs-var hs-var">bi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreBuildComponentInputs -&gt; BuildInfo
</span><a href="Distribution.Simple.Build.Inputs.html#buildBI"><span class="hs-identifier hs-var">buildBI</span></a></span><span> </span><span class="annot"><span class="annottext">PreBuildComponentInputs
</span><a href="#local-6989586621679485276"><span class="hs-identifier hs-var">pbci</span></a></span><span>
</span><span id="line-120"></span><span>    </span><span id="local-6989586621679485287"><span class="annot"><span class="annottext">what :: BuildingWhat
</span><a href="#local-6989586621679485287"><span class="hs-identifier hs-var hs-var hs-var">what</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreBuildComponentInputs -&gt; BuildingWhat
</span><a href="Distribution.Simple.Build.Inputs.html#buildingWhat"><span class="hs-identifier hs-var">buildingWhat</span></a></span><span> </span><span class="annot"><span class="annottext">PreBuildComponentInputs
</span><a href="#local-6989586621679485276"><span class="hs-identifier hs-var">pbci</span></a></span><span>
</span><span id="line-121"></span><span>    </span><span id="local-6989586621679485289"><span class="annot"><span class="annottext">comp :: Compiler
</span><a href="#local-6989586621679485289"><span class="hs-identifier hs-var hs-var hs-var">comp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreBuildComponentInputs -&gt; Compiler
</span><a href="Distribution.Simple.Build.Inputs.html#buildCompiler"><span class="hs-identifier hs-var">buildCompiler</span></a></span><span> </span><span class="annot"><span class="annottext">PreBuildComponentInputs
</span><a href="#local-6989586621679485276"><span class="hs-identifier hs-var">pbci</span></a></span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span>    </span><span class="hs-comment">-- If this component will be loaded into a repl, we don't compile the modules at all.</span><span>
</span><span id="line-124"></span><span>    </span><span id="local-6989586621679485291"><span class="annot"><span class="annottext">forRepl :: Bool
</span><a href="#local-6989586621679485291"><span class="hs-identifier hs-var hs-var hs-var">forRepl</span></a></span></span><span>
</span><span id="line-125"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Distribution.Simple.Setup.html#BuildRepl"><span class="hs-identifier hs-type">BuildRepl</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BuildingWhat
</span><a href="#local-6989586621679485287"><span class="hs-identifier hs-var">what</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-126"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span>  </span><span class="hs-comment">-- TODO: do we need to put hs-boot files into place for mutually recursive</span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-comment">-- modules?  FIX: what about exeName.hi-boot?</span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span>  </span><span class="hs-comment">-- Determine if program coverage should be enabled and if so, what</span><span>
</span><span id="line-132"></span><span>  </span><span class="hs-comment">-- '-hpcdir' should be.</span><span>
</span><span id="line-133"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679485293"><span class="annot"><span class="annottext">isCoverageEnabled :: Bool
</span><a href="#local-6989586621679485293"><span class="hs-identifier hs-var hs-var hs-var">isCoverageEnabled</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679485279"><span class="hs-identifier hs-var">isLib</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">LocalBuildInfo -&gt; Bool
</span><a href="Distribution.Types.LocalBuildInfo.html#libCoverage"><span class="hs-identifier hs-var">libCoverage</span></a></span><span> </span><span class="annot"><span class="annottext">LocalBuildInfo
</span><a href="#local-6989586621679485283"><span class="hs-identifier hs-var">lbi</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">LocalBuildInfo -&gt; Bool
</span><a href="Distribution.Types.LocalBuildInfo.html#exeCoverage"><span class="hs-identifier hs-var">exeCoverage</span></a></span><span> </span><span class="annot"><span class="annottext">LocalBuildInfo
</span><a href="#local-6989586621679485283"><span class="hs-identifier hs-var">lbi</span></a></span><span>
</span><span id="line-134"></span><span>      </span><span id="local-6989586621679485299"><span class="annot"><span class="annottext">hpcdir :: Way -&gt; Flag FilePath
</span><a href="#local-6989586621679485299"><span class="hs-identifier hs-var hs-var hs-var">hpcdir</span></a></span></span><span> </span><span id="local-6989586621679485300"><span class="annot"><span class="annottext">Way
</span><a href="#local-6989586621679485300"><span class="hs-identifier hs-var">way</span></a></span></span><span>
</span><span id="line-135"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679485291"><span class="hs-identifier hs-var">forRepl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Flag FilePath
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-comment">-- HPC is not supported in ghci</span><span>
</span><span id="line-136"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679485293"><span class="hs-identifier hs-var">isCoverageEnabled</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Flag FilePath
forall a. a -&gt; Flag a
</span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-var">Flag</span></a></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; Flag FilePath) -&gt; FilePath -&gt; Flag FilePath
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Way -&gt; FilePath
</span><a href="Distribution.Simple.Hpc.html#mixDir"><span class="hs-identifier hs-var">Hpc.mixDir</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679485274"><span class="hs-identifier hs-var">buildTargetDir</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><a href="../../filepath-1.5.2.0-8683/src//System.FilePath.Posix.html/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="Distribution.Simple.Setup.Common.html#extraCompilationArtifacts"><span class="hs-identifier hs-var">extraCompilationArtifacts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Way
</span><a href="#local-6989586621679485300"><span class="hs-identifier hs-var">way</span></a></span><span>
</span><span id="line-137"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Flag FilePath
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679485305"><span class="annot"><a href="#local-6989586621679485305"><span class="hs-identifier hs-var">inputFiles</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679485306"><span class="annot"><a href="#local-6989586621679485306"><span class="hs-identifier hs-var">inputModules</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilePath
-&gt; PackageDescription
-&gt; PreBuildComponentInputs
-&gt; IO ([FilePath], [ModuleName])
</span><a href="Distribution.Simple.GHC.Build.Modules.html#componentInputs"><span class="hs-identifier hs-var">componentInputs</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679485274"><span class="hs-identifier hs-var">buildTargetDir</span></a></span><span> </span><span class="annot"><span class="annottext">PackageDescription
</span><a href="#local-6989586621679485273"><span class="hs-identifier hs-var">pkg_descr</span></a></span><span> </span><span class="annot"><span class="annottext">PreBuildComponentInputs
</span><a href="#local-6989586621679485276"><span class="hs-identifier hs-var">pbci</span></a></span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-142"></span><span>    </span><span id="local-6989586621679485308"><span class="annot"><a href="#local-6989586621679485308"><span class="hs-identifier hs-var hs-var">runGhcProg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Verbosity
-&gt; ConfiguredProgram -&gt; Compiler -&gt; Platform -&gt; GhcOptions -&gt; IO ()
</span><a href="Distribution.Simple.Program.GHC.html#runGHC"><span class="hs-identifier hs-var">runGHC</span></a></span><span> </span><span class="annot"><span class="annottext">Verbosity
</span><a href="#local-6989586621679485277"><span class="hs-identifier hs-var">verbosity</span></a></span><span> </span><span class="annot"><span class="annottext">ConfiguredProgram
</span><a href="#local-6989586621679485272"><span class="hs-identifier hs-var">ghcProg</span></a></span><span> </span><span class="annot"><span class="annottext">Compiler
</span><a href="#local-6989586621679485289"><span class="hs-identifier hs-var">comp</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621679485310"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-143"></span><span>    </span><span id="local-6989586621679485310"><span class="annot"><a href="#local-6989586621679485310"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocalBuildInfo -&gt; Platform
</span><a href="Distribution.Types.LocalBuildInfo.html#hostPlatform"><span class="hs-identifier hs-var">hostPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">LocalBuildInfo
</span><a href="#local-6989586621679485283"><span class="hs-identifier hs-var">lbi</span></a></span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-comment">-- See Note [Building Haskell Modules accounting for TH]</span><span>
</span><span id="line-146"></span><span>    </span><span id="local-6989586621679485312"><span class="annot"><a href="#local-6989586621679485312"><span class="hs-identifier hs-var hs-var">doingTH</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuildInfo -&gt; Bool
</span><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.BuildInfo.html/Distribution.Types.BuildInfo.html#usesTemplateHaskellOrQQ"><span class="hs-identifier hs-var">usesTemplateHaskellOrQQ</span></a></span><span> </span><span class="annot"><span class="annottext">BuildInfo
</span><a href="#local-6989586621679485285"><span class="hs-identifier hs-var">bi</span></a></span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span>    </span><span class="hs-comment">-- We define the base opts which are shared across different build ways in</span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-comment">-- 'buildHaskellModules'</span><span>
</span><span id="line-150"></span><span>    </span><span id="local-6989586621679485327"><span class="annot"><a href="#local-6989586621679485327"><span class="hs-identifier hs-var hs-var">baseOpts</span></a></span></span><span> </span><span id="local-6989586621679485328"><span class="annot"><span class="annottext">BuildWay
</span><a href="#local-6989586621679485328"><span class="hs-identifier hs-var">way</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-151"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Verbosity
-&gt; LocalBuildInfo
-&gt; BuildInfo
-&gt; ComponentLocalBuildInfo
-&gt; FilePath
-&gt; GhcOptions
</span><a href="Distribution.Simple.GHC.Internal.html#componentGhcOptions"><span class="hs-identifier hs-var">Internal.componentGhcOptions</span></a></span><span> </span><span class="annot"><span class="annottext">Verbosity
</span><a href="#local-6989586621679485277"><span class="hs-identifier hs-var">verbosity</span></a></span><span> </span><span class="annot"><span class="annottext">LocalBuildInfo
</span><a href="#local-6989586621679485283"><span class="hs-identifier hs-var">lbi</span></a></span><span> </span><span class="annot"><span class="annottext">BuildInfo
</span><a href="#local-6989586621679485285"><span class="hs-identifier hs-var">bi</span></a></span><span> </span><span class="annot"><span class="annottext">ComponentLocalBuildInfo
</span><a href="#local-6989586621679485281"><span class="hs-identifier hs-var">clbi</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679485274"><span class="hs-identifier hs-var">buildTargetDir</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>        </span><span class="annot"><span class="annottext">GhcOptions -&gt; GhcOptions -&gt; GhcOptions
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">GhcOptions
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-153"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Distribution.Simple.Program.GHC.html#ghcOptMode"><span class="hs-identifier hs-var">ghcOptMode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Distribution.Simple.Flag.html#toFlag"><span class="hs-identifier hs-type">toFlag</span></a></span><span> </span><span class="annot"><a href="Distribution.Simple.Program.GHC.html#GhcModeMake"><span class="hs-identifier hs-type">GhcModeMake</span></a></span><span>
</span><span id="line-154"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- Previously we didn't pass -no-link when building libs,</span><span>
</span><span id="line-155"></span><span>            </span><span class="hs-comment">-- but I think that could result in a bug (e.g. if a lib module is</span><span>
</span><span id="line-156"></span><span>            </span><span class="hs-comment">-- called Main and exports main). So we really want nolink when</span><span>
</span><span id="line-157"></span><span>            </span><span class="hs-comment">-- building libs too (TODO).</span><span>
</span><span id="line-158"></span><span>            </span><span class="annot"><a href="Distribution.Simple.Program.GHC.html#ghcOptNoLink"><span class="hs-identifier hs-var">ghcOptNoLink</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621679485279"><span class="hs-identifier hs-type">isLib</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="Distribution.Simple.Flag.html#NoFlag"><span class="hs-identifier hs-type">NoFlag</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="Distribution.Simple.Flag.html#toFlag"><span class="hs-identifier hs-type">toFlag</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span>
</span><span id="line-159"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Distribution.Simple.Program.GHC.html#ghcOptNumJobs"><span class="hs-identifier hs-var">ghcOptNumJobs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679485271"><span class="hs-identifier hs-type">numJobs</span></a></span><span>
</span><span id="line-160"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Distribution.Simple.Program.GHC.html#ghcOptInputModules"><span class="hs-identifier hs-var">ghcOptInputModules</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-type">toNubListR</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679485306"><span class="hs-identifier hs-type">inputModules</span></a></span><span>
</span><span id="line-161"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Distribution.Simple.Program.GHC.html#ghcOptInputFiles"><span class="hs-identifier hs-var">ghcOptInputFiles</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-162"></span><span>              </span><span class="annot"><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-type">toNubListR</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-163"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.PackageDescription.html/Distribution.Types.PackageDescription.html#package"><span class="hs-identifier hs-var">PD.package</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679485273"><span class="hs-identifier hs-type">pkg_descr</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="Distribution.Types.PackageName.Magic.html#fakePackageId"><span class="hs-identifier hs-type">fakePackageId</span></a></span><span>
</span><span id="line-164"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">filter</span></span><span> </span><span class="annot"><a href="Distribution.Simple.GHC.Build.Utils.html#isHaskell"><span class="hs-identifier hs-type">isHaskell</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679485305"><span class="hs-identifier hs-type">inputFiles</span></a></span><span>
</span><span id="line-165"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="#local-6989586621679485305"><span class="hs-identifier hs-type">inputFiles</span></a></span><span>
</span><span id="line-166"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Distribution.Simple.Program.GHC.html#ghcOptInputScripts"><span class="hs-identifier hs-var">ghcOptInputScripts</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-167"></span><span>              </span><span class="annot"><a href="Distribution.Utils.NubList.html#toNubListR"><span class="hs-identifier hs-type">toNubListR</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-168"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.PackageDescription.html/Distribution.Types.PackageDescription.html#package"><span class="hs-identifier hs-var">PD.package</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679485273"><span class="hs-identifier hs-type">pkg_descr</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="Distribution.Types.PackageName.Magic.html#fakePackageId"><span class="hs-identifier hs-type">fakePackageId</span></a></span><span>
</span><span id="line-169"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Distribution.Simple.GHC.Build.Utils.html#isHaskell"><span class="hs-identifier hs-type">isHaskell</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679485305"><span class="hs-identifier hs-type">inputFiles</span></a></span><span>
</span><span id="line-170"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-171"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Distribution.Simple.Program.GHC.html#ghcOptExtra"><span class="hs-identifier hs-var">ghcOptExtra</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Distribution.Simple.GHC.Build.Modules.html#buildWayExtraHcOptions"><span class="hs-identifier hs-type">buildWayExtraHcOptions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679485328"><span class="hs-identifier hs-type">way</span></a></span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Compiler.html/Distribution.Compiler.html#GHC"><span class="hs-identifier hs-type">GHC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679485285"><span class="hs-identifier hs-type">bi</span></a></span><span>
</span><span id="line-172"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Distribution.Simple.Program.GHC.html#ghcOptHiSuffix"><span class="hs-identifier hs-var">ghcOptHiSuffix</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679485349"><span class="hs-identifier hs-type">optSuffixFlag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Distribution.Simple.GHC.Build.Modules.html#buildWayPrefix"><span class="hs-identifier hs-type">buildWayPrefix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679485328"><span class="hs-identifier hs-type">way</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-string">&quot;hi&quot;</span></span><span>
</span><span id="line-173"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Distribution.Simple.Program.GHC.html#ghcOptObjSuffix"><span class="hs-identifier hs-var">ghcOptObjSuffix</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679485349"><span class="hs-identifier hs-type">optSuffixFlag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Distribution.Simple.GHC.Build.Modules.html#buildWayPrefix"><span class="hs-identifier hs-type">buildWayPrefix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679485328"><span class="hs-identifier hs-type">way</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-string">&quot;o&quot;</span></span><span>
</span><span id="line-174"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Distribution.Simple.Program.GHC.html#ghcOptHPCDir"><span class="hs-identifier hs-var">ghcOptHPCDir</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679485299"><span class="hs-identifier hs-type">hpcdir</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Distribution.Simple.GHC.Build.Modules.html#buildWayHpcWay"><span class="hs-identifier hs-type">buildWayHpcWay</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679485328"><span class="hs-identifier hs-type">way</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- maybe this should not be passed for vanilla?</span><span>
</span><span id="line-175"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-176"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-177"></span><span>        </span><span id="local-6989586621679485349"><span class="annot"><span class="annottext">optSuffixFlag :: FilePath -&gt; FilePath -&gt; Flag FilePath
</span><a href="#local-6989586621679485349"><span class="hs-identifier hs-var hs-var">optSuffixFlag</span></a></span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Flag FilePath
forall a. Flag a
</span><a href="Distribution.Simple.Flag.html#NoFlag"><span class="hs-identifier hs-var">NoFlag</span></a></span><span>
</span><span id="line-178"></span><span>        </span><span class="annot"><a href="#local-6989586621679485349"><span class="hs-identifier hs-var">optSuffixFlag</span></a></span><span> </span><span id="local-6989586621679485353"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679485353"><span class="hs-identifier hs-var">pre</span></a></span></span><span> </span><span id="local-6989586621679485354"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679485354"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Flag FilePath
forall a. a -&gt; Flag a
</span><a href="Distribution.Simple.Flag.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679485353"><span class="hs-identifier hs-var">pre</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679485354"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span>    </span><span class="hs-comment">-- For libs we don't pass -static when building static, leaving it</span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-comment">-- implicit. We should just always pass -static, but we don't want to</span><span>
</span><span id="line-182"></span><span>    </span><span class="hs-comment">-- change behaviour when doing the refactor.</span><span>
</span><span id="line-183"></span><span>    </span><span id="local-6989586621679485355"><span class="annot"><a href="#local-6989586621679485355"><span class="hs-identifier hs-var hs-var">staticOpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuildWay -&gt; GhcOptions
</span><a href="#local-6989586621679485327"><span class="hs-identifier hs-var">baseOpts</span></a></span><span> </span><span class="annot"><span class="annottext">BuildWay
</span><a href="Distribution.Simple.GHC.Build.Modules.html#StaticWay"><span class="hs-identifier hs-var">StaticWay</span></a></span><span class="hs-special">)</span><span class="hs-special">{</span><span class="annot"><a href="Distribution.Simple.Program.GHC.html#ghcOptDynLinkMode"><span class="hs-identifier hs-var">ghcOptDynLinkMode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621679485279"><span class="hs-identifier hs-type">isLib</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="Distribution.Simple.Flag.html#NoFlag"><span class="hs-identifier hs-type">NoFlag</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="Distribution.Simple.Flag.html#toFlag"><span class="hs-identifier hs-type">toFlag</span></a></span><span> </span><span class="annot"><a href="Distribution.Simple.Program.GHC.html#GhcStaticOnly"><span class="hs-identifier hs-type">GhcStaticOnly</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-184"></span><span>    </span><span id="local-6989586621679485359"><span class="annot"><a href="#local-6989586621679485359"><span class="hs-identifier hs-var hs-var">dynOpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-185"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuildWay -&gt; GhcOptions
</span><a href="#local-6989586621679485327"><span class="hs-identifier hs-var">baseOpts</span></a></span><span> </span><span class="annot"><span class="annottext">BuildWay
</span><a href="Distribution.Simple.GHC.Build.Modules.html#DynWay"><span class="hs-identifier hs-var">DynWay</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Distribution.Simple.Program.GHC.html#ghcOptDynLinkMode"><span class="hs-identifier hs-var">ghcOptDynLinkMode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Distribution.Simple.Flag.html#toFlag"><span class="hs-identifier hs-type">toFlag</span></a></span><span> </span><span class="annot"><a href="Distribution.Simple.Program.GHC.html#GhcDynamicOnly"><span class="hs-identifier hs-type">GhcDynamicOnly</span></a></span><span> </span><span class="hs-comment">-- use -dynamic</span><span>
</span><span id="line-187"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- TODO: Does it hurt to set -fPIC for executables?</span><span>
</span><span id="line-188"></span><span>          </span><span class="annot"><a href="Distribution.Simple.Program.GHC.html#ghcOptFPic"><span class="hs-identifier hs-var">ghcOptFPic</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Distribution.Simple.Flag.html#toFlag"><span class="hs-identifier hs-type">toFlag</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="hs-comment">-- use -fPIC</span><span>
</span><span id="line-189"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-190"></span><span>    </span><span id="local-6989586621679485363"><span class="annot"><a href="#local-6989586621679485363"><span class="hs-identifier hs-var hs-var">profOpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-191"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuildWay -&gt; GhcOptions
</span><a href="#local-6989586621679485327"><span class="hs-identifier hs-var">baseOpts</span></a></span><span> </span><span class="annot"><span class="annottext">BuildWay
</span><a href="Distribution.Simple.GHC.Build.Modules.html#ProfWay"><span class="hs-identifier hs-var">ProfWay</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Distribution.Simple.Program.GHC.html#ghcOptProfilingMode"><span class="hs-identifier hs-var">ghcOptProfilingMode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Distribution.Simple.Flag.html#toFlag"><span class="hs-identifier hs-type">toFlag</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span>
</span><span id="line-193"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Distribution.Simple.Program.GHC.html#ghcOptProfilingAuto"><span class="hs-identifier hs-var">ghcOptProfilingAuto</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-194"></span><span>            </span><span class="annot"><a href="Distribution.Simple.GHC.Internal.html#profDetailLevelFlag"><span class="hs-identifier hs-type">Internal.profDetailLevelFlag</span></a></span><span>
</span><span id="line-195"></span><span>              </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621679485279"><span class="hs-identifier hs-type">isLib</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>              </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621679485279"><span class="hs-identifier hs-type">isLib</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="Distribution.Types.LocalBuildInfo.html#withProfLibDetail"><span class="hs-identifier hs-var">withProfLibDetail</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="Distribution.Types.LocalBuildInfo.html#withProfExeDetail"><span class="hs-identifier hs-var">withProfExeDetail</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679485283"><span class="hs-identifier hs-type">lbi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-198"></span><span>    </span><span class="hs-comment">-- Options for building both static and dynamic way at the same time, using</span><span>
</span><span id="line-199"></span><span>    </span><span class="hs-comment">-- the GHC flag -static and -dynamic-too</span><span>
</span><span id="line-200"></span><span>    </span><span id="local-6989586621679485370"><span class="annot"><a href="#local-6989586621679485370"><span class="hs-identifier hs-var hs-var">dynTooOpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-201"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuildWay -&gt; GhcOptions
</span><a href="#local-6989586621679485327"><span class="hs-identifier hs-var">baseOpts</span></a></span><span> </span><span class="annot"><span class="annottext">BuildWay
</span><a href="Distribution.Simple.GHC.Build.Modules.html#StaticWay"><span class="hs-identifier hs-var">StaticWay</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Distribution.Simple.Program.GHC.html#ghcOptDynLinkMode"><span class="hs-identifier hs-var">ghcOptDynLinkMode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Distribution.Simple.Flag.html#toFlag"><span class="hs-identifier hs-type">toFlag</span></a></span><span> </span><span class="annot"><a href="Distribution.Simple.Program.GHC.html#GhcStaticAndDynamic"><span class="hs-identifier hs-type">GhcStaticAndDynamic</span></a></span><span> </span><span class="hs-comment">-- use -dynamic-too</span><span>
</span><span id="line-203"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Distribution.Simple.Program.GHC.html#ghcOptDynHiSuffix"><span class="hs-identifier hs-var">ghcOptDynHiSuffix</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Distribution.Simple.Flag.html#toFlag"><span class="hs-identifier hs-type">toFlag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Distribution.Simple.GHC.Build.Modules.html#buildWayPrefix"><span class="hs-identifier hs-type">buildWayPrefix</span></a></span><span> </span><span class="annot"><a href="Distribution.Simple.GHC.Build.Modules.html#DynWay"><span class="hs-identifier hs-type">DynWay</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;hi&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Distribution.Simple.Program.GHC.html#ghcOptDynObjSuffix"><span class="hs-identifier hs-var">ghcOptDynObjSuffix</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Distribution.Simple.Flag.html#toFlag"><span class="hs-identifier hs-type">toFlag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Distribution.Simple.GHC.Build.Modules.html#buildWayPrefix"><span class="hs-identifier hs-type">buildWayPrefix</span></a></span><span> </span><span class="annot"><a href="Distribution.Simple.GHC.Build.Modules.html#DynWay"><span class="hs-identifier hs-type">DynWay</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;o&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Distribution.Simple.Program.GHC.html#ghcOptHPCDir"><span class="hs-identifier hs-var">ghcOptHPCDir</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679485299"><span class="hs-identifier hs-type">hpcdir</span></a></span><span> </span><span class="annot"><a href="Distribution.Simple.Hpc.html#Dyn"><span class="hs-identifier hs-type">Hpc.Dyn</span></a></span><span>
</span><span id="line-206"></span><span>        </span><span class="hs-comment">-- Should we pass hcSharedOpts in the -dynamic-too ghc invocation?</span><span>
</span><span id="line-207"></span><span>        </span><span class="hs-comment">-- (Note that `baseOtps StaticWay = hcStaticOptions`, not hcSharedOpts)</span><span>
</span><span id="line-208"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span>    </span><span class="hs-comment">-- Determines how to build for each way, also serves as the base options</span><span>
</span><span id="line-211"></span><span>    </span><span class="hs-comment">-- for loading modules in 'linkOrLoadComponent'</span><span>
</span><span id="line-212"></span><span>    </span><span id="local-6989586621679485375"><span class="annot"><a href="#local-6989586621679485375"><span class="hs-identifier hs-var hs-var">buildOpts</span></a></span></span><span> </span><span id="local-6989586621679485376"><span class="annot"><span class="annottext">BuildWay
</span><a href="#local-6989586621679485376"><span class="hs-identifier hs-var">way</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BuildWay
</span><a href="#local-6989586621679485376"><span class="hs-identifier hs-var">way</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-213"></span><span>      </span><span class="annot"><span class="annottext">BuildWay
</span><a href="Distribution.Simple.GHC.Build.Modules.html#StaticWay"><span class="hs-identifier hs-var">StaticWay</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GhcOptions
</span><a href="#local-6989586621679485355"><span class="hs-identifier hs-var">staticOpts</span></a></span><span>
</span><span id="line-214"></span><span>      </span><span class="annot"><span class="annottext">BuildWay
</span><a href="Distribution.Simple.GHC.Build.Modules.html#DynWay"><span class="hs-identifier hs-var">DynWay</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GhcOptions
</span><a href="#local-6989586621679485359"><span class="hs-identifier hs-var">dynOpts</span></a></span><span>
</span><span id="line-215"></span><span>      </span><span class="annot"><span class="annottext">BuildWay
</span><a href="Distribution.Simple.GHC.Build.Modules.html#ProfWay"><span class="hs-identifier hs-var">ProfWay</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GhcOptions
</span><a href="#local-6989586621679485363"><span class="hs-identifier hs-var">profOpts</span></a></span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span>    </span><span id="local-6989586621679485377"><span class="annot"><a href="#local-6989586621679485377"><span class="hs-identifier hs-var hs-var">defaultGhcWay</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Compiler -&gt; Bool
</span><a href="Distribution.Simple.GHC.Build.Utils.html#isDynamic"><span class="hs-identifier hs-var">isDynamic</span></a></span><span> </span><span class="annot"><span class="annottext">Compiler
</span><a href="#local-6989586621679485289"><span class="hs-identifier hs-var">comp</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">BuildWay
</span><a href="Distribution.Simple.GHC.Build.Modules.html#DynWay"><span class="hs-identifier hs-var">DynWay</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">BuildWay
</span><a href="Distribution.Simple.GHC.Build.Modules.html#StaticWay"><span class="hs-identifier hs-var">StaticWay</span></a></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span>  </span><span class="hs-comment">-- If there aren't modules, or if we're loading the modules in repl, don't build.</span><span>
</span><span id="line-220"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679485291"><span class="hs-identifier hs-type">forRepl</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">||</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621679485305"><span class="hs-identifier hs-type">inputFiles</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621679485306"><span class="hs-identifier hs-type">inputModules</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="../../base-4.20.0.0-4014/src//Control.Monad.IO.Class.html/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-type">liftIO</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-221"></span><span>    </span><span class="hs-comment">-- See Note [Building Haskell Modules accounting for TH]</span><span>
</span><span id="line-222"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-223"></span><span>      </span><span id="local-6989586621679485390"><span class="annot"><a href="#local-6989586621679485390"><span class="hs-identifier hs-var hs-var">neededWays</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-224"></span><span>        </span><span class="annot"><span class="annottext">Set BuildWay
</span><a href="#local-6989586621679485275"><span class="hs-identifier hs-var">wantedWays</span></a></span><span>
</span><span id="line-225"></span><span>          </span><span class="annot"><span class="annottext">Set BuildWay -&gt; Set BuildWay -&gt; Set BuildWay
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[BuildWay] -&gt; Set BuildWay
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../containers-0.7-7628/src//Data.Set.Internal.html/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span>
</span><span id="line-226"></span><span>            </span><span class="hs-comment">-- TODO: You also don't need to build the GHC way when doing TH if</span><span>
</span><span id="line-227"></span><span>            </span><span class="hs-comment">-- you are using an external interpreter!!</span><span>
</span><span id="line-228"></span><span>            </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BuildWay
</span><a href="#local-6989586621679485377"><span class="hs-identifier hs-var">defaultGhcWay</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679485312"><span class="hs-identifier hs-var">doingTH</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">BuildWay
</span><a href="#local-6989586621679485377"><span class="hs-identifier hs-var">defaultGhcWay</span></a></span><span> </span><span class="annot"><span class="annottext">BuildWay -&gt; Set BuildWay -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../../containers-0.7-7628/src//Data.Set.Internal.html/Data.Set.Internal.html#notMember"><span class="hs-operator hs-var">`Set.notMember`</span></a></span><span> </span><span class="annot"><span class="annottext">Set BuildWay
</span><a href="#local-6989586621679485275"><span class="hs-identifier hs-var">wantedWays</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span>      </span><span class="hs-comment">-- If we need both static and dynamic, use dynamic-too instead of</span><span>
</span><span id="line-231"></span><span>      </span><span class="hs-comment">-- compiling twice (if we support it)</span><span>
</span><span id="line-232"></span><span>      </span><span id="local-6989586621679485396"><span class="annot"><a href="#local-6989586621679485396"><span class="hs-identifier hs-var hs-var">useDynamicToo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-233"></span><span>        </span><span class="annot"><span class="annottext">BuildWay
</span><a href="Distribution.Simple.GHC.Build.Modules.html#StaticWay"><span class="hs-identifier hs-var">StaticWay</span></a></span><span> </span><span class="annot"><span class="annottext">BuildWay -&gt; Set BuildWay -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../../containers-0.7-7628/src//Data.Set.Internal.html/Data.Set.Internal.html#member"><span class="hs-operator hs-var">`Set.member`</span></a></span><span> </span><span class="annot"><span class="annottext">Set BuildWay
</span><a href="#local-6989586621679485390"><span class="hs-identifier hs-var">neededWays</span></a></span><span>
</span><span id="line-234"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">BuildWay
</span><a href="Distribution.Simple.GHC.Build.Modules.html#DynWay"><span class="hs-identifier hs-var">DynWay</span></a></span><span> </span><span class="annot"><span class="annottext">BuildWay -&gt; Set BuildWay -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../../containers-0.7-7628/src//Data.Set.Internal.html/Data.Set.Internal.html#member"><span class="hs-operator hs-var">`Set.member`</span></a></span><span> </span><span class="annot"><span class="annottext">Set BuildWay
</span><a href="#local-6989586621679485390"><span class="hs-identifier hs-var">neededWays</span></a></span><span>
</span><span id="line-235"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Compiler -&gt; Bool
</span><a href="Distribution.Simple.GHC.Build.Utils.html#supportsDynamicToo"><span class="hs-identifier hs-var">supportsDynamicToo</span></a></span><span> </span><span class="annot"><span class="annottext">Compiler
</span><a href="#local-6989586621679485289"><span class="hs-identifier hs-var">comp</span></a></span><span>
</span><span id="line-236"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[FilePath] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompilerFlavor -&gt; BuildInfo -&gt; [FilePath]
</span><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.BuildInfo.html/Distribution.Types.BuildInfo.html#hcSharedOptions"><span class="hs-identifier hs-var">hcSharedOptions</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerFlavor
</span><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Compiler.html/Distribution.Compiler.html#GHC"><span class="hs-identifier hs-var">GHC</span></a></span><span> </span><span class="annot"><span class="annottext">BuildInfo
</span><a href="#local-6989586621679485285"><span class="hs-identifier hs-var">bi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span>      </span><span class="hs-comment">-- The ways we'll build, in order</span><span>
</span><span id="line-239"></span><span>      </span><span id="local-6989586621679485414"><span class="annot"><a href="#local-6989586621679485414"><span class="hs-identifier hs-var hs-var">orderedBuilds</span></a></span></span><span>
</span><span id="line-240"></span><span>        </span><span class="hs-comment">-- If we can use dynamic-too, do it first. The default GHC way can only</span><span>
</span><span id="line-241"></span><span>        </span><span class="hs-comment">-- be static or dynamic, so, if we build both right away, any modules</span><span>
</span><span id="line-242"></span><span>        </span><span class="hs-comment">-- possibly needed by TH later (e.g. if building profiled) are already built.</span><span>
</span><span id="line-243"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679485396"><span class="hs-identifier hs-var">useDynamicToo</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-244"></span><span>            </span><span class="hs-special">[</span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679485415"><span class="hs-identifier hs-var">buildStaticAndDynamicToo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-245"></span><span>              </span><span class="annot"><span class="annottext">[IO ()] -&gt; [IO ()] -&gt; [IO ()]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GhcOptions -&gt; IO ()
</span><a href="#local-6989586621679485308"><span class="hs-identifier hs-var">runGhcProg</span></a></span><span> </span><span class="annot"><span class="annottext">(GhcOptions -&gt; IO ())
-&gt; (BuildWay -&gt; GhcOptions) -&gt; BuildWay -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BuildWay -&gt; GhcOptions
</span><a href="#local-6989586621679485375"><span class="hs-identifier hs-var">buildOpts</span></a></span><span> </span><span class="annot"><span class="annottext">(BuildWay -&gt; IO ()) -&gt; [BuildWay] -&gt; [IO ()]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set BuildWay -&gt; [BuildWay]
forall a. Set a -&gt; [a]
</span><a href="../../containers-0.7-7628/src//Data.Set.Internal.html/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set BuildWay
</span><a href="#local-6989586621679485390"><span class="hs-identifier hs-var">neededWays</span></a></span><span> </span><span class="annot"><span class="annottext">[BuildWay] -&gt; [BuildWay] -&gt; [BuildWay]
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">\\</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BuildWay
</span><a href="Distribution.Simple.GHC.Build.Modules.html#StaticWay"><span class="hs-identifier hs-var">StaticWay</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BuildWay
</span><a href="Distribution.Simple.GHC.Build.Modules.html#DynWay"><span class="hs-identifier hs-var">DynWay</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>        </span><span class="hs-comment">-- Otherwise, we need to ensure the defaultGhcWay is built first</span><span>
</span><span id="line-247"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-248"></span><span>            </span><span class="annot"><span class="annottext">GhcOptions -&gt; IO ()
</span><a href="#local-6989586621679485308"><span class="hs-identifier hs-var">runGhcProg</span></a></span><span> </span><span class="annot"><span class="annottext">(GhcOptions -&gt; IO ())
-&gt; (BuildWay -&gt; GhcOptions) -&gt; BuildWay -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BuildWay -&gt; GhcOptions
</span><a href="#local-6989586621679485375"><span class="hs-identifier hs-var">buildOpts</span></a></span><span> </span><span class="annot"><span class="annottext">(BuildWay -&gt; IO ()) -&gt; [BuildWay] -&gt; [IO ()]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(BuildWay -&gt; Int) -&gt; [BuildWay] -&gt; [BuildWay]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortOn</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679485418"><span class="annot"><span class="annottext">BuildWay
</span><a href="#local-6989586621679485418"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">BuildWay
</span><a href="#local-6989586621679485418"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">BuildWay -&gt; BuildWay -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">BuildWay
</span><a href="#local-6989586621679485377"><span class="hs-identifier hs-var">defaultGhcWay</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">BuildWay -&gt; Int
forall a. Enum a =&gt; a -&gt; Int
</span><span class="hs-identifier hs-var">fromEnum</span></span><span> </span><span class="annot"><span class="annottext">BuildWay
</span><a href="#local-6989586621679485418"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set BuildWay -&gt; [BuildWay]
forall a. Set a -&gt; [a]
</span><a href="../../containers-0.7-7628/src//Data.Set.Internal.html/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set BuildWay
</span><a href="#local-6989586621679485390"><span class="hs-identifier hs-var">neededWays</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span>      </span><span id="local-6989586621679485415"><span class="annot"><a href="#local-6989586621679485415"><span class="hs-identifier hs-var hs-var">buildStaticAndDynamicToo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-251"></span><span>        </span><span class="annot"><span class="annottext">GhcOptions -&gt; IO ()
</span><a href="#local-6989586621679485308"><span class="hs-identifier hs-var">runGhcProg</span></a></span><span> </span><span class="annot"><span class="annottext">GhcOptions
</span><a href="#local-6989586621679485370"><span class="hs-identifier hs-var">dynTooOpts</span></a></span><span>
</span><span id="line-252"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Way -&gt; Flag FilePath
</span><a href="#local-6989586621679485299"><span class="hs-identifier hs-var">hpcdir</span></a></span><span> </span><span class="annot"><span class="annottext">Way
</span><a href="Distribution.Simple.Hpc.html#Dyn"><span class="hs-identifier hs-var">Hpc.Dyn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Way -&gt; Flag FilePath
</span><a href="#local-6989586621679485299"><span class="hs-identifier hs-var">hpcdir</span></a></span><span> </span><span class="annot"><span class="annottext">Way
</span><a href="Distribution.Simple.Hpc.html#Vanilla"><span class="hs-identifier hs-var">Hpc.Vanilla</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-253"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a></span><span> </span><span id="local-6989586621679485424"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679485424"><span class="hs-identifier hs-var">dynDir</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a></span><span> </span><span id="local-6989586621679485425"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679485425"><span class="hs-identifier hs-var">vanillaDir</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-254"></span><span>            </span><span class="hs-comment">-- When the vanilla and shared library builds are done</span><span>
</span><span id="line-255"></span><span>            </span><span class="hs-comment">-- in one pass, only one set of HPC module interfaces</span><span>
</span><span id="line-256"></span><span>            </span><span class="hs-comment">-- are generated. This set should suffice for both</span><span>
</span><span id="line-257"></span><span>            </span><span class="hs-comment">-- static and dynamically linked executables. We copy</span><span>
</span><span id="line-258"></span><span>            </span><span class="hs-comment">-- the modules interfaces so they are available under</span><span>
</span><span id="line-259"></span><span>            </span><span class="hs-comment">-- both ways.</span><span>
</span><span id="line-260"></span><span>            </span><span class="annot"><span class="annottext">Verbosity -&gt; FilePath -&gt; FilePath -&gt; IO ()
</span><a href="Distribution.Simple.Utils.html#copyDirectoryRecursive"><span class="hs-identifier hs-var">copyDirectoryRecursive</span></a></span><span> </span><span class="annot"><span class="annottext">Verbosity
</span><a href="#local-6989586621679485277"><span class="hs-identifier hs-var">verbosity</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679485424"><span class="hs-identifier hs-var">dynDir</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679485425"><span class="hs-identifier hs-var">vanillaDir</span></a></span><span>
</span><span id="line-261"></span><span>          </span><span class="annot"><span class="annottext">(Flag FilePath, Flag FilePath)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>     </span><span class="hs-keyword">in</span><span>
</span><span id="line-263"></span><span>      </span><span class="hs-comment">-- REVIEW:ADD? info verbosity &quot;Building Haskell Sources...&quot;</span><span>
</span><span id="line-264"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">sequence_</span></span><span> </span><span class="annot"><a href="#local-6989586621679485414"><span class="hs-identifier hs-type">orderedBuilds</span></a></span><span>
</span><span id="line-265"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621679485375"><span class="hs-identifier hs-type">buildOpts</span></a></span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span class="hs-keyword">data</span><span> </span><span id="BuildWay"><span class="annot"><a href="Distribution.Simple.GHC.Build.Modules.html#BuildWay"><span class="hs-identifier hs-var">BuildWay</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="StaticWay"><span class="annot"><a href="Distribution.Simple.GHC.Build.Modules.html#StaticWay"><span class="hs-identifier hs-var">StaticWay</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="DynWay"><span class="annot"><a href="Distribution.Simple.GHC.Build.Modules.html#DynWay"><span class="hs-identifier hs-var">DynWay</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="ProfWay"><span class="annot"><a href="Distribution.Simple.GHC.Build.Modules.html#ProfWay"><span class="hs-identifier hs-var">ProfWay</span></a></span></span><span>
</span><span id="line-268"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679485429"><span id="local-6989586621679485434"><span class="annot"><span class="annottext">BuildWay -&gt; BuildWay -&gt; Bool
(BuildWay -&gt; BuildWay -&gt; Bool)
-&gt; (BuildWay -&gt; BuildWay -&gt; Bool) -&gt; Eq BuildWay
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: BuildWay -&gt; BuildWay -&gt; Bool
== :: BuildWay -&gt; BuildWay -&gt; Bool
$c/= :: BuildWay -&gt; BuildWay -&gt; Bool
/= :: BuildWay -&gt; BuildWay -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679485440"><span id="local-6989586621679485444"><span id="local-6989586621679485448"><span id="local-6989586621679485451"><span id="local-6989586621679485454"><span id="local-6989586621679485457"><span id="local-6989586621679485460"><span class="annot"><span class="annottext">Eq BuildWay
Eq BuildWay =&gt;
(BuildWay -&gt; BuildWay -&gt; Ordering)
-&gt; (BuildWay -&gt; BuildWay -&gt; Bool)
-&gt; (BuildWay -&gt; BuildWay -&gt; Bool)
-&gt; (BuildWay -&gt; BuildWay -&gt; Bool)
-&gt; (BuildWay -&gt; BuildWay -&gt; Bool)
-&gt; (BuildWay -&gt; BuildWay -&gt; BuildWay)
-&gt; (BuildWay -&gt; BuildWay -&gt; BuildWay)
-&gt; Ord BuildWay
BuildWay -&gt; BuildWay -&gt; Bool
BuildWay -&gt; BuildWay -&gt; Ordering
BuildWay -&gt; BuildWay -&gt; BuildWay
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: BuildWay -&gt; BuildWay -&gt; Ordering
compare :: BuildWay -&gt; BuildWay -&gt; Ordering
$c&lt; :: BuildWay -&gt; BuildWay -&gt; Bool
&lt; :: BuildWay -&gt; BuildWay -&gt; Bool
$c&lt;= :: BuildWay -&gt; BuildWay -&gt; Bool
&lt;= :: BuildWay -&gt; BuildWay -&gt; Bool
$c&gt; :: BuildWay -&gt; BuildWay -&gt; Bool
&gt; :: BuildWay -&gt; BuildWay -&gt; Bool
$c&gt;= :: BuildWay -&gt; BuildWay -&gt; Bool
&gt;= :: BuildWay -&gt; BuildWay -&gt; Bool
$cmax :: BuildWay -&gt; BuildWay -&gt; BuildWay
max :: BuildWay -&gt; BuildWay -&gt; BuildWay
$cmin :: BuildWay -&gt; BuildWay -&gt; BuildWay
min :: BuildWay -&gt; BuildWay -&gt; BuildWay
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679485468"><span id="local-6989586621679485470"><span id="local-6989586621679485474"><span class="annot"><span class="annottext">Int -&gt; BuildWay -&gt; FilePath -&gt; FilePath
[BuildWay] -&gt; FilePath -&gt; FilePath
BuildWay -&gt; FilePath
(Int -&gt; BuildWay -&gt; FilePath -&gt; FilePath)
-&gt; (BuildWay -&gt; FilePath)
-&gt; ([BuildWay] -&gt; FilePath -&gt; FilePath)
-&gt; Show BuildWay
forall a.
(Int -&gt; a -&gt; FilePath -&gt; FilePath)
-&gt; (a -&gt; FilePath) -&gt; ([a] -&gt; FilePath -&gt; FilePath) -&gt; Show a
$cshowsPrec :: Int -&gt; BuildWay -&gt; FilePath -&gt; FilePath
showsPrec :: Int -&gt; BuildWay -&gt; FilePath -&gt; FilePath
$cshow :: BuildWay -&gt; FilePath
show :: BuildWay -&gt; FilePath
$cshowList :: [BuildWay] -&gt; FilePath -&gt; FilePath
showList :: [BuildWay] -&gt; FilePath -&gt; FilePath
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679485479"><span id="local-6989586621679485487"><span id="local-6989586621679485494"><span id="local-6989586621679485503"><span id="local-6989586621679485506"><span id="local-6989586621679485511"><span id="local-6989586621679485517"><span id="local-6989586621679485520"><span class="annot"><span class="annottext">Int -&gt; BuildWay
BuildWay -&gt; Int
BuildWay -&gt; [BuildWay]
BuildWay -&gt; BuildWay
BuildWay -&gt; BuildWay -&gt; [BuildWay]
BuildWay -&gt; BuildWay -&gt; BuildWay -&gt; [BuildWay]
(BuildWay -&gt; BuildWay)
-&gt; (BuildWay -&gt; BuildWay)
-&gt; (Int -&gt; BuildWay)
-&gt; (BuildWay -&gt; Int)
-&gt; (BuildWay -&gt; [BuildWay])
-&gt; (BuildWay -&gt; BuildWay -&gt; [BuildWay])
-&gt; (BuildWay -&gt; BuildWay -&gt; [BuildWay])
-&gt; (BuildWay -&gt; BuildWay -&gt; BuildWay -&gt; [BuildWay])
-&gt; Enum BuildWay
forall a.
(a -&gt; a)
-&gt; (a -&gt; a)
-&gt; (Int -&gt; a)
-&gt; (a -&gt; Int)
-&gt; (a -&gt; [a])
-&gt; (a -&gt; a -&gt; [a])
-&gt; (a -&gt; a -&gt; [a])
-&gt; (a -&gt; a -&gt; a -&gt; [a])
-&gt; Enum a
$csucc :: BuildWay -&gt; BuildWay
succ :: BuildWay -&gt; BuildWay
$cpred :: BuildWay -&gt; BuildWay
pred :: BuildWay -&gt; BuildWay
$ctoEnum :: Int -&gt; BuildWay
toEnum :: Int -&gt; BuildWay
$cfromEnum :: BuildWay -&gt; Int
fromEnum :: BuildWay -&gt; Int
$cenumFrom :: BuildWay -&gt; [BuildWay]
enumFrom :: BuildWay -&gt; [BuildWay]
$cenumFromThen :: BuildWay -&gt; BuildWay -&gt; [BuildWay]
enumFromThen :: BuildWay -&gt; BuildWay -&gt; [BuildWay]
$cenumFromTo :: BuildWay -&gt; BuildWay -&gt; [BuildWay]
enumFromTo :: BuildWay -&gt; BuildWay -&gt; [BuildWay]
$cenumFromThenTo :: BuildWay -&gt; BuildWay -&gt; BuildWay -&gt; [BuildWay]
enumFromThenTo :: BuildWay -&gt; BuildWay -&gt; BuildWay -&gt; [BuildWay]
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Enum</span></span></span></span></span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span class="annot"><span class="hs-comment">-- | Returns the object/interface extension prefix for the given build way (e.g. &quot;dyn_&quot; for 'DynWay')</span></span><span>
</span><span id="line-271"></span><span class="annot"><a href="Distribution.Simple.GHC.Build.Modules.html#buildWayPrefix"><span class="hs-identifier hs-type">buildWayPrefix</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Distribution.Simple.GHC.Build.Modules.html#BuildWay"><span class="hs-identifier hs-type">BuildWay</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-272"></span><span id="buildWayPrefix"><span class="annot"><span class="annottext">buildWayPrefix :: BuildWay -&gt; FilePath
</span><a href="Distribution.Simple.GHC.Build.Modules.html#buildWayPrefix"><span class="hs-identifier hs-var hs-var">buildWayPrefix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-273"></span><span>  </span><span class="annot"><span class="annottext">BuildWay
</span><a href="Distribution.Simple.GHC.Build.Modules.html#StaticWay"><span class="hs-identifier hs-var">StaticWay</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-274"></span><span>  </span><span class="annot"><span class="annottext">BuildWay
</span><a href="Distribution.Simple.GHC.Build.Modules.html#ProfWay"><span class="hs-identifier hs-var">ProfWay</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;p_&quot;</span></span><span>
</span><span id="line-275"></span><span>  </span><span class="annot"><span class="annottext">BuildWay
</span><a href="Distribution.Simple.GHC.Build.Modules.html#DynWay"><span class="hs-identifier hs-var">DynWay</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;dyn_&quot;</span></span><span>
</span><span id="line-276"></span><span>
</span><span id="line-277"></span><span class="annot"><span class="hs-comment">-- | Returns the corresponding 'Hpc.Way' for a 'BuildWay'</span></span><span>
</span><span id="line-278"></span><span class="annot"><a href="Distribution.Simple.GHC.Build.Modules.html#buildWayHpcWay"><span class="hs-identifier hs-type">buildWayHpcWay</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Distribution.Simple.GHC.Build.Modules.html#BuildWay"><span class="hs-identifier hs-type">BuildWay</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Distribution.Simple.Hpc.html#Way"><span class="hs-identifier hs-type">Hpc.Way</span></a></span><span>
</span><span id="line-279"></span><span id="buildWayHpcWay"><span class="annot"><span class="annottext">buildWayHpcWay :: BuildWay -&gt; Way
</span><a href="Distribution.Simple.GHC.Build.Modules.html#buildWayHpcWay"><span class="hs-identifier hs-var hs-var">buildWayHpcWay</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-280"></span><span>  </span><span class="annot"><span class="annottext">BuildWay
</span><a href="Distribution.Simple.GHC.Build.Modules.html#StaticWay"><span class="hs-identifier hs-var">StaticWay</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Way
</span><a href="Distribution.Simple.Hpc.html#Vanilla"><span class="hs-identifier hs-var">Hpc.Vanilla</span></a></span><span>
</span><span id="line-281"></span><span>  </span><span class="annot"><span class="annottext">BuildWay
</span><a href="Distribution.Simple.GHC.Build.Modules.html#ProfWay"><span class="hs-identifier hs-var">ProfWay</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Way
</span><a href="Distribution.Simple.Hpc.html#Prof"><span class="hs-identifier hs-var">Hpc.Prof</span></a></span><span>
</span><span id="line-282"></span><span>  </span><span class="annot"><span class="annottext">BuildWay
</span><a href="Distribution.Simple.GHC.Build.Modules.html#DynWay"><span class="hs-identifier hs-var">DynWay</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Way
</span><a href="Distribution.Simple.Hpc.html#Dyn"><span class="hs-identifier hs-var">Hpc.Dyn</span></a></span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span class="hs-comment">-- | Returns a function to extract the extra haskell compiler options from a</span><span>
</span><span id="line-285"></span><span class="hs-comment">-- 'BuildInfo' and 'CompilerFlavor'</span><span>
</span><span id="line-286"></span><span class="annot"><a href="Distribution.Simple.GHC.Build.Modules.html#buildWayExtraHcOptions"><span class="hs-identifier hs-type">buildWayExtraHcOptions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Distribution.Simple.GHC.Build.Modules.html#BuildWay"><span class="hs-identifier hs-type">BuildWay</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Compiler.html/Distribution.Compiler.html#CompilerFlavor"><span class="hs-identifier hs-type">CompilerFlavor</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.BuildInfo.html/Distribution.Types.BuildInfo.html#BuildInfo"><span class="hs-identifier hs-type">BuildInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span>
</span><span id="line-287"></span><span id="buildWayExtraHcOptions"><span class="annot"><span class="annottext">buildWayExtraHcOptions :: BuildWay -&gt; CompilerFlavor -&gt; BuildInfo -&gt; [FilePath]
</span><a href="Distribution.Simple.GHC.Build.Modules.html#buildWayExtraHcOptions"><span class="hs-identifier hs-var hs-var">buildWayExtraHcOptions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-288"></span><span>  </span><span class="annot"><span class="annottext">BuildWay
</span><a href="Distribution.Simple.GHC.Build.Modules.html#StaticWay"><span class="hs-identifier hs-var">StaticWay</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompilerFlavor -&gt; BuildInfo -&gt; [FilePath]
</span><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.BuildInfo.html/Distribution.Types.BuildInfo.html#hcStaticOptions"><span class="hs-identifier hs-var">hcStaticOptions</span></a></span><span>
</span><span id="line-289"></span><span>  </span><span class="annot"><span class="annottext">BuildWay
</span><a href="Distribution.Simple.GHC.Build.Modules.html#ProfWay"><span class="hs-identifier hs-var">ProfWay</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompilerFlavor -&gt; BuildInfo -&gt; [FilePath]
</span><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.BuildInfo.html/Distribution.Types.BuildInfo.html#hcProfOptions"><span class="hs-identifier hs-var">hcProfOptions</span></a></span><span>
</span><span id="line-290"></span><span>  </span><span class="annot"><span class="annottext">BuildWay
</span><a href="Distribution.Simple.GHC.Build.Modules.html#DynWay"><span class="hs-identifier hs-var">DynWay</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompilerFlavor -&gt; BuildInfo -&gt; [FilePath]
</span><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.BuildInfo.html/Distribution.Types.BuildInfo.html#hcSharedOptions"><span class="hs-identifier hs-var">hcSharedOptions</span></a></span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span class="hs-comment">-- | Returns a pair of the Haskell input files and Haskell modules of the</span><span>
</span><span id="line-293"></span><span class="hs-comment">-- component being built.</span><span>
</span><span id="line-294"></span><span class="hs-comment">--</span><span>
</span><span id="line-295"></span><span class="hs-comment">-- The &quot;input files&quot; are either the path to the main Haskell module, or a repl</span><span>
</span><span id="line-296"></span><span class="hs-comment">-- script (that does not necessarily have an extension).</span><span>
</span><span id="line-297"></span><span class="annot"><a href="Distribution.Simple.GHC.Build.Modules.html#componentInputs"><span class="hs-identifier hs-type">componentInputs</span></a></span><span>
</span><span id="line-298"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-299"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Target build dir</span></span><span>
</span><span id="line-300"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.PackageDescription.html/Distribution.Types.PackageDescription.html#PackageDescription"><span class="hs-identifier hs-type">PD.PackageDescription</span></a></span><span>
</span><span id="line-301"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Distribution.Simple.Build.Inputs.html#PreBuildComponentInputs"><span class="hs-identifier hs-type">PreBuildComponentInputs</span></a></span><span>
</span><span id="line-302"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ The context and component being built in it.</span></span><span>
</span><span id="line-303"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.ModuleName.html/Distribution.ModuleName.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-304"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ The Haskell input files, and the Haskell modules</span></span><span>
</span><span id="line-305"></span><span id="componentInputs"><span class="annot"><span class="annottext">componentInputs :: FilePath
-&gt; PackageDescription
-&gt; PreBuildComponentInputs
-&gt; IO ([FilePath], [ModuleName])
</span><a href="Distribution.Simple.GHC.Build.Modules.html#componentInputs"><span class="hs-identifier hs-var hs-var">componentInputs</span></a></span></span><span> </span><span id="local-6989586621679485530"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679485530"><span class="hs-identifier hs-var">buildTargetDir</span></a></span></span><span> </span><span id="local-6989586621679485531"><span class="annot"><span class="annottext">PackageDescription
</span><a href="#local-6989586621679485531"><span class="hs-identifier hs-var">pkg_descr</span></a></span></span><span> </span><span id="local-6989586621679485532"><span class="annot"><span class="annottext">PreBuildComponentInputs
</span><a href="#local-6989586621679485532"><span class="hs-identifier hs-var">pbci</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-306"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-307"></span><span>    </span><span id="local-6989586621679485533"><span class="annot"><span class="annottext">verbosity :: Verbosity
</span><a href="#local-6989586621679485533"><span class="hs-identifier hs-var hs-var">verbosity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreBuildComponentInputs -&gt; Verbosity
</span><a href="Distribution.Simple.Build.Inputs.html#buildVerbosity"><span class="hs-identifier hs-var">buildVerbosity</span></a></span><span> </span><span class="annot"><span class="annottext">PreBuildComponentInputs
</span><a href="#local-6989586621679485532"><span class="hs-identifier hs-var">pbci</span></a></span><span>
</span><span id="line-308"></span><span>    </span><span id="local-6989586621679485534"><span class="annot"><span class="annottext">component :: Component
</span><a href="#local-6989586621679485534"><span class="hs-identifier hs-var hs-var">component</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreBuildComponentInputs -&gt; Component
</span><a href="Distribution.Simple.Build.Inputs.html#buildComponent"><span class="hs-identifier hs-var">buildComponent</span></a></span><span> </span><span class="annot"><span class="annottext">PreBuildComponentInputs
</span><a href="#local-6989586621679485532"><span class="hs-identifier hs-var">pbci</span></a></span><span>
</span><span id="line-309"></span><span>    </span><span id="local-6989586621679485536"><span class="annot"><span class="annottext">clbi :: ComponentLocalBuildInfo
</span><a href="#local-6989586621679485536"><span class="hs-identifier hs-var hs-var">clbi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreBuildComponentInputs -&gt; ComponentLocalBuildInfo
</span><a href="Distribution.Simple.Build.Inputs.html#buildCLBI"><span class="hs-identifier hs-var">buildCLBI</span></a></span><span> </span><span class="annot"><span class="annottext">PreBuildComponentInputs
</span><a href="#local-6989586621679485532"><span class="hs-identifier hs-var">pbci</span></a></span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Component
</span><a href="#local-6989586621679485534"><span class="hs-identifier hs-var">component</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-312"></span><span>    </span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.Component.html/Distribution.Types.Component.html#CLib"><span class="hs-identifier hs-type">CLib</span></a></span><span> </span><span id="local-6989586621679485538"><span class="annot"><span class="annottext">Library
</span><a href="#local-6989586621679485538"><span class="hs-identifier hs-var">lib</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-313"></span><span>      </span><span class="annot"><span class="annottext">([FilePath], [ModuleName]) -&gt; IO ([FilePath], [ModuleName])
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Library -&gt; ComponentLocalBuildInfo -&gt; [ModuleName]
</span><a href="Distribution.Simple.LocalBuildInfo.html#allLibModules"><span class="hs-identifier hs-var">allLibModules</span></a></span><span> </span><span class="annot"><span class="annottext">Library
</span><a href="#local-6989586621679485538"><span class="hs-identifier hs-var">lib</span></a></span><span> </span><span class="annot"><span class="annottext">ComponentLocalBuildInfo
</span><a href="#local-6989586621679485536"><span class="hs-identifier hs-var">clbi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span>    </span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.Component.html/Distribution.Types.Component.html#CFLib"><span class="hs-identifier hs-type">CFLib</span></a></span><span> </span><span id="local-6989586621679485541"><span class="annot"><span class="annottext">ForeignLib
</span><a href="#local-6989586621679485541"><span class="hs-identifier hs-var">flib</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-315"></span><span>      </span><span class="annot"><span class="annottext">([FilePath], [ModuleName]) -&gt; IO ([FilePath], [ModuleName])
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ForeignLib -&gt; [ModuleName]
</span><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.ForeignLib.html/Distribution.Types.ForeignLib.html#foreignLibModules"><span class="hs-identifier hs-var">foreignLibModules</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignLib
</span><a href="#local-6989586621679485541"><span class="hs-identifier hs-var">flib</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>    </span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.Component.html/Distribution.Types.Component.html#CExe"><span class="hs-identifier hs-type">CExe</span></a></span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.Executable.html/Distribution.Types.Executable.html#Executable"><span class="hs-identifier hs-type">Executable</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">buildInfo :: Executable -&gt; BuildInfo
</span><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.Executable.html/Distribution.Types.Executable.html#buildInfo"><span class="hs-identifier hs-var">buildInfo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679485546"><span class="annot"><span class="annottext">BuildInfo
</span><a href="#local-6989586621679485546"><span class="hs-identifier hs-var">bi'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679485547"><span class="annot"><span class="annottext">FilePath
modulePath :: FilePath
modulePath :: Executable -&gt; FilePath
</span><a href="#local-6989586621679485547"><span class="hs-identifier hs-var hs-var">modulePath</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-317"></span><span>      </span><span class="annot"><span class="annottext">Verbosity -&gt; BuildInfo -&gt; FilePath -&gt; IO ([FilePath], [ModuleName])
forall {m :: * -&gt; *}.
MonadIO m =&gt;
Verbosity -&gt; BuildInfo -&gt; FilePath -&gt; m ([FilePath], [ModuleName])
</span><a href="#local-6989586621679485549"><span class="hs-identifier hs-var">exeLikeInputs</span></a></span><span> </span><span class="annot"><span class="annottext">Verbosity
</span><a href="#local-6989586621679485533"><span class="hs-identifier hs-var">verbosity</span></a></span><span> </span><span class="annot"><span class="annottext">BuildInfo
</span><a href="#local-6989586621679485546"><span class="hs-identifier hs-var">bi'</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679485547"><span class="hs-identifier hs-var">modulePath</span></a></span><span>
</span><span id="line-318"></span><span>    </span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.Component.html/Distribution.Types.Component.html#CTest"><span class="hs-identifier hs-type">CTest</span></a></span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.TestSuite.html/Distribution.Types.TestSuite.html#TestSuite"><span class="hs-identifier hs-type">TestSuite</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">testBuildInfo :: TestSuite -&gt; BuildInfo
</span><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.TestSuite.html/Distribution.Types.TestSuite.html#testBuildInfo"><span class="hs-identifier hs-var">testBuildInfo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679485553"><span class="annot"><span class="annottext">BuildInfo
</span><a href="#local-6989586621679485553"><span class="hs-identifier hs-var">bi'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">testInterface :: TestSuite -&gt; TestSuiteInterface
</span><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.TestSuite.html/Distribution.Types.TestSuite.html#testInterface"><span class="hs-identifier hs-var">testInterface</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.TestSuiteInterface.html/Distribution.Types.TestSuiteInterface.html#TestSuiteExeV10"><span class="hs-identifier hs-type">TestSuiteExeV10</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679485556"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679485556"><span class="hs-identifier hs-var">mainFile</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-319"></span><span>      </span><span class="annot"><span class="annottext">Verbosity -&gt; BuildInfo -&gt; FilePath -&gt; IO ([FilePath], [ModuleName])
forall {m :: * -&gt; *}.
MonadIO m =&gt;
Verbosity -&gt; BuildInfo -&gt; FilePath -&gt; m ([FilePath], [ModuleName])
</span><a href="#local-6989586621679485549"><span class="hs-identifier hs-var">exeLikeInputs</span></a></span><span> </span><span class="annot"><span class="annottext">Verbosity
</span><a href="#local-6989586621679485533"><span class="hs-identifier hs-var">verbosity</span></a></span><span> </span><span class="annot"><span class="annottext">BuildInfo
</span><a href="#local-6989586621679485553"><span class="hs-identifier hs-var">bi'</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679485556"><span class="hs-identifier hs-var">mainFile</span></a></span><span>
</span><span id="line-320"></span><span>    </span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.Component.html/Distribution.Types.Component.html#CBench"><span class="hs-identifier hs-type">CBench</span></a></span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.Benchmark.html/Distribution.Types.Benchmark.html#Benchmark"><span class="hs-identifier hs-type">Benchmark</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">benchmarkBuildInfo :: Benchmark -&gt; BuildInfo
</span><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.Benchmark.html/Distribution.Types.Benchmark.html#benchmarkBuildInfo"><span class="hs-identifier hs-var">benchmarkBuildInfo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679485560"><span class="annot"><span class="annottext">BuildInfo
</span><a href="#local-6989586621679485560"><span class="hs-identifier hs-var">bi'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">benchmarkInterface :: Benchmark -&gt; BenchmarkInterface
</span><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.Benchmark.html/Distribution.Types.Benchmark.html#benchmarkInterface"><span class="hs-identifier hs-var">benchmarkInterface</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.BenchmarkInterface.html/Distribution.Types.BenchmarkInterface.html#BenchmarkExeV10"><span class="hs-identifier hs-type">BenchmarkExeV10</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679485563"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679485563"><span class="hs-identifier hs-var">mainFile</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-321"></span><span>      </span><span class="annot"><span class="annottext">Verbosity -&gt; BuildInfo -&gt; FilePath -&gt; IO ([FilePath], [ModuleName])
forall {m :: * -&gt; *}.
MonadIO m =&gt;
Verbosity -&gt; BuildInfo -&gt; FilePath -&gt; m ([FilePath], [ModuleName])
</span><a href="#local-6989586621679485549"><span class="hs-identifier hs-var">exeLikeInputs</span></a></span><span> </span><span class="annot"><span class="annottext">Verbosity
</span><a href="#local-6989586621679485533"><span class="hs-identifier hs-var">verbosity</span></a></span><span> </span><span class="annot"><span class="annottext">BuildInfo
</span><a href="#local-6989586621679485560"><span class="hs-identifier hs-var">bi'</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679485563"><span class="hs-identifier hs-var">mainFile</span></a></span><span>
</span><span id="line-322"></span><span>    </span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.Component.html/Distribution.Types.Component.html#CTest"><span class="hs-identifier hs-type">CTest</span></a></span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.TestSuite.html/Distribution.Types.TestSuite.html#TestSuite"><span class="hs-identifier hs-type">TestSuite</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO ([FilePath], [ModuleName])
forall a. HasCallStack =&gt; FilePath -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;testSuiteExeV10AsExe: wrong kind&quot;</span></span><span>
</span><span id="line-323"></span><span>    </span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.Component.html/Distribution.Types.Component.html#CBench"><span class="hs-identifier hs-type">CBench</span></a></span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.Benchmark.html/Distribution.Types.Benchmark.html#Benchmark"><span class="hs-identifier hs-type">Benchmark</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO ([FilePath], [ModuleName])
forall a. HasCallStack =&gt; FilePath -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;benchmarkExeV10asExe: wrong kind&quot;</span></span><span>
</span><span id="line-324"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-325"></span><span>    </span><span id="local-6989586621679485549"><span class="annot"><span class="annottext">exeLikeInputs :: Verbosity -&gt; BuildInfo -&gt; FilePath -&gt; m ([FilePath], [ModuleName])
</span><a href="#local-6989586621679485549"><span class="hs-identifier hs-var hs-var">exeLikeInputs</span></a></span></span><span> </span><span id="local-6989586621679485590"><span class="annot"><span class="annottext">Verbosity
</span><a href="#local-6989586621679485590"><span class="hs-identifier hs-var">verbosity</span></a></span></span><span> </span><span id="local-6989586621679485591"><span class="annot"><span class="annottext">BuildInfo
</span><a href="#local-6989586621679485591"><span class="hs-identifier hs-var">bnfo</span></a></span></span><span> </span><span id="local-6989586621679485592"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679485592"><span class="hs-identifier hs-var">modulePath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO ([FilePath], [ModuleName]) -&gt; m ([FilePath], [ModuleName])
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.20.0.0-4014/src//Control.Monad.IO.Class.html/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ([FilePath], [ModuleName]) -&gt; m ([FilePath], [ModuleName]))
-&gt; IO ([FilePath], [ModuleName]) -&gt; m ([FilePath], [ModuleName])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-326"></span><span>      </span><span id="local-6989586621679485593"><span class="annot"><a href="#local-6989586621679485593"><span class="hs-identifier hs-var">main</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Verbosity -&gt; FilePath -&gt; (BuildInfo, FilePath) -&gt; IO FilePath
</span><a href="Distribution.Simple.GHC.Build.Utils.html#findExecutableMain"><span class="hs-identifier hs-var">findExecutableMain</span></a></span><span> </span><span class="annot"><span class="annottext">Verbosity
</span><a href="#local-6989586621679485590"><span class="hs-identifier hs-var">verbosity</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679485530"><span class="hs-identifier hs-var">buildTargetDir</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuildInfo
</span><a href="#local-6989586621679485591"><span class="hs-identifier hs-var">bnfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679485592"><span class="hs-identifier hs-var">modulePath</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679485595"><span class="annot"><a href="#local-6989586621679485595"><span class="hs-identifier hs-var hs-var">mainModName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuildInfo -&gt; ModuleName
</span><a href="Distribution.Simple.GHC.Build.Utils.html#exeMainModuleName"><span class="hs-identifier hs-var">exeMainModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">BuildInfo
</span><a href="#local-6989586621679485591"><span class="hs-identifier hs-var">bnfo</span></a></span><span>
</span><span id="line-328"></span><span>          </span><span id="local-6989586621679485597"><span class="annot"><a href="#local-6989586621679485597"><span class="hs-identifier hs-var hs-var">otherModNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuildInfo -&gt; [ModuleName]
</span><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.BuildInfo.html/Distribution.Types.BuildInfo.html#otherModules"><span class="hs-identifier hs-var">otherModules</span></a></span><span> </span><span class="annot"><span class="annottext">BuildInfo
</span><a href="#local-6989586621679485591"><span class="hs-identifier hs-var">bnfo</span></a></span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span>      </span><span class="hs-comment">-- Scripts have fakePackageId and are always Haskell but can have any extension.</span><span>
</span><span id="line-331"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="Distribution.Simple.GHC.Build.Utils.html#isHaskell"><span class="hs-identifier hs-type">isHaskell</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679485593"><span class="hs-identifier hs-type">main</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">||</span></span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.PackageDescription.html/Distribution.Types.PackageDescription.html#package"><span class="hs-identifier hs-var">PD.package</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679485531"><span class="hs-identifier hs-type">pkg_descr</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="Distribution.Types.PackageName.Magic.html#fakePackageId"><span class="hs-identifier hs-type">fakePackageId</span></a></span><span>
</span><span id="line-332"></span><span>        </span><span class="hs-keyword">then</span><span>
</span><span id="line-333"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Types.PackageDescription.html/Distribution.Types.PackageDescription.html#specVersion"><span class="hs-identifier hs-var">PD.specVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679485531"><span class="hs-identifier hs-type">pkg_descr</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;</span></span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.CabalSpecVersion.html/Distribution.CabalSpecVersion.html#CabalSpecV2_0"><span class="hs-identifier hs-type">CabalSpecV2_0</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679485595"><span class="hs-identifier hs-type">mainModName</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`elem`</span></span><span> </span><span class="annot"><a href="#local-6989586621679485597"><span class="hs-identifier hs-type">otherModNames</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-335"></span><span>              </span><span class="hs-comment">-- The cabal manual clearly states that `other-modules` is</span><span>
</span><span id="line-336"></span><span>              </span><span class="hs-comment">-- intended for non-main modules.  However, there's at least one</span><span>
</span><span id="line-337"></span><span>              </span><span class="hs-comment">-- important package on Hackage (happy-1.19.5) which</span><span>
</span><span id="line-338"></span><span>              </span><span class="hs-comment">-- violates this. We workaround this here so that we don't</span><span>
</span><span id="line-339"></span><span>              </span><span class="hs-comment">-- invoke GHC with e.g.  'ghc --make Main src/Main.hs' which</span><span>
</span><span id="line-340"></span><span>              </span><span class="hs-comment">-- would result in GHC complaining about duplicate Main</span><span>
</span><span id="line-341"></span><span>              </span><span class="hs-comment">-- modules.</span><span>
</span><span id="line-342"></span><span>              </span><span class="hs-comment">--</span><span>
</span><span id="line-343"></span><span>              </span><span class="hs-comment">-- Finally, we only enable this workaround for</span><span>
</span><span id="line-344"></span><span>              </span><span class="hs-comment">-- specVersion &lt; 2, as 'cabal-version:&gt;=2.0' cabal files</span><span>
</span><span id="line-345"></span><span>              </span><span class="hs-comment">-- have no excuse anymore to keep doing it wrong... ;-)</span><span>
</span><span id="line-346"></span><span>              </span><span class="annot"><a href="Distribution.Simple.Utils.html#warn"><span class="hs-identifier hs-type">warn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679485590"><span class="hs-identifier hs-type">verbosity</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-347"></span><span>                </span><span class="annot"><span class="hs-string">&quot;Enabling workaround for Main module '&quot;</span></span><span>
</span><span id="line-348"></span><span>                  </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.12.0.0-d78a/src//Distribution.Pretty.html/Distribution.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679485595"><span class="hs-identifier hs-type">mainModName</span></a></span><span>
</span><span id="line-349"></span><span>                  </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;' listed in 'other-modules' illegally!&quot;</span></span><span>
</span><span id="line-350"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679485593"><span class="hs-identifier hs-type">main</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">/=</span></span><span> </span><span class="annot"><span class="hs-identifier">mainModName</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679485597"><span class="hs-identifier hs-type">otherModNames</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-351"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679485593"><span class="hs-identifier hs-type">main</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679485597"><span class="hs-identifier hs-type">otherModNames</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679485597"><span class="hs-identifier hs-type">otherModNames</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-353"></span></pre></body></html>