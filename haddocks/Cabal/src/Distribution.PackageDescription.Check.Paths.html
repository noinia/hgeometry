<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- |</span><span>
</span><span id="line-2"></span><span class="hs-comment">-- Module      :  Distribution.PackageDescription.Check.Paths</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- Copyright   :  Lennart Kolmodin 2008, Francesco Ariis 2023</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- License     :  BSD3</span><span>
</span><span id="line-5"></span><span class="hs-comment">--</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- Maintainer  :  cabal-devel@haskell.org</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- Portability :  portable</span><span>
</span><span id="line-8"></span><span class="hs-comment">--</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- Functions to check filepaths, directories, globs, etc.</span><span>
</span><span id="line-10"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Distribution.PackageDescription.Check.Paths.html"><span class="hs-identifier">Distribution.PackageDescription.Check.Paths</span></a></span><span>
</span><span id="line-11"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Distribution.PackageDescription.Check.Paths.html#checkGlob"><span class="hs-identifier">checkGlob</span></a></span><span>
</span><span id="line-12"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Distribution.PackageDescription.Check.Paths.html#checkPath"><span class="hs-identifier">checkPath</span></a></span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Distribution.PackageDescription.Check.Paths.html#fileExtensionSupportedLanguage"><span class="hs-identifier">fileExtensionSupportedLanguage</span></a></span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Distribution.PackageDescription.Check.Paths.html#isGoodRelativeDirectoryPath"><span class="hs-identifier">isGoodRelativeDirectoryPath</span></a></span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Distribution.PackageDescription.Check.Paths.html#isGoodRelativeFilePath"><span class="hs-identifier">isGoodRelativeFilePath</span></a></span><span>
</span><span id="line-16"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Distribution.PackageDescription.Check.Paths.html#isGoodRelativeGlob"><span class="hs-identifier">isGoodRelativeGlob</span></a></span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Distribution.PackageDescription.Check.Paths.html#isInsideDist"><span class="hs-identifier">isInsideDist</span></a></span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../Cabal-syntax-3.14.1.0-ebb2/src/Distribution.Compat.Prelude.html"><span class="hs-identifier">Distribution.Compat.Prelude</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Prelude.html"><span class="hs-identifier">Prelude</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Distribution.PackageDescription.Check.Common.html"><span class="hs-identifier">Distribution.PackageDescription.Check.Common</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Distribution.PackageDescription.Check.Monad.html"><span class="hs-identifier">Distribution.PackageDescription.Check.Monad</span></a></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Distribution.Simple.CCompiler.html"><span class="hs-identifier">Distribution.Simple.CCompiler</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Distribution.Simple.Glob.html"><span class="hs-identifier">Distribution.Simple.Glob</span></a></span><span>
</span><span id="line-27"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Distribution.Simple.Glob.Internal.html#Glob"><span class="hs-identifier">Glob</span></a></span><span>
</span><span id="line-28"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Distribution.Simple.Glob.html#explainGlobSyntaxError"><span class="hs-identifier">explainGlobSyntaxError</span></a></span><span>
</span><span id="line-29"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Distribution.Simple.Glob.html#isRecursiveInRoot"><span class="hs-identifier">isRecursiveInRoot</span></a></span><span>
</span><span id="line-30"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Distribution.Simple.Glob.html#parseFileGlob"><span class="hs-identifier">parseFileGlob</span></a></span><span>
</span><span id="line-31"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Distribution.Simple.Utils.html"><span class="hs-identifier">Distribution.Simple.Utils</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Distribution.Simple.Utils.html#findPackageDesc"><span class="hs-identifier">findPackageDesc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Distribution.Simple.Utils.html#notice"><span class="hs-identifier">notice</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.html"><span class="hs-identifier">System.FilePath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#splitDirectories"><span class="hs-identifier">splitDirectories</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#splitPath"><span class="hs-identifier">splitPath</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#takeExtension"><span class="hs-identifier">takeExtension</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Windows.html"><span class="hs-identifier">System.FilePath.Windows</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">FilePath.Windows</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Windows.html#isValid"><span class="hs-identifier">isValid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="annot"><a href="Distribution.PackageDescription.Check.Paths.html#fileExtensionSupportedLanguage"><span class="hs-identifier hs-type">fileExtensionSupportedLanguage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-38"></span><span id="fileExtensionSupportedLanguage"><span class="annot"><span class="annottext">fileExtensionSupportedLanguage :: FilePath -&gt; Bool
</span><a href="Distribution.PackageDescription.Check.Paths.html#fileExtensionSupportedLanguage"><span class="hs-identifier hs-var hs-var">fileExtensionSupportedLanguage</span></a></span></span><span> </span><span id="local-6989586621679556457"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556457"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-39"></span><span>  </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679556458"><span class="hs-identifier hs-var">isHaskell</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679556460"><span class="hs-identifier hs-var">isC</span></a></span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-41"></span><span>    </span><span id="local-6989586621679556461"><span class="annot"><span class="annottext">extension :: FilePath
</span><a href="#local-6989586621679556461"><span class="hs-identifier hs-var hs-var">extension</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath
</span><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#takeExtension"><span class="hs-identifier hs-var">takeExtension</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556457"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-42"></span><span>    </span><span id="local-6989586621679556458"><span class="annot"><span class="annottext">isHaskell :: Bool
</span><a href="#local-6989586621679556458"><span class="hs-identifier hs-var hs-var">isHaskell</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556461"><span class="hs-identifier hs-var">extension</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;.hs&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;.lhs&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-43"></span><span>    </span><span id="local-6989586621679556460"><span class="annot"><span class="annottext">isC :: Bool
</span><a href="#local-6989586621679556460"><span class="hs-identifier hs-var hs-var">isC</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (CDialect, Bool) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; Maybe (CDialect, Bool)
</span><a href="Distribution.Simple.CCompiler.html#filenameCDialect"><span class="hs-identifier hs-var">filenameCDialect</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556461"><span class="hs-identifier hs-var">extension</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="hs-comment">-- Boolean: are absolute paths allowed?</span><span>
</span><span id="line-46"></span><span id="local-6989586621679556393"><span class="annot"><a href="Distribution.PackageDescription.Check.Paths.html#checkPath"><span class="hs-identifier hs-type">checkPath</span></a></span><span>
</span><span id="line-47"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679556393"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-48"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-comment">-- Can be absolute path?</span><span>
</span><span id="line-49"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Distribution.PackageDescription.Check.Common.html#CabalField"><span class="hs-identifier hs-type">CabalField</span></a></span><span> </span><span class="hs-comment">-- .cabal field that we are checking.</span><span>
</span><span id="line-50"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Distribution.PackageDescription.Check.Common.html#PathKind"><span class="hs-identifier hs-type">PathKind</span></a></span><span> </span><span class="hs-comment">-- Path type.</span><span>
</span><span id="line-51"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-comment">-- Path.</span><span>
</span><span id="line-52"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Distribution.PackageDescription.Check.Monad.html#CheckM"><span class="hs-identifier hs-type">CheckM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679556393"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-53"></span><span id="checkPath"><span class="annot"><span class="annottext">checkPath :: forall (m :: * -&gt; *).
Monad m =&gt;
Bool -&gt; FilePath -&gt; PathKind -&gt; FilePath -&gt; CheckM m ()
</span><a href="Distribution.PackageDescription.Check.Paths.html#checkPath"><span class="hs-identifier hs-var hs-var">checkPath</span></a></span></span><span> </span><span id="local-6989586621679556488"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679556488"><span class="hs-identifier hs-var">isAbs</span></a></span></span><span> </span><span id="local-6989586621679556489"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556489"><span class="hs-identifier hs-var">title</span></a></span></span><span> </span><span id="local-6989586621679556490"><span class="annot"><span class="annottext">PathKind
</span><a href="#local-6989586621679556490"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span id="local-6989586621679556491"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556491"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-54"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; PackageCheck -&gt; CheckM m ()
forall (m :: * -&gt; *).
Monad m =&gt;
Bool -&gt; PackageCheck -&gt; CheckM m ()
</span><a href="Distribution.PackageDescription.Check.Monad.html#checkP"><span class="hs-identifier hs-var">checkP</span></a></span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; Bool
</span><a href="#local-6989586621679556493"><span class="hs-identifier hs-var">isOutsideTree</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556491"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CheckExplanation -&gt; PackageCheck
</span><a href="Distribution.PackageDescription.Check.Warning.html#PackageBuildWarning"><span class="hs-identifier hs-var">PackageBuildWarning</span></a></span><span> </span><span class="annot"><span class="annottext">(CheckExplanation -&gt; PackageCheck)
-&gt; CheckExplanation -&gt; PackageCheck
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; CheckExplanation
</span><a href="Distribution.PackageDescription.Check.Warning.html#RelativeOutside"><span class="hs-identifier hs-var">RelativeOutside</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556489"><span class="hs-identifier hs-var">title</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556491"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; PackageCheck -&gt; CheckM m ()
forall (m :: * -&gt; *).
Monad m =&gt;
Bool -&gt; PackageCheck -&gt; CheckM m ()
</span><a href="Distribution.PackageDescription.Check.Monad.html#checkP"><span class="hs-identifier hs-var">checkP</span></a></span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; Bool
</span><a href="Distribution.PackageDescription.Check.Paths.html#isInsideDist"><span class="hs-identifier hs-var">isInsideDist</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556491"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CheckExplanation -&gt; PackageCheck
</span><a href="Distribution.PackageDescription.Check.Warning.html#PackageDistInexcusable"><span class="hs-identifier hs-var">PackageDistInexcusable</span></a></span><span> </span><span class="annot"><span class="annottext">(CheckExplanation -&gt; PackageCheck)
-&gt; CheckExplanation -&gt; PackageCheck
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe FilePath -&gt; FilePath -&gt; CheckExplanation
</span><a href="Distribution.PackageDescription.Check.Warning.html#DistPoint"><span class="hs-identifier hs-var">DistPoint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556489"><span class="hs-identifier hs-var">title</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556491"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span>  </span><span class="annot"><span class="annottext">PathKind -&gt; FilePath -&gt; CheckM m ()
forall (m :: * -&gt; *).
Monad m =&gt;
PathKind -&gt; FilePath -&gt; CheckM m ()
</span><a href="Distribution.PackageDescription.Check.Paths.html#checkPackageFileNamesWithGlob"><span class="hs-identifier hs-var">checkPackageFileNamesWithGlob</span></a></span><span> </span><span class="annot"><span class="annottext">PathKind
</span><a href="#local-6989586621679556490"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556491"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span>  </span><span class="hs-comment">-- Skip if &quot;can be absolute path&quot;.</span><span>
</span><span id="line-63"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; PackageCheck -&gt; CheckM m ()
forall (m :: * -&gt; *).
Monad m =&gt;
Bool -&gt; PackageCheck -&gt; CheckM m ()
</span><a href="Distribution.PackageDescription.Check.Monad.html#checkP"><span class="hs-identifier hs-var">checkP</span></a></span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679556488"><span class="hs-identifier hs-var">isAbs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Bool
</span><a href="../../Cabal-syntax-3.14.1.0-ebb2/src/Distribution.Utils.Generic.html#isAbsoluteOnAnyPlatform"><span class="hs-identifier hs-var">isAbsoluteOnAnyPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556491"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CheckExplanation -&gt; PackageCheck
</span><a href="Distribution.PackageDescription.Check.Warning.html#PackageDistInexcusable"><span class="hs-identifier hs-var">PackageDistInexcusable</span></a></span><span> </span><span class="annot"><span class="annottext">(CheckExplanation -&gt; PackageCheck)
-&gt; CheckExplanation -&gt; PackageCheck
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; CheckExplanation
</span><a href="Distribution.PackageDescription.Check.Warning.html#AbsolutePath"><span class="hs-identifier hs-var">AbsolutePath</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556489"><span class="hs-identifier hs-var">title</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556491"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; PathKind -&gt; Maybe FilePath
</span><a href="#local-6989586621679556503"><span class="hs-identifier hs-var">grl</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556491"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">PathKind
</span><a href="#local-6989586621679556490"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-67"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679556504"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556504"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-68"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; PackageCheck -&gt; CheckM m ()
forall (m :: * -&gt; *).
Monad m =&gt;
Bool -&gt; PackageCheck -&gt; CheckM m ()
</span><a href="Distribution.PackageDescription.Check.Monad.html#checkP"><span class="hs-identifier hs-var">checkP</span></a></span><span>
</span><span id="line-69"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679556488"><span class="hs-identifier hs-var">isAbs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CheckExplanation -&gt; PackageCheck
</span><a href="Distribution.PackageDescription.Check.Warning.html#PackageDistInexcusable"><span class="hs-identifier hs-var">PackageDistInexcusable</span></a></span><span> </span><span class="annot"><span class="annottext">(CheckExplanation -&gt; PackageCheck)
-&gt; CheckExplanation -&gt; PackageCheck
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath -&gt; CheckExplanation
</span><a href="Distribution.PackageDescription.Check.Warning.html#BadRelativePath"><span class="hs-identifier hs-var">BadRelativePath</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556489"><span class="hs-identifier hs-var">title</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556491"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556504"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span>    </span><span class="annot"><span class="annottext">Maybe FilePath
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; CheckM m ()
forall a. a -&gt; CheckM m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; FilePath -&gt; CheckM m ()
forall (m :: * -&gt; *). Monad m =&gt; Bool -&gt; FilePath -&gt; CheckM m ()
</span><a href="Distribution.PackageDescription.Check.Paths.html#checkWindowsPath"><span class="hs-identifier hs-var">checkWindowsPath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PathKind
</span><a href="#local-6989586621679556490"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">PathKind -&gt; PathKind -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">PathKind
</span><a href="Distribution.PackageDescription.Check.Common.html#PathKindGlob"><span class="hs-identifier hs-var">PathKindGlob</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556491"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-73"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-74"></span><span>    </span><span id="local-6989586621679556493"><span class="annot"><span class="annottext">isOutsideTree :: FilePath -&gt; Bool
</span><a href="#local-6989586621679556493"><span class="hs-identifier hs-var hs-var">isOutsideTree</span></a></span></span><span> </span><span id="local-6989586621679556508"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556508"><span class="hs-identifier hs-var">wpath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath]
</span><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#splitDirectories"><span class="hs-identifier hs-var">splitDirectories</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556508"><span class="hs-identifier hs-var">wpath</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-75"></span><span>      </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;..&quot;</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-76"></span><span>      </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;..&quot;</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-77"></span><span>      </span><span class="annot"><span class="annottext">[FilePath]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-comment">-- These are not paths, but globs...</span><span>
</span><span id="line-80"></span><span>    </span><span id="local-6989586621679556503"><span class="annot"><span class="annottext">grl :: FilePath -&gt; PathKind -&gt; Maybe FilePath
</span><a href="#local-6989586621679556503"><span class="hs-identifier hs-var hs-var">grl</span></a></span></span><span> </span><span id="local-6989586621679556509"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556509"><span class="hs-identifier hs-var">wfp</span></a></span></span><span> </span><span class="annot"><span class="annottext">PathKind
</span><a href="Distribution.PackageDescription.Check.Common.html#PathKindFile"><span class="hs-identifier hs-var">PathKindFile</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
</span><a href="Distribution.PackageDescription.Check.Paths.html#isGoodRelativeFilePath"><span class="hs-identifier hs-var">isGoodRelativeFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556509"><span class="hs-identifier hs-var">wfp</span></a></span><span>
</span><span id="line-81"></span><span>    </span><span class="annot"><a href="#local-6989586621679556503"><span class="hs-identifier hs-var">grl</span></a></span><span> </span><span id="local-6989586621679556511"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556511"><span class="hs-identifier hs-var">wfp</span></a></span></span><span> </span><span class="annot"><span class="annottext">PathKind
</span><a href="Distribution.PackageDescription.Check.Common.html#PathKindGlob"><span class="hs-identifier hs-var">PathKindGlob</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
</span><a href="Distribution.PackageDescription.Check.Paths.html#isGoodRelativeGlob"><span class="hs-identifier hs-var">isGoodRelativeGlob</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556511"><span class="hs-identifier hs-var">wfp</span></a></span><span>
</span><span id="line-82"></span><span>    </span><span class="annot"><a href="#local-6989586621679556503"><span class="hs-identifier hs-var">grl</span></a></span><span> </span><span id="local-6989586621679556512"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556512"><span class="hs-identifier hs-var">wfp</span></a></span></span><span> </span><span class="annot"><span class="annottext">PathKind
</span><a href="Distribution.PackageDescription.Check.Common.html#PathKindDirectory"><span class="hs-identifier hs-var">PathKindDirectory</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
</span><a href="Distribution.PackageDescription.Check.Paths.html#isGoodRelativeDirectoryPath"><span class="hs-identifier hs-var">isGoodRelativeDirectoryPath</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556512"><span class="hs-identifier hs-var">wfp</span></a></span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="annot"><span class="hs-comment">-- | Is a 'FilePath' inside `dist`, `dist-newstyle` and friends?</span></span><span>
</span><span id="line-85"></span><span class="annot"><a href="Distribution.PackageDescription.Check.Paths.html#isInsideDist"><span class="hs-identifier hs-type">isInsideDist</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-86"></span><span id="isInsideDist"><span class="annot"><span class="annottext">isInsideDist :: FilePath -&gt; Bool
</span><a href="Distribution.PackageDescription.Check.Paths.html#isInsideDist"><span class="hs-identifier hs-var hs-var">isInsideDist</span></a></span></span><span> </span><span id="local-6989586621679556514"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556514"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; FilePath) -&gt; [FilePath] -&gt; [FilePath]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath
</span><a href="../../Cabal-syntax-3.14.1.0-ebb2/src/Distribution.Utils.Generic.html#lowercase"><span class="hs-identifier hs-var">lowercase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath]
</span><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#splitDirectories"><span class="hs-identifier hs-var">splitDirectories</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556514"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-88"></span><span>    </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;dist&quot;</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-89"></span><span>    </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;dist&quot;</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-90"></span><span>    </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;dist-newstyle&quot;</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-91"></span><span>    </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;dist-newstyle&quot;</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-92"></span><span>    </span><span class="annot"><span class="annottext">[FilePath]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span id="local-6989586621679556406"><span class="annot"><a href="Distribution.PackageDescription.Check.Paths.html#checkPackageFileNamesWithGlob"><span class="hs-identifier hs-type">checkPackageFileNamesWithGlob</span></a></span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679556406"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Distribution.PackageDescription.Check.Common.html#PathKind"><span class="hs-identifier hs-type">PathKind</span></a></span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-comment">-- Filepath or possibly a glob pattern.</span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Distribution.PackageDescription.Check.Monad.html#CheckM"><span class="hs-identifier hs-type">CheckM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679556406"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-99"></span><span id="checkPackageFileNamesWithGlob"><span class="annot"><span class="annottext">checkPackageFileNamesWithGlob :: forall (m :: * -&gt; *).
Monad m =&gt;
PathKind -&gt; FilePath -&gt; CheckM m ()
</span><a href="Distribution.PackageDescription.Check.Paths.html#checkPackageFileNamesWithGlob"><span class="hs-identifier hs-var hs-var">checkPackageFileNamesWithGlob</span></a></span></span><span> </span><span id="local-6989586621679556521"><span class="annot"><span class="annottext">PathKind
</span><a href="#local-6989586621679556521"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span id="local-6989586621679556522"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556522"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-100"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; FilePath -&gt; CheckM m ()
forall (m :: * -&gt; *). Monad m =&gt; Bool -&gt; FilePath -&gt; CheckM m ()
</span><a href="Distribution.PackageDescription.Check.Paths.html#checkWindowsPath"><span class="hs-identifier hs-var">checkWindowsPath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PathKind
</span><a href="#local-6989586621679556521"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">PathKind -&gt; PathKind -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">PathKind
</span><a href="Distribution.PackageDescription.Check.Common.html#PathKindGlob"><span class="hs-identifier hs-var">PathKindGlob</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556522"><span class="hs-identifier hs-var">fp</span></a></span><span>
</span><span id="line-101"></span><span>  </span><span class="annot"><span class="annottext">FilePath -&gt; CheckM m ()
forall (m :: * -&gt; *). Monad m =&gt; FilePath -&gt; CheckM m ()
</span><a href="Distribution.PackageDescription.Check.Paths.html#checkTarPath"><span class="hs-identifier hs-var">checkTarPath</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556522"><span class="hs-identifier hs-var">fp</span></a></span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span id="local-6989586621679556409"><span class="annot"><a href="Distribution.PackageDescription.Check.Paths.html#checkWindowsPath"><span class="hs-identifier hs-type">checkWindowsPath</span></a></span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679556409"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-105"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-comment">-- Is it a glob pattern?</span><span>
</span><span id="line-106"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-comment">-- Path.</span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Distribution.PackageDescription.Check.Monad.html#CheckM"><span class="hs-identifier hs-type">CheckM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679556409"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-108"></span><span id="checkWindowsPath"><span class="annot"><span class="annottext">checkWindowsPath :: forall (m :: * -&gt; *). Monad m =&gt; Bool -&gt; FilePath -&gt; CheckM m ()
</span><a href="Distribution.PackageDescription.Check.Paths.html#checkWindowsPath"><span class="hs-identifier hs-var hs-var">checkWindowsPath</span></a></span></span><span> </span><span id="local-6989586621679556527"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679556527"><span class="hs-identifier hs-var">isGlob</span></a></span></span><span> </span><span id="local-6989586621679556528"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556528"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-109"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; PackageCheck -&gt; CheckM m ()
forall (m :: * -&gt; *).
Monad m =&gt;
Bool -&gt; PackageCheck -&gt; CheckM m ()
</span><a href="Distribution.PackageDescription.Check.Monad.html#checkP"><span class="hs-identifier hs-var">checkP</span></a></span><span>
</span><span id="line-110"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (FilePath -&gt; Bool) -&gt; FilePath -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Bool
</span><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Windows.html#isValid"><span class="hs-identifier hs-var">FilePath.Windows.isValid</span></a></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; Bool) -&gt; FilePath -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; FilePath -&gt; FilePath
</span><a href="#local-6989586621679556530"><span class="hs-identifier hs-var">escape</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679556527"><span class="hs-identifier hs-var">isGlob</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556528"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CheckExplanation -&gt; PackageCheck
</span><a href="Distribution.PackageDescription.Check.Warning.html#PackageDistInexcusable"><span class="hs-identifier hs-var">PackageDistInexcusable</span></a></span><span> </span><span class="annot"><span class="annottext">(CheckExplanation -&gt; PackageCheck)
-&gt; CheckExplanation -&gt; PackageCheck
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[FilePath] -&gt; CheckExplanation
</span><a href="Distribution.PackageDescription.Check.Warning.html#InvalidOnWin"><span class="hs-identifier hs-var">InvalidOnWin</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556528"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-comment">-- Force a relative name to catch invalid file names like &quot;f:oo&quot; which</span><span>
</span><span id="line-114"></span><span>    </span><span class="hs-comment">-- otherwise parse as file &quot;oo&quot; in the current directory on the 'f' drive.</span><span>
</span><span id="line-115"></span><span>    </span><span class="annot"><a href="#local-6989586621679556530"><span class="hs-identifier hs-type">escape</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-116"></span><span>    </span><span id="local-6989586621679556530"><span class="annot"><span class="annottext">escape :: Bool -&gt; FilePath -&gt; FilePath
</span><a href="#local-6989586621679556530"><span class="hs-identifier hs-var hs-var">escape</span></a></span></span><span> </span><span id="local-6989586621679556532"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679556532"><span class="hs-identifier hs-var">wisGlob</span></a></span></span><span> </span><span id="local-6989586621679556533"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556533"><span class="hs-identifier hs-var">wpath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-117"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;.\\&quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>      </span><span class="hs-comment">-- Glob paths will be expanded before being dereferenced, so asterisks</span><span>
</span><span id="line-119"></span><span>      </span><span class="hs-comment">-- shouldn't count against them.</span><span>
</span><span id="line-120"></span><span>      </span><span class="annot"><span class="annottext">(FilePath -&gt; FilePath) -&gt; FilePath -&gt; FilePath
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-121"></span><span>        </span><span class="annot"><span class="annottext">(Char -&gt; Char) -&gt; FilePath -&gt; FilePath
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679556534"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556534"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556534"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'*'</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679556532"><span class="hs-identifier hs-var">wisGlob</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'x'</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556534"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556533"><span class="hs-identifier hs-var">wpath</span></a></span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="hs-comment">-- | Check a file name is valid for the portable POSIX tar format.</span><span>
</span><span id="line-124"></span><span class="hs-comment">--</span><span>
</span><span id="line-125"></span><span class="hs-comment">-- The POSIX tar format has a restriction on the length of file names. It is</span><span>
</span><span id="line-126"></span><span class="hs-comment">-- unfortunately not a simple restriction like a maximum length. The exact</span><span>
</span><span id="line-127"></span><span class="hs-comment">-- restriction is that either the whole path be 100 characters or less, or it</span><span>
</span><span id="line-128"></span><span class="hs-comment">-- be possible to split the path on a directory separator such that the first</span><span>
</span><span id="line-129"></span><span class="hs-comment">-- part is 155 characters or less and the second part 100 characters or less.</span><span>
</span><span id="line-130"></span><span id="local-6989586621679556414"><span class="annot"><a href="Distribution.PackageDescription.Check.Paths.html#checkTarPath"><span class="hs-identifier hs-type">checkTarPath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679556414"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Distribution.PackageDescription.Check.Monad.html#CheckM"><span class="hs-identifier hs-type">CheckM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679556414"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-131"></span><span id="checkTarPath"><span class="annot"><span class="annottext">checkTarPath :: forall (m :: * -&gt; *). Monad m =&gt; FilePath -&gt; CheckM m ()
</span><a href="Distribution.PackageDescription.Check.Paths.html#checkTarPath"><span class="hs-identifier hs-var hs-var">checkTarPath</span></a></span></span><span> </span><span id="local-6989586621679556549"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556549"><span class="hs-identifier hs-var">path</span></a></span></span><span>
</span><span id="line-132"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556549"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">255</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PackageCheck -&gt; CheckM m ()
forall (m :: * -&gt; *). Monad m =&gt; PackageCheck -&gt; CheckM m ()
</span><a href="Distribution.PackageDescription.Check.Monad.html#tellP"><span class="hs-identifier hs-var">tellP</span></a></span><span> </span><span class="annot"><span class="annottext">PackageCheck
</span><a href="#local-6989586621679556553"><span class="hs-identifier hs-var">longPath</span></a></span><span>
</span><span id="line-133"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [FilePath] -&gt; Either PackageCheck [FilePath]
forall {t :: * -&gt; *} {a}.
Foldable t =&gt;
Int -&gt; [t a] -&gt; Either PackageCheck [t a]
</span><a href="#local-6989586621679556554"><span class="hs-identifier hs-var">pack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679556555"><span class="hs-identifier hs-var">nameMax</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FilePath] -&gt; [FilePath]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath]
</span><a href="../../filepath-1.5.4.0-e69b/src/System.FilePath.Posix.html#splitPath"><span class="hs-identifier hs-var">splitPath</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556549"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-134"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679556557"><span class="annot"><span class="annottext">PackageCheck
</span><a href="#local-6989586621679556557"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PackageCheck -&gt; CheckM m ()
forall (m :: * -&gt; *). Monad m =&gt; PackageCheck -&gt; CheckM m ()
</span><a href="Distribution.PackageDescription.Check.Monad.html#tellP"><span class="hs-identifier hs-var">tellP</span></a></span><span> </span><span class="annot"><span class="annottext">PackageCheck
</span><a href="#local-6989586621679556557"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-135"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; CheckM m ()
forall a. a -&gt; CheckM m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679556558"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556558"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679556559"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621679556559"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [FilePath] -&gt; Either PackageCheck [FilePath]
forall {t :: * -&gt; *} {a}.
Foldable t =&gt;
Int -&gt; [t a] -&gt; Either PackageCheck [t a]
</span><a href="#local-6989586621679556554"><span class="hs-identifier hs-var">pack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679556560"><span class="hs-identifier hs-var">prefixMax</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621679556561"><span class="hs-identifier hs-var">remainder</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-137"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679556562"><span class="annot"><span class="annottext">PackageCheck
</span><a href="#local-6989586621679556562"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PackageCheck -&gt; CheckM m ()
forall (m :: * -&gt; *). Monad m =&gt; PackageCheck -&gt; CheckM m ()
</span><a href="Distribution.PackageDescription.Check.Monad.html#tellP"><span class="hs-identifier hs-var">tellP</span></a></span><span> </span><span class="annot"><span class="annottext">PackageCheck
</span><a href="#local-6989586621679556562"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-138"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; CheckM m ()
forall a. a -&gt; CheckM m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PackageCheck -&gt; CheckM m ()
forall (m :: * -&gt; *). Monad m =&gt; PackageCheck -&gt; CheckM m ()
</span><a href="Distribution.PackageDescription.Check.Monad.html#tellP"><span class="hs-identifier hs-var">tellP</span></a></span><span> </span><span class="annot"><span class="annottext">PackageCheck
</span><a href="#local-6989586621679556563"><span class="hs-identifier hs-var">noSplit</span></a></span><span>
</span><span id="line-140"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-141"></span><span>          </span><span class="hs-comment">-- drop the '/' between the name and prefix:</span><span>
</span><span id="line-142"></span><span>          </span><span id="local-6989586621679556561"><span class="annot"><span class="annottext">remainder :: [FilePath]
</span><a href="#local-6989586621679556561"><span class="hs-identifier hs-var hs-var">remainder</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath
forall a. [a] -&gt; [a]
</span><a href="../../Cabal-syntax-3.14.1.0-ebb2/src/Distribution.Utils.Generic.html#safeInit"><span class="hs-identifier hs-var">safeInit</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556558"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath] -&gt; [FilePath]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621679556559"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-143"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-144"></span><span>    </span><span class="annot"><a href="#local-6989586621679556555"><span class="hs-identifier hs-type">nameMax</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679556560"><span class="hs-identifier hs-type">prefixMax</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-145"></span><span>    </span><span id="local-6989586621679556555"><span class="annot"><span class="annottext">nameMax :: Int
</span><a href="#local-6989586621679556555"><span class="hs-identifier hs-var hs-var">nameMax</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">100</span></span><span>
</span><span id="line-146"></span><span>    </span><span id="local-6989586621679556560"><span class="annot"><span class="annottext">prefixMax :: Int
</span><a href="#local-6989586621679556560"><span class="hs-identifier hs-var hs-var">prefixMax</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">155</span></span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span>    </span><span id="local-6989586621679556554"><span class="annot"><span class="annottext">pack :: Int -&gt; [t a] -&gt; Either PackageCheck [t a]
</span><a href="#local-6989586621679556554"><span class="hs-identifier hs-var hs-var">pack</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PackageCheck -&gt; Either PackageCheck [t a]
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">PackageCheck
</span><a href="#local-6989586621679556568"><span class="hs-identifier hs-var">emptyName</span></a></span><span>
</span><span id="line-149"></span><span>    </span><span class="annot"><a href="#local-6989586621679556554"><span class="hs-identifier hs-var">pack</span></a></span><span> </span><span id="local-6989586621679556569"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679556569"><span class="hs-identifier hs-var">maxLen</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679556570"><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621679556570"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679556571"><span class="annot"><span class="annottext">[t a]
</span><a href="#local-6989586621679556571"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679556572"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679556569"><span class="hs-identifier hs-var">maxLen</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PackageCheck -&gt; Either PackageCheck [t a]
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">PackageCheck
</span><a href="#local-6989586621679556573"><span class="hs-identifier hs-var">longName</span></a></span><span>
</span><span id="line-151"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[t a] -&gt; Either PackageCheck [t a]
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; [t a] -&gt; [t a]
forall {t :: * -&gt; *} {a}.
Foldable t =&gt;
Int -&gt; Int -&gt; [t a] -&gt; [t a]
</span><a href="#local-6989586621679556574"><span class="hs-identifier hs-var">pack'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679556569"><span class="hs-identifier hs-var">maxLen</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679556572"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[t a]
</span><a href="#local-6989586621679556571"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-153"></span><span>        </span><span id="local-6989586621679556572"><span class="annot"><span class="annottext">n :: Int
</span><a href="#local-6989586621679556572"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">t a -&gt; Int
forall a. t a -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621679556570"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span>    </span><span id="local-6989586621679556574"><span class="annot"><span class="annottext">pack' :: Int -&gt; Int -&gt; [t a] -&gt; [t a]
</span><a href="#local-6989586621679556574"><span class="hs-identifier hs-var hs-var">pack'</span></a></span></span><span> </span><span id="local-6989586621679556578"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679556578"><span class="hs-identifier hs-var">maxLen</span></a></span></span><span> </span><span id="local-6989586621679556579"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679556579"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679556580"><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621679556580"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679556581"><span class="annot"><span class="annottext">[t a]
</span><a href="#local-6989586621679556581"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679556582"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679556578"><span class="hs-identifier hs-var">maxLen</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; [t a] -&gt; [t a]
</span><a href="#local-6989586621679556574"><span class="hs-identifier hs-var">pack'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679556578"><span class="hs-identifier hs-var">maxLen</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679556582"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="annot"><span class="annottext">[t a]
</span><a href="#local-6989586621679556581"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-157"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-158"></span><span>        </span><span id="local-6989586621679556582"><span class="annot"><span class="annottext">n' :: Int
</span><a href="#local-6989586621679556582"><span class="hs-identifier hs-var hs-var">n'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679556579"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">t a -&gt; Int
forall a. t a -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621679556580"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-159"></span><span>    </span><span class="annot"><a href="#local-6989586621679556574"><span class="hs-identifier hs-var">pack'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679556587"><span class="annot"><span class="annottext">[t a]
</span><a href="#local-6989586621679556587"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[t a]
</span><a href="#local-6989586621679556587"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span>    </span><span id="local-6989586621679556553"><span class="annot"><span class="annottext">longPath :: PackageCheck
</span><a href="#local-6989586621679556553"><span class="hs-identifier hs-var hs-var">longPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CheckExplanation -&gt; PackageCheck
</span><a href="Distribution.PackageDescription.Check.Warning.html#PackageDistInexcusable"><span class="hs-identifier hs-var">PackageDistInexcusable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; CheckExplanation
</span><a href="Distribution.PackageDescription.Check.Warning.html#FilePathTooLong"><span class="hs-identifier hs-var">FilePathTooLong</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556549"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>    </span><span id="local-6989586621679556573"><span class="annot"><span class="annottext">longName :: PackageCheck
</span><a href="#local-6989586621679556573"><span class="hs-identifier hs-var hs-var">longName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CheckExplanation -&gt; PackageCheck
</span><a href="Distribution.PackageDescription.Check.Warning.html#PackageDistInexcusable"><span class="hs-identifier hs-var">PackageDistInexcusable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; CheckExplanation
</span><a href="Distribution.PackageDescription.Check.Warning.html#FilePathNameTooLong"><span class="hs-identifier hs-var">FilePathNameTooLong</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556549"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>    </span><span id="local-6989586621679556563"><span class="annot"><span class="annottext">noSplit :: PackageCheck
</span><a href="#local-6989586621679556563"><span class="hs-identifier hs-var hs-var">noSplit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CheckExplanation -&gt; PackageCheck
</span><a href="Distribution.PackageDescription.Check.Warning.html#PackageDistInexcusable"><span class="hs-identifier hs-var">PackageDistInexcusable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; CheckExplanation
</span><a href="Distribution.PackageDescription.Check.Warning.html#FilePathSplitTooLong"><span class="hs-identifier hs-var">FilePathSplitTooLong</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556549"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>    </span><span id="local-6989586621679556568"><span class="annot"><span class="annottext">emptyName :: PackageCheck
</span><a href="#local-6989586621679556568"><span class="hs-identifier hs-var hs-var">emptyName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CheckExplanation -&gt; PackageCheck
</span><a href="Distribution.PackageDescription.Check.Warning.html#PackageDistInexcusable"><span class="hs-identifier hs-var">PackageDistInexcusable</span></a></span><span> </span><span class="annot"><span class="annottext">CheckExplanation
</span><a href="Distribution.PackageDescription.Check.Warning.html#FilePathEmpty"><span class="hs-identifier hs-var">FilePathEmpty</span></a></span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span class="hs-comment">-- `checkGlob` checks glob patterns and returns good ones for further</span><span>
</span><span id="line-167"></span><span class="hs-comment">-- processing.</span><span>
</span><span id="line-168"></span><span id="local-6989586621679556432"><span class="annot"><a href="Distribution.PackageDescription.Check.Paths.html#checkGlob"><span class="hs-identifier hs-type">checkGlob</span></a></span><span>
</span><span id="line-169"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679556432"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-170"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Distribution.PackageDescription.Check.Common.html#CabalField"><span class="hs-identifier hs-type">CabalField</span></a></span><span> </span><span class="hs-comment">-- .cabal field we are checking.</span><span>
</span><span id="line-171"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-comment">-- glob filepath pattern</span><span>
</span><span id="line-172"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Distribution.PackageDescription.Check.Monad.html#CheckM"><span class="hs-identifier hs-type">CheckM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679556432"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Distribution.Simple.Glob.Internal.html#Glob"><span class="hs-identifier hs-type">Glob</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-173"></span><span id="checkGlob"><span class="annot"><span class="annottext">checkGlob :: forall (m :: * -&gt; *).
Monad m =&gt;
FilePath -&gt; FilePath -&gt; CheckM m (Maybe Glob)
</span><a href="Distribution.PackageDescription.Check.Paths.html#checkGlob"><span class="hs-identifier hs-var hs-var">checkGlob</span></a></span></span><span> </span><span id="local-6989586621679556601"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556601"><span class="hs-identifier hs-var">title</span></a></span></span><span> </span><span id="local-6989586621679556602"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556602"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-174"></span><span>  </span><span id="local-6989586621679556603"><span class="annot"><a href="#local-6989586621679556603"><span class="hs-identifier hs-var">ver</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(CheckCtx m -&gt; CabalSpecVersion) -&gt; CheckM m CabalSpecVersion
forall (m :: * -&gt; *) a. Monad m =&gt; (CheckCtx m -&gt; a) -&gt; CheckM m a
</span><a href="Distribution.PackageDescription.Check.Monad.html#asksCM"><span class="hs-identifier hs-var">asksCM</span></a></span><span> </span><span class="annot"><span class="annottext">CheckCtx m -&gt; CabalSpecVersion
forall (m :: * -&gt; *). CheckCtx m -&gt; CabalSpecVersion
</span><a href="Distribution.PackageDescription.Check.Monad.html#ccSpecVersion"><span class="hs-identifier hs-var">ccSpecVersion</span></a></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span>  </span><span class="hs-comment">-- Glob sanity check.</span><span>
</span><span id="line-177"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="Distribution.Simple.Glob.html#parseFileGlob"><span class="hs-identifier hs-type">parseFileGlob</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679556603"><span class="hs-identifier hs-type">ver</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679556602"><span class="hs-identifier hs-type">pat</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-178"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679556606"><span class="annot"><span class="annottext">GlobSyntaxError
</span><a href="#local-6989586621679556606"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-179"></span><span>      </span><span class="annot"><span class="annottext">PackageCheck -&gt; CheckM m ()
forall (m :: * -&gt; *). Monad m =&gt; PackageCheck -&gt; CheckM m ()
</span><a href="Distribution.PackageDescription.Check.Monad.html#tellP"><span class="hs-identifier hs-var">tellP</span></a></span><span>
</span><span id="line-180"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">CheckExplanation -&gt; PackageCheck
</span><a href="Distribution.PackageDescription.Check.Warning.html#PackageDistInexcusable"><span class="hs-identifier hs-var">PackageDistInexcusable</span></a></span><span> </span><span class="annot"><span class="annottext">(CheckExplanation -&gt; PackageCheck)
-&gt; CheckExplanation -&gt; PackageCheck
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-181"></span><span>            </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; CheckExplanation
</span><a href="Distribution.PackageDescription.Check.Warning.html#GlobSyntaxError"><span class="hs-identifier hs-var">GlobSyntaxError</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556601"><span class="hs-identifier hs-var">title</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; GlobSyntaxError -&gt; FilePath
</span><a href="Distribution.Simple.Glob.html#explainGlobSyntaxError"><span class="hs-identifier hs-var">explainGlobSyntaxError</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556602"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">GlobSyntaxError
</span><a href="#local-6989586621679556606"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span>      </span><span class="annot"><span class="annottext">Maybe Glob -&gt; CheckM m (Maybe Glob)
forall a. a -&gt; CheckM m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Glob
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-184"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679556608"><span class="annot"><span class="annottext">Glob
</span><a href="#local-6989586621679556608"><span class="hs-identifier hs-var">wglob</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-185"></span><span>      </span><span class="hs-comment">-- \* Miscellaneous checks on sane glob.</span><span>
</span><span id="line-186"></span><span>      </span><span class="hs-comment">-- Checks for recursive glob in root.</span><span>
</span><span id="line-187"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; PackageCheck -&gt; CheckM m ()
forall (m :: * -&gt; *).
Monad m =&gt;
Bool -&gt; PackageCheck -&gt; CheckM m ()
</span><a href="Distribution.PackageDescription.Check.Monad.html#checkP"><span class="hs-identifier hs-var">checkP</span></a></span><span>
</span><span id="line-188"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Glob -&gt; Bool
</span><a href="Distribution.Simple.Glob.html#isRecursiveInRoot"><span class="hs-identifier hs-var">isRecursiveInRoot</span></a></span><span> </span><span class="annot"><span class="annottext">Glob
</span><a href="#local-6989586621679556608"><span class="hs-identifier hs-var">wglob</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">CheckExplanation -&gt; PackageCheck
</span><a href="Distribution.PackageDescription.Check.Warning.html#PackageDistSuspiciousWarn"><span class="hs-identifier hs-var">PackageDistSuspiciousWarn</span></a></span><span> </span><span class="annot"><span class="annottext">(CheckExplanation -&gt; PackageCheck)
-&gt; CheckExplanation -&gt; PackageCheck
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-190"></span><span>            </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; CheckExplanation
</span><a href="Distribution.PackageDescription.Check.Warning.html#RecursiveGlobInRoot"><span class="hs-identifier hs-var">RecursiveGlobInRoot</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556601"><span class="hs-identifier hs-var">title</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556602"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-191"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>      </span><span class="annot"><span class="annottext">Maybe Glob -&gt; CheckM m (Maybe Glob)
forall a. a -&gt; CheckM m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Glob -&gt; Maybe Glob
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Glob
</span><a href="#local-6989586621679556608"><span class="hs-identifier hs-var">wglob</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span class="hs-comment">-- | Whether a path is a good relative path.  We aren't worried about perfect</span><span>
</span><span id="line-195"></span><span class="hs-comment">-- cross-platform compatibility here; this function just checks the paths in</span><span>
</span><span id="line-196"></span><span class="hs-comment">-- the (local) @.cabal@ file, while only Hackage needs the portability.</span><span>
</span><span id="line-197"></span><span class="hs-comment">--</span><span>
</span><span id="line-198"></span><span class="hs-comment">-- &gt;&gt;&gt; let test fp = putStrLn $ show (isGoodRelativeDirectoryPath fp) ++ &quot;; &quot; ++ show (isGoodRelativeFilePath fp)</span><span>
</span><span id="line-199"></span><span class="hs-comment">--</span><span>
</span><span id="line-200"></span><span class="hs-comment">-- Note that &quot;foo./bar.hs&quot; would be invalid on Windows.</span><span>
</span><span id="line-201"></span><span class="hs-comment">--</span><span>
</span><span id="line-202"></span><span class="hs-comment">-- &gt;&gt;&gt; traverse_ test [&quot;foo/bar/quu&quot;, &quot;a/b.hs&quot;, &quot;foo./bar.hs&quot;]</span><span>
</span><span id="line-203"></span><span class="hs-comment">-- Nothing; Nothing</span><span>
</span><span id="line-204"></span><span class="hs-comment">-- Nothing; Nothing</span><span>
</span><span id="line-205"></span><span class="hs-comment">-- Nothing; Nothing</span><span>
</span><span id="line-206"></span><span class="hs-comment">--</span><span>
</span><span id="line-207"></span><span class="hs-comment">-- Trailing slash is not allowed for files, for directories it is ok.</span><span>
</span><span id="line-208"></span><span class="hs-comment">--</span><span>
</span><span id="line-209"></span><span class="hs-comment">-- &gt;&gt;&gt; test &quot;foo/&quot;</span><span>
</span><span id="line-210"></span><span class="hs-comment">-- Nothing; Just &quot;trailing slash&quot;</span><span>
</span><span id="line-211"></span><span class="hs-comment">--</span><span>
</span><span id="line-212"></span><span class="hs-comment">-- Leading @./@ is fine, but @.@ and @./@ are not valid files.</span><span>
</span><span id="line-213"></span><span class="hs-comment">--</span><span>
</span><span id="line-214"></span><span class="hs-comment">-- &gt;&gt;&gt; traverse_ test [&quot;.&quot;, &quot;./&quot;, &quot;./foo/bar&quot;]</span><span>
</span><span id="line-215"></span><span class="hs-comment">-- Nothing; Just &quot;trailing dot segment&quot;</span><span>
</span><span id="line-216"></span><span class="hs-comment">-- Nothing; Just &quot;trailing slash&quot;</span><span>
</span><span id="line-217"></span><span class="hs-comment">-- Nothing; Nothing</span><span>
</span><span id="line-218"></span><span class="hs-comment">--</span><span>
</span><span id="line-219"></span><span class="hs-comment">-- Lastly, not good file nor directory cases:</span><span>
</span><span id="line-220"></span><span class="hs-comment">--</span><span>
</span><span id="line-221"></span><span class="hs-comment">-- &gt;&gt;&gt; traverse_ test [&quot;&quot;, &quot;/tmp/src&quot;, &quot;foo//bar&quot;, &quot;foo/.&quot;, &quot;foo/./bar&quot;, &quot;foo/../bar&quot;]</span><span>
</span><span id="line-222"></span><span class="hs-comment">-- Just &quot;empty path&quot;; Just &quot;empty path&quot;</span><span>
</span><span id="line-223"></span><span class="hs-comment">-- Just &quot;posix absolute path&quot;; Just &quot;posix absolute path&quot;</span><span>
</span><span id="line-224"></span><span class="hs-comment">-- Just &quot;empty path segment&quot;; Just &quot;empty path segment&quot;</span><span>
</span><span id="line-225"></span><span class="hs-comment">-- Just &quot;trailing same directory segment: .&quot;; Just &quot;trailing same directory segment: .&quot;</span><span>
</span><span id="line-226"></span><span class="hs-comment">-- Just &quot;same directory segment: .&quot;; Just &quot;same directory segment: .&quot;</span><span>
</span><span id="line-227"></span><span class="hs-comment">-- Just &quot;parent directory segment: ..&quot;; Just &quot;parent directory segment: ..&quot;</span><span>
</span><span id="line-228"></span><span class="hs-comment">--</span><span>
</span><span id="line-229"></span><span class="hs-comment">-- For the last case, 'isGoodRelativeGlob' doesn't warn:</span><span>
</span><span id="line-230"></span><span class="hs-comment">--</span><span>
</span><span id="line-231"></span><span class="hs-comment">-- &gt;&gt;&gt; traverse_ (print . isGoodRelativeGlob) [&quot;foo/../bar&quot;]</span><span>
</span><span id="line-232"></span><span class="hs-comment">-- Just &quot;parent directory segment: ..&quot;</span><span>
</span><span id="line-233"></span><span class="annot"><a href="Distribution.PackageDescription.Check.Paths.html#isGoodRelativeFilePath"><span class="hs-identifier hs-type">isGoodRelativeFilePath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-234"></span><span id="isGoodRelativeFilePath"><span class="annot"><span class="annottext">isGoodRelativeFilePath :: FilePath -&gt; Maybe FilePath
</span><a href="Distribution.PackageDescription.Check.Paths.html#isGoodRelativeFilePath"><span class="hs-identifier hs-var hs-var">isGoodRelativeFilePath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556611"><span class="hs-identifier hs-var">state0</span></a></span><span>
</span><span id="line-235"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-236"></span><span>    </span><span class="hs-comment">-- initial state</span><span>
</span><span id="line-237"></span><span>    </span><span id="local-6989586621679556611"><span class="annot"><span class="annottext">state0 :: FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556611"><span class="hs-identifier hs-var hs-var">state0</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;empty path&quot;</span></span><span>
</span><span id="line-238"></span><span>    </span><span class="annot"><a href="#local-6989586621679556611"><span class="hs-identifier hs-var">state0</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679556614"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556614"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679556615"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556615"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556614"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'.'</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556616"><span class="hs-identifier hs-var">state1</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556615"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-240"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556614"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'/'</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;posix absolute path&quot;</span></span><span>
</span><span id="line-241"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556617"><span class="hs-identifier hs-var">state5</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556615"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span>    </span><span class="hs-comment">-- after initial .</span><span>
</span><span id="line-244"></span><span>    </span><span id="local-6989586621679556616"><span class="annot"><span class="annottext">state1 :: FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556616"><span class="hs-identifier hs-var hs-var">state1</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;trailing dot segment&quot;</span></span><span>
</span><span id="line-245"></span><span>    </span><span class="annot"><a href="#local-6989586621679556616"><span class="hs-identifier hs-var">state1</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679556620"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556620"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679556621"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556621"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556620"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'.'</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556622"><span class="hs-identifier hs-var">state4</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556621"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-247"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556620"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'/'</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556623"><span class="hs-identifier hs-var">state2</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556621"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-248"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556617"><span class="hs-identifier hs-var">state5</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556621"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span>    </span><span class="hs-comment">-- after ./ or after / between segments</span><span>
</span><span id="line-251"></span><span>    </span><span id="local-6989586621679556623"><span class="annot"><span class="annottext">state2 :: FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556623"><span class="hs-identifier hs-var hs-var">state2</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;trailing slash&quot;</span></span><span>
</span><span id="line-252"></span><span>    </span><span class="annot"><a href="#local-6989586621679556623"><span class="hs-identifier hs-var">state2</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679556632"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556632"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679556633"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556633"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556632"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'.'</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556634"><span class="hs-identifier hs-var">state3</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556633"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-254"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556632"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'/'</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;empty path segment&quot;</span></span><span>
</span><span id="line-255"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556617"><span class="hs-identifier hs-var">state5</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556633"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span>    </span><span class="hs-comment">-- after non-first segment's .</span><span>
</span><span id="line-258"></span><span>    </span><span id="local-6989586621679556634"><span class="annot"><span class="annottext">state3 :: FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556634"><span class="hs-identifier hs-var hs-var">state3</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;trailing same directory segment: .&quot;</span></span><span>
</span><span id="line-259"></span><span>    </span><span class="annot"><a href="#local-6989586621679556634"><span class="hs-identifier hs-var">state3</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679556635"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556635"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679556636"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556636"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556635"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'.'</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556622"><span class="hs-identifier hs-var">state4</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556636"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-261"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556635"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'/'</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;same directory segment: .&quot;</span></span><span>
</span><span id="line-262"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556617"><span class="hs-identifier hs-var">state5</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556636"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span>    </span><span class="hs-comment">-- after ..</span><span>
</span><span id="line-265"></span><span>    </span><span id="local-6989586621679556622"><span class="annot"><span class="annottext">state4 :: FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556622"><span class="hs-identifier hs-var hs-var">state4</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;trailing parent directory segment: ..&quot;</span></span><span>
</span><span id="line-266"></span><span>    </span><span class="annot"><a href="#local-6989586621679556622"><span class="hs-identifier hs-var">state4</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679556637"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556637"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679556638"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556638"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-267"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556637"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'.'</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556617"><span class="hs-identifier hs-var">state5</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556638"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-268"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556637"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'/'</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;parent directory segment: ..&quot;</span></span><span>
</span><span id="line-269"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556617"><span class="hs-identifier hs-var">state5</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556638"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span>    </span><span class="hs-comment">-- in a segment which is ok.</span><span>
</span><span id="line-272"></span><span>    </span><span id="local-6989586621679556617"><span class="annot"><span class="annottext">state5 :: FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556617"><span class="hs-identifier hs-var hs-var">state5</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-273"></span><span>    </span><span class="annot"><a href="#local-6989586621679556617"><span class="hs-identifier hs-var">state5</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679556639"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556639"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679556640"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556640"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556639"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'.'</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556617"><span class="hs-identifier hs-var">state5</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556640"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-275"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556639"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'/'</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556623"><span class="hs-identifier hs-var">state2</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556640"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-276"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556617"><span class="hs-identifier hs-var">state5</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556640"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span class="hs-comment">-- | See 'isGoodRelativeFilePath'.</span><span>
</span><span id="line-279"></span><span class="hs-comment">--</span><span>
</span><span id="line-280"></span><span class="hs-comment">-- This is barebones function. We check whether the glob is a valid file</span><span>
</span><span id="line-281"></span><span class="hs-comment">-- by replacing stars @*@ with @x@ses.</span><span>
</span><span id="line-282"></span><span class="annot"><a href="Distribution.PackageDescription.Check.Paths.html#isGoodRelativeGlob"><span class="hs-identifier hs-type">isGoodRelativeGlob</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-283"></span><span id="isGoodRelativeGlob"><span class="annot"><span class="annottext">isGoodRelativeGlob :: FilePath -&gt; Maybe FilePath
</span><a href="Distribution.PackageDescription.Check.Paths.html#isGoodRelativeGlob"><span class="hs-identifier hs-var hs-var">isGoodRelativeGlob</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
</span><a href="Distribution.PackageDescription.Check.Paths.html#isGoodRelativeFilePath"><span class="hs-identifier hs-var">isGoodRelativeFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; Maybe FilePath)
-&gt; (FilePath -&gt; FilePath) -&gt; FilePath -&gt; Maybe FilePath
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Char) -&gt; FilePath -&gt; FilePath
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char
</span><a href="#local-6989586621679556641"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-284"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-285"></span><span>    </span><span id="local-6989586621679556641"><span class="annot"><span class="annottext">f :: Char -&gt; Char
</span><a href="#local-6989586621679556641"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'*'</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'x'</span></span><span>
</span><span id="line-286"></span><span>    </span><span class="annot"><a href="#local-6989586621679556641"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span id="local-6989586621679556642"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556642"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556642"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span class="annot"><span class="hs-comment">-- | See 'isGoodRelativeFilePath'.</span></span><span>
</span><span id="line-289"></span><span class="annot"><a href="Distribution.PackageDescription.Check.Paths.html#isGoodRelativeDirectoryPath"><span class="hs-identifier hs-type">isGoodRelativeDirectoryPath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-290"></span><span id="isGoodRelativeDirectoryPath"><span class="annot"><span class="annottext">isGoodRelativeDirectoryPath :: FilePath -&gt; Maybe FilePath
</span><a href="Distribution.PackageDescription.Check.Paths.html#isGoodRelativeDirectoryPath"><span class="hs-identifier hs-var hs-var">isGoodRelativeDirectoryPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556643"><span class="hs-identifier hs-var">state0</span></a></span><span>
</span><span id="line-291"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-292"></span><span>    </span><span class="hs-comment">-- initial state</span><span>
</span><span id="line-293"></span><span>    </span><span id="local-6989586621679556643"><span class="annot"><span class="annottext">state0 :: FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556643"><span class="hs-identifier hs-var hs-var">state0</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;empty path&quot;</span></span><span>
</span><span id="line-294"></span><span>    </span><span class="annot"><a href="#local-6989586621679556643"><span class="hs-identifier hs-var">state0</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679556646"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556646"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679556647"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556647"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556646"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'.'</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556648"><span class="hs-identifier hs-var">state5</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556647"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-296"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556646"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'/'</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;posix absolute path&quot;</span></span><span>
</span><span id="line-297"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556649"><span class="hs-identifier hs-var">state4</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556647"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span>    </span><span class="hs-comment">-- after initial ./ or after / between segments</span><span>
</span><span id="line-300"></span><span>    </span><span id="local-6989586621679556658"><span class="annot"><span class="annottext">state1 :: FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556658"><span class="hs-identifier hs-var hs-var">state1</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-301"></span><span>    </span><span class="annot"><a href="#local-6989586621679556658"><span class="hs-identifier hs-var">state1</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679556659"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556659"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679556660"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556660"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-302"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556659"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'.'</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556661"><span class="hs-identifier hs-var">state2</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556660"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-303"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556659"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'/'</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;empty path segment&quot;</span></span><span>
</span><span id="line-304"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556649"><span class="hs-identifier hs-var">state4</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556660"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span>    </span><span class="hs-comment">-- after non-first setgment's .</span><span>
</span><span id="line-307"></span><span>    </span><span id="local-6989586621679556661"><span class="annot"><span class="annottext">state2 :: FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556661"><span class="hs-identifier hs-var hs-var">state2</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;trailing same directory segment: .&quot;</span></span><span>
</span><span id="line-308"></span><span>    </span><span class="annot"><a href="#local-6989586621679556661"><span class="hs-identifier hs-var">state2</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679556662"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556662"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679556663"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556663"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556662"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'.'</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556664"><span class="hs-identifier hs-var">state3</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556663"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-310"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556662"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'/'</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;same directory segment: .&quot;</span></span><span>
</span><span id="line-311"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556649"><span class="hs-identifier hs-var">state4</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556663"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-312"></span><span>
</span><span id="line-313"></span><span>    </span><span class="hs-comment">-- after ..</span><span>
</span><span id="line-314"></span><span>    </span><span id="local-6989586621679556664"><span class="annot"><span class="annottext">state3 :: FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556664"><span class="hs-identifier hs-var hs-var">state3</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;trailing parent directory segment: ..&quot;</span></span><span>
</span><span id="line-315"></span><span>    </span><span class="annot"><a href="#local-6989586621679556664"><span class="hs-identifier hs-var">state3</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679556665"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556665"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679556666"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556666"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556665"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'.'</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556649"><span class="hs-identifier hs-var">state4</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556666"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-317"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556665"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'/'</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;parent directory segment: ..&quot;</span></span><span>
</span><span id="line-318"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556649"><span class="hs-identifier hs-var">state4</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556666"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-319"></span><span>
</span><span id="line-320"></span><span>    </span><span class="hs-comment">-- in a segment which is ok.</span><span>
</span><span id="line-321"></span><span>    </span><span id="local-6989586621679556649"><span class="annot"><span class="annottext">state4 :: FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556649"><span class="hs-identifier hs-var hs-var">state4</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-322"></span><span>    </span><span class="annot"><a href="#local-6989586621679556649"><span class="hs-identifier hs-var">state4</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679556667"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556667"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679556668"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556668"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556667"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'.'</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556649"><span class="hs-identifier hs-var">state4</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556668"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-324"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556667"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'/'</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556658"><span class="hs-identifier hs-var">state1</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556668"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-325"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556649"><span class="hs-identifier hs-var">state4</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556668"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span>    </span><span class="hs-comment">-- after initial .</span><span>
</span><span id="line-328"></span><span>    </span><span id="local-6989586621679556648"><span class="annot"><span class="annottext">state5 :: FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556648"><span class="hs-identifier hs-var hs-var">state5</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-comment">-- &quot;.&quot;</span><span>
</span><span id="line-329"></span><span>    </span><span class="annot"><a href="#local-6989586621679556648"><span class="hs-identifier hs-var">state5</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679556671"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556671"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679556672"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556672"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556671"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'.'</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556664"><span class="hs-identifier hs-var">state3</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556672"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-331"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679556671"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'/'</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556658"><span class="hs-identifier hs-var">state1</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556672"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-332"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
</span><a href="#local-6989586621679556649"><span class="hs-identifier hs-var">state4</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679556672"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-333"></span><span>
</span><span id="line-334"></span><span class="hs-comment">-- [Note: Good relative paths]</span><span>
</span><span id="line-335"></span><span class="hs-comment">--</span><span>
</span><span id="line-336"></span><span class="hs-comment">-- Using @kleene@ we can define an extended regex:</span><span>
</span><span id="line-337"></span><span class="hs-comment">--</span><span>
</span><span id="line-338"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-339"></span><span class="hs-comment">-- import Algebra.Lattice</span><span>
</span><span id="line-340"></span><span class="hs-comment">-- import Kleene</span><span>
</span><span id="line-341"></span><span class="hs-comment">-- import Kleene.ERE (ERE (..), intersections)</span><span>
</span><span id="line-342"></span><span class="hs-comment">--</span><span>
</span><span id="line-343"></span><span class="hs-comment">-- data C = CDot | CSlash | CChar</span><span>
</span><span id="line-344"></span><span class="hs-comment">--   deriving (Eq, Ord, Enum, Bounded, Show)</span><span>
</span><span id="line-345"></span><span class="hs-comment">--</span><span>
</span><span id="line-346"></span><span class="hs-comment">-- reservedR :: ERE C</span><span>
</span><span id="line-347"></span><span class="hs-comment">-- reservedR = notChar CSlash</span><span>
</span><span id="line-348"></span><span class="hs-comment">--</span><span>
</span><span id="line-349"></span><span class="hs-comment">-- pathPieceR :: ERE C</span><span>
</span><span id="line-350"></span><span class="hs-comment">-- pathPieceR = intersections</span><span>
</span><span id="line-351"></span><span class="hs-comment">--     [ plus reservedR</span><span>
</span><span id="line-352"></span><span class="hs-comment">--     , ERENot (string [CDot])</span><span>
</span><span id="line-353"></span><span class="hs-comment">--     , ERENot (string [CDot,CDot])</span><span>
</span><span id="line-354"></span><span class="hs-comment">--     ]</span><span>
</span><span id="line-355"></span><span class="hs-comment">--</span><span>
</span><span id="line-356"></span><span class="hs-comment">-- filePathR :: ERE C</span><span>
</span><span id="line-357"></span><span class="hs-comment">-- filePathR = optional (string [CDot, CSlash]) &lt;&gt; pathPieceR &lt;&gt; star (char CSlash &lt;&gt; pathPieceR)</span><span>
</span><span id="line-358"></span><span class="hs-comment">--</span><span>
</span><span id="line-359"></span><span class="hs-comment">-- dirPathR :: ERE C</span><span>
</span><span id="line-360"></span><span class="hs-comment">-- dirPathR = (char CDot \/ filePathR) &lt;&gt; optional (char CSlash)</span><span>
</span><span id="line-361"></span><span class="hs-comment">--</span><span>
</span><span id="line-362"></span><span class="hs-comment">-- plus :: ERE C -&gt; ERE C</span><span>
</span><span id="line-363"></span><span class="hs-comment">-- plus r = r &lt;&gt; star r</span><span>
</span><span id="line-364"></span><span class="hs-comment">--</span><span>
</span><span id="line-365"></span><span class="hs-comment">-- optional :: ERE C -&gt; ERE C</span><span>
</span><span id="line-366"></span><span class="hs-comment">-- optional r = mempty \/ r</span><span>
</span><span id="line-367"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-368"></span><span class="hs-comment">--</span><span>
</span><span id="line-369"></span><span class="hs-comment">-- Results in following state machine for @filePathR@</span><span>
</span><span id="line-370"></span><span class="hs-comment">--</span><span>
</span><span id="line-371"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-372"></span><span class="hs-comment">-- 0 -&gt; \x -&gt; if</span><span>
</span><span id="line-373"></span><span class="hs-comment">--     | x &lt;= CDot           -&gt; 1</span><span>
</span><span id="line-374"></span><span class="hs-comment">--     | otherwise           -&gt; 5</span><span>
</span><span id="line-375"></span><span class="hs-comment">-- 1 -&gt; \x -&gt; if</span><span>
</span><span id="line-376"></span><span class="hs-comment">--     | x &lt;= CDot           -&gt; 4</span><span>
</span><span id="line-377"></span><span class="hs-comment">--     | x &lt;= CSlash         -&gt; 2</span><span>
</span><span id="line-378"></span><span class="hs-comment">--     | otherwise           -&gt; 5</span><span>
</span><span id="line-379"></span><span class="hs-comment">-- 2 -&gt; \x -&gt; if</span><span>
</span><span id="line-380"></span><span class="hs-comment">--     | x &lt;= CDot           -&gt; 3</span><span>
</span><span id="line-381"></span><span class="hs-comment">--     | otherwise           -&gt; 5</span><span>
</span><span id="line-382"></span><span class="hs-comment">-- 3 -&gt; \x -&gt; if</span><span>
</span><span id="line-383"></span><span class="hs-comment">--     | x &lt;= CDot           -&gt; 4</span><span>
</span><span id="line-384"></span><span class="hs-comment">--     | otherwise           -&gt; 5</span><span>
</span><span id="line-385"></span><span class="hs-comment">-- 4 -&gt; \x -&gt; if</span><span>
</span><span id="line-386"></span><span class="hs-comment">--     | x &lt;= CDot           -&gt; 5</span><span>
</span><span id="line-387"></span><span class="hs-comment">--     | otherwise           -&gt; 5</span><span>
</span><span id="line-388"></span><span class="hs-comment">-- 5+ -&gt; \x -&gt; if</span><span>
</span><span id="line-389"></span><span class="hs-comment">--     | x &lt;= CDot           -&gt; 5</span><span>
</span><span id="line-390"></span><span class="hs-comment">--     | x &lt;= CSlash         -&gt; 2</span><span>
</span><span id="line-391"></span><span class="hs-comment">--     | otherwise           -&gt; 5</span><span>
</span><span id="line-392"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-393"></span><span class="hs-comment">--</span><span>
</span><span id="line-394"></span><span class="hs-comment">-- and @dirPathR@:</span><span>
</span><span id="line-395"></span><span class="hs-comment">--</span><span>
</span><span id="line-396"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-397"></span><span class="hs-comment">-- 0 -&gt; \x -&gt; if</span><span>
</span><span id="line-398"></span><span class="hs-comment">--     | x &lt;= CDot           -&gt; 5</span><span>
</span><span id="line-399"></span><span class="hs-comment">--     | otherwise           -&gt; 4</span><span>
</span><span id="line-400"></span><span class="hs-comment">-- 1+ -&gt; \x -&gt; if</span><span>
</span><span id="line-401"></span><span class="hs-comment">--     | x &lt;= CDot           -&gt; 2</span><span>
</span><span id="line-402"></span><span class="hs-comment">--     | otherwise           -&gt; 4</span><span>
</span><span id="line-403"></span><span class="hs-comment">-- 2 -&gt; \x -&gt; if</span><span>
</span><span id="line-404"></span><span class="hs-comment">--     | x &lt;= CDot           -&gt; 3</span><span>
</span><span id="line-405"></span><span class="hs-comment">--     | otherwise           -&gt; 4</span><span>
</span><span id="line-406"></span><span class="hs-comment">-- 3 -&gt; \x -&gt; if</span><span>
</span><span id="line-407"></span><span class="hs-comment">--     | x &lt;= CDot           -&gt; 4</span><span>
</span><span id="line-408"></span><span class="hs-comment">--     | otherwise           -&gt; 4</span><span>
</span><span id="line-409"></span><span class="hs-comment">-- 4+ -&gt; \x -&gt; if</span><span>
</span><span id="line-410"></span><span class="hs-comment">--     | x &lt;= CDot           -&gt; 4</span><span>
</span><span id="line-411"></span><span class="hs-comment">--     | x &lt;= CSlash         -&gt; 1</span><span>
</span><span id="line-412"></span><span class="hs-comment">--     | otherwise           -&gt; 4</span><span>
</span><span id="line-413"></span><span class="hs-comment">-- 5+ -&gt; \x -&gt; if</span><span>
</span><span id="line-414"></span><span class="hs-comment">--     | x &lt;= CDot           -&gt; 3</span><span>
</span><span id="line-415"></span><span class="hs-comment">--     | x &lt;= CSlash         -&gt; 1</span><span>
</span><span id="line-416"></span><span class="hs-comment">--     | otherwise           -&gt; 4</span><span>
</span><span id="line-417"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-418"></span></pre></body></html>