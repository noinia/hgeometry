<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# language GADTs, LambdaCase #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html"><span class="hs-identifier">GHC.CmmToAsm.AArch64.CodeGen</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-4"></span><span>      </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#cmmTopCodeGen"><span class="hs-identifier">cmmTopCodeGen</span></a></span><span>
</span><span id="line-5"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#generateJumpTableForInstr"><span class="hs-identifier">generateJumpTableForInstr</span></a></span><span>
</span><span id="line-6"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#makeFarBranches"><span class="hs-identifier">makeFarBranches</span></a></span><span>
</span><span id="line-7"></span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">where</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-comment">-- NCG stuff:</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">EQ</span></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Word.html"><span class="hs-identifier">Data.Word</span></a></span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.Regs.html"><span class="hs-identifier">GHC.Platform.Regs</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html"><span class="hs-identifier">GHC.CmmToAsm.AArch64.Instr</span></a></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Regs.html"><span class="hs-identifier">GHC.CmmToAsm.AArch64.Regs</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Cond.html"><span class="hs-identifier">GHC.CmmToAsm.AArch64.Cond</span></a></span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.CPrim.html"><span class="hs-identifier">GHC.CmmToAsm.CPrim</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.DebugBlock.html"><span class="hs-identifier">GHC.Cmm.DebugBlock</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html"><span class="hs-identifier">GHC.CmmToAsm.Monad</span></a></span><span>
</span><span id="line-24"></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NatM"><span class="hs-identifier">NatM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#getNewRegNat"><span class="hs-identifier">getNewRegNat</span></a></span><span>
</span><span id="line-25"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#getPicBaseMaybeNat"><span class="hs-identifier">getPicBaseMaybeNat</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#getPlatform"><span class="hs-identifier">getPlatform</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#getConfig"><span class="hs-identifier">getConfig</span></a></span><span>
</span><span id="line-26"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#getDebugBlock"><span class="hs-identifier">getDebugBlock</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#getFileId"><span class="hs-identifier">getFileId</span></a></span><span>
</span><span id="line-27"></span><span>   </span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-comment">-- import GHC.CmmToAsm.Instr</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.PIC.html"><span class="hs-identifier">GHC.CmmToAsm.PIC</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Format.html"><span class="hs-identifier">GHC.CmmToAsm.Format</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Config.html"><span class="hs-identifier">GHC.CmmToAsm.Config</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Types.html"><span class="hs-identifier">GHC.CmmToAsm.Types</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.Reg.html"><span class="hs-identifier">GHC.Platform.Reg</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.html"><span class="hs-identifier">GHC.Platform</span></a></span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-comment">-- Our intermediate code:</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.BlockId.html"><span class="hs-identifier">GHC.Cmm.BlockId</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.html"><span class="hs-identifier">GHC.Cmm</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Utils.html"><span class="hs-identifier">GHC.Cmm.Utils</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Switch.html"><span class="hs-identifier">GHC.Cmm.Switch</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html"><span class="hs-identifier">GHC.Cmm.CLabel</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html"><span class="hs-identifier">GHC.Cmm.Dataflow.Block</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html"><span class="hs-identifier">GHC.Cmm.Dataflow.Label</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Graph.html"><span class="hs-identifier">GHC.Cmm.Dataflow.Graph</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Tickish.html"><span class="hs-identifier">GHC.Types.Tickish</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Tickish.html#GenTickish"><span class="hs-identifier">GenTickish</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#srcSpanFile"><span class="hs-identifier">srcSpanFile</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#srcSpanStartLine"><span class="hs-identifier">srcSpanStartLine</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#srcSpanStartCol"><span class="hs-identifier">srcSpanStartCol</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSM.html"><span class="hs-identifier">GHC.Types.Unique.DSM</span></a></span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-comment">-- The rest:</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html"><span class="hs-identifier">GHC.Data.OrdList</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">mapAndUnzipM</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">foldM</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/GHC.Float.html"><span class="hs-identifier">GHC.Float</span></a></span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.ForeignCall.html"><span class="hs-identifier">GHC.Types.ForeignCall</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Constants.html"><span class="hs-identifier">GHC.Utils.Constants</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Constants.html#debugIsOn"><span class="hs-identifier">debugIsOn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html"><span class="hs-identifier">GHC.Utils.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Monad.html#mapAccumLM"><span class="hs-identifier">mapAccumLM</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-comment">-- Note [General layout of an NCG]</span><span>
</span><span id="line-65"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-66"></span><span class="hs-comment">-- @cmmTopCodeGen@ will be our main entry point to code gen.  Here we'll get</span><span>
</span><span id="line-67"></span><span class="hs-comment">-- @RawCmmDecl@; see GHC.Cmm</span><span>
</span><span id="line-68"></span><span class="hs-comment">--</span><span>
</span><span id="line-69"></span><span class="hs-comment">--   RawCmmDecl = GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph</span><span>
</span><span id="line-70"></span><span class="hs-comment">--</span><span>
</span><span id="line-71"></span><span class="hs-comment">--   GenCmmDecl d h g = CmmProc h CLabel [GlobalReg] g</span><span>
</span><span id="line-72"></span><span class="hs-comment">--                    | CmmData Section d</span><span>
</span><span id="line-73"></span><span class="hs-comment">--</span><span>
</span><span id="line-74"></span><span class="hs-comment">-- As a result we want to transform this to a list of @NatCmmDecl@, which is</span><span>
</span><span id="line-75"></span><span class="hs-comment">-- defined @GHC.CmmToAsm.Instr@ as</span><span>
</span><span id="line-76"></span><span class="hs-comment">--</span><span>
</span><span id="line-77"></span><span class="hs-comment">--   type NatCmmDecl statics instr</span><span>
</span><span id="line-78"></span><span class="hs-comment">--        = GenCmmDecl statics (LabelMap RawCmmStatics) (ListGraph instr)</span><span>
</span><span id="line-79"></span><span class="hs-comment">--</span><span>
</span><span id="line-80"></span><span class="hs-comment">-- Thus well' turn</span><span>
</span><span id="line-81"></span><span class="hs-comment">--   GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) CmmGraph</span><span>
</span><span id="line-82"></span><span class="hs-comment">-- into</span><span>
</span><span id="line-83"></span><span class="hs-comment">--   [GenCmmDecl RawCmmStatics (LabelMap RawCmmStatics) (ListGraph Instr)]</span><span>
</span><span id="line-84"></span><span class="hs-comment">--</span><span>
</span><span id="line-85"></span><span class="hs-comment">-- where @CmmGraph@ is</span><span>
</span><span id="line-86"></span><span class="hs-comment">--</span><span>
</span><span id="line-87"></span><span class="hs-comment">--   type CmmGraph = GenCmmGraph CmmNode</span><span>
</span><span id="line-88"></span><span class="hs-comment">--   data GenCmmGraph n = CmmGraph { g_entry :: BlockId, g_graph :: Graph n C C }</span><span>
</span><span id="line-89"></span><span class="hs-comment">--   type CmmBlock = Block CmmNode C C</span><span>
</span><span id="line-90"></span><span class="hs-comment">--</span><span>
</span><span id="line-91"></span><span class="hs-comment">-- and @ListGraph Instr@ is</span><span>
</span><span id="line-92"></span><span class="hs-comment">--</span><span>
</span><span id="line-93"></span><span class="hs-comment">--   newtype ListGraph i = ListGraph [GenBasicBlock i]</span><span>
</span><span id="line-94"></span><span class="hs-comment">--   data GenBasicBlock i = BasicBlock BlockId [i]</span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#cmmTopCodeGen"><span class="hs-identifier hs-type">cmmTopCodeGen</span></a></span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.html#RawCmmDecl"><span class="hs-identifier hs-type">RawCmmDecl</span></a></span><span>
</span><span id="line-98"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.CmmToAsm.Types.html#NatCmmDecl"><span class="hs-identifier hs-type">NatCmmDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#RawCmmStatics"><span class="hs-identifier hs-type">RawCmmStatics</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="hs-comment">-- Thus we'll have to deal with either CmmProc ...</span><span>
</span><span id="line-101"></span><span id="cmmTopCodeGen"><span class="annot"><span class="annottext">cmmTopCodeGen :: RawCmmDecl -&gt; NatM [NatCmmDecl RawCmmStatics Instr]
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#cmmTopCodeGen"><span class="hs-identifier hs-var hs-var">cmmTopCodeGen</span></a></span></span><span> </span><span id="local-6989586621682870295"><span class="annot"><span class="annottext">_cmm :: RawCmmDecl
</span><a href="#local-6989586621682870295"><span class="hs-identifier hs-var">_cmm</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmProc"><span class="hs-identifier hs-type">CmmProc</span></a></span><span> </span><span id="local-6989586621682870297"><span class="annot"><span class="annottext">LabelMap RawCmmStatics
</span><a href="#local-6989586621682870297"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621682870298"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682870298"><span class="hs-identifier hs-var">lab</span></a></span></span><span> </span><span id="local-6989586621682870299"><span class="annot"><span class="annottext">[GlobalRegUse]
</span><a href="#local-6989586621682870299"><span class="hs-identifier hs-var">live</span></a></span></span><span> </span><span id="local-6989586621682870300"><span class="annot"><span class="annottext">CmmGraph
</span><a href="#local-6989586621682870300"><span class="hs-identifier hs-var">graph</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-102"></span><span>  </span><span class="hs-comment">-- do</span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-comment">--   traceM $ &quot;-- -------------------------- cmmTopGen (CmmProc) -------------------------- --\n&quot;</span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-comment">--         ++ showSDocUnsafe (ppr cmm)</span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682870301"><span class="annot"><span class="annottext">blocks :: [Block CmmNode C C]
</span><a href="#local-6989586621682870301"><span class="hs-identifier hs-var hs-var hs-var">blocks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmGraph -&gt; [Block CmmNode C C]
</span><a href="GHC.Cmm.Utils.html#toBlockListEntryFirst"><span class="hs-identifier hs-var">toBlockListEntryFirst</span></a></span><span> </span><span class="annot"><span class="annottext">CmmGraph
</span><a href="#local-6989586621682870300"><span class="hs-identifier hs-var">graph</span></a></span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682870303"><span class="annot"><a href="#local-6989586621682870303"><span class="hs-identifier hs-var">nat_blocks</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682870304"><span class="annot"><a href="#local-6989586621682870304"><span class="hs-identifier hs-var">statics</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Block CmmNode C C
 -&gt; NatM ([NatBasicBlock Instr], [NatCmmDecl RawCmmStatics Instr]))
-&gt; [Block CmmNode C C]
-&gt; NatM
     ([[NatBasicBlock Instr]], [[NatCmmDecl RawCmmStatics Instr]])
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; m (b, c)) -&gt; [a] -&gt; m ([b], [c])
</span><span class="hs-identifier hs-var">mapAndUnzipM</span></span><span> </span><span class="annot"><span class="annottext">Block CmmNode C C
-&gt; NatM ([NatBasicBlock Instr], [NatCmmDecl RawCmmStatics Instr])
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#basicBlockCodeGen"><span class="hs-identifier hs-var">basicBlockCodeGen</span></a></span><span> </span><span class="annot"><span class="annottext">[Block CmmNode C C]
</span><a href="#local-6989586621682870301"><span class="hs-identifier hs-var">blocks</span></a></span><span>
</span><span id="line-108"></span><span>  </span><span id="local-6989586621682870306"><span class="annot"><a href="#local-6989586621682870306"><span class="hs-identifier hs-var">picBaseMb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#getPicBaseMaybeNat"><span class="hs-identifier hs-type">getPicBaseMaybeNat</span></a></span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682870307"><span class="annot"><a href="#local-6989586621682870307"><span class="hs-identifier hs-var hs-var">proc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LabelMap RawCmmStatics
-&gt; CLabel
-&gt; [GlobalRegUse]
-&gt; ListGraph Instr
-&gt; NatCmmDecl RawCmmStatics Instr
forall d h g.
h -&gt; CLabel -&gt; [GlobalRegUse] -&gt; g -&gt; GenCmmDecl d h g
</span><a href="GHC.Cmm.html#CmmProc"><span class="hs-identifier hs-var">CmmProc</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap RawCmmStatics
</span><a href="#local-6989586621682870297"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682870298"><span class="hs-identifier hs-var">lab</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRegUse]
</span><a href="#local-6989586621682870299"><span class="hs-identifier hs-var">live</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[NatBasicBlock Instr] -&gt; ListGraph Instr
forall i. [GenBasicBlock i] -&gt; ListGraph i
</span><a href="GHC.Cmm.html#ListGraph"><span class="hs-identifier hs-var">ListGraph</span></a></span><span> </span><span class="annot"><span class="annottext">([NatBasicBlock Instr] -&gt; ListGraph Instr)
-&gt; [NatBasicBlock Instr] -&gt; ListGraph Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[NatBasicBlock Instr]] -&gt; [NatBasicBlock Instr]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">[[NatBasicBlock Instr]]
</span><a href="#local-6989586621682870303"><span class="hs-identifier hs-var">nat_blocks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span>      </span><span id="local-6989586621682870310"><span class="annot"><a href="#local-6989586621682870310"><span class="hs-identifier hs-var hs-var">tops</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NatCmmDecl RawCmmStatics Instr
</span><a href="#local-6989586621682870307"><span class="hs-identifier hs-var">proc</span></a></span><span> </span><span class="annot"><span class="annottext">NatCmmDecl RawCmmStatics Instr
-&gt; [NatCmmDecl RawCmmStatics Instr]
-&gt; [NatCmmDecl RawCmmStatics Instr]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[[NatCmmDecl RawCmmStatics Instr]]
-&gt; [NatCmmDecl RawCmmStatics Instr]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">[[NatCmmDecl RawCmmStatics Instr]]
</span><a href="#local-6989586621682870304"><span class="hs-identifier hs-var">statics</span></a></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682870306"><span class="hs-identifier hs-type">picBaseMb</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-114"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682870311"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870311"><span class="hs-identifier hs-var">_picBase</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; NatM [NatCmmDecl RawCmmStatics Instr]
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;AArch64.cmmTopCodeGen: picBase not implemented&quot;</span></span><span>
</span><span id="line-115"></span><span>      </span><span class="annot"><span class="annottext">Maybe Reg
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[NatCmmDecl RawCmmStatics Instr]
-&gt; NatM [NatCmmDecl RawCmmStatics Instr]
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">[NatCmmDecl RawCmmStatics Instr]
</span><a href="#local-6989586621682870310"><span class="hs-identifier hs-var">tops</span></a></span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span class="hs-comment">-- ... or CmmData.</span><span>
</span><span id="line-118"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#cmmTopCodeGen"><span class="hs-identifier hs-var">cmmTopCodeGen</span></a></span><span> </span><span id="local-6989586621682870313"><span class="annot"><span class="annottext">_cmm :: RawCmmDecl
</span><a href="#local-6989586621682870313"><span class="hs-identifier hs-var">_cmm</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmData"><span class="hs-identifier hs-type">CmmData</span></a></span><span> </span><span id="local-6989586621682870315"><span class="annot"><span class="annottext">Section
</span><a href="#local-6989586621682870315"><span class="hs-identifier hs-var">sec</span></a></span></span><span> </span><span id="local-6989586621682870316"><span class="annot"><span class="annottext">RawCmmStatics
</span><a href="#local-6989586621682870316"><span class="hs-identifier hs-var">dat</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-comment">-- do</span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-comment">--   traceM $ &quot;-- -------------------------- cmmTopGen (CmmData) -------------------------- --\n&quot;</span><span>
</span><span id="line-121"></span><span>  </span><span class="hs-comment">--         ++ showSDocUnsafe (ppr cmm)</span><span>
</span><span id="line-122"></span><span>  </span><span class="annot"><span class="annottext">[NatCmmDecl RawCmmStatics Instr]
-&gt; NatM [NatCmmDecl RawCmmStatics Instr]
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Section -&gt; RawCmmStatics -&gt; NatCmmDecl RawCmmStatics Instr
forall d h g. Section -&gt; d -&gt; GenCmmDecl d h g
</span><a href="GHC.Cmm.html#CmmData"><span class="hs-identifier hs-var">CmmData</span></a></span><span> </span><span class="annot"><span class="annottext">Section
</span><a href="#local-6989586621682870315"><span class="hs-identifier hs-var">sec</span></a></span><span> </span><span class="annot"><span class="annottext">RawCmmStatics
</span><a href="#local-6989586621682870316"><span class="hs-identifier hs-var">dat</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- no translation, we just use CmmStatic</span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#basicBlockCodeGen"><span class="hs-identifier hs-type">basicBlockCodeGen</span></a></span><span>
</span><span id="line-125"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#C"><span class="hs-identifier hs-type">C</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#C"><span class="hs-identifier hs-type">C</span></a></span><span>
</span><span id="line-126"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.CmmToAsm.Types.html#NatBasicBlock"><span class="hs-identifier hs-type">NatBasicBlock</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-127"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.CmmToAsm.Types.html#NatCmmDecl"><span class="hs-identifier hs-type">NatCmmDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#RawCmmStatics"><span class="hs-identifier hs-type">RawCmmStatics</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span id="basicBlockCodeGen"><span class="annot"><span class="annottext">basicBlockCodeGen :: Block CmmNode C C
-&gt; NatM ([NatBasicBlock Instr], [NatCmmDecl RawCmmStatics Instr])
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#basicBlockCodeGen"><span class="hs-identifier hs-var hs-var">basicBlockCodeGen</span></a></span></span><span> </span><span id="local-6989586621682870317"><span class="annot"><span class="annottext">Block CmmNode C C
</span><a href="#local-6989586621682870317"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-130"></span><span>  </span><span id="local-6989586621682870318"><span class="annot"><a href="#local-6989586621682870318"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NatM NCGConfig
</span><a href="GHC.CmmToAsm.Monad.html#getConfig"><span class="hs-identifier hs-var">getConfig</span></a></span><span>
</span><span id="line-131"></span><span>  </span><span class="hs-comment">-- do</span><span>
</span><span id="line-132"></span><span>  </span><span class="hs-comment">--   traceM $ &quot;-- --------------------------- basicBlockCodeGen --------------------------- --\n&quot;</span><span>
</span><span id="line-133"></span><span>  </span><span class="hs-comment">--         ++ showSDocUnsafe (ppr block)</span><span>
</span><span id="line-134"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870319"><span class="annot"><a href="#local-6989586621682870319"><span class="hs-identifier hs-var">nodes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870320"><span class="annot"><a href="#local-6989586621682870320"><span class="hs-identifier hs-var">tail</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#blockSplit"><span class="hs-identifier hs-type">blockSplit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870317"><span class="hs-identifier hs-type">block</span></a></span><span>
</span><span id="line-135"></span><span>      </span><span id="local-6989586621682870322"><span class="annot"><a href="#local-6989586621682870322"><span class="hs-identifier hs-var hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Block CmmNode C C -&gt; BlockId
forall (x :: Extensibility). Block CmmNode C x -&gt; BlockId
forall (thing :: Extensibility -&gt; Extensibility -&gt; *)
       (x :: Extensibility).
NonLocal thing =&gt;
thing C x -&gt; BlockId
</span><a href="GHC.Cmm.Dataflow.Graph.html#entryLabel"><span class="hs-identifier hs-var">entryLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Block CmmNode C C
</span><a href="#local-6989586621682870317"><span class="hs-identifier hs-var">block</span></a></span><span>
</span><span id="line-136"></span><span>      </span><span id="local-6989586621682870324"><span class="annot"><a href="#local-6989586621682870324"><span class="hs-identifier hs-var hs-var">stmts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Block CmmNode O O -&gt; [CmmNode O O]
forall (n :: Extensibility -&gt; Extensibility -&gt; *).
Block n O O -&gt; [n O O]
</span><a href="GHC.Cmm.Dataflow.Block.html#blockToList"><span class="hs-identifier hs-var">blockToList</span></a></span><span> </span><span class="annot"><span class="annottext">Block CmmNode O O
</span><a href="#local-6989586621682870319"><span class="hs-identifier hs-var">nodes</span></a></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span>      </span><span id="local-6989586621682870326"><span class="annot"><a href="#local-6989586621682870326"><span class="hs-identifier hs-var hs-var">header_comment_instr</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Utils.Constants.html#debugIsOn"><span class="hs-identifier hs-var">debugIsOn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; OrdList Instr) -&gt; Instr -&gt; OrdList Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#MULTILINE_COMMENT"><span class="hs-identifier hs-var">MULTILINE_COMMENT</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-139"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-- --------------------------- basicBlockCodeGen --------------------------- --\n&quot;</span></span><span>
</span><span id="line-140"></span><span>          </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%2B%24"><span class="hs-operator hs-var">$+$</span></a></span><span> </span><span class="annot"><span class="annottext">PprStyle -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#withPprStyle"><span class="hs-identifier hs-var">withPprStyle</span></a></span><span> </span><span class="annot"><span class="annottext">PprStyle
</span><a href="GHC.Utils.Outputable.html#defaultDumpStyle"><span class="hs-identifier hs-var">defaultDumpStyle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; Block CmmNode C C -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NCGConfig -&gt; Platform
</span><a href="GHC.CmmToAsm.Config.html#ncgPlatform"><span class="hs-identifier hs-var">ncgPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682870318"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Block CmmNode C C
</span><a href="#local-6989586621682870317"><span class="hs-identifier hs-var">block</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>                           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
forall a. OrdList a
</span><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-var">nilOL</span></a></span><span>
</span><span id="line-143"></span><span>  </span><span class="hs-comment">-- Generate location directive</span><span>
</span><span id="line-144"></span><span>  </span><span id="local-6989586621682870336"><span class="annot"><a href="#local-6989586621682870336"><span class="hs-identifier hs-var">dbg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#getDebugBlock"><span class="hs-identifier hs-type">getDebugBlock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.Graph.html#entryLabel"><span class="hs-identifier hs-type">entryLabel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870317"><span class="hs-identifier hs-type">block</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>  </span><span id="local-6989586621682870337"><span class="annot"><a href="#local-6989586621682870337"><span class="hs-identifier hs-var">loc_instrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Cmm.DebugBlock.html#dblSourceTick"><span class="hs-identifier hs-var">dblSourceTick</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682870336"><span class="hs-identifier hs-type">dbg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-146"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Tickish.html#SourceNote"><span class="hs-identifier hs-type">SourceNote</span></a></span><span> </span><span id="local-6989586621682870341"><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621682870341"><span class="hs-identifier hs-var">span</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#LexicalFastString"><span class="hs-identifier hs-type">LexicalFastString</span></a></span><span> </span><span id="local-6989586621682870343"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682870343"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621682870344"><span class="annot"><a href="#local-6989586621682870344"><span class="hs-identifier hs-var">fileId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM Int
</span><a href="GHC.CmmToAsm.Monad.html#getFileId"><span class="hs-identifier hs-var">getFileId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RealSrcSpan -&gt; FastString
</span><a href="GHC.Types.SrcLoc.html#srcSpanFile"><span class="hs-identifier hs-var">srcSpanFile</span></a></span><span> </span><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621682870341"><span class="hs-identifier hs-var">span</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682870345"><span class="annot"><a href="#local-6989586621682870345"><span class="hs-identifier hs-var hs-var">line</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RealSrcSpan -&gt; Int
</span><a href="GHC.Types.SrcLoc.html#srcSpanStartLine"><span class="hs-identifier hs-var">srcSpanStartLine</span></a></span><span> </span><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621682870341"><span class="hs-identifier hs-var">span</span></a></span><span class="hs-special">;</span><span> </span><span id="local-6989586621682870346"><span class="annot"><a href="#local-6989586621682870346"><span class="hs-identifier hs-var hs-var">col</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RealSrcSpan -&gt; Int
</span><a href="GHC.Types.SrcLoc.html#srcSpanStartCol"><span class="hs-identifier hs-var">srcSpanStartCol</span></a></span><span> </span><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621682870341"><span class="hs-identifier hs-var">span</span></a></span><span>
</span><span id="line-149"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-type">unitOL</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#LOCATION"><span class="hs-identifier hs-type">LOCATION</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870344"><span class="hs-identifier hs-type">fileId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870345"><span class="hs-identifier hs-type">line</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870346"><span class="hs-identifier hs-type">col</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#unpackFS"><span class="hs-identifier hs-type">unpackFS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870343"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>    </span><span class="annot"><span class="annottext">Maybe CmmTickish
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; NatM (OrdList Instr)
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">OrdList Instr
forall a. OrdList a
</span><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-var">nilOL</span></a></span><span>
</span><span id="line-151"></span><span>  </span><span id="local-6989586621682870349"><span class="annot"><a href="#local-6989586621682870349"><span class="hs-identifier hs-var">mid_instrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#stmtsToInstrs"><span class="hs-identifier hs-type">stmtsToInstrs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870324"><span class="hs-identifier hs-type">stmts</span></a></span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621682870351"><span class="annot"><a href="#local-6989586621682870351"><span class="hs-identifier hs-var">tail_instrs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#stmtToInstrs"><span class="hs-identifier hs-type">stmtToInstrs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870320"><span class="hs-identifier hs-type">tail</span></a></span><span>
</span><span id="line-153"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682870353"><span class="annot"><a href="#local-6989586621682870353"><span class="hs-identifier hs-var hs-var">instrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870326"><span class="hs-identifier hs-var">header_comment_instr</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870337"><span class="hs-identifier hs-var">loc_instrs</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870349"><span class="hs-identifier hs-var">mid_instrs</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870351"><span class="hs-identifier hs-var">tail_instrs</span></a></span><span>
</span><span id="line-154"></span><span>  </span><span class="hs-comment">-- TODO: Then x86 backend run @verifyBasicBlock@ here and inserts</span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-comment">--      unwinding info. See Ticket 19913</span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-comment">-- code generation may introduce new basic block boundaries, which</span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-comment">-- are indicated by the NEWBLOCK instruction.  We must split up the</span><span>
</span><span id="line-158"></span><span>  </span><span class="hs-comment">-- instruction stream into basic blocks again. Also, we may extract</span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-comment">-- LDATAs here too (if they are implemented by AArch64 again - See</span><span>
</span><span id="line-160"></span><span>  </span><span class="hs-comment">-- PPC how to do that.)</span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-162"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682870355"><span class="annot"><a href="#local-6989586621682870355"><span class="hs-identifier hs-var">top</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682870356"><span class="annot"><a href="#local-6989586621682870356"><span class="hs-identifier hs-var">other_blocks</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682870357"><span class="annot"><a href="#local-6989586621682870357"><span class="hs-identifier hs-var">statics</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#foldrOL"><span class="hs-identifier hs-type">foldrOL</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#mkBlocks"><span class="hs-identifier hs-type">mkBlocks</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682870353"><span class="hs-identifier hs-type">instrs</span></a></span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#BasicBlock"><span class="hs-identifier hs-type">BasicBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870322"><span class="hs-identifier hs-type">id</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870355"><span class="hs-identifier hs-type">top</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621682870356"><span class="hs-identifier hs-type">other_blocks</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682870357"><span class="hs-identifier hs-type">statics</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span id="local-6989586621682869171"><span id="local-6989586621682869172"><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#mkBlocks"><span class="hs-identifier hs-type">mkBlocks</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a></span><span>
</span><span id="line-167"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.html#GenBasicBlock"><span class="hs-identifier hs-type">GenBasicBlock</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.html#GenCmmDecl"><span class="hs-identifier hs-type">GenCmmDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#RawCmmStatics"><span class="hs-identifier hs-type">RawCmmStatics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682869171"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682869172"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.html#GenBasicBlock"><span class="hs-identifier hs-type">GenBasicBlock</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.html#GenCmmDecl"><span class="hs-identifier hs-type">GenCmmDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#RawCmmStatics"><span class="hs-identifier hs-type">RawCmmStatics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682869171"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682869172"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-169"></span><span id="mkBlocks"><span class="annot"><span class="annottext">mkBlocks :: forall h g.
Instr
-&gt; ([Instr], [NatBasicBlock Instr], [GenCmmDecl RawCmmStatics h g])
-&gt; ([Instr], [NatBasicBlock Instr], [GenCmmDecl RawCmmStatics h g])
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#mkBlocks"><span class="hs-identifier hs-var hs-var">mkBlocks</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#NEWBLOCK"><span class="hs-identifier hs-type">NEWBLOCK</span></a></span><span> </span><span id="local-6989586621682870362"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682870362"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682870363"><span class="annot"><span class="annottext">[Instr]
</span><a href="#local-6989586621682870363"><span class="hs-identifier hs-var">instrs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682870364"><span class="annot"><span class="annottext">[NatBasicBlock Instr]
</span><a href="#local-6989586621682870364"><span class="hs-identifier hs-var">blocks</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682870365"><span class="annot"><span class="annottext">[GenCmmDecl RawCmmStatics h g]
</span><a href="#local-6989586621682870365"><span class="hs-identifier hs-var">statics</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; [Instr] -&gt; NatBasicBlock Instr
forall i. BlockId -&gt; [i] -&gt; GenBasicBlock i
</span><a href="GHC.Cmm.html#BasicBlock"><span class="hs-identifier hs-var">BasicBlock</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682870362"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">[Instr]
</span><a href="#local-6989586621682870363"><span class="hs-identifier hs-var">instrs</span></a></span><span> </span><span class="annot"><span class="annottext">NatBasicBlock Instr
-&gt; [NatBasicBlock Instr] -&gt; [NatBasicBlock Instr]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[NatBasicBlock Instr]
</span><a href="#local-6989586621682870364"><span class="hs-identifier hs-var">blocks</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[GenCmmDecl RawCmmStatics h g]
</span><a href="#local-6989586621682870365"><span class="hs-identifier hs-var">statics</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#mkBlocks"><span class="hs-identifier hs-var">mkBlocks</span></a></span><span> </span><span id="local-6989586621682870366"><span class="annot"><span class="annottext">Instr
</span><a href="#local-6989586621682870366"><span class="hs-identifier hs-var">instr</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682870367"><span class="annot"><span class="annottext">[Instr]
</span><a href="#local-6989586621682870367"><span class="hs-identifier hs-var">instrs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682870368"><span class="annot"><span class="annottext">[NatBasicBlock Instr]
</span><a href="#local-6989586621682870368"><span class="hs-identifier hs-var">blocks</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682870369"><span class="annot"><span class="annottext">[GenCmmDecl RawCmmStatics h g]
</span><a href="#local-6989586621682870369"><span class="hs-identifier hs-var">statics</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Instr
</span><a href="#local-6989586621682870366"><span class="hs-identifier hs-var">instr</span></a></span><span class="annot"><span class="annottext">Instr -&gt; [Instr] -&gt; [Instr]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Instr]
</span><a href="#local-6989586621682870367"><span class="hs-identifier hs-var">instrs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[NatBasicBlock Instr]
</span><a href="#local-6989586621682870368"><span class="hs-identifier hs-var">blocks</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[GenCmmDecl RawCmmStatics h g]
</span><a href="#local-6989586621682870369"><span class="hs-identifier hs-var">statics</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-174"></span><span class="annot"><span class="hs-comment">-- | Utilities</span></span><span>
</span><span id="line-175"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#ann"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a></span><span>
</span><span id="line-176"></span><span id="ann"><span class="annot"><span class="annottext">ann :: SDoc -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#ann"><span class="hs-identifier hs-var hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621682870371"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682870371"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span id="local-6989586621682870372"><span class="annot"><span class="annottext">Instr
</span><a href="#local-6989586621682870372"><span class="hs-identifier hs-var">instr</span></a></span></span><span> </span><span class="hs-comment">{- debugIsOn -}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#ANN"><span class="hs-identifier hs-var">ANN</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682870371"><span class="hs-identifier hs-var">doc</span></a></span><span> </span><span class="annot"><span class="annottext">Instr
</span><a href="#local-6989586621682870372"><span class="hs-identifier hs-var">instr</span></a></span><span>
</span><span id="line-177"></span><span class="hs-comment">-- ann _ instr = instr</span><span>
</span><span id="line-178"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#ann"><span class="hs-pragma hs-type">ann</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span class="hs-comment">-- Using pprExpr will hide the AST, @ANN@ will end up in the assembly with</span><span>
</span><span id="line-181"></span><span class="hs-comment">-- -dppr-debug.  The idea is that we can trivially see how a cmm expression</span><span>
</span><span id="line-182"></span><span class="hs-comment">-- ended up producing the assembly we see.  By having the verbatim AST printed</span><span>
</span><span id="line-183"></span><span class="hs-comment">-- we can simply check the patterns that were matched to arrive at the assembly</span><span>
</span><span id="line-184"></span><span class="hs-comment">-- we generated.</span><span>
</span><span id="line-185"></span><span class="hs-comment">--</span><span>
</span><span id="line-186"></span><span class="hs-comment">-- pprExpr will hide a lot of noise of the underlying data structure and print</span><span>
</span><span id="line-187"></span><span class="hs-comment">-- the expression into something that can be easily read by a human. However</span><span>
</span><span id="line-188"></span><span class="hs-comment">-- going back to the exact CmmExpr representation can be laborious and adds</span><span>
</span><span id="line-189"></span><span class="hs-comment">-- indirections to find the matches that lead to the assembly.</span><span>
</span><span id="line-190"></span><span class="hs-comment">--</span><span>
</span><span id="line-191"></span><span class="hs-comment">-- An improvement could be to have</span><span>
</span><span id="line-192"></span><span class="hs-comment">--</span><span>
</span><span id="line-193"></span><span class="hs-comment">--    (pprExpr genericPlatform e) &lt;&gt; parens (text. show e)</span><span>
</span><span id="line-194"></span><span class="hs-comment">--</span><span>
</span><span id="line-195"></span><span class="hs-comment">-- to have the best of both worlds.</span><span>
</span><span id="line-196"></span><span class="hs-comment">--</span><span>
</span><span id="line-197"></span><span class="hs-comment">-- Note: debugIsOn is too restrictive, it only works for debug compilers.</span><span>
</span><span id="line-198"></span><span class="hs-comment">-- However, we do not only want to inspect this for debug compilers. Ideally</span><span>
</span><span id="line-199"></span><span class="hs-comment">-- we'd have a check for -dppr-debug here already, such that we don't even</span><span>
</span><span id="line-200"></span><span class="hs-comment">-- generate the ANN expressions. However, as they are lazy, they shouldn't be</span><span>
</span><span id="line-201"></span><span class="hs-comment">-- forced until we actually force them, and without -dppr-debug they should</span><span>
</span><span id="line-202"></span><span class="hs-comment">-- never end up being forced.</span><span>
</span><span id="line-203"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-type">annExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a></span><span>
</span><span id="line-204"></span><span id="annExpr"><span class="annot"><span class="annottext">annExpr :: CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var hs-var">annExpr</span></a></span></span><span> </span><span id="local-6989586621682870375"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870375"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621682870376"><span class="annot"><span class="annottext">Instr
</span><a href="#local-6989586621682870376"><span class="hs-identifier hs-var">instr</span></a></span></span><span> </span><span class="hs-comment">{- debugIsOn -}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#ANN"><span class="hs-identifier hs-var">ANN</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; SDoc) -&gt; (CmmExpr -&gt; String) -&gt; CmmExpr -&gt; SDoc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">(CmmExpr -&gt; SDoc) -&gt; CmmExpr -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870375"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Instr
</span><a href="#local-6989586621682870376"><span class="hs-identifier hs-var">instr</span></a></span><span>
</span><span id="line-205"></span><span class="hs-comment">-- annExpr e instr {- debugIsOn -} = ANN (pprExpr genericPlatform e) instr</span><span>
</span><span id="line-206"></span><span class="hs-comment">-- annExpr _ instr = instr</span><span>
</span><span id="line-207"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-pragma hs-type">annExpr</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-210"></span><span class="hs-comment">-- Generating a table-branch</span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span class="hs-comment">-- TODO jump tables would be a lot faster, but we'll use bare bones for now.</span><span>
</span><span id="line-213"></span><span class="hs-comment">-- this is usually done by sticking the jump table ids into an instruction</span><span>
</span><span id="line-214"></span><span class="hs-comment">-- and then have the @generateJumpTableForInstr@ callback produce the jump</span><span>
</span><span id="line-215"></span><span class="hs-comment">-- table as a static.</span><span>
</span><span id="line-216"></span><span class="hs-comment">--</span><span>
</span><span id="line-217"></span><span class="hs-comment">-- See Ticket 19912</span><span>
</span><span id="line-218"></span><span class="hs-comment">--</span><span>
</span><span id="line-219"></span><span class="hs-comment">-- data SwitchTargets =</span><span>
</span><span id="line-220"></span><span class="hs-comment">--    SwitchTargets</span><span>
</span><span id="line-221"></span><span class="hs-comment">--        Bool                       -- Signed values</span><span>
</span><span id="line-222"></span><span class="hs-comment">--        (Integer, Integer)         -- Range</span><span>
</span><span id="line-223"></span><span class="hs-comment">--        (Maybe Label)              -- Default value</span><span>
</span><span id="line-224"></span><span class="hs-comment">--        (M.Map Integer Label)      -- The branches</span><span>
</span><span id="line-225"></span><span class="hs-comment">--</span><span>
</span><span id="line-226"></span><span class="hs-comment">-- Non Jumptable plan:</span><span>
</span><span id="line-227"></span><span class="hs-comment">-- xE &lt;- expr</span><span>
</span><span id="line-228"></span><span class="hs-comment">--</span><span>
</span><span id="line-229"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#genSwitch"><span class="hs-identifier hs-type">genSwitch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Switch.html#SwitchTargets"><span class="hs-identifier hs-type">SwitchTargets</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a></span><span>
</span><span id="line-230"></span><span id="genSwitch"><span class="annot"><span class="annottext">genSwitch :: CmmExpr -&gt; SwitchTargets -&gt; NatM (OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#genSwitch"><span class="hs-identifier hs-var hs-var">genSwitch</span></a></span></span><span> </span><span id="local-6989586621682870381"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870381"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621682870382"><span class="annot"><span class="annottext">SwitchTargets
</span><a href="#local-6989586621682870382"><span class="hs-identifier hs-var">targets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- pprPanic &quot;genSwitch&quot; (ppr expr)</span><span>
</span><span id="line-231"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682870383"><span class="annot"><a href="#local-6989586621682870383"><span class="hs-identifier hs-var">reg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870384"><span class="annot"><a href="#local-6989586621682870384"><span class="hs-identifier hs-var">format</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870385"><span class="annot"><a href="#local-6989586621682870385"><span class="hs-identifier hs-var">code</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870381"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-232"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682870387"><span class="annot"><a href="#local-6989586621682870387"><span class="hs-identifier hs-var hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Format -&gt; Width
</span><a href="GHC.CmmToAsm.Format.html#formatToWidth"><span class="hs-identifier hs-var">formatToWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682870384"><span class="hs-identifier hs-var">format</span></a></span><span>
</span><span id="line-233"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682870389"><span class="annot"><a href="#local-6989586621682870389"><span class="hs-identifier hs-var hs-var">mkbranch</span></a></span></span><span> </span><span id="local-6989586621682870390"><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870390"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682870391"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870391"><span class="hs-identifier hs-var">key</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870392"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682870392"><span class="hs-identifier hs-var">bid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-234"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682870393"><span class="annot"><a href="#local-6989586621682870393"><span class="hs-identifier hs-var">keyReg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870394"><span class="annot"><a href="#local-6989586621682870394"><span class="hs-identifier hs-var">_format</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870395"><span class="annot"><a href="#local-6989586621682870395"><span class="hs-identifier hs-var">code</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmLit -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Width -&gt; CmmLit
</span><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870391"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870387"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682870395"><span class="hs-identifier hs-type">code</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span>
</span><span id="line-236"></span><span>                 </span><span class="annot"><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-type">toOL</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#CMP"><span class="hs-identifier hs-type">CMP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870387"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870383"><span class="hs-identifier hs-type">reg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870387"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870393"><span class="hs-identifier hs-type">keyReg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#BCOND"><span class="hs-identifier hs-type">BCOND</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Cond.html#EQ"><span class="hs-identifier hs-type">EQ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#TBlock"><span class="hs-identifier hs-type">TBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870392"><span class="hs-identifier hs-type">bid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>                      </span><span class="hs-special">]</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870390"><span class="hs-identifier hs-type">acc</span></a></span><span>
</span><span id="line-239"></span><span>      </span><span id="local-6989586621682870404"><span class="annot"><a href="#local-6989586621682870404"><span class="hs-identifier hs-var hs-var">def_code</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SwitchTargets -&gt; Maybe BlockId
</span><a href="GHC.Cmm.Switch.html#switchTargetsDefault"><span class="hs-identifier hs-var">switchTargetsDefault</span></a></span><span> </span><span class="annot"><span class="annottext">SwitchTargets
</span><a href="#local-6989586621682870382"><span class="hs-identifier hs-var">targets</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-240"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682870406"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682870406"><span class="hs-identifier hs-var">bid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Target -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#B"><span class="hs-identifier hs-var">B</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockId -&gt; Target
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#TBlock"><span class="hs-identifier hs-var">TBlock</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682870406"><span class="hs-identifier hs-var">bid</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>        </span><span class="annot"><span class="annottext">Maybe BlockId
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
forall a. OrdList a
</span><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-var">nilOL</span></a></span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span>  </span><span id="local-6989586621682870408"><span class="annot"><a href="#local-6989586621682870408"><span class="hs-identifier hs-var">switch_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">foldM</span></span><span> </span><span class="annot"><a href="#local-6989586621682870389"><span class="hs-identifier hs-type">mkbranch</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-type">nilOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Switch.html#switchTargetsCases"><span class="hs-identifier hs-type">switchTargetsCases</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870382"><span class="hs-identifier hs-type">targets</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682870385"><span class="hs-identifier hs-type">code</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870408"><span class="hs-identifier hs-type">switch_code</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870404"><span class="hs-identifier hs-type">def_code</span></a></span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span class="hs-comment">-- We don't do jump tables for now, see Ticket 19912</span><span>
</span><span id="line-247"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#generateJumpTableForInstr"><span class="hs-identifier hs-type">generateJumpTableForInstr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Config.html#NCGConfig"><span class="hs-identifier hs-type">NCGConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a></span><span>
</span><span id="line-248"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Types.html#NatCmmDecl"><span class="hs-identifier hs-type">NatCmmDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#RawCmmStatics"><span class="hs-identifier hs-type">RawCmmStatics</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span id="generateJumpTableForInstr"><span class="annot"><span class="annottext">generateJumpTableForInstr :: NCGConfig -&gt; Instr -&gt; Maybe (NatCmmDecl RawCmmStatics Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#generateJumpTableForInstr"><span class="hs-identifier hs-var hs-var">generateJumpTableForInstr</span></a></span></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Instr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (NatCmmDecl RawCmmStatics Instr)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-252"></span><span class="hs-comment">-- Top-level of the instruction selector</span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#stmtsToInstrs"><span class="hs-identifier hs-type">stmtsToInstrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-comment">-- ^ Cmm Statements</span></span><span>
</span><span id="line-255"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ Resulting instructions</span></span><span>
</span><span id="line-256"></span><span id="stmtsToInstrs"><span class="annot"><span class="annottext">stmtsToInstrs :: [CmmNode O O] -&gt; NatM (OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#stmtsToInstrs"><span class="hs-identifier hs-var hs-var">stmtsToInstrs</span></a></span></span><span> </span><span id="local-6989586621682870410"><span class="annot"><span class="annottext">[CmmNode O O]
</span><a href="#local-6989586621682870410"><span class="hs-identifier hs-var">stmts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-257"></span><span>    </span><span class="annot"><span class="annottext">[CmmNode O O] -&gt; OrdList Instr -&gt; NatM (OrdList Instr)
forall {e :: Extensibility} {x :: Extensibility}.
[CmmNode e x] -&gt; OrdList Instr -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682870411"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmNode O O]
</span><a href="#local-6989586621682870410"><span class="hs-identifier hs-var">stmts</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr
forall a. OrdList a
</span><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-var">nilOL</span></a></span><span>
</span><span id="line-258"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-259"></span><span>    </span><span id="local-6989586621682870411"><span class="annot"><span class="annottext">go :: [CmmNode e x] -&gt; OrdList Instr -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682870411"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>        </span><span id="local-6989586621682870414"><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870414"><span class="hs-identifier hs-var">instrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; NatM (OrdList Instr)
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870414"><span class="hs-identifier hs-var">instrs</span></a></span><span>
</span><span id="line-260"></span><span>    </span><span class="annot"><a href="#local-6989586621682870411"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682870415"><span class="annot"><span class="annottext">CmmNode e x
</span><a href="#local-6989586621682870415"><span class="hs-identifier hs-var">s</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682870416"><span class="annot"><span class="annottext">[CmmNode e x]
</span><a href="#local-6989586621682870416"><span class="hs-identifier hs-var">stmts</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682870417"><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870417"><span class="hs-identifier hs-var">instrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-261"></span><span>      </span><span id="local-6989586621682870418"><span class="annot"><a href="#local-6989586621682870418"><span class="hs-identifier hs-var">instrs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmNode e x -&gt; NatM (OrdList Instr)
forall (e :: Extensibility) (x :: Extensibility).
CmmNode e x -&gt; NatM (OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#stmtToInstrs"><span class="hs-identifier hs-var">stmtToInstrs</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode e x
</span><a href="#local-6989586621682870415"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-262"></span><span>      </span><span class="annot"><a href="#local-6989586621682870411"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870416"><span class="hs-identifier hs-type">stmts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682870417"><span class="hs-identifier hs-type">instrs</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870418"><span class="hs-identifier hs-type">instrs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span id="local-6989586621682869166"><span id="local-6989586621682869167"><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#stmtToInstrs"><span class="hs-identifier hs-type">stmtToInstrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682869166"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682869167"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ Cmm Statement</span></span><span>
</span><span id="line-265"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a></span></span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ Resulting Instructions</span></span><span>
</span><span id="line-266"></span><span id="stmtToInstrs"><span class="annot"><span class="annottext">stmtToInstrs :: forall (e :: Extensibility) (x :: Extensibility).
CmmNode e x -&gt; NatM (OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#stmtToInstrs"><span class="hs-identifier hs-var hs-var">stmtToInstrs</span></a></span></span><span> </span><span id="local-6989586621682870424"><span class="annot"><span class="annottext">CmmNode e x
</span><a href="#local-6989586621682870424"><span class="hs-identifier hs-var">stmt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-267"></span><span>  </span><span class="hs-comment">-- traceM $ &quot;-- -------------------------- stmtToInstrs -------------------------- --\n&quot;</span><span>
</span><span id="line-268"></span><span>  </span><span class="hs-comment">--     ++ showSDocUnsafe (ppr stmt)</span><span>
</span><span id="line-269"></span><span>  </span><span id="local-6989586621682870425"><span class="annot"><a href="#local-6989586621682870425"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NatM Platform
</span><a href="GHC.CmmToAsm.Monad.html#getPlatform"><span class="hs-identifier hs-var">getPlatform</span></a></span><span>
</span><span id="line-270"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682870424"><span class="hs-identifier hs-type">stmt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-271"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmUnsafeForeignCall"><span class="hs-identifier hs-type">CmmUnsafeForeignCall</span></a></span><span> </span><span id="local-6989586621682870429"><span class="annot"><span class="annottext">ForeignTarget
</span><a href="#local-6989586621682870429"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span id="local-6989586621682870430"><span class="annot"><span class="annottext">[CmmFormal]
</span><a href="#local-6989586621682870430"><span class="hs-identifier hs-var">result_regs</span></a></span></span><span> </span><span id="local-6989586621682870431"><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682870431"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-272"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ForeignTarget -&gt; [CmmFormal] -&gt; [CmmExpr] -&gt; NatM (OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#genCCall"><span class="hs-identifier hs-var">genCCall</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignTarget
</span><a href="#local-6989586621682870429"><span class="hs-identifier hs-var">target</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmFormal]
</span><a href="#local-6989586621682870430"><span class="hs-identifier hs-var">result_regs</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682870431"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span>    </span><span class="annot"><span class="annottext">CmmNode e x
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CmmNode e x
</span><a href="#local-6989586621682870424"><span class="hs-identifier hs-var">stmt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-275"></span><span>      </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmComment"><span class="hs-identifier hs-type">CmmComment</span></a></span><span> </span><span id="local-6989586621682870438"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682870438"><span class="hs-identifier hs-var">s</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; NatM (OrdList Instr)
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#COMMENT"><span class="hs-identifier hs-var">COMMENT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; SDoc
forall doc. IsLine doc =&gt; FastString -&gt; doc
</span><a href="GHC.Utils.Outputable.html#ftext"><span class="hs-identifier hs-var">ftext</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682870438"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-276"></span><span>      </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmTick"><span class="hs-identifier hs-type">CmmTick</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; NatM (OrdList Instr)
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">OrdList Instr
forall a. OrdList a
</span><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-var">nilOL</span></a></span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span>      </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmAssign"><span class="hs-identifier hs-type">CmmAssign</span></a></span><span> </span><span id="local-6989586621682870448"><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682870448"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span id="local-6989586621682870449"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870449"><span class="hs-identifier hs-var">src</span></a></span></span><span>
</span><span id="line-279"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CmmType -&gt; Bool
</span><a href="GHC.Cmm.Type.html#isFloatType"><span class="hs-identifier hs-var">isFloatType</span></a></span><span> </span><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682870451"><span class="hs-identifier hs-var">ty</span></a></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Format -&gt; CmmReg -&gt; CmmExpr -&gt; NatM (OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#assignReg_FltCode"><span class="hs-identifier hs-var">assignReg_FltCode</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682870453"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682870448"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870449"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-280"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Format -&gt; CmmReg -&gt; CmmExpr -&gt; NatM (OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#assignReg_IntCode"><span class="hs-identifier hs-var">assignReg_IntCode</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682870453"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682870448"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870449"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-281"></span><span>          </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682870451"><span class="annot"><span class="annottext">ty :: CmmType
</span><a href="#local-6989586621682870451"><span class="hs-identifier hs-var hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmReg -&gt; CmmType
</span><a href="GHC.Cmm.Reg.html#cmmRegType"><span class="hs-identifier hs-var">cmmRegType</span></a></span><span> </span><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682870448"><span class="hs-identifier hs-var">reg</span></a></span><span>
</span><span id="line-282"></span><span>                </span><span id="local-6989586621682870453"><span class="annot"><span class="annottext">format :: Format
</span><a href="#local-6989586621682870453"><span class="hs-identifier hs-var hs-var">format</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmType -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#cmmTypeFormat"><span class="hs-identifier hs-var">cmmTypeFormat</span></a></span><span> </span><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682870451"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span>      </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmStore"><span class="hs-identifier hs-type">CmmStore</span></a></span><span> </span><span id="local-6989586621682870460"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870460"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span id="local-6989586621682870461"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870461"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span id="local-6989586621682870462"><span class="annot"><span class="annottext">AlignmentSpec
</span><a href="#local-6989586621682870462"><span class="hs-identifier hs-var">_alignment</span></a></span></span><span>
</span><span id="line-285"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CmmType -&gt; Bool
</span><a href="GHC.Cmm.Type.html#isFloatType"><span class="hs-identifier hs-var">isFloatType</span></a></span><span> </span><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682870463"><span class="hs-identifier hs-var">ty</span></a></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Format -&gt; CmmExpr -&gt; CmmExpr -&gt; NatM (OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#assignMem_FltCode"><span class="hs-identifier hs-var">assignMem_FltCode</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682870465"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870460"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870461"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-286"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Format -&gt; CmmExpr -&gt; CmmExpr -&gt; NatM (OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#assignMem_IntCode"><span class="hs-identifier hs-var">assignMem_IntCode</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682870465"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870460"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870461"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-287"></span><span>          </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682870463"><span class="annot"><span class="annottext">ty :: CmmType
</span><a href="#local-6989586621682870463"><span class="hs-identifier hs-var hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmExpr -&gt; CmmType
</span><a href="GHC.Cmm.Expr.html#cmmExprType"><span class="hs-identifier hs-var">cmmExprType</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682870425"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870461"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-288"></span><span>                </span><span id="local-6989586621682870465"><span class="annot"><span class="annottext">format :: Format
</span><a href="#local-6989586621682870465"><span class="hs-identifier hs-var hs-var">format</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmType -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#cmmTypeFormat"><span class="hs-identifier hs-var">cmmTypeFormat</span></a></span><span> </span><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682870463"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-289"></span><span>
</span><span id="line-290"></span><span>      </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmBranch"><span class="hs-identifier hs-type">CmmBranch</span></a></span><span> </span><span id="local-6989586621682870471"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682870471"><span class="hs-identifier hs-var">id</span></a></span></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; NatM (OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#genBranch"><span class="hs-identifier hs-var">genBranch</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682870471"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span>      </span><span class="hs-comment">--We try to arrange blocks such that the likely branch is the fallthrough</span><span>
</span><span id="line-293"></span><span>      </span><span class="hs-comment">--in GHC.Cmm.ContFlowOpt. So we can assume the condition is likely false here.</span><span>
</span><span id="line-294"></span><span>      </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmCondBranch"><span class="hs-identifier hs-type">CmmCondBranch</span></a></span><span> </span><span id="local-6989586621682870476"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870476"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span id="local-6989586621682870477"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682870477"><span class="hs-identifier hs-var">true</span></a></span></span><span> </span><span id="local-6989586621682870478"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682870478"><span class="hs-identifier hs-var">false</span></a></span></span><span> </span><span id="local-6989586621682870479"><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621682870479"><span class="hs-identifier hs-var">_prediction</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-295"></span><span>          </span><span class="annot"><span class="annottext">BlockId -&gt; BlockId -&gt; CmmExpr -&gt; NatM (OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#genCondBranch"><span class="hs-identifier hs-var">genCondBranch</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682870477"><span class="hs-identifier hs-var">true</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682870478"><span class="hs-identifier hs-var">false</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870476"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-296"></span><span>
</span><span id="line-297"></span><span>      </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmSwitch"><span class="hs-identifier hs-type">CmmSwitch</span></a></span><span> </span><span id="local-6989586621682870484"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870484"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span id="local-6989586621682870485"><span class="annot"><span class="annottext">SwitchTargets
</span><a href="#local-6989586621682870485"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; SwitchTargets -&gt; NatM (OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#genSwitch"><span class="hs-identifier hs-var">genSwitch</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870484"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">SwitchTargets
</span><a href="#local-6989586621682870485"><span class="hs-identifier hs-var">ids</span></a></span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span>      </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmCall"><span class="hs-identifier hs-type">CmmCall</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cml_target :: CmmNode O C -&gt; CmmExpr
</span><a href="GHC.Cmm.Node.html#cml_target"><span class="hs-identifier hs-var">cml_target</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682870490"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870490"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#genJump"><span class="hs-identifier hs-var">genJump</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870490"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span>      </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmUnwind"><span class="hs-identifier hs-type">CmmUnwind</span></a></span><span> </span><span id="local-6989586621682870496"><span class="annot"><span class="annottext">[(GlobalReg, Maybe CmmExpr)]
</span><a href="#local-6989586621682870496"><span class="hs-identifier hs-var">_regs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; NatM (OrdList Instr)
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">OrdList Instr
forall a. OrdList a
</span><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-var">nilOL</span></a></span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span>      </span><span class="annot"><span class="annottext">CmmNode e x
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; NatM (OrdList Instr)
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;stmtToInstrs: statement should have been cps'd away&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; CmmNode e x -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682870425"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode e x
</span><a href="#local-6989586621682870424"><span class="hs-identifier hs-var">stmt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-304"></span><span>
</span><span id="line-305"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-306"></span><span class="hs-comment">-- | 'InstrBlock's are the insn sequences generated by the insn selectors.</span><span>
</span><span id="line-307"></span><span class="hs-comment">--      They are really trees of insns to facilitate fast appending, where a</span><span>
</span><span id="line-308"></span><span class="hs-comment">--      left-to-right traversal yields the insns in the correct order.</span><span>
</span><span id="line-309"></span><span class="hs-comment">--</span><span>
</span><span id="line-310"></span><span class="hs-keyword">type</span><span> </span><span id="InstrBlock"><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#InstrBlock"><span class="hs-identifier hs-var">InstrBlock</span></a></span></span><span>
</span><span id="line-311"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#OrdList"><span class="hs-identifier hs-type">OrdList</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a></span><span>
</span><span id="line-312"></span><span>
</span><span id="line-313"></span><span class="hs-comment">-- | Register's passed up the tree.  If the stix code forces the register</span><span>
</span><span id="line-314"></span><span class="hs-comment">--      to live in a pre-decided machine register, it comes out as @Fixed@;</span><span>
</span><span id="line-315"></span><span class="hs-comment">--      otherwise, it comes out as @Any@, and the parent can decide which</span><span>
</span><span id="line-316"></span><span class="hs-comment">--      register to put it in.</span><span>
</span><span id="line-317"></span><span class="hs-comment">--</span><span>
</span><span id="line-318"></span><span class="hs-keyword">data</span><span> </span><span id="Register"><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Register"><span class="hs-identifier hs-var">Register</span></a></span></span><span>
</span><span id="line-319"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span id="Fixed"><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Fixed"><span class="hs-identifier hs-var">Fixed</span></a></span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Format.html#Format"><span class="hs-identifier hs-type">Format</span></a></span><span> </span><span class="annot"><a href="GHC.Platform.Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a></span><span>
</span><span id="line-320"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span id="Any"><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a></span></span><span>   </span><span class="annot"><a href="GHC.CmmToAsm.Format.html#Format"><span class="hs-identifier hs-type">Format</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Platform.Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-321"></span><span>
</span><span id="line-322"></span><span class="hs-comment">-- | Sometimes we need to change the Format of a register. Primarily during</span><span>
</span><span id="line-323"></span><span class="hs-comment">-- conversion.</span><span>
</span><span id="line-324"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#swizzleRegisterRep"><span class="hs-identifier hs-type">swizzleRegisterRep</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Format.html#Format"><span class="hs-identifier hs-type">Format</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a></span><span>
</span><span id="line-325"></span><span id="swizzleRegisterRep"><span class="annot"><span class="annottext">swizzleRegisterRep :: Format -&gt; Register -&gt; Register
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#swizzleRegisterRep"><span class="hs-identifier hs-var hs-var">swizzleRegisterRep</span></a></span></span><span> </span><span id="local-6989586621682870501"><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682870501"><span class="hs-identifier hs-var">format</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Fixed"><span class="hs-identifier hs-type">Fixed</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682870502"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870502"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span id="local-6989586621682870503"><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870503"><span class="hs-identifier hs-var">code</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Format -&gt; Reg -&gt; OrdList Instr -&gt; Register
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Fixed"><span class="hs-identifier hs-var">Fixed</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682870501"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870502"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870503"><span class="hs-identifier hs-var">code</span></a></span><span>
</span><span id="line-326"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#swizzleRegisterRep"><span class="hs-identifier hs-var">swizzleRegisterRep</span></a></span><span> </span><span id="local-6989586621682870504"><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682870504"><span class="hs-identifier hs-var">format</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682870505"><span class="annot"><span class="annottext">Reg -&gt; OrdList Instr
</span><a href="#local-6989586621682870505"><span class="hs-identifier hs-var">codefn</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Format -&gt; (Reg -&gt; OrdList Instr) -&gt; Register
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a></span><span>   </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682870504"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="annot"><span class="annottext">Reg -&gt; OrdList Instr
</span><a href="#local-6989586621682870505"><span class="hs-identifier hs-var">codefn</span></a></span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span class="annot"><span class="hs-comment">-- | Grab the Reg for a CmmReg</span></span><span>
</span><span id="line-329"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-type">getRegisterReg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Reg.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Platform.Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a></span><span>
</span><span id="line-330"></span><span>
</span><span id="line-331"></span><span id="getRegisterReg"><span class="annot"><span class="annottext">getRegisterReg :: Platform -&gt; CmmReg -&gt; Reg
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var hs-var">getRegisterReg</span></a></span></span><span> </span><span class="annot"><span class="annottext">Platform
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Reg.html#CmmLocal"><span class="hs-identifier hs-type">CmmLocal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Reg.html#LocalReg"><span class="hs-identifier hs-type">LocalReg</span></a></span><span> </span><span id="local-6989586621682870509"><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682870509"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621682870510"><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682870510"><span class="hs-identifier hs-var">pk</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VirtualReg -&gt; Reg
</span><a href="GHC.Platform.Reg.html#RegVirtual"><span class="hs-identifier hs-var">RegVirtual</span></a></span><span> </span><span class="annot"><span class="annottext">(VirtualReg -&gt; Reg) -&gt; VirtualReg -&gt; Reg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Unique -&gt; Format -&gt; VirtualReg
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#mkVirtualReg"><span class="hs-identifier hs-var">mkVirtualReg</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682870509"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmType -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#cmmTypeFormat"><span class="hs-identifier hs-var">cmmTypeFormat</span></a></span><span> </span><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682870510"><span class="hs-identifier hs-var">pk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-333"></span><span>
</span><span id="line-334"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a></span><span> </span><span id="local-6989586621682870513"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682870513"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Reg.html#CmmGlobal"><span class="hs-identifier hs-type">CmmGlobal</span></a></span><span> </span><span id="local-6989586621682870515"><span class="annot"><span class="annottext">reg :: GlobalRegUse
</span><a href="#local-6989586621682870515"><span class="hs-identifier hs-var">reg</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Reg.html#GlobalRegUse"><span class="hs-identifier hs-type">GlobalRegUse</span></a></span><span> </span><span id="local-6989586621682870517"><span class="annot"><span class="annottext">GlobalReg
</span><a href="#local-6989586621682870517"><span class="hs-identifier hs-var">mid</span></a></span></span><span> </span><span class="annot"><span class="annottext">CmmType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-335"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; GlobalReg -&gt; Maybe RealReg
</span><a href="GHC.Platform.Regs.html#globalRegMaybe"><span class="hs-identifier hs-var">globalRegMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682870513"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalReg
</span><a href="#local-6989586621682870517"><span class="hs-identifier hs-var">mid</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-336"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682870519"><span class="annot"><span class="annottext">RealReg
</span><a href="#local-6989586621682870519"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RealReg -&gt; Reg
</span><a href="GHC.Platform.Reg.html#RegReal"><span class="hs-identifier hs-var">RegReal</span></a></span><span> </span><span class="annot"><span class="annottext">RealReg
</span><a href="#local-6989586621682870519"><span class="hs-identifier hs-var">reg</span></a></span><span>
</span><span id="line-337"></span><span>        </span><span class="annot"><span class="annottext">Maybe RealReg
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; Reg
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getRegisterReg-memory&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmReg -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">(CmmReg -&gt; SDoc) -&gt; CmmReg -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GlobalRegUse -&gt; CmmReg
</span><a href="GHC.Cmm.Reg.html#CmmGlobal"><span class="hs-identifier hs-var">CmmGlobal</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRegUse
</span><a href="#local-6989586621682870515"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>        </span><span class="hs-comment">-- By this stage, the only MagicIds remaining should be the</span><span>
</span><span id="line-339"></span><span>        </span><span class="hs-comment">-- ones which map to a real machine register on this</span><span>
</span><span id="line-340"></span><span>        </span><span class="hs-comment">-- platform.  Hence if it's not mapped to a registers something</span><span>
</span><span id="line-341"></span><span>        </span><span class="hs-comment">-- went wrong earlier in the pipeline.</span><span>
</span><span id="line-342"></span><span class="hs-comment">-- | Convert a BlockId to some CmmStatic data</span><span>
</span><span id="line-343"></span><span class="hs-comment">-- TODO: Add JumpTable Logic, see Ticket 19912</span><span>
</span><span id="line-344"></span><span class="hs-comment">-- jumpTableEntry :: NCGConfig -&gt; Maybe BlockId -&gt; CmmStatic</span><span>
</span><span id="line-345"></span><span class="hs-comment">-- jumpTableEntry config Nothing   = CmmStaticLit (CmmInt 0 (ncgWordWidth config))</span><span>
</span><span id="line-346"></span><span class="hs-comment">-- jumpTableEntry _ (Just blockid) = CmmStaticLit (CmmLabel blockLabel)</span><span>
</span><span id="line-347"></span><span class="hs-comment">--     where blockLabel = blockLbl blockid</span><span>
</span><span id="line-348"></span><span>
</span><span id="line-349"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-350"></span><span class="hs-comment">-- General things for putting together code sequences</span><span>
</span><span id="line-351"></span><span>
</span><span id="line-352"></span><span class="hs-comment">-- | The dual to getAnyReg: compute an expression into a register, but</span><span>
</span><span id="line-353"></span><span class="hs-comment">--      we don't mind which one it is.</span><span>
</span><span id="line-354"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-type">getSomeReg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Platform.Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Format.html#Format"><span class="hs-identifier hs-type">Format</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-355"></span><span id="getSomeReg"><span class="annot"><span class="annottext">getSomeReg :: CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var hs-var">getSomeReg</span></a></span></span><span> </span><span id="local-6989586621682870522"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870522"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-356"></span><span>  </span><span id="local-6989586621682870523"><span class="annot"><a href="#local-6989586621682870523"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM Register
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegister"><span class="hs-identifier hs-var">getRegister</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870522"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-357"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682870523"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-358"></span><span>    </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span id="local-6989586621682870525"><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682870525"><span class="hs-identifier hs-var">rep</span></a></span></span><span> </span><span id="local-6989586621682870526"><span class="annot"><span class="annottext">Reg -&gt; OrdList Instr
</span><a href="#local-6989586621682870526"><span class="hs-identifier hs-var">code</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-359"></span><span>        </span><span id="local-6989586621682870527"><span class="annot"><a href="#local-6989586621682870527"><span class="hs-identifier hs-var">tmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Format -&gt; NatM Reg
</span><a href="GHC.CmmToAsm.Monad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682870525"><span class="hs-identifier hs-var">rep</span></a></span><span>
</span><span id="line-360"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682870527"><span class="hs-identifier hs-type">tmp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682870525"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682870526"><span class="hs-identifier hs-type">code</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870527"><span class="hs-identifier hs-type">tmp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-361"></span><span>    </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Fixed"><span class="hs-identifier hs-type">Fixed</span></a></span><span> </span><span id="local-6989586621682870528"><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682870528"><span class="hs-identifier hs-var">rep</span></a></span></span><span> </span><span id="local-6989586621682870529"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870529"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span id="local-6989586621682870530"><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870530"><span class="hs-identifier hs-var">code</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-362"></span><span>        </span><span class="annot"><span class="annottext">(Reg, Format, OrdList Instr) -&gt; NatM (Reg, Format, OrdList Instr)
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870529"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682870528"><span class="hs-identifier hs-var">rep</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870530"><span class="hs-identifier hs-var">code</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-363"></span><span>
</span><span id="line-364"></span><span class="hs-comment">{- Note [Aarch64 immediates]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Aarch64 with it's fixed width instruction encoding uses leftover space for
immediates.
If you want the full rundown consult the arch reference document:
&quot;Arm&#174; Architecture Reference Manual&quot; - &quot;C3.4 Data processing - immediate&quot;

The gist of it is that different instructions allow for different immediate encodings.
The ones we care about for better code generation are:

* Simple but potentially repeated bit-patterns for logic instructions.
* 16bit numbers shifted by multiples of 16.
* 12 bit numbers optionally shifted by 12 bits.

It might seem like the ISA allows for 64bit immediates but this isn't the case.
Rather there are some instruction aliases which allow for large unencoded immediates
which will then be transalted to one of the immediate encodings implicitly.

For example mov x1, #0x10000 is allowed but will be assembled to movz x1, #0x1, lsl #16
-}</span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span class="hs-comment">-- | Move (wide immediate)</span><span>
</span><span id="line-386"></span><span class="hs-comment">-- Allows for 16bit immediate which can be shifted by 0/16/32/48 bits.</span><span>
</span><span id="line-387"></span><span class="hs-comment">-- Used with MOVZ,MOVN, MOVK</span><span>
</span><span id="line-388"></span><span class="hs-comment">-- See Note [Aarch64 immediates]</span><span>
</span><span id="line-389"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getMovWideImm"><span class="hs-identifier hs-type">getMovWideImm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#Width"><span class="hs-identifier hs-type">Width</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#Operand"><span class="hs-identifier hs-type">Operand</span></a></span><span>
</span><span id="line-390"></span><span id="getMovWideImm"><span class="annot"><span class="annottext">getMovWideImm :: Integer -&gt; Width -&gt; Maybe Operand
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getMovWideImm"><span class="hs-identifier hs-var hs-var">getMovWideImm</span></a></span></span><span> </span><span id="local-6989586621682870532"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870532"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682870533"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870533"><span class="hs-identifier hs-var">w</span></a></span></span><span>
</span><span id="line-391"></span><span>  </span><span class="hs-comment">-- TODO: Handle sign extension/negatives</span><span>
</span><span id="line-392"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870532"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-393"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Operand
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-394"></span><span>  </span><span class="hs-comment">-- Fits in 16 bits</span><span>
</span><span id="line-395"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682870535"><span class="hs-identifier hs-var">sized_n</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">2</span></span><span class="annot"><span class="annottext">Word64 -&gt; Int -&gt; Word64
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^</span></span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-396"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Maybe Operand
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Operand -&gt; Maybe Operand) -&gt; Operand -&gt; Maybe Operand
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870540"><span class="hs-identifier hs-var">truncated</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-397"></span><span>
</span><span id="line-398"></span><span>  </span><span class="hs-comment">-- 0x0000 0000 xxxx 0000</span><span>
</span><span id="line-399"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682870541"><span class="hs-identifier hs-var">trailing_zeros</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682870535"><span class="hs-identifier hs-var">sized_n</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">2</span></span><span class="annot"><span class="annottext">Word64 -&gt; Int -&gt; Word64
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^</span></span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">32</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-400"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Maybe Operand
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Operand -&gt; Maybe Operand) -&gt; Operand -&gt; Maybe Operand
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Imm -&gt; ShiftMode -&gt; Int -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImmShift"><span class="hs-identifier hs-var">OpImmShift</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Imm) -&gt; Integer -&gt; Imm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870540"><span class="hs-identifier hs-var">truncated</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Int -&gt; Integer
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="GHC.Prelude.Basic.html#shiftR"><span class="hs-operator hs-var">`shiftR`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ShiftMode
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SLSL"><span class="hs-identifier hs-var">SLSL</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16</span></span><span>
</span><span id="line-401"></span><span>
</span><span id="line-402"></span><span>  </span><span class="hs-comment">-- 0x 0000 xxxx 0000 0000</span><span>
</span><span id="line-403"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682870541"><span class="hs-identifier hs-var">trailing_zeros</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">32</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682870535"><span class="hs-identifier hs-var">sized_n</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">2</span></span><span class="annot"><span class="annottext">Word64 -&gt; Int -&gt; Word64
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^</span></span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">48</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-404"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Maybe Operand
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Operand -&gt; Maybe Operand) -&gt; Operand -&gt; Maybe Operand
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Imm -&gt; ShiftMode -&gt; Int -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImmShift"><span class="hs-identifier hs-var">OpImmShift</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Imm) -&gt; Integer -&gt; Imm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870540"><span class="hs-identifier hs-var">truncated</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Int -&gt; Integer
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="GHC.Prelude.Basic.html#shiftR"><span class="hs-operator hs-var">`shiftR`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">32</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ShiftMode
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SLSL"><span class="hs-identifier hs-var">SLSL</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">32</span></span><span>
</span><span id="line-405"></span><span>
</span><span id="line-406"></span><span>  </span><span class="hs-comment">-- 0x xxxx 0000 0000 0000</span><span>
</span><span id="line-407"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682870541"><span class="hs-identifier hs-var">trailing_zeros</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">48</span></span><span>
</span><span id="line-408"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Maybe Operand
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Operand -&gt; Maybe Operand) -&gt; Operand -&gt; Maybe Operand
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Imm -&gt; ShiftMode -&gt; Int -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImmShift"><span class="hs-identifier hs-var">OpImmShift</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Imm) -&gt; Integer -&gt; Imm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870540"><span class="hs-identifier hs-var">truncated</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Int -&gt; Integer
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="GHC.Prelude.Basic.html#shiftR"><span class="hs-operator hs-var">`shiftR`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">48</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ShiftMode
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SLSL"><span class="hs-identifier hs-var">SLSL</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">48</span></span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-411"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Operand
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-412"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-413"></span><span>    </span><span id="local-6989586621682870540"><span class="annot"><span class="annottext">truncated :: Integer
</span><a href="#local-6989586621682870540"><span class="hs-identifier hs-var hs-var">truncated</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Integer -&gt; Integer
</span><a href="GHC.Cmm.Type.html#narrowU"><span class="hs-identifier hs-var">narrowU</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870533"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870532"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-414"></span><span>    </span><span id="local-6989586621682870535"><span class="annot"><span class="annottext">sized_n :: Word64
</span><a href="#local-6989586621682870535"><span class="hs-identifier hs-var hs-var">sized_n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Word64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870540"><span class="hs-identifier hs-var">truncated</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-415"></span><span>    </span><span id="local-6989586621682870541"><span class="annot"><span class="annottext">trailing_zeros :: Int
</span><a href="#local-6989586621682870541"><span class="hs-identifier hs-var hs-var">trailing_zeros</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Int
forall b. FiniteBits b =&gt; b -&gt; Int
</span><span class="hs-identifier hs-var">countTrailingZeros</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682870535"><span class="hs-identifier hs-var">sized_n</span></a></span><span>
</span><span id="line-416"></span><span>
</span><span id="line-417"></span><span class="hs-comment">-- | Arithmetic(immediate)</span><span>
</span><span id="line-418"></span><span class="hs-comment">--  Allows for 12bit immediates which can be shifted by 0 or 12 bits.</span><span>
</span><span id="line-419"></span><span class="hs-comment">-- Used with ADD, ADDS, SUB, SUBS, CMP</span><span>
</span><span id="line-420"></span><span class="hs-comment">-- See Note [Aarch64 immediates]</span><span>
</span><span id="line-421"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getArithImm"><span class="hs-identifier hs-type">getArithImm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#Width"><span class="hs-identifier hs-type">Width</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#Operand"><span class="hs-identifier hs-type">Operand</span></a></span><span>
</span><span id="line-422"></span><span id="getArithImm"><span class="annot"><span class="annottext">getArithImm :: Integer -&gt; Width -&gt; Maybe Operand
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getArithImm"><span class="hs-identifier hs-var hs-var">getArithImm</span></a></span></span><span> </span><span id="local-6989586621682870549"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870549"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682870550"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870550"><span class="hs-identifier hs-var">w</span></a></span></span><span>
</span><span id="line-423"></span><span>  </span><span class="hs-comment">-- TODO: Handle sign extension</span><span>
</span><span id="line-424"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870549"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-425"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Operand
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-426"></span><span>  </span><span class="hs-comment">-- Fits in 16 bits</span><span>
</span><span id="line-427"></span><span>  </span><span class="hs-comment">-- Fits in 12 bits</span><span>
</span><span id="line-428"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682870551"><span class="hs-identifier hs-var">sized_n</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">2</span></span><span class="annot"><span class="annottext">Word64 -&gt; Int -&gt; Word64
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^</span></span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">12</span></span><span class="hs-glyph">::</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-429"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Maybe Operand
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Operand -&gt; Maybe Operand) -&gt; Operand -&gt; Maybe Operand
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870552"><span class="hs-identifier hs-var">truncated</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-430"></span><span>
</span><span id="line-431"></span><span>  </span><span class="hs-comment">-- 12 bits shifted by 12 places.</span><span>
</span><span id="line-432"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682870553"><span class="hs-identifier hs-var">trailing_zeros</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">12</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682870551"><span class="hs-identifier hs-var">sized_n</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">2</span></span><span class="annot"><span class="annottext">Word64 -&gt; Int -&gt; Word64
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^</span></span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">24</span></span><span class="hs-glyph">::</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-433"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Maybe Operand
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Operand -&gt; Maybe Operand) -&gt; Operand -&gt; Maybe Operand
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Imm -&gt; ShiftMode -&gt; Int -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImmShift"><span class="hs-identifier hs-var">OpImmShift</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Imm) -&gt; Integer -&gt; Imm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870552"><span class="hs-identifier hs-var">truncated</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Int -&gt; Integer
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="GHC.Prelude.Basic.html#shiftR"><span class="hs-operator hs-var">`shiftR`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">12</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ShiftMode
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SLSL"><span class="hs-identifier hs-var">SLSL</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">12</span></span><span>
</span><span id="line-434"></span><span>
</span><span id="line-435"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-436"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Operand
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-437"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-438"></span><span>    </span><span id="local-6989586621682870551"><span class="annot"><span class="annottext">sized_n :: Word64
</span><a href="#local-6989586621682870551"><span class="hs-identifier hs-var hs-var">sized_n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Word64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870552"><span class="hs-identifier hs-var">truncated</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-439"></span><span>    </span><span id="local-6989586621682870552"><span class="annot"><span class="annottext">truncated :: Integer
</span><a href="#local-6989586621682870552"><span class="hs-identifier hs-var hs-var">truncated</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Integer -&gt; Integer
</span><a href="GHC.Cmm.Type.html#narrowU"><span class="hs-identifier hs-var">narrowU</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870550"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870549"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-440"></span><span>    </span><span id="local-6989586621682870553"><span class="annot"><span class="annottext">trailing_zeros :: Int
</span><a href="#local-6989586621682870553"><span class="hs-identifier hs-var hs-var">trailing_zeros</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Int
forall b. FiniteBits b =&gt; b -&gt; Int
</span><span class="hs-identifier hs-var">countTrailingZeros</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682870551"><span class="hs-identifier hs-var">sized_n</span></a></span><span>
</span><span id="line-441"></span><span>
</span><span id="line-442"></span><span class="hs-comment">-- |  Logical (immediate)</span><span>
</span><span id="line-443"></span><span class="hs-comment">-- Allows encoding of some repeated bitpatterns</span><span>
</span><span id="line-444"></span><span class="hs-comment">-- Used with AND, EOR, ORR</span><span>
</span><span id="line-445"></span><span class="hs-comment">-- and their aliases which includes at least MOV (bitmask immediate)</span><span>
</span><span id="line-446"></span><span class="hs-comment">-- See Note [Aarch64 immediates]</span><span>
</span><span id="line-447"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getBitmaskImm"><span class="hs-identifier hs-type">getBitmaskImm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#Width"><span class="hs-identifier hs-type">Width</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#Operand"><span class="hs-identifier hs-type">Operand</span></a></span><span>
</span><span id="line-448"></span><span id="getBitmaskImm"><span class="annot"><span class="annottext">getBitmaskImm :: Integer -&gt; Width -&gt; Maybe Operand
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getBitmaskImm"><span class="hs-identifier hs-var hs-var">getBitmaskImm</span></a></span></span><span> </span><span id="local-6989586621682870555"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870555"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682870556"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870556"><span class="hs-identifier hs-var">w</span></a></span></span><span>
</span><span id="line-449"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Integer -&gt; Bool
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#isAArch64Bitmask"><span class="hs-identifier hs-var">isAArch64Bitmask</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Width
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#opRegWidth"><span class="hs-identifier hs-var">opRegWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870556"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870559"><span class="hs-identifier hs-var">truncated</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Maybe Operand
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Operand -&gt; Maybe Operand) -&gt; Operand -&gt; Maybe Operand
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870559"><span class="hs-identifier hs-var">truncated</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-450"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Operand
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-451"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-452"></span><span>    </span><span id="local-6989586621682870559"><span class="annot"><span class="annottext">truncated :: Integer
</span><a href="#local-6989586621682870559"><span class="hs-identifier hs-var hs-var">truncated</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Integer -&gt; Integer
</span><a href="GHC.Cmm.Type.html#narrowU"><span class="hs-identifier hs-var">narrowU</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870556"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870555"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-453"></span><span>
</span><span id="line-454"></span><span class="hs-comment">-- | Load/store immediate.</span><span>
</span><span id="line-455"></span><span class="hs-comment">-- Depends on the width of the store to some extent.</span><span>
</span><span id="line-456"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#isOffsetImm"><span class="hs-identifier hs-type">isOffsetImm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#Width"><span class="hs-identifier hs-type">Width</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-457"></span><span id="isOffsetImm"><span class="annot"><span class="annottext">isOffsetImm :: Int -&gt; Width -&gt; Bool
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#isOffsetImm"><span class="hs-identifier hs-var hs-var">isOffsetImm</span></a></span></span><span> </span><span id="local-6989586621682870561"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682870561"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span id="local-6989586621682870562"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870562"><span class="hs-identifier hs-var">w</span></a></span></span><span>
</span><span id="line-458"></span><span>  </span><span class="hs-comment">-- 8 bits + sign for unscaled offsets</span><span>
</span><span id="line-459"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">256</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682870561"><span class="hs-identifier hs-var">off</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682870561"><span class="hs-identifier hs-var">off</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">255</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-460"></span><span>  </span><span class="hs-comment">-- Offset using 12-bit positive immediate, scaled by width</span><span>
</span><span id="line-461"></span><span>  </span><span class="hs-comment">-- LDR/STR: imm12: if reg is 32bit: 0 -- 16380 in multiples of 4</span><span>
</span><span id="line-462"></span><span>  </span><span class="hs-comment">-- LDR/STR: imm12: if reg is 64bit: 0 -- 32760 in multiples of 8</span><span>
</span><span id="line-463"></span><span>  </span><span class="hs-comment">-- 16-bit: 0 .. 8188, 8-bit: 0 -- 4095</span><span>
</span><span id="line-464"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682870561"><span class="hs-identifier hs-var">off</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682870561"><span class="hs-identifier hs-var">off</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4096</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682870564"><span class="hs-identifier hs-var">byte_width</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682870561"><span class="hs-identifier hs-var">off</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682870564"><span class="hs-identifier hs-var">byte_width</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-465"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-466"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-467"></span><span>    </span><span id="local-6989586621682870564"><span class="annot"><span class="annottext">byte_width :: Int
</span><a href="#local-6989586621682870564"><span class="hs-identifier hs-var hs-var">byte_width</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Int
</span><a href="GHC.Cmm.Type.html#widthInBytes"><span class="hs-identifier hs-var">widthInBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870562"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-468"></span><span>
</span><span id="line-469"></span><span>
</span><span id="line-470"></span><span>
</span><span id="line-471"></span><span>
</span><span id="line-472"></span><span class="hs-comment">-- TODO OPT: we might be able give getRegister</span><span>
</span><span id="line-473"></span><span class="hs-comment">--          a hint, what kind of register we want.</span><span>
</span><span id="line-474"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getFloatReg"><span class="hs-identifier hs-type">getFloatReg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Platform.Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Format.html#Format"><span class="hs-identifier hs-type">Format</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-475"></span><span id="getFloatReg"><span class="annot"><span class="annottext">getFloatReg :: HasDebugCallStack =&gt; CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getFloatReg"><span class="hs-identifier hs-var hs-var">getFloatReg</span></a></span></span><span> </span><span id="local-6989586621682870581"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870581"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-476"></span><span>  </span><span id="local-6989586621682870582"><span class="annot"><a href="#local-6989586621682870582"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM Register
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegister"><span class="hs-identifier hs-var">getRegister</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870581"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-477"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682870582"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-478"></span><span>    </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span id="local-6989586621682870583"><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682870583"><span class="hs-identifier hs-var">rep</span></a></span></span><span> </span><span id="local-6989586621682870584"><span class="annot"><span class="annottext">Reg -&gt; OrdList Instr
</span><a href="#local-6989586621682870584"><span class="hs-identifier hs-var">code</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Format -&gt; Bool
</span><a href="GHC.CmmToAsm.Format.html#isFloatFormat"><span class="hs-identifier hs-var">isFloatFormat</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682870583"><span class="hs-identifier hs-var">rep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-479"></span><span>      </span><span id="local-6989586621682870586"><span class="annot"><a href="#local-6989586621682870586"><span class="hs-identifier hs-var">tmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Format -&gt; NatM Reg
</span><a href="GHC.CmmToAsm.Monad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682870583"><span class="hs-identifier hs-var">rep</span></a></span><span>
</span><span id="line-480"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682870586"><span class="hs-identifier hs-type">tmp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682870583"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682870584"><span class="hs-identifier hs-type">code</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870586"><span class="hs-identifier hs-type">tmp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-481"></span><span>    </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="GHC.CmmToAsm.Format.html#II32"><span class="hs-identifier hs-var">II32</span></a></span><span> </span><span id="local-6989586621682870588"><span class="annot"><span class="annottext">Reg -&gt; OrdList Instr
</span><a href="#local-6989586621682870588"><span class="hs-identifier hs-var">code</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-482"></span><span>      </span><span id="local-6989586621682870589"><span class="annot"><a href="#local-6989586621682870589"><span class="hs-identifier hs-var">tmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Format -&gt; NatM Reg
</span><a href="GHC.CmmToAsm.Monad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="GHC.CmmToAsm.Format.html#FF32"><span class="hs-identifier hs-var">FF32</span></a></span><span>
</span><span id="line-483"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682870589"><span class="hs-identifier hs-type">tmp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Format.html#FF32"><span class="hs-identifier hs-type">FF32</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682870588"><span class="hs-identifier hs-type">code</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870589"><span class="hs-identifier hs-type">tmp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-484"></span><span>    </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="GHC.CmmToAsm.Format.html#II64"><span class="hs-identifier hs-var">II64</span></a></span><span> </span><span id="local-6989586621682870592"><span class="annot"><span class="annottext">Reg -&gt; OrdList Instr
</span><a href="#local-6989586621682870592"><span class="hs-identifier hs-var">code</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-485"></span><span>      </span><span id="local-6989586621682870593"><span class="annot"><a href="#local-6989586621682870593"><span class="hs-identifier hs-var">tmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Format -&gt; NatM Reg
</span><a href="GHC.CmmToAsm.Monad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="GHC.CmmToAsm.Format.html#FF64"><span class="hs-identifier hs-var">FF64</span></a></span><span>
</span><span id="line-486"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682870593"><span class="hs-identifier hs-type">tmp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Format.html#FF64"><span class="hs-identifier hs-type">FF64</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682870592"><span class="hs-identifier hs-type">code</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870593"><span class="hs-identifier hs-type">tmp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-487"></span><span>    </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span id="local-6989586621682870595"><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682870595"><span class="hs-identifier hs-var">_w</span></a></span></span><span> </span><span id="local-6989586621682870596"><span class="annot"><span class="annottext">Reg -&gt; OrdList Instr
</span><a href="#local-6989586621682870596"><span class="hs-identifier hs-var">_code</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-488"></span><span>      </span><span id="local-6989586621682870597"><span class="annot"><a href="#local-6989586621682870597"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NatM NCGConfig
</span><a href="GHC.CmmToAsm.Monad.html#getConfig"><span class="hs-identifier hs-var">getConfig</span></a></span><span>
</span><span id="line-489"></span><span>      </span><span class="annot"><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-type">pprPanic</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;can't do getFloatReg on&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-type">pdoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Config.html#ncgPlatform"><span class="hs-identifier hs-var">ncgPlatform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870597"><span class="hs-identifier hs-type">config</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682870581"><span class="hs-identifier hs-type">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-490"></span><span>    </span><span class="hs-comment">-- can't do much for fixed.</span><span>
</span><span id="line-491"></span><span>    </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Fixed"><span class="hs-identifier hs-type">Fixed</span></a></span><span> </span><span id="local-6989586621682870598"><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682870598"><span class="hs-identifier hs-var">rep</span></a></span></span><span> </span><span id="local-6989586621682870599"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870599"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span id="local-6989586621682870600"><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870600"><span class="hs-identifier hs-var">code</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-492"></span><span>      </span><span class="annot"><span class="annottext">(Reg, Format, OrdList Instr) -&gt; NatM (Reg, Format, OrdList Instr)
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870599"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682870598"><span class="hs-identifier hs-var">rep</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870600"><span class="hs-identifier hs-var">code</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-493"></span><span>
</span><span id="line-494"></span><span class="hs-comment">-- TODO: TODO, bounds. We can't put any immediate</span><span>
</span><span id="line-495"></span><span class="hs-comment">-- value in. They are constrained.</span><span>
</span><span id="line-496"></span><span class="hs-comment">-- See Ticket 19911</span><span>
</span><span id="line-497"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#litToImm%27"><span class="hs-identifier hs-type">litToImm'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#Operand"><span class="hs-identifier hs-type">Operand</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-498"></span><span id="litToImm%27"><span class="annot"><span class="annottext">litToImm' :: CmmLit -&gt; NatM (Operand, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#litToImm%27"><span class="hs-identifier hs-var hs-var">litToImm'</span></a></span></span><span> </span><span id="local-6989586621682870602"><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682870602"><span class="hs-identifier hs-var">lit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Operand, OrdList Instr) -&gt; NatM (Operand, OrdList Instr)
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmLit -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#litToImm"><span class="hs-identifier hs-var">litToImm</span></a></span><span> </span><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682870602"><span class="hs-identifier hs-var">lit</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
forall a. OrdList a
</span><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-var">nilOL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-499"></span><span>
</span><span id="line-500"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegister"><span class="hs-identifier hs-type">getRegister</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a></span><span>
</span><span id="line-501"></span><span id="getRegister"><span class="annot"><span class="annottext">getRegister :: CmmExpr -&gt; NatM Register
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegister"><span class="hs-identifier hs-var hs-var">getRegister</span></a></span></span><span> </span><span id="local-6989586621682870604"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870604"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-502"></span><span>  </span><span id="local-6989586621682870605"><span class="annot"><a href="#local-6989586621682870605"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NatM NCGConfig
</span><a href="GHC.CmmToAsm.Monad.html#getConfig"><span class="hs-identifier hs-var">getConfig</span></a></span><span>
</span><span id="line-503"></span><span>  </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegister%27"><span class="hs-identifier hs-type">getRegister'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870605"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Config.html#ncgPlatform"><span class="hs-identifier hs-var">ncgPlatform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870605"><span class="hs-identifier hs-type">config</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682870604"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-504"></span><span>
</span><span id="line-505"></span><span class="hs-comment">-- | The register width to be used for an operation on the given width</span><span>
</span><span id="line-506"></span><span class="hs-comment">-- operand.</span><span>
</span><span id="line-507"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#opRegWidth"><span class="hs-identifier hs-type">opRegWidth</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#Width"><span class="hs-identifier hs-type">Width</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#Width"><span class="hs-identifier hs-type">Width</span></a></span><span>
</span><span id="line-508"></span><span id="opRegWidth"><span class="annot"><span class="annottext">opRegWidth :: Width -&gt; Width
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#opRegWidth"><span class="hs-identifier hs-var hs-var">opRegWidth</span></a></span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span>  </span><span class="hs-comment">-- x</span><span>
</span><span id="line-509"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#opRegWidth"><span class="hs-identifier hs-var">opRegWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span>  </span><span class="hs-comment">-- w</span><span>
</span><span id="line-510"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#opRegWidth"><span class="hs-identifier hs-var">opRegWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W16"><span class="hs-identifier hs-var">W16</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span>  </span><span class="hs-comment">-- w</span><span>
</span><span id="line-511"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#opRegWidth"><span class="hs-identifier hs-var">opRegWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W8"><span class="hs-identifier hs-var">W8</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span>  </span><span class="hs-comment">-- w</span><span>
</span><span id="line-512"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#opRegWidth"><span class="hs-identifier hs-var">opRegWidth</span></a></span><span> </span><span id="local-6989586621682870611"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870611"><span class="hs-identifier hs-var">w</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; Width
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;opRegWidth&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Unsupported width&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870611"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-513"></span><span>
</span><span id="line-514"></span><span class="hs-comment">-- Note [Signed arithmetic on AArch64]</span><span>
</span><span id="line-515"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-516"></span><span class="hs-comment">-- Handling signed arithmetic on sub-word-size values on AArch64 is a bit</span><span>
</span><span id="line-517"></span><span class="hs-comment">-- tricky as Cmm's type system does not capture signedness. While 32-bit values</span><span>
</span><span id="line-518"></span><span class="hs-comment">-- are fairly easy to handle due to AArch64's 32-bit instruction variants</span><span>
</span><span id="line-519"></span><span class="hs-comment">-- (denoted by use of %wN registers), 16- and 8-bit values require quite some</span><span>
</span><span id="line-520"></span><span class="hs-comment">-- care.</span><span>
</span><span id="line-521"></span><span class="hs-comment">--</span><span>
</span><span id="line-522"></span><span class="hs-comment">-- We handle 16-and 8-bit values by using the 32-bit operations and</span><span>
</span><span id="line-523"></span><span class="hs-comment">-- sign-/zero-extending operands and truncate results as necessary. For</span><span>
</span><span id="line-524"></span><span class="hs-comment">-- simplicity we maintain the invariant that a register containing a</span><span>
</span><span id="line-525"></span><span class="hs-comment">-- sub-word-size value always contains the zero-extended form of that value</span><span>
</span><span id="line-526"></span><span class="hs-comment">-- in between operations.</span><span>
</span><span id="line-527"></span><span class="hs-comment">--</span><span>
</span><span id="line-528"></span><span class="hs-comment">-- For instance, consider the program,</span><span>
</span><span id="line-529"></span><span class="hs-comment">--</span><span>
</span><span id="line-530"></span><span class="hs-comment">--    test(bits64 buffer)</span><span>
</span><span id="line-531"></span><span class="hs-comment">--      bits8 a = bits8[buffer];</span><span>
</span><span id="line-532"></span><span class="hs-comment">--      bits8 b = %mul(a, 42);</span><span>
</span><span id="line-533"></span><span class="hs-comment">--      bits8 c = %not(b);</span><span>
</span><span id="line-534"></span><span class="hs-comment">--      bits8 d = %shrl(c, 4::bits8);</span><span>
</span><span id="line-535"></span><span class="hs-comment">--      return (d);</span><span>
</span><span id="line-536"></span><span class="hs-comment">--    }</span><span>
</span><span id="line-537"></span><span class="hs-comment">--</span><span>
</span><span id="line-538"></span><span class="hs-comment">-- This program begins by loading `a` from memory, for which we use a</span><span>
</span><span id="line-539"></span><span class="hs-comment">-- zero-extended byte-size load.  We next sign-extend `a` to 32-bits, and use a</span><span>
</span><span id="line-540"></span><span class="hs-comment">-- 32-bit multiplication to compute `b`, and truncate the result back down to</span><span>
</span><span id="line-541"></span><span class="hs-comment">-- 8-bits.</span><span>
</span><span id="line-542"></span><span class="hs-comment">--</span><span>
</span><span id="line-543"></span><span class="hs-comment">-- Next we compute `c`: The `%not` requires no extension of its operands, but</span><span>
</span><span id="line-544"></span><span class="hs-comment">-- we must still truncate the result back down to 8-bits. Finally the `%shrl`</span><span>
</span><span id="line-545"></span><span class="hs-comment">-- requires no extension and no truncate since we can assume that</span><span>
</span><span id="line-546"></span><span class="hs-comment">-- `c` is zero-extended.</span><span>
</span><span id="line-547"></span><span class="hs-comment">--</span><span>
</span><span id="line-548"></span><span class="hs-comment">-- TODO:</span><span>
</span><span id="line-549"></span><span class="hs-comment">--   Don't use Width in Operands</span><span>
</span><span id="line-550"></span><span class="hs-comment">--   Instructions should rather carry a RegWidth</span><span>
</span><span id="line-551"></span><span class="hs-comment">--</span><span>
</span><span id="line-552"></span><span class="hs-comment">-- Note [Handling PIC on AArch64]</span><span>
</span><span id="line-553"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-554"></span><span class="hs-comment">-- AArch64 does not have a special PIC register, the general approach is to</span><span>
</span><span id="line-555"></span><span class="hs-comment">-- simply go through the GOT, and there is assembly support for this:</span><span>
</span><span id="line-556"></span><span class="hs-comment">--</span><span>
</span><span id="line-557"></span><span class="hs-comment">--   // Load the address of 'sym' from the GOT using ADRP and LDR (used for</span><span>
</span><span id="line-558"></span><span class="hs-comment">--   // position-independent code on AArch64):</span><span>
</span><span id="line-559"></span><span class="hs-comment">--   adrp x0, #:got:sym</span><span>
</span><span id="line-560"></span><span class="hs-comment">--   ldr x0, [x0, #:got_lo12:sym]</span><span>
</span><span id="line-561"></span><span class="hs-comment">--</span><span>
</span><span id="line-562"></span><span class="hs-comment">-- See also: https://developer.arm.com/documentation/dui0774/i/armclang-integrated-assembler-directives/assembly-expressions</span><span>
</span><span id="line-563"></span><span class="hs-comment">--</span><span>
</span><span id="line-564"></span><span class="hs-comment">-- CmmGlobal @PicBaseReg@'s are generated in @GHC.CmmToAsm.PIC@ in the</span><span>
</span><span id="line-565"></span><span class="hs-comment">-- @cmmMakePicReference@.  This is in turn called from @cmmMakeDynamicReference@</span><span>
</span><span id="line-566"></span><span class="hs-comment">-- also in @Cmm.CmmToAsm.PIC@ from where it is also exported.  There are two</span><span>
</span><span id="line-567"></span><span class="hs-comment">-- callsites for this. One is in this module to produce the @target@ in @genCCall@</span><span>
</span><span id="line-568"></span><span class="hs-comment">-- the other is in @GHC.CmmToAsm@ in @cmmExprNative@.</span><span>
</span><span id="line-569"></span><span class="hs-comment">--</span><span>
</span><span id="line-570"></span><span class="hs-comment">-- Conceptually we do not want any special PicBaseReg to be used on AArch64. If</span><span>
</span><span id="line-571"></span><span class="hs-comment">-- we want to distinguish between symbol loading, we need to address this through</span><span>
</span><span id="line-572"></span><span class="hs-comment">-- the way we load it, not through a register.</span><span>
</span><span id="line-573"></span><span class="hs-comment">--</span><span>
</span><span id="line-574"></span><span>
</span><span id="line-575"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegister%27"><span class="hs-identifier hs-type">getRegister'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Config.html#NCGConfig"><span class="hs-identifier hs-type">NCGConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a></span><span>
</span><span id="line-576"></span><span class="hs-comment">-- OPTIMIZATION WARNING: CmmExpr rewrites</span><span>
</span><span id="line-577"></span><span class="hs-comment">-- 1. Rewrite: Reg + (-n) =&gt; Reg - n</span><span>
</span><span id="line-578"></span><span class="hs-comment">--    TODO: this expression shouldn't even be generated to begin with.</span><span>
</span><span id="line-579"></span><span id="getRegister%27"><span class="annot"><span class="annottext">getRegister' :: NCGConfig -&gt; Platform -&gt; CmmExpr -&gt; NatM Register
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegister%27"><span class="hs-identifier hs-var hs-var">getRegister'</span></a></span></span><span> </span><span id="local-6989586621682870613"><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682870613"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621682870614"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682870614"><span class="hs-identifier hs-var">plat</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-type">CmmMachOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Add"><span class="hs-identifier hs-type">MO_Add</span></a></span><span> </span><span id="local-6989586621682870617"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870617"><span class="hs-identifier hs-var">w0</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682870618"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870618"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-type">CmmInt</span></a></span><span> </span><span id="local-6989586621682870619"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870619"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682870620"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870620"><span class="hs-identifier hs-var">w1</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870619"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-580"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; Platform -&gt; CmmExpr -&gt; NatM Register
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegister%27"><span class="hs-identifier hs-var">getRegister'</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682870613"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682870614"><span class="hs-identifier hs-var">plat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MachOp -&gt; [CmmExpr] -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; MachOp
</span><a href="GHC.Cmm.MachOp.html#MO_Sub"><span class="hs-identifier hs-var">MO_Sub</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870617"><span class="hs-identifier hs-var">w0</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870618"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CmmLit -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Width -&gt; CmmLit
</span><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870619"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870620"><span class="hs-identifier hs-var">w1</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-581"></span><span>
</span><span id="line-582"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegister%27"><span class="hs-identifier hs-var">getRegister'</span></a></span><span> </span><span id="local-6989586621682870622"><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682870622"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621682870623"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682870623"><span class="hs-identifier hs-var">plat</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-type">CmmMachOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Sub"><span class="hs-identifier hs-type">MO_Sub</span></a></span><span> </span><span id="local-6989586621682870624"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870624"><span class="hs-identifier hs-var">w0</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682870625"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870625"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-type">CmmInt</span></a></span><span> </span><span id="local-6989586621682870626"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870626"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682870627"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870627"><span class="hs-identifier hs-var">w1</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870626"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-583"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; Platform -&gt; CmmExpr -&gt; NatM Register
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegister%27"><span class="hs-identifier hs-var">getRegister'</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682870622"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682870623"><span class="hs-identifier hs-var">plat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MachOp -&gt; [CmmExpr] -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; MachOp
</span><a href="GHC.Cmm.MachOp.html#MO_Add"><span class="hs-identifier hs-var">MO_Add</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870624"><span class="hs-identifier hs-var">w0</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870625"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CmmLit -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Width -&gt; CmmLit
</span><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870626"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870627"><span class="hs-identifier hs-var">w1</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-584"></span><span>
</span><span id="line-585"></span><span>
</span><span id="line-586"></span><span class="hs-comment">-- Generic case.</span><span>
</span><span id="line-587"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegister%27"><span class="hs-identifier hs-var">getRegister'</span></a></span><span> </span><span id="local-6989586621682870628"><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682870628"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621682870629"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682870629"><span class="hs-identifier hs-var">plat</span></a></span></span><span> </span><span id="local-6989586621682870630"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span></span><span>
</span><span id="line-588"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-589"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Reg.html#CmmGlobal"><span class="hs-identifier hs-type">CmmGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Reg.html#GlobalRegUse"><span class="hs-identifier hs-type">GlobalRegUse</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalReg
</span><a href="GHC.Cmm.Reg.html#PicBaseReg"><span class="hs-identifier hs-var">PicBaseReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-590"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; NatM Register
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getRegisterReg-memory&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalReg -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">(GlobalReg -&gt; SDoc) -&gt; GlobalReg -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GlobalReg
</span><a href="GHC.Cmm.Reg.html#PicBaseReg"><span class="hs-identifier hs-var">PicBaseReg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-591"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span id="local-6989586621682870633"><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682870633"><span class="hs-identifier hs-var">lit</span></a></span></span><span>
</span><span id="line-592"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682870633"><span class="hs-identifier hs-var">lit</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-593"></span><span>
</span><span id="line-594"></span><span>        </span><span class="hs-comment">-- Use wzr xzr for CmmInt 0 if the width matches up, otherwise do a move.</span><span>
</span><span id="line-595"></span><span>        </span><span class="hs-comment">-- TODO: Reenable after https://gitlab.haskell.org/ghc/ghc/-/issues/23632 is fixed.</span><span>
</span><span id="line-596"></span><span>        </span><span class="hs-comment">-- CmmInt 0 W32 -&gt; do</span><span>
</span><span id="line-597"></span><span>        </span><span class="hs-comment">--   let format = intFormat W32</span><span>
</span><span id="line-598"></span><span>        </span><span class="hs-comment">--   return (Fixed format reg_zero (unitOL $ (COMMENT ((text . show $ expr))) ))</span><span>
</span><span id="line-599"></span><span>        </span><span class="hs-comment">-- CmmInt 0 W64 -&gt; do</span><span>
</span><span id="line-600"></span><span>        </span><span class="hs-comment">--   let format = intFormat W64</span><span>
</span><span id="line-601"></span><span>        </span><span class="hs-comment">--   return (Fixed format reg_zero (unitOL $ (COMMENT ((text . show $ expr))) ))</span><span>
</span><span id="line-602"></span><span>        </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-type">CmmInt</span></a></span><span> </span><span id="local-6989586621682870634"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870634"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W8"><span class="hs-identifier hs-var">W8</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870634"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-603"></span><span>          </span><span class="annot"><span class="annottext">Register -&gt; NatM Register
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Format -&gt; (Reg -&gt; OrdList Instr) -&gt; Register
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W8"><span class="hs-identifier hs-var">W8</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682870636"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870636"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; OrdList Instr) -&gt; Instr -&gt; OrdList Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W8"><span class="hs-identifier hs-var">W8</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870636"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Integer -&gt; Integer
</span><a href="GHC.Cmm.Type.html#narrowU"><span class="hs-identifier hs-var">narrowU</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W8"><span class="hs-identifier hs-var">W8</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870634"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-604"></span><span>        </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-type">CmmInt</span></a></span><span> </span><span id="local-6989586621682870638"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870638"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W16"><span class="hs-identifier hs-var">W16</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870638"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-605"></span><span>          </span><span class="annot"><span class="annottext">Register -&gt; NatM Register
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Format -&gt; (Reg -&gt; OrdList Instr) -&gt; Register
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W16"><span class="hs-identifier hs-var">W16</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682870639"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870639"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; OrdList Instr) -&gt; Instr -&gt; OrdList Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W16"><span class="hs-identifier hs-var">W16</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870639"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Integer -&gt; Integer
</span><a href="GHC.Cmm.Type.html#narrowU"><span class="hs-identifier hs-var">narrowU</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W16"><span class="hs-identifier hs-var">W16</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870638"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-606"></span><span>
</span><span id="line-607"></span><span>        </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-type">CmmInt</span></a></span><span> </span><span id="local-6989586621682870640"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870640"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W8"><span class="hs-identifier hs-var">W8</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-608"></span><span>          </span><span class="annot"><span class="annottext">Register -&gt; NatM Register
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Format -&gt; (Reg -&gt; OrdList Instr) -&gt; Register
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W8"><span class="hs-identifier hs-var">W8</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682870641"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870641"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; OrdList Instr) -&gt; Instr -&gt; OrdList Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W8"><span class="hs-identifier hs-var">W8</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870641"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Integer -&gt; Integer
</span><a href="GHC.Cmm.Type.html#narrowU"><span class="hs-identifier hs-var">narrowU</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W8"><span class="hs-identifier hs-var">W8</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870640"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-609"></span><span>        </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-type">CmmInt</span></a></span><span> </span><span id="local-6989586621682870642"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870642"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W16"><span class="hs-identifier hs-var">W16</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-610"></span><span>          </span><span class="annot"><span class="annottext">Register -&gt; NatM Register
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Format -&gt; (Reg -&gt; OrdList Instr) -&gt; Register
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W16"><span class="hs-identifier hs-var">W16</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682870643"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870643"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; OrdList Instr) -&gt; Instr -&gt; OrdList Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W16"><span class="hs-identifier hs-var">W16</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870643"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Integer -&gt; Integer
</span><a href="GHC.Cmm.Type.html#narrowU"><span class="hs-identifier hs-var">narrowU</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W16"><span class="hs-identifier hs-var">W16</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870642"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-611"></span><span>
</span><span id="line-612"></span><span>        </span><span class="hs-comment">-- We need to be careful to not shorten this for negative literals.</span><span>
</span><span id="line-613"></span><span>        </span><span class="hs-comment">-- Those need the upper bits set. We'd either have to explicitly sign</span><span>
</span><span id="line-614"></span><span>        </span><span class="hs-comment">-- or figure out something smarter. Lowered to</span><span>
</span><span id="line-615"></span><span>        </span><span class="hs-comment">-- `MOV dst XZR`</span><span>
</span><span id="line-616"></span><span>        </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-type">CmmInt</span></a></span><span> </span><span id="local-6989586621682870644"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870644"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682870645"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870645"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870644"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-617"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682870646"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682870646"><span class="hs-identifier hs-var">imm_op</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Width -&gt; Maybe Operand
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getMovWideImm"><span class="hs-identifier hs-var">getMovWideImm</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870644"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870645"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-618"></span><span>          </span><span class="annot"><span class="annottext">Register -&gt; NatM Register
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Format -&gt; (Reg -&gt; OrdList Instr) -&gt; Register
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870645"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682870647"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870647"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; OrdList Instr) -&gt; Instr -&gt; OrdList Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#MOVZ"><span class="hs-identifier hs-var">MOVZ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870645"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870647"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682870646"><span class="hs-identifier hs-var">imm_op</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-619"></span><span>
</span><span id="line-620"></span><span>        </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-type">CmmInt</span></a></span><span> </span><span id="local-6989586621682870649"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870649"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682870650"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870650"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Integer -&gt; Bool
</span><a href="#local-6989586621682870651"><span class="hs-identifier hs-var">isNbitEncodeable</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870649"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870649"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-621"></span><span>          </span><span class="annot"><span class="annottext">Register -&gt; NatM Register
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Format -&gt; (Reg -&gt; OrdList Instr) -&gt; Register
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870650"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682870652"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870652"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; OrdList Instr) -&gt; Instr -&gt; OrdList Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W16"><span class="hs-identifier hs-var">W16</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870652"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870649"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-622"></span><span>
</span><span id="line-623"></span><span>        </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-type">CmmInt</span></a></span><span> </span><span id="local-6989586621682870653"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870653"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682870654"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870654"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Integer -&gt; Bool
</span><a href="#local-6989586621682870651"><span class="hs-identifier hs-var">isNbitEncodeable</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">32</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870653"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870653"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-624"></span><span>          </span><span class="hs-keyword">let</span><span>  </span><span id="local-6989586621682870655"><span class="annot"><span class="annottext">half0 :: Int
</span><a href="#local-6989586621682870655"><span class="hs-identifier hs-var hs-var">half0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Word16
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870653"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span class="hs-special">)</span><span>
</span><span id="line-625"></span><span>               </span><span id="local-6989586621682870656"><span class="annot"><span class="annottext">half1 :: Int
</span><a href="#local-6989586621682870656"><span class="hs-identifier hs-var hs-var">half1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Word16
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870653"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Int -&gt; Integer
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="GHC.Prelude.Basic.html#shiftR"><span class="hs-operator hs-var">`shiftR`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span class="hs-special">)</span><span>
</span><span id="line-626"></span><span>          </span><span class="annot"><span class="annottext">Register -&gt; NatM Register
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Format -&gt; (Reg -&gt; OrdList Instr) -&gt; Register
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870654"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682870657"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870657"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Instr] -&gt; OrdList Instr
forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-627"></span><span>                                                  </span><span class="annot"><span class="annottext">(Instr -&gt; Instr) -&gt; Instr -&gt; Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870657"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682870655"><span class="hs-identifier hs-var">half0</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-628"></span><span>                                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#MOVK"><span class="hs-identifier hs-var">MOVK</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870657"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; ShiftMode -&gt; Int -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImmShift"><span class="hs-identifier hs-var">OpImmShift</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682870656"><span class="hs-identifier hs-var">half1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ShiftMode
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SLSL"><span class="hs-identifier hs-var">SLSL</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16</span></span><span class="hs-special">)</span><span>
</span><span id="line-629"></span><span>                                                  </span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-630"></span><span>        </span><span class="hs-comment">-- fallback for W32</span><span>
</span><span id="line-631"></span><span>        </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-type">CmmInt</span></a></span><span> </span><span id="local-6989586621682870660"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870660"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-632"></span><span>          </span><span class="hs-keyword">let</span><span>  </span><span id="local-6989586621682870661"><span class="annot"><span class="annottext">half0 :: Int
</span><a href="#local-6989586621682870661"><span class="hs-identifier hs-var hs-var">half0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Word16
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870660"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span class="hs-special">)</span><span>
</span><span id="line-633"></span><span>               </span><span id="local-6989586621682870662"><span class="annot"><span class="annottext">half1 :: Int
</span><a href="#local-6989586621682870662"><span class="hs-identifier hs-var hs-var">half1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Word16
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870660"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Int -&gt; Integer
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="GHC.Prelude.Basic.html#shiftR"><span class="hs-operator hs-var">`shiftR`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span class="hs-special">)</span><span>
</span><span id="line-634"></span><span>          </span><span class="annot"><span class="annottext">Register -&gt; NatM Register
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Format -&gt; (Reg -&gt; OrdList Instr) -&gt; Register
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682870663"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870663"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Instr] -&gt; OrdList Instr
forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-635"></span><span>                                                    </span><span class="annot"><span class="annottext">(Instr -&gt; Instr) -&gt; Instr -&gt; Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870663"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682870661"><span class="hs-identifier hs-var">half0</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-636"></span><span>                                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#MOVK"><span class="hs-identifier hs-var">MOVK</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870663"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; ShiftMode -&gt; Int -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImmShift"><span class="hs-identifier hs-var">OpImmShift</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682870662"><span class="hs-identifier hs-var">half1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ShiftMode
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SLSL"><span class="hs-identifier hs-var">SLSL</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16</span></span><span class="hs-special">)</span><span>
</span><span id="line-637"></span><span>                                                    </span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-638"></span><span>        </span><span class="hs-comment">-- anything else</span><span>
</span><span id="line-639"></span><span>        </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-type">CmmInt</span></a></span><span> </span><span id="local-6989586621682870664"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870664"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-640"></span><span>          </span><span class="hs-keyword">let</span><span>  </span><span id="local-6989586621682870665"><span class="annot"><span class="annottext">half0 :: Int
</span><a href="#local-6989586621682870665"><span class="hs-identifier hs-var hs-var">half0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Word16
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870664"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span class="hs-special">)</span><span>
</span><span id="line-641"></span><span>               </span><span id="local-6989586621682870666"><span class="annot"><span class="annottext">half1 :: Int
</span><a href="#local-6989586621682870666"><span class="hs-identifier hs-var hs-var">half1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Word16
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870664"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Int -&gt; Integer
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="GHC.Prelude.Basic.html#shiftR"><span class="hs-operator hs-var">`shiftR`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span class="hs-special">)</span><span>
</span><span id="line-642"></span><span>               </span><span id="local-6989586621682870667"><span class="annot"><span class="annottext">half2 :: Int
</span><a href="#local-6989586621682870667"><span class="hs-identifier hs-var hs-var">half2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Word16
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870664"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Int -&gt; Integer
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="GHC.Prelude.Basic.html#shiftR"><span class="hs-operator hs-var">`shiftR`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">32</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span class="hs-special">)</span><span>
</span><span id="line-643"></span><span>               </span><span id="local-6989586621682870668"><span class="annot"><span class="annottext">half3 :: Int
</span><a href="#local-6989586621682870668"><span class="hs-identifier hs-var hs-var">half3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Word16
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870664"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Int -&gt; Integer
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="GHC.Prelude.Basic.html#shiftR"><span class="hs-operator hs-var">`shiftR`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">48</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span class="hs-special">)</span><span>
</span><span id="line-644"></span><span>          </span><span class="annot"><span class="annottext">Register -&gt; NatM Register
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Format -&gt; (Reg -&gt; OrdList Instr) -&gt; Register
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682870669"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870669"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Instr] -&gt; OrdList Instr
forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-645"></span><span>                                                    </span><span class="annot"><span class="annottext">(Instr -&gt; Instr) -&gt; Instr -&gt; Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870669"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682870665"><span class="hs-identifier hs-var">half0</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-646"></span><span>                                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#MOVK"><span class="hs-identifier hs-var">MOVK</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870669"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; ShiftMode -&gt; Int -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImmShift"><span class="hs-identifier hs-var">OpImmShift</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682870666"><span class="hs-identifier hs-var">half1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ShiftMode
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SLSL"><span class="hs-identifier hs-var">SLSL</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16</span></span><span class="hs-special">)</span><span>
</span><span id="line-647"></span><span>                                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#MOVK"><span class="hs-identifier hs-var">MOVK</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870669"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; ShiftMode -&gt; Int -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImmShift"><span class="hs-identifier hs-var">OpImmShift</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682870667"><span class="hs-identifier hs-var">half2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ShiftMode
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SLSL"><span class="hs-identifier hs-var">SLSL</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">32</span></span><span class="hs-special">)</span><span>
</span><span id="line-648"></span><span>                                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#MOVK"><span class="hs-identifier hs-var">MOVK</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870669"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; ShiftMode -&gt; Int -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImmShift"><span class="hs-identifier hs-var">OpImmShift</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682870668"><span class="hs-identifier hs-var">half3</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ShiftMode
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SLSL"><span class="hs-identifier hs-var">SLSL</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">48</span></span><span class="hs-special">)</span><span>
</span><span id="line-649"></span><span>                                                    </span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-650"></span><span>        </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-type">CmmInt</span></a></span><span> </span><span id="local-6989586621682870670"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870670"><span class="hs-identifier hs-var">_i</span></a></span></span><span> </span><span id="local-6989586621682870671"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870671"><span class="hs-identifier hs-var">rep</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-651"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621682870672"><span class="annot"><a href="#local-6989586621682870672"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870673"><span class="annot"><a href="#local-6989586621682870673"><span class="hs-identifier hs-var">imm_code</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmLit -&gt; NatM (Operand, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#litToImm%27"><span class="hs-identifier hs-var">litToImm'</span></a></span><span> </span><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682870633"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-652"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-type">intFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870671"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682870674"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870674"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870673"><span class="hs-identifier hs-var">imm_code</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870671"><span class="hs-identifier hs-var">rep</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870674"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682870672"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-653"></span><span>
</span><span id="line-654"></span><span>        </span><span class="hs-comment">-- floatToBytes (fromRational f)</span><span>
</span><span id="line-655"></span><span>        </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmFloat"><span class="hs-identifier hs-type">CmmFloat</span></a></span><span> </span><span class="annot"><span class="annottext">Rational
</span><span class="hs-number">0</span></span><span> </span><span id="local-6989586621682870677"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870677"><span class="hs-identifier hs-var">w</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-656"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621682870678"><span class="annot"><a href="#local-6989586621682870678"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870679"><span class="annot"><a href="#local-6989586621682870679"><span class="hs-identifier hs-var">imm_code</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmLit -&gt; NatM (Operand, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#litToImm%27"><span class="hs-identifier hs-var">litToImm'</span></a></span><span> </span><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682870633"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-657"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Format.html#floatFormat"><span class="hs-identifier hs-type">floatFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870677"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682870681"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870681"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870679"><span class="hs-identifier hs-var">imm_code</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870677"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870681"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682870678"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-658"></span><span>
</span><span id="line-659"></span><span>        </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmFloat"><span class="hs-identifier hs-type">CmmFloat</span></a></span><span> </span><span id="local-6989586621682870682"><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621682870682"><span class="hs-identifier hs-var">_f</span></a></span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W8"><span class="hs-identifier hs-var">W8</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; NatM Register
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getRegister' (CmmLit:CmmFloat), no support for bytes&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; CmmExpr -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682870629"><span class="hs-identifier hs-var">plat</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-660"></span><span>        </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmFloat"><span class="hs-identifier hs-type">CmmFloat</span></a></span><span> </span><span id="local-6989586621682870683"><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621682870683"><span class="hs-identifier hs-var">_f</span></a></span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W16"><span class="hs-identifier hs-var">W16</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; NatM Register
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getRegister' (CmmLit:CmmFloat), no support for halfs&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; CmmExpr -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682870629"><span class="hs-identifier hs-var">plat</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-661"></span><span>        </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmFloat"><span class="hs-identifier hs-type">CmmFloat</span></a></span><span> </span><span id="local-6989586621682870684"><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621682870684"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-662"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682870685"><span class="annot"><span class="annottext">word :: Word32
</span><a href="#local-6989586621682870685"><span class="hs-identifier hs-var hs-var hs-var">word</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Float -&gt; Word32
</span><span class="hs-identifier hs-var">castFloatToWord32</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rational -&gt; Float
forall a. Fractional a =&gt; Rational -&gt; a
</span><span class="hs-identifier hs-var">fromRational</span></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621682870684"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word32</span></span><span>
</span><span id="line-663"></span><span>              </span><span id="local-6989586621682870687"><span class="annot"><span class="annottext">half0 :: Int
</span><a href="#local-6989586621682870687"><span class="hs-identifier hs-var hs-var hs-var">half0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; Word16
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682870685"><span class="hs-identifier hs-var">word</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span class="hs-special">)</span><span>
</span><span id="line-664"></span><span>              </span><span id="local-6989586621682870688"><span class="annot"><span class="annottext">half1 :: Int
</span><a href="#local-6989586621682870688"><span class="hs-identifier hs-var hs-var hs-var">half1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; Word16
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682870685"><span class="hs-identifier hs-var">word</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Int -&gt; Word32
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="GHC.Prelude.Basic.html#shiftR"><span class="hs-operator hs-var">`shiftR`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span class="hs-special">)</span><span>
</span><span id="line-665"></span><span>          </span><span id="local-6989586621682870689"><span class="annot"><a href="#local-6989586621682870689"><span class="hs-identifier hs-var">tmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Format -&gt; NatM Reg
</span><a href="GHC.CmmToAsm.Monad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-666"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Format.html#floatFormat"><span class="hs-identifier hs-type">floatFormat</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-type">W32</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682870690"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870690"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Instr] -&gt; OrdList Instr
forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-667"></span><span>                                                      </span><span class="annot"><span class="annottext">(Instr -&gt; Instr) -&gt; Instr -&gt; Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870689"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682870687"><span class="hs-identifier hs-var">half0</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-668"></span><span>                                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#MOVK"><span class="hs-identifier hs-var">MOVK</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870689"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; ShiftMode -&gt; Int -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImmShift"><span class="hs-identifier hs-var">OpImmShift</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682870688"><span class="hs-identifier hs-var">half1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ShiftMode
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SLSL"><span class="hs-identifier hs-var">SLSL</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16</span></span><span class="hs-special">)</span><span>
</span><span id="line-669"></span><span>                                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870690"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870689"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-670"></span><span>                                                      </span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-671"></span><span>        </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmFloat"><span class="hs-identifier hs-type">CmmFloat</span></a></span><span> </span><span id="local-6989586621682870691"><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621682870691"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-672"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682870692"><span class="annot"><span class="annottext">word :: Word64
</span><a href="#local-6989586621682870692"><span class="hs-identifier hs-var hs-var hs-var">word</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Word64
</span><span class="hs-identifier hs-var">castDoubleToWord64</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rational -&gt; Double
forall a. Fractional a =&gt; Rational -&gt; a
</span><span class="hs-identifier hs-var">fromRational</span></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621682870691"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-673"></span><span>              </span><span id="local-6989586621682870694"><span class="annot"><span class="annottext">half0 :: Int
</span><a href="#local-6989586621682870694"><span class="hs-identifier hs-var hs-var hs-var">half0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; Word16
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682870692"><span class="hs-identifier hs-var">word</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span class="hs-special">)</span><span>
</span><span id="line-674"></span><span>              </span><span id="local-6989586621682870695"><span class="annot"><span class="annottext">half1 :: Int
</span><a href="#local-6989586621682870695"><span class="hs-identifier hs-var hs-var hs-var">half1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; Word16
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682870692"><span class="hs-identifier hs-var">word</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Int -&gt; Word64
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="GHC.Prelude.Basic.html#shiftR"><span class="hs-operator hs-var">`shiftR`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span class="hs-special">)</span><span>
</span><span id="line-675"></span><span>              </span><span id="local-6989586621682870696"><span class="annot"><span class="annottext">half2 :: Int
</span><a href="#local-6989586621682870696"><span class="hs-identifier hs-var hs-var hs-var">half2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; Word16
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682870692"><span class="hs-identifier hs-var">word</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Int -&gt; Word64
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="GHC.Prelude.Basic.html#shiftR"><span class="hs-operator hs-var">`shiftR`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">32</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span class="hs-special">)</span><span>
</span><span id="line-676"></span><span>              </span><span id="local-6989586621682870697"><span class="annot"><span class="annottext">half3 :: Int
</span><a href="#local-6989586621682870697"><span class="hs-identifier hs-var hs-var hs-var">half3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; Word16
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682870692"><span class="hs-identifier hs-var">word</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Int -&gt; Word64
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="GHC.Prelude.Basic.html#shiftR"><span class="hs-operator hs-var">`shiftR`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">48</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span class="hs-special">)</span><span>
</span><span id="line-677"></span><span>          </span><span id="local-6989586621682870698"><span class="annot"><a href="#local-6989586621682870698"><span class="hs-identifier hs-var">tmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Format -&gt; NatM Reg
</span><a href="GHC.CmmToAsm.Monad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-678"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Format.html#floatFormat"><span class="hs-identifier hs-type">floatFormat</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-type">W64</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682870699"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870699"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Instr] -&gt; OrdList Instr
forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-679"></span><span>                                                      </span><span class="annot"><span class="annottext">(Instr -&gt; Instr) -&gt; Instr -&gt; Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870698"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682870694"><span class="hs-identifier hs-var">half0</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-680"></span><span>                                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#MOVK"><span class="hs-identifier hs-var">MOVK</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870698"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; ShiftMode -&gt; Int -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImmShift"><span class="hs-identifier hs-var">OpImmShift</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682870695"><span class="hs-identifier hs-var">half1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ShiftMode
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SLSL"><span class="hs-identifier hs-var">SLSL</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16</span></span><span class="hs-special">)</span><span>
</span><span id="line-681"></span><span>                                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#MOVK"><span class="hs-identifier hs-var">MOVK</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870698"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; ShiftMode -&gt; Int -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImmShift"><span class="hs-identifier hs-var">OpImmShift</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682870696"><span class="hs-identifier hs-var">half2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ShiftMode
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SLSL"><span class="hs-identifier hs-var">SLSL</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">32</span></span><span class="hs-special">)</span><span>
</span><span id="line-682"></span><span>                                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#MOVK"><span class="hs-identifier hs-var">MOVK</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870698"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; ShiftMode -&gt; Int -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImmShift"><span class="hs-identifier hs-var">OpImmShift</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682870697"><span class="hs-identifier hs-var">half3</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ShiftMode
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SLSL"><span class="hs-identifier hs-var">SLSL</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">48</span></span><span class="hs-special">)</span><span>
</span><span id="line-683"></span><span>                                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870699"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870698"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-684"></span><span>                                                      </span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-685"></span><span>        </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmFloat"><span class="hs-identifier hs-type">CmmFloat</span></a></span><span> </span><span id="local-6989586621682870700"><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621682870700"><span class="hs-identifier hs-var">_f</span></a></span></span><span> </span><span id="local-6989586621682870701"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870701"><span class="hs-identifier hs-var">_w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; NatM Register
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getRegister' (CmmLit:CmmFloat), unsupported float lit&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; CmmExpr -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682870629"><span class="hs-identifier hs-var">plat</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-686"></span><span>        </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmVec"><span class="hs-identifier hs-type">CmmVec</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmLit]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; NatM Register
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getRegister' (CmmLit:CmmVec): &quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; CmmExpr -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682870629"><span class="hs-identifier hs-var">plat</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-687"></span><span>        </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLabel"><span class="hs-identifier hs-type">CmmLabel</span></a></span><span> </span><span id="local-6989586621682870704"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682870704"><span class="hs-identifier hs-var">_lbl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-688"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621682870705"><span class="annot"><a href="#local-6989586621682870705"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870706"><span class="annot"><a href="#local-6989586621682870706"><span class="hs-identifier hs-var">imm_code</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmLit -&gt; NatM (Operand, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#litToImm%27"><span class="hs-identifier hs-var">litToImm'</span></a></span><span> </span><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682870633"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-689"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682870707"><span class="annot"><a href="#local-6989586621682870707"><span class="hs-identifier hs-var hs-var">rep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmLit -&gt; CmmType
</span><a href="GHC.Cmm.Expr.html#cmmLitType"><span class="hs-identifier hs-var">cmmLitType</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682870629"><span class="hs-identifier hs-var">plat</span></a></span><span> </span><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682870633"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-690"></span><span>              </span><span id="local-6989586621682870709"><span class="annot"><a href="#local-6989586621682870709"><span class="hs-identifier hs-var hs-var">format</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmType -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#cmmTypeFormat"><span class="hs-identifier hs-var">cmmTypeFormat</span></a></span><span> </span><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682870707"><span class="hs-identifier hs-var">rep</span></a></span><span>
</span><span id="line-691"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870709"><span class="hs-identifier hs-type">format</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682870710"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870710"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870706"><span class="hs-identifier hs-var">imm_code</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; Instr) -&gt; Instr -&gt; Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Format -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#LDR"><span class="hs-identifier hs-var">LDR</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682870709"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Format -&gt; Width
</span><a href="GHC.CmmToAsm.Format.html#formatToWidth"><span class="hs-identifier hs-var">formatToWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682870709"><span class="hs-identifier hs-var">format</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870710"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682870705"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-692"></span><span>
</span><span id="line-693"></span><span>        </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLabelOff"><span class="hs-identifier hs-type">CmmLabelOff</span></a></span><span> </span><span id="local-6989586621682870713"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682870713"><span class="hs-identifier hs-var">_lbl</span></a></span></span><span> </span><span id="local-6989586621682870714"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682870714"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Integer -&gt; Bool
</span><a href="#local-6989586621682870651"><span class="hs-identifier hs-var">isNbitEncodeable</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">12</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682870714"><span class="hs-identifier hs-var">off</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-694"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621682870715"><span class="annot"><a href="#local-6989586621682870715"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870716"><span class="annot"><a href="#local-6989586621682870716"><span class="hs-identifier hs-var">imm_code</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmLit -&gt; NatM (Operand, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#litToImm%27"><span class="hs-identifier hs-var">litToImm'</span></a></span><span> </span><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682870633"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-695"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682870717"><span class="annot"><a href="#local-6989586621682870717"><span class="hs-identifier hs-var hs-var">rep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmLit -&gt; CmmType
</span><a href="GHC.Cmm.Expr.html#cmmLitType"><span class="hs-identifier hs-var">cmmLitType</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682870629"><span class="hs-identifier hs-var">plat</span></a></span><span> </span><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682870633"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-696"></span><span>              </span><span id="local-6989586621682870718"><span class="annot"><a href="#local-6989586621682870718"><span class="hs-identifier hs-var hs-var">format</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmType -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#cmmTypeFormat"><span class="hs-identifier hs-var">cmmTypeFormat</span></a></span><span> </span><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682870717"><span class="hs-identifier hs-var">rep</span></a></span><span>
</span><span id="line-697"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870718"><span class="hs-identifier hs-type">format</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682870719"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870719"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870716"><span class="hs-identifier hs-var">imm_code</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span> </span><span class="annot"><span class="annottext">Format -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#LDR"><span class="hs-identifier hs-var">LDR</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682870718"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Format -&gt; Width
</span><a href="GHC.CmmToAsm.Format.html#formatToWidth"><span class="hs-identifier hs-var">formatToWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682870718"><span class="hs-identifier hs-var">format</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870719"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682870715"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-698"></span><span>
</span><span id="line-699"></span><span>        </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLabelOff"><span class="hs-identifier hs-type">CmmLabelOff</span></a></span><span> </span><span id="local-6989586621682870720"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682870720"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span id="local-6989586621682870721"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682870721"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-700"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621682870722"><span class="annot"><a href="#local-6989586621682870722"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870723"><span class="annot"><a href="#local-6989586621682870723"><span class="hs-identifier hs-var">imm_code</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmLit -&gt; NatM (Operand, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#litToImm%27"><span class="hs-identifier hs-var">litToImm'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLabel -&gt; CmmLit
</span><a href="GHC.Cmm.Expr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682870720"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-701"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682870724"><span class="annot"><a href="#local-6989586621682870724"><span class="hs-identifier hs-var hs-var">rep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmLit -&gt; CmmType
</span><a href="GHC.Cmm.Expr.html#cmmLitType"><span class="hs-identifier hs-var">cmmLitType</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682870629"><span class="hs-identifier hs-var">plat</span></a></span><span> </span><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682870633"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-702"></span><span>              </span><span id="local-6989586621682870725"><span class="annot"><a href="#local-6989586621682870725"><span class="hs-identifier hs-var hs-var">format</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmType -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#cmmTypeFormat"><span class="hs-identifier hs-var">cmmTypeFormat</span></a></span><span> </span><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682870724"><span class="hs-identifier hs-var">rep</span></a></span><span>
</span><span id="line-703"></span><span>              </span><span id="local-6989586621682870726"><span class="annot"><a href="#local-6989586621682870726"><span class="hs-identifier hs-var hs-var">width</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmType -&gt; Width
</span><a href="GHC.Cmm.Type.html#typeWidth"><span class="hs-identifier hs-var">typeWidth</span></a></span><span> </span><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682870724"><span class="hs-identifier hs-var">rep</span></a></span><span>
</span><span id="line-704"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621682870728"><span class="annot"><a href="#local-6989586621682870728"><span class="hs-identifier hs-var">off_r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870729"><span class="annot"><a href="#local-6989586621682870729"><span class="hs-identifier hs-var">_off_format</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870730"><span class="annot"><a href="#local-6989586621682870730"><span class="hs-identifier hs-var">off_code</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-type">getSomeReg</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-type">CmmInt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fromIntegral</span></span><span> </span><span class="annot"><a href="#local-6989586621682870721"><span class="hs-identifier hs-type">off</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682870726"><span class="hs-identifier hs-type">width</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-705"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870725"><span class="hs-identifier hs-type">format</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682870731"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870731"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870723"><span class="hs-identifier hs-var">imm_code</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870730"><span class="hs-identifier hs-var">off_code</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span> </span><span class="annot"><span class="annottext">Format -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#LDR"><span class="hs-identifier hs-var">LDR</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682870725"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Format -&gt; Width
</span><a href="GHC.CmmToAsm.Format.html#formatToWidth"><span class="hs-identifier hs-var">formatToWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682870725"><span class="hs-identifier hs-var">format</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870731"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682870722"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870726"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870731"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870726"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870731"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870726"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870728"><span class="hs-identifier hs-var">off_r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-706"></span><span>
</span><span id="line-707"></span><span>        </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLabelDiffOff"><span class="hs-identifier hs-type">CmmLabelDiffOff</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; NatM Register
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getRegister' (CmmLit:CmmLabelOff): &quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; CmmExpr -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682870629"><span class="hs-identifier hs-var">plat</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-708"></span><span>        </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmBlock"><span class="hs-identifier hs-type">CmmBlock</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; NatM Register
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getRegister' (CmmLit:CmmLabelOff): &quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; CmmExpr -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682870629"><span class="hs-identifier hs-var">plat</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-709"></span><span>        </span><span class="annot"><span class="annottext">CmmLit
</span><a href="GHC.Cmm.Expr.html#CmmHighStackMark"><span class="hs-identifier hs-var">CmmHighStackMark</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; NatM Register
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getRegister' (CmmLit:CmmLabelOff): &quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; CmmExpr -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682870629"><span class="hs-identifier hs-var">plat</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-710"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLoad"><span class="hs-identifier hs-type">CmmLoad</span></a></span><span> </span><span id="local-6989586621682870737"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870737"><span class="hs-identifier hs-var">mem</span></a></span></span><span> </span><span id="local-6989586621682870738"><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682870738"><span class="hs-identifier hs-var">rep</span></a></span></span><span> </span><span class="annot"><span class="annottext">AlignmentSpec
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-711"></span><span>      </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Amode"><span class="hs-identifier hs-type">Amode</span></a></span><span> </span><span id="local-6989586621682870740"><span class="annot"><a href="#local-6989586621682870740"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span id="local-6989586621682870741"><span class="annot"><a href="#local-6989586621682870741"><span class="hs-identifier hs-var">addr_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Width -&gt; CmmExpr -&gt; NatM Amode
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682870629"><span class="hs-identifier hs-var">plat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmType -&gt; Width
</span><a href="GHC.Cmm.Type.html#typeWidth"><span class="hs-identifier hs-var">typeWidth</span></a></span><span> </span><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682870738"><span class="hs-identifier hs-var">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870737"><span class="hs-identifier hs-var">mem</span></a></span><span>
</span><span id="line-712"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682870743"><span class="annot"><a href="#local-6989586621682870743"><span class="hs-identifier hs-var hs-var">format</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmType -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#cmmTypeFormat"><span class="hs-identifier hs-var">cmmTypeFormat</span></a></span><span> </span><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682870738"><span class="hs-identifier hs-var">rep</span></a></span><span>
</span><span id="line-713"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870743"><span class="hs-identifier hs-type">format</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682870744"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870744"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870741"><span class="hs-identifier hs-var">addr_code</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span> </span><span class="annot"><span class="annottext">Format -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#LDR"><span class="hs-identifier hs-var">LDR</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682870743"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Format -&gt; Width
</span><a href="GHC.CmmToAsm.Format.html#formatToWidth"><span class="hs-identifier hs-var">formatToWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682870743"><span class="hs-identifier hs-var">format</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870744"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddrMode -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a></span><span> </span><span class="annot"><span class="annottext">AddrMode
</span><a href="#local-6989586621682870740"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-714"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmStackSlot"><span class="hs-identifier hs-type">CmmStackSlot</span></a></span><span> </span><span class="annot"><span class="annottext">Area
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-715"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; NatM Register
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getRegister' (CmmStackSlot): &quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; CmmExpr -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682870629"><span class="hs-identifier hs-var">plat</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-716"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a></span><span> </span><span id="local-6989586621682870747"><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682870747"><span class="hs-identifier hs-var">reg</span></a></span></span><span>
</span><span id="line-717"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Register -&gt; NatM Register
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Format -&gt; Reg -&gt; OrdList Instr -&gt; Register
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Fixed"><span class="hs-identifier hs-var">Fixed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmType -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#cmmTypeFormat"><span class="hs-identifier hs-var">cmmTypeFormat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmReg -&gt; CmmType
</span><a href="GHC.Cmm.Reg.html#cmmRegType"><span class="hs-identifier hs-var">cmmRegType</span></a></span><span> </span><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682870747"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-718"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; CmmReg -&gt; Reg
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682870629"><span class="hs-identifier hs-var">plat</span></a></span><span> </span><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682870747"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-719"></span><span>                       </span><span class="annot"><span class="annottext">OrdList Instr
forall a. OrdList a
</span><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-var">nilOL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-720"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmRegOff"><span class="hs-identifier hs-type">CmmRegOff</span></a></span><span> </span><span id="local-6989586621682870749"><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682870749"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span id="local-6989586621682870750"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682870750"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-721"></span><span>      </span><span class="hs-comment">-- If we got here we will load the address into a register either way. So we might as well just expand</span><span>
</span><span id="line-722"></span><span>      </span><span class="hs-comment">-- and re-use the existing code path to handle &quot;reg + off&quot;.</span><span>
</span><span id="line-723"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682870751"><span class="annot"><span class="annottext">width :: Width
</span><a href="#local-6989586621682870751"><span class="hs-identifier hs-var hs-var">width</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmReg -&gt; Width
</span><a href="GHC.Cmm.Reg.html#cmmRegWidth"><span class="hs-identifier hs-var">cmmRegWidth</span></a></span><span> </span><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682870749"><span class="hs-identifier hs-var">reg</span></a></span><span>
</span><span id="line-724"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; Platform -&gt; CmmExpr -&gt; NatM Register
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegister%27"><span class="hs-identifier hs-var">getRegister'</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682870628"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682870629"><span class="hs-identifier hs-var">plat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MachOp -&gt; [CmmExpr] -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; MachOp
</span><a href="GHC.Cmm.MachOp.html#MO_Add"><span class="hs-identifier hs-var">MO_Add</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870751"><span class="hs-identifier hs-var">width</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CmmReg -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmReg"><span class="hs-identifier hs-var">CmmReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682870749"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CmmLit -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Width -&gt; CmmLit
</span><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682870750"><span class="hs-identifier hs-var">off</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870751"><span class="hs-identifier hs-var">width</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-725"></span><span>
</span><span id="line-726"></span><span>    </span><span class="hs-comment">-- for MachOps, see GHC.Cmm.MachOp</span><span>
</span><span id="line-727"></span><span>    </span><span class="hs-comment">-- For CmmMachOp, see GHC.Cmm.Expr</span><span>
</span><span id="line-728"></span><span>
</span><span id="line-729"></span><span>    </span><span class="hs-comment">-- Handle MO_RelaxedRead as a normal CmmLoad, to allow</span><span>
</span><span id="line-730"></span><span>    </span><span class="hs-comment">-- non-trivial addressing modes to be used.</span><span>
</span><span id="line-731"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-type">CmmMachOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_RelaxedRead"><span class="hs-identifier hs-type">MO_RelaxedRead</span></a></span><span> </span><span id="local-6989586621682870754"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870754"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682870755"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870755"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-732"></span><span>      </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM Register
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegister"><span class="hs-identifier hs-var">getRegister</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmExpr -&gt; CmmType -&gt; AlignmentSpec -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870755"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; CmmType
</span><a href="GHC.Cmm.Type.html#cmmBits"><span class="hs-identifier hs-var">cmmBits</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870754"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AlignmentSpec
</span><a href="GHC.Cmm.Expr.html#NaturallyAligned"><span class="hs-identifier hs-var">NaturallyAligned</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-733"></span><span>
</span><span id="line-734"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-type">CmmMachOp</span></a></span><span> </span><span id="local-6989586621682870758"><span class="annot"><span class="annottext">MachOp
</span><a href="#local-6989586621682870758"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621682870759"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870759"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-735"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682870760"><span class="annot"><a href="#local-6989586621682870760"><span class="hs-identifier hs-var">reg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870761"><span class="annot"><a href="#local-6989586621682870761"><span class="hs-identifier hs-var">_format</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870762"><span class="annot"><a href="#local-6989586621682870762"><span class="hs-identifier hs-var">code</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870759"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-736"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682870758"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-737"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Not"><span class="hs-identifier hs-type">MO_Not</span></a></span><span> </span><span id="local-6989586621682870764"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870764"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Register -&gt; NatM Register
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Register -&gt; NatM Register) -&gt; Register -&gt; NatM Register
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Format -&gt; (Reg -&gt; OrdList Instr) -&gt; Register
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870764"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Reg -&gt; OrdList Instr) -&gt; Register)
-&gt; (Reg -&gt; OrdList Instr) -&gt; Register
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682870765"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870765"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-738"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682870766"><span class="annot"><span class="annottext">w' :: Width
</span><a href="#local-6989586621682870766"><span class="hs-identifier hs-var hs-var">w'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#opRegWidth"><span class="hs-identifier hs-var">opRegWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870764"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-739"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870762"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span>
</span><span id="line-740"></span><span>                </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#MVN"><span class="hs-identifier hs-var">MVN</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870766"><span class="hs-identifier hs-var">w'</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870765"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870766"><span class="hs-identifier hs-var">w'</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870760"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span>
</span><span id="line-741"></span><span>                </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Reg -&gt; OrdList Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#truncateReg"><span class="hs-identifier hs-var">truncateReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870766"><span class="hs-identifier hs-var">w'</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870764"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870765"><span class="hs-identifier hs-var">dst</span></a></span><span> </span><span class="hs-comment">-- See Note [Signed arithmetic on AArch64]</span><span>
</span><span id="line-742"></span><span>
</span><span id="line-743"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_S_Neg"><span class="hs-identifier hs-type">MO_S_Neg</span></a></span><span> </span><span id="local-6989586621682870770"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870770"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Width -&gt; Reg -&gt; NatM Register
</span><a href="#local-6989586621682870771"><span class="hs-identifier hs-var">negate</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870762"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870770"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870760"><span class="hs-identifier hs-var">reg</span></a></span><span>
</span><span id="line-744"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_F_Neg"><span class="hs-identifier hs-type">MO_F_Neg</span></a></span><span> </span><span id="local-6989586621682870773"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870773"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Register -&gt; NatM Register
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Register -&gt; NatM Register) -&gt; Register -&gt; NatM Register
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Format -&gt; (Reg -&gt; OrdList Instr) -&gt; Register
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#floatFormat"><span class="hs-identifier hs-var">floatFormat</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870773"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682870774"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870774"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870762"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#NEG"><span class="hs-identifier hs-var">NEG</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870773"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870774"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870773"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870760"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-745"></span><span>
</span><span id="line-746"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_SF_Round"><span class="hs-identifier hs-type">MO_SF_Round</span></a></span><span>    </span><span id="local-6989586621682870777"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870777"><span class="hs-identifier hs-var">from</span></a></span></span><span> </span><span id="local-6989586621682870778"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870778"><span class="hs-identifier hs-var">to</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Register -&gt; NatM Register
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Register -&gt; NatM Register) -&gt; Register -&gt; NatM Register
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Format -&gt; (Reg -&gt; OrdList Instr) -&gt; Register
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#floatFormat"><span class="hs-identifier hs-var">floatFormat</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870778"><span class="hs-identifier hs-var">to</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682870779"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870779"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870762"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SCVTF"><span class="hs-identifier hs-var">SCVTF</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870778"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870779"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870777"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870760"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- (Signed ConVerT Float)</span><span>
</span><span id="line-747"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_FS_Truncate"><span class="hs-identifier hs-type">MO_FS_Truncate</span></a></span><span> </span><span id="local-6989586621682870782"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870782"><span class="hs-identifier hs-var">from</span></a></span></span><span> </span><span id="local-6989586621682870783"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870783"><span class="hs-identifier hs-var">to</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Register -&gt; NatM Register
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Register -&gt; NatM Register) -&gt; Register -&gt; NatM Register
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Format -&gt; (Reg -&gt; OrdList Instr) -&gt; Register
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870783"><span class="hs-identifier hs-var">to</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682870784"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870784"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870762"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#FCVTZS"><span class="hs-identifier hs-var">FCVTZS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870783"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870784"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870782"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870760"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- (float convert (-&gt; zero) signed)</span><span>
</span><span id="line-748"></span><span>
</span><span id="line-749"></span><span>        </span><span class="hs-comment">-- TODO this is very hacky</span><span>
</span><span id="line-750"></span><span>        </span><span class="hs-comment">-- Note, UBFM and SBFM expect source and target register to be of the same size, so we'll use @max from to@</span><span>
</span><span id="line-751"></span><span>        </span><span class="hs-comment">-- UBFM will set the high bits to 0. SBFM will copy the sign (sign extend).</span><span>
</span><span id="line-752"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_UU_Conv"><span class="hs-identifier hs-type">MO_UU_Conv</span></a></span><span> </span><span id="local-6989586621682870787"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870787"><span class="hs-identifier hs-var">from</span></a></span></span><span> </span><span id="local-6989586621682870788"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870788"><span class="hs-identifier hs-var">to</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Register -&gt; NatM Register
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Register -&gt; NatM Register) -&gt; Register -&gt; NatM Register
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Format -&gt; (Reg -&gt; OrdList Instr) -&gt; Register
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870788"><span class="hs-identifier hs-var">to</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682870789"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870789"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870762"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#UBFM"><span class="hs-identifier hs-var">UBFM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Width
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870787"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870788"><span class="hs-identifier hs-var">to</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870789"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Width
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870787"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870788"><span class="hs-identifier hs-var">to</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870760"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Operand
</span><a href="#local-6989586621682870792"><span class="hs-identifier hs-var">toImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Width
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870787"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870788"><span class="hs-identifier hs-var">to</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-753"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_SS_Conv"><span class="hs-identifier hs-type">MO_SS_Conv</span></a></span><span> </span><span id="local-6989586621682870795"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870795"><span class="hs-identifier hs-var">from</span></a></span></span><span> </span><span id="local-6989586621682870796"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870796"><span class="hs-identifier hs-var">to</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Reg -&gt; OrdList Instr -&gt; NatM Register
forall {m :: * -&gt; *}.
Monad m =&gt;
Width -&gt; Width -&gt; Reg -&gt; OrdList Instr -&gt; m Register
</span><a href="#local-6989586621682870797"><span class="hs-identifier hs-var">ss_conv</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870795"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870796"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870760"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870762"><span class="hs-identifier hs-var">code</span></a></span><span>
</span><span id="line-754"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_FF_Conv"><span class="hs-identifier hs-type">MO_FF_Conv</span></a></span><span> </span><span id="local-6989586621682870799"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870799"><span class="hs-identifier hs-var">from</span></a></span></span><span> </span><span id="local-6989586621682870800"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870800"><span class="hs-identifier hs-var">to</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Register -&gt; NatM Register
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Register -&gt; NatM Register) -&gt; Register -&gt; NatM Register
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Format -&gt; (Reg -&gt; OrdList Instr) -&gt; Register
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#floatFormat"><span class="hs-identifier hs-var">floatFormat</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870800"><span class="hs-identifier hs-var">to</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682870801"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870801"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870762"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#FCVT"><span class="hs-identifier hs-var">FCVT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870800"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870801"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870799"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870760"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-755"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_WF_Bitcast"><span class="hs-identifier hs-type">MO_WF_Bitcast</span></a></span><span> </span><span id="local-6989586621682870804"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870804"><span class="hs-identifier hs-var">w</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Register -&gt; NatM Register
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Register -&gt; NatM Register) -&gt; Register -&gt; NatM Register
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Format -&gt; (Reg -&gt; OrdList Instr) -&gt; Register
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#floatFormat"><span class="hs-identifier hs-var">floatFormat</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870804"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682870805"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870805"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870762"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#FMOV"><span class="hs-identifier hs-var">FMOV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870804"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870805"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870804"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870760"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-756"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_FW_Bitcast"><span class="hs-identifier hs-type">MO_FW_Bitcast</span></a></span><span> </span><span id="local-6989586621682870808"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870808"><span class="hs-identifier hs-var">w</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Register -&gt; NatM Register
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Register -&gt; NatM Register) -&gt; Register -&gt; NatM Register
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Format -&gt; (Reg -&gt; OrdList Instr) -&gt; Register
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870808"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682870809"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870809"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870762"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#FMOV"><span class="hs-identifier hs-var">FMOV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870808"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870809"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870808"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870760"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-757"></span><span>
</span><span id="line-758"></span><span>        </span><span class="hs-comment">-- Conversions</span><span>
</span><span id="line-759"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_XX_Conv"><span class="hs-identifier hs-type">MO_XX_Conv</span></a></span><span> </span><span id="local-6989586621682870811"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870811"><span class="hs-identifier hs-var">_from</span></a></span></span><span> </span><span id="local-6989586621682870812"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870812"><span class="hs-identifier hs-var">to</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Format -&gt; Register -&gt; Register
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#swizzleRegisterRep"><span class="hs-identifier hs-var">swizzleRegisterRep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870812"><span class="hs-identifier hs-var">to</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Register -&gt; Register) -&gt; NatM Register -&gt; NatM Register
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM Register
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegister"><span class="hs-identifier hs-var">getRegister</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870759"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-760"></span><span>
</span><span id="line-761"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Eq"><span class="hs-identifier hs-type">MO_Eq</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-762"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Ne"><span class="hs-identifier hs-type">MO_Ne</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-763"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Mul"><span class="hs-identifier hs-type">MO_Mul</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-764"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_S_MulMayOflo"><span class="hs-identifier hs-type">MO_S_MulMayOflo</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-765"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_S_Quot"><span class="hs-identifier hs-type">MO_S_Quot</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-766"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_S_Rem"><span class="hs-identifier hs-type">MO_S_Rem</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-767"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_U_Quot"><span class="hs-identifier hs-type">MO_U_Quot</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-768"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_U_Rem"><span class="hs-identifier hs-type">MO_U_Rem</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-769"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_S_Ge"><span class="hs-identifier hs-type">MO_S_Ge</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-770"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_S_Le"><span class="hs-identifier hs-type">MO_S_Le</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-771"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_S_Gt"><span class="hs-identifier hs-type">MO_S_Gt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-772"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_S_Lt"><span class="hs-identifier hs-type">MO_S_Lt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-773"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_U_Ge"><span class="hs-identifier hs-type">MO_U_Ge</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-774"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_U_Le"><span class="hs-identifier hs-type">MO_U_Le</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-775"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_U_Gt"><span class="hs-identifier hs-type">MO_U_Gt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-776"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_U_Lt"><span class="hs-identifier hs-type">MO_U_Lt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-777"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_F_Add"><span class="hs-identifier hs-type">MO_F_Add</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-778"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_F_Sub"><span class="hs-identifier hs-type">MO_F_Sub</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-779"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_F_Mul"><span class="hs-identifier hs-type">MO_F_Mul</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-780"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_F_Quot"><span class="hs-identifier hs-type">MO_F_Quot</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-781"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_FMA"><span class="hs-identifier hs-type">MO_FMA</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-782"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_F_Eq"><span class="hs-identifier hs-type">MO_F_Eq</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-783"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_F_Ne"><span class="hs-identifier hs-type">MO_F_Ne</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-784"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_F_Ge"><span class="hs-identifier hs-type">MO_F_Ge</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-785"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_F_Le"><span class="hs-identifier hs-type">MO_F_Le</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-786"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_F_Gt"><span class="hs-identifier hs-type">MO_F_Gt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-787"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_F_Lt"><span class="hs-identifier hs-type">MO_F_Lt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-788"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_And"><span class="hs-identifier hs-type">MO_And</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-789"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Or"><span class="hs-identifier hs-type">MO_Or</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-790"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Xor"><span class="hs-identifier hs-type">MO_Xor</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-791"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Shl"><span class="hs-identifier hs-type">MO_Shl</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-792"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_U_Shr"><span class="hs-identifier hs-type">MO_U_Shr</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-793"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_S_Shr"><span class="hs-identifier hs-type">MO_S_Shr</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-794"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_V_Insert"><span class="hs-identifier hs-type">MO_V_Insert</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-795"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_V_Extract"><span class="hs-identifier hs-type">MO_V_Extract</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-796"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_V_Add"><span class="hs-identifier hs-type">MO_V_Add</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-797"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_V_Sub"><span class="hs-identifier hs-type">MO_V_Sub</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-798"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_V_Mul"><span class="hs-identifier hs-type">MO_V_Mul</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-799"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VS_Quot"><span class="hs-identifier hs-type">MO_VS_Quot</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-800"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VS_Rem"><span class="hs-identifier hs-type">MO_VS_Rem</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-801"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VS_Neg"><span class="hs-identifier hs-type">MO_VS_Neg</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-802"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VU_Quot"><span class="hs-identifier hs-type">MO_VU_Quot</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-803"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VU_Rem"><span class="hs-identifier hs-type">MO_VU_Rem</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-804"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_V_Shuffle"><span class="hs-identifier hs-type">MO_V_Shuffle</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-805"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VF_Shuffle"><span class="hs-identifier hs-type">MO_VF_Shuffle</span></a></span><span>  </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-806"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VF_Insert"><span class="hs-identifier hs-type">MO_VF_Insert</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-807"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VF_Extract"><span class="hs-identifier hs-type">MO_VF_Extract</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-808"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VF_Add"><span class="hs-identifier hs-type">MO_VF_Add</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-809"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VF_Sub"><span class="hs-identifier hs-type">MO_VF_Sub</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-810"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VF_Mul"><span class="hs-identifier hs-type">MO_VF_Mul</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-811"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VF_Quot"><span class="hs-identifier hs-type">MO_VF_Quot</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-812"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Add"><span class="hs-identifier hs-type">MO_Add</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-813"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Sub"><span class="hs-identifier hs-type">MO_Sub</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-814"></span><span>
</span><span id="line-815"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_F_Min"><span class="hs-identifier hs-type">MO_F_Min</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-816"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_F_Max"><span class="hs-identifier hs-type">MO_F_Max</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-817"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VU_Min"><span class="hs-identifier hs-type">MO_VU_Min</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-818"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VU_Max"><span class="hs-identifier hs-type">MO_VU_Max</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-819"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VS_Min"><span class="hs-identifier hs-type">MO_VS_Min</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-820"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VS_Max"><span class="hs-identifier hs-type">MO_VS_Max</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-821"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VF_Min"><span class="hs-identifier hs-type">MO_VF_Min</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-822"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VF_Max"><span class="hs-identifier hs-type">MO_VF_Max</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var">notUnary</span></a></span><span>
</span><span id="line-823"></span><span>
</span><span id="line-824"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_AlignmentCheck"><span class="hs-identifier hs-type">MO_AlignmentCheck</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-825"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; NatM Register
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getRegister' (monadic CmmMachOp):&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; CmmExpr -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682870629"><span class="hs-identifier hs-var">plat</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-826"></span><span>
</span><span id="line-827"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_V_Broadcast"><span class="hs-identifier hs-type">MO_V_Broadcast</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
forall {a}. a
</span><a href="#local-6989586621682870876"><span class="hs-identifier hs-var">vectorsNeedLlvm</span></a></span><span>
</span><span id="line-828"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VF_Broadcast"><span class="hs-identifier hs-type">MO_VF_Broadcast</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
forall {a}. a
</span><a href="#local-6989586621682870876"><span class="hs-identifier hs-var">vectorsNeedLlvm</span></a></span><span>
</span><span id="line-829"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VF_Neg"><span class="hs-identifier hs-type">MO_VF_Neg</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
forall {a}. a
</span><a href="#local-6989586621682870876"><span class="hs-identifier hs-var">vectorsNeedLlvm</span></a></span><span>
</span><span id="line-830"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-831"></span><span>        </span><span id="local-6989586621682870815"><span class="annot"><span class="annottext">notUnary :: NatM Register
</span><a href="#local-6989586621682870815"><span class="hs-identifier hs-var hs-var">notUnary</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; NatM Register
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getRegister' (non-unary CmmMachOp with 1 argument):&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; CmmExpr -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682870629"><span class="hs-identifier hs-var">plat</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-832"></span><span>        </span><span id="local-6989586621682870876"><span class="annot"><span class="annottext">vectorsNeedLlvm :: a
</span><a href="#local-6989586621682870876"><span class="hs-identifier hs-var hs-var">vectorsNeedLlvm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-833"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; a
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#sorry"><span class="hs-identifier hs-var">sorry</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SIMD operations on AArch64 currently require the LLVM backend&quot;</span></span><span>
</span><span id="line-834"></span><span>        </span><span id="local-6989586621682870792"><span class="annot"><span class="annottext">toImm :: Width -&gt; Operand
</span><a href="#local-6989586621682870792"><span class="hs-identifier hs-var hs-var">toImm</span></a></span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W8"><span class="hs-identifier hs-var">W8</span></a></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">7</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-835"></span><span>        </span><span class="annot"><a href="#local-6989586621682870792"><span class="hs-identifier hs-var">toImm</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W16"><span class="hs-identifier hs-var">W16</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">15</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-836"></span><span>        </span><span class="annot"><a href="#local-6989586621682870792"><span class="hs-identifier hs-var">toImm</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">31</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-837"></span><span>        </span><span class="annot"><a href="#local-6989586621682870792"><span class="hs-identifier hs-var">toImm</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">63</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-838"></span><span>        </span><span class="annot"><a href="#local-6989586621682870792"><span class="hs-identifier hs-var">toImm</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W128"><span class="hs-identifier hs-var">W128</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">127</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-839"></span><span>        </span><span class="annot"><a href="#local-6989586621682870792"><span class="hs-identifier hs-var">toImm</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W256"><span class="hs-identifier hs-var">W256</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">255</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-840"></span><span>        </span><span class="annot"><a href="#local-6989586621682870792"><span class="hs-identifier hs-var">toImm</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W512"><span class="hs-identifier hs-var">W512</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">511</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-841"></span><span>
</span><span id="line-842"></span><span>        </span><span class="hs-comment">-- In the case of 16- or 8-bit values we need to sign-extend to 32-bits</span><span>
</span><span id="line-843"></span><span>        </span><span class="hs-comment">-- See Note [Signed arithmetic on AArch64].</span><span>
</span><span id="line-844"></span><span>        </span><span id="local-6989586621682870771"><span class="annot"><span class="annottext">negate :: OrdList Instr -&gt; Width -&gt; Reg -&gt; NatM Register
</span><a href="#local-6989586621682870771"><span class="hs-identifier hs-var hs-var">negate</span></a></span></span><span> </span><span id="local-6989586621682870887"><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870887"><span class="hs-identifier hs-var">code</span></a></span></span><span> </span><span id="local-6989586621682870888"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870888"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682870889"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870889"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-845"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682870890"><span class="annot"><span class="annottext">w' :: Width
</span><a href="#local-6989586621682870890"><span class="hs-identifier hs-var hs-var hs-var">w'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#opRegWidth"><span class="hs-identifier hs-var">opRegWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870888"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-846"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682870891"><span class="annot"><a href="#local-6989586621682870891"><span class="hs-identifier hs-var">reg'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870892"><span class="annot"><a href="#local-6989586621682870892"><span class="hs-identifier hs-var">code_sx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Reg -&gt; NatM (Reg, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#signExtendReg"><span class="hs-identifier hs-var">signExtendReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870888"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870890"><span class="hs-identifier hs-var">w'</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870889"><span class="hs-identifier hs-var">reg</span></a></span><span>
</span><span id="line-847"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-type">intFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870888"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682870894"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870894"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-848"></span><span>                </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870887"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span>
</span><span id="line-849"></span><span>                </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870892"><span class="hs-identifier hs-var">code_sx</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span>
</span><span id="line-850"></span><span>                </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#NEG"><span class="hs-identifier hs-var">NEG</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870890"><span class="hs-identifier hs-var">w'</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870894"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870890"><span class="hs-identifier hs-var">w'</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870891"><span class="hs-identifier hs-var">reg'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span>
</span><span id="line-851"></span><span>                </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Reg -&gt; OrdList Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#truncateReg"><span class="hs-identifier hs-var">truncateReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870890"><span class="hs-identifier hs-var">w'</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870888"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870894"><span class="hs-identifier hs-var">dst</span></a></span><span>
</span><span id="line-852"></span><span>
</span><span id="line-853"></span><span>        </span><span id="local-6989586621682870797"><span class="annot"><span class="annottext">ss_conv :: Width -&gt; Width -&gt; Reg -&gt; OrdList Instr -&gt; m Register
</span><a href="#local-6989586621682870797"><span class="hs-identifier hs-var hs-var">ss_conv</span></a></span></span><span> </span><span id="local-6989586621682870905"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870905"><span class="hs-identifier hs-var">from</span></a></span></span><span> </span><span id="local-6989586621682870906"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870906"><span class="hs-identifier hs-var">to</span></a></span></span><span> </span><span id="local-6989586621682870907"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870907"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span id="local-6989586621682870908"><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870908"><span class="hs-identifier hs-var">code</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-854"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682870909"><span class="annot"><span class="annottext">w' :: Width
</span><a href="#local-6989586621682870909"><span class="hs-identifier hs-var hs-var">w'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#opRegWidth"><span class="hs-identifier hs-var">opRegWidth</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Width
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870905"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870906"><span class="hs-identifier hs-var">to</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-855"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Register -&gt; m Register
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Register -&gt; m Register) -&gt; Register -&gt; m Register
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Format -&gt; (Reg -&gt; OrdList Instr) -&gt; Register
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870906"><span class="hs-identifier hs-var">to</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Reg -&gt; OrdList Instr) -&gt; Register)
-&gt; (Reg -&gt; OrdList Instr) -&gt; Register
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682870910"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870910"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-856"></span><span>                </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870908"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span>
</span><span id="line-857"></span><span>                </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SBFM"><span class="hs-identifier hs-var">SBFM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870909"><span class="hs-identifier hs-var">w'</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870910"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870909"><span class="hs-identifier hs-var">w'</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870907"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Operand
</span><a href="#local-6989586621682870792"><span class="hs-identifier hs-var">toImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Width
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870905"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870906"><span class="hs-identifier hs-var">to</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span>
</span><span id="line-858"></span><span>                </span><span class="hs-comment">-- At this point an 8- or 16-bit value would be sign-extended</span><span>
</span><span id="line-859"></span><span>                </span><span class="hs-comment">-- to 32-bits. Truncate back down the final width.</span><span>
</span><span id="line-860"></span><span>                </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Reg -&gt; OrdList Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#truncateReg"><span class="hs-identifier hs-var">truncateReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870909"><span class="hs-identifier hs-var">w'</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870906"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870910"><span class="hs-identifier hs-var">dst</span></a></span><span>
</span><span id="line-861"></span><span>
</span><span id="line-862"></span><span>    </span><span class="hs-comment">-- Dyadic machops:</span><span>
</span><span id="line-863"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-864"></span><span>    </span><span class="hs-comment">-- The general idea is:</span><span>
</span><span id="line-865"></span><span>    </span><span class="hs-comment">-- compute x&lt;i&gt; &lt;- x</span><span>
</span><span id="line-866"></span><span>    </span><span class="hs-comment">-- compute x&lt;j&gt; &lt;- y</span><span>
</span><span id="line-867"></span><span>    </span><span class="hs-comment">-- OP x&lt;r&gt;, x&lt;i&gt;, x&lt;j&gt;</span><span>
</span><span id="line-868"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-869"></span><span>    </span><span class="hs-comment">-- TODO: for now we'll only implement the 64bit versions. And rely on the</span><span>
</span><span id="line-870"></span><span>    </span><span class="hs-comment">--      fallthrough to alert us if things go wrong!</span><span>
</span><span id="line-871"></span><span>    </span><span class="hs-comment">-- OPTIMIZATION WARNING: Dyadic CmmMachOp destructuring</span><span>
</span><span id="line-872"></span><span>    </span><span class="hs-comment">-- 0. TODO This should not exist! Rewrite: Reg +- 0 -&gt; Reg</span><span>
</span><span id="line-873"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-type">CmmMachOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Add"><span class="hs-identifier hs-type">MO_Add</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682870912"><span class="annot"><span class="annottext">expr' :: CmmExpr
</span><a href="#local-6989586621682870912"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Reg.html#CmmGlobal"><span class="hs-identifier hs-type">CmmGlobal</span></a></span><span> </span><span id="local-6989586621682870913"><span class="annot"><span class="annottext">GlobalRegUse
</span><a href="#local-6989586621682870913"><span class="hs-identifier hs-var">_r</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-type">CmmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; Platform -&gt; CmmExpr -&gt; NatM Register
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegister%27"><span class="hs-identifier hs-var">getRegister'</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682870628"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682870629"><span class="hs-identifier hs-var">plat</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870912"><span class="hs-identifier hs-var">expr'</span></a></span><span>
</span><span id="line-874"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-type">CmmMachOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Sub"><span class="hs-identifier hs-type">MO_Sub</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682870914"><span class="annot"><span class="annottext">expr' :: CmmExpr
</span><a href="#local-6989586621682870914"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Reg.html#CmmGlobal"><span class="hs-identifier hs-type">CmmGlobal</span></a></span><span> </span><span id="local-6989586621682870915"><span class="annot"><span class="annottext">GlobalRegUse
</span><a href="#local-6989586621682870915"><span class="hs-identifier hs-var">_r</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-type">CmmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; Platform -&gt; CmmExpr -&gt; NatM Register
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegister%27"><span class="hs-identifier hs-var">getRegister'</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682870628"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682870629"><span class="hs-identifier hs-var">plat</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870914"><span class="hs-identifier hs-var">expr'</span></a></span><span>
</span><span id="line-875"></span><span>    </span><span class="hs-comment">-- Immediates are handled via `getArithImm` in the generic code path.</span><span>
</span><span id="line-876"></span><span>
</span><span id="line-877"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-type">CmmMachOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_U_Quot"><span class="hs-identifier hs-type">MO_U_Quot</span></a></span><span> </span><span id="local-6989586621682870916"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870916"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682870917"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870917"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870918"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870918"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870916"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W8"><span class="hs-identifier hs-var">W8</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-878"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682870919"><span class="annot"><a href="#local-6989586621682870919"><span class="hs-identifier hs-var">reg_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870920"><span class="annot"><a href="#local-6989586621682870920"><span class="hs-identifier hs-var">_format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870921"><span class="annot"><a href="#local-6989586621682870921"><span class="hs-identifier hs-var">code_x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870917"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-879"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682870922"><span class="annot"><a href="#local-6989586621682870922"><span class="hs-identifier hs-var">reg_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870923"><span class="annot"><a href="#local-6989586621682870923"><span class="hs-identifier hs-var">_format_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870924"><span class="annot"><a href="#local-6989586621682870924"><span class="hs-identifier hs-var">code_y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-type">getSomeReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870918"><span class="hs-identifier hs-type">y</span></a></span><span>
</span><span id="line-880"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-type">intFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870916"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682870925"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870925"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870921"><span class="hs-identifier hs-var">code_x</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870924"><span class="hs-identifier hs-var">code_y</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#UXTB"><span class="hs-identifier hs-var">UXTB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870916"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870919"><span class="hs-identifier hs-var">reg_x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870916"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870919"><span class="hs-identifier hs-var">reg_x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span>
</span><span id="line-881"></span><span>                                                                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#UXTB"><span class="hs-identifier hs-var">UXTB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870916"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870922"><span class="hs-identifier hs-var">reg_y</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870916"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870922"><span class="hs-identifier hs-var">reg_y</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span>
</span><span id="line-882"></span><span>                                                                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#UDIV"><span class="hs-identifier hs-var">UDIV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870916"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870925"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870916"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870919"><span class="hs-identifier hs-var">reg_x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870916"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870922"><span class="hs-identifier hs-var">reg_y</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-883"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-type">CmmMachOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_U_Quot"><span class="hs-identifier hs-type">MO_U_Quot</span></a></span><span> </span><span id="local-6989586621682870928"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870928"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682870929"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870929"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870930"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870930"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870928"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W16"><span class="hs-identifier hs-var">W16</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-884"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682870931"><span class="annot"><a href="#local-6989586621682870931"><span class="hs-identifier hs-var">reg_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870932"><span class="annot"><a href="#local-6989586621682870932"><span class="hs-identifier hs-var">_format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870933"><span class="annot"><a href="#local-6989586621682870933"><span class="hs-identifier hs-var">code_x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870929"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-885"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682870934"><span class="annot"><a href="#local-6989586621682870934"><span class="hs-identifier hs-var">reg_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870935"><span class="annot"><a href="#local-6989586621682870935"><span class="hs-identifier hs-var">_format_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870936"><span class="annot"><a href="#local-6989586621682870936"><span class="hs-identifier hs-var">code_y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-type">getSomeReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870930"><span class="hs-identifier hs-type">y</span></a></span><span>
</span><span id="line-886"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-type">intFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870928"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682870937"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870937"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870933"><span class="hs-identifier hs-var">code_x</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870936"><span class="hs-identifier hs-var">code_y</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#UXTH"><span class="hs-identifier hs-var">UXTH</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870928"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870931"><span class="hs-identifier hs-var">reg_x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870928"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870931"><span class="hs-identifier hs-var">reg_x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span>
</span><span id="line-887"></span><span>                                                                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#UXTH"><span class="hs-identifier hs-var">UXTH</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870928"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870934"><span class="hs-identifier hs-var">reg_y</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870928"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870934"><span class="hs-identifier hs-var">reg_y</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span>
</span><span id="line-888"></span><span>                                                                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#UDIV"><span class="hs-identifier hs-var">UDIV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870928"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870937"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870928"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870931"><span class="hs-identifier hs-var">reg_x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870928"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870934"><span class="hs-identifier hs-var">reg_y</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-889"></span><span>
</span><span id="line-890"></span><span>    </span><span class="hs-comment">-- 2. Shifts. x &lt;&lt; n, x &gt;&gt; n.</span><span>
</span><span id="line-891"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-type">CmmMachOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Shl"><span class="hs-identifier hs-type">MO_Shl</span></a></span><span> </span><span id="local-6989586621682870939"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870939"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682870940"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870940"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-type">CmmInt</span></a></span><span> </span><span id="local-6989586621682870941"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870941"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-892"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870939"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870939"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span>
</span><span id="line-893"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870941"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870941"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Int
</span><a href="GHC.Cmm.Type.html#widthInBits"><span class="hs-identifier hs-var">widthInBits</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870939"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-894"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682870944"><span class="annot"><a href="#local-6989586621682870944"><span class="hs-identifier hs-var">reg_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870945"><span class="annot"><a href="#local-6989586621682870945"><span class="hs-identifier hs-var">_format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870946"><span class="annot"><a href="#local-6989586621682870946"><span class="hs-identifier hs-var">code_x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870940"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-895"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-type">intFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870939"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682870947"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870947"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870946"><span class="hs-identifier hs-var">code_x</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#LSL"><span class="hs-identifier hs-var">LSL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870939"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870947"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870939"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870944"><span class="hs-identifier hs-var">reg_x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870941"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-896"></span><span>
</span><span id="line-897"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-type">CmmMachOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_S_Shr"><span class="hs-identifier hs-type">MO_S_Shr</span></a></span><span> </span><span id="local-6989586621682870949"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870949"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682870950"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870950"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-type">CmmInt</span></a></span><span> </span><span id="local-6989586621682870951"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870951"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870949"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W8"><span class="hs-identifier hs-var">W8</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870951"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870951"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">8</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-898"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682870952"><span class="annot"><a href="#local-6989586621682870952"><span class="hs-identifier hs-var">reg_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870953"><span class="annot"><a href="#local-6989586621682870953"><span class="hs-identifier hs-var">_format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870954"><span class="annot"><a href="#local-6989586621682870954"><span class="hs-identifier hs-var">code_x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870950"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-899"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-type">intFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870949"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682870955"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870955"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870954"><span class="hs-identifier hs-var">code_x</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SBFX"><span class="hs-identifier hs-var">SBFX</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870949"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870955"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870949"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870952"><span class="hs-identifier hs-var">reg_x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870951"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">8</span></span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870951"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-900"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-type">CmmMachOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_S_Shr"><span class="hs-identifier hs-type">MO_S_Shr</span></a></span><span> </span><span id="local-6989586621682870957"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870957"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682870958"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870958"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870959"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870959"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870957"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W8"><span class="hs-identifier hs-var">W8</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-901"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682870960"><span class="annot"><a href="#local-6989586621682870960"><span class="hs-identifier hs-var">reg_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870961"><span class="annot"><a href="#local-6989586621682870961"><span class="hs-identifier hs-var">_format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870962"><span class="annot"><a href="#local-6989586621682870962"><span class="hs-identifier hs-var">code_x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870958"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-902"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682870963"><span class="annot"><a href="#local-6989586621682870963"><span class="hs-identifier hs-var">reg_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870964"><span class="annot"><a href="#local-6989586621682870964"><span class="hs-identifier hs-var">_format_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870965"><span class="annot"><a href="#local-6989586621682870965"><span class="hs-identifier hs-var">code_y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-type">getSomeReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870959"><span class="hs-identifier hs-type">y</span></a></span><span>
</span><span id="line-903"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-type">intFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870957"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682870966"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870966"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870962"><span class="hs-identifier hs-var">code_x</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870965"><span class="hs-identifier hs-var">code_y</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SXTB"><span class="hs-identifier hs-var">SXTB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870957"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870960"><span class="hs-identifier hs-var">reg_x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870957"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870960"><span class="hs-identifier hs-var">reg_x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span>
</span><span id="line-904"></span><span>                                                                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#ASR"><span class="hs-identifier hs-var">ASR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870957"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870966"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870957"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870960"><span class="hs-identifier hs-var">reg_x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870957"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870963"><span class="hs-identifier hs-var">reg_y</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-905"></span><span>
</span><span id="line-906"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-type">CmmMachOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_S_Shr"><span class="hs-identifier hs-type">MO_S_Shr</span></a></span><span> </span><span id="local-6989586621682870969"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870969"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682870970"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870970"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-type">CmmInt</span></a></span><span> </span><span id="local-6989586621682870971"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870971"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870969"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W16"><span class="hs-identifier hs-var">W16</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870971"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870971"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">16</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-907"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682870972"><span class="annot"><a href="#local-6989586621682870972"><span class="hs-identifier hs-var">reg_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870973"><span class="annot"><a href="#local-6989586621682870973"><span class="hs-identifier hs-var">_format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870974"><span class="annot"><a href="#local-6989586621682870974"><span class="hs-identifier hs-var">code_x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870970"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-908"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-type">intFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870969"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682870975"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870975"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870974"><span class="hs-identifier hs-var">code_x</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SBFX"><span class="hs-identifier hs-var">SBFX</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870969"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870975"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870969"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870972"><span class="hs-identifier hs-var">reg_x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870971"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">16</span></span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870971"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-909"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-type">CmmMachOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_S_Shr"><span class="hs-identifier hs-type">MO_S_Shr</span></a></span><span> </span><span id="local-6989586621682870976"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870976"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682870977"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870977"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870978"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870978"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870976"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W16"><span class="hs-identifier hs-var">W16</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-910"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682870979"><span class="annot"><a href="#local-6989586621682870979"><span class="hs-identifier hs-var">reg_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870980"><span class="annot"><a href="#local-6989586621682870980"><span class="hs-identifier hs-var">_format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870981"><span class="annot"><a href="#local-6989586621682870981"><span class="hs-identifier hs-var">code_x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870977"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-911"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682870982"><span class="annot"><a href="#local-6989586621682870982"><span class="hs-identifier hs-var">reg_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870983"><span class="annot"><a href="#local-6989586621682870983"><span class="hs-identifier hs-var">_format_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870984"><span class="annot"><a href="#local-6989586621682870984"><span class="hs-identifier hs-var">code_y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-type">getSomeReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870978"><span class="hs-identifier hs-type">y</span></a></span><span>
</span><span id="line-912"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-type">intFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870976"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682870985"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870985"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870981"><span class="hs-identifier hs-var">code_x</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870984"><span class="hs-identifier hs-var">code_y</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SXTH"><span class="hs-identifier hs-var">SXTH</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870976"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870979"><span class="hs-identifier hs-var">reg_x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870976"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870979"><span class="hs-identifier hs-var">reg_x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span>
</span><span id="line-913"></span><span>                                                                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#ASR"><span class="hs-identifier hs-var">ASR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870976"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870985"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870976"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870979"><span class="hs-identifier hs-var">reg_x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870976"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870982"><span class="hs-identifier hs-var">reg_y</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-914"></span><span>
</span><span id="line-915"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-type">CmmMachOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_S_Shr"><span class="hs-identifier hs-type">MO_S_Shr</span></a></span><span> </span><span id="local-6989586621682870987"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870987"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682870988"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870988"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-type">CmmInt</span></a></span><span> </span><span id="local-6989586621682870989"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870989"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-916"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870987"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870987"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span>
</span><span id="line-917"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870989"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870989"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Int
</span><a href="GHC.Cmm.Type.html#widthInBits"><span class="hs-identifier hs-var">widthInBits</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870987"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-918"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682870990"><span class="annot"><a href="#local-6989586621682870990"><span class="hs-identifier hs-var">reg_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870991"><span class="annot"><a href="#local-6989586621682870991"><span class="hs-identifier hs-var">_format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870992"><span class="annot"><a href="#local-6989586621682870992"><span class="hs-identifier hs-var">code_x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870988"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-919"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-type">intFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870987"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682870993"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870993"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870992"><span class="hs-identifier hs-var">code_x</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#ASR"><span class="hs-identifier hs-var">ASR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870987"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870993"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870987"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870990"><span class="hs-identifier hs-var">reg_x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870989"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-920"></span><span>
</span><span id="line-921"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-type">CmmMachOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_U_Shr"><span class="hs-identifier hs-type">MO_U_Shr</span></a></span><span> </span><span id="local-6989586621682870994"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870994"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682870995"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870995"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-type">CmmInt</span></a></span><span> </span><span id="local-6989586621682870996"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870996"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870994"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W8"><span class="hs-identifier hs-var">W8</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870996"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870996"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">8</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-922"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682870997"><span class="annot"><a href="#local-6989586621682870997"><span class="hs-identifier hs-var">reg_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870998"><span class="annot"><a href="#local-6989586621682870998"><span class="hs-identifier hs-var">_format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682870999"><span class="annot"><a href="#local-6989586621682870999"><span class="hs-identifier hs-var">code_x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870995"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-923"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-type">intFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682870994"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871000"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871000"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682870999"><span class="hs-identifier hs-var">code_x</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#UBFX"><span class="hs-identifier hs-var">UBFX</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870994"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871000"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682870994"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682870997"><span class="hs-identifier hs-var">reg_x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870996"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">8</span></span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682870996"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-924"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-type">CmmMachOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_U_Shr"><span class="hs-identifier hs-type">MO_U_Shr</span></a></span><span> </span><span id="local-6989586621682871002"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871002"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871003"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871003"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871004"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871004"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871002"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W8"><span class="hs-identifier hs-var">W8</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-925"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682871005"><span class="annot"><a href="#local-6989586621682871005"><span class="hs-identifier hs-var">reg_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871006"><span class="annot"><a href="#local-6989586621682871006"><span class="hs-identifier hs-var">_format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871007"><span class="annot"><a href="#local-6989586621682871007"><span class="hs-identifier hs-var">code_x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871003"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-926"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682871008"><span class="annot"><a href="#local-6989586621682871008"><span class="hs-identifier hs-var">reg_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871009"><span class="annot"><a href="#local-6989586621682871009"><span class="hs-identifier hs-var">_format_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871010"><span class="annot"><a href="#local-6989586621682871010"><span class="hs-identifier hs-var">code_y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-type">getSomeReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871004"><span class="hs-identifier hs-type">y</span></a></span><span>
</span><span id="line-927"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-type">intFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871002"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871011"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871011"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871007"><span class="hs-identifier hs-var">code_x</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871010"><span class="hs-identifier hs-var">code_y</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#UXTB"><span class="hs-identifier hs-var">UXTB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871002"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871005"><span class="hs-identifier hs-var">reg_x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871002"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871005"><span class="hs-identifier hs-var">reg_x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span>
</span><span id="line-928"></span><span>                                                                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#ASR"><span class="hs-identifier hs-var">ASR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871002"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871011"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871002"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871005"><span class="hs-identifier hs-var">reg_x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871002"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871008"><span class="hs-identifier hs-var">reg_y</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-929"></span><span>
</span><span id="line-930"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-type">CmmMachOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_U_Shr"><span class="hs-identifier hs-type">MO_U_Shr</span></a></span><span> </span><span id="local-6989586621682871012"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871012"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871013"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871013"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-type">CmmInt</span></a></span><span> </span><span id="local-6989586621682871014"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682871014"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871012"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W16"><span class="hs-identifier hs-var">W16</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682871014"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682871014"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">16</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-931"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682871015"><span class="annot"><a href="#local-6989586621682871015"><span class="hs-identifier hs-var">reg_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871016"><span class="annot"><a href="#local-6989586621682871016"><span class="hs-identifier hs-var">_format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871017"><span class="annot"><a href="#local-6989586621682871017"><span class="hs-identifier hs-var">code_x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871013"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-932"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-type">intFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871012"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871018"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871018"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871017"><span class="hs-identifier hs-var">code_x</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#UBFX"><span class="hs-identifier hs-var">UBFX</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871012"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871018"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871012"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871015"><span class="hs-identifier hs-var">reg_x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682871014"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">16</span></span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682871014"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-933"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-type">CmmMachOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_U_Shr"><span class="hs-identifier hs-type">MO_U_Shr</span></a></span><span> </span><span id="local-6989586621682871019"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871019"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871020"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871020"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871021"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871021"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871019"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W16"><span class="hs-identifier hs-var">W16</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-934"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682871022"><span class="annot"><a href="#local-6989586621682871022"><span class="hs-identifier hs-var">reg_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871023"><span class="annot"><a href="#local-6989586621682871023"><span class="hs-identifier hs-var">_format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871024"><span class="annot"><a href="#local-6989586621682871024"><span class="hs-identifier hs-var">code_x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871020"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-935"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682871025"><span class="annot"><a href="#local-6989586621682871025"><span class="hs-identifier hs-var">reg_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871026"><span class="annot"><a href="#local-6989586621682871026"><span class="hs-identifier hs-var">_format_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871027"><span class="annot"><a href="#local-6989586621682871027"><span class="hs-identifier hs-var">code_y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-type">getSomeReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871021"><span class="hs-identifier hs-type">y</span></a></span><span>
</span><span id="line-936"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-type">intFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871019"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871028"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871028"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871024"><span class="hs-identifier hs-var">code_x</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871027"><span class="hs-identifier hs-var">code_y</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#UXTH"><span class="hs-identifier hs-var">UXTH</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871019"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871022"><span class="hs-identifier hs-var">reg_x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871019"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871022"><span class="hs-identifier hs-var">reg_x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-937"></span><span>                                                                </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#ASR"><span class="hs-identifier hs-var">ASR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871019"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871028"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871019"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871022"><span class="hs-identifier hs-var">reg_x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871019"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871025"><span class="hs-identifier hs-var">reg_y</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-938"></span><span>
</span><span id="line-939"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-type">CmmMachOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_U_Shr"><span class="hs-identifier hs-type">MO_U_Shr</span></a></span><span> </span><span id="local-6989586621682871029"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871029"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871030"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871030"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-type">CmmInt</span></a></span><span> </span><span id="local-6989586621682871031"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682871031"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-940"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871029"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871029"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span>
</span><span id="line-941"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682871031"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682871031"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Int
</span><a href="GHC.Cmm.Type.html#widthInBits"><span class="hs-identifier hs-var">widthInBits</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871029"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-942"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682871032"><span class="annot"><a href="#local-6989586621682871032"><span class="hs-identifier hs-var">reg_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871033"><span class="annot"><a href="#local-6989586621682871033"><span class="hs-identifier hs-var">_format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871034"><span class="annot"><a href="#local-6989586621682871034"><span class="hs-identifier hs-var">code_x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871030"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-943"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-type">intFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871029"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871035"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871035"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871034"><span class="hs-identifier hs-var">code_x</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#LSR"><span class="hs-identifier hs-var">LSR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871029"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871035"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871029"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871032"><span class="hs-identifier hs-var">reg_x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682871031"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-944"></span><span>
</span><span id="line-945"></span><span>    </span><span class="hs-comment">-- 3. Logic &amp;&amp;, ||</span><span>
</span><span id="line-946"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-type">CmmMachOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_And"><span class="hs-identifier hs-type">MO_And</span></a></span><span> </span><span id="local-6989586621682871037"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871037"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a></span><span> </span><span id="local-6989586621682871038"><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682871038"><span class="hs-identifier hs-var">reg</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-type">CmmInt</span></a></span><span> </span><span id="local-6989586621682871039"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682871039"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Integer -&gt; Bool
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#isAArch64Bitmask"><span class="hs-identifier hs-var">isAArch64Bitmask</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Width
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#opRegWidth"><span class="hs-identifier hs-var">opRegWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871040"><span class="hs-identifier hs-var">w'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682871039"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-947"></span><span>      </span><span class="annot"><span class="annottext">Register -&gt; NatM Register
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Register -&gt; NatM Register) -&gt; Register -&gt; NatM Register
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Format -&gt; (Reg -&gt; OrdList Instr) -&gt; Register
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871037"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871041"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871041"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; OrdList Instr) -&gt; Instr -&gt; OrdList Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#AND"><span class="hs-identifier hs-var">AND</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871037"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871041"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871040"><span class="hs-identifier hs-var">w'</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871043"><span class="hs-identifier hs-var">r'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682871039"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-948"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682871040"><span class="annot"><span class="annottext">w' :: Width
</span><a href="#local-6989586621682871040"><span class="hs-identifier hs-var hs-var">w'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Format -&gt; Width
</span><a href="GHC.CmmToAsm.Format.html#formatToWidth"><span class="hs-identifier hs-var">formatToWidth</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmType -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#cmmTypeFormat"><span class="hs-identifier hs-var">cmmTypeFormat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmReg -&gt; CmmType
</span><a href="GHC.Cmm.Reg.html#cmmRegType"><span class="hs-identifier hs-var">cmmRegType</span></a></span><span> </span><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682871038"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-949"></span><span>            </span><span id="local-6989586621682871043"><span class="annot"><span class="annottext">r' :: Reg
</span><a href="#local-6989586621682871043"><span class="hs-identifier hs-var hs-var">r'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmReg -&gt; Reg
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682870629"><span class="hs-identifier hs-var">plat</span></a></span><span> </span><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682871038"><span class="hs-identifier hs-var">reg</span></a></span><span>
</span><span id="line-950"></span><span>
</span><span id="line-951"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-type">CmmMachOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Or"><span class="hs-identifier hs-type">MO_Or</span></a></span><span> </span><span id="local-6989586621682871044"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871044"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a></span><span> </span><span id="local-6989586621682871045"><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682871045"><span class="hs-identifier hs-var">reg</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-type">CmmInt</span></a></span><span> </span><span id="local-6989586621682871046"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682871046"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Integer -&gt; Bool
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#isAArch64Bitmask"><span class="hs-identifier hs-var">isAArch64Bitmask</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Width
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#opRegWidth"><span class="hs-identifier hs-var">opRegWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871047"><span class="hs-identifier hs-var">w'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682871046"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-952"></span><span>      </span><span class="annot"><span class="annottext">Register -&gt; NatM Register
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Register -&gt; NatM Register) -&gt; Register -&gt; NatM Register
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Format -&gt; (Reg -&gt; OrdList Instr) -&gt; Register
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871044"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871048"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871048"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; OrdList Instr) -&gt; Instr -&gt; OrdList Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#ORR"><span class="hs-identifier hs-var">ORR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871044"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871048"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871047"><span class="hs-identifier hs-var">w'</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871050"><span class="hs-identifier hs-var">r'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682871046"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-953"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682871047"><span class="annot"><span class="annottext">w' :: Width
</span><a href="#local-6989586621682871047"><span class="hs-identifier hs-var hs-var">w'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Format -&gt; Width
</span><a href="GHC.CmmToAsm.Format.html#formatToWidth"><span class="hs-identifier hs-var">formatToWidth</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmType -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#cmmTypeFormat"><span class="hs-identifier hs-var">cmmTypeFormat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmReg -&gt; CmmType
</span><a href="GHC.Cmm.Reg.html#cmmRegType"><span class="hs-identifier hs-var">cmmRegType</span></a></span><span> </span><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682871045"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-954"></span><span>            </span><span id="local-6989586621682871050"><span class="annot"><span class="annottext">r' :: Reg
</span><a href="#local-6989586621682871050"><span class="hs-identifier hs-var hs-var">r'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmReg -&gt; Reg
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682870629"><span class="hs-identifier hs-var">plat</span></a></span><span> </span><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682871045"><span class="hs-identifier hs-var">reg</span></a></span><span>
</span><span id="line-955"></span><span>
</span><span id="line-956"></span><span>    </span><span class="hs-comment">-- Generic binary case.</span><span>
</span><span id="line-957"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-type">CmmMachOp</span></a></span><span> </span><span id="local-6989586621682871051"><span class="annot"><span class="annottext">MachOp
</span><a href="#local-6989586621682871051"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871052"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871052"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871053"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871053"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-958"></span><span>      </span><span class="hs-comment">-- alright, so we have an operation, and two expressions. And we want to essentially do</span><span>
</span><span id="line-959"></span><span>      </span><span class="hs-comment">-- ensure we get float regs (TODO(Ben): What?)</span><span>
</span><span id="line-960"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682871056"><span class="annot"><span class="annottext">withTempIntReg :: Width -&gt; (Operand -&gt; NatM b) -&gt; NatM b
</span><a href="#local-6989586621682871056"><span class="hs-identifier hs-var hs-var">withTempIntReg</span></a></span></span><span> </span><span id="local-6989586621682871057"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871057"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682871058"><span class="annot"><span class="annottext">Operand -&gt; NatM b
</span><a href="#local-6989586621682871058"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871057"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">(Reg -&gt; Operand) -&gt; NatM Reg -&gt; NatM Operand
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Format -&gt; NatM Reg
</span><a href="GHC.CmmToAsm.Monad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871057"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NatM Operand -&gt; (Operand -&gt; NatM b) -&gt; NatM b
forall a b. NatM a -&gt; (a -&gt; NatM b) -&gt; NatM b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; NatM b
</span><a href="#local-6989586621682871058"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-961"></span><span>          </span><span class="hs-comment">-- withTempFloatReg w op = OpReg w &lt;$&gt; getNewRegNat (floatFormat w) &gt;&gt;= op</span><span>
</span><span id="line-962"></span><span>
</span><span id="line-963"></span><span>          </span><span class="hs-comment">-- A &quot;plain&quot; operation.</span><span>
</span><span id="line-964"></span><span>          </span><span id="local-6989586621682871059"><span class="annot"><span class="annottext">bitOpImm :: Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; (Integer -&gt; Width -&gt; Maybe Operand)
-&gt; NatM Register
</span><a href="#local-6989586621682871059"><span class="hs-identifier hs-var hs-var">bitOpImm</span></a></span></span><span> </span><span id="local-6989586621682871060"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871060"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682871061"><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr
</span><a href="#local-6989586621682871061"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621682871062"><span class="annot"><span class="annottext">Integer -&gt; Width -&gt; Maybe Operand
</span><a href="#local-6989586621682871062"><span class="hs-identifier hs-var">encode_imm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-965"></span><span>            </span><span class="hs-comment">-- compute x&lt;m&gt; &lt;- x</span><span>
</span><span id="line-966"></span><span>            </span><span class="hs-comment">-- compute x&lt;o&gt; &lt;- y</span><span>
</span><span id="line-967"></span><span>            </span><span class="hs-comment">-- &lt;OP&gt; x&lt;n&gt;, x&lt;m&gt;, x&lt;o&gt;</span><span>
</span><span id="line-968"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682871063"><span class="annot"><a href="#local-6989586621682871063"><span class="hs-identifier hs-var">reg_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871064"><span class="annot"><a href="#local-6989586621682871064"><span class="hs-identifier hs-var">format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871065"><span class="annot"><a href="#local-6989586621682871065"><span class="hs-identifier hs-var">code_x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871052"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-969"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682871066"><span class="annot"><a href="#local-6989586621682871066"><span class="hs-identifier hs-var">op_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871067"><span class="annot"><a href="#local-6989586621682871067"><span class="hs-identifier hs-var">format_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871068"><span class="annot"><a href="#local-6989586621682871068"><span class="hs-identifier hs-var">code_y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682871053"><span class="hs-identifier hs-type">y</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-970"></span><span>              </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-type">CmmInt</span></a></span><span> </span><span id="local-6989586621682871069"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682871069"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682871070"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871070"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-971"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682871071"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871071"><span class="hs-identifier hs-var">imm_operand_y</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Width -&gt; Maybe Operand
</span><a href="#local-6989586621682871062"><span class="hs-identifier hs-var">encode_imm</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682871069"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871070"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-972"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Operand, Format, OrdList Instr)
-&gt; NatM (Operand, Format, OrdList Instr)
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871071"><span class="hs-identifier hs-var">imm_operand_y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871070"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
forall a. OrdList a
</span><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-var">nilOL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-973"></span><span>              </span><span class="annot"><span class="annottext">CmmExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-974"></span><span>                  </span><span class="hs-special">(</span><span id="local-6989586621682871072"><span class="annot"><a href="#local-6989586621682871072"><span class="hs-identifier hs-var">reg_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871073"><span class="annot"><a href="#local-6989586621682871073"><span class="hs-identifier hs-var">format_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871074"><span class="annot"><a href="#local-6989586621682871074"><span class="hs-identifier hs-var">code_y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871053"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-975"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871060"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871072"><span class="hs-identifier hs-type">reg_y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682871073"><span class="hs-identifier hs-type">format_y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682871074"><span class="hs-identifier hs-type">code_y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-976"></span><span>            </span><span class="annot"><a href="GHC.Utils.Panic.html#massertPpr"><span class="hs-identifier hs-type">massertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Format.html#isIntFormat"><span class="hs-identifier hs-type">isIntFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871064"><span class="hs-identifier hs-type">format_x</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Format.html#isIntFormat"><span class="hs-identifier hs-type">isIntFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871067"><span class="hs-identifier hs-type">format_y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;bitOpImm: incompatible&quot;</span></span><span>
</span><span id="line-977"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-type">intFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871060"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871077"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871077"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-978"></span><span>                </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871065"><span class="hs-identifier hs-var">code_x</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span>
</span><span id="line-979"></span><span>                </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871068"><span class="hs-identifier hs-var">code_y</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span>
</span><span id="line-980"></span><span>                </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr
</span><a href="#local-6989586621682871061"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871060"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871077"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871060"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871063"><span class="hs-identifier hs-var">reg_x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871066"><span class="hs-identifier hs-var">op_y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-981"></span><span>
</span><span id="line-982"></span><span>          </span><span class="hs-comment">-- A (potentially signed) integer operation.</span><span>
</span><span id="line-983"></span><span>          </span><span class="hs-comment">-- In the case of 8- and 16-bit signed arithmetic we must first</span><span>
</span><span id="line-984"></span><span>          </span><span class="hs-comment">-- sign-extend both arguments to 32-bits.</span><span>
</span><span id="line-985"></span><span>          </span><span class="hs-comment">-- See Note [Signed arithmetic on AArch64].</span><span>
</span><span id="line-986"></span><span>          </span><span class="annot"><a href="#local-6989586621682871078"><span class="hs-identifier hs-type">intOpImm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#Width"><span class="hs-identifier hs-type">Width</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#Operand"><span class="hs-identifier hs-type">Operand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#Operand"><span class="hs-identifier hs-type">Operand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#Operand"><span class="hs-identifier hs-type">Operand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#OrdList"><span class="hs-identifier hs-type">OrdList</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#Width"><span class="hs-identifier hs-type">Width</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#Operand"><span class="hs-identifier hs-type">Operand</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-987"></span><span>          </span><span id="local-6989586621682871078"><span class="annot"><span class="annottext">intOpImm :: Bool
-&gt; Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; (Integer -&gt; Width -&gt; Maybe Operand)
-&gt; NatM Register
</span><a href="#local-6989586621682871078"><span class="hs-identifier hs-var hs-var">intOpImm</span></a></span></span><span> </span><span class="hs-comment">{- is signed -}</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span id="local-6989586621682871079"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871079"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682871080"><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr
</span><a href="#local-6989586621682871080"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621682871081"><span class="annot"><span class="annottext">Integer -&gt; Width -&gt; Maybe Operand
</span><a href="#local-6989586621682871081"><span class="hs-identifier hs-var">_encode_imm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; NatM Register
</span><a href="#local-6989586621682871082"><span class="hs-identifier hs-var">intOp</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871079"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr
</span><a href="#local-6989586621682871080"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-988"></span><span>          </span><span class="annot"><a href="#local-6989586621682871078"><span class="hs-identifier hs-var">intOpImm</span></a></span><span>                 </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span id="local-6989586621682871083"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871083"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682871084"><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr
</span><a href="#local-6989586621682871084"><span class="hs-identifier hs-var">op</span></a></span></span><span>  </span><span id="local-6989586621682871085"><span class="annot"><span class="annottext">Integer -&gt; Width -&gt; Maybe Operand
</span><a href="#local-6989586621682871085"><span class="hs-identifier hs-var">encode_imm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-989"></span><span>              </span><span class="hs-comment">-- compute x&lt;m&gt; &lt;- x</span><span>
</span><span id="line-990"></span><span>              </span><span class="hs-comment">-- compute x&lt;o&gt; &lt;- y</span><span>
</span><span id="line-991"></span><span>              </span><span class="hs-comment">-- &lt;OP&gt; x&lt;n&gt;, x&lt;m&gt;, x&lt;o&gt;</span><span>
</span><span id="line-992"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682871086"><span class="annot"><a href="#local-6989586621682871086"><span class="hs-identifier hs-var">reg_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871087"><span class="annot"><a href="#local-6989586621682871087"><span class="hs-identifier hs-var">format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871088"><span class="annot"><a href="#local-6989586621682871088"><span class="hs-identifier hs-var">code_x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871052"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-993"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682871089"><span class="annot"><a href="#local-6989586621682871089"><span class="hs-identifier hs-var">op_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871090"><span class="annot"><a href="#local-6989586621682871090"><span class="hs-identifier hs-var">format_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871091"><span class="annot"><a href="#local-6989586621682871091"><span class="hs-identifier hs-var">code_y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682871053"><span class="hs-identifier hs-type">y</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-994"></span><span>                </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-type">CmmInt</span></a></span><span> </span><span id="local-6989586621682871092"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682871092"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682871093"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871093"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-995"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682871094"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871094"><span class="hs-identifier hs-var">imm_operand_y</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Width -&gt; Maybe Operand
</span><a href="#local-6989586621682871085"><span class="hs-identifier hs-var">encode_imm</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682871092"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871093"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-996"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Operand, Format, OrdList Instr)
-&gt; NatM (Operand, Format, OrdList Instr)
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871094"><span class="hs-identifier hs-var">imm_operand_y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871093"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
forall a. OrdList a
</span><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-var">nilOL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-997"></span><span>                </span><span class="annot"><span class="annottext">CmmExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-998"></span><span>                    </span><span class="hs-special">(</span><span id="local-6989586621682871095"><span class="annot"><a href="#local-6989586621682871095"><span class="hs-identifier hs-var">reg_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871096"><span class="annot"><a href="#local-6989586621682871096"><span class="hs-identifier hs-var">format_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871097"><span class="annot"><a href="#local-6989586621682871097"><span class="hs-identifier hs-var">code_y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871053"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-999"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871083"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871095"><span class="hs-identifier hs-type">reg_y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682871096"><span class="hs-identifier hs-type">format_y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682871097"><span class="hs-identifier hs-type">code_y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1000"></span><span>              </span><span class="annot"><a href="GHC.Utils.Panic.html#massertPpr"><span class="hs-identifier hs-type">massertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Format.html#isIntFormat"><span class="hs-identifier hs-type">isIntFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871087"><span class="hs-identifier hs-type">format_x</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Format.html#isIntFormat"><span class="hs-identifier hs-type">isIntFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871090"><span class="hs-identifier hs-type">format_y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;intOp: non-int&quot;</span></span><span>
</span><span id="line-1001"></span><span>              </span><span class="hs-comment">-- This is the width of the registers on which the operation</span><span>
</span><span id="line-1002"></span><span>              </span><span class="hs-comment">-- should be performed.</span><span>
</span><span id="line-1003"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682871098"><span class="annot"><a href="#local-6989586621682871098"><span class="hs-identifier hs-var hs-var">w'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#opRegWidth"><span class="hs-identifier hs-var">opRegWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871083"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-1004"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-type">intFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871083"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682871099"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871099"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1005"></span><span>                  </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871088"><span class="hs-identifier hs-var">code_x</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span>
</span><span id="line-1006"></span><span>                  </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871091"><span class="hs-identifier hs-var">code_y</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span>
</span><span id="line-1007"></span><span>                  </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr
</span><a href="#local-6989586621682871084"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871098"><span class="hs-identifier hs-var">w'</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871099"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871098"><span class="hs-identifier hs-var">w'</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871086"><span class="hs-identifier hs-var">reg_x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871089"><span class="hs-identifier hs-var">op_y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span>
</span><span id="line-1008"></span><span>                  </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Reg -&gt; OrdList Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#truncateReg"><span class="hs-identifier hs-var">truncateReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871098"><span class="hs-identifier hs-var">w'</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871083"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871099"><span class="hs-identifier hs-var">dst</span></a></span><span> </span><span class="hs-comment">-- truncate back to the operand's original width</span><span>
</span><span id="line-1009"></span><span>
</span><span id="line-1010"></span><span>          </span><span class="hs-comment">-- A (potentially signed) integer operation.</span><span>
</span><span id="line-1011"></span><span>          </span><span class="hs-comment">-- In the case of 8- and 16-bit signed arithmetic we must first</span><span>
</span><span id="line-1012"></span><span>          </span><span class="hs-comment">-- sign-extend both arguments to 32-bits.</span><span>
</span><span id="line-1013"></span><span>          </span><span class="hs-comment">-- See Note [Signed arithmetic on AArch64].</span><span>
</span><span id="line-1014"></span><span>          </span><span id="local-6989586621682871082"><span class="annot"><span class="annottext">intOp :: Bool
-&gt; Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; NatM Register
</span><a href="#local-6989586621682871082"><span class="hs-identifier hs-var hs-var">intOp</span></a></span></span><span> </span><span id="local-6989586621682871100"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682871100"><span class="hs-identifier hs-var">is_signed</span></a></span></span><span> </span><span id="local-6989586621682871101"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871101"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682871102"><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr
</span><a href="#local-6989586621682871102"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1015"></span><span>              </span><span class="hs-comment">-- compute x&lt;m&gt; &lt;- x</span><span>
</span><span id="line-1016"></span><span>              </span><span class="hs-comment">-- compute x&lt;o&gt; &lt;- y</span><span>
</span><span id="line-1017"></span><span>              </span><span class="hs-comment">-- &lt;OP&gt; x&lt;n&gt;, x&lt;m&gt;, x&lt;o&gt;</span><span>
</span><span id="line-1018"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682871103"><span class="annot"><a href="#local-6989586621682871103"><span class="hs-identifier hs-var">reg_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871104"><span class="annot"><a href="#local-6989586621682871104"><span class="hs-identifier hs-var">format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871105"><span class="annot"><a href="#local-6989586621682871105"><span class="hs-identifier hs-var">code_x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871052"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1019"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682871106"><span class="annot"><a href="#local-6989586621682871106"><span class="hs-identifier hs-var">reg_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871107"><span class="annot"><a href="#local-6989586621682871107"><span class="hs-identifier hs-var">format_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871108"><span class="annot"><a href="#local-6989586621682871108"><span class="hs-identifier hs-var">code_y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-type">getSomeReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871053"><span class="hs-identifier hs-type">y</span></a></span><span>
</span><span id="line-1020"></span><span>              </span><span class="annot"><a href="GHC.Utils.Panic.html#massertPpr"><span class="hs-identifier hs-type">massertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Format.html#isIntFormat"><span class="hs-identifier hs-type">isIntFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871104"><span class="hs-identifier hs-type">format_x</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Format.html#isIntFormat"><span class="hs-identifier hs-type">isIntFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871107"><span class="hs-identifier hs-type">format_y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;intOp: non-int&quot;</span></span><span>
</span><span id="line-1021"></span><span>              </span><span class="hs-comment">-- This is the width of the registers on which the operation</span><span>
</span><span id="line-1022"></span><span>              </span><span class="hs-comment">-- should be performed.</span><span>
</span><span id="line-1023"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682871109"><span class="annot"><a href="#local-6989586621682871109"><span class="hs-identifier hs-var hs-var">w'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#opRegWidth"><span class="hs-identifier hs-var">opRegWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871101"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-1024"></span><span>                  </span><span id="local-6989586621682871110"><span class="annot"><a href="#local-6989586621682871110"><span class="hs-identifier hs-var hs-var">signExt</span></a></span></span><span> </span><span id="local-6989586621682871111"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871111"><span class="hs-identifier hs-var">r</span></a></span></span><span>
</span><span id="line-1025"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682871100"><span class="hs-identifier hs-var">is_signed</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Reg, OrdList Instr) -&gt; NatM (Reg, OrdList Instr)
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871111"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
forall a. OrdList a
</span><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-var">nilOL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1026"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Reg -&gt; NatM (Reg, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#signExtendReg"><span class="hs-identifier hs-var">signExtendReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871101"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871109"><span class="hs-identifier hs-var">w'</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871111"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1027"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682871113"><span class="annot"><a href="#local-6989586621682871113"><span class="hs-identifier hs-var">reg_x_sx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871114"><span class="annot"><a href="#local-6989586621682871114"><span class="hs-identifier hs-var">code_x_sx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682871110"><span class="hs-identifier hs-type">signExt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871103"><span class="hs-identifier hs-type">reg_x</span></a></span><span>
</span><span id="line-1028"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682871115"><span class="annot"><a href="#local-6989586621682871115"><span class="hs-identifier hs-var">reg_y_sx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871116"><span class="annot"><a href="#local-6989586621682871116"><span class="hs-identifier hs-var">code_y_sx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682871110"><span class="hs-identifier hs-type">signExt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871106"><span class="hs-identifier hs-type">reg_y</span></a></span><span>
</span><span id="line-1029"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-type">intFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871101"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682871117"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871117"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1030"></span><span>                  </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871105"><span class="hs-identifier hs-var">code_x</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span>
</span><span id="line-1031"></span><span>                  </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871108"><span class="hs-identifier hs-var">code_y</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span>
</span><span id="line-1032"></span><span>                  </span><span class="hs-comment">-- sign-extend both operands</span><span>
</span><span id="line-1033"></span><span>                  </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871114"><span class="hs-identifier hs-var">code_x_sx</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span>
</span><span id="line-1034"></span><span>                  </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871116"><span class="hs-identifier hs-var">code_y_sx</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span>
</span><span id="line-1035"></span><span>                  </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr
</span><a href="#local-6989586621682871102"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871109"><span class="hs-identifier hs-var">w'</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871117"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871109"><span class="hs-identifier hs-var">w'</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871113"><span class="hs-identifier hs-var">reg_x_sx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871109"><span class="hs-identifier hs-var">w'</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871115"><span class="hs-identifier hs-var">reg_y_sx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span>
</span><span id="line-1036"></span><span>                  </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Reg -&gt; OrdList Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#truncateReg"><span class="hs-identifier hs-var">truncateReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871109"><span class="hs-identifier hs-var">w'</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871101"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871117"><span class="hs-identifier hs-var">dst</span></a></span><span> </span><span class="hs-comment">-- truncate back to the operand's original width</span><span>
</span><span id="line-1037"></span><span>
</span><span id="line-1038"></span><span>          </span><span id="local-6989586621682871118"><span class="annot"><span class="annottext">floatOp :: Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; NatM Register
</span><a href="#local-6989586621682871118"><span class="hs-identifier hs-var hs-var">floatOp</span></a></span></span><span> </span><span id="local-6989586621682871119"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871119"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682871120"><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr
</span><a href="#local-6989586621682871120"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1039"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682871121"><span class="annot"><a href="#local-6989586621682871121"><span class="hs-identifier hs-var">reg_fx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871122"><span class="annot"><a href="#local-6989586621682871122"><span class="hs-identifier hs-var">format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871123"><span class="annot"><a href="#local-6989586621682871123"><span class="hs-identifier hs-var">code_fx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getFloatReg"><span class="hs-identifier hs-var">getFloatReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871052"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1040"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682871124"><span class="annot"><a href="#local-6989586621682871124"><span class="hs-identifier hs-var">reg_fy</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871125"><span class="annot"><a href="#local-6989586621682871125"><span class="hs-identifier hs-var">format_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871126"><span class="annot"><a href="#local-6989586621682871126"><span class="hs-identifier hs-var">code_fy</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getFloatReg"><span class="hs-identifier hs-type">getFloatReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871053"><span class="hs-identifier hs-type">y</span></a></span><span>
</span><span id="line-1041"></span><span>            </span><span class="annot"><a href="GHC.Utils.Panic.html#massertPpr"><span class="hs-identifier hs-type">massertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Format.html#isFloatFormat"><span class="hs-identifier hs-type">isFloatFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871122"><span class="hs-identifier hs-type">format_x</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Format.html#isFloatFormat"><span class="hs-identifier hs-type">isFloatFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871125"><span class="hs-identifier hs-type">format_y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;floatOp: non-float&quot;</span></span><span>
</span><span id="line-1042"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Format.html#floatFormat"><span class="hs-identifier hs-type">floatFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871119"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871127"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871127"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871123"><span class="hs-identifier hs-var">code_fx</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871126"><span class="hs-identifier hs-var">code_fy</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr
</span><a href="#local-6989586621682871120"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871119"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871127"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871119"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871121"><span class="hs-identifier hs-var">reg_fx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871119"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871124"><span class="hs-identifier hs-var">reg_fy</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1043"></span><span>
</span><span id="line-1044"></span><span>          </span><span class="hs-comment">-- need a special one for conditionals, as they return ints</span><span>
</span><span id="line-1045"></span><span>          </span><span id="local-6989586621682871128"><span class="annot"><span class="annottext">floatCond :: Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; NatM Register
</span><a href="#local-6989586621682871128"><span class="hs-identifier hs-var hs-var">floatCond</span></a></span></span><span> </span><span id="local-6989586621682871129"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871129"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682871130"><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr
</span><a href="#local-6989586621682871130"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1046"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682871131"><span class="annot"><a href="#local-6989586621682871131"><span class="hs-identifier hs-var">reg_fx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871132"><span class="annot"><a href="#local-6989586621682871132"><span class="hs-identifier hs-var">format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871133"><span class="annot"><a href="#local-6989586621682871133"><span class="hs-identifier hs-var">code_fx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getFloatReg"><span class="hs-identifier hs-var">getFloatReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871052"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1047"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682871134"><span class="annot"><a href="#local-6989586621682871134"><span class="hs-identifier hs-var">reg_fy</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871135"><span class="annot"><a href="#local-6989586621682871135"><span class="hs-identifier hs-var">format_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871136"><span class="annot"><a href="#local-6989586621682871136"><span class="hs-identifier hs-var">code_fy</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getFloatReg"><span class="hs-identifier hs-type">getFloatReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871053"><span class="hs-identifier hs-type">y</span></a></span><span>
</span><span id="line-1048"></span><span>            </span><span class="annot"><a href="GHC.Utils.Panic.html#massertPpr"><span class="hs-identifier hs-type">massertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Format.html#isFloatFormat"><span class="hs-identifier hs-type">isFloatFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871132"><span class="hs-identifier hs-type">format_x</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Format.html#isFloatFormat"><span class="hs-identifier hs-type">isFloatFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871135"><span class="hs-identifier hs-type">format_y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;floatCond: non-float&quot;</span></span><span>
</span><span id="line-1049"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-type">intFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871129"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871137"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871137"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871133"><span class="hs-identifier hs-var">code_fx</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871136"><span class="hs-identifier hs-var">code_fy</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr
</span><a href="#local-6989586621682871130"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871129"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871137"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871129"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871131"><span class="hs-identifier hs-var">reg_fx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871129"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871134"><span class="hs-identifier hs-var">reg_fy</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1050"></span><span>
</span><span id="line-1051"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MachOp
</span><a href="#local-6989586621682871051"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1052"></span><span>        </span><span class="hs-comment">-- Integer operations</span><span>
</span><span id="line-1053"></span><span>        </span><span class="hs-comment">-- Add/Sub should only be Integer Options.</span><span>
</span><span id="line-1054"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Add"><span class="hs-identifier hs-type">MO_Add</span></a></span><span> </span><span id="local-6989586621682871138"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871138"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; (Integer -&gt; Width -&gt; Maybe Operand)
-&gt; NatM Register
</span><a href="#local-6989586621682871078"><span class="hs-identifier hs-var">intOpImm</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871138"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871139"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871139"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871140"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871140"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871141"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871141"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; OrdList Instr) -&gt; Instr -&gt; OrdList Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871139"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871140"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871141"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Width -&gt; Maybe Operand
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getArithImm"><span class="hs-identifier hs-var">getArithImm</span></a></span><span>
</span><span id="line-1055"></span><span>        </span><span class="hs-comment">-- TODO: Handle sub-word case</span><span>
</span><span id="line-1056"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Sub"><span class="hs-identifier hs-type">MO_Sub</span></a></span><span> </span><span id="local-6989586621682871142"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871142"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; (Integer -&gt; Width -&gt; Maybe Operand)
-&gt; NatM Register
</span><a href="#local-6989586621682871078"><span class="hs-identifier hs-var">intOpImm</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871142"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871143"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871143"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871144"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871144"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871145"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871145"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; OrdList Instr) -&gt; Instr -&gt; OrdList Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SUB"><span class="hs-identifier hs-var">SUB</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871143"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871144"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871145"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Width -&gt; Maybe Operand
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getArithImm"><span class="hs-identifier hs-var">getArithImm</span></a></span><span>
</span><span id="line-1057"></span><span>
</span><span id="line-1058"></span><span>        </span><span class="hs-comment">-- Note [CSET]</span><span>
</span><span id="line-1059"></span><span>        </span><span class="hs-comment">-- ~~~~~~~~~~~</span><span>
</span><span id="line-1060"></span><span>        </span><span class="hs-comment">-- Setting conditional flags: the architecture internally knows the</span><span>
</span><span id="line-1061"></span><span>        </span><span class="hs-comment">-- following flag bits.  And based on thsoe comparisons as in the</span><span>
</span><span id="line-1062"></span><span>        </span><span class="hs-comment">-- table below.</span><span>
</span><span id="line-1063"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-1064"></span><span>        </span><span class="hs-comment">--    31  30  29  28</span><span>
</span><span id="line-1065"></span><span>        </span><span class="hs-comment">--  .---+---+---+---+-- - -</span><span>
</span><span id="line-1066"></span><span>        </span><span class="hs-comment">--  | N | Z | C | V |</span><span>
</span><span id="line-1067"></span><span>        </span><span class="hs-comment">--  '---+---+---+---+-- - -</span><span>
</span><span id="line-1068"></span><span>        </span><span class="hs-comment">--  Negative</span><span>
</span><span id="line-1069"></span><span>        </span><span class="hs-comment">--  Zero</span><span>
</span><span id="line-1070"></span><span>        </span><span class="hs-comment">--  Carry</span><span>
</span><span id="line-1071"></span><span>        </span><span class="hs-comment">--  oVerflow</span><span>
</span><span id="line-1072"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-1073"></span><span>        </span><span class="hs-comment">--  .------+-------------------------------------+-----------------+----------.</span><span>
</span><span id="line-1074"></span><span>        </span><span class="hs-comment">--  | Code | Meaning                             | Flags           | Encoding |</span><span>
</span><span id="line-1075"></span><span>        </span><span class="hs-comment">--  |------+-------------------------------------+-----------------+----------|</span><span>
</span><span id="line-1076"></span><span>        </span><span class="hs-comment">--  |  EQ  | Equal                               | Z = 1           | 0000     |</span><span>
</span><span id="line-1077"></span><span>        </span><span class="hs-comment">--  |  NE  | Not Equal                           | Z = 0           | 0001     |</span><span>
</span><span id="line-1078"></span><span>        </span><span class="hs-comment">--  |  HI  | Unsigned Higher                     | C = 1 &amp;&amp; Z = 0  | 1000     |</span><span>
</span><span id="line-1079"></span><span>        </span><span class="hs-comment">--  |  HS  | Unsigned Higher or Same             | C = 1           | 0010     |</span><span>
</span><span id="line-1080"></span><span>        </span><span class="hs-comment">--  |  LS  | Unsigned Lower or Same              | C = 0 || Z = 1  | 1001     |</span><span>
</span><span id="line-1081"></span><span>        </span><span class="hs-comment">--  |  LO  | Unsigned Lower                      | C = 0           | 0011     |</span><span>
</span><span id="line-1082"></span><span>        </span><span class="hs-comment">--  |  GT  | Signed Greater Than                 | Z = 0 &amp;&amp; N = V  | 1100     |</span><span>
</span><span id="line-1083"></span><span>        </span><span class="hs-comment">--  |  GE  | Signed Greater Than or Equal        | N = V           | 1010     |</span><span>
</span><span id="line-1084"></span><span>        </span><span class="hs-comment">--  |  LE  | Signed Less Than or Equal           | Z = 1 || N /= V | 1101     |</span><span>
</span><span id="line-1085"></span><span>        </span><span class="hs-comment">--  |  LT  | Signed Less Than                    | N /= V          | 1011     |</span><span>
</span><span id="line-1086"></span><span>        </span><span class="hs-comment">--  |  CS  | Carry Set (Unsigned Overflow)       | C = 1           | 0010     |</span><span>
</span><span id="line-1087"></span><span>        </span><span class="hs-comment">--  |  CC  | Carry Clear (No Unsigned Overflow)  | C = 0           | 0011     |</span><span>
</span><span id="line-1088"></span><span>        </span><span class="hs-comment">--  |  VS  | Signed Overflow                     | V = 1           | 0110     |</span><span>
</span><span id="line-1089"></span><span>        </span><span class="hs-comment">--  |  VC  | No Signed Overflow                  | V = 0           | 0111     |</span><span>
</span><span id="line-1090"></span><span>        </span><span class="hs-comment">--  |  MI  | Minus, Negative                     | N = 1           | 0100     |</span><span>
</span><span id="line-1091"></span><span>        </span><span class="hs-comment">--  |  PL  | Plus, Positive or Zero (!)          | N = 0           | 0101     |</span><span>
</span><span id="line-1092"></span><span>        </span><span class="hs-comment">--  |  AL  | Always                              | Any             | 1110     |</span><span>
</span><span id="line-1093"></span><span>        </span><span class="hs-comment">--  |  NV  | Never                               | Any             | 1111     |</span><span>
</span><span id="line-1094"></span><span>        </span><span class="hs-comment">--- '-------------------------------------------------------------------------'</span><span>
</span><span id="line-1095"></span><span>
</span><span id="line-1096"></span><span>        </span><span class="hs-comment">-- N.B. We needn't sign-extend sub-word size (in)equality comparisons</span><span>
</span><span id="line-1097"></span><span>        </span><span class="hs-comment">-- since we don't care about ordering.</span><span>
</span><span id="line-1098"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Eq"><span class="hs-identifier hs-type">MO_Eq</span></a></span><span> </span><span id="local-6989586621682871147"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871147"><span class="hs-identifier hs-var">w</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; (Integer -&gt; Width -&gt; Maybe Operand)
-&gt; NatM Register
</span><a href="#local-6989586621682871059"><span class="hs-identifier hs-var">bitOpImm</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871147"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871148"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871148"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871149"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871149"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871150"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871150"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Instr] -&gt; OrdList Instr
forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CMP"><span class="hs-identifier hs-var">CMP</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871149"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871150"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Cond -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CSET"><span class="hs-identifier hs-var">CSET</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871148"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="GHC.CmmToAsm.AArch64.Cond.html#EQ"><span class="hs-identifier hs-var">EQ</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Width -&gt; Maybe Operand
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getArithImm"><span class="hs-identifier hs-var">getArithImm</span></a></span><span>
</span><span id="line-1099"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Ne"><span class="hs-identifier hs-type">MO_Ne</span></a></span><span> </span><span id="local-6989586621682871152"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871152"><span class="hs-identifier hs-var">w</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; (Integer -&gt; Width -&gt; Maybe Operand)
-&gt; NatM Register
</span><a href="#local-6989586621682871059"><span class="hs-identifier hs-var">bitOpImm</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871152"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871153"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871153"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871154"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871154"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871155"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871155"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Instr] -&gt; OrdList Instr
forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CMP"><span class="hs-identifier hs-var">CMP</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871154"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871155"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Cond -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CSET"><span class="hs-identifier hs-var">CSET</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871153"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="GHC.CmmToAsm.AArch64.Cond.html#NE"><span class="hs-identifier hs-var">NE</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Width -&gt; Maybe Operand
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getArithImm"><span class="hs-identifier hs-var">getArithImm</span></a></span><span>
</span><span id="line-1100"></span><span>
</span><span id="line-1101"></span><span>        </span><span class="hs-comment">-- Signed multiply/divide</span><span>
</span><span id="line-1102"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Mul"><span class="hs-identifier hs-type">MO_Mul</span></a></span><span> </span><span id="local-6989586621682871157"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871157"><span class="hs-identifier hs-var">w</span></a></span></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; NatM Register
</span><a href="#local-6989586621682871082"><span class="hs-identifier hs-var">intOp</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871157"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871158"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871158"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871159"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871159"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871160"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871160"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; OrdList Instr) -&gt; Instr -&gt; OrdList Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#MUL"><span class="hs-identifier hs-var">MUL</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871158"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871159"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871160"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1103"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_S_MulMayOflo"><span class="hs-identifier hs-type">MO_S_MulMayOflo</span></a></span><span> </span><span id="local-6989586621682871162"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871162"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width -&gt; CmmExpr -&gt; CmmExpr -&gt; NatM Register
</span><a href="#local-6989586621682871163"><span class="hs-identifier hs-var">do_mul_may_oflo</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871162"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871052"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871053"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-1104"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_S_Quot"><span class="hs-identifier hs-type">MO_S_Quot</span></a></span><span> </span><span id="local-6989586621682871164"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871164"><span class="hs-identifier hs-var">w</span></a></span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; NatM Register
</span><a href="#local-6989586621682871082"><span class="hs-identifier hs-var">intOp</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871164"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871165"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871165"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871166"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871166"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871167"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871167"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; OrdList Instr) -&gt; Instr -&gt; OrdList Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SDIV"><span class="hs-identifier hs-var">SDIV</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871165"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871166"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871167"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1105"></span><span>
</span><span id="line-1106"></span><span>        </span><span class="hs-comment">-- No native rem instruction. So we'll compute the following</span><span>
</span><span id="line-1107"></span><span>        </span><span class="hs-comment">-- Rd  &lt;- Rx / Ry             | 2 &lt;- 7 / 3      -- SDIV Rd Rx Ry</span><span>
</span><span id="line-1108"></span><span>        </span><span class="hs-comment">-- Rd' &lt;- Rx - Rd * Ry        | 1 &lt;- 7 - 2 * 3  -- MSUB Rd' Rd Ry Rx</span><span>
</span><span id="line-1109"></span><span>        </span><span class="hs-comment">--        |     '---|----------------|---'   |</span><span>
</span><span id="line-1110"></span><span>        </span><span class="hs-comment">--        |         '----------------|-------'</span><span>
</span><span id="line-1111"></span><span>        </span><span class="hs-comment">--        '--------------------------'</span><span>
</span><span id="line-1112"></span><span>        </span><span class="hs-comment">-- Note the swap in Rx and Ry.</span><span>
</span><span id="line-1113"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_S_Rem"><span class="hs-identifier hs-type">MO_S_Rem</span></a></span><span> </span><span id="local-6989586621682871169"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871169"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width -&gt; (Operand -&gt; NatM Register) -&gt; NatM Register
forall {b}. Width -&gt; (Operand -&gt; NatM b) -&gt; NatM b
</span><a href="#local-6989586621682871056"><span class="hs-identifier hs-var">withTempIntReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871169"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">((Operand -&gt; NatM Register) -&gt; NatM Register)
-&gt; (Operand -&gt; NatM Register) -&gt; NatM Register
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682871170"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871170"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1114"></span><span>                      </span><span class="annot"><span class="annottext">Bool
-&gt; Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; NatM Register
</span><a href="#local-6989586621682871082"><span class="hs-identifier hs-var">intOp</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871169"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871171"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871171"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871172"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871172"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871173"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871173"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Instr] -&gt; OrdList Instr
forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SDIV"><span class="hs-identifier hs-var">SDIV</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871170"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871172"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871173"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#MSUB"><span class="hs-identifier hs-var">MSUB</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871171"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871170"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871173"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871172"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1115"></span><span>
</span><span id="line-1116"></span><span>        </span><span class="hs-comment">-- Unsigned multiply/divide</span><span>
</span><span id="line-1117"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_U_Quot"><span class="hs-identifier hs-type">MO_U_Quot</span></a></span><span> </span><span id="local-6989586621682871175"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871175"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; NatM Register
</span><a href="#local-6989586621682871082"><span class="hs-identifier hs-var">intOp</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871175"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871176"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871176"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871177"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871177"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871178"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871178"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; OrdList Instr) -&gt; Instr -&gt; OrdList Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#UDIV"><span class="hs-identifier hs-var">UDIV</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871176"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871177"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871178"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1118"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_U_Rem"><span class="hs-identifier hs-type">MO_U_Rem</span></a></span><span> </span><span id="local-6989586621682871179"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871179"><span class="hs-identifier hs-var">w</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width -&gt; (Operand -&gt; NatM Register) -&gt; NatM Register
forall {b}. Width -&gt; (Operand -&gt; NatM b) -&gt; NatM b
</span><a href="#local-6989586621682871056"><span class="hs-identifier hs-var">withTempIntReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871179"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">((Operand -&gt; NatM Register) -&gt; NatM Register)
-&gt; (Operand -&gt; NatM Register) -&gt; NatM Register
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682871180"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871180"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1119"></span><span>                       </span><span class="annot"><span class="annottext">Bool
-&gt; Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; NatM Register
</span><a href="#local-6989586621682871082"><span class="hs-identifier hs-var">intOp</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871179"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871181"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871181"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871182"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871182"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871183"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871183"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Instr] -&gt; OrdList Instr
forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#UDIV"><span class="hs-identifier hs-var">UDIV</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871180"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871182"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871183"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#MSUB"><span class="hs-identifier hs-var">MSUB</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871181"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871180"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871183"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871182"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1120"></span><span>
</span><span id="line-1121"></span><span>        </span><span class="hs-comment">-- Signed comparisons -- see Note [CSET]</span><span>
</span><span id="line-1122"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_S_Ge"><span class="hs-identifier hs-type">MO_S_Ge</span></a></span><span> </span><span id="local-6989586621682871184"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871184"><span class="hs-identifier hs-var">w</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; NatM Register
</span><a href="#local-6989586621682871082"><span class="hs-identifier hs-var">intOp</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871184"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871185"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871185"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871186"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871186"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871187"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871187"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Instr] -&gt; OrdList Instr
forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CMP"><span class="hs-identifier hs-var">CMP</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871186"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871187"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Cond -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CSET"><span class="hs-identifier hs-var">CSET</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871185"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="GHC.CmmToAsm.AArch64.Cond.html#SGE"><span class="hs-identifier hs-var">SGE</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1123"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_S_Le"><span class="hs-identifier hs-type">MO_S_Le</span></a></span><span> </span><span id="local-6989586621682871189"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871189"><span class="hs-identifier hs-var">w</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; NatM Register
</span><a href="#local-6989586621682871082"><span class="hs-identifier hs-var">intOp</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871189"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871190"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871190"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871191"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871191"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871192"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871192"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Instr] -&gt; OrdList Instr
forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CMP"><span class="hs-identifier hs-var">CMP</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871191"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871192"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Cond -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CSET"><span class="hs-identifier hs-var">CSET</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871190"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="GHC.CmmToAsm.AArch64.Cond.html#SLE"><span class="hs-identifier hs-var">SLE</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1124"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_S_Gt"><span class="hs-identifier hs-type">MO_S_Gt</span></a></span><span> </span><span id="local-6989586621682871194"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871194"><span class="hs-identifier hs-var">w</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; NatM Register
</span><a href="#local-6989586621682871082"><span class="hs-identifier hs-var">intOp</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871194"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871195"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871195"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871196"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871196"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871197"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871197"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Instr] -&gt; OrdList Instr
forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CMP"><span class="hs-identifier hs-var">CMP</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871196"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871197"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Cond -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CSET"><span class="hs-identifier hs-var">CSET</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871195"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="GHC.CmmToAsm.AArch64.Cond.html#SGT"><span class="hs-identifier hs-var">SGT</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1125"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_S_Lt"><span class="hs-identifier hs-type">MO_S_Lt</span></a></span><span> </span><span id="local-6989586621682871199"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871199"><span class="hs-identifier hs-var">w</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; NatM Register
</span><a href="#local-6989586621682871082"><span class="hs-identifier hs-var">intOp</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871199"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871200"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871200"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871201"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871201"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871202"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871202"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Instr] -&gt; OrdList Instr
forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CMP"><span class="hs-identifier hs-var">CMP</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871201"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871202"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Cond -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CSET"><span class="hs-identifier hs-var">CSET</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871200"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="GHC.CmmToAsm.AArch64.Cond.html#SLT"><span class="hs-identifier hs-var">SLT</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1126"></span><span>
</span><span id="line-1127"></span><span>        </span><span class="hs-comment">-- Unsigned comparisons</span><span>
</span><span id="line-1128"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_U_Ge"><span class="hs-identifier hs-type">MO_U_Ge</span></a></span><span> </span><span id="local-6989586621682871204"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871204"><span class="hs-identifier hs-var">w</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; (Integer -&gt; Width -&gt; Maybe Operand)
-&gt; NatM Register
</span><a href="#local-6989586621682871078"><span class="hs-identifier hs-var">intOpImm</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871204"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871205"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871205"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871206"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871206"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871207"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871207"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Instr] -&gt; OrdList Instr
forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CMP"><span class="hs-identifier hs-var">CMP</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871206"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871207"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Cond -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CSET"><span class="hs-identifier hs-var">CSET</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871205"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="GHC.CmmToAsm.AArch64.Cond.html#UGE"><span class="hs-identifier hs-var">UGE</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Width -&gt; Maybe Operand
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getArithImm"><span class="hs-identifier hs-var">getArithImm</span></a></span><span>
</span><span id="line-1129"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_U_Le"><span class="hs-identifier hs-type">MO_U_Le</span></a></span><span> </span><span id="local-6989586621682871209"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871209"><span class="hs-identifier hs-var">w</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; (Integer -&gt; Width -&gt; Maybe Operand)
-&gt; NatM Register
</span><a href="#local-6989586621682871078"><span class="hs-identifier hs-var">intOpImm</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871209"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871210"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871210"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871211"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871211"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871212"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871212"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Instr] -&gt; OrdList Instr
forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CMP"><span class="hs-identifier hs-var">CMP</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871211"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871212"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Cond -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CSET"><span class="hs-identifier hs-var">CSET</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871210"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="GHC.CmmToAsm.AArch64.Cond.html#ULE"><span class="hs-identifier hs-var">ULE</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Width -&gt; Maybe Operand
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getArithImm"><span class="hs-identifier hs-var">getArithImm</span></a></span><span>
</span><span id="line-1130"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_U_Gt"><span class="hs-identifier hs-type">MO_U_Gt</span></a></span><span> </span><span id="local-6989586621682871214"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871214"><span class="hs-identifier hs-var">w</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; (Integer -&gt; Width -&gt; Maybe Operand)
-&gt; NatM Register
</span><a href="#local-6989586621682871078"><span class="hs-identifier hs-var">intOpImm</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871214"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871215"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871215"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871216"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871216"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871217"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871217"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Instr] -&gt; OrdList Instr
forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CMP"><span class="hs-identifier hs-var">CMP</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871216"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871217"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Cond -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CSET"><span class="hs-identifier hs-var">CSET</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871215"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="GHC.CmmToAsm.AArch64.Cond.html#UGT"><span class="hs-identifier hs-var">UGT</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Width -&gt; Maybe Operand
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getArithImm"><span class="hs-identifier hs-var">getArithImm</span></a></span><span>
</span><span id="line-1131"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_U_Lt"><span class="hs-identifier hs-type">MO_U_Lt</span></a></span><span> </span><span id="local-6989586621682871219"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871219"><span class="hs-identifier hs-var">w</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; (Integer -&gt; Width -&gt; Maybe Operand)
-&gt; NatM Register
</span><a href="#local-6989586621682871078"><span class="hs-identifier hs-var">intOpImm</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871219"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871220"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871220"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871221"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871221"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871222"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871222"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Instr] -&gt; OrdList Instr
forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CMP"><span class="hs-identifier hs-var">CMP</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871221"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871222"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Cond -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CSET"><span class="hs-identifier hs-var">CSET</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871220"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="GHC.CmmToAsm.AArch64.Cond.html#ULT"><span class="hs-identifier hs-var">ULT</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Width -&gt; Maybe Operand
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getArithImm"><span class="hs-identifier hs-var">getArithImm</span></a></span><span>
</span><span id="line-1132"></span><span>
</span><span id="line-1133"></span><span>        </span><span class="hs-comment">-- Floating point arithmetic</span><span>
</span><span id="line-1134"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_F_Add"><span class="hs-identifier hs-type">MO_F_Add</span></a></span><span> </span><span id="local-6989586621682871224"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871224"><span class="hs-identifier hs-var">w</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; NatM Register
</span><a href="#local-6989586621682871118"><span class="hs-identifier hs-var">floatOp</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871224"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871225"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871225"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871226"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871226"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871227"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871227"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; OrdList Instr) -&gt; Instr -&gt; OrdList Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871225"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871226"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871227"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1135"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_F_Sub"><span class="hs-identifier hs-type">MO_F_Sub</span></a></span><span> </span><span id="local-6989586621682871228"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871228"><span class="hs-identifier hs-var">w</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; NatM Register
</span><a href="#local-6989586621682871118"><span class="hs-identifier hs-var">floatOp</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871228"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871229"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871229"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871230"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871230"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871231"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871231"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; OrdList Instr) -&gt; Instr -&gt; OrdList Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SUB"><span class="hs-identifier hs-var">SUB</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871229"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871230"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871231"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1136"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_F_Mul"><span class="hs-identifier hs-type">MO_F_Mul</span></a></span><span> </span><span id="local-6989586621682871232"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871232"><span class="hs-identifier hs-var">w</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; NatM Register
</span><a href="#local-6989586621682871118"><span class="hs-identifier hs-var">floatOp</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871232"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871233"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871233"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871234"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871234"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871235"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871235"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; OrdList Instr) -&gt; Instr -&gt; OrdList Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#MUL"><span class="hs-identifier hs-var">MUL</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871233"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871234"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871235"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1137"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_F_Quot"><span class="hs-identifier hs-type">MO_F_Quot</span></a></span><span> </span><span id="local-6989586621682871236"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871236"><span class="hs-identifier hs-var">w</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; NatM Register
</span><a href="#local-6989586621682871118"><span class="hs-identifier hs-var">floatOp</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871236"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871237"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871237"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871238"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871238"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871239"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871239"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; OrdList Instr) -&gt; Instr -&gt; OrdList Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SDIV"><span class="hs-identifier hs-var">SDIV</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871237"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871238"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871239"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1138"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_F_Min"><span class="hs-identifier hs-type">MO_F_Min</span></a></span><span> </span><span id="local-6989586621682871240"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871240"><span class="hs-identifier hs-var">w</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; NatM Register
</span><a href="#local-6989586621682871118"><span class="hs-identifier hs-var">floatOp</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871240"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871241"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871241"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871242"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871242"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871243"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871243"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; OrdList Instr) -&gt; Instr -&gt; OrdList Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#FMIN"><span class="hs-identifier hs-var">FMIN</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871241"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871242"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871243"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1139"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_F_Max"><span class="hs-identifier hs-type">MO_F_Max</span></a></span><span> </span><span id="local-6989586621682871245"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871245"><span class="hs-identifier hs-var">w</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; NatM Register
</span><a href="#local-6989586621682871118"><span class="hs-identifier hs-var">floatOp</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871245"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871246"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871246"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871247"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871247"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871248"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871248"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; OrdList Instr) -&gt; Instr -&gt; OrdList Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#FMAX"><span class="hs-identifier hs-var">FMAX</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871246"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871247"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871248"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1140"></span><span>
</span><span id="line-1141"></span><span>        </span><span class="hs-comment">-- Floating point comparison</span><span>
</span><span id="line-1142"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_F_Eq"><span class="hs-identifier hs-type">MO_F_Eq</span></a></span><span> </span><span id="local-6989586621682871250"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871250"><span class="hs-identifier hs-var">w</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; NatM Register
</span><a href="#local-6989586621682871128"><span class="hs-identifier hs-var">floatCond</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871250"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871251"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871251"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871252"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871252"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871253"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871253"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Instr] -&gt; OrdList Instr
forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CMP"><span class="hs-identifier hs-var">CMP</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871252"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871253"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Cond -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CSET"><span class="hs-identifier hs-var">CSET</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871251"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="GHC.CmmToAsm.AArch64.Cond.html#EQ"><span class="hs-identifier hs-var">EQ</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1143"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_F_Ne"><span class="hs-identifier hs-type">MO_F_Ne</span></a></span><span> </span><span id="local-6989586621682871254"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871254"><span class="hs-identifier hs-var">w</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; NatM Register
</span><a href="#local-6989586621682871128"><span class="hs-identifier hs-var">floatCond</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871254"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871255"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871255"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871256"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871256"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871257"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871257"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Instr] -&gt; OrdList Instr
forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CMP"><span class="hs-identifier hs-var">CMP</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871256"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871257"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Cond -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CSET"><span class="hs-identifier hs-var">CSET</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871255"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="GHC.CmmToAsm.AArch64.Cond.html#NE"><span class="hs-identifier hs-var">NE</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1144"></span><span>
</span><span id="line-1145"></span><span>        </span><span class="hs-comment">-- careful with the floating point operations.</span><span>
</span><span id="line-1146"></span><span>        </span><span class="hs-comment">-- SLE is effectively LE or unordered (NaN)</span><span>
</span><span id="line-1147"></span><span>        </span><span class="hs-comment">-- SLT is the same. ULE, and ULT will not return true for NaN.</span><span>
</span><span id="line-1148"></span><span>        </span><span class="hs-comment">-- This is a bit counter-intuitive. Don't let yourself be fooled by</span><span>
</span><span id="line-1149"></span><span>        </span><span class="hs-comment">-- the S/U prefix for floats, it's only meaningful for integers.</span><span>
</span><span id="line-1150"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_F_Ge"><span class="hs-identifier hs-type">MO_F_Ge</span></a></span><span> </span><span id="local-6989586621682871258"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871258"><span class="hs-identifier hs-var">w</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; NatM Register
</span><a href="#local-6989586621682871128"><span class="hs-identifier hs-var">floatCond</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871258"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871259"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871259"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871260"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871260"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871261"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871261"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Instr] -&gt; OrdList Instr
forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CMP"><span class="hs-identifier hs-var">CMP</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871260"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871261"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Cond -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CSET"><span class="hs-identifier hs-var">CSET</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871259"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="GHC.CmmToAsm.AArch64.Cond.html#OGE"><span class="hs-identifier hs-var">OGE</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1151"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_F_Le"><span class="hs-identifier hs-type">MO_F_Le</span></a></span><span> </span><span id="local-6989586621682871263"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871263"><span class="hs-identifier hs-var">w</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; NatM Register
</span><a href="#local-6989586621682871128"><span class="hs-identifier hs-var">floatCond</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871263"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871264"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871264"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871265"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871265"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871266"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871266"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Instr] -&gt; OrdList Instr
forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CMP"><span class="hs-identifier hs-var">CMP</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871265"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871266"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Cond -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CSET"><span class="hs-identifier hs-var">CSET</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871264"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="GHC.CmmToAsm.AArch64.Cond.html#OLE"><span class="hs-identifier hs-var">OLE</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- x &lt;= y &lt;=&gt; y &gt; x</span><span>
</span><span id="line-1152"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_F_Gt"><span class="hs-identifier hs-type">MO_F_Gt</span></a></span><span> </span><span id="local-6989586621682871268"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871268"><span class="hs-identifier hs-var">w</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; NatM Register
</span><a href="#local-6989586621682871128"><span class="hs-identifier hs-var">floatCond</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871268"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871269"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871269"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871270"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871270"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871271"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871271"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Instr] -&gt; OrdList Instr
forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CMP"><span class="hs-identifier hs-var">CMP</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871270"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871271"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Cond -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CSET"><span class="hs-identifier hs-var">CSET</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871269"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="GHC.CmmToAsm.AArch64.Cond.html#OGT"><span class="hs-identifier hs-var">OGT</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1153"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_F_Lt"><span class="hs-identifier hs-type">MO_F_Lt</span></a></span><span> </span><span id="local-6989586621682871273"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871273"><span class="hs-identifier hs-var">w</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; NatM Register
</span><a href="#local-6989586621682871128"><span class="hs-identifier hs-var">floatCond</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871273"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871274"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871274"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871275"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871275"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871276"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871276"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Instr] -&gt; OrdList Instr
forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CMP"><span class="hs-identifier hs-var">CMP</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871275"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871276"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Cond -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CSET"><span class="hs-identifier hs-var">CSET</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871274"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="GHC.CmmToAsm.AArch64.Cond.html#OLT"><span class="hs-identifier hs-var">OLT</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- x &lt; y &lt;=&gt; y &gt;= x</span><span>
</span><span id="line-1154"></span><span>
</span><span id="line-1155"></span><span>        </span><span class="hs-comment">-- Bitwise operations</span><span>
</span><span id="line-1156"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_And"><span class="hs-identifier hs-type">MO_And</span></a></span><span>   </span><span id="local-6989586621682871278"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871278"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; (Integer -&gt; Width -&gt; Maybe Operand)
-&gt; NatM Register
</span><a href="#local-6989586621682871059"><span class="hs-identifier hs-var">bitOpImm</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871278"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871279"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871279"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871280"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871280"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871281"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871281"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; OrdList Instr) -&gt; Instr -&gt; OrdList Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#AND"><span class="hs-identifier hs-var">AND</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871279"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871280"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871281"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Width -&gt; Maybe Operand
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getBitmaskImm"><span class="hs-identifier hs-var">getBitmaskImm</span></a></span><span>
</span><span id="line-1157"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Or"><span class="hs-identifier hs-type">MO_Or</span></a></span><span>    </span><span id="local-6989586621682871282"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871282"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; (Integer -&gt; Width -&gt; Maybe Operand)
-&gt; NatM Register
</span><a href="#local-6989586621682871059"><span class="hs-identifier hs-var">bitOpImm</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871282"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871283"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871283"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871284"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871284"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871285"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871285"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; OrdList Instr) -&gt; Instr -&gt; OrdList Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#ORR"><span class="hs-identifier hs-var">ORR</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871283"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871284"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871285"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Width -&gt; Maybe Operand
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getBitmaskImm"><span class="hs-identifier hs-var">getBitmaskImm</span></a></span><span>
</span><span id="line-1158"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Xor"><span class="hs-identifier hs-type">MO_Xor</span></a></span><span>   </span><span id="local-6989586621682871286"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871286"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; (Integer -&gt; Width -&gt; Maybe Operand)
-&gt; NatM Register
</span><a href="#local-6989586621682871059"><span class="hs-identifier hs-var">bitOpImm</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871286"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871287"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871287"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871288"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871288"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871289"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871289"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; OrdList Instr) -&gt; Instr -&gt; OrdList Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#EOR"><span class="hs-identifier hs-var">EOR</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871287"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871288"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871289"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Width -&gt; Maybe Operand
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getBitmaskImm"><span class="hs-identifier hs-var">getBitmaskImm</span></a></span><span>
</span><span id="line-1159"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Shl"><span class="hs-identifier hs-type">MO_Shl</span></a></span><span>   </span><span id="local-6989586621682871291"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871291"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; NatM Register
</span><a href="#local-6989586621682871082"><span class="hs-identifier hs-var">intOp</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871291"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871292"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871292"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871293"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871293"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871294"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871294"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; OrdList Instr) -&gt; Instr -&gt; OrdList Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#LSL"><span class="hs-identifier hs-var">LSL</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871292"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871293"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871294"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1160"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_U_Shr"><span class="hs-identifier hs-type">MO_U_Shr</span></a></span><span> </span><span id="local-6989586621682871295"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871295"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; NatM Register
</span><a href="#local-6989586621682871082"><span class="hs-identifier hs-var">intOp</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871295"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871296"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871296"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871297"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871297"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871298"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871298"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; OrdList Instr) -&gt; Instr -&gt; OrdList Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#LSR"><span class="hs-identifier hs-var">LSR</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871296"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871297"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871298"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1161"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_S_Shr"><span class="hs-identifier hs-type">MO_S_Shr</span></a></span><span> </span><span id="local-6989586621682871299"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871299"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; NatM Register
</span><a href="#local-6989586621682871082"><span class="hs-identifier hs-var">intOp</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871299"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871300"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871300"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871301"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871301"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871302"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871302"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; OrdList Instr) -&gt; Instr -&gt; OrdList Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#ASR"><span class="hs-identifier hs-var">ASR</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871300"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871301"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871302"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1162"></span><span>
</span><span id="line-1163"></span><span>        </span><span class="hs-comment">-- Non-dyadic MachOp with 2 arguments</span><span>
</span><span id="line-1164"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_S_Neg"><span class="hs-identifier hs-type">MO_S_Neg</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682871303"><span class="hs-identifier hs-var">notDyadic</span></a></span><span>
</span><span id="line-1165"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_F_Neg"><span class="hs-identifier hs-type">MO_F_Neg</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682871303"><span class="hs-identifier hs-var">notDyadic</span></a></span><span>
</span><span id="line-1166"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_FMA"><span class="hs-identifier hs-type">MO_FMA</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682871303"><span class="hs-identifier hs-var">notDyadic</span></a></span><span>
</span><span id="line-1167"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Not"><span class="hs-identifier hs-type">MO_Not</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682871303"><span class="hs-identifier hs-var">notDyadic</span></a></span><span>
</span><span id="line-1168"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_SF_Round"><span class="hs-identifier hs-type">MO_SF_Round</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682871303"><span class="hs-identifier hs-var">notDyadic</span></a></span><span>
</span><span id="line-1169"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_FS_Truncate"><span class="hs-identifier hs-type">MO_FS_Truncate</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682871303"><span class="hs-identifier hs-var">notDyadic</span></a></span><span>
</span><span id="line-1170"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_SS_Conv"><span class="hs-identifier hs-type">MO_SS_Conv</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682871303"><span class="hs-identifier hs-var">notDyadic</span></a></span><span>
</span><span id="line-1171"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_UU_Conv"><span class="hs-identifier hs-type">MO_UU_Conv</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682871303"><span class="hs-identifier hs-var">notDyadic</span></a></span><span>
</span><span id="line-1172"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_XX_Conv"><span class="hs-identifier hs-type">MO_XX_Conv</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682871303"><span class="hs-identifier hs-var">notDyadic</span></a></span><span>
</span><span id="line-1173"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_FF_Conv"><span class="hs-identifier hs-type">MO_FF_Conv</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682871303"><span class="hs-identifier hs-var">notDyadic</span></a></span><span>
</span><span id="line-1174"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_WF_Bitcast"><span class="hs-identifier hs-type">MO_WF_Bitcast</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682871303"><span class="hs-identifier hs-var">notDyadic</span></a></span><span>
</span><span id="line-1175"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_FW_Bitcast"><span class="hs-identifier hs-type">MO_FW_Bitcast</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682871303"><span class="hs-identifier hs-var">notDyadic</span></a></span><span>
</span><span id="line-1176"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_V_Broadcast"><span class="hs-identifier hs-type">MO_V_Broadcast</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682871303"><span class="hs-identifier hs-var">notDyadic</span></a></span><span>
</span><span id="line-1177"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VF_Broadcast"><span class="hs-identifier hs-type">MO_VF_Broadcast</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682871303"><span class="hs-identifier hs-var">notDyadic</span></a></span><span>
</span><span id="line-1178"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_V_Insert"><span class="hs-identifier hs-type">MO_V_Insert</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682871303"><span class="hs-identifier hs-var">notDyadic</span></a></span><span>
</span><span id="line-1179"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VF_Insert"><span class="hs-identifier hs-type">MO_VF_Insert</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682871303"><span class="hs-identifier hs-var">notDyadic</span></a></span><span>
</span><span id="line-1180"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_AlignmentCheck"><span class="hs-identifier hs-type">MO_AlignmentCheck</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682871303"><span class="hs-identifier hs-var">notDyadic</span></a></span><span>
</span><span id="line-1181"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_RelaxedRead"><span class="hs-identifier hs-type">MO_RelaxedRead</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
</span><a href="#local-6989586621682871303"><span class="hs-identifier hs-var">notDyadic</span></a></span><span>
</span><span id="line-1182"></span><span>
</span><span id="line-1183"></span><span>        </span><span class="hs-comment">-- Vector operations: currently unsupported in the AArch64 NCG.</span><span>
</span><span id="line-1184"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_V_Extract"><span class="hs-identifier hs-type">MO_V_Extract</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
forall {a}. a
</span><a href="#local-6989586621682871304"><span class="hs-identifier hs-var">vectorsNeedLlvm</span></a></span><span>
</span><span id="line-1185"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_V_Add"><span class="hs-identifier hs-type">MO_V_Add</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
forall {a}. a
</span><a href="#local-6989586621682871304"><span class="hs-identifier hs-var">vectorsNeedLlvm</span></a></span><span>
</span><span id="line-1186"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_V_Sub"><span class="hs-identifier hs-type">MO_V_Sub</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
forall {a}. a
</span><a href="#local-6989586621682871304"><span class="hs-identifier hs-var">vectorsNeedLlvm</span></a></span><span>
</span><span id="line-1187"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_V_Mul"><span class="hs-identifier hs-type">MO_V_Mul</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
forall {a}. a
</span><a href="#local-6989586621682871304"><span class="hs-identifier hs-var">vectorsNeedLlvm</span></a></span><span>
</span><span id="line-1188"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VS_Quot"><span class="hs-identifier hs-type">MO_VS_Quot</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
forall {a}. a
</span><a href="#local-6989586621682871304"><span class="hs-identifier hs-var">vectorsNeedLlvm</span></a></span><span>
</span><span id="line-1189"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VS_Rem"><span class="hs-identifier hs-type">MO_VS_Rem</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
forall {a}. a
</span><a href="#local-6989586621682871304"><span class="hs-identifier hs-var">vectorsNeedLlvm</span></a></span><span>
</span><span id="line-1190"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VS_Neg"><span class="hs-identifier hs-type">MO_VS_Neg</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
forall {a}. a
</span><a href="#local-6989586621682871304"><span class="hs-identifier hs-var">vectorsNeedLlvm</span></a></span><span>
</span><span id="line-1191"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VU_Quot"><span class="hs-identifier hs-type">MO_VU_Quot</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
forall {a}. a
</span><a href="#local-6989586621682871304"><span class="hs-identifier hs-var">vectorsNeedLlvm</span></a></span><span>
</span><span id="line-1192"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VU_Rem"><span class="hs-identifier hs-type">MO_VU_Rem</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
forall {a}. a
</span><a href="#local-6989586621682871304"><span class="hs-identifier hs-var">vectorsNeedLlvm</span></a></span><span>
</span><span id="line-1193"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VF_Extract"><span class="hs-identifier hs-type">MO_VF_Extract</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
forall {a}. a
</span><a href="#local-6989586621682871304"><span class="hs-identifier hs-var">vectorsNeedLlvm</span></a></span><span>
</span><span id="line-1194"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VF_Add"><span class="hs-identifier hs-type">MO_VF_Add</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
forall {a}. a
</span><a href="#local-6989586621682871304"><span class="hs-identifier hs-var">vectorsNeedLlvm</span></a></span><span>
</span><span id="line-1195"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VF_Sub"><span class="hs-identifier hs-type">MO_VF_Sub</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
forall {a}. a
</span><a href="#local-6989586621682871304"><span class="hs-identifier hs-var">vectorsNeedLlvm</span></a></span><span>
</span><span id="line-1196"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VF_Neg"><span class="hs-identifier hs-type">MO_VF_Neg</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
forall {a}. a
</span><a href="#local-6989586621682871304"><span class="hs-identifier hs-var">vectorsNeedLlvm</span></a></span><span>
</span><span id="line-1197"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VF_Mul"><span class="hs-identifier hs-type">MO_VF_Mul</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
forall {a}. a
</span><a href="#local-6989586621682871304"><span class="hs-identifier hs-var">vectorsNeedLlvm</span></a></span><span>
</span><span id="line-1198"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VF_Quot"><span class="hs-identifier hs-type">MO_VF_Quot</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
forall {a}. a
</span><a href="#local-6989586621682871304"><span class="hs-identifier hs-var">vectorsNeedLlvm</span></a></span><span>
</span><span id="line-1199"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_V_Shuffle"><span class="hs-identifier hs-type">MO_V_Shuffle</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
forall {a}. a
</span><a href="#local-6989586621682871304"><span class="hs-identifier hs-var">vectorsNeedLlvm</span></a></span><span>
</span><span id="line-1200"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VF_Shuffle"><span class="hs-identifier hs-type">MO_VF_Shuffle</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
forall {a}. a
</span><a href="#local-6989586621682871304"><span class="hs-identifier hs-var">vectorsNeedLlvm</span></a></span><span>
</span><span id="line-1201"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VU_Min"><span class="hs-identifier hs-type">MO_VU_Min</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
forall {a}. a
</span><a href="#local-6989586621682871304"><span class="hs-identifier hs-var">vectorsNeedLlvm</span></a></span><span>
</span><span id="line-1202"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VU_Max"><span class="hs-identifier hs-type">MO_VU_Max</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
forall {a}. a
</span><a href="#local-6989586621682871304"><span class="hs-identifier hs-var">vectorsNeedLlvm</span></a></span><span>
</span><span id="line-1203"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VS_Min"><span class="hs-identifier hs-type">MO_VS_Min</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
forall {a}. a
</span><a href="#local-6989586621682871304"><span class="hs-identifier hs-var">vectorsNeedLlvm</span></a></span><span>
</span><span id="line-1204"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VS_Max"><span class="hs-identifier hs-type">MO_VS_Max</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
forall {a}. a
</span><a href="#local-6989586621682871304"><span class="hs-identifier hs-var">vectorsNeedLlvm</span></a></span><span>
</span><span id="line-1205"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VF_Min"><span class="hs-identifier hs-type">MO_VF_Min</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
forall {a}. a
</span><a href="#local-6989586621682871304"><span class="hs-identifier hs-var">vectorsNeedLlvm</span></a></span><span>
</span><span id="line-1206"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VF_Max"><span class="hs-identifier hs-type">MO_VF_Max</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
forall {a}. a
</span><a href="#local-6989586621682871304"><span class="hs-identifier hs-var">vectorsNeedLlvm</span></a></span><span>
</span><span id="line-1207"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-1208"></span><span>          </span><span id="local-6989586621682871303"><span class="annot"><span class="annottext">notDyadic :: NatM Register
</span><a href="#local-6989586621682871303"><span class="hs-identifier hs-var hs-var">notDyadic</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1209"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; NatM Register
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getRegister' (non-dyadic CmmMachOp with 2 arguments): &quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; NatM Register) -&gt; SDoc -&gt; NatM Register
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1210"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MachOp -&gt; SDoc
</span><a href="GHC.Cmm.MachOp.html#pprMachOp"><span class="hs-identifier hs-var">pprMachOp</span></a></span><span> </span><span class="annot"><span class="annottext">MachOp
</span><a href="#local-6989586621682871051"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;in&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; CmmExpr -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682870629"><span class="hs-identifier hs-var">plat</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1211"></span><span>          </span><span id="local-6989586621682871304"><span class="annot"><span class="annottext">vectorsNeedLlvm :: a
</span><a href="#local-6989586621682871304"><span class="hs-identifier hs-var hs-var">vectorsNeedLlvm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1212"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; a
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#sorry"><span class="hs-identifier hs-var">sorry</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SIMD operations on AArch64 currently require the LLVM backend&quot;</span></span><span>
</span><span id="line-1213"></span><span>
</span><span id="line-1214"></span><span>    </span><span class="hs-comment">-- Generic ternary case.</span><span>
</span><span id="line-1215"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-type">CmmMachOp</span></a></span><span> </span><span id="local-6989586621682871308"><span class="annot"><span class="annottext">MachOp
</span><a href="#local-6989586621682871308"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871309"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871309"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871310"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871310"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871311"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871311"><span class="hs-identifier hs-var">z</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1216"></span><span>
</span><span id="line-1217"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MachOp
</span><a href="#local-6989586621682871308"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1218"></span><span>
</span><span id="line-1219"></span><span>        </span><span class="hs-comment">-- Floating-point fused multiply-add operations</span><span>
</span><span id="line-1220"></span><span>
</span><span id="line-1221"></span><span>        </span><span class="hs-comment">-- x86 fmadd    x * y + z &lt;=&gt; AArch64 fmadd : d =   r1 * r2 + r3</span><span>
</span><span id="line-1222"></span><span>        </span><span class="hs-comment">-- x86 fmsub    x * y - z &lt;=&gt; AArch64 fnmsub: d =   r1 * r2 - r3</span><span>
</span><span id="line-1223"></span><span>        </span><span class="hs-comment">-- x86 fnmadd - x * y + z &lt;=&gt; AArch64 fmsub : d = - r1 * r2 + r3</span><span>
</span><span id="line-1224"></span><span>        </span><span class="hs-comment">-- x86 fnmsub - x * y - z &lt;=&gt; AArch64 fnmadd: d = - r1 * r2 - r3</span><span>
</span><span id="line-1225"></span><span>
</span><span id="line-1226"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_FMA"><span class="hs-identifier hs-type">MO_FMA</span></a></span><span> </span><span id="local-6989586621682871312"><span class="annot"><span class="annottext">FMASign
</span><a href="#local-6989586621682871312"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span id="local-6989586621682871313"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871313"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621682871314"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871314"><span class="hs-identifier hs-var">w</span></a></span></span><span>
</span><span id="line-1227"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871313"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1228"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FMASign
</span><a href="#local-6989586621682871312"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1229"></span><span>            </span><span class="annot"><span class="annottext">FMASign
</span><a href="GHC.Cmm.MachOp.html#FMAdd"><span class="hs-identifier hs-var">FMAdd</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; NatM Register
</span><a href="#local-6989586621682871316"><span class="hs-identifier hs-var">float3Op</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871314"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871317"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871317"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871318"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871318"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682871319"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871319"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682871320"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871320"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; OrdList Instr) -&gt; Instr -&gt; OrdList Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FMASign -&gt; Operand -&gt; Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#FMA"><span class="hs-identifier hs-var">FMA</span></a></span><span> </span><span class="annot"><span class="annottext">FMASign
</span><a href="GHC.Cmm.MachOp.html#FMAdd"><span class="hs-identifier hs-var">FMAdd</span></a></span><span>  </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871317"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871318"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871319"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871320"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1230"></span><span>            </span><span class="annot"><span class="annottext">FMASign
</span><a href="GHC.Cmm.MachOp.html#FMSub"><span class="hs-identifier hs-var">FMSub</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; NatM Register
</span><a href="#local-6989586621682871316"><span class="hs-identifier hs-var">float3Op</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871314"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871323"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871323"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871324"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871324"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682871325"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871325"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682871326"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871326"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; OrdList Instr) -&gt; Instr -&gt; OrdList Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FMASign -&gt; Operand -&gt; Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#FMA"><span class="hs-identifier hs-var">FMA</span></a></span><span> </span><span class="annot"><span class="annottext">FMASign
</span><a href="GHC.Cmm.MachOp.html#FNMSub"><span class="hs-identifier hs-var">FNMSub</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871323"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871324"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871325"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871326"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1231"></span><span>            </span><span class="annot"><span class="annottext">FMASign
</span><a href="GHC.Cmm.MachOp.html#FNMAdd"><span class="hs-identifier hs-var">FNMAdd</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; NatM Register
</span><a href="#local-6989586621682871316"><span class="hs-identifier hs-var">float3Op</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871314"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871329"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871329"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871330"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871330"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682871331"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871331"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682871332"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871332"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; OrdList Instr) -&gt; Instr -&gt; OrdList Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FMASign -&gt; Operand -&gt; Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#FMA"><span class="hs-identifier hs-var">FMA</span></a></span><span> </span><span class="annot"><span class="annottext">FMASign
</span><a href="GHC.Cmm.MachOp.html#FMSub"><span class="hs-identifier hs-var">FMSub</span></a></span><span>  </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871329"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871330"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871331"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871332"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1232"></span><span>            </span><span class="annot"><span class="annottext">FMASign
</span><a href="GHC.Cmm.MachOp.html#FNMSub"><span class="hs-identifier hs-var">FNMSub</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; NatM Register
</span><a href="#local-6989586621682871316"><span class="hs-identifier hs-var">float3Op</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871314"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871333"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871333"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871334"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871334"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682871335"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871335"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682871336"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871336"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; OrdList Instr) -&gt; Instr -&gt; OrdList Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FMASign -&gt; Operand -&gt; Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#FMA"><span class="hs-identifier hs-var">FMA</span></a></span><span> </span><span class="annot"><span class="annottext">FMASign
</span><a href="GHC.Cmm.MachOp.html#FNMAdd"><span class="hs-identifier hs-var">FNMAdd</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871333"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871334"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871335"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871336"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1233"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1234"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
forall {a}. a
</span><a href="#local-6989586621682871337"><span class="hs-identifier hs-var">vectorsNeedLlvm</span></a></span><span>
</span><span id="line-1235"></span><span>
</span><span id="line-1236"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_V_Insert"><span class="hs-identifier hs-type">MO_V_Insert</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
forall {a}. a
</span><a href="#local-6989586621682871337"><span class="hs-identifier hs-var">vectorsNeedLlvm</span></a></span><span>
</span><span id="line-1237"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_VF_Insert"><span class="hs-identifier hs-type">MO_VF_Insert</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM Register
forall {a}. a
</span><a href="#local-6989586621682871337"><span class="hs-identifier hs-var">vectorsNeedLlvm</span></a></span><span>
</span><span id="line-1238"></span><span>
</span><span id="line-1239"></span><span>        </span><span class="annot"><span class="annottext">MachOp
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; NatM Register
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getRegister' (unhandled ternary CmmMachOp): &quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; NatM Register) -&gt; SDoc -&gt; NatM Register
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1240"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MachOp -&gt; SDoc
</span><a href="GHC.Cmm.MachOp.html#pprMachOp"><span class="hs-identifier hs-var">pprMachOp</span></a></span><span> </span><span class="annot"><span class="annottext">MachOp
</span><a href="#local-6989586621682871308"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;in&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; CmmExpr -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682870629"><span class="hs-identifier hs-var">plat</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1241"></span><span>
</span><span id="line-1242"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1243"></span><span>          </span><span id="local-6989586621682871337"><span class="annot"><span class="annottext">vectorsNeedLlvm :: a
</span><a href="#local-6989586621682871337"><span class="hs-identifier hs-var hs-var">vectorsNeedLlvm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1244"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; a
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#sorry"><span class="hs-identifier hs-var">sorry</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SIMD operations on AArch64 currently require the LLVM backend&quot;</span></span><span>
</span><span id="line-1245"></span><span>          </span><span id="local-6989586621682871316"><span class="annot"><span class="annottext">float3Op :: Width
-&gt; (Operand -&gt; Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; NatM Register
</span><a href="#local-6989586621682871316"><span class="hs-identifier hs-var hs-var">float3Op</span></a></span></span><span> </span><span id="local-6989586621682871340"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871340"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682871341"><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr
</span><a href="#local-6989586621682871341"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1246"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682871342"><span class="annot"><a href="#local-6989586621682871342"><span class="hs-identifier hs-var">reg_fx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871343"><span class="annot"><a href="#local-6989586621682871343"><span class="hs-identifier hs-var">format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871344"><span class="annot"><a href="#local-6989586621682871344"><span class="hs-identifier hs-var">code_fx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getFloatReg"><span class="hs-identifier hs-var">getFloatReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871309"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1247"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682871345"><span class="annot"><a href="#local-6989586621682871345"><span class="hs-identifier hs-var">reg_fy</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871346"><span class="annot"><a href="#local-6989586621682871346"><span class="hs-identifier hs-var">format_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871347"><span class="annot"><a href="#local-6989586621682871347"><span class="hs-identifier hs-var">code_fy</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getFloatReg"><span class="hs-identifier hs-type">getFloatReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871310"><span class="hs-identifier hs-type">y</span></a></span><span>
</span><span id="line-1248"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682871348"><span class="annot"><a href="#local-6989586621682871348"><span class="hs-identifier hs-var">reg_fz</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871349"><span class="annot"><a href="#local-6989586621682871349"><span class="hs-identifier hs-var">format_z</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871350"><span class="annot"><a href="#local-6989586621682871350"><span class="hs-identifier hs-var">code_fz</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getFloatReg"><span class="hs-identifier hs-type">getFloatReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871311"><span class="hs-identifier hs-type">z</span></a></span><span>
</span><span id="line-1249"></span><span>            </span><span class="annot"><a href="GHC.Utils.Panic.html#massertPpr"><span class="hs-identifier hs-type">massertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Format.html#isFloatFormat"><span class="hs-identifier hs-type">isFloatFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871343"><span class="hs-identifier hs-type">format_x</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Format.html#isFloatFormat"><span class="hs-identifier hs-type">isFloatFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871346"><span class="hs-identifier hs-type">format_y</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Format.html#isFloatFormat"><span class="hs-identifier hs-type">isFloatFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871349"><span class="hs-identifier hs-type">format_z</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1250"></span><span>              </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;float3Op: non-float&quot;</span></span><span>
</span><span id="line-1251"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1252"></span><span>              </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Format.html#floatFormat"><span class="hs-identifier hs-type">floatFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871340"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682871351"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871351"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1253"></span><span>                </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871344"><span class="hs-identifier hs-var">code_fx</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span>
</span><span id="line-1254"></span><span>                </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871347"><span class="hs-identifier hs-var">code_fy</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span>
</span><span id="line-1255"></span><span>                </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871350"><span class="hs-identifier hs-var">code_fz</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span>
</span><span id="line-1256"></span><span>                </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Operand -&gt; OrdList Instr
</span><a href="#local-6989586621682871341"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871340"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871351"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871340"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871342"><span class="hs-identifier hs-var">reg_fx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871340"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871345"><span class="hs-identifier hs-var">reg_fy</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871340"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871348"><span class="hs-identifier hs-var">reg_fz</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1257"></span><span>
</span><span id="line-1258"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-type">CmmMachOp</span></a></span><span> </span><span id="local-6989586621682871352"><span class="annot"><span class="annottext">MachOp
</span><a href="#local-6989586621682871352"><span class="hs-identifier hs-var">_op</span></a></span></span><span> </span><span id="local-6989586621682871353"><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682871353"><span class="hs-identifier hs-var">_xs</span></a></span></span><span>
</span><span id="line-1259"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; NatM Register
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getRegister' (variadic CmmMachOp): &quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; CmmExpr -&gt; SDoc
forall env a. OutputableP env a =&gt; env -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-var">pdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682870629"><span class="hs-identifier hs-var">plat</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682870630"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1260"></span><span>
</span><span id="line-1261"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1262"></span><span>    </span><span class="annot"><a href="#local-6989586621682870651"><span class="hs-identifier hs-type">isNbitEncodeable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1263"></span><span>    </span><span id="local-6989586621682870651"><span class="annot"><span class="annottext">isNbitEncodeable :: Int -&gt; Integer -&gt; Bool
</span><a href="#local-6989586621682870651"><span class="hs-identifier hs-var hs-var">isNbitEncodeable</span></a></span></span><span> </span><span id="local-6989586621682871354"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871354"><span class="hs-identifier hs-var">n_bits</span></a></span></span><span> </span><span id="local-6989586621682871355"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682871355"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682871356"><span class="annot"><span class="annottext">shift :: Int
</span><a href="#local-6989586621682871356"><span class="hs-identifier hs-var hs-var">shift</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871354"><span class="hs-identifier hs-var">n_bits</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Int -&gt; Integer
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="GHC.Prelude.Basic.html#shiftL"><span class="hs-operator hs-var">`shiftL`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871356"><span class="hs-identifier hs-var">shift</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682871355"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682871355"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Int -&gt; Integer
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="GHC.Prelude.Basic.html#shiftL"><span class="hs-operator hs-var">`shiftL`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871356"><span class="hs-identifier hs-var">shift</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1264"></span><span>
</span><span id="line-1265"></span><span>    </span><span class="hs-comment">-- N.B. MUL does not set the overflow flag.</span><span>
</span><span id="line-1266"></span><span>    </span><span class="hs-comment">-- These implementations are based on output from GCC 11.</span><span>
</span><span id="line-1267"></span><span>    </span><span class="annot"><a href="#local-6989586621682871163"><span class="hs-identifier hs-type">do_mul_may_oflo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#Width"><span class="hs-identifier hs-type">Width</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a></span><span>
</span><span id="line-1268"></span><span>    </span><span id="local-6989586621682871163"><span class="annot"><span class="annottext">do_mul_may_oflo :: Width -&gt; CmmExpr -&gt; CmmExpr -&gt; NatM Register
</span><a href="#local-6989586621682871163"><span class="hs-identifier hs-var hs-var">do_mul_may_oflo</span></a></span></span><span> </span><span id="local-6989586621682871358"><span class="annot"><span class="annottext">w :: Width
</span><a href="#local-6989586621682871358"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span> </span><span id="local-6989586621682871359"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871359"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871360"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871360"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1269"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682871361"><span class="annot"><a href="#local-6989586621682871361"><span class="hs-identifier hs-var">reg_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871362"><span class="annot"><a href="#local-6989586621682871362"><span class="hs-identifier hs-var">_format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871363"><span class="annot"><a href="#local-6989586621682871363"><span class="hs-identifier hs-var">code_x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871359"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1270"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682871364"><span class="annot"><a href="#local-6989586621682871364"><span class="hs-identifier hs-var">reg_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871365"><span class="annot"><a href="#local-6989586621682871365"><span class="hs-identifier hs-var">_format_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871366"><span class="annot"><a href="#local-6989586621682871366"><span class="hs-identifier hs-var">code_y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-type">getSomeReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871360"><span class="hs-identifier hs-type">y</span></a></span><span>
</span><span id="line-1271"></span><span>        </span><span id="local-6989586621682871367"><span class="annot"><a href="#local-6989586621682871367"><span class="hs-identifier hs-var">lo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#getNewRegNat"><span class="hs-identifier hs-type">getNewRegNat</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Format.html#II64"><span class="hs-identifier hs-type">II64</span></a></span><span>
</span><span id="line-1272"></span><span>        </span><span id="local-6989586621682871368"><span class="annot"><a href="#local-6989586621682871368"><span class="hs-identifier hs-var">hi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#getNewRegNat"><span class="hs-identifier hs-type">getNewRegNat</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Format.html#II64"><span class="hs-identifier hs-type">II64</span></a></span><span>
</span><span id="line-1273"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-type">intFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871358"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871369"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871369"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1274"></span><span>            </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871363"><span class="hs-identifier hs-var">code_x</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span>
</span><span id="line-1275"></span><span>            </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871366"><span class="hs-identifier hs-var">code_y</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span>
</span><span id="line-1276"></span><span>            </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#MUL"><span class="hs-identifier hs-var">MUL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871358"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871367"><span class="hs-identifier hs-var">lo</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871358"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871361"><span class="hs-identifier hs-var">reg_x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871358"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871364"><span class="hs-identifier hs-var">reg_y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span>
</span><span id="line-1277"></span><span>            </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SMULH"><span class="hs-identifier hs-var">SMULH</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871358"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871368"><span class="hs-identifier hs-var">hi</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871358"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871361"><span class="hs-identifier hs-var">reg_x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871358"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871364"><span class="hs-identifier hs-var">reg_y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span>
</span><span id="line-1278"></span><span>            </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CMP"><span class="hs-identifier hs-var">CMP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871358"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871368"><span class="hs-identifier hs-var">hi</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; ShiftMode -&gt; Int -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpRegShift"><span class="hs-identifier hs-var">OpRegShift</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871358"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871367"><span class="hs-identifier hs-var">lo</span></a></span><span> </span><span class="annot"><span class="annottext">ShiftMode
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SASR"><span class="hs-identifier hs-var">SASR</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">63</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span>
</span><span id="line-1279"></span><span>            </span><span class="annot"><span class="annottext">Operand -&gt; Cond -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CSET"><span class="hs-identifier hs-var">CSET</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871358"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871369"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="GHC.CmmToAsm.AArch64.Cond.html#NE"><span class="hs-identifier hs-var">NE</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1280"></span><span>
</span><span id="line-1281"></span><span>    </span><span class="annot"><a href="#local-6989586621682871163"><span class="hs-identifier hs-var">do_mul_may_oflo</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span id="local-6989586621682871373"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871373"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871374"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871374"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1282"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682871375"><span class="annot"><a href="#local-6989586621682871375"><span class="hs-identifier hs-var">reg_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871376"><span class="annot"><a href="#local-6989586621682871376"><span class="hs-identifier hs-var">_format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871377"><span class="annot"><a href="#local-6989586621682871377"><span class="hs-identifier hs-var">code_x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871373"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1283"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682871378"><span class="annot"><a href="#local-6989586621682871378"><span class="hs-identifier hs-var">reg_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871379"><span class="annot"><a href="#local-6989586621682871379"><span class="hs-identifier hs-var">_format_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871380"><span class="annot"><a href="#local-6989586621682871380"><span class="hs-identifier hs-var">code_y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-type">getSomeReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871374"><span class="hs-identifier hs-type">y</span></a></span><span>
</span><span id="line-1284"></span><span>        </span><span id="local-6989586621682871381"><span class="annot"><a href="#local-6989586621682871381"><span class="hs-identifier hs-var">tmp1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#getNewRegNat"><span class="hs-identifier hs-type">getNewRegNat</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Format.html#II64"><span class="hs-identifier hs-type">II64</span></a></span><span>
</span><span id="line-1285"></span><span>        </span><span id="local-6989586621682871382"><span class="annot"><a href="#local-6989586621682871382"><span class="hs-identifier hs-var">tmp2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#getNewRegNat"><span class="hs-identifier hs-type">getNewRegNat</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Format.html#II64"><span class="hs-identifier hs-type">II64</span></a></span><span>
</span><span id="line-1286"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-type">intFormat</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-type">W32</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871383"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871383"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1287"></span><span>            </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871377"><span class="hs-identifier hs-var">code_x</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span>
</span><span id="line-1288"></span><span>            </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871380"><span class="hs-identifier hs-var">code_y</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span>
</span><span id="line-1289"></span><span>            </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SMULL"><span class="hs-identifier hs-var">SMULL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871381"><span class="hs-identifier hs-var">tmp1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871375"><span class="hs-identifier hs-var">reg_x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871378"><span class="hs-identifier hs-var">reg_y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span>
</span><span id="line-1290"></span><span>            </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#ASR"><span class="hs-identifier hs-var">ASR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871382"><span class="hs-identifier hs-var">tmp2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871381"><span class="hs-identifier hs-var">tmp1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">31</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span>
</span><span id="line-1291"></span><span>            </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CMP"><span class="hs-identifier hs-var">CMP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871382"><span class="hs-identifier hs-var">tmp2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; ShiftMode -&gt; Int -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpRegShift"><span class="hs-identifier hs-var">OpRegShift</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871381"><span class="hs-identifier hs-var">tmp1</span></a></span><span> </span><span class="annot"><span class="annottext">ShiftMode
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SASR"><span class="hs-identifier hs-var">SASR</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">31</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span>
</span><span id="line-1292"></span><span>            </span><span class="annot"><span class="annottext">Operand -&gt; Cond -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CSET"><span class="hs-identifier hs-var">CSET</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871383"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="GHC.CmmToAsm.AArch64.Cond.html#NE"><span class="hs-identifier hs-var">NE</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1293"></span><span>
</span><span id="line-1294"></span><span>    </span><span class="annot"><a href="#local-6989586621682871163"><span class="hs-identifier hs-var">do_mul_may_oflo</span></a></span><span> </span><span id="local-6989586621682871385"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871385"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682871386"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871386"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682871387"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871387"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1295"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682871388"><span class="annot"><a href="#local-6989586621682871388"><span class="hs-identifier hs-var">reg_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871389"><span class="annot"><a href="#local-6989586621682871389"><span class="hs-identifier hs-var">_format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871390"><span class="annot"><a href="#local-6989586621682871390"><span class="hs-identifier hs-var">code_x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871386"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1296"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682871391"><span class="annot"><a href="#local-6989586621682871391"><span class="hs-identifier hs-var">reg_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871392"><span class="annot"><a href="#local-6989586621682871392"><span class="hs-identifier hs-var">_format_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871393"><span class="annot"><a href="#local-6989586621682871393"><span class="hs-identifier hs-var">code_y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-type">getSomeReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871387"><span class="hs-identifier hs-type">y</span></a></span><span>
</span><span id="line-1297"></span><span>        </span><span id="local-6989586621682871394"><span class="annot"><a href="#local-6989586621682871394"><span class="hs-identifier hs-var">tmp1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#getNewRegNat"><span class="hs-identifier hs-type">getNewRegNat</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Format.html#II32"><span class="hs-identifier hs-type">II32</span></a></span><span>
</span><span id="line-1298"></span><span>        </span><span id="local-6989586621682871395"><span class="annot"><a href="#local-6989586621682871395"><span class="hs-identifier hs-var">tmp2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#getNewRegNat"><span class="hs-identifier hs-type">getNewRegNat</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Format.html#II32"><span class="hs-identifier hs-type">II32</span></a></span><span>
</span><span id="line-1299"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682871396"><span class="annot"><a href="#local-6989586621682871396"><span class="hs-identifier hs-var hs-var">extend</span></a></span></span><span> </span><span id="local-6989586621682871397"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871397"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span id="local-6989586621682871398"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871398"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1300"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871385"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1301"></span><span>                </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W16"><span class="hs-identifier hs-var">W16</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SXTH"><span class="hs-identifier hs-var">SXTH</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871397"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871398"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1302"></span><span>                </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W8"><span class="hs-identifier hs-var">W8</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SXTB"><span class="hs-identifier hs-var">SXTB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871397"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871398"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1303"></span><span>                </span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Instr
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unreachable&quot;</span></span><span>
</span><span id="line-1304"></span><span>            </span><span id="local-6989586621682871399"><span class="annot"><a href="#local-6989586621682871399"><span class="hs-identifier hs-var hs-var">cmp_ext_mode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1305"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871385"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1306"></span><span>                </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W16"><span class="hs-identifier hs-var">W16</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExtMode
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#EUXTH"><span class="hs-identifier hs-var">EUXTH</span></a></span><span>
</span><span id="line-1307"></span><span>                </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W8"><span class="hs-identifier hs-var">W8</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExtMode
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#EUXTB"><span class="hs-identifier hs-var">EUXTB</span></a></span><span>
</span><span id="line-1308"></span><span>                </span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ExtMode
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unreachable&quot;</span></span><span>
</span><span id="line-1309"></span><span>            </span><span id="local-6989586621682871402"><span class="annot"><a href="#local-6989586621682871402"><span class="hs-identifier hs-var hs-var">width</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Int
</span><a href="GHC.Cmm.Type.html#widthInBits"><span class="hs-identifier hs-var">widthInBits</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871385"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-1310"></span><span>            </span><span id="local-6989586621682871403"><span class="annot"><a href="#local-6989586621682871403"><span class="hs-identifier hs-var hs-var">opInt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="annot"><span class="annottext">(Imm -&gt; Operand) -&gt; (Int -&gt; Imm) -&gt; Int -&gt; Operand
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span>
</span><span id="line-1311"></span><span>
</span><span id="line-1312"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-type">intFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871385"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871404"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871404"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1313"></span><span>            </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871390"><span class="hs-identifier hs-var">code_x</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span>
</span><span id="line-1314"></span><span>            </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871393"><span class="hs-identifier hs-var">code_y</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span>
</span><span id="line-1315"></span><span>            </span><span class="annot"><span class="annottext">Reg -&gt; Reg -&gt; Instr
</span><a href="#local-6989586621682871396"><span class="hs-identifier hs-var">extend</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871394"><span class="hs-identifier hs-var">tmp1</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871388"><span class="hs-identifier hs-var">reg_x</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span>
</span><span id="line-1316"></span><span>            </span><span class="annot"><span class="annottext">Reg -&gt; Reg -&gt; Instr
</span><a href="#local-6989586621682871396"><span class="hs-identifier hs-var">extend</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871395"><span class="hs-identifier hs-var">tmp2</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871391"><span class="hs-identifier hs-var">reg_y</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span>
</span><span id="line-1317"></span><span>            </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#MUL"><span class="hs-identifier hs-var">MUL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871394"><span class="hs-identifier hs-var">tmp1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871394"><span class="hs-identifier hs-var">tmp1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871395"><span class="hs-identifier hs-var">tmp2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span>
</span><span id="line-1318"></span><span>            </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SBFX"><span class="hs-identifier hs-var">SBFX</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871395"><span class="hs-identifier hs-var">tmp2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871394"><span class="hs-identifier hs-var">tmp1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Operand
</span><a href="#local-6989586621682871403"><span class="hs-identifier hs-var">opInt</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Operand) -&gt; Int -&gt; Operand
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871402"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Operand
</span><a href="#local-6989586621682871403"><span class="hs-identifier hs-var">opInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span>
</span><span id="line-1319"></span><span>            </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#UBFX"><span class="hs-identifier hs-var">UBFX</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871394"><span class="hs-identifier hs-var">tmp1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871394"><span class="hs-identifier hs-var">tmp1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Operand
</span><a href="#local-6989586621682871403"><span class="hs-identifier hs-var">opInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871402"><span class="hs-identifier hs-var">width</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Operand
</span><a href="#local-6989586621682871403"><span class="hs-identifier hs-var">opInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871402"><span class="hs-identifier hs-var">width</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span>
</span><span id="line-1320"></span><span>            </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CMP"><span class="hs-identifier hs-var">CMP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871394"><span class="hs-identifier hs-var">tmp1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; ExtMode -&gt; Int -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpRegExt"><span class="hs-identifier hs-var">OpRegExt</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871395"><span class="hs-identifier hs-var">tmp2</span></a></span><span> </span><span class="annot"><span class="annottext">ExtMode
</span><a href="#local-6989586621682871399"><span class="hs-identifier hs-var">cmp_ext_mode</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span>
</span><span id="line-1321"></span><span>            </span><span class="annot"><span class="annottext">Operand -&gt; Cond -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CSET"><span class="hs-identifier hs-var">CSET</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871385"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871404"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="GHC.CmmToAsm.AArch64.Cond.html#NE"><span class="hs-identifier hs-var">NE</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1322"></span><span>
</span><span id="line-1323"></span><span class="hs-comment">-- | Is a given number encodable as a bitmask immediate?</span><span>
</span><span id="line-1324"></span><span class="hs-comment">--</span><span>
</span><span id="line-1325"></span><span class="hs-comment">-- https://stackoverflow.com/questions/30904718/range-of-immediate-values-in-armv8-a64-assembly</span><span>
</span><span id="line-1326"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#isAArch64Bitmask"><span class="hs-identifier hs-type">isAArch64Bitmask</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#Width"><span class="hs-identifier hs-type">Width</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1327"></span><span class="hs-comment">-- N.B. zero and ~0 are not encodable as bitmask immediates</span><span>
</span><span id="line-1328"></span><span id="isAArch64Bitmask"><span class="annot"><span class="annottext">isAArch64Bitmask :: Width -&gt; Integer -&gt; Bool
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#isAArch64Bitmask"><span class="hs-identifier hs-var hs-var">isAArch64Bitmask</span></a></span></span><span> </span><span id="local-6989586621682871406"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871406"><span class="hs-identifier hs-var">width</span></a></span></span><span> </span><span id="local-6989586621682871407"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682871407"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1329"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871406"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; [Width] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1330"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682871407"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1331"></span><span>    </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1332"></span><span>    </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682871407"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Integer
forall a. (Num a, Bits a) =&gt; Int -&gt; a
</span><a href="GHC.Prelude.Basic.html#bit"><span class="hs-identifier hs-var">bit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Int
</span><a href="GHC.Cmm.Type.html#widthInBits"><span class="hs-identifier hs-var">widthInBits</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871406"><span class="hs-identifier hs-var">width</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1333"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- 1111...1111</span><span>
</span><span id="line-1334"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1335"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871406"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621682871411"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">64</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621682871411"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">32</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621682871411"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621682871411"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span>
</span><span id="line-1336"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1337"></span><span>    </span><span class="hs-comment">-- Check whether @n@ can be represented as a subpattern of the given</span><span>
</span><span id="line-1338"></span><span>    </span><span class="hs-comment">-- width.</span><span>
</span><span id="line-1339"></span><span>    </span><span id="local-6989586621682871411"><span class="annot"><span class="annottext">check :: Int -&gt; Bool
</span><a href="#local-6989586621682871411"><span class="hs-identifier hs-var hs-var">check</span></a></span></span><span> </span><span id="local-6989586621682871412"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871412"><span class="hs-identifier hs-var">width</span></a></span></span><span>
</span><span id="line-1340"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Bool
</span><a href="#local-6989586621682871413"><span class="hs-identifier hs-var">hasOneRun</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682871414"><span class="hs-identifier hs-var">subpat</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1341"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682871415"><span class="annot"><span class="annottext">n' :: Integer
</span><a href="#local-6989586621682871415"><span class="hs-identifier hs-var hs-var">n'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Word64 -&gt; Word64
</span><a href="#local-6989586621682871416"><span class="hs-identifier hs-var">mkPat</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871412"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682871414"><span class="hs-identifier hs-var">subpat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1342"></span><span>          </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682871407"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682871415"><span class="hs-identifier hs-var">n'</span></a></span><span>
</span><span id="line-1343"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1344"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1345"></span><span>        </span><span class="annot"><a href="#local-6989586621682871414"><span class="hs-identifier hs-type">subpat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-1346"></span><span>        </span><span id="local-6989586621682871414"><span class="annot"><span class="annottext">subpat :: Word64
</span><a href="#local-6989586621682871414"><span class="hs-identifier hs-var hs-var">subpat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Word64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682871407"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Integer
forall a. (Num a, Bits a) =&gt; Int -&gt; a
</span><a href="GHC.Prelude.Basic.html#bit"><span class="hs-identifier hs-var">bit</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871412"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1347"></span><span>
</span><span id="line-1348"></span><span>    </span><span class="hs-comment">-- Construct a bit-pattern from a repeated subpatterns the given width.</span><span>
</span><span id="line-1349"></span><span>    </span><span class="annot"><a href="#local-6989586621682871416"><span class="hs-identifier hs-type">mkPat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-1350"></span><span>    </span><span id="local-6989586621682871416"><span class="annot"><span class="annottext">mkPat :: Int -&gt; Word64 -&gt; Word64
</span><a href="#local-6989586621682871416"><span class="hs-identifier hs-var hs-var">mkPat</span></a></span></span><span> </span><span id="local-6989586621682871418"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871418"><span class="hs-identifier hs-var">width</span></a></span></span><span> </span><span id="local-6989586621682871419"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682871419"><span class="hs-identifier hs-var">subpat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1351"></span><span>        </span><span class="annot"><span class="annottext">(Word64 -&gt; Word64 -&gt; Word64) -&gt; Word64 -&gt; [Word64] -&gt; Word64
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(.|.)</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682871419"><span class="hs-identifier hs-var">subpat</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Int -&gt; Word64
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="GHC.Prelude.Basic.html#shiftL"><span class="hs-operator hs-var">`shiftL`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871422"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682871422"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871422"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871418"><span class="hs-identifier hs-var">width</span></a></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">63</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1352"></span><span>
</span><span id="line-1353"></span><span>    </span><span class="hs-comment">-- Does the given number's bit representation match the regular expression</span><span>
</span><span id="line-1354"></span><span>    </span><span class="hs-comment">-- @0*1*0*@?</span><span>
</span><span id="line-1355"></span><span>    </span><span class="annot"><a href="#local-6989586621682871413"><span class="hs-identifier hs-type">hasOneRun</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1356"></span><span>    </span><span id="local-6989586621682871413"><span class="annot"><span class="annottext">hasOneRun :: Word64 -&gt; Bool
</span><a href="#local-6989586621682871413"><span class="hs-identifier hs-var hs-var">hasOneRun</span></a></span></span><span> </span><span id="local-6989586621682871423"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682871423"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1357"></span><span>        </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">64</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Int
forall a. Bits a =&gt; a -&gt; Int
</span><span class="hs-identifier hs-var">popCount</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682871423"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Int
forall b. FiniteBits b =&gt; b -&gt; Int
</span><span class="hs-identifier hs-var">countLeadingZeros</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682871423"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Int
forall b. FiniteBits b =&gt; b -&gt; Int
</span><span class="hs-identifier hs-var">countTrailingZeros</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682871423"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1358"></span><span>
</span><span id="line-1359"></span><span class="hs-comment">-- | Instructions to sign-extend the value in the given register from width @w@</span><span>
</span><span id="line-1360"></span><span class="hs-comment">-- up to width @w'@.</span><span>
</span><span id="line-1361"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#signExtendReg"><span class="hs-identifier hs-type">signExtendReg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#Width"><span class="hs-identifier hs-type">Width</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#Width"><span class="hs-identifier hs-type">Width</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Platform.Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Platform.Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#OrdList"><span class="hs-identifier hs-type">OrdList</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1362"></span><span id="signExtendReg"><span class="annot"><span class="annottext">signExtendReg :: Width -&gt; Width -&gt; Reg -&gt; NatM (Reg, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#signExtendReg"><span class="hs-identifier hs-var hs-var">signExtendReg</span></a></span></span><span> </span><span id="local-6989586621682871427"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871427"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682871428"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871428"><span class="hs-identifier hs-var">w'</span></a></span></span><span> </span><span id="local-6989586621682871429"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871429"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1363"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871427"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1364"></span><span>      </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM (Reg, OrdList Instr)
</span><a href="#local-6989586621682871430"><span class="hs-identifier hs-var">noop</span></a></span><span>
</span><span id="line-1365"></span><span>      </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span>
</span><span id="line-1366"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871428"><span class="hs-identifier hs-var">w'</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NatM (Reg, OrdList Instr)
</span><a href="#local-6989586621682871430"><span class="hs-identifier hs-var">noop</span></a></span><span>
</span><span id="line-1367"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Operand -&gt; Operand -&gt; Instr) -&gt; NatM (Reg, OrdList Instr)
</span><a href="#local-6989586621682871431"><span class="hs-identifier hs-var">extend</span></a></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SXTH"><span class="hs-identifier hs-var">SXTH</span></a></span><span>
</span><span id="line-1368"></span><span>      </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W16"><span class="hs-identifier hs-var">W16</span></a></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Operand -&gt; Operand -&gt; Instr) -&gt; NatM (Reg, OrdList Instr)
</span><a href="#local-6989586621682871431"><span class="hs-identifier hs-var">extend</span></a></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SXTH"><span class="hs-identifier hs-var">SXTH</span></a></span><span>
</span><span id="line-1369"></span><span>      </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W8"><span class="hs-identifier hs-var">W8</span></a></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Operand -&gt; Operand -&gt; Instr) -&gt; NatM (Reg, OrdList Instr)
</span><a href="#local-6989586621682871431"><span class="hs-identifier hs-var">extend</span></a></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SXTB"><span class="hs-identifier hs-var">SXTB</span></a></span><span>
</span><span id="line-1370"></span><span>      </span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; NatM (Reg, OrdList Instr)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;intOp&quot;</span></span><span>
</span><span id="line-1371"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1372"></span><span>    </span><span id="local-6989586621682871430"><span class="annot"><span class="annottext">noop :: NatM (Reg, OrdList Instr)
</span><a href="#local-6989586621682871430"><span class="hs-identifier hs-var hs-var">noop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Reg, OrdList Instr) -&gt; NatM (Reg, OrdList Instr)
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871429"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
forall a. OrdList a
</span><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-var">nilOL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1373"></span><span>    </span><span id="local-6989586621682871431"><span class="annot"><span class="annottext">extend :: (Operand -&gt; Operand -&gt; Instr) -&gt; NatM (Reg, OrdList Instr)
</span><a href="#local-6989586621682871431"><span class="hs-identifier hs-var hs-var">extend</span></a></span></span><span> </span><span id="local-6989586621682871432"><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="#local-6989586621682871432"><span class="hs-identifier hs-var">instr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1374"></span><span>        </span><span id="local-6989586621682871433"><span class="annot"><a href="#local-6989586621682871433"><span class="hs-identifier hs-var">r'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Format -&gt; NatM Reg
</span><a href="GHC.CmmToAsm.Monad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="GHC.CmmToAsm.Format.html#II64"><span class="hs-identifier hs-var">II64</span></a></span><span>
</span><span id="line-1375"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871433"><span class="hs-identifier hs-type">r'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-type">unitOL</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682871432"><span class="hs-identifier hs-type">instr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871428"><span class="hs-identifier hs-type">w'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871433"><span class="hs-identifier hs-type">r'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871428"><span class="hs-identifier hs-type">w'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871429"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1376"></span><span>
</span><span id="line-1377"></span><span class="hs-comment">-- | Instructions to truncate the value in the given register from width @w@</span><span>
</span><span id="line-1378"></span><span class="hs-comment">-- down to width @w'@.</span><span>
</span><span id="line-1379"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#truncateReg"><span class="hs-identifier hs-type">truncateReg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#Width"><span class="hs-identifier hs-type">Width</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#Width"><span class="hs-identifier hs-type">Width</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Platform.Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#OrdList"><span class="hs-identifier hs-type">OrdList</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a></span><span>
</span><span id="line-1380"></span><span id="truncateReg"><span class="annot"><span class="annottext">truncateReg :: Width -&gt; Width -&gt; Reg -&gt; OrdList Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#truncateReg"><span class="hs-identifier hs-var hs-var">truncateReg</span></a></span></span><span> </span><span id="local-6989586621682871434"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871434"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682871435"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871435"><span class="hs-identifier hs-var">w'</span></a></span></span><span> </span><span id="local-6989586621682871436"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871436"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1381"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871434"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1382"></span><span>      </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
forall a. OrdList a
</span><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-var">nilOL</span></a></span><span>
</span><span id="line-1383"></span><span>      </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span>
</span><span id="line-1384"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871435"><span class="hs-identifier hs-var">w'</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
forall a. OrdList a
</span><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-var">nilOL</span></a></span><span>
</span><span id="line-1385"></span><span>      </span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; OrdList Instr) -&gt; Instr -&gt; OrdList Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#UBFM"><span class="hs-identifier hs-var">UBFM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871434"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871436"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1386"></span><span>                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871434"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871436"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1387"></span><span>                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1388"></span><span>                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="annot"><span class="annottext">(Imm -&gt; Operand) -&gt; Imm -&gt; Operand
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Imm) -&gt; Int -&gt; Imm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Int
</span><a href="GHC.Cmm.Type.html#widthInBits"><span class="hs-identifier hs-var">widthInBits</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871435"><span class="hs-identifier hs-var">w'</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-1389"></span><span>
</span><span id="line-1390"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-1391"></span><span class="hs-comment">--  The 'Amode' type: Memory addressing modes passed up the tree.</span><span>
</span><span id="line-1392"></span><span class="hs-keyword">data</span><span> </span><span id="Amode"><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Amode"><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a></span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Regs.html#AddrMode"><span class="hs-identifier hs-type">AddrMode</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a></span><span>
</span><span id="line-1393"></span><span>
</span><span id="line-1394"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getAmode"><span class="hs-identifier hs-type">getAmode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span>
</span><span id="line-1395"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#Width"><span class="hs-identifier hs-type">Width</span></a></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ width of loaded value</span></span><span>
</span><span id="line-1396"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span>
</span><span id="line-1397"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Amode"><span class="hs-identifier hs-type">Amode</span></a></span><span>
</span><span id="line-1398"></span><span class="hs-comment">-- TODO: Specialize stuff we can destructure here.</span><span>
</span><span id="line-1399"></span><span>
</span><span id="line-1400"></span><span class="hs-comment">-- OPTIMIZATION WARNING: Addressing modes.</span><span>
</span><span id="line-1401"></span><span class="hs-comment">-- Addressing options:</span><span>
</span><span id="line-1402"></span><span id="getAmode"><span class="annot"><span class="annottext">getAmode :: Platform -&gt; Width -&gt; CmmExpr -&gt; NatM Amode
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getAmode"><span class="hs-identifier hs-var hs-var">getAmode</span></a></span></span><span> </span><span id="local-6989586621682871437"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682871437"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621682871438"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871438"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmRegOff"><span class="hs-identifier hs-type">CmmRegOff</span></a></span><span> </span><span id="local-6989586621682871439"><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682871439"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span id="local-6989586621682871440"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871440"><span class="hs-identifier hs-var">off</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1403"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Width -&gt; Bool
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#isOffsetImm"><span class="hs-identifier hs-var">isOffsetImm</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871440"><span class="hs-identifier hs-var">off</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871438"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-1404"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Amode -&gt; NatM Amode
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Amode -&gt; NatM Amode) -&gt; Amode -&gt; NatM Amode
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AddrMode -&gt; OrdList Instr -&gt; Amode
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reg -&gt; Imm -&gt; AddrMode
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871442"><span class="hs-identifier hs-var">reg'</span></a></span><span> </span><span class="annot"><span class="annottext">Imm
</span><a href="#local-6989586621682871443"><span class="hs-identifier hs-var">off'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
forall a. OrdList a
</span><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-var">nilOL</span></a></span><span>
</span><span id="line-1405"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682871442"><span class="annot"><span class="annottext">reg' :: Reg
</span><a href="#local-6989586621682871442"><span class="hs-identifier hs-var hs-var">reg'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmReg -&gt; Reg
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682871437"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682871439"><span class="hs-identifier hs-var">reg</span></a></span><span>
</span><span id="line-1406"></span><span>          </span><span id="local-6989586621682871443"><span class="annot"><span class="annottext">off' :: Imm
</span><a href="#local-6989586621682871443"><span class="hs-identifier hs-var hs-var">off'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871440"><span class="hs-identifier hs-var">off</span></a></span><span>
</span><span id="line-1407"></span><span>
</span><span id="line-1408"></span><span class="hs-comment">-- For Stores we often see something like this:</span><span>
</span><span id="line-1409"></span><span class="hs-comment">-- CmmStore (CmmMachOp (MO_Add w) [CmmLoad expr, CmmLit (CmmInt n w')]) (expr2)</span><span>
</span><span id="line-1410"></span><span class="hs-comment">-- E.g. a CmmStoreOff really. This can be translated to `str $expr2, [$expr, #n ]</span><span>
</span><span id="line-1411"></span><span class="hs-comment">-- for `n` in range.</span><span>
</span><span id="line-1412"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a></span><span> </span><span id="local-6989586621682871444"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682871444"><span class="hs-identifier hs-var">_platform</span></a></span></span><span> </span><span id="local-6989586621682871445"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871445"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-type">CmmMachOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Add"><span class="hs-identifier hs-type">MO_Add</span></a></span><span> </span><span id="local-6989586621682871446"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871446"><span class="hs-identifier hs-var">_w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871447"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871447"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-type">CmmInt</span></a></span><span> </span><span id="local-6989586621682871448"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682871448"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span id="local-6989586621682871449"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871449"><span class="hs-identifier hs-var">_w'</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1413"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Width -&gt; Bool
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#isOffsetImm"><span class="hs-identifier hs-var">isOffsetImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682871448"><span class="hs-identifier hs-var">off</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871445"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-1414"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682871450"><span class="annot"><a href="#local-6989586621682871450"><span class="hs-identifier hs-var">reg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871451"><span class="annot"><a href="#local-6989586621682871451"><span class="hs-identifier hs-var">_format</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871452"><span class="annot"><a href="#local-6989586621682871452"><span class="hs-identifier hs-var">code</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871447"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-1415"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Amode"><span class="hs-identifier hs-type">Amode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Regs.html#AddrRegImm"><span class="hs-identifier hs-type">AddrRegImm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871450"><span class="hs-identifier hs-type">reg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInteger"><span class="hs-identifier hs-type">ImmInteger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871448"><span class="hs-identifier hs-type">off</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682871452"><span class="hs-identifier hs-type">code</span></a></span><span>
</span><span id="line-1416"></span><span>
</span><span id="line-1417"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a></span><span> </span><span id="local-6989586621682871453"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682871453"><span class="hs-identifier hs-var">_platform</span></a></span></span><span> </span><span id="local-6989586621682871454"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871454"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-type">CmmMachOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Sub"><span class="hs-identifier hs-type">MO_Sub</span></a></span><span> </span><span id="local-6989586621682871455"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871455"><span class="hs-identifier hs-var">_w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871456"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871456"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-type">CmmInt</span></a></span><span> </span><span id="local-6989586621682871457"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682871457"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span id="local-6989586621682871458"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871458"><span class="hs-identifier hs-var">_w'</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1418"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Width -&gt; Bool
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#isOffsetImm"><span class="hs-identifier hs-var">isOffsetImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Int) -&gt; Integer -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682871457"><span class="hs-identifier hs-var">off</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871454"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-1419"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682871459"><span class="annot"><a href="#local-6989586621682871459"><span class="hs-identifier hs-var">reg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871460"><span class="annot"><a href="#local-6989586621682871460"><span class="hs-identifier hs-var">_format</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871461"><span class="annot"><a href="#local-6989586621682871461"><span class="hs-identifier hs-var">code</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871456"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-1420"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Amode"><span class="hs-identifier hs-type">Amode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Regs.html#AddrRegImm"><span class="hs-identifier hs-type">AddrRegImm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871459"><span class="hs-identifier hs-type">reg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInteger"><span class="hs-identifier hs-type">ImmInteger</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">-</span><span class="annot"><a href="#local-6989586621682871457"><span class="hs-identifier hs-type">off</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682871461"><span class="hs-identifier hs-type">code</span></a></span><span>
</span><span id="line-1421"></span><span>
</span><span id="line-1422"></span><span class="hs-comment">-- Generic case</span><span>
</span><span id="line-1423"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a></span><span> </span><span id="local-6989586621682871462"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682871462"><span class="hs-identifier hs-var">_platform</span></a></span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682871463"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871463"><span class="hs-identifier hs-var">expr</span></a></span></span><span>
</span><span id="line-1424"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682871464"><span class="annot"><a href="#local-6989586621682871464"><span class="hs-identifier hs-var">reg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871465"><span class="annot"><a href="#local-6989586621682871465"><span class="hs-identifier hs-var">_format</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871466"><span class="annot"><a href="#local-6989586621682871466"><span class="hs-identifier hs-var">code</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871463"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-1425"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Amode"><span class="hs-identifier hs-type">Amode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Regs.html#AddrReg"><span class="hs-identifier hs-type">AddrReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871464"><span class="hs-identifier hs-type">reg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682871466"><span class="hs-identifier hs-type">code</span></a></span><span>
</span><span id="line-1426"></span><span>
</span><span id="line-1427"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-1428"></span><span class="hs-comment">-- Generating assignments</span><span>
</span><span id="line-1429"></span><span>
</span><span id="line-1430"></span><span class="hs-comment">-- Assignments are really at the heart of the whole code generation</span><span>
</span><span id="line-1431"></span><span class="hs-comment">-- business.  Almost all top-level nodes of any real importance are</span><span>
</span><span id="line-1432"></span><span class="hs-comment">-- assignments, which correspond to loads, stores, or register</span><span>
</span><span id="line-1433"></span><span class="hs-comment">-- transfers.  If we're really lucky, some of the register transfers</span><span>
</span><span id="line-1434"></span><span class="hs-comment">-- will go away, because we can use the destination register to</span><span>
</span><span id="line-1435"></span><span class="hs-comment">-- complete the code generation for the right hand side.  This only</span><span>
</span><span id="line-1436"></span><span class="hs-comment">-- fails when the right hand side is forced into a fixed register</span><span>
</span><span id="line-1437"></span><span class="hs-comment">-- (e.g. the result of a call).</span><span>
</span><span id="line-1438"></span><span>
</span><span id="line-1439"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#assignMem_IntCode"><span class="hs-identifier hs-type">assignMem_IntCode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Format.html#Format"><span class="hs-identifier hs-type">Format</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a></span><span>
</span><span id="line-1440"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#assignReg_IntCode"><span class="hs-identifier hs-type">assignReg_IntCode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Format.html#Format"><span class="hs-identifier hs-type">Format</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Reg.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a></span><span>
</span><span id="line-1441"></span><span>
</span><span id="line-1442"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#assignMem_FltCode"><span class="hs-identifier hs-type">assignMem_FltCode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Format.html#Format"><span class="hs-identifier hs-type">Format</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a></span><span>
</span><span id="line-1443"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#assignReg_FltCode"><span class="hs-identifier hs-type">assignReg_FltCode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Format.html#Format"><span class="hs-identifier hs-type">Format</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Reg.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a></span><span>
</span><span id="line-1444"></span><span>
</span><span id="line-1445"></span><span id="assignMem_IntCode"><span class="annot"><span class="annottext">assignMem_IntCode :: Format -&gt; CmmExpr -&gt; CmmExpr -&gt; NatM (OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#assignMem_IntCode"><span class="hs-identifier hs-var hs-var">assignMem_IntCode</span></a></span></span><span> </span><span id="local-6989586621682871468"><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682871468"><span class="hs-identifier hs-var">rep</span></a></span></span><span> </span><span id="local-6989586621682871469"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871469"><span class="hs-identifier hs-var">addrE</span></a></span></span><span> </span><span id="local-6989586621682871470"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871470"><span class="hs-identifier hs-var">srcE</span></a></span></span><span>
</span><span id="line-1446"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1447"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682871471"><span class="annot"><a href="#local-6989586621682871471"><span class="hs-identifier hs-var">src_reg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871472"><span class="annot"><a href="#local-6989586621682871472"><span class="hs-identifier hs-var">_format</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871473"><span class="annot"><a href="#local-6989586621682871473"><span class="hs-identifier hs-var">code</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871470"><span class="hs-identifier hs-var">srcE</span></a></span><span>
</span><span id="line-1448"></span><span>    </span><span id="local-6989586621682871474"><span class="annot"><a href="#local-6989586621682871474"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#getPlatform"><span class="hs-identifier hs-type">getPlatform</span></a></span><span>
</span><span id="line-1449"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682871475"><span class="annot"><a href="#local-6989586621682871475"><span class="hs-identifier hs-var hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Format -&gt; Width
</span><a href="GHC.CmmToAsm.Format.html#formatToWidth"><span class="hs-identifier hs-var">formatToWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682871468"><span class="hs-identifier hs-var">rep</span></a></span><span>
</span><span id="line-1450"></span><span>    </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Amode"><span class="hs-identifier hs-type">Amode</span></a></span><span> </span><span id="local-6989586621682871476"><span class="annot"><a href="#local-6989586621682871476"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span id="local-6989586621682871477"><span class="annot"><a href="#local-6989586621682871477"><span class="hs-identifier hs-var">addr_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getAmode"><span class="hs-identifier hs-type">getAmode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871474"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871475"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871469"><span class="hs-identifier hs-type">addrE</span></a></span><span>
</span><span id="line-1451"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#COMMENT"><span class="hs-identifier hs-type">COMMENT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;CmmStore&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-type">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682871469"><span class="hs-identifier hs-type">addrE</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-type">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682871470"><span class="hs-identifier hs-type">srcE</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1452"></span><span>            </span><span class="annot"><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-type">`consOL`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871473"><span class="hs-identifier hs-type">code</span></a></span><span>
</span><span id="line-1453"></span><span>            </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871477"><span class="hs-identifier hs-type">addr_code</span></a></span><span>
</span><span id="line-1454"></span><span>            </span><span class="annot"><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-type">`snocOL`</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#STR"><span class="hs-identifier hs-type">STR</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871468"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871475"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871471"><span class="hs-identifier hs-type">src_reg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpAddr"><span class="hs-identifier hs-type">OpAddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871476"><span class="hs-identifier hs-type">addr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1455"></span><span>
</span><span id="line-1456"></span><span id="assignReg_IntCode"><span class="annot"><span class="annottext">assignReg_IntCode :: Format -&gt; CmmReg -&gt; CmmExpr -&gt; NatM (OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#assignReg_IntCode"><span class="hs-identifier hs-var hs-var">assignReg_IntCode</span></a></span></span><span> </span><span class="annot"><span class="annottext">Format
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682871481"><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682871481"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span id="local-6989586621682871482"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871482"><span class="hs-identifier hs-var">src</span></a></span></span><span>
</span><span id="line-1457"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1458"></span><span>    </span><span id="local-6989586621682871483"><span class="annot"><a href="#local-6989586621682871483"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NatM Platform
</span><a href="GHC.CmmToAsm.Monad.html#getPlatform"><span class="hs-identifier hs-var">getPlatform</span></a></span><span>
</span><span id="line-1459"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682871484"><span class="annot"><a href="#local-6989586621682871484"><span class="hs-identifier hs-var hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmReg -&gt; Reg
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682871483"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682871481"><span class="hs-identifier hs-var">reg</span></a></span><span>
</span><span id="line-1460"></span><span>    </span><span id="local-6989586621682871485"><span class="annot"><a href="#local-6989586621682871485"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegister"><span class="hs-identifier hs-type">getRegister</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871482"><span class="hs-identifier hs-type">src</span></a></span><span>
</span><span id="line-1461"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682871485"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1462"></span><span>      </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682871486"><span class="annot"><span class="annottext">Reg -&gt; OrdList Instr
</span><a href="#local-6989586621682871486"><span class="hs-identifier hs-var">code</span></a></span></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#COMMENT"><span class="hs-identifier hs-var">COMMENT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;CmmAssign&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmReg -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682871481"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmExpr -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871482"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-var">`consOL`</span></a></span><span> </span><span class="annot"><span class="annottext">Reg -&gt; OrdList Instr
</span><a href="#local-6989586621682871486"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871484"><span class="hs-identifier hs-var">dst</span></a></span><span>
</span><span id="line-1463"></span><span>      </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#Fixed"><span class="hs-identifier hs-type">Fixed</span></a></span><span> </span><span id="local-6989586621682871487"><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682871487"><span class="hs-identifier hs-var">format</span></a></span></span><span> </span><span id="local-6989586621682871488"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871488"><span class="hs-identifier hs-var">freg</span></a></span></span><span> </span><span id="local-6989586621682871489"><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871489"><span class="hs-identifier hs-var">fcode</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#COMMENT"><span class="hs-identifier hs-var">COMMENT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;CmmAssign&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmReg -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682871481"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmExpr -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871482"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-var">`consOL`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871489"><span class="hs-identifier hs-var">fcode</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Format -&gt; Width
</span><a href="GHC.CmmToAsm.Format.html#formatToWidth"><span class="hs-identifier hs-var">formatToWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682871487"><span class="hs-identifier hs-var">format</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871484"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Format -&gt; Width
</span><a href="GHC.CmmToAsm.Format.html#formatToWidth"><span class="hs-identifier hs-var">formatToWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682871487"><span class="hs-identifier hs-var">format</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871488"><span class="hs-identifier hs-var">freg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1464"></span><span>
</span><span id="line-1465"></span><span class="hs-comment">-- Let's treat Floating point stuff</span><span>
</span><span id="line-1466"></span><span class="hs-comment">-- as integer code for now. Opaque.</span><span>
</span><span id="line-1467"></span><span id="assignMem_FltCode"><span class="annot"><span class="annottext">assignMem_FltCode :: Format -&gt; CmmExpr -&gt; CmmExpr -&gt; NatM (OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#assignMem_FltCode"><span class="hs-identifier hs-var hs-var">assignMem_FltCode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Format -&gt; CmmExpr -&gt; CmmExpr -&gt; NatM (OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#assignMem_IntCode"><span class="hs-identifier hs-var">assignMem_IntCode</span></a></span><span>
</span><span id="line-1468"></span><span id="assignReg_FltCode"><span class="annot"><span class="annottext">assignReg_FltCode :: Format -&gt; CmmReg -&gt; CmmExpr -&gt; NatM (OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#assignReg_FltCode"><span class="hs-identifier hs-var hs-var">assignReg_FltCode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Format -&gt; CmmReg -&gt; CmmExpr -&gt; NatM (OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#assignReg_IntCode"><span class="hs-identifier hs-var">assignReg_IntCode</span></a></span><span>
</span><span id="line-1469"></span><span>
</span><span id="line-1470"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-1471"></span><span class="hs-comment">-- Jumps</span><span>
</span><span id="line-1472"></span><span>
</span><span id="line-1473"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#genJump"><span class="hs-identifier hs-type">genJump</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span class="hs-comment">{-the branch target-}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a></span><span>
</span><span id="line-1474"></span><span id="genJump"><span class="annot"><span class="annottext">genJump :: CmmExpr -&gt; NatM (OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#genJump"><span class="hs-identifier hs-var hs-var">genJump</span></a></span></span><span> </span><span id="local-6989586621682871490"><span class="annot"><span class="annottext">expr :: CmmExpr
</span><a href="#local-6989586621682871490"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLabel"><span class="hs-identifier hs-type">CmmLabel</span></a></span><span> </span><span id="local-6989586621682871491"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682871491"><span class="hs-identifier hs-var">lbl</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1475"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; NatM (OrdList Instr)
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(OrdList Instr -&gt; NatM (OrdList Instr))
-&gt; OrdList Instr -&gt; NatM (OrdList Instr)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871490"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Target -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#J"><span class="hs-identifier hs-var">J</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLabel -&gt; Target
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#TLabel"><span class="hs-identifier hs-var">TLabel</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682871491"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1476"></span><span>
</span><span id="line-1477"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#genJump"><span class="hs-identifier hs-var">genJump</span></a></span><span> </span><span id="local-6989586621682871494"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871494"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1478"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682871495"><span class="annot"><a href="#local-6989586621682871495"><span class="hs-identifier hs-var">target</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871496"><span class="annot"><a href="#local-6989586621682871496"><span class="hs-identifier hs-var">_format</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871497"><span class="annot"><a href="#local-6989586621682871497"><span class="hs-identifier hs-var">code</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871494"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-1479"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871497"><span class="hs-identifier hs-type">code</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-type">unitOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-type">annExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871494"><span class="hs-identifier hs-type">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#J"><span class="hs-identifier hs-type">J</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#TReg"><span class="hs-identifier hs-type">TReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871495"><span class="hs-identifier hs-type">target</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1480"></span><span>
</span><span id="line-1481"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-1482"></span><span class="hs-comment">--  Unconditional branches</span><span>
</span><span id="line-1483"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#genBranch"><span class="hs-identifier hs-type">genBranch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a></span><span>
</span><span id="line-1484"></span><span id="genBranch"><span class="annot"><span class="annottext">genBranch :: BlockId -&gt; NatM (OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#genBranch"><span class="hs-identifier hs-var hs-var">genBranch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; NatM (OrdList Instr)
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(OrdList Instr -&gt; NatM (OrdList Instr))
-&gt; (BlockId -&gt; OrdList Instr) -&gt; BlockId -&gt; NatM (OrdList Instr)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Instr] -&gt; OrdList Instr
forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="annot"><span class="annottext">([Instr] -&gt; OrdList Instr)
-&gt; (BlockId -&gt; [Instr]) -&gt; BlockId -&gt; OrdList Instr
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; [Instr]
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#mkJumpInstr"><span class="hs-identifier hs-var">mkJumpInstr</span></a></span><span>
</span><span id="line-1485"></span><span>
</span><span id="line-1486"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-1487"></span><span class="hs-comment">-- Conditional branches</span><span>
</span><span id="line-1488"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#genCondJump"><span class="hs-identifier hs-type">genCondJump</span></a></span><span>
</span><span id="line-1489"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a></span><span>
</span><span id="line-1490"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span>
</span><span id="line-1491"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a></span><span>
</span><span id="line-1492"></span><span id="genCondJump"><span class="annot"><span class="annottext">genCondJump :: BlockId -&gt; CmmExpr -&gt; NatM (OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#genCondJump"><span class="hs-identifier hs-var hs-var">genCondJump</span></a></span></span><span> </span><span id="local-6989586621682871501"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682871501"><span class="hs-identifier hs-var">bid</span></a></span></span><span> </span><span id="local-6989586621682871502"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871502"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1493"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871502"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1494"></span><span>      </span><span class="hs-comment">-- Optimized == 0 case.</span><span>
</span><span id="line-1495"></span><span>      </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-type">CmmMachOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Eq"><span class="hs-identifier hs-type">MO_Eq</span></a></span><span> </span><span id="local-6989586621682871503"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871503"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871504"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871504"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-type">CmmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1496"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682871505"><span class="annot"><a href="#local-6989586621682871505"><span class="hs-identifier hs-var">reg_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871506"><span class="annot"><a href="#local-6989586621682871506"><span class="hs-identifier hs-var">_format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871507"><span class="annot"><a href="#local-6989586621682871507"><span class="hs-identifier hs-var">code_x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871504"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1497"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682871507"><span class="hs-identifier hs-type">code_x</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-type">`snocOL`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-type">annExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871502"><span class="hs-identifier hs-type">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#CBZ"><span class="hs-identifier hs-type">CBZ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871503"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871505"><span class="hs-identifier hs-type">reg_x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#TBlock"><span class="hs-identifier hs-type">TBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871501"><span class="hs-identifier hs-type">bid</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1498"></span><span>
</span><span id="line-1499"></span><span>      </span><span class="hs-comment">-- Optimized /= 0 case.</span><span>
</span><span id="line-1500"></span><span>      </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-type">CmmMachOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Ne"><span class="hs-identifier hs-type">MO_Ne</span></a></span><span> </span><span id="local-6989586621682871509"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871509"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871510"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871510"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-type">CmmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1501"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682871511"><span class="annot"><a href="#local-6989586621682871511"><span class="hs-identifier hs-var">reg_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871512"><span class="annot"><a href="#local-6989586621682871512"><span class="hs-identifier hs-var">_format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871513"><span class="annot"><a href="#local-6989586621682871513"><span class="hs-identifier hs-var">code_x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871510"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1502"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682871513"><span class="hs-identifier hs-type">code_x</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-type">`snocOL`</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-type">annExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871502"><span class="hs-identifier hs-type">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#CBNZ"><span class="hs-identifier hs-type">CBNZ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871509"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871511"><span class="hs-identifier hs-type">reg_x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#TBlock"><span class="hs-identifier hs-type">TBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871501"><span class="hs-identifier hs-type">bid</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1503"></span><span>
</span><span id="line-1504"></span><span>      </span><span class="hs-comment">-- Generic case.</span><span>
</span><span id="line-1505"></span><span>      </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-type">CmmMachOp</span></a></span><span> </span><span id="local-6989586621682871515"><span class="annot"><span class="annottext">MachOp
</span><a href="#local-6989586621682871515"><span class="hs-identifier hs-var">mop</span></a></span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871516"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871516"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871517"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871517"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1506"></span><span>
</span><span id="line-1507"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682871518"><span class="annot"><span class="annottext">ubcond :: Width -&gt; Cond -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871518"><span class="hs-identifier hs-var hs-var">ubcond</span></a></span></span><span> </span><span id="local-6989586621682871519"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871519"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682871520"><span class="annot"><span class="annottext">Cond
</span><a href="#local-6989586621682871520"><span class="hs-identifier hs-var">cmp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1508"></span><span>                </span><span class="hs-comment">-- compute both sides.</span><span>
</span><span id="line-1509"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621682871521"><span class="annot"><a href="#local-6989586621682871521"><span class="hs-identifier hs-var">reg_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871522"><span class="annot"><a href="#local-6989586621682871522"><span class="hs-identifier hs-var">_format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871523"><span class="annot"><a href="#local-6989586621682871523"><span class="hs-identifier hs-var">code_x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871516"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1510"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621682871524"><span class="annot"><a href="#local-6989586621682871524"><span class="hs-identifier hs-var">reg_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871525"><span class="annot"><a href="#local-6989586621682871525"><span class="hs-identifier hs-var">_format_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871526"><span class="annot"><a href="#local-6989586621682871526"><span class="hs-identifier hs-var">code_y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-type">getSomeReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871517"><span class="hs-identifier hs-type">y</span></a></span><span>
</span><span id="line-1511"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682871527"><span class="annot"><a href="#local-6989586621682871527"><span class="hs-identifier hs-var hs-var">x'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871519"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871521"><span class="hs-identifier hs-var">reg_x</span></a></span><span>
</span><span id="line-1512"></span><span>                    </span><span id="local-6989586621682871528"><span class="annot"><a href="#local-6989586621682871528"><span class="hs-identifier hs-var hs-var">y'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871519"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871524"><span class="hs-identifier hs-var">reg_y</span></a></span><span>
</span><span id="line-1513"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682871519"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1514"></span><span>                  </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W8"><span class="hs-identifier hs-var">W8</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871523"><span class="hs-identifier hs-var">code_x</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871526"><span class="hs-identifier hs-var">code_y</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">[Instr] -&gt; OrdList Instr
forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#UXTB"><span class="hs-identifier hs-var">UXTB</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871527"><span class="hs-identifier hs-var">x'</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871527"><span class="hs-identifier hs-var">x'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#UXTB"><span class="hs-identifier hs-var">UXTB</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871528"><span class="hs-identifier hs-var">y'</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871528"><span class="hs-identifier hs-var">y'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CMP"><span class="hs-identifier hs-var">CMP</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871527"><span class="hs-identifier hs-var">x'</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871528"><span class="hs-identifier hs-var">y'</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871502"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cond -&gt; Target -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#BCOND"><span class="hs-identifier hs-var">BCOND</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="#local-6989586621682871520"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockId -&gt; Target
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#TBlock"><span class="hs-identifier hs-var">TBlock</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682871501"><span class="hs-identifier hs-var">bid</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1515"></span><span>                  </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W16"><span class="hs-identifier hs-var">W16</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871523"><span class="hs-identifier hs-var">code_x</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871526"><span class="hs-identifier hs-var">code_y</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">[Instr] -&gt; OrdList Instr
forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#UXTH"><span class="hs-identifier hs-var">UXTH</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871527"><span class="hs-identifier hs-var">x'</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871527"><span class="hs-identifier hs-var">x'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#UXTH"><span class="hs-identifier hs-var">UXTH</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871528"><span class="hs-identifier hs-var">y'</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871528"><span class="hs-identifier hs-var">y'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CMP"><span class="hs-identifier hs-var">CMP</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871527"><span class="hs-identifier hs-var">x'</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871528"><span class="hs-identifier hs-var">y'</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871502"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cond -&gt; Target -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#BCOND"><span class="hs-identifier hs-var">BCOND</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="#local-6989586621682871520"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockId -&gt; Target
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#TBlock"><span class="hs-identifier hs-var">TBlock</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682871501"><span class="hs-identifier hs-var">bid</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1516"></span><span>                  </span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871523"><span class="hs-identifier hs-var">code_x</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871526"><span class="hs-identifier hs-var">code_y</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">[Instr] -&gt; OrdList Instr
forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span>                         </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CMP"><span class="hs-identifier hs-var">CMP</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871527"><span class="hs-identifier hs-var">x'</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871528"><span class="hs-identifier hs-var">y'</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871502"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cond -&gt; Target -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#BCOND"><span class="hs-identifier hs-var">BCOND</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="#local-6989586621682871520"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockId -&gt; Target
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#TBlock"><span class="hs-identifier hs-var">TBlock</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682871501"><span class="hs-identifier hs-var">bid</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1517"></span><span>
</span><span id="line-1518"></span><span>            </span><span id="local-6989586621682871529"><span class="annot"><span class="annottext">sbcond :: Width -&gt; Cond -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871529"><span class="hs-identifier hs-var hs-var">sbcond</span></a></span></span><span> </span><span id="local-6989586621682871530"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871530"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682871531"><span class="annot"><span class="annottext">Cond
</span><a href="#local-6989586621682871531"><span class="hs-identifier hs-var">cmp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1519"></span><span>                </span><span class="hs-comment">-- compute both sides.</span><span>
</span><span id="line-1520"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621682871532"><span class="annot"><a href="#local-6989586621682871532"><span class="hs-identifier hs-var">reg_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871533"><span class="annot"><a href="#local-6989586621682871533"><span class="hs-identifier hs-var">_format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871534"><span class="annot"><a href="#local-6989586621682871534"><span class="hs-identifier hs-var">code_x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871516"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1521"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621682871535"><span class="annot"><a href="#local-6989586621682871535"><span class="hs-identifier hs-var">reg_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871536"><span class="annot"><a href="#local-6989586621682871536"><span class="hs-identifier hs-var">_format_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871537"><span class="annot"><a href="#local-6989586621682871537"><span class="hs-identifier hs-var">code_y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-type">getSomeReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871517"><span class="hs-identifier hs-type">y</span></a></span><span>
</span><span id="line-1522"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682871538"><span class="annot"><a href="#local-6989586621682871538"><span class="hs-identifier hs-var hs-var">x'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871530"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871532"><span class="hs-identifier hs-var">reg_x</span></a></span><span>
</span><span id="line-1523"></span><span>                    </span><span id="local-6989586621682871539"><span class="annot"><a href="#local-6989586621682871539"><span class="hs-identifier hs-var hs-var">y'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871530"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871535"><span class="hs-identifier hs-var">reg_y</span></a></span><span>
</span><span id="line-1524"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682871530"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1525"></span><span>                  </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W8"><span class="hs-identifier hs-var">W8</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871534"><span class="hs-identifier hs-var">code_x</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871537"><span class="hs-identifier hs-var">code_y</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">[Instr] -&gt; OrdList Instr
forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SXTB"><span class="hs-identifier hs-var">SXTB</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871538"><span class="hs-identifier hs-var">x'</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871538"><span class="hs-identifier hs-var">x'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SXTB"><span class="hs-identifier hs-var">SXTB</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871539"><span class="hs-identifier hs-var">y'</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871539"><span class="hs-identifier hs-var">y'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CMP"><span class="hs-identifier hs-var">CMP</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871538"><span class="hs-identifier hs-var">x'</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871539"><span class="hs-identifier hs-var">y'</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871502"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cond -&gt; Target -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#BCOND"><span class="hs-identifier hs-var">BCOND</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="#local-6989586621682871531"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockId -&gt; Target
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#TBlock"><span class="hs-identifier hs-var">TBlock</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682871501"><span class="hs-identifier hs-var">bid</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1526"></span><span>                  </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W16"><span class="hs-identifier hs-var">W16</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871534"><span class="hs-identifier hs-var">code_x</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871537"><span class="hs-identifier hs-var">code_y</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">[Instr] -&gt; OrdList Instr
forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SXTH"><span class="hs-identifier hs-var">SXTH</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871538"><span class="hs-identifier hs-var">x'</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871538"><span class="hs-identifier hs-var">x'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SXTH"><span class="hs-identifier hs-var">SXTH</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871539"><span class="hs-identifier hs-var">y'</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871539"><span class="hs-identifier hs-var">y'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CMP"><span class="hs-identifier hs-var">CMP</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871538"><span class="hs-identifier hs-var">x'</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871539"><span class="hs-identifier hs-var">y'</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871502"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cond -&gt; Target -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#BCOND"><span class="hs-identifier hs-var">BCOND</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="#local-6989586621682871531"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockId -&gt; Target
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#TBlock"><span class="hs-identifier hs-var">TBlock</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682871501"><span class="hs-identifier hs-var">bid</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1527"></span><span>                  </span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871534"><span class="hs-identifier hs-var">code_x</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871537"><span class="hs-identifier hs-var">code_y</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">[Instr] -&gt; OrdList Instr
forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span>                         </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#CMP"><span class="hs-identifier hs-var">CMP</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871538"><span class="hs-identifier hs-var">x'</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871539"><span class="hs-identifier hs-var">y'</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmExpr -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-var">annExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871502"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cond -&gt; Target -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#BCOND"><span class="hs-identifier hs-var">BCOND</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="#local-6989586621682871531"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockId -&gt; Target
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#TBlock"><span class="hs-identifier hs-var">TBlock</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682871501"><span class="hs-identifier hs-var">bid</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1528"></span><span>
</span><span id="line-1529"></span><span>            </span><span id="local-6989586621682871540"><span class="annot"><span class="annottext">fbcond :: Width -&gt; Cond -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871540"><span class="hs-identifier hs-var hs-var">fbcond</span></a></span></span><span> </span><span id="local-6989586621682871541"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871541"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682871542"><span class="annot"><span class="annottext">Cond
</span><a href="#local-6989586621682871542"><span class="hs-identifier hs-var">cmp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1530"></span><span>              </span><span class="hs-comment">-- ensure we get float regs</span><span>
</span><span id="line-1531"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682871543"><span class="annot"><a href="#local-6989586621682871543"><span class="hs-identifier hs-var">reg_fx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871544"><span class="annot"><a href="#local-6989586621682871544"><span class="hs-identifier hs-var">_format_fx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871545"><span class="annot"><a href="#local-6989586621682871545"><span class="hs-identifier hs-var">code_fx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getFloatReg"><span class="hs-identifier hs-var">getFloatReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871516"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1532"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682871546"><span class="annot"><a href="#local-6989586621682871546"><span class="hs-identifier hs-var">reg_fy</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871547"><span class="annot"><a href="#local-6989586621682871547"><span class="hs-identifier hs-var">_format_fy</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871548"><span class="annot"><a href="#local-6989586621682871548"><span class="hs-identifier hs-var">code_fy</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getFloatReg"><span class="hs-identifier hs-type">getFloatReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871517"><span class="hs-identifier hs-type">y</span></a></span><span>
</span><span id="line-1533"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682871545"><span class="hs-identifier hs-type">code_fx</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871548"><span class="hs-identifier hs-type">code_fy</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-type">`snocOL`</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#CMP"><span class="hs-identifier hs-type">CMP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871541"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871543"><span class="hs-identifier hs-type">reg_fx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871541"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871546"><span class="hs-identifier hs-type">reg_fy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-type">`snocOL`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#annExpr"><span class="hs-identifier hs-type">annExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871502"><span class="hs-identifier hs-type">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#BCOND"><span class="hs-identifier hs-type">BCOND</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871542"><span class="hs-identifier hs-type">cmp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#TBlock"><span class="hs-identifier hs-type">TBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871501"><span class="hs-identifier hs-type">bid</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1534"></span><span>
</span><span id="line-1535"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MachOp
</span><a href="#local-6989586621682871515"><span class="hs-identifier hs-var">mop</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1536"></span><span>          </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_F_Eq"><span class="hs-identifier hs-type">MO_F_Eq</span></a></span><span> </span><span id="local-6989586621682871549"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871549"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Cond -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871540"><span class="hs-identifier hs-var">fbcond</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871549"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="GHC.CmmToAsm.AArch64.Cond.html#EQ"><span class="hs-identifier hs-var">EQ</span></a></span><span>
</span><span id="line-1537"></span><span>          </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_F_Ne"><span class="hs-identifier hs-type">MO_F_Ne</span></a></span><span> </span><span id="local-6989586621682871550"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871550"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Cond -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871540"><span class="hs-identifier hs-var">fbcond</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871550"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="GHC.CmmToAsm.AArch64.Cond.html#NE"><span class="hs-identifier hs-var">NE</span></a></span><span>
</span><span id="line-1538"></span><span>
</span><span id="line-1539"></span><span>          </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_F_Gt"><span class="hs-identifier hs-type">MO_F_Gt</span></a></span><span> </span><span id="local-6989586621682871551"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871551"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Cond -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871540"><span class="hs-identifier hs-var">fbcond</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871551"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="GHC.CmmToAsm.AArch64.Cond.html#OGT"><span class="hs-identifier hs-var">OGT</span></a></span><span>
</span><span id="line-1540"></span><span>          </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_F_Ge"><span class="hs-identifier hs-type">MO_F_Ge</span></a></span><span> </span><span id="local-6989586621682871552"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871552"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Cond -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871540"><span class="hs-identifier hs-var">fbcond</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871552"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="GHC.CmmToAsm.AArch64.Cond.html#OGE"><span class="hs-identifier hs-var">OGE</span></a></span><span>
</span><span id="line-1541"></span><span>          </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_F_Lt"><span class="hs-identifier hs-type">MO_F_Lt</span></a></span><span> </span><span id="local-6989586621682871553"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871553"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Cond -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871540"><span class="hs-identifier hs-var">fbcond</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871553"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="GHC.CmmToAsm.AArch64.Cond.html#OLT"><span class="hs-identifier hs-var">OLT</span></a></span><span>
</span><span id="line-1542"></span><span>          </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_F_Le"><span class="hs-identifier hs-type">MO_F_Le</span></a></span><span> </span><span id="local-6989586621682871554"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871554"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Cond -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871540"><span class="hs-identifier hs-var">fbcond</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871554"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="GHC.CmmToAsm.AArch64.Cond.html#OLE"><span class="hs-identifier hs-var">OLE</span></a></span><span>
</span><span id="line-1543"></span><span>
</span><span id="line-1544"></span><span>          </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Eq"><span class="hs-identifier hs-type">MO_Eq</span></a></span><span> </span><span id="local-6989586621682871555"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871555"><span class="hs-identifier hs-var">w</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Cond -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871529"><span class="hs-identifier hs-var">sbcond</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871555"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="GHC.CmmToAsm.AArch64.Cond.html#EQ"><span class="hs-identifier hs-var">EQ</span></a></span><span>
</span><span id="line-1545"></span><span>          </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Ne"><span class="hs-identifier hs-type">MO_Ne</span></a></span><span> </span><span id="local-6989586621682871556"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871556"><span class="hs-identifier hs-var">w</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Cond -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871529"><span class="hs-identifier hs-var">sbcond</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871556"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="GHC.CmmToAsm.AArch64.Cond.html#NE"><span class="hs-identifier hs-var">NE</span></a></span><span>
</span><span id="line-1546"></span><span>
</span><span id="line-1547"></span><span>          </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_S_Gt"><span class="hs-identifier hs-type">MO_S_Gt</span></a></span><span> </span><span id="local-6989586621682871557"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871557"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Cond -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871529"><span class="hs-identifier hs-var">sbcond</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871557"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="GHC.CmmToAsm.AArch64.Cond.html#SGT"><span class="hs-identifier hs-var">SGT</span></a></span><span>
</span><span id="line-1548"></span><span>          </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_S_Ge"><span class="hs-identifier hs-type">MO_S_Ge</span></a></span><span> </span><span id="local-6989586621682871558"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871558"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Cond -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871529"><span class="hs-identifier hs-var">sbcond</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871558"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="GHC.CmmToAsm.AArch64.Cond.html#SGE"><span class="hs-identifier hs-var">SGE</span></a></span><span>
</span><span id="line-1549"></span><span>          </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_S_Lt"><span class="hs-identifier hs-type">MO_S_Lt</span></a></span><span> </span><span id="local-6989586621682871559"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871559"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Cond -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871529"><span class="hs-identifier hs-var">sbcond</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871559"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="GHC.CmmToAsm.AArch64.Cond.html#SLT"><span class="hs-identifier hs-var">SLT</span></a></span><span>
</span><span id="line-1550"></span><span>          </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_S_Le"><span class="hs-identifier hs-type">MO_S_Le</span></a></span><span> </span><span id="local-6989586621682871560"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871560"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Cond -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871529"><span class="hs-identifier hs-var">sbcond</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871560"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="GHC.CmmToAsm.AArch64.Cond.html#SLE"><span class="hs-identifier hs-var">SLE</span></a></span><span>
</span><span id="line-1551"></span><span>          </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_U_Gt"><span class="hs-identifier hs-type">MO_U_Gt</span></a></span><span> </span><span id="local-6989586621682871561"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871561"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Cond -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871518"><span class="hs-identifier hs-var">ubcond</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871561"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="GHC.CmmToAsm.AArch64.Cond.html#UGT"><span class="hs-identifier hs-var">UGT</span></a></span><span>
</span><span id="line-1552"></span><span>          </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_U_Ge"><span class="hs-identifier hs-type">MO_U_Ge</span></a></span><span> </span><span id="local-6989586621682871562"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871562"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Cond -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871518"><span class="hs-identifier hs-var">ubcond</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871562"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="GHC.CmmToAsm.AArch64.Cond.html#UGE"><span class="hs-identifier hs-var">UGE</span></a></span><span>
</span><span id="line-1553"></span><span>          </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_U_Lt"><span class="hs-identifier hs-type">MO_U_Lt</span></a></span><span> </span><span id="local-6989586621682871563"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871563"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Cond -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871518"><span class="hs-identifier hs-var">ubcond</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871563"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="GHC.CmmToAsm.AArch64.Cond.html#ULT"><span class="hs-identifier hs-var">ULT</span></a></span><span>
</span><span id="line-1554"></span><span>          </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_U_Le"><span class="hs-identifier hs-type">MO_U_Le</span></a></span><span> </span><span id="local-6989586621682871564"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871564"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Cond -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871518"><span class="hs-identifier hs-var">ubcond</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871564"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="GHC.CmmToAsm.AArch64.Cond.html#ULE"><span class="hs-identifier hs-var">ULE</span></a></span><span>
</span><span id="line-1555"></span><span>          </span><span class="annot"><span class="annottext">MachOp
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; NatM (OrdList Instr)
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;AArch64.genCondJump:case mop: &quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; SDoc) -&gt; String -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871502"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1556"></span><span>      </span><span class="annot"><span class="annottext">CmmExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; NatM (OrdList Instr)
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;AArch64.genCondJump: &quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; SDoc) -&gt; String -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871502"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1557"></span><span>
</span><span id="line-1558"></span><span class="hs-comment">-- A conditional jump with at least +/-128M jump range</span><span>
</span><span id="line-1559"></span><span id="local-6989586621682869248"><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#genCondFarJump"><span class="hs-identifier hs-type">genCondFarJump</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSM.html#MonadGetUnique"><span class="hs-identifier hs-type">MonadGetUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682869248"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Cond.html#Cond"><span class="hs-identifier hs-type">Cond</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#Target"><span class="hs-identifier hs-type">Target</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682869248"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a></span></span><span>
</span><span id="line-1560"></span><span id="genCondFarJump"><span class="annot"><span class="annottext">genCondFarJump :: forall (m :: * -&gt; *).
MonadGetUnique m =&gt;
Cond -&gt; Target -&gt; m (OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#genCondFarJump"><span class="hs-identifier hs-var hs-var">genCondFarJump</span></a></span></span><span> </span><span id="local-6989586621682871574"><span class="annot"><span class="annottext">Cond
</span><a href="#local-6989586621682871574"><span class="hs-identifier hs-var">cond</span></a></span></span><span> </span><span id="local-6989586621682871575"><span class="annot"><span class="annottext">Target
</span><a href="#local-6989586621682871575"><span class="hs-identifier hs-var">far_target</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1561"></span><span>  </span><span id="local-6989586621682871576"><span class="annot"><a href="#local-6989586621682871576"><span class="hs-identifier hs-var">skip_lbl_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m BlockId
forall (m :: * -&gt; *). MonadGetUnique m =&gt; m BlockId
</span><a href="GHC.Cmm.BlockId.html#newBlockId"><span class="hs-identifier hs-var">newBlockId</span></a></span><span>
</span><span id="line-1562"></span><span>  </span><span id="local-6989586621682871578"><span class="annot"><a href="#local-6989586621682871578"><span class="hs-identifier hs-var">jmp_lbl_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Cmm.BlockId.html#newBlockId"><span class="hs-identifier hs-type">newBlockId</span></a></span><span>
</span><span id="line-1563"></span><span>
</span><span id="line-1564"></span><span>  </span><span class="hs-comment">-- TODO: We can improve this by inverting the condition</span><span>
</span><span id="line-1565"></span><span>  </span><span class="hs-comment">-- but it's not quite trivial since we don't know if we</span><span>
</span><span id="line-1566"></span><span>  </span><span class="hs-comment">-- need to consider float orderings.</span><span>
</span><span id="line-1567"></span><span>  </span><span class="hs-comment">-- So we take the hit of the additional jump in the false</span><span>
</span><span id="line-1568"></span><span>  </span><span class="hs-comment">-- case for now.</span><span>
</span><span id="line-1569"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-type">toOL</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#BCOND"><span class="hs-identifier hs-type">BCOND</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871574"><span class="hs-identifier hs-type">cond</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#TBlock"><span class="hs-identifier hs-type">TBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871578"><span class="hs-identifier hs-type">jmp_lbl_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1570"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#B"><span class="hs-identifier hs-type">B</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#TBlock"><span class="hs-identifier hs-type">TBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871576"><span class="hs-identifier hs-type">skip_lbl_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1571"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#NEWBLOCK"><span class="hs-identifier hs-type">NEWBLOCK</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871578"><span class="hs-identifier hs-type">jmp_lbl_id</span></a></span><span>
</span><span id="line-1572"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#B"><span class="hs-identifier hs-type">B</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871575"><span class="hs-identifier hs-type">far_target</span></a></span><span>
</span><span id="line-1573"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#NEWBLOCK"><span class="hs-identifier hs-type">NEWBLOCK</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871576"><span class="hs-identifier hs-type">skip_lbl_id</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1574"></span><span>
</span><span id="line-1575"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#genCondBranch"><span class="hs-identifier hs-type">genCondBranch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a></span><span>      </span><span class="hs-comment">-- the true branch target</span><span>
</span><span id="line-1576"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a></span><span>      </span><span class="hs-comment">-- the false branch target</span><span>
</span><span id="line-1577"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span>      </span><span class="hs-comment">-- the condition on which to branch</span><span>
</span><span id="line-1578"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a></span><span> </span><span class="hs-comment">-- Instructions</span><span>
</span><span id="line-1579"></span><span>
</span><span id="line-1580"></span><span id="genCondBranch"><span class="annot"><span class="annottext">genCondBranch :: BlockId -&gt; BlockId -&gt; CmmExpr -&gt; NatM (OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#genCondBranch"><span class="hs-identifier hs-var hs-var">genCondBranch</span></a></span></span><span> </span><span id="local-6989586621682871579"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682871579"><span class="hs-identifier hs-var">true</span></a></span></span><span> </span><span id="local-6989586621682871580"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682871580"><span class="hs-identifier hs-var">false</span></a></span></span><span> </span><span id="local-6989586621682871581"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871581"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1581"></span><span>  </span><span id="local-6989586621682871582"><span class="annot"><a href="#local-6989586621682871582"><span class="hs-identifier hs-var">b1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; CmmExpr -&gt; NatM (OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#genCondJump"><span class="hs-identifier hs-var">genCondJump</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682871579"><span class="hs-identifier hs-var">true</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871581"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-1582"></span><span>  </span><span id="local-6989586621682871583"><span class="annot"><a href="#local-6989586621682871583"><span class="hs-identifier hs-var">b2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#genBranch"><span class="hs-identifier hs-type">genBranch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871580"><span class="hs-identifier hs-type">false</span></a></span><span>
</span><span id="line-1583"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871582"><span class="hs-identifier hs-type">b1</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871583"><span class="hs-identifier hs-type">b2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1584"></span><span>
</span><span id="line-1585"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-1586"></span><span class="hs-comment">--  Generating C calls</span><span>
</span><span id="line-1587"></span><span>
</span><span id="line-1588"></span><span class="hs-comment">-- Now the biggest nightmare---calls.  Most of the nastiness is buried in</span><span>
</span><span id="line-1589"></span><span class="hs-comment">-- @get_arg@, which moves the arguments to the correct registers/stack</span><span>
</span><span id="line-1590"></span><span class="hs-comment">-- locations.  Apart from that, the code is easy.</span><span>
</span><span id="line-1591"></span><span class="hs-comment">--</span><span>
</span><span id="line-1592"></span><span class="hs-comment">-- As per *convention*:</span><span>
</span><span id="line-1593"></span><span class="hs-comment">-- x0-x7:   (volatile) argument registers</span><span>
</span><span id="line-1594"></span><span class="hs-comment">-- x8:      (volatile) indirect result register / Linux syscall no</span><span>
</span><span id="line-1595"></span><span class="hs-comment">-- x9-x15:  (volatile) caller saved regs</span><span>
</span><span id="line-1596"></span><span class="hs-comment">-- x16,x17: (volatile) intra-procedure-call registers</span><span>
</span><span id="line-1597"></span><span class="hs-comment">-- x18:     (volatile) platform register. don't use for portability</span><span>
</span><span id="line-1598"></span><span class="hs-comment">-- x19-x28: (non-volatile) callee save regs</span><span>
</span><span id="line-1599"></span><span class="hs-comment">-- x29:     (non-volatile) frame pointer</span><span>
</span><span id="line-1600"></span><span class="hs-comment">-- x30:                    link register</span><span>
</span><span id="line-1601"></span><span class="hs-comment">-- x31:                    stack pointer / zero reg</span><span>
</span><span id="line-1602"></span><span class="hs-comment">--</span><span>
</span><span id="line-1603"></span><span class="hs-comment">-- Thus, this is what a c function will expect. Find the arguments in x0-x7,</span><span>
</span><span id="line-1604"></span><span class="hs-comment">-- anything above that on the stack.  We'll ignore c functions with more than</span><span>
</span><span id="line-1605"></span><span class="hs-comment">-- 8 arguments for now.  Sorry.</span><span>
</span><span id="line-1606"></span><span class="hs-comment">--</span><span>
</span><span id="line-1607"></span><span class="hs-comment">-- We need to make sure we preserve x9-x15, don't want to touch x16, x17.</span><span>
</span><span id="line-1608"></span><span>
</span><span id="line-1609"></span><span class="hs-comment">-- Note [PLT vs GOT relocations]</span><span>
</span><span id="line-1610"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-1611"></span><span class="hs-comment">-- When linking objects together, we may need to lookup foreign references. That</span><span>
</span><span id="line-1612"></span><span class="hs-comment">-- is symbolic references to functions or values in other objects. When</span><span>
</span><span id="line-1613"></span><span class="hs-comment">-- compiling the object, we can not know where those elements will end up in</span><span>
</span><span id="line-1614"></span><span class="hs-comment">-- memory (relative to the current location). Thus the use of symbols. There</span><span>
</span><span id="line-1615"></span><span class="hs-comment">-- are two types of items we are interested, code segments we want to jump to</span><span>
</span><span id="line-1616"></span><span class="hs-comment">-- and continue execution there (functions, ...), and data items we want to look</span><span>
</span><span id="line-1617"></span><span class="hs-comment">-- up (strings, numbers, ...). For functions we can use the fact that we can use</span><span>
</span><span id="line-1618"></span><span class="hs-comment">-- an intermediate jump without visibility to the programs execution.  If we</span><span>
</span><span id="line-1619"></span><span class="hs-comment">-- want to jump to a function that is simply too far away to reach for the B/BL</span><span>
</span><span id="line-1620"></span><span class="hs-comment">-- instruction, we can create a small piece of code that loads the full target</span><span>
</span><span id="line-1621"></span><span class="hs-comment">-- address and jumps to that on demand. Say f wants to call g, however g is out</span><span>
</span><span id="line-1622"></span><span class="hs-comment">-- of range for a direct jump, we can create a function h in range for f, that</span><span>
</span><span id="line-1623"></span><span class="hs-comment">-- will load the address of g, and jump there. The area where we construct h</span><span>
</span><span id="line-1624"></span><span class="hs-comment">-- is called the Procedure Linking Table (PLT), we have essentially replaced</span><span>
</span><span id="line-1625"></span><span class="hs-comment">-- f -&gt; g with f -&gt; h -&gt; g.  This is fine for function calls.  However if we</span><span>
</span><span id="line-1626"></span><span class="hs-comment">-- want to lookup values, this trick doesn't work, so we need something else.</span><span>
</span><span id="line-1627"></span><span class="hs-comment">-- We will instead reserve a slot in memory, and have a symbol pointing to that</span><span>
</span><span id="line-1628"></span><span class="hs-comment">-- slot. Now what we essentially do is, we reference that slot, and expect that</span><span>
</span><span id="line-1629"></span><span class="hs-comment">-- slot to hold the final resting address of the data we are interested in.</span><span>
</span><span id="line-1630"></span><span class="hs-comment">-- Thus what that symbol really points to is the location of the final data.</span><span>
</span><span id="line-1631"></span><span class="hs-comment">-- The block of memory where we hold all those slots is the Global Offset Table</span><span>
</span><span id="line-1632"></span><span class="hs-comment">-- (GOT).  Instead of x &lt;- $foo, we now do y &lt;- $fooPtr, and x &lt;- [$y].</span><span>
</span><span id="line-1633"></span><span class="hs-comment">--</span><span>
</span><span id="line-1634"></span><span class="hs-comment">-- For JUMP/CALLs we have 26bits (+/- 128MB), for conditional branches we only</span><span>
</span><span id="line-1635"></span><span class="hs-comment">-- have 19bits (+/- 1MB).  Symbol lookups are also within +/- 1MB, thus for most</span><span>
</span><span id="line-1636"></span><span class="hs-comment">-- of the LOAD/STOREs we'd want to use adrp, and add to compute a value within</span><span>
</span><span id="line-1637"></span><span class="hs-comment">-- 4GB of the PC, and load that.  For anything outside of that range, we'd have</span><span>
</span><span id="line-1638"></span><span class="hs-comment">-- to go through the GOT.</span><span>
</span><span id="line-1639"></span><span class="hs-comment">--</span><span>
</span><span id="line-1640"></span><span class="hs-comment">--  adrp x0, &lt;symbol&gt;</span><span>
</span><span id="line-1641"></span><span class="hs-comment">--  add x0, :lo:&lt;symbol&gt;</span><span>
</span><span id="line-1642"></span><span class="hs-comment">--</span><span>
</span><span id="line-1643"></span><span class="hs-comment">-- will compute the address of &lt;symbol&gt; int x0 if &lt;symbol&gt; is within 4GB of the</span><span>
</span><span id="line-1644"></span><span class="hs-comment">-- PC.</span><span>
</span><span id="line-1645"></span><span class="hs-comment">--</span><span>
</span><span id="line-1646"></span><span class="hs-comment">-- If we want to get the slot in the global offset table (GOT), we can do this:</span><span>
</span><span id="line-1647"></span><span class="hs-comment">--</span><span>
</span><span id="line-1648"></span><span class="hs-comment">--   adrp x0, #:got:&lt;symbol&gt;</span><span>
</span><span id="line-1649"></span><span class="hs-comment">--   ldr x0, [x0, #:got_lo12:&lt;symbol&gt;]</span><span>
</span><span id="line-1650"></span><span class="hs-comment">--</span><span>
</span><span id="line-1651"></span><span class="hs-comment">-- this will compute the address anywhere in the addressable 64bit space into</span><span>
</span><span id="line-1652"></span><span class="hs-comment">-- x0, by loading the address from the GOT slot.</span><span>
</span><span id="line-1653"></span><span class="hs-comment">--</span><span>
</span><span id="line-1654"></span><span class="hs-comment">-- To actually get the value of &lt;symbol&gt;, we'd need to ldr x0, x0 still, which</span><span>
</span><span id="line-1655"></span><span class="hs-comment">-- for the first case can be optimized to use ldr x0, [x0, #:lo12:&lt;symbol&gt;]</span><span>
</span><span id="line-1656"></span><span class="hs-comment">-- instead of the add instruction.</span><span>
</span><span id="line-1657"></span><span class="hs-comment">--</span><span>
</span><span id="line-1658"></span><span class="hs-comment">-- As the memory model for AArch64 for PIC is considered to be +/- 4GB, we do</span><span>
</span><span id="line-1659"></span><span class="hs-comment">-- not need to go through the GOT, unless we want to address the full address</span><span>
</span><span id="line-1660"></span><span class="hs-comment">-- range within 64bit.</span><span>
</span><span id="line-1661"></span><span>
</span><span id="line-1662"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#genCCall"><span class="hs-identifier hs-type">genCCall</span></a></span><span>
</span><span id="line-1663"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#ForeignTarget"><span class="hs-identifier hs-type">ForeignTarget</span></a></span><span>      </span><span class="hs-comment">-- function to call</span><span>
</span><span id="line-1664"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmFormal"><span class="hs-identifier hs-type">CmmFormal</span></a></span><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- where to put the result</span><span>
</span><span id="line-1665"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmActual"><span class="hs-identifier hs-type">CmmActual</span></a></span><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- arguments (of mixed type)</span><span>
</span><span id="line-1666"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a></span><span>
</span><span id="line-1667"></span><span class="hs-comment">-- TODO: Specialize where we can.</span><span>
</span><span id="line-1668"></span><span class="hs-comment">-- Generic impl</span><span>
</span><span id="line-1669"></span><span id="genCCall"><span class="annot"><span class="annottext">genCCall :: ForeignTarget -&gt; [CmmFormal] -&gt; [CmmExpr] -&gt; NatM (OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#genCCall"><span class="hs-identifier hs-var hs-var">genCCall</span></a></span></span><span> </span><span id="local-6989586621682871585"><span class="annot"><span class="annottext">ForeignTarget
</span><a href="#local-6989586621682871585"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span id="local-6989586621682871586"><span class="annot"><span class="annottext">[CmmFormal]
</span><a href="#local-6989586621682871586"><span class="hs-identifier hs-var">dest_regs</span></a></span></span><span> </span><span id="local-6989586621682871587"><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682871587"><span class="hs-identifier hs-var">arg_regs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1670"></span><span>  </span><span class="hs-comment">-- we want to pass arg_regs into allArgRegs</span><span>
</span><span id="line-1671"></span><span>  </span><span class="hs-comment">-- pprTraceM &quot;genCCall target&quot; (ppr target)</span><span>
</span><span id="line-1672"></span><span>  </span><span class="hs-comment">-- pprTraceM &quot;genCCall formal&quot; (ppr dest_regs)</span><span>
</span><span id="line-1673"></span><span>  </span><span class="hs-comment">-- pprTraceM &quot;genCCall actual&quot; (ppr arg_regs)</span><span>
</span><span id="line-1674"></span><span>  </span><span id="local-6989586621682871588"><span class="annot"><a href="#local-6989586621682871588"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NatM Platform
</span><a href="GHC.CmmToAsm.Monad.html#getPlatform"><span class="hs-identifier hs-var">getPlatform</span></a></span><span>
</span><span id="line-1675"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682871585"><span class="hs-identifier hs-type">target</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1676"></span><span>    </span><span class="hs-comment">-- The target :: ForeignTarget call can either</span><span>
</span><span id="line-1677"></span><span>    </span><span class="hs-comment">-- be a foreign procedure with an address expr</span><span>
</span><span id="line-1678"></span><span>    </span><span class="hs-comment">-- and a calling convention.</span><span>
</span><span id="line-1679"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Node.html#ForeignTarget"><span class="hs-identifier hs-type">ForeignTarget</span></a></span><span> </span><span id="local-6989586621682871590"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871590"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621682871591"><span class="annot"><span class="annottext">ForeignConvention
</span><a href="#local-6989586621682871591"><span class="hs-identifier hs-var">_cconv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1680"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682871592"><span class="annot"><a href="#local-6989586621682871592"><span class="hs-identifier hs-var">call_target</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871593"><span class="annot"><a href="#local-6989586621682871593"><span class="hs-identifier hs-var">call_target_code</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871590"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1681"></span><span>        </span><span class="hs-comment">-- if this is a label, let's just directly to it.  This will produce the</span><span>
</span><span id="line-1682"></span><span>        </span><span class="hs-comment">-- correct CALL relocation for BL...</span><span>
</span><span id="line-1683"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLabel"><span class="hs-identifier hs-type">CmmLabel</span></a></span><span> </span><span id="local-6989586621682871594"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682871594"><span class="hs-identifier hs-var">lbl</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Target, OrdList Instr) -&gt; NatM (Target, OrdList Instr)
forall a. a -&gt; NatM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLabel -&gt; Target
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#TLabel"><span class="hs-identifier hs-var">TLabel</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682871594"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
forall a. OrdList a
</span><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-var">nilOL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1684"></span><span>        </span><span class="hs-comment">-- ... if it's not a label--well--let's compute the expression into a</span><span>
</span><span id="line-1685"></span><span>        </span><span class="hs-comment">-- register and jump to that. See Note [PLT vs GOT relocations]</span><span>
</span><span id="line-1686"></span><span>        </span><span class="annot"><span class="annottext">CmmExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682871595"><span class="annot"><a href="#local-6989586621682871595"><span class="hs-identifier hs-var">reg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871596"><span class="annot"><a href="#local-6989586621682871596"><span class="hs-identifier hs-var">_format</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871597"><span class="annot"><a href="#local-6989586621682871597"><span class="hs-identifier hs-var">reg_code</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871590"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-1687"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#TReg"><span class="hs-identifier hs-type">TReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871595"><span class="hs-identifier hs-type">reg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682871597"><span class="hs-identifier hs-type">reg_code</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1688"></span><span>      </span><span class="hs-comment">-- compute the code and register logic for all arg_regs.</span><span>
</span><span id="line-1689"></span><span>      </span><span class="hs-comment">-- this will give us the format information to match on.</span><span>
</span><span id="line-1690"></span><span>      </span><span id="local-6989586621682871598"><span class="annot"><a href="#local-6989586621682871598"><span class="hs-identifier hs-var">arg_regs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-type">getSomeReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871587"><span class="hs-identifier hs-type">arg_regs</span></a></span><span>
</span><span id="line-1691"></span><span>
</span><span id="line-1692"></span><span>      </span><span class="hs-comment">-- Now this is stupid.  Our Cmm expressions doesn't carry the proper sizes</span><span>
</span><span id="line-1693"></span><span>      </span><span class="hs-comment">-- so while in Cmm we might get W64 incorrectly for an int, that is W32 in</span><span>
</span><span id="line-1694"></span><span>      </span><span class="hs-comment">-- STG; this thenn breaks packing of stack arguments, if we need to pack</span><span>
</span><span id="line-1695"></span><span>      </span><span class="hs-comment">-- for the pcs, e.g. darwinpcs.  Option one would be to fix the Int type</span><span>
</span><span id="line-1696"></span><span>      </span><span class="hs-comment">-- in Cmm proper. Option two, which we choose here is to use extended Hint</span><span>
</span><span id="line-1697"></span><span>      </span><span class="hs-comment">-- information to contain the size information and use that when packing</span><span>
</span><span id="line-1698"></span><span>      </span><span class="hs-comment">-- arguments, spilled onto the stack.</span><span>
</span><span id="line-1699"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682871600"><span class="annot"><a href="#local-6989586621682871600"><span class="hs-identifier hs-var">_res_hints</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871601"><span class="annot"><a href="#local-6989586621682871601"><span class="hs-identifier hs-var">arg_hints</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#foreignTargetHints"><span class="hs-identifier hs-type">foreignTargetHints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871585"><span class="hs-identifier hs-type">target</span></a></span><span>
</span><span id="line-1700"></span><span>          </span><span id="local-6989586621682871603"><span class="annot"><a href="#local-6989586621682871603"><span class="hs-identifier hs-var hs-var">arg_regs''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Reg, Format, OrdList Instr)
 -&gt; ForeignHint -&gt; (Reg, Format, ForeignHint, OrdList Instr))
-&gt; [(Reg, Format, OrdList Instr)]
-&gt; [ForeignHint]
-&gt; [(Reg, Format, ForeignHint, OrdList Instr)]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682871605"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871605"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871606"><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682871606"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871607"><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871607"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682871608"><span class="annot"><span class="annottext">ForeignHint
</span><a href="#local-6989586621682871608"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871605"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682871606"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">ForeignHint
</span><a href="#local-6989586621682871608"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871607"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Reg, Format, OrdList Instr)]
</span><a href="#local-6989586621682871598"><span class="hs-identifier hs-var">arg_regs'</span></a></span><span> </span><span class="annot"><span class="annottext">[ForeignHint]
</span><a href="#local-6989586621682871601"><span class="hs-identifier hs-var">arg_hints</span></a></span><span>
</span><span id="line-1701"></span><span>
</span><span id="line-1702"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682871609"><span class="annot"><a href="#local-6989586621682871609"><span class="hs-identifier hs-var hs-var">packStack</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682871588"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">OS -&gt; OS -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">OS
</span><span class="hs-identifier hs-var">OSDarwin</span></span><span>
</span><span id="line-1703"></span><span>
</span><span id="line-1704"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682871612"><span class="annot"><a href="#local-6989586621682871612"><span class="hs-identifier hs-var">stackSpace'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871613"><span class="annot"><a href="#local-6989586621682871613"><span class="hs-identifier hs-var">passRegs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871614"><span class="annot"><a href="#local-6989586621682871614"><span class="hs-identifier hs-var">passArgumentsCode</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682871615"><span class="hs-identifier hs-type">passArguments</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871609"><span class="hs-identifier hs-type">packStack</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Regs.html#allGpArgRegs"><span class="hs-identifier hs-type">allGpArgRegs</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Regs.html#allFpArgRegs"><span class="hs-identifier hs-type">allFpArgRegs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871603"><span class="hs-identifier hs-type">arg_regs''</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-type">nilOL</span></a></span><span>
</span><span id="line-1705"></span><span>
</span><span id="line-1706"></span><span>      </span><span class="hs-comment">-- if we pack the stack, we may need to adjust to multiple of 8byte.</span><span>
</span><span id="line-1707"></span><span>      </span><span class="hs-comment">-- if we don't pack the stack, it will always be multiple of 8.</span><span>
</span><span id="line-1708"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682871618"><span class="annot"><a href="#local-6989586621682871618"><span class="hs-identifier hs-var hs-var">stackSpace</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871612"><span class="hs-identifier hs-var">stackSpace'</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1709"></span><span>                       </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871612"><span class="hs-identifier hs-var">stackSpace'</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-1710"></span><span>                       </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871612"><span class="hs-identifier hs-var">stackSpace'</span></a></span><span>
</span><span id="line-1711"></span><span>
</span><span id="line-1712"></span><span>      </span><span id="local-6989586621682871621"><span class="annot"><a href="#local-6989586621682871621"><span class="hs-identifier hs-var">readResultsCode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682871622"><span class="hs-identifier hs-type">readResults</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Regs.html#allGpArgRegs"><span class="hs-identifier hs-type">allGpArgRegs</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Regs.html#allFpArgRegs"><span class="hs-identifier hs-type">allFpArgRegs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871586"><span class="hs-identifier hs-type">dest_regs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-type">nilOL</span></a></span><span>
</span><span id="line-1713"></span><span>
</span><span id="line-1714"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682871637"><span class="annot"><a href="#local-6989586621682871637"><span class="hs-identifier hs-var hs-var">moveStackDown</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Instr] -&gt; OrdList Instr
forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#PUSH_STACK_FRAME"><span class="hs-identifier hs-var">PUSH_STACK_FRAME</span></a></span><span>
</span><span id="line-1715"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#DELTA"><span class="hs-identifier hs-var">DELTA</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1716"></span><span>          </span><span class="annot"><a href="#local-6989586621682871637"><span class="hs-identifier hs-var">moveStackDown</span></a></span><span> </span><span id="local-6989586621682871640"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871640"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool
forall a. Integral a =&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">odd</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871640"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; OrdList Instr
</span><a href="#local-6989586621682871637"><span class="hs-identifier hs-var">moveStackDown</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871640"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-1717"></span><span>          </span><span class="annot"><a href="#local-6989586621682871637"><span class="hs-identifier hs-var">moveStackDown</span></a></span><span> </span><span id="local-6989586621682871642"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871642"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Instr] -&gt; OrdList Instr
forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#PUSH_STACK_FRAME"><span class="hs-identifier hs-var">PUSH_STACK_FRAME</span></a></span><span>
</span><span id="line-1718"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SUB"><span class="hs-identifier hs-var">SUB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Reg
</span><a href="GHC.Platform.Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">31</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Reg
</span><a href="GHC.Platform.Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">31</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871642"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1719"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#DELTA"><span class="hs-identifier hs-var">DELTA</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871642"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1720"></span><span>          </span><span id="local-6989586621682871651"><span class="annot"><a href="#local-6989586621682871651"><span class="hs-identifier hs-var hs-var">moveStackUp</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Instr] -&gt; OrdList Instr
forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#POP_STACK_FRAME"><span class="hs-identifier hs-var">POP_STACK_FRAME</span></a></span><span>
</span><span id="line-1721"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#DELTA"><span class="hs-identifier hs-var">DELTA</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1722"></span><span>          </span><span class="annot"><a href="#local-6989586621682871651"><span class="hs-identifier hs-var">moveStackUp</span></a></span><span> </span><span id="local-6989586621682871653"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871653"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool
forall a. Integral a =&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">odd</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871653"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; OrdList Instr
</span><a href="#local-6989586621682871651"><span class="hs-identifier hs-var">moveStackUp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871653"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-1723"></span><span>          </span><span class="annot"><a href="#local-6989586621682871651"><span class="hs-identifier hs-var">moveStackUp</span></a></span><span> </span><span id="local-6989586621682871654"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871654"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Instr] -&gt; OrdList Instr
forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Reg
</span><a href="GHC.Platform.Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">31</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Reg
</span><a href="GHC.Platform.Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">31</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871654"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1724"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#POP_STACK_FRAME"><span class="hs-identifier hs-var">POP_STACK_FRAME</span></a></span><span>
</span><span id="line-1725"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#DELTA"><span class="hs-identifier hs-var">DELTA</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1726"></span><span>
</span><span id="line-1727"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682871655"><span class="annot"><a href="#local-6989586621682871655"><span class="hs-identifier hs-var hs-var">code</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>    </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871593"><span class="hs-identifier hs-var">call_target_code</span></a></span><span>          </span><span class="hs-comment">-- compute the label (possibly into a register)</span><span>
</span><span id="line-1728"></span><span>            </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; OrdList Instr
</span><a href="#local-6989586621682871637"><span class="hs-identifier hs-var">moveStackDown</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871618"><span class="hs-identifier hs-var">stackSpace</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span class="hs-special">)</span><span>
</span><span id="line-1729"></span><span>            </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871614"><span class="hs-identifier hs-var">passArgumentsCode</span></a></span><span>         </span><span class="hs-comment">-- put the arguments into x0, ...</span><span>
</span><span id="line-1730"></span><span>            </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; OrdList Instr) -&gt; Instr -&gt; OrdList Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Target -&gt; [Reg] -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#BL"><span class="hs-identifier hs-var">BL</span></a></span><span> </span><span class="annot"><span class="annottext">Target
</span><a href="#local-6989586621682871592"><span class="hs-identifier hs-var">call_target</span></a></span><span> </span><span class="annot"><span class="annottext">[Reg]
</span><a href="#local-6989586621682871613"><span class="hs-identifier hs-var">passRegs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- branch and link.</span><span>
</span><span id="line-1731"></span><span>            </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871621"><span class="hs-identifier hs-var">readResultsCode</span></a></span><span>           </span><span class="hs-comment">-- parse the results into registers</span><span>
</span><span id="line-1732"></span><span>            </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; OrdList Instr
</span><a href="#local-6989586621682871651"><span class="hs-identifier hs-var">moveStackUp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871618"><span class="hs-identifier hs-var">stackSpace</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span class="hs-special">)</span><span>
</span><span id="line-1733"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682871655"><span class="hs-identifier hs-type">code</span></a></span><span>
</span><span id="line-1734"></span><span>
</span><span id="line-1735"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Node.html#PrimTarget"><span class="hs-identifier hs-type">PrimTarget</span></a></span><span> </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F32_Fabs"><span class="hs-identifier hs-var">MO_F32_Fabs</span></a></span><span>
</span><span id="line-1736"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871659"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871659"><span class="hs-identifier hs-var">arg_reg</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682871587"><span class="hs-identifier hs-var">arg_regs</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871660"><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871660"><span class="hs-identifier hs-var">dest_reg</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmFormal]
</span><a href="#local-6989586621682871586"><span class="hs-identifier hs-var">dest_regs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1737"></span><span>        </span><span class="annot"><span class="annottext">Width
-&gt; (Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; CmmExpr
-&gt; CmmFormal
-&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871661"><span class="hs-identifier hs-var">unaryFloatOp</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871662"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871662"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871663"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871663"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; OrdList Instr) -&gt; Instr -&gt; OrdList Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#FABS"><span class="hs-identifier hs-var">FABS</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871662"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871663"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871659"><span class="hs-identifier hs-var">arg_reg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871660"><span class="hs-identifier hs-var">dest_reg</span></a></span><span>
</span><span id="line-1738"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; NatM (OrdList Instr)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mal-formed MO_F32_Fabs&quot;</span></span><span>
</span><span id="line-1739"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Node.html#PrimTarget"><span class="hs-identifier hs-type">PrimTarget</span></a></span><span> </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F64_Fabs"><span class="hs-identifier hs-var">MO_F64_Fabs</span></a></span><span>
</span><span id="line-1740"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871666"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871666"><span class="hs-identifier hs-var">arg_reg</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682871587"><span class="hs-identifier hs-var">arg_regs</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871667"><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871667"><span class="hs-identifier hs-var">dest_reg</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmFormal]
</span><a href="#local-6989586621682871586"><span class="hs-identifier hs-var">dest_regs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1741"></span><span>        </span><span class="annot"><span class="annottext">Width
-&gt; (Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; CmmExpr
-&gt; CmmFormal
-&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871661"><span class="hs-identifier hs-var">unaryFloatOp</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871668"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871668"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871669"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871669"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; OrdList Instr) -&gt; Instr -&gt; OrdList Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#FABS"><span class="hs-identifier hs-var">FABS</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871668"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871669"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871666"><span class="hs-identifier hs-var">arg_reg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871667"><span class="hs-identifier hs-var">dest_reg</span></a></span><span>
</span><span id="line-1742"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; NatM (OrdList Instr)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mal-formed MO_F64_Fabs&quot;</span></span><span>
</span><span id="line-1743"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Node.html#PrimTarget"><span class="hs-identifier hs-type">PrimTarget</span></a></span><span> </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F32_Sqrt"><span class="hs-identifier hs-var">MO_F32_Sqrt</span></a></span><span>
</span><span id="line-1744"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871671"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871671"><span class="hs-identifier hs-var">arg_reg</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682871587"><span class="hs-identifier hs-var">arg_regs</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871672"><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871672"><span class="hs-identifier hs-var">dest_reg</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmFormal]
</span><a href="#local-6989586621682871586"><span class="hs-identifier hs-var">dest_regs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1745"></span><span>        </span><span class="annot"><span class="annottext">Width
-&gt; (Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; CmmExpr
-&gt; CmmFormal
-&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871661"><span class="hs-identifier hs-var">unaryFloatOp</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871673"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871673"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871674"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871674"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; OrdList Instr) -&gt; Instr -&gt; OrdList Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#FSQRT"><span class="hs-identifier hs-var">FSQRT</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871673"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871674"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871671"><span class="hs-identifier hs-var">arg_reg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871672"><span class="hs-identifier hs-var">dest_reg</span></a></span><span>
</span><span id="line-1746"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; NatM (OrdList Instr)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mal-formed MO_F32_Sqrt&quot;</span></span><span>
</span><span id="line-1747"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Node.html#PrimTarget"><span class="hs-identifier hs-type">PrimTarget</span></a></span><span> </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F64_Sqrt"><span class="hs-identifier hs-var">MO_F64_Sqrt</span></a></span><span>
</span><span id="line-1748"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871677"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871677"><span class="hs-identifier hs-var">arg_reg</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682871587"><span class="hs-identifier hs-var">arg_regs</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871678"><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871678"><span class="hs-identifier hs-var">dest_reg</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmFormal]
</span><a href="#local-6989586621682871586"><span class="hs-identifier hs-var">dest_regs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1749"></span><span>        </span><span class="annot"><span class="annottext">Width
-&gt; (Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; CmmExpr
-&gt; CmmFormal
-&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871661"><span class="hs-identifier hs-var">unaryFloatOp</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682871679"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871679"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682871680"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871680"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; OrdList Instr) -&gt; Instr -&gt; OrdList Instr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#FSQRT"><span class="hs-identifier hs-var">FSQRT</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871679"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682871680"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871677"><span class="hs-identifier hs-var">arg_reg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871678"><span class="hs-identifier hs-var">dest_reg</span></a></span><span>
</span><span id="line-1750"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; NatM (OrdList Instr)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mal-formed MO_F64_Sqrt&quot;</span></span><span>
</span><span id="line-1751"></span><span>
</span><span id="line-1752"></span><span>
</span><span id="line-1753"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Node.html#PrimTarget"><span class="hs-identifier hs-type">PrimTarget</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_S_Mul2"><span class="hs-identifier hs-type">MO_S_Mul2</span></a></span><span> </span><span id="local-6989586621682871682"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871682"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1754"></span><span>          </span><span class="hs-comment">-- Life is easier when we're working with word sized operands,</span><span>
</span><span id="line-1755"></span><span>          </span><span class="hs-comment">-- we can use SMULH to compute the high 64 bits, and dst_needed</span><span>
</span><span id="line-1756"></span><span>          </span><span class="hs-comment">-- checks if the high half's bits are all the same as the low half's</span><span>
</span><span id="line-1757"></span><span>          </span><span class="hs-comment">-- top bit.</span><span>
</span><span id="line-1758"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871682"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span>
</span><span id="line-1759"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871683"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871683"><span class="hs-identifier hs-var">src_a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871684"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871684"><span class="hs-identifier hs-var">src_b</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682871587"><span class="hs-identifier hs-var">arg_regs</span></a></span><span>
</span><span id="line-1760"></span><span>          </span><span class="hs-comment">-- dst_needed = did the result fit into just the low half</span><span>
</span><span id="line-1761"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871685"><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871685"><span class="hs-identifier hs-var">dst_needed</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871686"><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871686"><span class="hs-identifier hs-var">dst_hi</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871687"><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871687"><span class="hs-identifier hs-var">dst_lo</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmFormal]
</span><a href="#local-6989586621682871586"><span class="hs-identifier hs-var">dest_regs</span></a></span><span>
</span><span id="line-1762"></span><span>            </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-keyword">do</span><span>
</span><span id="line-1763"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682871688"><span class="annot"><a href="#local-6989586621682871688"><span class="hs-identifier hs-var">reg_a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871689"><span class="annot"><a href="#local-6989586621682871689"><span class="hs-identifier hs-var">_format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871690"><span class="annot"><a href="#local-6989586621682871690"><span class="hs-identifier hs-var">code_x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871683"><span class="hs-identifier hs-var">src_a</span></a></span><span>
</span><span id="line-1764"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682871691"><span class="annot"><a href="#local-6989586621682871691"><span class="hs-identifier hs-var">reg_b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871692"><span class="annot"><a href="#local-6989586621682871692"><span class="hs-identifier hs-var">_format_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871693"><span class="annot"><a href="#local-6989586621682871693"><span class="hs-identifier hs-var">code_y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-type">getSomeReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871684"><span class="hs-identifier hs-type">src_b</span></a></span><span>
</span><span id="line-1765"></span><span>
</span><span id="line-1766"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682871694"><span class="annot"><a href="#local-6989586621682871694"><span class="hs-identifier hs-var hs-var">lo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmReg -&gt; Reg
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682871588"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmFormal -&gt; CmmReg
</span><a href="GHC.Cmm.Reg.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a></span><span> </span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871687"><span class="hs-identifier hs-var">dst_lo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1767"></span><span>                  </span><span id="local-6989586621682871695"><span class="annot"><a href="#local-6989586621682871695"><span class="hs-identifier hs-var hs-var">hi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmReg -&gt; Reg
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682871588"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmFormal -&gt; CmmReg
</span><a href="GHC.Cmm.Reg.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a></span><span> </span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871686"><span class="hs-identifier hs-var">dst_hi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1768"></span><span>                  </span><span id="local-6989586621682871696"><span class="annot"><a href="#local-6989586621682871696"><span class="hs-identifier hs-var hs-var">nd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmReg -&gt; Reg
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682871588"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmFormal -&gt; CmmReg
</span><a href="GHC.Cmm.Reg.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a></span><span> </span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871685"><span class="hs-identifier hs-var">dst_needed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1769"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1770"></span><span>                  </span><span class="annot"><a href="#local-6989586621682871690"><span class="hs-identifier hs-type">code_x</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span>
</span><span id="line-1771"></span><span>                  </span><span class="annot"><a href="#local-6989586621682871693"><span class="hs-identifier hs-type">code_y</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-type">`snocOL`</span></a></span><span>
</span><span id="line-1772"></span><span>                  </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#MUL"><span class="hs-identifier hs-type">MUL</span></a></span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-type">W64</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871694"><span class="hs-identifier hs-type">lo</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-type">W64</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871688"><span class="hs-identifier hs-type">reg_a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-type">W64</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871691"><span class="hs-identifier hs-type">reg_b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-type">`snocOL`</span></a></span><span>
</span><span id="line-1773"></span><span>                  </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#SMULH"><span class="hs-identifier hs-type">SMULH</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-type">W64</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871695"><span class="hs-identifier hs-type">hi</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-type">W64</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871688"><span class="hs-identifier hs-type">reg_a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-type">W64</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871691"><span class="hs-identifier hs-type">reg_b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-type">`snocOL`</span></a></span><span>
</span><span id="line-1774"></span><span>                  </span><span class="hs-comment">-- Are all high bits equal to the sign bit of the low word?</span><span>
</span><span id="line-1775"></span><span>                  </span><span class="hs-comment">-- nd = (hi == ASR(lo,width-1)) ? 1 : 0</span><span>
</span><span id="line-1776"></span><span>                  </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#CMP"><span class="hs-identifier hs-type">CMP</span></a></span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-type">W64</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871695"><span class="hs-identifier hs-type">hi</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpRegShift"><span class="hs-identifier hs-type">OpRegShift</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-type">W64</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871694"><span class="hs-identifier hs-type">lo</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#SASR"><span class="hs-identifier hs-type">SASR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Type.html#widthInBits"><span class="hs-identifier hs-type">widthInBits</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871682"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">-</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-type">`snocOL`</span></a></span><span>
</span><span id="line-1777"></span><span>                  </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#CSET"><span class="hs-identifier hs-type">CSET</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-type">W64</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871696"><span class="hs-identifier hs-type">nd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Cond.html#NE"><span class="hs-identifier hs-type">NE</span></a></span><span>
</span><span id="line-1778"></span><span>            </span><span class="hs-comment">-- For sizes &lt; platform width, we can just perform a multiply and shift</span><span>
</span><span id="line-1779"></span><span>            </span><span class="hs-comment">-- using the normal 64 bit multiply. Calculating the dst_needed value is</span><span>
</span><span id="line-1780"></span><span>            </span><span class="hs-comment">-- complicated a little by the need to be careful when truncation happens.</span><span>
</span><span id="line-1781"></span><span>            </span><span class="hs-comment">-- Currently this case can't be generated since</span><span>
</span><span id="line-1782"></span><span>            </span><span class="hs-comment">-- timesInt2# :: Int# -&gt; Int# -&gt; (# Int#, Int#, Int# #)</span><span>
</span><span id="line-1783"></span><span>            </span><span class="hs-comment">-- TODO: Should this be removed or would other primops be useful?</span><span>
</span><span id="line-1784"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871682"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span>
</span><span id="line-1785"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871697"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871697"><span class="hs-identifier hs-var">src_a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871698"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871698"><span class="hs-identifier hs-var">src_b</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682871587"><span class="hs-identifier hs-var">arg_regs</span></a></span><span>
</span><span id="line-1786"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871699"><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871699"><span class="hs-identifier hs-var">dst_needed</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871700"><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871700"><span class="hs-identifier hs-var">dst_hi</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871701"><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871701"><span class="hs-identifier hs-var">dst_lo</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmFormal]
</span><a href="#local-6989586621682871586"><span class="hs-identifier hs-var">dest_regs</span></a></span><span>
</span><span id="line-1787"></span><span>            </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-keyword">do</span><span>
</span><span id="line-1788"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682871702"><span class="annot"><a href="#local-6989586621682871702"><span class="hs-identifier hs-var">reg_a'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871703"><span class="annot"><a href="#local-6989586621682871703"><span class="hs-identifier hs-var">_format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871704"><span class="annot"><a href="#local-6989586621682871704"><span class="hs-identifier hs-var">code_a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871697"><span class="hs-identifier hs-var">src_a</span></a></span><span>
</span><span id="line-1789"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682871705"><span class="annot"><a href="#local-6989586621682871705"><span class="hs-identifier hs-var">reg_b'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871706"><span class="annot"><a href="#local-6989586621682871706"><span class="hs-identifier hs-var">_format_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871707"><span class="annot"><a href="#local-6989586621682871707"><span class="hs-identifier hs-var">code_b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-type">getSomeReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871698"><span class="hs-identifier hs-type">src_b</span></a></span><span>
</span><span id="line-1790"></span><span>
</span><span id="line-1791"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682871708"><span class="annot"><a href="#local-6989586621682871708"><span class="hs-identifier hs-var hs-var">lo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmReg -&gt; Reg
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682871588"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmFormal -&gt; CmmReg
</span><a href="GHC.Cmm.Reg.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a></span><span> </span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871701"><span class="hs-identifier hs-var">dst_lo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1792"></span><span>                  </span><span id="local-6989586621682871709"><span class="annot"><a href="#local-6989586621682871709"><span class="hs-identifier hs-var hs-var">hi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmReg -&gt; Reg
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682871588"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmFormal -&gt; CmmReg
</span><a href="GHC.Cmm.Reg.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a></span><span> </span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871700"><span class="hs-identifier hs-var">dst_hi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1793"></span><span>                  </span><span id="local-6989586621682871710"><span class="annot"><a href="#local-6989586621682871710"><span class="hs-identifier hs-var hs-var">nd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmReg -&gt; Reg
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682871588"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmFormal -&gt; CmmReg
</span><a href="GHC.Cmm.Reg.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a></span><span> </span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871699"><span class="hs-identifier hs-var">dst_needed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1794"></span><span>                  </span><span class="hs-comment">-- Do everything in a full 64 bit registers</span><span>
</span><span id="line-1795"></span><span>                  </span><span id="local-6989586621682871711"><span class="annot"><a href="#local-6989586621682871711"><span class="hs-identifier hs-var hs-var">w'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Width
</span><a href="GHC.CmmToAsm.Config.html#platformWordWidth"><span class="hs-identifier hs-var">platformWordWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682871588"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-1796"></span><span>
</span><span id="line-1797"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682871713"><span class="annot"><a href="#local-6989586621682871713"><span class="hs-identifier hs-var">reg_a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871714"><span class="annot"><a href="#local-6989586621682871714"><span class="hs-identifier hs-var">code_a'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#signExtendReg"><span class="hs-identifier hs-type">signExtendReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871682"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871711"><span class="hs-identifier hs-type">w'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871702"><span class="hs-identifier hs-type">reg_a'</span></a></span><span>
</span><span id="line-1798"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682871715"><span class="annot"><a href="#local-6989586621682871715"><span class="hs-identifier hs-var">reg_b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871716"><span class="annot"><a href="#local-6989586621682871716"><span class="hs-identifier hs-var">code_b'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#signExtendReg"><span class="hs-identifier hs-type">signExtendReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871682"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871711"><span class="hs-identifier hs-type">w'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871705"><span class="hs-identifier hs-type">reg_b'</span></a></span><span>
</span><span id="line-1799"></span><span>
</span><span id="line-1800"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1801"></span><span>                  </span><span class="annot"><a href="#local-6989586621682871704"><span class="hs-identifier hs-type">code_a</span></a></span><span>  </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span>
</span><span id="line-1802"></span><span>                  </span><span class="annot"><a href="#local-6989586621682871707"><span class="hs-identifier hs-type">code_b</span></a></span><span>  </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span>
</span><span id="line-1803"></span><span>                  </span><span class="annot"><a href="#local-6989586621682871714"><span class="hs-identifier hs-type">code_a'</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span>
</span><span id="line-1804"></span><span>                  </span><span class="annot"><a href="#local-6989586621682871716"><span class="hs-identifier hs-type">code_b'</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-type">`snocOL`</span></a></span><span>
</span><span id="line-1805"></span><span>                  </span><span class="hs-comment">-- the low 2w' of lo contains the full multiplication;</span><span>
</span><span id="line-1806"></span><span>                  </span><span class="hs-comment">-- eg: int8 * int8 -&gt; int16 result</span><span>
</span><span id="line-1807"></span><span>                  </span><span class="hs-comment">-- so lo is in the last w of the register, and hi is in the second w.</span><span>
</span><span id="line-1808"></span><span>                  </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#SMULL"><span class="hs-identifier hs-type">SMULL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871711"><span class="hs-identifier hs-type">w'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871708"><span class="hs-identifier hs-type">lo</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871711"><span class="hs-identifier hs-type">w'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871713"><span class="hs-identifier hs-type">reg_a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871711"><span class="hs-identifier hs-type">w'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871715"><span class="hs-identifier hs-type">reg_b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-type">`snocOL`</span></a></span><span>
</span><span id="line-1809"></span><span>                  </span><span class="hs-comment">-- Make sure we hold onto the sign bits for dst_needed</span><span>
</span><span id="line-1810"></span><span>                  </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#ASR"><span class="hs-identifier hs-type">ASR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871711"><span class="hs-identifier hs-type">w'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871709"><span class="hs-identifier hs-type">hi</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871711"><span class="hs-identifier hs-type">w'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871708"><span class="hs-identifier hs-type">lo</span></a></span><span class="hs-special">)</span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-type">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-type">ImmInt</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#widthInBits"><span class="hs-identifier hs-type">widthInBits</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871682"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span>
</span><span id="line-1811"></span><span>                  </span><span class="hs-comment">-- lo can now be truncated so we can get at it's top bit easily.</span><span>
</span><span id="line-1812"></span><span>                  </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#truncateReg"><span class="hs-identifier hs-type">truncateReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871711"><span class="hs-identifier hs-type">w'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871682"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871708"><span class="hs-identifier hs-type">lo</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-type">`snocOL`</span></a></span><span>
</span><span id="line-1813"></span><span>                  </span><span class="hs-comment">-- Note the use of CMN (compare negative), not CMP: we want to</span><span>
</span><span id="line-1814"></span><span>                  </span><span class="hs-comment">-- test if the top half is negative one and the top</span><span>
</span><span id="line-1815"></span><span>                  </span><span class="hs-comment">-- bit of the bottom half is positive one. eg:</span><span>
</span><span id="line-1816"></span><span>                  </span><span class="hs-comment">-- hi = 0b1111_1111  (actually 64 bits)</span><span>
</span><span id="line-1817"></span><span>                  </span><span class="hs-comment">-- lo = 0b1010_1111  (-81, so the result didn't need the top half)</span><span>
</span><span id="line-1818"></span><span>                  </span><span class="hs-comment">-- lo' = ASR(lo,7)   (second reg of SMN)</span><span>
</span><span id="line-1819"></span><span>                  </span><span class="hs-comment">--     = 0b0000_0001 (theeshift gives us 1 for negative,</span><span>
</span><span id="line-1820"></span><span>                  </span><span class="hs-comment">--                    and 0 for positive)</span><span>
</span><span id="line-1821"></span><span>                  </span><span class="hs-comment">-- hi == -lo'?</span><span>
</span><span id="line-1822"></span><span>                  </span><span class="hs-comment">-- 0b1111_1111 == 0b1111_1111 (yes, top half is just overflow)</span><span>
</span><span id="line-1823"></span><span>                  </span><span class="hs-comment">-- Another way to think of this is if hi + lo' == 0, which is what</span><span>
</span><span id="line-1824"></span><span>                  </span><span class="hs-comment">-- CMN really is under the hood.</span><span>
</span><span id="line-1825"></span><span>                  </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#CMN"><span class="hs-identifier hs-type">CMN</span></a></span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871711"><span class="hs-identifier hs-type">w'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871709"><span class="hs-identifier hs-type">hi</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpRegShift"><span class="hs-identifier hs-type">OpRegShift</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871711"><span class="hs-identifier hs-type">w'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871708"><span class="hs-identifier hs-type">lo</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#SLSR"><span class="hs-identifier hs-type">SLSR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Type.html#widthInBits"><span class="hs-identifier hs-type">widthInBits</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871682"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">-</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-type">`snocOL`</span></a></span><span>
</span><span id="line-1826"></span><span>                  </span><span class="hs-comment">-- Set dst_needed to 1 if hi and lo' were (negatively) equal</span><span>
</span><span id="line-1827"></span><span>                  </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#CSET"><span class="hs-identifier hs-type">CSET</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871711"><span class="hs-identifier hs-type">w'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871710"><span class="hs-identifier hs-type">nd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Cond.html#EQ"><span class="hs-identifier hs-type">EQ</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span>
</span><span id="line-1828"></span><span>                  </span><span class="hs-comment">-- Finally truncate hi to drop any extraneous sign bits.</span><span>
</span><span id="line-1829"></span><span>                  </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#truncateReg"><span class="hs-identifier hs-type">truncateReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871711"><span class="hs-identifier hs-type">w'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871682"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871709"><span class="hs-identifier hs-type">hi</span></a></span><span>
</span><span id="line-1830"></span><span>          </span><span class="hs-comment">-- Can't handle &gt; 64 bit operands</span><span>
</span><span id="line-1831"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CallishMachOp -&gt; NatM (OrdList Instr)
forall a b. Show a =&gt; a -&gt; b
</span><a href="#local-6989586621682871719"><span class="hs-identifier hs-var">unsupported</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_S_Mul2"><span class="hs-identifier hs-var">MO_S_Mul2</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871682"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1832"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Node.html#PrimTarget"><span class="hs-identifier hs-type">PrimTarget</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_U_Mul2"><span class="hs-identifier hs-type">MO_U_Mul2</span></a></span><span>  </span><span id="local-6989586621682871721"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871721"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1833"></span><span>          </span><span class="hs-comment">-- The unsigned case is much simpler than the signed, all we need to</span><span>
</span><span id="line-1834"></span><span>          </span><span class="hs-comment">-- do is the multiplication straight into the destination registers.</span><span>
</span><span id="line-1835"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871721"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span>
</span><span id="line-1836"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871722"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871722"><span class="hs-identifier hs-var">src_a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871723"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871723"><span class="hs-identifier hs-var">src_b</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682871587"><span class="hs-identifier hs-var">arg_regs</span></a></span><span>
</span><span id="line-1837"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871724"><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871724"><span class="hs-identifier hs-var">dst_hi</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871725"><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871725"><span class="hs-identifier hs-var">dst_lo</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmFormal]
</span><a href="#local-6989586621682871586"><span class="hs-identifier hs-var">dest_regs</span></a></span><span>
</span><span id="line-1838"></span><span>            </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-keyword">do</span><span>
</span><span id="line-1839"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682871726"><span class="annot"><a href="#local-6989586621682871726"><span class="hs-identifier hs-var">reg_a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871727"><span class="annot"><a href="#local-6989586621682871727"><span class="hs-identifier hs-var">_format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871728"><span class="annot"><a href="#local-6989586621682871728"><span class="hs-identifier hs-var">code_x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871722"><span class="hs-identifier hs-var">src_a</span></a></span><span>
</span><span id="line-1840"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682871729"><span class="annot"><a href="#local-6989586621682871729"><span class="hs-identifier hs-var">reg_b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871730"><span class="annot"><a href="#local-6989586621682871730"><span class="hs-identifier hs-var">_format_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871731"><span class="annot"><a href="#local-6989586621682871731"><span class="hs-identifier hs-var">code_y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-type">getSomeReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871723"><span class="hs-identifier hs-type">src_b</span></a></span><span>
</span><span id="line-1841"></span><span>
</span><span id="line-1842"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682871732"><span class="annot"><a href="#local-6989586621682871732"><span class="hs-identifier hs-var hs-var">lo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmReg -&gt; Reg
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682871588"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmFormal -&gt; CmmReg
</span><a href="GHC.Cmm.Reg.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a></span><span> </span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871725"><span class="hs-identifier hs-var">dst_lo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1843"></span><span>                  </span><span id="local-6989586621682871733"><span class="annot"><a href="#local-6989586621682871733"><span class="hs-identifier hs-var hs-var">hi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmReg -&gt; Reg
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682871588"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmFormal -&gt; CmmReg
</span><a href="GHC.Cmm.Reg.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a></span><span> </span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871724"><span class="hs-identifier hs-var">dst_hi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1844"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-1845"></span><span>                  </span><span class="annot"><a href="#local-6989586621682871728"><span class="hs-identifier hs-type">code_x</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span>
</span><span id="line-1846"></span><span>                  </span><span class="annot"><a href="#local-6989586621682871731"><span class="hs-identifier hs-type">code_y</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-type">`snocOL`</span></a></span><span>
</span><span id="line-1847"></span><span>                  </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#MUL"><span class="hs-identifier hs-type">MUL</span></a></span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-type">W64</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871732"><span class="hs-identifier hs-type">lo</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-type">W64</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871726"><span class="hs-identifier hs-type">reg_a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-type">W64</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871729"><span class="hs-identifier hs-type">reg_b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-type">`snocOL`</span></a></span><span>
</span><span id="line-1848"></span><span>                  </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#UMULH"><span class="hs-identifier hs-type">UMULH</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-type">W64</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871733"><span class="hs-identifier hs-type">hi</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-type">W64</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871726"><span class="hs-identifier hs-type">reg_a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-type">W64</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871729"><span class="hs-identifier hs-type">reg_b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1849"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-1850"></span><span>            </span><span class="hs-comment">-- For sizes &lt; platform width, we can just perform a multiply and shift</span><span>
</span><span id="line-1851"></span><span>            </span><span class="hs-comment">-- Need to be careful to truncate the low half, but the upper half should be</span><span>
</span><span id="line-1852"></span><span>            </span><span class="hs-comment">-- be ok if the invariant in [Signed arithmetic on AArch64] is maintained.</span><span>
</span><span id="line-1853"></span><span>            </span><span class="hs-comment">-- Currently this case can't be produced by the compiler since</span><span>
</span><span id="line-1854"></span><span>            </span><span class="hs-comment">-- timesWord2# :: Word# -&gt; Word# -&gt; (# Word#, Word# #)</span><span>
</span><span id="line-1855"></span><span>            </span><span class="hs-comment">-- TODO: Remove? Or would the extra primop be useful for avoiding the extra</span><span>
</span><span id="line-1856"></span><span>            </span><span class="hs-comment">-- steps needed to do this in userland?</span><span>
</span><span id="line-1857"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871721"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span>
</span><span id="line-1858"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871735"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871735"><span class="hs-identifier hs-var">src_a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871736"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871736"><span class="hs-identifier hs-var">src_b</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682871587"><span class="hs-identifier hs-var">arg_regs</span></a></span><span>
</span><span id="line-1859"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871737"><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871737"><span class="hs-identifier hs-var">dst_hi</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871738"><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871738"><span class="hs-identifier hs-var">dst_lo</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmFormal]
</span><a href="#local-6989586621682871586"><span class="hs-identifier hs-var">dest_regs</span></a></span><span>
</span><span id="line-1860"></span><span>            </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-keyword">do</span><span>
</span><span id="line-1861"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682871739"><span class="annot"><a href="#local-6989586621682871739"><span class="hs-identifier hs-var">reg_a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871740"><span class="annot"><a href="#local-6989586621682871740"><span class="hs-identifier hs-var">_format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871741"><span class="annot"><a href="#local-6989586621682871741"><span class="hs-identifier hs-var">code_x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871735"><span class="hs-identifier hs-var">src_a</span></a></span><span>
</span><span id="line-1862"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682871742"><span class="annot"><a href="#local-6989586621682871742"><span class="hs-identifier hs-var">reg_b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871743"><span class="annot"><a href="#local-6989586621682871743"><span class="hs-identifier hs-var">_format_y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871744"><span class="annot"><a href="#local-6989586621682871744"><span class="hs-identifier hs-var">code_y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-type">getSomeReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871736"><span class="hs-identifier hs-type">src_b</span></a></span><span>
</span><span id="line-1863"></span><span>
</span><span id="line-1864"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682871745"><span class="annot"><a href="#local-6989586621682871745"><span class="hs-identifier hs-var hs-var">lo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmReg -&gt; Reg
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682871588"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmFormal -&gt; CmmReg
</span><a href="GHC.Cmm.Reg.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a></span><span> </span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871738"><span class="hs-identifier hs-var">dst_lo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1865"></span><span>                  </span><span id="local-6989586621682871746"><span class="annot"><a href="#local-6989586621682871746"><span class="hs-identifier hs-var hs-var">hi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmReg -&gt; Reg
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682871588"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmFormal -&gt; CmmReg
</span><a href="GHC.Cmm.Reg.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a></span><span> </span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871737"><span class="hs-identifier hs-var">dst_hi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1866"></span><span>                  </span><span id="local-6989586621682871747"><span class="annot"><a href="#local-6989586621682871747"><span class="hs-identifier hs-var hs-var">w'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#opRegWidth"><span class="hs-identifier hs-var">opRegWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871721"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-1867"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-1868"></span><span>                  </span><span class="annot"><a href="#local-6989586621682871741"><span class="hs-identifier hs-type">code_x</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span>
</span><span id="line-1869"></span><span>                  </span><span class="annot"><a href="#local-6989586621682871744"><span class="hs-identifier hs-type">code_y</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-type">`snocOL`</span></a></span><span>
</span><span id="line-1870"></span><span>                  </span><span class="hs-comment">-- UMULL: Xd = Wa * Wb with 64 bit result</span><span>
</span><span id="line-1871"></span><span>                  </span><span class="hs-comment">-- W64 inputs should have been caught by case above</span><span>
</span><span id="line-1872"></span><span>                  </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#UMULL"><span class="hs-identifier hs-type">UMULL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-type">W64</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871745"><span class="hs-identifier hs-type">lo</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871747"><span class="hs-identifier hs-type">w'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871739"><span class="hs-identifier hs-type">reg_a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871747"><span class="hs-identifier hs-type">w'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871742"><span class="hs-identifier hs-type">reg_b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-type">`snocOL`</span></a></span><span>
</span><span id="line-1873"></span><span>                  </span><span class="hs-comment">-- Extract and truncate high result</span><span>
</span><span id="line-1874"></span><span>                  </span><span class="hs-comment">-- hi[w:0] = lo[2w:w]</span><span>
</span><span id="line-1875"></span><span>                  </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#UBFX"><span class="hs-identifier hs-type">UBFX</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-type">W64</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871746"><span class="hs-identifier hs-type">hi</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-type">W64</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871745"><span class="hs-identifier hs-type">lo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1876"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-type">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-type">ImmInt</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#widthInBits"><span class="hs-identifier hs-type">widthInBits</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871721"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- lsb</span><span>
</span><span id="line-1877"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-type">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-type">ImmInt</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#widthInBits"><span class="hs-identifier hs-type">widthInBits</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871721"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- width to extract</span><span>
</span><span id="line-1878"></span><span>                      </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span>
</span><span id="line-1879"></span><span>                  </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#truncateReg"><span class="hs-identifier hs-type">truncateReg</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-type">W64</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871721"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871745"><span class="hs-identifier hs-type">lo</span></a></span><span>
</span><span id="line-1880"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-1881"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CallishMachOp -&gt; NatM (OrdList Instr)
forall a b. Show a =&gt; a -&gt; b
</span><a href="#local-6989586621682871719"><span class="hs-identifier hs-var">unsupported</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_U_Mul2"><span class="hs-identifier hs-var">MO_U_Mul2</span></a></span><span>  </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871721"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1882"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Node.html#PrimTarget"><span class="hs-identifier hs-type">PrimTarget</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Clz"><span class="hs-identifier hs-type">MO_Clz</span></a></span><span>  </span><span id="local-6989586621682871750"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871750"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1883"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871750"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871750"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span>
</span><span id="line-1884"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871751"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871751"><span class="hs-identifier hs-var">src</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682871587"><span class="hs-identifier hs-var">arg_regs</span></a></span><span>
</span><span id="line-1885"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871752"><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871752"><span class="hs-identifier hs-var">dst</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmFormal]
</span><a href="#local-6989586621682871586"><span class="hs-identifier hs-var">dest_regs</span></a></span><span>
</span><span id="line-1886"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1887"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682871753"><span class="annot"><a href="#local-6989586621682871753"><span class="hs-identifier hs-var">reg_a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871754"><span class="annot"><a href="#local-6989586621682871754"><span class="hs-identifier hs-var">_format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871755"><span class="annot"><a href="#local-6989586621682871755"><span class="hs-identifier hs-var">code_x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871751"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-1888"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682871756"><span class="annot"><a href="#local-6989586621682871756"><span class="hs-identifier hs-var hs-var">dst_reg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmReg -&gt; Reg
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682871588"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmFormal -&gt; CmmReg
</span><a href="GHC.Cmm.Reg.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a></span><span> </span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871752"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1889"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-1890"></span><span>                  </span><span class="annot"><a href="#local-6989586621682871755"><span class="hs-identifier hs-type">code_x</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-type">`snocOL`</span></a></span><span>
</span><span id="line-1891"></span><span>                  </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#CLZ"><span class="hs-identifier hs-type">CLZ</span></a></span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871750"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871756"><span class="hs-identifier hs-type">dst_reg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871750"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871753"><span class="hs-identifier hs-type">reg_a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1892"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-1893"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871750"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W16"><span class="hs-identifier hs-var">W16</span></a></span><span>
</span><span id="line-1894"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871758"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871758"><span class="hs-identifier hs-var">src</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682871587"><span class="hs-identifier hs-var">arg_regs</span></a></span><span>
</span><span id="line-1895"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871759"><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871759"><span class="hs-identifier hs-var">dst</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmFormal]
</span><a href="#local-6989586621682871586"><span class="hs-identifier hs-var">dest_regs</span></a></span><span>
</span><span id="line-1896"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1897"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682871760"><span class="annot"><a href="#local-6989586621682871760"><span class="hs-identifier hs-var">reg_a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871761"><span class="annot"><a href="#local-6989586621682871761"><span class="hs-identifier hs-var">_format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871762"><span class="annot"><a href="#local-6989586621682871762"><span class="hs-identifier hs-var">code_x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871758"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-1898"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682871763"><span class="annot"><a href="#local-6989586621682871763"><span class="hs-identifier hs-var hs-var">dst'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmReg -&gt; Reg
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682871588"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmFormal -&gt; CmmReg
</span><a href="GHC.Cmm.Reg.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a></span><span> </span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871759"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1899"></span><span>                  </span><span id="local-6989586621682871764"><span class="annot"><a href="#local-6989586621682871764"><span class="hs-identifier hs-var hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682871765"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871765"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871765"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1900"></span><span>                  </span><span id="local-6989586621682871766"><span class="annot"><a href="#local-6989586621682871766"><span class="hs-identifier hs-var hs-var">imm</span></a></span></span><span> </span><span id="local-6989586621682871767"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871767"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871767"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1901"></span><span>              </span><span class="hs-comment">{- dst = clz(x &lt;&lt; 16 | 0x0000_8000) -}</span><span>
</span><span id="line-1902"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-1903"></span><span>                  </span><span class="annot"><a href="#local-6989586621682871762"><span class="hs-identifier hs-type">code_x</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-type">toOL</span></a></span><span>
</span><span id="line-1904"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#LSL"><span class="hs-identifier hs-type">LSL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871764"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871763"><span class="hs-identifier hs-type">dst'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871764"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871760"><span class="hs-identifier hs-type">reg_a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871766"><span class="hs-identifier hs-type">imm</span></a></span><span> </span><span class="annot"><span class="hs-number">16</span></span><span class="hs-special">)</span><span>
</span><span id="line-1905"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#ORR"><span class="hs-identifier hs-type">ORR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871764"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871763"><span class="hs-identifier hs-type">dst'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871764"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871763"><span class="hs-identifier hs-type">dst'</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871766"><span class="hs-identifier hs-type">imm</span></a></span><span> </span><span class="annot"><span class="hs-number">0x00008000</span></span><span class="hs-special">)</span><span>
</span><span id="line-1906"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#CLZ"><span class="hs-identifier hs-type">CLZ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871764"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871763"><span class="hs-identifier hs-type">dst'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871764"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871763"><span class="hs-identifier hs-type">dst'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1907"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-1908"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-1909"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871750"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W8"><span class="hs-identifier hs-var">W8</span></a></span><span>
</span><span id="line-1910"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871768"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871768"><span class="hs-identifier hs-var">src</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682871587"><span class="hs-identifier hs-var">arg_regs</span></a></span><span>
</span><span id="line-1911"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871769"><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871769"><span class="hs-identifier hs-var">dst</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmFormal]
</span><a href="#local-6989586621682871586"><span class="hs-identifier hs-var">dest_regs</span></a></span><span>
</span><span id="line-1912"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1913"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682871770"><span class="annot"><a href="#local-6989586621682871770"><span class="hs-identifier hs-var">reg_a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871771"><span class="annot"><a href="#local-6989586621682871771"><span class="hs-identifier hs-var">_format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871772"><span class="annot"><a href="#local-6989586621682871772"><span class="hs-identifier hs-var">code_x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871768"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-1914"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682871773"><span class="annot"><a href="#local-6989586621682871773"><span class="hs-identifier hs-var hs-var">dst'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmReg -&gt; Reg
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682871588"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmFormal -&gt; CmmReg
</span><a href="GHC.Cmm.Reg.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a></span><span> </span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871769"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1915"></span><span>                  </span><span id="local-6989586621682871774"><span class="annot"><a href="#local-6989586621682871774"><span class="hs-identifier hs-var hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682871775"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871775"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871775"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1916"></span><span>                  </span><span id="local-6989586621682871776"><span class="annot"><a href="#local-6989586621682871776"><span class="hs-identifier hs-var hs-var">imm</span></a></span></span><span> </span><span id="local-6989586621682871777"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871777"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871777"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1917"></span><span>              </span><span class="hs-comment">{- dst = clz(x &lt;&lt; 24 | 0x0080_0000) -}</span><span>
</span><span id="line-1918"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1919"></span><span>                  </span><span class="annot"><a href="#local-6989586621682871772"><span class="hs-identifier hs-type">code_x</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-type">toOL</span></a></span><span>
</span><span id="line-1920"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#LSL"><span class="hs-identifier hs-type">LSL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871774"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871773"><span class="hs-identifier hs-type">dst'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871774"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871770"><span class="hs-identifier hs-type">reg_a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871776"><span class="hs-identifier hs-type">imm</span></a></span><span> </span><span class="annot"><span class="hs-number">24</span></span><span class="hs-special">)</span><span>
</span><span id="line-1921"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#ORR"><span class="hs-identifier hs-type">ORR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871774"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871773"><span class="hs-identifier hs-type">dst'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871774"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871773"><span class="hs-identifier hs-type">dst'</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871776"><span class="hs-identifier hs-type">imm</span></a></span><span> </span><span class="annot"><span class="hs-number">0x00800000</span></span><span class="hs-special">)</span><span>
</span><span id="line-1922"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#CLZ"><span class="hs-identifier hs-type">CLZ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871774"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871773"><span class="hs-identifier hs-type">dst'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871774"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871773"><span class="hs-identifier hs-type">dst'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1923"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-1924"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CallishMachOp -&gt; NatM (OrdList Instr)
forall a b. Show a =&gt; a -&gt; b
</span><a href="#local-6989586621682871719"><span class="hs-identifier hs-var">unsupported</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_Clz"><span class="hs-identifier hs-var">MO_Clz</span></a></span><span>  </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871750"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1925"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Node.html#PrimTarget"><span class="hs-identifier hs-type">PrimTarget</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Ctz"><span class="hs-identifier hs-type">MO_Ctz</span></a></span><span>  </span><span id="local-6989586621682871779"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871779"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1926"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871779"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871779"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span>
</span><span id="line-1927"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871780"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871780"><span class="hs-identifier hs-var">src</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682871587"><span class="hs-identifier hs-var">arg_regs</span></a></span><span>
</span><span id="line-1928"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871781"><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871781"><span class="hs-identifier hs-var">dst</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmFormal]
</span><a href="#local-6989586621682871586"><span class="hs-identifier hs-var">dest_regs</span></a></span><span>
</span><span id="line-1929"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1930"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682871782"><span class="annot"><a href="#local-6989586621682871782"><span class="hs-identifier hs-var">reg_a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871783"><span class="annot"><a href="#local-6989586621682871783"><span class="hs-identifier hs-var">_format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871784"><span class="annot"><a href="#local-6989586621682871784"><span class="hs-identifier hs-var">code_x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871780"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-1931"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682871785"><span class="annot"><a href="#local-6989586621682871785"><span class="hs-identifier hs-var hs-var">dst_reg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmReg -&gt; Reg
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682871588"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmFormal -&gt; CmmReg
</span><a href="GHC.Cmm.Reg.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a></span><span> </span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871781"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1932"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1933"></span><span>                  </span><span class="annot"><a href="#local-6989586621682871784"><span class="hs-identifier hs-type">code_x</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-type">`snocOL`</span></a></span><span>
</span><span id="line-1934"></span><span>                  </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#RBIT"><span class="hs-identifier hs-type">RBIT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871779"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871785"><span class="hs-identifier hs-type">dst_reg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871779"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871782"><span class="hs-identifier hs-type">reg_a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-type">`snocOL`</span></a></span><span>
</span><span id="line-1935"></span><span>                  </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#CLZ"><span class="hs-identifier hs-type">CLZ</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871779"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871785"><span class="hs-identifier hs-type">dst_reg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871779"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871785"><span class="hs-identifier hs-type">dst_reg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1936"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871779"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W16"><span class="hs-identifier hs-var">W16</span></a></span><span>
</span><span id="line-1937"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871787"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871787"><span class="hs-identifier hs-var">src</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682871587"><span class="hs-identifier hs-var">arg_regs</span></a></span><span>
</span><span id="line-1938"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871788"><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871788"><span class="hs-identifier hs-var">dst</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmFormal]
</span><a href="#local-6989586621682871586"><span class="hs-identifier hs-var">dest_regs</span></a></span><span>
</span><span id="line-1939"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1940"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682871789"><span class="annot"><a href="#local-6989586621682871789"><span class="hs-identifier hs-var">reg_a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871790"><span class="annot"><a href="#local-6989586621682871790"><span class="hs-identifier hs-var">_format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871791"><span class="annot"><a href="#local-6989586621682871791"><span class="hs-identifier hs-var">code_x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871787"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-1941"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682871792"><span class="annot"><a href="#local-6989586621682871792"><span class="hs-identifier hs-var hs-var">dst'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmReg -&gt; Reg
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682871588"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmFormal -&gt; CmmReg
</span><a href="GHC.Cmm.Reg.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a></span><span> </span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871788"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1942"></span><span>                  </span><span id="local-6989586621682871793"><span class="annot"><a href="#local-6989586621682871793"><span class="hs-identifier hs-var hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682871794"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871794"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871794"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1943"></span><span>                  </span><span id="local-6989586621682871795"><span class="annot"><a href="#local-6989586621682871795"><span class="hs-identifier hs-var hs-var">imm</span></a></span></span><span> </span><span id="local-6989586621682871796"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871796"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871796"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1944"></span><span>              </span><span class="hs-comment">{- dst = clz(reverseBits(x) | 0x0000_8000) -}</span><span>
</span><span id="line-1945"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1946"></span><span>                  </span><span class="annot"><a href="#local-6989586621682871791"><span class="hs-identifier hs-type">code_x</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-type">toOL</span></a></span><span>
</span><span id="line-1947"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#RBIT"><span class="hs-identifier hs-type">RBIT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871793"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871792"><span class="hs-identifier hs-type">dst'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871793"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871789"><span class="hs-identifier hs-type">reg_a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1948"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#ORR"><span class="hs-identifier hs-type">ORR</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871793"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871792"><span class="hs-identifier hs-type">dst'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871793"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871792"><span class="hs-identifier hs-type">dst'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871795"><span class="hs-identifier hs-type">imm</span></a></span><span> </span><span class="annot"><span class="hs-number">0x00008000</span></span><span class="hs-special">)</span><span>
</span><span id="line-1949"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#CLZ"><span class="hs-identifier hs-type">CLZ</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871793"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871792"><span class="hs-identifier hs-type">dst'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871793"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871792"><span class="hs-identifier hs-type">dst'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1950"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-1951"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871779"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W8"><span class="hs-identifier hs-var">W8</span></a></span><span>
</span><span id="line-1952"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871797"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871797"><span class="hs-identifier hs-var">src</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682871587"><span class="hs-identifier hs-var">arg_regs</span></a></span><span>
</span><span id="line-1953"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871798"><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871798"><span class="hs-identifier hs-var">dst</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmFormal]
</span><a href="#local-6989586621682871586"><span class="hs-identifier hs-var">dest_regs</span></a></span><span>
</span><span id="line-1954"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1955"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682871799"><span class="annot"><a href="#local-6989586621682871799"><span class="hs-identifier hs-var">reg_a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871800"><span class="annot"><a href="#local-6989586621682871800"><span class="hs-identifier hs-var">_format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871801"><span class="annot"><a href="#local-6989586621682871801"><span class="hs-identifier hs-var">code_x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871797"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-1956"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682871802"><span class="annot"><a href="#local-6989586621682871802"><span class="hs-identifier hs-var hs-var">dst'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmReg -&gt; Reg
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682871588"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmFormal -&gt; CmmReg
</span><a href="GHC.Cmm.Reg.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a></span><span> </span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871798"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1957"></span><span>                  </span><span id="local-6989586621682871803"><span class="annot"><a href="#local-6989586621682871803"><span class="hs-identifier hs-var hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682871804"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871804"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871804"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1958"></span><span>                  </span><span id="local-6989586621682871805"><span class="annot"><a href="#local-6989586621682871805"><span class="hs-identifier hs-var hs-var">imm</span></a></span></span><span> </span><span id="local-6989586621682871806"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871806"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871806"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1959"></span><span>              </span><span class="hs-comment">{- dst = clz(reverseBits(x) | 0x0080_0000) -}</span><span>
</span><span id="line-1960"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1961"></span><span>                  </span><span class="annot"><a href="#local-6989586621682871801"><span class="hs-identifier hs-type">code_x</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-type">toOL</span></a></span><span>
</span><span id="line-1962"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#RBIT"><span class="hs-identifier hs-type">RBIT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871803"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871802"><span class="hs-identifier hs-type">dst'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871803"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871799"><span class="hs-identifier hs-type">reg_a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1963"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#ORR"><span class="hs-identifier hs-type">ORR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871803"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871802"><span class="hs-identifier hs-type">dst'</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871803"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871802"><span class="hs-identifier hs-type">dst'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871805"><span class="hs-identifier hs-type">imm</span></a></span><span> </span><span class="annot"><span class="hs-number">0x00800000</span></span><span class="hs-special">)</span><span>
</span><span id="line-1964"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#CLZ"><span class="hs-identifier hs-type">CLZ</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871803"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871802"><span class="hs-identifier hs-type">dst'</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871803"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871802"><span class="hs-identifier hs-type">dst'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1965"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-1966"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CallishMachOp -&gt; NatM (OrdList Instr)
forall a b. Show a =&gt; a -&gt; b
</span><a href="#local-6989586621682871719"><span class="hs-identifier hs-var">unsupported</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_Ctz"><span class="hs-identifier hs-var">MO_Ctz</span></a></span><span>  </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871779"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1967"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Node.html#PrimTarget"><span class="hs-identifier hs-type">PrimTarget</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_BRev"><span class="hs-identifier hs-type">MO_BRev</span></a></span><span>  </span><span id="local-6989586621682871808"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871808"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1968"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871808"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871808"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span>
</span><span id="line-1969"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871809"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871809"><span class="hs-identifier hs-var">src</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682871587"><span class="hs-identifier hs-var">arg_regs</span></a></span><span>
</span><span id="line-1970"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871810"><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871810"><span class="hs-identifier hs-var">dst</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmFormal]
</span><a href="#local-6989586621682871586"><span class="hs-identifier hs-var">dest_regs</span></a></span><span>
</span><span id="line-1971"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1972"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682871811"><span class="annot"><a href="#local-6989586621682871811"><span class="hs-identifier hs-var">reg_a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871812"><span class="annot"><a href="#local-6989586621682871812"><span class="hs-identifier hs-var">_format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871813"><span class="annot"><a href="#local-6989586621682871813"><span class="hs-identifier hs-var">code_x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871809"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-1973"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682871814"><span class="annot"><a href="#local-6989586621682871814"><span class="hs-identifier hs-var hs-var">dst_reg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmReg -&gt; Reg
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682871588"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmFormal -&gt; CmmReg
</span><a href="GHC.Cmm.Reg.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a></span><span> </span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871810"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1974"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1975"></span><span>                  </span><span class="annot"><a href="#local-6989586621682871813"><span class="hs-identifier hs-type">code_x</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-type">`snocOL`</span></a></span><span>
</span><span id="line-1976"></span><span>                  </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#RBIT"><span class="hs-identifier hs-type">RBIT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871808"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871814"><span class="hs-identifier hs-type">dst_reg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871808"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871811"><span class="hs-identifier hs-type">reg_a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1977"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871808"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W16"><span class="hs-identifier hs-var">W16</span></a></span><span>
</span><span id="line-1978"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871815"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871815"><span class="hs-identifier hs-var">src</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682871587"><span class="hs-identifier hs-var">arg_regs</span></a></span><span>
</span><span id="line-1979"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871816"><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871816"><span class="hs-identifier hs-var">dst</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmFormal]
</span><a href="#local-6989586621682871586"><span class="hs-identifier hs-var">dest_regs</span></a></span><span>
</span><span id="line-1980"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1981"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682871817"><span class="annot"><a href="#local-6989586621682871817"><span class="hs-identifier hs-var">reg_a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871818"><span class="annot"><a href="#local-6989586621682871818"><span class="hs-identifier hs-var">_format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871819"><span class="annot"><a href="#local-6989586621682871819"><span class="hs-identifier hs-var">code_x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871815"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-1982"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682871820"><span class="annot"><a href="#local-6989586621682871820"><span class="hs-identifier hs-var hs-var">dst'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmReg -&gt; Reg
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682871588"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmFormal -&gt; CmmReg
</span><a href="GHC.Cmm.Reg.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a></span><span> </span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871816"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1983"></span><span>                  </span><span id="local-6989586621682871821"><span class="annot"><a href="#local-6989586621682871821"><span class="hs-identifier hs-var hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682871822"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871822"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871822"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1984"></span><span>                  </span><span id="local-6989586621682871823"><span class="annot"><a href="#local-6989586621682871823"><span class="hs-identifier hs-var hs-var">imm</span></a></span></span><span> </span><span id="local-6989586621682871824"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871824"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871824"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1985"></span><span>              </span><span class="hs-comment">{- dst = reverseBits32(x &lt;&lt; 16) -}</span><span>
</span><span id="line-1986"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1987"></span><span>                  </span><span class="annot"><a href="#local-6989586621682871819"><span class="hs-identifier hs-type">code_x</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-type">toOL</span></a></span><span>
</span><span id="line-1988"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#LSL"><span class="hs-identifier hs-type">LSL</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871821"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871820"><span class="hs-identifier hs-type">dst'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871821"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871817"><span class="hs-identifier hs-type">reg_a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871823"><span class="hs-identifier hs-type">imm</span></a></span><span> </span><span class="annot"><span class="hs-number">16</span></span><span class="hs-special">)</span><span>
</span><span id="line-1989"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#RBIT"><span class="hs-identifier hs-type">RBIT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871821"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871820"><span class="hs-identifier hs-type">dst'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871821"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871820"><span class="hs-identifier hs-type">dst'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1990"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-1991"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871808"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W8"><span class="hs-identifier hs-var">W8</span></a></span><span>
</span><span id="line-1992"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871825"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871825"><span class="hs-identifier hs-var">src</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682871587"><span class="hs-identifier hs-var">arg_regs</span></a></span><span>
</span><span id="line-1993"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871826"><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871826"><span class="hs-identifier hs-var">dst</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmFormal]
</span><a href="#local-6989586621682871586"><span class="hs-identifier hs-var">dest_regs</span></a></span><span>
</span><span id="line-1994"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1995"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682871827"><span class="annot"><a href="#local-6989586621682871827"><span class="hs-identifier hs-var">reg_a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871828"><span class="annot"><a href="#local-6989586621682871828"><span class="hs-identifier hs-var">_format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871829"><span class="annot"><a href="#local-6989586621682871829"><span class="hs-identifier hs-var">code_x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871825"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-1996"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682871830"><span class="annot"><a href="#local-6989586621682871830"><span class="hs-identifier hs-var hs-var">dst'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmReg -&gt; Reg
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682871588"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmFormal -&gt; CmmReg
</span><a href="GHC.Cmm.Reg.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a></span><span> </span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871826"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1997"></span><span>                  </span><span id="local-6989586621682871831"><span class="annot"><a href="#local-6989586621682871831"><span class="hs-identifier hs-var hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682871832"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871832"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871832"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1998"></span><span>                  </span><span id="local-6989586621682871833"><span class="annot"><a href="#local-6989586621682871833"><span class="hs-identifier hs-var hs-var">imm</span></a></span></span><span> </span><span id="local-6989586621682871834"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871834"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Imm -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871834"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1999"></span><span>              </span><span class="hs-comment">{- dst = reverseBits32(x &lt;&lt; 24) -}</span><span>
</span><span id="line-2000"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2001"></span><span>                  </span><span class="annot"><a href="#local-6989586621682871829"><span class="hs-identifier hs-type">code_x</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-type">toOL</span></a></span><span>
</span><span id="line-2002"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#LSL"><span class="hs-identifier hs-type">LSL</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871831"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871830"><span class="hs-identifier hs-type">dst'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871831"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871827"><span class="hs-identifier hs-type">reg_a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871833"><span class="hs-identifier hs-type">imm</span></a></span><span> </span><span class="annot"><span class="hs-number">24</span></span><span class="hs-special">)</span><span>
</span><span id="line-2003"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#RBIT"><span class="hs-identifier hs-type">RBIT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871831"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871830"><span class="hs-identifier hs-type">dst'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871831"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871830"><span class="hs-identifier hs-type">dst'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2004"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-2005"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CallishMachOp -&gt; NatM (OrdList Instr)
forall a b. Show a =&gt; a -&gt; b
</span><a href="#local-6989586621682871719"><span class="hs-identifier hs-var">unsupported</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_BRev"><span class="hs-identifier hs-var">MO_BRev</span></a></span><span>  </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871808"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2006"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Node.html#PrimTarget"><span class="hs-identifier hs-type">PrimTarget</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_BSwap"><span class="hs-identifier hs-type">MO_BSwap</span></a></span><span>  </span><span id="local-6989586621682871836"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871836"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2007"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871836"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871836"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span>
</span><span id="line-2008"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871837"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871837"><span class="hs-identifier hs-var">src</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682871587"><span class="hs-identifier hs-var">arg_regs</span></a></span><span>
</span><span id="line-2009"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871838"><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871838"><span class="hs-identifier hs-var">dst</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmFormal]
</span><a href="#local-6989586621682871586"><span class="hs-identifier hs-var">dest_regs</span></a></span><span>
</span><span id="line-2010"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2011"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682871839"><span class="annot"><a href="#local-6989586621682871839"><span class="hs-identifier hs-var">reg_a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871840"><span class="annot"><a href="#local-6989586621682871840"><span class="hs-identifier hs-var">_format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871841"><span class="annot"><a href="#local-6989586621682871841"><span class="hs-identifier hs-var">code_x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871837"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-2012"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682871842"><span class="annot"><a href="#local-6989586621682871842"><span class="hs-identifier hs-var hs-var">dst_reg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmReg -&gt; Reg
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682871588"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmFormal -&gt; CmmReg
</span><a href="GHC.Cmm.Reg.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a></span><span> </span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871838"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2013"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682871841"><span class="hs-identifier hs-type">code_x</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-type">`snocOL`</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#REV"><span class="hs-identifier hs-type">REV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871836"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871842"><span class="hs-identifier hs-type">dst_reg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871836"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871839"><span class="hs-identifier hs-type">reg_a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2014"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871836"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W16"><span class="hs-identifier hs-var">W16</span></a></span><span>
</span><span id="line-2015"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871844"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871844"><span class="hs-identifier hs-var">src</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682871587"><span class="hs-identifier hs-var">arg_regs</span></a></span><span>
</span><span id="line-2016"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871845"><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871845"><span class="hs-identifier hs-var">dst</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmFormal]
</span><a href="#local-6989586621682871586"><span class="hs-identifier hs-var">dest_regs</span></a></span><span>
</span><span id="line-2017"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2018"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682871846"><span class="annot"><a href="#local-6989586621682871846"><span class="hs-identifier hs-var">reg_a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871847"><span class="annot"><a href="#local-6989586621682871847"><span class="hs-identifier hs-var">_format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871848"><span class="annot"><a href="#local-6989586621682871848"><span class="hs-identifier hs-var">code_x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871844"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-2019"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682871849"><span class="annot"><a href="#local-6989586621682871849"><span class="hs-identifier hs-var hs-var">dst'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmReg -&gt; Reg
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682871588"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmFormal -&gt; CmmReg
</span><a href="GHC.Cmm.Reg.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a></span><span> </span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871845"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2020"></span><span>                  </span><span id="local-6989586621682871850"><span class="annot"><a href="#local-6989586621682871850"><span class="hs-identifier hs-var hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682871851"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871851"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871851"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-2021"></span><span>              </span><span class="hs-comment">-- Swaps the bytes in each 16bit word</span><span>
</span><span id="line-2022"></span><span>              </span><span class="hs-comment">-- TODO: Expose the 32 &amp; 64 bit version of this?</span><span>
</span><span id="line-2023"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682871848"><span class="hs-identifier hs-type">code_x</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-type">`snocOL`</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#REV16"><span class="hs-identifier hs-type">REV16</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871850"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871849"><span class="hs-identifier hs-type">dst'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682871850"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871846"><span class="hs-identifier hs-type">reg_a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2024"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CallishMachOp -&gt; NatM (OrdList Instr)
forall a b. Show a =&gt; a -&gt; b
</span><a href="#local-6989586621682871719"><span class="hs-identifier hs-var">unsupported</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_BSwap"><span class="hs-identifier hs-var">MO_BSwap</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871836"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2025"></span><span>
</span><span id="line-2026"></span><span>    </span><span class="hs-comment">-- or a possibly side-effecting machine operation</span><span>
</span><span id="line-2027"></span><span>    </span><span class="hs-comment">-- mop :: CallishMachOp (see GHC.Cmm.MachOp)</span><span>
</span><span id="line-2028"></span><span>    </span><span class="annot"><a href="GHC.Cmm.Node.html#PrimTarget"><span class="hs-identifier hs-type">PrimTarget</span></a></span><span> </span><span id="local-6989586621682871853"><span class="annot"><span class="annottext">CallishMachOp
</span><a href="#local-6989586621682871853"><span class="hs-identifier hs-var">mop</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2029"></span><span>      </span><span class="hs-comment">-- We'll need config to construct forien targets</span><span>
</span><span id="line-2030"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="#local-6989586621682871853"><span class="hs-identifier hs-var">mop</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2031"></span><span>        </span><span class="hs-comment">-- 64 bit float ops</span><span>
</span><span id="line-2032"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F64_Pwr"><span class="hs-identifier hs-var">MO_F64_Pwr</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;pow&quot;</span></span><span>
</span><span id="line-2033"></span><span>
</span><span id="line-2034"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F64_Sin"><span class="hs-identifier hs-var">MO_F64_Sin</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;sin&quot;</span></span><span>
</span><span id="line-2035"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F64_Cos"><span class="hs-identifier hs-var">MO_F64_Cos</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;cos&quot;</span></span><span>
</span><span id="line-2036"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F64_Tan"><span class="hs-identifier hs-var">MO_F64_Tan</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;tan&quot;</span></span><span>
</span><span id="line-2037"></span><span>
</span><span id="line-2038"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F64_Sinh"><span class="hs-identifier hs-var">MO_F64_Sinh</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;sinh&quot;</span></span><span>
</span><span id="line-2039"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F64_Cosh"><span class="hs-identifier hs-var">MO_F64_Cosh</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;cosh&quot;</span></span><span>
</span><span id="line-2040"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F64_Tanh"><span class="hs-identifier hs-var">MO_F64_Tanh</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;tanh&quot;</span></span><span>
</span><span id="line-2041"></span><span>
</span><span id="line-2042"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F64_Asin"><span class="hs-identifier hs-var">MO_F64_Asin</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;asin&quot;</span></span><span>
</span><span id="line-2043"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F64_Acos"><span class="hs-identifier hs-var">MO_F64_Acos</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;acos&quot;</span></span><span>
</span><span id="line-2044"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F64_Atan"><span class="hs-identifier hs-var">MO_F64_Atan</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;atan&quot;</span></span><span>
</span><span id="line-2045"></span><span>
</span><span id="line-2046"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F64_Asinh"><span class="hs-identifier hs-var">MO_F64_Asinh</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;asinh&quot;</span></span><span>
</span><span id="line-2047"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F64_Acosh"><span class="hs-identifier hs-var">MO_F64_Acosh</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;acosh&quot;</span></span><span>
</span><span id="line-2048"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F64_Atanh"><span class="hs-identifier hs-var">MO_F64_Atanh</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;atanh&quot;</span></span><span>
</span><span id="line-2049"></span><span>
</span><span id="line-2050"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F64_Log"><span class="hs-identifier hs-var">MO_F64_Log</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;log&quot;</span></span><span>
</span><span id="line-2051"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F64_Log1P"><span class="hs-identifier hs-var">MO_F64_Log1P</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;log1p&quot;</span></span><span>
</span><span id="line-2052"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F64_Exp"><span class="hs-identifier hs-var">MO_F64_Exp</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;exp&quot;</span></span><span>
</span><span id="line-2053"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F64_ExpM1"><span class="hs-identifier hs-var">MO_F64_ExpM1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;expm1&quot;</span></span><span>
</span><span id="line-2054"></span><span>
</span><span id="line-2055"></span><span>        </span><span class="hs-comment">-- 32 bit float ops</span><span>
</span><span id="line-2056"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F32_Pwr"><span class="hs-identifier hs-var">MO_F32_Pwr</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;powf&quot;</span></span><span>
</span><span id="line-2057"></span><span>
</span><span id="line-2058"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F32_Sin"><span class="hs-identifier hs-var">MO_F32_Sin</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;sinf&quot;</span></span><span>
</span><span id="line-2059"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F32_Cos"><span class="hs-identifier hs-var">MO_F32_Cos</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;cosf&quot;</span></span><span>
</span><span id="line-2060"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F32_Tan"><span class="hs-identifier hs-var">MO_F32_Tan</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;tanf&quot;</span></span><span>
</span><span id="line-2061"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F32_Sinh"><span class="hs-identifier hs-var">MO_F32_Sinh</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;sinhf&quot;</span></span><span>
</span><span id="line-2062"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F32_Cosh"><span class="hs-identifier hs-var">MO_F32_Cosh</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;coshf&quot;</span></span><span>
</span><span id="line-2063"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F32_Tanh"><span class="hs-identifier hs-var">MO_F32_Tanh</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;tanhf&quot;</span></span><span>
</span><span id="line-2064"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F32_Asin"><span class="hs-identifier hs-var">MO_F32_Asin</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;asinf&quot;</span></span><span>
</span><span id="line-2065"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F32_Acos"><span class="hs-identifier hs-var">MO_F32_Acos</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;acosf&quot;</span></span><span>
</span><span id="line-2066"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F32_Atan"><span class="hs-identifier hs-var">MO_F32_Atan</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;atanf&quot;</span></span><span>
</span><span id="line-2067"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F32_Asinh"><span class="hs-identifier hs-var">MO_F32_Asinh</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;asinhf&quot;</span></span><span>
</span><span id="line-2068"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F32_Acosh"><span class="hs-identifier hs-var">MO_F32_Acosh</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;acoshf&quot;</span></span><span>
</span><span id="line-2069"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F32_Atanh"><span class="hs-identifier hs-var">MO_F32_Atanh</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;atanhf&quot;</span></span><span>
</span><span id="line-2070"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F32_Log"><span class="hs-identifier hs-var">MO_F32_Log</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;logf&quot;</span></span><span>
</span><span id="line-2071"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F32_Log1P"><span class="hs-identifier hs-var">MO_F32_Log1P</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;log1pf&quot;</span></span><span>
</span><span id="line-2072"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F32_Exp"><span class="hs-identifier hs-var">MO_F32_Exp</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;expf&quot;</span></span><span>
</span><span id="line-2073"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_F32_ExpM1"><span class="hs-identifier hs-var">MO_F32_ExpM1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;expm1f&quot;</span></span><span>
</span><span id="line-2074"></span><span>
</span><span id="line-2075"></span><span>        </span><span class="hs-comment">-- 64-bit primops</span><span>
</span><span id="line-2076"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_I64_ToI"><span class="hs-identifier hs-var">MO_I64_ToI</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;hs_int64ToInt&quot;</span></span><span>
</span><span id="line-2077"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_I64_FromI"><span class="hs-identifier hs-var">MO_I64_FromI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;hs_intToInt64&quot;</span></span><span>
</span><span id="line-2078"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_W64_ToW"><span class="hs-identifier hs-var">MO_W64_ToW</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;hs_word64ToWord&quot;</span></span><span>
</span><span id="line-2079"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_W64_FromW"><span class="hs-identifier hs-var">MO_W64_FromW</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;hs_wordToWord64&quot;</span></span><span>
</span><span id="line-2080"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_x64_Neg"><span class="hs-identifier hs-var">MO_x64_Neg</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;hs_neg64&quot;</span></span><span>
</span><span id="line-2081"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_x64_Add"><span class="hs-identifier hs-var">MO_x64_Add</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;hs_add64&quot;</span></span><span>
</span><span id="line-2082"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_x64_Sub"><span class="hs-identifier hs-var">MO_x64_Sub</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;hs_sub64&quot;</span></span><span>
</span><span id="line-2083"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_x64_Mul"><span class="hs-identifier hs-var">MO_x64_Mul</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;hs_mul64&quot;</span></span><span>
</span><span id="line-2084"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_I64_Quot"><span class="hs-identifier hs-var">MO_I64_Quot</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;hs_quotInt64&quot;</span></span><span>
</span><span id="line-2085"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_I64_Rem"><span class="hs-identifier hs-var">MO_I64_Rem</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;hs_remInt64&quot;</span></span><span>
</span><span id="line-2086"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_W64_Quot"><span class="hs-identifier hs-var">MO_W64_Quot</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;hs_quotWord64&quot;</span></span><span>
</span><span id="line-2087"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_W64_Rem"><span class="hs-identifier hs-var">MO_W64_Rem</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;hs_remWord64&quot;</span></span><span>
</span><span id="line-2088"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_x64_And"><span class="hs-identifier hs-var">MO_x64_And</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;hs_and64&quot;</span></span><span>
</span><span id="line-2089"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_x64_Or"><span class="hs-identifier hs-var">MO_x64_Or</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;hs_or64&quot;</span></span><span>
</span><span id="line-2090"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_x64_Xor"><span class="hs-identifier hs-var">MO_x64_Xor</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;hs_xor64&quot;</span></span><span>
</span><span id="line-2091"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_x64_Not"><span class="hs-identifier hs-var">MO_x64_Not</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;hs_not64&quot;</span></span><span>
</span><span id="line-2092"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_x64_Shl"><span class="hs-identifier hs-var">MO_x64_Shl</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;hs_uncheckedShiftL64&quot;</span></span><span>
</span><span id="line-2093"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_I64_Shr"><span class="hs-identifier hs-var">MO_I64_Shr</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;hs_uncheckedIShiftRA64&quot;</span></span><span>
</span><span id="line-2094"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_W64_Shr"><span class="hs-identifier hs-var">MO_W64_Shr</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;hs_uncheckedShiftRL64&quot;</span></span><span>
</span><span id="line-2095"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_x64_Eq"><span class="hs-identifier hs-var">MO_x64_Eq</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;hs_eq64&quot;</span></span><span>
</span><span id="line-2096"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_x64_Ne"><span class="hs-identifier hs-var">MO_x64_Ne</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;hs_ne64&quot;</span></span><span>
</span><span id="line-2097"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_I64_Ge"><span class="hs-identifier hs-var">MO_I64_Ge</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;hs_geInt64&quot;</span></span><span>
</span><span id="line-2098"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_I64_Gt"><span class="hs-identifier hs-var">MO_I64_Gt</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;hs_gtInt64&quot;</span></span><span>
</span><span id="line-2099"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_I64_Le"><span class="hs-identifier hs-var">MO_I64_Le</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;hs_leInt64&quot;</span></span><span>
</span><span id="line-2100"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_I64_Lt"><span class="hs-identifier hs-var">MO_I64_Lt</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;hs_ltInt64&quot;</span></span><span>
</span><span id="line-2101"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_W64_Ge"><span class="hs-identifier hs-var">MO_W64_Ge</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;hs_geWord64&quot;</span></span><span>
</span><span id="line-2102"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_W64_Gt"><span class="hs-identifier hs-var">MO_W64_Gt</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;hs_gtWord64&quot;</span></span><span>
</span><span id="line-2103"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_W64_Le"><span class="hs-identifier hs-var">MO_W64_Le</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;hs_leWord64&quot;</span></span><span>
</span><span id="line-2104"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_W64_Lt"><span class="hs-identifier hs-var">MO_W64_Lt</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;hs_ltWord64&quot;</span></span><span>
</span><span id="line-2105"></span><span>
</span><span id="line-2106"></span><span>        </span><span class="hs-comment">-- Conversion</span><span>
</span><span id="line-2107"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_UF_Conv"><span class="hs-identifier hs-type">MO_UF_Conv</span></a></span><span> </span><span id="local-6989586621682871919"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871919"><span class="hs-identifier hs-var">w</span></a></span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; FastString
</span><a href="GHC.CmmToAsm.CPrim.html#word2FloatLabel"><span class="hs-identifier hs-var">word2FloatLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871919"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2108"></span><span>
</span><span id="line-2109"></span><span>        </span><span class="hs-comment">-- Arithmatic</span><span>
</span><span id="line-2110"></span><span>        </span><span class="hs-comment">-- These are not supported on X86, so I doubt they are used much.</span><span>
</span><span id="line-2111"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_S_QuotRem"><span class="hs-identifier hs-type">MO_S_QuotRem</span></a></span><span>  </span><span id="local-6989586621682871922"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871922"><span class="hs-identifier hs-var">_w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CallishMachOp -&gt; NatM (OrdList Instr)
forall a b. Show a =&gt; a -&gt; b
</span><a href="#local-6989586621682871719"><span class="hs-identifier hs-var">unsupported</span></a></span><span> </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="#local-6989586621682871853"><span class="hs-identifier hs-var">mop</span></a></span><span>
</span><span id="line-2112"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_U_QuotRem"><span class="hs-identifier hs-type">MO_U_QuotRem</span></a></span><span>  </span><span id="local-6989586621682871924"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871924"><span class="hs-identifier hs-var">_w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CallishMachOp -&gt; NatM (OrdList Instr)
forall a b. Show a =&gt; a -&gt; b
</span><a href="#local-6989586621682871719"><span class="hs-identifier hs-var">unsupported</span></a></span><span> </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="#local-6989586621682871853"><span class="hs-identifier hs-var">mop</span></a></span><span>
</span><span id="line-2113"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_U_QuotRem2"><span class="hs-identifier hs-type">MO_U_QuotRem2</span></a></span><span> </span><span id="local-6989586621682871926"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871926"><span class="hs-identifier hs-var">_w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CallishMachOp -&gt; NatM (OrdList Instr)
forall a b. Show a =&gt; a -&gt; b
</span><a href="#local-6989586621682871719"><span class="hs-identifier hs-var">unsupported</span></a></span><span> </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="#local-6989586621682871853"><span class="hs-identifier hs-var">mop</span></a></span><span>
</span><span id="line-2114"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Add2"><span class="hs-identifier hs-type">MO_Add2</span></a></span><span>       </span><span id="local-6989586621682871928"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871928"><span class="hs-identifier hs-var">_w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CallishMachOp -&gt; NatM (OrdList Instr)
forall a b. Show a =&gt; a -&gt; b
</span><a href="#local-6989586621682871719"><span class="hs-identifier hs-var">unsupported</span></a></span><span> </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="#local-6989586621682871853"><span class="hs-identifier hs-var">mop</span></a></span><span>
</span><span id="line-2115"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_AddWordC"><span class="hs-identifier hs-type">MO_AddWordC</span></a></span><span>   </span><span id="local-6989586621682871930"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871930"><span class="hs-identifier hs-var">_w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CallishMachOp -&gt; NatM (OrdList Instr)
forall a b. Show a =&gt; a -&gt; b
</span><a href="#local-6989586621682871719"><span class="hs-identifier hs-var">unsupported</span></a></span><span> </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="#local-6989586621682871853"><span class="hs-identifier hs-var">mop</span></a></span><span>
</span><span id="line-2116"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_SubWordC"><span class="hs-identifier hs-type">MO_SubWordC</span></a></span><span>   </span><span id="local-6989586621682871932"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871932"><span class="hs-identifier hs-var">_w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CallishMachOp -&gt; NatM (OrdList Instr)
forall a b. Show a =&gt; a -&gt; b
</span><a href="#local-6989586621682871719"><span class="hs-identifier hs-var">unsupported</span></a></span><span> </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="#local-6989586621682871853"><span class="hs-identifier hs-var">mop</span></a></span><span>
</span><span id="line-2117"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_AddIntC"><span class="hs-identifier hs-type">MO_AddIntC</span></a></span><span>    </span><span id="local-6989586621682871934"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871934"><span class="hs-identifier hs-var">_w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CallishMachOp -&gt; NatM (OrdList Instr)
forall a b. Show a =&gt; a -&gt; b
</span><a href="#local-6989586621682871719"><span class="hs-identifier hs-var">unsupported</span></a></span><span> </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="#local-6989586621682871853"><span class="hs-identifier hs-var">mop</span></a></span><span>
</span><span id="line-2118"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_SubIntC"><span class="hs-identifier hs-type">MO_SubIntC</span></a></span><span>    </span><span id="local-6989586621682871936"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871936"><span class="hs-identifier hs-var">_w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CallishMachOp -&gt; NatM (OrdList Instr)
forall a b. Show a =&gt; a -&gt; b
</span><a href="#local-6989586621682871719"><span class="hs-identifier hs-var">unsupported</span></a></span><span> </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="#local-6989586621682871853"><span class="hs-identifier hs-var">mop</span></a></span><span>
</span><span id="line-2119"></span><span>
</span><span id="line-2120"></span><span>        </span><span class="hs-comment">-- Memory Ordering</span><span>
</span><span id="line-2121"></span><span>        </span><span class="hs-comment">-- Set flags according to their C pendants (stdatomic.h):</span><span>
</span><span id="line-2122"></span><span>        </span><span class="hs-comment">-- atomic_thread_fence(memory_order_acquire); // -&gt; dmb ishld</span><span>
</span><span id="line-2123"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_AcquireFence"><span class="hs-identifier hs-var">MO_AcquireFence</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><span class="annottext">OrdList Instr -&gt; NatM (OrdList Instr)
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(OrdList Instr -&gt; NatM (OrdList Instr))
-&gt; (Instr -&gt; OrdList Instr) -&gt; Instr -&gt; NatM (OrdList Instr)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; NatM (OrdList Instr)) -&gt; Instr -&gt; NatM (OrdList Instr)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DMBISHFlags -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#DMBISH"><span class="hs-identifier hs-var">DMBISH</span></a></span><span> </span><span class="annot"><span class="annottext">DMBISHFlags
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#DmbLoad"><span class="hs-identifier hs-var">DmbLoad</span></a></span><span>
</span><span id="line-2124"></span><span>        </span><span class="hs-comment">-- atomic_thread_fence(memory_order_release); // -&gt; dmb ish</span><span>
</span><span id="line-2125"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_ReleaseFence"><span class="hs-identifier hs-var">MO_ReleaseFence</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><span class="annottext">OrdList Instr -&gt; NatM (OrdList Instr)
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(OrdList Instr -&gt; NatM (OrdList Instr))
-&gt; (Instr -&gt; OrdList Instr) -&gt; Instr -&gt; NatM (OrdList Instr)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; NatM (OrdList Instr)) -&gt; Instr -&gt; NatM (OrdList Instr)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DMBISHFlags -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#DMBISH"><span class="hs-identifier hs-var">DMBISH</span></a></span><span> </span><span class="annot"><span class="annottext">DMBISHFlags
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#DmbLoadStore"><span class="hs-identifier hs-var">DmbLoadStore</span></a></span><span>
</span><span id="line-2126"></span><span>        </span><span class="hs-comment">-- atomic_thread_fence(memory_order_seq_cst); // -&gt; dmb ish</span><span>
</span><span id="line-2127"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_SeqCstFence"><span class="hs-identifier hs-var">MO_SeqCstFence</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><span class="annottext">OrdList Instr -&gt; NatM (OrdList Instr)
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(OrdList Instr -&gt; NatM (OrdList Instr))
-&gt; (Instr -&gt; OrdList Instr) -&gt; Instr -&gt; NatM (OrdList Instr)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Instr -&gt; OrdList Instr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(Instr -&gt; NatM (OrdList Instr)) -&gt; Instr -&gt; NatM (OrdList Instr)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DMBISHFlags -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#DMBISH"><span class="hs-identifier hs-var">DMBISH</span></a></span><span> </span><span class="annot"><span class="annottext">DMBISHFlags
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#DmbLoadStore"><span class="hs-identifier hs-var">DmbLoadStore</span></a></span><span>
</span><span id="line-2128"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_Touch"><span class="hs-identifier hs-var">MO_Touch</span></a></span><span>            </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><span class="annottext">OrdList Instr -&gt; NatM (OrdList Instr)
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">OrdList Instr
forall a. OrdList a
</span><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-var">nilOL</span></a></span><span> </span><span class="hs-comment">-- Keep variables live (when using interior pointers)</span><span>
</span><span id="line-2129"></span><span>        </span><span class="hs-comment">-- Prefetch</span><span>
</span><span id="line-2130"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Prefetch_Data"><span class="hs-identifier hs-type">MO_Prefetch_Data</span></a></span><span> </span><span id="local-6989586621682871945"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871945"><span class="hs-identifier hs-var">_n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; NatM (OrdList Instr)
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">OrdList Instr
forall a. OrdList a
</span><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-var">nilOL</span></a></span><span> </span><span class="hs-comment">-- Prefetch hint.</span><span>
</span><span id="line-2131"></span><span>
</span><span id="line-2132"></span><span>        </span><span class="hs-comment">-- Memory copy/set/move/cmp, with alignment for optimization</span><span>
</span><span id="line-2133"></span><span>
</span><span id="line-2134"></span><span>        </span><span class="hs-comment">-- TODO Optimize and use e.g. quad registers to move memory around instead</span><span>
</span><span id="line-2135"></span><span>        </span><span class="hs-comment">-- of offloading this to memcpy. For small memcpys we can utilize</span><span>
</span><span id="line-2136"></span><span>        </span><span class="hs-comment">-- the 128bit quad registers in NEON to move block of bytes around.</span><span>
</span><span id="line-2137"></span><span>        </span><span class="hs-comment">-- Might also make sense of small memsets? Use xzr? What's the function</span><span>
</span><span id="line-2138"></span><span>        </span><span class="hs-comment">-- call overhead?</span><span>
</span><span id="line-2139"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Memcpy"><span class="hs-identifier hs-type">MO_Memcpy</span></a></span><span>  </span><span id="local-6989586621682871947"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871947"><span class="hs-identifier hs-var">_align</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;memcpy&quot;</span></span><span>
</span><span id="line-2140"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Memset"><span class="hs-identifier hs-type">MO_Memset</span></a></span><span>  </span><span id="local-6989586621682871949"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871949"><span class="hs-identifier hs-var">_align</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;memset&quot;</span></span><span>
</span><span id="line-2141"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Memmove"><span class="hs-identifier hs-type">MO_Memmove</span></a></span><span> </span><span id="local-6989586621682871951"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871951"><span class="hs-identifier hs-var">_align</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;memmove&quot;</span></span><span>
</span><span id="line-2142"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Memcmp"><span class="hs-identifier hs-type">MO_Memcmp</span></a></span><span>  </span><span id="local-6989586621682871953"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682871953"><span class="hs-identifier hs-var">_align</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;memcmp&quot;</span></span><span>
</span><span id="line-2143"></span><span>
</span><span id="line-2144"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_SuspendThread"><span class="hs-identifier hs-var">MO_SuspendThread</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;suspendThread&quot;</span></span><span>
</span><span id="line-2145"></span><span>        </span><span class="annot"><span class="annottext">CallishMachOp
</span><a href="GHC.Cmm.MachOp.html#MO_ResumeThread"><span class="hs-identifier hs-var">MO_ResumeThread</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-string">&quot;resumeThread&quot;</span></span><span>
</span><span id="line-2146"></span><span>
</span><span id="line-2147"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_PopCnt"><span class="hs-identifier hs-type">MO_PopCnt</span></a></span><span> </span><span id="local-6989586621682871957"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871957"><span class="hs-identifier hs-var">w</span></a></span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; FastString
</span><a href="GHC.CmmToAsm.CPrim.html#popCntLabel"><span class="hs-identifier hs-var">popCntLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871957"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2148"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Pdep"><span class="hs-identifier hs-type">MO_Pdep</span></a></span><span> </span><span id="local-6989586621682871960"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871960"><span class="hs-identifier hs-var">w</span></a></span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; FastString
</span><a href="GHC.CmmToAsm.CPrim.html#pdepLabel"><span class="hs-identifier hs-var">pdepLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871960"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2149"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Pext"><span class="hs-identifier hs-type">MO_Pext</span></a></span><span> </span><span id="local-6989586621682871963"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871963"><span class="hs-identifier hs-var">w</span></a></span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; FastString
</span><a href="GHC.CmmToAsm.CPrim.html#pextLabel"><span class="hs-identifier hs-var">pextLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871963"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2150"></span><span>
</span><span id="line-2151"></span><span>        </span><span class="hs-comment">-- -- Atomic read-modify-write.</span><span>
</span><span id="line-2152"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_AtomicRead"><span class="hs-identifier hs-type">MO_AtomicRead</span></a></span><span> </span><span id="local-6989586621682871966"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871966"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682871967"><span class="annot"><span class="annottext">MemoryOrdering
</span><a href="#local-6989586621682871967"><span class="hs-identifier hs-var">ord</span></a></span></span><span>
</span><span id="line-2153"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871968"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871968"><span class="hs-identifier hs-var">p_reg</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682871587"><span class="hs-identifier hs-var">arg_regs</span></a></span><span>
</span><span id="line-2154"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871969"><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871969"><span class="hs-identifier hs-var">dst_reg</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmFormal]
</span><a href="#local-6989586621682871586"><span class="hs-identifier hs-var">dest_regs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2155"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682871970"><span class="annot"><a href="#local-6989586621682871970"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871971"><span class="annot"><a href="#local-6989586621682871971"><span class="hs-identifier hs-var">_fmt_p</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871972"><span class="annot"><a href="#local-6989586621682871972"><span class="hs-identifier hs-var">code_p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871968"><span class="hs-identifier hs-var">p_reg</span></a></span><span>
</span><span id="line-2156"></span><span>              </span><span id="local-6989586621682871973"><span class="annot"><a href="#local-6989586621682871973"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#getPlatform"><span class="hs-identifier hs-type">getPlatform</span></a></span><span>
</span><span id="line-2157"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682871974"><span class="annot"><a href="#local-6989586621682871974"><span class="hs-identifier hs-var hs-var">instr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MemoryOrdering
</span><a href="#local-6989586621682871967"><span class="hs-identifier hs-var">ord</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2158"></span><span>                      </span><span class="annot"><span class="annottext">MemoryOrdering
</span><a href="GHC.Cmm.MachOp.html#MemOrderRelaxed"><span class="hs-identifier hs-var">MemOrderRelaxed</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Format -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#LDR"><span class="hs-identifier hs-var">LDR</span></a></span><span>
</span><span id="line-2159"></span><span>                      </span><span class="annot"><span class="annottext">MemoryOrdering
</span><span class="hs-identifier">_</span></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Format -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#LDAR"><span class="hs-identifier hs-var">LDAR</span></a></span><span>
</span><span id="line-2160"></span><span>                  </span><span id="local-6989586621682871977"><span class="annot"><a href="#local-6989586621682871977"><span class="hs-identifier hs-var hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmReg -&gt; Reg
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682871973"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmFormal -&gt; CmmReg
</span><a href="GHC.Cmm.Reg.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a></span><span> </span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682871969"><span class="hs-identifier hs-var">dst_reg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2161"></span><span>                  </span><span id="local-6989586621682871978"><span class="annot"><a href="#local-6989586621682871978"><span class="hs-identifier hs-var hs-var">code</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2162"></span><span>                    </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871972"><span class="hs-identifier hs-var">code_p</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span>
</span><span id="line-2163"></span><span>                    </span><span class="annot"><span class="annottext">Format -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="#local-6989586621682871974"><span class="hs-identifier hs-var">instr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871966"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871966"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871977"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddrMode -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a></span><span> </span><span class="annot"><span class="annottext">(AddrMode -&gt; Operand) -&gt; AddrMode -&gt; Operand
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Reg -&gt; AddrMode
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#AddrReg"><span class="hs-identifier hs-var">AddrReg</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871970"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2164"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682871978"><span class="hs-identifier hs-type">code</span></a></span><span>
</span><span id="line-2165"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; NatM (OrdList Instr)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mal-formed AtomicRead&quot;</span></span><span>
</span><span id="line-2166"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_AtomicWrite"><span class="hs-identifier hs-type">MO_AtomicWrite</span></a></span><span> </span><span id="local-6989586621682871980"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871980"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682871981"><span class="annot"><span class="annottext">MemoryOrdering
</span><a href="#local-6989586621682871981"><span class="hs-identifier hs-var">ord</span></a></span></span><span>
</span><span id="line-2167"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682871982"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871982"><span class="hs-identifier hs-var">p_reg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871983"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871983"><span class="hs-identifier hs-var">val_reg</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682871587"><span class="hs-identifier hs-var">arg_regs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2168"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682871984"><span class="annot"><a href="#local-6989586621682871984"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871985"><span class="annot"><a href="#local-6989586621682871985"><span class="hs-identifier hs-var">_fmt_p</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871986"><span class="annot"><a href="#local-6989586621682871986"><span class="hs-identifier hs-var">code_p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; NatM (Reg, Format, OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682871982"><span class="hs-identifier hs-var">p_reg</span></a></span><span>
</span><span id="line-2169"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682871987"><span class="annot"><a href="#local-6989586621682871987"><span class="hs-identifier hs-var">val</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871988"><span class="annot"><a href="#local-6989586621682871988"><span class="hs-identifier hs-var">fmt_val</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682871989"><span class="annot"><a href="#local-6989586621682871989"><span class="hs-identifier hs-var">code_val</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getSomeReg"><span class="hs-identifier hs-type">getSomeReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871983"><span class="hs-identifier hs-type">val_reg</span></a></span><span>
</span><span id="line-2170"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682871990"><span class="annot"><a href="#local-6989586621682871990"><span class="hs-identifier hs-var hs-var">instr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MemoryOrdering
</span><a href="#local-6989586621682871981"><span class="hs-identifier hs-var">ord</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2171"></span><span>                      </span><span class="annot"><span class="annottext">MemoryOrdering
</span><a href="GHC.Cmm.MachOp.html#MemOrderRelaxed"><span class="hs-identifier hs-var">MemOrderRelaxed</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Format -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#STR"><span class="hs-identifier hs-var">STR</span></a></span><span>
</span><span id="line-2172"></span><span>                      </span><span class="annot"><span class="annottext">MemoryOrdering
</span><span class="hs-identifier">_</span></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Format -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#STLR"><span class="hs-identifier hs-var">STLR</span></a></span><span>
</span><span id="line-2173"></span><span>                  </span><span id="local-6989586621682871992"><span class="annot"><a href="#local-6989586621682871992"><span class="hs-identifier hs-var hs-var">code</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2174"></span><span>                    </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871986"><span class="hs-identifier hs-var">code_p</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span>
</span><span id="line-2175"></span><span>                    </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682871989"><span class="hs-identifier hs-var">code_val</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span>
</span><span id="line-2176"></span><span>                    </span><span class="annot"><span class="annottext">Format -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="#local-6989586621682871990"><span class="hs-identifier hs-var">instr</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682871988"><span class="hs-identifier hs-var">fmt_val</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871980"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871987"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddrMode -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a></span><span> </span><span class="annot"><span class="annottext">(AddrMode -&gt; Operand) -&gt; AddrMode -&gt; Operand
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Reg -&gt; AddrMode
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#AddrReg"><span class="hs-identifier hs-var">AddrReg</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682871984"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2177"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682871992"><span class="hs-identifier hs-type">code</span></a></span><span>
</span><span id="line-2178"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; NatM (OrdList Instr)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mal-formed AtomicWrite&quot;</span></span><span>
</span><span id="line-2179"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_AtomicRMW"><span class="hs-identifier hs-type">MO_AtomicRMW</span></a></span><span> </span><span id="local-6989586621682871994"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871994"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682871995"><span class="annot"><span class="annottext">AtomicMachOp
</span><a href="#local-6989586621682871995"><span class="hs-identifier hs-var">amop</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; AtomicMachOp -&gt; FastString
</span><a href="GHC.CmmToAsm.CPrim.html#atomicRMWLabel"><span class="hs-identifier hs-var">atomicRMWLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871994"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">AtomicMachOp
</span><a href="#local-6989586621682871995"><span class="hs-identifier hs-var">amop</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2180"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Cmpxchg"><span class="hs-identifier hs-type">MO_Cmpxchg</span></a></span><span> </span><span id="local-6989586621682871998"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871998"><span class="hs-identifier hs-var">w</span></a></span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; FastString
</span><a href="GHC.CmmToAsm.CPrim.html#cmpxchgLabel"><span class="hs-identifier hs-var">cmpxchgLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682871998"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2181"></span><span>        </span><span class="hs-comment">-- -- Should be an AtomicRMW variant eventually.</span><span>
</span><span id="line-2182"></span><span>        </span><span class="hs-comment">-- -- Sequential consistent.</span><span>
</span><span id="line-2183"></span><span>        </span><span class="hs-comment">-- TODO: this should be implemented properly!</span><span>
</span><span id="line-2184"></span><span>        </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Xchg"><span class="hs-identifier hs-type">MO_Xchg</span></a></span><span> </span><span id="local-6989586621682872001"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682872001"><span class="hs-identifier hs-var">w</span></a></span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var">mkCCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; FastString
</span><a href="GHC.CmmToAsm.CPrim.html#xchgLabel"><span class="hs-identifier hs-var">xchgLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682872001"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2185"></span><span>
</span><span id="line-2186"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2187"></span><span>    </span><span id="local-6989586621682869263"><span id="local-6989586621682869264"><span class="annot"><a href="#local-6989586621682871719"><span class="hs-identifier hs-type">unsupported</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621682869263"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682869263"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682869264"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-2188"></span><span>    </span><span id="local-6989586621682871719"><span class="annot"><span class="annottext">unsupported :: forall a b. Show a =&gt; a -&gt; b
</span><a href="#local-6989586621682871719"><span class="hs-identifier hs-var hs-var">unsupported</span></a></span></span><span> </span><span id="local-6989586621682872011"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682872011"><span class="hs-identifier hs-var">mop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; b
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;outOfLineCmmOp: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682872011"><span class="hs-identifier hs-var">mop</span></a></span><span>
</span><span id="line-2189"></span><span>                          </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; not supported here&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-2190"></span><span>    </span><span class="annot"><a href="#local-6989586621682871855"><span class="hs-identifier hs-type">mkCCall</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a></span><span>
</span><span id="line-2191"></span><span>    </span><span id="local-6989586621682871855"><span class="annot"><span class="annottext">mkCCall :: FastString -&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871855"><span class="hs-identifier hs-var hs-var">mkCCall</span></a></span></span><span> </span><span id="local-6989586621682872012"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682872012"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2192"></span><span>      </span><span id="local-6989586621682872013"><span class="annot"><a href="#local-6989586621682872013"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NatM NCGConfig
</span><a href="GHC.CmmToAsm.Monad.html#getConfig"><span class="hs-identifier hs-var">getConfig</span></a></span><span>
</span><span id="line-2193"></span><span>      </span><span id="local-6989586621682872014"><span class="annot"><a href="#local-6989586621682872014"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#cmmMakeDynamicReference"><span class="hs-identifier hs-type">cmmMakeDynamicReference</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682872013"><span class="hs-identifier hs-type">config</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#CallReference"><span class="hs-identifier hs-type">CallReference</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2194"></span><span>          </span><span class="annot"><a href="GHC.Cmm.CLabel.html#mkForeignLabel"><span class="hs-identifier hs-type">mkForeignLabel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682872012"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#ForeignLabelInThisPackage"><span class="hs-identifier hs-type">ForeignLabelInThisPackage</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#IsFunction"><span class="hs-identifier hs-type">IsFunction</span></a></span><span>
</span><span id="line-2195"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682872020"><span class="annot"><a href="#local-6989586621682872020"><span class="hs-identifier hs-var hs-var">cconv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CCallConv
-&gt; [ForeignHint]
-&gt; [ForeignHint]
-&gt; CmmReturnInfo
-&gt; ForeignConvention
</span><a href="GHC.Cmm.Node.html#ForeignConvention"><span class="hs-identifier hs-var">ForeignConvention</span></a></span><span> </span><span class="annot"><span class="annottext">CCallConv
</span><a href="GHC.Types.ForeignCall.html#CCallConv"><span class="hs-identifier hs-var">CCallConv</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ForeignHint
</span><a href="GHC.Cmm.Type.html#NoHint"><span class="hs-identifier hs-var">NoHint</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ForeignHint
</span><a href="GHC.Cmm.Type.html#NoHint"><span class="hs-identifier hs-var">NoHint</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">CmmReturnInfo
</span><a href="GHC.Cmm.Node.html#CmmMayReturn"><span class="hs-identifier hs-var">CmmMayReturn</span></a></span><span>
</span><span id="line-2196"></span><span>      </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#genCCall"><span class="hs-identifier hs-type">genCCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#ForeignTarget"><span class="hs-identifier hs-type">ForeignTarget</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682872014"><span class="hs-identifier hs-type">target</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682872020"><span class="hs-identifier hs-type">cconv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682871586"><span class="hs-identifier hs-type">dest_regs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871587"><span class="hs-identifier hs-type">arg_regs</span></a></span><span>
</span><span id="line-2197"></span><span>
</span><span id="line-2198"></span><span>    </span><span class="hs-comment">-- TODO: Optimize using paired stores and loads (STP, LDP). It is</span><span>
</span><span id="line-2199"></span><span>    </span><span class="hs-comment">-- automatically done by the allocator for us. However it's not optimal,</span><span>
</span><span id="line-2200"></span><span>    </span><span class="hs-comment">-- as we'd rather want to have control over</span><span>
</span><span id="line-2201"></span><span>    </span><span class="hs-comment">--     all spill/load registers, so we can optimize with instructions like</span><span>
</span><span id="line-2202"></span><span>    </span><span class="hs-comment">--       STP xA, xB, [sp, #-16]!</span><span>
</span><span id="line-2203"></span><span>    </span><span class="hs-comment">--     and</span><span>
</span><span id="line-2204"></span><span>    </span><span class="hs-comment">--       LDP xA, xB, sp, #16</span><span>
</span><span id="line-2205"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-2206"></span><span>    </span><span class="annot"><a href="#local-6989586621682871615"><span class="hs-identifier hs-type">passArguments</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Platform.Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Platform.Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Platform.Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Format.html#Format"><span class="hs-identifier hs-type">Format</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#ForeignHint"><span class="hs-identifier hs-type">ForeignHint</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Platform.Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Platform.Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2207"></span><span>    </span><span id="local-6989586621682871615"><span class="annot"><span class="annottext">passArguments :: Bool
-&gt; [Reg]
-&gt; [Reg]
-&gt; [(Reg, Format, ForeignHint, OrdList Instr)]
-&gt; Int
-&gt; [Reg]
-&gt; OrdList Instr
-&gt; NatM (Int, [Reg], OrdList Instr)
</span><a href="#local-6989586621682871615"><span class="hs-identifier hs-var hs-var">passArguments</span></a></span></span><span> </span><span id="local-6989586621682872025"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682872025"><span class="hs-identifier hs-var">_packStack</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Reg]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Reg]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621682872026"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872026"><span class="hs-identifier hs-var">stackSpace</span></a></span></span><span> </span><span id="local-6989586621682872027"><span class="annot"><span class="annottext">[Reg]
</span><a href="#local-6989586621682872027"><span class="hs-identifier hs-var">accumRegs</span></a></span></span><span> </span><span id="local-6989586621682872028"><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682872028"><span class="hs-identifier hs-var">accumCode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int, [Reg], OrdList Instr) -&gt; NatM (Int, [Reg], OrdList Instr)
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872026"><span class="hs-identifier hs-var">stackSpace</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Reg]
</span><a href="#local-6989586621682872027"><span class="hs-identifier hs-var">accumRegs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682872028"><span class="hs-identifier hs-var">accumCode</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2208"></span><span>    </span><span class="hs-comment">-- passArguments _ _ [] accumCode stackSpace | isEven stackSpace = return $ SUM (OpReg W64 x31) (OpReg W64 x31) OpImm (ImmInt (-8 * stackSpace))</span><span>
</span><span id="line-2209"></span><span>    </span><span class="hs-comment">-- passArguments _ _ [] accumCode stackSpace = return $ SUM (OpReg W64 x31) (OpReg W64 x31) OpImm (ImmInt (-8 * (stackSpace + 1)))</span><span>
</span><span id="line-2210"></span><span>    </span><span class="hs-comment">-- passArguments [] fpRegs (arg0:arg1:args) stack accumCode = do</span><span>
</span><span id="line-2211"></span><span>    </span><span class="hs-comment">--   -- allocate this on the stack</span><span>
</span><span id="line-2212"></span><span>    </span><span class="hs-comment">--   (r0, format0, code_r0) &lt;- getSomeReg arg0</span><span>
</span><span id="line-2213"></span><span>    </span><span class="hs-comment">--   (r1, format1, code_r1) &lt;- getSomeReg arg1</span><span>
</span><span id="line-2214"></span><span>    </span><span class="hs-comment">--   let w0 = formatToWidth format0</span><span>
</span><span id="line-2215"></span><span>    </span><span class="hs-comment">--       w1 = formatToWidth format1</span><span>
</span><span id="line-2216"></span><span>    </span><span class="hs-comment">--       stackCode = unitOL $ STP (OpReg w0 r0) (OpReg w1 R1), (OpAddr (AddrRegImm x31 (ImmInt (stackSpace * 8)))</span><span>
</span><span id="line-2217"></span><span>    </span><span class="hs-comment">--   passArguments gpRegs (fpReg:fpRegs) args (stackCode `appOL` accumCode)</span><span>
</span><span id="line-2218"></span><span>
</span><span id="line-2219"></span><span>      </span><span class="hs-comment">-- float promotion.</span><span>
</span><span id="line-2220"></span><span>      </span><span class="hs-comment">-- According to</span><span>
</span><span id="line-2221"></span><span>      </span><span class="hs-comment">--  ISO/IEC 9899:2018</span><span>
</span><span id="line-2222"></span><span>      </span><span class="hs-comment">--  Information technology &#8212; Programming languages &#8212; C</span><span>
</span><span id="line-2223"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-2224"></span><span>      </span><span class="hs-comment">-- e.g.</span><span>
</span><span id="line-2225"></span><span>      </span><span class="hs-comment">-- http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1124.pdf</span><span>
</span><span id="line-2226"></span><span>      </span><span class="hs-comment">-- http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1256.pdf</span><span>
</span><span id="line-2227"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-2228"></span><span>      </span><span class="hs-comment">-- GHC would need to know the prototype.</span><span>
</span><span id="line-2229"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-2230"></span><span>      </span><span class="hs-comment">-- &gt; If the expression that denotes the called function has a type that does not include a</span><span>
</span><span id="line-2231"></span><span>      </span><span class="hs-comment">-- &gt; prototype, the integer promotions are performed on each argument, and arguments that</span><span>
</span><span id="line-2232"></span><span>      </span><span class="hs-comment">-- &gt; have type float are promoted to double.</span><span>
</span><span id="line-2233"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-2234"></span><span>      </span><span class="hs-comment">-- As we have no way to get prototypes for C yet, we'll *not* promote this</span><span>
</span><span id="line-2235"></span><span>      </span><span class="hs-comment">-- which is in line with the x86_64 backend :(</span><span>
</span><span id="line-2236"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-2237"></span><span>      </span><span class="hs-comment">-- See the encode_values.cmm test.</span><span>
</span><span id="line-2238"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-2239"></span><span>      </span><span class="hs-comment">-- We would essentially need to insert an FCVT (OpReg W64 fpReg) (OpReg W32 fpReg)</span><span>
</span><span id="line-2240"></span><span>      </span><span class="hs-comment">-- if w == W32.  But *only* if we don't have a prototype m(</span><span>
</span><span id="line-2241"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-2242"></span><span>      </span><span class="hs-comment">-- For AArch64 specificies see: https://developer.arm.com/docs/ihi0055/latest/procedure-call-standard-for-the-arm-64-bit-architecture</span><span>
</span><span id="line-2243"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-2244"></span><span>    </span><span class="hs-comment">-- Still have GP regs, and we want to pass an GP argument.</span><span>
</span><span id="line-2245"></span><span>
</span><span id="line-2246"></span><span>    </span><span class="hs-comment">-- AArch64-Darwin: stack packing and alignment</span><span>
</span><span id="line-2247"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-2248"></span><span>    </span><span class="hs-comment">-- According to the &quot;Writing ARM64 Code for Apple Platforms&quot; document form</span><span>
</span><span id="line-2249"></span><span>    </span><span class="hs-comment">-- Apple, specifically the section &quot;Handle Data Types and Data Alignment Properly&quot;</span><span>
</span><span id="line-2250"></span><span>    </span><span class="hs-comment">-- we need to not only pack, but also align arguments on the stack.</span><span>
</span><span id="line-2251"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-2252"></span><span>    </span><span class="hs-comment">-- Data type   Size (in bytes)   Natural alignment (in bytes)</span><span>
</span><span id="line-2253"></span><span>    </span><span class="hs-comment">-- BOOL, bool  1                 1</span><span>
</span><span id="line-2254"></span><span>    </span><span class="hs-comment">-- char        1                 1</span><span>
</span><span id="line-2255"></span><span>    </span><span class="hs-comment">-- short       2                 2</span><span>
</span><span id="line-2256"></span><span>    </span><span class="hs-comment">-- int         4                 4</span><span>
</span><span id="line-2257"></span><span>    </span><span class="hs-comment">-- long        8                 8</span><span>
</span><span id="line-2258"></span><span>    </span><span class="hs-comment">-- long long   8                 8</span><span>
</span><span id="line-2259"></span><span>    </span><span class="hs-comment">-- pointer     8                 8</span><span>
</span><span id="line-2260"></span><span>    </span><span class="hs-comment">-- size_t      8                 8</span><span>
</span><span id="line-2261"></span><span>    </span><span class="hs-comment">-- NSInteger   8                 8</span><span>
</span><span id="line-2262"></span><span>    </span><span class="hs-comment">-- CFIndex     8                 8</span><span>
</span><span id="line-2263"></span><span>    </span><span class="hs-comment">-- fpos_t      8                 8</span><span>
</span><span id="line-2264"></span><span>    </span><span class="hs-comment">-- off_t       8                 8</span><span>
</span><span id="line-2265"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-2266"></span><span>    </span><span class="hs-comment">-- We can see that types are aligned by their sizes so the easiest way to</span><span>
</span><span id="line-2267"></span><span>    </span><span class="hs-comment">-- guarantee alignment during packing seems to be to pad to a multiple of the</span><span>
</span><span id="line-2268"></span><span>    </span><span class="hs-comment">-- size we want to pack. Failure to get this right can result in pretty</span><span>
</span><span id="line-2269"></span><span>    </span><span class="hs-comment">-- subtle bugs, e.g. #20137.</span><span>
</span><span id="line-2270"></span><span>
</span><span id="line-2271"></span><span>    </span><span class="annot"><a href="#local-6989586621682871615"><span class="hs-identifier hs-var">passArguments</span></a></span><span> </span><span id="local-6989586621682872029"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682872029"><span class="hs-identifier hs-var">pack</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682872030"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682872030"><span class="hs-identifier hs-var">gpReg</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682872031"><span class="annot"><span class="annottext">[Reg]
</span><a href="#local-6989586621682872031"><span class="hs-identifier hs-var">gpRegs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682872032"><span class="annot"><span class="annottext">[Reg]
</span><a href="#local-6989586621682872032"><span class="hs-identifier hs-var">fpRegs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682872033"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682872033"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682872034"><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682872034"><span class="hs-identifier hs-var">format</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682872035"><span class="annot"><span class="annottext">ForeignHint
</span><a href="#local-6989586621682872035"><span class="hs-identifier hs-var">hint</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682872036"><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682872036"><span class="hs-identifier hs-var">code_r</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682872037"><span class="annot"><span class="annottext">[(Reg, Format, ForeignHint, OrdList Instr)]
</span><a href="#local-6989586621682872037"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682872038"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872038"><span class="hs-identifier hs-var">stackSpace</span></a></span></span><span> </span><span id="local-6989586621682872039"><span class="annot"><span class="annottext">[Reg]
</span><a href="#local-6989586621682872039"><span class="hs-identifier hs-var">accumRegs</span></a></span></span><span> </span><span id="local-6989586621682872040"><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682872040"><span class="hs-identifier hs-var">accumCode</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Format -&gt; Bool
</span><a href="GHC.CmmToAsm.Format.html#isIntFormat"><span class="hs-identifier hs-var">isIntFormat</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682872034"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2272"></span><span>      </span><span id="local-6989586621682872041"><span class="annot"><a href="#local-6989586621682872041"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NatM Platform
</span><a href="GHC.CmmToAsm.Monad.html#getPlatform"><span class="hs-identifier hs-var">getPlatform</span></a></span><span>
</span><span id="line-2273"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682872042"><span class="annot"><a href="#local-6989586621682872042"><span class="hs-identifier hs-var hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Format -&gt; Width
</span><a href="GHC.CmmToAsm.Format.html#formatToWidth"><span class="hs-identifier hs-var">formatToWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682872034"><span class="hs-identifier hs-var">format</span></a></span><span>
</span><span id="line-2274"></span><span>          </span><span id="local-6989586621682872043"><span class="annot"><a href="#local-6989586621682872043"><span class="hs-identifier hs-var hs-var">mov</span></a></span></span><span>
</span><span id="line-2275"></span><span>            </span><span class="hs-comment">-- Specifically, Darwin/AArch64's ABI requires that the caller</span><span>
</span><span id="line-2276"></span><span>            </span><span class="hs-comment">-- sign-extend arguments which are smaller than 32-bits.</span><span>
</span><span id="line-2277"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682872042"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Width -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span>
</span><span id="line-2278"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Bool
</span><a href="GHC.Platform.html#platformCConvNeedsExtension"><span class="hs-identifier hs-var">platformCConvNeedsExtension</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682872041"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-2279"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ForeignHint
</span><a href="GHC.Cmm.Type.html#SignedHint"><span class="hs-identifier hs-var">SignedHint</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ForeignHint
</span><a href="#local-6989586621682872035"><span class="hs-identifier hs-var">hint</span></a></span><span>
</span><span id="line-2280"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682872042"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2281"></span><span>                </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W8"><span class="hs-identifier hs-var">W8</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SXTB"><span class="hs-identifier hs-var">SXTB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682872030"><span class="hs-identifier hs-var">gpReg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682872042"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682872033"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2282"></span><span>                </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W16"><span class="hs-identifier hs-var">W16</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#SXTH"><span class="hs-identifier hs-var">SXTH</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682872030"><span class="hs-identifier hs-var">gpReg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682872042"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682872033"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2283"></span><span>                </span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Instr
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;impossible&quot;</span></span><span>
</span><span id="line-2284"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2285"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682872042"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682872030"><span class="hs-identifier hs-var">gpReg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682872042"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682872033"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2286"></span><span>          </span><span id="local-6989586621682872046"><span class="annot"><a href="#local-6989586621682872046"><span class="hs-identifier hs-var hs-var">accumCode'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682872040"><span class="hs-identifier hs-var">accumCode</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span>
</span><span id="line-2287"></span><span>                       </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682872036"><span class="hs-identifier hs-var">code_r</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span>
</span><span id="line-2288"></span><span>                       </span><span class="annot"><span class="annottext">SDoc -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#ann"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Pass gp argument: &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Reg -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682872033"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Instr
</span><a href="#local-6989586621682872043"><span class="hs-identifier hs-var">mov</span></a></span><span>
</span><span id="line-2289"></span><span>      </span><span class="annot"><a href="#local-6989586621682871615"><span class="hs-identifier hs-type">passArguments</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682872029"><span class="hs-identifier hs-type">pack</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682872031"><span class="hs-identifier hs-type">gpRegs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682872032"><span class="hs-identifier hs-type">fpRegs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682872037"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682872038"><span class="hs-identifier hs-type">stackSpace</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682872030"><span class="hs-identifier hs-type">gpReg</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><a href="#local-6989586621682872039"><span class="hs-identifier hs-type">accumRegs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682872046"><span class="hs-identifier hs-type">accumCode'</span></a></span><span>
</span><span id="line-2290"></span><span>
</span><span id="line-2291"></span><span>    </span><span class="hs-comment">-- Still have FP regs, and we want to pass an FP argument.</span><span>
</span><span id="line-2292"></span><span>    </span><span class="annot"><a href="#local-6989586621682871615"><span class="hs-identifier hs-var">passArguments</span></a></span><span> </span><span id="local-6989586621682872048"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682872048"><span class="hs-identifier hs-var">pack</span></a></span></span><span> </span><span id="local-6989586621682872049"><span class="annot"><span class="annottext">[Reg]
</span><a href="#local-6989586621682872049"><span class="hs-identifier hs-var">gpRegs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682872050"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682872050"><span class="hs-identifier hs-var">fpReg</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682872051"><span class="annot"><span class="annottext">[Reg]
</span><a href="#local-6989586621682872051"><span class="hs-identifier hs-var">fpRegs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682872052"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682872052"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682872053"><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682872053"><span class="hs-identifier hs-var">format</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682872054"><span class="annot"><span class="annottext">ForeignHint
</span><a href="#local-6989586621682872054"><span class="hs-identifier hs-var">_hint</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682872055"><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682872055"><span class="hs-identifier hs-var">code_r</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682872056"><span class="annot"><span class="annottext">[(Reg, Format, ForeignHint, OrdList Instr)]
</span><a href="#local-6989586621682872056"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682872057"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872057"><span class="hs-identifier hs-var">stackSpace</span></a></span></span><span> </span><span id="local-6989586621682872058"><span class="annot"><span class="annottext">[Reg]
</span><a href="#local-6989586621682872058"><span class="hs-identifier hs-var">accumRegs</span></a></span></span><span> </span><span id="local-6989586621682872059"><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682872059"><span class="hs-identifier hs-var">accumCode</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Format -&gt; Bool
</span><a href="GHC.CmmToAsm.Format.html#isFloatFormat"><span class="hs-identifier hs-var">isFloatFormat</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682872053"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2293"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682872060"><span class="annot"><span class="annottext">w :: Width
</span><a href="#local-6989586621682872060"><span class="hs-identifier hs-var hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Format -&gt; Width
</span><a href="GHC.CmmToAsm.Format.html#formatToWidth"><span class="hs-identifier hs-var">formatToWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682872053"><span class="hs-identifier hs-var">format</span></a></span><span>
</span><span id="line-2294"></span><span>          </span><span id="local-6989586621682872061"><span class="annot"><span class="annottext">mov :: Instr
</span><a href="#local-6989586621682872061"><span class="hs-identifier hs-var hs-var">mov</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682872060"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682872050"><span class="hs-identifier hs-var">fpReg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682872060"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682872052"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2295"></span><span>          </span><span id="local-6989586621682872062"><span class="annot"><span class="annottext">accumCode' :: OrdList Instr
</span><a href="#local-6989586621682872062"><span class="hs-identifier hs-var hs-var">accumCode'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682872059"><span class="hs-identifier hs-var">accumCode</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span>
</span><span id="line-2296"></span><span>                       </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682872055"><span class="hs-identifier hs-var">code_r</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span>
</span><span id="line-2297"></span><span>                       </span><span class="annot"><span class="annottext">SDoc -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#ann"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Pass fp argument: &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Reg -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682872052"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Instr
</span><a href="#local-6989586621682872061"><span class="hs-identifier hs-var">mov</span></a></span><span>
</span><span id="line-2298"></span><span>      </span><span class="annot"><span class="annottext">Bool
-&gt; [Reg]
-&gt; [Reg]
-&gt; [(Reg, Format, ForeignHint, OrdList Instr)]
-&gt; Int
-&gt; [Reg]
-&gt; OrdList Instr
-&gt; NatM (Int, [Reg], OrdList Instr)
</span><a href="#local-6989586621682871615"><span class="hs-identifier hs-var">passArguments</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682872048"><span class="hs-identifier hs-var">pack</span></a></span><span> </span><span class="annot"><span class="annottext">[Reg]
</span><a href="#local-6989586621682872049"><span class="hs-identifier hs-var">gpRegs</span></a></span><span> </span><span class="annot"><span class="annottext">[Reg]
</span><a href="#local-6989586621682872051"><span class="hs-identifier hs-var">fpRegs</span></a></span><span> </span><span class="annot"><span class="annottext">[(Reg, Format, ForeignHint, OrdList Instr)]
</span><a href="#local-6989586621682872056"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872057"><span class="hs-identifier hs-var">stackSpace</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682872050"><span class="hs-identifier hs-var">fpReg</span></a></span><span class="annot"><span class="annottext">Reg -&gt; [Reg] -&gt; [Reg]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Reg]
</span><a href="#local-6989586621682872058"><span class="hs-identifier hs-var">accumRegs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682872062"><span class="hs-identifier hs-var">accumCode'</span></a></span><span>
</span><span id="line-2299"></span><span>
</span><span id="line-2300"></span><span>    </span><span class="hs-comment">-- No mor regs left to pass. Must pass on stack.</span><span>
</span><span id="line-2301"></span><span>    </span><span class="annot"><a href="#local-6989586621682871615"><span class="hs-identifier hs-var">passArguments</span></a></span><span> </span><span id="local-6989586621682872063"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682872063"><span class="hs-identifier hs-var">pack</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682872064"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682872064"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682872065"><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682872065"><span class="hs-identifier hs-var">format</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682872066"><span class="annot"><span class="annottext">ForeignHint
</span><a href="#local-6989586621682872066"><span class="hs-identifier hs-var">_hint</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682872067"><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682872067"><span class="hs-identifier hs-var">code_r</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682872068"><span class="annot"><span class="annottext">[(Reg, Format, ForeignHint, OrdList Instr)]
</span><a href="#local-6989586621682872068"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682872069"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872069"><span class="hs-identifier hs-var">stackSpace</span></a></span></span><span> </span><span id="local-6989586621682872070"><span class="annot"><span class="annottext">[Reg]
</span><a href="#local-6989586621682872070"><span class="hs-identifier hs-var">accumRegs</span></a></span></span><span> </span><span id="local-6989586621682872071"><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682872071"><span class="hs-identifier hs-var">accumCode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2302"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682872072"><span class="annot"><span class="annottext">w :: Width
</span><a href="#local-6989586621682872072"><span class="hs-identifier hs-var hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Format -&gt; Width
</span><a href="GHC.CmmToAsm.Format.html#formatToWidth"><span class="hs-identifier hs-var">formatToWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682872065"><span class="hs-identifier hs-var">format</span></a></span><span>
</span><span id="line-2303"></span><span>          </span><span id="local-6989586621682872073"><span class="annot"><span class="annottext">bytes :: Int
</span><a href="#local-6989586621682872073"><span class="hs-identifier hs-var hs-var">bytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Int
</span><a href="GHC.Cmm.Type.html#widthInBits"><span class="hs-identifier hs-var">widthInBits</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682872072"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span>
</span><span id="line-2304"></span><span>          </span><span id="local-6989586621682872074"><span class="annot"><span class="annottext">space :: Int
</span><a href="#local-6989586621682872074"><span class="hs-identifier hs-var hs-var">space</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682872063"><span class="hs-identifier hs-var">pack</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872073"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span>
</span><span id="line-2305"></span><span>          </span><span id="local-6989586621682872075"><span class="annot"><span class="annottext">stackSpace' :: Int
</span><a href="#local-6989586621682872075"><span class="hs-identifier hs-var hs-var">stackSpace'</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682872063"><span class="hs-identifier hs-var">pack</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872069"><span class="hs-identifier hs-var">stackSpace</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872074"><span class="hs-identifier hs-var">space</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872069"><span class="hs-identifier hs-var">stackSpace</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872074"><span class="hs-identifier hs-var">space</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872069"><span class="hs-identifier hs-var">stackSpace</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872074"><span class="hs-identifier hs-var">space</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2306"></span><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872069"><span class="hs-identifier hs-var">stackSpace</span></a></span><span>
</span><span id="line-2307"></span><span>          </span><span id="local-6989586621682872076"><span class="annot"><span class="annottext">str :: Instr
</span><a href="#local-6989586621682872076"><span class="hs-identifier hs-var hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Format -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#STR"><span class="hs-identifier hs-var">STR</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682872065"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682872072"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682872064"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddrMode -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reg -&gt; Imm -&gt; AddrMode
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Reg
</span><a href="GHC.Platform.Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">31</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872075"><span class="hs-identifier hs-var">stackSpace'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2308"></span><span>          </span><span id="local-6989586621682872077"><span class="annot"><span class="annottext">stackCode :: OrdList Instr
</span><a href="#local-6989586621682872077"><span class="hs-identifier hs-var hs-var">stackCode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682872067"><span class="hs-identifier hs-var">code_r</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span>
</span><span id="line-2309"></span><span>                      </span><span class="annot"><span class="annottext">SDoc -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#ann"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Pass argument (size &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682872072"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;) on the stack: &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Reg -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682872064"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Instr
</span><a href="#local-6989586621682872076"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-2310"></span><span>      </span><span class="annot"><span class="annottext">Bool
-&gt; [Reg]
-&gt; [Reg]
-&gt; [(Reg, Format, ForeignHint, OrdList Instr)]
-&gt; Int
-&gt; [Reg]
-&gt; OrdList Instr
-&gt; NatM (Int, [Reg], OrdList Instr)
</span><a href="#local-6989586621682871615"><span class="hs-identifier hs-var">passArguments</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682872063"><span class="hs-identifier hs-var">pack</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[(Reg, Format, ForeignHint, OrdList Instr)]
</span><a href="#local-6989586621682872068"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872075"><span class="hs-identifier hs-var">stackSpace'</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872074"><span class="hs-identifier hs-var">space</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Reg]
</span><a href="#local-6989586621682872070"><span class="hs-identifier hs-var">accumRegs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682872077"><span class="hs-identifier hs-var">stackCode</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682872071"><span class="hs-identifier hs-var">accumCode</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2311"></span><span>
</span><span id="line-2312"></span><span>    </span><span class="hs-comment">-- Still have fpRegs left, but want to pass a GP argument. Must be passed on the stack then.</span><span>
</span><span id="line-2313"></span><span>    </span><span class="annot"><a href="#local-6989586621682871615"><span class="hs-identifier hs-var">passArguments</span></a></span><span> </span><span id="local-6989586621682872078"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682872078"><span class="hs-identifier hs-var">pack</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621682872079"><span class="annot"><span class="annottext">[Reg]
</span><a href="#local-6989586621682872079"><span class="hs-identifier hs-var">fpRegs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682872080"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682872080"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682872081"><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682872081"><span class="hs-identifier hs-var">format</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682872082"><span class="annot"><span class="annottext">ForeignHint
</span><a href="#local-6989586621682872082"><span class="hs-identifier hs-var">_hint</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682872083"><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682872083"><span class="hs-identifier hs-var">code_r</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682872084"><span class="annot"><span class="annottext">[(Reg, Format, ForeignHint, OrdList Instr)]
</span><a href="#local-6989586621682872084"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682872085"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872085"><span class="hs-identifier hs-var">stackSpace</span></a></span></span><span> </span><span id="local-6989586621682872086"><span class="annot"><span class="annottext">[Reg]
</span><a href="#local-6989586621682872086"><span class="hs-identifier hs-var">accumRegs</span></a></span></span><span> </span><span id="local-6989586621682872087"><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682872087"><span class="hs-identifier hs-var">accumCode</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Format -&gt; Bool
</span><a href="GHC.CmmToAsm.Format.html#isIntFormat"><span class="hs-identifier hs-var">isIntFormat</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682872081"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2314"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682872088"><span class="annot"><span class="annottext">w :: Width
</span><a href="#local-6989586621682872088"><span class="hs-identifier hs-var hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Format -&gt; Width
</span><a href="GHC.CmmToAsm.Format.html#formatToWidth"><span class="hs-identifier hs-var">formatToWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682872081"><span class="hs-identifier hs-var">format</span></a></span><span>
</span><span id="line-2315"></span><span>          </span><span id="local-6989586621682872089"><span class="annot"><span class="annottext">bytes :: Int
</span><a href="#local-6989586621682872089"><span class="hs-identifier hs-var hs-var">bytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Int
</span><a href="GHC.Cmm.Type.html#widthInBits"><span class="hs-identifier hs-var">widthInBits</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682872088"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span>
</span><span id="line-2316"></span><span>          </span><span id="local-6989586621682872090"><span class="annot"><span class="annottext">space :: Int
</span><a href="#local-6989586621682872090"><span class="hs-identifier hs-var hs-var">space</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682872078"><span class="hs-identifier hs-var">pack</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872089"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span>
</span><span id="line-2317"></span><span>          </span><span id="local-6989586621682872091"><span class="annot"><span class="annottext">stackSpace' :: Int
</span><a href="#local-6989586621682872091"><span class="hs-identifier hs-var hs-var">stackSpace'</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682872078"><span class="hs-identifier hs-var">pack</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872085"><span class="hs-identifier hs-var">stackSpace</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872090"><span class="hs-identifier hs-var">space</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872085"><span class="hs-identifier hs-var">stackSpace</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872090"><span class="hs-identifier hs-var">space</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872085"><span class="hs-identifier hs-var">stackSpace</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872090"><span class="hs-identifier hs-var">space</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2318"></span><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872085"><span class="hs-identifier hs-var">stackSpace</span></a></span><span>
</span><span id="line-2319"></span><span>          </span><span id="local-6989586621682872092"><span class="annot"><span class="annottext">str :: Instr
</span><a href="#local-6989586621682872092"><span class="hs-identifier hs-var hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Format -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#STR"><span class="hs-identifier hs-var">STR</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682872081"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682872088"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682872080"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddrMode -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reg -&gt; Imm -&gt; AddrMode
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Reg
</span><a href="GHC.Platform.Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">31</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872091"><span class="hs-identifier hs-var">stackSpace'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2320"></span><span>          </span><span id="local-6989586621682872093"><span class="annot"><span class="annottext">stackCode :: OrdList Instr
</span><a href="#local-6989586621682872093"><span class="hs-identifier hs-var hs-var">stackCode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682872083"><span class="hs-identifier hs-var">code_r</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span>
</span><span id="line-2321"></span><span>                      </span><span class="annot"><span class="annottext">SDoc -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#ann"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Pass argument (size &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682872088"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;) on the stack: &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Reg -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682872080"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Instr
</span><a href="#local-6989586621682872092"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-2322"></span><span>      </span><span class="annot"><span class="annottext">Bool
-&gt; [Reg]
-&gt; [Reg]
-&gt; [(Reg, Format, ForeignHint, OrdList Instr)]
-&gt; Int
-&gt; [Reg]
-&gt; OrdList Instr
-&gt; NatM (Int, [Reg], OrdList Instr)
</span><a href="#local-6989586621682871615"><span class="hs-identifier hs-var">passArguments</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682872078"><span class="hs-identifier hs-var">pack</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Reg]
</span><a href="#local-6989586621682872079"><span class="hs-identifier hs-var">fpRegs</span></a></span><span> </span><span class="annot"><span class="annottext">[(Reg, Format, ForeignHint, OrdList Instr)]
</span><a href="#local-6989586621682872084"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872091"><span class="hs-identifier hs-var">stackSpace'</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872090"><span class="hs-identifier hs-var">space</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Reg]
</span><a href="#local-6989586621682872086"><span class="hs-identifier hs-var">accumRegs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682872093"><span class="hs-identifier hs-var">stackCode</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682872087"><span class="hs-identifier hs-var">accumCode</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2323"></span><span>
</span><span id="line-2324"></span><span>    </span><span class="hs-comment">-- Still have gpRegs left, but want to pass a FP argument. Must be passed on the stack then.</span><span>
</span><span id="line-2325"></span><span>    </span><span class="annot"><a href="#local-6989586621682871615"><span class="hs-identifier hs-var">passArguments</span></a></span><span> </span><span id="local-6989586621682872094"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682872094"><span class="hs-identifier hs-var">pack</span></a></span></span><span> </span><span id="local-6989586621682872095"><span class="annot"><span class="annottext">[Reg]
</span><a href="#local-6989586621682872095"><span class="hs-identifier hs-var">gpRegs</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682872096"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682872096"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682872097"><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682872097"><span class="hs-identifier hs-var">format</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682872098"><span class="annot"><span class="annottext">ForeignHint
</span><a href="#local-6989586621682872098"><span class="hs-identifier hs-var">_hint</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682872099"><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682872099"><span class="hs-identifier hs-var">code_r</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682872100"><span class="annot"><span class="annottext">[(Reg, Format, ForeignHint, OrdList Instr)]
</span><a href="#local-6989586621682872100"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682872101"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872101"><span class="hs-identifier hs-var">stackSpace</span></a></span></span><span> </span><span id="local-6989586621682872102"><span class="annot"><span class="annottext">[Reg]
</span><a href="#local-6989586621682872102"><span class="hs-identifier hs-var">accumRegs</span></a></span></span><span> </span><span id="local-6989586621682872103"><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682872103"><span class="hs-identifier hs-var">accumCode</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Format -&gt; Bool
</span><a href="GHC.CmmToAsm.Format.html#isFloatFormat"><span class="hs-identifier hs-var">isFloatFormat</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682872097"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2326"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682872104"><span class="annot"><span class="annottext">w :: Width
</span><a href="#local-6989586621682872104"><span class="hs-identifier hs-var hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Format -&gt; Width
</span><a href="GHC.CmmToAsm.Format.html#formatToWidth"><span class="hs-identifier hs-var">formatToWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682872097"><span class="hs-identifier hs-var">format</span></a></span><span>
</span><span id="line-2327"></span><span>          </span><span id="local-6989586621682872105"><span class="annot"><span class="annottext">bytes :: Int
</span><a href="#local-6989586621682872105"><span class="hs-identifier hs-var hs-var">bytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Int
</span><a href="GHC.Cmm.Type.html#widthInBits"><span class="hs-identifier hs-var">widthInBits</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682872104"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span>
</span><span id="line-2328"></span><span>          </span><span id="local-6989586621682872106"><span class="annot"><span class="annottext">space :: Int
</span><a href="#local-6989586621682872106"><span class="hs-identifier hs-var hs-var">space</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682872094"><span class="hs-identifier hs-var">pack</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872105"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span>
</span><span id="line-2329"></span><span>          </span><span id="local-6989586621682872107"><span class="annot"><span class="annottext">stackSpace' :: Int
</span><a href="#local-6989586621682872107"><span class="hs-identifier hs-var hs-var">stackSpace'</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682872094"><span class="hs-identifier hs-var">pack</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872101"><span class="hs-identifier hs-var">stackSpace</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872106"><span class="hs-identifier hs-var">space</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872101"><span class="hs-identifier hs-var">stackSpace</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872106"><span class="hs-identifier hs-var">space</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872101"><span class="hs-identifier hs-var">stackSpace</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872106"><span class="hs-identifier hs-var">space</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2330"></span><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872101"><span class="hs-identifier hs-var">stackSpace</span></a></span><span>
</span><span id="line-2331"></span><span>          </span><span id="local-6989586621682872108"><span class="annot"><span class="annottext">str :: Instr
</span><a href="#local-6989586621682872108"><span class="hs-identifier hs-var hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Format -&gt; Operand -&gt; Operand -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#STR"><span class="hs-identifier hs-var">STR</span></a></span><span> </span><span class="annot"><span class="annottext">Format
</span><a href="#local-6989586621682872097"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682872104"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682872096"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddrMode -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reg -&gt; Imm -&gt; AddrMode
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Reg
</span><a href="GHC.Platform.Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">31</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Imm
</span><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872107"><span class="hs-identifier hs-var">stackSpace'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2332"></span><span>          </span><span id="local-6989586621682872109"><span class="annot"><span class="annottext">stackCode :: OrdList Instr
</span><a href="#local-6989586621682872109"><span class="hs-identifier hs-var hs-var">stackCode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682872099"><span class="hs-identifier hs-var">code_r</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span>
</span><span id="line-2333"></span><span>                      </span><span class="annot"><span class="annottext">SDoc -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#ann"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Pass argument (size &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682872104"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;) on the stack: &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Reg -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682872096"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Instr
</span><a href="#local-6989586621682872108"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-2334"></span><span>      </span><span class="annot"><span class="annottext">Bool
-&gt; [Reg]
-&gt; [Reg]
-&gt; [(Reg, Format, ForeignHint, OrdList Instr)]
-&gt; Int
-&gt; [Reg]
-&gt; OrdList Instr
-&gt; NatM (Int, [Reg], OrdList Instr)
</span><a href="#local-6989586621682871615"><span class="hs-identifier hs-var">passArguments</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682872094"><span class="hs-identifier hs-var">pack</span></a></span><span> </span><span class="annot"><span class="annottext">[Reg]
</span><a href="#local-6989586621682872095"><span class="hs-identifier hs-var">gpRegs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[(Reg, Format, ForeignHint, OrdList Instr)]
</span><a href="#local-6989586621682872100"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872107"><span class="hs-identifier hs-var">stackSpace'</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872106"><span class="hs-identifier hs-var">space</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Reg]
</span><a href="#local-6989586621682872102"><span class="hs-identifier hs-var">accumRegs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682872109"><span class="hs-identifier hs-var">stackCode</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682872103"><span class="hs-identifier hs-var">accumCode</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2335"></span><span>
</span><span id="line-2336"></span><span>    </span><span class="annot"><a href="#local-6989586621682871615"><span class="hs-identifier hs-var">passArguments</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Reg]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Reg]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[(Reg, Format, ForeignHint, OrdList Instr)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Reg]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; NatM (Int, [Reg], OrdList Instr)
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;passArguments&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;invalid state&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-2337"></span><span>
</span><span id="line-2338"></span><span>    </span><span class="annot"><a href="#local-6989586621682871622"><span class="hs-identifier hs-type">readResults</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Platform.Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Platform.Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Reg.html#LocalReg"><span class="hs-identifier hs-type">LocalReg</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Platform.Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a></span><span class="hs-special">]</span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2339"></span><span>    </span><span id="local-6989586621682871622"><span class="annot"><span class="annottext">readResults :: [Reg]
-&gt; [Reg]
-&gt; [CmmFormal]
-&gt; [Reg]
-&gt; OrdList Instr
-&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871622"><span class="hs-identifier hs-var hs-var">readResults</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Reg]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Reg]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Reg]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682872111"><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682872111"><span class="hs-identifier hs-var">accumCode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; NatM (OrdList Instr)
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682872111"><span class="hs-identifier hs-var">accumCode</span></a></span><span>
</span><span id="line-2340"></span><span>    </span><span class="annot"><a href="#local-6989586621682871622"><span class="hs-identifier hs-var">readResults</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Reg]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[CmmFormal]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Reg]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2341"></span><span>      </span><span id="local-6989586621682872112"><span class="annot"><a href="#local-6989586621682872112"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NatM Platform
</span><a href="GHC.CmmToAsm.Monad.html#getPlatform"><span class="hs-identifier hs-var">getPlatform</span></a></span><span>
</span><span id="line-2342"></span><span>      </span><span class="annot"><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-type">pprPanic</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;genCCall, out of gp registers when reading results&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-type">pdoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682872112"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871585"><span class="hs-identifier hs-type">target</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2343"></span><span>    </span><span class="annot"><a href="#local-6989586621682871622"><span class="hs-identifier hs-var">readResults</span></a></span><span> </span><span class="annot"><span class="annottext">[Reg]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[CmmFormal]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Reg]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2344"></span><span>      </span><span id="local-6989586621682872113"><span class="annot"><a href="#local-6989586621682872113"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NatM Platform
</span><a href="GHC.CmmToAsm.Monad.html#getPlatform"><span class="hs-identifier hs-var">getPlatform</span></a></span><span>
</span><span id="line-2345"></span><span>      </span><span class="annot"><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-type">pprPanic</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;genCCall, out of fp registers when reading results&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#pdoc"><span class="hs-identifier hs-type">pdoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682872113"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682871585"><span class="hs-identifier hs-type">target</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2346"></span><span>    </span><span class="annot"><a href="#local-6989586621682871622"><span class="hs-identifier hs-var">readResults</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682872114"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682872114"><span class="hs-identifier hs-var">gpReg</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682872115"><span class="annot"><span class="annottext">[Reg]
</span><a href="#local-6989586621682872115"><span class="hs-identifier hs-var">gpRegs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682872116"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682872116"><span class="hs-identifier hs-var">fpReg</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682872117"><span class="annot"><span class="annottext">[Reg]
</span><a href="#local-6989586621682872117"><span class="hs-identifier hs-var">fpRegs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682872118"><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682872118"><span class="hs-identifier hs-var">dst</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682872119"><span class="annot"><span class="annottext">[CmmFormal]
</span><a href="#local-6989586621682872119"><span class="hs-identifier hs-var">dsts</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682872120"><span class="annot"><span class="annottext">[Reg]
</span><a href="#local-6989586621682872120"><span class="hs-identifier hs-var">accumRegs</span></a></span></span><span> </span><span id="local-6989586621682872121"><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682872121"><span class="hs-identifier hs-var">accumCode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2347"></span><span>      </span><span class="hs-comment">-- gp/fp reg -&gt; dst</span><span>
</span><span id="line-2348"></span><span>      </span><span id="local-6989586621682872122"><span class="annot"><a href="#local-6989586621682872122"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NatM Platform
</span><a href="GHC.CmmToAsm.Monad.html#getPlatform"><span class="hs-identifier hs-var">getPlatform</span></a></span><span>
</span><span id="line-2349"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682872123"><span class="annot"><a href="#local-6989586621682872123"><span class="hs-identifier hs-var hs-var">rep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmReg -&gt; CmmType
</span><a href="GHC.Cmm.Reg.html#cmmRegType"><span class="hs-identifier hs-var">cmmRegType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmFormal -&gt; CmmReg
</span><a href="GHC.Cmm.Reg.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a></span><span> </span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682872118"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2350"></span><span>          </span><span id="local-6989586621682872124"><span class="annot"><a href="#local-6989586621682872124"><span class="hs-identifier hs-var hs-var">format</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmType -&gt; Format
</span><a href="GHC.CmmToAsm.Format.html#cmmTypeFormat"><span class="hs-identifier hs-var">cmmTypeFormat</span></a></span><span> </span><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682872123"><span class="hs-identifier hs-var">rep</span></a></span><span>
</span><span id="line-2351"></span><span>          </span><span id="local-6989586621682872125"><span class="annot"><a href="#local-6989586621682872125"><span class="hs-identifier hs-var hs-var">w</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmReg -&gt; Width
</span><a href="GHC.Cmm.Reg.html#cmmRegWidth"><span class="hs-identifier hs-var">cmmRegWidth</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmFormal -&gt; CmmReg
</span><a href="GHC.Cmm.Reg.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a></span><span> </span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682872118"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2352"></span><span>          </span><span id="local-6989586621682872126"><span class="annot"><a href="#local-6989586621682872126"><span class="hs-identifier hs-var hs-var">r_dst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmReg -&gt; Reg
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682872122"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmFormal -&gt; CmmReg
</span><a href="GHC.Cmm.Reg.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a></span><span> </span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682872118"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2353"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Format.html#isFloatFormat"><span class="hs-identifier hs-type">isFloatFormat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682872124"><span class="hs-identifier hs-type">format</span></a></span><span>
</span><span id="line-2354"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="#local-6989586621682871622"><span class="hs-identifier hs-type">readResults</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682872114"><span class="hs-identifier hs-type">gpReg</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><a href="#local-6989586621682872115"><span class="hs-identifier hs-type">gpRegs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682872117"><span class="hs-identifier hs-type">fpRegs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682872119"><span class="hs-identifier hs-type">dsts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682872116"><span class="hs-identifier hs-type">fpReg</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><a href="#local-6989586621682872120"><span class="hs-identifier hs-type">accumRegs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682872121"><span class="hs-identifier hs-type">accumCode</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-type">`snocOL`</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#MOV"><span class="hs-identifier hs-type">MOV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682872125"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682872126"><span class="hs-identifier hs-type">r_dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682872125"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682872116"><span class="hs-identifier hs-type">fpReg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2355"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="#local-6989586621682871622"><span class="hs-identifier hs-type">readResults</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682872115"><span class="hs-identifier hs-type">gpRegs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682872116"><span class="hs-identifier hs-type">fpReg</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><a href="#local-6989586621682872117"><span class="hs-identifier hs-type">fpRegs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682872119"><span class="hs-identifier hs-type">dsts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682872114"><span class="hs-identifier hs-type">gpReg</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><a href="#local-6989586621682872120"><span class="hs-identifier hs-type">accumRegs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682872121"><span class="hs-identifier hs-type">accumCode</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-type">`snocOL`</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#MOV"><span class="hs-identifier hs-type">MOV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682872125"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682872126"><span class="hs-identifier hs-type">r_dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-type">OpReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682872125"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682872114"><span class="hs-identifier hs-type">gpReg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2356"></span><span>
</span><span id="line-2357"></span><span>    </span><span id="local-6989586621682871661"><span class="annot"><span class="annottext">unaryFloatOp :: Width
-&gt; (Operand -&gt; Operand -&gt; OrdList Instr)
-&gt; CmmExpr
-&gt; CmmFormal
-&gt; NatM (OrdList Instr)
</span><a href="#local-6989586621682871661"><span class="hs-identifier hs-var hs-var">unaryFloatOp</span></a></span></span><span> </span><span id="local-6989586621682872131"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682872131"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682872132"><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; OrdList Instr
</span><a href="#local-6989586621682872132"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621682872133"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682872133"><span class="hs-identifier hs-var">arg_reg</span></a></span></span><span> </span><span id="local-6989586621682872134"><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682872134"><span class="hs-identifier hs-var">dest_reg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2358"></span><span>      </span><span id="local-6989586621682872135"><span class="annot"><a href="#local-6989586621682872135"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NatM Platform
</span><a href="GHC.CmmToAsm.Monad.html#getPlatform"><span class="hs-identifier hs-var">getPlatform</span></a></span><span>
</span><span id="line-2359"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682872136"><span class="annot"><a href="#local-6989586621682872136"><span class="hs-identifier hs-var">reg_fx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682872137"><span class="annot"><a href="#local-6989586621682872137"><span class="hs-identifier hs-var">_format_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682872138"><span class="annot"><a href="#local-6989586621682872138"><span class="hs-identifier hs-var">code_fx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getFloatReg"><span class="hs-identifier hs-type">getFloatReg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682872133"><span class="hs-identifier hs-type">arg_reg</span></a></span><span>
</span><span id="line-2360"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682872139"><span class="annot"><a href="#local-6989586621682872139"><span class="hs-identifier hs-var hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmReg -&gt; Reg
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682872135"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmFormal -&gt; CmmReg
</span><a href="GHC.Cmm.Reg.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a></span><span> </span><span class="annot"><span class="annottext">CmmFormal
</span><a href="#local-6989586621682872134"><span class="hs-identifier hs-var">dest_reg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2361"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682872140"><span class="annot"><a href="#local-6989586621682872140"><span class="hs-identifier hs-var hs-var">code</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrdList Instr
</span><a href="#local-6989586621682872138"><span class="hs-identifier hs-var">code_fx</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList Instr -&gt; OrdList Instr -&gt; OrdList Instr
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; OrdList Instr
</span><a href="#local-6989586621682872132"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682872131"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682872139"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Reg -&gt; Operand
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682872131"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621682872136"><span class="hs-identifier hs-var">reg_fx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2362"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682872140"><span class="hs-identifier hs-type">code</span></a></span><span>
</span><span id="line-2363"></span><span>
</span><span id="line-2364"></span><span class="hs-comment">{- Note [AArch64 far jumps]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
AArch conditional jump instructions can only encode an offset of +/-1MB
which is usually enough but can be exceeded in edge cases. In these cases
we will replace:

  b.cond &lt;cond&gt; foo

with the sequence:

  b.cond &lt;cond&gt; &lt;lbl_true&gt;
  b &lt;lbl_false&gt;
  &lt;lbl_true&gt;:
  b foo
  &lt;lbl_false&gt;:

Note the encoding of the `b` instruction still limits jumps to
+/-128M offsets, but that seems like an acceptable limitation.

Since AArch64 instructions are all of equal length we can reasonably estimate jumps
in range by counting the instructions between a jump and its target label.

We make some simplifications in the name of performance which can result in overestimating
jump &lt;-&gt; label offsets:

* To avoid having to recalculate the label offsets once we replaced a jump we simply
  assume all jumps will be expanded to a three instruction far jump sequence.
* For labels associated with a info table we assume the info table is 64byte large.
  Most info tables are smaller than that but it means we don't have to distinguish
  between multiple types of info tables.

In terms of implementation we walk the instruction stream at least once calculating
label offsets, and if we determine during this that the functions body is big enough
to potentially contain out of range jumps we walk the instructions a second time, replacing
out of range jumps with the sequence of instructions described above.

-}</span><span>
</span><span id="line-2401"></span><span>
</span><span id="line-2402"></span><span class="hs-comment">-- See Note [AArch64 far jumps]</span><span>
</span><span id="line-2403"></span><span class="hs-keyword">data</span><span> </span><span id="BlockInRange"><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#BlockInRange"><span class="hs-identifier hs-var">BlockInRange</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="InRange"><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#InRange"><span class="hs-identifier hs-var">InRange</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="NotInRange"><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#NotInRange"><span class="hs-identifier hs-var">NotInRange</span></a></span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#Target"><span class="hs-identifier hs-type">Target</span></a></span><span>
</span><span id="line-2404"></span><span>
</span><span id="line-2405"></span><span class="hs-comment">-- See Note [AArch64 far jumps]</span><span>
</span><span id="line-2406"></span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#makeFarBranches"><span class="hs-identifier hs-type">makeFarBranches</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelMap"><span class="hs-identifier hs-type">LabelMap</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#RawCmmStatics"><span class="hs-identifier hs-type">RawCmmStatics</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.CmmToAsm.Types.html#NatBasicBlock"><span class="hs-identifier hs-type">NatBasicBlock</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2407"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSM.html#UniqDSM"><span class="hs-identifier hs-type">UniqDSM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.CmmToAsm.Types.html#NatBasicBlock"><span class="hs-identifier hs-type">NatBasicBlock</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2408"></span><span id="makeFarBranches"><span class="annot"><span class="annottext">makeFarBranches :: Platform
-&gt; LabelMap RawCmmStatics
-&gt; [NatBasicBlock Instr]
-&gt; UniqDSM [NatBasicBlock Instr]
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#makeFarBranches"><span class="hs-identifier hs-var hs-var">makeFarBranches</span></a></span></span><span> </span><span class="hs-comment">{- only used when debugging -}</span><span> </span><span id="local-6989586621682872143"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682872143"><span class="hs-identifier hs-var">_platform</span></a></span></span><span> </span><span id="local-6989586621682872144"><span class="annot"><span class="annottext">LabelMap RawCmmStatics
</span><a href="#local-6989586621682872144"><span class="hs-identifier hs-var">statics</span></a></span></span><span> </span><span id="local-6989586621682872145"><span class="annot"><span class="annottext">[NatBasicBlock Instr]
</span><a href="#local-6989586621682872145"><span class="hs-identifier hs-var">basic_blocks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2409"></span><span>  </span><span class="hs-comment">-- All offsets/positions are counted in multiples of 4 bytes (the size of AArch64 instructions)</span><span>
</span><span id="line-2410"></span><span>  </span><span class="hs-comment">-- That is an offset of 1 represents a 4-byte/one instruction offset.</span><span>
</span><span id="line-2411"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682872146"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872146"><span class="hs-identifier hs-var">func_size</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682872147"><span class="annot"><span class="annottext">LabelMap Int
</span><a href="#local-6989586621682872147"><span class="hs-identifier hs-var">lblMap</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Int, LabelMap Int) -&gt; NatBasicBlock Instr -&gt; (Int, LabelMap Int))
-&gt; (Int, LabelMap Int)
-&gt; [NatBasicBlock Instr]
-&gt; (Int, LabelMap Int)
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">(Int, LabelMap Int) -&gt; NatBasicBlock Instr -&gt; (Int, LabelMap Int)
</span><a href="#local-6989586621682872148"><span class="hs-identifier hs-var">calc_lbl_positions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LabelMap Int
forall v. LabelMap v
</span><a href="GHC.Cmm.Dataflow.Label.html#mapEmpty"><span class="hs-identifier hs-var">mapEmpty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NatBasicBlock Instr]
</span><a href="#local-6989586621682872145"><span class="hs-identifier hs-var">basic_blocks</span></a></span><span>
</span><span id="line-2412"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872146"><span class="hs-identifier hs-var">func_size</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872150"><span class="hs-identifier hs-var">max_jump_dist</span></a></span><span>
</span><span id="line-2413"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[NatBasicBlock Instr] -&gt; UniqDSM [NatBasicBlock Instr]
forall a. a -&gt; UniqDSM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">[NatBasicBlock Instr]
</span><a href="#local-6989586621682872145"><span class="hs-identifier hs-var">basic_blocks</span></a></span><span>
</span><span id="line-2414"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2415"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621682872151"><span class="annot"><a href="#local-6989586621682872151"><span class="hs-identifier hs-var">blocks</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int
 -&gt; NatBasicBlock Instr -&gt; UniqDSM (Int, [NatBasicBlock Instr]))
-&gt; Int
-&gt; [NatBasicBlock Instr]
-&gt; UniqDSM (Int, [[NatBasicBlock Instr]])
forall (m :: * -&gt; *) (t :: * -&gt; *) acc x y.
(Monad m, Traversable t) =&gt;
(acc -&gt; x -&gt; m (acc, y)) -&gt; acc -&gt; t x -&gt; m (acc, t y)
</span><a href="GHC.Utils.Monad.html#mapAccumLM"><span class="hs-identifier hs-var">mapAccumLM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LabelMap Int
-&gt; Int
-&gt; NatBasicBlock Instr
-&gt; UniqDSM (Int, [NatBasicBlock Instr])
</span><a href="#local-6989586621682872152"><span class="hs-identifier hs-var">replace_blk</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap Int
</span><a href="#local-6989586621682872147"><span class="hs-identifier hs-var">lblMap</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">[NatBasicBlock Instr]
</span><a href="#local-6989586621682872145"><span class="hs-identifier hs-var">basic_blocks</span></a></span><span>
</span><span id="line-2416"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">concat</span></span><span> </span><span class="annot"><a href="#local-6989586621682872151"><span class="hs-identifier hs-type">blocks</span></a></span><span>
</span><span id="line-2417"></span><span>      </span><span class="hs-comment">-- pprTrace &quot;lblMap&quot; (ppr lblMap) $ basic_blocks</span><span>
</span><span id="line-2418"></span><span>
</span><span id="line-2419"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2420"></span><span>    </span><span class="hs-comment">-- 2^18, 19 bit immediate with one bit is reserved for the sign</span><span>
</span><span id="line-2421"></span><span>    </span><span id="local-6989586621682872150"><span class="annot"><span class="annottext">max_jump_dist :: Int
</span><a href="#local-6989586621682872150"><span class="hs-identifier hs-var hs-var">max_jump_dist</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^</span></span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">18</span></span><span class="hs-glyph">::</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-2422"></span><span>    </span><span class="hs-comment">-- Currently all inline info tables fit into 64 bytes.</span><span>
</span><span id="line-2423"></span><span>    </span><span id="local-6989586621682872158"><span class="annot"><span class="annottext">max_info_size :: Int
</span><a href="#local-6989586621682872158"><span class="hs-identifier hs-var hs-var">max_info_size</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-2424"></span><span>    </span><span id="local-6989586621682872159"><span class="annot"><span class="annottext">long_bc_jump_size :: Int
</span><a href="#local-6989586621682872159"><span class="hs-identifier hs-var hs-var">long_bc_jump_size</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-2425"></span><span>    </span><span id="local-6989586621682872160"><span class="annot"><span class="annottext">long_bz_jump_size :: Int
</span><a href="#local-6989586621682872160"><span class="hs-identifier hs-var hs-var">long_bz_jump_size</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-2426"></span><span>
</span><span id="line-2427"></span><span>    </span><span class="hs-comment">-- Replace out of range conditional jumps with unconditional jumps.</span><span>
</span><span id="line-2428"></span><span>    </span><span class="annot"><a href="#local-6989586621682872152"><span class="hs-identifier hs-type">replace_blk</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelMap"><span class="hs-identifier hs-type">LabelMap</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.html#GenBasicBlock"><span class="hs-identifier hs-type">GenBasicBlock</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSM.html#UniqDSM"><span class="hs-identifier hs-type">UniqDSM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.html#GenBasicBlock"><span class="hs-identifier hs-type">GenBasicBlock</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2429"></span><span>    </span><span id="local-6989586621682872152"><span class="annot"><span class="annottext">replace_blk :: LabelMap Int
-&gt; Int
-&gt; NatBasicBlock Instr
-&gt; UniqDSM (Int, [NatBasicBlock Instr])
</span><a href="#local-6989586621682872152"><span class="hs-identifier hs-var hs-var">replace_blk</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682872161"><span class="annot"><span class="annottext">LabelMap Int
</span><a href="#local-6989586621682872161"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682872162"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872162"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#BasicBlock"><span class="hs-identifier hs-type">BasicBlock</span></a></span><span> </span><span id="local-6989586621682872163"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682872163"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span id="local-6989586621682872164"><span class="annot"><span class="annottext">[Instr]
</span><a href="#local-6989586621682872164"><span class="hs-identifier hs-var">instrs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2430"></span><span>      </span><span class="hs-comment">-- Account for a potential info table before the label.</span><span>
</span><span id="line-2431"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682872165"><span class="annot"><span class="annottext">block_pos :: Int
</span><a href="#local-6989586621682872165"><span class="hs-identifier hs-var hs-var hs-var">block_pos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872162"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; Int
</span><a href="#local-6989586621682872166"><span class="hs-identifier hs-var">infoTblSize_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682872163"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-2432"></span><span>      </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621682872167"><span class="annot"><a href="#local-6989586621682872167"><span class="hs-identifier hs-var">pos'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682872168"><span class="annot"><a href="#local-6989586621682872168"><span class="hs-identifier hs-var">instrs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Instr -&gt; UniqDSM (Int, [Instr]))
-&gt; Int -&gt; [Instr] -&gt; UniqDSM (Int, [[Instr]])
forall (m :: * -&gt; *) (t :: * -&gt; *) acc x y.
(Monad m, Traversable t) =&gt;
(acc -&gt; x -&gt; m (acc, y)) -&gt; acc -&gt; t x -&gt; m (acc, t y)
</span><a href="GHC.Utils.Monad.html#mapAccumLM"><span class="hs-identifier hs-var">mapAccumLM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LabelMap Int -&gt; Int -&gt; Instr -&gt; UniqDSM (Int, [Instr])
</span><a href="#local-6989586621682872169"><span class="hs-identifier hs-var">replace_jump</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap Int
</span><a href="#local-6989586621682872161"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872165"><span class="hs-identifier hs-var">block_pos</span></a></span><span> </span><span class="annot"><span class="annottext">[Instr]
</span><a href="#local-6989586621682872164"><span class="hs-identifier hs-var">instrs</span></a></span><span>
</span><span id="line-2433"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682872170"><span class="annot"><a href="#local-6989586621682872170"><span class="hs-identifier hs-var hs-var">instrs''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[Instr]] -&gt; [Instr]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">[[Instr]]
</span><a href="#local-6989586621682872168"><span class="hs-identifier hs-var">instrs'</span></a></span><span>
</span><span id="line-2434"></span><span>      </span><span class="hs-comment">-- We might have introduced new labels, so split the instructions into basic blocks again if neccesary.</span><span>
</span><span id="line-2435"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682872171"><span class="annot"><a href="#local-6989586621682872171"><span class="hs-identifier hs-var">top</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682872172"><span class="annot"><a href="#local-6989586621682872172"><span class="hs-identifier hs-var">split_blocks</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682872173"><span class="annot"><a href="#local-6989586621682872173"><span class="hs-identifier hs-var">no_data</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">foldr</span></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#mkBlocks"><span class="hs-identifier hs-type">mkBlocks</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682872170"><span class="hs-identifier hs-type">instrs''</span></a></span><span>
</span><span id="line-2436"></span><span>      </span><span class="hs-comment">-- There should be no data in the instruction stream at this point</span><span>
</span><span id="line-2437"></span><span>      </span><span class="annot"><a href="GHC.Utils.Panic.Plain.html#massert"><span class="hs-identifier hs-type">massert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621682872173"><span class="hs-identifier hs-type">no_data</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2438"></span><span>
</span><span id="line-2439"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682872177"><span class="annot"><a href="#local-6989586621682872177"><span class="hs-identifier hs-var hs-var">final_blocks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; [Instr] -&gt; NatBasicBlock Instr
forall i. BlockId -&gt; [i] -&gt; GenBasicBlock i
</span><a href="GHC.Cmm.html#BasicBlock"><span class="hs-identifier hs-var">BasicBlock</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682872163"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">[Instr]
</span><a href="#local-6989586621682872171"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">NatBasicBlock Instr
-&gt; [NatBasicBlock Instr] -&gt; [NatBasicBlock Instr]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[NatBasicBlock Instr]
</span><a href="#local-6989586621682872172"><span class="hs-identifier hs-var">split_blocks</span></a></span><span>
</span><span id="line-2440"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682872167"><span class="hs-identifier hs-type">pos'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682872177"><span class="hs-identifier hs-type">final_blocks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2441"></span><span>
</span><span id="line-2442"></span><span>    </span><span class="annot"><a href="#local-6989586621682872169"><span class="hs-identifier hs-type">replace_jump</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelMap"><span class="hs-identifier hs-type">LabelMap</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSM.html#UniqDSM"><span class="hs-identifier hs-type">UniqDSM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2443"></span><span>    </span><span id="local-6989586621682872169"><span class="annot"><span class="annottext">replace_jump :: LabelMap Int -&gt; Int -&gt; Instr -&gt; UniqDSM (Int, [Instr])
</span><a href="#local-6989586621682872169"><span class="hs-identifier hs-var hs-var">replace_jump</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682872178"><span class="annot"><span class="annottext">LabelMap Int
</span><a href="#local-6989586621682872178"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682872179"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872179"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span id="local-6989586621682872180"><span class="annot"><span class="annottext">Instr
</span><a href="#local-6989586621682872180"><span class="hs-identifier hs-var">instr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2444"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Instr
</span><a href="#local-6989586621682872180"><span class="hs-identifier hs-var">instr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2445"></span><span>        </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#ANN"><span class="hs-identifier hs-type">ANN</span></a></span><span> </span><span id="local-6989586621682872181"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682872181"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621682872182"><span class="annot"><span class="annottext">Instr
</span><a href="#local-6989586621682872182"><span class="hs-identifier hs-var">instr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2446"></span><span>          </span><span class="annot"><span class="annottext">LabelMap Int -&gt; Int -&gt; Instr -&gt; UniqDSM (Int, [Instr])
</span><a href="#local-6989586621682872169"><span class="hs-identifier hs-var">replace_jump</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap Int
</span><a href="#local-6989586621682872178"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872179"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">Instr
</span><a href="#local-6989586621682872182"><span class="hs-identifier hs-var">instr</span></a></span><span> </span><span class="annot"><span class="annottext">UniqDSM (Int, [Instr])
-&gt; ((Int, [Instr]) -&gt; UniqDSM (Int, [Instr]))
-&gt; UniqDSM (Int, [Instr])
forall a b. UniqDSM a -&gt; (a -&gt; UniqDSM b) -&gt; UniqDSM b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-2447"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682872183"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872183"><span class="hs-identifier hs-var">idx</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682872184"><span class="annot"><span class="annottext">Instr
</span><a href="#local-6989586621682872184"><span class="hs-identifier hs-var">instr'</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682872185"><span class="annot"><span class="annottext">[Instr]
</span><a href="#local-6989586621682872185"><span class="hs-identifier hs-var">instrs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2448"></span><span>              </span><span class="annot"><span class="annottext">(Int, [Instr]) -&gt; UniqDSM (Int, [Instr])
forall a. a -&gt; UniqDSM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872183"><span class="hs-identifier hs-var">idx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Instr -&gt; Instr
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#ANN"><span class="hs-identifier hs-var">ANN</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682872181"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Instr
</span><a href="#local-6989586621682872184"><span class="hs-identifier hs-var">instr'</span></a></span><span class="annot"><span class="annottext">Instr -&gt; [Instr] -&gt; [Instr]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Instr]
</span><a href="#local-6989586621682872185"><span class="hs-identifier hs-var">instrs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2449"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682872186"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872186"><span class="hs-identifier hs-var">idx</span></a></span></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; UniqDSM (Int, [Instr])
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;replace_jump&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;empty return list for &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872186"><span class="hs-identifier hs-var">idx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2450"></span><span>        </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#BCOND"><span class="hs-identifier hs-type">BCOND</span></a></span><span> </span><span id="local-6989586621682872187"><span class="annot"><span class="annottext">Cond
</span><a href="#local-6989586621682872187"><span class="hs-identifier hs-var">cond</span></a></span></span><span> </span><span id="local-6989586621682872188"><span class="annot"><span class="annottext">Target
</span><a href="#local-6989586621682872188"><span class="hs-identifier hs-var">t</span></a></span></span><span>
</span><span id="line-2451"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LabelMap Int -&gt; Target -&gt; Int -&gt; BlockInRange
</span><a href="#local-6989586621682872189"><span class="hs-identifier hs-var">target_in_range</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap Int
</span><a href="#local-6989586621682872178"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Target
</span><a href="#local-6989586621682872188"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872179"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2452"></span><span>              </span><span class="annot"><span class="annottext">BlockInRange
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#InRange"><span class="hs-identifier hs-var">InRange</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Int, [Instr]) -&gt; UniqDSM (Int, [Instr])
forall a. a -&gt; UniqDSM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872179"><span class="hs-identifier hs-var">pos</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872159"><span class="hs-identifier hs-var">long_bc_jump_size</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="annot"><span class="annottext">Instr
</span><a href="#local-6989586621682872180"><span class="hs-identifier hs-var">instr</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2453"></span><span>              </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#NotInRange"><span class="hs-identifier hs-type">NotInRange</span></a></span><span> </span><span id="local-6989586621682872190"><span class="annot"><span class="annottext">Target
</span><a href="#local-6989586621682872190"><span class="hs-identifier hs-var">far_target</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2454"></span><span>                </span><span id="local-6989586621682872191"><span class="annot"><a href="#local-6989586621682872191"><span class="hs-identifier hs-var">jmp_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cond -&gt; Target -&gt; UniqDSM (OrdList Instr)
forall (m :: * -&gt; *).
MonadGetUnique m =&gt;
Cond -&gt; Target -&gt; m (OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#genCondFarJump"><span class="hs-identifier hs-var">genCondFarJump</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="#local-6989586621682872187"><span class="hs-identifier hs-var">cond</span></a></span><span> </span><span class="annot"><span class="annottext">Target
</span><a href="#local-6989586621682872190"><span class="hs-identifier hs-var">far_target</span></a></span><span>
</span><span id="line-2455"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682872179"><span class="hs-identifier hs-type">pos</span></a></span><span class="annot"><span class="hs-operator hs-type">+</span></span><span class="annot"><a href="#local-6989586621682872159"><span class="hs-identifier hs-type">long_bc_jump_size</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#fromOL"><span class="hs-identifier hs-type">fromOL</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682872191"><span class="hs-identifier hs-type">jmp_code</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2456"></span><span>        </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#CBZ"><span class="hs-identifier hs-type">CBZ</span></a></span><span> </span><span id="local-6989586621682872193"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682872193"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621682872194"><span class="annot"><span class="annottext">Target
</span><a href="#local-6989586621682872194"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Target -&gt; Cond -&gt; UniqDSM (Int, [Instr])
</span><a href="#local-6989586621682872195"><span class="hs-identifier hs-var">long_zero_jump</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682872193"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Target
</span><a href="#local-6989586621682872194"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="GHC.CmmToAsm.AArch64.Cond.html#EQ"><span class="hs-identifier hs-var">EQ</span></a></span><span>
</span><span id="line-2457"></span><span>        </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#CBNZ"><span class="hs-identifier hs-type">CBNZ</span></a></span><span> </span><span id="local-6989586621682872196"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682872196"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621682872197"><span class="annot"><span class="annottext">Target
</span><a href="#local-6989586621682872197"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Target -&gt; Cond -&gt; UniqDSM (Int, [Instr])
</span><a href="#local-6989586621682872195"><span class="hs-identifier hs-var">long_zero_jump</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682872196"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Target
</span><a href="#local-6989586621682872197"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="GHC.CmmToAsm.AArch64.Cond.html#NE"><span class="hs-identifier hs-var">NE</span></a></span><span>
</span><span id="line-2458"></span><span>        </span><span id="local-6989586621682872198"><span class="annot"><span class="annottext">Instr
</span><a href="#local-6989586621682872198"><span class="hs-identifier hs-var">instr</span></a></span></span><span>
</span><span id="line-2459"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; Bool
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#isMetaInstr"><span class="hs-identifier hs-var">isMetaInstr</span></a></span><span> </span><span class="annot"><span class="annottext">Instr
</span><a href="#local-6989586621682872198"><span class="hs-identifier hs-var">instr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Int, [Instr]) -&gt; UniqDSM (Int, [Instr])
forall a. a -&gt; UniqDSM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872179"><span class="hs-identifier hs-var">pos</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="annot"><span class="annottext">Instr
</span><a href="#local-6989586621682872198"><span class="hs-identifier hs-var">instr</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2460"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Int, [Instr]) -&gt; UniqDSM (Int, [Instr])
forall a. a -&gt; UniqDSM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872179"><span class="hs-identifier hs-var">pos</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Instr
</span><a href="#local-6989586621682872198"><span class="hs-identifier hs-var">instr</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2461"></span><span>
</span><span id="line-2462"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2463"></span><span>        </span><span class="hs-comment">-- cmp_op: EQ = CBZ, NEQ = CBNZ</span><span>
</span><span id="line-2464"></span><span>        </span><span id="local-6989586621682872195"><span class="annot"><span class="annottext">long_zero_jump :: Operand -&gt; Target -&gt; Cond -&gt; UniqDSM (Int, [Instr])
</span><a href="#local-6989586621682872195"><span class="hs-identifier hs-var hs-var">long_zero_jump</span></a></span></span><span> </span><span id="local-6989586621682872200"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621682872200"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621682872201"><span class="annot"><span class="annottext">Target
</span><a href="#local-6989586621682872201"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682872202"><span class="annot"><span class="annottext">Cond
</span><a href="#local-6989586621682872202"><span class="hs-identifier hs-var">cmp_op</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2465"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LabelMap Int -&gt; Target -&gt; Int -&gt; BlockInRange
</span><a href="#local-6989586621682872189"><span class="hs-identifier hs-var">target_in_range</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap Int
</span><a href="#local-6989586621682872178"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Target
</span><a href="#local-6989586621682872201"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872179"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2466"></span><span>              </span><span class="annot"><span class="annottext">BlockInRange
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#InRange"><span class="hs-identifier hs-var">InRange</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Int, [Instr]) -&gt; UniqDSM (Int, [Instr])
forall a. a -&gt; UniqDSM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872179"><span class="hs-identifier hs-var">pos</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872160"><span class="hs-identifier hs-var">long_bz_jump_size</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="annot"><span class="annottext">Instr
</span><a href="#local-6989586621682872180"><span class="hs-identifier hs-var">instr</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2467"></span><span>              </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#NotInRange"><span class="hs-identifier hs-type">NotInRange</span></a></span><span> </span><span id="local-6989586621682872203"><span class="annot"><span class="annottext">Target
</span><a href="#local-6989586621682872203"><span class="hs-identifier hs-var">far_target</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2468"></span><span>                </span><span id="local-6989586621682872204"><span class="annot"><a href="#local-6989586621682872204"><span class="hs-identifier hs-var">jmp_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cond -&gt; Target -&gt; UniqDSM (OrdList Instr)
forall (m :: * -&gt; *).
MonadGetUnique m =&gt;
Cond -&gt; Target -&gt; m (OrdList Instr)
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#genCondFarJump"><span class="hs-identifier hs-var">genCondFarJump</span></a></span><span> </span><span class="annot"><span class="annottext">Cond
</span><a href="#local-6989586621682872202"><span class="hs-identifier hs-var">cmp_op</span></a></span><span> </span><span class="annot"><span class="annottext">Target
</span><a href="#local-6989586621682872203"><span class="hs-identifier hs-var">far_target</span></a></span><span>
</span><span id="line-2469"></span><span>                </span><span class="hs-comment">-- TODO: Fix zero reg so we can use it here</span><span>
</span><span id="line-2470"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682872179"><span class="hs-identifier hs-type">pos</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><a href="#local-6989586621682872160"><span class="hs-identifier hs-type">long_bz_jump_size</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#CMP"><span class="hs-identifier hs-type">CMP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682872200"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#OpImm"><span class="hs-identifier hs-type">OpImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Regs.html#ImmInt"><span class="hs-identifier hs-type">ImmInt</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#fromOL"><span class="hs-identifier hs-type">fromOL</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682872204"><span class="hs-identifier hs-type">jmp_code</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2471"></span><span>
</span><span id="line-2472"></span><span>
</span><span id="line-2473"></span><span>    </span><span class="annot"><a href="#local-6989586621682872189"><span class="hs-identifier hs-type">target_in_range</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelMap"><span class="hs-identifier hs-type">LabelMap</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#Target"><span class="hs-identifier hs-type">Target</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#BlockInRange"><span class="hs-identifier hs-type">BlockInRange</span></a></span><span>
</span><span id="line-2474"></span><span>    </span><span id="local-6989586621682872189"><span class="annot"><span class="annottext">target_in_range :: LabelMap Int -&gt; Target -&gt; Int -&gt; BlockInRange
</span><a href="#local-6989586621682872189"><span class="hs-identifier hs-var hs-var">target_in_range</span></a></span></span><span> </span><span id="local-6989586621682872205"><span class="annot"><span class="annottext">LabelMap Int
</span><a href="#local-6989586621682872205"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682872206"><span class="annot"><span class="annottext">Target
</span><a href="#local-6989586621682872206"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span id="local-6989586621682872207"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872207"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2475"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Target
</span><a href="#local-6989586621682872206"><span class="hs-identifier hs-var">target</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2476"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#TReg"><span class="hs-identifier hs-type">TReg</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BlockInRange
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#InRange"><span class="hs-identifier hs-var">InRange</span></a></span><span>
</span><span id="line-2477"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#TBlock"><span class="hs-identifier hs-type">TBlock</span></a></span><span> </span><span id="local-6989586621682872208"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682872208"><span class="hs-identifier hs-var">bid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LabelMap Int -&gt; Int -&gt; BlockId -&gt; BlockInRange
</span><a href="#local-6989586621682872209"><span class="hs-identifier hs-var">block_in_range</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap Int
</span><a href="#local-6989586621682872205"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872207"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682872208"><span class="hs-identifier hs-var">bid</span></a></span><span>
</span><span id="line-2478"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#TLabel"><span class="hs-identifier hs-type">TLabel</span></a></span><span> </span><span id="local-6989586621682872210"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682872210"><span class="hs-identifier hs-var">clbl</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2479"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682872211"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682872211"><span class="hs-identifier hs-var">bid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; Maybe BlockId
</span><a href="GHC.Cmm.CLabel.html#maybeLocalBlockLabel"><span class="hs-identifier hs-var">maybeLocalBlockLabel</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682872210"><span class="hs-identifier hs-var">clbl</span></a></span><span>
</span><span id="line-2480"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LabelMap Int -&gt; Int -&gt; BlockId -&gt; BlockInRange
</span><a href="#local-6989586621682872209"><span class="hs-identifier hs-var">block_in_range</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap Int
</span><a href="#local-6989586621682872205"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872207"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682872211"><span class="hs-identifier hs-var">bid</span></a></span><span>
</span><span id="line-2481"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2482"></span><span>          </span><span class="hs-comment">-- Maybe we should be pessimistic here, for now just fixing intra proc jumps</span><span>
</span><span id="line-2483"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BlockInRange
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#InRange"><span class="hs-identifier hs-var">InRange</span></a></span><span>
</span><span id="line-2484"></span><span>
</span><span id="line-2485"></span><span>    </span><span class="annot"><a href="#local-6989586621682872209"><span class="hs-identifier hs-type">block_in_range</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelMap"><span class="hs-identifier hs-type">LabelMap</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.CodeGen.html#BlockInRange"><span class="hs-identifier hs-type">BlockInRange</span></a></span><span>
</span><span id="line-2486"></span><span>    </span><span id="local-6989586621682872209"><span class="annot"><span class="annottext">block_in_range :: LabelMap Int -&gt; Int -&gt; BlockId -&gt; BlockInRange
</span><a href="#local-6989586621682872209"><span class="hs-identifier hs-var hs-var">block_in_range</span></a></span></span><span> </span><span id="local-6989586621682872213"><span class="annot"><span class="annottext">LabelMap Int
</span><a href="#local-6989586621682872213"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682872214"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872214"><span class="hs-identifier hs-var">src_pos</span></a></span></span><span> </span><span id="local-6989586621682872215"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682872215"><span class="hs-identifier hs-var">dest_lbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2487"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; LabelMap Int -&gt; Maybe Int
forall a. BlockId -&gt; LabelMap a -&gt; Maybe a
</span><a href="GHC.Cmm.Dataflow.Label.html#mapLookup"><span class="hs-identifier hs-var">mapLookup</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682872215"><span class="hs-identifier hs-var">dest_lbl</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap Int
</span><a href="#local-6989586621682872213"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2488"></span><span>        </span><span class="annot"><span class="annottext">Maybe Int
</span><span class="hs-identifier hs-var">Nothing</span></span><span>       </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2489"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; BlockInRange -&gt; BlockInRange
forall a. String -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Trace.html#pprTrace"><span class="hs-identifier hs-var">pprTrace</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;not in range&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682872215"><span class="hs-identifier hs-var">dest_lbl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(BlockInRange -&gt; BlockInRange) -&gt; BlockInRange -&gt; BlockInRange
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2490"></span><span>            </span><span class="annot"><span class="annottext">Target -&gt; BlockInRange
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#NotInRange"><span class="hs-identifier hs-var">NotInRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockId -&gt; Target
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#TBlock"><span class="hs-identifier hs-var">TBlock</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682872215"><span class="hs-identifier hs-var">dest_lbl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2491"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682872218"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872218"><span class="hs-identifier hs-var">dest_pos</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">abs</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872218"><span class="hs-identifier hs-var">dest_pos</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872214"><span class="hs-identifier hs-var">src_pos</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872150"><span class="hs-identifier hs-var">max_jump_dist</span></a></span><span>
</span><span id="line-2492"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">BlockInRange
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#InRange"><span class="hs-identifier hs-var">InRange</span></a></span><span>
</span><span id="line-2493"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Target -&gt; BlockInRange
</span><a href="GHC.CmmToAsm.AArch64.CodeGen.html#NotInRange"><span class="hs-identifier hs-var">NotInRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockId -&gt; Target
</span><a href="GHC.CmmToAsm.AArch64.Instr.html#TBlock"><span class="hs-identifier hs-var">TBlock</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682872215"><span class="hs-identifier hs-var">dest_lbl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2494"></span><span>
</span><span id="line-2495"></span><span>    </span><span class="annot"><a href="#local-6989586621682872148"><span class="hs-identifier hs-type">calc_lbl_positions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelMap"><span class="hs-identifier hs-type">LabelMap</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.html#GenBasicBlock"><span class="hs-identifier hs-type">GenBasicBlock</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelMap"><span class="hs-identifier hs-type">LabelMap</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-2496"></span><span>    </span><span id="local-6989586621682872148"><span class="annot"><span class="annottext">calc_lbl_positions :: (Int, LabelMap Int) -&gt; NatBasicBlock Instr -&gt; (Int, LabelMap Int)
</span><a href="#local-6989586621682872148"><span class="hs-identifier hs-var hs-var">calc_lbl_positions</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682872220"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872220"><span class="hs-identifier hs-var">pos</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682872221"><span class="annot"><span class="annottext">LabelMap Int
</span><a href="#local-6989586621682872221"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#BasicBlock"><span class="hs-identifier hs-type">BasicBlock</span></a></span><span> </span><span id="local-6989586621682872222"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682872222"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span id="local-6989586621682872223"><span class="annot"><span class="annottext">[Instr]
</span><a href="#local-6989586621682872223"><span class="hs-identifier hs-var">instrs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2497"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682872224"><span class="annot"><span class="annottext">pos' :: Int
</span><a href="#local-6989586621682872224"><span class="hs-identifier hs-var hs-var">pos'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872220"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; Int
</span><a href="#local-6989586621682872166"><span class="hs-identifier hs-var">infoTblSize_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682872222"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-2498"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">((Int, LabelMap Int) -&gt; Instr -&gt; (Int, LabelMap Int))
-&gt; (Int, LabelMap Int) -&gt; [Instr] -&gt; (Int, LabelMap Int)
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">(Int, LabelMap Int) -&gt; Instr -&gt; (Int, LabelMap Int)
</span><a href="#local-6989586621682872225"><span class="hs-identifier hs-var">instr_pos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872224"><span class="hs-identifier hs-var">pos'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">BlockId -&gt; Int -&gt; LabelMap Int -&gt; LabelMap Int
forall v. BlockId -&gt; v -&gt; LabelMap v -&gt; LabelMap v
</span><a href="GHC.Cmm.Dataflow.Label.html#mapInsert"><span class="hs-identifier hs-var">mapInsert</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682872222"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872224"><span class="hs-identifier hs-var">pos'</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap Int
</span><a href="#local-6989586621682872221"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Instr]
</span><a href="#local-6989586621682872223"><span class="hs-identifier hs-var">instrs</span></a></span><span>
</span><span id="line-2499"></span><span>
</span><span id="line-2500"></span><span>    </span><span class="annot"><a href="#local-6989586621682872225"><span class="hs-identifier hs-type">instr_pos</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelMap"><span class="hs-identifier hs-type">LabelMap</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelMap"><span class="hs-identifier hs-type">LabelMap</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-2501"></span><span>    </span><span id="local-6989586621682872225"><span class="annot"><span class="annottext">instr_pos :: (Int, LabelMap Int) -&gt; Instr -&gt; (Int, LabelMap Int)
</span><a href="#local-6989586621682872225"><span class="hs-identifier hs-var hs-var">instr_pos</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682872227"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872227"><span class="hs-identifier hs-var">pos</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682872228"><span class="annot"><span class="annottext">LabelMap Int
</span><a href="#local-6989586621682872228"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682872229"><span class="annot"><span class="annottext">Instr
</span><a href="#local-6989586621682872229"><span class="hs-identifier hs-var">instr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2502"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Instr
</span><a href="#local-6989586621682872229"><span class="hs-identifier hs-var">instr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2503"></span><span>        </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#ANN"><span class="hs-identifier hs-type">ANN</span></a></span><span> </span><span id="local-6989586621682872230"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682872230"><span class="hs-identifier hs-var">_ann</span></a></span></span><span> </span><span id="local-6989586621682872231"><span class="annot"><span class="annottext">Instr
</span><a href="#local-6989586621682872231"><span class="hs-identifier hs-var">instr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Int, LabelMap Int) -&gt; Instr -&gt; (Int, LabelMap Int)
</span><a href="#local-6989586621682872225"><span class="hs-identifier hs-var">instr_pos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872227"><span class="hs-identifier hs-var">pos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LabelMap Int
</span><a href="#local-6989586621682872228"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Instr
</span><a href="#local-6989586621682872231"><span class="hs-identifier hs-var">instr</span></a></span><span>
</span><span id="line-2504"></span><span>        </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#NEWBLOCK"><span class="hs-identifier hs-type">NEWBLOCK</span></a></span><span> </span><span id="local-6989586621682872232"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682872232"><span class="hs-identifier hs-var">_bid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; (Int, LabelMap Int)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mkFarBranched - unexpected NEWBLOCK&quot;</span></span><span> </span><span class="hs-comment">-- At this point there should be no NEWBLOCK</span><span>
</span><span id="line-2505"></span><span>                                                                     </span><span class="hs-comment">-- in the instruction stream</span><span>
</span><span id="line-2506"></span><span>                                                                     </span><span class="hs-comment">-- (pos, mapInsert bid pos m)</span><span>
</span><span id="line-2507"></span><span>        </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#COMMENT"><span class="hs-identifier hs-type">COMMENT</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872227"><span class="hs-identifier hs-var">pos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LabelMap Int
</span><a href="#local-6989586621682872228"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2508"></span><span>        </span><span id="local-6989586621682872233"><span class="annot"><span class="annottext">Instr
</span><a href="#local-6989586621682872233"><span class="hs-identifier hs-var">instr</span></a></span></span><span>
</span><span id="line-2509"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682872234"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872234"><span class="hs-identifier hs-var">jump_size</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Instr -&gt; Maybe Int
</span><a href="#local-6989586621682872235"><span class="hs-identifier hs-var">is_expandable_jump</span></a></span><span> </span><span class="annot"><span class="annottext">Instr
</span><a href="#local-6989586621682872233"><span class="hs-identifier hs-var">instr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872227"><span class="hs-identifier hs-var">pos</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872234"><span class="hs-identifier hs-var">jump_size</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LabelMap Int
</span><a href="#local-6989586621682872228"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2510"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872227"><span class="hs-identifier hs-var">pos</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LabelMap Int
</span><a href="#local-6989586621682872228"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2511"></span><span>
</span><span id="line-2512"></span><span>    </span><span id="local-6989586621682872166"><span class="annot"><span class="annottext">infoTblSize_maybe :: BlockId -&gt; Int
</span><a href="#local-6989586621682872166"><span class="hs-identifier hs-var hs-var">infoTblSize_maybe</span></a></span></span><span> </span><span id="local-6989586621682872236"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682872236"><span class="hs-identifier hs-var">bid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2513"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; LabelMap RawCmmStatics -&gt; Maybe RawCmmStatics
forall a. BlockId -&gt; LabelMap a -&gt; Maybe a
</span><a href="GHC.Cmm.Dataflow.Label.html#mapLookup"><span class="hs-identifier hs-var">mapLookup</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682872236"><span class="hs-identifier hs-var">bid</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap RawCmmStatics
</span><a href="#local-6989586621682872144"><span class="hs-identifier hs-var">statics</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2514"></span><span>        </span><span class="annot"><span class="annottext">Maybe RawCmmStatics
</span><span class="hs-identifier hs-var">Nothing</span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-2515"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682872237"><span class="annot"><span class="annottext">RawCmmStatics
</span><a href="#local-6989586621682872237"><span class="hs-identifier hs-var">_info_static</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872158"><span class="hs-identifier hs-var">max_info_size</span></a></span><span>
</span><span id="line-2516"></span><span>
</span><span id="line-2517"></span><span>    </span><span class="hs-comment">-- These jumps have a 19bit immediate as offset which is quite</span><span>
</span><span id="line-2518"></span><span>    </span><span class="hs-comment">-- limiting so we potentially have to expand them into</span><span>
</span><span id="line-2519"></span><span>    </span><span class="hs-comment">-- multiple instructions.</span><span>
</span><span id="line-2520"></span><span>    </span><span id="local-6989586621682872235"><span class="annot"><span class="annottext">is_expandable_jump :: Instr -&gt; Maybe Int
</span><a href="#local-6989586621682872235"><span class="hs-identifier hs-var hs-var">is_expandable_jump</span></a></span></span><span> </span><span id="local-6989586621682872238"><span class="annot"><span class="annottext">Instr
</span><a href="#local-6989586621682872238"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Instr
</span><a href="#local-6989586621682872238"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2521"></span><span>      </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#CBZ"><span class="hs-identifier hs-type">CBZ</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872160"><span class="hs-identifier hs-var">long_bz_jump_size</span></a></span><span>
</span><span id="line-2522"></span><span>      </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#CBNZ"><span class="hs-identifier hs-type">CBNZ</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872160"><span class="hs-identifier hs-var">long_bz_jump_size</span></a></span><span>
</span><span id="line-2523"></span><span>      </span><span class="annot"><a href="GHC.CmmToAsm.AArch64.Instr.html#BCOND"><span class="hs-identifier hs-type">BCOND</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682872159"><span class="hs-identifier hs-var">long_bc_jump_size</span></a></span><span>
</span><span id="line-2524"></span><span>      </span><span class="annot"><span class="annottext">Instr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2525"></span></pre></body></html>