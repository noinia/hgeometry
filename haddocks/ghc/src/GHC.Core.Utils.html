<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998


Utility functions on @Core@ syntax
-}</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="annot"><span class="hs-comment">-- | Commonly useful utilities for manipulating the Core language</span></span><span>
</span><span id="line-10"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html"><span class="hs-identifier">GHC.Core.Utils</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-11"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Constructing expressions</span></span><span>
</span><span id="line-12"></span><span>        </span><span class="annot"><a href="GHC.Core.Utils.html#mkCast"><span class="hs-identifier">mkCast</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#mkCastMCo"><span class="hs-identifier">mkCastMCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#mkPiMCo"><span class="hs-identifier">mkPiMCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>        </span><span class="annot"><a href="GHC.Core.Utils.html#mkTick"><span class="hs-identifier">mkTick</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#mkTicks"><span class="hs-identifier">mkTicks</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#mkTickNoHNF"><span class="hs-identifier">mkTickNoHNF</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#tickHNFArgs"><span class="hs-identifier">tickHNFArgs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>        </span><span class="annot"><a href="GHC.Core.Utils.html#bindNonRec"><span class="hs-identifier">bindNonRec</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#needsCaseBinding"><span class="hs-identifier">needsCaseBinding</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#needsCaseBindingL"><span class="hs-identifier">needsCaseBindingL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>        </span><span class="annot"><a href="GHC.Core.Utils.html#mkAltExpr"><span class="hs-identifier">mkAltExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#mkDefaultCase"><span class="hs-identifier">mkDefaultCase</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#mkSingleAltCase"><span class="hs-identifier">mkSingleAltCase</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Taking expressions apart</span></span><span>
</span><span id="line-18"></span><span>        </span><span class="annot"><a href="GHC.Core.Utils.html#findDefault"><span class="hs-identifier">findDefault</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#addDefault"><span class="hs-identifier">addDefault</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#findAlt"><span class="hs-identifier">findAlt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#isDefaultAlt"><span class="hs-identifier">isDefaultAlt</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>        </span><span class="annot"><a href="GHC.Core.Utils.html#mergeAlts"><span class="hs-identifier">mergeAlts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#mergeCaseAlts"><span class="hs-identifier">mergeCaseAlts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#trimConArgs"><span class="hs-identifier">trimConArgs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>        </span><span class="annot"><a href="GHC.Core.Utils.html#filterAlts"><span class="hs-identifier">filterAlts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#combineIdenticalAlts"><span class="hs-identifier">combineIdenticalAlts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#refineDefaultAlt"><span class="hs-identifier">refineDefaultAlt</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>        </span><span class="annot"><a href="GHC.Core.Utils.html#scaleAltsBy"><span class="hs-identifier">scaleAltsBy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Properties of expressions</span></span><span>
</span><span id="line-24"></span><span>        </span><span class="annot"><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier">exprType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#coreAltType"><span class="hs-identifier">coreAltType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#coreAltsType"><span class="hs-identifier">coreAltsType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>        </span><span class="annot"><a href="GHC.Core.Utils.html#mkLamType"><span class="hs-identifier">mkLamType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#mkLamTypes"><span class="hs-identifier">mkLamTypes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>        </span><span class="annot"><a href="GHC.Core.Type.html#mkFunctionType"><span class="hs-identifier">mkFunctionType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>        </span><span class="annot"><a href="GHC.Core.Utils.html#exprIsTrivial"><span class="hs-identifier">exprIsTrivial</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#getIdFromTrivialExpr"><span class="hs-identifier">getIdFromTrivialExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#getIdFromTrivialExpr_maybe"><span class="hs-identifier">getIdFromTrivialExpr_maybe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>        </span><span class="annot"><a href="GHC.Core.Utils.html#trivial_expr_fold"><span class="hs-identifier">trivial_expr_fold</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>        </span><span class="annot"><a href="GHC.Core.Utils.html#exprIsDupable"><span class="hs-identifier">exprIsDupable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#exprIsCheap"><span class="hs-identifier">exprIsCheap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#exprIsExpandable"><span class="hs-identifier">exprIsExpandable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#exprIsCheapX"><span class="hs-identifier">exprIsCheapX</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#CheapAppFun"><span class="hs-identifier">CheapAppFun</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>        </span><span class="annot"><a href="GHC.Core.Utils.html#exprIsHNF"><span class="hs-identifier">exprIsHNF</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#exprOkForSpeculation"><span class="hs-identifier">exprOkForSpeculation</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#exprOkToDiscard"><span class="hs-identifier">exprOkToDiscard</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#exprOkForSpecEval"><span class="hs-identifier">exprOkForSpecEval</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>        </span><span class="annot"><a href="GHC.Core.Utils.html#exprIsWorkFree"><span class="hs-identifier">exprIsWorkFree</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#exprIsConLike"><span class="hs-identifier">exprIsConLike</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>        </span><span class="annot"><a href="GHC.Core.Utils.html#isCheapApp"><span class="hs-identifier">isCheapApp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#isExpandableApp"><span class="hs-identifier">isExpandableApp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#isSaturatedConApp"><span class="hs-identifier">isSaturatedConApp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>        </span><span class="annot"><a href="GHC.Core.Utils.html#exprIsTickedString"><span class="hs-identifier">exprIsTickedString</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#exprIsTickedString_maybe"><span class="hs-identifier">exprIsTickedString_maybe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>        </span><span class="annot"><a href="GHC.Core.Utils.html#exprIsTopLevelBindable"><span class="hs-identifier">exprIsTopLevelBindable</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>        </span><span class="annot"><a href="GHC.Core.Utils.html#altsAreExhaustive"><span class="hs-identifier">altsAreExhaustive</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#etaExpansionTick"><span class="hs-identifier">etaExpansionTick</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Equality</span></span><span>
</span><span id="line-38"></span><span>        </span><span class="annot"><a href="GHC.Core.Utils.html#cheapEqExpr"><span class="hs-identifier">cheapEqExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#cheapEqExpr%27"><span class="hs-identifier">cheapEqExpr'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#diffBinds"><span class="hs-identifier">diffBinds</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Manipulating data constructors and types</span></span><span>
</span><span id="line-41"></span><span>        </span><span class="annot"><a href="GHC.Core.html#exprToType"><span class="hs-identifier">exprToType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>        </span><span class="annot"><a href="GHC.Core.Utils.html#applyTypeToArgs"><span class="hs-identifier">applyTypeToArgs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>        </span><span class="annot"><a href="GHC.Core.Utils.html#dataConRepInstPat"><span class="hs-identifier">dataConRepInstPat</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#dataConRepFSInstPat"><span class="hs-identifier">dataConRepFSInstPat</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>        </span><span class="annot"><a href="GHC.Core.Utils.html#isEmptyTy"><span class="hs-identifier">isEmptyTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#normSplitTyConApp_maybe"><span class="hs-identifier">normSplitTyConApp_maybe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Working with ticks</span></span><span>
</span><span id="line-47"></span><span>        </span><span class="annot"><a href="GHC.Core.Utils.html#stripTicksTop"><span class="hs-identifier">stripTicksTop</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#stripTicksTopE"><span class="hs-identifier">stripTicksTopE</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#stripTicksTopT"><span class="hs-identifier">stripTicksTopT</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>        </span><span class="annot"><a href="GHC.Core.Utils.html#stripTicksE"><span class="hs-identifier">stripTicksE</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#stripTicksT"><span class="hs-identifier">stripTicksT</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span>        </span><span class="annot"><span class="hs-comment">-- * InScopeSet things which work over CoreBinds</span></span><span>
</span><span id="line-51"></span><span>        </span><span class="annot"><a href="GHC.Core.Utils.html#mkInScopeSetBndrs"><span class="hs-identifier">mkInScopeSetBndrs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#extendInScopeSetBind"><span class="hs-identifier">extendInScopeSetBind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#extendInScopeSetBndrs"><span class="hs-identifier">extendInScopeSetBndrs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span>        </span><span class="annot"><span class="hs-comment">-- * StaticPtr</span></span><span>
</span><span id="line-54"></span><span>        </span><span class="annot"><a href="GHC.Core.Utils.html#collectMakeStaticArgs"><span class="hs-identifier">collectMakeStaticArgs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Join points</span></span><span>
</span><span id="line-57"></span><span>        </span><span class="annot"><a href="GHC.Core.Utils.html#isJoinBind"><span class="hs-identifier">isJoinBind</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Tag inference</span></span><span>
</span><span id="line-60"></span><span>        </span><span class="annot"><a href="GHC.Core.Utils.html#mkStrictFieldSeqs"><span class="hs-identifier">mkStrictFieldSeqs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#shouldStrictifyIdForCbv"><span class="hs-identifier">shouldStrictifyIdForCbv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#shouldUseCbvForId"><span class="hs-identifier">shouldUseCbvForId</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span>        </span><span class="annot"><span class="hs-comment">-- * unsafeEqualityProof</span></span><span>
</span><span id="line-63"></span><span>        </span><span class="annot"><a href="GHC.Core.Utils.html#isUnsafeEqualityCase"><span class="hs-identifier">isUnsafeEqualityCase</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Dumping stuff</span></span><span>
</span><span id="line-66"></span><span>        </span><span class="annot"><a href="GHC.Core.Utils.html#dumpIdInfoOfProgram"><span class="hs-identifier">dumpIdInfoOfProgram</span></a></span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.html"><span class="hs-identifier">GHC.Platform</span></a></span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.html"><span class="hs-identifier">GHC.Core</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Ppr.html"><span class="hs-identifier">GHC.Core.Ppr</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.FVs.html"><span class="hs-identifier">GHC.Core.FVs</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.FVs.html#bindFreeVars"><span class="hs-identifier">bindFreeVars</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Type</span></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html"><span class="hs-identifier">GHC.Core.Predicate</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#isCoVarType"><span class="hs-identifier">isCoVarType</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html"><span class="hs-identifier">GHC.Core.FamInstEnv</span></a></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Compare.html"><span class="hs-identifier">GHC.Core.TyCo.Compare</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-identifier">eqType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Compare.html#eqTypeX"><span class="hs-identifier">eqTypeX</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html"><span class="hs-identifier">GHC.Core.Coercion</span></a></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html"><span class="hs-identifier">GHC.Core.Reduction</span></a></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Multiplicity.html"><span class="hs-identifier">GHC.Core.Multiplicity</span></a></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#makeStaticName"><span class="hs-identifier">makeStaticName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#unsafeEqualityProofIdKey"><span class="hs-identifier">unsafeEqualityProofIdKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#unsafeReflDataConKey"><span class="hs-identifier">unsafeReflDataConKey</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.PrimOps.html"><span class="hs-identifier">GHC.Builtin.PrimOps</span></a></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.html"><span class="hs-identifier">GHC.Types.Var</span></a></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html"><span class="hs-identifier">GHC.Types.Var.Env</span></a></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html"><span class="hs-identifier">GHC.Types.Var.Set</span></a></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Literal.html"><span class="hs-identifier">GHC.Types.Literal</span></a></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Tickish.html"><span class="hs-identifier">GHC.Types.Tickish</span></a></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html"><span class="hs-identifier">GHC.Types.Id.Info</span></a></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Arity"><span class="hs-identifier">Arity</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.html"><span class="hs-identifier">GHC.Types.Unique</span></a></span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html"><span class="hs-identifier">GHC.Types.Unique.Set</span></a></span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html"><span class="hs-identifier">GHC.Types.Demand</span></a></span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.RepType.html"><span class="hs-identifier">GHC.Types.RepType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.RepType.html#isZeroBitTy"><span class="hs-identifier">isZeroBitTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.List.SetOps.html"><span class="hs-identifier">GHC.Data.List.SetOps</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Data.List.SetOps.html#minusList"><span class="hs-identifier">minusList</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html"><span class="hs-identifier">GHC.Data.OrdList</span></a></span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Constants.html"><span class="hs-identifier">GHC.Utils.Constants</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Constants.html#debugIsOn"><span class="hs-identifier">debugIsOn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-111"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.html"><span class="hs-identifier">Data.ByteString</span></a></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier">ByteString</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Function.html"><span class="hs-identifier">Data.Function</span></a></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">on</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span>           </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">sort</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">sortBy</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">partition</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">zipWith4</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mapAccumL</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Ord.html"><span class="hs-identifier">Data.Ord</span></a></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">comparing</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">guard</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Find the type of a Core atom/expression}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="annot"><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-type">exprType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-129"></span><span class="hs-comment">-- ^ Recover the type of a well-typed Core expression. Fails when</span><span>
</span><span id="line-130"></span><span class="hs-comment">-- applied to the actual 'GHC.Core.Type' expression as it cannot</span><span>
</span><span id="line-131"></span><span class="hs-comment">-- really be said to have a type</span><span>
</span><span id="line-132"></span><span id="exprType"><span class="annot"><span class="annottext">exprType :: HasDebugCallStack =&gt; CoreExpr -&gt; Type
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var hs-var">exprType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682702463"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702463"><span class="hs-identifier hs-var">var</span></a></span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702463"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-133"></span><span class="annot"><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span id="local-6989586621682702466"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682702466"><span class="hs-identifier hs-var">lit</span></a></span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; Type
</span><a href="GHC.Types.Literal.html#literalType"><span class="hs-identifier hs-var">literalType</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682702466"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-134"></span><span class="annot"><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span id="local-6989586621682702469"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682702469"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionType"><span class="hs-identifier hs-var">coercionType</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682702469"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-135"></span><span class="annot"><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span id="local-6989586621682702472"><span class="annot"><span class="annottext">Bind Id
</span><a href="#local-6989586621682702472"><span class="hs-identifier hs-var">bind</span></a></span></span><span> </span><span id="local-6989586621682702473"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702473"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Core.html#NonRec"><span class="hs-identifier hs-type">NonRec</span></a></span><span> </span><span id="local-6989586621682702475"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702475"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621682702476"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702476"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bind Id
</span><a href="#local-6989586621682702472"><span class="hs-identifier hs-var">bind</span></a></span><span>    </span><span class="hs-comment">-- See Note [Type bindings]</span><span>
</span><span id="line-137"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span id="local-6989586621682702477"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702477"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702476"><span class="hs-identifier hs-var">rhs</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; [Type] -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTyWithUnchecked"><span class="hs-identifier hs-var">substTyWithUnchecked</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702475"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702477"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoreExpr -&gt; Type
CoreExpr -&gt; Type
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702473"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoreExpr -&gt; Type
CoreExpr -&gt; Type
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702473"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-139"></span><span class="annot"><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Case"><span class="hs-identifier hs-type">Case</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682702480"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702480"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702480"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-140"></span><span class="annot"><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Cast"><span class="hs-identifier hs-type">Cast</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682702482"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682702482"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Type
Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionRKind"><span class="hs-identifier hs-var">coercionRKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682702482"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-141"></span><span class="annot"><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-type">Tick</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682702485"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702485"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoreExpr -&gt; Type
CoreExpr -&gt; Type
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702485"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-142"></span><span class="annot"><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-type">Lam</span></a></span><span> </span><span id="local-6989586621682702487"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702487"><span class="hs-identifier hs-var">binder</span></a></span></span><span> </span><span id="local-6989586621682702488"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702488"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Id -&gt; Type -&gt; Type
Id -&gt; Type -&gt; Type
</span><a href="GHC.Core.Utils.html#mkLamType"><span class="hs-identifier hs-var">mkLamType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702487"><span class="hs-identifier hs-var">binder</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoreExpr -&gt; Type
CoreExpr -&gt; Type
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702488"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span class="annot"><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span id="local-6989586621682702489"><span class="annot"><span class="annottext">e :: CoreExpr
</span><a href="#local-6989586621682702489"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#App"><span class="hs-identifier hs-type">App</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; (CoreExpr, [CoreExpr])
forall b. Expr b -&gt; (Expr b, [Expr b])
</span><a href="GHC.Core.html#collectArgs"><span class="hs-identifier hs-var">collectArgs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702489"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-145"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682702492"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702492"><span class="hs-identifier hs-var">fun</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682702493"><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682702493"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; SDoc -&gt; Type -&gt; [CoreExpr] -&gt; Type
SDoc -&gt; Type -&gt; [CoreExpr] -&gt; Type
</span><a href="GHC.Core.Utils.html#applyTypeToArgs"><span class="hs-identifier hs-var">applyTypeToArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; SDoc
forall b. OutputableBndr b =&gt; Expr b -&gt; SDoc
</span><a href="GHC.Core.Ppr.html#pprCoreExpr"><span class="hs-identifier hs-var">pprCoreExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702489"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoreExpr -&gt; Type
CoreExpr -&gt; Type
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702492"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682702493"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-146"></span><span class="annot"><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span id="local-6989586621682702495"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702495"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; Type
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;exprType&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702495"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span class="annot"><a href="GHC.Core.Utils.html#coreAltType"><span class="hs-identifier hs-type">coreAltType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreAlt"><span class="hs-identifier hs-type">CoreAlt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-149"></span><span class="annot"><span class="hs-comment">-- ^ Returns the type of the alternatives right hand side</span></span><span>
</span><span id="line-150"></span><span id="coreAltType"><span class="annot"><span class="annottext">coreAltType :: Alt Id -&gt; Type
</span><a href="GHC.Core.Utils.html#coreAltType"><span class="hs-identifier hs-var hs-var">coreAltType</span></a></span></span><span> </span><span id="local-6989586621682702499"><span class="annot"><span class="annottext">alt :: Alt Id
</span><a href="#local-6989586621682702499"><span class="hs-identifier hs-var">alt</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682702501"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682702501"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span id="local-6989586621682702502"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702502"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Type -&gt; Maybe Type
</span><a href="GHC.Core.TyCo.FVs.html#occCheckExpand"><span class="hs-identifier hs-var">occCheckExpand</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682702501"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702504"><span class="hs-identifier hs-var">rhs_ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-152"></span><span>      </span><span class="hs-comment">-- Note [Existential variables and silly type synonyms]</span><span>
</span><span id="line-153"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682702505"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702505"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702505"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-154"></span><span>      </span><span class="annot"><span class="annottext">Maybe Type
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; Type
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;coreAltType&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Alt Id -&gt; SDoc
forall a. OutputableBndr a =&gt; Alt a -&gt; SDoc
</span><a href="GHC.Core.Ppr.html#pprCoreAlt"><span class="hs-identifier hs-var">pprCoreAlt</span></a></span><span> </span><span class="annot"><span class="annottext">Alt Id
</span><a href="#local-6989586621682702499"><span class="hs-identifier hs-var">alt</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702504"><span class="hs-identifier hs-var">rhs_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-156"></span><span>    </span><span id="local-6989586621682702504"><span class="annot"><span class="annottext">rhs_ty :: Type
</span><a href="#local-6989586621682702504"><span class="hs-identifier hs-var hs-var">rhs_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoreExpr -&gt; Type
CoreExpr -&gt; Type
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702502"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span class="annot"><a href="GHC.Core.Utils.html#coreAltsType"><span class="hs-identifier hs-type">coreAltsType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreAlt"><span class="hs-identifier hs-type">CoreAlt</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-159"></span><span class="annot"><span class="hs-comment">-- ^ Returns the type of the first alternative, which should be the same as for all alternatives</span></span><span>
</span><span id="line-160"></span><span id="coreAltsType"><span class="annot"><span class="annottext">coreAltsType :: [Alt Id] -&gt; Type
</span><a href="GHC.Core.Utils.html#coreAltsType"><span class="hs-identifier hs-var hs-var">coreAltsType</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682702508"><span class="annot"><span class="annottext">Alt Id
</span><a href="#local-6989586621682702508"><span class="hs-identifier hs-var">alt</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[Alt Id]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Alt Id -&gt; Type
</span><a href="GHC.Core.Utils.html#coreAltType"><span class="hs-identifier hs-var">coreAltType</span></a></span><span> </span><span class="annot"><span class="annottext">Alt Id
</span><a href="#local-6989586621682702508"><span class="hs-identifier hs-var">alt</span></a></span><span>
</span><span id="line-161"></span><span class="annot"><a href="GHC.Core.Utils.html#coreAltsType"><span class="hs-identifier hs-var">coreAltsType</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Type
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;coreAltsType&quot;</span></span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="annot"><a href="GHC.Core.Utils.html#mkLamType"><span class="hs-identifier hs-type">mkLamType</span></a></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-164"></span><span class="hs-comment">-- ^ Makes a @(-&gt;)@ type or an implicit forall type, depending</span><span>
</span><span id="line-165"></span><span class="hs-comment">-- on whether it is given a type variable or a term variable.</span><span>
</span><span id="line-166"></span><span class="hs-comment">-- This is used, for example, when producing the type of a lambda.</span><span>
</span><span id="line-167"></span><span class="hs-comment">--</span><span>
</span><span id="line-168"></span><span class="annot"><a href="GHC.Core.Utils.html#mkLamTypes"><span class="hs-identifier hs-type">mkLamTypes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-169"></span><span class="annot"><span class="hs-comment">-- ^ 'mkLamType' for multiple type or value arguments</span></span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span id="mkLamType"><span class="annot"><span class="annottext">mkLamType :: HasDebugCallStack =&gt; Id -&gt; Type -&gt; Type
</span><a href="GHC.Core.Utils.html#mkLamType"><span class="hs-identifier hs-var hs-var">mkLamType</span></a></span></span><span> </span><span id="local-6989586621682702513"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702513"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621682702514"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702514"><span class="hs-identifier hs-var">body_ty</span></a></span></span><span>
</span><span id="line-172"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702513"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-173"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForAllTyBinder -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkForAllTy"><span class="hs-identifier hs-var">mkForAllTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; ForAllTyFlag -&gt; ForAllTyBinder
forall var argf. var -&gt; argf -&gt; VarBndr var argf
</span><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702513"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="Language.Haskell.Syntax.Specificity.html#coreTyLamForAllTyFlag"><span class="hs-identifier hs-var">coreTyLamForAllTyFlag</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702514"><span class="hs-identifier hs-var">body_ty</span></a></span><span>
</span><span id="line-174"></span><span>     </span><span class="hs-comment">-- coreTyLamForAllTyFlag: see Note [Required foralls in Core]</span><span>
</span><span id="line-175"></span><span>     </span><span class="hs-comment">--                        in GHC.Core.TyCo.Rep</span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Var.html#isCoVar"><span class="hs-identifier hs-var">isCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702513"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-178"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702513"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702514"><span class="hs-identifier hs-var">body_ty</span></a></span><span>
</span><span id="line-179"></span><span>     </span><span class="hs-comment">-- See Note [Unused coercion variable in ForAllTy] in GHC.Core.TyCo.Rep</span><span>
</span><span id="line-180"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForAllTyBinder -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkForAllTy"><span class="hs-identifier hs-var">mkForAllTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; ForAllTyFlag -&gt; ForAllTyBinder
forall var argf. var -&gt; argf -&gt; VarBndr var argf
</span><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702513"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="Language.Haskell.Syntax.Specificity.html#coreTyLamForAllTyFlag"><span class="hs-identifier hs-var">coreTyLamForAllTyFlag</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702514"><span class="hs-identifier hs-var">body_ty</span></a></span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-183"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type -&gt; Type -&gt; Type
Type -&gt; Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#mkFunctionType"><span class="hs-identifier hs-var">mkFunctionType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Var.html#varMult"><span class="hs-identifier hs-var">varMult</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702513"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Var.html#varType"><span class="hs-identifier hs-var">varType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702513"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702514"><span class="hs-identifier hs-var">body_ty</span></a></span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span id="mkLamTypes"><span class="annot"><span class="annottext">mkLamTypes :: [Id] -&gt; Type -&gt; Type
</span><a href="GHC.Core.Utils.html#mkLamTypes"><span class="hs-identifier hs-var hs-var">mkLamTypes</span></a></span></span><span> </span><span id="local-6989586621682702524"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682702524"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span id="local-6989586621682702525"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702525"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Type -&gt; Type) -&gt; Type -&gt; [Id] -&gt; Type
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Id -&gt; Type -&gt; Type
Id -&gt; Type -&gt; Type
</span><a href="GHC.Core.Utils.html#mkLamType"><span class="hs-identifier hs-var">mkLamType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702525"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682702524"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span class="hs-comment">{-
Note [Type bindings]
~~~~~~~~~~~~~~~~~~~~
Core does allow type bindings, although such bindings are
not much used, except in the output of the desugarer.
Example:
     let a = Int in (\x:a. x)
Given this, exprType must be careful to substitute 'a' in the
result type (#8522).

Note [Existential variables and silly type synonyms]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider
        data T = forall a. T (Funny a)
        type Funny a = Bool
        f :: T -&gt; Bool
        f (T x) = x

Now, the type of 'x' is (Funny a), where 'a' is existentially quantified.
That means that 'exprType' and 'coreAltsType' may give a result that *appears*
to mention an out-of-scope type variable.  See #3409 for a more real-world
example.

Various possibilities suggest themselves:

 - Ignore the problem, and make Lint not complain about such variables

 - Expand all type synonyms (or at least all those that discard arguments)
      This is tricky, because at least for top-level things we want to
      retain the type the user originally specified.

 - Expand synonyms on the fly, when the problem arises. That is what
   we are doing here.  It's not too expensive, I think.

Note that there might be existentially quantified coercion variables, too.
-}</span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span class="annot"><a href="GHC.Core.Utils.html#applyTypeToArgs"><span class="hs-identifier hs-type">applyTypeToArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-225"></span><span class="annot"><span class="hs-comment">-- ^ Determines the type resulting from applying an expression with given type</span></span><span>
</span><span id="line-226"></span><span class="hs-comment">--- to given argument expressions.</span><span>
</span><span id="line-227"></span><span class="hs-comment">-- The first argument is just for debugging, and gives some context</span><span>
</span><span id="line-228"></span><span id="applyTypeToArgs"><span class="annot"><span class="annottext">applyTypeToArgs :: HasDebugCallStack =&gt; SDoc -&gt; Type -&gt; [CoreExpr] -&gt; Type
</span><a href="GHC.Core.Utils.html#applyTypeToArgs"><span class="hs-identifier hs-var hs-var">applyTypeToArgs</span></a></span></span><span> </span><span id="local-6989586621682702543"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682702543"><span class="hs-identifier hs-var">pp_e</span></a></span></span><span> </span><span id="local-6989586621682702544"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702544"><span class="hs-identifier hs-var">op_ty</span></a></span></span><span> </span><span id="local-6989586621682702545"><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682702545"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-229"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; [CoreExpr] -&gt; Type
</span><a href="#local-6989586621682702546"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702544"><span class="hs-identifier hs-var">op_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682702545"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-230"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-231"></span><span>    </span><span id="local-6989586621682702546"><span class="annot"><span class="annottext">go :: Type -&gt; [CoreExpr] -&gt; Type
</span><a href="#local-6989586621682702546"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621682702547"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702547"><span class="hs-identifier hs-var">op_ty</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702547"><span class="hs-identifier hs-var">op_ty</span></a></span><span>
</span><span id="line-232"></span><span>    </span><span class="annot"><a href="#local-6989586621682702546"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682702548"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702548"><span class="hs-identifier hs-var">op_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span id="local-6989586621682702549"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702549"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682702550"><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682702550"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; [CoreExpr] -&gt; Type
</span><a href="#local-6989586621682702551"><span class="hs-identifier hs-var">go_ty_args</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702548"><span class="hs-identifier hs-var">op_ty</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702549"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682702550"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-233"></span><span>    </span><span class="annot"><a href="#local-6989586621682702546"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682702552"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702552"><span class="hs-identifier hs-var">op_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span id="local-6989586621682702553"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682702553"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682702554"><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682702554"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; [CoreExpr] -&gt; Type
</span><a href="#local-6989586621682702551"><span class="hs-identifier hs-var">go_ty_args</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702552"><span class="hs-identifier hs-var">op_ty</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Type.html#mkCoercionTy"><span class="hs-identifier hs-var">mkCoercionTy</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682702553"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682702554"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-234"></span><span>    </span><span class="annot"><a href="#local-6989586621682702546"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682702556"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702556"><span class="hs-identifier hs-var">op_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682702557"><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682702557"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunTyFlag
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682702558"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702558"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (FunTyFlag, Type, Type, Type)
</span><a href="GHC.Core.Type.html#splitFunTy_maybe"><span class="hs-identifier hs-var">splitFunTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702556"><span class="hs-identifier hs-var">op_ty</span></a></span><span>
</span><span id="line-235"></span><span>                                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; [CoreExpr] -&gt; Type
</span><a href="#local-6989586621682702546"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702558"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682702557"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-236"></span><span>    </span><span class="annot"><a href="#local-6989586621682702546"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682702560"><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682702560"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; Type
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;applyTypeToArgs&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoreExpr] -&gt; SDoc
</span><a href="#local-6989586621682702561"><span class="hs-identifier hs-var">panic_msg</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682702560"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span>    </span><span class="hs-comment">-- go_ty_args: accumulate type arguments so we can</span><span>
</span><span id="line-239"></span><span>    </span><span class="hs-comment">-- instantiate all at once with piResultTys</span><span>
</span><span id="line-240"></span><span>    </span><span id="local-6989586621682702551"><span class="annot"><span class="annottext">go_ty_args :: Type -&gt; [Type] -&gt; [CoreExpr] -&gt; Type
</span><a href="#local-6989586621682702551"><span class="hs-identifier hs-var hs-var">go_ty_args</span></a></span></span><span> </span><span id="local-6989586621682702562"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702562"><span class="hs-identifier hs-var">op_ty</span></a></span></span><span> </span><span id="local-6989586621682702563"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682702563"><span class="hs-identifier hs-var">rev_tys</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span id="local-6989586621682702564"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702564"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682702565"><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682702565"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; [CoreExpr] -&gt; Type
</span><a href="#local-6989586621682702551"><span class="hs-identifier hs-var">go_ty_args</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702562"><span class="hs-identifier hs-var">op_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702564"><span class="hs-identifier hs-var">ty</span></a></span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; [Type]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682702563"><span class="hs-identifier hs-var">rev_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682702565"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-242"></span><span>    </span><span class="annot"><a href="#local-6989586621682702551"><span class="hs-identifier hs-var">go_ty_args</span></a></span><span> </span><span id="local-6989586621682702566"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702566"><span class="hs-identifier hs-var">op_ty</span></a></span></span><span> </span><span id="local-6989586621682702567"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682702567"><span class="hs-identifier hs-var">rev_tys</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span id="local-6989586621682702568"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682702568"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682702569"><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682702569"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; [CoreExpr] -&gt; Type
</span><a href="#local-6989586621682702551"><span class="hs-identifier hs-var">go_ty_args</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702566"><span class="hs-identifier hs-var">op_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Type.html#mkCoercionTy"><span class="hs-identifier hs-var">mkCoercionTy</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682702568"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; [Type]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682702567"><span class="hs-identifier hs-var">rev_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682702569"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-244"></span><span>    </span><span class="annot"><a href="#local-6989586621682702551"><span class="hs-identifier hs-var">go_ty_args</span></a></span><span> </span><span id="local-6989586621682702570"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702570"><span class="hs-identifier hs-var">op_ty</span></a></span></span><span> </span><span id="local-6989586621682702571"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682702571"><span class="hs-identifier hs-var">rev_tys</span></a></span></span><span> </span><span id="local-6989586621682702572"><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682702572"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-245"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; [CoreExpr] -&gt; Type
</span><a href="#local-6989586621682702546"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; [Type] -&gt; Type
Type -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#piResultTys"><span class="hs-identifier hs-var">piResultTys</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702570"><span class="hs-identifier hs-var">op_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type] -&gt; [Type]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682702571"><span class="hs-identifier hs-var">rev_tys</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682702572"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span>    </span><span id="local-6989586621682702561"><span class="annot"><span class="annottext">panic_msg :: [CoreExpr] -&gt; SDoc
</span><a href="#local-6989586621682702561"><span class="hs-identifier hs-var hs-var">panic_msg</span></a></span></span><span> </span><span id="local-6989586621682702575"><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682702575"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expression:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682702543"><span class="hs-identifier hs-var">pp_e</span></a></span><span>
</span><span id="line-248"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Type:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702544"><span class="hs-identifier hs-var">op_ty</span></a></span><span>
</span><span id="line-249"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Args:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682702545"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-250"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Args':&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682702575"><span class="hs-keyword hs-var">as</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span class="annot"><a href="GHC.Core.Utils.html#mkCastMCo"><span class="hs-identifier hs-type">mkCastMCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercionR"><span class="hs-identifier hs-type">MCoercionR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-253"></span><span id="mkCastMCo"><span class="annot"><span class="annottext">mkCastMCo :: CoreExpr -&gt; MCoercionR -&gt; CoreExpr
</span><a href="GHC.Core.Utils.html#mkCastMCo"><span class="hs-identifier hs-var hs-var">mkCastMCo</span></a></span></span><span> </span><span id="local-6989586621682702579"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702579"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">MCoercionR
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702579"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-254"></span><span class="annot"><a href="GHC.Core.Utils.html#mkCastMCo"><span class="hs-identifier hs-var">mkCastMCo</span></a></span><span> </span><span id="local-6989586621682702581"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702581"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621682702583"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682702583"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Coercion -&gt; CoreExpr
forall b. Expr b -&gt; Coercion -&gt; Expr b
</span><a href="GHC.Core.html#Cast"><span class="hs-identifier hs-var">Cast</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702581"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682702583"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-255"></span><span>  </span><span class="hs-comment">-- We are careful to use (MCo co) only when co is not reflexive</span><span>
</span><span id="line-256"></span><span>  </span><span class="hs-comment">-- Hence (Cast e co) rather than (mkCast e co)</span><span>
</span><span id="line-257"></span><span>
</span><span id="line-258"></span><span class="annot"><a href="GHC.Core.Utils.html#mkPiMCo"><span class="hs-identifier hs-type">mkPiMCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercionR"><span class="hs-identifier hs-type">MCoercionR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercionR"><span class="hs-identifier hs-type">MCoercionR</span></a></span><span>
</span><span id="line-259"></span><span id="mkPiMCo"><span class="annot"><span class="annottext">mkPiMCo :: Id -&gt; MCoercionR -&gt; MCoercionR
</span><a href="GHC.Core.Utils.html#mkPiMCo"><span class="hs-identifier hs-var hs-var">mkPiMCo</span></a></span></span><span> </span><span class="annot"><span class="annottext">Id
</span><span class="hs-identifier">_</span></span><span>  </span><span class="annot"><span class="annottext">MCoercionR
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MCoercionR
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>
</span><span id="line-260"></span><span class="annot"><a href="GHC.Core.Utils.html#mkPiMCo"><span class="hs-identifier hs-var">mkPiMCo</span></a></span><span> </span><span id="local-6989586621682702584"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702584"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621682702585"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682702585"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; MCoercionR
</span><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-var">MCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Id -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkPiCo"><span class="hs-identifier hs-var">mkPiCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702584"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682702585"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
             Casts
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span class="hs-comment">-- | Wrap the given expression in the coercion safely, dropping</span><span>
</span><span id="line-270"></span><span class="hs-comment">-- identity coercions and coalescing nested coercions</span><span>
</span><span id="line-271"></span><span class="annot"><a href="GHC.Core.Utils.html#mkCast"><span class="hs-identifier hs-type">mkCast</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionR"><span class="hs-identifier hs-type">CoercionR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span id="mkCast"><span class="annot"><span class="annottext">mkCast :: HasDebugCallStack =&gt; CoreExpr -&gt; Coercion -&gt; CoreExpr
</span><a href="GHC.Core.Utils.html#mkCast"><span class="hs-identifier hs-var hs-var">mkCast</span></a></span></span><span> </span><span id="local-6989586621682702634"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702634"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621682702635"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682702635"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-274"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; CoreExpr -&gt; CoreExpr
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="GHC.Core.Coercion.html#coercionRole"><span class="hs-identifier hs-var">coercionRole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682702635"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;coercion&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682702635"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;passed to mkCast&quot;</span></span><span>
</span><span id="line-276"></span><span>               </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702634"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;has wrong role&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="GHC.Core.Coercion.html#coercionRole"><span class="hs-identifier hs-var">coercionRole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682702635"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-277"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; String -&gt; SDoc -&gt; CoreExpr -&gt; CoreExpr
forall a. HasCallStack =&gt; Bool -&gt; String -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Trace.html#warnPprTrace"><span class="hs-identifier hs-var">warnPprTrace</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Type
Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionLKind"><span class="hs-identifier hs-var">coercionLKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682702635"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoreExpr -&gt; Type
CoreExpr -&gt; Type
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702634"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>          </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Trying to coerce&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;(&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702634"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-279"></span><span>          </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;::&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoreExpr -&gt; Type
CoreExpr -&gt; Type
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702634"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-280"></span><span>          </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682702635"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionType"><span class="hs-identifier hs-var">coercionType</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682702635"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span>          </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
HasCallStack =&gt; SDoc
</span><a href="GHC.Utils.Panic.html#callStackDoc"><span class="hs-identifier hs-var">callStackDoc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-282"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702634"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-283"></span><span>      </span><span class="annot"><a href="GHC.Core.html#Cast"><span class="hs-identifier hs-type">Cast</span></a></span><span> </span><span id="local-6989586621682702643"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702643"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621682702644"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682702644"><span class="hs-identifier hs-var">co2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoreExpr -&gt; Coercion -&gt; CoreExpr
CoreExpr -&gt; Coercion -&gt; CoreExpr
</span><a href="GHC.Core.Utils.html#mkCast"><span class="hs-identifier hs-var">mkCast</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702643"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Coercion -&gt; Coercion
Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682702644"><span class="hs-identifier hs-var">co2</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682702635"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-284"></span><span>      </span><span class="annot"><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-type">Tick</span></a></span><span> </span><span id="local-6989586621682702646"><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702646"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682702647"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702647"><span class="hs-identifier hs-var">expr</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; CoreExpr -&gt; CoreExpr
forall b. CoreTickish -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-var">Tick</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702646"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoreExpr -&gt; Coercion -&gt; CoreExpr
CoreExpr -&gt; Coercion -&gt; CoreExpr
</span><a href="GHC.Core.Utils.html#mkCast"><span class="hs-identifier hs-var">mkCast</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702647"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682702635"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span>      </span><span class="annot"><a href="GHC.Core.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span id="local-6989586621682702648"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682702648"><span class="hs-identifier hs-var">e_co</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Predicate.html#isCoVarType"><span class="hs-identifier hs-var">isCoVarType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Type
Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionRKind"><span class="hs-identifier hs-var">coercionRKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682702635"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span>         </span><span class="hs-comment">-- The guard here checks that g has a (~#) on both sides,</span><span>
</span><span id="line-288"></span><span>         </span><span class="hs-comment">-- otherwise decomposeCo fails.  Can in principle happen</span><span>
</span><span id="line-289"></span><span>         </span><span class="hs-comment">-- with unsafeCoerce</span><span>
</span><span id="line-290"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; CoreExpr
forall b. Coercion -&gt; Expr b
</span><a href="GHC.Core.html#Coercion"><span class="hs-identifier hs-var">Coercion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkCoCast"><span class="hs-identifier hs-var">mkCoCast</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682702648"><span class="hs-identifier hs-var">e_co</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682702635"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span>      </span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isReflCo"><span class="hs-identifier hs-var">isReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682702635"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702634"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-293"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Coercion -&gt; CoreExpr
forall b. Expr b -&gt; Coercion -&gt; Expr b
</span><a href="GHC.Core.html#Cast"><span class="hs-identifier hs-var">Cast</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702634"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682702635"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
             Attaching ticks
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-301"></span><span>
</span><span id="line-302"></span><span class="hs-comment">-- | Wraps the given expression in the source annotation, dropping the</span><span>
</span><span id="line-303"></span><span class="hs-comment">-- annotation if possible.</span><span>
</span><span id="line-304"></span><span class="annot"><a href="GHC.Core.Utils.html#mkTick"><span class="hs-identifier hs-type">mkTick</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Tickish.html#CoreTickish"><span class="hs-identifier hs-type">CoreTickish</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-305"></span><span id="mkTick"><span class="annot"><span class="annottext">mkTick :: CoreTickish -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Utils.html#mkTick"><span class="hs-identifier hs-var hs-var">mkTick</span></a></span></span><span> </span><span id="local-6989586621682702651"><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702651"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682702652"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702652"><span class="hs-identifier hs-var">orig_expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr)
-&gt; (CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702653"><span class="hs-identifier hs-var">mkTick'</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702652"><span class="hs-identifier hs-var">orig_expr</span></a></span><span>
</span><span id="line-306"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-307"></span><span>  </span><span class="hs-comment">-- Some ticks (cost-centres) can be split in two, with the</span><span>
</span><span id="line-308"></span><span>  </span><span class="hs-comment">-- non-counting part having laxer placement properties.</span><span>
</span><span id="line-309"></span><span>  </span><span id="local-6989586621682702655"><span class="annot"><span class="annottext">canSplit :: Bool
</span><a href="#local-6989586621682702655"><span class="hs-identifier hs-var hs-var">canSplit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; Bool
forall (pass :: TickishPass). GenTickish pass -&gt; Bool
</span><a href="GHC.Types.Tickish.html#tickishCanSplit"><span class="hs-identifier hs-var">tickishCanSplit</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702651"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; TickishPlacement
forall (pass :: TickishPass). GenTickish pass -&gt; TickishPlacement
</span><a href="GHC.Types.Tickish.html#tickishPlace"><span class="hs-identifier hs-var">tickishPlace</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreTickish -&gt; CoreTickish
forall (pass :: TickishPass). GenTickish pass -&gt; GenTickish pass
</span><a href="GHC.Types.Tickish.html#mkNoCount"><span class="hs-identifier hs-var">mkNoCount</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702651"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TickishPlacement -&gt; TickishPlacement -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; TickishPlacement
forall (pass :: TickishPass). GenTickish pass -&gt; TickishPlacement
</span><a href="GHC.Types.Tickish.html#tickishPlace"><span class="hs-identifier hs-var">tickishPlace</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702651"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span>  </span><span class="hs-comment">-- mkTick' handles floating of ticks *into* the expression.</span><span>
</span><span id="line-312"></span><span>  </span><span class="hs-comment">-- In this function, `top` is applied after adding the tick, and `rest` before.</span><span>
</span><span id="line-313"></span><span>  </span><span class="hs-comment">-- This will result in applications that look like (top $ Tick t $ rest expr).</span><span>
</span><span id="line-314"></span><span>  </span><span class="hs-comment">-- If we want to push the tick deeper, we pre-compose `top` with a function</span><span>
</span><span id="line-315"></span><span>  </span><span class="hs-comment">-- adding the tick.</span><span>
</span><span id="line-316"></span><span>  </span><span class="annot"><a href="#local-6989586621682702653"><span class="hs-identifier hs-type">mkTick'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- apply after adding tick (float through)</span><span>
</span><span id="line-317"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- apply before adding tick (float with)</span><span>
</span><span id="line-318"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>               </span><span class="hs-comment">-- current expression</span><span>
</span><span id="line-319"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-320"></span><span>  </span><span id="local-6989586621682702653"><span class="annot"><span class="annottext">mkTick' :: (CoreExpr -&gt; CoreExpr)
-&gt; (CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702653"><span class="hs-identifier hs-var hs-var">mkTick'</span></a></span></span><span> </span><span id="local-6989586621682702661"><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702661"><span class="hs-identifier hs-var">top</span></a></span></span><span> </span><span id="local-6989586621682702662"><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702662"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span id="local-6989586621682702663"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702663"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702663"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-321"></span><span>
</span><span id="line-322"></span><span>    </span><span class="hs-comment">-- Cost centre ticks should never be reordered relative to each</span><span>
</span><span id="line-323"></span><span>    </span><span class="hs-comment">-- other. Therefore we can stop whenever two collide.</span><span>
</span><span id="line-324"></span><span>    </span><span class="annot"><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-type">Tick</span></a></span><span> </span><span id="local-6989586621682702664"><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702664"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span id="local-6989586621682702665"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702665"><span class="hs-identifier hs-var">e</span></a></span></span><span>
</span><span id="line-325"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Types.Tickish.html#ProfNote"><span class="hs-identifier hs-type">ProfNote</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702664"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Tickish.html#ProfNote"><span class="hs-identifier hs-type">ProfNote</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702651"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702661"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; CoreExpr -&gt; CoreExpr
forall b. CoreTickish -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-var">Tick</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702651"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702662"><span class="hs-identifier hs-var">rest</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702663"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span>    </span><span class="hs-comment">-- Otherwise we assume that ticks of different placements float</span><span>
</span><span id="line-328"></span><span>    </span><span class="hs-comment">-- through each other.</span><span>
</span><span id="line-329"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; TickishPlacement
forall (pass :: TickishPass). GenTickish pass -&gt; TickishPlacement
</span><a href="GHC.Types.Tickish.html#tickishPlace"><span class="hs-identifier hs-var">tickishPlace</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702664"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="annot"><span class="annottext">TickishPlacement -&gt; TickishPlacement -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; TickishPlacement
forall (pass :: TickishPass). GenTickish pass -&gt; TickishPlacement
</span><a href="GHC.Types.Tickish.html#tickishPlace"><span class="hs-identifier hs-var">tickishPlace</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702651"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr)
-&gt; (CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702653"><span class="hs-identifier hs-var">mkTick'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702661"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr)
-&gt; (CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; CoreExpr -&gt; CoreExpr
forall b. CoreTickish -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-var">Tick</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702664"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702662"><span class="hs-identifier hs-var">rest</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702665"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-330"></span><span>
</span><span id="line-331"></span><span>    </span><span class="hs-comment">-- For annotations this is where we make sure to not introduce</span><span>
</span><span id="line-332"></span><span>    </span><span class="hs-comment">-- redundant ticks.</span><span>
</span><span id="line-333"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; CoreTickish -&gt; Bool
forall (pass :: TickishPass).
Eq (GenTickish pass) =&gt;
GenTickish pass -&gt; GenTickish pass -&gt; Bool
</span><a href="GHC.Types.Tickish.html#tickishContains"><span class="hs-identifier hs-var">tickishContains</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702651"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702664"><span class="hs-identifier hs-var">t2</span></a></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr)
-&gt; (CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702653"><span class="hs-identifier hs-var">mkTick'</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702661"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702662"><span class="hs-identifier hs-var">rest</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702665"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-334"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; CoreTickish -&gt; Bool
forall (pass :: TickishPass).
Eq (GenTickish pass) =&gt;
GenTickish pass -&gt; GenTickish pass -&gt; Bool
</span><a href="GHC.Types.Tickish.html#tickishContains"><span class="hs-identifier hs-var">tickishContains</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702664"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702651"><span class="hs-identifier hs-var">t</span></a></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702652"><span class="hs-identifier hs-var">orig_expr</span></a></span><span>
</span><span id="line-335"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr)
-&gt; (CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702653"><span class="hs-identifier hs-var">mkTick'</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702661"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702662"><span class="hs-identifier hs-var">rest</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr)
-&gt; (CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; CoreExpr -&gt; CoreExpr
forall b. CoreTickish -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-var">Tick</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702664"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702665"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span>    </span><span class="hs-comment">-- Ticks don't care about types, so we just float all ticks</span><span>
</span><span id="line-338"></span><span>    </span><span class="hs-comment">-- through them. Note that it's not enough to check for these</span><span>
</span><span id="line-339"></span><span>    </span><span class="hs-comment">-- cases top-level. While mkTick will never produce Core with type</span><span>
</span><span id="line-340"></span><span>    </span><span class="hs-comment">-- expressions below ticks, such constructs can be the result of</span><span>
</span><span id="line-341"></span><span>    </span><span class="hs-comment">-- unfoldings. We therefore make an effort to put everything into</span><span>
</span><span id="line-342"></span><span>    </span><span class="hs-comment">-- the right place no matter what we start with.</span><span>
</span><span id="line-343"></span><span>    </span><span class="annot"><a href="GHC.Core.html#Cast"><span class="hs-identifier hs-type">Cast</span></a></span><span> </span><span id="local-6989586621682702669"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702669"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621682702670"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682702670"><span class="hs-identifier hs-var">co</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr)
-&gt; (CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702653"><span class="hs-identifier hs-var">mkTick'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702661"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr)
-&gt; (CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; Coercion -&gt; CoreExpr)
-&gt; Coercion -&gt; CoreExpr -&gt; CoreExpr
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Coercion -&gt; CoreExpr
forall b. Expr b -&gt; Coercion -&gt; Expr b
</span><a href="GHC.Core.html#Cast"><span class="hs-identifier hs-var">Cast</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682702670"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702662"><span class="hs-identifier hs-var">rest</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702669"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-344"></span><span>    </span><span class="annot"><a href="GHC.Core.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span id="local-6989586621682702672"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682702672"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; CoreExpr
forall b. Coercion -&gt; Expr b
</span><a href="GHC.Core.html#Coercion"><span class="hs-identifier hs-var">Coercion</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682702672"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-345"></span><span>
</span><span id="line-346"></span><span>    </span><span class="annot"><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-type">Lam</span></a></span><span> </span><span id="local-6989586621682702673"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702673"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682702674"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702674"><span class="hs-identifier hs-var">e</span></a></span></span><span>
</span><span id="line-347"></span><span>      </span><span class="hs-comment">-- Always float through type lambdas. Even for non-type lambdas,</span><span>
</span><span id="line-348"></span><span>      </span><span class="hs-comment">-- floating is allowed for all but the most strict placement rule.</span><span>
</span><span id="line-349"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Core.html#isRuntimeVar"><span class="hs-identifier hs-var">isRuntimeVar</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702673"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; TickishPlacement
forall (pass :: TickishPass). GenTickish pass -&gt; TickishPlacement
</span><a href="GHC.Types.Tickish.html#tickishPlace"><span class="hs-identifier hs-var">tickishPlace</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702651"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">TickishPlacement -&gt; TickishPlacement -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">TickishPlacement
</span><a href="GHC.Types.Tickish.html#PlaceRuntime"><span class="hs-identifier hs-var">PlaceRuntime</span></a></span><span>
</span><span id="line-350"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr)
-&gt; (CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702653"><span class="hs-identifier hs-var">mkTick'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702661"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr)
-&gt; (CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; CoreExpr -&gt; CoreExpr
forall b. b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-var">Lam</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702673"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702662"><span class="hs-identifier hs-var">rest</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702674"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-351"></span><span>
</span><span id="line-352"></span><span>      </span><span class="hs-comment">-- If it is both counting and scoped, we split the tick into its</span><span>
</span><span id="line-353"></span><span>      </span><span class="hs-comment">-- two components, often allowing us to keep the counting tick on</span><span>
</span><span id="line-354"></span><span>      </span><span class="hs-comment">-- the outside of the lambda and push the scoped tick inside.</span><span>
</span><span id="line-355"></span><span>      </span><span class="hs-comment">-- The point of this is that the counting tick can probably be</span><span>
</span><span id="line-356"></span><span>      </span><span class="hs-comment">-- floated, and the lambda may then be in a position to be</span><span>
</span><span id="line-357"></span><span>      </span><span class="hs-comment">-- beta-reduced.</span><span>
</span><span id="line-358"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682702655"><span class="hs-identifier hs-var">canSplit</span></a></span><span>
</span><span id="line-359"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702661"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; CoreExpr -&gt; CoreExpr
forall b. CoreTickish -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-var">Tick</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreTickish -&gt; CoreTickish
forall (pass :: TickishPass). GenTickish pass -&gt; GenTickish pass
</span><a href="GHC.Types.Tickish.html#mkNoScope"><span class="hs-identifier hs-var">mkNoScope</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702651"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702662"><span class="hs-identifier hs-var">rest</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; CoreExpr -&gt; CoreExpr
forall b. b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-var">Lam</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702673"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Utils.html#mkTick"><span class="hs-identifier hs-var">mkTick</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreTickish -&gt; CoreTickish
forall (pass :: TickishPass). GenTickish pass -&gt; GenTickish pass
</span><a href="GHC.Types.Tickish.html#mkNoCount"><span class="hs-identifier hs-var">mkNoCount</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702651"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702674"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-360"></span><span>
</span><span id="line-361"></span><span>    </span><span class="annot"><a href="GHC.Core.html#App"><span class="hs-identifier hs-type">App</span></a></span><span> </span><span id="local-6989586621682702679"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702679"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682702680"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702680"><span class="hs-identifier hs-var">arg</span></a></span></span><span>
</span><span id="line-362"></span><span>      </span><span class="hs-comment">-- Always float through type applications.</span><span>
</span><span id="line-363"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; Bool
</span><a href="GHC.Core.html#isRuntimeArg"><span class="hs-identifier hs-var">isRuntimeArg</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702680"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-364"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr)
-&gt; (CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702653"><span class="hs-identifier hs-var">mkTick'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702661"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr)
-&gt; (CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr -&gt; CoreExpr)
-&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
forall b. Expr b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#App"><span class="hs-identifier hs-var">App</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702680"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702662"><span class="hs-identifier hs-var">rest</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702679"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-365"></span><span>
</span><span id="line-366"></span><span>      </span><span class="hs-comment">-- We can also float through constructor applications, placement</span><span>
</span><span id="line-367"></span><span>      </span><span class="hs-comment">-- permitting. Again we can split.</span><span>
</span><span id="line-368"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#isSaturatedConApp"><span class="hs-identifier hs-var">isSaturatedConApp</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702663"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreTickish -&gt; TickishPlacement
forall (pass :: TickishPass). GenTickish pass -&gt; TickishPlacement
</span><a href="GHC.Types.Tickish.html#tickishPlace"><span class="hs-identifier hs-var">tickishPlace</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702651"><span class="hs-identifier hs-var">t</span></a></span><span class="annot"><span class="annottext">TickishPlacement -&gt; TickishPlacement -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="annot"><span class="annottext">TickishPlacement
</span><a href="GHC.Types.Tickish.html#PlaceCostCentre"><span class="hs-identifier hs-var">PlaceCostCentre</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682702655"><span class="hs-identifier hs-var">canSplit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; TickishPlacement
forall (pass :: TickishPass). GenTickish pass -&gt; TickishPlacement
</span><a href="GHC.Types.Tickish.html#tickishPlace"><span class="hs-identifier hs-var">tickishPlace</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702651"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">TickishPlacement -&gt; TickishPlacement -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TickishPlacement
</span><a href="GHC.Types.Tickish.html#PlaceCostCentre"><span class="hs-identifier hs-var">PlaceCostCentre</span></a></span><span>
</span><span id="line-370"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702661"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702662"><span class="hs-identifier hs-var">rest</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Utils.html#tickHNFArgs"><span class="hs-identifier hs-var">tickHNFArgs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702651"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702663"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-371"></span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702661"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; CoreExpr -&gt; CoreExpr
forall b. CoreTickish -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-var">Tick</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreTickish -&gt; CoreTickish
forall (pass :: TickishPass). GenTickish pass -&gt; GenTickish pass
</span><a href="GHC.Types.Tickish.html#mkNoScope"><span class="hs-identifier hs-var">mkNoScope</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702651"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702662"><span class="hs-identifier hs-var">rest</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Utils.html#tickHNFArgs"><span class="hs-identifier hs-var">tickHNFArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreTickish -&gt; CoreTickish
forall (pass :: TickishPass). GenTickish pass -&gt; GenTickish pass
</span><a href="GHC.Types.Tickish.html#mkNoCount"><span class="hs-identifier hs-var">mkNoCount</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702651"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702663"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-372"></span><span>
</span><span id="line-373"></span><span>    </span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682702683"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702683"><span class="hs-identifier hs-var">x</span></a></span></span><span>
</span><span id="line-374"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682702684"><span class="hs-identifier hs-var">notFunction</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; TickishPlacement
forall (pass :: TickishPass). GenTickish pass -&gt; TickishPlacement
</span><a href="GHC.Types.Tickish.html#tickishPlace"><span class="hs-identifier hs-var">tickishPlace</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702651"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">TickishPlacement -&gt; TickishPlacement -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TickishPlacement
</span><a href="GHC.Types.Tickish.html#PlaceCostCentre"><span class="hs-identifier hs-var">PlaceCostCentre</span></a></span><span>
</span><span id="line-375"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702652"><span class="hs-identifier hs-var">orig_expr</span></a></span><span>
</span><span id="line-376"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682702684"><span class="hs-identifier hs-var">notFunction</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682702655"><span class="hs-identifier hs-var">canSplit</span></a></span><span>
</span><span id="line-377"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702661"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; CoreExpr -&gt; CoreExpr
forall b. CoreTickish -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-var">Tick</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreTickish -&gt; CoreTickish
forall (pass :: TickishPass). GenTickish pass -&gt; GenTickish pass
</span><a href="GHC.Types.Tickish.html#mkNoScope"><span class="hs-identifier hs-var">mkNoScope</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702651"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702662"><span class="hs-identifier hs-var">rest</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702663"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-378"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-379"></span><span>        </span><span class="hs-comment">-- SCCs can be eliminated on variables provided the variable</span><span>
</span><span id="line-380"></span><span>        </span><span class="hs-comment">-- is not a function.  In these cases the SCC makes no difference:</span><span>
</span><span id="line-381"></span><span>        </span><span class="hs-comment">-- the cost of evaluating the variable will be attributed to its</span><span>
</span><span id="line-382"></span><span>        </span><span class="hs-comment">-- definition site.  When the variable refers to a function, however,</span><span>
</span><span id="line-383"></span><span>        </span><span class="hs-comment">-- an SCC annotation on the variable affects the cost-centre stack</span><span>
</span><span id="line-384"></span><span>        </span><span class="hs-comment">-- when the function is called, so we must retain those.</span><span>
</span><span id="line-385"></span><span>        </span><span id="local-6989586621682702684"><span class="annot"><span class="annottext">notFunction :: Bool
</span><a href="#local-6989586621682702684"><span class="hs-identifier hs-var hs-var">notFunction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isFunTy"><span class="hs-identifier hs-var">isFunTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702683"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-386"></span><span>
</span><span id="line-387"></span><span>    </span><span class="annot"><a href="GHC.Core.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><span id="line-388"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; TickishPlacement
forall (pass :: TickishPass). GenTickish pass -&gt; TickishPlacement
</span><a href="GHC.Types.Tickish.html#tickishPlace"><span class="hs-identifier hs-var">tickishPlace</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702651"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">TickishPlacement -&gt; TickishPlacement -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TickishPlacement
</span><a href="GHC.Types.Tickish.html#PlaceCostCentre"><span class="hs-identifier hs-var">PlaceCostCentre</span></a></span><span>
</span><span id="line-389"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702652"><span class="hs-identifier hs-var">orig_expr</span></a></span><span>
</span><span id="line-390"></span><span>
</span><span id="line-391"></span><span>    </span><span class="hs-comment">-- Catch-all: Annotate where we stand</span><span>
</span><span id="line-392"></span><span>    </span><span id="local-6989586621682702686"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702686"><span class="hs-identifier hs-var">_any</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702661"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; CoreExpr -&gt; CoreExpr
forall b. CoreTickish -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-var">Tick</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702651"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702662"><span class="hs-identifier hs-var">rest</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702663"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-393"></span><span>
</span><span id="line-394"></span><span class="annot"><a href="GHC.Core.Utils.html#mkTicks"><span class="hs-identifier hs-type">mkTicks</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Tickish.html#CoreTickish"><span class="hs-identifier hs-type">CoreTickish</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-395"></span><span id="mkTicks"><span class="annot"><span class="annottext">mkTicks :: [CoreTickish] -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Utils.html#mkTicks"><span class="hs-identifier hs-var hs-var">mkTicks</span></a></span></span><span> </span><span id="local-6989586621682702687"><span class="annot"><span class="annottext">[CoreTickish]
</span><a href="#local-6989586621682702687"><span class="hs-identifier hs-var">ticks</span></a></span></span><span> </span><span id="local-6989586621682702688"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702688"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoreTickish -&gt; CoreExpr -&gt; CoreExpr)
-&gt; CoreExpr -&gt; [CoreTickish] -&gt; CoreExpr
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Utils.html#mkTick"><span class="hs-identifier hs-var">mkTick</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702688"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreTickish]
</span><a href="#local-6989586621682702687"><span class="hs-identifier hs-var">ticks</span></a></span><span>
</span><span id="line-396"></span><span>
</span><span id="line-397"></span><span class="annot"><a href="GHC.Core.Utils.html#isSaturatedConApp"><span class="hs-identifier hs-type">isSaturatedConApp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-398"></span><span id="isSaturatedConApp"><span class="annot"><span class="annottext">isSaturatedConApp :: CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#isSaturatedConApp"><span class="hs-identifier hs-var hs-var">isSaturatedConApp</span></a></span></span><span> </span><span id="local-6989586621682702689"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702689"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; [CoreExpr] -&gt; Bool
forall {b}. Expr b -&gt; [Expr b] -&gt; Bool
</span><a href="#local-6989586621682702690"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702689"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-399"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682702690"><span class="annot"><span class="annottext">go :: Expr b -&gt; [Expr b] -&gt; Bool
</span><a href="#local-6989586621682702690"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#App"><span class="hs-identifier hs-type">App</span></a></span><span> </span><span id="local-6989586621682702692"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702692"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682702693"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702693"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682702694"><span class="annot"><span class="annottext">[Expr b]
</span><a href="#local-6989586621682702694"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr b -&gt; [Expr b] -&gt; Bool
</span><a href="#local-6989586621682702690"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702692"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702693"><span class="hs-identifier hs-var">a</span></a></span><span class="annot"><span class="annottext">Expr b -&gt; [Expr b] -&gt; [Expr b]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Expr b]
</span><a href="#local-6989586621682702694"><span class="hs-keyword hs-var">as</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-400"></span><span>        </span><span class="annot"><a href="#local-6989586621682702690"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682702695"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702695"><span class="hs-identifier hs-var">fun</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682702696"><span class="annot"><span class="annottext">[Expr b]
</span><a href="#local-6989586621682702696"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-401"></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Id.html#isConLikeId"><span class="hs-identifier hs-var">isConLikeId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702695"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Int
</span><a href="GHC.Types.Id.html#idArity"><span class="hs-identifier hs-var">idArity</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702695"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[Expr b] -&gt; Int
forall b. [Arg b] -&gt; Int
</span><a href="GHC.Core.html#valArgCount"><span class="hs-identifier hs-var">valArgCount</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr b]
</span><a href="#local-6989586621682702696"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-402"></span><span>        </span><span class="annot"><a href="#local-6989586621682702690"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Cast"><span class="hs-identifier hs-type">Cast</span></a></span><span> </span><span id="local-6989586621682702700"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702700"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682702701"><span class="annot"><span class="annottext">[Expr b]
</span><a href="#local-6989586621682702701"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr b -&gt; [Expr b] -&gt; Bool
</span><a href="#local-6989586621682702690"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702700"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr b]
</span><a href="#local-6989586621682702701"><span class="hs-keyword hs-var">as</span></a></span><span>
</span><span id="line-403"></span><span>        </span><span class="annot"><a href="#local-6989586621682702690"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Expr b]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-404"></span><span>
</span><span id="line-405"></span><span class="annot"><a href="GHC.Core.Utils.html#mkTickNoHNF"><span class="hs-identifier hs-type">mkTickNoHNF</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Tickish.html#CoreTickish"><span class="hs-identifier hs-type">CoreTickish</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-406"></span><span id="mkTickNoHNF"><span class="annot"><span class="annottext">mkTickNoHNF :: CoreTickish -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Utils.html#mkTickNoHNF"><span class="hs-identifier hs-var hs-var">mkTickNoHNF</span></a></span></span><span> </span><span id="local-6989586621682702702"><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702702"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682702703"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702703"><span class="hs-identifier hs-var">e</span></a></span></span><span>
</span><span id="line-407"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#exprIsHNF"><span class="hs-identifier hs-var">exprIsHNF</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702703"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Utils.html#tickHNFArgs"><span class="hs-identifier hs-var">tickHNFArgs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702702"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702703"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-408"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Utils.html#mkTick"><span class="hs-identifier hs-var">mkTick</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702702"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702703"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span class="hs-comment">-- push a tick into the arguments of a HNF (call or constructor app)</span><span>
</span><span id="line-411"></span><span class="annot"><a href="GHC.Core.Utils.html#tickHNFArgs"><span class="hs-identifier hs-type">tickHNFArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Tickish.html#CoreTickish"><span class="hs-identifier hs-type">CoreTickish</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-412"></span><span id="tickHNFArgs"><span class="annot"><span class="annottext">tickHNFArgs :: CoreTickish -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Utils.html#tickHNFArgs"><span class="hs-identifier hs-var hs-var">tickHNFArgs</span></a></span></span><span> </span><span id="local-6989586621682702704"><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702704"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682702705"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702705"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702706"><span class="hs-identifier hs-var">push</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702704"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702705"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-413"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-414"></span><span>  </span><span id="local-6989586621682702706"><span class="annot"><span class="annottext">push :: CoreTickish -&gt; CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702706"><span class="hs-identifier hs-var hs-var">push</span></a></span></span><span> </span><span id="local-6989586621682702707"><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702707"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#App"><span class="hs-identifier hs-type">App</span></a></span><span> </span><span id="local-6989586621682702708"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702708"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span id="local-6989586621682702709"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702709"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
forall b. Expr b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#App"><span class="hs-identifier hs-var">App</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreTickish -&gt; CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702706"><span class="hs-identifier hs-var">push</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702707"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702708"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; CoreExpr
forall b. Type -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702709"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-415"></span><span>  </span><span class="annot"><a href="#local-6989586621682702706"><span class="hs-identifier hs-var">push</span></a></span><span> </span><span id="local-6989586621682702710"><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702710"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#App"><span class="hs-identifier hs-type">App</span></a></span><span> </span><span id="local-6989586621682702711"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702711"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682702712"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702712"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
forall b. Expr b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#App"><span class="hs-identifier hs-var">App</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreTickish -&gt; CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702706"><span class="hs-identifier hs-var">push</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702710"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702711"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreTickish -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Utils.html#mkTick"><span class="hs-identifier hs-var">mkTick</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702710"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702712"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-416"></span><span>  </span><span class="annot"><a href="#local-6989586621682702706"><span class="hs-identifier hs-var">push</span></a></span><span> </span><span id="local-6989586621682702713"><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702713"><span class="hs-identifier hs-var">_t</span></a></span></span><span> </span><span id="local-6989586621682702714"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702714"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702714"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-417"></span><span>
</span><span id="line-418"></span><span class="annot"><span class="hs-comment">-- | Strip ticks satisfying a predicate from top of an expression</span></span><span>
</span><span id="line-419"></span><span id="local-6989586621682701905"><span class="annot"><a href="GHC.Core.Utils.html#stripTicksTop"><span class="hs-identifier hs-type">stripTicksTop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Tickish.html#CoreTickish"><span class="hs-identifier hs-type">CoreTickish</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682701905"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Tickish.html#CoreTickish"><span class="hs-identifier hs-type">CoreTickish</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682701905"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-420"></span><span id="stripTicksTop"><span class="annot"><span class="annottext">stripTicksTop :: forall b.
(CoreTickish -&gt; Bool) -&gt; Expr b -&gt; ([CoreTickish], Expr b)
</span><a href="GHC.Core.Utils.html#stripTicksTop"><span class="hs-identifier hs-var hs-var">stripTicksTop</span></a></span></span><span> </span><span id="local-6989586621682702715"><span class="annot"><span class="annottext">CoreTickish -&gt; Bool
</span><a href="#local-6989586621682702715"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreTickish] -&gt; Expr b -&gt; ([CoreTickish], Expr b)
</span><a href="#local-6989586621682702716"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-421"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682702716"><span class="annot"><span class="annottext">go :: [CoreTickish] -&gt; Expr b -&gt; ([CoreTickish], Expr b)
</span><a href="#local-6989586621682702716"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621682702717"><span class="annot"><span class="annottext">[CoreTickish]
</span><a href="#local-6989586621682702717"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-type">Tick</span></a></span><span> </span><span id="local-6989586621682702718"><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702718"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682702719"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702719"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; Bool
</span><a href="#local-6989586621682702715"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702718"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreTickish] -&gt; Expr b -&gt; ([CoreTickish], Expr b)
</span><a href="#local-6989586621682702716"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702718"><span class="hs-identifier hs-var">t</span></a></span><span class="annot"><span class="annottext">CoreTickish -&gt; [CoreTickish] -&gt; [CoreTickish]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[CoreTickish]
</span><a href="#local-6989586621682702717"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702719"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-422"></span><span>        </span><span class="annot"><a href="#local-6989586621682702716"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682702720"><span class="annot"><span class="annottext">[CoreTickish]
</span><a href="#local-6989586621682702720"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span id="local-6989586621682702721"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702721"><span class="hs-identifier hs-var">other</span></a></span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoreTickish] -&gt; [CoreTickish]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[CoreTickish]
</span><a href="#local-6989586621682702720"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702721"><span class="hs-identifier hs-var">other</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-423"></span><span>
</span><span id="line-424"></span><span class="hs-comment">-- | Strip ticks satisfying a predicate from top of an expression,</span><span>
</span><span id="line-425"></span><span class="hs-comment">-- returning the remaining expression</span><span>
</span><span id="line-426"></span><span id="local-6989586621682701907"><span class="annot"><a href="GHC.Core.Utils.html#stripTicksTopE"><span class="hs-identifier hs-type">stripTicksTopE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Tickish.html#CoreTickish"><span class="hs-identifier hs-type">CoreTickish</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682701907"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682701907"><span class="hs-identifier hs-type">b</span></a></span></span><span>
</span><span id="line-427"></span><span id="stripTicksTopE"><span class="annot"><span class="annottext">stripTicksTopE :: forall b. (CoreTickish -&gt; Bool) -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.Utils.html#stripTicksTopE"><span class="hs-identifier hs-var hs-var">stripTicksTopE</span></a></span></span><span> </span><span id="local-6989586621682702722"><span class="annot"><span class="annottext">CoreTickish -&gt; Bool
</span><a href="#local-6989586621682702722"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr b -&gt; Expr b
</span><a href="#local-6989586621682702723"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-428"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682702723"><span class="annot"><span class="annottext">go :: Expr b -&gt; Expr b
</span><a href="#local-6989586621682702723"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-type">Tick</span></a></span><span> </span><span id="local-6989586621682702724"><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702724"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682702725"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702725"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; Bool
</span><a href="#local-6989586621682702722"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702724"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr b -&gt; Expr b
</span><a href="#local-6989586621682702723"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702725"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-429"></span><span>        </span><span class="annot"><a href="#local-6989586621682702723"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682702726"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702726"><span class="hs-identifier hs-var">other</span></a></span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702726"><span class="hs-identifier hs-var">other</span></a></span><span>
</span><span id="line-430"></span><span>
</span><span id="line-431"></span><span class="hs-comment">-- | Strip ticks satisfying a predicate from top of an expression,</span><span>
</span><span id="line-432"></span><span class="hs-comment">-- returning the ticks</span><span>
</span><span id="line-433"></span><span id="local-6989586621682701909"><span class="annot"><a href="GHC.Core.Utils.html#stripTicksTopT"><span class="hs-identifier hs-type">stripTicksTopT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Tickish.html#CoreTickish"><span class="hs-identifier hs-type">CoreTickish</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682701909"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Tickish.html#CoreTickish"><span class="hs-identifier hs-type">CoreTickish</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-434"></span><span id="stripTicksTopT"><span class="annot"><span class="annottext">stripTicksTopT :: forall b. (CoreTickish -&gt; Bool) -&gt; Expr b -&gt; [CoreTickish]
</span><a href="GHC.Core.Utils.html#stripTicksTopT"><span class="hs-identifier hs-var hs-var">stripTicksTopT</span></a></span></span><span> </span><span id="local-6989586621682702727"><span class="annot"><span class="annottext">CoreTickish -&gt; Bool
</span><a href="#local-6989586621682702727"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreTickish] -&gt; Expr b -&gt; [CoreTickish]
</span><a href="#local-6989586621682702728"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-435"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682702728"><span class="annot"><span class="annottext">go :: [CoreTickish] -&gt; Expr b -&gt; [CoreTickish]
</span><a href="#local-6989586621682702728"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621682702729"><span class="annot"><span class="annottext">[CoreTickish]
</span><a href="#local-6989586621682702729"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-type">Tick</span></a></span><span> </span><span id="local-6989586621682702730"><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702730"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682702731"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702731"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; Bool
</span><a href="#local-6989586621682702727"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702730"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreTickish] -&gt; Expr b -&gt; [CoreTickish]
</span><a href="#local-6989586621682702728"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702730"><span class="hs-identifier hs-var">t</span></a></span><span class="annot"><span class="annottext">CoreTickish -&gt; [CoreTickish] -&gt; [CoreTickish]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[CoreTickish]
</span><a href="#local-6989586621682702729"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702731"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-436"></span><span>        </span><span class="annot"><a href="#local-6989586621682702728"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682702732"><span class="annot"><span class="annottext">[CoreTickish]
</span><a href="#local-6989586621682702732"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><span class="hs-identifier">_</span></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreTickish]
</span><a href="#local-6989586621682702732"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-437"></span><span>
</span><span id="line-438"></span><span class="hs-comment">-- | Completely strip ticks satisfying a predicate from an</span><span>
</span><span id="line-439"></span><span class="hs-comment">-- expression. Note this is O(n) in the size of the expression!</span><span>
</span><span id="line-440"></span><span id="local-6989586621682702733"><span class="annot"><a href="GHC.Core.Utils.html#stripTicksE"><span class="hs-identifier hs-type">stripTicksE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Tickish.html#CoreTickish"><span class="hs-identifier hs-type">CoreTickish</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682702733"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682702733"><span class="hs-identifier hs-type">b</span></a></span></span><span>
</span><span id="line-441"></span><span id="stripTicksE"><span class="annot"><span class="annottext">stripTicksE :: forall b. (CoreTickish -&gt; Bool) -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.Utils.html#stripTicksE"><span class="hs-identifier hs-var hs-var">stripTicksE</span></a></span></span><span> </span><span id="local-6989586621682702734"><span class="annot"><span class="annottext">CoreTickish -&gt; Bool
</span><a href="#local-6989586621682702734"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621682702735"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702735"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr b -&gt; Expr b
</span><a href="#local-6989586621682702736"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702735"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-442"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682702736"><span class="annot"><span class="annottext">go :: Expr b -&gt; Expr b
</span><a href="#local-6989586621682702736"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#App"><span class="hs-identifier hs-type">App</span></a></span><span> </span><span id="local-6989586621682702737"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702737"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621682702738"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702738"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr b -&gt; Expr b -&gt; Expr b
forall b. Expr b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#App"><span class="hs-identifier hs-var">App</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr b -&gt; Expr b
</span><a href="#local-6989586621682702736"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702737"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr b -&gt; Expr b
</span><a href="#local-6989586621682702736"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702738"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-443"></span><span>        </span><span class="annot"><a href="#local-6989586621682702736"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-type">Lam</span></a></span><span> </span><span id="local-6989586621682702739"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682702739"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621682702740"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702740"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">b -&gt; Expr b -&gt; Expr b
forall b. b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-var">Lam</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682702739"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr b -&gt; Expr b
</span><a href="#local-6989586621682702736"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702740"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-444"></span><span>        </span><span class="annot"><a href="#local-6989586621682702736"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span id="local-6989586621682702741"><span class="annot"><span class="annottext">Bind b
</span><a href="#local-6989586621682702741"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621682702742"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702742"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bind b -&gt; Expr b -&gt; Expr b
forall b. Bind b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bind b -&gt; Bind b
</span><a href="#local-6989586621682702743"><span class="hs-identifier hs-var">go_bs</span></a></span><span> </span><span class="annot"><span class="annottext">Bind b
</span><a href="#local-6989586621682702741"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr b -&gt; Expr b
</span><a href="#local-6989586621682702736"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702742"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-445"></span><span>        </span><span class="annot"><a href="#local-6989586621682702736"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Case"><span class="hs-identifier hs-type">Case</span></a></span><span> </span><span id="local-6989586621682702744"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702744"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621682702745"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682702745"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621682702746"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702746"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682702747"><span class="annot"><span class="annottext">[Alt b]
</span><a href="#local-6989586621682702747"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr b -&gt; b -&gt; Type -&gt; [Alt b] -&gt; Expr b
forall b. Expr b -&gt; b -&gt; Type -&gt; [Alt b] -&gt; Expr b
</span><a href="GHC.Core.html#Case"><span class="hs-identifier hs-var">Case</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr b -&gt; Expr b
</span><a href="#local-6989586621682702736"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702744"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682702745"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702746"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Alt b -&gt; Alt b) -&gt; [Alt b] -&gt; [Alt b]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Alt b -&gt; Alt b
</span><a href="#local-6989586621682702748"><span class="hs-identifier hs-var">go_a</span></a></span><span> </span><span class="annot"><span class="annottext">[Alt b]
</span><a href="#local-6989586621682702747"><span class="hs-keyword hs-var">as</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-446"></span><span>        </span><span class="annot"><a href="#local-6989586621682702736"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Cast"><span class="hs-identifier hs-type">Cast</span></a></span><span> </span><span id="local-6989586621682702749"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702749"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621682702750"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682702750"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr b -&gt; Coercion -&gt; Expr b
forall b. Expr b -&gt; Coercion -&gt; Expr b
</span><a href="GHC.Core.html#Cast"><span class="hs-identifier hs-var">Cast</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr b -&gt; Expr b
</span><a href="#local-6989586621682702736"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702749"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682702750"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-447"></span><span>        </span><span class="annot"><a href="#local-6989586621682702736"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-type">Tick</span></a></span><span> </span><span id="local-6989586621682702751"><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702751"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682702752"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702752"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-448"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; Bool
</span><a href="#local-6989586621682702734"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702751"><span class="hs-identifier hs-var">t</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr b -&gt; Expr b
</span><a href="#local-6989586621682702736"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702752"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-449"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; Expr b -&gt; Expr b
forall b. CoreTickish -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-var">Tick</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702751"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr b -&gt; Expr b
</span><a href="#local-6989586621682702736"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702752"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-450"></span><span>        </span><span class="annot"><a href="#local-6989586621682702736"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682702753"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702753"><span class="hs-identifier hs-var">other</span></a></span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702753"><span class="hs-identifier hs-var">other</span></a></span><span>
</span><span id="line-451"></span><span>        </span><span id="local-6989586621682702743"><span class="annot"><span class="annottext">go_bs :: Bind b -&gt; Bind b
</span><a href="#local-6989586621682702743"><span class="hs-identifier hs-var hs-var">go_bs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#NonRec"><span class="hs-identifier hs-type">NonRec</span></a></span><span> </span><span id="local-6989586621682702754"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682702754"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621682702755"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702755"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">b -&gt; Expr b -&gt; Bind b
forall b. b -&gt; Expr b -&gt; Bind b
</span><a href="GHC.Core.html#NonRec"><span class="hs-identifier hs-var">NonRec</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682702754"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr b -&gt; Expr b
</span><a href="#local-6989586621682702736"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702755"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-452"></span><span>        </span><span class="annot"><a href="#local-6989586621682702743"><span class="hs-identifier hs-var">go_bs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Rec"><span class="hs-identifier hs-type">Rec</span></a></span><span> </span><span id="local-6989586621682702757"><span class="annot"><span class="annottext">[(b, Expr b)]
</span><a href="#local-6989586621682702757"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(b, Expr b)] -&gt; Bind b
forall b. [(b, Expr b)] -&gt; Bind b
</span><a href="GHC.Core.html#Rec"><span class="hs-identifier hs-var">Rec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((b, Expr b) -&gt; (b, Expr b)) -&gt; [(b, Expr b)] -&gt; [(b, Expr b)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(b, Expr b) -&gt; (b, Expr b)
</span><a href="#local-6989586621682702758"><span class="hs-identifier hs-var">go_b</span></a></span><span> </span><span class="annot"><span class="annottext">[(b, Expr b)]
</span><a href="#local-6989586621682702757"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-453"></span><span>        </span><span id="local-6989586621682702758"><span class="annot"><span class="annottext">go_b :: (b, Expr b) -&gt; (b, Expr b)
</span><a href="#local-6989586621682702758"><span class="hs-identifier hs-var hs-var">go_b</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682702759"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682702759"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682702760"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702760"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682702759"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Expr b -&gt; Expr b
</span><a href="#local-6989586621682702736"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702760"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-454"></span><span>        </span><span id="local-6989586621682702748"><span class="annot"><span class="annottext">go_a :: Alt b -&gt; Alt b
</span><a href="#local-6989586621682702748"><span class="hs-identifier hs-var hs-var">go_a</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span id="local-6989586621682702761"><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621682702761"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682702762"><span class="annot"><span class="annottext">[b]
</span><a href="#local-6989586621682702762"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span id="local-6989586621682702763"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702763"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AltCon -&gt; [b] -&gt; Expr b -&gt; Alt b
forall b. AltCon -&gt; [b] -&gt; Expr b -&gt; Alt b
</span><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-var">Alt</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621682702761"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">[b]
</span><a href="#local-6989586621682702762"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr b -&gt; Expr b
</span><a href="#local-6989586621682702736"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702763"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-455"></span><span>
</span><span id="line-456"></span><span id="local-6989586621682702764"><span class="annot"><a href="GHC.Core.Utils.html#stripTicksT"><span class="hs-identifier hs-type">stripTicksT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Tickish.html#CoreTickish"><span class="hs-identifier hs-type">CoreTickish</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682702764"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Tickish.html#CoreTickish"><span class="hs-identifier hs-type">CoreTickish</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-457"></span><span id="stripTicksT"><span class="annot"><span class="annottext">stripTicksT :: forall b. (CoreTickish -&gt; Bool) -&gt; Expr b -&gt; [CoreTickish]
</span><a href="GHC.Core.Utils.html#stripTicksT"><span class="hs-identifier hs-var hs-var">stripTicksT</span></a></span></span><span> </span><span id="local-6989586621682702765"><span class="annot"><span class="annottext">CoreTickish -&gt; Bool
</span><a href="#local-6989586621682702765"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621682702766"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702766"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrdList CoreTickish -&gt; [CoreTickish]
forall a. OrdList a -&gt; [a]
</span><a href="GHC.Data.OrdList.html#fromOL"><span class="hs-identifier hs-var">fromOL</span></a></span><span> </span><span class="annot"><span class="annottext">(OrdList CoreTickish -&gt; [CoreTickish])
-&gt; OrdList CoreTickish -&gt; [CoreTickish]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr b -&gt; OrdList CoreTickish
</span><a href="#local-6989586621682702768"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702766"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-458"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682702768"><span class="annot"><span class="annottext">go :: Expr b -&gt; OrdList CoreTickish
</span><a href="#local-6989586621682702768"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#App"><span class="hs-identifier hs-type">App</span></a></span><span> </span><span id="local-6989586621682702769"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702769"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621682702770"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702770"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr b -&gt; OrdList CoreTickish
</span><a href="#local-6989586621682702768"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702769"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList CoreTickish -&gt; OrdList CoreTickish -&gt; OrdList CoreTickish
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b -&gt; OrdList CoreTickish
</span><a href="#local-6989586621682702768"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702770"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-459"></span><span>        </span><span class="annot"><a href="#local-6989586621682702768"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-type">Lam</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682702772"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702772"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr b -&gt; OrdList CoreTickish
</span><a href="#local-6989586621682702768"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702772"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-460"></span><span>        </span><span class="annot"><a href="#local-6989586621682702768"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span id="local-6989586621682702773"><span class="annot"><span class="annottext">Bind b
</span><a href="#local-6989586621682702773"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621682702774"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702774"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bind b -&gt; OrdList CoreTickish
</span><a href="#local-6989586621682702775"><span class="hs-identifier hs-var">go_bs</span></a></span><span> </span><span class="annot"><span class="annottext">Bind b
</span><a href="#local-6989586621682702773"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList CoreTickish -&gt; OrdList CoreTickish -&gt; OrdList CoreTickish
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b -&gt; OrdList CoreTickish
</span><a href="#local-6989586621682702768"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702774"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-461"></span><span>        </span><span class="annot"><a href="#local-6989586621682702768"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Case"><span class="hs-identifier hs-type">Case</span></a></span><span> </span><span id="local-6989586621682702776"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702776"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682702777"><span class="annot"><span class="annottext">[Alt b]
</span><a href="#local-6989586621682702777"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr b -&gt; OrdList CoreTickish
</span><a href="#local-6989586621682702768"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702776"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList CoreTickish -&gt; OrdList CoreTickish -&gt; OrdList CoreTickish
forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">[OrdList CoreTickish] -&gt; OrdList CoreTickish
forall a. [OrdList a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#concatOL"><span class="hs-identifier hs-var">concatOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Alt b -&gt; OrdList CoreTickish) -&gt; [Alt b] -&gt; [OrdList CoreTickish]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Alt b -&gt; OrdList CoreTickish
</span><a href="#local-6989586621682702779"><span class="hs-identifier hs-var">go_a</span></a></span><span> </span><span class="annot"><span class="annottext">[Alt b]
</span><a href="#local-6989586621682702777"><span class="hs-keyword hs-var">as</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-462"></span><span>        </span><span class="annot"><a href="#local-6989586621682702768"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Cast"><span class="hs-identifier hs-type">Cast</span></a></span><span> </span><span id="local-6989586621682702780"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702780"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr b -&gt; OrdList CoreTickish
</span><a href="#local-6989586621682702768"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702780"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-463"></span><span>        </span><span class="annot"><a href="#local-6989586621682702768"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-type">Tick</span></a></span><span> </span><span id="local-6989586621682702781"><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702781"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682702782"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702782"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-464"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; Bool
</span><a href="#local-6989586621682702765"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702781"><span class="hs-identifier hs-var">t</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702781"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; OrdList CoreTickish -&gt; OrdList CoreTickish
forall a. a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-var">`consOL`</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b -&gt; OrdList CoreTickish
</span><a href="#local-6989586621682702768"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702782"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-465"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr b -&gt; OrdList CoreTickish
</span><a href="#local-6989586621682702768"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702782"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-466"></span><span>        </span><span class="annot"><a href="#local-6989586621682702768"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><span class="hs-identifier">_</span></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrdList CoreTickish
forall a. OrdList a
</span><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-var">nilOL</span></a></span><span>
</span><span id="line-467"></span><span>        </span><span id="local-6989586621682702775"><span class="annot"><span class="annottext">go_bs :: Bind b -&gt; OrdList CoreTickish
</span><a href="#local-6989586621682702775"><span class="hs-identifier hs-var hs-var">go_bs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#NonRec"><span class="hs-identifier hs-type">NonRec</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682702785"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702785"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr b -&gt; OrdList CoreTickish
</span><a href="#local-6989586621682702768"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702785"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-468"></span><span>        </span><span class="annot"><a href="#local-6989586621682702775"><span class="hs-identifier hs-var">go_bs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Rec"><span class="hs-identifier hs-type">Rec</span></a></span><span> </span><span id="local-6989586621682702786"><span class="annot"><span class="annottext">[(b, Expr b)]
</span><a href="#local-6989586621682702786"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[OrdList CoreTickish] -&gt; OrdList CoreTickish
forall a. [OrdList a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#concatOL"><span class="hs-identifier hs-var">concatOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((b, Expr b) -&gt; OrdList CoreTickish)
-&gt; [(b, Expr b)] -&gt; [OrdList CoreTickish]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(b, Expr b) -&gt; OrdList CoreTickish
</span><a href="#local-6989586621682702787"><span class="hs-identifier hs-var">go_b</span></a></span><span> </span><span class="annot"><span class="annottext">[(b, Expr b)]
</span><a href="#local-6989586621682702786"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-469"></span><span>        </span><span id="local-6989586621682702787"><span class="annot"><span class="annottext">go_b :: (b, Expr b) -&gt; OrdList CoreTickish
</span><a href="#local-6989586621682702787"><span class="hs-identifier hs-var hs-var">go_b</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682702788"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702788"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr b -&gt; OrdList CoreTickish
</span><a href="#local-6989586621682702768"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702788"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-470"></span><span>        </span><span id="local-6989586621682702779"><span class="annot"><span class="annottext">go_a :: Alt b -&gt; OrdList CoreTickish
</span><a href="#local-6989586621682702779"><span class="hs-identifier hs-var hs-var">go_a</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[b]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682702789"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702789"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr b -&gt; OrdList CoreTickish
</span><a href="#local-6989586621682702768"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702789"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-471"></span><span>
</span><span id="line-472"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Other expression construction}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-479"></span><span>
</span><span id="line-480"></span><span class="annot"><a href="GHC.Core.Utils.html#bindNonRec"><span class="hs-identifier hs-type">bindNonRec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-481"></span><span class="hs-comment">-- ^ @bindNonRec x r b@ produces either:</span><span>
</span><span id="line-482"></span><span class="hs-comment">--</span><span>
</span><span id="line-483"></span><span class="hs-comment">-- &gt; let x = r in b</span><span>
</span><span id="line-484"></span><span class="hs-comment">--</span><span>
</span><span id="line-485"></span><span class="hs-comment">-- or:</span><span>
</span><span id="line-486"></span><span class="hs-comment">--</span><span>
</span><span id="line-487"></span><span class="hs-comment">-- &gt; case r of x { _DEFAULT_ -&gt; b }</span><span>
</span><span id="line-488"></span><span class="hs-comment">--</span><span>
</span><span id="line-489"></span><span class="hs-comment">-- depending on whether we have to use a @case@ or @let@</span><span>
</span><span id="line-490"></span><span class="hs-comment">-- binding for the expression (see 'needsCaseBinding').</span><span>
</span><span id="line-491"></span><span class="hs-comment">-- It's used by the desugarer to avoid building bindings</span><span>
</span><span id="line-492"></span><span class="hs-comment">-- that give Core Lint a heart attack, although actually</span><span>
</span><span id="line-493"></span><span class="hs-comment">-- the simplifier deals with them perfectly well. See</span><span>
</span><span id="line-494"></span><span class="hs-comment">-- also 'GHC.Core.Make.mkCoreLet'</span><span>
</span><span id="line-495"></span><span id="bindNonRec"><span class="annot"><span class="annottext">bindNonRec :: HasDebugCallStack =&gt; Id -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Utils.html#bindNonRec"><span class="hs-identifier hs-var hs-var">bindNonRec</span></a></span></span><span> </span><span id="local-6989586621682702792"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702792"><span class="hs-identifier hs-var">bndr</span></a></span></span><span> </span><span id="local-6989586621682702793"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702793"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span id="local-6989586621682702794"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702794"><span class="hs-identifier hs-var">body</span></a></span></span><span>
</span><span id="line-496"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702792"><span class="hs-identifier hs-var">bndr</span></a></span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702795"><span class="hs-identifier hs-var">let_bind</span></a></span><span>
</span><span id="line-497"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Var.html#isCoVar"><span class="hs-identifier hs-var">isCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702792"><span class="hs-identifier hs-var">bndr</span></a></span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Bool
forall b. Expr b -&gt; Bool
</span><a href="GHC.Core.html#isCoArg"><span class="hs-identifier hs-var">isCoArg</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702793"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702795"><span class="hs-identifier hs-var">let_bind</span></a></span><span>
</span><span id="line-498"></span><span>    </span><span class="hs-comment">{- See Note [Binding coercions] -}</span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702797"><span class="hs-identifier hs-var">case_bind</span></a></span><span>
</span><span id="line-499"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Id.html#isJoinId"><span class="hs-identifier hs-var">isJoinId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702792"><span class="hs-identifier hs-var">bndr</span></a></span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702795"><span class="hs-identifier hs-var">let_bind</span></a></span><span>
</span><span id="line-500"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; CoreExpr -&gt; Bool
Type -&gt; CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#needsCaseBinding"><span class="hs-identifier hs-var">needsCaseBinding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702792"><span class="hs-identifier hs-var">bndr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702793"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702797"><span class="hs-identifier hs-var">case_bind</span></a></span><span>
</span><span id="line-501"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702795"><span class="hs-identifier hs-var">let_bind</span></a></span><span>
</span><span id="line-502"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-503"></span><span>    </span><span id="local-6989586621682702797"><span class="annot"><span class="annottext">case_bind :: CoreExpr
</span><a href="#local-6989586621682702797"><span class="hs-identifier hs-var hs-var">case_bind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Id -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Utils.html#mkDefaultCase"><span class="hs-identifier hs-var">mkDefaultCase</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702793"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702792"><span class="hs-identifier hs-var">bndr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702794"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-504"></span><span>    </span><span id="local-6989586621682702795"><span class="annot"><span class="annottext">let_bind :: CoreExpr
</span><a href="#local-6989586621682702795"><span class="hs-identifier hs-var hs-var">let_bind</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bind Id -&gt; CoreExpr -&gt; CoreExpr
forall b. Bind b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr -&gt; Bind Id
forall b. b -&gt; Expr b -&gt; Bind b
</span><a href="GHC.Core.html#NonRec"><span class="hs-identifier hs-var">NonRec</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702792"><span class="hs-identifier hs-var">bndr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702793"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702794"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-505"></span><span>
</span><span id="line-506"></span><span class="hs-comment">-- | `needsCaseBinding` tests whether we have to use a @case@ rather than @let@</span><span>
</span><span id="line-507"></span><span class="hs-comment">-- binding for this expression as per the invariants of 'CoreExpr': see</span><span>
</span><span id="line-508"></span><span class="hs-comment">-- &quot;GHC.Core#let_can_float_invariant&quot;</span><span>
</span><span id="line-509"></span><span class="hs-comment">-- (needsCaseBinding ty rhs) requires that `ty` has a well-defined levity, else</span><span>
</span><span id="line-510"></span><span class="hs-comment">-- `typeLevity ty` will fail; but that should be the case because</span><span>
</span><span id="line-511"></span><span class="hs-comment">-- `needsCaseBinding` is only called once typechecking is complete</span><span>
</span><span id="line-512"></span><span class="annot"><a href="GHC.Core.Utils.html#needsCaseBinding"><span class="hs-identifier hs-type">needsCaseBinding</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-513"></span><span id="needsCaseBinding"><span class="annot"><span class="annottext">needsCaseBinding :: HasDebugCallStack =&gt; Type -&gt; CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#needsCaseBinding"><span class="hs-identifier hs-var hs-var">needsCaseBinding</span></a></span></span><span> </span><span id="local-6989586621682702801"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702801"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621682702802"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702802"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Levity -&gt; CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#needsCaseBindingL"><span class="hs-identifier hs-var">needsCaseBindingL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Levity
Type -&gt; Levity
</span><a href="GHC.Core.Type.html#typeLevity"><span class="hs-identifier hs-var">typeLevity</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702801"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702802"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-514"></span><span>
</span><span id="line-515"></span><span class="annot"><a href="GHC.Core.Utils.html#needsCaseBindingL"><span class="hs-identifier hs-type">needsCaseBindingL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Levity"><span class="hs-identifier hs-type">Levity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-516"></span><span class="hs-comment">-- True &lt;=&gt; make a case expression instead of a let</span><span>
</span><span id="line-517"></span><span class="hs-comment">-- These can arise either from the desugarer,</span><span>
</span><span id="line-518"></span><span class="hs-comment">-- or from beta reductions: (\x.e) (x +# y)</span><span>
</span><span id="line-519"></span><span id="needsCaseBindingL"><span class="annot"><span class="annottext">needsCaseBindingL :: Levity -&gt; CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#needsCaseBindingL"><span class="hs-identifier hs-var hs-var">needsCaseBindingL</span></a></span></span><span> </span><span class="annot"><span class="annottext">Levity
</span><a href="GHC.Types.Basic.html#Lifted"><span class="hs-identifier hs-var">Lifted</span></a></span><span>   </span><span id="local-6989586621682702805"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702805"><span class="hs-identifier hs-var">_rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-520"></span><span class="annot"><a href="GHC.Core.Utils.html#needsCaseBindingL"><span class="hs-identifier hs-var">needsCaseBindingL</span></a></span><span> </span><span class="annot"><span class="annottext">Levity
</span><a href="GHC.Types.Basic.html#Unlifted"><span class="hs-identifier hs-var">Unlifted</span></a></span><span> </span><span id="local-6989586621682702807"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702807"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#exprOkForSpeculation"><span class="hs-identifier hs-var">exprOkForSpeculation</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702807"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-521"></span><span>
</span><span id="line-522"></span><span class="annot"><a href="GHC.Core.Utils.html#mkAltExpr"><span class="hs-identifier hs-type">mkAltExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#AltCon"><span class="hs-identifier hs-type">AltCon</span></a></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Case alternative constructor</span></span><span>
</span><span id="line-523"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreBndr"><span class="hs-identifier hs-type">CoreBndr</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-comment">-- ^ Things bound by the pattern match</span></span><span>
</span><span id="line-524"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span>     </span><span class="annot"><span class="hs-comment">-- ^ The type arguments to the case alternative</span></span><span>
</span><span id="line-525"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-526"></span><span class="hs-comment">-- ^ This guy constructs the value that the scrutinee must have</span><span>
</span><span id="line-527"></span><span class="hs-comment">-- given that you are in one particular branch of a case</span><span>
</span><span id="line-528"></span><span id="mkAltExpr"><span class="annot"><span class="annottext">mkAltExpr :: AltCon -&gt; [Id] -&gt; [Type] -&gt; CoreExpr
</span><a href="GHC.Core.Utils.html#mkAltExpr"><span class="hs-identifier hs-var hs-var">mkAltExpr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#DataAlt"><span class="hs-identifier hs-type">DataAlt</span></a></span><span> </span><span id="local-6989586621682702810"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682702810"><span class="hs-identifier hs-var">con</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682702811"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682702811"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621682702812"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682702812"><span class="hs-identifier hs-var">inst_tys</span></a></span></span><span>
</span><span id="line-529"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [CoreExpr] -&gt; CoreExpr
forall b. DataCon -&gt; [Arg b] -&gt; Arg b
</span><a href="GHC.Core.html#mkConApp"><span class="hs-identifier hs-var">mkConApp</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682702810"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Type -&gt; CoreExpr) -&gt; [Type] -&gt; [CoreExpr]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; CoreExpr
forall b. Type -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682702812"><span class="hs-identifier hs-var">inst_tys</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr] -&gt; [CoreExpr] -&gt; [CoreExpr]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; [CoreExpr]
forall b. [Id] -&gt; [Expr b]
</span><a href="GHC.Core.html#varsToCoreExprs"><span class="hs-identifier hs-var">varsToCoreExprs</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682702811"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-530"></span><span class="annot"><a href="GHC.Core.Utils.html#mkAltExpr"><span class="hs-identifier hs-var">mkAltExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#LitAlt"><span class="hs-identifier hs-type">LitAlt</span></a></span><span> </span><span id="local-6989586621682702816"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682702816"><span class="hs-identifier hs-var">lit</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-531"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; CoreExpr
forall b. Literal -&gt; Expr b
</span><a href="GHC.Core.html#Lit"><span class="hs-identifier hs-var">Lit</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682702816"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-532"></span><span class="annot"><a href="GHC.Core.Utils.html#mkAltExpr"><span class="hs-identifier hs-var">mkAltExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#LitAlt"><span class="hs-identifier hs-type">LitAlt</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; CoreExpr
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mkAltExpr LitAlt&quot;</span></span><span>
</span><span id="line-533"></span><span class="annot"><a href="GHC.Core.Utils.html#mkAltExpr"><span class="hs-identifier hs-var">mkAltExpr</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="GHC.Core.html#DEFAULT"><span class="hs-identifier hs-var">DEFAULT</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; CoreExpr
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mkAltExpr DEFAULT&quot;</span></span><span>
</span><span id="line-534"></span><span>
</span><span id="line-535"></span><span class="annot"><a href="GHC.Core.Utils.html#mkDefaultCase"><span class="hs-identifier hs-type">mkDefaultCase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-536"></span><span class="hs-comment">-- Make (case x of y { DEFAULT -&gt; e }</span><span>
</span><span id="line-537"></span><span id="mkDefaultCase"><span class="annot"><span class="annottext">mkDefaultCase :: CoreExpr -&gt; Id -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Utils.html#mkDefaultCase"><span class="hs-identifier hs-var hs-var">mkDefaultCase</span></a></span></span><span> </span><span id="local-6989586621682702818"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702818"><span class="hs-identifier hs-var">scrut</span></a></span></span><span> </span><span id="local-6989586621682702819"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702819"><span class="hs-identifier hs-var">case_bndr</span></a></span></span><span> </span><span id="local-6989586621682702820"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702820"><span class="hs-identifier hs-var">body</span></a></span></span><span>
</span><span id="line-538"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Id -&gt; Type -&gt; [Alt Id] -&gt; CoreExpr
forall b. Expr b -&gt; b -&gt; Type -&gt; [Alt b] -&gt; Expr b
</span><a href="GHC.Core.html#Case"><span class="hs-identifier hs-var">Case</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702818"><span class="hs-identifier hs-var">scrut</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702819"><span class="hs-identifier hs-var">case_bndr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoreExpr -&gt; Type
CoreExpr -&gt; Type
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702820"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">AltCon -&gt; [Id] -&gt; CoreExpr -&gt; Alt Id
forall b. AltCon -&gt; [b] -&gt; Expr b -&gt; Alt b
</span><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-var">Alt</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="GHC.Core.html#DEFAULT"><span class="hs-identifier hs-var">DEFAULT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702820"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-539"></span><span>
</span><span id="line-540"></span><span class="annot"><a href="GHC.Core.Utils.html#mkSingleAltCase"><span class="hs-identifier hs-type">mkSingleAltCase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#AltCon"><span class="hs-identifier hs-type">AltCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-541"></span><span class="hs-comment">-- Use this function if possible, when building a case,</span><span>
</span><span id="line-542"></span><span class="hs-comment">-- because it ensures that the type on the Case itself</span><span>
</span><span id="line-543"></span><span class="hs-comment">-- doesn't mention variables bound by the case</span><span>
</span><span id="line-544"></span><span class="hs-comment">-- See Note [Care with the type of a case expression]</span><span>
</span><span id="line-545"></span><span id="mkSingleAltCase"><span class="annot"><span class="annottext">mkSingleAltCase :: CoreExpr -&gt; Id -&gt; AltCon -&gt; [Id] -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Utils.html#mkSingleAltCase"><span class="hs-identifier hs-var hs-var">mkSingleAltCase</span></a></span></span><span> </span><span id="local-6989586621682702821"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702821"><span class="hs-identifier hs-var">scrut</span></a></span></span><span> </span><span id="local-6989586621682702822"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702822"><span class="hs-identifier hs-var">case_bndr</span></a></span></span><span> </span><span id="local-6989586621682702823"><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621682702823"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621682702824"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682702824"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span> </span><span id="local-6989586621682702825"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702825"><span class="hs-identifier hs-var">body</span></a></span></span><span>
</span><span id="line-546"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Id -&gt; Type -&gt; [Alt Id] -&gt; CoreExpr
forall b. Expr b -&gt; b -&gt; Type -&gt; [Alt b] -&gt; Expr b
</span><a href="GHC.Core.html#Case"><span class="hs-identifier hs-var">Case</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702821"><span class="hs-identifier hs-var">scrut</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702822"><span class="hs-identifier hs-var">case_bndr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702826"><span class="hs-identifier hs-var">case_ty</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">AltCon -&gt; [Id] -&gt; CoreExpr -&gt; Alt Id
forall b. AltCon -&gt; [b] -&gt; Expr b -&gt; Alt b
</span><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-var">Alt</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621682702823"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682702824"><span class="hs-identifier hs-var">bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702825"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-547"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-548"></span><span>    </span><span id="local-6989586621682702827"><span class="annot"><span class="annottext">body_ty :: Type
</span><a href="#local-6989586621682702827"><span class="hs-identifier hs-var hs-var">body_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoreExpr -&gt; Type
CoreExpr -&gt; Type
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702825"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-549"></span><span>
</span><span id="line-550"></span><span>    </span><span id="local-6989586621682702826"><span class="annot"><span class="annottext">case_ty :: Type
</span><a href="#local-6989586621682702826"><span class="hs-identifier hs-var hs-var">case_ty</span></a></span></span><span> </span><span class="hs-comment">-- See Note [Care with the type of a case expression]</span><span>
</span><span id="line-551"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682702828"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702828"><span class="hs-identifier hs-var">body_ty'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Type -&gt; Maybe Type
</span><a href="GHC.Core.TyCo.FVs.html#occCheckExpand"><span class="hs-identifier hs-var">occCheckExpand</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682702824"><span class="hs-identifier hs-var">bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702827"><span class="hs-identifier hs-var">body_ty</span></a></span><span>
</span><span id="line-552"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702828"><span class="hs-identifier hs-var">body_ty'</span></a></span><span>
</span><span id="line-553"></span><span>
</span><span id="line-554"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-555"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; Type
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mkSingleAltCase&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702821"><span class="hs-identifier hs-var">scrut</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682702824"><span class="hs-identifier hs-var">bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702827"><span class="hs-identifier hs-var">body_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-556"></span><span>
</span><span id="line-557"></span><span class="hs-comment">{- Note [Care with the type of a case expression]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider a phantom type synonym
   type S a = Int
and we want to form the case expression
   case x of K (a::*) -&gt; (e :: S a)

We must not make the type field of the case-expression (S a) because
'a' isn't in scope.  Hence the call to occCheckExpand.  This caused
issue #17056.

NB: this situation can only arise with type synonyms, which can
falsely &quot;mention&quot; type variables that aren't &quot;really there&quot;, and which
can be eliminated by expanding the synonym.

Note [Binding coercions]
~~~~~~~~~~~~~~~~~~~~~~~~
Consider binding a CoVar, c = e.  Then, we must satisfy
Note [Core type and coercion invariant] in GHC.Core,
which allows only (Coercion co) on the RHS.

************************************************************************
*                                                                      *
               Operations over case alternatives
*                                                                      *
************************************************************************

The default alternative must be first, if it exists at all.
This makes it easy to find, though it makes matching marginally harder.
-}</span><span>
</span><span id="line-587"></span><span>
</span><span id="line-588"></span><span class="annot"><span class="hs-comment">-- | Extract the default case alternative</span></span><span>
</span><span id="line-589"></span><span id="local-6989586621682701928"><span class="annot"><a href="GHC.Core.Utils.html#findDefault"><span class="hs-identifier hs-type">findDefault</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682701928"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682701928"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682701928"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-590"></span><span id="findDefault"><span class="annot"><span class="annottext">findDefault :: forall b. [Alt b] -&gt; ([Alt b], Maybe (Expr b))
</span><a href="GHC.Core.Utils.html#findDefault"><span class="hs-identifier hs-var hs-var">findDefault</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="GHC.Core.html#DEFAULT"><span class="hs-identifier hs-var">DEFAULT</span></a></span><span> </span><span id="local-6989586621682702832"><span class="annot"><span class="annottext">[b]
</span><a href="#local-6989586621682702832"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621682702833"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702833"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682702834"><span class="annot"><span class="annottext">[Alt b]
</span><a href="#local-6989586621682702834"><span class="hs-identifier hs-var">alts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ([Alt b], Maybe (Expr b)) -&gt; ([Alt b], Maybe (Expr b))
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[b] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[b]
</span><a href="#local-6989586621682702832"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Alt b]
</span><a href="#local-6989586621682702834"><span class="hs-identifier hs-var">alts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Expr b -&gt; Maybe (Expr b)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702833"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-591"></span><span class="annot"><a href="GHC.Core.Utils.html#findDefault"><span class="hs-identifier hs-var">findDefault</span></a></span><span> </span><span id="local-6989586621682702837"><span class="annot"><span class="annottext">[Alt b]
</span><a href="#local-6989586621682702837"><span class="hs-identifier hs-var">alts</span></a></span></span><span>                          </span><span class="hs-glyph">=</span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Alt b]
</span><a href="#local-6989586621682702837"><span class="hs-identifier hs-var">alts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Expr b)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-592"></span><span>
</span><span id="line-593"></span><span id="local-6989586621682701932"><span class="annot"><a href="GHC.Core.Utils.html#addDefault"><span class="hs-identifier hs-type">addDefault</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682701932"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682701932"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682701932"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-594"></span><span id="addDefault"><span class="annot"><span class="annottext">addDefault :: forall b. [Alt b] -&gt; Maybe (Expr b) -&gt; [Alt b]
</span><a href="GHC.Core.Utils.html#addDefault"><span class="hs-identifier hs-var hs-var">addDefault</span></a></span></span><span> </span><span id="local-6989586621682702838"><span class="annot"><span class="annottext">[Alt b]
</span><a href="#local-6989586621682702838"><span class="hs-identifier hs-var">alts</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (Expr b)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Alt b]
</span><a href="#local-6989586621682702838"><span class="hs-identifier hs-var">alts</span></a></span><span>
</span><span id="line-595"></span><span class="annot"><a href="GHC.Core.Utils.html#addDefault"><span class="hs-identifier hs-var">addDefault</span></a></span><span> </span><span id="local-6989586621682702839"><span class="annot"><span class="annottext">[Alt b]
</span><a href="#local-6989586621682702839"><span class="hs-identifier hs-var">alts</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682702840"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702840"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AltCon -&gt; [b] -&gt; Expr b -&gt; Alt b
forall b. AltCon -&gt; [b] -&gt; Expr b -&gt; Alt b
</span><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-var">Alt</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="GHC.Core.html#DEFAULT"><span class="hs-identifier hs-var">DEFAULT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702840"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">Alt b -&gt; [Alt b] -&gt; [Alt b]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Alt b]
</span><a href="#local-6989586621682702839"><span class="hs-identifier hs-var">alts</span></a></span><span>
</span><span id="line-596"></span><span>
</span><span id="line-597"></span><span id="local-6989586621682701934"><span class="annot"><a href="GHC.Core.Utils.html#isDefaultAlt"><span class="hs-identifier hs-type">isDefaultAlt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682701934"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-598"></span><span id="isDefaultAlt"><span class="annot"><span class="annottext">isDefaultAlt :: forall b. Alt b -&gt; Bool
</span><a href="GHC.Core.Utils.html#isDefaultAlt"><span class="hs-identifier hs-var hs-var">isDefaultAlt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="GHC.Core.html#DEFAULT"><span class="hs-identifier hs-var">DEFAULT</span></a></span><span> </span><span class="annot"><span class="annottext">[b]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-599"></span><span class="annot"><a href="GHC.Core.Utils.html#isDefaultAlt"><span class="hs-identifier hs-var">isDefaultAlt</span></a></span><span> </span><span class="annot"><span class="annottext">Alt b
</span><span class="hs-identifier">_</span></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-600"></span><span>
</span><span id="line-601"></span><span class="hs-comment">-- | Find the case alternative corresponding to a particular</span><span>
</span><span id="line-602"></span><span class="hs-comment">-- constructor: panics if no such constructor exists</span><span>
</span><span id="line-603"></span><span id="local-6989586621682701936"><span class="annot"><a href="GHC.Core.Utils.html#findAlt"><span class="hs-identifier hs-type">findAlt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#AltCon"><span class="hs-identifier hs-type">AltCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682701936"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682701936"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-604"></span><span>    </span><span class="hs-comment">-- A &quot;Nothing&quot; result *is* legitimate</span><span>
</span><span id="line-605"></span><span>    </span><span class="hs-comment">-- See Note [Unreachable code]</span><span>
</span><span id="line-606"></span><span id="findAlt"><span class="annot"><span class="annottext">findAlt :: forall b. AltCon -&gt; [Alt b] -&gt; Maybe (Alt b)
</span><a href="GHC.Core.Utils.html#findAlt"><span class="hs-identifier hs-var hs-var">findAlt</span></a></span></span><span> </span><span id="local-6989586621682702844"><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621682702844"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621682702845"><span class="annot"><span class="annottext">[Alt b]
</span><a href="#local-6989586621682702845"><span class="hs-identifier hs-var">alts</span></a></span></span><span>
</span><span id="line-607"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Alt b]
</span><a href="#local-6989586621682702845"><span class="hs-identifier hs-var">alts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-608"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682702846"><span class="annot"><span class="annottext">deflt :: Alt b
</span><a href="#local-6989586621682702846"><span class="hs-identifier hs-var">deflt</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="GHC.Core.html#DEFAULT"><span class="hs-identifier hs-var">DEFAULT</span></a></span><span> </span><span class="annot"><span class="annottext">[b]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682702847"><span class="annot"><span class="annottext">[Alt b]
</span><a href="#local-6989586621682702847"><span class="hs-identifier hs-var">alts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Alt b] -&gt; Maybe (Alt b) -&gt; Maybe (Alt b)
</span><a href="#local-6989586621682702848"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Alt b]
</span><a href="#local-6989586621682702847"><span class="hs-identifier hs-var">alts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Alt b -&gt; Maybe (Alt b)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Alt b
</span><a href="#local-6989586621682702846"><span class="hs-identifier hs-var">deflt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-609"></span><span>        </span><span class="annot"><span class="annottext">[Alt b]
</span><span class="hs-identifier">_</span></span><span>                              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Alt b] -&gt; Maybe (Alt b) -&gt; Maybe (Alt b)
</span><a href="#local-6989586621682702848"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Alt b]
</span><a href="#local-6989586621682702845"><span class="hs-identifier hs-var">alts</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Alt b)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-610"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-611"></span><span>    </span><span id="local-6989586621682702848"><span class="annot"><span class="annottext">go :: [Alt b] -&gt; Maybe (Alt b) -&gt; Maybe (Alt b)
</span><a href="#local-6989586621682702848"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>                     </span><span id="local-6989586621682702849"><span class="annot"><span class="annottext">Maybe (Alt b)
</span><a href="#local-6989586621682702849"><span class="hs-identifier hs-var">deflt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Alt b)
</span><a href="#local-6989586621682702849"><span class="hs-identifier hs-var">deflt</span></a></span><span>
</span><span id="line-612"></span><span>    </span><span class="annot"><a href="#local-6989586621682702848"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682702850"><span class="annot"><span class="annottext">alt :: Alt b
</span><a href="#local-6989586621682702850"><span class="hs-identifier hs-var">alt</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span id="local-6989586621682702851"><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621682702851"><span class="hs-identifier hs-var">con1</span></a></span></span><span> </span><span class="annot"><span class="annottext">[b]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682702852"><span class="annot"><span class="annottext">[Alt b]
</span><a href="#local-6989586621682702852"><span class="hs-identifier hs-var">alts</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682702853"><span class="annot"><span class="annottext">Maybe (Alt b)
</span><a href="#local-6989586621682702853"><span class="hs-identifier hs-var">deflt</span></a></span></span><span>
</span><span id="line-613"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621682702844"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon -&gt; AltCon -&gt; Ordering
</span><a href="GHC.Core.html#cmpAltCon"><span class="hs-operator hs-var">`cmpAltCon`</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621682702851"><span class="hs-identifier hs-var">con1</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-614"></span><span>          </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">LT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Alt b)
</span><a href="#local-6989586621682702853"><span class="hs-identifier hs-var">deflt</span></a></span><span>   </span><span class="hs-comment">-- Missed it already; the alts are in increasing order</span><span>
</span><span id="line-615"></span><span>          </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Alt b -&gt; Maybe (Alt b)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Alt b
</span><a href="#local-6989586621682702850"><span class="hs-identifier hs-var">alt</span></a></span><span>
</span><span id="line-616"></span><span>          </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe (Alt b) -&gt; Maybe (Alt b)
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621682702851"><span class="hs-identifier hs-var">con1</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon -&gt; AltCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="GHC.Core.html#DEFAULT"><span class="hs-identifier hs-var">DEFAULT</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (Alt b) -&gt; Maybe (Alt b)) -&gt; Maybe (Alt b) -&gt; Maybe (Alt b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Alt b] -&gt; Maybe (Alt b) -&gt; Maybe (Alt b)
</span><a href="#local-6989586621682702848"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Alt b]
</span><a href="#local-6989586621682702852"><span class="hs-identifier hs-var">alts</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Alt b)
</span><a href="#local-6989586621682702853"><span class="hs-identifier hs-var">deflt</span></a></span><span>
</span><span id="line-617"></span><span>
</span><span id="line-618"></span><span class="hs-comment">{- Note [Unreachable code]
~~~~~~~~~~~~~~~~~~~~~~~~~~
It is possible (although unusual) for GHC to find a case expression
that cannot match.  For example:

     data Col = Red | Green | Blue
     x = Red
     f v = case x of
              Red -&gt; ...
              _ -&gt; ...(case x of { Green -&gt; e1; Blue -&gt; e2 })...

Suppose that for some silly reason, x isn't substituted in the case
expression.  (Perhaps there's a NOINLINE on it, or profiling SCC stuff
gets in the way; cf #3118.)  Then the full-laziness pass might produce
this

     x = Red
     lvl = case x of { Green -&gt; e1; Blue -&gt; e2 })
     f v = case x of
             Red -&gt; ...
             _ -&gt; ...lvl...

Now if x gets inlined, we won't be able to find a matching alternative
for 'Red'.  That's because 'lvl' is unreachable.  So rather than crashing
we generate (error &quot;Inaccessible alternative&quot;).

Similar things can happen (augmented by GADTs) when the Simplifier
filters down the matching alternatives in GHC.Core.Opt.Simplify.rebuildCase.
-}</span><span>
</span><span id="line-647"></span><span>
</span><span id="line-648"></span><span class="hs-comment">---------------------------------</span><span>
</span><span id="line-649"></span><span class="annot"><a href="GHC.Core.Utils.html#mergeCaseAlts"><span class="hs-identifier hs-type">mergeCaseAlts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreAlt"><span class="hs-identifier hs-type">CoreAlt</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreBind"><span class="hs-identifier hs-type">CoreBind</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreAlt"><span class="hs-identifier hs-type">CoreAlt</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-650"></span><span class="hs-comment">-- See Note [Merge Nested Cases]</span><span>
</span><span id="line-651"></span><span id="mergeCaseAlts"><span class="annot"><span class="annottext">mergeCaseAlts :: Id -&gt; [Alt Id] -&gt; Maybe ([Bind Id], [Alt Id])
</span><a href="GHC.Core.Utils.html#mergeCaseAlts"><span class="hs-identifier hs-var hs-var">mergeCaseAlts</span></a></span></span><span> </span><span id="local-6989586621682702856"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702856"><span class="hs-identifier hs-var">outer_bndr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="GHC.Core.html#DEFAULT"><span class="hs-identifier hs-var">DEFAULT</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682702857"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702857"><span class="hs-identifier hs-var">deflt_rhs</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682702858"><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682702858"><span class="hs-identifier hs-var">outer_alts</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-652"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682702859"><span class="annot"><span class="annottext">[Bind Id]
</span><a href="#local-6989586621682702859"><span class="hs-identifier hs-var">joins</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682702860"><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682702860"><span class="hs-identifier hs-var">inner_alts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Maybe ([Bind Id], [Alt Id])
</span><a href="#local-6989586621682702861"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702857"><span class="hs-identifier hs-var">deflt_rhs</span></a></span><span>
</span><span id="line-653"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Bind Id], [Alt Id]) -&gt; Maybe ([Bind Id], [Alt Id])
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Bind Id]
</span><a href="#local-6989586621682702859"><span class="hs-identifier hs-var">joins</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Alt Id] -&gt; [Alt Id] -&gt; [Alt Id]
forall a. [Alt a] -&gt; [Alt a] -&gt; [Alt a]
</span><a href="GHC.Core.Utils.html#mergeAlts"><span class="hs-identifier hs-var">mergeAlts</span></a></span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682702858"><span class="hs-identifier hs-var">outer_alts</span></a></span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682702860"><span class="hs-identifier hs-var">inner_alts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-654"></span><span>                </span><span class="hs-comment">-- NB: mergeAlts gives priority to the left</span><span>
</span><span id="line-655"></span><span>                </span><span class="hs-comment">--      case x of</span><span>
</span><span id="line-656"></span><span>                </span><span class="hs-comment">--        A -&gt; e1</span><span>
</span><span id="line-657"></span><span>                </span><span class="hs-comment">--        DEFAULT -&gt; case x of</span><span>
</span><span id="line-658"></span><span>                </span><span class="hs-comment">--                      A -&gt; e2</span><span>
</span><span id="line-659"></span><span>                </span><span class="hs-comment">--                      B -&gt; e3</span><span>
</span><span id="line-660"></span><span>                </span><span class="hs-comment">-- When we merge, we must ensure that e1 takes</span><span>
</span><span id="line-661"></span><span>                </span><span class="hs-comment">-- precedence over e2 as the value for A!</span><span>
</span><span id="line-662"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-663"></span><span>    </span><span class="annot"><a href="#local-6989586621682702861"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreBind"><span class="hs-identifier hs-type">CoreBind</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreAlt"><span class="hs-identifier hs-type">CoreAlt</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-664"></span><span>
</span><span id="line-665"></span><span>    </span><span class="hs-comment">-- Whizzo: we can merge!</span><span>
</span><span id="line-666"></span><span>    </span><span id="local-6989586621682702861"><span class="annot"><span class="annottext">go :: CoreExpr -&gt; Maybe ([Bind Id], [Alt Id])
</span><a href="#local-6989586621682702861"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Case"><span class="hs-identifier hs-type">Case</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682702862"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702862"><span class="hs-identifier hs-var">inner_scrut_var</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682702863"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702863"><span class="hs-identifier hs-var">inner_bndr</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682702864"><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682702864"><span class="hs-identifier hs-var">inner_alts</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-667"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702862"><span class="hs-identifier hs-var">inner_scrut_var</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Id -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702856"><span class="hs-identifier hs-var">outer_bndr</span></a></span><span>
</span><span id="line-668"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702863"><span class="hs-identifier hs-var">inner_bndr</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Id -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702856"><span class="hs-identifier hs-var">outer_bndr</span></a></span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- Avoid shadowing</span><span>
</span><span id="line-669"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682702865"><span class="annot"><span class="annottext">wrap_let :: CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702865"><span class="hs-identifier hs-var hs-var">wrap_let</span></a></span></span><span> </span><span id="local-6989586621682702866"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702866"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bind Id -&gt; CoreExpr -&gt; CoreExpr
forall b. Bind b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr -&gt; Bind Id
forall b. b -&gt; Expr b -&gt; Bind b
</span><a href="GHC.Core.html#NonRec"><span class="hs-identifier hs-var">NonRec</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702863"><span class="hs-identifier hs-var">inner_bndr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702856"><span class="hs-identifier hs-var">outer_bndr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702866"><span class="hs-identifier hs-var">rhs'</span></a></span><span>
</span><span id="line-670"></span><span>                </span><span class="hs-comment">-- inner_bndr is never dead!  It's the scrutinee!</span><span>
</span><span id="line-671"></span><span>                </span><span class="hs-comment">-- The let is OK even for unboxed binders</span><span>
</span><span id="line-672"></span><span>                </span><span class="hs-comment">-- See Note [Merge Nested Cases] wrinkle (MC2)</span><span>
</span><span id="line-673"></span><span>             </span><span id="local-6989586621682702867"><span class="annot"><span class="annottext">do_one :: Alt Id -&gt; Maybe (Alt Id)
</span><a href="#local-6989586621682702867"><span class="hs-identifier hs-var hs-var">do_one</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span id="local-6989586621682702868"><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621682702868"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621682702869"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682702869"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span> </span><span id="local-6989586621682702870"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702870"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-674"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Bool) -&gt; [Id] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Id -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702856"><span class="hs-identifier hs-var">outer_bndr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682702869"><span class="hs-identifier hs-var">bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Alt Id)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-675"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Alt Id -&gt; Maybe (Alt Id)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AltCon -&gt; [Id] -&gt; CoreExpr -&gt; Alt Id
forall b. AltCon -&gt; [b] -&gt; Expr b -&gt; Alt b
</span><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-var">Alt</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621682702868"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682702869"><span class="hs-identifier hs-var">bndrs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682702865"><span class="hs-identifier hs-var">wrap_let</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702870"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-676"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682702872"><span class="annot"><a href="#local-6989586621682702872"><span class="hs-identifier hs-var">alts'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Alt Id -&gt; Maybe (Alt Id)) -&gt; [Alt Id] -&gt; Maybe [Alt Id]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Alt Id -&gt; Maybe (Alt Id)
</span><a href="#local-6989586621682702867"><span class="hs-identifier hs-var">do_one</span></a></span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682702864"><span class="hs-identifier hs-var">inner_alts</span></a></span><span>
</span><span id="line-677"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682702872"><span class="hs-identifier hs-type">alts'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-678"></span><span>
</span><span id="line-679"></span><span>    </span><span class="hs-comment">-- Deal with tagToEnum# See Note [Merge Nested Cases] wrinkle (MC3)</span><span>
</span><span id="line-680"></span><span>    </span><span class="annot"><a href="#local-6989586621682702861"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#App"><span class="hs-identifier hs-type">App</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#App"><span class="hs-identifier hs-type">App</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682702874"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702874"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span id="local-6989586621682702875"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702875"><span class="hs-identifier hs-var">type_arg</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682702876"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702876"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-681"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702876"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Id -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702856"><span class="hs-identifier hs-var">outer_bndr</span></a></span><span>
</span><span id="line-682"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">PrimOp
</span><a href="GHC.Builtin.PrimOps.html#TagToEnumOp"><span class="hs-identifier hs-var">TagToEnumOp</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Maybe PrimOp
</span><a href="GHC.Types.Id.html#isPrimOpId_maybe"><span class="hs-identifier hs-var">isPrimOpId_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702874"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-683"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682702879"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682702879"><span class="hs-identifier hs-var">tc</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe TyCon
</span><a href="GHC.Core.Type.html#tyConAppTyCon_maybe"><span class="hs-identifier hs-var">tyConAppTyCon_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702875"><span class="hs-identifier hs-var">type_arg</span></a></span><span>
</span><span id="line-684"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682702881"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682702881"><span class="hs-identifier hs-var">dc1</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682702882"><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621682702882"><span class="hs-identifier hs-var">dcs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe [DataCon]
</span><a href="GHC.Core.TyCon.html#tyConDataCons_maybe"><span class="hs-identifier hs-var">tyConDataCons_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682702879"><span class="hs-identifier hs-var">tc</span></a></span><span>   </span><span class="hs-comment">-- At least one data constructor</span><span>
</span><span id="line-685"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621682702882"><span class="hs-identifier hs-var">dcs</span></a></span><span> </span><span class="annot"><span class="annottext">[DataCon] -&gt; Int -&gt; Bool
forall a. [a] -&gt; Int -&gt; Bool
</span><a href="GHC.Utils.Misc.html#lengthAtMost"><span class="hs-operator hs-var">`lengthAtMost`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span>  </span><span class="hs-comment">-- Arbitrary</span><span>
</span><span id="line-686"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Bind Id], [Alt Id]) -&gt; Maybe ([Bind Id], [Alt Id])
forall a. a -&gt; Maybe a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [DataCon] -&gt; [Alt Id]
forall {b}. DataCon -&gt; [DataCon] -&gt; [Alt b]
</span><a href="#local-6989586621682702885"><span class="hs-identifier hs-var">mk_alts</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682702881"><span class="hs-identifier hs-var">dc1</span></a></span><span> </span><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621682702882"><span class="hs-identifier hs-var">dcs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-687"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-688"></span><span>        </span><span id="local-6989586621682702888"><span class="annot"><span class="annottext">mk_lit :: DataCon -&gt; Literal
</span><a href="#local-6989586621682702888"><span class="hs-identifier hs-var hs-var">mk_lit</span></a></span></span><span> </span><span id="local-6989586621682702889"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682702889"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Literal
</span><a href="GHC.Types.Literal.html#mkLitIntUnchecked"><span class="hs-identifier hs-var">mkLitIntUnchecked</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Literal) -&gt; Integer -&gt; Literal
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><span class="hs-identifier hs-var">toInteger</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Integer) -&gt; Int -&gt; Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Int
</span><a href="GHC.Core.DataCon.html#dataConTagZ"><span class="hs-identifier hs-var">dataConTagZ</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682702889"><span class="hs-identifier hs-var">dc</span></a></span><span>
</span><span id="line-689"></span><span>        </span><span id="local-6989586621682702892"><span class="annot"><span class="annottext">mk_rhs :: DataCon -&gt; Expr b
</span><a href="#local-6989586621682702892"><span class="hs-identifier hs-var hs-var">mk_rhs</span></a></span></span><span> </span><span id="local-6989586621682702893"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682702893"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Expr b
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Id
</span><a href="GHC.Core.DataCon.html#dataConWorkId"><span class="hs-identifier hs-var">dataConWorkId</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682702893"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-690"></span><span>        </span><span id="local-6989586621682702885"><span class="annot"><span class="annottext">mk_alts :: DataCon -&gt; [DataCon] -&gt; [Alt b]
</span><a href="#local-6989586621682702885"><span class="hs-identifier hs-var hs-var">mk_alts</span></a></span></span><span> </span><span id="local-6989586621682702895"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682702895"><span class="hs-identifier hs-var">dc1</span></a></span></span><span> </span><span id="local-6989586621682702896"><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621682702896"><span class="hs-identifier hs-var">dcs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">AltCon -&gt; [b] -&gt; Expr b -&gt; Alt b
forall b. AltCon -&gt; [b] -&gt; Expr b -&gt; Alt b
</span><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-var">Alt</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="GHC.Core.html#DEFAULT"><span class="hs-identifier hs-var">DEFAULT</span></a></span><span>              </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Expr b
forall {b}. DataCon -&gt; Expr b
</span><a href="#local-6989586621682702892"><span class="hs-identifier hs-var">mk_rhs</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682702895"><span class="hs-identifier hs-var">dc1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-691"></span><span>                        </span><span class="annot"><span class="annottext">Alt b -&gt; [Alt b] -&gt; [Alt b]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">AltCon -&gt; [b] -&gt; Expr b -&gt; Alt b
forall b. AltCon -&gt; [b] -&gt; Expr b -&gt; Alt b
</span><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-var">Alt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Literal -&gt; AltCon
</span><a href="GHC.Core.html#LitAlt"><span class="hs-identifier hs-var">LitAlt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Literal
</span><a href="#local-6989586621682702888"><span class="hs-identifier hs-var">mk_lit</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682702897"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Expr b
forall {b}. DataCon -&gt; Expr b
</span><a href="#local-6989586621682702892"><span class="hs-identifier hs-var">mk_rhs</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682702897"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682702897"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682702897"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621682702896"><span class="hs-identifier hs-var">dcs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-692"></span><span>
</span><span id="line-693"></span><span>    </span><span class="hs-comment">-- Float out let/join bindings</span><span>
</span><span id="line-694"></span><span>    </span><span class="hs-comment">-- See Note [Merge Nested Cases] wrinkle (MC4)</span><span>
</span><span id="line-695"></span><span>    </span><span class="annot"><a href="#local-6989586621682702861"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span id="local-6989586621682702898"><span class="annot"><span class="annottext">Bind Id
</span><a href="#local-6989586621682702898"><span class="hs-identifier hs-var">bind</span></a></span></span><span> </span><span id="local-6989586621682702899"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702899"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-696"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Alt Id] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682702858"><span class="hs-identifier hs-var">outer_alts</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bind Id -&gt; Bool
</span><a href="GHC.Core.Utils.html#isJoinBind"><span class="hs-identifier hs-var">isJoinBind</span></a></span><span> </span><span class="annot"><span class="annottext">Bind Id
</span><a href="#local-6989586621682702898"><span class="hs-identifier hs-var">bind</span></a></span><span>
</span><span id="line-697"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682702900"><span class="annot"><a href="#local-6989586621682702900"><span class="hs-identifier hs-var">joins</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682702901"><span class="annot"><a href="#local-6989586621682702901"><span class="hs-identifier hs-var">alts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Maybe ([Bind Id], [Alt Id])
</span><a href="#local-6989586621682702861"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702899"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-698"></span><span>
</span><span id="line-699"></span><span>             </span><span class="hs-comment">-- Check for capture; but only if we could otherwise do a merge</span><span>
</span><span id="line-700"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682702902"><span class="annot"><a href="#local-6989586621682702902"><span class="hs-identifier hs-var hs-var">capture</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702856"><span class="hs-identifier hs-var">outer_bndr</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; [Id] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">Bind Id -&gt; [Id]
forall b. Bind b -&gt; [b]
</span><a href="GHC.Core.html#bindersOf"><span class="hs-identifier hs-var">bindersOf</span></a></span><span> </span><span class="annot"><span class="annottext">Bind Id
</span><a href="#local-6989586621682702898"><span class="hs-identifier hs-var">bind</span></a></span><span>
</span><span id="line-701"></span><span>                           </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682702856"><span class="hs-identifier hs-var">outer_bndr</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Bind Id -&gt; VarSet
</span><a href="GHC.Core.FVs.html#bindFreeVars"><span class="hs-identifier hs-var">bindFreeVars</span></a></span><span> </span><span class="annot"><span class="annottext">Bind Id
</span><a href="#local-6989586621682702898"><span class="hs-identifier hs-var">bind</span></a></span><span>
</span><span id="line-702"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">guard</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="annot"><a href="#local-6989586621682702902"><span class="hs-identifier hs-type">capture</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-703"></span><span>
</span><span id="line-704"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682702898"><span class="hs-identifier hs-type">bind</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><a href="#local-6989586621682702900"><span class="hs-identifier hs-type">joins</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682702901"><span class="hs-identifier hs-type">alts</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-705"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-706"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ([Bind Id], [Alt Id])
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-707"></span><span>
</span><span id="line-708"></span><span>    </span><span class="hs-comment">-- We don't want ticks to get in the way; just push them inwards.</span><span>
</span><span id="line-709"></span><span>    </span><span class="hs-comment">-- (This happens when you add SourceTicks e.g. GHC.Num.Integer.integerLt#)</span><span>
</span><span id="line-710"></span><span>    </span><span class="annot"><a href="#local-6989586621682702861"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-type">Tick</span></a></span><span> </span><span id="local-6989586621682702905"><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682702905"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682702906"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702906"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-711"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682702907"><span class="annot"><a href="#local-6989586621682702907"><span class="hs-identifier hs-var">joins</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682702908"><span class="annot"><a href="#local-6989586621682702908"><span class="hs-identifier hs-var">alts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Maybe ([Bind Id], [Alt Id])
</span><a href="#local-6989586621682702861"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702906"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-712"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682702907"><span class="hs-identifier hs-type">joins</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682702909"><span class="hs-identifier hs-type">con</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682702910"><span class="hs-identifier hs-type">bs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-type">Tick</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682702905"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682702911"><span class="hs-identifier hs-type">rhs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span id="local-6989586621682702909"><span class="annot"><a href="#local-6989586621682702909"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621682702910"><span class="annot"><a href="#local-6989586621682702910"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span id="local-6989586621682702911"><span class="annot"><a href="#local-6989586621682702911"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682702908"><span class="hs-identifier hs-type">alts</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-713"></span><span>
</span><span id="line-714"></span><span>    </span><span class="annot"><a href="#local-6989586621682702861"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ([Bind Id], [Alt Id])
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-715"></span><span>
</span><span id="line-716"></span><span class="annot"><a href="GHC.Core.Utils.html#mergeCaseAlts"><span class="hs-identifier hs-var">mergeCaseAlts</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ([Bind Id], [Alt Id])
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-717"></span><span>
</span><span id="line-718"></span><span class="hs-comment">---------------------------------</span><span>
</span><span id="line-719"></span><span id="local-6989586621682701938"><span class="annot"><a href="GHC.Core.Utils.html#mergeAlts"><span class="hs-identifier hs-type">mergeAlts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682701938"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682701938"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682701938"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-720"></span><span class="hs-comment">-- ^ Merge alternatives preserving order; alternatives in</span><span>
</span><span id="line-721"></span><span class="hs-comment">-- the first argument shadow ones in the second</span><span>
</span><span id="line-722"></span><span id="mergeAlts"><span class="annot"><span class="annottext">mergeAlts :: forall a. [Alt a] -&gt; [Alt a] -&gt; [Alt a]
</span><a href="GHC.Core.Utils.html#mergeAlts"><span class="hs-identifier hs-var hs-var">mergeAlts</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621682702912"><span class="annot"><span class="annottext">[Alt a]
</span><a href="#local-6989586621682702912"><span class="hs-identifier hs-var">as2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Alt a]
</span><a href="#local-6989586621682702912"><span class="hs-identifier hs-var">as2</span></a></span><span>
</span><span id="line-723"></span><span class="annot"><a href="GHC.Core.Utils.html#mergeAlts"><span class="hs-identifier hs-var">mergeAlts</span></a></span><span> </span><span id="local-6989586621682702913"><span class="annot"><span class="annottext">[Alt a]
</span><a href="#local-6989586621682702913"><span class="hs-identifier hs-var">as1</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Alt a]
</span><a href="#local-6989586621682702913"><span class="hs-identifier hs-var">as1</span></a></span><span>
</span><span id="line-724"></span><span class="annot"><a href="GHC.Core.Utils.html#mergeAlts"><span class="hs-identifier hs-var">mergeAlts</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682702914"><span class="annot"><span class="annottext">Alt a
</span><a href="#local-6989586621682702914"><span class="hs-identifier hs-var">a1</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682702915"><span class="annot"><span class="annottext">[Alt a]
</span><a href="#local-6989586621682702915"><span class="hs-identifier hs-var">as1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682702916"><span class="annot"><span class="annottext">Alt a
</span><a href="#local-6989586621682702916"><span class="hs-identifier hs-var">a2</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682702917"><span class="annot"><span class="annottext">[Alt a]
</span><a href="#local-6989586621682702917"><span class="hs-identifier hs-var">as2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-725"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Alt a
</span><a href="#local-6989586621682702914"><span class="hs-identifier hs-var">a1</span></a></span><span> </span><span class="annot"><span class="annottext">Alt a -&gt; Alt a -&gt; Ordering
forall a. Alt a -&gt; Alt a -&gt; Ordering
</span><a href="GHC.Core.html#cmpAlt"><span class="hs-operator hs-var">`cmpAlt`</span></a></span><span> </span><span class="annot"><span class="annottext">Alt a
</span><a href="#local-6989586621682702916"><span class="hs-identifier hs-var">a2</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-726"></span><span>        </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">LT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Alt a
</span><a href="#local-6989586621682702914"><span class="hs-identifier hs-var">a1</span></a></span><span> </span><span class="annot"><span class="annottext">Alt a -&gt; [Alt a] -&gt; [Alt a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Alt a] -&gt; [Alt a] -&gt; [Alt a]
forall a. [Alt a] -&gt; [Alt a] -&gt; [Alt a]
</span><a href="GHC.Core.Utils.html#mergeAlts"><span class="hs-identifier hs-var">mergeAlts</span></a></span><span> </span><span class="annot"><span class="annottext">[Alt a]
</span><a href="#local-6989586621682702915"><span class="hs-identifier hs-var">as1</span></a></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Alt a
</span><a href="#local-6989586621682702916"><span class="hs-identifier hs-var">a2</span></a></span><span class="annot"><span class="annottext">Alt a -&gt; [Alt a] -&gt; [Alt a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Alt a]
</span><a href="#local-6989586621682702917"><span class="hs-identifier hs-var">as2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-727"></span><span>        </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Alt a
</span><a href="#local-6989586621682702914"><span class="hs-identifier hs-var">a1</span></a></span><span> </span><span class="annot"><span class="annottext">Alt a -&gt; [Alt a] -&gt; [Alt a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Alt a] -&gt; [Alt a] -&gt; [Alt a]
forall a. [Alt a] -&gt; [Alt a] -&gt; [Alt a]
</span><a href="GHC.Core.Utils.html#mergeAlts"><span class="hs-identifier hs-var">mergeAlts</span></a></span><span> </span><span class="annot"><span class="annottext">[Alt a]
</span><a href="#local-6989586621682702915"><span class="hs-identifier hs-var">as1</span></a></span><span>      </span><span class="annot"><span class="annottext">[Alt a]
</span><a href="#local-6989586621682702917"><span class="hs-identifier hs-var">as2</span></a></span><span>       </span><span class="hs-comment">-- Discard a2</span><span>
</span><span id="line-728"></span><span>        </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Alt a
</span><a href="#local-6989586621682702916"><span class="hs-identifier hs-var">a2</span></a></span><span> </span><span class="annot"><span class="annottext">Alt a -&gt; [Alt a] -&gt; [Alt a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Alt a] -&gt; [Alt a] -&gt; [Alt a]
forall a. [Alt a] -&gt; [Alt a] -&gt; [Alt a]
</span><a href="GHC.Core.Utils.html#mergeAlts"><span class="hs-identifier hs-var">mergeAlts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Alt a
</span><a href="#local-6989586621682702914"><span class="hs-identifier hs-var">a1</span></a></span><span class="annot"><span class="annottext">Alt a -&gt; [Alt a] -&gt; [Alt a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Alt a]
</span><a href="#local-6989586621682702915"><span class="hs-identifier hs-var">as1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Alt a]
</span><a href="#local-6989586621682702917"><span class="hs-identifier hs-var">as2</span></a></span><span>
</span><span id="line-729"></span><span>
</span><span id="line-730"></span><span>
</span><span id="line-731"></span><span class="hs-comment">---------------------------------</span><span>
</span><span id="line-732"></span><span class="annot"><a href="GHC.Core.Utils.html#trimConArgs"><span class="hs-identifier hs-type">trimConArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#AltCon"><span class="hs-identifier hs-type">AltCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreArg"><span class="hs-identifier hs-type">CoreArg</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreArg"><span class="hs-identifier hs-type">CoreArg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-733"></span><span class="hs-comment">-- ^ Given:</span><span>
</span><span id="line-734"></span><span class="hs-comment">--</span><span>
</span><span id="line-735"></span><span class="hs-comment">-- &gt; case (C a b x y) of</span><span>
</span><span id="line-736"></span><span class="hs-comment">-- &gt;        C b x y -&gt; ...</span><span>
</span><span id="line-737"></span><span class="hs-comment">--</span><span>
</span><span id="line-738"></span><span class="hs-comment">-- We want to drop the leading type argument of the scrutinee</span><span>
</span><span id="line-739"></span><span class="hs-comment">-- leaving the arguments to match against the pattern</span><span>
</span><span id="line-740"></span><span>
</span><span id="line-741"></span><span id="trimConArgs"><span class="annot"><span class="annottext">trimConArgs :: AltCon -&gt; [CoreExpr] -&gt; [CoreExpr]
</span><a href="GHC.Core.Utils.html#trimConArgs"><span class="hs-identifier hs-var hs-var">trimConArgs</span></a></span></span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="GHC.Core.html#DEFAULT"><span class="hs-identifier hs-var">DEFAULT</span></a></span><span>      </span><span id="local-6989586621682702920"><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682702920"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; [CoreExpr] -&gt; [CoreExpr]
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoreExpr] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682702920"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-742"></span><span class="annot"><a href="GHC.Core.Utils.html#trimConArgs"><span class="hs-identifier hs-var">trimConArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#LitAlt"><span class="hs-identifier hs-type">LitAlt</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>   </span><span id="local-6989586621682702921"><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682702921"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; [CoreExpr] -&gt; [CoreExpr]
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoreExpr] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682702921"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-743"></span><span class="annot"><a href="GHC.Core.Utils.html#trimConArgs"><span class="hs-identifier hs-var">trimConArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#DataAlt"><span class="hs-identifier hs-type">DataAlt</span></a></span><span> </span><span id="local-6989586621682702922"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682702922"><span class="hs-identifier hs-var">dc</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682702923"><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682702923"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; [CoreExpr] -&gt; [CoreExpr]
forall b a. [b] -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#dropList"><span class="hs-identifier hs-var">dropList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; [Id]
</span><a href="GHC.Core.DataCon.html#dataConUnivTyVars"><span class="hs-identifier hs-var">dataConUnivTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682702922"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682702923"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-744"></span><span>
</span><span id="line-745"></span><span id="local-6989586621682701960"><span class="annot"><a href="GHC.Core.Utils.html#filterAlts"><span class="hs-identifier hs-type">filterAlts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>                </span><span class="annot"><span class="hs-comment">-- ^ Type constructor of scrutinee's type (used to prune possibilities)</span></span><span>
</span><span id="line-746"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span>               </span><span class="annot"><span class="hs-comment">-- ^ And its type arguments</span></span><span>
</span><span id="line-747"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#AltCon"><span class="hs-identifier hs-type">AltCon</span></a></span><span class="hs-special">]</span><span>             </span><span class="annot"><span class="hs-comment">-- ^ 'imposs_cons': constructors known to be impossible due to the form of the scrutinee</span></span><span>
</span><span id="line-748"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682701960"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-comment">-- ^ Alternatives</span></span><span>
</span><span id="line-749"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#AltCon"><span class="hs-identifier hs-type">AltCon</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682701960"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span><span>
</span><span id="line-750"></span><span>             </span><span class="hs-comment">-- Returns:</span><span>
</span><span id="line-751"></span><span>             </span><span class="hs-comment">--  1. Constructors that will never be encountered by the</span><span>
</span><span id="line-752"></span><span>             </span><span class="hs-comment">--     *default* case (if any).  A superset of imposs_cons</span><span>
</span><span id="line-753"></span><span>             </span><span class="hs-comment">--  2. The new alternatives, trimmed by</span><span>
</span><span id="line-754"></span><span>             </span><span class="hs-comment">--        a) remove imposs_cons</span><span>
</span><span id="line-755"></span><span>             </span><span class="hs-comment">--        b) remove constructors which can't match because of GADTs</span><span>
</span><span id="line-756"></span><span>             </span><span class="hs-comment">--</span><span>
</span><span id="line-757"></span><span>             </span><span class="hs-comment">-- NB: the final list of alternatives may be empty:</span><span>
</span><span id="line-758"></span><span>             </span><span class="hs-comment">-- This is a tricky corner case.  If the data type has no constructors,</span><span>
</span><span id="line-759"></span><span>             </span><span class="hs-comment">-- which GHC allows, or if the imposs_cons covers all constructors (after taking</span><span>
</span><span id="line-760"></span><span>             </span><span class="hs-comment">-- account of GADTs), then no alternatives can match.</span><span>
</span><span id="line-761"></span><span>             </span><span class="hs-comment">--</span><span>
</span><span id="line-762"></span><span>             </span><span class="hs-comment">-- If callers need to preserve the invariant that there is always at least one branch</span><span>
</span><span id="line-763"></span><span>             </span><span class="hs-comment">-- in a &quot;case&quot; statement then they will need to manually add a dummy case branch that just</span><span>
</span><span id="line-764"></span><span>             </span><span class="hs-comment">-- calls &quot;error&quot; or similar.</span><span>
</span><span id="line-765"></span><span id="filterAlts"><span class="annot"><span class="annottext">filterAlts :: forall b.
TyCon -&gt; [Type] -&gt; [AltCon] -&gt; [Alt b] -&gt; ([AltCon], [Alt b])
</span><a href="GHC.Core.Utils.html#filterAlts"><span class="hs-identifier hs-var hs-var">filterAlts</span></a></span></span><span> </span><span id="local-6989586621682702928"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682702928"><span class="hs-identifier hs-var">_tycon</span></a></span></span><span> </span><span id="local-6989586621682702929"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682702929"><span class="hs-identifier hs-var">inst_tys</span></a></span></span><span> </span><span id="local-6989586621682702930"><span class="annot"><span class="annottext">[AltCon]
</span><a href="#local-6989586621682702930"><span class="hs-identifier hs-var">imposs_cons</span></a></span></span><span> </span><span id="local-6989586621682702931"><span class="annot"><span class="annottext">[Alt b]
</span><a href="#local-6989586621682702931"><span class="hs-identifier hs-var">alts</span></a></span></span><span>
</span><span id="line-766"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[AltCon]
</span><a href="#local-6989586621682702932"><span class="hs-identifier hs-var">imposs_deflt_cons</span></a></span><span> </span><span class="annot"><span class="annottext">[AltCon] -&gt; ([AltCon], [Alt b]) -&gt; ([AltCon], [Alt b])
forall a b. [a] -&gt; b -&gt; b
</span><a href="GHC.Utils.Misc.html#seqList"><span class="hs-operator hs-var">`seqList`</span></a></span><span>
</span><span id="line-767"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[AltCon]
</span><a href="#local-6989586621682702932"><span class="hs-identifier hs-var">imposs_deflt_cons</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Alt b] -&gt; Maybe (Expr b) -&gt; [Alt b]
forall b. [Alt b] -&gt; Maybe (Expr b) -&gt; [Alt b]
</span><a href="GHC.Core.Utils.html#addDefault"><span class="hs-identifier hs-var">addDefault</span></a></span><span> </span><span class="annot"><span class="annottext">[Alt b]
</span><a href="#local-6989586621682702934"><span class="hs-identifier hs-var">trimmed_alts</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Expr b)
</span><a href="#local-6989586621682702935"><span class="hs-identifier hs-var">maybe_deflt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-768"></span><span>  </span><span class="hs-comment">-- Very important to force `imposs_deflt_cons` as that forces `alt_cons`, which</span><span>
</span><span id="line-769"></span><span>  </span><span class="hs-comment">-- is essentially as retaining `alts_wo_default` or any `Alt b` for that matter</span><span>
</span><span id="line-770"></span><span>  </span><span class="hs-comment">-- leads to a huge space leak (see #22102 and !8896)</span><span>
</span><span id="line-771"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-772"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682702936"><span class="annot"><span class="annottext">[Alt b]
</span><a href="#local-6989586621682702936"><span class="hs-identifier hs-var">alts_wo_default</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682702935"><span class="annot"><span class="annottext">Maybe (Expr b)
</span><a href="#local-6989586621682702935"><span class="hs-identifier hs-var">maybe_deflt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Alt b] -&gt; ([Alt b], Maybe (Expr b))
forall b. [Alt b] -&gt; ([Alt b], Maybe (Expr b))
</span><a href="GHC.Core.Utils.html#findDefault"><span class="hs-identifier hs-var">findDefault</span></a></span><span> </span><span class="annot"><span class="annottext">[Alt b]
</span><a href="#local-6989586621682702931"><span class="hs-identifier hs-var">alts</span></a></span><span>
</span><span id="line-773"></span><span>    </span><span id="local-6989586621682702937"><span class="annot"><span class="annottext">alt_cons :: [AltCon]
</span><a href="#local-6989586621682702937"><span class="hs-identifier hs-var hs-var">alt_cons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621682702938"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span id="local-6989586621682702938"><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621682702938"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="annot"><span class="annottext">[b]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Alt b]
</span><a href="#local-6989586621682702936"><span class="hs-identifier hs-var">alts_wo_default</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-774"></span><span>
</span><span id="line-775"></span><span>    </span><span id="local-6989586621682702934"><span class="annot"><span class="annottext">trimmed_alts :: [Alt b]
</span><a href="#local-6989586621682702934"><span class="hs-identifier hs-var hs-var">trimmed_alts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Alt b -&gt; Bool) -&gt; [Alt b] -&gt; [Alt b]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#filterOut"><span class="hs-identifier hs-var">filterOut</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type] -&gt; Alt b -&gt; Bool
forall b. [Type] -&gt; Alt b -&gt; Bool
</span><a href="#local-6989586621682702940"><span class="hs-identifier hs-var">impossible_alt</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682702929"><span class="hs-identifier hs-var">inst_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Alt b]
</span><a href="#local-6989586621682702936"><span class="hs-identifier hs-var">alts_wo_default</span></a></span><span>
</span><span id="line-776"></span><span>
</span><span id="line-777"></span><span>    </span><span id="local-6989586621682702941"><span class="annot"><span class="annottext">imposs_cons_set :: Set AltCon
</span><a href="#local-6989586621682702941"><span class="hs-identifier hs-var hs-var">imposs_cons_set</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[AltCon] -&gt; Set AltCon
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[AltCon]
</span><a href="#local-6989586621682702930"><span class="hs-identifier hs-var">imposs_cons</span></a></span><span>
</span><span id="line-778"></span><span>    </span><span id="local-6989586621682702932"><span class="annot"><span class="annottext">imposs_deflt_cons :: [AltCon]
</span><a href="#local-6989586621682702932"><span class="hs-identifier hs-var hs-var">imposs_deflt_cons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-779"></span><span>      </span><span class="annot"><span class="annottext">[AltCon]
</span><a href="#local-6989586621682702930"><span class="hs-identifier hs-var">imposs_cons</span></a></span><span> </span><span class="annot"><span class="annottext">[AltCon] -&gt; [AltCon] -&gt; [AltCon]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(AltCon -&gt; Bool) -&gt; [AltCon] -&gt; [AltCon]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#filterOut"><span class="hs-identifier hs-var">filterOut</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AltCon -&gt; Set AltCon -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#member"><span class="hs-operator hs-var">`Set.member`</span></a></span><span> </span><span class="annot"><span class="annottext">Set AltCon
</span><a href="#local-6989586621682702941"><span class="hs-identifier hs-var">imposs_cons_set</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[AltCon]
</span><a href="#local-6989586621682702937"><span class="hs-identifier hs-var">alt_cons</span></a></span><span>
</span><span id="line-780"></span><span>         </span><span class="hs-comment">-- &quot;imposs_deflt_cons&quot; are handled</span><span>
</span><span id="line-781"></span><span>         </span><span class="hs-comment">--   EITHER by the context,</span><span>
</span><span id="line-782"></span><span>         </span><span class="hs-comment">--   OR by a non-DEFAULT branch in this case expression.</span><span>
</span><span id="line-783"></span><span>
</span><span id="line-784"></span><span>    </span><span id="local-6989586621682701965"><span class="annot"><a href="#local-6989586621682702940"><span class="hs-identifier hs-type">impossible_alt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682701965"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-785"></span><span>    </span><span id="local-6989586621682702940"><span class="annot"><span class="annottext">impossible_alt :: forall b. [Type] -&gt; Alt b -&gt; Bool
</span><a href="#local-6989586621682702940"><span class="hs-identifier hs-var hs-var">impossible_alt</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span id="local-6989586621682702945"><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621682702945"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="annot"><span class="annottext">[b]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621682702945"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon -&gt; Set AltCon -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#member"><span class="hs-operator hs-var">`Set.member`</span></a></span><span> </span><span class="annot"><span class="annottext">Set AltCon
</span><a href="#local-6989586621682702941"><span class="hs-identifier hs-var">imposs_cons_set</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-786"></span><span>    </span><span class="annot"><a href="#local-6989586621682702940"><span class="hs-identifier hs-var">impossible_alt</span></a></span><span> </span><span id="local-6989586621682702946"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682702946"><span class="hs-identifier hs-var">inst_tys</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#DataAlt"><span class="hs-identifier hs-type">DataAlt</span></a></span><span> </span><span id="local-6989586621682702947"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682702947"><span class="hs-identifier hs-var">con</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[b]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#dataConCannotMatch"><span class="hs-identifier hs-var">dataConCannotMatch</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682702946"><span class="hs-identifier hs-var">inst_tys</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682702947"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-787"></span><span>    </span><span class="annot"><a href="#local-6989586621682702940"><span class="hs-identifier hs-var">impossible_alt</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="annot"><span class="annottext">Alt b
</span><span class="hs-identifier">_</span></span><span>                             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-788"></span><span>
</span><span id="line-789"></span><span class="hs-comment">-- | Refine the default alternative to a 'DataAlt', if there is a unique way to do so.</span><span>
</span><span id="line-790"></span><span class="hs-comment">-- See Note [Refine DEFAULT case alternatives]</span><span>
</span><span id="line-791"></span><span class="annot"><a href="GHC.Core.Utils.html#refineDefaultAlt"><span class="hs-identifier hs-type">refineDefaultAlt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span class="hs-special">]</span><span>          </span><span class="annot"><span class="hs-comment">-- ^ Uniques for constructing new binders</span></span><span>
</span><span id="line-792"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span>              </span><span class="annot"><span class="hs-comment">-- ^ Multiplicity annotation of the case expression</span></span><span>
</span><span id="line-793"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>             </span><span class="annot"><span class="hs-comment">-- ^ Type constructor of scrutinee's type</span></span><span>
</span><span id="line-794"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span>            </span><span class="annot"><span class="hs-comment">-- ^ Type arguments of scrutinee's type</span></span><span>
</span><span id="line-795"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#AltCon"><span class="hs-identifier hs-type">AltCon</span></a></span><span class="hs-special">]</span><span>          </span><span class="annot"><span class="hs-comment">-- ^ Constructors that cannot match the DEFAULT (if any)</span></span><span>
</span><span id="line-796"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreAlt"><span class="hs-identifier hs-type">CoreAlt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-797"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreAlt"><span class="hs-identifier hs-type">CoreAlt</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ 'True', if a default alt was replaced with a 'DataAlt'</span></span><span>
</span><span id="line-798"></span><span id="refineDefaultAlt"><span class="annot"><span class="annottext">refineDefaultAlt :: [Unique]
-&gt; Type
-&gt; TyCon
-&gt; [Type]
-&gt; [AltCon]
-&gt; [Alt Id]
-&gt; (Bool, [Alt Id])
</span><a href="GHC.Core.Utils.html#refineDefaultAlt"><span class="hs-identifier hs-var hs-var">refineDefaultAlt</span></a></span></span><span> </span><span id="local-6989586621682702950"><span class="annot"><span class="annottext">[Unique]
</span><a href="#local-6989586621682702950"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span id="local-6989586621682702951"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702951"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span id="local-6989586621682702952"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682702952"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span id="local-6989586621682702953"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682702953"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span id="local-6989586621682702954"><span class="annot"><span class="annottext">[AltCon]
</span><a href="#local-6989586621682702954"><span class="hs-identifier hs-var">imposs_deflt_cons</span></a></span></span><span> </span><span id="local-6989586621682702955"><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682702955"><span class="hs-identifier hs-var">all_alts</span></a></span></span><span>
</span><span id="line-799"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="GHC.Core.html#DEFAULT"><span class="hs-identifier hs-var">DEFAULT</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682702956"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702956"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682702957"><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682702957"><span class="hs-identifier hs-var">rest_alts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682702955"><span class="hs-identifier hs-var">all_alts</span></a></span><span>
</span><span id="line-800"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isAlgTyCon"><span class="hs-identifier hs-var">isAlgTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682702952"><span class="hs-identifier hs-var">tycon</span></a></span><span>            </span><span class="hs-comment">-- It's a data type, tuple, or unboxed tuples.</span><span>
</span><span id="line-801"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isNewTyCon"><span class="hs-identifier hs-var">isNewTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682702952"><span class="hs-identifier hs-var">tycon</span></a></span><span class="hs-special">)</span><span>      </span><span class="hs-comment">-- Exception 1 in Note [Refine DEFAULT case alternatives]</span><span>
</span><span id="line-802"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isTypeDataTyCon"><span class="hs-identifier hs-var">isTypeDataTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682702952"><span class="hs-identifier hs-var">tycon</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Exception 2 in Note [Refine DEFAULT case alternatives]</span><span>
</span><span id="line-803"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682702961"><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621682702961"><span class="hs-identifier hs-var">all_cons</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe [DataCon]
</span><a href="GHC.Core.TyCon.html#tyConDataCons_maybe"><span class="hs-identifier hs-var">tyConDataCons_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682702952"><span class="hs-identifier hs-var">tycon</span></a></span><span>
</span><span id="line-804"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682702962"><span class="annot"><span class="annottext">imposs_data_cons :: UniqSet DataCon
</span><a href="#local-6989586621682702962"><span class="hs-identifier hs-var hs-var">imposs_data_cons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[DataCon] -&gt; UniqSet DataCon
forall a. Uniquable a =&gt; [a] -&gt; UniqSet a
</span><a href="GHC.Types.Unique.Set.html#mkUniqSet"><span class="hs-identifier hs-var">mkUniqSet</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682702964"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Core.html#DataAlt"><span class="hs-identifier hs-type">DataAlt</span></a></span><span> </span><span id="local-6989586621682702964"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682702964"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[AltCon]
</span><a href="#local-6989586621682702954"><span class="hs-identifier hs-var">imposs_deflt_cons</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-805"></span><span>                             </span><span class="hs-comment">-- We now know it's a data type, so we can use</span><span>
</span><span id="line-806"></span><span>                             </span><span class="hs-comment">-- UniqSet rather than Set (more efficient)</span><span>
</span><span id="line-807"></span><span>        </span><span id="local-6989586621682702965"><span class="annot"><span class="annottext">impossible :: DataCon -&gt; Bool
</span><a href="#local-6989586621682702965"><span class="hs-identifier hs-var hs-var">impossible</span></a></span></span><span> </span><span id="local-6989586621682702966"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682702966"><span class="hs-identifier hs-var">con</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682702966"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; UniqSet DataCon -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; UniqSet a -&gt; Bool
</span><a href="GHC.Types.Unique.Set.html#elementOfUniqSet"><span class="hs-operator hs-var">`elementOfUniqSet`</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet DataCon
</span><a href="#local-6989586621682702962"><span class="hs-identifier hs-var">imposs_data_cons</span></a></span><span>
</span><span id="line-808"></span><span>                             </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#dataConCannotMatch"><span class="hs-identifier hs-var">dataConCannotMatch</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682702953"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682702966"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-809"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(DataCon -&gt; Bool) -&gt; [DataCon] -&gt; [DataCon]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#filterOut"><span class="hs-identifier hs-var">filterOut</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="#local-6989586621682702965"><span class="hs-identifier hs-var">impossible</span></a></span><span> </span><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621682702961"><span class="hs-identifier hs-var">all_cons</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-810"></span><span>       </span><span class="hs-comment">-- Eliminate the default alternative</span><span>
</span><span id="line-811"></span><span>       </span><span class="hs-comment">-- altogether if it can't match:</span><span>
</span><span id="line-812"></span><span>       </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682702957"><span class="hs-identifier hs-var">rest_alts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-813"></span><span>
</span><span id="line-814"></span><span>       </span><span class="hs-comment">-- It matches exactly one constructor, so fill it in:</span><span>
</span><span id="line-815"></span><span>       </span><span class="hs-special">[</span><span id="local-6989586621682702968"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682702968"><span class="hs-identifier hs-var">con</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Alt Id] -&gt; [Alt Id] -&gt; [Alt Id]
forall a. [Alt a] -&gt; [Alt a] -&gt; [Alt a]
</span><a href="GHC.Core.Utils.html#mergeAlts"><span class="hs-identifier hs-var">mergeAlts</span></a></span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682702957"><span class="hs-identifier hs-var">rest_alts</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">AltCon -&gt; [Id] -&gt; CoreExpr -&gt; Alt Id
forall b. AltCon -&gt; [b] -&gt; Expr b -&gt; Alt b
</span><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-var">Alt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; AltCon
</span><a href="GHC.Core.html#DataAlt"><span class="hs-identifier hs-var">DataAlt</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682702968"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682702969"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; [Id] -&gt; [Id]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682702970"><span class="hs-identifier hs-var">arg_ids</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702956"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-816"></span><span>                       </span><span class="hs-comment">-- We need the mergeAlts to keep the alternatives in the right order</span><span>
</span><span id="line-817"></span><span>             </span><span class="hs-keyword">where</span><span>
</span><span id="line-818"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621682702969"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682702969"><span class="hs-identifier hs-var">ex_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682702970"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682702970"><span class="hs-identifier hs-var">arg_ids</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Unique] -&gt; Type -&gt; DataCon -&gt; [Type] -&gt; ([Id], [Id])
</span><a href="GHC.Core.Utils.html#dataConRepInstPat"><span class="hs-identifier hs-var">dataConRepInstPat</span></a></span><span> </span><span class="annot"><span class="annottext">[Unique]
</span><a href="#local-6989586621682702950"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682702951"><span class="hs-identifier hs-var">mult</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682702968"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682702953"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-819"></span><span>
</span><span id="line-820"></span><span>       </span><span class="hs-comment">-- It matches more than one, so do nothing</span><span>
</span><span id="line-821"></span><span>       </span><span class="annot"><span class="annottext">[DataCon]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682702955"><span class="hs-identifier hs-var">all_alts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-822"></span><span>
</span><span id="line-823"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Utils.Constants.html#debugIsOn"><span class="hs-identifier hs-var">debugIsOn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isAlgTyCon"><span class="hs-identifier hs-var">isAlgTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682702952"><span class="hs-identifier hs-var">tycon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[DataCon] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [DataCon]
</span><a href="GHC.Core.TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682702952"><span class="hs-identifier hs-var">tycon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-824"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isFamilyTyCon"><span class="hs-identifier hs-var">isFamilyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682702952"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isAbstractTyCon"><span class="hs-identifier hs-var">isAbstractTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682702952"><span class="hs-identifier hs-var">tycon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-825"></span><span>        </span><span class="hs-comment">-- Check for no data constructors</span><span>
</span><span id="line-826"></span><span>        </span><span class="hs-comment">-- This can legitimately happen for abstract types and type families,</span><span>
</span><span id="line-827"></span><span>        </span><span class="hs-comment">-- so don't report that</span><span>
</span><span id="line-828"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682702955"><span class="hs-identifier hs-var">all_alts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-829"></span><span>
</span><span id="line-830"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>      </span><span class="hs-comment">-- The common case</span><span>
</span><span id="line-831"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682702955"><span class="hs-identifier hs-var">all_alts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-832"></span><span>
</span><span id="line-833"></span><span class="hs-comment">{- Note [Merge Nested Cases]
~~~~~~~~~~~~~~~~~~~~~~~~~
       case e of b {             ==&gt;   case e of b {
         p1 -&gt; rhs1                      p1 -&gt; rhs1
         ...                             ...
         pm -&gt; rhsm                      pm -&gt; rhsm
         _  -&gt; case b of b' {            pn -&gt; let b'=b in rhsn
                     pn -&gt; rhsn          ...
                     ...                 po -&gt; let b'=b in rhso
                     po -&gt; rhso          _  -&gt; let b'=b in rhsd
                     _  -&gt; rhsd
       }

which merges two cases in one case when -- the default alternative of
the outer case scrutinises the same variable as the outer case. This
transformation is called Case Merging.  It avoids that the same
variable is scrutinised multiple times.

Wrinkles

(MC1) Historical note. I tried making `mergeCaseAlts` &quot;looks though&quot; an inner
     single-alternative case-on-variable. For example
       case x of {
          ...outer-alts...
          DEFAULT -&gt; case y of (a,b) -&gt;
                     case x of { A -&gt; rhs1; B -&gt; rhs2 }
    ===&gt;
       case x of
         ...outer-alts...
         a -&gt; case y of (a,b) -&gt; rhs1
         B -&gt; case y of (a,b) -&gt; rhs2

    This duplicates the `case y` but it removes the case x; so it is a win
    in terms of execution time (combining the cases on x) at the cost of
    perhaps duplicating the `case y`.  A case in point is integerEq, which
    is defined thus
        integerEq :: Integer -&gt; Integer -&gt; Bool
        integerEq !x !y = isTrue# (integerEq# x y)
    which becomes
        integerEq
          = \ (x :: Integer) (y_aAL :: Integer) -&gt;
              case x of x1 { __DEFAULT -&gt;
              case y of y1 { __DEFAULT -&gt;
              case x1 of {
                IS x2 -&gt; case y1 of {
                           __DEFAULT -&gt; GHC.Types.False;
                           IS y2     -&gt; tagToEnum# @Bool (==# x2 y2) };
                IP x2 -&gt; ...
                IN x2 -&gt; ...
    We want to merge the outer `case x` with the inner `case x1`.

    But (a) this is all a bit dubious: see #24251, and
        (b) it is hard to combine with (MC4)
    So I'm not doing this any more.  If we want to do it, we'll handle it
    separately: #24251.

    End of historical note

(MC2) The auxiliary bindings b'=b are annoying, because they force another
      simplifier pass, but there seems no easy way to avoid them.  See
      Note [Which transformations are innocuous] in GHC.Core.Opt.Stats.

(MC3) Consider
         case f x of (r::Int#) -&gt; tagToEnum# r :: Bool
      `mergeCaseAlts` as a special case to treat this as if it was
         case f x of r -&gt;
           case r of { 0# -&gt; False; 1# -&gt; True }
      which can be merged to
         case f x of { 0# -&gt; False; 1# -&gt; True }

      To see why this is important, return to
         case f x of (r::Int#) -&gt; tagToEnum# r :: Bool
      and supppose `f` inlines to a case expression.  Then then we get
         let $j r = tagToEnum# r
         case .. of { .. jump $j 0#; ...jump $j 1# ... }
      Now if the entire expression is consumed by another case-expression,
      that outer case will only see (tagToEnum# r) which it can't do much
      with.  Whereas the result of the above case-merge generates much better
      code: no branching on Int#

(MC4) Consider
          case f x of r -&gt;
            join $j y = &lt;rhs&gt; in
            case r of { ...alts ... }
      This is pretty common, and it a pity for it to defeat the case-merge
      transformation; and it makes the optimiser fragile to inlining decisions
      for join points.

      So `mergeCaseAlts` floats out any join points. It doesn't float out
      non-join-points unless the /outer/ case has just one alternative; doing
      so would risk more allocation

(MC5) See Note [Cascading case merge]

See also Note [Example of case-merging and caseRules] in GHC.Core.Opt.Simplify.Utils


Note [Cascading case merge]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
Case merging should cascade in one sweep, because the Simplifier tries it /after/
simplifying (and hence case-merging) the inner case.  For example

      case e of a {
        DEFAULT -&gt; case a of b
                      DEFAULT -&gt; case b of c {
                                     DEFAULT -&gt; e
                                     A -&gt; ea
                      B -&gt; eb
        C -&gt; ec
==&gt; {simplify inner case}
      case e of a {
        DEFAULT -&gt; case a of b
                      DEFAULT -&gt; let c = b in e
                      A -&gt; let c = b in ea
                      B -&gt; eb
        C -&gt; ec
==&gt; {case-merge on outer case}
      case e of a {
        DEFAULT -&gt; let b = a in let c = b in e
        A -&gt; let b = a in let c = b in ea
        B -&gt; let b = a in eb
        C -&gt; ec


However here's a tricky case that we still don't catch, and I don't
see how to catch it in one pass:

  case x of c1 { I# a1 -&gt;
  case a1 of c2 -&gt;
    0 -&gt; ...
    DEFAULT -&gt; case x of c3 { I# a2 -&gt;
               case a2 of ...

After occurrence analysis (and its binder-swap) we get this

  case x of c1 { I# a1 -&gt;
  let x = c1 in         -- Binder-swap addition
  case a1 of c2 -&gt;
    0 -&gt; ...
    DEFAULT -&gt; case x of c3 { I# a2 -&gt;
               case a2 of ...

When we simplify the inner case x, we'll see that
x=c1=I# a1.  So we'll bind a2 to a1, and get

  case x of c1 { I# a1 -&gt;
  case a1 of c2 -&gt;
    0 -&gt; ...
    DEFAULT -&gt; case a1 of ...

This is correct, but we can't do a case merge in this sweep
because c2 /= a1.  Reason: the binding c1=I# a1 went inwards
without getting changed to c1=I# c2.

I don't think this is worth fixing, even if I knew how. It'll
all come out in the next pass anyway.


Note [Refine DEFAULT case alternatives]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
refineDefaultAlt replaces the DEFAULT alt with a constructor if there
is one possible value it could be.

The simplest example being
    foo :: () -&gt; ()
    foo x = case x of !_ -&gt; ()
which rewrites to
    foo :: () -&gt; ()
    foo x = case x of () -&gt; ()

There are two reasons in general why replacing a DEFAULT alternative
with a specific constructor is desirable.

1. We can simplify inner expressions.  For example

       data Foo = Foo1 ()

       test :: Foo -&gt; ()
       test x = case x of
                  DEFAULT -&gt; mid (case x of
                                    Foo1 x1 -&gt; x1)

   refineDefaultAlt fills in the DEFAULT here with `Foo ip1` and then
   x becomes bound to `Foo ip1` so is inlined into the other case
   which causes the KnownBranch optimisation to kick in. If we don't
   refine DEFAULT to `Foo ip1`, we are left with both case expressions.

2. combineIdenticalAlts does a better job. For example (Simon Jacobi)
       data D = C0 | C1 | C2

       case e of
         DEFAULT -&gt; e0
         C0      -&gt; e1
         C1      -&gt; e1

   When we apply combineIdenticalAlts to this expression, it can't
   combine the alts for C0 and C1, as we already have a default case.
   But if we apply refineDefaultAlt first, we get
       case e of
         C0 -&gt; e1
         C1 -&gt; e1
         C2 -&gt; e0
   and combineIdenticalAlts can turn that into
       case e of
         DEFAULT -&gt; e1
         C2 -&gt; e0

   It isn't obvious that refineDefaultAlt does this but if you look
   at its one call site in GHC.Core.Opt.Simplify.Utils then the
   `imposs_deflt_cons` argument is populated with constructors which
   are matched elsewhere.

There are two exceptions where we avoid refining a DEFAULT case:

* Exception 1: Newtypes

  We can have a newtype, if we are just doing an eval:

    case x of { DEFAULT -&gt; e }

  And we don't want to fill in a default for them!

* Exception 2: `type data` declarations

  The data constructors for a `type data` declaration (see
  Note [Type data declarations] in GHC.Rename.Module) do not exist at the
  value level. Nevertheless, it is possible to strictly evaluate a value
  whose type is a `type data` declaration. Test case
  type-data/should_compile/T2294b.hs contains an example:

    type data T a where
      A :: T Int

    f :: T a -&gt; ()
    f !x = ()

  We want to generate the following Core for f:

    f = \(@a) (x :: T a) -&gt;
         case x of
           __DEFAULT -&gt; ()

  Namely, we do _not_ want to match on `A`, as it doesn't exist at the value
  level! See wrinkle (W2b) in Note [Type data declarations] in GHC.Rename.Module


Note [Combine identical alternatives]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
If several alternatives are identical, merge them into a single
DEFAULT alternative.  I've occasionally seen this making a big
difference:

     case e of               =====&gt;     case e of
       C _ -&gt; f x                         D v -&gt; ....v....
       D v -&gt; ....v....                   DEFAULT -&gt; f x
       DEFAULT -&gt; f x

The point is that we merge common RHSs, at least for the DEFAULT case.
[One could do something more elaborate but I've never seen it needed.]
To avoid an expensive test, we just merge branches equal to the *first*
alternative; this picks up the common cases
     a) all branches equal
     b) some branches equal to the DEFAULT (which occurs first)

The case where Combine Identical Alternatives transformation showed up
was like this (base/Foreign/C/Err/Error.hs):

        x | p `is` 1 -&gt; e1
          | p `is` 2 -&gt; e2
        ...etc...

where @is@ was something like

        p `is` n = p /= (-1) &amp;&amp; p == n

This gave rise to a horrible sequence of cases

        case p of
          (-1) -&gt; $j p
          1    -&gt; e1
          DEFAULT -&gt; $j p

and similarly in cascade for all the join points!

Note [Combine identical alternatives: wrinkles]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

* It's important that we try to combine alternatives *before*
  simplifying them, rather than after. Reason: because
  Simplify.simplAlt may zap the occurrence info on the binders in the
  alternatives, which in turn defeats combineIdenticalAlts use of
  isDeadBinder (see #7360).

  You can see this in the call to combineIdenticalAlts in
  GHC.Core.Opt.Simplify.Utils.prepareAlts.  Here the alternatives have type InAlt
  (the &quot;In&quot; meaning input) rather than OutAlt.

* combineIdenticalAlts does not work well for nullary constructors
      case x of y
         []    -&gt; f []
         (_:_) -&gt; f y
  Here we won't see that [] and y are the same.  Sigh! This problem
  is solved in CSE, in GHC.Core.Opt.CSE.combineAlts, which does a better version
  of combineIdenticalAlts. But sadly it doesn't have the occurrence info we have
  here.
  See Note [Combine case alts: awkward corner] in GHC.Core.Opt.CSE).

Note [Care with impossible-constructors when combining alternatives]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose we have (#10538)
   data T = A | B | C | D

      case x::T of   (Imposs-default-cons {A,B})
         DEFAULT -&gt; e1
         A -&gt; e2
         B -&gt; e1

When calling combineIdentialAlts, we'll have computed that the
&quot;impossible constructors&quot; for the DEFAULT alt is {A,B}, since if x is
A or B we'll take the other alternatives.  But suppose we combine B
into the DEFAULT, to get

      case x::T of   (Imposs-default-cons {A})
         DEFAULT -&gt; e1
         A -&gt; e2

Then we must be careful to trim the impossible constructors to just {A},
else we risk compiling 'e1' wrong!

Not only that, but we take care when there is no DEFAULT beforehand,
because we are introducing one.  Consider

   case x of   (Imposs-default-cons {A,B,C})
     A -&gt; e1
     B -&gt; e2
     C -&gt; e1

Then when combining the A and C alternatives we get

   case x of   (Imposs-default-cons {B})
     DEFAULT -&gt; e1
     B -&gt; e2

Note that we have a new DEFAULT branch that we didn't have before.  So
we need delete from the &quot;impossible-default-constructors&quot; all the
known-con alternatives that we have eliminated. (In #11172 we
missed the first one.)

-}</span><span>
</span><span id="line-1182"></span><span>
</span><span id="line-1183"></span><span class="annot"><a href="GHC.Core.Utils.html#combineIdenticalAlts"><span class="hs-identifier hs-type">combineIdenticalAlts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#AltCon"><span class="hs-identifier hs-type">AltCon</span></a></span><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- Constructors that cannot match DEFAULT</span><span>
</span><span id="line-1184"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreAlt"><span class="hs-identifier hs-type">CoreAlt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1185"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span>      </span><span class="hs-comment">-- True &lt;=&gt; something happened</span><span>
</span><span id="line-1186"></span><span>                         </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#AltCon"><span class="hs-identifier hs-type">AltCon</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- New constructors that cannot match DEFAULT</span><span>
</span><span id="line-1187"></span><span>                         </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreAlt"><span class="hs-identifier hs-type">CoreAlt</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- New alternatives</span><span>
</span><span id="line-1188"></span><span class="hs-comment">-- See Note [Combine identical alternatives]</span><span>
</span><span id="line-1189"></span><span class="hs-comment">-- True &lt;=&gt; we did some combining, result is a single DEFAULT alternative</span><span>
</span><span id="line-1190"></span><span id="combineIdenticalAlts"><span class="annot"><span class="annottext">combineIdenticalAlts :: [AltCon] -&gt; [Alt Id] -&gt; (Bool, [AltCon], [Alt Id])
</span><a href="GHC.Core.Utils.html#combineIdenticalAlts"><span class="hs-identifier hs-var hs-var">combineIdenticalAlts</span></a></span></span><span> </span><span id="local-6989586621682702974"><span class="annot"><span class="annottext">[AltCon]
</span><a href="#local-6989586621682702974"><span class="hs-identifier hs-var">imposs_deflt_cons</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span id="local-6989586621682702975"><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621682702975"><span class="hs-identifier hs-var">con1</span></a></span></span><span> </span><span id="local-6989586621682702976"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682702976"><span class="hs-identifier hs-var">bndrs1</span></a></span></span><span> </span><span id="local-6989586621682702977"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702977"><span class="hs-identifier hs-var">rhs1</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682702978"><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682702978"><span class="hs-identifier hs-var">rest_alts</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1191"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Bool) -&gt; [Id] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Id.html#isDeadBinder"><span class="hs-identifier hs-var">isDeadBinder</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682702976"><span class="hs-identifier hs-var">bndrs1</span></a></span><span>    </span><span class="hs-comment">-- Remember the default</span><span>
</span><span id="line-1192"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Alt Id] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682702981"><span class="hs-identifier hs-var">elim_rest</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- alternative comes first</span><span>
</span><span id="line-1193"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AltCon]
</span><a href="#local-6989586621682702982"><span class="hs-identifier hs-var">imposs_deflt_cons'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Alt Id
</span><a href="#local-6989586621682702983"><span class="hs-identifier hs-var">deflt_alt</span></a></span><span> </span><span class="annot"><span class="annottext">Alt Id -&gt; [Alt Id] -&gt; [Alt Id]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682702984"><span class="hs-identifier hs-var">filtered_rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1194"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1195"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682702981"><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682702981"><span class="hs-identifier hs-var">elim_rest</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682702984"><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682702984"><span class="hs-identifier hs-var">filtered_rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Alt Id -&gt; Bool) -&gt; [Alt Id] -&gt; ([Alt Id], [Alt Id])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">partition</span></span><span> </span><span class="annot"><span class="annottext">Alt Id -&gt; Bool
</span><a href="#local-6989586621682702985"><span class="hs-identifier hs-var">identical_to_alt1</span></a></span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682702978"><span class="hs-identifier hs-var">rest_alts</span></a></span><span>
</span><span id="line-1196"></span><span>    </span><span id="local-6989586621682702983"><span class="annot"><span class="annottext">deflt_alt :: Alt Id
</span><a href="#local-6989586621682702983"><span class="hs-identifier hs-var hs-var">deflt_alt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AltCon -&gt; [Id] -&gt; CoreExpr -&gt; Alt Id
forall b. AltCon -&gt; [b] -&gt; Expr b -&gt; Alt b
</span><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-var">Alt</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="GHC.Core.html#DEFAULT"><span class="hs-identifier hs-var">DEFAULT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoreTickish] -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Utils.html#mkTicks"><span class="hs-identifier hs-var">mkTicks</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[CoreTickish]] -&gt; [CoreTickish]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">[[CoreTickish]]
</span><a href="#local-6989586621682702987"><span class="hs-identifier hs-var">tickss</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702977"><span class="hs-identifier hs-var">rhs1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1197"></span><span>
</span><span id="line-1198"></span><span>     </span><span class="hs-comment">-- See Note [Care with impossible-constructors when combining alternatives]</span><span>
</span><span id="line-1199"></span><span>    </span><span id="local-6989586621682702982"><span class="annot"><span class="annottext">imposs_deflt_cons' :: [AltCon]
</span><a href="#local-6989586621682702982"><span class="hs-identifier hs-var hs-var">imposs_deflt_cons'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[AltCon]
</span><a href="#local-6989586621682702974"><span class="hs-identifier hs-var">imposs_deflt_cons</span></a></span><span> </span><span class="annot"><span class="annottext">[AltCon] -&gt; [AltCon] -&gt; [AltCon]
forall a. Ord a =&gt; [a] -&gt; [a] -&gt; [a]
</span><a href="GHC.Data.List.SetOps.html#minusList"><span class="hs-operator hs-var">`minusList`</span></a></span><span> </span><span class="annot"><span class="annottext">[AltCon]
</span><a href="#local-6989586621682702988"><span class="hs-identifier hs-var">elim_cons</span></a></span><span>
</span><span id="line-1200"></span><span>    </span><span id="local-6989586621682702988"><span class="annot"><span class="annottext">elim_cons :: [AltCon]
</span><a href="#local-6989586621682702988"><span class="hs-identifier hs-var hs-var">elim_cons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[AltCon]
</span><a href="#local-6989586621682702989"><span class="hs-identifier hs-var">elim_con1</span></a></span><span> </span><span class="annot"><span class="annottext">[AltCon] -&gt; [AltCon] -&gt; [AltCon]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(Alt Id -&gt; AltCon) -&gt; [Alt Id] -&gt; [AltCon]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span id="local-6989586621682702990"><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621682702990"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621682702990"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682702981"><span class="hs-identifier hs-var">elim_rest</span></a></span><span>
</span><span id="line-1201"></span><span>    </span><span id="local-6989586621682702989"><span class="annot"><span class="annottext">elim_con1 :: [AltCon]
</span><a href="#local-6989586621682702989"><span class="hs-identifier hs-var hs-var">elim_con1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621682702975"><span class="hs-identifier hs-var">con1</span></a></span><span> </span><span class="hs-keyword">of</span><span>     </span><span class="hs-comment">-- Don't forget con1!</span><span>
</span><span id="line-1202"></span><span>                  </span><span class="annot"><span class="annottext">AltCon
</span><a href="GHC.Core.html#DEFAULT"><span class="hs-identifier hs-var">DEFAULT</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1203"></span><span>                  </span><span class="annot"><span class="annottext">AltCon
</span><span class="hs-identifier">_</span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621682702975"><span class="hs-identifier hs-var">con1</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1204"></span><span>
</span><span id="line-1205"></span><span>    </span><span id="local-6989586621682702991"><span class="annot"><span class="annottext">cheapEqTicked :: Expr b -&gt; Expr b -&gt; Bool
</span><a href="#local-6989586621682702991"><span class="hs-identifier hs-var hs-var">cheapEqTicked</span></a></span></span><span> </span><span id="local-6989586621682702992"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702992"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621682702993"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702993"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoreTickish -&gt; Bool) -&gt; Expr b -&gt; Expr b -&gt; Bool
forall b. (CoreTickish -&gt; Bool) -&gt; Expr b -&gt; Expr b -&gt; Bool
</span><a href="GHC.Core.Utils.html#cheapEqExpr%27"><span class="hs-identifier hs-var">cheapEqExpr'</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; Bool
forall (pass :: TickishPass). GenTickish pass -&gt; Bool
</span><a href="GHC.Types.Tickish.html#tickishFloatable"><span class="hs-identifier hs-var">tickishFloatable</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702992"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682702993"><span class="hs-identifier hs-var">e2</span></a></span><span>
</span><span id="line-1206"></span><span>    </span><span id="local-6989586621682702985"><span class="annot"><span class="annottext">identical_to_alt1 :: Alt Id -&gt; Bool
</span><a href="#local-6989586621682702985"><span class="hs-identifier hs-var hs-var">identical_to_alt1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span id="local-6989586621682702995"><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621682702995"><span class="hs-identifier hs-var">_con</span></a></span></span><span> </span><span id="local-6989586621682702996"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682702996"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span> </span><span id="local-6989586621682702997"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702997"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1207"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Bool) -&gt; [Id] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Id.html#isDeadBinder"><span class="hs-identifier hs-var">isDeadBinder</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682702996"><span class="hs-identifier hs-var">bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702997"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; Bool
forall {b}. Expr b -&gt; Expr b -&gt; Bool
</span><a href="#local-6989586621682702991"><span class="hs-operator hs-var">`cheapEqTicked`</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702977"><span class="hs-identifier hs-var">rhs1</span></a></span><span>
</span><span id="line-1208"></span><span>    </span><span id="local-6989586621682702987"><span class="annot"><span class="annottext">tickss :: [[CoreTickish]]
</span><a href="#local-6989586621682702987"><span class="hs-identifier hs-var hs-var">tickss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Alt Id -&gt; [CoreTickish]) -&gt; [Alt Id] -&gt; [[CoreTickish]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682702998"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702998"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(CoreTickish -&gt; Bool) -&gt; CoreExpr -&gt; [CoreTickish]
forall b. (CoreTickish -&gt; Bool) -&gt; Expr b -&gt; [CoreTickish]
</span><a href="GHC.Core.Utils.html#stripTicksT"><span class="hs-identifier hs-var">stripTicksT</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; Bool
forall (pass :: TickishPass). GenTickish pass -&gt; Bool
</span><a href="GHC.Types.Tickish.html#tickishFloatable"><span class="hs-identifier hs-var">tickishFloatable</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682702998"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682702981"><span class="hs-identifier hs-var">elim_rest</span></a></span><span>
</span><span id="line-1209"></span><span>
</span><span id="line-1210"></span><span class="annot"><a href="GHC.Core.Utils.html#combineIdenticalAlts"><span class="hs-identifier hs-var">combineIdenticalAlts</span></a></span><span> </span><span id="local-6989586621682702999"><span class="annot"><span class="annottext">[AltCon]
</span><a href="#local-6989586621682702999"><span class="hs-identifier hs-var">imposs_cons</span></a></span></span><span> </span><span id="local-6989586621682703000"><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682703000"><span class="hs-identifier hs-var">alts</span></a></span></span><span>
</span><span id="line-1211"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AltCon]
</span><a href="#local-6989586621682702999"><span class="hs-identifier hs-var">imposs_cons</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682703000"><span class="hs-identifier hs-var">alts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1212"></span><span>
</span><span id="line-1213"></span><span class="hs-comment">-- Scales the multiplicity of the binders of a list of case alternatives. That</span><span>
</span><span id="line-1214"></span><span class="hs-comment">-- is, in [C x1&#8230;xn -&gt; u], the multiplicity of x1&#8230;xn is scaled.</span><span>
</span><span id="line-1215"></span><span class="annot"><a href="GHC.Core.Utils.html#scaleAltsBy"><span class="hs-identifier hs-type">scaleAltsBy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreAlt"><span class="hs-identifier hs-type">CoreAlt</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreAlt"><span class="hs-identifier hs-type">CoreAlt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1216"></span><span id="scaleAltsBy"><span class="annot"><span class="annottext">scaleAltsBy :: Type -&gt; [Alt Id] -&gt; [Alt Id]
</span><a href="GHC.Core.Utils.html#scaleAltsBy"><span class="hs-identifier hs-var hs-var">scaleAltsBy</span></a></span></span><span> </span><span id="local-6989586621682703001"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703001"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682703002"><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682703002"><span class="hs-identifier hs-var">alts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Alt Id -&gt; Alt Id) -&gt; [Alt Id] -&gt; [Alt Id]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Alt Id -&gt; Alt Id
</span><a href="#local-6989586621682703003"><span class="hs-identifier hs-var">scaleAlt</span></a></span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682703002"><span class="hs-identifier hs-var">alts</span></a></span><span>
</span><span id="line-1217"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1218"></span><span>    </span><span class="annot"><a href="#local-6989586621682703003"><span class="hs-identifier hs-type">scaleAlt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreAlt"><span class="hs-identifier hs-type">CoreAlt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreAlt"><span class="hs-identifier hs-type">CoreAlt</span></a></span><span>
</span><span id="line-1219"></span><span>    </span><span id="local-6989586621682703003"><span class="annot"><span class="annottext">scaleAlt :: Alt Id -&gt; Alt Id
</span><a href="#local-6989586621682703003"><span class="hs-identifier hs-var hs-var">scaleAlt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span id="local-6989586621682703004"><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621682703004"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621682703005"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682703005"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span> </span><span id="local-6989586621682703006"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703006"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AltCon -&gt; [Id] -&gt; CoreExpr -&gt; Alt Id
forall b. AltCon -&gt; [b] -&gt; Expr b -&gt; Alt b
</span><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-var">Alt</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621682703004"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Id -&gt; Id) -&gt; [Id] -&gt; [Id]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Id
</span><a href="#local-6989586621682703007"><span class="hs-identifier hs-var">scaleBndr</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682703005"><span class="hs-identifier hs-var">bndrs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703006"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-1220"></span><span>
</span><span id="line-1221"></span><span>    </span><span class="annot"><a href="#local-6989586621682703007"><span class="hs-identifier hs-type">scaleBndr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreBndr"><span class="hs-identifier hs-type">CoreBndr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreBndr"><span class="hs-identifier hs-type">CoreBndr</span></a></span><span>
</span><span id="line-1222"></span><span>    </span><span id="local-6989586621682703007"><span class="annot"><span class="annottext">scaleBndr :: Id -&gt; Id
</span><a href="#local-6989586621682703007"><span class="hs-identifier hs-var hs-var">scaleBndr</span></a></span></span><span> </span><span id="local-6989586621682703008"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703008"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Id -&gt; Id
</span><a href="GHC.Types.Id.html#scaleVarBy"><span class="hs-identifier hs-var">scaleVarBy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703001"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703008"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-1223"></span><span>
</span><span id="line-1224"></span><span>
</span><span id="line-1225"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
             exprIsTrivial
*                                                                      *
************************************************************************

Note [exprIsTrivial]
~~~~~~~~~~~~~~~~~~~~
@exprIsTrivial@ is true of expressions we are unconditionally happy to
                duplicate; simple variables and constants, and type
                applications.  Note that primop Ids aren't considered
                trivial unless

Note [Variables are trivial]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
There used to be a gruesome test for (hasNoBinding v) in the
Var case:
        exprIsTrivial (Var v) | hasNoBinding v = idArity v == 0
The idea here is that a constructor worker, like \$wJust, is
really short for (\x -&gt; \$wJust x), because \$wJust has no binding.
So it should be treated like a lambda.  Ditto unsaturated primops.
But now constructor workers are not &quot;have-no-binding&quot; Ids.  And
completely un-applied primops and foreign-call Ids are sufficiently
rare that I plan to allow them to be duplicated and put up with
saturating them.

Note [Tick trivial]
~~~~~~~~~~~~~~~~~~~
Ticks are only trivial if they are pure annotations. If we treat
&quot;tick&lt;n&gt; x&quot; as trivial, it will be inlined inside lambdas and the
entry count will be skewed, for example.  Furthermore &quot;scc&lt;n&gt; x&quot; will
turn into just &quot;x&quot; in mkTick.

Note [Empty case is trivial]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The expression (case (x::Int) Bool of {}) is just a type-changing
case used when we are sure that 'x' will not return.  See
Note [Empty case alternatives] in GHC.Core.

If the scrutinee is trivial, then so is the whole expression; and the
CoreToSTG pass in fact drops the case expression leaving only the
scrutinee.

Having more trivial expressions is good.  Moreover, if we don't treat
it as trivial we may land up with let-bindings like
   let v = case x of {} in ...
and after CoreToSTG that gives
   let v = x in ...
and that confuses the code generator (#11155). So best to kill
it off at source.
-}</span></span><span>
</span><span id="line-1276"></span><span>
</span><span id="line-1277"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#trivial_expr_fold"><span class="hs-pragma hs-type">trivial_expr_fold</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1278"></span><span id="local-6989586621682701980"><span class="annot"><a href="GHC.Core.Utils.html#trivial_expr_fold"><span class="hs-identifier hs-type">trivial_expr_fold</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682701980"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682701980"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682701980"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682701980"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682701980"><span class="hs-identifier hs-type">r</span></a></span></span><span>
</span><span id="line-1279"></span><span class="hs-comment">-- ^ The worker function for Note [exprIsTrivial] and Note [getIdFromTrivialExpr]</span><span>
</span><span id="line-1280"></span><span class="hs-comment">-- This is meant to have the code of both functions in one place and make it</span><span>
</span><span id="line-1281"></span><span class="hs-comment">-- easy to derive custom predicates.</span><span>
</span><span id="line-1282"></span><span class="hs-comment">--</span><span>
</span><span id="line-1283"></span><span class="hs-comment">-- (trivial_expr_fold k_id k_triv k_not_triv e)</span><span>
</span><span id="line-1284"></span><span class="hs-comment">-- * returns (k_id x) if `e` is a variable `x` (with trivial wrapping)</span><span>
</span><span id="line-1285"></span><span class="hs-comment">-- * returns (k_lit x) if `e` is a trivial literal `l` (with trivial wrapping)</span><span>
</span><span id="line-1286"></span><span class="hs-comment">-- * returns k_triv if `e` is a literal, type, or coercion (with trivial wrapping)</span><span>
</span><span id="line-1287"></span><span class="hs-comment">-- * returns k_not_triv otherwise</span><span>
</span><span id="line-1288"></span><span class="hs-comment">--</span><span>
</span><span id="line-1289"></span><span class="hs-comment">-- where &quot;trivial wrapping&quot; is</span><span>
</span><span id="line-1290"></span><span class="hs-comment">-- * Type application or abstraction</span><span>
</span><span id="line-1291"></span><span class="hs-comment">-- * Ticks other than `tickishIsCode`</span><span>
</span><span id="line-1292"></span><span class="hs-comment">-- * `case e of {}` an empty case</span><span>
</span><span id="line-1293"></span><span id="trivial_expr_fold"><span class="annot"><span class="annottext">trivial_expr_fold :: forall r. (Id -&gt; r) -&gt; (Literal -&gt; r) -&gt; r -&gt; r -&gt; CoreExpr -&gt; r
</span><a href="GHC.Core.Utils.html#trivial_expr_fold"><span class="hs-identifier hs-var hs-var">trivial_expr_fold</span></a></span></span><span> </span><span id="local-6989586621682703012"><span class="annot"><span class="annottext">Id -&gt; r
</span><a href="#local-6989586621682703012"><span class="hs-identifier hs-var">k_id</span></a></span></span><span> </span><span id="local-6989586621682703013"><span class="annot"><span class="annottext">Literal -&gt; r
</span><a href="#local-6989586621682703013"><span class="hs-identifier hs-var">k_lit</span></a></span></span><span> </span><span id="local-6989586621682703014"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621682703014"><span class="hs-identifier hs-var">k_triv</span></a></span></span><span> </span><span id="local-6989586621682703015"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621682703015"><span class="hs-identifier hs-var">k_not_triv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; r
</span><a href="#local-6989586621682703016"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-1294"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1295"></span><span>    </span><span class="hs-comment">-- If you change this function, be sure to change SetLevels.notWorthFloating</span><span>
</span><span id="line-1296"></span><span>    </span><span class="hs-comment">-- as well!</span><span>
</span><span id="line-1297"></span><span>    </span><span class="hs-comment">-- (Or yet better: Come up with a way to share code with this function.)</span><span>
</span><span id="line-1298"></span><span>    </span><span id="local-6989586621682703016"><span class="annot"><span class="annottext">go :: CoreExpr -&gt; r
</span><a href="#local-6989586621682703016"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682703017"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703017"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span>                            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; r
</span><a href="#local-6989586621682703012"><span class="hs-identifier hs-var">k_id</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703017"><span class="hs-identifier hs-var">v</span></a></span><span>  </span><span class="hs-comment">-- See Note [Variables are trivial]</span><span>
</span><span id="line-1299"></span><span>    </span><span class="annot"><a href="#local-6989586621682703016"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span id="local-6989586621682703018"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682703018"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; Bool
</span><a href="GHC.Types.Literal.html#litIsTrivial"><span class="hs-identifier hs-var">litIsTrivial</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682703018"><span class="hs-identifier hs-var">l</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; r
</span><a href="#local-6989586621682703013"><span class="hs-identifier hs-var">k_lit</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682703018"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-1300"></span><span>    </span><span class="annot"><a href="#local-6989586621682703016"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>                           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621682703014"><span class="hs-identifier hs-var">k_triv</span></a></span><span>
</span><span id="line-1301"></span><span>    </span><span class="annot"><a href="#local-6989586621682703016"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621682703014"><span class="hs-identifier hs-var">k_triv</span></a></span><span>
</span><span id="line-1302"></span><span>    </span><span class="annot"><a href="#local-6989586621682703016"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#App"><span class="hs-identifier hs-type">App</span></a></span><span> </span><span id="local-6989586621682703020"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703020"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682703021"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703021"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; Bool
</span><a href="GHC.Core.html#isRuntimeArg"><span class="hs-identifier hs-var">isRuntimeArg</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703021"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; r
</span><a href="#local-6989586621682703016"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703020"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-1303"></span><span>    </span><span class="annot"><a href="#local-6989586621682703016"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-type">Lam</span></a></span><span> </span><span id="local-6989586621682703022"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703022"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621682703023"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703023"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Core.html#isRuntimeVar"><span class="hs-identifier hs-var">isRuntimeVar</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703022"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; r
</span><a href="#local-6989586621682703016"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703023"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1304"></span><span>    </span><span class="annot"><a href="#local-6989586621682703016"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-type">Tick</span></a></span><span> </span><span id="local-6989586621682703024"><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682703024"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682703025"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703025"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreTickish -&gt; Bool
forall (pass :: TickishPass). GenTickish pass -&gt; Bool
</span><a href="GHC.Types.Tickish.html#tickishIsCode"><span class="hs-identifier hs-var">tickishIsCode</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682703024"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; r
</span><a href="#local-6989586621682703016"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703025"><span class="hs-identifier hs-var">e</span></a></span><span>              </span><span class="hs-comment">-- See Note [Tick trivial]</span><span>
</span><span id="line-1305"></span><span>    </span><span class="annot"><a href="#local-6989586621682703016"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Cast"><span class="hs-identifier hs-type">Cast</span></a></span><span> </span><span id="local-6989586621682703026"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703026"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>                         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; r
</span><a href="#local-6989586621682703016"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703026"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1306"></span><span>    </span><span class="annot"><a href="#local-6989586621682703016"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Case"><span class="hs-identifier hs-type">Case</span></a></span><span> </span><span id="local-6989586621682703027"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703027"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621682703028"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703028"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682703029"><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682703029"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1307"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Alt Id] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682703029"><span class="hs-keyword hs-var">as</span></a></span><span>
</span><span id="line-1308"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; r
</span><a href="#local-6989586621682703016"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703027"><span class="hs-identifier hs-var">e</span></a></span><span>     </span><span class="hs-comment">-- See Note [Empty case is trivial]</span><span>
</span><span id="line-1309"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682703030"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703030"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Id -&gt; [Alt Id] -&gt; Maybe CoreExpr
</span><a href="GHC.Core.Utils.html#isUnsafeEqualityCase"><span class="hs-identifier hs-var">isUnsafeEqualityCase</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703027"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703028"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682703029"><span class="hs-keyword hs-var">as</span></a></span><span>
</span><span id="line-1310"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; r
</span><a href="#local-6989586621682703016"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703030"><span class="hs-identifier hs-var">rhs</span></a></span><span>   </span><span class="hs-comment">-- See (U2) of Note [Implementing unsafeCoerce] in base:Unsafe.Coerce</span><span>
</span><span id="line-1311"></span><span>    </span><span class="annot"><a href="#local-6989586621682703016"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span>                                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621682703015"><span class="hs-identifier hs-var">k_not_triv</span></a></span><span>
</span><span id="line-1312"></span><span>
</span><span id="line-1313"></span><span class="annot"><a href="GHC.Core.Utils.html#exprIsTrivial"><span class="hs-identifier hs-type">exprIsTrivial</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1314"></span><span id="exprIsTrivial"><span class="annot"><span class="annottext">exprIsTrivial :: CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#exprIsTrivial"><span class="hs-identifier hs-var hs-var">exprIsTrivial</span></a></span></span><span> </span><span id="local-6989586621682703031"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703031"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Bool)
-&gt; (Literal -&gt; Bool) -&gt; Bool -&gt; Bool -&gt; CoreExpr -&gt; Bool
forall r. (Id -&gt; r) -&gt; (Literal -&gt; r) -&gt; r -&gt; r -&gt; CoreExpr -&gt; r
</span><a href="GHC.Core.Utils.html#trivial_expr_fold"><span class="hs-identifier hs-var">trivial_expr_fold</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Id -&gt; Bool
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Literal -&gt; Bool
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703031"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1315"></span><span>
</span><span id="line-1316"></span><span class="hs-comment">{-
Note [getIdFromTrivialExpr]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
When substituting in a breakpoint we need to strip away the type cruft
from a trivial expression and get back to the Id.  The invariant is
that the expression we're substituting was originally trivial
according to exprIsTrivial, AND the expression is not a literal.
See Note [substTickish] for how breakpoint substitution preserves
this extra invariant.

We also need this functionality in CorePrep to extract out Id of a
function which we are saturating.  However, in this case we don't know
if the variable actually refers to a literal; thus we use
'getIdFromTrivialExpr_maybe' to handle this case.  See test
T12076lit for an example where this matters.
-}</span><span>
</span><span id="line-1332"></span><span>
</span><span id="line-1333"></span><span class="annot"><a href="GHC.Core.Utils.html#getIdFromTrivialExpr"><span class="hs-identifier hs-type">getIdFromTrivialExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-1334"></span><span class="hs-comment">-- See Note [getIdFromTrivialExpr]</span><span>
</span><span id="line-1335"></span><span id="getIdFromTrivialExpr"><span class="annot"><span class="annottext">getIdFromTrivialExpr :: HasDebugCallStack =&gt; CoreExpr -&gt; Id
</span><a href="GHC.Core.Utils.html#getIdFromTrivialExpr"><span class="hs-identifier hs-var hs-var">getIdFromTrivialExpr</span></a></span></span><span> </span><span id="local-6989586621682703037"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703037"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Id) -&gt; (Literal -&gt; Id) -&gt; Id -&gt; Id -&gt; CoreExpr -&gt; Id
forall r. (Id -&gt; r) -&gt; (Literal -&gt; r) -&gt; r -&gt; r -&gt; CoreExpr -&gt; r
</span><a href="GHC.Core.Utils.html#trivial_expr_fold"><span class="hs-identifier hs-var">trivial_expr_fold</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Id
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Literal -&gt; Id
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703038"><span class="hs-identifier hs-var">panic</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703038"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703038"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703037"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1336"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1337"></span><span>    </span><span id="local-6989586621682703038"><span class="annot"><span class="annottext">panic :: Id
</span><a href="#local-6989586621682703038"><span class="hs-identifier hs-var hs-var">panic</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; Id
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getIdFromTrivialExpr&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703037"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1338"></span><span>
</span><span id="line-1339"></span><span class="annot"><a href="GHC.Core.Utils.html#getIdFromTrivialExpr_maybe"><span class="hs-identifier hs-type">getIdFromTrivialExpr_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-1340"></span><span id="getIdFromTrivialExpr_maybe"><span class="annot"><span class="annottext">getIdFromTrivialExpr_maybe :: CoreExpr -&gt; Maybe Id
</span><a href="GHC.Core.Utils.html#getIdFromTrivialExpr_maybe"><span class="hs-identifier hs-var hs-var">getIdFromTrivialExpr_maybe</span></a></span></span><span> </span><span id="local-6989586621682703039"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703039"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Maybe Id)
-&gt; (Literal -&gt; Maybe Id)
-&gt; Maybe Id
-&gt; Maybe Id
-&gt; CoreExpr
-&gt; Maybe Id
forall r. (Id -&gt; r) -&gt; (Literal -&gt; r) -&gt; r -&gt; r -&gt; CoreExpr -&gt; r
</span><a href="GHC.Core.Utils.html#trivial_expr_fold"><span class="hs-identifier hs-var">trivial_expr_fold</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Maybe Id
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Id -&gt; Literal -&gt; Maybe Id
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Maybe Id
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Id
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe Id
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703039"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1341"></span><span>
</span><span id="line-1342"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
             exprIsDupable
*                                                                      *
************************************************************************

Note [exprIsDupable]
~~~~~~~~~~~~~~~~~~~~
@exprIsDupable@ is true of expressions that can be duplicated at a modest
                cost in code size.  This will only happen in different case
                branches, so there's no issue about duplicating work.

                That is, exprIsDupable returns True of (f x) even if
                f is very very expensive to call.

                Its only purpose is to avoid fruitless let-binding
                and then inlining of case join points
-}</span></span><span>
</span><span id="line-1360"></span><span>
</span><span id="line-1361"></span><span class="annot"><a href="GHC.Core.Utils.html#exprIsDupable"><span class="hs-identifier hs-type">exprIsDupable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1362"></span><span id="exprIsDupable"><span class="annot"><span class="annottext">exprIsDupable :: Platform -&gt; CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#exprIsDupable"><span class="hs-identifier hs-var hs-var">exprIsDupable</span></a></span></span><span> </span><span id="local-6989586621682703040"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682703040"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621682703041"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703041"><span class="hs-identifier hs-var">e</span></a></span></span><span>
</span><span id="line-1363"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; CoreExpr -&gt; Maybe Int
</span><a href="#local-6989586621682703043"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.Core.Utils.html#dupAppSize"><span class="hs-identifier hs-var">dupAppSize</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703041"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1364"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1365"></span><span>    </span><span class="annot"><a href="#local-6989586621682703043"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-1366"></span><span>    </span><span id="local-6989586621682703043"><span class="annot"><span class="annottext">go :: Int -&gt; CoreExpr -&gt; Maybe Int
</span><a href="#local-6989586621682703043"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621682703045"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703045"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703045"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1367"></span><span>    </span><span class="annot"><a href="#local-6989586621682703043"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682703046"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703046"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703046"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1368"></span><span>    </span><span class="annot"><a href="#local-6989586621682703043"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682703047"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703047"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
</span><a href="#local-6989586621682703048"><span class="hs-identifier hs-var">decrement</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703047"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1369"></span><span>    </span><span class="annot"><a href="#local-6989586621682703043"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682703049"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703049"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-type">Tick</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682703050"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703050"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; CoreExpr -&gt; Maybe Int
</span><a href="#local-6989586621682703043"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703049"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703050"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1370"></span><span>    </span><span class="annot"><a href="#local-6989586621682703043"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682703051"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703051"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Cast"><span class="hs-identifier hs-type">Cast</span></a></span><span> </span><span id="local-6989586621682703052"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703052"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; CoreExpr -&gt; Maybe Int
</span><a href="#local-6989586621682703043"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703051"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703052"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1371"></span><span>    </span><span class="annot"><a href="#local-6989586621682703043"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682703053"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703053"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#App"><span class="hs-identifier hs-type">App</span></a></span><span> </span><span id="local-6989586621682703054"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703054"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682703055"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703055"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682703056"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703056"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; CoreExpr -&gt; Maybe Int
</span><a href="#local-6989586621682703043"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703053"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703055"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; CoreExpr -&gt; Maybe Int
</span><a href="#local-6989586621682703043"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703056"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703054"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-1372"></span><span>    </span><span class="annot"><a href="#local-6989586621682703043"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682703057"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703057"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span id="local-6989586621682703058"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682703058"><span class="hs-identifier hs-var">lit</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Literal -&gt; Bool
</span><a href="GHC.Types.Literal.html#litIsDupable"><span class="hs-identifier hs-var">litIsDupable</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682703040"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682703058"><span class="hs-identifier hs-var">lit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
</span><a href="#local-6989586621682703048"><span class="hs-identifier hs-var">decrement</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703057"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1373"></span><span>    </span><span class="annot"><a href="#local-6989586621682703043"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1374"></span><span>
</span><span id="line-1375"></span><span>    </span><span class="annot"><a href="#local-6989586621682703048"><span class="hs-identifier hs-type">decrement</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-1376"></span><span>    </span><span id="local-6989586621682703048"><span class="annot"><span class="annottext">decrement :: Int -&gt; Maybe Int
</span><a href="#local-6989586621682703048"><span class="hs-identifier hs-var hs-var">decrement</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1377"></span><span>    </span><span class="annot"><a href="#local-6989586621682703048"><span class="hs-identifier hs-var">decrement</span></a></span><span> </span><span id="local-6989586621682703060"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703060"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703060"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-1378"></span><span>
</span><span id="line-1379"></span><span class="annot"><a href="GHC.Core.Utils.html#dupAppSize"><span class="hs-identifier hs-type">dupAppSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-1380"></span><span id="dupAppSize"><span class="annot"><span class="annottext">dupAppSize :: Int
</span><a href="GHC.Core.Utils.html#dupAppSize"><span class="hs-identifier hs-var hs-var">dupAppSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span>   </span><span class="hs-comment">-- Size of term we are prepared to duplicate</span><span>
</span><span id="line-1381"></span><span>                 </span><span class="hs-comment">-- This is *just* big enough to make test MethSharing</span><span>
</span><span id="line-1382"></span><span>                 </span><span class="hs-comment">-- inline enough join points.  Really it should be</span><span>
</span><span id="line-1383"></span><span>                 </span><span class="hs-comment">-- smaller, and could be if we fixed #4960.</span><span>
</span><span id="line-1384"></span><span>
</span><span id="line-1385"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
             exprIsCheap, exprIsExpandable
*                                                                      *
************************************************************************

Note [exprIsWorkFree]
~~~~~~~~~~~~~~~~~~~~~
exprIsWorkFree is used when deciding whether to inline something; we
don't inline it if doing so might duplicate work, by peeling off a
complete copy of the expression.  Here we do not want even to
duplicate a primop (#5623):
   eg   let x = a #+ b in x +# x
   we do not want to inline/duplicate x

Previously we were a bit more liberal, which led to the primop-duplicating
problem.  However, being more conservative did lead to a big regression in
one nofib benchmark, wheel-sieve1.  The situation looks like this:

   let noFactor_sZ3 :: GHC.Types.Int -&gt; GHC.Types.Bool
       noFactor_sZ3 = case s_adJ of _ { GHC.Types.I# x_aRs -&gt;
         case GHC.Prim.&lt;=# x_aRs 2 of _ {
           GHC.Types.False -&gt; notDivBy ps_adM qs_adN;
           GHC.Types.True -&gt; lvl_r2Eb }}
       go = \x. ...(noFactor (I# y))....(go x')...

The function 'noFactor' is heap-allocated and then called.  Turns out
that 'notDivBy' is strict in its THIRD arg, but that is invisible to
the caller of noFactor, which therefore cannot do w/w and
heap-allocates noFactor's argument.  At the moment (May 12) we are just
going to put up with this, because the previous more aggressive inlining
(which treated 'noFactor' as work-free) was duplicating primops, which
in turn was making inner loops of array calculations runs slow (#5623)

Note [Case expressions are work-free]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Are case-expressions work-free?  Consider
    let v = case x of (p,q) -&gt; p
        go = \y -&gt; ...case v of ...
Should we inline 'v' at its use site inside the loop?  At the moment
we do.  I experimented with saying that case are *not* work-free, but
that increased allocation slightly.  It's a fairly small effect, and at
the moment we go for the slightly more aggressive version which treats
(case x of ....) as work-free if the alternatives are.

Moreover it improves arities of overloaded functions where
there is only dictionary selection (no construction) involved

Note [exprIsCheap]
~~~~~~~~~~~~~~~~~~
See also Note [Interaction of exprIsWorkFree and lone variables] in GHC.Core.Unfold

@exprIsCheap@ looks at a Core expression and returns \tr{True} if
it is obviously in weak head normal form, or is cheap to get to WHNF.
Note that that's not the same as exprIsDupable; an expression might be
big, and hence not dupable, but still cheap.

By ``cheap'' we mean a computation we're willing to:
        push inside a lambda, or
        inline at more than one place
That might mean it gets evaluated more than once, instead of being
shared.  The main examples of things which aren't WHNF but are
``cheap'' are:

  *     case e of
          pi -&gt; ei
        (where e, and all the ei are cheap)

  *     let x = e in b
        (where e and b are cheap)

  *     op x1 ... xn
        (where op is a cheap primitive operator)

  *     error &quot;foo&quot;
        (because we are happy to substitute it inside a lambda)

Notice that a variable is considered 'cheap': we can push it inside a lambda,
because sharing will make sure it is only evaluated once.

Note [exprIsCheap and exprIsHNF]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Note that exprIsHNF does not imply exprIsCheap.  Eg
        let x = fac 20 in Just x
This responds True to exprIsHNF (you can discard a seq), but
False to exprIsCheap.

Note [Arguments and let-bindings exprIsCheapX]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
What predicate should we apply to the argument of an application, or the
RHS of a let-binding?

We used to say &quot;exprIsTrivial arg&quot; due to concerns about duplicating
nested constructor applications, but see #4978.  So now we just recursively
use exprIsCheapX.

We definitely want to treat let and app the same.  The principle here is
that
   let x = blah in f x
should behave equivalently to
   f blah

This in turn means that the 'letrec g' does not prevent eta expansion
in this (which it previously was):
    f = \x. let v = case x of
                      True -&gt; letrec g = \w. blah
                              in g
                      False -&gt; \x. x
            in \w. v True
-}</span><span>
</span><span id="line-1496"></span><span>
</span><span id="line-1497"></span><span class="hs-comment">--------------------</span><span>
</span><span id="line-1498"></span><span class="annot"><a href="GHC.Core.Utils.html#exprIsWorkFree"><span class="hs-identifier hs-type">exprIsWorkFree</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>   </span><span class="hs-comment">-- See Note [exprIsWorkFree]</span><span>
</span><span id="line-1499"></span><span id="exprIsWorkFree"><span class="annot"><span class="annottext">exprIsWorkFree :: CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#exprIsWorkFree"><span class="hs-identifier hs-var hs-var">exprIsWorkFree</span></a></span></span><span> </span><span id="local-6989586621682703061"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703061"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CheapAppFun -&gt; CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#exprIsCheapX"><span class="hs-identifier hs-var">exprIsCheapX</span></a></span><span> </span><span class="annot"><span class="annottext">CheapAppFun
</span><a href="GHC.Core.Utils.html#isWorkFreeApp"><span class="hs-identifier hs-var">isWorkFreeApp</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703061"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1500"></span><span>
</span><span id="line-1501"></span><span class="annot"><a href="GHC.Core.Utils.html#exprIsCheap"><span class="hs-identifier hs-type">exprIsCheap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1502"></span><span id="exprIsCheap"><span class="annot"><span class="annottext">exprIsCheap :: CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#exprIsCheap"><span class="hs-identifier hs-var hs-var">exprIsCheap</span></a></span></span><span> </span><span id="local-6989586621682703063"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703063"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CheapAppFun -&gt; CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#exprIsCheapX"><span class="hs-identifier hs-var">exprIsCheapX</span></a></span><span> </span><span class="annot"><span class="annottext">CheapAppFun
</span><a href="GHC.Core.Utils.html#isCheapApp"><span class="hs-identifier hs-var">isCheapApp</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703063"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1503"></span><span>
</span><span id="line-1504"></span><span class="annot"><a href="GHC.Core.Utils.html#exprIsCheapX"><span class="hs-identifier hs-type">exprIsCheapX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#CheapAppFun"><span class="hs-identifier hs-type">CheapAppFun</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1505"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#exprIsCheapX"><span class="hs-pragma hs-type">exprIsCheapX</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1506"></span><span class="hs-comment">-- allow specialization of exprIsCheap and exprIsWorkFree</span><span>
</span><span id="line-1507"></span><span class="hs-comment">-- instead of having an unknown call to ok_app</span><span>
</span><span id="line-1508"></span><span id="exprIsCheapX"><span class="annot"><span class="annottext">exprIsCheapX :: CheapAppFun -&gt; CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#exprIsCheapX"><span class="hs-identifier hs-var hs-var">exprIsCheapX</span></a></span></span><span> </span><span id="local-6989586621682703064"><span class="annot"><span class="annottext">CheapAppFun
</span><a href="#local-6989586621682703064"><span class="hs-identifier hs-var">ok_app</span></a></span></span><span> </span><span id="local-6989586621682703065"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703065"><span class="hs-identifier hs-var">e</span></a></span></span><span>
</span><span id="line-1509"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703066"><span class="hs-identifier hs-var">ok</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703065"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1510"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1511"></span><span>    </span><span id="local-6989586621682703066"><span class="annot"><span class="annottext">ok :: CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703066"><span class="hs-identifier hs-var hs-var">ok</span></a></span></span><span> </span><span id="local-6989586621682703067"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703067"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703068"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703067"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1512"></span><span>
</span><span id="line-1513"></span><span>    </span><span class="hs-comment">-- n is the number of value arguments</span><span>
</span><span id="line-1514"></span><span>    </span><span id="local-6989586621682703068"><span class="annot"><span class="annottext">go :: Int -&gt; CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703068"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621682703069"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703069"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682703070"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703070"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CheapAppFun
</span><a href="#local-6989586621682703064"><span class="hs-identifier hs-var">ok_app</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703070"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703069"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1515"></span><span>    </span><span class="annot"><a href="#local-6989586621682703068"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1516"></span><span>    </span><span class="annot"><a href="#local-6989586621682703068"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1517"></span><span>    </span><span class="annot"><a href="#local-6989586621682703068"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1518"></span><span>    </span><span class="annot"><a href="#local-6989586621682703068"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682703071"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703071"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Cast"><span class="hs-identifier hs-type">Cast</span></a></span><span> </span><span id="local-6989586621682703072"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703072"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703068"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703071"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703072"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1519"></span><span>    </span><span class="annot"><a href="#local-6989586621682703068"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682703073"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703073"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Case"><span class="hs-identifier hs-type">Case</span></a></span><span> </span><span id="local-6989586621682703074"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703074"><span class="hs-identifier hs-var">scrut</span></a></span></span><span> </span><span class="annot"><span class="annottext">Id
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682703075"><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682703075"><span class="hs-identifier hs-var">alts</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703066"><span class="hs-identifier hs-var">ok</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703074"><span class="hs-identifier hs-var">scrut</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-1520"></span><span>                                        </span><span class="annot"><span class="annottext">[Bool] -&gt; Bool
forall (t :: * -&gt; *). Foldable t =&gt; t Bool -&gt; Bool
</span><span class="hs-identifier hs-var">and</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Int -&gt; CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703068"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703073"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703077"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682703077"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703077"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682703075"><span class="hs-identifier hs-var">alts</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1521"></span><span>    </span><span class="annot"><a href="#local-6989586621682703068"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682703078"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703078"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-type">Tick</span></a></span><span> </span><span id="local-6989586621682703079"><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682703079"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682703080"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703080"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; Bool
forall (pass :: TickishPass). GenTickish pass -&gt; Bool
</span><a href="GHC.Types.Tickish.html#tickishCounts"><span class="hs-identifier hs-var">tickishCounts</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682703079"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1522"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703068"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703078"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703080"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1523"></span><span>    </span><span class="annot"><a href="#local-6989586621682703068"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682703082"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703082"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-type">Lam</span></a></span><span> </span><span id="local-6989586621682703083"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703083"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682703084"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703084"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Core.html#isRuntimeVar"><span class="hs-identifier hs-var">isRuntimeVar</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703083"><span class="hs-identifier hs-var">x</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703082"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703068"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703082"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703084"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1524"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703068"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703082"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703084"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1525"></span><span>    </span><span class="annot"><a href="#local-6989586621682703068"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682703085"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703085"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#App"><span class="hs-identifier hs-type">App</span></a></span><span> </span><span id="local-6989586621682703086"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703086"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682703087"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703087"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Bool
</span><a href="GHC.Core.html#isRuntimeArg"><span class="hs-identifier hs-var">isRuntimeArg</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703087"><span class="hs-identifier hs-var">e</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703068"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703085"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703086"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703066"><span class="hs-identifier hs-var">ok</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703087"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1526"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703068"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703085"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703086"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-1527"></span><span>    </span><span class="annot"><a href="#local-6989586621682703068"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682703089"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703089"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#NonRec"><span class="hs-identifier hs-type">NonRec</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682703090"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703090"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682703091"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703091"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703068"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703089"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703091"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703066"><span class="hs-identifier hs-var">ok</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703090"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1528"></span><span>    </span><span class="annot"><a href="#local-6989586621682703068"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682703092"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703092"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Rec"><span class="hs-identifier hs-type">Rec</span></a></span><span> </span><span id="local-6989586621682703093"><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><a href="#local-6989586621682703093"><span class="hs-identifier hs-var">prs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682703094"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703094"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703068"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703092"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703094"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">((Id, CoreExpr) -&gt; Bool) -&gt; [(Id, CoreExpr)] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703066"><span class="hs-identifier hs-var">ok</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; Bool)
-&gt; ((Id, CoreExpr) -&gt; CoreExpr) -&gt; (Id, CoreExpr) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Id, CoreExpr) -&gt; CoreExpr
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><a href="#local-6989586621682703093"><span class="hs-identifier hs-var">prs</span></a></span><span>
</span><span id="line-1529"></span><span>
</span><span id="line-1530"></span><span>      </span><span class="hs-comment">-- Case: see Note [Case expressions are work-free]</span><span>
</span><span id="line-1531"></span><span>      </span><span class="hs-comment">-- App, Let: see Note [Arguments and let-bindings exprIsCheapX]</span><span>
</span><span id="line-1532"></span><span>
</span><span id="line-1533"></span><span>
</span><span id="line-1534"></span><span class="hs-comment">{- Note [exprIsExpandable]
~~~~~~~~~~~~~~~~~~~~~~~~~~
An expression is &quot;expandable&quot; if we are willing to duplicate it, if doing
so might make a RULE or case-of-constructor fire.  Consider
   let x = (a,b)
       y = build g
   in ....(case x of (p,q) -&gt; rhs)....(foldr k z y)....

We don't inline 'x' or 'y' (see Note [Lone variables] in GHC.Core.Unfold),
but we do want

 * the case-expression to simplify
   (via exprIsConApp_maybe, exprIsLiteral_maybe)

 * the foldr/build RULE to fire
   (by expanding the unfolding during rule matching)

So we classify the unfolding of a let-binding as &quot;expandable&quot; (via the
uf_expandable field) if we want to do this kind of on-the-fly
expansion.  Specifically:

* True of constructor applications (K a b)

* True of applications of a &quot;CONLIKE&quot; Id; see Note [CONLIKE pragma] in GHC.Types.Basic.
  (NB: exprIsCheap might not be true of this)

* False of case-expressions.  If we have
    let x = case ... in ...(case x of ...)...
  we won't simplify.  We have to inline x.  See #14688.

* False of let-expressions (same reason); and in any case we
  float lets out of an RHS if doing so will reveal an expandable
  application (see SimplEnv.doFloatFromRhs).

* Take care: exprIsExpandable should /not/ be true of primops.  I
  found this in test T5623a:
    let q = /\a. Ptr a (a +# b)
    in case q @ Float of Ptr v -&gt; ...q...

  q's inlining should not be expandable, else exprIsConApp_maybe will
  say that (q @ Float) expands to (Ptr a (a +# b)), and that will
  duplicate the (a +# b) primop, which we should not do lightly.
  (It's quite hard to trigger this bug, but T13155 does so for GHC 8.0.)
-}</span><span>
</span><span id="line-1578"></span><span>
</span><span id="line-1579"></span><span class="hs-comment">-------------------------------------</span><span>
</span><span id="line-1580"></span><span class="annot"><a href="GHC.Core.Utils.html#exprIsExpandable"><span class="hs-identifier hs-type">exprIsExpandable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1581"></span><span class="hs-comment">-- See Note [exprIsExpandable]</span><span>
</span><span id="line-1582"></span><span id="exprIsExpandable"><span class="annot"><span class="annottext">exprIsExpandable :: CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#exprIsExpandable"><span class="hs-identifier hs-var hs-var">exprIsExpandable</span></a></span></span><span> </span><span id="local-6989586621682703096"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703096"><span class="hs-identifier hs-var">e</span></a></span></span><span>
</span><span id="line-1583"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703097"><span class="hs-identifier hs-var">ok</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703096"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1584"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1585"></span><span>    </span><span id="local-6989586621682703097"><span class="annot"><span class="annottext">ok :: CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703097"><span class="hs-identifier hs-var hs-var">ok</span></a></span></span><span> </span><span id="local-6989586621682703105"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703105"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703106"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703105"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1586"></span><span>
</span><span id="line-1587"></span><span>    </span><span class="hs-comment">-- n is the number of value arguments</span><span>
</span><span id="line-1588"></span><span>    </span><span id="local-6989586621682703106"><span class="annot"><span class="annottext">go :: Int -&gt; CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703106"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621682703107"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703107"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682703108"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703108"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CheapAppFun
</span><a href="GHC.Core.Utils.html#isExpandableApp"><span class="hs-identifier hs-var">isExpandableApp</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703108"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703107"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1589"></span><span>    </span><span class="annot"><a href="#local-6989586621682703106"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1590"></span><span>    </span><span class="annot"><a href="#local-6989586621682703106"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1591"></span><span>    </span><span class="annot"><a href="#local-6989586621682703106"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1592"></span><span>    </span><span class="annot"><a href="#local-6989586621682703106"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682703109"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703109"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Cast"><span class="hs-identifier hs-type">Cast</span></a></span><span> </span><span id="local-6989586621682703110"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703110"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703106"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703109"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703110"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1593"></span><span>    </span><span class="annot"><a href="#local-6989586621682703106"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682703111"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703111"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-type">Tick</span></a></span><span> </span><span id="local-6989586621682703112"><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682703112"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682703113"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703113"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; Bool
forall (pass :: TickishPass). GenTickish pass -&gt; Bool
</span><a href="GHC.Types.Tickish.html#tickishCounts"><span class="hs-identifier hs-var">tickishCounts</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682703112"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1594"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703106"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703111"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703113"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1595"></span><span>    </span><span class="annot"><a href="#local-6989586621682703106"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682703114"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703114"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-type">Lam</span></a></span><span> </span><span id="local-6989586621682703115"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703115"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682703116"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703116"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Core.html#isRuntimeVar"><span class="hs-identifier hs-var">isRuntimeVar</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703115"><span class="hs-identifier hs-var">x</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703114"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703106"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703114"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703116"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1596"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703106"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703114"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703116"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1597"></span><span>    </span><span class="annot"><a href="#local-6989586621682703106"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682703117"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703117"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#App"><span class="hs-identifier hs-type">App</span></a></span><span> </span><span id="local-6989586621682703118"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703118"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682703119"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703119"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Bool
</span><a href="GHC.Core.html#isRuntimeArg"><span class="hs-identifier hs-var">isRuntimeArg</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703119"><span class="hs-identifier hs-var">e</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703106"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703117"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703118"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703097"><span class="hs-identifier hs-var">ok</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703119"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1598"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703106"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703117"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703118"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-1599"></span><span>    </span><span class="annot"><a href="#local-6989586621682703106"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Case"><span class="hs-identifier hs-type">Case</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1600"></span><span>    </span><span class="annot"><a href="#local-6989586621682703106"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1601"></span><span>
</span><span id="line-1602"></span><span>
</span><span id="line-1603"></span><span class="hs-comment">-------------------------------------</span><span>
</span><span id="line-1604"></span><span class="hs-keyword">type</span><span> </span><span id="CheapAppFun"><span class="annot"><a href="GHC.Core.Utils.html#CheapAppFun"><span class="hs-identifier hs-var">CheapAppFun</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1605"></span><span>  </span><span class="hs-comment">-- Is an application of this function to n *value* args</span><span>
</span><span id="line-1606"></span><span>  </span><span class="hs-comment">-- always cheap, assuming the arguments are cheap?</span><span>
</span><span id="line-1607"></span><span>  </span><span class="hs-comment">-- True mainly of data constructors, partial applications;</span><span>
</span><span id="line-1608"></span><span>  </span><span class="hs-comment">-- but with minor variations:</span><span>
</span><span id="line-1609"></span><span>  </span><span class="hs-comment">--    isWorkFreeApp</span><span>
</span><span id="line-1610"></span><span>  </span><span class="hs-comment">--    isCheapApp</span><span>
</span><span id="line-1611"></span><span>
</span><span id="line-1612"></span><span class="annot"><a href="GHC.Core.Utils.html#isWorkFreeApp"><span class="hs-identifier hs-type">isWorkFreeApp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#CheapAppFun"><span class="hs-identifier hs-type">CheapAppFun</span></a></span><span>
</span><span id="line-1613"></span><span id="isWorkFreeApp"><span class="annot"><span class="annottext">isWorkFreeApp :: CheapAppFun
</span><a href="GHC.Core.Utils.html#isWorkFreeApp"><span class="hs-identifier hs-var hs-var">isWorkFreeApp</span></a></span></span><span> </span><span id="local-6989586621682703120"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703120"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span id="local-6989586621682703121"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703121"><span class="hs-identifier hs-var">n_val_args</span></a></span></span><span>
</span><span id="line-1614"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703121"><span class="hs-identifier hs-var">n_val_args</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>           </span><span class="hs-comment">-- No value args</span><span>
</span><span id="line-1615"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1616"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703121"><span class="hs-identifier hs-var">n_val_args</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Int
</span><a href="GHC.Types.Id.html#idArity"><span class="hs-identifier hs-var">idArity</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703120"><span class="hs-identifier hs-var">fn</span></a></span><span>   </span><span class="hs-comment">-- Partial application</span><span>
</span><span id="line-1617"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1618"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1619"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Id -&gt; IdDetails
</span><a href="GHC.Types.Var.html#idDetails"><span class="hs-identifier hs-var">idDetails</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703120"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1620"></span><span>      </span><span class="annot"><a href="GHC.Types.Id.Info.html#DataConWorkId"><span class="hs-identifier hs-type">DataConWorkId</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1621"></span><span>      </span><span class="annot"><a href="GHC.Types.Id.Info.html#PrimOpId"><span class="hs-identifier hs-type">PrimOpId</span></a></span><span> </span><span id="local-6989586621682703126"><span class="annot"><span class="annottext">PrimOp
</span><a href="#local-6989586621682703126"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="annot"><span class="annottext">ConcreteTyVars
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; Bool
</span><a href="GHC.Builtin.PrimOps.html#primOpIsWorkFree"><span class="hs-identifier hs-var">primOpIsWorkFree</span></a></span><span> </span><span class="annot"><span class="annottext">PrimOp
</span><a href="#local-6989586621682703126"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-1622"></span><span>      </span><span class="annot"><span class="annottext">IdDetails
</span><span class="hs-identifier">_</span></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1623"></span><span>
</span><span id="line-1624"></span><span class="annot"><a href="GHC.Core.Utils.html#isCheapApp"><span class="hs-identifier hs-type">isCheapApp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#CheapAppFun"><span class="hs-identifier hs-type">CheapAppFun</span></a></span><span>
</span><span id="line-1625"></span><span id="isCheapApp"><span class="annot"><span class="annottext">isCheapApp :: CheapAppFun
</span><a href="GHC.Core.Utils.html#isCheapApp"><span class="hs-identifier hs-var hs-var">isCheapApp</span></a></span></span><span> </span><span id="local-6989586621682703128"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703128"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span id="local-6989586621682703129"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703129"><span class="hs-identifier hs-var">n_val_args</span></a></span></span><span>
</span><span id="line-1626"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CheapAppFun
</span><a href="GHC.Core.Utils.html#isWorkFreeApp"><span class="hs-identifier hs-var">isWorkFreeApp</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703128"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703129"><span class="hs-identifier hs-var">n_val_args</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1627"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Id.html#isDeadEndId"><span class="hs-identifier hs-var">isDeadEndId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703128"><span class="hs-identifier hs-var">fn</span></a></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="hs-comment">-- See Note [isCheapApp: bottoming functions]</span><span>
</span><span id="line-1628"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1629"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Id -&gt; IdDetails
</span><a href="GHC.Types.Var.html#idDetails"><span class="hs-identifier hs-var">idDetails</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703128"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1630"></span><span>      </span><span class="annot"><a href="GHC.Types.Id.Info.html#DataConWorkId"><span class="hs-identifier hs-type">DataConWorkId</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="hs-comment">-- Actually handled by isWorkFreeApp</span><span>
</span><span id="line-1631"></span><span>      </span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelId"><span class="hs-identifier hs-type">RecSelId</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703129"><span class="hs-identifier hs-var">n_val_args</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>  </span><span class="hs-comment">-- See Note [Record selection]</span><span>
</span><span id="line-1632"></span><span>      </span><span class="annot"><a href="GHC.Types.Id.Info.html#ClassOpId"><span class="hs-identifier hs-type">ClassOpId</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703129"><span class="hs-identifier hs-var">n_val_args</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1633"></span><span>      </span><span class="annot"><a href="GHC.Types.Id.Info.html#PrimOpId"><span class="hs-identifier hs-type">PrimOpId</span></a></span><span> </span><span id="local-6989586621682703133"><span class="annot"><span class="annottext">PrimOp
</span><a href="#local-6989586621682703133"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="annot"><span class="annottext">ConcreteTyVars
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; Bool
</span><a href="GHC.Builtin.PrimOps.html#primOpIsCheap"><span class="hs-identifier hs-var">primOpIsCheap</span></a></span><span> </span><span class="annot"><span class="annottext">PrimOp
</span><a href="#local-6989586621682703133"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-1634"></span><span>      </span><span class="annot"><span class="annottext">IdDetails
</span><span class="hs-identifier">_</span></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1635"></span><span>        </span><span class="hs-comment">-- In principle we should worry about primops</span><span>
</span><span id="line-1636"></span><span>        </span><span class="hs-comment">-- that return a type variable, since the result</span><span>
</span><span id="line-1637"></span><span>        </span><span class="hs-comment">-- might be applied to something, but I'm not going</span><span>
</span><span id="line-1638"></span><span>        </span><span class="hs-comment">-- to bother to check the number of args</span><span>
</span><span id="line-1639"></span><span>
</span><span id="line-1640"></span><span class="annot"><a href="GHC.Core.Utils.html#isExpandableApp"><span class="hs-identifier hs-type">isExpandableApp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#CheapAppFun"><span class="hs-identifier hs-type">CheapAppFun</span></a></span><span>
</span><span id="line-1641"></span><span id="isExpandableApp"><span class="annot"><span class="annottext">isExpandableApp :: CheapAppFun
</span><a href="GHC.Core.Utils.html#isExpandableApp"><span class="hs-identifier hs-var hs-var">isExpandableApp</span></a></span></span><span> </span><span id="local-6989586621682703135"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703135"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span id="local-6989586621682703136"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703136"><span class="hs-identifier hs-var">n_val_args</span></a></span></span><span>
</span><span id="line-1642"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CheapAppFun
</span><a href="GHC.Core.Utils.html#isWorkFreeApp"><span class="hs-identifier hs-var">isWorkFreeApp</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703135"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703136"><span class="hs-identifier hs-var">n_val_args</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1643"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1644"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Id -&gt; IdDetails
</span><a href="GHC.Types.Var.html#idDetails"><span class="hs-identifier hs-var">idDetails</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703135"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1645"></span><span>      </span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelId"><span class="hs-identifier hs-type">RecSelId</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703136"><span class="hs-identifier hs-var">n_val_args</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>  </span><span class="hs-comment">-- See Note [Record selection]</span><span>
</span><span id="line-1646"></span><span>      </span><span class="annot"><a href="GHC.Types.Id.Info.html#ClassOpId"><span class="hs-identifier hs-type">ClassOpId</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703136"><span class="hs-identifier hs-var">n_val_args</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1647"></span><span>      </span><span class="annot"><a href="GHC.Types.Id.Info.html#PrimOpId"><span class="hs-identifier hs-type">PrimOpId</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1648"></span><span>      </span><span class="annot"><span class="annottext">IdDetails
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Id.html#isDeadEndId"><span class="hs-identifier hs-var">isDeadEndId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703135"><span class="hs-identifier hs-var">fn</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1649"></span><span>          </span><span class="hs-comment">-- See Note [isExpandableApp: bottoming functions]</span><span>
</span><span id="line-1650"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Id.html#isConLikeId"><span class="hs-identifier hs-var">isConLikeId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703135"><span class="hs-identifier hs-var">fn</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1651"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682703137"><span class="hs-identifier hs-var">all_args_are_preds</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1652"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1653"></span><span>
</span><span id="line-1654"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1655"></span><span>     </span><span class="hs-comment">-- See if all the arguments are PredTys (implicit params or classes)</span><span>
</span><span id="line-1656"></span><span>     </span><span class="hs-comment">-- If so we'll regard it as expandable; see Note [Expandable overloadings]</span><span>
</span><span id="line-1657"></span><span>     </span><span id="local-6989586621682703137"><span class="annot"><span class="annottext">all_args_are_preds :: Bool
</span><a href="#local-6989586621682703137"><span class="hs-identifier hs-var hs-var">all_args_are_preds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Type -&gt; Bool
forall {t}. (Eq t, Num t) =&gt; t -&gt; Type -&gt; Bool
</span><a href="#local-6989586621682703138"><span class="hs-identifier hs-var">all_pred_args</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703136"><span class="hs-identifier hs-var">n_val_args</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703135"><span class="hs-identifier hs-var">fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1658"></span><span>
</span><span id="line-1659"></span><span>     </span><span id="local-6989586621682703138"><span class="annot"><span class="annottext">all_pred_args :: t -&gt; Type -&gt; Bool
</span><a href="#local-6989586621682703138"><span class="hs-identifier hs-var hs-var">all_pred_args</span></a></span></span><span> </span><span id="local-6989586621682703145"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682703145"><span class="hs-identifier hs-var">n_val_args</span></a></span></span><span> </span><span id="local-6989586621682703146"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703146"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1660"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682703145"><span class="hs-identifier hs-var">n_val_args</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1661"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1662"></span><span>
</span><span id="line-1663"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682703147"><span class="annot"><span class="annottext">PiTyBinder
</span><a href="#local-6989586621682703147"><span class="hs-identifier hs-var">bndr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682703148"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703148"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (PiTyBinder, Type)
</span><a href="GHC.Core.Type.html#splitPiTy_maybe"><span class="hs-identifier hs-var">splitPiTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703146"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1664"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PiTyBinder
</span><a href="#local-6989586621682703147"><span class="hs-identifier hs-var">bndr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1665"></span><span>           </span><span class="annot"><a href="GHC.Types.Var.html#Named"><span class="hs-identifier hs-type">Named</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">t -&gt; Type -&gt; Bool
</span><a href="#local-6989586621682703138"><span class="hs-identifier hs-var">all_pred_args</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682703145"><span class="hs-identifier hs-var">n_val_args</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703148"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1666"></span><span>           </span><span class="annot"><a href="GHC.Types.Var.html#Anon"><span class="hs-identifier hs-type">Anon</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682703152"><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682703152"><span class="hs-identifier hs-var">af</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FunTyFlag -&gt; Bool
</span><a href="GHC.Types.Var.html#isInvisibleFunArg"><span class="hs-identifier hs-var">isInvisibleFunArg</span></a></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682703152"><span class="hs-identifier hs-var">af</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">t -&gt; Type -&gt; Bool
</span><a href="#local-6989586621682703138"><span class="hs-identifier hs-var">all_pred_args</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682703145"><span class="hs-identifier hs-var">n_val_args</span></a></span><span class="annot"><span class="annottext">t -&gt; t -&gt; t
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">t
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703148"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1667"></span><span>
</span><span id="line-1668"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1669"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1670"></span><span>
</span><span id="line-1671"></span><span class="hs-comment">{- Note [isCheapApp: bottoming functions]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
I'm not sure why we have a special case for bottoming
functions in isCheapApp.  Maybe we don't need it.

Note [isExpandableApp: bottoming functions]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
It's important that isExpandableApp does not respond True to bottoming
functions.  Recall  undefined :: HasCallStack =&gt; a
Suppose isExpandableApp responded True to (undefined d), and we had:

  x = undefined &lt;dict-expr&gt;

Then Simplify.prepareRhs would ANF the RHS:

  d = &lt;dict-expr&gt;
  x = undefined d

This is already bad: we gain nothing from having x bound to (undefined
var), unlike the case for data constructors.  Worse, we get the
simplifier loop described in OccurAnal Note [Cascading inlines].
Suppose x occurs just once; OccurAnal.occAnalNonRecRhs decides x will
certainly_inline; so we end up inlining d right back into x; but in
the end x doesn't inline because it is bottom (preInlineUnconditionally);
so the process repeats.. We could elaborate the certainly_inline logic
some more, but it's better just to treat bottoming bindings as
non-expandable, because ANFing them is a bad idea in the first place.

Note [Record selection]
~~~~~~~~~~~~~~~~~~~~~~~~~~
I'm experimenting with making record selection
look cheap, so we will substitute it inside a
lambda.  Particularly for dictionary field selection.

BUT: Take care with (sel d x)!  The (sel d) might be cheap, but
there's no guarantee that (sel d x) will be too.  Hence (n_val_args == 1)

Note [Expandable overloadings]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose the user wrote this
   {-# RULE  forall x. foo (negate x) = h x #-}
   f x = ....(foo (negate x))....
They'd expect the rule to fire. But since negate is overloaded, we might
get this:
    f = \d -&gt; let n = negate d in \x -&gt; ...foo (n x)...
So we treat the application of a function (negate in this case) to a
*dictionary* as expandable.  In effect, every function is CONLIKE when
it's applied only to dictionaries.


************************************************************************
*                                                                      *
             exprOkForSpeculation
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1727"></span><span>
</span><span id="line-1728"></span><span class="hs-comment">-----------------------------</span><span>
</span><span id="line-1729"></span><span class="hs-comment">-- | To a first approximation, 'exprOkForSpeculation' returns True of</span><span>
</span><span id="line-1730"></span><span class="hs-comment">-- an expression that is:</span><span>
</span><span id="line-1731"></span><span class="hs-comment">--</span><span>
</span><span id="line-1732"></span><span class="hs-comment">--  * Safe to evaluate even if normal order eval might not</span><span>
</span><span id="line-1733"></span><span class="hs-comment">--    evaluate the expression at all, and</span><span>
</span><span id="line-1734"></span><span class="hs-comment">--</span><span>
</span><span id="line-1735"></span><span class="hs-comment">--  * Safe /not/ to evaluate even if normal order would do so</span><span>
</span><span id="line-1736"></span><span class="hs-comment">--</span><span>
</span><span id="line-1737"></span><span class="hs-comment">-- More specifically, this means that:</span><span>
</span><span id="line-1738"></span><span class="hs-comment">--  * A: Evaluation of the expression reaches weak-head-normal-form,</span><span>
</span><span id="line-1739"></span><span class="hs-comment">--  * B: soon,</span><span>
</span><span id="line-1740"></span><span class="hs-comment">--  * C: without causing a write side effect (e.g. writing a mutable variable).</span><span>
</span><span id="line-1741"></span><span class="hs-comment">--</span><span>
</span><span id="line-1742"></span><span class="hs-comment">-- In particular, an expression that may</span><span>
</span><span id="line-1743"></span><span class="hs-comment">--  * throw a synchronous Haskell exception, or</span><span>
</span><span id="line-1744"></span><span class="hs-comment">--  * risk an unchecked runtime exception (e.g. array</span><span>
</span><span id="line-1745"></span><span class="hs-comment">--    out of bounds, divide by zero)</span><span>
</span><span id="line-1746"></span><span class="hs-comment">-- is /not/ considered OK-for-speculation, as these violate condition A.</span><span>
</span><span id="line-1747"></span><span class="hs-comment">--</span><span>
</span><span id="line-1748"></span><span class="hs-comment">-- For 'exprOkToDiscard', condition A is weakened to allow expressions</span><span>
</span><span id="line-1749"></span><span class="hs-comment">-- that might risk an unchecked runtime exception but must otherwise</span><span>
</span><span id="line-1750"></span><span class="hs-comment">-- reach weak-head-normal-form.</span><span>
</span><span id="line-1751"></span><span class="hs-comment">-- (Note that 'exprOkForSpeculation' implies 'exprOkToDiscard')</span><span>
</span><span id="line-1752"></span><span class="hs-comment">--</span><span>
</span><span id="line-1753"></span><span class="hs-comment">-- But in fact both functions are a bit more conservative than the above,</span><span>
</span><span id="line-1754"></span><span class="hs-comment">-- in at least the following ways:</span><span>
</span><span id="line-1755"></span><span class="hs-comment">--</span><span>
</span><span id="line-1756"></span><span class="hs-comment">--  * W1: We do not take advantage of already-evaluated lifted variables.</span><span>
</span><span id="line-1757"></span><span class="hs-comment">--        As a result, 'exprIsHNF' DOES NOT imply 'exprOkForSpeculation';</span><span>
</span><span id="line-1758"></span><span class="hs-comment">--        if @y@ is a case-binder of lifted type, then @exprIsHNF y@ is</span><span>
</span><span id="line-1759"></span><span class="hs-comment">--        'True', while @exprOkForSpeculation y@ is 'False'.</span><span>
</span><span id="line-1760"></span><span class="hs-comment">--        See Note [exprOkForSpeculation and evaluated variables] for why.</span><span>
</span><span id="line-1761"></span><span class="hs-comment">--  * W2: Read-effects on mutable variables are currently also included.</span><span>
</span><span id="line-1762"></span><span class="hs-comment">--        See Note [Classifying primop effects] &quot;GHC.Builtin.PrimOps&quot;.</span><span>
</span><span id="line-1763"></span><span class="hs-comment">--  * W3: Currently, 'exprOkForSpeculation' always returns 'False' for</span><span>
</span><span id="line-1764"></span><span class="hs-comment">--        let-expressions.  Lets can be stacked deeply, so we just give up.</span><span>
</span><span id="line-1765"></span><span class="hs-comment">--        In any case, the argument of 'exprOkForSpeculation' is usually in</span><span>
</span><span id="line-1766"></span><span class="hs-comment">--        a strict context, so any lets will have been floated away.</span><span>
</span><span id="line-1767"></span><span class="hs-comment">--</span><span>
</span><span id="line-1768"></span><span class="hs-comment">--</span><span>
</span><span id="line-1769"></span><span class="hs-comment">-- As an example of the considerations in this test, consider:</span><span>
</span><span id="line-1770"></span><span class="hs-comment">--</span><span>
</span><span id="line-1771"></span><span class="hs-comment">-- &gt; let x = case y# +# 1# of { r# -&gt; I# r# }</span><span>
</span><span id="line-1772"></span><span class="hs-comment">-- &gt; in E</span><span>
</span><span id="line-1773"></span><span class="hs-comment">--</span><span>
</span><span id="line-1774"></span><span class="hs-comment">-- being translated to:</span><span>
</span><span id="line-1775"></span><span class="hs-comment">--</span><span>
</span><span id="line-1776"></span><span class="hs-comment">-- &gt; case y# +# 1# of { r# -&gt;</span><span>
</span><span id="line-1777"></span><span class="hs-comment">-- &gt;    let x = I# r#</span><span>
</span><span id="line-1778"></span><span class="hs-comment">-- &gt;    in E</span><span>
</span><span id="line-1779"></span><span class="hs-comment">-- &gt; }</span><span>
</span><span id="line-1780"></span><span class="hs-comment">--</span><span>
</span><span id="line-1781"></span><span class="hs-comment">-- We can only do this if the @y# +# 1#@ is ok for speculation: it has no</span><span>
</span><span id="line-1782"></span><span class="hs-comment">-- side effects, and can't diverge or raise an exception.</span><span>
</span><span id="line-1783"></span><span class="hs-comment">--</span><span>
</span><span id="line-1784"></span><span class="hs-comment">--</span><span>
</span><span id="line-1785"></span><span class="hs-comment">-- See also Note [Classifying primop effects] in &quot;GHC.Builtin.PrimOps&quot;</span><span>
</span><span id="line-1786"></span><span class="hs-comment">-- and Note [Transformations affected by primop effects].</span><span>
</span><span id="line-1787"></span><span class="hs-comment">--</span><span>
</span><span id="line-1788"></span><span class="hs-comment">-- 'exprOkForSpeculation' is used to define Core's let-can-float</span><span>
</span><span id="line-1789"></span><span class="hs-comment">-- invariant.  (See Note [Core let-can-float invariant] in</span><span>
</span><span id="line-1790"></span><span class="hs-comment">-- &quot;GHC.Core&quot;.)  It is therefore frequently called on arguments of</span><span>
</span><span id="line-1791"></span><span class="hs-comment">-- unlifted type, especially via 'needsCaseBinding'.  But it is</span><span>
</span><span id="line-1792"></span><span class="hs-comment">-- sometimes called on expressions of lifted type as well.  For</span><span>
</span><span id="line-1793"></span><span class="hs-comment">-- example, see Note [Speculative evaluation] in &quot;GHC.CoreToStg.Prep&quot;.</span><span>
</span><span id="line-1794"></span><span>
</span><span id="line-1795"></span><span>
</span><span id="line-1796"></span><span class="annot"><a href="GHC.Core.Utils.html#exprOkForSpeculation"><span class="hs-identifier hs-type">exprOkForSpeculation</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#exprOkToDiscard"><span class="hs-identifier hs-type">exprOkToDiscard</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1797"></span><span id="exprOkForSpeculation"><span class="annot"><span class="annottext">exprOkForSpeculation :: CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#exprOkForSpeculation"><span class="hs-identifier hs-var hs-var">exprOkForSpeculation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Bool) -&gt; (PrimOp -&gt; Bool) -&gt; CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#expr_ok"><span class="hs-identifier hs-var">expr_ok</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Core.Utils.html#fun_always_ok"><span class="hs-identifier hs-var">fun_always_ok</span></a></span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; Bool
</span><a href="GHC.Builtin.PrimOps.html#primOpOkForSpeculation"><span class="hs-identifier hs-var">primOpOkForSpeculation</span></a></span><span>
</span><span id="line-1798"></span><span id="exprOkToDiscard"><span class="annot"><span class="annottext">exprOkToDiscard :: CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#exprOkToDiscard"><span class="hs-identifier hs-var hs-var">exprOkToDiscard</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Bool) -&gt; (PrimOp -&gt; Bool) -&gt; CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#expr_ok"><span class="hs-identifier hs-var">expr_ok</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Core.Utils.html#fun_always_ok"><span class="hs-identifier hs-var">fun_always_ok</span></a></span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; Bool
</span><a href="GHC.Builtin.PrimOps.html#primOpOkToDiscard"><span class="hs-identifier hs-var">primOpOkToDiscard</span></a></span><span>
</span><span id="line-1799"></span><span>
</span><span id="line-1800"></span><span class="annot"><a href="GHC.Core.Utils.html#fun_always_ok"><span class="hs-identifier hs-type">fun_always_ok</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1801"></span><span id="fun_always_ok"><span class="annot"><span class="annottext">fun_always_ok :: Id -&gt; Bool
</span><a href="GHC.Core.Utils.html#fun_always_ok"><span class="hs-identifier hs-var hs-var">fun_always_ok</span></a></span></span><span> </span><span class="annot"><span class="annottext">Id
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1802"></span><span>
</span><span id="line-1803"></span><span class="hs-comment">-- | A special version of 'exprOkForSpeculation' used during</span><span>
</span><span id="line-1804"></span><span class="hs-comment">-- Note [Speculative evaluation]. When the predicate arg `fun_ok` returns False</span><span>
</span><span id="line-1805"></span><span class="hs-comment">-- for `b`, then `b` is never considered ok-for-spec.</span><span>
</span><span id="line-1806"></span><span class="annot"><a href="GHC.Core.Utils.html#exprOkForSpecEval"><span class="hs-identifier hs-type">exprOkForSpecEval</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1807"></span><span id="exprOkForSpecEval"><span class="annot"><span class="annottext">exprOkForSpecEval :: (Id -&gt; Bool) -&gt; CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#exprOkForSpecEval"><span class="hs-identifier hs-var hs-var">exprOkForSpecEval</span></a></span></span><span> </span><span id="local-6989586621682703158"><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="#local-6989586621682703158"><span class="hs-identifier hs-var">fun_ok</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Bool) -&gt; (PrimOp -&gt; Bool) -&gt; CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#expr_ok"><span class="hs-identifier hs-var">expr_ok</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="#local-6989586621682703158"><span class="hs-identifier hs-var">fun_ok</span></a></span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; Bool
</span><a href="GHC.Builtin.PrimOps.html#primOpOkForSpeculation"><span class="hs-identifier hs-var">primOpOkForSpeculation</span></a></span><span>
</span><span id="line-1808"></span><span>
</span><span id="line-1809"></span><span class="annot"><a href="GHC.Core.Utils.html#expr_ok"><span class="hs-identifier hs-type">expr_ok</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Builtin.PrimOps.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1810"></span><span id="expr_ok"><span class="annot"><span class="annottext">expr_ok :: (Id -&gt; Bool) -&gt; (PrimOp -&gt; Bool) -&gt; CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#expr_ok"><span class="hs-identifier hs-var hs-var">expr_ok</span></a></span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1811"></span><span class="annot"><a href="GHC.Core.Utils.html#expr_ok"><span class="hs-identifier hs-var">expr_ok</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1812"></span><span class="annot"><a href="GHC.Core.Utils.html#expr_ok"><span class="hs-identifier hs-var">expr_ok</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1813"></span><span>
</span><span id="line-1814"></span><span class="annot"><a href="GHC.Core.Utils.html#expr_ok"><span class="hs-identifier hs-var">expr_ok</span></a></span><span> </span><span id="local-6989586621682703159"><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="#local-6989586621682703159"><span class="hs-identifier hs-var">fun_ok</span></a></span></span><span> </span><span id="local-6989586621682703160"><span class="annot"><span class="annottext">PrimOp -&gt; Bool
</span><a href="#local-6989586621682703160"><span class="hs-identifier hs-var">primop_ok</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682703161"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703161"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Bool) -&gt; (PrimOp -&gt; Bool) -&gt; Id -&gt; [CoreExpr] -&gt; Bool
</span><a href="GHC.Core.Utils.html#app_ok"><span class="hs-identifier hs-var">app_ok</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="#local-6989586621682703159"><span class="hs-identifier hs-var">fun_ok</span></a></span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; Bool
</span><a href="#local-6989586621682703160"><span class="hs-identifier hs-var">primop_ok</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703161"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1815"></span><span class="annot"><a href="GHC.Core.Utils.html#expr_ok"><span class="hs-identifier hs-var">expr_ok</span></a></span><span> </span><span id="local-6989586621682703163"><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="#local-6989586621682703163"><span class="hs-identifier hs-var">fun_ok</span></a></span></span><span> </span><span id="local-6989586621682703164"><span class="annot"><span class="annottext">PrimOp -&gt; Bool
</span><a href="#local-6989586621682703164"><span class="hs-identifier hs-var">primop_ok</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Cast"><span class="hs-identifier hs-type">Cast</span></a></span><span> </span><span id="local-6989586621682703165"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703165"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Bool) -&gt; (PrimOp -&gt; Bool) -&gt; CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#expr_ok"><span class="hs-identifier hs-var">expr_ok</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="#local-6989586621682703163"><span class="hs-identifier hs-var">fun_ok</span></a></span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; Bool
</span><a href="#local-6989586621682703164"><span class="hs-identifier hs-var">primop_ok</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703165"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1816"></span><span class="annot"><a href="GHC.Core.Utils.html#expr_ok"><span class="hs-identifier hs-var">expr_ok</span></a></span><span> </span><span id="local-6989586621682703166"><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="#local-6989586621682703166"><span class="hs-identifier hs-var">fun_ok</span></a></span></span><span> </span><span id="local-6989586621682703167"><span class="annot"><span class="annottext">PrimOp -&gt; Bool
</span><a href="#local-6989586621682703167"><span class="hs-identifier hs-var">primop_ok</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-type">Lam</span></a></span><span> </span><span id="local-6989586621682703168"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703168"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621682703169"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703169"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1817"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703168"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Bool) -&gt; (PrimOp -&gt; Bool) -&gt; CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#expr_ok"><span class="hs-identifier hs-var">expr_ok</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="#local-6989586621682703166"><span class="hs-identifier hs-var">fun_ok</span></a></span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; Bool
</span><a href="#local-6989586621682703167"><span class="hs-identifier hs-var">primop_ok</span></a></span><span>  </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703169"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1818"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1819"></span><span>
</span><span id="line-1820"></span><span class="hs-comment">-- Tick annotations that *tick* cannot be speculated, because these</span><span>
</span><span id="line-1821"></span><span class="hs-comment">-- are meant to identify whether or not (and how often) the particular</span><span>
</span><span id="line-1822"></span><span class="hs-comment">-- source expression was evaluated at runtime.</span><span>
</span><span id="line-1823"></span><span class="annot"><a href="GHC.Core.Utils.html#expr_ok"><span class="hs-identifier hs-var">expr_ok</span></a></span><span> </span><span id="local-6989586621682703170"><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="#local-6989586621682703170"><span class="hs-identifier hs-var">fun_ok</span></a></span></span><span> </span><span id="local-6989586621682703171"><span class="annot"><span class="annottext">PrimOp -&gt; Bool
</span><a href="#local-6989586621682703171"><span class="hs-identifier hs-var">primop_ok</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-type">Tick</span></a></span><span> </span><span id="local-6989586621682703172"><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682703172"><span class="hs-identifier hs-var">tickish</span></a></span></span><span> </span><span id="local-6989586621682703173"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703173"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1824"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; Bool
forall (pass :: TickishPass). GenTickish pass -&gt; Bool
</span><a href="GHC.Types.Tickish.html#tickishCounts"><span class="hs-identifier hs-var">tickishCounts</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682703172"><span class="hs-identifier hs-var">tickish</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1825"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Bool) -&gt; (PrimOp -&gt; Bool) -&gt; CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#expr_ok"><span class="hs-identifier hs-var">expr_ok</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="#local-6989586621682703170"><span class="hs-identifier hs-var">fun_ok</span></a></span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; Bool
</span><a href="#local-6989586621682703171"><span class="hs-identifier hs-var">primop_ok</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703173"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1826"></span><span>
</span><span id="line-1827"></span><span class="annot"><a href="GHC.Core.Utils.html#expr_ok"><span class="hs-identifier hs-var">expr_ok</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1828"></span><span class="hs-comment">-- See W3 in the Haddock comment for exprOkForSpeculation</span><span>
</span><span id="line-1829"></span><span>
</span><span id="line-1830"></span><span class="annot"><a href="GHC.Core.Utils.html#expr_ok"><span class="hs-identifier hs-var">expr_ok</span></a></span><span> </span><span id="local-6989586621682703174"><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="#local-6989586621682703174"><span class="hs-identifier hs-var">fun_ok</span></a></span></span><span> </span><span id="local-6989586621682703175"><span class="annot"><span class="annottext">PrimOp -&gt; Bool
</span><a href="#local-6989586621682703175"><span class="hs-identifier hs-var">primop_ok</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Case"><span class="hs-identifier hs-type">Case</span></a></span><span> </span><span id="local-6989586621682703176"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703176"><span class="hs-identifier hs-var">scrut</span></a></span></span><span> </span><span id="local-6989586621682703177"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703177"><span class="hs-identifier hs-var">bndr</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682703178"><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682703178"><span class="hs-identifier hs-var">alts</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1831"></span><span>  </span><span class="hs-glyph">=</span><span>  </span><span class="hs-comment">-- See Note [exprOkForSpeculation: case expressions]</span><span>
</span><span id="line-1832"></span><span>     </span><span class="annot"><span class="annottext">(Id -&gt; Bool) -&gt; (PrimOp -&gt; Bool) -&gt; CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#expr_ok"><span class="hs-identifier hs-var">expr_ok</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="#local-6989586621682703174"><span class="hs-identifier hs-var">fun_ok</span></a></span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; Bool
</span><a href="#local-6989586621682703175"><span class="hs-identifier hs-var">primop_ok</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703176"><span class="hs-identifier hs-var">scrut</span></a></span><span>
</span><span id="line-1833"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Bool
Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnliftedType"><span class="hs-identifier hs-var">isUnliftedType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703177"><span class="hs-identifier hs-var">bndr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1834"></span><span>      </span><span class="hs-comment">-- OK to call isUnliftedType: binders always have a fixed RuntimeRep</span><span>
</span><span id="line-1835"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Alt Id -&gt; Bool) -&gt; [Alt Id] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682703180"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703180"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Bool) -&gt; (PrimOp -&gt; Bool) -&gt; CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#expr_ok"><span class="hs-identifier hs-var">expr_ok</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="#local-6989586621682703174"><span class="hs-identifier hs-var">fun_ok</span></a></span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; Bool
</span><a href="#local-6989586621682703175"><span class="hs-identifier hs-var">primop_ok</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703180"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682703178"><span class="hs-identifier hs-var">alts</span></a></span><span>
</span><span id="line-1836"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[Alt Id] -&gt; Bool
forall b. [Alt b] -&gt; Bool
</span><a href="GHC.Core.Utils.html#altsAreExhaustive"><span class="hs-identifier hs-var">altsAreExhaustive</span></a></span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682703178"><span class="hs-identifier hs-var">alts</span></a></span><span>
</span><span id="line-1837"></span><span>
</span><span id="line-1838"></span><span class="annot"><a href="GHC.Core.Utils.html#expr_ok"><span class="hs-identifier hs-var">expr_ok</span></a></span><span> </span><span id="local-6989586621682703181"><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="#local-6989586621682703181"><span class="hs-identifier hs-var">fun_ok</span></a></span></span><span> </span><span id="local-6989586621682703182"><span class="annot"><span class="annottext">PrimOp -&gt; Bool
</span><a href="#local-6989586621682703182"><span class="hs-identifier hs-var">primop_ok</span></a></span></span><span> </span><span id="local-6989586621682703183"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703183"><span class="hs-identifier hs-var">other_expr</span></a></span></span><span>
</span><span id="line-1839"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682703184"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703184"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682703185"><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682703185"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; (CoreExpr, [CoreExpr])
forall b. Expr b -&gt; (Expr b, [Expr b])
</span><a href="GHC.Core.html#collectArgs"><span class="hs-identifier hs-var">collectArgs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703183"><span class="hs-identifier hs-var">other_expr</span></a></span><span>
</span><span id="line-1840"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(CoreTickish -&gt; Bool) -&gt; CoreExpr -&gt; CoreExpr
forall b. (CoreTickish -&gt; Bool) -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.Utils.html#stripTicksTopE"><span class="hs-identifier hs-var">stripTicksTopE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (CoreTickish -&gt; Bool) -&gt; CoreTickish -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; Bool
forall (pass :: TickishPass). GenTickish pass -&gt; Bool
</span><a href="GHC.Types.Tickish.html#tickishCounts"><span class="hs-identifier hs-var">tickishCounts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703184"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1841"></span><span>        </span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682703186"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703186"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1842"></span><span>           </span><span class="annot"><span class="annottext">(Id -&gt; Bool) -&gt; (PrimOp -&gt; Bool) -&gt; Id -&gt; [CoreExpr] -&gt; Bool
</span><a href="GHC.Core.Utils.html#app_ok"><span class="hs-identifier hs-var">app_ok</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="#local-6989586621682703181"><span class="hs-identifier hs-var">fun_ok</span></a></span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; Bool
</span><a href="#local-6989586621682703182"><span class="hs-identifier hs-var">primop_ok</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703186"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682703185"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1843"></span><span>
</span><span id="line-1844"></span><span>        </span><span class="hs-comment">-- 'LitRubbish' is the only literal that can occur in the head of an</span><span>
</span><span id="line-1845"></span><span>        </span><span class="hs-comment">-- application and will not be matched by the above case (Var /= Lit).</span><span>
</span><span id="line-1846"></span><span>        </span><span class="hs-comment">-- See Note [How a rubbish literal can be the head of an application]</span><span>
</span><span id="line-1847"></span><span>        </span><span class="hs-comment">-- in GHC.Types.Literal</span><span>
</span><span id="line-1848"></span><span>        </span><span class="annot"><a href="GHC.Core.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span id="local-6989586621682703187"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682703187"><span class="hs-identifier hs-var">lit</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Utils.Constants.html#debugIsOn"><span class="hs-identifier hs-var">debugIsOn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Literal -&gt; Bool
</span><a href="GHC.Types.Literal.html#isLitRubbish"><span class="hs-identifier hs-var">isLitRubbish</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682703187"><span class="hs-identifier hs-var">lit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1849"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; Bool
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Non-rubbish lit in app head&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Literal -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682703187"><span class="hs-identifier hs-var">lit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1850"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1851"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1852"></span><span>
</span><span id="line-1853"></span><span>        </span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1854"></span><span>
</span><span id="line-1855"></span><span class="hs-comment">-----------------------------</span><span>
</span><span id="line-1856"></span><span class="annot"><a href="GHC.Core.Utils.html#app_ok"><span class="hs-identifier hs-type">app_ok</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Builtin.PrimOps.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1857"></span><span id="app_ok"><span class="annot"><span class="annottext">app_ok :: (Id -&gt; Bool) -&gt; (PrimOp -&gt; Bool) -&gt; Id -&gt; [CoreExpr] -&gt; Bool
</span><a href="GHC.Core.Utils.html#app_ok"><span class="hs-identifier hs-var hs-var">app_ok</span></a></span></span><span> </span><span id="local-6989586621682703189"><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="#local-6989586621682703189"><span class="hs-identifier hs-var">fun_ok</span></a></span></span><span> </span><span id="local-6989586621682703190"><span class="annot"><span class="annottext">PrimOp -&gt; Bool
</span><a href="#local-6989586621682703190"><span class="hs-identifier hs-var">primop_ok</span></a></span></span><span> </span><span id="local-6989586621682703191"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703191"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621682703192"><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682703192"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-1858"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="#local-6989586621682703189"><span class="hs-identifier hs-var">fun_ok</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703191"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1859"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- This code path is only taken for Note [Speculative evaluation]</span><span>
</span><span id="line-1860"></span><span>
</span><span id="line-1861"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Int
</span><a href="GHC.Types.Id.html#idArity"><span class="hs-identifier hs-var">idArity</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703191"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703194"><span class="hs-identifier hs-var">n_val_args</span></a></span><span>
</span><span id="line-1862"></span><span>  </span><span class="hs-comment">-- Partial application: just check passing the arguments is OK</span><span>
</span><span id="line-1863"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682703195"><span class="hs-identifier hs-var">args_ok</span></a></span><span>
</span><span id="line-1864"></span><span>
</span><span id="line-1865"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1866"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Id -&gt; IdDetails
</span><a href="GHC.Types.Var.html#idDetails"><span class="hs-identifier hs-var">idDetails</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703191"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1867"></span><span>      </span><span class="annot"><a href="GHC.Types.Id.Info.html#DFunId"><span class="hs-identifier hs-type">DFunId</span></a></span><span> </span><span id="local-6989586621682703197"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682703197"><span class="hs-identifier hs-var">new_type</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682703197"><span class="hs-identifier hs-var">new_type</span></a></span><span>
</span><span id="line-1868"></span><span>         </span><span class="hs-comment">-- DFuns terminate, unless the dict is implemented</span><span>
</span><span id="line-1869"></span><span>         </span><span class="hs-comment">-- with a newtype in which case they may not</span><span>
</span><span id="line-1870"></span><span>
</span><span id="line-1871"></span><span>      </span><span class="annot"><a href="GHC.Types.Id.Info.html#DataConWorkId"><span class="hs-identifier hs-type">DataConWorkId</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682703195"><span class="hs-identifier hs-var">args_ok</span></a></span><span>
</span><span id="line-1872"></span><span>                </span><span class="hs-comment">-- The strictness of the constructor has already</span><span>
</span><span id="line-1873"></span><span>                </span><span class="hs-comment">-- been expressed by its &quot;wrapper&quot;, so we don't need</span><span>
</span><span id="line-1874"></span><span>                </span><span class="hs-comment">-- to take the arguments into account</span><span>
</span><span id="line-1875"></span><span>                   </span><span class="hs-comment">-- Well, we thought so.  But it's definitely wrong!</span><span>
</span><span id="line-1876"></span><span>                   </span><span class="hs-comment">-- See #20749 and Note [How untagged pointers can</span><span>
</span><span id="line-1877"></span><span>                   </span><span class="hs-comment">-- end up in strict fields] in GHC.Stg.InferTags</span><span>
</span><span id="line-1878"></span><span>
</span><span id="line-1879"></span><span>      </span><span class="annot"><a href="GHC.Types.Id.Info.html#ClassOpId"><span class="hs-identifier hs-type">ClassOpId</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682703198"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682703198"><span class="hs-identifier hs-var">is_terminating_result</span></a></span></span><span>
</span><span id="line-1880"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682703198"><span class="hs-identifier hs-var">is_terminating_result</span></a></span><span> </span><span class="hs-comment">-- See Note [exprOkForSpeculation and type classes]</span><span>
</span><span id="line-1881"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; Bool -&gt; Bool
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703194"><span class="hs-identifier hs-var">n_val_args</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703191"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682703192"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1882"></span><span>           </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1883"></span><span>           </span><span class="hs-comment">-- assert: terminating result type =&gt; can't be applied;</span><span>
</span><span id="line-1884"></span><span>           </span><span class="hs-comment">-- c.f the _other case below</span><span>
</span><span id="line-1885"></span><span>
</span><span id="line-1886"></span><span>      </span><span class="annot"><a href="GHC.Types.Id.Info.html#PrimOpId"><span class="hs-identifier hs-type">PrimOpId</span></a></span><span> </span><span id="local-6989586621682703199"><span class="annot"><span class="annottext">PrimOp
</span><a href="#local-6989586621682703199"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="annot"><span class="annottext">ConcreteTyVars
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1887"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; Bool
</span><a href="GHC.Builtin.PrimOps.html#primOpIsDiv"><span class="hs-identifier hs-var">primOpIsDiv</span></a></span><span> </span><span class="annot"><span class="annottext">PrimOp
</span><a href="#local-6989586621682703199"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-1888"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span id="local-6989586621682703201"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682703201"><span class="hs-identifier hs-var">divisor</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CoreExpr] -&gt; CoreExpr
forall a. HasCallStack =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">last</span></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682703192"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1889"></span><span>            </span><span class="hs-comment">-- there can be 2 args (most div primops) or 3 args</span><span>
</span><span id="line-1890"></span><span>            </span><span class="hs-comment">-- (WordQuotRem2Op), hence the use of last/init</span><span>
</span><span id="line-1891"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Literal -&gt; Bool
</span><a href="GHC.Types.Literal.html#isZeroLit"><span class="hs-identifier hs-var">isZeroLit</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682703201"><span class="hs-identifier hs-var">divisor</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; Bool) -&gt; [CoreExpr] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Id -&gt; Bool) -&gt; (PrimOp -&gt; Bool) -&gt; CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#expr_ok"><span class="hs-identifier hs-var">expr_ok</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="#local-6989586621682703189"><span class="hs-identifier hs-var">fun_ok</span></a></span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; Bool
</span><a href="#local-6989586621682703190"><span class="hs-identifier hs-var">primop_ok</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoreExpr] -&gt; [CoreExpr]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">init</span></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682703192"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1892"></span><span>              </span><span class="hs-comment">-- Special case for dividing operations that fail</span><span>
</span><span id="line-1893"></span><span>              </span><span class="hs-comment">-- In general they are NOT ok-for-speculation</span><span>
</span><span id="line-1894"></span><span>              </span><span class="hs-comment">-- (which primop_ok will catch), but they ARE OK</span><span>
</span><span id="line-1895"></span><span>              </span><span class="hs-comment">-- if the divisor is definitely non-zero.</span><span>
</span><span id="line-1896"></span><span>              </span><span class="hs-comment">-- Often there is a literal divisor, and this</span><span>
</span><span id="line-1897"></span><span>              </span><span class="hs-comment">-- can get rid of a thunk in an inner loop</span><span>
</span><span id="line-1898"></span><span>
</span><span id="line-1899"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; Bool
</span><a href="#local-6989586621682703190"><span class="hs-identifier hs-var">primop_ok</span></a></span><span> </span><span class="annot"><span class="annottext">PrimOp
</span><a href="#local-6989586621682703199"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682703195"><span class="hs-identifier hs-var">args_ok</span></a></span><span>
</span><span id="line-1900"></span><span>
</span><span id="line-1901"></span><span>      </span><span id="local-6989586621682703205"><span class="annot"><span class="annottext">IdDetails
</span><a href="#local-6989586621682703205"><span class="hs-identifier hs-var">_other</span></a></span></span><span>  </span><span class="hs-comment">-- Unlifted and terminating types;</span><span>
</span><span id="line-1902"></span><span>              </span><span class="hs-comment">-- Also c.f. the Var case of exprIsHNF</span><span>
</span><span id="line-1903"></span><span>         </span><span class="hs-glyph">|</span><span>  </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Bool
Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isTerminatingType"><span class="hs-identifier hs-var">isTerminatingType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703207"><span class="hs-identifier hs-var">fun_ty</span></a></span><span>  </span><span class="hs-comment">-- See Note [exprOkForSpeculation and type classes]</span><span>
</span><span id="line-1904"></span><span>         </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#definitelyUnliftedType"><span class="hs-identifier hs-var">definitelyUnliftedType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703207"><span class="hs-identifier hs-var">fun_ty</span></a></span><span>
</span><span id="line-1905"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; Bool -&gt; Bool
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703194"><span class="hs-identifier hs-var">n_val_args</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703191"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682703192"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1906"></span><span>            </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="hs-comment">-- Both terminating types (e.g. Eq a), and unlifted types (e.g. Int#)</span><span>
</span><span id="line-1907"></span><span>                  </span><span class="hs-comment">-- are non-functions and so will have no value args.  The assert is</span><span>
</span><span id="line-1908"></span><span>                  </span><span class="hs-comment">-- just to check this.</span><span>
</span><span id="line-1909"></span><span>                  </span><span class="hs-comment">-- (If we added unlifted function types this would change,</span><span>
</span><span id="line-1910"></span><span>                  </span><span class="hs-comment">-- and we'd need to actually test n_val_args == 0.)</span><span>
</span><span id="line-1911"></span><span>
</span><span id="line-1912"></span><span>         </span><span class="hs-comment">-- Functions that terminate fast without raising exceptions etc</span><span>
</span><span id="line-1913"></span><span>         </span><span class="hs-comment">-- See (U12) of Note [Implementing unsafeCoerce]</span><span>
</span><span id="line-1914"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703191"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#unsafeEqualityProofIdKey"><span class="hs-identifier hs-var">unsafeEqualityProofIdKey</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1915"></span><span>
</span><span id="line-1916"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1917"></span><span>             </span><span class="hs-comment">-- NB: even in the nullary case, do /not/ check</span><span>
</span><span id="line-1918"></span><span>             </span><span class="hs-comment">--     for evaluated-ness of the fun;</span><span>
</span><span id="line-1919"></span><span>             </span><span class="hs-comment">--     see Note [exprOkForSpeculation and evaluated variables]</span><span>
</span><span id="line-1920"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1921"></span><span>    </span><span id="local-6989586621682703207"><span class="annot"><span class="annottext">fun_ty :: Type
</span><a href="#local-6989586621682703207"><span class="hs-identifier hs-var hs-var">fun_ty</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703191"><span class="hs-identifier hs-var">fun</span></a></span><span>
</span><span id="line-1922"></span><span>    </span><span id="local-6989586621682703194"><span class="annot"><span class="annottext">n_val_args :: Int
</span><a href="#local-6989586621682703194"><span class="hs-identifier hs-var hs-var">n_val_args</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreExpr] -&gt; Int
forall b. [Arg b] -&gt; Int
</span><a href="GHC.Core.html#valArgCount"><span class="hs-identifier hs-var">valArgCount</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682703192"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1923"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682703210"><span class="annot"><span class="annottext">[PiTyBinder]
</span><a href="#local-6989586621682703210"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([PiTyBinder], Type)
</span><a href="GHC.Core.Type.html#splitPiTys"><span class="hs-identifier hs-var">splitPiTys</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703207"><span class="hs-identifier hs-var">fun_ty</span></a></span><span>
</span><span id="line-1924"></span><span>
</span><span id="line-1925"></span><span>    </span><span class="hs-comment">-- Even if a function call itself is OK, any unlifted</span><span>
</span><span id="line-1926"></span><span>    </span><span class="hs-comment">-- args are still evaluated eagerly and must be checked</span><span>
</span><span id="line-1927"></span><span>    </span><span id="local-6989586621682703195"><span class="annot"><span class="annottext">args_ok :: Bool
</span><a href="#local-6989586621682703195"><span class="hs-identifier hs-var hs-var">args_ok</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Bool] -&gt; Bool
forall (t :: * -&gt; *). Foldable t =&gt; t Bool -&gt; Bool
</span><span class="hs-identifier hs-var">and</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PiTyBinder -&gt; CoreExpr -&gt; Bool)
-&gt; [PiTyBinder] -&gt; [CoreExpr] -&gt; [Bool]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">PiTyBinder -&gt; CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703213"><span class="hs-identifier hs-var">arg_ok</span></a></span><span> </span><span class="annot"><span class="annottext">[PiTyBinder]
</span><a href="#local-6989586621682703210"><span class="hs-identifier hs-var">arg_tys</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682703192"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1928"></span><span>    </span><span class="annot"><a href="#local-6989586621682703213"><span class="hs-identifier hs-type">arg_ok</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#PiTyVarBinder"><span class="hs-identifier hs-type">PiTyVarBinder</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1929"></span><span>    </span><span id="local-6989586621682703213"><span class="annot"><span class="annottext">arg_ok :: PiTyBinder -&gt; CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703213"><span class="hs-identifier hs-var hs-var">arg_ok</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Named"><span class="hs-identifier hs-type">Named</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyBinder
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>   </span><span class="hs-comment">-- A type argument</span><span>
</span><span id="line-1930"></span><span>    </span><span class="annot"><a href="#local-6989586621682703213"><span class="hs-identifier hs-var">arg_ok</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Anon"><span class="hs-identifier hs-type">Anon</span></a></span><span> </span><span id="local-6989586621682703215"><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621682703215"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682703216"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703216"><span class="hs-identifier hs-var">arg</span></a></span></span><span>      </span><span class="hs-comment">-- A term argument</span><span>
</span><span id="line-1931"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#definitelyLiftedType"><span class="hs-identifier hs-var">definitelyLiftedType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled Type -&gt; Type
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621682703215"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1932"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-comment">-- lifted args are not evaluated eagerly</span><span>
</span><span id="line-1933"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1934"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Bool) -&gt; (PrimOp -&gt; Bool) -&gt; CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#expr_ok"><span class="hs-identifier hs-var">expr_ok</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="#local-6989586621682703189"><span class="hs-identifier hs-var">fun_ok</span></a></span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; Bool
</span><a href="#local-6989586621682703190"><span class="hs-identifier hs-var">primop_ok</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703216"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-1935"></span><span>
</span><span id="line-1936"></span><span class="hs-comment">-----------------------------</span><span>
</span><span id="line-1937"></span><span id="local-6989586621682701997"><span class="annot"><a href="GHC.Core.Utils.html#altsAreExhaustive"><span class="hs-identifier hs-type">altsAreExhaustive</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682701997"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-1938"></span><span class="hs-comment">-- True  &lt;=&gt; the case alternatives are definitely exhaustive</span><span>
</span><span id="line-1939"></span><span class="hs-comment">-- False &lt;=&gt; they may or may not be</span><span>
</span><span id="line-1940"></span><span id="altsAreExhaustive"><span class="annot"><span class="annottext">altsAreExhaustive :: forall b. [Alt b] -&gt; Bool
</span><a href="GHC.Core.Utils.html#altsAreExhaustive"><span class="hs-identifier hs-var hs-var">altsAreExhaustive</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1941"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>    </span><span class="hs-comment">-- The scrutinee never returns; see Note [Empty case alternatives] in GHC.Core</span><span>
</span><span id="line-1942"></span><span class="annot"><a href="GHC.Core.Utils.html#altsAreExhaustive"><span class="hs-identifier hs-var">altsAreExhaustive</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span id="local-6989586621682703221"><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621682703221"><span class="hs-identifier hs-var">con1</span></a></span></span><span> </span><span class="annot"><span class="annottext">[b]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682703222"><span class="annot"><span class="annottext">[Alt b]
</span><a href="#local-6989586621682703222"><span class="hs-identifier hs-var">alts</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1943"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621682703221"><span class="hs-identifier hs-var">con1</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1944"></span><span>      </span><span class="annot"><span class="annottext">AltCon
</span><a href="GHC.Core.html#DEFAULT"><span class="hs-identifier hs-var">DEFAULT</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1945"></span><span>      </span><span class="annot"><a href="GHC.Core.html#LitAlt"><span class="hs-identifier hs-type">LitAlt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1946"></span><span>      </span><span class="annot"><a href="GHC.Core.html#DataAlt"><span class="hs-identifier hs-type">DataAlt</span></a></span><span> </span><span id="local-6989586621682703223"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682703223"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Alt b]
</span><a href="#local-6989586621682703222"><span class="hs-identifier hs-var">alts</span></a></span><span> </span><span class="annot"><span class="annottext">[Alt b] -&gt; Int -&gt; Bool
forall a. [a] -&gt; Int -&gt; Bool
</span><a href="GHC.Utils.Misc.html#lengthIs"><span class="hs-operator hs-var">`lengthIs`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Int
</span><a href="GHC.Core.TyCon.html#tyConFamilySize"><span class="hs-identifier hs-var">tyConFamilySize</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; TyCon
</span><a href="GHC.Core.DataCon.html#dataConTyCon"><span class="hs-identifier hs-var">dataConTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682703223"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-1947"></span><span>      </span><span class="hs-comment">-- It is possible to have an exhaustive case that does not</span><span>
</span><span id="line-1948"></span><span>      </span><span class="hs-comment">-- enumerate all constructors, notably in a GADT match, but</span><span>
</span><span id="line-1949"></span><span>      </span><span class="hs-comment">-- we behave conservatively here -- I don't think it's important</span><span>
</span><span id="line-1950"></span><span>      </span><span class="hs-comment">-- enough to deserve special treatment</span><span>
</span><span id="line-1951"></span><span>
</span><span id="line-1952"></span><span class="hs-comment">-- | Should we look past this tick when eta-expanding the given function?</span><span>
</span><span id="line-1953"></span><span class="hs-comment">--</span><span>
</span><span id="line-1954"></span><span class="hs-comment">-- See Note [Ticks and mandatory eta expansion]</span><span>
</span><span id="line-1955"></span><span class="hs-comment">-- Takes the function we are applying as argument.</span><span>
</span><span id="line-1956"></span><span id="local-6989586621682702007"><span class="annot"><a href="GHC.Core.Utils.html#etaExpansionTick"><span class="hs-identifier hs-type">etaExpansionTick</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Tickish.html#GenTickish"><span class="hs-identifier hs-type">GenTickish</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682702007"><span class="hs-identifier hs-type">pass</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-1957"></span><span id="etaExpansionTick"><span class="annot"><span class="annottext">etaExpansionTick :: forall (pass :: TickishPass). Id -&gt; GenTickish pass -&gt; Bool
</span><a href="GHC.Core.Utils.html#etaExpansionTick"><span class="hs-identifier hs-var hs-var">etaExpansionTick</span></a></span></span><span> </span><span id="local-6989586621682703227"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703227"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span id="local-6989586621682703228"><span class="annot"><span class="annottext">GenTickish pass
</span><a href="#local-6989586621682703228"><span class="hs-identifier hs-var">t</span></a></span></span><span>
</span><span id="line-1958"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Id.html#hasNoBinding"><span class="hs-identifier hs-var">hasNoBinding</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703227"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-1959"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">GenTickish pass -&gt; Bool
forall (pass :: TickishPass). GenTickish pass -&gt; Bool
</span><a href="GHC.Types.Tickish.html#tickishFloatable"><span class="hs-identifier hs-var">tickishFloatable</span></a></span><span> </span><span class="annot"><span class="annottext">GenTickish pass
</span><a href="#local-6989586621682703228"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">GenTickish pass -&gt; Bool
forall (pass :: TickishPass). GenTickish pass -&gt; Bool
</span><a href="GHC.Types.Tickish.html#isProfTick"><span class="hs-identifier hs-var">isProfTick</span></a></span><span> </span><span class="annot"><span class="annottext">GenTickish pass
</span><a href="#local-6989586621682703228"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1960"></span><span>
</span><span id="line-1961"></span><span class="hs-comment">{- Note [exprOkForSpeculation and type classes]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider (#22745, #15205)

  \(d :: C a b). case eq_sel (sc_sel d) of
                   (co :: t1 ~# t2) [Dead] -&gt;  blah

We know that
* eq_sel's argument (sc_sel d) has dictionary type, so it definitely terminates
  (again Note [NON-BOTTOM-DICTS invariant] in GHC.Core)
* eq_sel is simply a superclass selector, and hence is fast
* The field that eq_sel picks is of unlifted type, and hence can't be bottom
  (remember the dictionary argument itself is non-bottom)

So we can treat (eq_sel (sc_sel d)) as ok-for-speculation.  We must check

a) That the function is a class-op, with IdDetails of ClassOpId

b) That the result type of the class-op is terminating or unlifted.  E.g. for
     class C a =&gt; D a where ...
     class C a where { op :: a -&gt; a }
   Since C is represented by a newtype, (sc_sel (d :: D a)) might
   not be terminating.

Rather than repeatedly test if the result of the class-op is a
terminating/unlifted type, we cache it as a field of ClassOpId. See
GHC.Types.Id.Make.mkDictSelId for where this field is initialised.

Note [exprOkForSpeculation: case expressions]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
exprOkForSpeculation accepts very special case expressions.
Reason: (a ==# b) is ok-for-speculation, but the litEq rules
in GHC.Core.Opt.ConstantFold convert it (a ==# 3#) to
   case a of { DEFAULT -&gt; 0#; 3# -&gt; 1# }
for excellent reasons described in
  GHC.Core.Opt.ConstantFold Note [The litEq rule: converting equality to case].
So, annoyingly, we want that case expression to be
ok-for-speculation too. Bother.

But we restrict it sharply:

* We restrict it to unlifted scrutinees. Consider this:
     case x of y {
       DEFAULT -&gt; ... (let v::Int# = case y of { True  -&gt; e1
                                               ; False -&gt; e2 }
                       in ...) ...

  Does the RHS of v satisfy the let-can-float invariant?  Previously we said
  yes, on the grounds that y is evaluated.  But the binder-swap done
  by GHC.Core.Opt.SetLevels would transform the inner alternative to
     DEFAULT -&gt; ... (let v::Int# = case x of { ... }
                     in ...) ....
  which does /not/ satisfy the let-can-float invariant, because x is
  not evaluated. See Note [Binder-swap during float-out]
  in GHC.Core.Opt.SetLevels.  To avoid this awkwardness it seems simpler
  to stick to unlifted scrutinees where the issue does not
  arise.

* We restrict it to exhaustive alternatives. A non-exhaustive
  case manifestly isn't ok-for-speculation. for example,
  this is a valid program (albeit a slightly dodgy one)
    let v = case x of { B -&gt; ...; C -&gt; ... }
    in case x of
         A -&gt; ...
         _ -&gt;  ...v...v....
  Should v be considered ok-for-speculation?  Its scrutinee may be
  evaluated, but the alternatives are incomplete so we should not
  evaluate it strictly.

  Now, all this is for lifted types, but it'd be the same for any
  finite unlifted type. We don't have many of them, but we might
  add unlifted algebraic types in due course.


----- Historical note: #15696: --------
  Previously GHC.Core.Opt.SetLevels used exprOkForSpeculation to guide
  floating of single-alternative cases; it now uses exprIsHNF
  Note [Floating single-alternative cases].

  But in those days, consider
    case e of x { DEAFULT -&gt;
      ...(case x of y
            A -&gt; ...
            _ -&gt; ...(case (case x of { B -&gt; p; C -&gt; p }) of
                       I# r -&gt; blah)...
  If GHC.Core.Opt.SetLevels considers the inner nested case as
  ok-for-speculation it can do case-floating (in GHC.Core.Opt.SetLevels).
  So we'd float to:
    case e of x { DEAFULT -&gt;
    case (case x of { B -&gt; p; C -&gt; p }) of I# r -&gt;
    ...(case x of y
            A -&gt; ...
            _ -&gt; ...blah...)...
  which is utterly bogus (seg fault); see #5453.

----- Historical note: #3717: --------
    foo :: Int -&gt; Int
    foo 0 = 0
    foo n = (if n &lt; 5 then 1 else 2) `seq` foo (n-1)

In earlier GHCs, we got this:
    T.$wfoo =
      \ (ww :: GHC.Prim.Int#) -&gt;
        case ww of ds {
          __DEFAULT -&gt; case (case &lt;# ds 5 of _ {
                          GHC.Types.False -&gt; lvl1;
                          GHC.Types.True -&gt; lvl})
                       of _ { __DEFAULT -&gt;
                       T.$wfoo (GHC.Prim.-# ds_XkE 1) };
          0 -&gt; 0 }

Before join-points etc we could only get rid of two cases (which are
redundant) by recognising that the (case &lt;# ds 5 of { ... }) is
ok-for-speculation, even though it has /lifted/ type.  But now join
points do the job nicely.
------- End of historical note ------------


Note [exprOkForSpeculation and evaluated variables]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider these examples:
 * case x of y { DEFAULT -&gt; ....y.... }
   Should 'y' (alone) be considered ok-for-speculation?

 * case x of y { DEFAULT -&gt; ....let z = dataToTagLarge# y... }
   Should (dataToTagLarge# y) be considered ok-for-spec? Recall that
     dataToTagLarge# :: forall a. a -&gt; Int#
   must always evaluate its argument. (See also Note [DataToTag overview].)

You could argue 'yes', because in the case alternative we know that
'y' is evaluated.  But the binder-swap transformation, which is
extremely useful for float-out, changes these expressions to
   case x of y { DEFAULT -&gt; ....x.... }
   case x of y { DEFAULT -&gt; ....let z = dataToTagLarge# x... }

And now the expression does not obey the let-can-float invariant!  Yikes!
Moreover we really might float (dataToTagLarge# x) outside the case,
and then it really, really doesn't obey the let-can-float invariant.

The solution is simple: exprOkForSpeculation does not try to take
advantage of the evaluated-ness of (lifted) variables.  And it returns
False (always) for primops that perform evaluation.  We achieve the latter
by marking the relevant primops as &quot;ThrowsException&quot; or
&quot;ReadWriteEffect&quot;; see also Note [Classifying primop effects] in
GHC.Builtin.PrimOps.

Note that exprIsHNF /can/ and does take advantage of evaluated-ness;
it doesn't have the trickiness of the let-can-float invariant to worry about.

************************************************************************
*                                                                      *
             exprIsHNF, exprIsConLike
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-2116"></span><span>
</span><span id="line-2117"></span><span class="hs-comment">-- Note [exprIsHNF]             See also Note [exprIsCheap and exprIsHNF]</span><span>
</span><span id="line-2118"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-2119"></span><span class="hs-comment">-- | exprIsHNF returns true for expressions that are certainly /already/</span><span>
</span><span id="line-2120"></span><span class="hs-comment">-- evaluated to /head/ normal form.  This is used to decide whether it's ok</span><span>
</span><span id="line-2121"></span><span class="hs-comment">-- to perform case-to-let for lifted expressions, which changes:</span><span>
</span><span id="line-2122"></span><span class="hs-comment">--</span><span>
</span><span id="line-2123"></span><span class="hs-comment">-- &gt; case x of x' { _ -&gt; e }</span><span>
</span><span id="line-2124"></span><span class="hs-comment">--</span><span>
</span><span id="line-2125"></span><span class="hs-comment">--    into:</span><span>
</span><span id="line-2126"></span><span class="hs-comment">--</span><span>
</span><span id="line-2127"></span><span class="hs-comment">-- &gt; let x' = x in e</span><span>
</span><span id="line-2128"></span><span class="hs-comment">--</span><span>
</span><span id="line-2129"></span><span class="hs-comment">-- and in so doing makes the binding lazy.</span><span>
</span><span id="line-2130"></span><span class="hs-comment">--</span><span>
</span><span id="line-2131"></span><span class="hs-comment">-- So, it does /not/ treat variables as evaluated, unless they say they are.</span><span>
</span><span id="line-2132"></span><span class="hs-comment">-- However, it /does/ treat partial applications and constructor applications</span><span>
</span><span id="line-2133"></span><span class="hs-comment">-- as values, even if their arguments are non-trivial, provided the argument</span><span>
</span><span id="line-2134"></span><span class="hs-comment">-- type is lifted. For example, both of these are values:</span><span>
</span><span id="line-2135"></span><span class="hs-comment">--</span><span>
</span><span id="line-2136"></span><span class="hs-comment">-- &gt; (:) (f x) (map f xs)</span><span>
</span><span id="line-2137"></span><span class="hs-comment">-- &gt; map (...redex...)</span><span>
</span><span id="line-2138"></span><span class="hs-comment">--</span><span>
</span><span id="line-2139"></span><span class="hs-comment">-- because 'seq' on such things completes immediately.</span><span>
</span><span id="line-2140"></span><span class="hs-comment">--</span><span>
</span><span id="line-2141"></span><span class="hs-comment">-- For unlifted argument types, we have to be careful:</span><span>
</span><span id="line-2142"></span><span class="hs-comment">--</span><span>
</span><span id="line-2143"></span><span class="hs-comment">-- &gt; C (f x :: Int#)</span><span>
</span><span id="line-2144"></span><span class="hs-comment">--</span><span>
</span><span id="line-2145"></span><span class="hs-comment">-- Suppose @f x@ diverges; then @C (f x)@ is not a value.</span><span>
</span><span id="line-2146"></span><span class="hs-comment">-- We check for this using needsCaseBinding below</span><span>
</span><span id="line-2147"></span><span class="annot"><a href="GHC.Core.Utils.html#exprIsHNF"><span class="hs-identifier hs-type">exprIsHNF</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>           </span><span class="hs-comment">-- True =&gt; Value-lambda, constructor, PAP</span><span>
</span><span id="line-2148"></span><span id="exprIsHNF"><span class="annot"><span class="annottext">exprIsHNF :: CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#exprIsHNF"><span class="hs-identifier hs-var hs-var">exprIsHNF</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt;
(Id -&gt; Bool) -&gt; (Unfolding -&gt; Bool) -&gt; CoreExpr -&gt; Bool
(Id -&gt; Bool) -&gt; (Unfolding -&gt; Bool) -&gt; CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#exprIsHNFlike"><span class="hs-identifier hs-var">exprIsHNFlike</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Id.html#isDataConWorkId"><span class="hs-identifier hs-var">isDataConWorkId</span></a></span><span> </span><span class="annot"><span class="annottext">Unfolding -&gt; Bool
</span><a href="GHC.Core.html#isEvaldUnfolding"><span class="hs-identifier hs-var">isEvaldUnfolding</span></a></span><span>
</span><span id="line-2149"></span><span>
</span><span id="line-2150"></span><span class="hs-comment">-- | Similar to 'exprIsHNF' but includes CONLIKE functions as well as</span><span>
</span><span id="line-2151"></span><span class="hs-comment">-- data constructors. Conlike arguments are considered interesting by the</span><span>
</span><span id="line-2152"></span><span class="hs-comment">-- inliner.</span><span>
</span><span id="line-2153"></span><span class="annot"><a href="GHC.Core.Utils.html#exprIsConLike"><span class="hs-identifier hs-type">exprIsConLike</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>       </span><span class="hs-comment">-- True =&gt; lambda, conlike, PAP</span><span>
</span><span id="line-2154"></span><span id="exprIsConLike"><span class="annot"><span class="annottext">exprIsConLike :: CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#exprIsConLike"><span class="hs-identifier hs-var hs-var">exprIsConLike</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt;
(Id -&gt; Bool) -&gt; (Unfolding -&gt; Bool) -&gt; CoreExpr -&gt; Bool
(Id -&gt; Bool) -&gt; (Unfolding -&gt; Bool) -&gt; CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#exprIsHNFlike"><span class="hs-identifier hs-var">exprIsHNFlike</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Id.html#isConLikeId"><span class="hs-identifier hs-var">isConLikeId</span></a></span><span> </span><span class="annot"><span class="annottext">Unfolding -&gt; Bool
</span><a href="GHC.Core.html#isConLikeUnfolding"><span class="hs-identifier hs-var">isConLikeUnfolding</span></a></span><span>
</span><span id="line-2155"></span><span>
</span><span id="line-2156"></span><span class="hs-comment">-- | Returns true for values or value-like expressions. These are lambdas,</span><span>
</span><span id="line-2157"></span><span class="hs-comment">-- constructors / CONLIKE functions (as determined by the function argument)</span><span>
</span><span id="line-2158"></span><span class="hs-comment">-- or PAPs.</span><span>
</span><span id="line-2159"></span><span class="hs-comment">--</span><span>
</span><span id="line-2160"></span><span class="annot"><a href="GHC.Core.Utils.html#exprIsHNFlike"><span class="hs-identifier hs-type">exprIsHNFlike</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Unfolding"><span class="hs-identifier hs-type">Unfolding</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2161"></span><span id="exprIsHNFlike"><span class="annot"><span class="annottext">exprIsHNFlike :: HasDebugCallStack =&gt;
(Id -&gt; Bool) -&gt; (Unfolding -&gt; Bool) -&gt; CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#exprIsHNFlike"><span class="hs-identifier hs-var hs-var">exprIsHNFlike</span></a></span></span><span> </span><span id="local-6989586621682703242"><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="#local-6989586621682703242"><span class="hs-identifier hs-var">is_con</span></a></span></span><span> </span><span id="local-6989586621682703243"><span class="annot"><span class="annottext">Unfolding -&gt; Bool
</span><a href="#local-6989586621682703243"><span class="hs-identifier hs-var">is_con_unf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703244"><span class="hs-identifier hs-var">is_hnf_like</span></a></span><span>
</span><span id="line-2162"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2163"></span><span>    </span><span id="local-6989586621682703244"><span class="annot"><span class="annottext">is_hnf_like :: CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703244"><span class="hs-identifier hs-var hs-var">is_hnf_like</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682703245"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703245"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- NB: There are no value args at this point</span><span>
</span><span id="line-2164"></span><span>      </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">CheapAppFun
</span><a href="#local-6989586621682703246"><span class="hs-identifier hs-var">id_app_is_value</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703245"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-comment">-- Catches nullary constructors,</span><span>
</span><span id="line-2165"></span><span>                             </span><span class="hs-comment">--      so that [] and () are values, for example</span><span>
</span><span id="line-2166"></span><span>                             </span><span class="hs-comment">-- and (e.g.) primops that don't have unfoldings</span><span>
</span><span id="line-2167"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Unfolding -&gt; Bool
</span><a href="#local-6989586621682703243"><span class="hs-identifier hs-var">is_con_unf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IdUnfoldingFun
</span><a href="GHC.Types.Id.html#idUnfolding"><span class="hs-identifier hs-var">idUnfolding</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703245"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2168"></span><span>        </span><span class="hs-comment">-- Check the thing's unfolding; it might be bound to a value</span><span>
</span><span id="line-2169"></span><span>        </span><span class="hs-comment">--   or to a guaranteed-evaluated variable (isEvaldUnfolding)</span><span>
</span><span id="line-2170"></span><span>        </span><span class="hs-comment">--   Contrast with Note [exprOkForSpeculation and evaluated variables]</span><span>
</span><span id="line-2171"></span><span>        </span><span class="hs-comment">-- We don't look through loop breakers here, which is a bit conservative</span><span>
</span><span id="line-2172"></span><span>        </span><span class="hs-comment">-- but otherwise I worry that if an Id's unfolding is just itself,</span><span>
</span><span id="line-2173"></span><span>        </span><span class="hs-comment">-- we could get an infinite loop</span><span>
</span><span id="line-2174"></span><span>
</span><span id="line-2175"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#definitelyUnliftedType"><span class="hs-identifier hs-var">definitelyUnliftedType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703245"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2176"></span><span>        </span><span class="hs-comment">-- Unlifted binders are always evaluated (#20140)</span><span>
</span><span id="line-2177"></span><span>
</span><span id="line-2178"></span><span>    </span><span class="annot"><a href="#local-6989586621682703244"><span class="hs-identifier hs-var">is_hnf_like</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span id="local-6989586621682703248"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682703248"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Literal -&gt; Bool
</span><a href="GHC.Types.Literal.html#isLitRubbish"><span class="hs-identifier hs-var">isLitRubbish</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682703248"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2179"></span><span>        </span><span class="hs-comment">-- Regarding a LitRubbish as ConLike leads to unproductive inlining in</span><span>
</span><span id="line-2180"></span><span>        </span><span class="hs-comment">-- WWRec, see #20035</span><span>
</span><span id="line-2181"></span><span>    </span><span class="annot"><a href="#local-6989586621682703244"><span class="hs-identifier hs-var">is_hnf_like</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>       </span><span class="hs-comment">-- Types are honorary Values;</span><span>
</span><span id="line-2182"></span><span>                                              </span><span class="hs-comment">-- we don't mind copying them</span><span>
</span><span id="line-2183"></span><span>    </span><span class="annot"><a href="#local-6989586621682703244"><span class="hs-identifier hs-var">is_hnf_like</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>       </span><span class="hs-comment">-- Same for coercions</span><span>
</span><span id="line-2184"></span><span>    </span><span class="annot"><a href="#local-6989586621682703244"><span class="hs-identifier hs-var">is_hnf_like</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-type">Lam</span></a></span><span> </span><span id="local-6989586621682703249"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703249"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621682703250"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703250"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Core.html#isRuntimeVar"><span class="hs-identifier hs-var">isRuntimeVar</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703249"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703244"><span class="hs-identifier hs-var">is_hnf_like</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703250"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-2185"></span><span>    </span><span class="annot"><a href="#local-6989586621682703244"><span class="hs-identifier hs-var">is_hnf_like</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-type">Tick</span></a></span><span> </span><span id="local-6989586621682703251"><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682703251"><span class="hs-identifier hs-var">tickish</span></a></span></span><span> </span><span id="local-6989586621682703252"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703252"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreTickish -&gt; Bool
forall (pass :: TickishPass). GenTickish pass -&gt; Bool
</span><a href="GHC.Types.Tickish.html#tickishCounts"><span class="hs-identifier hs-var">tickishCounts</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682703251"><span class="hs-identifier hs-var">tickish</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2186"></span><span>                                   </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703244"><span class="hs-identifier hs-var">is_hnf_like</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703252"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-2187"></span><span>                                      </span><span class="hs-comment">-- See Note [exprIsHNF Tick]</span><span>
</span><span id="line-2188"></span><span>    </span><span class="annot"><a href="#local-6989586621682703244"><span class="hs-identifier hs-var">is_hnf_like</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Cast"><span class="hs-identifier hs-type">Cast</span></a></span><span> </span><span id="local-6989586621682703253"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703253"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703244"><span class="hs-identifier hs-var">is_hnf_like</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703253"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-2189"></span><span>    </span><span class="annot"><a href="#local-6989586621682703244"><span class="hs-identifier hs-var">is_hnf_like</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#App"><span class="hs-identifier hs-type">App</span></a></span><span> </span><span id="local-6989586621682703254"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703254"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621682703255"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703255"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2190"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Bool
forall b. Expr b -&gt; Bool
</span><a href="GHC.Core.html#isValArg"><span class="hs-identifier hs-var">isValArg</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703255"><span class="hs-identifier hs-var">a</span></a></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Int -&gt; Bool
</span><a href="#local-6989586621682703257"><span class="hs-identifier hs-var">app_is_value</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703254"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-2191"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703244"><span class="hs-identifier hs-var">is_hnf_like</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703254"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-2192"></span><span>    </span><span class="annot"><a href="#local-6989586621682703244"><span class="hs-identifier hs-var">is_hnf_like</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span class="annot"><span class="annottext">Bind Id
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682703258"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703258"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703244"><span class="hs-identifier hs-var">is_hnf_like</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703258"><span class="hs-identifier hs-var">e</span></a></span><span>  </span><span class="hs-comment">-- Lazy let(rec)s don't affect us</span><span>
</span><span id="line-2193"></span><span>    </span><span class="annot"><a href="#local-6989586621682703244"><span class="hs-identifier hs-var">is_hnf_like</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Case"><span class="hs-identifier hs-type">Case</span></a></span><span> </span><span id="local-6989586621682703259"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703259"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621682703260"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703260"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682703261"><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682703261"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2194"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682703262"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703262"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Id -&gt; [Alt Id] -&gt; Maybe CoreExpr
</span><a href="GHC.Core.Utils.html#isUnsafeEqualityCase"><span class="hs-identifier hs-var">isUnsafeEqualityCase</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703259"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703260"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682703261"><span class="hs-keyword hs-var">as</span></a></span><span>
</span><span id="line-2195"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Bool
</span><a href="#local-6989586621682703244"><span class="hs-identifier hs-var">is_hnf_like</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703262"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-2196"></span><span>    </span><span class="annot"><a href="#local-6989586621682703244"><span class="hs-identifier hs-var">is_hnf_like</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2197"></span><span>
</span><span id="line-2198"></span><span>    </span><span class="hs-comment">-- 'n' is the number of value args to which the expression is applied</span><span>
</span><span id="line-2199"></span><span>    </span><span class="hs-comment">-- And n&gt;0: there is at least one value argument</span><span>
</span><span id="line-2200"></span><span>    </span><span class="annot"><a href="#local-6989586621682703257"><span class="hs-identifier hs-type">app_is_value</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2201"></span><span>    </span><span id="local-6989586621682703257"><span class="annot"><span class="annottext">app_is_value :: CoreExpr -&gt; Int -&gt; Bool
</span><a href="#local-6989586621682703257"><span class="hs-identifier hs-var hs-var">app_is_value</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682703263"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703263"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span>    </span><span id="local-6989586621682703264"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703264"><span class="hs-identifier hs-var">nva</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CheapAppFun
</span><a href="#local-6989586621682703246"><span class="hs-identifier hs-var">id_app_is_value</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703263"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703264"><span class="hs-identifier hs-var">nva</span></a></span><span>
</span><span id="line-2202"></span><span>    </span><span class="annot"><a href="#local-6989586621682703257"><span class="hs-identifier hs-var">app_is_value</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-type">Tick</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682703265"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703265"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682703266"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703266"><span class="hs-identifier hs-var">nva</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Int -&gt; Bool
</span><a href="#local-6989586621682703257"><span class="hs-identifier hs-var">app_is_value</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703265"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703266"><span class="hs-identifier hs-var">nva</span></a></span><span>
</span><span id="line-2203"></span><span>    </span><span class="annot"><a href="#local-6989586621682703257"><span class="hs-identifier hs-var">app_is_value</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Cast"><span class="hs-identifier hs-type">Cast</span></a></span><span> </span><span id="local-6989586621682703267"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703267"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682703268"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703268"><span class="hs-identifier hs-var">nva</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Int -&gt; Bool
</span><a href="#local-6989586621682703257"><span class="hs-identifier hs-var">app_is_value</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703267"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703268"><span class="hs-identifier hs-var">nva</span></a></span><span>
</span><span id="line-2204"></span><span>    </span><span class="annot"><a href="#local-6989586621682703257"><span class="hs-identifier hs-var">app_is_value</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#App"><span class="hs-identifier hs-type">App</span></a></span><span> </span><span id="local-6989586621682703269"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703269"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682703270"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703270"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span>  </span><span id="local-6989586621682703271"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703271"><span class="hs-identifier hs-var">nva</span></a></span></span><span>
</span><span id="line-2205"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Bool
forall b. Expr b -&gt; Bool
</span><a href="GHC.Core.html#isValArg"><span class="hs-identifier hs-var">isValArg</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703270"><span class="hs-identifier hs-var">a</span></a></span><span>              </span><span class="hs-glyph">=</span><span>
</span><span id="line-2206"></span><span>        </span><span class="annot"><span class="annottext">CoreExpr -&gt; Int -&gt; Bool
</span><a href="#local-6989586621682703257"><span class="hs-identifier hs-var">app_is_value</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703269"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703271"><span class="hs-identifier hs-var">nva</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-2207"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; CoreExpr -&gt; Bool
Type -&gt; CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#needsCaseBinding"><span class="hs-identifier hs-var">needsCaseBinding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoreExpr -&gt; Type
CoreExpr -&gt; Type
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703270"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703270"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2208"></span><span>          </span><span class="hs-comment">-- For example  f (x /# y)  where f has arity two, and the first</span><span>
</span><span id="line-2209"></span><span>          </span><span class="hs-comment">-- argument is unboxed. This is not a value!</span><span>
</span><span id="line-2210"></span><span>          </span><span class="hs-comment">-- But  f 34#  is a value.</span><span>
</span><span id="line-2211"></span><span>          </span><span class="hs-comment">-- NB: Check app_is_value first, the arity check is cheaper</span><span>
</span><span id="line-2212"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Int -&gt; Bool
</span><a href="#local-6989586621682703257"><span class="hs-identifier hs-var">app_is_value</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703269"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703271"><span class="hs-identifier hs-var">nva</span></a></span><span>
</span><span id="line-2213"></span><span>    </span><span class="annot"><a href="#local-6989586621682703257"><span class="hs-identifier hs-var">app_is_value</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span>          </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2214"></span><span>
</span><span id="line-2215"></span><span>    </span><span id="local-6989586621682703246"><span class="annot"><span class="annottext">id_app_is_value :: CheapAppFun
</span><a href="#local-6989586621682703246"><span class="hs-identifier hs-var hs-var">id_app_is_value</span></a></span></span><span> </span><span id="local-6989586621682703272"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703272"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span id="local-6989586621682703273"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703273"><span class="hs-identifier hs-var">n_val_args</span></a></span></span><span>
</span><span id="line-2216"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="#local-6989586621682703242"><span class="hs-identifier hs-var">is_con</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703272"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-2217"></span><span>       </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Int
</span><a href="GHC.Types.Id.html#idArity"><span class="hs-identifier hs-var">idArity</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703272"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703273"><span class="hs-identifier hs-var">n_val_args</span></a></span><span>
</span><span id="line-2218"></span><span>
</span><span id="line-2219"></span><span class="hs-comment">{-
Note [exprIsHNF Tick]
~~~~~~~~~~~~~~~~~~~~~
We can discard source annotations on HNFs as long as they aren't
tick-like:

  scc c (\x . e)    =&gt;  \x . e
  scc c (C x1..xn)  =&gt;  C x1..xn

So we regard these as HNFs.  Tick annotations that tick are not
regarded as HNF if the expression they surround is HNF, because the
tick is there to tell us that the expression was evaluated, so we
don't want to discard a seq on it.
-}</span><span>
</span><span id="line-2233"></span><span>
</span><span id="line-2234"></span><span class="annot"><span class="hs-comment">-- | Can we bind this 'CoreExpr' at the top level?</span></span><span>
</span><span id="line-2235"></span><span class="annot"><a href="GHC.Core.Utils.html#exprIsTopLevelBindable"><span class="hs-identifier hs-type">exprIsTopLevelBindable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2236"></span><span class="hs-comment">-- See Note [Core top-level string literals]</span><span>
</span><span id="line-2237"></span><span class="hs-comment">-- Precondition: exprType expr = ty</span><span>
</span><span id="line-2238"></span><span class="hs-comment">-- Top-level literal strings can't even be wrapped in ticks</span><span>
</span><span id="line-2239"></span><span class="hs-comment">--   see Note [Core top-level string literals] in &quot;GHC.Core&quot;</span><span>
</span><span id="line-2240"></span><span id="exprIsTopLevelBindable"><span class="annot"><span class="annottext">exprIsTopLevelBindable :: CoreExpr -&gt; Type -&gt; Bool
</span><a href="GHC.Core.Utils.html#exprIsTopLevelBindable"><span class="hs-identifier hs-var hs-var">exprIsTopLevelBindable</span></a></span></span><span> </span><span id="local-6989586621682703274"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703274"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621682703275"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703275"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-2241"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#mightBeUnliftedType"><span class="hs-identifier hs-var">mightBeUnliftedType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703275"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2242"></span><span>    </span><span class="hs-comment">-- Note that 'expr' may not have a fixed runtime representation here,</span><span>
</span><span id="line-2243"></span><span>    </span><span class="hs-comment">-- consequently we must use 'mightBeUnliftedType' rather than 'isUnliftedType',</span><span>
</span><span id="line-2244"></span><span>    </span><span class="hs-comment">-- as the latter would panic.</span><span>
</span><span id="line-2245"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#exprIsTickedString"><span class="hs-identifier hs-var">exprIsTickedString</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703274"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-2246"></span><span>
</span><span id="line-2247"></span><span class="hs-comment">-- | Check if the expression is zero or more Ticks wrapped around a literal</span><span>
</span><span id="line-2248"></span><span class="hs-comment">-- string.</span><span>
</span><span id="line-2249"></span><span class="annot"><a href="GHC.Core.Utils.html#exprIsTickedString"><span class="hs-identifier hs-type">exprIsTickedString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2250"></span><span id="exprIsTickedString"><span class="annot"><span class="annottext">exprIsTickedString :: CoreExpr -&gt; Bool
</span><a href="GHC.Core.Utils.html#exprIsTickedString"><span class="hs-identifier hs-var hs-var">exprIsTickedString</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ByteString -&gt; Bool)
-&gt; (CoreExpr -&gt; Maybe ByteString) -&gt; CoreExpr -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Maybe ByteString
</span><a href="GHC.Core.Utils.html#exprIsTickedString_maybe"><span class="hs-identifier hs-var">exprIsTickedString_maybe</span></a></span><span>
</span><span id="line-2251"></span><span>
</span><span id="line-2252"></span><span class="hs-comment">-- | Extract a literal string from an expression that is zero or more Ticks</span><span>
</span><span id="line-2253"></span><span class="hs-comment">-- wrapped around a literal string. Returns Nothing if the expression has a</span><span>
</span><span id="line-2254"></span><span class="hs-comment">-- different shape.</span><span>
</span><span id="line-2255"></span><span class="hs-comment">-- Used to &quot;look through&quot; Ticks in places that need to handle literal strings.</span><span>
</span><span id="line-2256"></span><span class="annot"><a href="GHC.Core.Utils.html#exprIsTickedString_maybe"><span class="hs-identifier hs-type">exprIsTickedString_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-2257"></span><span id="exprIsTickedString_maybe"><span class="annot"><span class="annottext">exprIsTickedString_maybe :: CoreExpr -&gt; Maybe ByteString
</span><a href="GHC.Core.Utils.html#exprIsTickedString_maybe"><span class="hs-identifier hs-var hs-var">exprIsTickedString_maybe</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Literal.html#LitString"><span class="hs-identifier hs-type">LitString</span></a></span><span> </span><span id="local-6989586621682703278"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682703278"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe ByteString
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682703278"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-2258"></span><span class="annot"><a href="GHC.Core.Utils.html#exprIsTickedString_maybe"><span class="hs-identifier hs-var">exprIsTickedString_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-type">Tick</span></a></span><span> </span><span id="local-6989586621682703279"><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682703279"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682703280"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703280"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2259"></span><span>  </span><span class="hs-comment">-- we don't tick literals with CostCentre ticks, compare to mkTick</span><span>
</span><span id="line-2260"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; TickishPlacement
forall (pass :: TickishPass). GenTickish pass -&gt; TickishPlacement
</span><a href="GHC.Types.Tickish.html#tickishPlace"><span class="hs-identifier hs-var">tickishPlace</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682703279"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">TickishPlacement -&gt; TickishPlacement -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TickishPlacement
</span><a href="GHC.Types.Tickish.html#PlaceCostCentre"><span class="hs-identifier hs-var">PlaceCostCentre</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2261"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Maybe ByteString
</span><a href="GHC.Core.Utils.html#exprIsTickedString_maybe"><span class="hs-identifier hs-var">exprIsTickedString_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703280"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-2262"></span><span class="annot"><a href="GHC.Core.Utils.html#exprIsTickedString_maybe"><span class="hs-identifier hs-var">exprIsTickedString_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2263"></span><span>
</span><span id="line-2264"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
             Instantiating data constructors
*                                                                      *
************************************************************************

These InstPat functions go here to avoid circularity between DataCon and Id
-}</span><span>
</span><span id="line-2273"></span><span>
</span><span id="line-2274"></span><span class="annot"><a href="GHC.Core.Utils.html#dataConRepInstPat"><span class="hs-identifier hs-type">dataConRepInstPat</span></a></span><span>   </span><span class="hs-glyph">::</span><span>                 </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2275"></span><span class="annot"><a href="GHC.Core.Utils.html#dataConRepFSInstPat"><span class="hs-identifier hs-type">dataConRepFSInstPat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2276"></span><span>
</span><span id="line-2277"></span><span id="dataConRepInstPat"><span class="annot"><span class="annottext">dataConRepInstPat :: [Unique] -&gt; Type -&gt; DataCon -&gt; [Type] -&gt; ([Id], [Id])
</span><a href="GHC.Core.Utils.html#dataConRepInstPat"><span class="hs-identifier hs-var hs-var">dataConRepInstPat</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FastString]
-&gt; [Unique] -&gt; Type -&gt; DataCon -&gt; [Type] -&gt; ([Id], [Id])
</span><a href="GHC.Core.Utils.html#dataConInstPat"><span class="hs-identifier hs-var">dataConInstPat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; [FastString]
forall a. a -&gt; [a]
</span><span class="hs-identifier hs-var">repeat</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ipv&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2278"></span><span id="dataConRepFSInstPat"><span class="annot"><span class="annottext">dataConRepFSInstPat :: [FastString]
-&gt; [Unique] -&gt; Type -&gt; DataCon -&gt; [Type] -&gt; ([Id], [Id])
</span><a href="GHC.Core.Utils.html#dataConRepFSInstPat"><span class="hs-identifier hs-var hs-var">dataConRepFSInstPat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FastString]
-&gt; [Unique] -&gt; Type -&gt; DataCon -&gt; [Type] -&gt; ([Id], [Id])
</span><a href="GHC.Core.Utils.html#dataConInstPat"><span class="hs-identifier hs-var">dataConInstPat</span></a></span><span>
</span><span id="line-2279"></span><span>
</span><span id="line-2280"></span><span class="annot"><a href="GHC.Core.Utils.html#dataConInstPat"><span class="hs-identifier hs-type">dataConInstPat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span class="hs-special">]</span><span>          </span><span class="hs-comment">-- A long enough list of FSs to use for names</span><span>
</span><span id="line-2281"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span class="hs-special">]</span><span>              </span><span class="hs-comment">-- An equally long list of uniques, at least one for each binder</span><span>
</span><span id="line-2282"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span>                  </span><span class="hs-comment">-- The multiplicity annotation of the case expression: scales the multiplicity of variables</span><span>
</span><span id="line-2283"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span>
</span><span id="line-2284"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span>                </span><span class="hs-comment">-- Types to instantiate the universally quantified tyvars</span><span>
</span><span id="line-2285"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- Return instantiated variables</span><span>
</span><span id="line-2286"></span><span class="hs-comment">-- dataConInstPat arg_fun fss us mult con inst_tys returns a tuple</span><span>
</span><span id="line-2287"></span><span class="hs-comment">-- (ex_tvs, arg_ids),</span><span>
</span><span id="line-2288"></span><span class="hs-comment">--</span><span>
</span><span id="line-2289"></span><span class="hs-comment">--   ex_tvs are intended to be used as binders for existential type args</span><span>
</span><span id="line-2290"></span><span class="hs-comment">--</span><span>
</span><span id="line-2291"></span><span class="hs-comment">--   arg_ids are intended to be used as binders for value arguments,</span><span>
</span><span id="line-2292"></span><span class="hs-comment">--     and their types have been instantiated with inst_tys and ex_tys</span><span>
</span><span id="line-2293"></span><span class="hs-comment">--     The arg_ids include both evidence and</span><span>
</span><span id="line-2294"></span><span class="hs-comment">--     programmer-specified arguments (both after rep-ing)</span><span>
</span><span id="line-2295"></span><span class="hs-comment">--</span><span>
</span><span id="line-2296"></span><span class="hs-comment">-- Example.</span><span>
</span><span id="line-2297"></span><span class="hs-comment">--  The following constructor T1</span><span>
</span><span id="line-2298"></span><span class="hs-comment">--</span><span>
</span><span id="line-2299"></span><span class="hs-comment">--  data T a where</span><span>
</span><span id="line-2300"></span><span class="hs-comment">--    T1 :: forall b. Int -&gt; b -&gt; T(a,b)</span><span>
</span><span id="line-2301"></span><span class="hs-comment">--    ...</span><span>
</span><span id="line-2302"></span><span class="hs-comment">--</span><span>
</span><span id="line-2303"></span><span class="hs-comment">--  has representation type</span><span>
</span><span id="line-2304"></span><span class="hs-comment">--   forall a. forall a1. forall b. (a ~ (a1,b)) =&gt;</span><span>
</span><span id="line-2305"></span><span class="hs-comment">--     Int -&gt; b -&gt; T a</span><span>
</span><span id="line-2306"></span><span class="hs-comment">--</span><span>
</span><span id="line-2307"></span><span class="hs-comment">--  dataConInstPat fss us T1 (a1',b') will return</span><span>
</span><span id="line-2308"></span><span class="hs-comment">--</span><span>
</span><span id="line-2309"></span><span class="hs-comment">--  ([a1'', b''], [c :: (a1', b')~(a1'', b''), x :: Int, y :: b''])</span><span>
</span><span id="line-2310"></span><span class="hs-comment">--</span><span>
</span><span id="line-2311"></span><span class="hs-comment">--  where the double-primed variables are created with the FastStrings and</span><span>
</span><span id="line-2312"></span><span class="hs-comment">--  Uniques given as fss and us</span><span>
</span><span id="line-2313"></span><span id="dataConInstPat"><span class="annot"><span class="annottext">dataConInstPat :: [FastString]
-&gt; [Unique] -&gt; Type -&gt; DataCon -&gt; [Type] -&gt; ([Id], [Id])
</span><a href="GHC.Core.Utils.html#dataConInstPat"><span class="hs-identifier hs-var hs-var">dataConInstPat</span></a></span></span><span> </span><span id="local-6989586621682703285"><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621682703285"><span class="hs-identifier hs-var">fss</span></a></span></span><span> </span><span id="local-6989586621682703286"><span class="annot"><span class="annottext">[Unique]
</span><a href="#local-6989586621682703286"><span class="hs-identifier hs-var">uniqs</span></a></span></span><span> </span><span id="local-6989586621682703287"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703287"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span id="local-6989586621682703288"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682703288"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621682703289"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682703289"><span class="hs-identifier hs-var">inst_tys</span></a></span></span><span>
</span><span id="line-2314"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ([Id], [Id]) -&gt; ([Id], [Id])
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682703290"><span class="hs-identifier hs-var">univ_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; [Type] -&gt; Bool
forall a b. [a] -&gt; [b] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#equalLength"><span class="hs-operator hs-var">`equalLength`</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682703289"><span class="hs-identifier hs-var">inst_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(([Id], [Id]) -&gt; ([Id], [Id])) -&gt; ([Id], [Id]) -&gt; ([Id], [Id])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2315"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682703292"><span class="hs-identifier hs-var">ex_bndrs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682703293"><span class="hs-identifier hs-var">arg_ids</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2316"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2317"></span><span>    </span><span id="local-6989586621682703290"><span class="annot"><span class="annottext">univ_tvs :: [Id]
</span><a href="#local-6989586621682703290"><span class="hs-identifier hs-var hs-var">univ_tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [Id]
</span><a href="GHC.Core.DataCon.html#dataConUnivTyVars"><span class="hs-identifier hs-var">dataConUnivTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682703288"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-2318"></span><span>    </span><span id="local-6989586621682703294"><span class="annot"><span class="annottext">ex_tvs :: [Id]
</span><a href="#local-6989586621682703294"><span class="hs-identifier hs-var hs-var">ex_tvs</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [Id]
</span><a href="GHC.Core.DataCon.html#dataConExTyCoVars"><span class="hs-identifier hs-var">dataConExTyCoVars</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682703288"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-2319"></span><span>    </span><span id="local-6989586621682703296"><span class="annot"><span class="annottext">arg_tys :: [Scaled Type]
</span><a href="#local-6989586621682703296"><span class="hs-identifier hs-var hs-var">arg_tys</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [Scaled Type]
</span><a href="GHC.Core.DataCon.html#dataConRepArgTys"><span class="hs-identifier hs-var">dataConRepArgTys</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682703288"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-2320"></span><span>    </span><span id="local-6989586621682703298"><span class="annot"><span class="annottext">arg_strs :: [StrictnessMark]
</span><a href="#local-6989586621682703298"><span class="hs-identifier hs-var hs-var">arg_strs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [StrictnessMark]
</span><a href="GHC.Core.DataCon.html#dataConRepStrictness"><span class="hs-identifier hs-var">dataConRepStrictness</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682703288"><span class="hs-identifier hs-var">con</span></a></span><span>  </span><span class="hs-comment">-- 1-1 with arg_tys</span><span>
</span><span id="line-2321"></span><span>    </span><span id="local-6989586621682703300"><span class="annot"><span class="annottext">n_ex :: Int
</span><a href="#local-6989586621682703300"><span class="hs-identifier hs-var hs-var">n_ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682703294"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span>
</span><span id="line-2322"></span><span>
</span><span id="line-2323"></span><span>      </span><span class="hs-comment">-- split the Uniques and FastStrings</span><span>
</span><span id="line-2324"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682703302"><span class="annot"><span class="annottext">[Unique]
</span><a href="#local-6989586621682703302"><span class="hs-identifier hs-var">ex_uniqs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682703303"><span class="annot"><span class="annottext">[Unique]
</span><a href="#local-6989586621682703303"><span class="hs-identifier hs-var">id_uniqs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Unique] -&gt; ([Unique], [Unique])
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703300"><span class="hs-identifier hs-var">n_ex</span></a></span><span> </span><span class="annot"><span class="annottext">[Unique]
</span><a href="#local-6989586621682703286"><span class="hs-identifier hs-var">uniqs</span></a></span><span>
</span><span id="line-2325"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682703305"><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621682703305"><span class="hs-identifier hs-var">ex_fss</span></a></span></span><span class="hs-special">,</span><span>   </span><span id="local-6989586621682703306"><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621682703306"><span class="hs-identifier hs-var">id_fss</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [FastString] -&gt; ([FastString], [FastString])
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703300"><span class="hs-identifier hs-var">n_ex</span></a></span><span> </span><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621682703285"><span class="hs-identifier hs-var">fss</span></a></span><span>
</span><span id="line-2326"></span><span>
</span><span id="line-2327"></span><span>      </span><span class="hs-comment">-- Make the instantiating substitution for universals</span><span>
</span><span id="line-2328"></span><span>    </span><span id="local-6989586621682703307"><span class="annot"><span class="annottext">univ_subst :: Subst
</span><a href="#local-6989586621682703307"><span class="hs-identifier hs-var hs-var">univ_subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; [Type] -&gt; Subst
HasDebugCallStack =&gt; [Id] -&gt; [Type] -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#zipTvSubst"><span class="hs-identifier hs-var">zipTvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682703290"><span class="hs-identifier hs-var">univ_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682703289"><span class="hs-identifier hs-var">inst_tys</span></a></span><span>
</span><span id="line-2329"></span><span>
</span><span id="line-2330"></span><span>      </span><span class="hs-comment">-- Make existential type variables, applying and extending the substitution</span><span>
</span><span id="line-2331"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682703309"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682703309"><span class="hs-identifier hs-var">full_subst</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682703292"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682703292"><span class="hs-identifier hs-var">ex_bndrs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Subst -&gt; (Id, FastString, Unique) -&gt; (Subst, Id))
-&gt; Subst -&gt; [(Id, FastString, Unique)] -&gt; (Subst, [Id])
forall (t :: * -&gt; *) s a b.
Traversable t =&gt;
(s -&gt; a -&gt; (s, b)) -&gt; s -&gt; t a -&gt; (s, t b)
</span><span class="hs-identifier hs-var">mapAccumL</span></span><span> </span><span class="annot"><span class="annottext">Subst -&gt; (Id, FastString, Unique) -&gt; (Subst, Id)
</span><a href="#local-6989586621682703310"><span class="hs-identifier hs-var">mk_ex_var</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682703307"><span class="hs-identifier hs-var">univ_subst</span></a></span><span>
</span><span id="line-2332"></span><span>                                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; [FastString] -&gt; [Unique] -&gt; [(Id, FastString, Unique)]
forall a b c. [a] -&gt; [b] -&gt; [c] -&gt; [(a, b, c)]
</span><span class="hs-identifier hs-var">zip3</span></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682703294"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621682703305"><span class="hs-identifier hs-var">ex_fss</span></a></span><span> </span><span class="annot"><span class="annottext">[Unique]
</span><a href="#local-6989586621682703302"><span class="hs-identifier hs-var">ex_uniqs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2333"></span><span>
</span><span id="line-2334"></span><span>    </span><span class="annot"><a href="#local-6989586621682703310"><span class="hs-identifier hs-type">mk_ex_var</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2335"></span><span>    </span><span id="local-6989586621682703310"><span class="annot"><span class="annottext">mk_ex_var :: Subst -&gt; (Id, FastString, Unique) -&gt; (Subst, Id)
</span><a href="#local-6989586621682703310"><span class="hs-identifier hs-var hs-var">mk_ex_var</span></a></span></span><span> </span><span id="local-6989586621682703312"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682703312"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682703313"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703313"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682703314"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682703314"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682703315"><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682703315"><span class="hs-identifier hs-var">uniq</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst -&gt; Id -&gt; Id -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#extendTCvSubstWithClone"><span class="hs-identifier hs-var">Type.extendTCvSubstWithClone</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682703312"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703313"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-2336"></span><span>                                       </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703317"><span class="hs-identifier hs-var">new_tv</span></a></span><span>
</span><span id="line-2337"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703317"><span class="hs-identifier hs-var">new_tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2338"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2339"></span><span>        </span><span id="local-6989586621682703317"><span class="annot"><span class="annottext">new_tv :: Id
</span><a href="#local-6989586621682703317"><span class="hs-identifier hs-var hs-var">new_tv</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703313"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-2340"></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; Id
</span><a href="GHC.Types.Var.html#mkTyVar"><span class="hs-identifier hs-var">mkTyVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unique -&gt; FastString -&gt; Name
</span><a href="GHC.Types.Name.html#mkSysTvName"><span class="hs-identifier hs-var">mkSysTvName</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682703315"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682703314"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703320"><span class="hs-identifier hs-var">kind</span></a></span><span>
</span><span id="line-2341"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2342"></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; Id
</span><a href="GHC.Types.Var.html#mkCoVar"><span class="hs-identifier hs-var">mkCoVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unique -&gt; FastString -&gt; Name
</span><a href="GHC.Types.Name.html#mkSystemVarName"><span class="hs-identifier hs-var">mkSystemVarName</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682703315"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682703314"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703320"><span class="hs-identifier hs-var">kind</span></a></span><span>
</span><span id="line-2343"></span><span>        </span><span id="local-6989586621682703320"><span class="annot"><span class="annottext">kind :: Type
</span><a href="#local-6989586621682703320"><span class="hs-identifier hs-var hs-var">kind</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTyUnchecked"><span class="hs-identifier hs-var">Type.substTyUnchecked</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682703312"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Var.html#varType"><span class="hs-identifier hs-var">varType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703313"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2344"></span><span>
</span><span id="line-2345"></span><span>      </span><span class="hs-comment">-- Make value vars, instantiating types</span><span>
</span><span id="line-2346"></span><span>    </span><span id="local-6989586621682703293"><span class="annot"><span class="annottext">arg_ids :: [Id]
</span><a href="#local-6989586621682703293"><span class="hs-identifier hs-var hs-var">arg_ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Unique -&gt; FastString -&gt; Scaled Type -&gt; StrictnessMark -&gt; Id)
-&gt; [Unique]
-&gt; [FastString]
-&gt; [Scaled Type]
-&gt; [StrictnessMark]
-&gt; [Id]
forall a b c d e.
(a -&gt; b -&gt; c -&gt; d -&gt; e) -&gt; [a] -&gt; [b] -&gt; [c] -&gt; [d] -&gt; [e]
</span><span class="hs-identifier hs-var">zipWith4</span></span><span> </span><span class="annot"><span class="annottext">Unique -&gt; FastString -&gt; Scaled Type -&gt; StrictnessMark -&gt; Id
</span><a href="#local-6989586621682703324"><span class="hs-identifier hs-var">mk_id_var</span></a></span><span> </span><span class="annot"><span class="annottext">[Unique]
</span><a href="#local-6989586621682703303"><span class="hs-identifier hs-var">id_uniqs</span></a></span><span> </span><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621682703306"><span class="hs-identifier hs-var">id_fss</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682703296"><span class="hs-identifier hs-var">arg_tys</span></a></span><span> </span><span class="annot"><span class="annottext">[StrictnessMark]
</span><a href="#local-6989586621682703298"><span class="hs-identifier hs-var">arg_strs</span></a></span><span>
</span><span id="line-2347"></span><span>    </span><span id="local-6989586621682703324"><span class="annot"><span class="annottext">mk_id_var :: Unique -&gt; FastString -&gt; Scaled Type -&gt; StrictnessMark -&gt; Id
</span><a href="#local-6989586621682703324"><span class="hs-identifier hs-var hs-var">mk_id_var</span></a></span></span><span> </span><span id="local-6989586621682703325"><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682703325"><span class="hs-identifier hs-var">uniq</span></a></span></span><span> </span><span id="local-6989586621682703326"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682703326"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span id="local-6989586621682703328"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703328"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682703329"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703329"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682703330"><span class="annot"><span class="annottext">StrictnessMark
</span><a href="#local-6989586621682703330"><span class="hs-identifier hs-var">str</span></a></span></span><span>
</span><span id="line-2348"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StrictnessMark -&gt; Id -&gt; Id
</span><a href="GHC.Types.Id.html#setCaseBndrEvald"><span class="hs-identifier hs-var">setCaseBndrEvald</span></a></span><span> </span><span class="annot"><span class="annottext">StrictnessMark
</span><a href="#local-6989586621682703330"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Id) -&gt; Id -&gt; Id
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>  </span><span class="hs-comment">-- See Note [Mark evaluated arguments]</span><span>
</span><span id="line-2349"></span><span>        </span><span class="annot"><span class="annottext">OccName -&gt; Unique -&gt; Type -&gt; Type -&gt; SrcSpan -&gt; Id
</span><a href="GHC.Types.Id.html#mkUserLocalOrCoVar"><span class="hs-identifier hs-var">mkUserLocalOrCoVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkVarOccFS"><span class="hs-identifier hs-var">mkVarOccFS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682703326"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682703325"><span class="hs-identifier hs-var">uniq</span></a></span><span>
</span><span id="line-2350"></span><span>                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703287"><span class="hs-identifier hs-var">mult</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Multiplicity.html#mkMultMul"><span class="hs-operator hs-var">`mkMultMul`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703328"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">Type.substTy</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682703309"><span class="hs-identifier hs-var">full_subst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703329"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a></span><span>
</span><span id="line-2351"></span><span>
</span><span id="line-2352"></span><span class="hs-comment">{-
Note [Mark evaluated arguments]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When pattern matching on a constructor with strict fields, the binder
can have an 'evaldUnfolding'.  Moreover, it *should* have one, so that
when loading an interface file unfolding like:
  data T = MkT !Int
  f x = case x of { MkT y -&gt; let v::Int# = case y of I# n -&gt; n+1
                             in ... }
we don't want Lint to complain.  The 'y' is evaluated, so the
case in the RHS of the binding for 'v' is fine.  But only if we
*know* that 'y' is evaluated.

c.f. add_evals in GHC.Core.Opt.Simplify.simplAlt

************************************************************************
*                                                                      *
         Equality
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-2373"></span><span>
</span><span id="line-2374"></span><span class="hs-comment">-- | A cheap equality test which bales out fast!</span><span>
</span><span id="line-2375"></span><span class="hs-comment">--      If it returns @True@ the arguments are definitely equal,</span><span>
</span><span id="line-2376"></span><span class="hs-comment">--      otherwise, they may or may not be equal.</span><span>
</span><span id="line-2377"></span><span id="local-6989586621682703337"><span class="annot"><a href="GHC.Core.Utils.html#cheapEqExpr"><span class="hs-identifier hs-type">cheapEqExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682703337"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682703337"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-2378"></span><span id="cheapEqExpr"><span class="annot"><span class="annottext">cheapEqExpr :: forall {b}. Expr b -&gt; Expr b -&gt; Bool
</span><a href="GHC.Core.Utils.html#cheapEqExpr"><span class="hs-identifier hs-var hs-var">cheapEqExpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoreTickish -&gt; Bool) -&gt; Expr b -&gt; Expr b -&gt; Bool
forall b. (CoreTickish -&gt; Bool) -&gt; Expr b -&gt; Expr b -&gt; Bool
</span><a href="GHC.Core.Utils.html#cheapEqExpr%27"><span class="hs-identifier hs-var">cheapEqExpr'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; CoreTickish -&gt; Bool
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-2379"></span><span>
</span><span id="line-2380"></span><span class="annot"><span class="hs-comment">-- | Cheap expression equality test, can ignore ticks by type.</span></span><span>
</span><span id="line-2381"></span><span id="local-6989586621682701979"><span class="annot"><a href="GHC.Core.Utils.html#cheapEqExpr%27"><span class="hs-identifier hs-type">cheapEqExpr'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Tickish.html#CoreTickish"><span class="hs-identifier hs-type">CoreTickish</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682701979"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682701979"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-2382"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#cheapEqExpr%27"><span class="hs-pragma hs-type">cheapEqExpr'</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-2383"></span><span id="cheapEqExpr%27"><span class="annot"><span class="annottext">cheapEqExpr' :: forall b. (CoreTickish -&gt; Bool) -&gt; Expr b -&gt; Expr b -&gt; Bool
</span><a href="GHC.Core.Utils.html#cheapEqExpr%27"><span class="hs-identifier hs-var hs-var">cheapEqExpr'</span></a></span></span><span> </span><span id="local-6989586621682703343"><span class="annot"><span class="annottext">CoreTickish -&gt; Bool
</span><a href="#local-6989586621682703343"><span class="hs-identifier hs-var">ignoreTick</span></a></span></span><span> </span><span id="local-6989586621682703344"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682703344"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621682703345"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682703345"><span class="hs-identifier hs-var">e2</span></a></span></span><span>
</span><span id="line-2384"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr b -&gt; Expr b -&gt; Bool
</span><a href="#local-6989586621682703346"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682703344"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682703345"><span class="hs-identifier hs-var">e2</span></a></span><span>
</span><span id="line-2385"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2386"></span><span>    </span><span id="local-6989586621682703346"><span class="annot"><span class="annottext">go :: Expr b -&gt; Expr b -&gt; Bool
</span><a href="#local-6989586621682703346"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682703347"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703347"><span class="hs-identifier hs-var">v1</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682703348"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703348"><span class="hs-identifier hs-var">v2</span></a></span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703347"><span class="hs-identifier hs-var">v1</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Id -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703348"><span class="hs-identifier hs-var">v2</span></a></span><span>
</span><span id="line-2387"></span><span>    </span><span class="annot"><a href="#local-6989586621682703346"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span id="local-6989586621682703349"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682703349"><span class="hs-identifier hs-var">lit1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span id="local-6989586621682703350"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682703350"><span class="hs-identifier hs-var">lit2</span></a></span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682703349"><span class="hs-identifier hs-var">lit1</span></a></span><span> </span><span class="annot"><span class="annottext">Literal -&gt; Literal -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682703350"><span class="hs-identifier hs-var">lit2</span></a></span><span>
</span><span id="line-2388"></span><span>    </span><span class="annot"><a href="#local-6989586621682703346"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span id="local-6989586621682703351"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703351"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span id="local-6989586621682703352"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703352"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703351"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703352"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-2389"></span><span>    </span><span class="annot"><a href="#local-6989586621682703346"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span id="local-6989586621682703353"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682703353"><span class="hs-identifier hs-var">c1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span id="local-6989586621682703354"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682703354"><span class="hs-identifier hs-var">c2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682703353"><span class="hs-identifier hs-var">c1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#eqCoercion"><span class="hs-operator hs-var">`eqCoercion`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682703354"><span class="hs-identifier hs-var">c2</span></a></span><span>
</span><span id="line-2390"></span><span>    </span><span class="annot"><a href="#local-6989586621682703346"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#App"><span class="hs-identifier hs-type">App</span></a></span><span> </span><span id="local-6989586621682703356"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682703356"><span class="hs-identifier hs-var">f1</span></a></span></span><span> </span><span id="local-6989586621682703357"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682703357"><span class="hs-identifier hs-var">a1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#App"><span class="hs-identifier hs-type">App</span></a></span><span> </span><span id="local-6989586621682703358"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682703358"><span class="hs-identifier hs-var">f2</span></a></span></span><span> </span><span id="local-6989586621682703359"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682703359"><span class="hs-identifier hs-var">a2</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682703356"><span class="hs-identifier hs-var">f1</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b -&gt; Expr b -&gt; Bool
</span><a href="#local-6989586621682703346"><span class="hs-operator hs-var">`go`</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682703358"><span class="hs-identifier hs-var">f2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682703357"><span class="hs-identifier hs-var">a1</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b -&gt; Expr b -&gt; Bool
</span><a href="#local-6989586621682703346"><span class="hs-operator hs-var">`go`</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682703359"><span class="hs-identifier hs-var">a2</span></a></span><span>
</span><span id="line-2391"></span><span>    </span><span class="annot"><a href="#local-6989586621682703346"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Cast"><span class="hs-identifier hs-type">Cast</span></a></span><span> </span><span id="local-6989586621682703360"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682703360"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621682703361"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682703361"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Cast"><span class="hs-identifier hs-type">Cast</span></a></span><span> </span><span id="local-6989586621682703362"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682703362"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span id="local-6989586621682703363"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682703363"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682703360"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b -&gt; Expr b -&gt; Bool
</span><a href="#local-6989586621682703346"><span class="hs-operator hs-var">`go`</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682703362"><span class="hs-identifier hs-var">e2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682703361"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#eqCoercion"><span class="hs-operator hs-var">`eqCoercion`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682703363"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-2392"></span><span>
</span><span id="line-2393"></span><span>    </span><span class="annot"><a href="#local-6989586621682703346"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-type">Tick</span></a></span><span> </span><span id="local-6989586621682703364"><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682703364"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621682703365"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682703365"><span class="hs-identifier hs-var">e1</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682703366"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682703366"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; Bool
</span><a href="#local-6989586621682703343"><span class="hs-identifier hs-var">ignoreTick</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682703364"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr b -&gt; Expr b -&gt; Bool
</span><a href="#local-6989586621682703346"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682703365"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682703366"><span class="hs-identifier hs-var">e2</span></a></span><span>
</span><span id="line-2394"></span><span>    </span><span class="annot"><a href="#local-6989586621682703346"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682703367"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682703367"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-type">Tick</span></a></span><span> </span><span id="local-6989586621682703368"><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682703368"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span id="local-6989586621682703369"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682703369"><span class="hs-identifier hs-var">e2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; Bool
</span><a href="#local-6989586621682703343"><span class="hs-identifier hs-var">ignoreTick</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682703368"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr b -&gt; Expr b -&gt; Bool
</span><a href="#local-6989586621682703346"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682703367"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682703369"><span class="hs-identifier hs-var">e2</span></a></span><span>
</span><span id="line-2395"></span><span>    </span><span class="annot"><a href="#local-6989586621682703346"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-type">Tick</span></a></span><span> </span><span id="local-6989586621682703370"><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682703370"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621682703371"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682703371"><span class="hs-identifier hs-var">e1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-type">Tick</span></a></span><span> </span><span id="local-6989586621682703372"><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682703372"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span id="local-6989586621682703373"><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682703373"><span class="hs-identifier hs-var">e2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682703370"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; CoreTickish -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682703372"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682703371"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b -&gt; Expr b -&gt; Bool
</span><a href="#local-6989586621682703346"><span class="hs-operator hs-var">`go`</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><a href="#local-6989586621682703373"><span class="hs-identifier hs-var">e2</span></a></span><span>
</span><span id="line-2396"></span><span>
</span><span id="line-2397"></span><span>    </span><span class="annot"><a href="#local-6989586621682703346"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Expr b
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2398"></span><span>
</span><span id="line-2399"></span><span>
</span><span id="line-2400"></span><span>
</span><span id="line-2401"></span><span class="hs-comment">-- Used by diffBinds, which is itself only used in GHC.Core.Lint.lintAnnots</span><span>
</span><span id="line-2402"></span><span class="annot"><a href="GHC.Core.Utils.html#eqTickish"><span class="hs-identifier hs-type">eqTickish</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#RnEnv2"><span class="hs-identifier hs-type">RnEnv2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Tickish.html#CoreTickish"><span class="hs-identifier hs-type">CoreTickish</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Tickish.html#CoreTickish"><span class="hs-identifier hs-type">CoreTickish</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2403"></span><span id="eqTickish"><span class="annot"><span class="annottext">eqTickish :: RnEnv2 -&gt; CoreTickish -&gt; CoreTickish -&gt; Bool
</span><a href="GHC.Core.Utils.html#eqTickish"><span class="hs-identifier hs-var hs-var">eqTickish</span></a></span></span><span> </span><span id="local-6989586621682703375"><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703375"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Tickish.html#Breakpoint"><span class="hs-identifier hs-type">Breakpoint</span></a></span><span> </span><span id="local-6989586621682703377"><span class="annot"><span class="annottext">XBreakpoint 'TickishPassCore
</span><a href="#local-6989586621682703377"><span class="hs-identifier hs-var">lext</span></a></span></span><span> </span><span id="local-6989586621682703378"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703378"><span class="hs-identifier hs-var">lid</span></a></span></span><span> </span><span id="local-6989586621682703379"><span class="annot"><span class="annottext">[XTickishId 'TickishPassCore]
</span><a href="#local-6989586621682703379"><span class="hs-identifier hs-var">lids</span></a></span></span><span> </span><span id="local-6989586621682703380"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682703380"><span class="hs-identifier hs-var">lmod</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Tickish.html#Breakpoint"><span class="hs-identifier hs-type">Breakpoint</span></a></span><span> </span><span id="local-6989586621682703381"><span class="annot"><span class="annottext">XBreakpoint 'TickishPassCore
</span><a href="#local-6989586621682703381"><span class="hs-identifier hs-var">rext</span></a></span></span><span> </span><span id="local-6989586621682703382"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703382"><span class="hs-identifier hs-var">rid</span></a></span></span><span> </span><span id="local-6989586621682703383"><span class="annot"><span class="annottext">[XTickishId 'TickishPassCore]
</span><a href="#local-6989586621682703383"><span class="hs-identifier hs-var">rids</span></a></span></span><span> </span><span id="local-6989586621682703384"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682703384"><span class="hs-identifier hs-var">rmod</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2404"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703378"><span class="hs-identifier hs-var">lid</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703382"><span class="hs-identifier hs-var">rid</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-2405"></span><span>        </span><span class="annot"><span class="annottext">(Id -&gt; Id) -&gt; [Id] -&gt; [Id]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RnEnv2 -&gt; Id -&gt; Id
</span><a href="GHC.Types.Var.Env.html#rnOccL"><span class="hs-identifier hs-var">rnOccL</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703375"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Id]
[XTickishId 'TickishPassCore]
</span><a href="#local-6989586621682703379"><span class="hs-identifier hs-var">lids</span></a></span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; [Id] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Id) -&gt; [Id] -&gt; [Id]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RnEnv2 -&gt; Id -&gt; Id
</span><a href="GHC.Types.Var.Env.html#rnOccR"><span class="hs-identifier hs-var">rnOccR</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703375"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Id]
[XTickishId 'TickishPassCore]
</span><a href="#local-6989586621682703383"><span class="hs-identifier hs-var">rids</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-2406"></span><span>        </span><span class="annot"><span class="annottext">NoExtField
XBreakpoint 'TickishPassCore
</span><a href="#local-6989586621682703377"><span class="hs-identifier hs-var">lext</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField -&gt; NoExtField -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">NoExtField
XBreakpoint 'TickishPassCore
</span><a href="#local-6989586621682703381"><span class="hs-identifier hs-var">rext</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-2407"></span><span>        </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682703380"><span class="hs-identifier hs-var">lmod</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; Module -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682703384"><span class="hs-identifier hs-var">rmod</span></a></span><span>
</span><span id="line-2408"></span><span class="annot"><a href="GHC.Core.Utils.html#eqTickish"><span class="hs-identifier hs-var">eqTickish</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682703387"><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682703387"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621682703388"><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682703388"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682703387"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; CoreTickish -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682703388"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-2409"></span><span>
</span><span id="line-2410"></span><span class="hs-comment">-- | Finds differences between core bindings, see @diffExpr@.</span><span>
</span><span id="line-2411"></span><span class="hs-comment">--</span><span>
</span><span id="line-2412"></span><span class="hs-comment">-- The main problem here is that while we expect the binds to have the</span><span>
</span><span id="line-2413"></span><span class="hs-comment">-- same order in both lists, this is not guaranteed. To do this</span><span>
</span><span id="line-2414"></span><span class="hs-comment">-- properly we'd either have to do some sort of unification or check</span><span>
</span><span id="line-2415"></span><span class="hs-comment">-- all possible mappings, which would be seriously expensive. So</span><span>
</span><span id="line-2416"></span><span class="hs-comment">-- instead we simply match single bindings as far as we can. This</span><span>
</span><span id="line-2417"></span><span class="hs-comment">-- leaves us just with mutually recursive and/or mismatching bindings,</span><span>
</span><span id="line-2418"></span><span class="hs-comment">-- which we then speculatively match by ordering them. It's by no means</span><span>
</span><span id="line-2419"></span><span class="hs-comment">-- perfect, but gets the job done well enough.</span><span>
</span><span id="line-2420"></span><span class="hs-comment">--</span><span>
</span><span id="line-2421"></span><span class="hs-comment">-- Only used in GHC.Core.Lint.lintAnnots</span><span>
</span><span id="line-2422"></span><span class="annot"><a href="GHC.Core.Utils.html#diffBinds"><span class="hs-identifier hs-type">diffBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#RnEnv2"><span class="hs-identifier hs-type">RnEnv2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2423"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#RnEnv2"><span class="hs-identifier hs-type">RnEnv2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2424"></span><span id="diffBinds"><span class="annot"><span class="annottext">diffBinds :: Bool
-&gt; RnEnv2
-&gt; [(Id, CoreExpr)]
-&gt; [(Id, CoreExpr)]
-&gt; ([SDoc], RnEnv2)
</span><a href="GHC.Core.Utils.html#diffBinds"><span class="hs-identifier hs-var hs-var">diffBinds</span></a></span></span><span> </span><span id="local-6989586621682703389"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682703389"><span class="hs-identifier hs-var">top</span></a></span></span><span> </span><span id="local-6989586621682703390"><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703390"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682703391"><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><a href="#local-6989586621682703391"><span class="hs-identifier hs-var">binds1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; RnEnv2
-&gt; [(Id, CoreExpr)]
-&gt; [(Id, CoreExpr)]
-&gt; ([SDoc], RnEnv2)
</span><a href="#local-6989586621682703392"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Id, CoreExpr)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><a href="#local-6989586621682703391"><span class="hs-identifier hs-var">binds1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703390"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><a href="#local-6989586621682703391"><span class="hs-identifier hs-var">binds1</span></a></span><span>
</span><span id="line-2425"></span><span> </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682703392"><span class="annot"><span class="annottext">go :: Int
-&gt; RnEnv2
-&gt; [(Id, CoreExpr)]
-&gt; [(Id, CoreExpr)]
-&gt; ([SDoc], RnEnv2)
</span><a href="#local-6989586621682703392"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span>    </span><span id="local-6989586621682703393"><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703393"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2426"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703393"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2427"></span><span>       </span><span class="annot"><a href="#local-6989586621682703392"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682703394"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703394"><span class="hs-identifier hs-var">_fuel</span></a></span></span><span> </span><span id="local-6989586621682703395"><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703395"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621682703396"><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><a href="#local-6989586621682703396"><span class="hs-identifier hs-var">binds2</span></a></span></span><span>
</span><span id="line-2428"></span><span>          </span><span class="hs-comment">-- No binds remaining to compare on the left? Bail out early.</span><span>
</span><span id="line-2429"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RnEnv2 -&gt; [(Id, CoreExpr)] -&gt; [(Id, CoreExpr)] -&gt; [SDoc]
</span><a href="#local-6989586621682703397"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703395"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><a href="#local-6989586621682703396"><span class="hs-identifier hs-var">binds2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703395"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2430"></span><span>       </span><span class="annot"><a href="#local-6989586621682703392"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682703398"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703398"><span class="hs-identifier hs-var">_fuel</span></a></span></span><span> </span><span id="local-6989586621682703399"><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703399"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682703400"><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><a href="#local-6989586621682703400"><span class="hs-identifier hs-var">binds1</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2431"></span><span>          </span><span class="hs-comment">-- No binds remaining to compare on the right? Bail out early.</span><span>
</span><span id="line-2432"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RnEnv2 -&gt; [(Id, CoreExpr)] -&gt; [(Id, CoreExpr)] -&gt; [SDoc]
</span><a href="#local-6989586621682703397"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703399"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><a href="#local-6989586621682703400"><span class="hs-identifier hs-var">binds1</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703399"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2433"></span><span>       </span><span class="annot"><a href="#local-6989586621682703392"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682703401"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703401"><span class="hs-identifier hs-var">fuel</span></a></span></span><span> </span><span id="local-6989586621682703402"><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703402"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682703403"><span class="annot"><span class="annottext">binds1 :: [(Id, CoreExpr)]
</span><a href="#local-6989586621682703403"><span class="hs-identifier hs-var">binds1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621682703404"><span class="annot"><span class="annottext">(Id, CoreExpr)
</span><a href="#local-6989586621682703404"><span class="hs-identifier hs-var">bind1</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682703405"><span class="annot"><span class="annottext">binds2 :: [(Id, CoreExpr)]
</span><a href="#local-6989586621682703405"><span class="hs-identifier hs-var">binds2</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Id, CoreExpr)
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-2434"></span><span>          </span><span class="hs-comment">-- Iterated over all binds without finding a match? Then</span><span>
</span><span id="line-2435"></span><span>          </span><span class="hs-comment">-- try speculatively matching binders by order.</span><span>
</span><span id="line-2436"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703401"><span class="hs-identifier hs-var">fuel</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-2437"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703402"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2 -&gt; Id -&gt; Bool
</span><a href="GHC.Types.Var.Env.html#inRnEnvL"><span class="hs-operator hs-var">`inRnEnvL`</span></a></span><span> </span><span class="annot"><span class="annottext">(Id, CoreExpr) -&gt; Id
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(Id, CoreExpr)
</span><a href="#local-6989586621682703404"><span class="hs-identifier hs-var">bind1</span></a></span><span>
</span><span id="line-2438"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682703408"><span class="annot"><span class="annottext">env' :: RnEnv2
</span><a href="#local-6989586621682703408"><span class="hs-identifier hs-var hs-var">env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Id] -&gt; [Id] -&gt; RnEnv2) -&gt; ([Id], [Id]) -&gt; RnEnv2
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RnEnv2 -&gt; [Id] -&gt; [Id] -&gt; RnEnv2
</span><a href="GHC.Types.Var.Env.html#rnBndrs2"><span class="hs-identifier hs-var">rnBndrs2</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703402"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(([Id], [Id]) -&gt; RnEnv2) -&gt; ([Id], [Id]) -&gt; RnEnv2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Id, Id)] -&gt; ([Id], [Id])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">([(Id, Id)] -&gt; ([Id], [Id])) -&gt; [(Id, Id)] -&gt; ([Id], [Id])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2439"></span><span>                            </span><span class="annot"><span class="annottext">[Id] -&gt; [Id] -&gt; [(Id, Id)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; [Id]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sort</span></span><span> </span><span class="annot"><span class="annottext">([Id] -&gt; [Id]) -&gt; [Id] -&gt; [Id]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Id, CoreExpr) -&gt; Id) -&gt; [(Id, CoreExpr)] -&gt; [Id]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Id, CoreExpr) -&gt; Id
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><a href="#local-6989586621682703403"><span class="hs-identifier hs-var">binds1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; [Id]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sort</span></span><span> </span><span class="annot"><span class="annottext">([Id] -&gt; [Id]) -&gt; [Id] -&gt; [Id]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Id, CoreExpr) -&gt; Id) -&gt; [(Id, CoreExpr)] -&gt; [Id]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Id, CoreExpr) -&gt; Id
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><a href="#local-6989586621682703405"><span class="hs-identifier hs-var">binds2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2440"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; RnEnv2
-&gt; [(Id, CoreExpr)]
-&gt; [(Id, CoreExpr)]
-&gt; ([SDoc], RnEnv2)
</span><a href="#local-6989586621682703392"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Id, CoreExpr)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><a href="#local-6989586621682703403"><span class="hs-identifier hs-var">binds1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703408"><span class="hs-identifier hs-var">env'</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><a href="#local-6989586621682703403"><span class="hs-identifier hs-var">binds1</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><a href="#local-6989586621682703405"><span class="hs-identifier hs-var">binds2</span></a></span><span>
</span><span id="line-2441"></span><span>            </span><span class="hs-comment">-- If we have already tried that, give up</span><span>
</span><span id="line-2442"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RnEnv2 -&gt; [(Id, CoreExpr)] -&gt; [(Id, CoreExpr)] -&gt; [SDoc]
</span><a href="#local-6989586621682703397"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703402"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><a href="#local-6989586621682703403"><span class="hs-identifier hs-var">binds1</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><a href="#local-6989586621682703405"><span class="hs-identifier hs-var">binds2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703402"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2443"></span><span>       </span><span class="annot"><a href="#local-6989586621682703392"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682703412"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703412"><span class="hs-identifier hs-var">fuel</span></a></span></span><span> </span><span id="local-6989586621682703413"><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703413"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682703414"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703414"><span class="hs-identifier hs-var">bndr1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682703415"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703415"><span class="hs-identifier hs-var">expr1</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682703416"><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><a href="#local-6989586621682703416"><span class="hs-identifier hs-var">binds1</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682703417"><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><a href="#local-6989586621682703417"><span class="hs-identifier hs-var">binds2</span></a></span></span><span>
</span><span id="line-2444"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682703418"><span class="annot"><span class="annottext">matchExpr :: (Id, CoreExpr) -&gt; Bool
</span><a href="#local-6989586621682703418"><span class="hs-identifier hs-var hs-var">matchExpr</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682703419"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703419"><span class="hs-identifier hs-var">bndr</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682703420"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703420"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2445"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703419"><span class="hs-identifier hs-var">bndr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682703389"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RnEnv2 -&gt; Id -&gt; Id -&gt; [SDoc]
</span><a href="GHC.Core.Utils.html#diffIdInfo"><span class="hs-identifier hs-var">diffIdInfo</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703413"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703419"><span class="hs-identifier hs-var">bndr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703414"><span class="hs-identifier hs-var">bndr1</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-2446"></span><span>                  </span><span class="annot"><span class="annottext">[SDoc] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; RnEnv2 -&gt; CoreExpr -&gt; CoreExpr -&gt; [SDoc]
</span><a href="GHC.Core.Utils.html#diffExpr"><span class="hs-identifier hs-var">diffExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682703389"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RnEnv2 -&gt; Id -&gt; Id -&gt; RnEnv2
</span><a href="GHC.Types.Var.Env.html#rnBndr2"><span class="hs-identifier hs-var">rnBndr2</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703413"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703414"><span class="hs-identifier hs-var">bndr1</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703419"><span class="hs-identifier hs-var">bndr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703415"><span class="hs-identifier hs-var">expr1</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703420"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2447"></span><span>
</span><span id="line-2448"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682703424"><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><a href="#local-6989586621682703424"><span class="hs-identifier hs-var">binds2l</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682703425"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703425"><span class="hs-identifier hs-var">bndr2</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682703426"><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><a href="#local-6989586621682703426"><span class="hs-identifier hs-var">binds2r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Id, CoreExpr) -&gt; Bool)
-&gt; [(Id, CoreExpr)] -&gt; ([(Id, CoreExpr)], [(Id, CoreExpr)])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">break</span></span><span> </span><span class="annot"><span class="annottext">(Id, CoreExpr) -&gt; Bool
</span><a href="#local-6989586621682703418"><span class="hs-identifier hs-var">matchExpr</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><a href="#local-6989586621682703417"><span class="hs-identifier hs-var">binds2</span></a></span><span>
</span><span id="line-2449"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; RnEnv2
-&gt; [(Id, CoreExpr)]
-&gt; [(Id, CoreExpr)]
-&gt; ([SDoc], RnEnv2)
</span><a href="#local-6989586621682703392"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Id, CoreExpr)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><a href="#local-6989586621682703416"><span class="hs-identifier hs-var">binds1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RnEnv2 -&gt; Id -&gt; Id -&gt; RnEnv2
</span><a href="GHC.Types.Var.Env.html#rnBndr2"><span class="hs-identifier hs-var">rnBndr2</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703413"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703414"><span class="hs-identifier hs-var">bndr1</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703425"><span class="hs-identifier hs-var">bndr2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2450"></span><span>                </span><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><a href="#local-6989586621682703416"><span class="hs-identifier hs-var">binds1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><a href="#local-6989586621682703424"><span class="hs-identifier hs-var">binds2l</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, CoreExpr)] -&gt; [(Id, CoreExpr)] -&gt; [(Id, CoreExpr)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><a href="#local-6989586621682703426"><span class="hs-identifier hs-var">binds2r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2451"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-comment">-- No match, so push back (FIXME O(n^2))</span><span>
</span><span id="line-2452"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; RnEnv2
-&gt; [(Id, CoreExpr)]
-&gt; [(Id, CoreExpr)]
-&gt; ([SDoc], RnEnv2)
</span><a href="#local-6989586621682703392"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703412"><span class="hs-identifier hs-var">fuel</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703413"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><a href="#local-6989586621682703416"><span class="hs-identifier hs-var">binds1</span></a></span><span class="annot"><span class="annottext">[(Id, CoreExpr)] -&gt; [(Id, CoreExpr)] -&gt; [(Id, CoreExpr)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703414"><span class="hs-identifier hs-var">bndr1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703415"><span class="hs-identifier hs-var">expr1</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><a href="#local-6989586621682703417"><span class="hs-identifier hs-var">binds2</span></a></span><span>
</span><span id="line-2453"></span><span>
</span><span id="line-2454"></span><span>       </span><span class="hs-comment">-- We have tried everything, but couldn't find a good match. So</span><span>
</span><span id="line-2455"></span><span>       </span><span class="hs-comment">-- now we just return the comparison results when we pair up</span><span>
</span><span id="line-2456"></span><span>       </span><span class="hs-comment">-- the binds in a pseudo-random order.</span><span>
</span><span id="line-2457"></span><span>       </span><span id="local-6989586621682703397"><span class="annot"><span class="annottext">warn :: RnEnv2 -&gt; [(Id, CoreExpr)] -&gt; [(Id, CoreExpr)] -&gt; [SDoc]
</span><a href="#local-6989586621682703397"><span class="hs-identifier hs-var hs-var">warn</span></a></span></span><span> </span><span id="local-6989586621682703428"><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703428"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682703429"><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><a href="#local-6989586621682703429"><span class="hs-identifier hs-var">binds1</span></a></span></span><span> </span><span id="local-6989586621682703430"><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><a href="#local-6989586621682703430"><span class="hs-identifier hs-var">binds2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2458"></span><span>         </span><span class="annot"><span class="annottext">(((Id, CoreExpr), (Id, CoreExpr)) -&gt; [SDoc])
-&gt; [((Id, CoreExpr), (Id, CoreExpr))] -&gt; [SDoc]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Id, CoreExpr) -&gt; (Id, CoreExpr) -&gt; [SDoc])
-&gt; ((Id, CoreExpr), (Id, CoreExpr)) -&gt; [SDoc]
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RnEnv2 -&gt; (Id, CoreExpr) -&gt; (Id, CoreExpr) -&gt; [SDoc]
</span><a href="#local-6989586621682703432"><span class="hs-identifier hs-var">diffBind</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703428"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Id, CoreExpr)]
-&gt; [(Id, CoreExpr)] -&gt; [((Id, CoreExpr), (Id, CoreExpr))]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><a href="#local-6989586621682703433"><span class="hs-identifier hs-var">binds1'</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><a href="#local-6989586621682703434"><span class="hs-identifier hs-var">binds2'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; [SDoc] -&gt; [SDoc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-2459"></span><span>         </span><span class="annot"><span class="annottext">String -&gt; [(Id, CoreExpr)] -&gt; [SDoc]
forall {b}. OutputableBndr b =&gt; String -&gt; [(b, Expr b)] -&gt; [SDoc]
</span><a href="#local-6989586621682703435"><span class="hs-identifier hs-var">unmatched</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unmatched left-hand:&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [(Id, CoreExpr)] -&gt; [(Id, CoreExpr)]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703437"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><a href="#local-6989586621682703433"><span class="hs-identifier hs-var">binds1'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; [SDoc] -&gt; [SDoc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-2460"></span><span>         </span><span class="annot"><span class="annottext">String -&gt; [(Id, CoreExpr)] -&gt; [SDoc]
forall {b}. OutputableBndr b =&gt; String -&gt; [(b, Expr b)] -&gt; [SDoc]
</span><a href="#local-6989586621682703435"><span class="hs-identifier hs-var">unmatched</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unmatched right-hand:&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [(Id, CoreExpr)] -&gt; [(Id, CoreExpr)]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682703437"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><a href="#local-6989586621682703434"><span class="hs-identifier hs-var">binds2'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2461"></span><span>        </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682703433"><span class="annot"><span class="annottext">binds1' :: [(Id, CoreExpr)]
</span><a href="#local-6989586621682703433"><span class="hs-identifier hs-var hs-var">binds1'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Id, CoreExpr) -&gt; (Id, CoreExpr) -&gt; Ordering)
-&gt; [(Id, CoreExpr)] -&gt; [(Id, CoreExpr)]
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Id, CoreExpr) -&gt; Id)
-&gt; (Id, CoreExpr) -&gt; (Id, CoreExpr) -&gt; Ordering
forall a b. Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering
</span><span class="hs-identifier hs-var">comparing</span></span><span> </span><span class="annot"><span class="annottext">(Id, CoreExpr) -&gt; Id
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><a href="#local-6989586621682703429"><span class="hs-identifier hs-var">binds1</span></a></span><span>
</span><span id="line-2462"></span><span>              </span><span id="local-6989586621682703434"><span class="annot"><span class="annottext">binds2' :: [(Id, CoreExpr)]
</span><a href="#local-6989586621682703434"><span class="hs-identifier hs-var hs-var">binds2'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Id, CoreExpr) -&gt; (Id, CoreExpr) -&gt; Ordering)
-&gt; [(Id, CoreExpr)] -&gt; [(Id, CoreExpr)]
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Id, CoreExpr) -&gt; Id)
-&gt; (Id, CoreExpr) -&gt; (Id, CoreExpr) -&gt; Ordering
forall a b. Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering
</span><span class="hs-identifier hs-var">comparing</span></span><span> </span><span class="annot"><span class="annottext">(Id, CoreExpr) -&gt; Id
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><a href="#local-6989586621682703430"><span class="hs-identifier hs-var">binds2</span></a></span><span>
</span><span id="line-2463"></span><span>              </span><span id="local-6989586621682703437"><span class="annot"><span class="annottext">l :: Int
</span><a href="#local-6989586621682703437"><span class="hs-identifier hs-var hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Id, CoreExpr)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><a href="#local-6989586621682703433"><span class="hs-identifier hs-var">binds1'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Id, CoreExpr)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><a href="#local-6989586621682703434"><span class="hs-identifier hs-var">binds2'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2464"></span><span>       </span><span id="local-6989586621682703435"><span class="annot"><span class="annottext">unmatched :: String -&gt; [(b, Expr b)] -&gt; [SDoc]
</span><a href="#local-6989586621682703435"><span class="hs-identifier hs-var hs-var">unmatched</span></a></span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2465"></span><span>       </span><span class="annot"><a href="#local-6989586621682703435"><span class="hs-identifier hs-var">unmatched</span></a></span><span> </span><span id="local-6989586621682703448"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682703448"><span class="hs-identifier hs-var">txt</span></a></span></span><span> </span><span id="local-6989586621682703449"><span class="annot"><span class="annottext">[(b, Expr b)]
</span><a href="#local-6989586621682703449"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682703448"><span class="hs-identifier hs-var">txt</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Bind b -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(b, Expr b)] -&gt; Bind b
forall b. [(b, Expr b)] -&gt; Bind b
</span><a href="GHC.Core.html#Rec"><span class="hs-identifier hs-var">Rec</span></a></span><span> </span><span class="annot"><span class="annottext">[(b, Expr b)]
</span><a href="#local-6989586621682703449"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2466"></span><span>       </span><span id="local-6989586621682703432"><span class="annot"><span class="annottext">diffBind :: RnEnv2 -&gt; (Id, CoreExpr) -&gt; (Id, CoreExpr) -&gt; [SDoc]
</span><a href="#local-6989586621682703432"><span class="hs-identifier hs-var hs-var">diffBind</span></a></span></span><span> </span><span id="local-6989586621682703450"><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703450"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682703451"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703451"><span class="hs-identifier hs-var">bndr1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682703452"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703452"><span class="hs-identifier hs-var">expr1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682703453"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703453"><span class="hs-identifier hs-var">bndr2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682703454"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703454"><span class="hs-identifier hs-var">expr2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2467"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682703455"><span class="annot"><span class="annottext">ds :: [SDoc]
</span><a href="#local-6989586621682703455"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[SDoc]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; RnEnv2 -&gt; CoreExpr -&gt; CoreExpr -&gt; [SDoc]
</span><a href="GHC.Core.Utils.html#diffExpr"><span class="hs-identifier hs-var">diffExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682703389"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703450"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703452"><span class="hs-identifier hs-var">expr1</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703454"><span class="hs-identifier hs-var">expr2</span></a></span><span>
</span><span id="line-2468"></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Id -&gt; Id -&gt; [SDoc] -&gt; [SDoc]
</span><a href="GHC.Core.Utils.html#locBind"><span class="hs-identifier hs-var">locBind</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;in binding&quot;</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703451"><span class="hs-identifier hs-var">bndr1</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703453"><span class="hs-identifier hs-var">bndr2</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621682703455"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-2469"></span><span>         </span><span class="hs-comment">-- Special case for TyVar, which we checked were bound to the same types in</span><span>
</span><span id="line-2470"></span><span>         </span><span class="hs-comment">-- diffExpr, but don't have any IdInfo we would panic if called diffIdInfo.</span><span>
</span><span id="line-2471"></span><span>         </span><span class="hs-comment">-- These let-bound types are created temporarily by the simplifier but inlined</span><span>
</span><span id="line-2472"></span><span>         </span><span class="hs-comment">-- immediately.</span><span>
</span><span id="line-2473"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703451"><span class="hs-identifier hs-var">bndr1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703453"><span class="hs-identifier hs-var">bndr2</span></a></span><span>
</span><span id="line-2474"></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2475"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2476"></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RnEnv2 -&gt; Id -&gt; Id -&gt; [SDoc]
</span><a href="GHC.Core.Utils.html#diffIdInfo"><span class="hs-identifier hs-var">diffIdInfo</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703450"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703451"><span class="hs-identifier hs-var">bndr1</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703453"><span class="hs-identifier hs-var">bndr2</span></a></span><span>
</span><span id="line-2477"></span><span>
</span><span id="line-2478"></span><span class="hs-comment">-- | Finds differences between core expressions, modulo alpha and</span><span>
</span><span id="line-2479"></span><span class="hs-comment">-- renaming. Setting @top@ means that the @IdInfo@ of bindings will be</span><span>
</span><span id="line-2480"></span><span class="hs-comment">-- checked for differences as well.</span><span>
</span><span id="line-2481"></span><span class="annot"><a href="GHC.Core.Utils.html#diffExpr"><span class="hs-identifier hs-type">diffExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#RnEnv2"><span class="hs-identifier hs-type">RnEnv2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2482"></span><span id="diffExpr"><span class="annot"><span class="annottext">diffExpr :: Bool -&gt; RnEnv2 -&gt; CoreExpr -&gt; CoreExpr -&gt; [SDoc]
</span><a href="GHC.Core.Utils.html#diffExpr"><span class="hs-identifier hs-var hs-var">diffExpr</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span>   </span><span id="local-6989586621682703457"><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703457"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682703458"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703458"><span class="hs-identifier hs-var">v1</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682703459"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703459"><span class="hs-identifier hs-var">v2</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">RnEnv2 -&gt; Id -&gt; Id
</span><a href="GHC.Types.Var.Env.html#rnOccL"><span class="hs-identifier hs-var">rnOccL</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703457"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703458"><span class="hs-identifier hs-var">v1</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Id -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">RnEnv2 -&gt; Id -&gt; Id
</span><a href="GHC.Types.Var.Env.html#rnOccR"><span class="hs-identifier hs-var">rnOccR</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703457"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703459"><span class="hs-identifier hs-var">v2</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2483"></span><span class="annot"><a href="GHC.Core.Utils.html#diffExpr"><span class="hs-identifier hs-var">diffExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span>   </span><span class="annot"><span class="annottext">RnEnv2
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span id="local-6989586621682703460"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682703460"><span class="hs-identifier hs-var">lit1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span id="local-6989586621682703461"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682703461"><span class="hs-identifier hs-var">lit2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682703460"><span class="hs-identifier hs-var">lit1</span></a></span><span> </span><span class="annot"><span class="annottext">Literal -&gt; Literal -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682703461"><span class="hs-identifier hs-var">lit2</span></a></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2484"></span><span class="annot"><a href="GHC.Core.Utils.html#diffExpr"><span class="hs-identifier hs-var">diffExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span>   </span><span id="local-6989586621682703462"><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703462"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span id="local-6989586621682703463"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703463"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span id="local-6989586621682703464"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703464"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; RnEnv2 -&gt; Type -&gt; Type -&gt; Bool
RnEnv2 -&gt; Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqTypeX"><span class="hs-identifier hs-var">eqTypeX</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703462"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703463"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703464"><span class="hs-identifier hs-var">t2</span></a></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2485"></span><span class="annot"><a href="GHC.Core.Utils.html#diffExpr"><span class="hs-identifier hs-var">diffExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span>   </span><span id="local-6989586621682703465"><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703465"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span id="local-6989586621682703466"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682703466"><span class="hs-identifier hs-var">co1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span id="local-6989586621682703467"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682703467"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2486"></span><span>                                       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">RnEnv2 -&gt; Coercion -&gt; Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#eqCoercionX"><span class="hs-identifier hs-var">eqCoercionX</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703465"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682703466"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682703467"><span class="hs-identifier hs-var">co2</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2487"></span><span class="annot"><a href="GHC.Core.Utils.html#diffExpr"><span class="hs-identifier hs-var">diffExpr</span></a></span><span> </span><span id="local-6989586621682703469"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682703469"><span class="hs-identifier hs-var">top</span></a></span></span><span> </span><span id="local-6989586621682703470"><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703470"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Cast"><span class="hs-identifier hs-type">Cast</span></a></span><span> </span><span id="local-6989586621682703471"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703471"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621682703472"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682703472"><span class="hs-identifier hs-var">co1</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Cast"><span class="hs-identifier hs-type">Cast</span></a></span><span> </span><span id="local-6989586621682703473"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703473"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span id="local-6989586621682703474"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682703474"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2488"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">RnEnv2 -&gt; Coercion -&gt; Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#eqCoercionX"><span class="hs-identifier hs-var">eqCoercionX</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703470"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682703472"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682703474"><span class="hs-identifier hs-var">co2</span></a></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; RnEnv2 -&gt; CoreExpr -&gt; CoreExpr -&gt; [SDoc]
</span><a href="GHC.Core.Utils.html#diffExpr"><span class="hs-identifier hs-var">diffExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682703469"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703470"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703471"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703473"><span class="hs-identifier hs-var">e2</span></a></span><span>
</span><span id="line-2489"></span><span class="annot"><a href="GHC.Core.Utils.html#diffExpr"><span class="hs-identifier hs-var">diffExpr</span></a></span><span> </span><span id="local-6989586621682703475"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682703475"><span class="hs-identifier hs-var">top</span></a></span></span><span> </span><span id="local-6989586621682703476"><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703476"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-type">Tick</span></a></span><span> </span><span id="local-6989586621682703477"><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682703477"><span class="hs-identifier hs-var">n1</span></a></span></span><span> </span><span id="local-6989586621682703478"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703478"><span class="hs-identifier hs-var">e1</span></a></span></span><span class="hs-special">)</span><span>   </span><span id="local-6989586621682703479"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703479"><span class="hs-identifier hs-var">e2</span></a></span></span><span>
</span><span id="line-2490"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreTickish -&gt; Bool
forall (pass :: TickishPass). GenTickish pass -&gt; Bool
</span><a href="GHC.Types.Tickish.html#tickishIsCode"><span class="hs-identifier hs-var">tickishIsCode</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682703477"><span class="hs-identifier hs-var">n1</span></a></span><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; RnEnv2 -&gt; CoreExpr -&gt; CoreExpr -&gt; [SDoc]
</span><a href="GHC.Core.Utils.html#diffExpr"><span class="hs-identifier hs-var">diffExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682703475"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703476"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703478"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703479"><span class="hs-identifier hs-var">e2</span></a></span><span>
</span><span id="line-2491"></span><span class="annot"><a href="GHC.Core.Utils.html#diffExpr"><span class="hs-identifier hs-var">diffExpr</span></a></span><span> </span><span id="local-6989586621682703480"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682703480"><span class="hs-identifier hs-var">top</span></a></span></span><span> </span><span id="local-6989586621682703481"><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703481"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682703482"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703482"><span class="hs-identifier hs-var">e1</span></a></span></span><span>             </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-type">Tick</span></a></span><span> </span><span id="local-6989586621682703483"><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682703483"><span class="hs-identifier hs-var">n2</span></a></span></span><span> </span><span id="local-6989586621682703484"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703484"><span class="hs-identifier hs-var">e2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2492"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreTickish -&gt; Bool
forall (pass :: TickishPass). GenTickish pass -&gt; Bool
</span><a href="GHC.Types.Tickish.html#tickishIsCode"><span class="hs-identifier hs-var">tickishIsCode</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682703483"><span class="hs-identifier hs-var">n2</span></a></span><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; RnEnv2 -&gt; CoreExpr -&gt; CoreExpr -&gt; [SDoc]
</span><a href="GHC.Core.Utils.html#diffExpr"><span class="hs-identifier hs-var">diffExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682703480"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703481"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703482"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703484"><span class="hs-identifier hs-var">e2</span></a></span><span>
</span><span id="line-2493"></span><span class="annot"><a href="GHC.Core.Utils.html#diffExpr"><span class="hs-identifier hs-var">diffExpr</span></a></span><span> </span><span id="local-6989586621682703485"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682703485"><span class="hs-identifier hs-var">top</span></a></span></span><span> </span><span id="local-6989586621682703486"><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703486"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-type">Tick</span></a></span><span> </span><span id="local-6989586621682703487"><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682703487"><span class="hs-identifier hs-var">n1</span></a></span></span><span> </span><span id="local-6989586621682703488"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703488"><span class="hs-identifier hs-var">e1</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-type">Tick</span></a></span><span> </span><span id="local-6989586621682703489"><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682703489"><span class="hs-identifier hs-var">n2</span></a></span></span><span> </span><span id="local-6989586621682703490"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703490"><span class="hs-identifier hs-var">e2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2494"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">RnEnv2 -&gt; CoreTickish -&gt; CoreTickish -&gt; Bool
</span><a href="GHC.Core.Utils.html#eqTickish"><span class="hs-identifier hs-var">eqTickish</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703486"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682703487"><span class="hs-identifier hs-var">n1</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621682703489"><span class="hs-identifier hs-var">n2</span></a></span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; RnEnv2 -&gt; CoreExpr -&gt; CoreExpr -&gt; [SDoc]
</span><a href="GHC.Core.Utils.html#diffExpr"><span class="hs-identifier hs-var">diffExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682703485"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703486"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703488"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703490"><span class="hs-identifier hs-var">e2</span></a></span><span>
</span><span id="line-2495"></span><span> </span><span class="hs-comment">-- The error message of failed pattern matches will contain</span><span>
</span><span id="line-2496"></span><span> </span><span class="hs-comment">-- generated names, which are allowed to differ.</span><span>
</span><span id="line-2497"></span><span class="annot"><a href="GHC.Core.Utils.html#diffExpr"><span class="hs-identifier hs-var">diffExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span>   </span><span class="annot"><span class="annottext">RnEnv2
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#App"><span class="hs-identifier hs-type">App</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#App"><span class="hs-identifier hs-type">App</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682703491"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703491"><span class="hs-identifier hs-var">absent</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-2498"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#App"><span class="hs-identifier hs-type">App</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#App"><span class="hs-identifier hs-type">App</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682703492"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703492"><span class="hs-identifier hs-var">absent2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-2499"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Id.html#isDeadEndId"><span class="hs-identifier hs-var">isDeadEndId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703491"><span class="hs-identifier hs-var">absent</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Id.html#isDeadEndId"><span class="hs-identifier hs-var">isDeadEndId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703492"><span class="hs-identifier hs-var">absent2</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2500"></span><span class="annot"><a href="GHC.Core.Utils.html#diffExpr"><span class="hs-identifier hs-var">diffExpr</span></a></span><span> </span><span id="local-6989586621682703493"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682703493"><span class="hs-identifier hs-var">top</span></a></span></span><span> </span><span id="local-6989586621682703494"><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703494"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#App"><span class="hs-identifier hs-type">App</span></a></span><span> </span><span id="local-6989586621682703495"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703495"><span class="hs-identifier hs-var">f1</span></a></span></span><span> </span><span id="local-6989586621682703496"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703496"><span class="hs-identifier hs-var">a1</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#App"><span class="hs-identifier hs-type">App</span></a></span><span> </span><span id="local-6989586621682703497"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703497"><span class="hs-identifier hs-var">f2</span></a></span></span><span> </span><span id="local-6989586621682703498"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703498"><span class="hs-identifier hs-var">a2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2501"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; RnEnv2 -&gt; CoreExpr -&gt; CoreExpr -&gt; [SDoc]
</span><a href="GHC.Core.Utils.html#diffExpr"><span class="hs-identifier hs-var">diffExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682703493"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703494"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703495"><span class="hs-identifier hs-var">f1</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703497"><span class="hs-identifier hs-var">f2</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; [SDoc] -&gt; [SDoc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; RnEnv2 -&gt; CoreExpr -&gt; CoreExpr -&gt; [SDoc]
</span><a href="GHC.Core.Utils.html#diffExpr"><span class="hs-identifier hs-var">diffExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682703493"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703494"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703496"><span class="hs-identifier hs-var">a1</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703498"><span class="hs-identifier hs-var">a2</span></a></span><span>
</span><span id="line-2502"></span><span class="annot"><a href="GHC.Core.Utils.html#diffExpr"><span class="hs-identifier hs-var">diffExpr</span></a></span><span> </span><span id="local-6989586621682703499"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682703499"><span class="hs-identifier hs-var">top</span></a></span></span><span> </span><span id="local-6989586621682703500"><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703500"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-type">Lam</span></a></span><span> </span><span id="local-6989586621682703501"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703501"><span class="hs-identifier hs-var">b1</span></a></span></span><span> </span><span id="local-6989586621682703502"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703502"><span class="hs-identifier hs-var">e1</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-type">Lam</span></a></span><span> </span><span id="local-6989586621682703503"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703503"><span class="hs-identifier hs-var">b2</span></a></span></span><span> </span><span id="local-6989586621682703504"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703504"><span class="hs-identifier hs-var">e2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2503"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; RnEnv2 -&gt; Type -&gt; Type -&gt; Bool
RnEnv2 -&gt; Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqTypeX"><span class="hs-identifier hs-var">eqTypeX</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703500"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Var.html#varType"><span class="hs-identifier hs-var">varType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703501"><span class="hs-identifier hs-var">b1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Var.html#varType"><span class="hs-identifier hs-var">varType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703503"><span class="hs-identifier hs-var">b2</span></a></span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- False for Id/TyVar combination</span><span>
</span><span id="line-2504"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; RnEnv2 -&gt; CoreExpr -&gt; CoreExpr -&gt; [SDoc]
</span><a href="GHC.Core.Utils.html#diffExpr"><span class="hs-identifier hs-var">diffExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682703499"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RnEnv2 -&gt; Id -&gt; Id -&gt; RnEnv2
</span><a href="GHC.Types.Var.Env.html#rnBndr2"><span class="hs-identifier hs-var">rnBndr2</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703500"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703501"><span class="hs-identifier hs-var">b1</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703503"><span class="hs-identifier hs-var">b2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703502"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703504"><span class="hs-identifier hs-var">e2</span></a></span><span>
</span><span id="line-2505"></span><span class="annot"><a href="GHC.Core.Utils.html#diffExpr"><span class="hs-identifier hs-var">diffExpr</span></a></span><span> </span><span id="local-6989586621682703505"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682703505"><span class="hs-identifier hs-var">top</span></a></span></span><span> </span><span id="local-6989586621682703506"><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703506"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span id="local-6989586621682703507"><span class="annot"><span class="annottext">Bind Id
</span><a href="#local-6989586621682703507"><span class="hs-identifier hs-var">bs1</span></a></span></span><span> </span><span id="local-6989586621682703508"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703508"><span class="hs-identifier hs-var">e1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span id="local-6989586621682703509"><span class="annot"><span class="annottext">Bind Id
</span><a href="#local-6989586621682703509"><span class="hs-identifier hs-var">bs2</span></a></span></span><span> </span><span id="local-6989586621682703510"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703510"><span class="hs-identifier hs-var">e2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2506"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682703511"><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621682703511"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682703512"><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703512"><span class="hs-identifier hs-var">env'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; RnEnv2
-&gt; [(Id, CoreExpr)]
-&gt; [(Id, CoreExpr)]
-&gt; ([SDoc], RnEnv2)
</span><a href="GHC.Core.Utils.html#diffBinds"><span class="hs-identifier hs-var">diffBinds</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682703505"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703506"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Bind Id] -&gt; [(Id, CoreExpr)]
forall b. [Bind b] -&gt; [(b, Expr b)]
</span><a href="GHC.Core.html#flattenBinds"><span class="hs-identifier hs-var">flattenBinds</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Bind Id
</span><a href="#local-6989586621682703507"><span class="hs-identifier hs-var">bs1</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Bind Id] -&gt; [(Id, CoreExpr)]
forall b. [Bind b] -&gt; [(b, Expr b)]
</span><a href="GHC.Core.html#flattenBinds"><span class="hs-identifier hs-var">flattenBinds</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Bind Id
</span><a href="#local-6989586621682703509"><span class="hs-identifier hs-var">bs2</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2507"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621682703511"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; [SDoc] -&gt; [SDoc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; RnEnv2 -&gt; CoreExpr -&gt; CoreExpr -&gt; [SDoc]
</span><a href="GHC.Core.Utils.html#diffExpr"><span class="hs-identifier hs-var">diffExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682703505"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703512"><span class="hs-identifier hs-var">env'</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703508"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703510"><span class="hs-identifier hs-var">e2</span></a></span><span>
</span><span id="line-2508"></span><span class="annot"><a href="GHC.Core.Utils.html#diffExpr"><span class="hs-identifier hs-var">diffExpr</span></a></span><span> </span><span id="local-6989586621682703514"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682703514"><span class="hs-identifier hs-var">top</span></a></span></span><span> </span><span id="local-6989586621682703515"><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703515"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Case"><span class="hs-identifier hs-type">Case</span></a></span><span> </span><span id="local-6989586621682703516"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703516"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621682703517"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703517"><span class="hs-identifier hs-var">b1</span></a></span></span><span> </span><span id="local-6989586621682703518"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703518"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621682703519"><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682703519"><span class="hs-identifier hs-var">a1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Case"><span class="hs-identifier hs-type">Case</span></a></span><span> </span><span id="local-6989586621682703520"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703520"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span id="local-6989586621682703521"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703521"><span class="hs-identifier hs-var">b2</span></a></span></span><span> </span><span id="local-6989586621682703522"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703522"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span id="local-6989586621682703523"><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682703523"><span class="hs-identifier hs-var">a2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2509"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Alt Id] -&gt; [Alt Id] -&gt; Bool
forall a b. [a] -&gt; [b] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#equalLength"><span class="hs-identifier hs-var">equalLength</span></a></span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682703519"><span class="hs-identifier hs-var">a1</span></a></span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682703523"><span class="hs-identifier hs-var">a2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Alt Id] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682703519"><span class="hs-identifier hs-var">a1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; RnEnv2 -&gt; Type -&gt; Type -&gt; Bool
RnEnv2 -&gt; Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqTypeX"><span class="hs-identifier hs-var">eqTypeX</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703515"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703518"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703522"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-2510"></span><span>    </span><span class="hs-comment">-- See Note [Empty case alternatives] in GHC.Data.TrieMap</span><span>
</span><span id="line-2511"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; RnEnv2 -&gt; CoreExpr -&gt; CoreExpr -&gt; [SDoc]
</span><a href="GHC.Core.Utils.html#diffExpr"><span class="hs-identifier hs-var">diffExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682703514"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703515"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703516"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703520"><span class="hs-identifier hs-var">e2</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; [SDoc] -&gt; [SDoc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[[SDoc]] -&gt; [SDoc]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Alt Id -&gt; Alt Id -&gt; [SDoc]) -&gt; [Alt Id] -&gt; [Alt Id] -&gt; [[SDoc]]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">Alt Id -&gt; Alt Id -&gt; [SDoc]
</span><a href="#local-6989586621682703524"><span class="hs-identifier hs-var">diffAlt</span></a></span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682703519"><span class="hs-identifier hs-var">a1</span></a></span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682703523"><span class="hs-identifier hs-var">a2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2512"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682703525"><span class="annot"><span class="annottext">env' :: RnEnv2
</span><a href="#local-6989586621682703525"><span class="hs-identifier hs-var hs-var">env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RnEnv2 -&gt; Id -&gt; Id -&gt; RnEnv2
</span><a href="GHC.Types.Var.Env.html#rnBndr2"><span class="hs-identifier hs-var">rnBndr2</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703515"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703517"><span class="hs-identifier hs-var">b1</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703521"><span class="hs-identifier hs-var">b2</span></a></span><span>
</span><span id="line-2513"></span><span>        </span><span id="local-6989586621682703524"><span class="annot"><span class="annottext">diffAlt :: Alt Id -&gt; Alt Id -&gt; [SDoc]
</span><a href="#local-6989586621682703524"><span class="hs-identifier hs-var hs-var">diffAlt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span id="local-6989586621682703526"><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621682703526"><span class="hs-identifier hs-var">c1</span></a></span></span><span> </span><span id="local-6989586621682703527"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682703527"><span class="hs-identifier hs-var">bs1</span></a></span></span><span> </span><span id="local-6989586621682703528"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703528"><span class="hs-identifier hs-var">e1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span id="local-6989586621682703529"><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621682703529"><span class="hs-identifier hs-var">c2</span></a></span></span><span> </span><span id="local-6989586621682703530"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682703530"><span class="hs-identifier hs-var">bs2</span></a></span></span><span> </span><span id="local-6989586621682703531"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703531"><span class="hs-identifier hs-var">e2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2514"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621682703526"><span class="hs-identifier hs-var">c1</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon -&gt; AltCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621682703529"><span class="hs-identifier hs-var">c2</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;alt-cons &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621682703526"><span class="hs-identifier hs-var">c1</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; /= &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621682703529"><span class="hs-identifier hs-var">c2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2515"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; RnEnv2 -&gt; CoreExpr -&gt; CoreExpr -&gt; [SDoc]
</span><a href="GHC.Core.Utils.html#diffExpr"><span class="hs-identifier hs-var">diffExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682703514"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RnEnv2 -&gt; [Id] -&gt; [Id] -&gt; RnEnv2
</span><a href="GHC.Types.Var.Env.html#rnBndrs2"><span class="hs-identifier hs-var">rnBndrs2</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703525"><span class="hs-identifier hs-var">env'</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682703527"><span class="hs-identifier hs-var">bs1</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682703530"><span class="hs-identifier hs-var">bs2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703528"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703531"><span class="hs-identifier hs-var">e2</span></a></span><span>
</span><span id="line-2516"></span><span class="annot"><a href="GHC.Core.Utils.html#diffExpr"><span class="hs-identifier hs-var">diffExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span>  </span><span class="annot"><span class="annottext">RnEnv2
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682703532"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703532"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621682703533"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703533"><span class="hs-identifier hs-var">e2</span></a></span></span><span>
</span><span id="line-2517"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#fsep"><span class="hs-identifier hs-var">fsep</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CoreExpr -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703532"><span class="hs-identifier hs-var">e1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;/=&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703533"><span class="hs-identifier hs-var">e2</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-2518"></span><span>
</span><span id="line-2519"></span><span class="hs-comment">-- | Find differences in @IdInfo@. We will especially check whether</span><span>
</span><span id="line-2520"></span><span class="hs-comment">-- the unfoldings match, if present (see @diffUnfold@).</span><span>
</span><span id="line-2521"></span><span class="annot"><a href="GHC.Core.Utils.html#diffIdInfo"><span class="hs-identifier hs-type">diffIdInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#RnEnv2"><span class="hs-identifier hs-type">RnEnv2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2522"></span><span id="diffIdInfo"><span class="annot"><span class="annottext">diffIdInfo :: RnEnv2 -&gt; Id -&gt; Id -&gt; [SDoc]
</span><a href="GHC.Core.Utils.html#diffIdInfo"><span class="hs-identifier hs-var hs-var">diffIdInfo</span></a></span></span><span> </span><span id="local-6989586621682703535"><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703535"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682703536"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703536"><span class="hs-identifier hs-var">bndr1</span></a></span></span><span> </span><span id="local-6989586621682703537"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703537"><span class="hs-identifier hs-var">bndr2</span></a></span></span><span>
</span><span id="line-2523"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IdInfo -&gt; Int
</span><a href="GHC.Types.Id.Info.html#arityInfo"><span class="hs-identifier hs-var">arityInfo</span></a></span><span> </span><span class="annot"><span class="annottext">IdInfo
</span><a href="#local-6989586621682703539"><span class="hs-identifier hs-var">info1</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">IdInfo -&gt; Int
</span><a href="GHC.Types.Id.Info.html#arityInfo"><span class="hs-identifier hs-var">arityInfo</span></a></span><span> </span><span class="annot"><span class="annottext">IdInfo
</span><a href="#local-6989586621682703540"><span class="hs-identifier hs-var">info2</span></a></span><span>
</span><span id="line-2524"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">IdInfo -&gt; CafInfo
</span><a href="GHC.Types.Id.Info.html#cafInfo"><span class="hs-identifier hs-var">cafInfo</span></a></span><span> </span><span class="annot"><span class="annottext">IdInfo
</span><a href="#local-6989586621682703539"><span class="hs-identifier hs-var">info1</span></a></span><span> </span><span class="annot"><span class="annottext">CafInfo -&gt; CafInfo -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">IdInfo -&gt; CafInfo
</span><a href="GHC.Types.Id.Info.html#cafInfo"><span class="hs-identifier hs-var">cafInfo</span></a></span><span> </span><span class="annot"><span class="annottext">IdInfo
</span><a href="#local-6989586621682703540"><span class="hs-identifier hs-var">info2</span></a></span><span>
</span><span id="line-2525"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">IdInfo -&gt; OneShotInfo
</span><a href="GHC.Types.Id.Info.html#oneShotInfo"><span class="hs-identifier hs-var">oneShotInfo</span></a></span><span> </span><span class="annot"><span class="annottext">IdInfo
</span><a href="#local-6989586621682703539"><span class="hs-identifier hs-var">info1</span></a></span><span> </span><span class="annot"><span class="annottext">OneShotInfo -&gt; OneShotInfo -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">IdInfo -&gt; OneShotInfo
</span><a href="GHC.Types.Id.Info.html#oneShotInfo"><span class="hs-identifier hs-var">oneShotInfo</span></a></span><span> </span><span class="annot"><span class="annottext">IdInfo
</span><a href="#local-6989586621682703540"><span class="hs-identifier hs-var">info2</span></a></span><span>
</span><span id="line-2526"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">IdInfo -&gt; InlinePragma
</span><a href="GHC.Types.Id.Info.html#inlinePragInfo"><span class="hs-identifier hs-var">inlinePragInfo</span></a></span><span> </span><span class="annot"><span class="annottext">IdInfo
</span><a href="#local-6989586621682703539"><span class="hs-identifier hs-var">info1</span></a></span><span> </span><span class="annot"><span class="annottext">InlinePragma -&gt; InlinePragma -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">IdInfo -&gt; InlinePragma
</span><a href="GHC.Types.Id.Info.html#inlinePragInfo"><span class="hs-identifier hs-var">inlinePragInfo</span></a></span><span> </span><span class="annot"><span class="annottext">IdInfo
</span><a href="#local-6989586621682703540"><span class="hs-identifier hs-var">info2</span></a></span><span>
</span><span id="line-2527"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">IdInfo -&gt; OccInfo
</span><a href="GHC.Types.Id.Info.html#occInfo"><span class="hs-identifier hs-var">occInfo</span></a></span><span> </span><span class="annot"><span class="annottext">IdInfo
</span><a href="#local-6989586621682703539"><span class="hs-identifier hs-var">info1</span></a></span><span> </span><span class="annot"><span class="annottext">OccInfo -&gt; OccInfo -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">IdInfo -&gt; OccInfo
</span><a href="GHC.Types.Id.Info.html#occInfo"><span class="hs-identifier hs-var">occInfo</span></a></span><span> </span><span class="annot"><span class="annottext">IdInfo
</span><a href="#local-6989586621682703540"><span class="hs-identifier hs-var">info2</span></a></span><span>
</span><span id="line-2528"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">IdInfo -&gt; Demand
</span><a href="GHC.Types.Id.Info.html#demandInfo"><span class="hs-identifier hs-var">demandInfo</span></a></span><span> </span><span class="annot"><span class="annottext">IdInfo
</span><a href="#local-6989586621682703539"><span class="hs-identifier hs-var">info1</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Demand -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">IdInfo -&gt; Demand
</span><a href="GHC.Types.Id.Info.html#demandInfo"><span class="hs-identifier hs-var">demandInfo</span></a></span><span> </span><span class="annot"><span class="annottext">IdInfo
</span><a href="#local-6989586621682703540"><span class="hs-identifier hs-var">info2</span></a></span><span>
</span><span id="line-2529"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">IdInfo -&gt; Int
</span><a href="GHC.Types.Id.Info.html#callArityInfo"><span class="hs-identifier hs-var">callArityInfo</span></a></span><span> </span><span class="annot"><span class="annottext">IdInfo
</span><a href="#local-6989586621682703539"><span class="hs-identifier hs-var">info1</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">IdInfo -&gt; Int
</span><a href="GHC.Types.Id.Info.html#callArityInfo"><span class="hs-identifier hs-var">callArityInfo</span></a></span><span> </span><span class="annot"><span class="annottext">IdInfo
</span><a href="#local-6989586621682703540"><span class="hs-identifier hs-var">info2</span></a></span><span>
</span><span id="line-2530"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Id -&gt; Id -&gt; [SDoc] -&gt; [SDoc]
</span><a href="GHC.Core.Utils.html#locBind"><span class="hs-identifier hs-var">locBind</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;in unfolding of&quot;</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703536"><span class="hs-identifier hs-var">bndr1</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703537"><span class="hs-identifier hs-var">bndr2</span></a></span><span> </span><span class="annot"><span class="annottext">([SDoc] -&gt; [SDoc]) -&gt; [SDoc] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2531"></span><span>    </span><span class="annot"><span class="annottext">RnEnv2 -&gt; Unfolding -&gt; Unfolding -&gt; [SDoc]
</span><a href="GHC.Core.Utils.html#diffUnfold"><span class="hs-identifier hs-var">diffUnfold</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703535"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IdInfo -&gt; Unfolding
</span><a href="GHC.Types.Id.Info.html#realUnfoldingInfo"><span class="hs-identifier hs-var">realUnfoldingInfo</span></a></span><span> </span><span class="annot"><span class="annottext">IdInfo
</span><a href="#local-6989586621682703539"><span class="hs-identifier hs-var">info1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IdInfo -&gt; Unfolding
</span><a href="GHC.Types.Id.Info.html#realUnfoldingInfo"><span class="hs-identifier hs-var">realUnfoldingInfo</span></a></span><span> </span><span class="annot"><span class="annottext">IdInfo
</span><a href="#local-6989586621682703540"><span class="hs-identifier hs-var">info2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2532"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2533"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Id -&gt; Id -&gt; [SDoc] -&gt; [SDoc]
</span><a href="GHC.Core.Utils.html#locBind"><span class="hs-identifier hs-var">locBind</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;in Id info of&quot;</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703536"><span class="hs-identifier hs-var">bndr1</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703537"><span class="hs-identifier hs-var">bndr2</span></a></span><span>
</span><span id="line-2534"></span><span>    </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#fsep"><span class="hs-identifier hs-var">fsep</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BindingSite -&gt; Id -&gt; SDoc
forall a. OutputableBndr a =&gt; BindingSite -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pprBndr"><span class="hs-identifier hs-var">pprBndr</span></a></span><span> </span><span class="annot"><span class="annottext">BindingSite
</span><a href="GHC.Utils.Outputable.html#LetBind"><span class="hs-identifier hs-var">LetBind</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703536"><span class="hs-identifier hs-var">bndr1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;/=&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BindingSite -&gt; Id -&gt; SDoc
forall a. OutputableBndr a =&gt; BindingSite -&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pprBndr"><span class="hs-identifier hs-var">pprBndr</span></a></span><span> </span><span class="annot"><span class="annottext">BindingSite
</span><a href="GHC.Utils.Outputable.html#LetBind"><span class="hs-identifier hs-var">LetBind</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703537"><span class="hs-identifier hs-var">bndr2</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-2535"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682703539"><span class="annot"><span class="annottext">info1 :: IdInfo
</span><a href="#local-6989586621682703539"><span class="hs-identifier hs-var hs-var">info1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Id -&gt; IdInfo
Id -&gt; IdInfo
</span><a href="GHC.Types.Var.html#idInfo"><span class="hs-identifier hs-var">idInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703536"><span class="hs-identifier hs-var">bndr1</span></a></span><span class="hs-special">;</span><span> </span><span id="local-6989586621682703540"><span class="annot"><span class="annottext">info2 :: IdInfo
</span><a href="#local-6989586621682703540"><span class="hs-identifier hs-var hs-var">info2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Id -&gt; IdInfo
Id -&gt; IdInfo
</span><a href="GHC.Types.Var.html#idInfo"><span class="hs-identifier hs-var">idInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703537"><span class="hs-identifier hs-var">bndr2</span></a></span><span>
</span><span id="line-2536"></span><span>
</span><span id="line-2537"></span><span class="hs-comment">-- | Find differences in unfoldings. Note that we will not check for</span><span>
</span><span id="line-2538"></span><span class="hs-comment">-- differences of @IdInfo@ in unfoldings, as this is generally</span><span>
</span><span id="line-2539"></span><span class="hs-comment">-- redundant, and can lead to an exponential blow-up in complexity.</span><span>
</span><span id="line-2540"></span><span class="annot"><a href="GHC.Core.Utils.html#diffUnfold"><span class="hs-identifier hs-type">diffUnfold</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#RnEnv2"><span class="hs-identifier hs-type">RnEnv2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#Unfolding"><span class="hs-identifier hs-type">Unfolding</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#Unfolding"><span class="hs-identifier hs-type">Unfolding</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2541"></span><span id="diffUnfold"><span class="annot"><span class="annottext">diffUnfold :: RnEnv2 -&gt; Unfolding -&gt; Unfolding -&gt; [SDoc]
</span><a href="GHC.Core.Utils.html#diffUnfold"><span class="hs-identifier hs-var hs-var">diffUnfold</span></a></span></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><span class="hs-identifier">_</span></span><span>   </span><span class="annot"><span class="annottext">Unfolding
</span><a href="GHC.Core.html#NoUnfolding"><span class="hs-identifier hs-var">NoUnfolding</span></a></span><span>    </span><span class="annot"><span class="annottext">Unfolding
</span><a href="GHC.Core.html#NoUnfolding"><span class="hs-identifier hs-var">NoUnfolding</span></a></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2542"></span><span class="annot"><a href="GHC.Core.Utils.html#diffUnfold"><span class="hs-identifier hs-var">diffUnfold</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><span class="hs-identifier">_</span></span><span>   </span><span class="annot"><span class="annottext">Unfolding
</span><a href="GHC.Core.html#BootUnfolding"><span class="hs-identifier hs-var">BootUnfolding</span></a></span><span>  </span><span class="annot"><span class="annottext">Unfolding
</span><a href="GHC.Core.html#BootUnfolding"><span class="hs-identifier hs-var">BootUnfolding</span></a></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2543"></span><span class="annot"><a href="GHC.Core.Utils.html#diffUnfold"><span class="hs-identifier hs-var">diffUnfold</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#OtherCon"><span class="hs-identifier hs-type">OtherCon</span></a></span><span> </span><span id="local-6989586621682703555"><span class="annot"><span class="annottext">[AltCon]
</span><a href="#local-6989586621682703555"><span class="hs-identifier hs-var">cs1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#OtherCon"><span class="hs-identifier hs-type">OtherCon</span></a></span><span> </span><span id="local-6989586621682703556"><span class="annot"><span class="annottext">[AltCon]
</span><a href="#local-6989586621682703556"><span class="hs-identifier hs-var">cs2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[AltCon]
</span><a href="#local-6989586621682703555"><span class="hs-identifier hs-var">cs1</span></a></span><span> </span><span class="annot"><span class="annottext">[AltCon] -&gt; [AltCon] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[AltCon]
</span><a href="#local-6989586621682703556"><span class="hs-identifier hs-var">cs2</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2544"></span><span class="annot"><a href="GHC.Core.Utils.html#diffUnfold"><span class="hs-identifier hs-var">diffUnfold</span></a></span><span> </span><span id="local-6989586621682703557"><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703557"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#DFunUnfolding"><span class="hs-identifier hs-type">DFunUnfolding</span></a></span><span> </span><span id="local-6989586621682703559"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682703559"><span class="hs-identifier hs-var">bs1</span></a></span></span><span> </span><span id="local-6989586621682703560"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682703560"><span class="hs-identifier hs-var">c1</span></a></span></span><span> </span><span id="local-6989586621682703561"><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682703561"><span class="hs-identifier hs-var">a1</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2545"></span><span>               </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#DFunUnfolding"><span class="hs-identifier hs-type">DFunUnfolding</span></a></span><span> </span><span id="local-6989586621682703562"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682703562"><span class="hs-identifier hs-var">bs2</span></a></span></span><span> </span><span id="local-6989586621682703563"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682703563"><span class="hs-identifier hs-var">c2</span></a></span></span><span> </span><span id="local-6989586621682703564"><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682703564"><span class="hs-identifier hs-var">a2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2546"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682703560"><span class="hs-identifier hs-var">c1</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; DataCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682703563"><span class="hs-identifier hs-var">c2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; [Id] -&gt; Bool
forall a b. [a] -&gt; [b] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#equalLength"><span class="hs-identifier hs-var">equalLength</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682703559"><span class="hs-identifier hs-var">bs1</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682703562"><span class="hs-identifier hs-var">bs2</span></a></span><span>
</span><span id="line-2547"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((CoreExpr, CoreExpr) -&gt; [SDoc])
-&gt; [(CoreExpr, CoreExpr)] -&gt; [SDoc]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr -&gt; [SDoc]) -&gt; (CoreExpr, CoreExpr) -&gt; [SDoc]
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; RnEnv2 -&gt; CoreExpr -&gt; CoreExpr -&gt; [SDoc]
</span><a href="GHC.Core.Utils.html#diffExpr"><span class="hs-identifier hs-var">diffExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703565"><span class="hs-identifier hs-var">env'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoreExpr] -&gt; [CoreExpr] -&gt; [(CoreExpr, CoreExpr)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682703561"><span class="hs-identifier hs-var">a1</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682703564"><span class="hs-identifier hs-var">a2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2548"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682703565"><span class="annot"><span class="annottext">env' :: RnEnv2
</span><a href="#local-6989586621682703565"><span class="hs-identifier hs-var hs-var">env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RnEnv2 -&gt; [Id] -&gt; [Id] -&gt; RnEnv2
</span><a href="GHC.Types.Var.Env.html#rnBndrs2"><span class="hs-identifier hs-var">rnBndrs2</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703557"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682703559"><span class="hs-identifier hs-var">bs1</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682703562"><span class="hs-identifier hs-var">bs2</span></a></span><span>
</span><span id="line-2549"></span><span class="annot"><a href="GHC.Core.Utils.html#diffUnfold"><span class="hs-identifier hs-var">diffUnfold</span></a></span><span> </span><span id="local-6989586621682703566"><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703566"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#CoreUnfolding"><span class="hs-identifier hs-type">CoreUnfolding</span></a></span><span> </span><span id="local-6989586621682703568"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703568"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span class="annot"><span class="annottext">UnfoldingSource
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682703569"><span class="annot"><span class="annottext">UnfoldingCache
</span><a href="#local-6989586621682703569"><span class="hs-identifier hs-var">c1</span></a></span></span><span> </span><span id="local-6989586621682703570"><span class="annot"><span class="annottext">UnfoldingGuidance
</span><a href="#local-6989586621682703570"><span class="hs-identifier hs-var">g1</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2550"></span><span>               </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#CoreUnfolding"><span class="hs-identifier hs-type">CoreUnfolding</span></a></span><span> </span><span id="local-6989586621682703571"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703571"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span class="annot"><span class="annottext">UnfoldingSource
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682703572"><span class="annot"><span class="annottext">UnfoldingCache
</span><a href="#local-6989586621682703572"><span class="hs-identifier hs-var">c2</span></a></span></span><span> </span><span id="local-6989586621682703573"><span class="annot"><span class="annottext">UnfoldingGuidance
</span><a href="#local-6989586621682703573"><span class="hs-identifier hs-var">g2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2551"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">UnfoldingCache
</span><a href="#local-6989586621682703569"><span class="hs-identifier hs-var">c1</span></a></span><span> </span><span class="annot"><span class="annottext">UnfoldingCache -&gt; UnfoldingCache -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">UnfoldingCache
</span><a href="#local-6989586621682703572"><span class="hs-identifier hs-var">c2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">UnfoldingGuidance
</span><a href="#local-6989586621682703570"><span class="hs-identifier hs-var">g1</span></a></span><span> </span><span class="annot"><span class="annottext">UnfoldingGuidance -&gt; UnfoldingGuidance -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">UnfoldingGuidance
</span><a href="#local-6989586621682703573"><span class="hs-identifier hs-var">g2</span></a></span><span>
</span><span id="line-2552"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; RnEnv2 -&gt; CoreExpr -&gt; CoreExpr -&gt; [SDoc]
</span><a href="GHC.Core.Utils.html#diffExpr"><span class="hs-identifier hs-var">diffExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621682703566"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703568"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703571"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-2553"></span><span class="annot"><a href="GHC.Core.Utils.html#diffUnfold"><span class="hs-identifier hs-var">diffUnfold</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><span class="hs-identifier">_</span></span><span>   </span><span id="local-6989586621682703574"><span class="annot"><span class="annottext">Unfolding
</span><a href="#local-6989586621682703574"><span class="hs-identifier hs-var">uf1</span></a></span></span><span> </span><span id="local-6989586621682703575"><span class="annot"><span class="annottext">Unfolding
</span><a href="#local-6989586621682703575"><span class="hs-identifier hs-var">uf2</span></a></span></span><span>
</span><span id="line-2554"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#fsep"><span class="hs-identifier hs-var">fsep</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Unfolding -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Unfolding
</span><a href="#local-6989586621682703574"><span class="hs-identifier hs-var">uf1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;/=&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Unfolding -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Unfolding
</span><a href="#local-6989586621682703575"><span class="hs-identifier hs-var">uf2</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-2555"></span><span>
</span><span id="line-2556"></span><span class="annot"><span class="hs-comment">-- | Add location information to diff messages</span></span><span>
</span><span id="line-2557"></span><span class="annot"><a href="GHC.Core.Utils.html#locBind"><span class="hs-identifier hs-type">locBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2558"></span><span id="locBind"><span class="annot"><span class="annottext">locBind :: String -&gt; Id -&gt; Id -&gt; [SDoc] -&gt; [SDoc]
</span><a href="GHC.Core.Utils.html#locBind"><span class="hs-identifier hs-var hs-var">locBind</span></a></span></span><span> </span><span id="local-6989586621682703576"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682703576"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682703577"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703577"><span class="hs-identifier hs-var">b1</span></a></span></span><span> </span><span id="local-6989586621682703578"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703578"><span class="hs-identifier hs-var">b2</span></a></span></span><span> </span><span id="local-6989586621682703579"><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621682703579"><span class="hs-identifier hs-var">diffs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; [SDoc] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="#local-6989586621682703580"><span class="hs-identifier hs-var">addLoc</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621682703579"><span class="hs-identifier hs-var">diffs</span></a></span><span>
</span><span id="line-2559"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682703580"><span class="annot"><span class="annottext">addLoc :: SDoc -&gt; SDoc
</span><a href="#local-6989586621682703580"><span class="hs-identifier hs-var hs-var">addLoc</span></a></span></span><span> </span><span id="local-6989586621682703581"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682703581"><span class="hs-identifier hs-var">d</span></a></span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682703581"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682703576"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682703584"><span class="hs-identifier hs-var">bindLoc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2560"></span><span>        </span><span id="local-6989586621682703584"><span class="annot"><span class="annottext">bindLoc :: SDoc
</span><a href="#local-6989586621682703584"><span class="hs-identifier hs-var hs-var">bindLoc</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703577"><span class="hs-identifier hs-var">b1</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Id -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703578"><span class="hs-identifier hs-var">b2</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703577"><span class="hs-identifier hs-var">b1</span></a></span><span>
</span><span id="line-2561"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703577"><span class="hs-identifier hs-var">b1</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'/'</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703578"><span class="hs-identifier hs-var">b2</span></a></span><span>
</span><span id="line-2562"></span><span>
</span><span id="line-2563"></span><span>
</span><span id="line-2564"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
\subsection{Determining non-updatable right-hand-sides}
*                                                                      *
************************************************************************

Top-level constructor applications can usually be allocated
statically, but they can't if the constructor, or any of the
arguments, come from another DLL (because we can't refer to static
labels in other DLLs).

If this happens we simply make the RHS into an updatable thunk,
and 'execute' it rather than allocating it statically.
-}</span></span><span>
</span><span id="line-2578"></span><span>
</span><span id="line-2579"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Type utilities}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-2586"></span><span>
</span><span id="line-2587"></span><span class="hs-comment">-- | True if the type has no non-bottom elements, e.g. when it is an empty</span><span>
</span><span id="line-2588"></span><span class="hs-comment">-- datatype, or a GADT with non-satisfiable type parameters, e.g. Int :~: Bool.</span><span>
</span><span id="line-2589"></span><span class="hs-comment">-- See Note [Bottoming expressions]</span><span>
</span><span id="line-2590"></span><span class="hs-comment">--</span><span>
</span><span id="line-2591"></span><span class="hs-comment">-- See Note [No alternatives lint check] for another use of this function.</span><span>
</span><span id="line-2592"></span><span class="annot"><a href="GHC.Core.Utils.html#isEmptyTy"><span class="hs-identifier hs-type">isEmptyTy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2593"></span><span id="isEmptyTy"><span class="annot"><span class="annottext">isEmptyTy :: Type -&gt; Bool
</span><a href="GHC.Core.Utils.html#isEmptyTy"><span class="hs-identifier hs-var hs-var">isEmptyTy</span></a></span></span><span> </span><span id="local-6989586621682703586"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703586"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-2594"></span><span>    </span><span class="hs-comment">-- Data types where, given the particular type parameters, no data</span><span>
</span><span id="line-2595"></span><span>    </span><span class="hs-comment">-- constructor matches, are empty.</span><span>
</span><span id="line-2596"></span><span>    </span><span class="hs-comment">-- This includes data types with no constructors, e.g. Data.Void.Void.</span><span>
</span><span id="line-2597"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682703587"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682703587"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682703588"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682703588"><span class="hs-identifier hs-var">inst_tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703586"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2598"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682703590"><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621682703590"><span class="hs-identifier hs-var">dcs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe [DataCon]
</span><a href="GHC.Core.TyCon.html#tyConDataCons_maybe"><span class="hs-identifier hs-var">tyConDataCons_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682703587"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-2599"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(DataCon -&gt; Bool) -&gt; [DataCon] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type] -&gt; DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#dataConCannotMatch"><span class="hs-identifier hs-var">dataConCannotMatch</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682703588"><span class="hs-identifier hs-var">inst_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621682703590"><span class="hs-identifier hs-var">dcs</span></a></span><span>
</span><span id="line-2600"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2601"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2602"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2603"></span><span>
</span><span id="line-2604"></span><span class="hs-comment">-- | If @normSplitTyConApp_maybe _ ty = Just (tc, tys, co)@</span><span>
</span><span id="line-2605"></span><span class="hs-comment">-- then @ty |&gt; co = tc tys@. It's 'splitTyConApp_maybe', but looks through</span><span>
</span><span id="line-2606"></span><span class="hs-comment">-- coercions via 'topNormaliseType_maybe'. Hence the \&quot;norm\&quot; prefix.</span><span>
</span><span id="line-2607"></span><span class="annot"><a href="GHC.Core.Utils.html#normSplitTyConApp_maybe"><span class="hs-identifier hs-type">normSplitTyConApp_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInstEnvs"><span class="hs-identifier hs-type">FamInstEnvs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2608"></span><span id="normSplitTyConApp_maybe"><span class="annot"><span class="annottext">normSplitTyConApp_maybe :: FamInstEnvs -&gt; Type -&gt; Maybe (TyCon, [Type], Coercion)
</span><a href="GHC.Core.Utils.html#normSplitTyConApp_maybe"><span class="hs-identifier hs-var hs-var">normSplitTyConApp_maybe</span></a></span></span><span> </span><span id="local-6989586621682703592"><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621682703592"><span class="hs-identifier hs-var">fam_envs</span></a></span></span><span> </span><span id="local-6989586621682703593"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703593"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-2609"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span id="local-6989586621682703595"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682703595"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621682703596"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703596"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FamInstEnvs -&gt; Type -&gt; Maybe Reduction
</span><a href="GHC.Core.FamInstEnv.html#topNormaliseType_maybe"><span class="hs-identifier hs-var">topNormaliseType_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621682703592"><span class="hs-identifier hs-var">fam_envs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703593"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2610"></span><span>                           </span><span class="annot"><span class="annottext">Maybe Reduction -&gt; Reduction -&gt; Reduction
forall a. Maybe a -&gt; a -&gt; a
</span><a href="GHC.Data.Maybe.html#orElse"><span class="hs-operator hs-var">`orElse`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkReflRedn"><span class="hs-identifier hs-var">mkReflRedn</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703593"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2611"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682703599"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682703599"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682703600"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682703600"><span class="hs-identifier hs-var">tc_args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703596"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-2612"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TyCon, [Type], Coercion) -&gt; Maybe (TyCon, [Type], Coercion)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682703599"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682703600"><span class="hs-identifier hs-var">tc_args</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682703595"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2613"></span><span class="annot"><a href="GHC.Core.Utils.html#normSplitTyConApp_maybe"><span class="hs-identifier hs-var">normSplitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (TyCon, [Type], Coercion)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2614"></span><span>
</span><span id="line-2615"></span><span class="hs-comment">{-
*****************************************************
*
* InScopeSet things
*
*****************************************************
-}</span><span>
</span><span id="line-2622"></span><span>
</span><span id="line-2623"></span><span>
</span><span id="line-2624"></span><span class="annot"><a href="GHC.Core.Utils.html#extendInScopeSetBind"><span class="hs-identifier hs-type">extendInScopeSetBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#InScopeSet"><span class="hs-identifier hs-type">InScopeSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreBind"><span class="hs-identifier hs-type">CoreBind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#InScopeSet"><span class="hs-identifier hs-type">InScopeSet</span></a></span><span>
</span><span id="line-2625"></span><span id="extendInScopeSetBind"><span class="annot"><span class="annottext">extendInScopeSetBind :: InScopeSet -&gt; Bind Id -&gt; InScopeSet
</span><a href="GHC.Core.Utils.html#extendInScopeSetBind"><span class="hs-identifier hs-var hs-var">extendInScopeSetBind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#InScope"><span class="hs-identifier hs-type">InScope</span></a></span><span> </span><span id="local-6989586621682703602"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682703602"><span class="hs-identifier hs-var">in_scope</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682703603"><span class="annot"><span class="annottext">Bind Id
</span><a href="#local-6989586621682703603"><span class="hs-identifier hs-var">binds</span></a></span></span><span>
</span><span id="line-2626"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#InScope"><span class="hs-identifier hs-var">InScope</span></a></span><span> </span><span class="annot"><span class="annottext">(VarSet -&gt; InScopeSet) -&gt; VarSet -&gt; InScopeSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(VarSet -&gt; Id -&gt; VarSet) -&gt; VarSet -&gt; Bind Id -&gt; VarSet
forall a b. (a -&gt; b -&gt; a) -&gt; a -&gt; Bind b -&gt; a
</span><a href="GHC.Core.html#foldBindersOfBindStrict"><span class="hs-identifier hs-var">foldBindersOfBindStrict</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; Id -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#extendVarSet"><span class="hs-identifier hs-var">extendVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682703602"><span class="hs-identifier hs-var">in_scope</span></a></span><span> </span><span class="annot"><span class="annottext">Bind Id
</span><a href="#local-6989586621682703603"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-2627"></span><span>
</span><span id="line-2628"></span><span class="annot"><a href="GHC.Core.Utils.html#extendInScopeSetBndrs"><span class="hs-identifier hs-type">extendInScopeSetBndrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#InScopeSet"><span class="hs-identifier hs-type">InScopeSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreBind"><span class="hs-identifier hs-type">CoreBind</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#InScopeSet"><span class="hs-identifier hs-type">InScopeSet</span></a></span><span>
</span><span id="line-2629"></span><span id="extendInScopeSetBndrs"><span class="annot"><span class="annottext">extendInScopeSetBndrs :: InScopeSet -&gt; [Bind Id] -&gt; InScopeSet
</span><a href="GHC.Core.Utils.html#extendInScopeSetBndrs"><span class="hs-identifier hs-var hs-var">extendInScopeSetBndrs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#InScope"><span class="hs-identifier hs-type">InScope</span></a></span><span> </span><span id="local-6989586621682703606"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682703606"><span class="hs-identifier hs-var">in_scope</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682703607"><span class="annot"><span class="annottext">[Bind Id]
</span><a href="#local-6989586621682703607"><span class="hs-identifier hs-var">binds</span></a></span></span><span>
</span><span id="line-2630"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#InScope"><span class="hs-identifier hs-var">InScope</span></a></span><span> </span><span class="annot"><span class="annottext">(VarSet -&gt; InScopeSet) -&gt; VarSet -&gt; InScopeSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(VarSet -&gt; Id -&gt; VarSet) -&gt; VarSet -&gt; [Bind Id] -&gt; VarSet
forall a b. (a -&gt; b -&gt; a) -&gt; a -&gt; [Bind b] -&gt; a
</span><a href="GHC.Core.html#foldBindersOfBindsStrict"><span class="hs-identifier hs-var">foldBindersOfBindsStrict</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; Id -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#extendVarSet"><span class="hs-identifier hs-var">extendVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682703606"><span class="hs-identifier hs-var">in_scope</span></a></span><span> </span><span class="annot"><span class="annottext">[Bind Id]
</span><a href="#local-6989586621682703607"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-2631"></span><span>
</span><span id="line-2632"></span><span class="annot"><a href="GHC.Core.Utils.html#mkInScopeSetBndrs"><span class="hs-identifier hs-type">mkInScopeSetBndrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreBind"><span class="hs-identifier hs-type">CoreBind</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#InScopeSet"><span class="hs-identifier hs-type">InScopeSet</span></a></span><span>
</span><span id="line-2633"></span><span id="mkInScopeSetBndrs"><span class="annot"><span class="annottext">mkInScopeSetBndrs :: [Bind Id] -&gt; InScopeSet
</span><a href="GHC.Core.Utils.html#mkInScopeSetBndrs"><span class="hs-identifier hs-var hs-var">mkInScopeSetBndrs</span></a></span></span><span> </span><span id="local-6989586621682703609"><span class="annot"><span class="annottext">[Bind Id]
</span><a href="#local-6989586621682703609"><span class="hs-identifier hs-var">binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(InScopeSet -&gt; Id -&gt; InScopeSet)
-&gt; InScopeSet -&gt; [Bind Id] -&gt; InScopeSet
forall a b. (a -&gt; b -&gt; a) -&gt; a -&gt; [Bind b] -&gt; a
</span><a href="GHC.Core.html#foldBindersOfBindsStrict"><span class="hs-identifier hs-var">foldBindersOfBindsStrict</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; Id -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#extendInScopeSet"><span class="hs-identifier hs-var">extendInScopeSet</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="GHC.Types.Var.Env.html#emptyInScopeSet"><span class="hs-identifier hs-var">emptyInScopeSet</span></a></span><span> </span><span class="annot"><span class="annottext">[Bind Id]
</span><a href="#local-6989586621682703609"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-2634"></span><span>
</span><span id="line-2635"></span><span class="hs-comment">{-
*****************************************************
*
* StaticPtr
*
*****************************************************
-}</span><span>
</span><span id="line-2642"></span><span>
</span><span id="line-2643"></span><span class="hs-comment">-- | @collectMakeStaticArgs (makeStatic t srcLoc e)@ yields</span><span>
</span><span id="line-2644"></span><span class="hs-comment">-- @Just (makeStatic, t, srcLoc, e)@.</span><span>
</span><span id="line-2645"></span><span class="hs-comment">--</span><span>
</span><span id="line-2646"></span><span class="hs-comment">-- Returns @Nothing@ for every other expression.</span><span>
</span><span id="line-2647"></span><span class="annot"><a href="GHC.Core.Utils.html#collectMakeStaticArgs"><span class="hs-identifier hs-type">collectMakeStaticArgs</span></a></span><span>
</span><span id="line-2648"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2649"></span><span id="collectMakeStaticArgs"><span class="annot"><span class="annottext">collectMakeStaticArgs :: CoreExpr -&gt; Maybe (CoreExpr, Type, CoreExpr, CoreExpr)
</span><a href="GHC.Core.Utils.html#collectMakeStaticArgs"><span class="hs-identifier hs-var hs-var">collectMakeStaticArgs</span></a></span></span><span> </span><span id="local-6989586621682703612"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703612"><span class="hs-identifier hs-var">e</span></a></span></span><span>
</span><span id="line-2650"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682703613"><span class="annot"><span class="annottext">fun :: CoreExpr
</span><a href="#local-6989586621682703613"><span class="hs-identifier hs-var">fun</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682703614"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703614"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span id="local-6989586621682703615"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703615"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682703616"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703616"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682703617"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703617"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[CoreTickish]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(CoreTickish -&gt; Bool)
-&gt; CoreExpr -&gt; (CoreExpr, [CoreExpr], [CoreTickish])
forall b.
(CoreTickish -&gt; Bool)
-&gt; Expr b -&gt; (Expr b, [Expr b], [CoreTickish])
</span><a href="GHC.Core.html#collectArgsTicks"><span class="hs-identifier hs-var">collectArgsTicks</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; CoreTickish -&gt; Bool
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703612"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-2651"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703614"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#makeStaticName"><span class="hs-identifier hs-var">makeStaticName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoreExpr, Type, CoreExpr, CoreExpr)
-&gt; Maybe (CoreExpr, Type, CoreExpr, CoreExpr)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703613"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703615"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703616"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703617"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2652"></span><span class="annot"><a href="GHC.Core.Utils.html#collectMakeStaticArgs"><span class="hs-identifier hs-var">collectMakeStaticArgs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (CoreExpr, Type, CoreExpr, CoreExpr)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2653"></span><span>
</span><span id="line-2654"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Join points}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-2661"></span><span>
</span><span id="line-2662"></span><span class="annot"><span class="hs-comment">-- | Does this binding bind a join point (or a recursive group of join points)?</span></span><span>
</span><span id="line-2663"></span><span class="annot"><a href="GHC.Core.Utils.html#isJoinBind"><span class="hs-identifier hs-type">isJoinBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreBind"><span class="hs-identifier hs-type">CoreBind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2664"></span><span id="isJoinBind"><span class="annot"><span class="annottext">isJoinBind :: Bind Id -&gt; Bool
</span><a href="GHC.Core.Utils.html#isJoinBind"><span class="hs-identifier hs-var hs-var">isJoinBind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#NonRec"><span class="hs-identifier hs-type">NonRec</span></a></span><span> </span><span id="local-6989586621682703620"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703620"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Id.html#isJoinId"><span class="hs-identifier hs-var">isJoinId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703620"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-2665"></span><span class="annot"><a href="GHC.Core.Utils.html#isJoinBind"><span class="hs-identifier hs-var">isJoinBind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Rec"><span class="hs-identifier hs-type">Rec</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682703621"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703621"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[(Id, CoreExpr)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Id.html#isJoinId"><span class="hs-identifier hs-var">isJoinId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703621"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-2666"></span><span class="annot"><a href="GHC.Core.Utils.html#isJoinBind"><span class="hs-identifier hs-var">isJoinBind</span></a></span><span> </span><span class="annot"><span class="annottext">Bind Id
</span><span class="hs-identifier">_</span></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2667"></span><span>
</span><span id="line-2668"></span><span class="annot"><a href="GHC.Core.Utils.html#dumpIdInfoOfProgram"><span class="hs-identifier hs-type">dumpIdInfoOfProgram</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.Info.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreProgram"><span class="hs-identifier hs-type">CoreProgram</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-2669"></span><span id="dumpIdInfoOfProgram"><span class="annot"><span class="annottext">dumpIdInfoOfProgram :: Bool -&gt; (IdInfo -&gt; SDoc) -&gt; [Bind Id] -&gt; SDoc
</span><a href="GHC.Core.Utils.html#dumpIdInfoOfProgram"><span class="hs-identifier hs-var hs-var">dumpIdInfoOfProgram</span></a></span></span><span> </span><span id="local-6989586621682703623"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682703623"><span class="hs-identifier hs-var">dump_locals</span></a></span></span><span> </span><span id="local-6989586621682703624"><span class="annot"><span class="annottext">IdInfo -&gt; SDoc
</span><a href="#local-6989586621682703624"><span class="hs-identifier hs-var">ppr_id_info</span></a></span></span><span> </span><span id="local-6989586621682703625"><span class="annot"><span class="annottext">[Bind Id]
</span><a href="#local-6989586621682703625"><span class="hs-identifier hs-var">binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Id -&gt; SDoc) -&gt; [Id] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; SDoc
</span><a href="#local-6989586621682703626"><span class="hs-identifier hs-var">printId</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682703627"><span class="hs-identifier hs-var">ids</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2670"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2671"></span><span>  </span><span id="local-6989586621682703627"><span class="annot"><span class="annottext">ids :: [Id]
</span><a href="#local-6989586621682703627"><span class="hs-identifier hs-var hs-var">ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Id -&gt; Ordering) -&gt; [Id] -&gt; [Id]
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Ordering
</span><a href="GHC.Types.Name.html#stableNameCmp"><span class="hs-identifier hs-var">stableNameCmp</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Name -&gt; Ordering) -&gt; (Id -&gt; Name) -&gt; Id -&gt; Id -&gt; Ordering
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Name
forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Bind Id -&gt; [Id]) -&gt; [Bind Id] -&gt; [Id]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">Bind Id -&gt; [Id]
forall b. Bind b -&gt; [b]
</span><a href="#local-6989586621682703630"><span class="hs-identifier hs-var">getIds</span></a></span><span> </span><span class="annot"><span class="annottext">[Bind Id]
</span><a href="#local-6989586621682703625"><span class="hs-identifier hs-var">binds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2672"></span><span>  </span><span id="local-6989586621682703630"><span class="annot"><span class="annottext">getIds :: Bind a -&gt; [a]
</span><a href="#local-6989586621682703630"><span class="hs-identifier hs-var hs-var">getIds</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#NonRec"><span class="hs-identifier hs-type">NonRec</span></a></span><span> </span><span id="local-6989586621682703631"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682703631"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="annot"><span class="annottext">Expr a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682703631"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2673"></span><span>  </span><span class="annot"><a href="#local-6989586621682703630"><span class="hs-identifier hs-var">getIds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Rec"><span class="hs-identifier hs-type">Rec</span></a></span><span> </span><span id="local-6989586621682703632"><span class="annot"><span class="annottext">[(a, Expr a)]
</span><a href="#local-6989586621682703632"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a, Expr a) -&gt; a) -&gt; [(a, Expr a)] -&gt; [a]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(a, Expr a) -&gt; a
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(a, Expr a)]
</span><a href="#local-6989586621682703632"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-2674"></span><span>  </span><span class="hs-comment">-- By default only include full info for exported ids, unless we run in the verbose</span><span>
</span><span id="line-2675"></span><span>  </span><span class="hs-comment">-- pprDebug mode.</span><span>
</span><span id="line-2676"></span><span>  </span><span id="local-6989586621682703626"><span class="annot"><span class="annottext">printId :: Id -&gt; SDoc
</span><a href="#local-6989586621682703626"><span class="hs-identifier hs-var hs-var">printId</span></a></span></span><span> </span><span id="local-6989586621682703633"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703633"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Var.html#isExportedId"><span class="hs-identifier hs-var">isExportedId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703633"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682703623"><span class="hs-identifier hs-var">dump_locals</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703633"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IdInfo -&gt; SDoc
</span><a href="#local-6989586621682703624"><span class="hs-identifier hs-var">ppr_id_info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Id -&gt; IdInfo
Id -&gt; IdInfo
</span><a href="GHC.Types.Var.html#idInfo"><span class="hs-identifier hs-var">idInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703633"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2677"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-2678"></span><span>
</span><span id="line-2679"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Tag inference things}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-2686"></span><span>
</span><span id="line-2687"></span><span class="hs-comment">{- Note [Call-by-value for worker args]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
If we unbox a constructor with strict fields we want to
preserve the information that some of the arguments came
out of strict fields and therefore should be already properly
tagged, however we can't express this directly in core.

Instead what we do is generate a worker like this:

  data T = MkT A !B

  foo = case T of MkT a b -&gt; $wfoo a b

  $wfoo a b = case b of b' -&gt; rhs[b/b']

This makes the worker strict in b causing us to use a more efficient
calling convention for `b` where the caller needs to ensure `b` is
properly tagged and evaluated before it's passed to $wfoo. See Note [CBV Function Ids].

Usually the argument will be known to be properly tagged at the call site so there is
no additional work for the caller and the worker can be more efficient since it can
assume the presence of a tag.

This is especially true for recursive functions like this:
    -- myPred expect it's argument properly tagged
    myPred !x = ...

    loop :: MyPair -&gt; Int
    loop (MyPair !x !y) =
        case x of
            A -&gt; 1
            B -&gt; 2
            _ -&gt; loop (MyPair (myPred x) (myPred y))

Here we would ordinarily not be strict in y after unboxing.
However if we pass it as a regular argument then this means on
every iteration of loop we will incur an extra seq on y before
we can pass it to `myPred` which isn't great! That is in STG after
tag inference we get:

    Rec {
    Find.$wloop [InlPrag=[2], Occ=LoopBreaker]
      :: Find.MyEnum -&gt; Find.MyEnum -&gt; GHC.Prim.Int#
    [GblId[StrictWorker([!, ~])],
    Arity=2,
    Str=&lt;1L&gt;&lt;ML&gt;,
    Unf=OtherCon []] =
        {} \r [x y]
            case x&lt;TagProper&gt; of x' [Occ=Once1] {
              __DEFAULT -&gt;
                  case y of y' [Occ=Once1] {
                  __DEFAULT -&gt;
                  case Find.$wmyPred y' of pred_y [Occ=Once1] {
                  __DEFAULT -&gt;
                  case Find.$wmyPred x' of pred_x [Occ=Once1] {
                  __DEFAULT -&gt; Find.$wloop pred_x pred_y;
                  };
                  };
              Find.A -&gt; 1#;
              Find.B -&gt; 2#;
            };
    end Rec }

Here comes the tricky part: If we make $wloop strict in both x/y and we get:

    Rec {
    Find.$wloop [InlPrag=[2], Occ=LoopBreaker]
      :: Find.MyEnum -&gt; Find.MyEnum -&gt; GHC.Prim.Int#
    [GblId[StrictWorker([!, !])],
    Arity=2,
    Str=&lt;1L&gt;&lt;!L&gt;,
    Unf=OtherCon []] =
        {} \r [x y]
            case y&lt;TagProper&gt; of y' [Occ=Once1] { __DEFAULT -&gt;
            case x&lt;TagProper&gt; of x' [Occ=Once1] {
              __DEFAULT -&gt;
                  case Find.$wmyPred y' of pred_y [Occ=Once1] {
                  __DEFAULT -&gt;
                  case Find.$wmyPred x' of pred_x [Occ=Once1] {
                  __DEFAULT -&gt; Find.$wloop pred_x pred_y;
                  };
                  };
              Find.A -&gt; 1#;
              Find.B -&gt; 2#;
            };
    end Rec }

Here both x and y are known to be tagged in the function body since we pass strict worker args using unlifted cbv.
This means the seqs on x and y both become no-ops and compared to the first version the seq on `y` disappears at runtime.

The downside is that the caller of $wfoo potentially has to evaluate `y` once if we can't prove it isn't already evaluated.
But y coming out of a strict field is in WHNF so safe to evaluated. And most of the time it will be properly tagged+evaluated
already at the call site because of the Strict Field Invariant! See Note [Strict Field Invariant] for more in this.
This makes GHC itself around 1% faster despite doing slightly more work! So this is generally quite good.

We only apply this when we think there is a benefit in doing so however. There are a number of cases in which
it would be useless to insert an extra seq. ShouldStrictifyIdForCbv tries to identify these to avoid churn in the
simplifier. See Note [Which Ids should be strictified] for details on this.
-}</span><span>
</span><span id="line-2786"></span><span class="annot"><a href="GHC.Core.Utils.html#mkStrictFieldSeqs"><span class="hs-identifier hs-type">mkStrictFieldSeqs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.DataCon.html#StrictnessMark"><span class="hs-identifier hs-type">StrictnessMark</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2787"></span><span id="mkStrictFieldSeqs"><span class="annot"><span class="annottext">mkStrictFieldSeqs :: [(Id, StrictnessMark)] -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Utils.html#mkStrictFieldSeqs"><span class="hs-identifier hs-var hs-var">mkStrictFieldSeqs</span></a></span></span><span> </span><span id="local-6989586621682703637"><span class="annot"><span class="annottext">[(Id, StrictnessMark)]
</span><a href="#local-6989586621682703637"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621682703638"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703638"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2788"></span><span>  </span><span class="annot"><span class="annottext">((Id, StrictnessMark) -&gt; CoreExpr -&gt; CoreExpr)
-&gt; CoreExpr -&gt; [(Id, StrictnessMark)] -&gt; CoreExpr
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">(Id, StrictnessMark) -&gt; CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682703639"><span class="hs-identifier hs-var">addEval</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703638"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, StrictnessMark)]
</span><a href="#local-6989586621682703637"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-2789"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-2790"></span><span>      </span><span id="local-6989586621682703640"><span class="annot"><span class="annottext">case_ty :: Type
</span><a href="#local-6989586621682703640"><span class="hs-identifier hs-var hs-var">case_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoreExpr -&gt; Type
CoreExpr -&gt; Type
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703638"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-2791"></span><span>      </span><span class="annot"><a href="#local-6989586621682703639"><span class="hs-identifier hs-type">addEval</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.DataCon.html#StrictnessMark"><span class="hs-identifier hs-type">StrictnessMark</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2792"></span><span>      </span><span id="local-6989586621682703639"><span class="annot"><span class="annottext">addEval :: (Id, StrictnessMark) -&gt; CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682703639"><span class="hs-identifier hs-var hs-var">addEval</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682703641"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703641"><span class="hs-identifier hs-var">arg_id</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682703642"><span class="annot"><span class="annottext">StrictnessMark
</span><a href="#local-6989586621682703642"><span class="hs-identifier hs-var">arg_cbv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682703643"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703643"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2793"></span><span>        </span><span class="hs-comment">-- Argument representing strict field.</span><span>
</span><span id="line-2794"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">StrictnessMark -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isMarkedStrict"><span class="hs-identifier hs-var">isMarkedStrict</span></a></span><span> </span><span class="annot"><span class="annottext">StrictnessMark
</span><a href="#local-6989586621682703642"><span class="hs-identifier hs-var">arg_cbv</span></a></span><span>
</span><span id="line-2795"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Core.Utils.html#shouldStrictifyIdForCbv"><span class="hs-identifier hs-var">shouldStrictifyIdForCbv</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703641"><span class="hs-identifier hs-var">arg_id</span></a></span><span>
</span><span id="line-2796"></span><span>        </span><span class="hs-comment">-- Make sure to remove unfoldings here to avoid the simplifier dropping those for OtherCon[] unfoldings.</span><span>
</span><span id="line-2797"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Id -&gt; Type -&gt; [Alt Id] -&gt; CoreExpr
forall b. Expr b -&gt; b -&gt; Type -&gt; [Alt b] -&gt; Expr b
</span><a href="GHC.Core.html#Case"><span class="hs-identifier hs-var">Case</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">(Id -&gt; CoreExpr) -&gt; Id -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Id
</span><a href="GHC.Types.Id.html#zapIdUnfolding"><span class="hs-identifier hs-var">zapIdUnfolding</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703641"><span class="hs-identifier hs-var">arg_id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703641"><span class="hs-identifier hs-var">arg_id</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703640"><span class="hs-identifier hs-var">case_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">AltCon -&gt; [Id] -&gt; CoreExpr -&gt; Alt Id
forall b. AltCon -&gt; [b] -&gt; Expr b -&gt; Alt b
</span><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-var">Alt</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="GHC.Core.html#DEFAULT"><span class="hs-identifier hs-var">DEFAULT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703643"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2798"></span><span>        </span><span class="hs-comment">-- Normal argument</span><span>
</span><span id="line-2799"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2800"></span><span>          </span><span class="annot"><a href="#local-6989586621682703643"><span class="hs-identifier hs-type">rhs</span></a></span><span>
</span><span id="line-2801"></span><span>
</span><span id="line-2802"></span><span class="hs-comment">{- Note [Which Ids should be strictified]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
For some arguments we would like to convince GHC to pass them call by value.
One way to achieve this is described in see Note [Call-by-value for worker args].

We separate the concerns of &quot;should we pass this argument using cbv&quot; and
&quot;should we do so by making the rhs strict in this argument&quot;.
This note deals with the second part.

There are multiple reasons why we might not want to insert a seq in the rhs to
strictify a functions argument:

1) The argument doesn't exist at runtime.

For zero width types (like Types) there is no benefit as we don't operate on them
at runtime at all. This includes things like void#, coercions and state tokens.

2) The argument is a unlifted type.

If the argument is a unlifted type the calling convention already is explicitly
cbv. This means inserting a seq on this argument wouldn't do anything as the seq
would be a no-op *and* it wouldn't affect the calling convention.

3) The argument is absent.

If the argument is absent in the body there is no advantage to it being passed as
cbv to the function. The function won't ever look at it so we don't safe any work.

This mostly happens for join point. For example we might have:

    data T = MkT ![Int] [Char]
    f t = case t of MkT xs{strict} ys-&gt; snd (xs,ys)

and abstract the case alternative to:

    f t = join j1 = \xs ys -&gt; snd (xs,ys)
          in case t of MkT xs{strict} ys-&gt; j1 xs xy

While we &quot;use&quot; xs inside `j1` it's not used inside the function `snd` we pass it to.
In short a absent demand means neither our RHS, nor any function we pass the argument
to will inspect it. So there is no work to be saved by forcing `xs` early.

NB: There is an edge case where if we rebox we *can* end up seqing an absent value.
Note [Absent fillers] has an example of this. However this is so rare it's not worth
caring about here.

4) The argument is already strict.

Consider this code:

    data T = MkT ![Int]
    f t = case t of MkT xs{strict} -&gt; reverse xs

The `xs{strict}` indicates that `xs` is used strictly by the `reverse xs`.
If we do a w/w split, and add the extra eval on `xs`, we'll get

    $wf xs =
        case xs of xs1 -&gt;
            let t = MkT xs1 in
            case t of MkT xs2 -&gt; reverse xs2

That's not wrong; but the w/w body will simplify to

    $wf xs = case xs of xs1 -&gt; reverse xs1

and now we'll drop the `case xs` because `xs1` is used strictly in its scope.
Adding that eval was a waste of time.  So don't add it for strictly-demanded Ids.

5) Functions

Functions are tricky (see Note [TagInfo of functions] in InferTags).
But the gist of it even if we make a higher order function argument strict
we can't avoid the tag check when it's used later in the body.
So there is no benefit.

-}</span><span>
</span><span id="line-2878"></span><span class="hs-comment">-- | Do we expect there to be any benefit if we make this var strict</span><span>
</span><span id="line-2879"></span><span class="hs-comment">-- in order for it to get treated as as cbv argument?</span><span>
</span><span id="line-2880"></span><span class="hs-comment">-- See Note [Which Ids should be strictified]</span><span>
</span><span id="line-2881"></span><span class="hs-comment">-- See Note [CBV Function Ids] for more background.</span><span>
</span><span id="line-2882"></span><span class="annot"><a href="GHC.Core.Utils.html#shouldStrictifyIdForCbv"><span class="hs-identifier hs-type">shouldStrictifyIdForCbv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2883"></span><span id="shouldStrictifyIdForCbv"><span class="annot"><span class="annottext">shouldStrictifyIdForCbv :: Id -&gt; Bool
</span><a href="GHC.Core.Utils.html#shouldStrictifyIdForCbv"><span class="hs-identifier hs-var hs-var">shouldStrictifyIdForCbv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Id -&gt; Bool
</span><a href="GHC.Core.Utils.html#wantCbvForId"><span class="hs-identifier hs-var">wantCbvForId</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2884"></span><span>
</span><span id="line-2885"></span><span class="hs-comment">-- Like shouldStrictifyIdForCbv but also wants to use cbv for strict args.</span><span>
</span><span id="line-2886"></span><span class="annot"><a href="GHC.Core.Utils.html#shouldUseCbvForId"><span class="hs-identifier hs-type">shouldUseCbvForId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2887"></span><span id="shouldUseCbvForId"><span class="annot"><span class="annottext">shouldUseCbvForId :: Id -&gt; Bool
</span><a href="GHC.Core.Utils.html#shouldUseCbvForId"><span class="hs-identifier hs-var hs-var">shouldUseCbvForId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Id -&gt; Bool
</span><a href="GHC.Core.Utils.html#wantCbvForId"><span class="hs-identifier hs-var">wantCbvForId</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2888"></span><span>
</span><span id="line-2889"></span><span class="hs-comment">-- When we strictify we want to skip strict args otherwise the logic is the same</span><span>
</span><span id="line-2890"></span><span class="hs-comment">-- as for shouldUseCbvForId so we common up the logic here.</span><span>
</span><span id="line-2891"></span><span class="hs-comment">-- Basically returns true if it would be beneficial for runtime to pass this argument</span><span>
</span><span id="line-2892"></span><span class="hs-comment">-- as CBV independent of weither or not it's correct. E.g. it might return true for lazy args</span><span>
</span><span id="line-2893"></span><span class="hs-comment">-- we are not allowed to force.</span><span>
</span><span id="line-2894"></span><span class="annot"><a href="GHC.Core.Utils.html#wantCbvForId"><span class="hs-identifier hs-type">wantCbvForId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2895"></span><span id="wantCbvForId"><span class="annot"><span class="annottext">wantCbvForId :: Bool -&gt; Id -&gt; Bool
</span><a href="GHC.Core.Utils.html#wantCbvForId"><span class="hs-identifier hs-var hs-var">wantCbvForId</span></a></span></span><span> </span><span id="local-6989586621682703648"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682703648"><span class="hs-identifier hs-var">cbv_for_strict</span></a></span></span><span> </span><span id="local-6989586621682703649"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703649"><span class="hs-identifier hs-var">v</span></a></span></span><span>
</span><span id="line-2896"></span><span>  </span><span class="hs-comment">-- Must be a runtime var.</span><span>
</span><span id="line-2897"></span><span>  </span><span class="hs-comment">-- See Note [Which Ids should be strictified] point 1)</span><span>
</span><span id="line-2898"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Var.html#isId"><span class="hs-identifier hs-var">isId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703649"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-2899"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Bool
Type -&gt; Bool
</span><a href="GHC.Types.RepType.html#isZeroBitTy"><span class="hs-identifier hs-var">isZeroBitTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703651"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2900"></span><span>  </span><span class="hs-comment">-- Unlifted things don't need special measures to be treated as cbv</span><span>
</span><span id="line-2901"></span><span>  </span><span class="hs-comment">-- See Note [Which Ids should be strictified] point 2)</span><span>
</span><span id="line-2902"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#mightBeLiftedType"><span class="hs-identifier hs-var">mightBeLiftedType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703651"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2903"></span><span>  </span><span class="hs-comment">-- Functions sometimes get a zero tag so we can't eliminate the tag check.</span><span>
</span><span id="line-2904"></span><span>  </span><span class="hs-comment">-- See Note [TagInfo of functions] in InferTags.</span><span>
</span><span id="line-2905"></span><span>  </span><span class="hs-comment">-- See Note [Which Ids should be strictified] point 5)</span><span>
</span><span id="line-2906"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isFunTy"><span class="hs-identifier hs-var">isFunTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682703651"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2907"></span><span>  </span><span class="hs-comment">-- If the var is strict already a seq is redundant.</span><span>
</span><span id="line-2908"></span><span>  </span><span class="hs-comment">-- See Note [Which Ids should be strictified] point 4)</span><span>
</span><span id="line-2909"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Demand -&gt; Bool
</span><a href="GHC.Types.Demand.html#isStrictDmd"><span class="hs-identifier hs-var">isStrictDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621682703654"><span class="hs-identifier hs-var">dmd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682703648"><span class="hs-identifier hs-var">cbv_for_strict</span></a></span><span>
</span><span id="line-2910"></span><span>  </span><span class="hs-comment">-- If the var is absent a seq is almost always useless.</span><span>
</span><span id="line-2911"></span><span>  </span><span class="hs-comment">-- See Note [Which Ids should be strictified] point 3)</span><span>
</span><span id="line-2912"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Demand -&gt; Bool
</span><a href="GHC.Types.Demand.html#isAbsDmd"><span class="hs-identifier hs-var">isAbsDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621682703654"><span class="hs-identifier hs-var">dmd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2913"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2914"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2915"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2916"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2917"></span><span>    </span><span id="local-6989586621682703651"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621682703651"><span class="hs-identifier hs-var hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703649"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-2918"></span><span>    </span><span id="local-6989586621682703654"><span class="annot"><span class="annottext">dmd :: Demand
</span><a href="#local-6989586621682703654"><span class="hs-identifier hs-var hs-var">dmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Demand
</span><a href="GHC.Types.Id.html#idDemandInfo"><span class="hs-identifier hs-var">idDemandInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703649"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-2919"></span><span>
</span><span id="line-2920"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
             unsafeEqualityProof
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-2925"></span><span>
</span><span id="line-2926"></span><span class="annot"><a href="GHC.Core.Utils.html#isUnsafeEqualityCase"><span class="hs-identifier hs-type">isUnsafeEqualityCase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreAlt"><span class="hs-identifier hs-type">CoreAlt</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-2927"></span><span class="hs-comment">-- See (U3) and (U4) in</span><span>
</span><span id="line-2928"></span><span class="hs-comment">-- Note [Implementing unsafeCoerce] in base:Unsafe.Coerce</span><span>
</span><span id="line-2929"></span><span id="isUnsafeEqualityCase"><span class="annot"><span class="annottext">isUnsafeEqualityCase :: CoreExpr -&gt; Id -&gt; [Alt Id] -&gt; Maybe CoreExpr
</span><a href="GHC.Core.Utils.html#isUnsafeEqualityCase"><span class="hs-identifier hs-var hs-var">isUnsafeEqualityCase</span></a></span></span><span> </span><span id="local-6989586621682703657"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703657"><span class="hs-identifier hs-var">scrut</span></a></span></span><span> </span><span id="local-6989586621682703658"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703658"><span class="hs-identifier hs-var">bndr</span></a></span></span><span> </span><span id="local-6989586621682703659"><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682703659"><span class="hs-identifier hs-var">alts</span></a></span></span><span>
</span><span id="line-2930"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span id="local-6989586621682703660"><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621682703660"><span class="hs-identifier hs-var">ac</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682703661"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703661"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621682703659"><span class="hs-identifier hs-var">alts</span></a></span><span>
</span><span id="line-2931"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#DataAlt"><span class="hs-identifier hs-type">DataAlt</span></a></span><span> </span><span id="local-6989586621682703662"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682703662"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621682703660"><span class="hs-identifier hs-var">ac</span></a></span><span>
</span><span id="line-2932"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682703662"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#unsafeReflDataConKey"><span class="hs-identifier hs-var">unsafeReflDataConKey</span></a></span><span>
</span><span id="line-2933"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Id.html#isDeadBinder"><span class="hs-identifier hs-var">isDeadBinder</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703658"><span class="hs-identifier hs-var">bndr</span></a></span><span>
</span><span id="line-2934"></span><span>      </span><span class="hs-comment">-- We can only discard the case if the case-binder is dead</span><span>
</span><span id="line-2935"></span><span>      </span><span class="hs-comment">-- It usually is, but see #18227</span><span>
</span><span id="line-2936"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682703663"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703663"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><a href="GHC.Core.html#App"><span class="hs-operator hs-type">`App`</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="GHC.Core.html#App"><span class="hs-operator hs-type">`App`</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="GHC.Core.html#App"><span class="hs-operator hs-type">`App`</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703657"><span class="hs-identifier hs-var">scrut</span></a></span><span>
</span><span id="line-2937"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682703663"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#unsafeEqualityProofIdKey"><span class="hs-identifier hs-var">unsafeEqualityProofIdKey</span></a></span><span>
</span><span id="line-2938"></span><span>      </span><span class="hs-comment">-- Check that the scrutinee really is unsafeEqualityProof</span><span>
</span><span id="line-2939"></span><span>      </span><span class="hs-comment">-- and not, say, error</span><span>
</span><span id="line-2940"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Maybe CoreExpr
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682703661"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-2941"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2942"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe CoreExpr
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2943"></span></pre></body></html>