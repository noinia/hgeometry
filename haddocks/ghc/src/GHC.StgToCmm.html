<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-6"></span><span class="hs-comment">--</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- Stg to C-- code generation</span><span>
</span><span id="line-8"></span><span class="hs-comment">--</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- (c) The University of Glasgow 2004-2006</span><span>
</span><span id="line-10"></span><span class="hs-comment">--</span><span>
</span><span id="line-11"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.StgToCmm.html"><span class="hs-identifier">GHC.StgToCmm</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.StgToCmm.html#codeGen"><span class="hs-identifier">codeGen</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Prelude.html"><span class="hs-identifier">Prelude</span></a></span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.UniqueRenamer.html"><span class="hs-identifier">GHC.Cmm.UniqueRenamer</span></a></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Prof.html"><span class="hs-identifier">GHC.StgToCmm.Prof</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Prof.html#initCostCentres"><span class="hs-identifier">initCostCentres</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Prof.html#ldvEnter"><span class="hs-identifier">ldvEnter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html"><span class="hs-identifier">GHC.StgToCmm.Monad</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Env.html"><span class="hs-identifier">GHC.StgToCmm.Env</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Bind.html"><span class="hs-identifier">GHC.StgToCmm.Bind</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.DataCon.html"><span class="hs-identifier">GHC.StgToCmm.DataCon</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Layout.html"><span class="hs-identifier">GHC.StgToCmm.Layout</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Utils.html"><span class="hs-identifier">GHC.StgToCmm.Utils</span></a></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Closure.html"><span class="hs-identifier">GHC.StgToCmm.Closure</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Config.html"><span class="hs-identifier">GHC.StgToCmm.Config</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html"><span class="hs-identifier">GHC.StgToCmm.Ticky</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Types.html"><span class="hs-identifier">GHC.StgToCmm.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Types.html#ModuleLFInfos"><span class="hs-identifier">ModuleLFInfos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.CgUtils.html"><span class="hs-identifier">GHC.StgToCmm.CgUtils</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.CgUtils.html#CgStream"><span class="hs-identifier">CgStream</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.html"><span class="hs-identifier">GHC.Cmm</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Utils.html"><span class="hs-identifier">GHC.Cmm.Utils</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html"><span class="hs-identifier">GHC.Cmm.CLabel</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Graph.html"><span class="hs-identifier">GHC.Cmm.Graph</span></a></span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html"><span class="hs-identifier">GHC.Stg.Syntax</span></a></span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.html"><span class="hs-identifier">GHC.Types.CostCentre</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.IPE.html"><span class="hs-identifier">GHC.Types.IPE</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html"><span class="hs-identifier">GHC.Types.Id.Info</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.RepType.html"><span class="hs-identifier">GHC.Types.RepType</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html"><span class="hs-identifier">GHC.Types.Var.Set</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#isEmptyDVarSet"><span class="hs-identifier">isEmptyDVarSet</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DFM.html"><span class="hs-identifier">GHC.Types.Unique.DFM</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html"><span class="hs-identifier">GHC.Types.Unique.FM</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html"><span class="hs-identifier">GHC.Types.Name.Env</span></a></span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Multiplicity.html"><span class="hs-identifier">GHC.Core.Multiplicity</span></a></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html"><span class="hs-identifier">GHC.Utils.Error</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html"><span class="hs-identifier">GHC.Utils.Logger</span></a></span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html"><span class="hs-identifier">GHC.Utils.TmpFs</span></a></span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Stream.html"><span class="hs-identifier">GHC.Data.Stream</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html"><span class="hs-identifier">GHC.Data.OrdList</span></a></span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">when</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">void</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">forM_</span></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/System.IO.Unsafe.html"><span class="hs-identifier">System.IO.Unsafe</span></a></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.html"><span class="hs-identifier">Data.ByteString</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS</span></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.IORef.html"><span class="hs-identifier">Data.IORef</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="annot"><a href="GHC.StgToCmm.html#codeGen"><span class="hs-identifier hs-type">codeGen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span>
</span><span id="line-71"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TmpFs"><span class="hs-identifier hs-type">TmpFs</span></a></span><span>
</span><span id="line-72"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Config.html#StgToCmmConfig"><span class="hs-identifier hs-type">StgToCmmConfig</span></a></span><span>
</span><span id="line-73"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#InfoTableProvMap"><span class="hs-identifier hs-type">InfoTableProvMap</span></a></span><span>
</span><span id="line-74"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-75"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.html#CollectedCCs"><span class="hs-identifier hs-type">CollectedCCs</span></a></span><span>                </span><span class="hs-comment">-- (Local/global) cost-centres needing declaring/registering.</span><span>
</span><span id="line-76"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgTopBinding"><span class="hs-identifier hs-type">CgStgTopBinding</span></a></span><span class="hs-special">]</span><span>           </span><span class="hs-comment">-- Bindings to convert</span><span>
</span><span id="line-77"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.CgUtils.html#CgStream"><span class="hs-identifier hs-type">CgStream</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGroup"><span class="hs-identifier hs-type">CmmGroup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Types.html#ModuleLFInfos"><span class="hs-identifier hs-type">ModuleLFInfos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.UniqueRenamer.html#DetUniqFM"><span class="hs-identifier hs-type">DetUniqFM</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- See Note [Deterministic Uniques in the CG] on CgStream</span><span>
</span><span id="line-78"></span><span>                                       </span><span class="hs-comment">-- Output as a stream, so codegen can</span><span>
</span><span id="line-79"></span><span>                                       </span><span class="hs-comment">-- be interleaved with output</span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span id="codeGen"><span class="annot"><span class="annottext">codeGen :: Logger
-&gt; TmpFs
-&gt; StgToCmmConfig
-&gt; InfoTableProvMap
-&gt; [TyCon]
-&gt; CollectedCCs
-&gt; [CgStgTopBinding]
-&gt; CgStream CmmGroup (ModuleLFInfos, DetUniqFM)
</span><a href="GHC.StgToCmm.html#codeGen"><span class="hs-identifier hs-var hs-var">codeGen</span></a></span></span><span> </span><span id="local-6989586621682999655"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682999655"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621682999656"><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621682999656"><span class="hs-identifier hs-var">tmpfs</span></a></span></span><span> </span><span id="local-6989586621682999657"><span class="annot"><span class="annottext">StgToCmmConfig
</span><a href="#local-6989586621682999657"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.IPE.html#InfoTableProvMap"><span class="hs-identifier hs-type">InfoTableProvMap</span></a></span><span> </span><span id="local-6989586621682999659"><span class="annot"><span class="annottext">DCMap
</span><a href="#local-6989586621682999659"><span class="hs-identifier hs-var">denv</span></a></span></span><span> </span><span class="annot"><span class="annottext">ClosureMap
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">InfoTableToSourceLocationMap
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682999660"><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621682999660"><span class="hs-identifier hs-var">data_tycons</span></a></span></span><span>
</span><span id="line-82"></span><span>        </span><span id="local-6989586621682999661"><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621682999661"><span class="hs-identifier hs-var">cost_centre_info</span></a></span></span><span> </span><span id="local-6989586621682999662"><span class="annot"><span class="annottext">[CgStgTopBinding]
</span><a href="#local-6989586621682999662"><span class="hs-identifier hs-var">stg_binds</span></a></span></span><span>
</span><span id="line-83"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span>     </span><span class="hs-comment">-- cg: run the code generator, and yield the resulting CmmGroup</span><span>
</span><span id="line-84"></span><span>              </span><span class="hs-comment">-- Using an IORef to store the state is a bit crude, but otherwise</span><span>
</span><span id="line-85"></span><span>              </span><span class="hs-comment">-- we would need to add a state monad layer which regresses</span><span>
</span><span id="line-86"></span><span>              </span><span class="hs-comment">-- allocations by 0.5-2%.</span><span>
</span><span id="line-87"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682999663"><span class="annot"><a href="#local-6989586621682999663"><span class="hs-identifier hs-var">cgref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (IORef CgState) -&gt; Stream (UniqDSMT IO) CmmGroup (IORef CgState)
forall a. IO a -&gt; Stream (UniqDSMT IO) CmmGroup a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (IORef CgState)
 -&gt; Stream (UniqDSMT IO) CmmGroup (IORef CgState))
-&gt; IO (IORef CgState)
-&gt; Stream (UniqDSMT IO) CmmGroup (IORef CgState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO CgState
</span><a href="GHC.StgToCmm.Monad.html#initC"><span class="hs-identifier hs-var">initC</span></a></span><span> </span><span class="annot"><span class="annottext">IO CgState -&gt; (CgState -&gt; IO (IORef CgState)) -&gt; IO (IORef CgState)
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682999666"><span class="annot"><span class="annottext">CgState
</span><a href="#local-6989586621682999666"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CgState -&gt; IO (IORef CgState)
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="annot"><span class="annottext">CgState
</span><a href="#local-6989586621682999666"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-88"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682999668"><span class="annot"><a href="#local-6989586621682999668"><span class="hs-identifier hs-var">uniqRnRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">newIORef</span></span><span> </span><span class="annot"><a href="GHC.Cmm.UniqueRenamer.html#emptyDetUFM"><span class="hs-identifier hs-type">emptyDetUFM</span></a></span><span>
</span><span id="line-89"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682999670"><span class="annot"><a href="#local-6989586621682999670"><span class="hs-identifier hs-var hs-var">fstate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; FCodeState
</span><a href="GHC.StgToCmm.Monad.html#initFCodeState"><span class="hs-identifier hs-var">initFCodeState</span></a></span><span> </span><span class="annot"><span class="annottext">(Platform -&gt; FCodeState) -&gt; Platform -&gt; FCodeState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig -&gt; Platform
</span><a href="GHC.StgToCmm.Config.html#stgToCmmPlatform"><span class="hs-identifier hs-var">stgToCmmPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig
</span><a href="#local-6989586621682999657"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-90"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682999451"><span class="annot"><a href="#local-6989586621682999673"><span class="hs-identifier hs-type">cg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999451"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.CgUtils.html#CgStream"><span class="hs-identifier hs-type">CgStream</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGroup"><span class="hs-identifier hs-type">CmmGroup</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999451"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-91"></span><span>              </span><span id="local-6989586621682999673"><span class="annot"><a href="#local-6989586621682999673"><span class="hs-identifier hs-var hs-var">cg</span></a></span></span><span> </span><span id="local-6989586621682999687"><span class="annot"><span class="annottext">FCode a
</span><a href="#local-6989586621682999687"><span class="hs-identifier hs-var">fcode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-92"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621682999688"><span class="annot"><a href="#local-6989586621682999688"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682999689"><span class="annot"><a href="#local-6989586621682999689"><span class="hs-identifier hs-var">cmm</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (a, CmmGroup) -&gt; Stream (UniqDSMT IO) CmmGroup (a, CmmGroup)
forall a. IO a -&gt; Stream (UniqDSMT IO) CmmGroup a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (a, CmmGroup) -&gt; Stream (UniqDSMT IO) CmmGroup (a, CmmGroup))
-&gt; (IO (a, CmmGroup) -&gt; IO (a, CmmGroup))
-&gt; IO (a, CmmGroup)
-&gt; Stream (UniqDSMT IO) CmmGroup (a, CmmGroup)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; SDoc
-&gt; ((a, CmmGroup) -&gt; ())
-&gt; IO (a, CmmGroup)
-&gt; IO (a, CmmGroup)
forall (m :: * -&gt; *) a.
MonadIO m =&gt;
Logger -&gt; SDoc -&gt; (a -&gt; ()) -&gt; m a -&gt; m a
</span><a href="GHC.Utils.Error.html#withTimingSilent"><span class="hs-identifier hs-var">withTimingSilent</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682999655"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;STG -&gt; Cmm&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a, CmmGroup) -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO (a, CmmGroup) -&gt; Stream (UniqDSMT IO) CmmGroup (a, CmmGroup))
-&gt; IO (a, CmmGroup) -&gt; Stream (UniqDSMT IO) CmmGroup (a, CmmGroup)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-93"></span><span>                         </span><span id="local-6989586621682999693"><span class="annot"><a href="#local-6989586621682999693"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef CgState -&gt; IO CgState
forall a. IORef a -&gt; IO a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef CgState
</span><a href="#local-6989586621682999663"><span class="hs-identifier hs-var">cgref</span></a></span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span>                         </span><span id="local-6989586621682999695"><span class="annot"><a href="#local-6989586621682999695"><span class="hs-identifier hs-var">rnm0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">readIORef</span></span><span> </span><span class="annot"><a href="#local-6989586621682999668"><span class="hs-identifier hs-type">uniqRnRef</span></a></span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span>                         </span><span class="hs-keyword">let</span><span>
</span><span id="line-98"></span><span>                           </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682999696"><span class="annot"><a href="#local-6989586621682999696"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682999697"><span class="annot"><a href="#local-6989586621682999697"><span class="hs-identifier hs-var">cmm</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682999698"><span class="annot"><a href="#local-6989586621682999698"><span class="hs-identifier hs-var">st'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#runC"><span class="hs-identifier hs-type">runC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999657"><span class="hs-identifier hs-type">cfg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999670"><span class="hs-identifier hs-type">fstate</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999693"><span class="hs-identifier hs-type">st</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Monad.html#getCmm"><span class="hs-identifier hs-type">getCmm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999687"><span class="hs-identifier hs-type">fcode</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>                           </span><span class="hs-special">(</span><span id="local-6989586621682999701"><span class="annot"><a href="#local-6989586621682999701"><span class="hs-identifier hs-var">rnm1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682999702"><span class="annot"><a href="#local-6989586621682999702"><span class="hs-identifier hs-var">cmm_renamed</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-100"></span><span>                             </span><span class="hs-comment">-- Enable deterministic object code generation by</span><span>
</span><span id="line-101"></span><span>                             </span><span class="hs-comment">-- renaming uniques deterministically.</span><span>
</span><span id="line-102"></span><span>                             </span><span class="hs-comment">-- See Note [Object determinism]</span><span>
</span><span id="line-103"></span><span>                             </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Config.html#stgToCmmObjectDeterminism"><span class="hs-identifier hs-var">stgToCmmObjectDeterminism</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999657"><span class="hs-identifier hs-type">cfg</span></a></span><span>
</span><span id="line-104"></span><span>                                </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="GHC.Cmm.UniqueRenamer.html#detRenameCmmGroup"><span class="hs-identifier hs-type">detRenameCmmGroup</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999695"><span class="hs-identifier hs-type">rnm0</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999697"><span class="hs-identifier hs-type">cmm</span></a></span><span> </span><span class="hs-comment">-- The yielded cmm will already be renamed.</span><span>
</span><span id="line-105"></span><span>                                </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682999695"><span class="hs-identifier hs-type">rnm0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.html#removeDeterm"><span class="hs-identifier hs-type">removeDeterm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999697"><span class="hs-identifier hs-type">cmm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span>                         </span><span class="hs-comment">-- NB. stub-out cgs_tops and cgs_stmts.  This fixes</span><span>
</span><span id="line-108"></span><span>                         </span><span class="hs-comment">-- a big space leak.  DO NOT REMOVE!</span><span>
</span><span id="line-109"></span><span>                         </span><span class="hs-comment">-- This is observed by the #3294 test</span><span>
</span><span id="line-110"></span><span>                         </span><span class="annot"><span class="hs-identifier hs-type">writeIORef</span></span><span> </span><span class="annot"><a href="#local-6989586621682999663"><span class="hs-identifier hs-type">cgref</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682999698"><span class="hs-identifier hs-type">st'</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#cgs_tops"><span class="hs-identifier hs-var">cgs_tops</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-type">nilOL</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#cgs_stmts"><span class="hs-identifier hs-var">cgs_stmts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Cmm.Graph.html#mkNop"><span class="hs-identifier hs-type">mkNop</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span>                         </span><span class="annot"><span class="hs-identifier hs-type">writeIORef</span></span><span> </span><span class="annot"><a href="#local-6989586621682999668"><span class="hs-identifier hs-type">uniqRnRef</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$!</span></span><span> </span><span class="annot"><a href="#local-6989586621682999701"><span class="hs-identifier hs-type">rnm1</span></a></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span>                         </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682999696"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682999702"><span class="hs-identifier hs-type">cmm_renamed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>                </span><span class="annot"><a href="GHC.Data.Stream.html#yield"><span class="hs-identifier hs-type">yield</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999689"><span class="hs-identifier hs-type">cmm</span></a></span><span>
</span><span id="line-115"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682999688"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="#local-6989586621682999673"><span class="hs-identifier hs-type">cg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.html#mkModuleInit"><span class="hs-identifier hs-type">mkModuleInit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999661"><span class="hs-identifier hs-type">cost_centre_info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682999673"><span class="hs-identifier hs-type">cg</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="GHC.StgToCmm.html#cgTopBinding"><span class="hs-identifier hs-type">cgTopBinding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999655"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999656"><span class="hs-identifier hs-type">tmpfs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999657"><span class="hs-identifier hs-type">cfg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682999662"><span class="hs-identifier hs-type">stg_binds</span></a></span><span>
</span><span id="line-120"></span><span>                </span><span class="hs-comment">-- Put datatype_stuff after code_stuff, because the</span><span>
</span><span id="line-121"></span><span>                </span><span class="hs-comment">-- datatype closure table (for enumeration types) to</span><span>
</span><span id="line-122"></span><span>                </span><span class="hs-comment">-- (say) PrelBase_True_closure, which is defined in</span><span>
</span><span id="line-123"></span><span>                </span><span class="hs-comment">-- code_stuff</span><span>
</span><span id="line-124"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682999721"><span class="annot"><a href="#local-6989586621682999721"><span class="hs-identifier hs-var hs-var">do_tycon</span></a></span></span><span> </span><span id="local-6989586621682999722"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682999722"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-125"></span><span>                </span><span class="hs-comment">-- Generate a table of static closures for an</span><span>
</span><span id="line-126"></span><span>                </span><span class="hs-comment">-- enumeration type Note that the closure pointers are</span><span>
</span><span id="line-127"></span><span>                </span><span class="hs-comment">-- tagged.</span><span>
</span><span id="line-128"></span><span>                 </span><span class="annot"><span class="annottext">Bool
-&gt; Stream (UniqDSMT IO) CmmGroup ()
-&gt; Stream (UniqDSMT IO) CmmGroup ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isEnumerationTyCon"><span class="hs-identifier hs-var">isEnumerationTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682999722"><span class="hs-identifier hs-var">tycon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Stream (UniqDSMT IO) CmmGroup ()
 -&gt; Stream (UniqDSMT IO) CmmGroup ())
-&gt; Stream (UniqDSMT IO) CmmGroup ()
-&gt; Stream (UniqDSMT IO) CmmGroup ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FCode () -&gt; Stream (UniqDSMT IO) CmmGroup ()
forall a. FCode a -&gt; CgStream CmmGroup a
</span><a href="#local-6989586621682999673"><span class="hs-identifier hs-var">cg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; FCode ()
</span><a href="GHC.StgToCmm.html#cgEnumerationTyCon"><span class="hs-identifier hs-var">cgEnumerationTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682999722"><span class="hs-identifier hs-var">tycon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span>                 </span><span class="hs-comment">-- Emit normal info_tables, for data constructors defined in this module.</span><span>
</span><span id="line-130"></span><span>                 </span><span class="annot"><span class="annottext">(DataCon -&gt; Stream (UniqDSMT IO) CmmGroup ())
-&gt; [DataCon] -&gt; Stream (UniqDSMT IO) CmmGroup ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FCode () -&gt; Stream (UniqDSMT IO) CmmGroup ()
forall a. FCode a -&gt; CgStream CmmGroup a
</span><a href="#local-6989586621682999673"><span class="hs-identifier hs-var">cg</span></a></span><span> </span><span class="annot"><span class="annottext">(FCode () -&gt; Stream (UniqDSMT IO) CmmGroup ())
-&gt; (DataCon -&gt; FCode ())
-&gt; DataCon
-&gt; Stream (UniqDSMT IO) CmmGroup ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ConInfoTableLocation -&gt; DataCon -&gt; FCode ()
</span><a href="GHC.StgToCmm.html#cgDataCon"><span class="hs-identifier hs-var">cgDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">ConInfoTableLocation
</span><a href="GHC.Cmm.CLabel.html#DefinitionSite"><span class="hs-identifier hs-var">DefinitionSite</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [DataCon]
</span><a href="GHC.Core.TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682999722"><span class="hs-identifier hs-var">tycon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="annot"><a href="#local-6989586621682999721"><span class="hs-identifier hs-type">do_tycon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999660"><span class="hs-identifier hs-type">data_tycons</span></a></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span>        </span><span class="hs-comment">-- Emit special info tables for everything used in this module</span><span>
</span><span id="line-135"></span><span>        </span><span class="hs-comment">-- This will only do something if  `-fdistinct-info-tables` is turned on.</span><span>
</span><span id="line-136"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682999728"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682999728"><span class="hs-identifier hs-var">dc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682999729"><span class="annot"><span class="annottext">NonEmpty (WordOff, Maybe IpeSourceLocation)
</span><a href="#local-6989586621682999729"><span class="hs-identifier hs-var">ns</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NonEmpty (WordOff, Maybe IpeSourceLocation)
-&gt; ((WordOff, Maybe IpeSourceLocation)
    -&gt; Stream (UniqDSMT IO) CmmGroup ())
-&gt; Stream (UniqDSMT IO) CmmGroup ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (WordOff, Maybe IpeSourceLocation)
</span><a href="#local-6989586621682999729"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="annot"><span class="annottext">(((WordOff, Maybe IpeSourceLocation)
  -&gt; Stream (UniqDSMT IO) CmmGroup ())
 -&gt; Stream (UniqDSMT IO) CmmGroup ())
-&gt; ((WordOff, Maybe IpeSourceLocation)
    -&gt; Stream (UniqDSMT IO) CmmGroup ())
-&gt; Stream (UniqDSMT IO) CmmGroup ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682999730"><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682999730"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682999731"><span class="annot"><span class="annottext">Maybe IpeSourceLocation
</span><a href="#local-6989586621682999731"><span class="hs-identifier hs-var">_ss</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FCode () -&gt; Stream (UniqDSMT IO) CmmGroup ()
forall a. FCode a -&gt; CgStream CmmGroup a
</span><a href="#local-6989586621682999673"><span class="hs-identifier hs-var">cg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConInfoTableLocation -&gt; DataCon -&gt; FCode ()
</span><a href="GHC.StgToCmm.html#cgDataCon"><span class="hs-identifier hs-var">cgDataCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; WordOff -&gt; ConInfoTableLocation
</span><a href="GHC.Cmm.CLabel.html#UsageSite"><span class="hs-identifier hs-var">UsageSite</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StgToCmmConfig -&gt; Module
</span><a href="GHC.StgToCmm.Config.html#stgToCmmThisModule"><span class="hs-identifier hs-var">stgToCmmThisModule</span></a></span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig
</span><a href="#local-6989586621682999657"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682999730"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682999728"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.DFM.html#eltsUDFM"><span class="hs-identifier hs-type">eltsUDFM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999659"><span class="hs-identifier hs-type">denv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682999735"><span class="annot"><a href="#local-6989586621682999735"><span class="hs-identifier hs-var">final_state</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">readIORef</span></span><span> </span><span class="annot"><a href="#local-6989586621682999663"><span class="hs-identifier hs-type">cgref</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682999736"><span class="annot"><a href="#local-6989586621682999736"><span class="hs-identifier hs-var hs-var">cg_id_infos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CgState -&gt; CgBindings
</span><a href="GHC.StgToCmm.Monad.html#cgs_binds"><span class="hs-identifier hs-var">cgs_binds</span></a></span><span> </span><span class="annot"><span class="annottext">CgState
</span><a href="#local-6989586621682999735"><span class="hs-identifier hs-var">final_state</span></a></span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span>          </span><span class="hs-comment">-- See Note [Conveying CAF-info and LFInfo between modules] in</span><span>
</span><span id="line-142"></span><span>          </span><span class="hs-comment">-- GHC.StgToCmm.Types</span><span>
</span><span id="line-143"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682999738"><span class="annot"><a href="#local-6989586621682999738"><span class="hs-identifier hs-var hs-var">extractInfo</span></a></span></span><span> </span><span id="local-6989586621682999739"><span class="annot"><span class="annottext">CgIdInfo
</span><a href="#local-6989586621682999739"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682999740"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LambdaFormInfo
</span><a href="#local-6989586621682999741"><span class="hs-identifier hs-var">lf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>                </span><span class="hs-keyword">where</span><span>
</span><span id="line-145"></span><span>                  </span><span class="hs-glyph">!</span><span id="local-6989586621682999740"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621682999740"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CgIdInfo -&gt; Var
</span><a href="GHC.StgToCmm.Monad.html#cg_id"><span class="hs-identifier hs-var">cg_id</span></a></span><span> </span><span class="annot"><span class="annottext">CgIdInfo
</span><a href="#local-6989586621682999739"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>                  </span><span class="hs-glyph">!</span><span id="local-6989586621682999741"><span class="annot"><span class="annottext">lf :: LambdaFormInfo
</span><a href="#local-6989586621682999741"><span class="hs-identifier hs-var hs-var">lf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CgIdInfo -&gt; LambdaFormInfo
</span><a href="GHC.StgToCmm.Monad.html#cg_lf"><span class="hs-identifier hs-var">cg_lf</span></a></span><span> </span><span class="annot"><span class="annottext">CgIdInfo
</span><a href="#local-6989586621682999739"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span>              </span><span class="hs-glyph">!</span><span id="local-6989586621682999745"><span class="annot"><a href="#local-6989586621682999745"><span class="hs-identifier hs-var hs-var">generatedInfo</span></a></span></span><span>
</span><span id="line-149"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig -&gt; Bool
</span><a href="GHC.StgToCmm.Config.html#stgToCmmOmitIfPragmas"><span class="hs-identifier hs-var">stgToCmmOmitIfPragmas</span></a></span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig
</span><a href="#local-6989586621682999657"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-150"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleLFInfos
forall a. NameEnv a
</span><a href="GHC.Types.Name.Env.html#emptyNameEnv"><span class="hs-identifier hs-var">emptyNameEnv</span></a></span><span>
</span><span id="line-151"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-152"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Name, LambdaFormInfo)] -&gt; ModuleLFInfos
forall a. [(Name, a)] -&gt; NameEnv a
</span><a href="GHC.Types.Name.Env.html#mkNameEnv"><span class="hs-identifier hs-var">mkNameEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CgIdInfo -&gt; (Name, LambdaFormInfo))
-&gt; [CgIdInfo] -&gt; [(Name, LambdaFormInfo)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">Prelude.map</span></span><span> </span><span class="annot"><span class="annottext">CgIdInfo -&gt; (Name, LambdaFormInfo)
</span><a href="#local-6989586621682999738"><span class="hs-identifier hs-var">extractInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CgBindings -&gt; [CgIdInfo]
forall {k} (key :: k) elt. UniqFM key elt -&gt; [elt]
</span><a href="GHC.Types.Unique.FM.html#nonDetEltsUFM"><span class="hs-identifier hs-var">nonDetEltsUFM</span></a></span><span> </span><span class="annot"><span class="annottext">CgBindings
</span><a href="#local-6989586621682999736"><span class="hs-identifier hs-var">cg_id_infos</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682999750"><span class="annot"><a href="#local-6989586621682999750"><span class="hs-identifier hs-var">rn_mapping</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">readIORef</span></span><span> </span><span class="annot"><a href="#local-6989586621682999668"><span class="hs-identifier hs-type">uniqRnRef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-type">debugTraceMsg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999655"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><span class="hs-number">3</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;DetRnM mapping:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999750"><span class="hs-identifier hs-type">rn_mapping</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682999745"><span class="hs-identifier hs-type">generatedInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682999750"><span class="hs-identifier hs-type">rn_mapping</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="hs-comment">{-
Note [Object determinism]
~~~~~~~~~~~~~~~~~~~~~~~~~
Object determinism means that GHC, for the same exact input, produces,
deterministically, byte-for-byte identical objects (.o files, executables,
libraries...) on separate multi-threaded runs.

Deterministic objects are critical, for instance, for reproducible software
packaging and distribution, or build systems with content-sensitive
recompilation avoidance.

The main cause of non-determinism in objects comes from the non-deterministic
uniques leaking into the generated code. Apart from uniques previously affecting
determinism both directly by showing up in symbol labels and indirectly, e.g. in
the CLabel Ord instance, GHC already did a lot deterministically (modulo bugs)
by the time we set out to achieve full object determinism:

* The Simplifier is deterministic in the optimisations it applies (c.f. #25170)

* Interface files are deterministic (which depends on the previous bullet)

* The Cmm/NCG pipeline processes sections in a deterministic order, so the final
  object sections, closures, data, etc., are already always outputted in the
  same order for the same module.

Beyond fixing small bugs in the above bullets and other smaller non-determinism
leaks like the Ord instance of CLabels, we must ensure that/do the following to
make GHC produce fully deterministic objects:

* In STG -&gt; Cmm, deterministically /rename/ all non-external uniques in the Cmm
  chunk, deterministically, before yielding. See Note [Renaming uniques deterministically]
  in GHC.Cmm.UniqueRenamer. This pass is necessary for object determinism but
  is currently guarded by -fobject-determinism.

* Multiple Cmm passes work with non-deterministic @LabelMap@s -- that doesn't
  change since they are both important for performance and do not affect the
  determinism of the end result. As after the renaming pass the uniques are all
  produced deterministically, the orderings observable by the map are also going
  to be deterministic. In the brief period before a CmmGroup has been renamed,
  a list instead of LabelMap is used to preserve the ordering.
  See Note [DCmmGroup vs CmmGroup or: Deterministic Info Tables] in GHC.Cmm.

* In the code generation pipeline from Cmm onwards, when new uniques need to be
  created for a given pass, use @UniqDSM@ instead of the previously used @UniqSM@.
  @UniqDSM@ supplies uniques iteratively, guaranteeing uniques produced by the
  backend are deterministic accross runs.
  See Note [Deterministic Uniques in the CG] in GHC.Types.Unique.DSM.

Also, c.f. Note [Unique Determinism]
-}</span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span class="hs-comment">---------------------------------------------------------------</span><span>
</span><span id="line-213"></span><span class="hs-comment">--      Top-level bindings</span><span>
</span><span id="line-214"></span><span class="hs-comment">---------------------------------------------------------------</span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span class="hs-comment">{- 'cgTopBinding' is only used for top-level bindings, since they need
to be allocated statically (not in the heap) and need to be labelled.
No unboxed bindings can happen at top level.

In the code below, the static bindings are accumulated in the
@MkCgState@, and transferred into the ``statics'' slot by @forkStatics@.
This is so that we can write the top level processing in a compositional
style, with the increasing static environment being plumbed as a state
variable. -}</span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span class="annot"><a href="GHC.StgToCmm.html#cgTopBinding"><span class="hs-identifier hs-type">cgTopBinding</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TmpFs"><span class="hs-identifier hs-type">TmpFs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Config.html#StgToCmmConfig"><span class="hs-identifier hs-type">StgToCmmConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgTopBinding"><span class="hs-identifier hs-type">CgStgTopBinding</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span id="cgTopBinding"><span class="annot"><span class="annottext">cgTopBinding :: Logger -&gt; TmpFs -&gt; StgToCmmConfig -&gt; CgStgTopBinding -&gt; FCode ()
</span><a href="GHC.StgToCmm.html#cgTopBinding"><span class="hs-identifier hs-var hs-var">cgTopBinding</span></a></span></span><span> </span><span id="local-6989586621682999754"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682999754"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621682999755"><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621682999755"><span class="hs-identifier hs-var">tmpfs</span></a></span></span><span> </span><span id="local-6989586621682999756"><span class="annot"><span class="annottext">StgToCmmConfig
</span><a href="#local-6989586621682999756"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-228"></span><span>    </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTopLifted"><span class="hs-identifier hs-type">StgTopLifted</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgNonRec"><span class="hs-identifier hs-type">StgNonRec</span></a></span><span> </span><span id="local-6989586621682999759"><span class="annot"><span class="annottext">BinderP 'CodeGen
</span><a href="#local-6989586621682999759"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span id="local-6989586621682999760"><span class="annot"><span class="annottext">GenStgRhs 'CodeGen
</span><a href="#local-6989586621682999760"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-229"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682999761"><span class="annot"><span class="annottext">CgIdInfo
</span><a href="#local-6989586621682999761"><span class="hs-identifier hs-var hs-var">info</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682999762"><span class="annot"><span class="annottext">FCode ()
</span><a href="#local-6989586621682999762"><span class="hs-identifier hs-var hs-var">fcode</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig
-&gt; RecFlag -&gt; Var -&gt; GenStgRhs 'CodeGen -&gt; (CgIdInfo, FCode ())
</span><a href="GHC.StgToCmm.html#cgTopRhs"><span class="hs-identifier hs-var">cgTopRhs</span></a></span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig
</span><a href="#local-6989586621682999756"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="annot"><span class="annottext">RecFlag
</span><a href="GHC.Types.Basic.html#NonRecursive"><span class="hs-identifier hs-var">NonRecursive</span></a></span><span> </span><span class="annot"><span class="annottext">Var
BinderP 'CodeGen
</span><a href="#local-6989586621682999759"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgRhs 'CodeGen
</span><a href="#local-6989586621682999760"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-230"></span><span>        </span><span class="annot"><span class="annottext">FCode ()
</span><a href="#local-6989586621682999762"><span class="hs-identifier hs-var">fcode</span></a></span><span>
</span><span id="line-231"></span><span>        </span><span class="annot"><span class="annottext">CgIdInfo -&gt; FCode ()
</span><a href="GHC.StgToCmm.Env.html#addBindC"><span class="hs-identifier hs-var">addBindC</span></a></span><span> </span><span class="annot"><span class="annottext">CgIdInfo
</span><a href="#local-6989586621682999761"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span>    </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTopLifted"><span class="hs-identifier hs-type">StgTopLifted</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRec"><span class="hs-identifier hs-type">StgRec</span></a></span><span> </span><span id="local-6989586621682999767"><span class="annot"><span class="annottext">[(BinderP 'CodeGen, GenStgRhs 'CodeGen)]
</span><a href="#local-6989586621682999767"><span class="hs-identifier hs-var">pairs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-234"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682999768"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621682999768"><span class="hs-identifier hs-var hs-var">bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682999769"><span class="annot"><span class="annottext">[GenStgRhs 'CodeGen]
</span><a href="#local-6989586621682999769"><span class="hs-identifier hs-var hs-var">rhss</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, GenStgRhs 'CodeGen)] -&gt; ([Var], [GenStgRhs 'CodeGen])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">[(Var, GenStgRhs 'CodeGen)]
[(BinderP 'CodeGen, GenStgRhs 'CodeGen)]
</span><a href="#local-6989586621682999767"><span class="hs-identifier hs-var">pairs</span></a></span><span>
</span><span id="line-235"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682999771"><span class="annot"><span class="annottext">pairs' :: [(Var, GenStgRhs 'CodeGen)]
</span><a href="#local-6989586621682999771"><span class="hs-identifier hs-var hs-var hs-var">pairs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [GenStgRhs 'CodeGen] -&gt; [(Var, GenStgRhs 'CodeGen)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621682999768"><span class="hs-identifier hs-var">bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">[GenStgRhs 'CodeGen]
</span><a href="#local-6989586621682999769"><span class="hs-identifier hs-var">rhss</span></a></span><span>
</span><span id="line-236"></span><span>            </span><span id="local-6989586621682999772"><span class="annot"><span class="annottext">r :: [(CgIdInfo, FCode ())]
</span><a href="#local-6989586621682999772"><span class="hs-identifier hs-var hs-var hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; GenStgRhs 'CodeGen -&gt; (CgIdInfo, FCode ()))
-&gt; [(Var, GenStgRhs 'CodeGen)] -&gt; [(CgIdInfo, FCode ())]
forall a b c. (a -&gt; b -&gt; c) -&gt; [(a, b)] -&gt; [c]
</span><a href="GHC.Utils.Misc.html#unzipWith"><span class="hs-identifier hs-var">unzipWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StgToCmmConfig
-&gt; RecFlag -&gt; Var -&gt; GenStgRhs 'CodeGen -&gt; (CgIdInfo, FCode ())
</span><a href="GHC.StgToCmm.html#cgTopRhs"><span class="hs-identifier hs-var">cgTopRhs</span></a></span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig
</span><a href="#local-6989586621682999756"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="annot"><span class="annottext">RecFlag
</span><a href="GHC.Types.Basic.html#Recursive"><span class="hs-identifier hs-var">Recursive</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Var, GenStgRhs 'CodeGen)]
</span><a href="#local-6989586621682999771"><span class="hs-identifier hs-var">pairs'</span></a></span><span>
</span><span id="line-237"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682999775"><span class="annot"><span class="annottext">[CgIdInfo]
</span><a href="#local-6989586621682999775"><span class="hs-identifier hs-var hs-var">infos</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682999776"><span class="annot"><span class="annottext">[FCode ()]
</span><a href="#local-6989586621682999776"><span class="hs-identifier hs-var hs-var">fcodes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(CgIdInfo, FCode ())] -&gt; ([CgIdInfo], [FCode ()])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">[(CgIdInfo, FCode ())]
</span><a href="#local-6989586621682999772"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-238"></span><span>        </span><span class="annot"><span class="annottext">[CgIdInfo] -&gt; FCode ()
</span><a href="GHC.StgToCmm.Env.html#addBindsC"><span class="hs-identifier hs-var">addBindsC</span></a></span><span> </span><span class="annot"><span class="annottext">[CgIdInfo]
</span><a href="#local-6989586621682999775"><span class="hs-identifier hs-var">infos</span></a></span><span>
</span><span id="line-239"></span><span>        </span><span class="annot"><span class="annottext">[FCode ()] -&gt; FCode ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Foldable t, Monad m) =&gt;
t (m a) -&gt; m ()
</span><span class="hs-identifier hs-var">sequence_</span></span><span> </span><span class="annot"><span class="annottext">[FCode ()]
</span><a href="#local-6989586621682999776"><span class="hs-identifier hs-var">fcodes</span></a></span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span>    </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTopStringLit"><span class="hs-identifier hs-type">StgTopStringLit</span></a></span><span> </span><span id="local-6989586621682999780"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621682999780"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span id="local-6989586621682999781"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682999781"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-242"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682999782"><span class="annot"><span class="annottext">label :: CLabel
</span><a href="#local-6989586621682999782"><span class="hs-keyword hs-var hs-var hs-var">label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#mkBytesLabel"><span class="hs-identifier hs-var">mkBytesLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621682999780"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>        </span><span class="hs-comment">-- emit either a CmmString literal or dump the string in a file and emit a</span><span>
</span><span id="line-244"></span><span>        </span><span class="hs-comment">-- CmmFileEmbed literal.  If binary blobs aren't supported,</span><span>
</span><span id="line-245"></span><span>        </span><span class="hs-comment">-- the threshold in `cfg` will be 0.</span><span>
</span><span id="line-246"></span><span>        </span><span class="hs-comment">-- See Note [Embedding large binary blobs] in GHC.CmmToAsm.Ppr</span><span>
</span><span id="line-247"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682999784"><span class="annot"><span class="annottext">asString :: Bool
</span><a href="#local-6989586621682999784"><span class="hs-identifier hs-var hs-var hs-var">asString</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig -&gt; Maybe Word
</span><a href="GHC.StgToCmm.Config.html#stgToCmmBinBlobThresh"><span class="hs-identifier hs-var">stgToCmmBinBlobThresh</span></a></span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig
</span><a href="#local-6989586621682999756"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-248"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682999786"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621682999786"><span class="hs-identifier hs-var">bin_blob_threshold</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; Word
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; WordOff
</span><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.html#length"><span class="hs-identifier hs-var">BS.length</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682999781"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621682999786"><span class="hs-identifier hs-var">bin_blob_threshold</span></a></span><span>
</span><span id="line-249"></span><span>              </span><span class="annot"><span class="annottext">Maybe Word
</span><span class="hs-identifier hs-var">Nothing</span></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682999789"><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682999789"><span class="hs-identifier hs-var hs-var">lit</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682999790"><span class="annot"><span class="annottext">DCmmDecl
</span><a href="#local-6989586621682999790"><span class="hs-identifier hs-var hs-var">decl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682999784"><span class="hs-identifier hs-var">asString</span></a></span><span>
</span><span id="line-252"></span><span>              </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; ByteString -&gt; (CmmLit, DCmmDecl)
forall (raw :: Bool) info stmt.
CLabel
-&gt; ByteString -&gt; (CmmLit, GenCmmDecl (GenCmmStatics raw) info stmt)
</span><a href="GHC.Cmm.Utils.html#mkByteStringCLit"><span class="hs-identifier hs-var">mkByteStringCLit</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682999782"><span class="hs-keyword hs-var">label</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682999781"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-253"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">IO (CmmLit, DCmmDecl) -&gt; (CmmLit, DCmmDecl)
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (CmmLit, DCmmDecl) -&gt; (CmmLit, DCmmDecl))
-&gt; IO (CmmLit, DCmmDecl) -&gt; (CmmLit, DCmmDecl)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-254"></span><span>                     </span><span id="local-6989586621682999793"><span class="annot"><a href="#local-6989586621682999793"><span class="hs-identifier hs-var">bFile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; TmpFs -&gt; TempDir -&gt; TempFileLifetime -&gt; String -&gt; IO String
</span><a href="GHC.Utils.TmpFs.html#newTempName"><span class="hs-identifier hs-var">newTempName</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682999754"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621682999755"><span class="hs-identifier hs-var">tmpfs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StgToCmmConfig -&gt; TempDir
</span><a href="GHC.StgToCmm.Config.html#stgToCmmTmpDir"><span class="hs-identifier hs-var">stgToCmmTmpDir</span></a></span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig
</span><a href="#local-6989586621682999756"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.Utils.TmpFs.html#TFL_CurrentModule"><span class="hs-identifier hs-var">TFL_CurrentModule</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.dat&quot;</span></span><span>
</span><span id="line-255"></span><span>                     </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.html#writeFile"><span class="hs-identifier hs-type">BS.writeFile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999793"><span class="hs-identifier hs-type">bFile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999781"><span class="hs-identifier hs-type">str</span></a></span><span>
</span><span id="line-256"></span><span>                     </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Cmm.Utils.html#mkFileEmbedLit"><span class="hs-identifier hs-type">mkFileEmbedLit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999782"><span class="hs-keyword hs-type">label</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999793"><span class="hs-identifier hs-type">bFile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.html#length"><span class="hs-identifier hs-type">BS.length</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999781"><span class="hs-identifier hs-type">str</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>        </span><span class="annot"><span class="annottext">DCmmDecl -&gt; FCode ()
</span><a href="GHC.StgToCmm.Monad.html#emitDecl"><span class="hs-identifier hs-var">emitDecl</span></a></span><span> </span><span class="annot"><span class="annottext">DCmmDecl
</span><a href="#local-6989586621682999790"><span class="hs-identifier hs-var">decl</span></a></span><span>
</span><span id="line-258"></span><span>        </span><span class="annot"><span class="annottext">CgIdInfo -&gt; FCode ()
</span><a href="GHC.StgToCmm.Env.html#addBindC"><span class="hs-identifier hs-var">addBindC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; Var -&gt; LambdaFormInfo -&gt; CmmLit -&gt; CgIdInfo
</span><a href="GHC.StgToCmm.Env.html#litIdInfo"><span class="hs-identifier hs-var">litIdInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StgToCmmConfig -&gt; Platform
</span><a href="GHC.StgToCmm.Config.html#stgToCmmPlatform"><span class="hs-identifier hs-var">stgToCmmPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig
</span><a href="#local-6989586621682999756"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621682999780"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">LambdaFormInfo
</span><a href="GHC.StgToCmm.Closure.html#mkLFStringLit"><span class="hs-identifier hs-var">mkLFStringLit</span></a></span><span> </span><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682999789"><span class="hs-identifier hs-var">lit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span class="annot"><a href="GHC.StgToCmm.html#cgTopRhs"><span class="hs-identifier hs-type">cgTopRhs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Config.html#StgToCmmConfig"><span class="hs-identifier hs-type">StgToCmmConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#RecFlag"><span class="hs-identifier hs-type">RecFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgRhs"><span class="hs-identifier hs-type">CgStgRhs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Monad.html#CgIdInfo"><span class="hs-identifier hs-type">CgIdInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>        </span><span class="hs-comment">-- The Id is passed along for setting up a binding...</span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span id="cgTopRhs"><span class="annot"><span class="annottext">cgTopRhs :: StgToCmmConfig
-&gt; RecFlag -&gt; Var -&gt; GenStgRhs 'CodeGen -&gt; (CgIdInfo, FCode ())
</span><a href="GHC.StgToCmm.html#cgTopRhs"><span class="hs-identifier hs-var hs-var">cgTopRhs</span></a></span></span><span> </span><span id="local-6989586621682999804"><span class="annot"><span class="annottext">StgToCmmConfig
</span><a href="#local-6989586621682999804"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span id="local-6989586621682999805"><span class="annot"><span class="annottext">RecFlag
</span><a href="#local-6989586621682999805"><span class="hs-identifier hs-var">_rec</span></a></span></span><span> </span><span id="local-6989586621682999806"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621682999806"><span class="hs-identifier hs-var">bndr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRhsCon"><span class="hs-identifier hs-type">StgRhsCon</span></a></span><span> </span><span id="local-6989586621682999808"><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621682999808"><span class="hs-identifier hs-var">_cc</span></a></span></span><span> </span><span id="local-6989586621682999809"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682999809"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621682999810"><span class="annot"><span class="annottext">ConstructorNumber
</span><a href="#local-6989586621682999810"><span class="hs-identifier hs-var">mn</span></a></span></span><span> </span><span id="local-6989586621682999811"><span class="annot"><span class="annottext">[StgTickish]
</span><a href="#local-6989586621682999811"><span class="hs-identifier hs-var">_ts</span></a></span></span><span> </span><span id="local-6989586621682999812"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682999812"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621682999813"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682999813"><span class="hs-identifier hs-var">_typ</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig
-&gt; Var
-&gt; DataCon
-&gt; ConstructorNumber
-&gt; [NonVoid StgArg]
-&gt; (CgIdInfo, FCode ())
</span><a href="GHC.StgToCmm.DataCon.html#cgTopRhsCon"><span class="hs-identifier hs-var">cgTopRhsCon</span></a></span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig
</span><a href="#local-6989586621682999804"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621682999806"><span class="hs-identifier hs-var">bndr</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682999809"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">ConstructorNumber
</span><a href="#local-6989586621682999810"><span class="hs-identifier hs-var">mn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[StgArg] -&gt; [NonVoid StgArg]
</span><a href="GHC.StgToCmm.Closure.html#assertNonVoidStgArgs"><span class="hs-identifier hs-var">assertNonVoidStgArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682999812"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-266"></span><span>      </span><span class="hs-comment">-- con args are always non-void,</span><span>
</span><span id="line-267"></span><span>      </span><span class="hs-comment">-- see Note [Post-unarisation invariants] in GHC.Stg.Unarise</span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span class="annot"><a href="GHC.StgToCmm.html#cgTopRhs"><span class="hs-identifier hs-var">cgTopRhs</span></a></span><span> </span><span id="local-6989586621682999816"><span class="annot"><span class="annottext">StgToCmmConfig
</span><a href="#local-6989586621682999816"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span id="local-6989586621682999817"><span class="annot"><span class="annottext">RecFlag
</span><a href="#local-6989586621682999817"><span class="hs-identifier hs-var">rec</span></a></span></span><span> </span><span id="local-6989586621682999818"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621682999818"><span class="hs-identifier hs-var">bndr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRhsClosure"><span class="hs-identifier hs-type">StgRhsClosure</span></a></span><span> </span><span id="local-6989586621682999820"><span class="annot"><span class="annottext">XRhsClosure 'CodeGen
</span><a href="#local-6989586621682999820"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span id="local-6989586621682999821"><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621682999821"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span id="local-6989586621682999822"><span class="annot"><span class="annottext">UpdateFlag
</span><a href="#local-6989586621682999822"><span class="hs-identifier hs-var">upd_flag</span></a></span></span><span> </span><span id="local-6989586621682999823"><span class="annot"><span class="annottext">[BinderP 'CodeGen]
</span><a href="#local-6989586621682999823"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621682999824"><span class="annot"><span class="annottext">GenStgExpr 'CodeGen
</span><a href="#local-6989586621682999824"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621682999825"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682999825"><span class="hs-identifier hs-var">_typ</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-270"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; (CgIdInfo, FCode ()) -&gt; (CgIdInfo, FCode ())
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DIdSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#isEmptyDVarSet"><span class="hs-identifier hs-var">isEmptyDVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">DIdSet
XRhsClosure 'CodeGen
</span><a href="#local-6989586621682999820"><span class="hs-identifier hs-var">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;fvs:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DIdSet -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DIdSet
XRhsClosure 'CodeGen
</span><a href="#local-6989586621682999820"><span class="hs-identifier hs-var">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((CgIdInfo, FCode ()) -&gt; (CgIdInfo, FCode ()))
-&gt; (CgIdInfo, FCode ()) -&gt; (CgIdInfo, FCode ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>   </span><span class="hs-comment">-- There should be no free variables</span><span>
</span><span id="line-271"></span><span>    </span><span class="annot"><span class="annottext">Platform
-&gt; RecFlag
-&gt; Var
-&gt; CostCentreStack
-&gt; UpdateFlag
-&gt; [Var]
-&gt; GenStgExpr 'CodeGen
-&gt; (CgIdInfo, FCode ())
</span><a href="GHC.StgToCmm.Bind.html#cgTopRhsClosure"><span class="hs-identifier hs-var">cgTopRhsClosure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StgToCmmConfig -&gt; Platform
</span><a href="GHC.StgToCmm.Config.html#stgToCmmPlatform"><span class="hs-identifier hs-var">stgToCmmPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig
</span><a href="#local-6989586621682999816"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RecFlag
</span><a href="#local-6989586621682999817"><span class="hs-identifier hs-var">rec</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621682999818"><span class="hs-identifier hs-var">bndr</span></a></span><span> </span><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621682999821"><span class="hs-identifier hs-var">cc</span></a></span><span> </span><span class="annot"><span class="annottext">UpdateFlag
</span><a href="#local-6989586621682999822"><span class="hs-identifier hs-var">upd_flag</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
[BinderP 'CodeGen]
</span><a href="#local-6989586621682999823"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'CodeGen
</span><a href="#local-6989586621682999824"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span class="hs-comment">---------------------------------------------------------------</span><span>
</span><span id="line-275"></span><span class="hs-comment">--      Module initialisation code</span><span>
</span><span id="line-276"></span><span class="hs-comment">---------------------------------------------------------------</span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span class="annot"><a href="GHC.StgToCmm.html#mkModuleInit"><span class="hs-identifier hs-type">mkModuleInit</span></a></span><span>
</span><span id="line-279"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.html#CollectedCCs"><span class="hs-identifier hs-type">CollectedCCs</span></a></span><span>         </span><span class="hs-comment">-- cost centre info</span><span>
</span><span id="line-280"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span id="mkModuleInit"><span class="annot"><span class="annottext">mkModuleInit :: CollectedCCs -&gt; FCode ()
</span><a href="GHC.StgToCmm.html#mkModuleInit"><span class="hs-identifier hs-var hs-var">mkModuleInit</span></a></span></span><span> </span><span id="local-6989586621682999829"><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621682999829"><span class="hs-identifier hs-var">cost_centre_info</span></a></span></span><span>
</span><span id="line-283"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">CollectedCCs -&gt; FCode ()
</span><a href="GHC.StgToCmm.Prof.html#initCostCentres"><span class="hs-identifier hs-var">initCostCentres</span></a></span><span> </span><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621682999829"><span class="hs-identifier hs-var">cost_centre_info</span></a></span><span>
</span><span id="line-284"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span>
</span><span id="line-287"></span><span class="hs-comment">---------------------------------------------------------------</span><span>
</span><span id="line-288"></span><span class="hs-comment">--      Generating static stuff for algebraic data types</span><span>
</span><span id="line-289"></span><span class="hs-comment">---------------------------------------------------------------</span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span class="annot"><a href="GHC.StgToCmm.html#cgEnumerationTyCon"><span class="hs-identifier hs-type">cgEnumerationTyCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-293"></span><span id="cgEnumerationTyCon"><span class="annot"><span class="annottext">cgEnumerationTyCon :: TyCon -&gt; FCode ()
</span><a href="GHC.StgToCmm.html#cgEnumerationTyCon"><span class="hs-identifier hs-var hs-var">cgEnumerationTyCon</span></a></span></span><span> </span><span id="local-6989586621682999830"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682999830"><span class="hs-identifier hs-var">tycon</span></a></span></span><span>
</span><span id="line-294"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621682999831"><span class="annot"><a href="#local-6989586621682999831"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FCode Platform
</span><a href="GHC.StgToCmm.Monad.html#getPlatform"><span class="hs-identifier hs-var">getPlatform</span></a></span><span>
</span><span id="line-295"></span><span>       </span><span class="annot"><a href="GHC.StgToCmm.Utils.html#emitRODataLits"><span class="hs-identifier hs-type">emitRODataLits</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.CLabel.html#mkClosureTableLabel"><span class="hs-identifier hs-type">mkClosureTableLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#tyConName"><span class="hs-identifier hs-var">tyConName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999830"><span class="hs-identifier hs-type">tycon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html#NoCafRefs"><span class="hs-identifier hs-type">NoCafRefs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-296"></span><span>             </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLabelOff"><span class="hs-identifier hs-type">CmmLabelOff</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.CLabel.html#mkClosureLabel"><span class="hs-identifier hs-type">mkClosureLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.DataCon.html#dataConName"><span class="hs-identifier hs-type">dataConName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999840"><span class="hs-identifier hs-type">con</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html#NoCafRefs"><span class="hs-identifier hs-type">NoCafRefs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span>                           </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Closure.html#tagForCon"><span class="hs-identifier hs-type">tagForCon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999831"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999840"><span class="hs-identifier hs-type">con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682999840"><span class="annot"><a href="#local-6989586621682999840"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#tyConDataCons"><span class="hs-identifier hs-type">tyConDataCons</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999830"><span class="hs-identifier hs-type">tycon</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-299"></span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span class="annot"><a href="GHC.StgToCmm.html#cgDataCon"><span class="hs-identifier hs-type">cgDataCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#ConInfoTableLocation"><span class="hs-identifier hs-type">ConInfoTableLocation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-302"></span><span class="hs-comment">-- Generate the entry code, info tables, and (for niladic constructor)</span><span>
</span><span id="line-303"></span><span class="hs-comment">-- the static closure, for a constructor.</span><span>
</span><span id="line-304"></span><span id="cgDataCon"><span class="annot"><span class="annottext">cgDataCon :: ConInfoTableLocation -&gt; DataCon -&gt; FCode ()
</span><a href="GHC.StgToCmm.html#cgDataCon"><span class="hs-identifier hs-var hs-var">cgDataCon</span></a></span></span><span> </span><span id="local-6989586621682999842"><span class="annot"><span class="annottext">ConInfoTableLocation
</span><a href="#local-6989586621682999842"><span class="hs-identifier hs-var">mn</span></a></span></span><span> </span><span id="local-6989586621682999843"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682999843"><span class="hs-identifier hs-var">data_con</span></a></span></span><span>
</span><span id="line-305"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; FCode ()
forall (m :: * -&gt; *). (HasCallStack, Applicative m) =&gt; Bool -&gt; m ()
</span><a href="GHC.Utils.Panic.Plain.html#massert"><span class="hs-identifier hs-var">massert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isUnboxedTupleDataCon"><span class="hs-identifier hs-var">isUnboxedTupleDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682999843"><span class="hs-identifier hs-var">data_con</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isUnboxedSumDataCon"><span class="hs-identifier hs-var">isUnboxedSumDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682999843"><span class="hs-identifier hs-var">data_con</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682999849"><span class="annot"><a href="#local-6989586621682999849"><span class="hs-identifier hs-var">profile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FCode Profile
</span><a href="GHC.StgToCmm.Monad.html#getProfile"><span class="hs-identifier hs-var">getProfile</span></a></span><span>
</span><span id="line-307"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682999851"><span class="annot"><a href="#local-6989586621682999851"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#getPlatform"><span class="hs-identifier hs-type">getPlatform</span></a></span><span>
</span><span id="line-308"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-309"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682999852"><span class="annot"><a href="#local-6989586621682999852"><span class="hs-identifier hs-var">tot_wds</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-comment">--  #ptr_wds + #nonptr_wds</span><span>
</span><span id="line-310"></span><span>             </span><span id="local-6989586621682999853"><span class="annot"><a href="#local-6989586621682999853"><span class="hs-identifier hs-var">ptr_wds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">--  #ptr_wds</span><span>
</span><span id="line-311"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Layout.html#mkVirtConstrSizes"><span class="hs-identifier hs-type">mkVirtConstrSizes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999849"><span class="hs-identifier hs-type">profile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999855"><span class="hs-identifier hs-type">arg_reps</span></a></span><span>
</span><span id="line-312"></span><span>
</span><span id="line-313"></span><span>            </span><span id="local-6989586621682999856"><span class="annot"><a href="#local-6989586621682999856"><span class="hs-identifier hs-var hs-var">nonptr_wds</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682999852"><span class="hs-identifier hs-var">tot_wds</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; WordOff -&gt; WordOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682999853"><span class="hs-identifier hs-var">ptr_wds</span></a></span><span>
</span><span id="line-314"></span><span>
</span><span id="line-315"></span><span>            </span><span id="local-6989586621682999857"><span class="annot"><a href="#local-6989586621682999857"><span class="hs-identifier hs-var hs-var">dyn_info_tbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-316"></span><span>              </span><span class="annot"><span class="annottext">Profile
-&gt; DataCon
-&gt; ConInfoTableLocation
-&gt; Bool
-&gt; WordOff
-&gt; WordOff
-&gt; CmmInfoTable
</span><a href="GHC.StgToCmm.Closure.html#mkDataConInfoTable"><span class="hs-identifier hs-var">mkDataConInfoTable</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682999849"><span class="hs-identifier hs-var">profile</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682999843"><span class="hs-identifier hs-var">data_con</span></a></span><span> </span><span class="annot"><span class="annottext">ConInfoTableLocation
</span><a href="#local-6989586621682999842"><span class="hs-identifier hs-var">mn</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682999853"><span class="hs-identifier hs-var">ptr_wds</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682999856"><span class="hs-identifier hs-var">nonptr_wds</span></a></span><span>
</span><span id="line-317"></span><span>
</span><span id="line-318"></span><span>            </span><span class="hs-comment">-- We're generating info tables, so we don't know and care about</span><span>
</span><span id="line-319"></span><span>            </span><span class="hs-comment">-- what the actual arguments are. Using () here as the place holder.</span><span>
</span><span id="line-320"></span><span>            </span><span class="annot"><a href="#local-6989586621682999855"><span class="hs-identifier hs-type">arg_reps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCon.html#PrimRep"><span class="hs-identifier hs-type">PrimRep</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-321"></span><span>            </span><span id="local-6989586621682999855"><span class="annot"><a href="#local-6989586621682999855"><span class="hs-identifier hs-var hs-var">arg_reps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621682999859"><span class="hs-identifier hs-var">rep_ty</span></a></span><span>
</span><span id="line-322"></span><span>                       </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682999860"><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621682999860"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [Scaled Type]
</span><a href="GHC.Core.DataCon.html#dataConRepArgTys"><span class="hs-identifier hs-var">dataConRepArgTys</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682999843"><span class="hs-identifier hs-var">data_con</span></a></span><span>
</span><span id="line-323"></span><span>                       </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682999859"><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621682999859"><span class="hs-identifier hs-var">rep_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; [PrimRep]
Type -&gt; [PrimRep]
</span><a href="GHC.Types.RepType.html#typePrimRep"><span class="hs-identifier hs-var">typePrimRep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled Type -&gt; Type
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621682999860"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-324"></span><span>                       </span><span class="hs-special">]</span><span>
</span><span id="line-325"></span><span>
</span><span id="line-326"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Layout.html#emitClosureAndInfoTable"><span class="hs-identifier hs-type">emitClosureAndInfoTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999851"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999857"><span class="hs-identifier hs-type">dyn_info_tbl</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#NativeDirectCall"><span class="hs-identifier hs-type">NativeDirectCall</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-327"></span><span>            </span><span class="hs-comment">-- NB: the closure pointer is assumed *untagged* on</span><span>
</span><span id="line-328"></span><span>            </span><span class="hs-comment">-- entry to a constructor.  If the pointer is tagged,</span><span>
</span><span id="line-329"></span><span>            </span><span class="hs-comment">-- then we should not be entering it.  This assumption</span><span>
</span><span id="line-330"></span><span>            </span><span class="hs-comment">-- is used in ldvEnter and when tagging the pointer to</span><span>
</span><span id="line-331"></span><span>            </span><span class="hs-comment">-- return it.</span><span>
</span><span id="line-332"></span><span>            </span><span class="hs-comment">-- NB 2: We don't set CC when entering data (WDP 94/06)</span><span>
</span><span id="line-333"></span><span>            </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyEnterDynCon"><span class="hs-identifier hs-type">tickyEnterDynCon</span></a></span><span>
</span><span id="line-334"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682999867"><span class="annot"><a href="#local-6989586621682999867"><span class="hs-identifier hs-var hs-var">node</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmReg -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmReg"><span class="hs-identifier hs-var">CmmReg</span></a></span><span> </span><span class="annot"><span class="annottext">(CmmReg -&gt; CmmExpr) -&gt; CmmReg -&gt; CmmExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmReg
</span><a href="GHC.Cmm.Reg.html#nodeReg"><span class="hs-identifier hs-var">nodeReg</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682999851"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-335"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Prof.html#ldvEnter"><span class="hs-identifier hs-type">ldvEnter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999867"><span class="hs-identifier hs-type">node</span></a></span><span>
</span><span id="line-336"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyReturnOldCon"><span class="hs-identifier hs-type">tickyReturnOldCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">length</span></span><span> </span><span class="annot"><a href="#local-6989586621682999855"><span class="hs-identifier hs-type">arg_reps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">void</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.StgToCmm.Layout.html#emitReturn"><span class="hs-identifier hs-type">emitReturn</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Utils.html#cmmOffsetB"><span class="hs-identifier hs-type">cmmOffsetB</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999851"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999867"><span class="hs-identifier hs-type">node</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Closure.html#tagForCon"><span class="hs-identifier hs-type">tagForCon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999851"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682999843"><span class="hs-identifier hs-type">data_con</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-338"></span><span>               </span><span class="hs-special">}</span><span>
</span><span id="line-339"></span><span>                    </span><span class="hs-comment">-- The case continuation code expects a tagged pointer</span><span>
</span><span id="line-340"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-341"></span></pre></body></html>