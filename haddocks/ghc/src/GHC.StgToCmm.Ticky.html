<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE MultiWayIf #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-4"></span><span class="hs-comment">--</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- Code generation for ticky-ticky profiling</span><span>
</span><span id="line-6"></span><span class="hs-comment">--</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- (c) The University of Glasgow 2004-2006</span><span>
</span><span id="line-8"></span><span class="hs-comment">--</span><span>
</span><span id="line-9"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-comment">{- OVERVIEW: ticky ticky profiling

Please see
https://gitlab.haskell.org/ghc/ghc/wikis/debugging/ticky-ticky and also
edit it and the rest of this comment to keep them up-to-date if you
change ticky-ticky. Thanks!

 *** All allocation ticky numbers are in bytes. ***

Some of the relevant source files:

       ***not necessarily an exhaustive list***

  * some codeGen/ modules import this one

  * this module imports GHC.Cmm.CLabel to manage labels

  * GHC.Cmm.Parser expands some macros using generators defined in
    this module

  * rts/include/stg/Ticky.h declares all of the global counters

  * rts/include/rts/Ticky.h declares the C data type for an
    STG-declaration's counters

  * some macros defined in rts/include/Cmm.h (and used within the RTS's
    CMM code) update the global ticky counters

  * at the end of execution rts/Ticky.c generates the final report
    +RTS -r&lt;report-file&gt; -RTS

The rts/Ticky.c function that generates the report includes an
STG-declaration's ticky counters if

  * that declaration was entered, or

  * it was allocated (if -ticky-allocd)

On either of those events, the counter is &quot;registered&quot; by adding it to
a linked list; cf the CMM generated by registerTickyCtr.

Ticky-ticky profiling has evolved over many years. Many of the
counters from its most sophisticated days are no longer
active/accurate. As the RTS has changed, sometimes the ticky code for
relevant counters was not accordingly updated. Unfortunately, neither
were the comments.

As of March 2013, there still exist deprecated code and comments in
the code generator as well as the RTS because:

  * I don't know what is out-of-date versus merely commented out for
    momentary convenience, and

  * someone else might know how to repair it!


Note [Ticky counters are static]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Currently GHC only supports static ticky events. That is -ticky emits
code containing labels containing counters which then get bumped at runtime.

There are currently only *static* ticky counters. Either we bump one of the
static counters included in the RTS. Or we emit StgEntCounter structures in
the object code and bump these.
-}</span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html"><span class="hs-identifier">GHC.StgToCmm.Ticky</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-78"></span><span>  </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#withNewTickyCounterFun"><span class="hs-identifier">withNewTickyCounterFun</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-79"></span><span>  </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#withNewTickyCounterLNE"><span class="hs-identifier">withNewTickyCounterLNE</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-80"></span><span>  </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#withNewTickyCounterThunk"><span class="hs-identifier">withNewTickyCounterThunk</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-81"></span><span>  </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#withNewTickyCounterStdThunk"><span class="hs-identifier">withNewTickyCounterStdThunk</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-82"></span><span>  </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#withNewTickyCounterCon"><span class="hs-identifier">withNewTickyCounterCon</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-83"></span><span>  </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#emitTickyCounterTag"><span class="hs-identifier">emitTickyCounterTag</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span>  </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyDynAlloc"><span class="hs-identifier">tickyDynAlloc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-86"></span><span>  </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyAllocHeap"><span class="hs-identifier">tickyAllocHeap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span>  </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyAllocPrim"><span class="hs-identifier">tickyAllocPrim</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-89"></span><span>  </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyAllocThunk"><span class="hs-identifier">tickyAllocThunk</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-90"></span><span>  </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyAllocPAP"><span class="hs-identifier">tickyAllocPAP</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-91"></span><span>  </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyHeapCheck"><span class="hs-identifier">tickyHeapCheck</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-92"></span><span>  </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyStackCheck"><span class="hs-identifier">tickyStackCheck</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span>  </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyDirectCall"><span class="hs-identifier">tickyDirectCall</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span>  </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyPushUpdateFrame"><span class="hs-identifier">tickyPushUpdateFrame</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-97"></span><span>  </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyUpdateFrameOmitted"><span class="hs-identifier">tickyUpdateFrameOmitted</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span>  </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyEnterDynCon"><span class="hs-identifier">tickyEnterDynCon</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span>  </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyEnterFun"><span class="hs-identifier">tickyEnterFun</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-102"></span><span>  </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyEnterThunk"><span class="hs-identifier">tickyEnterThunk</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-103"></span><span>  </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyEnterLNE"><span class="hs-identifier">tickyEnterLNE</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span>  </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyUpdateBhCaf"><span class="hs-identifier">tickyUpdateBhCaf</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-106"></span><span>  </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyUnboxedTupleReturn"><span class="hs-identifier">tickyUnboxedTupleReturn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-107"></span><span>  </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyReturnOldCon"><span class="hs-identifier">tickyReturnOldCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyReturnNewCon"><span class="hs-identifier">tickyReturnNewCon</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span>  </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyKnownCallTooFewArgs"><span class="hs-identifier">tickyKnownCallTooFewArgs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyKnownCallExact"><span class="hs-identifier">tickyKnownCallExact</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyKnownCallExtraArgs"><span class="hs-identifier">tickyKnownCallExtraArgs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-110"></span><span>  </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickySlowCall"><span class="hs-identifier">tickySlowCall</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickySlowCallPat"><span class="hs-identifier">tickySlowCallPat</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span>  </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyTagged"><span class="hs-identifier">tickyTagged</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyUntagged"><span class="hs-identifier">tickyUntagged</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyTagSkip"><span class="hs-identifier">tickyTagSkip</span></a></span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.html"><span class="hs-identifier">GHC.Platform</span></a></span><span>
</span><span id="line-118"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.Profile.html"><span class="hs-identifier">GHC.Platform.Profile</span></a></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.ArgRep.html"><span class="hs-identifier">GHC.StgToCmm.ArgRep</span></a></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.StgToCmm.ArgRep.html#slowCallPattern"><span class="hs-identifier">slowCallPattern</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.ArgRep.html#toArgRepOrV"><span class="hs-identifier">toArgRepOrV</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.ArgRep.html#argRepString"><span class="hs-identifier">argRepString</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Closure.html"><span class="hs-identifier">GHC.StgToCmm.Closure</span></a></span><span>
</span><span id="line-122"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Config.html"><span class="hs-identifier">GHC.StgToCmm.Config</span></a></span><span>
</span><span id="line-123"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Foreign.html"><span class="hs-identifier">GHC.StgToCmm.Foreign</span></a></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Foreign.html#emitPrimCall"><span class="hs-identifier">emitPrimCall</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Lit.html"><span class="hs-identifier">GHC.StgToCmm.Lit</span></a></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Lit.html#newStringCLit"><span class="hs-identifier">newStringCLit</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html"><span class="hs-identifier">GHC.StgToCmm.Monad</span></a></span><span>
</span><span id="line-126"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Utils.html"><span class="hs-identifier">GHC.StgToCmm.Utils</span></a></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html"><span class="hs-identifier">GHC.Stg.Syntax</span></a></span><span>
</span><span id="line-129"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html"><span class="hs-identifier">GHC.Cmm.Expr</span></a></span><span>
</span><span id="line-130"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Graph.html"><span class="hs-identifier">GHC.Cmm.Graph</span></a></span><span>
</span><span id="line-131"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Utils.html"><span class="hs-identifier">GHC.Cmm.Utils</span></a></span><span>
</span><span id="line-132"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html"><span class="hs-identifier">GHC.Cmm.CLabel</span></a></span><span>
</span><span id="line-133"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Layout.html"><span class="hs-identifier">GHC.Runtime.Heap.Layout</span></a></span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-137"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-138"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span>
</span><span id="line-139"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-140"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-141"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-142"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-143"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html"><span class="hs-identifier">GHC.Utils.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Monad.html#whenM"><span class="hs-identifier">whenM</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span class="hs-comment">-- Turgid imports for showTypeCategory</span><span>
</span><span id="line-146"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span>
</span><span id="line-147"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></a></span><span>
</span><span id="line-148"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span>
</span><span id="line-149"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-150"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html"><span class="hs-identifier">GHC.Core.Predicate</span></a></span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span>
</span><span id="line-153"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Char.html"><span class="hs-identifier">Data.Char</span></a></span><span>
</span><span id="line-154"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">when</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unless</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html"><span class="hs-identifier">GHC.Types.Id.Info</span></a></span><span>
</span><span id="line-156"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Env.html"><span class="hs-identifier">GHC.StgToCmm.Env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Env.html#getCgInfo_maybe"><span class="hs-identifier">getCgInfo_maybe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Coerce.html"><span class="hs-identifier">Data.Coerce</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">coerce</span></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Json.html"><span class="hs-identifier">GHC.Utils.Json</span></a></span><span>
</span><span id="line-159"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Unique.html"><span class="hs-identifier">GHC.Utils.Unique</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Unique.html#anyOfUnique"><span class="hs-identifier">anyOfUnique</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-162"></span><span class="hs-comment">--</span><span>
</span><span id="line-163"></span><span class="hs-comment">-- Ticky-ticky profiling</span><span>
</span><span id="line-164"></span><span class="hs-comment">--</span><span>
</span><span id="line-165"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span class="hs-comment">-- | Number of arguments for a ticky counter.</span><span>
</span><span id="line-168"></span><span class="hs-comment">--</span><span>
</span><span id="line-169"></span><span class="hs-comment">-- Ticky currently treats args to constructor allocations differently than those for functions/LNE bindings.</span><span>
</span><span id="line-170"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyArgArity"><span class="hs-identifier hs-type">tickyArgArity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyClosureType"><span class="hs-identifier hs-type">TickyClosureType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-171"></span><span id="tickyArgArity"><span class="annot"><span class="annottext">tickyArgArity :: TickyClosureType -&gt; Int
</span><a href="GHC.StgToCmm.Ticky.html#tickyArgArity"><span class="hs-identifier hs-var hs-var">tickyArgArity</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyFun"><span class="hs-identifier hs-type">TickyFun</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682888900"><span class="annot"><span class="annottext">[NonVoid Id]
</span><a href="#local-6989586621682888900"><span class="hs-identifier hs-var">_fvs</span></a></span></span><span> </span><span id="local-6989586621682888901"><span class="annot"><span class="annottext">[NonVoid Id]
</span><a href="#local-6989586621682888901"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[NonVoid Id] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[NonVoid Id]
</span><a href="#local-6989586621682888901"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-172"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyArgArity"><span class="hs-identifier hs-var">tickyArgArity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyLNE"><span class="hs-identifier hs-type">TickyLNE</span></a></span><span> </span><span id="local-6989586621682888904"><span class="annot"><span class="annottext">[NonVoid Id]
</span><a href="#local-6989586621682888904"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[NonVoid Id] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[NonVoid Id]
</span><a href="#local-6989586621682888904"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-173"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyArgArity"><span class="hs-identifier hs-var">tickyArgArity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyCon"><span class="hs-identifier hs-type">TickyCon</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-174"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyArgArity"><span class="hs-identifier hs-var">tickyArgArity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyThunk"><span class="hs-identifier hs-type">TickyThunk</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyArgDesc"><span class="hs-identifier hs-type">tickyArgDesc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyClosureType"><span class="hs-identifier hs-type">TickyClosureType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-177"></span><span id="tickyArgDesc"><span class="annot"><span class="annottext">tickyArgDesc :: TickyClosureType -&gt; String
</span><a href="GHC.StgToCmm.Ticky.html#tickyArgDesc"><span class="hs-identifier hs-var hs-var">tickyArgDesc</span></a></span></span><span> </span><span id="local-6989586621682888908"><span class="annot"><span class="annottext">TickyClosureType
</span><a href="#local-6989586621682888908"><span class="hs-identifier hs-var">arg_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-178"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TickyClosureType
</span><a href="#local-6989586621682888908"><span class="hs-identifier hs-var">arg_info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-179"></span><span>    </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyFun"><span class="hs-identifier hs-type">TickyFun</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682888909"><span class="annot"><span class="annottext">[NonVoid Id]
</span><a href="#local-6989586621682888909"><span class="hs-identifier hs-var">_fvs</span></a></span></span><span> </span><span id="local-6989586621682888910"><span class="annot"><span class="annottext">[NonVoid Id]
</span><a href="#local-6989586621682888910"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(NonVoid Id -&gt; Char) -&gt; [NonVoid Id] -&gt; String
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Char
</span><a href="GHC.StgToCmm.Ticky.html#showTypeCategory"><span class="hs-identifier hs-var">showTypeCategory</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Char) -&gt; (NonVoid Id -&gt; Type) -&gt; NonVoid Id -&gt; Char
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Type) -&gt; (NonVoid Id -&gt; Id) -&gt; NonVoid Id -&gt; Type
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NonVoid Id -&gt; Id
forall a. NonVoid a -&gt; a
</span><a href="GHC.StgToCmm.Closure.html#fromNonVoid"><span class="hs-identifier hs-var">fromNonVoid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NonVoid Id]
</span><a href="#local-6989586621682888910"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-180"></span><span>    </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyLNE"><span class="hs-identifier hs-type">TickyLNE</span></a></span><span> </span><span id="local-6989586621682888915"><span class="annot"><span class="annottext">[NonVoid Id]
</span><a href="#local-6989586621682888915"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(NonVoid Id -&gt; Char) -&gt; [NonVoid Id] -&gt; String
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Char
</span><a href="GHC.StgToCmm.Ticky.html#showTypeCategory"><span class="hs-identifier hs-var">showTypeCategory</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Char) -&gt; (NonVoid Id -&gt; Type) -&gt; NonVoid Id -&gt; Char
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Type) -&gt; (NonVoid Id -&gt; Id) -&gt; NonVoid Id -&gt; Type
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NonVoid Id -&gt; Id
forall a. NonVoid a -&gt; a
</span><a href="GHC.StgToCmm.Closure.html#fromNonVoid"><span class="hs-identifier hs-var">fromNonVoid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NonVoid Id]
</span><a href="#local-6989586621682888915"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-181"></span><span>    </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyThunk"><span class="hs-identifier hs-type">TickyThunk</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-182"></span><span>    </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyCon"><span class="hs-identifier hs-type">TickyCon</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyFvDesc"><span class="hs-identifier hs-type">tickyFvDesc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyClosureType"><span class="hs-identifier hs-type">TickyClosureType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-185"></span><span id="tickyFvDesc"><span class="annot"><span class="annottext">tickyFvDesc :: TickyClosureType -&gt; String
</span><a href="GHC.StgToCmm.Ticky.html#tickyFvDesc"><span class="hs-identifier hs-var hs-var">tickyFvDesc</span></a></span></span><span> </span><span id="local-6989586621682888917"><span class="annot"><span class="annottext">TickyClosureType
</span><a href="#local-6989586621682888917"><span class="hs-identifier hs-var">arg_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-186"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TickyClosureType
</span><a href="#local-6989586621682888917"><span class="hs-identifier hs-var">arg_info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-187"></span><span>    </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyFun"><span class="hs-identifier hs-type">TickyFun</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682888918"><span class="annot"><span class="annottext">[NonVoid Id]
</span><a href="#local-6989586621682888918"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span id="local-6989586621682888919"><span class="annot"><span class="annottext">[NonVoid Id]
</span><a href="#local-6989586621682888919"><span class="hs-identifier hs-var">_args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(NonVoid Id -&gt; Char) -&gt; [NonVoid Id] -&gt; String
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Char
</span><a href="GHC.StgToCmm.Ticky.html#showTypeCategory"><span class="hs-identifier hs-var">showTypeCategory</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Char) -&gt; (NonVoid Id -&gt; Type) -&gt; NonVoid Id -&gt; Char
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Type) -&gt; (NonVoid Id -&gt; Id) -&gt; NonVoid Id -&gt; Type
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NonVoid Id -&gt; Id
forall a. NonVoid a -&gt; a
</span><a href="GHC.StgToCmm.Closure.html#fromNonVoid"><span class="hs-identifier hs-var">fromNonVoid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NonVoid Id]
</span><a href="#local-6989586621682888918"><span class="hs-identifier hs-var">fvs</span></a></span><span>
</span><span id="line-188"></span><span>    </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyLNE"><span class="hs-identifier hs-type">TickyLNE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-189"></span><span>    </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyThunk"><span class="hs-identifier hs-type">TickyThunk</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682888920"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682888920"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(StgArg -&gt; Char) -&gt; [StgArg] -&gt; String
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Char
</span><a href="GHC.StgToCmm.Ticky.html#showTypeCategory"><span class="hs-identifier hs-var">showTypeCategory</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Char) -&gt; (StgArg -&gt; Type) -&gt; StgArg -&gt; Char
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">StgArg -&gt; Type
</span><a href="GHC.Stg.Syntax.html#stgArgType"><span class="hs-identifier hs-var">stgArgType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682888920"><span class="hs-identifier hs-var">fvs</span></a></span><span>
</span><span id="line-190"></span><span>    </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyCon"><span class="hs-identifier hs-type">TickyCon</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Json.html#ToJson"><span class="hs-identifier hs-type">ToJson</span></a></span><span> </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyClosureType"><span class="hs-identifier hs-type">TickyClosureType</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-193"></span><span>    </span><span id="local-6989586621682888932"><span class="annot"><span class="annottext">json :: TickyClosureType -&gt; JsonDoc
</span><a href="#local-6989586621682888932"><span class="hs-identifier hs-var hs-var hs-var">json</span></a></span></span><span> </span><span id="local-6989586621682888934"><span class="annot"><span class="annottext">TickyClosureType
</span><a href="#local-6989586621682888934"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TickyClosureType
</span><a href="#local-6989586621682888934"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-194"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyFun"><span class="hs-identifier hs-type">TickyFun</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String -&gt; JsonDoc
</span><a href="#local-6989586621682888935"><span class="hs-identifier hs-var">mkInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TickyClosureType -&gt; String
</span><a href="GHC.StgToCmm.Ticky.html#tickyFvDesc"><span class="hs-identifier hs-var">tickyFvDesc</span></a></span><span> </span><span class="annot"><span class="annottext">TickyClosureType
</span><a href="#local-6989586621682888934"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TickyClosureType -&gt; String
</span><a href="GHC.StgToCmm.Ticky.html#tickyArgDesc"><span class="hs-identifier hs-var">tickyArgDesc</span></a></span><span> </span><span class="annot"><span class="annottext">TickyClosureType
</span><a href="#local-6989586621682888934"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;fun&quot;</span></span><span>
</span><span id="line-195"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyLNE"><span class="hs-identifier hs-type">TickyLNE</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String -&gt; JsonDoc
</span><a href="#local-6989586621682888935"><span class="hs-identifier hs-var">mkInfo</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TickyClosureType -&gt; String
</span><a href="GHC.StgToCmm.Ticky.html#tickyArgDesc"><span class="hs-identifier hs-var">tickyArgDesc</span></a></span><span> </span><span class="annot"><span class="annottext">TickyClosureType
</span><a href="#local-6989586621682888934"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;lne&quot;</span></span><span>
</span><span id="line-196"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyThunk"><span class="hs-identifier hs-type">TickyThunk</span></a></span><span> </span><span id="local-6989586621682888936"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682888936"><span class="hs-identifier hs-var">uf</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String -&gt; JsonDoc
</span><a href="#local-6989586621682888935"><span class="hs-identifier hs-var">mkInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TickyClosureType -&gt; String
</span><a href="GHC.StgToCmm.Ticky.html#tickyFvDesc"><span class="hs-identifier hs-var">tickyFvDesc</span></a></span><span> </span><span class="annot"><span class="annottext">TickyClosureType
</span><a href="#local-6989586621682888934"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;thk&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682888936"><span class="hs-identifier hs-var">uf</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_u&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyCon"><span class="hs-identifier hs-type">TickyCon</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String -&gt; JsonDoc
</span><a href="#local-6989586621682888935"><span class="hs-identifier hs-var">mkInfo</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>                 </span><span class="hs-special">[</span><span class="hs-special">]</span><span>                  </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;con&quot;</span></span><span>
</span><span id="line-198"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-199"></span><span>        </span><span class="annot"><a href="#local-6989586621682888935"><span class="hs-identifier hs-type">mkInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Json.html#JsonDoc"><span class="hs-identifier hs-type">JsonDoc</span></a></span><span>
</span><span id="line-200"></span><span>        </span><span id="local-6989586621682888935"><span class="annot"><span class="annottext">mkInfo :: String -&gt; String -&gt; String -&gt; JsonDoc
</span><a href="#local-6989586621682888935"><span class="hs-identifier hs-var hs-var">mkInfo</span></a></span></span><span> </span><span id="local-6989586621682888937"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682888937"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span id="local-6989586621682888938"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682888938"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621682888939"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682888939"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-201"></span><span>          </span><span class="annot"><span class="annottext">[(String, JsonDoc)] -&gt; JsonDoc
</span><a href="GHC.Utils.Json.html#JSObject"><span class="hs-identifier hs-var">JSObject</span></a></span><span>
</span><span id="line-202"></span><span>              </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;type&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; JsonDoc
forall a. ToJson a =&gt; a -&gt; JsonDoc
</span><a href="GHC.Utils.Json.html#json"><span class="hs-identifier hs-var">json</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;entCntr&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>              </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;subTy&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; JsonDoc
forall a. ToJson a =&gt; a -&gt; JsonDoc
</span><a href="GHC.Utils.Json.html#json"><span class="hs-identifier hs-var">json</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682888939"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>              </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;fvs_c&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; JsonDoc
forall a. ToJson a =&gt; a -&gt; JsonDoc
</span><a href="GHC.Utils.Json.html#json"><span class="hs-identifier hs-var">json</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682888937"><span class="hs-identifier hs-var">fvs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>              </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;fvs&quot;</span></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; JsonDoc
forall a. ToJson a =&gt; a -&gt; JsonDoc
</span><a href="GHC.Utils.Json.html#json"><span class="hs-identifier hs-var">json</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682888937"><span class="hs-identifier hs-var">fvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>              </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;args&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; JsonDoc
forall a. ToJson a =&gt; a -&gt; JsonDoc
</span><a href="GHC.Utils.Json.html#json"><span class="hs-identifier hs-var">json</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682888938"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyEntryDescJson"><span class="hs-identifier hs-type">tickyEntryDescJson</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#SDocContext"><span class="hs-identifier hs-type">SDocContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyClosureType"><span class="hs-identifier hs-type">TickyClosureType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span id="tickyEntryDescJson"><span class="annot"><span class="annottext">tickyEntryDescJson :: SDocContext -&gt; TickyClosureType -&gt; String
</span><a href="GHC.StgToCmm.Ticky.html#tickyEntryDescJson"><span class="hs-identifier hs-var hs-var">tickyEntryDescJson</span></a></span></span><span> </span><span id="local-6989586621682888942"><span class="annot"><span class="annottext">SDocContext
</span><a href="#local-6989586621682888942"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDocContext -&gt; SDoc -&gt; String
</span><a href="GHC.Utils.Outputable.html#renderWithContext"><span class="hs-identifier hs-var">renderWithContext</span></a></span><span> </span><span class="annot"><span class="annottext">SDocContext
</span><a href="#local-6989586621682888942"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; String)
-&gt; (TickyClosureType -&gt; SDoc) -&gt; TickyClosureType -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">JsonDoc -&gt; SDoc
</span><a href="GHC.Utils.Json.html#renderJSON"><span class="hs-identifier hs-var">renderJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(JsonDoc -&gt; SDoc)
-&gt; (TickyClosureType -&gt; JsonDoc) -&gt; TickyClosureType -&gt; SDoc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TickyClosureType -&gt; JsonDoc
forall a. ToJson a =&gt; a -&gt; JsonDoc
</span><a href="GHC.Utils.Json.html#json"><span class="hs-identifier hs-var">json</span></a></span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span class="hs-keyword">data</span><span> </span><span id="TickyClosureType"><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyClosureType"><span class="hs-identifier hs-var">TickyClosureType</span></a></span></span><span>
</span><span id="line-213"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="TickyFun"><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyFun"><span class="hs-identifier hs-var">TickyFun</span></a></span></span><span>
</span><span id="line-214"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-comment">-- True &lt;-&gt; single entry</span><span>
</span><span id="line-215"></span><span>        </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToCmm.Closure.html#NonVoid"><span class="hs-identifier hs-type">NonVoid</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-comment">-- ^ FVs</span></span><span>
</span><span id="line-216"></span><span>        </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToCmm.Closure.html#NonVoid"><span class="hs-identifier hs-type">NonVoid</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-comment">-- ^ Args</span></span><span>
</span><span id="line-217"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="TickyCon"><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyCon"><span class="hs-identifier hs-var">TickyCon</span></a></span></span><span>
</span><span id="line-218"></span><span>        </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-comment">-- the allocated constructor</span><span>
</span><span id="line-219"></span><span>        </span><span class="annot"><a href="GHC.Stg.Syntax.html#ConstructorNumber"><span class="hs-identifier hs-type">ConstructorNumber</span></a></span><span>
</span><span id="line-220"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="TickyThunk"><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyThunk"><span class="hs-identifier hs-var">TickyThunk</span></a></span></span><span>
</span><span id="line-221"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-comment">-- True &lt;-&gt; updateable</span><span>
</span><span id="line-222"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-comment">-- True &lt;-&gt; standard thunk (AP or selector), has no entry counter</span><span>
</span><span id="line-223"></span><span>        </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-comment">-- ^ FVS, StgArg because for thunks these can also be literals.</span></span><span>
</span><span id="line-224"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="TickyLNE"><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyLNE"><span class="hs-identifier hs-var">TickyLNE</span></a></span></span><span>
</span><span id="line-225"></span><span>        </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToCmm.Closure.html#NonVoid"><span class="hs-identifier hs-type">NonVoid</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-comment">-- ^ Args</span></span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span id="local-6989586621682888579"><span class="annot"><a href="GHC.StgToCmm.Ticky.html#withNewTickyCounterFun"><span class="hs-identifier hs-type">withNewTickyCounterFun</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToCmm.Closure.html#NonVoid"><span class="hs-identifier hs-type">NonVoid</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToCmm.Closure.html#NonVoid"><span class="hs-identifier hs-type">NonVoid</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682888579"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682888579"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-228"></span><span id="withNewTickyCounterFun"><span class="annot"><span class="annottext">withNewTickyCounterFun :: forall a.
Bool -&gt; Id -&gt; [NonVoid Id] -&gt; [NonVoid Id] -&gt; FCode a -&gt; FCode a
</span><a href="GHC.StgToCmm.Ticky.html#withNewTickyCounterFun"><span class="hs-identifier hs-var hs-var">withNewTickyCounterFun</span></a></span></span><span> </span><span id="local-6989586621682888945"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682888945"><span class="hs-identifier hs-var">single_entry</span></a></span></span><span> </span><span id="local-6989586621682888946"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682888946"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682888947"><span class="annot"><span class="annottext">[NonVoid Id]
</span><a href="#local-6989586621682888947"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span id="local-6989586621682888948"><span class="annot"><span class="annottext">[NonVoid Id]
</span><a href="#local-6989586621682888948"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TickyClosureType -&gt; Id -&gt; FCode a -&gt; FCode a
forall a. TickyClosureType -&gt; Id -&gt; FCode a -&gt; FCode a
</span><a href="GHC.StgToCmm.Ticky.html#withNewTickyCounter"><span class="hs-identifier hs-var">withNewTickyCounter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; [NonVoid Id] -&gt; [NonVoid Id] -&gt; TickyClosureType
</span><a href="GHC.StgToCmm.Ticky.html#TickyFun"><span class="hs-identifier hs-var">TickyFun</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682888945"><span class="hs-identifier hs-var">single_entry</span></a></span><span> </span><span class="annot"><span class="annottext">[NonVoid Id]
</span><a href="#local-6989586621682888947"><span class="hs-identifier hs-var">fvs</span></a></span><span> </span><span class="annot"><span class="annottext">[NonVoid Id]
</span><a href="#local-6989586621682888948"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682888946"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span id="local-6989586621682888582"><span class="annot"><a href="GHC.StgToCmm.Ticky.html#withNewTickyCounterLNE"><span class="hs-identifier hs-type">withNewTickyCounterLNE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToCmm.Closure.html#NonVoid"><span class="hs-identifier hs-type">NonVoid</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682888582"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682888582"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-231"></span><span id="withNewTickyCounterLNE"><span class="annot"><span class="annottext">withNewTickyCounterLNE :: forall a. Id -&gt; [NonVoid Id] -&gt; FCode a -&gt; FCode a
</span><a href="GHC.StgToCmm.Ticky.html#withNewTickyCounterLNE"><span class="hs-identifier hs-var hs-var">withNewTickyCounterLNE</span></a></span></span><span> </span><span id="local-6989586621682888951"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682888951"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span id="local-6989586621682888952"><span class="annot"><span class="annottext">[NonVoid Id]
</span><a href="#local-6989586621682888952"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621682888953"><span class="annot"><span class="annottext">FCode a
</span><a href="#local-6989586621682888953"><span class="hs-identifier hs-var">code</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-232"></span><span>  </span><span id="local-6989586621682888954"><span class="annot"><a href="#local-6989586621682888954"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(StgToCmmConfig -&gt; Bool) -&gt; FCode Bool
</span><a href="GHC.StgToCmm.Ticky.html#isEnabled"><span class="hs-identifier hs-var">isEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig -&gt; Bool
</span><a href="GHC.StgToCmm.Config.html#stgToCmmTickyLNE"><span class="hs-identifier hs-var">stgToCmmTickyLNE</span></a></span><span>
</span><span id="line-233"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="annot"><a href="#local-6989586621682888954"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="#local-6989586621682888953"><span class="hs-identifier hs-type">code</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#withNewTickyCounter"><span class="hs-identifier hs-type">withNewTickyCounter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyLNE"><span class="hs-identifier hs-type">TickyLNE</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682888952"><span class="hs-identifier hs-type">args</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682888951"><span class="hs-identifier hs-type">nm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682888953"><span class="hs-identifier hs-type">code</span></a></span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#thunkHasCounter"><span class="hs-identifier hs-type">thunkHasCounter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-236"></span><span id="thunkHasCounter"><span class="annot"><span class="annottext">thunkHasCounter :: Bool -&gt; FCode Bool
</span><a href="GHC.StgToCmm.Ticky.html#thunkHasCounter"><span class="hs-identifier hs-var hs-var">thunkHasCounter</span></a></span></span><span> </span><span id="local-6989586621682888959"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682888959"><span class="hs-identifier hs-var">isStatic</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682888959"><span class="hs-identifier hs-var">isStatic</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; FCode Bool -&gt; FCode Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(StgToCmmConfig -&gt; Bool) -&gt; FCode Bool
</span><a href="GHC.StgToCmm.Ticky.html#isEnabled"><span class="hs-identifier hs-var">isEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig -&gt; Bool
</span><a href="GHC.StgToCmm.Config.html#stgToCmmTickyDynThunk"><span class="hs-identifier hs-var">stgToCmmTickyDynThunk</span></a></span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span id="local-6989586621682888588"><span class="annot"><a href="GHC.StgToCmm.Ticky.html#withNewTickyCounterThunk"><span class="hs-identifier hs-type">withNewTickyCounterThunk</span></a></span><span>
</span><span id="line-239"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ static</span></span><span>
</span><span id="line-240"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ updateable</span></span><span>
</span><span id="line-241"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-242"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToCmm.Closure.html#NonVoid"><span class="hs-identifier hs-type">NonVoid</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-comment">-- ^ Free vars</span></span><span>
</span><span id="line-243"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682888588"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-244"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682888588"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-245"></span><span id="withNewTickyCounterThunk"><span class="annot"><span class="annottext">withNewTickyCounterThunk :: forall a. Bool -&gt; Bool -&gt; Id -&gt; [NonVoid Id] -&gt; FCode a -&gt; FCode a
</span><a href="GHC.StgToCmm.Ticky.html#withNewTickyCounterThunk"><span class="hs-identifier hs-var hs-var">withNewTickyCounterThunk</span></a></span></span><span> </span><span id="local-6989586621682888965"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682888965"><span class="hs-identifier hs-var">isStatic</span></a></span></span><span> </span><span id="local-6989586621682888966"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682888966"><span class="hs-identifier hs-var">isUpdatable</span></a></span></span><span> </span><span id="local-6989586621682888967"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682888967"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621682888968"><span class="annot"><span class="annottext">[NonVoid Id]
</span><a href="#local-6989586621682888968"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span id="local-6989586621682888969"><span class="annot"><span class="annottext">FCode a
</span><a href="#local-6989586621682888969"><span class="hs-identifier hs-var">code</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-246"></span><span>    </span><span id="local-6989586621682888970"><span class="annot"><a href="#local-6989586621682888970"><span class="hs-identifier hs-var">has_ctr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; FCode Bool
</span><a href="GHC.StgToCmm.Ticky.html#thunkHasCounter"><span class="hs-identifier hs-var">thunkHasCounter</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682888965"><span class="hs-identifier hs-var">isStatic</span></a></span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="annot"><a href="#local-6989586621682888970"><span class="hs-identifier hs-type">has_ctr</span></a></span><span>
</span><span id="line-248"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="#local-6989586621682888969"><span class="hs-identifier hs-type">code</span></a></span><span>
</span><span id="line-249"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#withNewTickyCounter"><span class="hs-identifier hs-type">withNewTickyCounter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyThunk"><span class="hs-identifier hs-type">TickyThunk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682888966"><span class="hs-identifier hs-type">isUpdatable</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgVarArg"><span class="hs-identifier hs-type">StgVarArg</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">coerce</span></span><span> </span><span class="annot"><a href="#local-6989586621682888968"><span class="hs-identifier hs-type">fvs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682888967"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682888969"><span class="hs-identifier hs-type">code</span></a></span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span id="local-6989586621682888596"><span class="annot"><a href="GHC.StgToCmm.Ticky.html#withNewTickyCounterStdThunk"><span class="hs-identifier hs-type">withNewTickyCounterStdThunk</span></a></span><span>
</span><span id="line-252"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ updateable</span></span><span>
</span><span id="line-253"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-254"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-comment">-- ^ Free vars + function</span></span><span>
</span><span id="line-255"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682888596"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-256"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682888596"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-257"></span><span id="withNewTickyCounterStdThunk"><span class="annot"><span class="annottext">withNewTickyCounterStdThunk :: forall a. Bool -&gt; Id -&gt; [StgArg] -&gt; FCode a -&gt; FCode a
</span><a href="GHC.StgToCmm.Ticky.html#withNewTickyCounterStdThunk"><span class="hs-identifier hs-var hs-var">withNewTickyCounterStdThunk</span></a></span></span><span> </span><span id="local-6989586621682888973"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682888973"><span class="hs-identifier hs-var">isUpdatable</span></a></span></span><span> </span><span id="local-6989586621682888974"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682888974"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621682888975"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682888975"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span id="local-6989586621682888976"><span class="annot"><span class="annottext">FCode a
</span><a href="#local-6989586621682888976"><span class="hs-identifier hs-var">code</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-258"></span><span>    </span><span id="local-6989586621682888977"><span class="annot"><a href="#local-6989586621682888977"><span class="hs-identifier hs-var">has_ctr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; FCode Bool
</span><a href="GHC.StgToCmm.Ticky.html#thunkHasCounter"><span class="hs-identifier hs-var">thunkHasCounter</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-259"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="annot"><a href="#local-6989586621682888977"><span class="hs-identifier hs-type">has_ctr</span></a></span><span>
</span><span id="line-260"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="#local-6989586621682888976"><span class="hs-identifier hs-type">code</span></a></span><span>
</span><span id="line-261"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#withNewTickyCounter"><span class="hs-identifier hs-type">withNewTickyCounter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyThunk"><span class="hs-identifier hs-type">TickyThunk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682888973"><span class="hs-identifier hs-type">isUpdatable</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="annot"><a href="#local-6989586621682888975"><span class="hs-identifier hs-type">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682888974"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682888976"><span class="hs-identifier hs-type">code</span></a></span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span id="local-6989586621682888600"><span class="annot"><a href="GHC.StgToCmm.Ticky.html#withNewTickyCounterCon"><span class="hs-identifier hs-type">withNewTickyCounterCon</span></a></span><span>
</span><span id="line-264"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-265"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span>
</span><span id="line-266"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#ConstructorNumber"><span class="hs-identifier hs-type">ConstructorNumber</span></a></span><span>
</span><span id="line-267"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682888600"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-268"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682888600"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-269"></span><span id="withNewTickyCounterCon"><span class="annot"><span class="annottext">withNewTickyCounterCon :: forall a. Id -&gt; DataCon -&gt; ConstructorNumber -&gt; FCode a -&gt; FCode a
</span><a href="GHC.StgToCmm.Ticky.html#withNewTickyCounterCon"><span class="hs-identifier hs-var hs-var">withNewTickyCounterCon</span></a></span></span><span> </span><span id="local-6989586621682888979"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682888979"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621682888980"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682888980"><span class="hs-identifier hs-var">datacon</span></a></span></span><span> </span><span id="local-6989586621682888981"><span class="annot"><span class="annottext">ConstructorNumber
</span><a href="#local-6989586621682888981"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621682888982"><span class="annot"><span class="annottext">FCode a
</span><a href="#local-6989586621682888982"><span class="hs-identifier hs-var">code</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-270"></span><span>    </span><span id="local-6989586621682888983"><span class="annot"><a href="#local-6989586621682888983"><span class="hs-identifier hs-var">has_ctr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; FCode Bool
</span><a href="GHC.StgToCmm.Ticky.html#thunkHasCounter"><span class="hs-identifier hs-var">thunkHasCounter</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-271"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="annot"><a href="#local-6989586621682888983"><span class="hs-identifier hs-type">has_ctr</span></a></span><span>
</span><span id="line-272"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="#local-6989586621682888982"><span class="hs-identifier hs-type">code</span></a></span><span>
</span><span id="line-273"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#withNewTickyCounter"><span class="hs-identifier hs-type">withNewTickyCounter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyCon"><span class="hs-identifier hs-type">TickyCon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682888980"><span class="hs-identifier hs-type">datacon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682888981"><span class="hs-identifier hs-type">info</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682888979"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682888982"><span class="hs-identifier hs-type">code</span></a></span><span>
</span><span id="line-274"></span><span>
</span><span id="line-275"></span><span class="hs-comment">-- args does not include the void arguments</span><span>
</span><span id="line-276"></span><span id="local-6989586621682888581"><span class="annot"><a href="GHC.StgToCmm.Ticky.html#withNewTickyCounter"><span class="hs-identifier hs-type">withNewTickyCounter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyClosureType"><span class="hs-identifier hs-type">TickyClosureType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682888581"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682888581"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-277"></span><span id="withNewTickyCounter"><span class="annot"><span class="annottext">withNewTickyCounter :: forall a. TickyClosureType -&gt; Id -&gt; FCode a -&gt; FCode a
</span><a href="GHC.StgToCmm.Ticky.html#withNewTickyCounter"><span class="hs-identifier hs-var hs-var">withNewTickyCounter</span></a></span></span><span> </span><span id="local-6989586621682888985"><span class="annot"><span class="annottext">TickyClosureType
</span><a href="#local-6989586621682888985"><span class="hs-identifier hs-var">cloType</span></a></span></span><span> </span><span id="local-6989586621682888986"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682888986"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621682888987"><span class="annot"><span class="annottext">FCode a
</span><a href="#local-6989586621682888987"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-278"></span><span>  </span><span id="local-6989586621682888988"><span class="annot"><a href="#local-6989586621682888988"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TickyClosureType -&gt; Id -&gt; FCode CLabel
</span><a href="GHC.StgToCmm.Ticky.html#emitTickyCounter"><span class="hs-identifier hs-var">emitTickyCounter</span></a></span><span> </span><span class="annot"><span class="annottext">TickyClosureType
</span><a href="#local-6989586621682888985"><span class="hs-identifier hs-var">cloType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682888986"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-279"></span><span>  </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#setTickyCtrLabel"><span class="hs-identifier hs-type">setTickyCtrLabel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682888988"><span class="hs-identifier hs-type">lbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682888987"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-280"></span><span>
</span><span id="line-281"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#emitTickyData"><span class="hs-identifier hs-type">emitTickyData</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span>
</span><span id="line-282"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ lbl for the counter</span></span><span>
</span><span id="line-283"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ arity</span></span><span>
</span><span id="line-284"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ fun desc</span></span><span>
</span><span id="line-285"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ arg desc</span></span><span>
</span><span id="line-286"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ json desc</span></span><span>
</span><span id="line-287"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ info table lbl</span></span><span>
</span><span id="line-288"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span id="emitTickyData"><span class="annot"><span class="annottext">emitTickyData :: Platform
-&gt; CLabel
-&gt; Int
-&gt; CmmLit
-&gt; CmmLit
-&gt; CmmLit
-&gt; CmmLit
-&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#emitTickyData"><span class="hs-identifier hs-var hs-var">emitTickyData</span></a></span></span><span> </span><span id="local-6989586621682888993"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682888993"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621682888994"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682888994"><span class="hs-identifier hs-var">ctr_lbl</span></a></span></span><span> </span><span id="local-6989586621682888995"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682888995"><span class="hs-identifier hs-var">arity</span></a></span></span><span> </span><span id="local-6989586621682888996"><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682888996"><span class="hs-identifier hs-var">fun_desc</span></a></span></span><span> </span><span id="local-6989586621682888997"><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682888997"><span class="hs-identifier hs-var">arg_desc</span></a></span></span><span> </span><span id="local-6989586621682888998"><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682888998"><span class="hs-identifier hs-var">json_desc</span></a></span></span><span> </span><span id="local-6989586621682888999"><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682888999"><span class="hs-identifier hs-var">info_tbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-290"></span><span>  </span><span class="annot"><span class="annottext">CLabel -&gt; [CmmLit] -&gt; FCode ()
</span><a href="GHC.StgToCmm.Utils.html#emitDataLits"><span class="hs-identifier hs-var">emitDataLits</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682888994"><span class="hs-identifier hs-var">ctr_lbl</span></a></span><span>
</span><span id="line-291"></span><span>    </span><span class="hs-comment">-- Must match layout of rts/include/rts/Ticky.h's StgEntCounter</span><span>
</span><span id="line-292"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-293"></span><span>    </span><span class="hs-comment">-- krc: note that all the fields are I32 now; some were I16</span><span>
</span><span id="line-294"></span><span>    </span><span class="hs-comment">-- before, but the code generator wasn't handling that</span><span>
</span><span id="line-295"></span><span>    </span><span class="hs-comment">-- properly and it led to chaos, panic and disorder.</span><span>
</span><span id="line-296"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmLit
</span><a href="GHC.Cmm.Utils.html#zeroCLit"><span class="hs-identifier hs-var">zeroCLit</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682888993"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">,</span><span>               </span><span class="hs-comment">-- registered?</span><span>
</span><span id="line-297"></span><span>          </span><span class="annot"><span class="annottext">Platform -&gt; Int -&gt; CmmLit
</span><a href="GHC.Cmm.Utils.html#mkIntCLit"><span class="hs-identifier hs-var">mkIntCLit</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682888993"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682888995"><span class="hs-identifier hs-var">arity</span></a></span><span class="hs-special">,</span><span>   </span><span class="hs-comment">-- Arity</span><span>
</span><span id="line-298"></span><span>          </span><span class="annot"><span class="annottext">Platform -&gt; CmmLit
</span><a href="GHC.Cmm.Utils.html#zeroCLit"><span class="hs-identifier hs-var">zeroCLit</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682888993"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">,</span><span>               </span><span class="hs-comment">-- Heap allocated for this thing</span><span>
</span><span id="line-299"></span><span>          </span><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682888996"><span class="hs-identifier hs-var">fun_desc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-300"></span><span>          </span><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682888997"><span class="hs-identifier hs-var">arg_desc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-301"></span><span>          </span><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682888998"><span class="hs-identifier hs-var">json_desc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-302"></span><span>          </span><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682888999"><span class="hs-identifier hs-var">info_tbl</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-303"></span><span>          </span><span class="annot"><span class="annottext">Platform -&gt; CmmLit
</span><a href="GHC.Cmm.Utils.html#zeroCLit"><span class="hs-identifier hs-var">zeroCLit</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682888993"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">,</span><span>          </span><span class="hs-comment">-- Entries into this thing</span><span>
</span><span id="line-304"></span><span>          </span><span class="annot"><span class="annottext">Platform -&gt; CmmLit
</span><a href="GHC.Cmm.Utils.html#zeroCLit"><span class="hs-identifier hs-var">zeroCLit</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682888993"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">,</span><span>          </span><span class="hs-comment">-- Heap allocated by this thing</span><span>
</span><span id="line-305"></span><span>          </span><span class="annot"><span class="annottext">Platform -&gt; CmmLit
</span><a href="GHC.Cmm.Utils.html#zeroCLit"><span class="hs-identifier hs-var">zeroCLit</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682888993"><span class="hs-identifier hs-var">platform</span></a></span><span>           </span><span class="hs-comment">-- Link to next StgEntCounter</span><span>
</span><span id="line-306"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-307"></span><span>
</span><span id="line-308"></span><span>
</span><span id="line-309"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#emitTickyCounter"><span class="hs-identifier hs-type">emitTickyCounter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyClosureType"><span class="hs-identifier hs-type">TickyClosureType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span>
</span><span id="line-310"></span><span id="emitTickyCounter"><span class="annot"><span class="annottext">emitTickyCounter :: TickyClosureType -&gt; Id -&gt; FCode CLabel
</span><a href="GHC.StgToCmm.Ticky.html#emitTickyCounter"><span class="hs-identifier hs-var hs-var">emitTickyCounter</span></a></span></span><span> </span><span id="local-6989586621682889003"><span class="annot"><span class="annottext">TickyClosureType
</span><a href="#local-6989586621682889003"><span class="hs-identifier hs-var">cloType</span></a></span></span><span> </span><span id="local-6989586621682889004"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682889004"><span class="hs-identifier hs-var">tickee</span></a></span></span><span>
</span><span id="line-311"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682889005"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621682889005"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682889004"><span class="hs-identifier hs-var">tickee</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-312"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682889007"><span class="annot"><span class="annottext">ctr_lbl :: CLabel
</span><a href="#local-6989586621682889007"><span class="hs-identifier hs-var hs-var">ctr_lbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#mkRednCountsLabel"><span class="hs-identifier hs-var">mkRednCountsLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682889005"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-313"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FCode () -&gt; FCode CLabel -&gt; FCode CLabel
forall a b. FCode a -&gt; FCode b -&gt; FCode b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; FCode CLabel
forall a. a -&gt; FCode a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682889007"><span class="hs-identifier hs-var">ctr_lbl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(FCode () -&gt; FCode CLabel) -&gt; FCode () -&gt; FCode CLabel
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-314"></span><span>    </span><span class="annot"><span class="annottext">FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#ifTicky"><span class="hs-identifier hs-var">ifTicky</span></a></span><span> </span><span class="annot"><span class="annottext">(FCode () -&gt; FCode ()) -&gt; FCode () -&gt; FCode ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-315"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682889010"><span class="annot"><a href="#local-6989586621682889010"><span class="hs-identifier hs-var">cfg</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FCode StgToCmmConfig
</span><a href="GHC.StgToCmm.Monad.html#getStgToCmmConfig"><span class="hs-identifier hs-var">getStgToCmmConfig</span></a></span><span>
</span><span id="line-316"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682889012"><span class="annot"><a href="#local-6989586621682889012"><span class="hs-identifier hs-var">parent</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#getTickyCtrLabel"><span class="hs-identifier hs-type">getTickyCtrLabel</span></a></span><span>
</span><span id="line-317"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682889014"><span class="annot"><a href="#local-6989586621682889014"><span class="hs-identifier hs-var">mod_name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#getModuleName"><span class="hs-identifier hs-type">getModuleName</span></a></span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span>          </span><span class="hs-comment">-- When printing the name of a thing in a ticky file, we</span><span>
</span><span id="line-320"></span><span>          </span><span class="hs-comment">-- want to give the module name even for *local* things.  We</span><span>
</span><span id="line-321"></span><span>          </span><span class="hs-comment">-- print just &quot;x (M)&quot; rather that &quot;M.x&quot; to distinguish them</span><span>
</span><span id="line-322"></span><span>          </span><span class="hs-comment">-- from the global kind by calling to @pprTickyName@</span><span>
</span><span id="line-323"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682889016"><span class="annot"><a href="#local-6989586621682889016"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig -&gt; Platform
</span><a href="GHC.StgToCmm.Config.html#stgToCmmPlatform"><span class="hs-identifier hs-var">stgToCmmPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig
</span><a href="#local-6989586621682889010"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-324"></span><span>              </span><span class="annot"><a href="#local-6989586621682889018"><span class="hs-identifier hs-type">ppr_for_ticky_name</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-325"></span><span>              </span><span id="local-6989586621682889018"><span class="annot"><a href="#local-6989586621682889018"><span class="hs-identifier hs-var hs-var">ppr_for_ticky_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-326"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682889019"><span class="annot"><span class="annottext">ext :: SDoc
</span><a href="#local-6989586621682889019"><span class="hs-identifier hs-var hs-var">ext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TickyClosureType
</span><a href="#local-6989586621682889003"><span class="hs-identifier hs-var">cloType</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-327"></span><span>                              </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyFun"><span class="hs-identifier hs-type">TickyFun</span></a></span><span> </span><span id="local-6989586621682889020"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682889020"><span class="hs-identifier hs-var">single_entry</span></a></span></span><span> </span><span class="annot"><span class="annottext">[NonVoid Id]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[NonVoid Id]
</span><span class="hs-identifier">_</span></span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#hcat"><span class="hs-identifier hs-var">hcat</span></a></span><span> </span><span class="annot"><span class="annottext">([SDoc] -&gt; SDoc) -&gt; [SDoc] -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; [SDoc] -&gt; [SDoc]
forall doc. IsLine doc =&gt; doc -&gt; [doc] -&gt; [doc]
</span><a href="GHC.Utils.Outputable.html#punctuate"><span class="hs-identifier hs-var">punctuate</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span> </span><span class="annot"><span class="annottext">([SDoc] -&gt; [SDoc]) -&gt; [SDoc] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-328"></span><span>                                  </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;fun&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; [SDoc] -&gt; [SDoc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;se&quot;</span></span><span class="hs-glyph">|</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682889020"><span class="hs-identifier hs-var">single_entry</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-329"></span><span>                              </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyCon"><span class="hs-identifier hs-type">TickyCon</span></a></span><span> </span><span id="local-6989586621682889026"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682889026"><span class="hs-identifier hs-var">datacon</span></a></span></span><span> </span><span id="local-6989586621682889027"><span class="annot"><span class="annottext">ConstructorNumber
</span><a href="#local-6989586621682889027"><span class="hs-identifier hs-var">_cn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;con:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Name
</span><a href="GHC.Core.DataCon.html#dataConName"><span class="hs-identifier hs-var">dataConName</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682889026"><span class="hs-identifier hs-var">datacon</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span>                              </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyThunk"><span class="hs-identifier hs-type">TickyThunk</span></a></span><span> </span><span id="local-6989586621682889031"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682889031"><span class="hs-identifier hs-var">upd</span></a></span></span><span> </span><span id="local-6989586621682889032"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682889032"><span class="hs-identifier hs-var">std</span></a></span></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><span class="hs-identifier">_</span></span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#hcat"><span class="hs-identifier hs-var">hcat</span></a></span><span> </span><span class="annot"><span class="annottext">([SDoc] -&gt; SDoc) -&gt; [SDoc] -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; [SDoc] -&gt; [SDoc]
forall doc. IsLine doc =&gt; doc -&gt; [doc] -&gt; [doc]
</span><a href="GHC.Utils.Outputable.html#punctuate"><span class="hs-identifier hs-var">punctuate</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span> </span><span class="annot"><span class="annottext">([SDoc] -&gt; [SDoc]) -&gt; [SDoc] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-331"></span><span>                                  </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;thk&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; [SDoc] -&gt; [SDoc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;se&quot;</span></span><span class="hs-glyph">|</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682889031"><span class="hs-identifier hs-var">upd</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; [SDoc] -&gt; [SDoc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;std&quot;</span></span><span class="hs-glyph">|</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682889032"><span class="hs-identifier hs-var">std</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-332"></span><span>                              </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyLNE"><span class="hs-identifier hs-type">TickyLNE</span></a></span><span> </span><span class="annot"><span class="annottext">[NonVoid Id]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="GHC.Types.Name.html#isInternalName"><span class="hs-identifier hs-var">isInternalName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682889005"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;LNE&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-333"></span><span>                                         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;emitTickyCounter: how is this an external LNE?&quot;</span></span><span>
</span><span id="line-334"></span><span>                    </span><span id="local-6989586621682889035"><span class="annot"><span class="annottext">p :: SDoc
</span><a href="#local-6989586621682889035"><span class="hs-identifier hs-var hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; Maybe Name
</span><a href="GHC.Cmm.CLabel.html#hasHaskellName"><span class="hs-identifier hs-var">hasHaskellName</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682889012"><span class="hs-identifier hs-var">parent</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-335"></span><span>                            </span><span class="hs-comment">-- NB the default &quot;top&quot; ticky ctr does not</span><span>
</span><span id="line-336"></span><span>                            </span><span class="hs-comment">-- have a Haskell name</span><span>
</span><span id="line-337"></span><span>                          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682889037"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682889037"><span class="hs-identifier hs-var">pname</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;in&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Unique -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Unique
</span><a href="GHC.Types.Name.html#nameUnique"><span class="hs-identifier hs-var">nameUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682889037"><span class="hs-identifier hs-var">pname</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>                          </span><span class="annot"><span class="annottext">Maybe Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-339"></span><span>                </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Module -&gt; Name -&gt; SDoc
</span><a href="GHC.Types.Name.html#pprTickyName"><span class="hs-identifier hs-var">pprTickyName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682889014"><span class="hs-identifier hs-var">mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682889005"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682889019"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682889035"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-340"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682889041"><span class="annot"><a href="#local-6989586621682889041"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#getModuleName"><span class="hs-identifier hs-type">getModuleName</span></a></span><span>
</span><span id="line-341"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682889042"><span class="annot"><a href="#local-6989586621682889042"><span class="hs-identifier hs-var hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TickyClosureType
</span><a href="#local-6989586621682889003"><span class="hs-identifier hs-var">cloType</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-342"></span><span>                    </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyCon"><span class="hs-identifier hs-type">TickyCon</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;C&quot;</span></span><span>
</span><span id="line-343"></span><span>                    </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyFun"><span class="hs-identifier hs-type">TickyFun</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;F&quot;</span></span><span>
</span><span id="line-344"></span><span>                    </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyThunk"><span class="hs-identifier hs-type">TickyThunk</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;T&quot;</span></span><span>
</span><span id="line-345"></span><span>                    </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyLNE"><span class="hs-identifier hs-type">TickyLNE</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;L&quot;</span></span><span>
</span><span id="line-346"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682889043"><span class="annot"><a href="#local-6989586621682889043"><span class="hs-identifier hs-var">info_lbl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682889003"><span class="hs-identifier hs-type">cloType</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-347"></span><span>                            </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyCon"><span class="hs-identifier hs-type">TickyCon</span></a></span><span> </span><span id="local-6989586621682889044"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682889044"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span id="local-6989586621682889045"><span class="annot"><span class="annottext">ConstructorNumber
</span><a href="#local-6989586621682889045"><span class="hs-identifier hs-var">mn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ConstructorNumber
</span><a href="#local-6989586621682889045"><span class="hs-identifier hs-var">mn</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-348"></span><span>                                               </span><span class="annot"><span class="annottext">ConstructorNumber
</span><a href="GHC.Stg.Syntax.html#NoNumber"><span class="hs-identifier hs-var">NoNumber</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CmmLit -&gt; FCode CmmLit
forall a. a -&gt; FCode a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(CmmLit -&gt; FCode CmmLit) -&gt; CmmLit -&gt; FCode CmmLit
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; CmmLit
</span><a href="GHC.Cmm.Expr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a></span><span> </span><span class="annot"><span class="annottext">(CLabel -&gt; CmmLit) -&gt; CLabel -&gt; CmmLit
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; ConInfoTableLocation -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#mkConInfoTableLabel"><span class="hs-identifier hs-var">mkConInfoTableLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Name
</span><a href="GHC.Core.DataCon.html#dataConName"><span class="hs-identifier hs-var">dataConName</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682889044"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ConInfoTableLocation
</span><a href="GHC.Cmm.CLabel.html#DefinitionSite"><span class="hs-identifier hs-var">DefinitionSite</span></a></span><span>
</span><span id="line-349"></span><span>                                               </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#Numbered"><span class="hs-identifier hs-type">Numbered</span></a></span><span> </span><span id="local-6989586621682889052"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682889052"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CmmLit -&gt; FCode CmmLit
forall a. a -&gt; FCode a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(CmmLit -&gt; FCode CmmLit) -&gt; CmmLit -&gt; FCode CmmLit
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; CmmLit
</span><a href="GHC.Cmm.Expr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a></span><span> </span><span class="annot"><span class="annottext">(CLabel -&gt; CmmLit) -&gt; CLabel -&gt; CmmLit
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; ConInfoTableLocation -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#mkConInfoTableLabel"><span class="hs-identifier hs-var">mkConInfoTableLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Name
</span><a href="GHC.Core.DataCon.html#dataConName"><span class="hs-identifier hs-var">dataConName</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682889044"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; Int -&gt; ConInfoTableLocation
</span><a href="GHC.Cmm.CLabel.html#UsageSite"><span class="hs-identifier hs-var">UsageSite</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682889041"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682889052"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-350"></span><span>                            </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyFun"><span class="hs-identifier hs-type">TickyFun</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-351"></span><span>                              </span><span class="annot"><span class="annottext">CmmLit -&gt; FCode CmmLit
forall a. a -&gt; FCode a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(CmmLit -&gt; FCode CmmLit) -&gt; CmmLit -&gt; FCode CmmLit
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; CmmLit
</span><a href="GHC.Cmm.Expr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a></span><span> </span><span class="annot"><span class="annottext">(CLabel -&gt; CmmLit) -&gt; CLabel -&gt; CmmLit
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; CafInfo -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#mkInfoTableLabel"><span class="hs-identifier hs-var">mkInfoTableLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682889005"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">CafInfo
</span><a href="GHC.Types.Id.Info.html#NoCafRefs"><span class="hs-identifier hs-var">NoCafRefs</span></a></span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span>                            </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyThunk"><span class="hs-identifier hs-type">TickyThunk</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682889056"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682889056"><span class="hs-identifier hs-var">std_thunk</span></a></span></span><span> </span><span id="local-6989586621682889057"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682889057"><span class="hs-identifier hs-var">_fvs</span></a></span></span><span>
</span><span id="line-354"></span><span>                              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682889056"><span class="hs-identifier hs-var">std_thunk</span></a></span><span>
</span><span id="line-355"></span><span>                              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CmmLit -&gt; FCode CmmLit
forall a. a -&gt; FCode a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(CmmLit -&gt; FCode CmmLit) -&gt; CmmLit -&gt; FCode CmmLit
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; CmmLit
</span><a href="GHC.Cmm.Expr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a></span><span> </span><span class="annot"><span class="annottext">(CLabel -&gt; CmmLit) -&gt; CLabel -&gt; CmmLit
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; CafInfo -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#mkInfoTableLabel"><span class="hs-identifier hs-var">mkInfoTableLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682889005"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">CafInfo
</span><a href="GHC.Types.Id.Info.html#NoCafRefs"><span class="hs-identifier hs-var">NoCafRefs</span></a></span><span>
</span><span id="line-356"></span><span>                              </span><span class="hs-comment">-- IPE Maps have no entry for std thunks.</span><span>
</span><span id="line-357"></span><span>                              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-358"></span><span>                              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-359"></span><span>                                    </span><span id="local-6989586621682889058"><span class="annot"><a href="#local-6989586621682889058"><span class="hs-identifier hs-var">lf_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; FCode (Maybe CgIdInfo)
</span><a href="GHC.StgToCmm.Env.html#getCgInfo_maybe"><span class="hs-identifier hs-var">getCgInfo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682889005"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-360"></span><span>                                    </span><span id="local-6989586621682889059"><span class="annot"><a href="#local-6989586621682889059"><span class="hs-identifier hs-var">profile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#getProfile"><span class="hs-identifier hs-type">getProfile</span></a></span><span>
</span><span id="line-361"></span><span>                                    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682889058"><span class="hs-identifier hs-type">lf_info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-362"></span><span>                                      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Monad.html#CgIdInfo"><span class="hs-identifier hs-type">CgIdInfo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cg_lf :: CgIdInfo -&gt; LambdaFormInfo
</span><a href="GHC.StgToCmm.Monad.html#cg_lf"><span class="hs-identifier hs-var">cg_lf</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682889063"><span class="annot"><span class="annottext">LambdaFormInfo
</span><a href="#local-6989586621682889063"><span class="hs-identifier hs-var">cg_lf</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-363"></span><span>                                          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">LambdaFormInfo -&gt; Bool
</span><a href="GHC.StgToCmm.Closure.html#isLFThunk"><span class="hs-identifier hs-var">isLFThunk</span></a></span><span> </span><span class="annot"><span class="annottext">LambdaFormInfo
</span><a href="#local-6989586621682889063"><span class="hs-identifier hs-var">cg_lf</span></a></span><span>
</span><span id="line-364"></span><span>                                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CmmLit -&gt; FCode CmmLit
forall a. a -&gt; FCode a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(CmmLit -&gt; FCode CmmLit) -&gt; CmmLit -&gt; FCode CmmLit
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; CmmLit
</span><a href="GHC.Cmm.Expr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a></span><span> </span><span class="annot"><span class="annottext">(CLabel -&gt; CmmLit) -&gt; CLabel -&gt; CmmLit
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Id -&gt; LambdaFormInfo -&gt; CLabel
</span><a href="GHC.StgToCmm.Closure.html#mkClosureInfoTableLabel"><span class="hs-identifier hs-var">mkClosureInfoTableLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Profile -&gt; Platform
</span><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682889059"><span class="hs-identifier hs-var">profile</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682889004"><span class="hs-identifier hs-var">tickee</span></a></span><span> </span><span class="annot"><span class="annottext">LambdaFormInfo
</span><a href="#local-6989586621682889063"><span class="hs-identifier hs-var">cg_lf</span></a></span><span>
</span><span id="line-365"></span><span>                                      </span><span class="annot"><span class="annottext">Maybe CgIdInfo
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
-&gt; SDoc -&gt; (CmmLit -&gt; FCode CmmLit) -&gt; CmmLit -&gt; FCode CmmLit
forall a. String -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Trace.html#pprTraceDebug"><span class="hs-identifier hs-var">pprTraceDebug</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tickyThunkUnknown&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682889042"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682889005"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CLabel -&gt; SDoc
</span><a href="GHC.Cmm.CLabel.html#pprDebugCLabel"><span class="hs-identifier hs-var">pprDebugCLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Profile -&gt; Platform
</span><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682889059"><span class="hs-identifier hs-var">profile</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; CafInfo -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#mkInfoTableLabel"><span class="hs-identifier hs-var">mkInfoTableLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682889005"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">CafInfo
</span><a href="GHC.Types.Id.Info.html#NoCafRefs"><span class="hs-identifier hs-var">NoCafRefs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-366"></span><span>                                            </span><span class="annot"><span class="annottext">CmmLit -&gt; FCode CmmLit
forall a. a -&gt; FCode a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(CmmLit -&gt; FCode CmmLit) -&gt; CmmLit -&gt; FCode CmmLit
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmLit
</span><a href="GHC.Cmm.Utils.html#zeroCLit"><span class="hs-identifier hs-var">zeroCLit</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682889016"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-367"></span><span>
</span><span id="line-368"></span><span>                            </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#TickyLNE"><span class="hs-identifier hs-type">TickyLNE</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CmmLit -&gt; FCode CmmLit
forall a. a -&gt; FCode a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(CmmLit -&gt; FCode CmmLit) -&gt; CmmLit -&gt; FCode CmmLit
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmLit
</span><a href="GHC.Cmm.Utils.html#zeroCLit"><span class="hs-identifier hs-var">zeroCLit</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682889016"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-369"></span><span>
</span><span id="line-370"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682889071"><span class="annot"><a href="#local-6989586621682889071"><span class="hs-identifier hs-var hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDocContext
</span><a href="GHC.Utils.Outputable.html#defaultSDocContext"><span class="hs-identifier hs-var">defaultSDocContext</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="GHC.Utils.Outputable.html#sdocPprDebug"><span class="hs-identifier hs-var">sdocPprDebug</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span class="hs-special">}</span><span>
</span><span id="line-371"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682889074"><span class="annot"><a href="#local-6989586621682889074"><span class="hs-identifier hs-var">fun_descr_lit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Lit.html#newStringCLit"><span class="hs-identifier hs-type">newStringCLit</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#renderWithContext"><span class="hs-identifier hs-type">renderWithContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889071"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889018"><span class="hs-identifier hs-type">ppr_for_ticky_name</span></a></span><span>
</span><span id="line-372"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682889075"><span class="annot"><a href="#local-6989586621682889075"><span class="hs-identifier hs-var">arg_descr_lit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Lit.html#newStringCLit"><span class="hs-identifier hs-type">newStringCLit</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyArgDesc"><span class="hs-identifier hs-type">tickyArgDesc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889003"><span class="hs-identifier hs-type">cloType</span></a></span><span>
</span><span id="line-373"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682889076"><span class="annot"><a href="#local-6989586621682889076"><span class="hs-identifier hs-var">json_descr_lit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Lit.html#newStringCLit"><span class="hs-identifier hs-type">newStringCLit</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyEntryDescJson"><span class="hs-identifier hs-type">tickyEntryDescJson</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889071"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889003"><span class="hs-identifier hs-type">cloType</span></a></span><span>
</span><span id="line-374"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#emitTickyData"><span class="hs-identifier hs-type">emitTickyData</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889016"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889007"><span class="hs-identifier hs-type">ctr_lbl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyArgArity"><span class="hs-identifier hs-type">tickyArgArity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889003"><span class="hs-identifier hs-type">cloType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682889074"><span class="hs-identifier hs-type">fun_descr_lit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889075"><span class="hs-identifier hs-type">arg_descr_lit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889076"><span class="hs-identifier hs-type">json_descr_lit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889043"><span class="hs-identifier hs-type">info_lbl</span></a></span><span>
</span><span id="line-375"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-376"></span><span>
</span><span id="line-377"></span><span class="hs-comment">{- Note [TagSkip ticky counters]
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
These counters keep track how often we execute code where we
would have performed a tag check if we hadn't run tag inference.

If we have some code of the form:
    case v[tagged] of ...
and we want to record how often we avoid a tag check on v
through tag inference we have to emit a new StgEntCounter for
each such case statement in order to record how often it's executed.

In theory we could emit one per *binding*. But then we
would have to either keep track of the bindings which
already have a StgEntCounter associated with them in the
code gen state or preallocate such a structure for each binding
in the code unconditionally (since ticky-code can call non-ticky code)

The first makes the compiler slower, even when ticky is not
used (a big no no). The later is fairly complex but increases code size
unconditionally. See also Note [Ticky counters are static].

So instead we emit a new StgEntCounter for each use site of a binding
where we infered a tag to be present. And increment the counter whenever
this use site is executed.

We use the fields as follows:

entry_count: Entries avoided.
str:       : Name of the id.

We use emitTickyCounterTag to emit the counter.

Unlike the closure counters each *use* site of v has it's own
counter. So there is no need to keep track of the closure/case we are
in.

We also have to pass a unique for the counter. An Id might be
scrutinized in more than one place, so the ID alone isn't enough
to distinguish between use sites.
-}</span><span>
</span><span id="line-417"></span><span>
</span><span id="line-418"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#emitTickyCounterTag"><span class="hs-identifier hs-type">emitTickyCounterTag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Closure.html#NonVoid"><span class="hs-identifier hs-type">NonVoid</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span>
</span><span id="line-419"></span><span id="emitTickyCounterTag"><span class="annot"><span class="annottext">emitTickyCounterTag :: Unique -&gt; NonVoid Id -&gt; FCode CLabel
</span><a href="GHC.StgToCmm.Ticky.html#emitTickyCounterTag"><span class="hs-identifier hs-var hs-var">emitTickyCounterTag</span></a></span></span><span> </span><span id="local-6989586621682889077"><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682889077"><span class="hs-identifier hs-var">unique</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Closure.html#NonVoid"><span class="hs-identifier hs-type">NonVoid</span></a></span><span> </span><span id="local-6989586621682889079"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682889079"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-420"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682889080"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621682889080"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682889079"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-421"></span><span>      </span><span id="local-6989586621682889081"><span class="annot"><span class="annottext">ctr_lbl :: CLabel
</span><a href="#local-6989586621682889081"><span class="hs-identifier hs-var hs-var">ctr_lbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Unique -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#mkTagHitLabel"><span class="hs-identifier hs-var">mkTagHitLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682889080"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682889077"><span class="hs-identifier hs-var">unique</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-422"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FCode () -&gt; FCode CLabel -&gt; FCode CLabel
forall a b. FCode a -&gt; FCode b -&gt; FCode b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; FCode CLabel
forall a. a -&gt; FCode a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682889081"><span class="hs-identifier hs-var">ctr_lbl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(FCode () -&gt; FCode CLabel) -&gt; FCode () -&gt; FCode CLabel
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-423"></span><span>    </span><span class="annot"><span class="annottext">FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#ifTickyTag"><span class="hs-identifier hs-var">ifTickyTag</span></a></span><span> </span><span class="annot"><span class="annottext">(FCode () -&gt; FCode ()) -&gt; FCode () -&gt; FCode ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-424"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682889084"><span class="annot"><a href="#local-6989586621682889084"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FCode Platform
</span><a href="GHC.StgToCmm.Monad.html#getPlatform"><span class="hs-identifier hs-var">getPlatform</span></a></span><span>
</span><span id="line-425"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682889086"><span class="annot"><a href="#local-6989586621682889086"><span class="hs-identifier hs-var">parent</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#getTickyCtrLabel"><span class="hs-identifier hs-type">getTickyCtrLabel</span></a></span><span>
</span><span id="line-426"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682889087"><span class="annot"><a href="#local-6989586621682889087"><span class="hs-identifier hs-var">mod_name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#getModuleName"><span class="hs-identifier hs-type">getModuleName</span></a></span><span>
</span><span id="line-427"></span><span>
</span><span id="line-428"></span><span>          </span><span class="hs-comment">-- When printing the name of a thing in a ticky file, we</span><span>
</span><span id="line-429"></span><span>          </span><span class="hs-comment">-- want to give the module name even for *local* things.  We</span><span>
</span><span id="line-430"></span><span>          </span><span class="hs-comment">-- print just &quot;x (M)&quot; rather that &quot;M.x&quot; to distinguish them</span><span>
</span><span id="line-431"></span><span>          </span><span class="hs-comment">-- from the global kind.</span><span>
</span><span id="line-432"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621682889088"><span class="hs-identifier hs-type">ppr_for_ticky_name</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-433"></span><span>              </span><span id="local-6989586621682889088"><span class="annot"><a href="#local-6989586621682889088"><span class="hs-identifier hs-var hs-var">ppr_for_ticky_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-434"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682889089"><span class="annot"><span class="annottext">n :: SDoc
</span><a href="#local-6989586621682889089"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682889080"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-435"></span><span>                    </span><span id="local-6989586621682889091"><span class="annot"><span class="annottext">ext :: SDoc
</span><a href="#local-6989586621682889091"><span class="hs-identifier hs-var hs-var">ext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span> </span><span class="hs-comment">-- parens (text &quot;tagged&quot;)</span><span>
</span><span id="line-436"></span><span>                    </span><span id="local-6989586621682889092"><span class="annot"><span class="annottext">p :: SDoc
</span><a href="#local-6989586621682889092"><span class="hs-identifier hs-var hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; Maybe Name
</span><a href="GHC.Cmm.CLabel.html#hasHaskellName"><span class="hs-identifier hs-var">hasHaskellName</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682889086"><span class="hs-identifier hs-var">parent</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-437"></span><span>                            </span><span class="hs-comment">-- NB the default &quot;top&quot; ticky ctr does not</span><span>
</span><span id="line-438"></span><span>                            </span><span class="hs-comment">-- have a Haskell name</span><span>
</span><span id="line-439"></span><span>                          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682889093"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682889093"><span class="hs-identifier hs-var">pname</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;at&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SrcLoc
</span><a href="GHC.Types.Name.html#nameSrcLoc"><span class="hs-identifier hs-var">nameSrcLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682889093"><span class="hs-identifier hs-var">pname</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-440"></span><span>                                          </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;in&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; SDoc
</span><a href="GHC.Types.Name.html#pprNameUnqualified"><span class="hs-identifier hs-var">pprNameUnqualified</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682889080"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-441"></span><span>                          </span><span class="annot"><span class="annottext">Maybe Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-442"></span><span>                </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="GHC.Types.Name.html#isInternalName"><span class="hs-identifier hs-var">isInternalName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682889080"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-443"></span><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682889089"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682889087"><span class="hs-identifier hs-var">mod_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682889091"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682889092"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-444"></span><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682889089"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682889091"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682889092"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-445"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682889096"><span class="annot"><a href="#local-6989586621682889096"><span class="hs-identifier hs-var">sdoc_context</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Config.html#stgToCmmContext"><span class="hs-identifier hs-var">stgToCmmContext</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#getStgToCmmConfig"><span class="hs-identifier hs-type">getStgToCmmConfig</span></a></span><span>
</span><span id="line-446"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682889098"><span class="annot"><a href="#local-6989586621682889098"><span class="hs-identifier hs-var">fun_descr_lit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Lit.html#newStringCLit"><span class="hs-identifier hs-type">newStringCLit</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#renderWithContext"><span class="hs-identifier hs-type">renderWithContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889096"><span class="hs-identifier hs-type">sdoc_context</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889088"><span class="hs-identifier hs-type">ppr_for_ticky_name</span></a></span><span>
</span><span id="line-447"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682889099"><span class="annot"><a href="#local-6989586621682889099"><span class="hs-identifier hs-var">arg_descr_lit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Lit.html#newStringCLit"><span class="hs-identifier hs-type">newStringCLit</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;infer&quot;</span></span><span>
</span><span id="line-448"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682889100"><span class="annot"><a href="#local-6989586621682889100"><span class="hs-identifier hs-var">json_descr_lit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Lit.html#newStringCLit"><span class="hs-identifier hs-type">newStringCLit</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;infer&quot;</span></span><span>
</span><span id="line-449"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#emitTickyData"><span class="hs-identifier hs-type">emitTickyData</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889084"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889081"><span class="hs-identifier hs-type">ctr_lbl</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><a href="#local-6989586621682889098"><span class="hs-identifier hs-type">fun_descr_lit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889099"><span class="hs-identifier hs-type">arg_descr_lit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889100"><span class="hs-identifier hs-type">json_descr_lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Utils.html#zeroCLit"><span class="hs-identifier hs-type">zeroCLit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889084"><span class="hs-identifier hs-type">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-450"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-451"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-452"></span><span class="hs-comment">-- Ticky stack frames</span><span>
</span><span id="line-453"></span><span>
</span><span id="line-454"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyPushUpdateFrame"><span class="hs-identifier hs-type">tickyPushUpdateFrame</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyUpdateFrameOmitted"><span class="hs-identifier hs-type">tickyUpdateFrameOmitted</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-455"></span><span id="tickyPushUpdateFrame"><span class="annot"><span class="annottext">tickyPushUpdateFrame :: FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#tickyPushUpdateFrame"><span class="hs-identifier hs-var hs-var">tickyPushUpdateFrame</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#ifTicky"><span class="hs-identifier hs-var">ifTicky</span></a></span><span> </span><span class="annot"><span class="annottext">(FCode () -&gt; FCode ()) -&gt; FCode () -&gt; FCode ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounter"><span class="hs-identifier hs-var">bumpTickyCounter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;UPDF_PUSHED_ctr&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-456"></span><span id="tickyUpdateFrameOmitted"><span class="annot"><span class="annottext">tickyUpdateFrameOmitted :: FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#tickyUpdateFrameOmitted"><span class="hs-identifier hs-var hs-var">tickyUpdateFrameOmitted</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#ifTicky"><span class="hs-identifier hs-var">ifTicky</span></a></span><span> </span><span class="annot"><span class="annottext">(FCode () -&gt; FCode ()) -&gt; FCode () -&gt; FCode ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounter"><span class="hs-identifier hs-var">bumpTickyCounter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;UPDF_OMITTED_ctr&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-457"></span><span>
</span><span id="line-458"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-459"></span><span class="hs-comment">-- Ticky entries</span><span>
</span><span id="line-460"></span><span>
</span><span id="line-461"></span><span class="hs-comment">-- NB the name-specific entries are only available for names that have</span><span>
</span><span id="line-462"></span><span class="hs-comment">-- dedicated Cmm code. As far as I know, this just rules out</span><span>
</span><span id="line-463"></span><span class="hs-comment">-- constructor thunks. For them, there is no CMM code block to put the</span><span>
</span><span id="line-464"></span><span class="hs-comment">-- bump of name-specific ticky counter into. On the other hand, we can</span><span>
</span><span id="line-465"></span><span class="hs-comment">-- still track allocation their allocation.</span><span>
</span><span id="line-466"></span><span>
</span><span id="line-467"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyEnterDynCon"><span class="hs-identifier hs-type">tickyEnterDynCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-468"></span><span id="tickyEnterDynCon"><span class="annot"><span class="annottext">tickyEnterDynCon :: FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#tickyEnterDynCon"><span class="hs-identifier hs-var hs-var">tickyEnterDynCon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#ifTicky"><span class="hs-identifier hs-var">ifTicky</span></a></span><span> </span><span class="annot"><span class="annottext">(FCode () -&gt; FCode ()) -&gt; FCode () -&gt; FCode ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounter"><span class="hs-identifier hs-var">bumpTickyCounter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ENT_DYN_CON_ctr&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-469"></span><span>
</span><span id="line-470"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyEnterThunk"><span class="hs-identifier hs-type">tickyEnterThunk</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Closure.html#ClosureInfo"><span class="hs-identifier hs-type">ClosureInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-471"></span><span id="tickyEnterThunk"><span class="annot"><span class="annottext">tickyEnterThunk :: ClosureInfo -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#tickyEnterThunk"><span class="hs-identifier hs-var hs-var">tickyEnterThunk</span></a></span></span><span> </span><span id="local-6989586621682889103"><span class="annot"><span class="annottext">ClosureInfo
</span><a href="#local-6989586621682889103"><span class="hs-identifier hs-var">cl_info</span></a></span></span><span>
</span><span id="line-472"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#ifTicky"><span class="hs-identifier hs-var">ifTicky</span></a></span><span> </span><span class="annot"><span class="annottext">(FCode () -&gt; FCode ()) -&gt; FCode () -&gt; FCode ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-473"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounter"><span class="hs-identifier hs-var">bumpTickyCounter</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682889104"><span class="hs-identifier hs-var">ctr</span></a></span><span>
</span><span id="line-474"></span><span>    </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682889105"><span class="annot"><a href="#local-6989586621682889105"><span class="hs-identifier hs-var">has_ctr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; FCode Bool
</span><a href="GHC.StgToCmm.Ticky.html#thunkHasCounter"><span class="hs-identifier hs-var">thunkHasCounter</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682889106"><span class="hs-identifier hs-var">static</span></a></span><span>
</span><span id="line-475"></span><span>    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="annot"><a href="#local-6989586621682889105"><span class="hs-identifier hs-type">has_ctr</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-476"></span><span>      </span><span id="local-6989586621682889107"><span class="annot"><a href="#local-6989586621682889107"><span class="hs-identifier hs-var">ticky_ctr_lbl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#getTickyCtrLabel"><span class="hs-identifier hs-type">getTickyCtrLabel</span></a></span><span>
</span><span id="line-477"></span><span>      </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#registerTickyCtrAtEntryDyn"><span class="hs-identifier hs-type">registerTickyCtrAtEntryDyn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889107"><span class="hs-identifier hs-type">ticky_ctr_lbl</span></a></span><span>
</span><span id="line-478"></span><span>      </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#bumpTickyEntryCount"><span class="hs-identifier hs-type">bumpTickyEntryCount</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889107"><span class="hs-identifier hs-type">ticky_ctr_lbl</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-479"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-480"></span><span>    </span><span id="local-6989586621682889110"><span class="annot"><span class="annottext">updatable :: Bool
</span><a href="#local-6989586621682889110"><span class="hs-identifier hs-var hs-var">updatable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClosureInfo -&gt; Bool
</span><a href="GHC.StgToCmm.Closure.html#closureUpdReqd"><span class="hs-identifier hs-var">closureUpdReqd</span></a></span><span> </span><span class="annot"><span class="annottext">ClosureInfo
</span><a href="#local-6989586621682889103"><span class="hs-identifier hs-var">cl_info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-481"></span><span>    </span><span id="local-6989586621682889106"><span class="annot"><span class="annottext">static :: Bool
</span><a href="#local-6989586621682889106"><span class="hs-identifier hs-var hs-var">static</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClosureInfo -&gt; Bool
</span><a href="GHC.StgToCmm.Closure.html#isStaticClosure"><span class="hs-identifier hs-var">isStaticClosure</span></a></span><span> </span><span class="annot"><span class="annottext">ClosureInfo
</span><a href="#local-6989586621682889103"><span class="hs-identifier hs-var">cl_info</span></a></span><span>
</span><span id="line-482"></span><span>
</span><span id="line-483"></span><span>    </span><span id="local-6989586621682889104"><span class="annot"><span class="annottext">ctr :: FastString
</span><a href="#local-6989586621682889104"><span class="hs-identifier hs-var hs-var">ctr</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682889106"><span class="hs-identifier hs-var">static</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682889110"><span class="hs-identifier hs-var">updatable</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ENT_STATIC_THK_SINGLE_ctr&quot;</span></span><span>
</span><span id="line-484"></span><span>                                   </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ENT_STATIC_THK_MANY_ctr&quot;</span></span><span>
</span><span id="line-485"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682889110"><span class="hs-identifier hs-var">updatable</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ENT_DYN_THK_SINGLE_ctr&quot;</span></span><span>
</span><span id="line-486"></span><span>                                   </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ENT_DYN_THK_MANY_ctr&quot;</span></span><span>
</span><span id="line-487"></span><span>
</span><span id="line-488"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyUpdateBhCaf"><span class="hs-identifier hs-type">tickyUpdateBhCaf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Closure.html#ClosureInfo"><span class="hs-identifier hs-type">ClosureInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-489"></span><span id="tickyUpdateBhCaf"><span class="annot"><span class="annottext">tickyUpdateBhCaf :: ClosureInfo -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#tickyUpdateBhCaf"><span class="hs-identifier hs-var hs-var">tickyUpdateBhCaf</span></a></span></span><span> </span><span id="local-6989586621682889113"><span class="annot"><span class="annottext">ClosureInfo
</span><a href="#local-6989586621682889113"><span class="hs-identifier hs-var">cl_info</span></a></span></span><span>
</span><span id="line-490"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#ifTicky"><span class="hs-identifier hs-var">ifTicky</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounter"><span class="hs-identifier hs-var">bumpTickyCounter</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682889114"><span class="hs-identifier hs-var">ctr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-491"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-492"></span><span>    </span><span id="local-6989586621682889114"><span class="annot"><span class="annottext">ctr :: FastString
</span><a href="#local-6989586621682889114"><span class="hs-identifier hs-var hs-var">ctr</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ClosureInfo -&gt; Bool
</span><a href="GHC.StgToCmm.Closure.html#closureUpdReqd"><span class="hs-identifier hs-var">closureUpdReqd</span></a></span><span> </span><span class="annot"><span class="annottext">ClosureInfo
</span><a href="#local-6989586621682889113"><span class="hs-identifier hs-var">cl_info</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;UPD_CAF_BH_SINGLE_ENTRY_ctr&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-493"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;UPD_CAF_BH_UPDATABLE_ctr&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-494"></span><span>
</span><span id="line-495"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyEnterFun"><span class="hs-identifier hs-type">tickyEnterFun</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Closure.html#ClosureInfo"><span class="hs-identifier hs-type">ClosureInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-496"></span><span id="tickyEnterFun"><span class="annot"><span class="annottext">tickyEnterFun :: ClosureInfo -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#tickyEnterFun"><span class="hs-identifier hs-var hs-var">tickyEnterFun</span></a></span></span><span> </span><span id="local-6989586621682889115"><span class="annot"><span class="annottext">ClosureInfo
</span><a href="#local-6989586621682889115"><span class="hs-identifier hs-var">cl_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#ifTicky"><span class="hs-identifier hs-var">ifTicky</span></a></span><span> </span><span class="annot"><span class="annottext">(FCode () -&gt; FCode ()) -&gt; FCode () -&gt; FCode ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-497"></span><span>  </span><span id="local-6989586621682889116"><span class="annot"><a href="#local-6989586621682889116"><span class="hs-identifier hs-var">ctr_lbl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FCode CLabel
</span><a href="GHC.StgToCmm.Monad.html#getTickyCtrLabel"><span class="hs-identifier hs-var">getTickyCtrLabel</span></a></span><span>
</span><span id="line-498"></span><span>
</span><span id="line-499"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Closure.html#isStaticClosure"><span class="hs-identifier hs-type">isStaticClosure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889115"><span class="hs-identifier hs-type">cl_info</span></a></span><span>
</span><span id="line-500"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounter"><span class="hs-identifier hs-type">bumpTickyCounter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-type">fsLit</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ENT_STATIC_FUN_DIRECT_ctr&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-501"></span><span>            </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#registerTickyCtr"><span class="hs-identifier hs-type">registerTickyCtr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889116"><span class="hs-identifier hs-type">ctr_lbl</span></a></span><span>
</span><span id="line-502"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounter"><span class="hs-identifier hs-type">bumpTickyCounter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-type">fsLit</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ENT_DYN_FUN_DIRECT_ctr&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-503"></span><span>            </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#registerTickyCtrAtEntryDyn"><span class="hs-identifier hs-type">registerTickyCtrAtEntryDyn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889116"><span class="hs-identifier hs-type">ctr_lbl</span></a></span><span>
</span><span id="line-504"></span><span>
</span><span id="line-505"></span><span>  </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#bumpTickyEntryCount"><span class="hs-identifier hs-type">bumpTickyEntryCount</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889116"><span class="hs-identifier hs-type">ctr_lbl</span></a></span><span>
</span><span id="line-506"></span><span>
</span><span id="line-507"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyEnterLNE"><span class="hs-identifier hs-type">tickyEnterLNE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-508"></span><span id="tickyEnterLNE"><span class="annot"><span class="annottext">tickyEnterLNE :: FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#tickyEnterLNE"><span class="hs-identifier hs-var hs-var">tickyEnterLNE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#ifTicky"><span class="hs-identifier hs-var">ifTicky</span></a></span><span> </span><span class="annot"><span class="annottext">(FCode () -&gt; FCode ()) -&gt; FCode () -&gt; FCode ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-509"></span><span>  </span><span class="annot"><span class="annottext">FastString -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounter"><span class="hs-identifier hs-var">bumpTickyCounter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ENT_LNE_ctr&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-510"></span><span>  </span><span class="annot"><span class="annottext">FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#ifTickyLNE"><span class="hs-identifier hs-var">ifTickyLNE</span></a></span><span> </span><span class="annot"><span class="annottext">(FCode () -&gt; FCode ()) -&gt; FCode () -&gt; FCode ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-511"></span><span>    </span><span id="local-6989586621682889119"><span class="annot"><a href="#local-6989586621682889119"><span class="hs-identifier hs-var">ctr_lbl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FCode CLabel
</span><a href="GHC.StgToCmm.Monad.html#getTickyCtrLabel"><span class="hs-identifier hs-var">getTickyCtrLabel</span></a></span><span>
</span><span id="line-512"></span><span>    </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#registerTickyCtr"><span class="hs-identifier hs-type">registerTickyCtr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889119"><span class="hs-identifier hs-type">ctr_lbl</span></a></span><span>
</span><span id="line-513"></span><span>    </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#bumpTickyEntryCount"><span class="hs-identifier hs-type">bumpTickyEntryCount</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889119"><span class="hs-identifier hs-type">ctr_lbl</span></a></span><span>
</span><span id="line-514"></span><span>
</span><span id="line-515"></span><span class="hs-comment">-- needn't register a counter upon entry if</span><span>
</span><span id="line-516"></span><span class="hs-comment">--</span><span>
</span><span id="line-517"></span><span class="hs-comment">-- 1) it's for a dynamic closure, and</span><span>
</span><span id="line-518"></span><span class="hs-comment">--</span><span>
</span><span id="line-519"></span><span class="hs-comment">-- 2) -ticky-allocd is on</span><span>
</span><span id="line-520"></span><span class="hs-comment">--</span><span>
</span><span id="line-521"></span><span class="hs-comment">-- since the counter was registered already upon being alloc'd</span><span>
</span><span id="line-522"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#registerTickyCtrAtEntryDyn"><span class="hs-identifier hs-type">registerTickyCtrAtEntryDyn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-523"></span><span id="registerTickyCtrAtEntryDyn"><span class="annot"><span class="annottext">registerTickyCtrAtEntryDyn :: CLabel -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#registerTickyCtrAtEntryDyn"><span class="hs-identifier hs-var hs-var">registerTickyCtrAtEntryDyn</span></a></span></span><span> </span><span id="local-6989586621682889120"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682889120"><span class="hs-identifier hs-var">ctr_lbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-524"></span><span>  </span><span id="local-6989586621682889121"><span class="annot"><a href="#local-6989586621682889121"><span class="hs-identifier hs-var">already_registered</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(StgToCmmConfig -&gt; Bool) -&gt; FCode Bool
</span><a href="GHC.StgToCmm.Ticky.html#isEnabled"><span class="hs-identifier hs-var">isEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig -&gt; Bool
</span><a href="GHC.StgToCmm.Config.html#stgToCmmTickyAllocd"><span class="hs-identifier hs-var">stgToCmmTickyAllocd</span></a></span><span>
</span><span id="line-525"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">unless</span></span><span> </span><span class="annot"><a href="#local-6989586621682889121"><span class="hs-identifier hs-type">already_registered</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#registerTickyCtr"><span class="hs-identifier hs-type">registerTickyCtr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889120"><span class="hs-identifier hs-type">ctr_lbl</span></a></span><span>
</span><span id="line-526"></span><span>
</span><span id="line-527"></span><span class="hs-comment">-- | Register a ticky counter.</span><span>
</span><span id="line-528"></span><span class="hs-comment">--</span><span>
</span><span id="line-529"></span><span class="hs-comment">-- It's important that this does not race with other entries of the same</span><span>
</span><span id="line-530"></span><span class="hs-comment">-- closure, lest the ticky_entry_ctrs list may become cyclic. However, we also</span><span>
</span><span id="line-531"></span><span class="hs-comment">-- need to make sure that this is reasonably efficient. Consequently, we first</span><span>
</span><span id="line-532"></span><span class="hs-comment">-- perform a normal load of the counter's &quot;registered&quot; flag to check whether</span><span>
</span><span id="line-533"></span><span class="hs-comment">-- registration is necessary. If so, then we do a compare-and-swap to lock the</span><span>
</span><span id="line-534"></span><span class="hs-comment">-- counter for registration and use an atomic-exchange to add the counter to the list.</span><span>
</span><span id="line-535"></span><span class="hs-comment">--</span><span>
</span><span id="line-536"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-537"></span><span class="hs-comment">-- if ( f_ct.registeredp == 0 ) {</span><span>
</span><span id="line-538"></span><span class="hs-comment">--    if (cas(f_ct.registeredp, 0, 1) == 0) {</span><span>
</span><span id="line-539"></span><span class="hs-comment">--        old_head = xchg(ticky_entry_ctrs,  f_ct);</span><span>
</span><span id="line-540"></span><span class="hs-comment">--        f_ct.link = old_head;</span><span>
</span><span id="line-541"></span><span class="hs-comment">--    }</span><span>
</span><span id="line-542"></span><span class="hs-comment">-- }</span><span>
</span><span id="line-543"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-544"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#registerTickyCtr"><span class="hs-identifier hs-type">registerTickyCtr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-545"></span><span id="registerTickyCtr"><span class="annot"><span class="annottext">registerTickyCtr :: CLabel -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#registerTickyCtr"><span class="hs-identifier hs-var hs-var">registerTickyCtr</span></a></span></span><span> </span><span id="local-6989586621682889123"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682889123"><span class="hs-identifier hs-var">ctr_lbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-546"></span><span>  </span><span id="local-6989586621682889124"><span class="annot"><a href="#local-6989586621682889124"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FCode Platform
</span><a href="GHC.StgToCmm.Monad.html#getPlatform"><span class="hs-identifier hs-var">getPlatform</span></a></span><span>
</span><span id="line-547"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682889125"><span class="annot"><a href="#local-6989586621682889125"><span class="hs-identifier hs-var hs-var">constants</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; PlatformConstants
</span><a href="GHC.Platform.html#platformConstants"><span class="hs-identifier hs-var">platformConstants</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682889124"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-548"></span><span>      </span><span id="local-6989586621682889127"><span class="annot"><a href="#local-6989586621682889127"><span class="hs-identifier hs-var hs-var">word_width</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Width
</span><a href="GHC.Cmm.Type.html#wordWidth"><span class="hs-identifier hs-var">wordWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682889124"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-549"></span><span>      </span><span id="local-6989586621682889129"><span class="annot"><a href="#local-6989586621682889129"><span class="hs-identifier hs-var hs-var">registeredp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmLit -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLabel -&gt; Int -&gt; CmmLit
</span><a href="GHC.Cmm.Utils.html#cmmLabelOffB"><span class="hs-identifier hs-var">cmmLabelOffB</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682889123"><span class="hs-identifier hs-var">ctr_lbl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PlatformConstants -&gt; Int
</span><a href="GHC.Platform.Constants.html#pc_OFFSET_StgEntCounter_registeredp"><span class="hs-identifier hs-var">pc_OFFSET_StgEntCounter_registeredp</span></a></span><span> </span><span class="annot"><span class="annottext">PlatformConstants
</span><a href="#local-6989586621682889125"><span class="hs-identifier hs-var">constants</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-550"></span><span>
</span><span id="line-551"></span><span>  </span><span id="local-6989586621682889133"><span class="annot"><a href="#local-6989586621682889133"><span class="hs-identifier hs-var">register_stmts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#getCode"><span class="hs-identifier hs-type">getCode</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-552"></span><span>    </span><span id="local-6989586621682889135"><span class="annot"><a href="#local-6989586621682889135"><span class="hs-identifier hs-var">old_head</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#newTemp"><span class="hs-identifier hs-type">newTemp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Type.html#bWord"><span class="hs-identifier hs-type">bWord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889124"><span class="hs-identifier hs-type">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-553"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682889138"><span class="annot"><a href="#local-6989586621682889138"><span class="hs-identifier hs-var hs-var">ticky_entry_ctrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; CmmExpr
</span><a href="GHC.Cmm.Utils.html#mkLblExpr"><span class="hs-identifier hs-var">mkLblExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#mkRtsCmmDataLabel"><span class="hs-identifier hs-var">mkRtsCmmDataLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ticky_entry_ctrs&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-554"></span><span>        </span><span id="local-6989586621682889141"><span class="annot"><a href="#local-6989586621682889141"><span class="hs-identifier hs-var hs-var">link</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmLit -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLabel -&gt; Int -&gt; CmmLit
</span><a href="GHC.Cmm.Utils.html#cmmLabelOffB"><span class="hs-identifier hs-var">cmmLabelOffB</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682889123"><span class="hs-identifier hs-var">ctr_lbl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PlatformConstants -&gt; Int
</span><a href="GHC.Platform.Constants.html#pc_OFFSET_StgEntCounter_link"><span class="hs-identifier hs-var">pc_OFFSET_StgEntCounter_link</span></a></span><span> </span><span class="annot"><span class="annottext">PlatformConstants
</span><a href="#local-6989586621682889125"><span class="hs-identifier hs-var">constants</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-555"></span><span>    </span><span class="annot"><a href="GHC.StgToCmm.Foreign.html#emitPrimCall"><span class="hs-identifier hs-type">emitPrimCall</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682889135"><span class="hs-identifier hs-type">old_head</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Xchg"><span class="hs-identifier hs-type">MO_Xchg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889127"><span class="hs-identifier hs-type">word_width</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682889138"><span class="hs-identifier hs-type">ticky_entry_ctrs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Utils.html#mkLblExpr"><span class="hs-identifier hs-type">mkLblExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889123"><span class="hs-identifier hs-type">ctr_lbl</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-556"></span><span>    </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#emitStore"><span class="hs-identifier hs-type">emitStore</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889141"><span class="hs-identifier hs-type">link</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Cmm.Reg.html#CmmLocal"><span class="hs-identifier hs-type">CmmLocal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889135"><span class="hs-identifier hs-type">old_head</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-557"></span><span>
</span><span id="line-558"></span><span>  </span><span id="local-6989586621682889147"><span class="annot"><a href="#local-6989586621682889147"><span class="hs-identifier hs-var">cas_test</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#getCode"><span class="hs-identifier hs-type">getCode</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-559"></span><span>    </span><span id="local-6989586621682889148"><span class="annot"><a href="#local-6989586621682889148"><span class="hs-identifier hs-var">old</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#newTemp"><span class="hs-identifier hs-type">newTemp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Type.html#bWord"><span class="hs-identifier hs-type">bWord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889124"><span class="hs-identifier hs-type">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-560"></span><span>    </span><span class="annot"><a href="GHC.StgToCmm.Foreign.html#emitPrimCall"><span class="hs-identifier hs-type">emitPrimCall</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682889148"><span class="hs-identifier hs-type">old</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Cmpxchg"><span class="hs-identifier hs-type">MO_Cmpxchg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889127"><span class="hs-identifier hs-type">word_width</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-561"></span><span>        </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682889129"><span class="hs-identifier hs-type">registeredp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Utils.html#zeroExpr"><span class="hs-identifier hs-type">zeroExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889124"><span class="hs-identifier hs-type">platform</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Utils.html#mkIntExpr"><span class="hs-identifier hs-type">mkIntExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889124"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-562"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682889152"><span class="annot"><a href="#local-6989586621682889152"><span class="hs-identifier hs-var hs-var">locked</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmExpr -&gt; CmmExpr -&gt; CmmExpr
</span><a href="GHC.Cmm.Utils.html#cmmEqWord"><span class="hs-identifier hs-var">cmmEqWord</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682889124"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmReg -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmReg"><span class="hs-identifier hs-var">CmmReg</span></a></span><span> </span><span class="annot"><span class="annottext">(CmmReg -&gt; CmmExpr) -&gt; CmmReg -&gt; CmmExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LocalReg -&gt; CmmReg
</span><a href="GHC.Cmm.Reg.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a></span><span> </span><span class="annot"><span class="annottext">LocalReg
</span><a href="#local-6989586621682889148"><span class="hs-identifier hs-var">old</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; CmmExpr
</span><a href="GHC.Cmm.Utils.html#zeroExpr"><span class="hs-identifier hs-var">zeroExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682889124"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-563"></span><span>    </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#emit"><span class="hs-identifier hs-type">emit</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#mkCmmIfThen"><span class="hs-identifier hs-type">mkCmmIfThen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889152"><span class="hs-identifier hs-type">locked</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889133"><span class="hs-identifier hs-type">register_stmts</span></a></span><span>
</span><span id="line-564"></span><span>
</span><span id="line-565"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682889157"><span class="annot"><a href="#local-6989586621682889157"><span class="hs-identifier hs-var hs-var">test</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmExpr -&gt; CmmExpr -&gt; CmmExpr
</span><a href="GHC.Cmm.Utils.html#cmmEqWord"><span class="hs-identifier hs-var">cmmEqWord</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682889124"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; CmmExpr -&gt; CmmExpr
</span><a href="GHC.Cmm.Utils.html#cmmLoadBWord"><span class="hs-identifier hs-var">cmmLoadBWord</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682889124"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682889129"><span class="hs-identifier hs-var">registeredp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; CmmExpr
</span><a href="GHC.Cmm.Utils.html#zeroExpr"><span class="hs-identifier hs-var">zeroExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682889124"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-566"></span><span>  </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#emit"><span class="hs-identifier hs-type">emit</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#mkCmmIfThen"><span class="hs-identifier hs-type">mkCmmIfThen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889157"><span class="hs-identifier hs-type">test</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889147"><span class="hs-identifier hs-type">cas_test</span></a></span><span>
</span><span id="line-567"></span><span>
</span><span id="line-568"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyReturnOldCon"><span class="hs-identifier hs-type">tickyReturnOldCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyReturnNewCon"><span class="hs-identifier hs-type">tickyReturnNewCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#RepArity"><span class="hs-identifier hs-type">RepArity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-569"></span><span id="tickyReturnOldCon"><span class="annot"><span class="annottext">tickyReturnOldCon :: Int -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#tickyReturnOldCon"><span class="hs-identifier hs-var hs-var">tickyReturnOldCon</span></a></span></span><span> </span><span id="local-6989586621682889160"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682889160"><span class="hs-identifier hs-var">arity</span></a></span></span><span>
</span><span id="line-570"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#ifTicky"><span class="hs-identifier hs-var">ifTicky</span></a></span><span> </span><span class="annot"><span class="annottext">(FCode () -&gt; FCode ()) -&gt; FCode () -&gt; FCode ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounter"><span class="hs-identifier hs-var">bumpTickyCounter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;RET_OLD_ctr&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-571"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Int -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpHistogram"><span class="hs-identifier hs-var">bumpHistogram</span></a></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;RET_OLD_hst&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682889160"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-572"></span><span id="tickyReturnNewCon"><span class="annot"><span class="annottext">tickyReturnNewCon :: Int -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#tickyReturnNewCon"><span class="hs-identifier hs-var hs-var">tickyReturnNewCon</span></a></span></span><span> </span><span id="local-6989586621682889162"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682889162"><span class="hs-identifier hs-var">arity</span></a></span></span><span>
</span><span id="line-573"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#ifTicky"><span class="hs-identifier hs-var">ifTicky</span></a></span><span> </span><span class="annot"><span class="annottext">(FCode () -&gt; FCode ()) -&gt; FCode () -&gt; FCode ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounter"><span class="hs-identifier hs-var">bumpTickyCounter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;RET_NEW_ctr&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-574"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Int -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpHistogram"><span class="hs-identifier hs-var">bumpHistogram</span></a></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;RET_NEW_hst&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682889162"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-575"></span><span>
</span><span id="line-576"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyUnboxedTupleReturn"><span class="hs-identifier hs-type">tickyUnboxedTupleReturn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#RepArity"><span class="hs-identifier hs-type">RepArity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-577"></span><span id="tickyUnboxedTupleReturn"><span class="annot"><span class="annottext">tickyUnboxedTupleReturn :: Int -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#tickyUnboxedTupleReturn"><span class="hs-identifier hs-var hs-var">tickyUnboxedTupleReturn</span></a></span></span><span> </span><span id="local-6989586621682889163"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682889163"><span class="hs-identifier hs-var">arity</span></a></span></span><span>
</span><span id="line-578"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#ifTicky"><span class="hs-identifier hs-var">ifTicky</span></a></span><span> </span><span class="annot"><span class="annottext">(FCode () -&gt; FCode ()) -&gt; FCode () -&gt; FCode ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounter"><span class="hs-identifier hs-var">bumpTickyCounter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;RET_UNBOXED_TUP_ctr&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-579"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Int -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpHistogram"><span class="hs-identifier hs-var">bumpHistogram</span></a></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;RET_UNBOXED_TUP_hst&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682889163"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-580"></span><span>
</span><span id="line-581"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-582"></span><span class="hs-comment">-- Ticky calls</span><span>
</span><span id="line-583"></span><span>
</span><span id="line-584"></span><span class="hs-comment">-- Ticks at a *call site*:</span><span>
</span><span id="line-585"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyDirectCall"><span class="hs-identifier hs-type">tickyDirectCall</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#RepArity"><span class="hs-identifier hs-type">RepArity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-586"></span><span id="tickyDirectCall"><span class="annot"><span class="annottext">tickyDirectCall :: Int -&gt; [StgArg] -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#tickyDirectCall"><span class="hs-identifier hs-var hs-var">tickyDirectCall</span></a></span></span><span> </span><span id="local-6989586621682889164"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682889164"><span class="hs-identifier hs-var">arity</span></a></span></span><span> </span><span id="local-6989586621682889165"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682889165"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-587"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682889165"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg] -&gt; Int -&gt; Bool
forall a. [a] -&gt; Int -&gt; Bool
</span><a href="GHC.Utils.Misc.html#lengthIs"><span class="hs-operator hs-var">`lengthIs`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682889164"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#tickyKnownCallExact"><span class="hs-identifier hs-var">tickyKnownCallExact</span></a></span><span>
</span><span id="line-588"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#tickyKnownCallExtraArgs"><span class="hs-identifier hs-var">tickyKnownCallExtraArgs</span></a></span><span>
</span><span id="line-589"></span><span>                   </span><span class="annot"><span class="annottext">[StgArg] -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#tickySlowCallPat"><span class="hs-identifier hs-var">tickySlowCallPat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [StgArg] -&gt; [StgArg]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682889164"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682889165"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-590"></span><span>
</span><span id="line-591"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyKnownCallTooFewArgs"><span class="hs-identifier hs-type">tickyKnownCallTooFewArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-592"></span><span id="tickyKnownCallTooFewArgs"><span class="annot"><span class="annottext">tickyKnownCallTooFewArgs :: FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#tickyKnownCallTooFewArgs"><span class="hs-identifier hs-var hs-var">tickyKnownCallTooFewArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#ifTicky"><span class="hs-identifier hs-var">ifTicky</span></a></span><span> </span><span class="annot"><span class="annottext">(FCode () -&gt; FCode ()) -&gt; FCode () -&gt; FCode ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounter"><span class="hs-identifier hs-var">bumpTickyCounter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;KNOWN_CALL_TOO_FEW_ARGS_ctr&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-593"></span><span>
</span><span id="line-594"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyKnownCallExact"><span class="hs-identifier hs-type">tickyKnownCallExact</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-595"></span><span id="tickyKnownCallExact"><span class="annot"><span class="annottext">tickyKnownCallExact :: FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#tickyKnownCallExact"><span class="hs-identifier hs-var hs-var">tickyKnownCallExact</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#ifTicky"><span class="hs-identifier hs-var">ifTicky</span></a></span><span> </span><span class="annot"><span class="annottext">(FCode () -&gt; FCode ()) -&gt; FCode () -&gt; FCode ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounter"><span class="hs-identifier hs-var">bumpTickyCounter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;KNOWN_CALL_ctr&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-596"></span><span>
</span><span id="line-597"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyKnownCallExtraArgs"><span class="hs-identifier hs-type">tickyKnownCallExtraArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-598"></span><span id="tickyKnownCallExtraArgs"><span class="annot"><span class="annottext">tickyKnownCallExtraArgs :: FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#tickyKnownCallExtraArgs"><span class="hs-identifier hs-var hs-var">tickyKnownCallExtraArgs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#ifTicky"><span class="hs-identifier hs-var">ifTicky</span></a></span><span> </span><span class="annot"><span class="annottext">(FCode () -&gt; FCode ()) -&gt; FCode () -&gt; FCode ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounter"><span class="hs-identifier hs-var">bumpTickyCounter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;KNOWN_CALL_EXTRA_ARGS_ctr&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-599"></span><span>
</span><span id="line-600"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyUnknownCall"><span class="hs-identifier hs-type">tickyUnknownCall</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-601"></span><span id="tickyUnknownCall"><span class="annot"><span class="annottext">tickyUnknownCall :: FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#tickyUnknownCall"><span class="hs-identifier hs-var hs-var">tickyUnknownCall</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#ifTicky"><span class="hs-identifier hs-var">ifTicky</span></a></span><span> </span><span class="annot"><span class="annottext">(FCode () -&gt; FCode ()) -&gt; FCode () -&gt; FCode ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounter"><span class="hs-identifier hs-var">bumpTickyCounter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;UNKNOWN_CALL_ctr&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-602"></span><span>
</span><span id="line-603"></span><span class="hs-comment">-- Tick for the call pattern at slow call site (i.e. in addition to</span><span>
</span><span id="line-604"></span><span class="hs-comment">-- tickyUnknownCall, tickyKnownCallExtraArgs, etc.)</span><span>
</span><span id="line-605"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickySlowCall"><span class="hs-identifier hs-type">tickySlowCall</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Types.html#LambdaFormInfo"><span class="hs-identifier hs-type">LambdaFormInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-606"></span><span id="tickySlowCall"><span class="annot"><span class="annottext">tickySlowCall :: LambdaFormInfo -&gt; [StgArg] -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#tickySlowCall"><span class="hs-identifier hs-var hs-var">tickySlowCall</span></a></span></span><span> </span><span class="annot"><span class="annottext">LambdaFormInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; FCode ()
forall a. a -&gt; FCode a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-607"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickySlowCall"><span class="hs-identifier hs-var">tickySlowCall</span></a></span><span> </span><span id="local-6989586621682889169"><span class="annot"><span class="annottext">LambdaFormInfo
</span><a href="#local-6989586621682889169"><span class="hs-identifier hs-var">lf_info</span></a></span></span><span> </span><span id="local-6989586621682889170"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682889170"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-608"></span><span> </span><span class="hs-comment">-- see Note [Ticky for slow calls]</span><span>
</span><span id="line-609"></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">LambdaFormInfo -&gt; Bool
</span><a href="GHC.StgToCmm.Closure.html#isKnownFun"><span class="hs-identifier hs-var">isKnownFun</span></a></span><span> </span><span class="annot"><span class="annottext">LambdaFormInfo
</span><a href="#local-6989586621682889169"><span class="hs-identifier hs-var">lf_info</span></a></span><span>
</span><span id="line-610"></span><span>   </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#tickyKnownCallTooFewArgs"><span class="hs-identifier hs-var">tickyKnownCallTooFewArgs</span></a></span><span>
</span><span id="line-611"></span><span>   </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#tickyUnknownCall"><span class="hs-identifier hs-var">tickyUnknownCall</span></a></span><span>
</span><span id="line-612"></span><span> </span><span class="annot"><span class="annottext">[StgArg] -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#tickySlowCallPat"><span class="hs-identifier hs-var">tickySlowCallPat</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682889170"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-613"></span><span>
</span><span id="line-614"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickySlowCallPat"><span class="hs-identifier hs-type">tickySlowCallPat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-615"></span><span id="tickySlowCallPat"><span class="annot"><span class="annottext">tickySlowCallPat :: [StgArg] -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#tickySlowCallPat"><span class="hs-identifier hs-var hs-var">tickySlowCallPat</span></a></span></span><span> </span><span id="local-6989586621682889172"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682889172"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#ifTicky"><span class="hs-identifier hs-var">ifTicky</span></a></span><span> </span><span class="annot"><span class="annottext">(FCode () -&gt; FCode ()) -&gt; FCode () -&gt; FCode ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-616"></span><span>  </span><span id="local-6989586621682889173"><span class="annot"><a href="#local-6989586621682889173"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Profile -&gt; Platform
</span><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="annottext">(Profile -&gt; Platform) -&gt; FCode Profile -&gt; FCode Platform
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">FCode Profile
</span><a href="GHC.StgToCmm.Monad.html#getProfile"><span class="hs-identifier hs-var">getProfile</span></a></span><span>
</span><span id="line-617"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682889174"><span class="annot"><a href="#local-6989586621682889174"><span class="hs-identifier hs-var hs-var">argReps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(StgArg -&gt; ArgRep) -&gt; [StgArg] -&gt; [ArgRep]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; PrimOrVoidRep -&gt; ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#toArgRepOrV"><span class="hs-identifier hs-var">toArgRepOrV</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682889173"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">(PrimOrVoidRep -&gt; ArgRep)
-&gt; (StgArg -&gt; PrimOrVoidRep) -&gt; StgArg -&gt; ArgRep
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">StgArg -&gt; PrimOrVoidRep
</span><a href="GHC.Stg.Syntax.html#stgArgRep1"><span class="hs-identifier hs-var">stgArgRep1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682889172"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-618"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682889176"><span class="annot"><a href="#local-6989586621682889176"><span class="hs-identifier hs-var">n_matched</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.StgToCmm.ArgRep.html#slowCallPattern"><span class="hs-identifier hs-type">slowCallPattern</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889174"><span class="hs-identifier hs-type">argReps</span></a></span><span>
</span><span id="line-619"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621682889176"><span class="hs-identifier hs-type">n_matched</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><a href="#local-6989586621682889172"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#lengthIs"><span class="hs-operator hs-type">`lengthIs`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889176"><span class="hs-identifier hs-type">n_matched</span></a></span><span>
</span><span id="line-620"></span><span>     </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#bumpTickyLbl"><span class="hs-identifier hs-type">bumpTickyLbl</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#mkRtsSlowFastTickyCtrLabel"><span class="hs-identifier hs-type">mkRtsSlowFastTickyCtrLabel</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Data.Char.toLower</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="GHC.StgToCmm.ArgRep.html#argRepString"><span class="hs-identifier hs-type">argRepString</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682889174"><span class="hs-identifier hs-type">argReps</span></a></span><span>
</span><span id="line-621"></span><span>     </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounter"><span class="hs-identifier hs-type">bumpTickyCounter</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-type">fsLit</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;VERY_SLOW_CALL_ctr&quot;</span></span><span>
</span><span id="line-622"></span><span>
</span><span id="line-623"></span><span class="hs-comment">{-

Note [Ticky for slow calls]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
Terminology is unfortunately a bit mixed up for these calls. codeGen
uses &quot;slow call&quot; to refer to unknown calls and under-saturated known
calls.

Nowadays, though (ie as of the eval/apply paper), the significantly
slower calls are actually just a subset of these: the ones with no
built-in argument pattern (cf GHC.StgToCmm.ArgRep.slowCallPattern)

So for ticky profiling, we split slow calls into
&quot;SLOW_CALL_fast_&lt;pattern&gt;_ctr&quot; (those matching a built-in pattern) and
VERY_SLOW_CALL_ctr (those without a built-in pattern; these are very
bad for both space and time).

-}</span><span>
</span><span id="line-641"></span><span>
</span><span id="line-642"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-643"></span><span class="hs-comment">-- Ticky allocation</span><span>
</span><span id="line-644"></span><span>
</span><span id="line-645"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyDynAlloc"><span class="hs-identifier hs-type">tickyDynAlloc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Layout.html#SMRep"><span class="hs-identifier hs-type">SMRep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Types.html#LambdaFormInfo"><span class="hs-identifier hs-type">LambdaFormInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-646"></span><span class="hs-comment">-- Called when doing a dynamic heap allocation; the LambdaFormInfo</span><span>
</span><span id="line-647"></span><span class="hs-comment">-- used to distinguish between closure types</span><span>
</span><span id="line-648"></span><span class="hs-comment">--</span><span>
</span><span id="line-649"></span><span class="hs-comment">-- TODO what else to count while we're here?</span><span>
</span><span id="line-650"></span><span id="tickyDynAlloc"><span class="annot"><span class="annottext">tickyDynAlloc :: Maybe Id -&gt; SMRep -&gt; LambdaFormInfo -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#tickyDynAlloc"><span class="hs-identifier hs-var hs-var">tickyDynAlloc</span></a></span></span><span> </span><span id="local-6989586621682889182"><span class="annot"><span class="annottext">Maybe Id
</span><a href="#local-6989586621682889182"><span class="hs-identifier hs-var">mb_id</span></a></span></span><span> </span><span id="local-6989586621682889183"><span class="annot"><span class="annottext">SMRep
</span><a href="#local-6989586621682889183"><span class="hs-identifier hs-var">rep</span></a></span></span><span> </span><span id="local-6989586621682889184"><span class="annot"><span class="annottext">LambdaFormInfo
</span><a href="#local-6989586621682889184"><span class="hs-identifier hs-var">lf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#ifTicky"><span class="hs-identifier hs-var">ifTicky</span></a></span><span> </span><span class="annot"><span class="annottext">(FCode () -&gt; FCode ()) -&gt; FCode () -&gt; FCode ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-651"></span><span>  </span><span id="local-6989586621682889185"><span class="annot"><a href="#local-6989586621682889185"><span class="hs-identifier hs-var">profile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FCode Profile
</span><a href="GHC.StgToCmm.Monad.html#getProfile"><span class="hs-identifier hs-var">getProfile</span></a></span><span>
</span><span id="line-652"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682889186"><span class="annot"><a href="#local-6989586621682889186"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Profile -&gt; Platform
</span><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682889185"><span class="hs-identifier hs-var">profile</span></a></span><span>
</span><span id="line-653"></span><span>      </span><span id="local-6989586621682889187"><span class="annot"><a href="#local-6989586621682889187"><span class="hs-identifier hs-var hs-var">bytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Int
</span><a href="GHC.Platform.html#platformWordSizeInBytes"><span class="hs-identifier hs-var">platformWordSizeInBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682889186"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Profile -&gt; SMRep -&gt; Int
</span><a href="GHC.Runtime.Heap.Layout.html#heapClosureSizeW"><span class="hs-identifier hs-var">heapClosureSizeW</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682889185"><span class="hs-identifier hs-var">profile</span></a></span><span> </span><span class="annot"><span class="annottext">SMRep
</span><a href="#local-6989586621682889183"><span class="hs-identifier hs-var">rep</span></a></span><span>
</span><span id="line-654"></span><span>
</span><span id="line-655"></span><span>      </span><span id="local-6989586621682889191"><span class="annot"><a href="#local-6989586621682889191"><span class="hs-identifier hs-var hs-var">countGlobal</span></a></span></span><span> </span><span id="local-6989586621682889192"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682889192"><span class="hs-identifier hs-var">tot</span></a></span></span><span> </span><span id="local-6989586621682889193"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682889193"><span class="hs-identifier hs-var">ctr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-656"></span><span>        </span><span class="annot"><span class="annottext">FastString -&gt; Int -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounterBy"><span class="hs-identifier hs-var">bumpTickyCounterBy</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682889192"><span class="hs-identifier hs-var">tot</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682889187"><span class="hs-identifier hs-var">bytes</span></a></span><span>
</span><span id="line-657"></span><span>        </span><span class="annot"><span class="annottext">FastString -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounter"><span class="hs-identifier hs-var">bumpTickyCounter</span></a></span><span>   </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682889193"><span class="hs-identifier hs-var">ctr</span></a></span><span>
</span><span id="line-658"></span><span>      </span><span id="local-6989586621682889195"><span class="annot"><a href="#local-6989586621682889195"><span class="hs-identifier hs-var hs-var">countSpecific</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#ifTickyAllocd"><span class="hs-identifier hs-var">ifTickyAllocd</span></a></span><span> </span><span class="annot"><span class="annottext">(FCode () -&gt; FCode ()) -&gt; FCode () -&gt; FCode ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Id
</span><a href="#local-6989586621682889182"><span class="hs-identifier hs-var">mb_id</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-659"></span><span>        </span><span class="annot"><span class="annottext">Maybe Id
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; FCode ()
forall a. a -&gt; FCode a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-660"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682889197"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682889197"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-661"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682889198"><span class="annot"><span class="annottext">ctr_lbl :: CLabel
</span><a href="#local-6989586621682889198"><span class="hs-identifier hs-var hs-var hs-var">ctr_lbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#mkRednCountsLabel"><span class="hs-identifier hs-var">mkRednCountsLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682889197"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-662"></span><span>          </span><span class="annot"><span class="annottext">CLabel -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#registerTickyCtr"><span class="hs-identifier hs-var">registerTickyCtr</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682889198"><span class="hs-identifier hs-var">ctr_lbl</span></a></span><span>
</span><span id="line-663"></span><span>          </span><span class="annot"><span class="annottext">CLabel -&gt; Int -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyAllocd"><span class="hs-identifier hs-var">bumpTickyAllocd</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682889198"><span class="hs-identifier hs-var">ctr_lbl</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682889187"><span class="hs-identifier hs-var">bytes</span></a></span><span>
</span><span id="line-664"></span><span>
</span><span id="line-665"></span><span>  </span><span class="hs-comment">-- TODO are we still tracking &quot;good stuff&quot; (_gds) versus</span><span>
</span><span id="line-666"></span><span>  </span><span class="hs-comment">-- administrative (_adm) versus slop (_slp)? I'm going with all _gds</span><span>
</span><span id="line-667"></span><span>  </span><span class="hs-comment">-- for now, since I don't currently know neither if we do nor how to</span><span>
</span><span id="line-668"></span><span>  </span><span class="hs-comment">-- distinguish. NSF Mar 2013</span><span>
</span><span id="line-669"></span><span>
</span><span id="line-670"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Layout.html#isConRep"><span class="hs-identifier hs-type">isConRep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889183"><span class="hs-identifier hs-type">rep</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-671"></span><span>         </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#ifTickyDynThunk"><span class="hs-identifier hs-type">ifTickyDynThunk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889195"><span class="hs-identifier hs-type">countSpecific</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;</span></span><span>
</span><span id="line-672"></span><span>         </span><span class="annot"><a href="#local-6989586621682889191"><span class="hs-identifier hs-type">countGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-type">fsLit</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ALLOC_CON_gds&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-type">fsLit</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ALLOC_CON_ctr&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-673"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Layout.html#isThunkRep"><span class="hs-identifier hs-type">isThunkRep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889183"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-674"></span><span>         </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#ifTickyDynThunk"><span class="hs-identifier hs-type">ifTickyDynThunk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889195"><span class="hs-identifier hs-type">countSpecific</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;</span></span><span>
</span><span id="line-675"></span><span>         </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Closure.html#lfUpdatable"><span class="hs-identifier hs-type">lfUpdatable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889184"><span class="hs-identifier hs-type">lf</span></a></span><span>
</span><span id="line-676"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="#local-6989586621682889191"><span class="hs-identifier hs-type">countGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-type">fsLit</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ALLOC_THK_gds&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-type">fsLit</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ALLOC_UP_THK_ctr&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-677"></span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="#local-6989586621682889191"><span class="hs-identifier hs-type">countGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-type">fsLit</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ALLOC_THK_gds&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-type">fsLit</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ALLOC_SE_THK_ctr&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-678"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Layout.html#isFunRep"><span class="hs-identifier hs-type">isFunRep</span></a></span><span>   </span><span class="annot"><a href="#local-6989586621682889183"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-679"></span><span>         </span><span class="annot"><a href="#local-6989586621682889195"><span class="hs-identifier hs-type">countSpecific</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;</span></span><span>
</span><span id="line-680"></span><span>         </span><span class="annot"><a href="#local-6989586621682889191"><span class="hs-identifier hs-type">countGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-type">fsLit</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ALLOC_FUN_gds&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-type">fsLit</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ALLOC_FUN_ctr&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-681"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">otherwise</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-type">panic</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;How is this heap object not a con, thunk, or fun?&quot;</span></span><span>
</span><span id="line-682"></span><span>
</span><span id="line-683"></span><span>
</span><span id="line-684"></span><span>
</span><span id="line-685"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyAllocHeap"><span class="hs-identifier hs-type">tickyAllocHeap</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-686"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- is this a genuine allocation? As opposed to</span><span>
</span><span id="line-687"></span><span>          </span><span class="hs-comment">-- GHC.StgToCmm.Layout.adjustHpBackwards</span><span>
</span><span id="line-688"></span><span>  </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#VirtualHpOffset"><span class="hs-identifier hs-type">VirtualHpOffset</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-689"></span><span class="hs-comment">-- Called when doing a heap check [TICK_ALLOC_HEAP]</span><span>
</span><span id="line-690"></span><span class="hs-comment">-- Must be lazy in the amount of allocation!</span><span>
</span><span id="line-691"></span><span id="tickyAllocHeap"><span class="annot"><span class="annottext">tickyAllocHeap :: Bool -&gt; Int -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#tickyAllocHeap"><span class="hs-identifier hs-var hs-var">tickyAllocHeap</span></a></span></span><span> </span><span id="local-6989586621682889206"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682889206"><span class="hs-identifier hs-var">genuine</span></a></span></span><span> </span><span id="local-6989586621682889207"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682889207"><span class="hs-identifier hs-var">hp</span></a></span></span><span>
</span><span id="line-692"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#ifTicky"><span class="hs-identifier hs-var">ifTicky</span></a></span><span> </span><span class="annot"><span class="annottext">(FCode () -&gt; FCode ()) -&gt; FCode () -&gt; FCode ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-693"></span><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682889208"><span class="annot"><a href="#local-6989586621682889208"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FCode Platform
</span><a href="GHC.StgToCmm.Monad.html#getPlatform"><span class="hs-identifier hs-var">getPlatform</span></a></span><span>
</span><span id="line-694"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682889209"><span class="annot"><a href="#local-6989586621682889209"><span class="hs-identifier hs-var">ticky_ctr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#getTickyCtrLabel"><span class="hs-identifier hs-type">getTickyCtrLabel</span></a></span><span>
</span><span id="line-695"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#emit"><span class="hs-identifier hs-type">emit</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Cmm.Graph.html#catAGraphs"><span class="hs-identifier hs-type">catAGraphs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-696"></span><span>            </span><span class="hs-comment">-- only test hp from within the emit so that the monadic</span><span>
</span><span id="line-697"></span><span>            </span><span class="hs-comment">-- computation itself is not strict in hp (cf knot in</span><span>
</span><span id="line-698"></span><span>            </span><span class="hs-comment">-- GHC.StgToCmm.Monad.getHeapUsage)</span><span>
</span><span id="line-699"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621682889207"><span class="hs-identifier hs-type">hp</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-700"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682889211"><span class="annot"><a href="#local-6989586621682889211"><span class="hs-identifier hs-var hs-var">bytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Int
</span><a href="GHC.Platform.html#platformWordSizeInBytes"><span class="hs-identifier hs-var">platformWordSizeInBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682889208"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682889207"><span class="hs-identifier hs-var">hp</span></a></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">[</span><span>
</span><span id="line-701"></span><span>            </span><span class="hs-comment">-- Bump the allocation total in the closure's StgEntCounter</span><span>
</span><span id="line-702"></span><span>            </span><span class="annot"><a href="GHC.StgToCmm.Utils.html#addToMem"><span class="hs-identifier hs-type">addToMem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Type.html#rEP_StgEntCounter_allocs"><span class="hs-identifier hs-type">rEP_StgEntCounter_allocs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889208"><span class="hs-identifier hs-type">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-703"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Utils.html#cmmLabelOffB"><span class="hs-identifier hs-type">cmmLabelOffB</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889209"><span class="hs-identifier hs-type">ticky_ctr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Platform.Constants.html#pc_OFFSET_StgEntCounter_allocs"><span class="hs-identifier hs-var">pc_OFFSET_StgEntCounter_allocs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Platform.html#platformConstants"><span class="hs-identifier hs-type">platformConstants</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889208"><span class="hs-identifier hs-type">platform</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-704"></span><span>                     </span><span class="annot"><a href="#local-6989586621682889211"><span class="hs-identifier hs-type">bytes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-705"></span><span>            </span><span class="hs-comment">-- Bump the global allocation total ALLOC_HEAP_tot</span><span>
</span><span id="line-706"></span><span>            </span><span class="annot"><a href="GHC.StgToCmm.Utils.html#addToMemLbl"><span class="hs-identifier hs-type">addToMemLbl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Type.html#bWord"><span class="hs-identifier hs-type">bWord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889208"><span class="hs-identifier hs-type">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-707"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.CLabel.html#mkRtsCmmDataLabel"><span class="hs-identifier hs-type">mkRtsCmmDataLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-type">fsLit</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ALLOC_HEAP_tot&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-708"></span><span>                        </span><span class="annot"><a href="#local-6989586621682889211"><span class="hs-identifier hs-type">bytes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-709"></span><span>            </span><span class="hs-comment">-- Bump the global allocation counter ALLOC_HEAP_ctr</span><span>
</span><span id="line-710"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="annot"><a href="#local-6989586621682889206"><span class="hs-identifier hs-type">genuine</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="GHC.Cmm.Graph.html#mkNop"><span class="hs-identifier hs-type">mkNop</span></a></span><span>
</span><span id="line-711"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Utils.html#addToMemLbl"><span class="hs-identifier hs-type">addToMemLbl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Type.html#bWord"><span class="hs-identifier hs-type">bWord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889208"><span class="hs-identifier hs-type">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-712"></span><span>                             </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.CLabel.html#mkRtsCmmDataLabel"><span class="hs-identifier hs-type">mkRtsCmmDataLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-type">fsLit</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ALLOC_HEAP_ctr&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-713"></span><span>                             </span><span class="annot"><span class="hs-number">1</span></span><span>
</span><span id="line-714"></span><span>            </span><span class="hs-special">]</span><span class="hs-special">}</span><span>
</span><span id="line-715"></span><span>
</span><span id="line-716"></span><span>
</span><span id="line-717"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-718"></span><span class="hs-comment">-- these three are only called from GHC.Cmm.Parser (ie ultimately from the RTS)</span><span>
</span><span id="line-719"></span><span>
</span><span id="line-720"></span><span class="hs-comment">-- the units are bytes</span><span>
</span><span id="line-721"></span><span>
</span><span id="line-722"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyAllocPrim"><span class="hs-identifier hs-type">tickyAllocPrim</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ size of the full header, in bytes</span></span><span>
</span><span id="line-723"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ size of the payload, in bytes</span></span><span>
</span><span id="line-724"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-725"></span><span id="tickyAllocPrim"><span class="annot"><span class="annottext">tickyAllocPrim :: CmmExpr -&gt; CmmExpr -&gt; CmmExpr -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#tickyAllocPrim"><span class="hs-identifier hs-var hs-var">tickyAllocPrim</span></a></span></span><span> </span><span id="local-6989586621682889217"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682889217"><span class="hs-identifier hs-var">_hdr</span></a></span></span><span> </span><span id="local-6989586621682889218"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682889218"><span class="hs-identifier hs-var">_goods</span></a></span></span><span> </span><span id="local-6989586621682889219"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682889219"><span class="hs-identifier hs-var">_slop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#ifTicky"><span class="hs-identifier hs-var">ifTicky</span></a></span><span> </span><span class="annot"><span class="annottext">(FCode () -&gt; FCode ()) -&gt; FCode () -&gt; FCode ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-726"></span><span>  </span><span class="annot"><span class="annottext">FastString -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounter"><span class="hs-identifier hs-var">bumpTickyCounter</span></a></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ALLOC_PRIM_ctr&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-727"></span><span>  </span><span class="annot"><span class="annottext">FastString -&gt; CmmExpr -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounterByE"><span class="hs-identifier hs-var">bumpTickyCounterByE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ALLOC_PRIM_adm&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682889217"><span class="hs-identifier hs-var">_hdr</span></a></span><span>
</span><span id="line-728"></span><span>  </span><span class="annot"><span class="annottext">FastString -&gt; CmmExpr -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounterByE"><span class="hs-identifier hs-var">bumpTickyCounterByE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ALLOC_PRIM_gds&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682889218"><span class="hs-identifier hs-var">_goods</span></a></span><span>
</span><span id="line-729"></span><span>  </span><span class="annot"><span class="annottext">FastString -&gt; CmmExpr -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounterByE"><span class="hs-identifier hs-var">bumpTickyCounterByE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ALLOC_PRIM_slp&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682889219"><span class="hs-identifier hs-var">_slop</span></a></span><span>
</span><span id="line-730"></span><span>
</span><span id="line-731"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyAllocThunk"><span class="hs-identifier hs-type">tickyAllocThunk</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-732"></span><span id="tickyAllocThunk"><span class="annot"><span class="annottext">tickyAllocThunk :: CmmExpr -&gt; CmmExpr -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#tickyAllocThunk"><span class="hs-identifier hs-var hs-var">tickyAllocThunk</span></a></span></span><span> </span><span id="local-6989586621682889221"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682889221"><span class="hs-identifier hs-var">_goods</span></a></span></span><span> </span><span id="local-6989586621682889222"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682889222"><span class="hs-identifier hs-var">_slop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#ifTicky"><span class="hs-identifier hs-var">ifTicky</span></a></span><span> </span><span class="annot"><span class="annottext">(FCode () -&gt; FCode ()) -&gt; FCode () -&gt; FCode ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-733"></span><span>    </span><span class="hs-comment">-- TODO is it ever called with a Single-Entry thunk?</span><span>
</span><span id="line-734"></span><span>  </span><span class="annot"><span class="annottext">FastString -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounter"><span class="hs-identifier hs-var">bumpTickyCounter</span></a></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ALLOC_UP_THK_ctr&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-735"></span><span>  </span><span class="annot"><span class="annottext">FastString -&gt; CmmExpr -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounterByE"><span class="hs-identifier hs-var">bumpTickyCounterByE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ALLOC_THK_gds&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682889221"><span class="hs-identifier hs-var">_goods</span></a></span><span>
</span><span id="line-736"></span><span>  </span><span class="annot"><span class="annottext">FastString -&gt; CmmExpr -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounterByE"><span class="hs-identifier hs-var">bumpTickyCounterByE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ALLOC_THK_slp&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682889222"><span class="hs-identifier hs-var">_slop</span></a></span><span>
</span><span id="line-737"></span><span>
</span><span id="line-738"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyAllocPAP"><span class="hs-identifier hs-type">tickyAllocPAP</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-739"></span><span id="tickyAllocPAP"><span class="annot"><span class="annottext">tickyAllocPAP :: CmmExpr -&gt; CmmExpr -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#tickyAllocPAP"><span class="hs-identifier hs-var hs-var">tickyAllocPAP</span></a></span></span><span> </span><span id="local-6989586621682889223"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682889223"><span class="hs-identifier hs-var">_goods</span></a></span></span><span> </span><span id="local-6989586621682889224"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682889224"><span class="hs-identifier hs-var">_slop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#ifTicky"><span class="hs-identifier hs-var">ifTicky</span></a></span><span> </span><span class="annot"><span class="annottext">(FCode () -&gt; FCode ()) -&gt; FCode () -&gt; FCode ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-740"></span><span>  </span><span class="annot"><span class="annottext">FastString -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounter"><span class="hs-identifier hs-var">bumpTickyCounter</span></a></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ALLOC_PAP_ctr&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-741"></span><span>  </span><span class="annot"><span class="annottext">FastString -&gt; CmmExpr -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounterByE"><span class="hs-identifier hs-var">bumpTickyCounterByE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ALLOC_PAP_gds&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682889223"><span class="hs-identifier hs-var">_goods</span></a></span><span>
</span><span id="line-742"></span><span>  </span><span class="annot"><span class="annottext">FastString -&gt; CmmExpr -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounterByE"><span class="hs-identifier hs-var">bumpTickyCounterByE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ALLOC_PAP_slp&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682889224"><span class="hs-identifier hs-var">_slop</span></a></span><span>
</span><span id="line-743"></span><span>
</span><span id="line-744"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyHeapCheck"><span class="hs-identifier hs-type">tickyHeapCheck</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-745"></span><span id="tickyHeapCheck"><span class="annot"><span class="annottext">tickyHeapCheck :: FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#tickyHeapCheck"><span class="hs-identifier hs-var hs-var">tickyHeapCheck</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#ifTicky"><span class="hs-identifier hs-var">ifTicky</span></a></span><span> </span><span class="annot"><span class="annottext">(FCode () -&gt; FCode ()) -&gt; FCode () -&gt; FCode ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounter"><span class="hs-identifier hs-var">bumpTickyCounter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;HEAP_CHK_ctr&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-746"></span><span>
</span><span id="line-747"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyStackCheck"><span class="hs-identifier hs-type">tickyStackCheck</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-748"></span><span id="tickyStackCheck"><span class="annot"><span class="annottext">tickyStackCheck :: FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#tickyStackCheck"><span class="hs-identifier hs-var hs-var">tickyStackCheck</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#ifTicky"><span class="hs-identifier hs-var">ifTicky</span></a></span><span> </span><span class="annot"><span class="annottext">(FCode () -&gt; FCode ()) -&gt; FCode () -&gt; FCode ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounter"><span class="hs-identifier hs-var">bumpTickyCounter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;STK_CHK_ctr&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-749"></span><span>
</span><span id="line-750"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-751"></span><span class="hs-comment">-- Ticky for tag inference characterisation</span><span>
</span><span id="line-752"></span><span>
</span><span id="line-753"></span><span class="annot"><span class="hs-comment">-- | Predicted a pointer would be tagged correctly (GHC will crash if not so no miss case)</span></span><span>
</span><span id="line-754"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyTagged"><span class="hs-identifier hs-type">tickyTagged</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-755"></span><span id="tickyTagged"><span class="annot"><span class="annottext">tickyTagged :: FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#tickyTagged"><span class="hs-identifier hs-var hs-var">tickyTagged</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#ifTickyTag"><span class="hs-identifier hs-var">ifTickyTag</span></a></span><span> </span><span class="annot"><span class="annottext">(FCode () -&gt; FCode ()) -&gt; FCode () -&gt; FCode ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounter"><span class="hs-identifier hs-var">bumpTickyCounter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TAG_TAGGED_pred&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-756"></span><span>
</span><span id="line-757"></span><span class="annot"><span class="hs-comment">-- | Pass a boolean expr indicating if tag was present.</span></span><span>
</span><span id="line-758"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyUntagged"><span class="hs-identifier hs-type">tickyUntagged</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-759"></span><span id="tickyUntagged"><span class="annot"><span class="annottext">tickyUntagged :: CmmExpr -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#tickyUntagged"><span class="hs-identifier hs-var hs-var">tickyUntagged</span></a></span></span><span> </span><span id="local-6989586621682889225"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682889225"><span class="hs-identifier hs-var">e</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-760"></span><span>    </span><span class="annot"><span class="annottext">FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#ifTickyTag"><span class="hs-identifier hs-var">ifTickyTag</span></a></span><span> </span><span class="annot"><span class="annottext">(FCode () -&gt; FCode ()) -&gt; FCode () -&gt; FCode ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounter"><span class="hs-identifier hs-var">bumpTickyCounter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TAG_UNTAGGED_pred&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-761"></span><span>    </span><span class="annot"><span class="annottext">FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#ifTickyTag"><span class="hs-identifier hs-var">ifTickyTag</span></a></span><span> </span><span class="annot"><span class="annottext">(FCode () -&gt; FCode ()) -&gt; FCode () -&gt; FCode ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; CmmExpr -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounterByE"><span class="hs-identifier hs-var">bumpTickyCounterByE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TAG_UNTAGGED_miss&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682889225"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-762"></span><span>
</span><span id="line-763"></span><span class="hs-comment">-- | Called when for `case v of ...` we can avoid entering v based on</span><span>
</span><span id="line-764"></span><span class="hs-comment">-- tag inference information.</span><span>
</span><span id="line-765"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#tickyTagSkip"><span class="hs-identifier hs-type">tickyTagSkip</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-766"></span><span id="tickyTagSkip"><span class="annot"><span class="annottext">tickyTagSkip :: Unique -&gt; Id -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#tickyTagSkip"><span class="hs-identifier hs-var hs-var">tickyTagSkip</span></a></span></span><span> </span><span id="local-6989586621682889226"><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682889226"><span class="hs-identifier hs-var">unique</span></a></span></span><span> </span><span id="local-6989586621682889227"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682889227"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#ifTickyTag"><span class="hs-identifier hs-var">ifTickyTag</span></a></span><span> </span><span class="annot"><span class="annottext">(FCode () -&gt; FCode ()) -&gt; FCode () -&gt; FCode ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-767"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682889228"><span class="annot"><span class="annottext">ctr_lbl :: CLabel
</span><a href="#local-6989586621682889228"><span class="hs-identifier hs-var hs-var hs-var">ctr_lbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Unique -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#mkTagHitLabel"><span class="hs-identifier hs-var">mkTagHitLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682889227"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682889226"><span class="hs-identifier hs-var">unique</span></a></span><span>
</span><span id="line-768"></span><span>  </span><span class="annot"><span class="annottext">CLabel -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#registerTickyCtr"><span class="hs-identifier hs-var">registerTickyCtr</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682889228"><span class="hs-identifier hs-var">ctr_lbl</span></a></span><span>
</span><span id="line-769"></span><span>  </span><span class="annot"><span class="annottext">CLabel -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyTagSkip"><span class="hs-identifier hs-var">bumpTickyTagSkip</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682889228"><span class="hs-identifier hs-var">ctr_lbl</span></a></span><span>
</span><span id="line-770"></span><span>
</span><span id="line-771"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-772"></span><span class="hs-comment">-- Ticky utils</span><span>
</span><span id="line-773"></span><span>
</span><span id="line-774"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#isEnabled"><span class="hs-identifier hs-type">isEnabled</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Config.html#StgToCmmConfig"><span class="hs-identifier hs-type">StgToCmmConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-775"></span><span id="isEnabled"><span class="annot"><span class="annottext">isEnabled :: (StgToCmmConfig -&gt; Bool) -&gt; FCode Bool
</span><a href="GHC.StgToCmm.Ticky.html#isEnabled"><span class="hs-identifier hs-var hs-var">isEnabled</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((StgToCmmConfig -&gt; Bool) -&gt; FCode StgToCmmConfig -&gt; FCode Bool)
-&gt; FCode StgToCmmConfig -&gt; (StgToCmmConfig -&gt; Bool) -&gt; FCode Bool
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">(StgToCmmConfig -&gt; Bool) -&gt; FCode StgToCmmConfig -&gt; FCode Bool
forall a b. (a -&gt; b) -&gt; FCode a -&gt; FCode b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">FCode StgToCmmConfig
</span><a href="GHC.StgToCmm.Monad.html#getStgToCmmConfig"><span class="hs-identifier hs-var">getStgToCmmConfig</span></a></span><span>
</span><span id="line-776"></span><span>
</span><span id="line-777"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#runIfFlag"><span class="hs-identifier hs-type">runIfFlag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Config.html#StgToCmmConfig"><span class="hs-identifier hs-type">StgToCmmConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-778"></span><span id="runIfFlag"><span class="annot"><span class="annottext">runIfFlag :: (StgToCmmConfig -&gt; Bool) -&gt; FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#runIfFlag"><span class="hs-identifier hs-var hs-var">runIfFlag</span></a></span></span><span> </span><span id="local-6989586621682889232"><span class="annot"><span class="annottext">StgToCmmConfig -&gt; Bool
</span><a href="#local-6989586621682889232"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FCode Bool -&gt; FCode () -&gt; FCode ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="GHC.Utils.Monad.html#whenM"><span class="hs-identifier hs-var">whenM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StgToCmmConfig -&gt; Bool
</span><a href="#local-6989586621682889232"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(StgToCmmConfig -&gt; Bool) -&gt; FCode StgToCmmConfig -&gt; FCode Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">FCode StgToCmmConfig
</span><a href="GHC.StgToCmm.Monad.html#getStgToCmmConfig"><span class="hs-identifier hs-var">getStgToCmmConfig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-779"></span><span>
</span><span id="line-780"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#ifTicky"><span class="hs-identifier hs-type">ifTicky</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-781"></span><span id="ifTicky"><span class="annot"><span class="annottext">ifTicky :: FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#ifTicky"><span class="hs-identifier hs-var hs-var">ifTicky</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(StgToCmmConfig -&gt; Bool) -&gt; FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#runIfFlag"><span class="hs-identifier hs-var">runIfFlag</span></a></span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig -&gt; Bool
</span><a href="GHC.StgToCmm.Config.html#stgToCmmDoTicky"><span class="hs-identifier hs-var">stgToCmmDoTicky</span></a></span><span>
</span><span id="line-782"></span><span>
</span><span id="line-783"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#ifTickyTag"><span class="hs-identifier hs-type">ifTickyTag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-784"></span><span id="ifTickyTag"><span class="annot"><span class="annottext">ifTickyTag :: FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#ifTickyTag"><span class="hs-identifier hs-var hs-var">ifTickyTag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(StgToCmmConfig -&gt; Bool) -&gt; FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#runIfFlag"><span class="hs-identifier hs-var">runIfFlag</span></a></span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig -&gt; Bool
</span><a href="GHC.StgToCmm.Config.html#stgToCmmTickyTag"><span class="hs-identifier hs-var">stgToCmmTickyTag</span></a></span><span>
</span><span id="line-785"></span><span>
</span><span id="line-786"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#ifTickyAllocd"><span class="hs-identifier hs-type">ifTickyAllocd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-787"></span><span id="ifTickyAllocd"><span class="annot"><span class="annottext">ifTickyAllocd :: FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#ifTickyAllocd"><span class="hs-identifier hs-var hs-var">ifTickyAllocd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(StgToCmmConfig -&gt; Bool) -&gt; FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#runIfFlag"><span class="hs-identifier hs-var">runIfFlag</span></a></span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig -&gt; Bool
</span><a href="GHC.StgToCmm.Config.html#stgToCmmTickyAllocd"><span class="hs-identifier hs-var">stgToCmmTickyAllocd</span></a></span><span>
</span><span id="line-788"></span><span>
</span><span id="line-789"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#ifTickyLNE"><span class="hs-identifier hs-type">ifTickyLNE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-790"></span><span id="ifTickyLNE"><span class="annot"><span class="annottext">ifTickyLNE :: FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#ifTickyLNE"><span class="hs-identifier hs-var hs-var">ifTickyLNE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(StgToCmmConfig -&gt; Bool) -&gt; FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#runIfFlag"><span class="hs-identifier hs-var">runIfFlag</span></a></span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig -&gt; Bool
</span><a href="GHC.StgToCmm.Config.html#stgToCmmTickyLNE"><span class="hs-identifier hs-var">stgToCmmTickyLNE</span></a></span><span>
</span><span id="line-791"></span><span>
</span><span id="line-792"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#ifTickyDynThunk"><span class="hs-identifier hs-type">ifTickyDynThunk</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-793"></span><span id="ifTickyDynThunk"><span class="annot"><span class="annottext">ifTickyDynThunk :: FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#ifTickyDynThunk"><span class="hs-identifier hs-var hs-var">ifTickyDynThunk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(StgToCmmConfig -&gt; Bool) -&gt; FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#runIfFlag"><span class="hs-identifier hs-var">runIfFlag</span></a></span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig -&gt; Bool
</span><a href="GHC.StgToCmm.Config.html#stgToCmmTickyDynThunk"><span class="hs-identifier hs-var">stgToCmmTickyDynThunk</span></a></span><span>
</span><span id="line-794"></span><span>
</span><span id="line-795"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounter"><span class="hs-identifier hs-type">bumpTickyCounter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-796"></span><span id="bumpTickyCounter"><span class="annot"><span class="annottext">bumpTickyCounter :: FastString -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounter"><span class="hs-identifier hs-var hs-var">bumpTickyCounter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyLbl"><span class="hs-identifier hs-var">bumpTickyLbl</span></a></span><span> </span><span class="annot"><span class="annottext">(CLabel -&gt; FCode ())
-&gt; (FastString -&gt; CLabel) -&gt; FastString -&gt; FCode ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#mkRtsCmmDataLabel"><span class="hs-identifier hs-var">mkRtsCmmDataLabel</span></a></span><span>
</span><span id="line-797"></span><span>
</span><span id="line-798"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounterBy"><span class="hs-identifier hs-type">bumpTickyCounterBy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-799"></span><span id="bumpTickyCounterBy"><span class="annot"><span class="annottext">bumpTickyCounterBy :: FastString -&gt; Int -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounterBy"><span class="hs-identifier hs-var hs-var">bumpTickyCounterBy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; Int -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyLblBy"><span class="hs-identifier hs-var">bumpTickyLblBy</span></a></span><span> </span><span class="annot"><span class="annottext">(CLabel -&gt; Int -&gt; FCode ())
-&gt; (FastString -&gt; CLabel) -&gt; FastString -&gt; Int -&gt; FCode ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#mkRtsCmmDataLabel"><span class="hs-identifier hs-var">mkRtsCmmDataLabel</span></a></span><span>
</span><span id="line-800"></span><span>
</span><span id="line-801"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounterByE"><span class="hs-identifier hs-type">bumpTickyCounterByE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-802"></span><span id="bumpTickyCounterByE"><span class="annot"><span class="annottext">bumpTickyCounterByE :: FastString -&gt; CmmExpr -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyCounterByE"><span class="hs-identifier hs-var hs-var">bumpTickyCounterByE</span></a></span></span><span> </span><span id="local-6989586621682889236"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682889236"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; CmmExpr -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyLblByE"><span class="hs-identifier hs-var">bumpTickyLblByE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#mkRtsCmmDataLabel"><span class="hs-identifier hs-var">mkRtsCmmDataLabel</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682889236"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-803"></span><span>
</span><span id="line-804"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#bumpTickyEntryCount"><span class="hs-identifier hs-type">bumpTickyEntryCount</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-805"></span><span id="bumpTickyEntryCount"><span class="annot"><span class="annottext">bumpTickyEntryCount :: CLabel -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyEntryCount"><span class="hs-identifier hs-var hs-var">bumpTickyEntryCount</span></a></span></span><span> </span><span id="local-6989586621682889238"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682889238"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-806"></span><span>  </span><span id="local-6989586621682889239"><span class="annot"><a href="#local-6989586621682889239"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FCode Platform
</span><a href="GHC.StgToCmm.Monad.html#getPlatform"><span class="hs-identifier hs-var">getPlatform</span></a></span><span>
</span><span id="line-807"></span><span>  </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#bumpTickyLit"><span class="hs-identifier hs-type">bumpTickyLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Utils.html#cmmLabelOffB"><span class="hs-identifier hs-type">cmmLabelOffB</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889238"><span class="hs-identifier hs-type">lbl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Platform.Constants.html#pc_OFFSET_StgEntCounter_entry_count"><span class="hs-identifier hs-var">pc_OFFSET_StgEntCounter_entry_count</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Platform.html#platformConstants"><span class="hs-identifier hs-type">platformConstants</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889239"><span class="hs-identifier hs-type">platform</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-808"></span><span>
</span><span id="line-809"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#bumpTickyAllocd"><span class="hs-identifier hs-type">bumpTickyAllocd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-810"></span><span id="bumpTickyAllocd"><span class="annot"><span class="annottext">bumpTickyAllocd :: CLabel -&gt; Int -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyAllocd"><span class="hs-identifier hs-var hs-var">bumpTickyAllocd</span></a></span></span><span> </span><span id="local-6989586621682889242"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682889242"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span id="local-6989586621682889243"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682889243"><span class="hs-identifier hs-var">bytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-811"></span><span>  </span><span id="local-6989586621682889244"><span class="annot"><a href="#local-6989586621682889244"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FCode Platform
</span><a href="GHC.StgToCmm.Monad.html#getPlatform"><span class="hs-identifier hs-var">getPlatform</span></a></span><span>
</span><span id="line-812"></span><span>  </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#bumpTickyLitBy"><span class="hs-identifier hs-type">bumpTickyLitBy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Utils.html#cmmLabelOffB"><span class="hs-identifier hs-type">cmmLabelOffB</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889242"><span class="hs-identifier hs-type">lbl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Platform.Constants.html#pc_OFFSET_StgEntCounter_allocd"><span class="hs-identifier hs-var">pc_OFFSET_StgEntCounter_allocd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Platform.html#platformConstants"><span class="hs-identifier hs-type">platformConstants</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889244"><span class="hs-identifier hs-type">platform</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682889243"><span class="hs-identifier hs-type">bytes</span></a></span><span>
</span><span id="line-813"></span><span>
</span><span id="line-814"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#bumpTickyTagSkip"><span class="hs-identifier hs-type">bumpTickyTagSkip</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-815"></span><span id="bumpTickyTagSkip"><span class="annot"><span class="annottext">bumpTickyTagSkip :: CLabel -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyTagSkip"><span class="hs-identifier hs-var hs-var">bumpTickyTagSkip</span></a></span></span><span> </span><span id="local-6989586621682889247"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682889247"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-816"></span><span>  </span><span id="local-6989586621682889248"><span class="annot"><a href="#local-6989586621682889248"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FCode Platform
</span><a href="GHC.StgToCmm.Monad.html#getPlatform"><span class="hs-identifier hs-var">getPlatform</span></a></span><span>
</span><span id="line-817"></span><span>  </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#bumpTickyLitBy"><span class="hs-identifier hs-type">bumpTickyLitBy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Utils.html#cmmLabelOffB"><span class="hs-identifier hs-type">cmmLabelOffB</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889247"><span class="hs-identifier hs-type">lbl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Platform.Constants.html#pc_OFFSET_StgEntCounter_entry_count"><span class="hs-identifier hs-var">pc_OFFSET_StgEntCounter_entry_count</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Platform.html#platformConstants"><span class="hs-identifier hs-type">platformConstants</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889248"><span class="hs-identifier hs-type">platform</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span>
</span><span id="line-818"></span><span>
</span><span id="line-819"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#bumpTickyLbl"><span class="hs-identifier hs-type">bumpTickyLbl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-820"></span><span id="bumpTickyLbl"><span class="annot"><span class="annottext">bumpTickyLbl :: CLabel -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyLbl"><span class="hs-identifier hs-var hs-var">bumpTickyLbl</span></a></span></span><span> </span><span id="local-6989586621682889249"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682889249"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmLit -&gt; Int -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyLitBy"><span class="hs-identifier hs-var">bumpTickyLitBy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLabel -&gt; Int -&gt; CmmLit
</span><a href="GHC.Cmm.Utils.html#cmmLabelOffB"><span class="hs-identifier hs-var">cmmLabelOffB</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682889249"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-821"></span><span>
</span><span id="line-822"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#bumpTickyLblBy"><span class="hs-identifier hs-type">bumpTickyLblBy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-823"></span><span id="bumpTickyLblBy"><span class="annot"><span class="annottext">bumpTickyLblBy :: CLabel -&gt; Int -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyLblBy"><span class="hs-identifier hs-var hs-var">bumpTickyLblBy</span></a></span></span><span> </span><span id="local-6989586621682889250"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682889250"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmLit -&gt; Int -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyLitBy"><span class="hs-identifier hs-var">bumpTickyLitBy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLabel -&gt; Int -&gt; CmmLit
</span><a href="GHC.Cmm.Utils.html#cmmLabelOffB"><span class="hs-identifier hs-var">cmmLabelOffB</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682889250"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-824"></span><span>
</span><span id="line-825"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#bumpTickyLblByE"><span class="hs-identifier hs-type">bumpTickyLblByE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-826"></span><span id="bumpTickyLblByE"><span class="annot"><span class="annottext">bumpTickyLblByE :: CLabel -&gt; CmmExpr -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyLblByE"><span class="hs-identifier hs-var hs-var">bumpTickyLblByE</span></a></span></span><span> </span><span id="local-6989586621682889251"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682889251"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmLit -&gt; CmmExpr -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyLitByE"><span class="hs-identifier hs-var">bumpTickyLitByE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLabel -&gt; Int -&gt; CmmLit
</span><a href="GHC.Cmm.Utils.html#cmmLabelOffB"><span class="hs-identifier hs-var">cmmLabelOffB</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682889251"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-827"></span><span>
</span><span id="line-828"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#bumpTickyLit"><span class="hs-identifier hs-type">bumpTickyLit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-829"></span><span id="bumpTickyLit"><span class="annot"><span class="annottext">bumpTickyLit :: CmmLit -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyLit"><span class="hs-identifier hs-var hs-var">bumpTickyLit</span></a></span></span><span> </span><span id="local-6989586621682889253"><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682889253"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmLit -&gt; Int -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyLitBy"><span class="hs-identifier hs-var">bumpTickyLitBy</span></a></span><span> </span><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682889253"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-830"></span><span>
</span><span id="line-831"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#bumpTickyLitBy"><span class="hs-identifier hs-type">bumpTickyLitBy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-832"></span><span id="bumpTickyLitBy"><span class="annot"><span class="annottext">bumpTickyLitBy :: CmmLit -&gt; Int -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyLitBy"><span class="hs-identifier hs-var hs-var">bumpTickyLitBy</span></a></span></span><span> </span><span id="local-6989586621682889254"><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682889254"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span id="local-6989586621682889255"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682889255"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Int -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#emitAddToMem"><span class="hs-identifier hs-var">emitAddToMem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmLit -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a></span><span> </span><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682889254"><span class="hs-identifier hs-var">lhs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682889255"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-833"></span><span>
</span><span id="line-834"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#bumpTickyLitByE"><span class="hs-identifier hs-type">bumpTickyLitByE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-835"></span><span id="bumpTickyLitByE"><span class="annot"><span class="annottext">bumpTickyLitByE :: CmmLit -&gt; CmmExpr -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpTickyLitByE"><span class="hs-identifier hs-var hs-var">bumpTickyLitByE</span></a></span></span><span> </span><span id="local-6989586621682889257"><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682889257"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span id="local-6989586621682889258"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682889258"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; CmmExpr -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#emitAddToMemE"><span class="hs-identifier hs-var">emitAddToMemE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmLit -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a></span><span> </span><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682889257"><span class="hs-identifier hs-var">lhs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682889258"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-836"></span><span>
</span><span id="line-837"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#bumpHistogram"><span class="hs-identifier hs-type">bumpHistogram</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-838"></span><span id="bumpHistogram"><span class="annot"><span class="annottext">bumpHistogram :: FastString -&gt; Int -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#bumpHistogram"><span class="hs-identifier hs-var hs-var">bumpHistogram</span></a></span></span><span> </span><span id="local-6989586621682889260"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682889260"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span id="local-6989586621682889261"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682889261"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-839"></span><span>    </span><span id="local-6989586621682889262"><span class="annot"><a href="#local-6989586621682889262"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FCode Platform
</span><a href="GHC.StgToCmm.Monad.html#getPlatform"><span class="hs-identifier hs-var">getPlatform</span></a></span><span>
</span><span id="line-840"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682889263"><span class="annot"><a href="#local-6989586621682889263"><span class="hs-identifier hs-var hs-var">offset</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682889261"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`min`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PlatformConstants -&gt; Int
</span><a href="GHC.Platform.Constants.html#pc_TICKY_BIN_COUNT"><span class="hs-identifier hs-var">pc_TICKY_BIN_COUNT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; PlatformConstants
</span><a href="GHC.Platform.html#platformConstants"><span class="hs-identifier hs-var">platformConstants</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682889262"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-841"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682889266"><span class="annot"><a href="#local-6989586621682889266"><span class="hs-identifier hs-var hs-var">addr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-842"></span><span>           </span><span class="annot"><span class="annottext">Platform -&gt; Width -&gt; CmmExpr -&gt; CmmExpr -&gt; CmmExpr
</span><a href="GHC.Cmm.Utils.html#cmmIndexExpr"><span class="hs-identifier hs-var">cmmIndexExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682889262"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-843"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; Width
</span><a href="GHC.Cmm.Type.html#wordWidth"><span class="hs-identifier hs-var">wordWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682889262"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-844"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmLit -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLabel -&gt; CmmLit
</span><a href="GHC.Cmm.Expr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#mkRtsCmmDataLabel"><span class="hs-identifier hs-var">mkRtsCmmDataLabel</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682889260"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-845"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmLit -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Width -&gt; CmmLit
</span><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682889263"><span class="hs-identifier hs-var">offset</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; Width
</span><a href="GHC.Cmm.Type.html#wordWidth"><span class="hs-identifier hs-var">wordWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682889262"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-846"></span><span>    </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#emitAddToMem"><span class="hs-identifier hs-type">emitAddToMem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889266"><span class="hs-identifier hs-type">addr</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span>
</span><span id="line-847"></span><span>
</span><span id="line-848"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#emitAddToMem"><span class="hs-identifier hs-type">emitAddToMem</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-849"></span><span id="emitAddToMem"><span class="annot"><span class="annottext">emitAddToMem :: CmmExpr -&gt; Int -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#emitAddToMem"><span class="hs-identifier hs-var hs-var">emitAddToMem</span></a></span></span><span> </span><span id="local-6989586621682889269"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682889269"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span id="local-6989586621682889270"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682889270"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-850"></span><span>  </span><span id="local-6989586621682889271"><span class="annot"><a href="#local-6989586621682889271"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FCode Platform
</span><a href="GHC.StgToCmm.Monad.html#getPlatform"><span class="hs-identifier hs-var">getPlatform</span></a></span><span>
</span><span id="line-851"></span><span>  </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#emitAddToMemE"><span class="hs-identifier hs-type">emitAddToMemE</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889269"><span class="hs-identifier hs-type">lhs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Utils.html#mkIntExpr"><span class="hs-identifier hs-type">mkIntExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889271"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889270"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-852"></span><span>
</span><span id="line-853"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#emitAddToMemE"><span class="hs-identifier hs-type">emitAddToMemE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-854"></span><span id="emitAddToMemE"><span class="annot"><span class="annottext">emitAddToMemE :: CmmExpr -&gt; CmmExpr -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#emitAddToMemE"><span class="hs-identifier hs-var hs-var">emitAddToMemE</span></a></span></span><span> </span><span id="local-6989586621682889272"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682889272"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span id="local-6989586621682889273"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682889273"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-855"></span><span>  </span><span id="local-6989586621682889274"><span class="annot"><a href="#local-6989586621682889274"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FCode Platform
</span><a href="GHC.StgToCmm.Monad.html#getPlatform"><span class="hs-identifier hs-var">getPlatform</span></a></span><span>
</span><span id="line-856"></span><span>  </span><span id="local-6989586621682889275"><span class="annot"><a href="#local-6989586621682889275"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#newTemp"><span class="hs-identifier hs-type">newTemp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Type.html#bWord"><span class="hs-identifier hs-type">bWord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889274"><span class="hs-identifier hs-type">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-857"></span><span>  </span><span class="annot"><a href="GHC.StgToCmm.Utils.html#emitAtomicRead"><span class="hs-identifier hs-type">emitAtomicRead</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MemOrderRelaxed"><span class="hs-identifier hs-type">MemOrderRelaxed</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889275"><span class="hs-identifier hs-type">val</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889272"><span class="hs-identifier hs-type">lhs</span></a></span><span>
</span><span id="line-858"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682889278"><span class="annot"><a href="#local-6989586621682889278"><span class="hs-identifier hs-var hs-var">val'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmExpr -&gt; CmmExpr -&gt; CmmExpr
</span><a href="GHC.Cmm.Utils.html#cmmOffsetExpr"><span class="hs-identifier hs-var">cmmOffsetExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682889274"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmReg -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmReg"><span class="hs-identifier hs-var">CmmReg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocalReg -&gt; CmmReg
</span><a href="GHC.Cmm.Reg.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a></span><span> </span><span class="annot"><span class="annottext">LocalReg
</span><a href="#local-6989586621682889275"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682889273"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-859"></span><span>  </span><span class="annot"><a href="GHC.StgToCmm.Utils.html#emitAtomicWrite"><span class="hs-identifier hs-type">emitAtomicWrite</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.MachOp.html#MemOrderRelaxed"><span class="hs-identifier hs-type">MemOrderRelaxed</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889272"><span class="hs-identifier hs-type">lhs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682889278"><span class="hs-identifier hs-type">val'</span></a></span><span>
</span><span id="line-860"></span><span>
</span><span id="line-861"></span><span class="hs-comment">------------------------------------------------------------------</span><span>
</span><span id="line-862"></span><span class="hs-comment">-- Showing the &quot;type category&quot; for ticky-ticky profiling</span><span>
</span><span id="line-863"></span><span>
</span><span id="line-864"></span><span class="annot"><a href="GHC.StgToCmm.Ticky.html#showTypeCategory"><span class="hs-identifier hs-type">showTypeCategory</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span>
</span><span id="line-865"></span><span>  </span><span class="hs-comment">{-
        +           dictionary

        &gt;           function

        {C,I,F,D,W} char, int, float, double, word
        {c,i,f,d,w} unboxed ditto

        T           tuple

        P           other primitive type
        p           unboxed ditto

        L           list
        E           enumeration type
        S           other single-constructor type
        M           other multi-constructor data-con type

        .           other type

        -           reserved for others to mark as &quot;uninteresting&quot;

  Accurate as of Mar 2013, but I eliminated the Array category instead
  of updating it, for simplicity. It's in P/p, I think --NSF

    -}</span><span>
</span><span id="line-891"></span><span id="showTypeCategory"><span class="annot"><span class="annottext">showTypeCategory :: Type -&gt; Char
</span><a href="GHC.StgToCmm.Ticky.html#showTypeCategory"><span class="hs-identifier hs-var hs-var">showTypeCategory</span></a></span></span><span> </span><span id="local-6989586621682889281"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682889281"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-892"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Predicate.html#isDictTy"><span class="hs-identifier hs-var">isDictTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682889281"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'+'</span></span><span>
</span><span id="line-893"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682889281"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-894"></span><span>  </span><span class="annot"><span class="annottext">Maybe (TyCon, [Type])
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'.'</span></span><span>
</span><span id="line-895"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682889284"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682889284"><span class="hs-identifier hs-var">tycon</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-896"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-897"></span><span>      </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Unique] -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; [Unique] -&gt; Bool
</span><a href="GHC.Utils.Unique.html#anyOfUnique"><span class="hs-identifier hs-var">anyOfUnique</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682889284"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#fUNTyConKey"><span class="hs-identifier hs-var">fUNTyConKey</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'&gt;'</span></span><span>
</span><span id="line-898"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Unique] -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; [Unique] -&gt; Bool
</span><a href="GHC.Utils.Unique.html#anyOfUnique"><span class="hs-identifier hs-var">anyOfUnique</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682889284"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#charTyConKey"><span class="hs-identifier hs-var">charTyConKey</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'C'</span></span><span>
</span><span id="line-899"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Unique] -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; [Unique] -&gt; Bool
</span><a href="GHC.Utils.Unique.html#anyOfUnique"><span class="hs-identifier hs-var">anyOfUnique</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682889284"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#charPrimTyConKey"><span class="hs-identifier hs-var">charPrimTyConKey</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'c'</span></span><span>
</span><span id="line-900"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Unique] -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; [Unique] -&gt; Bool
</span><a href="GHC.Utils.Unique.html#anyOfUnique"><span class="hs-identifier hs-var">anyOfUnique</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682889284"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#doubleTyConKey"><span class="hs-identifier hs-var">doubleTyConKey</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'D'</span></span><span>
</span><span id="line-901"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Unique] -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; [Unique] -&gt; Bool
</span><a href="GHC.Utils.Unique.html#anyOfUnique"><span class="hs-identifier hs-var">anyOfUnique</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682889284"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#doublePrimTyConKey"><span class="hs-identifier hs-var">doublePrimTyConKey</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'d'</span></span><span>
</span><span id="line-902"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Unique] -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; [Unique] -&gt; Bool
</span><a href="GHC.Utils.Unique.html#anyOfUnique"><span class="hs-identifier hs-var">anyOfUnique</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682889284"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#floatTyConKey"><span class="hs-identifier hs-var">floatTyConKey</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'F'</span></span><span>
</span><span id="line-903"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Unique] -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; [Unique] -&gt; Bool
</span><a href="GHC.Utils.Unique.html#anyOfUnique"><span class="hs-identifier hs-var">anyOfUnique</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682889284"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#floatPrimTyConKey"><span class="hs-identifier hs-var">floatPrimTyConKey</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'f'</span></span><span>
</span><span id="line-904"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Unique] -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; [Unique] -&gt; Bool
</span><a href="GHC.Utils.Unique.html#anyOfUnique"><span class="hs-identifier hs-var">anyOfUnique</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682889284"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#intTyConKey"><span class="hs-identifier hs-var">intTyConKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#int8TyConKey"><span class="hs-identifier hs-var">int8TyConKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#int16TyConKey"><span class="hs-identifier hs-var">int16TyConKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#int32TyConKey"><span class="hs-identifier hs-var">int32TyConKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#int64TyConKey"><span class="hs-identifier hs-var">int64TyConKey</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'I'</span></span><span>
</span><span id="line-905"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Unique] -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; [Unique] -&gt; Bool
</span><a href="GHC.Utils.Unique.html#anyOfUnique"><span class="hs-identifier hs-var">anyOfUnique</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682889284"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#intPrimTyConKey"><span class="hs-identifier hs-var">intPrimTyConKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#int8PrimTyConKey"><span class="hs-identifier hs-var">int8PrimTyConKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#int16PrimTyConKey"><span class="hs-identifier hs-var">int16PrimTyConKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#int32PrimTyConKey"><span class="hs-identifier hs-var">int32PrimTyConKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#int64PrimTyConKey"><span class="hs-identifier hs-var">int64PrimTyConKey</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'i'</span></span><span>
</span><span id="line-906"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Unique] -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; [Unique] -&gt; Bool
</span><a href="GHC.Utils.Unique.html#anyOfUnique"><span class="hs-identifier hs-var">anyOfUnique</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682889284"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#wordTyConKey"><span class="hs-identifier hs-var">wordTyConKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#word8TyConKey"><span class="hs-identifier hs-var">word8TyConKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#word16TyConKey"><span class="hs-identifier hs-var">word16TyConKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#word32TyConKey"><span class="hs-identifier hs-var">word32TyConKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#word64TyConKey"><span class="hs-identifier hs-var">word64TyConKey</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'W'</span></span><span>
</span><span id="line-907"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Unique] -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; [Unique] -&gt; Bool
</span><a href="GHC.Utils.Unique.html#anyOfUnique"><span class="hs-identifier hs-var">anyOfUnique</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682889284"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#wordPrimTyConKey"><span class="hs-identifier hs-var">wordPrimTyConKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#word8PrimTyConKey"><span class="hs-identifier hs-var">word8PrimTyConKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#word16PrimTyConKey"><span class="hs-identifier hs-var">word16PrimTyConKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#word32PrimTyConKey"><span class="hs-identifier hs-var">word32PrimTyConKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#word64PrimTyConKey"><span class="hs-identifier hs-var">word64PrimTyConKey</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'w'</span></span><span>
</span><span id="line-908"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Unique] -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; [Unique] -&gt; Bool
</span><a href="GHC.Utils.Unique.html#anyOfUnique"><span class="hs-identifier hs-var">anyOfUnique</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682889284"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#listTyConKey"><span class="hs-identifier hs-var">listTyConKey</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'L'</span></span><span>
</span><span id="line-909"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isUnboxedTupleTyCon"><span class="hs-identifier hs-var">isUnboxedTupleTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682889284"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'t'</span></span><span>
</span><span id="line-910"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isTupleTyCon"><span class="hs-identifier hs-var">isTupleTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682889284"><span class="hs-identifier hs-var">tycon</span></a></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'T'</span></span><span>
</span><span id="line-911"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isPrimTyCon"><span class="hs-identifier hs-var">isPrimTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682889284"><span class="hs-identifier hs-var">tycon</span></a></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'P'</span></span><span>
</span><span id="line-912"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isEnumerationTyCon"><span class="hs-identifier hs-var">isEnumerationTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682889284"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'E'</span></span><span>
</span><span id="line-913"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe DataCon -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Maybe DataCon
</span><a href="GHC.Core.TyCon.html#tyConSingleDataCon_maybe"><span class="hs-identifier hs-var">tyConSingleDataCon_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682889284"><span class="hs-identifier hs-var">tycon</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'S'</span></span><span>
</span><span id="line-914"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'M'</span></span><span> </span><span class="hs-comment">-- oh, well...</span><span>
</span><span id="line-915"></span></pre></body></html>