<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The AQUA Project, Glasgow University, 1993-1998

-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="annot"><span class="hs-comment">-- | Typechecking @default@ declarations</span></span><span>
</span><span id="line-9"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Default.html"><span class="hs-identifier">GHC.Tc.Gen.Default</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Default.html#tcDefaults"><span class="hs-identifier">tcDefaults</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.html"><span class="hs-identifier">GHC.Hs</span></a></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Class.html"><span class="hs-identifier">GHC.Core.Class</span></a></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier">TyCon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier">typeKind</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.html"><span class="hs-identifier">GHC.Types.Var</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier">tyVarKind</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html"><span class="hs-identifier">GHC.Tc.Errors.Types</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html"><span class="hs-identifier">GHC.Tc.Utils.Env</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html"><span class="hs-identifier">GHC.Tc.Gen.HsType</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Type.html"><span class="hs-identifier">GHC.Tc.Zonk.Type</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.html"><span class="hs-identifier">GHC.Tc.Solver</span></a></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Validity.html"><span class="hs-identifier">GHC.Tc.Validity</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.DefaultEnv.html"><span class="hs-identifier">GHC.Types.DefaultEnv</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.DefaultEnv.html#DefaultEnv"><span class="hs-identifier">DefaultEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.DefaultEnv.html#ClassDefaults"><span class="hs-identifier">ClassDefaults</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.DefaultEnv.html#defaultEnv"><span class="hs-identifier">defaultEnv</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Error.html"><span class="hs-identifier">GHC.Types.Error</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html"><span class="hs-identifier">GHC.Unit.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier">Module</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#bignumUnit"><span class="hs-identifier">bignumUnit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#ghcInternalUnit"><span class="hs-identifier">ghcInternalUnit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#moduleUnit"><span class="hs-identifier">moduleUnit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#primUnit"><span class="hs-identifier">primUnit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Misc.html#fstOf3"><span class="hs-identifier">fstOf3</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#sndOf3"><span class="hs-identifier">sndOf3</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../ghc-boot-9.12.2-1a37/src/GHC.LanguageExtensions.html"><span class="hs-identifier">GHC.LanguageExtensions</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LangExt</span></span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">void</span></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Function.html"><span class="hs-identifier">Data.Function</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">on</span></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#groupBy"><span class="hs-identifier">groupBy</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-comment">{- Note [Named default declarations]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
With the `NamedDefaults` language extension, a `default` declaration can specify type-class
defaulting behaviour for specific classes. For example

      class C a where
        ...
      default C( Int, Bool )  -- The default types for class C

The `default` declaration tells GHC to default unresolved constraints (C a) to (C Int) or
(C Bool), in that order. Of course, if you don't specify a class, thus

    default (Int, Bool)

the default declaration behaves as before, affecting primarily the `Num` class.

Moreover, a module export list can specify a list of classes whose defaults should be
exported.  For example

    module M( C, default C )

would export the above `default` declaration for `C`.

See details at
https://github.com/ghc-proposals/ghc-proposals/blob/master/proposals/0409-exportable-named-default.rst

The moving parts are as follows:

* Language.Haskell.Syntax.Decls.DefaultDecl: A `DefaultDecl` optionally carries
  the specified class.

* Parsing and renaming are entirely straightforward.

* The typechecker maintains a `DefaultEnv` (see GHC.Types.DefaultEnv)
  which maps a class to a `ClassDefaults`.  The `ClassDefaults` for a class
  specifies the defaults for that class, in the current module.

* The `DefaultEnv` of all defaults in scope in a module is kept in the `tcg_default`
  field of `TcGblEnv`.

* This field is populated by `GHC.Tc.Gen.Default.tcDefaults` which typechecks
  any local or imported `default` declarations.

* Only a single default declaration can be in effect in any single module for
  any particular class. We issue an error if a single module contains two
  default declarations for the same class, a possible warning if it imports
  them.

  See Note [Disambiguation of multiple default declarations] in GHC.Tc.Module

* There is a _default_ `DefaultEnv` even in absence of any user-declared
  `default` declarations. It is determined by the presence of the
  `ExtendedDefaultRules` and `OverloadedStrings` extensions. If neither of these
  extensions nor user-declared declarations are present, the `DefaultEnv` will
  in effect be `default Num (Integer, Double)` as specified by Haskell Language
  Report.

  See Note [Default class defaults] in GHC.Tc.Utils.Env

* Beside the defaults, the `ExtendedDefaultRules` and `OverloadedStrings`
  extensions also affect the traditional `default` declarations that don't name
  the class. They have no effect on declarations with explicit class name.
  For details of their operation see the corresponding sections of GHC User's Guide:
  - https://downloads.haskell.org/ghc/latest/docs/users_guide/ghci.html#extension-ExtendedDefaultRules
  - https://downloads.haskell.org/ghc/latest/docs/users_guide/exts/overloaded_strings.html#extension-OverloadedStrings

* The module's `tcg_default` is consulted when defaulting unsolved constraints,
  in GHC.Tc.Solver.applyDefaultingRules.
  See Note [How type-class constraints are defaulted] in GHC.Tc.Solver

* Class defaults are imported automatically, like class instances. They are
  tracked separately from `ImportAvails`, and returned separately from them by
  `GHC.Rename.Names.rnImports`.

* Class defaults are exported explicitly, as the example above shows. A module's
  exported defaults are tracked in `tcg_default_exports`, which are then
  transferred to `mg_defaults`, `md_defaults`, and `mi_defaults_`.
  See Note [Default exports] in GHC.Tc.Gen.Export

* Since the class defaults merely help the solver infer the correct types, they
  leave no trace in Haskell Core.
-}</span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="hs-comment">-- See Note [Named default declarations]</span><span>
</span><span id="line-125"></span><span class="annot"><a href="GHC.Tc.Gen.Default.html#tcDefaults"><span class="hs-identifier hs-type">tcDefaults</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#LDefaultDecl"><span class="hs-identifier hs-type">LDefaultDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-126"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.DefaultEnv.html#DefaultEnv"><span class="hs-identifier hs-type">DefaultEnv</span></a></span><span>  </span><span class="hs-comment">-- Defaulting types to heave</span><span>
</span><span id="line-127"></span><span>                              </span><span class="hs-comment">-- into Tc monad for later use</span><span>
</span><span id="line-128"></span><span>                              </span><span class="hs-comment">-- in Disambig.</span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span id="tcDefaults"><span class="annot"><span class="annottext">tcDefaults :: [LDefaultDecl GhcRn] -&gt; TcM DefaultEnv
</span><a href="GHC.Tc.Gen.Default.html#tcDefaults"><span class="hs-identifier hs-var hs-var">tcDefaults</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-131"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM DefaultEnv
</span><a href="GHC.Tc.Utils.Monad.html#getDeclaredDefaultTys"><span class="hs-identifier hs-var">getDeclaredDefaultTys</span></a></span><span>       </span><span class="hs-comment">-- No default declaration, so get the</span><span>
</span><span id="line-132"></span><span>                                </span><span class="hs-comment">-- default types from the envt;</span><span>
</span><span id="line-133"></span><span>                                </span><span class="hs-comment">-- i.e. use the current ones</span><span>
</span><span id="line-134"></span><span>                                </span><span class="hs-comment">-- (the caller will put them back there)</span><span>
</span><span id="line-135"></span><span>        </span><span class="hs-comment">-- It's important not to return defaultDefaultTys here (which</span><span>
</span><span id="line-136"></span><span>        </span><span class="hs-comment">-- we used to do) because in a TH program, tcDefaults [] is called</span><span>
</span><span id="line-137"></span><span>        </span><span class="hs-comment">-- repeatedly, once for each group of declarations between top-level</span><span>
</span><span id="line-138"></span><span>        </span><span class="hs-comment">-- splices.  We don't want to carefully set the default types in</span><span>
</span><span id="line-139"></span><span>        </span><span class="hs-comment">-- one group, only for the next group to ignore them and install</span><span>
</span><span id="line-140"></span><span>        </span><span class="hs-comment">-- defaultDefaultTys</span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span class="annot"><a href="GHC.Tc.Gen.Default.html#tcDefaults"><span class="hs-identifier hs-var">tcDefaults</span></a></span><span> </span><span id="local-6989586621683082137"><span class="annot"><span class="annottext">[LDefaultDecl GhcRn]
</span><a href="#local-6989586621683082137"><span class="hs-identifier hs-var">decls</span></a></span></span><span>
</span><span id="line-143"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683082138"><span class="annot"><a href="#local-6989586621683082138"><span class="hs-identifier hs-var">ovl_str</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.OverloadedStrings</span></span><span>
</span><span id="line-144"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683082141"><span class="annot"><a href="#local-6989586621683082141"><span class="hs-identifier hs-var">ext_deflt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-type">xoptM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LangExt.ExtendedDefaultRules</span></span><span>
</span><span id="line-145"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683082143"><span class="annot"><a href="#local-6989586621683082143"><span class="hs-identifier hs-var">deflt_str</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621683082138"><span class="hs-identifier hs-type">ovl_str</span></a></span><span>
</span><span id="line-146"></span><span>                       </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcLookupClass"><span class="hs-identifier hs-type">tcLookupClass</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Builtin.Names.html#isStringClassName"><span class="hs-identifier hs-type">isStringClassName</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-147"></span><span>                       </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-148"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683082147"><span class="annot"><a href="#local-6989586621683082147"><span class="hs-identifier hs-var">deflt_interactive</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621683082141"><span class="hs-identifier hs-type">ext_deflt</span></a></span><span>
</span><span id="line-149"></span><span>                               </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcLookupClass"><span class="hs-identifier hs-type">tcLookupClass</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#interactiveClassNames"><span class="hs-identifier hs-type">interactiveClassNames</span></a></span><span>
</span><span id="line-150"></span><span>                               </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-151"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683082149"><span class="annot"><a href="#local-6989586621683082149"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-type">getGblEnv</span></a></span><span>
</span><span id="line-152"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683082151"><span class="annot"><a href="#local-6989586621683082151"><span class="hs-identifier hs-var hs-var">extra_clss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Class]
</span><a href="#local-6989586621683082143"><span class="hs-identifier hs-var">deflt_str</span></a></span><span> </span><span class="annot"><span class="annottext">[Class] -&gt; [Class] -&gt; [Class]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Class]
</span><a href="#local-6989586621683082147"><span class="hs-identifier hs-var">deflt_interactive</span></a></span><span>
</span><span id="line-153"></span><span>              </span><span id="local-6989586621683082152"><span class="annot"><a href="#local-6989586621683082152"><span class="hs-identifier hs-var hs-var">here</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; Module
</span><a href="GHC.Tc.Types.html#tcg_mod"><span class="hs-identifier hs-var">tcg_mod</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683082149"><span class="hs-identifier hs-var">tcg_env</span></a></span><span>
</span><span id="line-154"></span><span>              </span><span id="local-6989586621683082154"><span class="annot"><a href="#local-6989586621683082154"><span class="hs-identifier hs-var hs-var">is_internal_unit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; Unit
forall unit. GenModule unit -&gt; unit
</span><a href="GHC.Unit.Types.html#moduleUnit"><span class="hs-identifier hs-var">moduleUnit</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683082152"><span class="hs-identifier hs-var">here</span></a></span><span> </span><span class="annot"><span class="annottext">Unit -&gt; [Unit] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Unit
</span><a href="GHC.Unit.Types.html#bignumUnit"><span class="hs-identifier hs-var">bignumUnit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Unit
</span><a href="GHC.Unit.Types.html#ghcInternalUnit"><span class="hs-identifier hs-var">ghcInternalUnit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Unit
</span><a href="GHC.Unit.Types.html#primUnit"><span class="hs-identifier hs-var">primUnit</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-155"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683082156"><span class="annot"><a href="#local-6989586621683082156"><span class="hs-identifier hs-var">decls'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683082154"><span class="hs-identifier hs-type">is_internal_unit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683082137"><span class="hs-identifier hs-type">decls</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-156"></span><span>            </span><span class="hs-comment">-- Some internal GHC modules contain @default ()@ to declare that no defaults can take place</span><span>
</span><span id="line-157"></span><span>            </span><span class="hs-comment">-- in the module.</span><span>
</span><span id="line-158"></span><span>            </span><span class="hs-comment">-- We shortcut the treatment of such a default declaration with no class nor types: we won't</span><span>
</span><span id="line-159"></span><span>            </span><span class="hs-comment">-- try to point 'cd_class' to 'Num' since it may not even exist yet.</span><span>
</span><span id="line-160"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#DefaultDecl"><span class="hs-identifier hs-type">DefaultDecl</span></a></span><span> </span><span class="annot"><span class="annottext">XCDefaultDecl GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe (LIdP GhcRn)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(GenLocated SrcSpanAnnA (DefaultDecl GhcRn), TyCon, [Type])]
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     [(GenLocated SrcSpanAnnA (DefaultDecl GhcRn), TyCon, [Type])]
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-161"></span><span>            </span><span class="hs-comment">-- Otherwise we take apart the declaration into the class constructor and its default types.</span><span>
</span><span id="line-162"></span><span>            </span><span class="annot"><span class="annottext">(Bool, [GenLocated SrcSpanAnnA (DefaultDecl GhcRn)])
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (DefaultDecl GhcRn)
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (GenLocated SrcSpanAnnA (DefaultDecl GhcRn), TyCon, [Type]))
-&gt; [GenLocated SrcSpanAnnA (DefaultDecl GhcRn)]
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     [(GenLocated SrcSpanAnnA (DefaultDecl GhcRn), TyCon, [Type])]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Class]
-&gt; LDefaultDecl GhcRn -&gt; TcM (LDefaultDecl GhcRn, TyCon, [Type])
</span><a href="#local-6989586621683082159"><span class="hs-identifier hs-var">declarationParts</span></a></span><span> </span><span class="annot"><span class="annottext">[Class]
</span><a href="#local-6989586621683082151"><span class="hs-identifier hs-var">extra_clss</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LDefaultDecl GhcRn]
[GenLocated SrcSpanAnnA (DefaultDecl GhcRn)]
</span><a href="#local-6989586621683082137"><span class="hs-identifier hs-var">decls</span></a></span><span>
</span><span id="line-163"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Types.DefaultEnv.html#defaultEnv"><span class="hs-identifier hs-type">defaultEnv</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">concat</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683082163"><span class="hs-identifier hs-type">reportDuplicates</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683082152"><span class="hs-identifier hs-type">here</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683082151"><span class="hs-identifier hs-type">extra_clss</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#groupBy"><span class="hs-identifier hs-type">groupBy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator hs-type">(==)</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">`on`</span></span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#sndOf3"><span class="hs-identifier hs-type">sndOf3</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683082156"><span class="hs-identifier hs-type">decls'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-164"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-165"></span><span>    </span><span class="annot"><a href="#local-6989586621683082159"><span class="hs-identifier hs-type">declarationParts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#LDefaultDecl"><span class="hs-identifier hs-type">LDefaultDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#LDefaultDecl"><span class="hs-identifier hs-type">LDefaultDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>    </span><span class="annot"><a href="#local-6989586621683082163"><span class="hs-identifier hs-type">reportDuplicates</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#LDefaultDecl"><span class="hs-identifier hs-type">LDefaultDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.DefaultEnv.html#ClassDefaults"><span class="hs-identifier hs-type">ClassDefaults</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-167"></span><span>    </span><span id="local-6989586621683082159"><span class="annot"><span class="annottext">declarationParts :: [Class]
-&gt; LDefaultDecl GhcRn -&gt; TcM (LDefaultDecl GhcRn, TyCon, [Type])
</span><a href="#local-6989586621683082159"><span class="hs-identifier hs-var hs-var">declarationParts</span></a></span></span><span> </span><span id="local-6989586621683082164"><span class="annot"><span class="annottext">[Class]
</span><a href="#local-6989586621683082164"><span class="hs-identifier hs-var">extra_clss</span></a></span></span><span> </span><span id="local-6989586621683082165"><span class="annot"><span class="annottext">decl :: LDefaultDecl GhcRn
</span><a href="#local-6989586621683082165"><span class="hs-identifier hs-var">decl</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683082166"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683082166"><span class="hs-identifier hs-var">locn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#DefaultDecl"><span class="hs-identifier hs-type">DefaultDecl</span></a></span><span> </span><span class="annot"><span class="annottext">XCDefaultDecl GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683082167"><span class="annot"><span class="annottext">Maybe (LIdP GhcRn)
</span><a href="#local-6989586621683082167"><span class="hs-identifier hs-var">cls_tyMaybe</span></a></span></span><span> </span><span id="local-6989586621683082168"><span class="annot"><span class="annottext">[LHsType GhcRn]
</span><a href="#local-6989586621683082168"><span class="hs-identifier hs-var">mono_tys</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
-&gt; TcM (LDefaultDecl GhcRn, TyCon, [Type])
-&gt; TcM (LDefaultDecl GhcRn, TyCon, [Type])
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Tc.Gen.Default.html#defaultDeclCtxt"><span class="hs-identifier hs-var">defaultDeclCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LDefaultDecl GhcRn, TyCon, [Type])
 -&gt; TcM (LDefaultDecl GhcRn, TyCon, [Type]))
-&gt; TcM (LDefaultDecl GhcRn, TyCon, [Type])
-&gt; TcM (LDefaultDecl GhcRn, TyCon, [Type])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-169"></span><span>        </span><span class="annot"><span class="annottext">SrcSpan
-&gt; TcM (LDefaultDecl GhcRn, TyCon, [Type])
-&gt; TcM (LDefaultDecl GhcRn, TyCon, [Type])
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; SrcSpan
forall a. HasLoc a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-var">locA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683082166"><span class="hs-identifier hs-var">locn</span></a></span><span class="hs-special">)</span><span>     </span><span class="annot"><span class="annottext">(TcM (LDefaultDecl GhcRn, TyCon, [Type])
 -&gt; TcM (LDefaultDecl GhcRn, TyCon, [Type]))
-&gt; TcM (LDefaultDecl GhcRn, TyCon, [Type])
-&gt; TcM (LDefaultDecl GhcRn, TyCon, [Type])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-170"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683082173"><span class="annot"><a href="#local-6989586621683082173"><span class="hs-identifier hs-var">tau_tys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsType GhcRn) -&gt; TcRn Type)
-&gt; [GenLocated SrcSpanAnnA (HsType GhcRn)] -&gt; TcRn [Type]
forall a b. (a -&gt; TcRn b) -&gt; [a] -&gt; TcRn [b]
</span><a href="GHC.Tc.Utils.Monad.html#mapAndReportM"><span class="hs-identifier hs-var">mapAndReportM</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; TcRn Type
GenLocated SrcSpanAnnA (HsType GhcRn) -&gt; TcRn Type
</span><a href="GHC.Tc.Gen.Default.html#tc_default_ty"><span class="hs-identifier hs-var">tc_default_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsType GhcRn]
[GenLocated SrcSpanAnnA (HsType GhcRn)]
</span><a href="#local-6989586621683082168"><span class="hs-identifier hs-var">mono_tys</span></a></span><span>
</span><span id="line-171"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683082176"><span class="annot"><a href="#local-6989586621683082176"><span class="hs-identifier hs-var">def_clsCon</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683082167"><span class="hs-identifier hs-type">cls_tyMaybe</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-172"></span><span>               </span><span class="annot"><span class="annottext">Maybe (LIdP GhcRn)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-173"></span><span>                 </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683082177"><span class="annot"><a href="#local-6989586621683082177"><span class="hs-identifier hs-var">numTyCon</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) TyCon
</span><a href="GHC.Tc.Utils.Env.html#tcLookupTyCon"><span class="hs-identifier hs-var">tcLookupTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#numClassName"><span class="hs-identifier hs-var">numClassName</span></a></span><span>
</span><span id="line-174"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683082182"><span class="annot"><a href="#local-6989586621683082182"><span class="hs-identifier hs-var hs-var">classTyConAndArgKinds</span></a></span></span><span> </span><span id="local-6989586621683082183"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683082183"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; TyCon
</span><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier hs-var">classTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683082183"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; Type
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">(TyVar -&gt; Type) -&gt; [TyVar] -&gt; [Type]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Class -&gt; [TyVar]
</span><a href="GHC.Core.Class.html#classTyVars"><span class="hs-identifier hs-var">classTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683082183"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span>                          </span><span id="local-6989586621683082186"><span class="annot"><a href="#local-6989586621683082186"><span class="hs-identifier hs-var hs-var">tyConsAndArgKinds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683082177"><span class="hs-identifier hs-var">numTyCon</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TyCon, [Type], [Type])
-&gt; [(TyCon, [Type], [Type])] -&gt; [(TyCon, [Type], [Type])]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">(Class -&gt; (TyCon, [Type], [Type]))
-&gt; [Class] -&gt; [(TyCon, [Type], [Type])]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Class -&gt; (TyCon, [Type], [Type])
forall {a}. Class -&gt; (TyCon, [a], [Type])
</span><a href="#local-6989586621683082182"><span class="hs-identifier hs-var">classTyConAndArgKinds</span></a></span><span> </span><span class="annot"><span class="annottext">[Class]
</span><a href="#local-6989586621683082164"><span class="hs-identifier hs-var">extra_clss</span></a></span><span>
</span><span id="line-176"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">void</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mapAndReportM"><span class="hs-identifier hs-type">mapAndReportM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Default.html#check_instance_any"><span class="hs-identifier hs-type">check_instance_any</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683082186"><span class="hs-identifier hs-type">tyConsAndArgKinds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683082173"><span class="hs-identifier hs-type">tau_tys</span></a></span><span>
</span><span id="line-177"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683082177"><span class="hs-identifier hs-type">numTyCon</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-178"></span><span>               </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683082189"><span class="annot"><span class="annottext">LIdP GhcRn
</span><a href="#local-6989586621683082189"><span class="hs-identifier hs-var">cls_name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-179"></span><span>                 </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683082190"><span class="annot"><a href="#local-6989586621683082190"><span class="hs-identifier hs-var">named_deflt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.NamedDefaults</span></span><span>
</span><span id="line-180"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#checkErr"><span class="hs-identifier hs-type">checkErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683082190"><span class="hs-identifier hs-type">named_deflt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnIllegalNamedDefault"><span class="hs-identifier hs-type">TcRnIllegalNamedDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683082165"><span class="hs-identifier hs-type">decl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683082194"><span class="annot"><a href="#local-6989586621683082194"><span class="hs-identifier hs-var hs-var">cls_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsSigType GhcRn -&gt; GenLocated SrcSpanAnnA (HsSigType GhcRn)
forall e a. HasAnnotation e =&gt; a -&gt; GenLocated e a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsSig"><span class="hs-identifier hs-type">HsSig</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sig_ext :: XHsSig GhcRn
</span><a href="Language.Haskell.Syntax.Type.html#sig_ext"><span class="hs-identifier hs-var">sig_ext</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XHsSig GhcRn
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span>
</span><span id="line-182"></span><span>                                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sig_bndrs :: HsOuterSigTyVarBndrs GhcRn
</span><a href="Language.Haskell.Syntax.Type.html#sig_bndrs"><span class="hs-identifier hs-var">sig_bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOuterImplicit"><span class="hs-identifier hs-type">HsOuterImplicit</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">hso_ximplicit :: XHsOuterImplicit GhcRn
</span><a href="Language.Haskell.Syntax.Type.html#hso_ximplicit"><span class="hs-identifier hs-var">hso_ximplicit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">}</span><span>
</span><span id="line-183"></span><span>                                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sig_body :: LHsType GhcRn
</span><a href="Language.Haskell.Syntax.Type.html#sig_body"><span class="hs-identifier hs-var">sig_body</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsType GhcRn -&gt; GenLocated SrcSpanAnnA (HsType GhcRn)
forall e a. HasAnnotation e =&gt; a -&gt; GenLocated e a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="annot"><span class="annottext">(HsType GhcRn -&gt; GenLocated SrcSpanAnnA (HsType GhcRn))
-&gt; HsType GhcRn -&gt; GenLocated SrcSpanAnnA (HsType GhcRn)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">XTyVar GhcRn -&gt; PromotionFlag -&gt; LIdP GhcRn -&gt; HsType GhcRn
forall pass.
XTyVar pass -&gt; PromotionFlag -&gt; LIdP pass -&gt; HsType pass
</span><a href="Language.Haskell.Syntax.Type.html#HsTyVar"><span class="hs-identifier hs-var">HsTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">XTyVar GhcRn
forall a. NoAnn a =&gt; a
</span><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-var">noAnn</span></a></span><span> </span><span class="annot"><span class="annottext">PromotionFlag
</span><a href="Language.Haskell.Syntax.Type.html#NotPromoted"><span class="hs-identifier hs-var">NotPromoted</span></a></span><span> </span><span class="annot"><span class="annottext">LIdP GhcRn
</span><a href="#local-6989586621683082189"><span class="hs-identifier hs-var">cls_name</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683082206"><span class="annot"><a href="#local-6989586621683082206"><span class="hs-identifier hs-var">_cls_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683082207"><span class="annot"><a href="#local-6989586621683082207"><span class="hs-identifier hs-var">cls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683082208"><span class="annot"><a href="#local-6989586621683082208"><span class="hs-identifier hs-var">cls_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683082209"><span class="annot"><a href="#local-6989586621683082209"><span class="hs-identifier hs-var">cls_arg_kinds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsDefault"><span class="hs-identifier hs-type">tcHsDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683082194"><span class="hs-identifier hs-type">cls_ty</span></a></span><span>
</span><span id="line-185"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683082211"><span class="annot"><a href="#local-6989586621683082211"><span class="hs-identifier hs-var hs-var">clsTyCon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class -&gt; TyCon
</span><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier hs-var">classTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683082207"><span class="hs-identifier hs-var">cls</span></a></span><span>
</span><span id="line-186"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683082209"><span class="hs-identifier hs-type">cls_arg_kinds</span></a></span><span>
</span><span id="line-187"></span><span>                      </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">[</span><span id="local-6989586621683082212"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683082212"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) [()]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) [()]
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [()]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; [Type] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [()]
forall a b. (a -&gt; TcRn b) -&gt; [a] -&gt; TcRn [b]
</span><a href="GHC.Tc.Utils.Monad.html#mapAndReportM"><span class="hs-identifier hs-var">mapAndReportM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(TyCon, [Type], [Type])]
-&gt; Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Gen.Default.html#check_instance_any"><span class="hs-identifier hs-var">check_instance_any</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683082211"><span class="hs-identifier hs-var">clsTyCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683082208"><span class="hs-identifier hs-var">cls_tys</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683082212"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683082173"><span class="hs-identifier hs-var">tau_tys</span></a></span><span>
</span><span id="line-188"></span><span>                         </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UserTypeCtxt -&gt; LHsSigType GhcRn -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnNonUnaryTypeclassConstraint"><span class="hs-identifier hs-var">TcRnNonUnaryTypeclassConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#DefaultDeclCtxt"><span class="hs-identifier hs-var">DefaultDeclCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsSigType GhcRn
GenLocated SrcSpanAnnA (HsSigType GhcRn)
</span><a href="#local-6989586621683082194"><span class="hs-identifier hs-var">cls_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683082211"><span class="hs-identifier hs-type">clsTyCon</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-190"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683082165"><span class="hs-identifier hs-type">decl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683082176"><span class="hs-identifier hs-type">def_clsCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683082173"><span class="hs-identifier hs-type">tau_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-191"></span><span>    </span><span id="local-6989586621683082163"><span class="annot"><span class="annottext">reportDuplicates :: Module
-&gt; [Class]
-&gt; NonEmpty (LDefaultDecl GhcRn, TyCon, [Type])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [ClassDefaults]
</span><a href="#local-6989586621683082163"><span class="hs-identifier hs-var hs-var">reportDuplicates</span></a></span></span><span> </span><span id="local-6989586621683082216"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683082216"><span class="hs-identifier hs-var">here</span></a></span></span><span> </span><span id="local-6989586621683082217"><span class="annot"><span class="annottext">[Class]
</span><a href="#local-6989586621683082217"><span class="hs-identifier hs-var">extra_clss</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">LDefaultDecl GhcRn
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683082218"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683082218"><span class="hs-identifier hs-var">clsCon</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683082219"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683082219"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ClassDefaults] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [ClassDefaults]
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Types.DefaultEnv.html#ClassDefaults"><span class="hs-identifier hs-type">ClassDefaults</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">cd_class :: TyCon
</span><a href="GHC.Types.DefaultEnv.html#cd_class"><span class="hs-identifier hs-var">cd_class</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683082223"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cd_types :: [Type]
</span><a href="GHC.Types.DefaultEnv.html#cd_types"><span class="hs-identifier hs-var">cd_types</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683082219"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cd_module :: Maybe Module
</span><a href="GHC.Types.DefaultEnv.html#cd_module"><span class="hs-identifier hs-var">cd_module</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; Maybe Module
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683082216"><span class="hs-identifier hs-var">here</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cd_warn :: Maybe (WarningTxt GhcRn)
</span><a href="GHC.Types.DefaultEnv.html#cd_warn"><span class="hs-identifier hs-var">cd_warn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (WarningTxt GhcRn)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">}</span><span>
</span><span id="line-193"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683082223"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683082223"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683082218"><span class="hs-identifier hs-var">clsCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [TyCon] -&gt; [TyCon]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">(Class -&gt; TyCon) -&gt; [Class] -&gt; [TyCon]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Class -&gt; TyCon
</span><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier hs-var">classTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">[Class]
</span><a href="#local-6989586621683082217"><span class="hs-identifier hs-var">extra_clss</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-194"></span><span>    </span><span class="hs-comment">-- Report an error on multiple default declarations for the same class in the same module.</span><span>
</span><span id="line-195"></span><span>    </span><span class="hs-comment">-- See Note [Disambiguation of multiple default declarations] in GHC.Tc.Module</span><span>
</span><span id="line-196"></span><span>    </span><span class="annot"><a href="#local-6989586621683082163"><span class="hs-identifier hs-var">reportDuplicates</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Class]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683082227"><span class="annot"><span class="annottext">decls :: NonEmpty (LDefaultDecl GhcRn, TyCon, [Type])
</span><a href="#local-6989586621683082227"><span class="hs-identifier hs-var">decls</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683082228"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683082228"><span class="hs-identifier hs-var">locn</span></a></span></span><span> </span><span class="annot"><span class="annottext">DefaultDecl GhcRn
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683082229"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683082229"><span class="hs-identifier hs-var">cls</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span class="annot"><span class="annottext">[(LDefaultDecl GhcRn, TyCon, [Type])]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; SrcSpan
forall a. HasLoc a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-var">locA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683082228"><span class="hs-identifier hs-var">locn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ())
-&gt; TcRnMessage -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; NonEmpty (LDefaultDecl GhcRn) -&gt; TcRnMessage
</span><a href="GHC.Tc.Gen.Default.html#dupDefaultDeclErr"><span class="hs-identifier hs-var">dupDefaultDeclErr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683082229"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (DefaultDecl GhcRn), TyCon, [Type])
-&gt; GenLocated SrcSpanAnnA (DefaultDecl GhcRn)
forall a b c. (a, b, c) -&gt; a
</span><a href="GHC.Utils.Misc.html#fstOf3"><span class="hs-identifier hs-var">fstOf3</span></a></span><span> </span><span class="annot"><span class="annottext">((GenLocated SrcSpanAnnA (DefaultDecl GhcRn), TyCon, [Type])
 -&gt; GenLocated SrcSpanAnnA (DefaultDecl GhcRn))
-&gt; NonEmpty
     (GenLocated SrcSpanAnnA (DefaultDecl GhcRn), TyCon, [Type])
-&gt; NonEmpty (GenLocated SrcSpanAnnA (DefaultDecl GhcRn))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (LDefaultDecl GhcRn, TyCon, [Type])
NonEmpty
  (GenLocated SrcSpanAnnA (DefaultDecl GhcRn), TyCon, [Type])
</span><a href="#local-6989586621683082227"><span class="hs-identifier hs-var">decls</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>        </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [ClassDefaults]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [ClassDefaults]
forall a b.
IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[ClassDefaults] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [ClassDefaults]
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="annot"><a href="GHC.Tc.Gen.Default.html#tc_default_ty"><span class="hs-identifier hs-type">tc_default_ty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-201"></span><span id="tc_default_ty"><span class="annot"><span class="annottext">tc_default_ty :: LHsType GhcRn -&gt; TcRn Type
</span><a href="GHC.Tc.Gen.Default.html#tc_default_ty"><span class="hs-identifier hs-var hs-var">tc_default_ty</span></a></span></span><span> </span><span id="local-6989586621683082231"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683082231"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span>
</span><span id="line-202"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>   </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683082232"><span class="annot"><a href="#local-6989586621683082232"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; TcRn Type -&gt; TcRn Type
forall a. String -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Solver.html#solveEqualities"><span class="hs-identifier hs-var">solveEqualities</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc_default_ty&quot;</span></span><span> </span><span class="annot"><span class="annottext">(TcRn Type -&gt; TcRn Type) -&gt; TcRn Type -&gt; TcRn Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-203"></span><span>                </span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; TcRn Type
</span><a href="GHC.Tc.Gen.HsType.html#tcInferLHsType"><span class="hs-identifier hs-var">tcInferLHsType</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683082231"><span class="hs-identifier hs-var">hs_ty</span></a></span><span>
</span><span id="line-204"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683082235"><span class="annot"><a href="#local-6989586621683082235"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Type.html#zonkTcTypeToType"><span class="hs-identifier hs-type">zonkTcTypeToType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683082232"><span class="hs-identifier hs-type">ty</span></a></span><span>   </span><span class="hs-comment">-- establish Type invariants</span><span>
</span><span id="line-205"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Validity.html#checkValidType"><span class="hs-identifier hs-type">checkValidType</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#DefaultDeclCtxt"><span class="hs-identifier hs-type">DefaultDeclCtxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683082235"><span class="hs-identifier hs-type">ty</span></a></span><span>
</span><span id="line-206"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683082235"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span class="hs-comment">-- Check that the type is an instance of at least one of the default classes.</span><span>
</span><span id="line-209"></span><span class="hs-comment">-- Beside the class type constructor, we take the already-supplied type</span><span>
</span><span id="line-210"></span><span class="hs-comment">-- parameters and the expected kinds of the remaining parameters. We report</span><span>
</span><span id="line-211"></span><span class="hs-comment">-- an error unless there's only one remaining parameter to fill and the given</span><span>
</span><span id="line-212"></span><span class="hs-comment">-- type has the expected kind.</span><span>
</span><span id="line-213"></span><span class="annot"><a href="GHC.Tc.Gen.Default.html#check_instance_any"><span class="hs-identifier hs-type">check_instance_any</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span id="check_instance_any"><span class="annot"><span class="annottext">check_instance_any :: [(TyCon, [Type], [Type])]
-&gt; Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Gen.Default.html#check_instance_any"><span class="hs-identifier hs-var hs-var">check_instance_any</span></a></span></span><span> </span><span id="local-6989586621683082239"><span class="annot"><span class="annottext">[(TyCon, [Type], [Type])]
</span><a href="#local-6989586621683082239"><span class="hs-identifier hs-var">deflt_clss</span></a></span></span><span> </span><span id="local-6989586621683082240"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683082240"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-215"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>   </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683082241"><span class="annot"><a href="#local-6989586621683082241"><span class="hs-identifier hs-var">oks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((TyCon, [Type], [Type]) -&gt; TcRnIf TcGblEnv TcLclEnv Bool)
-&gt; [(TyCon, [Type], [Type])]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [Bool]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; (TyCon, [Type], [Type]) -&gt; TcRnIf TcGblEnv TcLclEnv Bool
</span><a href="GHC.Tc.Gen.Default.html#check_instance"><span class="hs-identifier hs-var">check_instance</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683082240"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(TyCon, [Type], [Type])]
</span><a href="#local-6989586621683082239"><span class="hs-identifier hs-var">deflt_clss</span></a></span><span>
</span><span id="line-216"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-type">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">or</span></span><span> </span><span class="annot"><a href="#local-6989586621683082241"><span class="hs-identifier hs-type">oks</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnBadDefaultType"><span class="hs-identifier hs-type">TcRnBadDefaultType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683082240"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#fstOf3"><span class="hs-identifier hs-type">fstOf3</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683082239"><span class="hs-identifier hs-type">deflt_clss</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span class="annot"><a href="GHC.Tc.Gen.Default.html#check_instance"><span class="hs-identifier hs-type">check_instance</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-220"></span><span class="hs-comment">-- Check that ty is an instance of cls</span><span>
</span><span id="line-221"></span><span class="hs-comment">-- We only care about whether it worked or not; return a boolean</span><span>
</span><span id="line-222"></span><span class="hs-comment">-- This checks that  cls :: k -&gt; Constraint</span><span>
</span><span id="line-223"></span><span class="hs-comment">-- with just one argument and no polymorphism; if we need to add</span><span>
</span><span id="line-224"></span><span class="hs-comment">-- polymorphism we can make it more complicated.  For now we are</span><span>
</span><span id="line-225"></span><span class="hs-comment">-- concerned with classes like</span><span>
</span><span id="line-226"></span><span class="hs-comment">--    Num      :: Type -&gt; Constraint</span><span>
</span><span id="line-227"></span><span class="hs-comment">--    Foldable :: (Type-&gt;Type) -&gt; Constraint</span><span>
</span><span id="line-228"></span><span id="check_instance"><span class="annot"><span class="annottext">check_instance :: Type -&gt; (TyCon, [Type], [Type]) -&gt; TcRnIf TcGblEnv TcLclEnv Bool
</span><a href="GHC.Tc.Gen.Default.html#check_instance"><span class="hs-identifier hs-var hs-var">check_instance</span></a></span></span><span> </span><span id="local-6989586621683082246"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683082246"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683082247"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683082247"><span class="hs-identifier hs-var">clsTyCon</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683082248"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683082248"><span class="hs-identifier hs-var">clsArgs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621683082249"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683082249"><span class="hs-identifier hs-var">cls_argKind</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683082249"><span class="hs-identifier hs-var">cls_argKind</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#tcEqType"><span class="hs-operator hs-var">`tcEqType`</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683082246"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-230"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcRnIf TcGblEnv TcLclEnv Bool
</span><a href="GHC.Tc.Solver.html#simplifyDefault"><span class="hs-identifier hs-var">simplifyDefault</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683082247"><span class="hs-identifier hs-var">clsTyCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683082248"><span class="hs-identifier hs-var">clsArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; [Type]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683082246"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-231"></span><span class="annot"><a href="GHC.Tc.Gen.Default.html#check_instance"><span class="hs-identifier hs-var">check_instance</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">(TyCon, [Type], [Type])
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-232"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span class="annot"><a href="GHC.Tc.Gen.Default.html#defaultDeclCtxt"><span class="hs-identifier hs-type">defaultDeclCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-235"></span><span id="defaultDeclCtxt"><span class="annot"><span class="annottext">defaultDeclCtxt :: SDoc
</span><a href="GHC.Tc.Gen.Default.html#defaultDeclCtxt"><span class="hs-identifier hs-var hs-var">defaultDeclCtxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;When checking the types in a default declaration&quot;</span></span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span class="annot"><a href="GHC.Tc.Gen.Default.html#dupDefaultDeclErr"><span class="hs-identifier hs-type">dupDefaultDeclErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#LDefaultDecl"><span class="hs-identifier hs-type">LDefaultDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span>
</span><span id="line-238"></span><span id="dupDefaultDeclErr"><span class="annot"><span class="annottext">dupDefaultDeclErr :: TyCon -&gt; NonEmpty (LDefaultDecl GhcRn) -&gt; TcRnMessage
</span><a href="GHC.Tc.Gen.Default.html#dupDefaultDeclErr"><span class="hs-identifier hs-var hs-var">dupDefaultDeclErr</span></a></span></span><span> </span><span id="local-6989586621683082254"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683082254"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#DefaultDecl"><span class="hs-identifier hs-type">DefaultDecl</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span id="local-6989586621683082255"><span class="annot"><span class="annottext">[LDefaultDecl GhcRn]
</span><a href="#local-6989586621683082255"><span class="hs-identifier hs-var">dup_things</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [LDefaultDecl GhcRn] -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnMultipleDefaultDeclarations"><span class="hs-identifier hs-var">TcRnMultipleDefaultDeclarations</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683082254"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[LDefaultDecl GhcRn]
</span><a href="#local-6989586621683082255"><span class="hs-identifier hs-var">dup_things</span></a></span><span>
</span><span id="line-240"></span></pre></body></html>