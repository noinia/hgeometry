<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE RecordWildCards   #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-orphans #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-comment">{-
(c) The University of Glasgow 2006

-}</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-comment">-- | Functions for working with the typechecker environment (setters,</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- getters...).</span><span>
</span><span id="line-12"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span class="hs-special">(</span><span>
</span><span id="line-13"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Initialisation</span></span><span>
</span><span id="line-14"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initTc"><span class="hs-identifier">initTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initTcWithGbl"><span class="hs-identifier">initTcWithGbl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initTcInteractive"><span class="hs-identifier">initTcInteractive</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initTcRnIf"><span class="hs-identifier">initTcRnIf</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Simple accessors</span></span><span>
</span><span id="line-17"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#discardResult"><span class="hs-identifier">discardResult</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier">getTopEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updTopEnv"><span class="hs-identifier">updTopEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier">getGblEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updGblEnv"><span class="hs-identifier">updGblEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setGblEnv"><span class="hs-identifier">setGblEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier">getLclEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier">updLclEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updLclCtxt"><span class="hs-identifier">updLclCtxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setLclEnv"><span class="hs-identifier">setLclEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#restoreLclEnv"><span class="hs-identifier">restoreLclEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updTopFlags"><span class="hs-identifier">updTopFlags</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getEnvs"><span class="hs-identifier">getEnvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setEnvs"><span class="hs-identifier">setEnvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updEnvs"><span class="hs-identifier">updEnvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#restoreEnvs"><span class="hs-identifier">restoreEnvs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier">xoptM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#doptM"><span class="hs-identifier">doptM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#goptM"><span class="hs-identifier">goptM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#woptM"><span class="hs-identifier">woptM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setXOptM"><span class="hs-identifier">setXOptM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#unsetXOptM"><span class="hs-identifier">unsetXOptM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#unsetGOptM"><span class="hs-identifier">unsetGOptM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#unsetWOptM"><span class="hs-identifier">unsetWOptM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#whenDOptM"><span class="hs-identifier">whenDOptM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#whenGOptM"><span class="hs-identifier">whenGOptM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#whenWOptM"><span class="hs-identifier">whenWOptM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#whenXOptM"><span class="hs-identifier">whenXOptM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#unlessXOptM"><span class="hs-identifier">unlessXOptM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getGhcMode"><span class="hs-identifier">getGhcMode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#withoutDynamicNow"><span class="hs-identifier">withoutDynamicNow</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getEpsVar"><span class="hs-identifier">getEpsVar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getEps"><span class="hs-identifier">getEps</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updateEps"><span class="hs-identifier">updateEps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updateEps_"><span class="hs-identifier">updateEps_</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getHpt"><span class="hs-identifier">getHpt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getEpsAndHug"><span class="hs-identifier">getEpsAndHug</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Arrow scopes</span></span><span>
</span><span id="line-34"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newArrowScope"><span class="hs-identifier">newArrowScope</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#escapeArrowScope"><span class="hs-identifier">escapeArrowScope</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Unique supply</span></span><span>
</span><span id="line-37"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier">newUnique</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newUniqueSupply"><span class="hs-identifier">newUniqueSupply</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newName"><span class="hs-identifier">newName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newNameAt"><span class="hs-identifier">newNameAt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#cloneLocalName"><span class="hs-identifier">cloneLocalName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newSysName"><span class="hs-identifier">newSysName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newSysLocalId"><span class="hs-identifier">newSysLocalId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newSysLocalIds"><span class="hs-identifier">newSysLocalIds</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Accessing input/output</span></span><span>
</span><span id="line-41"></span><span>  </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#newTcRef"><span class="hs-identifier">newTcRef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier">readTcRef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#writeTcRef"><span class="hs-identifier">writeTcRef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#updTcRef"><span class="hs-identifier">updTcRef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#updTcRefM"><span class="hs-identifier">updTcRefM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Debugging</span></span><span>
</span><span id="line-44"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier">traceTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier">traceRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceOptTcRn"><span class="hs-identifier">traceOptTcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#dumpOptTcRn"><span class="hs-identifier">dumpOptTcRn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#dumpTcRn"><span class="hs-identifier">dumpTcRn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getNamePprCtx"><span class="hs-identifier">getNamePprCtx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#printForUserTcRn"><span class="hs-identifier">printForUserTcRn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceIf"><span class="hs-identifier">traceIf</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceOptIf"><span class="hs-identifier">traceOptIf</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#debugTc"><span class="hs-identifier">debugTc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Typechecker global environment</span></span><span>
</span><span id="line-52"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getIsGHCi"><span class="hs-identifier">getIsGHCi</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getGHCiMonad"><span class="hs-identifier">getGHCiMonad</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getInteractivePrintName"><span class="hs-identifier">getInteractivePrintName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcHscSource"><span class="hs-identifier">tcHscSource</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcIsHsBootOrSig"><span class="hs-identifier">tcIsHsBootOrSig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcIsHsig"><span class="hs-identifier">tcIsHsig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcSelfBootInfo"><span class="hs-identifier">tcSelfBootInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getGlobalRdrEnv"><span class="hs-identifier">getGlobalRdrEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getRdrEnvs"><span class="hs-identifier">getRdrEnvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getImports"><span class="hs-identifier">getImports</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getFixityEnv"><span class="hs-identifier">getFixityEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#extendFixityEnv"><span class="hs-identifier">extendFixityEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getDeclaredDefaultTys"><span class="hs-identifier">getDeclaredDefaultTys</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addDependentFiles"><span class="hs-identifier">addDependentFiles</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Error management</span></span><span>
</span><span id="line-60"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier">getSrcSpanM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier">setSrcSpan</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier">setSrcSpanA</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addLocM"><span class="hs-identifier">addLocM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#inGeneratedCode"><span class="hs-identifier">inGeneratedCode</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setInGeneratedCode"><span class="hs-identifier">setInGeneratedCode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-62"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#wrapLocM"><span class="hs-identifier">wrapLocM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#wrapLocFstM"><span class="hs-identifier">wrapLocFstM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#wrapLocFstMA"><span class="hs-identifier">wrapLocFstMA</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#wrapLocSndM"><span class="hs-identifier">wrapLocSndM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#wrapLocSndMA"><span class="hs-identifier">wrapLocSndMA</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#wrapLocM_"><span class="hs-identifier">wrapLocM_</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-63"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#wrapLocMA_"><span class="hs-identifier">wrapLocMA_</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#wrapLocMA"><span class="hs-identifier">wrapLocMA</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getErrsVar"><span class="hs-identifier">getErrsVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setErrsVar"><span class="hs-identifier">setErrsVar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier">addErr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failWith"><span class="hs-identifier">failWith</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failAt"><span class="hs-identifier">failAt</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrAt"><span class="hs-identifier">addErrAt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrs"><span class="hs-identifier">addErrs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#checkErr"><span class="hs-identifier">checkErr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#checkErrAt"><span class="hs-identifier">checkErrAt</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addMessages"><span class="hs-identifier">addMessages</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#discardWarnings"><span class="hs-identifier">discardWarnings</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mkDetailedMessage"><span class="hs-identifier">mkDetailedMessage</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Usage environment</span></span><span>
</span><span id="line-73"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcCollectingUsage"><span class="hs-identifier">tcCollectingUsage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier">tcScalingUsage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcEmitBindingUsage"><span class="hs-identifier">tcEmitBindingUsage</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Shared error message stuff: renamer and typechecker</span></span><span>
</span><span id="line-76"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#recoverM"><span class="hs-identifier">recoverM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mapAndRecoverM"><span class="hs-identifier">mapAndRecoverM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mapAndReportM"><span class="hs-identifier">mapAndReportM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#foldAndRecoverM"><span class="hs-identifier">foldAndRecoverM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#attemptM"><span class="hs-identifier">attemptM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tryTc"><span class="hs-identifier">tryTc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-78"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#askNoErrs"><span class="hs-identifier">askNoErrs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#discardErrs"><span class="hs-identifier">discardErrs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tryTcDiscardingErrs"><span class="hs-identifier">tryTcDiscardingErrs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-79"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#checkNoErrs"><span class="hs-identifier">checkNoErrs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#whenNoErrs"><span class="hs-identifier">whenNoErrs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-80"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#ifErrsM"><span class="hs-identifier">ifErrsM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failIfErrsM"><span class="hs-identifier">failIfErrsM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Context management for the type checker</span></span><span>
</span><span id="line-83"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getErrCtxt"><span class="hs-identifier">getErrCtxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setErrCtxt"><span class="hs-identifier">setErrCtxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier">addErrCtxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrCtxtM"><span class="hs-identifier">addErrCtxtM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addLandmarkErrCtxt"><span class="hs-identifier">addLandmarkErrCtxt</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-84"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addLandmarkErrCtxtM"><span class="hs-identifier">addLandmarkErrCtxtM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#popErrCtxt"><span class="hs-identifier">popErrCtxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getCtLocM"><span class="hs-identifier">getCtLocM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setCtLocM"><span class="hs-identifier">setCtLocM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mkCtLocEnv"><span class="hs-identifier">mkCtLocEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Diagnostic message generation (type checker)</span></span><span>
</span><span id="line-87"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier">addErrTc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-88"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrTcM"><span class="hs-identifier">addErrTcM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-89"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier">failWithTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failWithTcM"><span class="hs-identifier">failWithTcM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-90"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier">checkTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#checkTcM"><span class="hs-identifier">checkTcM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-91"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failIfTc"><span class="hs-identifier">failIfTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failIfTcM"><span class="hs-identifier">failIfTcM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-92"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mkErrInfo"><span class="hs-identifier">mkErrInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-93"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addTcRnDiagnostic"><span class="hs-identifier">addTcRnDiagnostic</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addDetailedDiagnostic"><span class="hs-identifier">addDetailedDiagnostic</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-94"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mkTcRnMessage"><span class="hs-identifier">mkTcRnMessage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#reportDiagnostic"><span class="hs-identifier">reportDiagnostic</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#reportDiagnostics"><span class="hs-identifier">reportDiagnostics</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-95"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#warnIf"><span class="hs-identifier">warnIf</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#diagnosticTc"><span class="hs-identifier">diagnosticTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#diagnosticTcM"><span class="hs-identifier">diagnosticTcM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-96"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addDiagnosticTc"><span class="hs-identifier">addDiagnosticTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addDiagnosticTcM"><span class="hs-identifier">addDiagnosticTcM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addDiagnostic"><span class="hs-identifier">addDiagnostic</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addDiagnosticAt"><span class="hs-identifier">addDiagnosticAt</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Type constraints</span></span><span>
</span><span id="line-99"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newTcEvBinds"><span class="hs-identifier">newTcEvBinds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newNoTcEvBinds"><span class="hs-identifier">newNoTcEvBinds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#cloneEvBindsVar"><span class="hs-identifier">cloneEvBindsVar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-100"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addTcEvBind"><span class="hs-identifier">addTcEvBind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addTopEvBinds"><span class="hs-identifier">addTopEvBinds</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-101"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getTcEvTyCoVars"><span class="hs-identifier">getTcEvTyCoVars</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getTcEvBindsMap"><span class="hs-identifier">getTcEvBindsMap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setTcEvBindsMap"><span class="hs-identifier">setTcEvBindsMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-102"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#chooseUniqueOccTc"><span class="hs-identifier">chooseUniqueOccTc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-103"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getConstraintVar"><span class="hs-identifier">getConstraintVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setConstraintVar"><span class="hs-identifier">setConstraintVar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-104"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitConstraints"><span class="hs-identifier">emitConstraints</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitStaticConstraints"><span class="hs-identifier">emitStaticConstraints</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitSimple"><span class="hs-identifier">emitSimple</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitSimples"><span class="hs-identifier">emitSimples</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-105"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitImplication"><span class="hs-identifier">emitImplication</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitImplications"><span class="hs-identifier">emitImplications</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-106"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitDelayedErrors"><span class="hs-identifier">emitDelayedErrors</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitHole"><span class="hs-identifier">emitHole</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitHoles"><span class="hs-identifier">emitHoles</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitNotConcreteError"><span class="hs-identifier">emitNotConcreteError</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-107"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#discardConstraints"><span class="hs-identifier">discardConstraints</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#captureConstraints"><span class="hs-identifier">captureConstraints</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tryCaptureConstraints"><span class="hs-identifier">tryCaptureConstraints</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-108"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#pushLevelAndCaptureConstraints"><span class="hs-identifier">pushLevelAndCaptureConstraints</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-109"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#pushTcLevelM_"><span class="hs-identifier">pushTcLevelM_</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#pushTcLevelM"><span class="hs-identifier">pushTcLevelM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-110"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getTcLevel"><span class="hs-identifier">getTcLevel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setTcLevel"><span class="hs-identifier">setTcLevel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#isTouchableTcM"><span class="hs-identifier">isTouchableTcM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-111"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getLclTypeEnv"><span class="hs-identifier">getLclTypeEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setLclTypeEnv"><span class="hs-identifier">setLclTypeEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-112"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTcConstraints"><span class="hs-identifier">traceTcConstraints</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-113"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitNamedTypeHole"><span class="hs-identifier">emitNamedTypeHole</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#IsExtraConstraint"><span class="hs-identifier">IsExtraConstraint</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitAnonTypeHole"><span class="hs-identifier">emitAnonTypeHole</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Template Haskell context</span></span><span>
</span><span id="line-116"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#recordThUse"><span class="hs-identifier">recordThUse</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#recordThSpliceUse"><span class="hs-identifier">recordThSpliceUse</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#recordThNeededRuntimeDeps"><span class="hs-identifier">recordThNeededRuntimeDeps</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-117"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#keepAlive"><span class="hs-identifier">keepAlive</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getStage"><span class="hs-identifier">getStage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getStageAndBindLevel"><span class="hs-identifier">getStageAndBindLevel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setStage"><span class="hs-identifier">setStage</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-118"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addModFinalizersWithLclEnv"><span class="hs-identifier">addModFinalizersWithLclEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Safe Haskell context</span></span><span>
</span><span id="line-121"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#recordUnsafeInfer"><span class="hs-identifier">recordUnsafeInfer</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#finalSafeMode"><span class="hs-identifier">finalSafeMode</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#fixSafeInstances"><span class="hs-identifier">fixSafeInstances</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Stuff for the renamer's local env</span></span><span>
</span><span id="line-124"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getLocalRdrEnv"><span class="hs-identifier">getLocalRdrEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setLocalRdrEnv"><span class="hs-identifier">setLocalRdrEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Stuff for interface decls</span></span><span>
</span><span id="line-127"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mkIfLclEnv"><span class="hs-identifier">mkIfLclEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-128"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initIfaceTcRn"><span class="hs-identifier">initIfaceTcRn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-129"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initIfaceCheck"><span class="hs-identifier">initIfaceCheck</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-130"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initIfaceLcl"><span class="hs-identifier">initIfaceLcl</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-131"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initIfaceLclWithSubst"><span class="hs-identifier">initIfaceLclWithSubst</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-132"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initIfaceLoad"><span class="hs-identifier">initIfaceLoad</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-133"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initIfaceLoadModule"><span class="hs-identifier">initIfaceLoadModule</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-134"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getIfModule"><span class="hs-identifier">getIfModule</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-135"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failIfM"><span class="hs-identifier">failIfM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-136"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#forkM"><span class="hs-identifier">forkM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-137"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setImplicitEnvM"><span class="hs-identifier">setImplicitEnvM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#withException"><span class="hs-identifier">withException</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#withIfaceErr"><span class="hs-identifier">withIfaceErr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Stuff for cost centres.</span></span><span>
</span><span id="line-142"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getCCIndexM"><span class="hs-identifier">getCCIndexM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getCCIndexTcM"><span class="hs-identifier">getCCIndexTcM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Zonking</span></span><span>
</span><span id="line-145"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier">liftZonkM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newZonkAnyType"><span class="hs-identifier">newZonkAnyType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Complete matches</span></span><span>
</span><span id="line-148"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#localAndImportedCompleteMatches"><span class="hs-identifier">localAndImportedCompleteMatches</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getCompleteMatchesTcM"><span class="hs-identifier">getCompleteMatchesTcM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Types etc.</span></span><span>
</span><span id="line-151"></span><span>  </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html"><span class="hs-identifier">GHC.Tc.Types</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Data.IOEnv.html"><span class="hs-identifier">GHC.Data.IOEnv</span></a></span><span>
</span><span id="line-153"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span>
</span><span id="line-159"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html"><span class="hs-identifier">GHC.Builtin.Types</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#zonkAnyTyCon"><span class="hs-identifier">zonkAnyTyCon</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html"><span class="hs-identifier">GHC.Tc.Errors.Types</span></a></span><span>
</span><span id="line-162"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html"><span class="hs-identifier">GHC.Tc.Types</span></a></span><span>     </span><span class="hs-comment">-- Re-export all</span><span>
</span><span id="line-163"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html"><span class="hs-identifier">GHC.Tc.Types.Constraint</span></a></span><span>
</span><span id="line-164"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html"><span class="hs-identifier">GHC.Tc.Types.CtLoc</span></a></span><span>
</span><span id="line-165"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html"><span class="hs-identifier">GHC.Tc.Types.Evidence</span></a></span><span>
</span><span id="line-166"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html"><span class="hs-identifier">GHC.Tc.Types.Origin</span></a></span><span>
</span><span id="line-167"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html"><span class="hs-identifier">GHC.Tc.Types.TcRef</span></a></span><span>
</span><span id="line-168"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></a></span><span>
</span><span id="line-169"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html"><span class="hs-identifier">GHC.Tc.Zonk.TcType</span></a></span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.html"><span class="hs-identifier">GHC.Hs</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#LIE"><span class="hs-identifier">LIE</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.html"><span class="hs-identifier">GHC.Unit</span></a></span><span>
</span><span id="line-174"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html"><span class="hs-identifier">GHC.Unit.Env</span></a></span><span>
</span><span id="line-175"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.External.html"><span class="hs-identifier">GHC.Unit.External</span></a></span><span>
</span><span id="line-176"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Warnings.html"><span class="hs-identifier">GHC.Unit.Module.Warnings</span></a></span><span>
</span><span id="line-177"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html"><span class="hs-identifier">GHC.Unit.Home.ModInfo</span></a></span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.UsageEnv.html"><span class="hs-identifier">GHC.Core.UsageEnv</span></a></span><span>
</span><span id="line-180"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Multiplicity.html"><span class="hs-identifier">GHC.Core.Multiplicity</span></a></span><span>
</span><span id="line-181"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html"><span class="hs-identifier">GHC.Core.InstEnv</span></a></span><span>
</span><span id="line-182"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html"><span class="hs-identifier">GHC.Core.FamInstEnv</span></a></span><span>
</span><span id="line-183"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Type.html#mkNumLitTy"><span class="hs-identifier">mkNumLitTy</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html"><span class="hs-identifier">GHC.Driver.Env</span></a></span><span>
</span><span id="line-186"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html"><span class="hs-identifier">GHC.Driver.Session</span></a></span><span>
</span><span id="line-187"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Diagnostic.html"><span class="hs-identifier">GHC.Driver.Config.Diagnostic</span></a></span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html"><span class="hs-identifier">GHC.Runtime.Context</span></a></span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.IOEnv.html"><span class="hs-identifier">GHC.Data.IOEnv</span></a></span><span> </span><span class="hs-comment">-- Re-export all</span><span>
</span><span id="line-192"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html"><span class="hs-identifier">GHC.Data.Bag</span></a></span><span>
</span><span id="line-193"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-194"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Outputable</span></span><span>
</span><span id="line-197"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html"><span class="hs-identifier">GHC.Utils.Error</span></a></span><span>
</span><span id="line-198"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-199"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Constants.html"><span class="hs-identifier">GHC.Utils.Constants</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Constants.html#debugIsOn"><span class="hs-identifier">debugIsOn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-200"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html"><span class="hs-identifier">GHC.Utils.Logger</span></a></span><span>
</span><span id="line-201"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Data.Strict.html"><span class="hs-identifier">GHC.Data.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Strict</span></span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Error.html"><span class="hs-identifier">GHC.Types.Error</span></a></span><span>
</span><span id="line-204"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.DefaultEnv.html"><span class="hs-identifier">GHC.Types.DefaultEnv</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.DefaultEnv.html#DefaultEnv"><span class="hs-identifier">DefaultEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.DefaultEnv.html#emptyDefaultEnv"><span class="hs-identifier">emptyDefaultEnv</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Fixity.Env.html"><span class="hs-identifier">GHC.Types.Fixity.Env</span></a></span><span>
</span><span id="line-206"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html"><span class="hs-identifier">GHC.Types.Name.Reader</span></a></span><span>
</span><span id="line-207"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-208"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SafeHaskell.html"><span class="hs-identifier">GHC.Types.SafeHaskell</span></a></span><span>
</span><span id="line-209"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-210"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.TypeEnv.html"><span class="hs-identifier">GHC.Types.TypeEnv</span></a></span><span>
</span><span id="line-211"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html"><span class="hs-identifier">GHC.Types.Var.Set</span></a></span><span>
</span><span id="line-212"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html"><span class="hs-identifier">GHC.Types.Var.Env</span></a></span><span>
</span><span id="line-213"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-214"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html"><span class="hs-identifier">GHC.Types.Name.Env</span></a></span><span>
</span><span id="line-215"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html"><span class="hs-identifier">GHC.Types.Name.Set</span></a></span><span>
</span><span id="line-216"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Ppr.html"><span class="hs-identifier">GHC.Types.Name.Ppr</span></a></span><span>
</span><span id="line-217"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html"><span class="hs-identifier">GHC.Types.Unique.FM</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html#emptyUFM"><span class="hs-identifier">emptyUFM</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html"><span class="hs-identifier">GHC.Types.Unique.Supply</span></a></span><span>
</span><span id="line-219"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Annotations.html"><span class="hs-identifier">GHC.Types.Annotations</span></a></span><span>
</span><span id="line-220"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TopLevelFlag"><span class="hs-identifier">TopLevelFlag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TypeOrKind"><span class="hs-identifier">TypeOrKind</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-221"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.State.html"><span class="hs-identifier">GHC.Types.CostCentre.State</span></a></span><span>
</span><span id="line-222"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SourceFile.html"><span class="hs-identifier">GHC.Types.SourceFile</span></a></span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../ghc-boot-9.12.2-1a37/src/GHC.LanguageExtensions.html"><span class="hs-identifier">GHC.LanguageExtensions</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LangExt</span></span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.IORef.html"><span class="hs-identifier">Data.IORef</span></a></span><span>
</span><span id="line-227"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.html"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-230"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Env.KnotVars.html"><span class="hs-identifier">GHC.Driver.Env.KnotVars</span></a></span><span>
</span><span id="line-231"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Linker.Types.html"><span class="hs-identifier">GHC.Linker.Types</span></a></span><span>
</span><span id="line-232"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DFM.html"><span class="hs-identifier">GHC.Types.Unique.DFM</span></a></span><span>
</span><span id="line-233"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Errors.Types.html"><span class="hs-identifier">GHC.Iface.Errors.Types</span></a></span><span>
</span><span id="line-234"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Errors.Ppr.html"><span class="hs-identifier">GHC.Iface.Errors.Ppr</span></a></span><span>
</span><span id="line-235"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html"><span class="hs-identifier">GHC.Tc.Types.LclEnv</span></a></span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                        initTc
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span class="annot"><span class="hs-comment">-- | Setup the initial typechecking environment</span></span><span>
</span><span id="line-246"></span><span id="local-6989586621682982929"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initTc"><span class="hs-identifier hs-type">initTc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-247"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SourceFile.html#HscSource"><span class="hs-identifier hs-type">HscSource</span></a></span><span>
</span><span id="line-248"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>          </span><span class="hs-comment">-- True &lt;=&gt; retain renamed syntax trees</span><span>
</span><span id="line-249"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-250"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#RealSrcSpan"><span class="hs-identifier hs-type">RealSrcSpan</span></a></span><span>
</span><span id="line-251"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682982929"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-252"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621682982929"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-253"></span><span>                </span><span class="hs-comment">-- Nothing =&gt; error thrown by the thing inside</span><span>
</span><span id="line-254"></span><span>                </span><span class="hs-comment">-- (error messages should have been printed already)</span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span id="initTc"><span class="annot"><span class="annottext">initTc :: forall r.
HscEnv
-&gt; HscSource
-&gt; Bool
-&gt; Module
-&gt; RealSrcSpan
-&gt; TcM r
-&gt; IO (Messages TcRnMessage, Maybe r)
</span><a href="GHC.Tc.Utils.Monad.html#initTc"><span class="hs-identifier hs-var hs-var">initTc</span></a></span></span><span> </span><span id="local-6989586621682984206"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682984206"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682984207"><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621682984207"><span class="hs-identifier hs-var">hsc_src</span></a></span></span><span> </span><span id="local-6989586621682984208"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682984208"><span class="hs-identifier hs-var">keep_rn_syntax</span></a></span></span><span> </span><span id="local-6989586621682984209"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682984209"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span id="local-6989586621682984210"><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621682984210"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682984211"><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682984211"><span class="hs-identifier hs-var">do_this</span></a></span></span><span>
</span><span id="line-257"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984212"><span class="annot"><a href="#local-6989586621682984212"><span class="hs-identifier hs-var">keep_var</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NameSet -&gt; IO (IORef NameSet)
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="annot"><span class="annottext">NameSet
</span><a href="GHC.Types.Name.Set.html#emptyNameSet"><span class="hs-identifier hs-var">emptyNameSet</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-258"></span><span>        </span><span id="local-6989586621682984215"><span class="annot"><a href="#local-6989586621682984215"><span class="hs-identifier hs-var">used_gre_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newIORef</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-259"></span><span>        </span><span id="local-6989586621682984216"><span class="annot"><a href="#local-6989586621682984216"><span class="hs-identifier hs-var">th_var</span></a></span></span><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newIORef</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-260"></span><span>        </span><span id="local-6989586621682984217"><span class="annot"><a href="#local-6989586621682984217"><span class="hs-identifier hs-var">th_splice_var</span></a></span></span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newIORef</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-261"></span><span>        </span><span id="local-6989586621682984218"><span class="annot"><a href="#local-6989586621682984218"><span class="hs-identifier hs-var">infer_var</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newIORef</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-262"></span><span>        </span><span id="local-6989586621682984219"><span class="annot"><a href="#local-6989586621682984219"><span class="hs-identifier hs-var">infer_reasons_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newIORef</span></span><span> </span><span class="annot"><a href="GHC.Types.Error.html#emptyMessages"><span class="hs-identifier hs-type">emptyMessages</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-263"></span><span>        </span><span id="local-6989586621682984221"><span class="annot"><a href="#local-6989586621682984221"><span class="hs-identifier hs-var">dfun_n_var</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newIORef</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#emptyOccSet"><span class="hs-identifier hs-type">emptyOccSet</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-264"></span><span>        </span><span id="local-6989586621682984223"><span class="annot"><a href="#local-6989586621682984223"><span class="hs-identifier hs-var">zany_n_var</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newIORef</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-265"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984224"><span class="annot"><a href="#local-6989586621682984224"><span class="hs-identifier hs-var hs-var">type_env_var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; KnotVars (IORef TypeEnv)
</span><a href="GHC.Driver.Env.Types.html#hsc_type_env_vars"><span class="hs-identifier hs-var">hsc_type_env_vars</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682984206"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">;</span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span>        </span><span id="local-6989586621682984226"><span class="annot"><a href="#local-6989586621682984226"><span class="hs-identifier hs-var">dependent_files_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newIORef</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-268"></span><span>        </span><span id="local-6989586621682984227"><span class="annot"><a href="#local-6989586621682984227"><span class="hs-identifier hs-var">static_wc_var</span></a></span></span><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newIORef</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#emptyWC"><span class="hs-identifier hs-type">emptyWC</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-269"></span><span>        </span><span id="local-6989586621682984229"><span class="annot"><a href="#local-6989586621682984229"><span class="hs-identifier hs-var">cc_st_var</span></a></span></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newIORef</span></span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.State.html#newCostCentreState"><span class="hs-identifier hs-type">newCostCentreState</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-270"></span><span>        </span><span id="local-6989586621682984231"><span class="annot"><a href="#local-6989586621682984231"><span class="hs-identifier hs-var">th_topdecls_var</span></a></span></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newIORef</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-271"></span><span>        </span><span id="local-6989586621682984232"><span class="annot"><a href="#local-6989586621682984232"><span class="hs-identifier hs-var">th_foreign_files_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newIORef</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-272"></span><span>        </span><span id="local-6989586621682984233"><span class="annot"><a href="#local-6989586621682984233"><span class="hs-identifier hs-var">th_topnames_var</span></a></span></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newIORef</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#emptyNameSet"><span class="hs-identifier hs-type">emptyNameSet</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-273"></span><span>        </span><span id="local-6989586621682984234"><span class="annot"><a href="#local-6989586621682984234"><span class="hs-identifier hs-var">th_modfinalizers_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newIORef</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-274"></span><span>        </span><span id="local-6989586621682984235"><span class="annot"><a href="#local-6989586621682984235"><span class="hs-identifier hs-var">th_coreplugins_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newIORef</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-275"></span><span>        </span><span id="local-6989586621682984236"><span class="annot"><a href="#local-6989586621682984236"><span class="hs-identifier hs-var">th_state_var</span></a></span></span><span>         </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newIORef</span></span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-type">Map.empty</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-276"></span><span>        </span><span id="local-6989586621682984238"><span class="annot"><a href="#local-6989586621682984238"><span class="hs-identifier hs-var">th_remote_state_var</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newIORef</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-277"></span><span>        </span><span id="local-6989586621682984239"><span class="annot"><a href="#local-6989586621682984239"><span class="hs-identifier hs-var">th_docs_var</span></a></span></span><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newIORef</span></span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-type">Map.empty</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-278"></span><span>        </span><span id="local-6989586621682984240"><span class="annot"><a href="#local-6989586621682984240"><span class="hs-identifier hs-var">th_needed_deps_var</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newIORef</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DFM.html#emptyUDFM"><span class="hs-identifier hs-type">emptyUDFM</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-279"></span><span>        </span><span id="local-6989586621682984242"><span class="annot"><a href="#local-6989586621682984242"><span class="hs-identifier hs-var">next_wrapper_num</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newIORef</span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Env.html#emptyModuleEnv"><span class="hs-identifier hs-type">emptyModuleEnv</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-280"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-281"></span><span>             </span><span class="hs-comment">-- bangs to avoid leaking the env (#19356)</span><span>
</span><span id="line-282"></span><span>             </span><span class="hs-glyph">!</span><span id="local-6989586621682984244"><span class="annot"><a href="#local-6989586621682984244"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682984206"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-283"></span><span>             </span><span class="hs-glyph">!</span><span id="local-6989586621682984246"><span class="annot"><a href="#local-6989586621682984246"><span class="hs-identifier hs-var hs-var">mhome_unit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Maybe HomeUnit
</span><a href="GHC.Driver.Env.html#hsc_home_unit_maybe"><span class="hs-identifier hs-var">hsc_home_unit_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682984206"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">;</span><span>
</span><span id="line-284"></span><span>             </span><span class="hs-glyph">!</span><span id="local-6989586621682984248"><span class="annot"><a href="#local-6989586621682984248"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682984206"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span>             </span><span class="annot"><a href="#local-6989586621682984250"><span class="hs-identifier hs-type">maybe_rn_syntax</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682982973"><span class="annot"><a href="#local-6989586621682982973"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621682982973"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621682982973"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-287"></span><span>             </span><span id="local-6989586621682984250"><span class="annot"><a href="#local-6989586621682984250"><span class="hs-identifier hs-var hs-var">maybe_rn_syntax</span></a></span></span><span> </span><span id="local-6989586621682984251"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682984251"><span class="hs-identifier hs-var">empty_val</span></a></span></span><span>
</span><span id="line-288"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Logger -&gt; DumpFlag -&gt; Bool
</span><a href="GHC.Utils.Logger.html#logHasDumpFlag"><span class="hs-identifier hs-var">logHasDumpFlag</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682984248"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_rn_ast"><span class="hs-identifier hs-var">Opt_D_dump_rn_ast</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682984251"><span class="hs-identifier hs-var">empty_val</span></a></span><span>
</span><span id="line-289"></span><span>
</span><span id="line-290"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_WriteHie"><span class="hs-identifier hs-var">Opt_WriteHie</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682984244"><span class="hs-identifier hs-var">dflags</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682984251"><span class="hs-identifier hs-var">empty_val</span></a></span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span>                  </span><span class="hs-comment">-- We want to serialize the documentation in the .hi-files,</span><span>
</span><span id="line-293"></span><span>                  </span><span class="hs-comment">-- and need to extract it from the renamed syntax first.</span><span>
</span><span id="line-294"></span><span>                  </span><span class="hs-comment">-- See 'GHC.HsToCore.Docs.extractDocs'.</span><span>
</span><span id="line-295"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_Haddock"><span class="hs-identifier hs-var">Opt_Haddock</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682984244"><span class="hs-identifier hs-var">dflags</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682984251"><span class="hs-identifier hs-var">empty_val</span></a></span><span>
</span><span id="line-296"></span><span>
</span><span id="line-297"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682984208"><span class="hs-identifier hs-var">keep_rn_syntax</span></a></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682984251"><span class="hs-identifier hs-var">empty_val</span></a></span><span>
</span><span id="line-298"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-299"></span><span>
</span><span id="line-300"></span><span>             </span><span id="local-6989586621682984257"><span class="annot"><a href="#local-6989586621682984257"><span class="hs-identifier hs-var hs-var">gbl_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-301"></span><span>                </span><span class="annot"><span class="annottext">tcg_th_topdecls :: TcRef [LHsDecl GhcPs]
</span><a href="GHC.Tc.Types.html#tcg_th_topdecls"><span class="hs-identifier hs-var">tcg_th_topdecls</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRef [LHsDecl GhcPs]
IORef [GenLocated SrcSpanAnnA (HsDecl GhcPs)]
</span><a href="#local-6989586621682984231"><span class="hs-identifier hs-var">th_topdecls_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-302"></span><span>                </span><span class="annot"><span class="annottext">tcg_th_foreign_files :: IORef [(ForeignSrcLang, FilePath)]
</span><a href="GHC.Tc.Types.html#tcg_th_foreign_files"><span class="hs-identifier hs-var">tcg_th_foreign_files</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef [(ForeignSrcLang, FilePath)]
</span><a href="#local-6989586621682984232"><span class="hs-identifier hs-var">th_foreign_files_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-303"></span><span>                </span><span class="annot"><span class="annottext">tcg_th_topnames :: IORef NameSet
</span><a href="GHC.Tc.Types.html#tcg_th_topnames"><span class="hs-identifier hs-var">tcg_th_topnames</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef NameSet
</span><a href="#local-6989586621682984233"><span class="hs-identifier hs-var">th_topnames_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-304"></span><span>                </span><span class="annot"><span class="annottext">tcg_th_modfinalizers :: IORef [(TcLclEnv, ThModFinalizers)]
</span><a href="GHC.Tc.Types.html#tcg_th_modfinalizers"><span class="hs-identifier hs-var">tcg_th_modfinalizers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef [(TcLclEnv, ThModFinalizers)]
</span><a href="#local-6989586621682984234"><span class="hs-identifier hs-var">th_modfinalizers_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-305"></span><span>                </span><span class="annot"><span class="annottext">tcg_th_coreplugins :: IORef [FilePath]
</span><a href="GHC.Tc.Types.html#tcg_th_coreplugins"><span class="hs-identifier hs-var">tcg_th_coreplugins</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef [FilePath]
</span><a href="#local-6989586621682984235"><span class="hs-identifier hs-var">th_coreplugins_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-306"></span><span>                </span><span class="annot"><span class="annottext">tcg_th_state :: IORef (Map TypeRep Dynamic)
</span><a href="GHC.Tc.Types.html#tcg_th_state"><span class="hs-identifier hs-var">tcg_th_state</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef (Map TypeRep Dynamic)
</span><a href="#local-6989586621682984236"><span class="hs-identifier hs-var">th_state_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-307"></span><span>                </span><span class="annot"><span class="annottext">tcg_th_remote_state :: IORef (Maybe (ForeignRef (IORef QState)))
</span><a href="GHC.Tc.Types.html#tcg_th_remote_state"><span class="hs-identifier hs-var">tcg_th_remote_state</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef (Maybe (ForeignRef (IORef QState)))
</span><a href="#local-6989586621682984238"><span class="hs-identifier hs-var">th_remote_state_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-308"></span><span>                </span><span class="annot"><span class="annottext">tcg_th_docs :: IORef (Map DocLoc (HsDoc GhcRn))
</span><a href="GHC.Tc.Types.html#tcg_th_docs"><span class="hs-identifier hs-var">tcg_th_docs</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef (Map DocLoc (HsDoc GhcRn))
</span><a href="#local-6989586621682984239"><span class="hs-identifier hs-var">th_docs_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span>                </span><span class="annot"><span class="annottext">tcg_mod :: Module
</span><a href="GHC.Tc.Types.html#tcg_mod"><span class="hs-identifier hs-var">tcg_mod</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682984209"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-311"></span><span>                </span><span class="annot"><span class="annottext">tcg_semantic_mod :: Module
</span><a href="GHC.Tc.Types.html#tcg_semantic_mod"><span class="hs-identifier hs-var">tcg_semantic_mod</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe HomeUnit -&gt; Module -&gt; Module
</span><a href="GHC.Unit.Home.html#homeModuleInstantiation"><span class="hs-identifier hs-var">homeModuleInstantiation</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HomeUnit
</span><a href="#local-6989586621682984246"><span class="hs-identifier hs-var">mhome_unit</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682984209"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-312"></span><span>                </span><span class="annot"><span class="annottext">tcg_src :: HscSource
</span><a href="GHC.Tc.Types.html#tcg_src"><span class="hs-identifier hs-var">tcg_src</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621682984207"><span class="hs-identifier hs-var">hsc_src</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-313"></span><span>                </span><span class="annot"><span class="annottext">tcg_rdr_env :: GlobalRdrEnv
</span><a href="GHC.Tc.Types.html#tcg_rdr_env"><span class="hs-identifier hs-var">tcg_rdr_env</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
forall info. GlobalRdrEnvX info
</span><a href="GHC.Types.Name.Reader.html#emptyGlobalRdrEnv"><span class="hs-identifier hs-var">emptyGlobalRdrEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-314"></span><span>                </span><span class="annot"><span class="annottext">tcg_fix_env :: FixityEnv
</span><a href="GHC.Tc.Types.html#tcg_fix_env"><span class="hs-identifier hs-var">tcg_fix_env</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FixityEnv
forall a. NameEnv a
</span><a href="GHC.Types.Name.Env.html#emptyNameEnv"><span class="hs-identifier hs-var">emptyNameEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-315"></span><span>                </span><span class="annot"><span class="annottext">tcg_default :: DefaultEnv
</span><a href="GHC.Tc.Types.html#tcg_default"><span class="hs-identifier hs-var">tcg_default</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DefaultEnv
</span><a href="GHC.Types.DefaultEnv.html#emptyDefaultEnv"><span class="hs-identifier hs-var">emptyDefaultEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-316"></span><span>                </span><span class="annot"><span class="annottext">tcg_default_exports :: DefaultEnv
</span><a href="GHC.Tc.Types.html#tcg_default_exports"><span class="hs-identifier hs-var">tcg_default_exports</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DefaultEnv
</span><a href="GHC.Types.DefaultEnv.html#emptyDefaultEnv"><span class="hs-identifier hs-var">emptyDefaultEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-317"></span><span>                </span><span class="annot"><span class="annottext">tcg_type_env :: TypeEnv
</span><a href="GHC.Tc.Types.html#tcg_type_env"><span class="hs-identifier hs-var">tcg_type_env</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeEnv
forall a. NameEnv a
</span><a href="GHC.Types.Name.Env.html#emptyNameEnv"><span class="hs-identifier hs-var">emptyNameEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-318"></span><span>                </span><span class="annot"><span class="annottext">tcg_type_env_var :: KnotVars (IORef TypeEnv)
</span><a href="GHC.Tc.Types.html#tcg_type_env_var"><span class="hs-identifier hs-var">tcg_type_env_var</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnotVars (IORef TypeEnv)
</span><a href="#local-6989586621682984224"><span class="hs-identifier hs-var">type_env_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-319"></span><span>                </span><span class="annot"><span class="annottext">tcg_inst_env :: InstEnv
</span><a href="GHC.Tc.Types.html#tcg_inst_env"><span class="hs-identifier hs-var">tcg_inst_env</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InstEnv
</span><a href="GHC.Core.InstEnv.html#emptyInstEnv"><span class="hs-identifier hs-var">emptyInstEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-320"></span><span>                </span><span class="annot"><span class="annottext">tcg_fam_inst_env :: FamInstEnv
</span><a href="GHC.Tc.Types.html#tcg_fam_inst_env"><span class="hs-identifier hs-var">tcg_fam_inst_env</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FamInstEnv
</span><a href="GHC.Core.FamInstEnv.html#emptyFamInstEnv"><span class="hs-identifier hs-var">emptyFamInstEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-321"></span><span>                </span><span class="annot"><span class="annottext">tcg_ann_env :: AnnEnv
</span><a href="GHC.Tc.Types.html#tcg_ann_env"><span class="hs-identifier hs-var">tcg_ann_env</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnEnv
</span><a href="GHC.Types.Annotations.html#emptyAnnEnv"><span class="hs-identifier hs-var">emptyAnnEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-322"></span><span>                </span><span class="annot"><span class="annottext">tcg_th_used :: IORef Bool
</span><a href="GHC.Tc.Types.html#tcg_th_used"><span class="hs-identifier hs-var">tcg_th_used</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef Bool
</span><a href="#local-6989586621682984216"><span class="hs-identifier hs-var">th_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-323"></span><span>                </span><span class="annot"><span class="annottext">tcg_th_splice_used :: IORef Bool
</span><a href="GHC.Tc.Types.html#tcg_th_splice_used"><span class="hs-identifier hs-var">tcg_th_splice_used</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef Bool
</span><a href="#local-6989586621682984217"><span class="hs-identifier hs-var">th_splice_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-324"></span><span>                </span><span class="annot"><span class="annottext">tcg_th_needed_deps :: IORef ([Linkable], UniqDFM UnitId LoadedPkgInfo)
</span><a href="GHC.Tc.Types.html#tcg_th_needed_deps"><span class="hs-identifier hs-var">tcg_th_needed_deps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef ([Linkable], UniqDFM UnitId LoadedPkgInfo)
</span><a href="#local-6989586621682984240"><span class="hs-identifier hs-var">th_needed_deps_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-325"></span><span>                </span><span class="annot"><span class="annottext">tcg_exports :: [AvailInfo]
</span><a href="GHC.Tc.Types.html#tcg_exports"><span class="hs-identifier hs-var">tcg_exports</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-326"></span><span>                </span><span class="annot"><span class="annottext">tcg_imports :: ImportAvails
</span><a href="GHC.Tc.Types.html#tcg_imports"><span class="hs-identifier hs-var">tcg_imports</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImportAvails
</span><a href="GHC.Tc.Types.html#emptyImportAvails"><span class="hs-identifier hs-var">emptyImportAvails</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-327"></span><span>                </span><span class="annot"><span class="annottext">tcg_import_decls :: [ImportUserSpec]
</span><a href="GHC.Tc.Types.html#tcg_import_decls"><span class="hs-identifier hs-var">tcg_import_decls</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-328"></span><span>                </span><span class="annot"><span class="annottext">tcg_used_gres :: IORef [GlobalRdrElt]
</span><a href="GHC.Tc.Types.html#tcg_used_gres"><span class="hs-identifier hs-var">tcg_used_gres</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef [GlobalRdrElt]
</span><a href="#local-6989586621682984215"><span class="hs-identifier hs-var">used_gre_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-329"></span><span>                </span><span class="annot"><span class="annottext">tcg_dus :: DefUses
</span><a href="GHC.Tc.Types.html#tcg_dus"><span class="hs-identifier hs-var">tcg_dus</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DefUses
</span><a href="GHC.Types.Name.Set.html#emptyDUs"><span class="hs-identifier hs-var">emptyDUs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-330"></span><span>
</span><span id="line-331"></span><span>                </span><span class="annot"><span class="annottext">tcg_rn_imports :: [LImportDecl GhcRn]
</span><a href="GHC.Tc.Types.html#tcg_rn_imports"><span class="hs-identifier hs-var">tcg_rn_imports</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-332"></span><span>                </span><span class="annot"><span class="annottext">tcg_rn_exports :: Maybe [(LIE GhcRn, [AvailInfo])]
</span><a href="GHC.Tc.Types.html#tcg_rn_exports"><span class="hs-identifier hs-var">tcg_rn_exports</span></a></span><span>     </span><span class="hs-glyph">=</span><span>
</span><span id="line-333"></span><span>                    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621682984207"><span class="hs-identifier hs-var">hsc_src</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource -&gt; HscSource -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Types.SourceFile.html#HsigFile"><span class="hs-identifier hs-var">HsigFile</span></a></span><span>
</span><span id="line-334"></span><span>                        </span><span class="hs-comment">-- Always retain renamed syntax, so that we can give</span><span>
</span><span id="line-335"></span><span>                        </span><span class="hs-comment">-- better errors.  (TODO: how?)</span><span>
</span><span id="line-336"></span><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[(GenLocated SrcSpanAnnA (IE GhcRn), [AvailInfo])]
-&gt; Maybe [(GenLocated SrcSpanAnnA (IE GhcRn), [AvailInfo])]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-337"></span><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[(GenLocated SrcSpanAnnA (IE GhcRn), [AvailInfo])]
-&gt; Maybe [(GenLocated SrcSpanAnnA (IE GhcRn), [AvailInfo])]
forall a. a -&gt; Maybe a
</span><a href="#local-6989586621682984250"><span class="hs-identifier hs-var">maybe_rn_syntax</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-338"></span><span>                </span><span class="annot"><span class="annottext">tcg_rn_decls :: Maybe (HsGroup GhcRn)
</span><a href="GHC.Tc.Types.html#tcg_rn_decls"><span class="hs-identifier hs-var">tcg_rn_decls</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsGroup GhcRn -&gt; Maybe (HsGroup GhcRn)
forall a. a -&gt; Maybe a
</span><a href="#local-6989586621682984250"><span class="hs-identifier hs-var">maybe_rn_syntax</span></a></span><span> </span><span class="annot"><span class="annottext">HsGroup GhcRn
forall (p :: Pass). HsGroup (GhcPass p)
</span><a href="GHC.Hs.Decls.html#emptyRnGroup"><span class="hs-identifier hs-var">emptyRnGroup</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-339"></span><span>                </span><span class="annot"><span class="annottext">tcg_tr_module :: Maybe Id
</span><a href="GHC.Tc.Types.html#tcg_tr_module"><span class="hs-identifier hs-var">tcg_tr_module</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Id
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-340"></span><span>                </span><span class="annot"><span class="annottext">tcg_binds :: LHsBinds GhcTc
</span><a href="GHC.Tc.Types.html#tcg_binds"><span class="hs-identifier hs-var">tcg_binds</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsBinds GhcTc
forall (idL :: Pass) idR. LHsBindsLR (GhcPass idL) idR
</span><a href="GHC.Hs.Binds.html#emptyLHsBinds"><span class="hs-identifier hs-var">emptyLHsBinds</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-341"></span><span>                </span><span class="annot"><span class="annottext">tcg_imp_specs :: [LTcSpecPrag]
</span><a href="GHC.Tc.Types.html#tcg_imp_specs"><span class="hs-identifier hs-var">tcg_imp_specs</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-342"></span><span>                </span><span class="annot"><span class="annottext">tcg_sigs :: NameSet
</span><a href="GHC.Tc.Types.html#tcg_sigs"><span class="hs-identifier hs-var">tcg_sigs</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameSet
</span><a href="GHC.Types.Name.Set.html#emptyNameSet"><span class="hs-identifier hs-var">emptyNameSet</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-343"></span><span>                </span><span class="annot"><span class="annottext">tcg_ksigs :: NameSet
</span><a href="GHC.Tc.Types.html#tcg_ksigs"><span class="hs-identifier hs-var">tcg_ksigs</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameSet
</span><a href="GHC.Types.Name.Set.html#emptyNameSet"><span class="hs-identifier hs-var">emptyNameSet</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-344"></span><span>                </span><span class="annot"><span class="annottext">tcg_ev_binds :: Bag EvBind
</span><a href="GHC.Tc.Types.html#tcg_ev_binds"><span class="hs-identifier hs-var">tcg_ev_binds</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bag EvBind
forall a. Bag a
</span><a href="GHC.Data.Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-345"></span><span>                </span><span class="annot"><span class="annottext">tcg_warns :: Warnings GhcRn
</span><a href="GHC.Tc.Types.html#tcg_warns"><span class="hs-identifier hs-var">tcg_warns</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Warnings GhcRn
forall p. Warnings p
</span><a href="GHC.Unit.Module.Warnings.html#emptyWarn"><span class="hs-identifier hs-var">emptyWarn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-346"></span><span>                </span><span class="annot"><span class="annottext">tcg_anns :: [Annotation]
</span><a href="GHC.Tc.Types.html#tcg_anns"><span class="hs-identifier hs-var">tcg_anns</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-347"></span><span>                </span><span class="annot"><span class="annottext">tcg_tcs :: [TyCon]
</span><a href="GHC.Tc.Types.html#tcg_tcs"><span class="hs-identifier hs-var">tcg_tcs</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-348"></span><span>                </span><span class="annot"><span class="annottext">tcg_insts :: [ClsInst]
</span><a href="GHC.Tc.Types.html#tcg_insts"><span class="hs-identifier hs-var">tcg_insts</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-349"></span><span>                </span><span class="annot"><span class="annottext">tcg_fam_insts :: [FamInst]
</span><a href="GHC.Tc.Types.html#tcg_fam_insts"><span class="hs-identifier hs-var">tcg_fam_insts</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-350"></span><span>                </span><span class="annot"><span class="annottext">tcg_rules :: [LRuleDecl GhcTc]
</span><a href="GHC.Tc.Types.html#tcg_rules"><span class="hs-identifier hs-var">tcg_rules</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-351"></span><span>                </span><span class="annot"><span class="annottext">tcg_fords :: [LForeignDecl GhcTc]
</span><a href="GHC.Tc.Types.html#tcg_fords"><span class="hs-identifier hs-var">tcg_fords</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-352"></span><span>                </span><span class="annot"><span class="annottext">tcg_patsyns :: [PatSyn]
</span><a href="GHC.Tc.Types.html#tcg_patsyns"><span class="hs-identifier hs-var">tcg_patsyns</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-353"></span><span>                </span><span class="annot"><span class="annottext">tcg_merged :: [(Module, Fingerprint)]
</span><a href="GHC.Tc.Types.html#tcg_merged"><span class="hs-identifier hs-var">tcg_merged</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-354"></span><span>                </span><span class="annot"><span class="annottext">tcg_dfun_n :: IORef OccSet
</span><a href="GHC.Tc.Types.html#tcg_dfun_n"><span class="hs-identifier hs-var">tcg_dfun_n</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef OccSet
</span><a href="#local-6989586621682984221"><span class="hs-identifier hs-var">dfun_n_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-355"></span><span>                </span><span class="annot"><span class="annottext">tcg_zany_n :: IORef Integer
</span><a href="GHC.Tc.Types.html#tcg_zany_n"><span class="hs-identifier hs-var">tcg_zany_n</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef Integer
</span><a href="#local-6989586621682984223"><span class="hs-identifier hs-var">zany_n_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-356"></span><span>                </span><span class="annot"><span class="annottext">tcg_keep :: IORef NameSet
</span><a href="GHC.Tc.Types.html#tcg_keep"><span class="hs-identifier hs-var">tcg_keep</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef NameSet
</span><a href="#local-6989586621682984212"><span class="hs-identifier hs-var">keep_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-357"></span><span>                </span><span class="annot"><span class="annottext">tcg_hdr_info :: (Maybe (LHsDoc GhcRn), Maybe (XRec GhcRn ModuleName))
</span><a href="GHC.Tc.Types.html#tcg_hdr_info"><span class="hs-identifier hs-var">tcg_hdr_info</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (LHsDoc GhcRn)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe (XRec GhcRn ModuleName)
Maybe (GenLocated SrcSpanAnnA ModuleName)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-358"></span><span>                </span><span class="annot"><span class="annottext">tcg_hpc :: Bool
</span><a href="GHC.Tc.Types.html#tcg_hpc"><span class="hs-identifier hs-var">tcg_hpc</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span>
</span><span id="line-359"></span><span>                </span><span class="annot"><span class="annottext">tcg_main :: Maybe Name
</span><a href="GHC.Tc.Types.html#tcg_main"><span class="hs-identifier hs-var">tcg_main</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-360"></span><span>                </span><span class="annot"><span class="annottext">tcg_self_boot :: SelfBootInfo
</span><a href="GHC.Tc.Types.html#tcg_self_boot"><span class="hs-identifier hs-var">tcg_self_boot</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelfBootInfo
</span><a href="GHC.Tc.Types.html#NoSelfBoot"><span class="hs-identifier hs-var">NoSelfBoot</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-361"></span><span>                </span><span class="annot"><span class="annottext">tcg_safe_infer :: IORef Bool
</span><a href="GHC.Tc.Types.html#tcg_safe_infer"><span class="hs-identifier hs-var">tcg_safe_infer</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef Bool
</span><a href="#local-6989586621682984218"><span class="hs-identifier hs-var">infer_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-362"></span><span>                </span><span class="annot"><span class="annottext">tcg_safe_infer_reasons :: IORef (Messages TcRnMessage)
</span><a href="GHC.Tc.Types.html#tcg_safe_infer_reasons"><span class="hs-identifier hs-var">tcg_safe_infer_reasons</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef (Messages TcRnMessage)
</span><a href="#local-6989586621682984219"><span class="hs-identifier hs-var">infer_reasons_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-363"></span><span>                </span><span class="annot"><span class="annottext">tcg_dependent_files :: IORef [FilePath]
</span><a href="GHC.Tc.Types.html#tcg_dependent_files"><span class="hs-identifier hs-var">tcg_dependent_files</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef [FilePath]
</span><a href="#local-6989586621682984226"><span class="hs-identifier hs-var">dependent_files_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-364"></span><span>                </span><span class="annot"><span class="annottext">tcg_tc_plugin_solvers :: [TcPluginSolver]
</span><a href="GHC.Tc.Types.html#tcg_tc_plugin_solvers"><span class="hs-identifier hs-var">tcg_tc_plugin_solvers</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-365"></span><span>                </span><span class="annot"><span class="annottext">tcg_tc_plugin_rewriters :: UniqFM TyCon [TcPluginRewriter]
</span><a href="GHC.Tc.Types.html#tcg_tc_plugin_rewriters"><span class="hs-identifier hs-var">tcg_tc_plugin_rewriters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqFM TyCon [TcPluginRewriter]
forall {k} (key :: k) elt. UniqFM key elt
</span><a href="GHC.Types.Unique.FM.html#emptyUFM"><span class="hs-identifier hs-var">emptyUFM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-366"></span><span>                </span><span class="annot"><span class="annottext">tcg_defaulting_plugins :: [FillDefaulting]
</span><a href="GHC.Tc.Types.html#tcg_defaulting_plugins"><span class="hs-identifier hs-var">tcg_defaulting_plugins</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-367"></span><span>                </span><span class="annot"><span class="annottext">tcg_hf_plugins :: [HoleFitPlugin]
</span><a href="GHC.Tc.Types.html#tcg_hf_plugins"><span class="hs-identifier hs-var">tcg_hf_plugins</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-368"></span><span>                </span><span class="annot"><span class="annottext">tcg_top_loc :: RealSrcSpan
</span><a href="GHC.Tc.Types.html#tcg_top_loc"><span class="hs-identifier hs-var">tcg_top_loc</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621682984210"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-369"></span><span>                </span><span class="annot"><span class="annottext">tcg_static_wc :: IORef WantedConstraints
</span><a href="GHC.Tc.Types.html#tcg_static_wc"><span class="hs-identifier hs-var">tcg_static_wc</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef WantedConstraints
</span><a href="#local-6989586621682984227"><span class="hs-identifier hs-var">static_wc_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-370"></span><span>                </span><span class="annot"><span class="annottext">tcg_complete_matches :: CompleteMatches
</span><a href="GHC.Tc.Types.html#tcg_complete_matches"><span class="hs-identifier hs-var">tcg_complete_matches</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-371"></span><span>                </span><span class="annot"><span class="annottext">tcg_cc_st :: IORef CostCentreState
</span><a href="GHC.Tc.Types.html#tcg_cc_st"><span class="hs-identifier hs-var">tcg_cc_st</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef CostCentreState
</span><a href="#local-6989586621682984229"><span class="hs-identifier hs-var">cc_st_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-372"></span><span>                </span><span class="annot"><span class="annottext">tcg_next_wrapper_num :: IORef (ModuleEnv Int)
</span><a href="GHC.Tc.Types.html#tcg_next_wrapper_num"><span class="hs-identifier hs-var">tcg_next_wrapper_num</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef (ModuleEnv Int)
</span><a href="#local-6989586621682984242"><span class="hs-identifier hs-var">next_wrapper_num</span></a></span><span>
</span><span id="line-373"></span><span>             </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-374"></span><span>        </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-375"></span><span>
</span><span id="line-376"></span><span>        </span><span class="hs-comment">-- OK, here's the business end!</span><span>
</span><span id="line-377"></span><span>        </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initTcWithGbl"><span class="hs-identifier hs-type">initTcWithGbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984206"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984257"><span class="hs-identifier hs-type">gbl_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984210"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984211"><span class="hs-identifier hs-type">do_this</span></a></span><span>
</span><span id="line-378"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-379"></span><span>
</span><span id="line-380"></span><span class="annot"><span class="hs-comment">-- | Run a 'TcM' action in the context of an existing 'GblEnv'.</span></span><span>
</span><span id="line-381"></span><span id="local-6989586621682983035"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initTcWithGbl"><span class="hs-identifier hs-type">initTcWithGbl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-382"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span>
</span><span id="line-383"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#RealSrcSpan"><span class="hs-identifier hs-type">RealSrcSpan</span></a></span><span>
</span><span id="line-384"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983035"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-385"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621682983035"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-386"></span><span id="initTcWithGbl"><span class="annot"><span class="annottext">initTcWithGbl :: forall r.
HscEnv
-&gt; TcGblEnv
-&gt; RealSrcSpan
-&gt; TcM r
-&gt; IO (Messages TcRnMessage, Maybe r)
</span><a href="GHC.Tc.Utils.Monad.html#initTcWithGbl"><span class="hs-identifier hs-var hs-var">initTcWithGbl</span></a></span></span><span> </span><span id="local-6989586621682984355"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682984355"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682984356"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682984356"><span class="hs-identifier hs-var">gbl_env</span></a></span></span><span> </span><span id="local-6989586621682984357"><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621682984357"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682984358"><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682984358"><span class="hs-identifier hs-var">do_this</span></a></span></span><span>
</span><span id="line-387"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984359"><span class="annot"><a href="#local-6989586621682984359"><span class="hs-identifier hs-var">lie_var</span></a></span></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WantedConstraints -&gt; IO (IORef WantedConstraints)
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="GHC.Tc.Types.Constraint.html#emptyWC"><span class="hs-identifier hs-var">emptyWC</span></a></span><span>
</span><span id="line-388"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682984360"><span class="annot"><a href="#local-6989586621682984360"><span class="hs-identifier hs-var">errs_var</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newIORef</span></span><span> </span><span class="annot"><a href="GHC.Types.Error.html#emptyMessages"><span class="hs-identifier hs-type">emptyMessages</span></a></span><span>
</span><span id="line-389"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682984361"><span class="annot"><a href="#local-6989586621682984361"><span class="hs-identifier hs-var">usage_var</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newIORef</span></span><span> </span><span class="annot"><a href="GHC.Core.UsageEnv.html#zeroUE"><span class="hs-identifier hs-type">zeroUE</span></a></span><span>
</span><span id="line-390"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682984363"><span class="annot"><a href="#local-6989586621682984363"><span class="hs-identifier hs-var hs-var">lcl_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-391"></span><span>                </span><span class="annot"><span class="annottext">tcl_lcl_ctxt :: TcLclCtxt
</span><a href="GHC.Tc.Types.LclEnv.html#tcl_lcl_ctxt"><span class="hs-identifier hs-var">tcl_lcl_ctxt</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#TcLclCtxt"><span class="hs-identifier hs-type">TcLclCtxt</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-392"></span><span>                </span><span class="annot"><span class="annottext">tcl_loc :: RealSrcSpan
</span><a href="GHC.Tc.Types.LclEnv.html#tcl_loc"><span class="hs-identifier hs-var">tcl_loc</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621682984357"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-393"></span><span>                </span><span class="hs-comment">-- tcl_loc should be over-ridden very soon!</span><span>
</span><span id="line-394"></span><span>                </span><span class="annot"><span class="annottext">tcl_in_gen_code :: Bool
</span><a href="GHC.Tc.Types.LclEnv.html#tcl_in_gen_code"><span class="hs-identifier hs-var">tcl_in_gen_code</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span>
</span><span id="line-395"></span><span>                </span><span class="annot"><span class="annottext">tcl_ctxt :: [ErrCtxt]
</span><a href="GHC.Tc.Types.LclEnv.html#tcl_ctxt"><span class="hs-identifier hs-var">tcl_ctxt</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-396"></span><span>                </span><span class="annot"><span class="annottext">tcl_rdr :: LocalRdrEnv
</span><a href="GHC.Tc.Types.LclEnv.html#tcl_rdr"><span class="hs-identifier hs-var">tcl_rdr</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocalRdrEnv
</span><a href="GHC.Types.Name.Reader.html#emptyLocalRdrEnv"><span class="hs-identifier hs-var">emptyLocalRdrEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-397"></span><span>                </span><span class="annot"><span class="annottext">tcl_th_ctxt :: ThStage
</span><a href="GHC.Tc.Types.LclEnv.html#tcl_th_ctxt"><span class="hs-identifier hs-var">tcl_th_ctxt</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="GHC.Tc.Types.TH.html#topStage"><span class="hs-identifier hs-var">topStage</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-398"></span><span>                </span><span class="annot"><span class="annottext">tcl_th_bndrs :: ThBindEnv
</span><a href="GHC.Tc.Types.LclEnv.html#tcl_th_bndrs"><span class="hs-identifier hs-var">tcl_th_bndrs</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThBindEnv
forall a. NameEnv a
</span><a href="GHC.Types.Name.Env.html#emptyNameEnv"><span class="hs-identifier hs-var">emptyNameEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-399"></span><span>                </span><span class="annot"><span class="annottext">tcl_arrow_ctxt :: ArrowCtxt
</span><a href="GHC.Tc.Types.LclEnv.html#tcl_arrow_ctxt"><span class="hs-identifier hs-var">tcl_arrow_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArrowCtxt
</span><a href="GHC.Tc.Types.LclEnv.html#NoArrowCtxt"><span class="hs-identifier hs-var">NoArrowCtxt</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-400"></span><span>                </span><span class="annot"><span class="annottext">tcl_env :: TcTypeEnv
</span><a href="GHC.Tc.Types.LclEnv.html#tcl_env"><span class="hs-identifier hs-var">tcl_env</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTypeEnv
forall a. NameEnv a
</span><a href="GHC.Types.Name.Env.html#emptyNameEnv"><span class="hs-identifier hs-var">emptyNameEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-401"></span><span>                </span><span class="annot"><span class="annottext">tcl_bndrs :: TcBinderStack
</span><a href="GHC.Tc.Types.LclEnv.html#tcl_bndrs"><span class="hs-identifier hs-var">tcl_bndrs</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-402"></span><span>                </span><span class="annot"><span class="annottext">tcl_tclvl :: TcLevel
</span><a href="GHC.Tc.Types.LclEnv.html#tcl_tclvl"><span class="hs-identifier hs-var">tcl_tclvl</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="GHC.Tc.Utils.TcType.html#topTcLevel"><span class="hs-identifier hs-var">topTcLevel</span></a></span><span>
</span><span id="line-403"></span><span>                </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-404"></span><span>                </span><span class="annot"><span class="annottext">tcl_usage :: IORef UsageEnv
</span><a href="GHC.Tc.Types.LclEnv.html#tcl_usage"><span class="hs-identifier hs-var">tcl_usage</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef UsageEnv
</span><a href="#local-6989586621682984361"><span class="hs-identifier hs-var">usage_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-405"></span><span>                </span><span class="annot"><span class="annottext">tcl_lie :: IORef WantedConstraints
</span><a href="GHC.Tc.Types.LclEnv.html#tcl_lie"><span class="hs-identifier hs-var">tcl_lie</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef WantedConstraints
</span><a href="#local-6989586621682984359"><span class="hs-identifier hs-var">lie_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-406"></span><span>                </span><span class="annot"><span class="annottext">tcl_errs :: IORef (Messages TcRnMessage)
</span><a href="GHC.Tc.Types.LclEnv.html#tcl_errs"><span class="hs-identifier hs-var">tcl_errs</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef (Messages TcRnMessage)
</span><a href="#local-6989586621682984360"><span class="hs-identifier hs-var">errs_var</span></a></span><span>
</span><span id="line-407"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-408"></span><span>
</span><span id="line-409"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682984384"><span class="annot"><a href="#local-6989586621682984384"><span class="hs-identifier hs-var">maybe_res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initTcRnIf"><span class="hs-identifier hs-type">initTcRnIf</span></a></span><span> </span><span class="annot"><span class="hs-char">'a'</span></span><span> </span><span class="annot"><a href="#local-6989586621682984355"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984356"><span class="hs-identifier hs-type">gbl_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984363"><span class="hs-identifier hs-type">lcl_env</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-410"></span><span>                     </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984385"><span class="annot"><a href="#local-6989586621682984385"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Data.IOEnv.html#tryM"><span class="hs-identifier hs-type">tryM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984358"><span class="hs-identifier hs-type">do_this</span></a></span><span>
</span><span id="line-411"></span><span>                        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682984385"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-412"></span><span>                          </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621682984387"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621682984387"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe r -&gt; TcRnIf TcGblEnv TcLclEnv (Maybe r)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r -&gt; Maybe r
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621682984387"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-413"></span><span>                          </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">IOEnvFailure
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe r -&gt; TcRnIf TcGblEnv TcLclEnv (Maybe r)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe r
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-414"></span><span>
</span><span id="line-415"></span><span>      </span><span class="hs-comment">-- Check for unsolved constraints</span><span>
</span><span id="line-416"></span><span>      </span><span class="hs-comment">-- If we succeed (maybe_res = Just r), there should be</span><span>
</span><span id="line-417"></span><span>      </span><span class="hs-comment">-- no unsolved constraints.  But if we exit via an</span><span>
</span><span id="line-418"></span><span>      </span><span class="hs-comment">-- exception (maybe_res = Nothing), we may have skipped</span><span>
</span><span id="line-419"></span><span>      </span><span class="hs-comment">-- solving, so don't panic then (#13466)</span><span>
</span><span id="line-420"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682984388"><span class="annot"><a href="#local-6989586621682984388"><span class="hs-identifier hs-var">lie</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">readIORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#tcl_lie"><span class="hs-identifier hs-var">tcl_lie</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984363"><span class="hs-identifier hs-type">lcl_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-421"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">isJust</span></span><span> </span><span class="annot"><a href="#local-6989586621682984384"><span class="hs-identifier hs-type">maybe_res</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#isEmptyWC"><span class="hs-identifier hs-type">isEmptyWC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984388"><span class="hs-identifier hs-type">lie</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-422"></span><span>        </span><span class="annot"><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-type">pprPanic</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;initTc: unsolved constraints&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984388"><span class="hs-identifier hs-type">lie</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-423"></span><span>
</span><span id="line-424"></span><span>        </span><span class="hs-comment">-- Collect any error messages</span><span>
</span><span id="line-425"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682984397"><span class="annot"><a href="#local-6989586621682984397"><span class="hs-identifier hs-var">msgs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">readIORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#tcl_errs"><span class="hs-identifier hs-var">tcl_errs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984363"><span class="hs-identifier hs-type">lcl_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-426"></span><span>
</span><span id="line-427"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984398"><span class="annot"><a href="#local-6989586621682984398"><span class="hs-identifier hs-var hs-var">final_res</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Messages TcRnMessage -&gt; Bool
forall e. Diagnostic e =&gt; Messages e -&gt; Bool
</span><a href="GHC.Types.Error.html#errorsFound"><span class="hs-identifier hs-var">errorsFound</span></a></span><span> </span><span class="annot"><span class="annottext">Messages TcRnMessage
</span><a href="#local-6989586621682984397"><span class="hs-identifier hs-var">msgs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe r
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-428"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe r
</span><a href="#local-6989586621682984384"><span class="hs-identifier hs-var">maybe_res</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-429"></span><span>
</span><span id="line-430"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682984397"><span class="hs-identifier hs-type">msgs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682984398"><span class="hs-identifier hs-type">final_res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-431"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-432"></span><span>
</span><span id="line-433"></span><span id="local-6989586621682983066"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initTcInteractive"><span class="hs-identifier hs-type">initTcInteractive</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983066"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621682983066"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-434"></span><span class="hs-comment">-- Initialise the type checker monad for use in GHCi</span><span>
</span><span id="line-435"></span><span id="initTcInteractive"><span class="annot"><span class="annottext">initTcInteractive :: forall a. HscEnv -&gt; TcM a -&gt; IO (Messages TcRnMessage, Maybe a)
</span><a href="GHC.Tc.Utils.Monad.html#initTcInteractive"><span class="hs-identifier hs-var hs-var">initTcInteractive</span></a></span></span><span> </span><span id="local-6989586621682984400"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682984400"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682984401"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682984401"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-436"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; HscSource
-&gt; Bool
-&gt; Module
-&gt; RealSrcSpan
-&gt; TcM a
-&gt; IO (Messages TcRnMessage, Maybe a)
forall r.
HscEnv
-&gt; HscSource
-&gt; Bool
-&gt; Module
-&gt; RealSrcSpan
-&gt; TcM r
-&gt; IO (Messages TcRnMessage, Maybe r)
</span><a href="GHC.Tc.Utils.Monad.html#initTc"><span class="hs-identifier hs-var">initTc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682984400"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Types.SourceFile.html#HsSrcFile"><span class="hs-identifier hs-var">HsSrcFile</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-437"></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InteractiveContext -&gt; Module
</span><a href="GHC.Runtime.Context.html#icInteractiveModule"><span class="hs-identifier hs-var">icInteractiveModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; InteractiveContext
</span><a href="GHC.Driver.Env.Types.html#hsc_IC"><span class="hs-identifier hs-var">hsc_IC</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682984400"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-438"></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RealSrcLoc -&gt; RealSrcSpan
</span><a href="GHC.Types.SrcLoc.html#realSrcLocSpan"><span class="hs-identifier hs-var">realSrcLocSpan</span></a></span><span> </span><span class="annot"><span class="annottext">RealSrcLoc
</span><a href="#local-6989586621682984406"><span class="hs-identifier hs-var">interactive_src_loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-439"></span><span>           </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682984401"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-440"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-441"></span><span>    </span><span id="local-6989586621682984406"><span class="annot"><span class="annottext">interactive_src_loc :: RealSrcLoc
</span><a href="#local-6989586621682984406"><span class="hs-identifier hs-var hs-var">interactive_src_loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Int -&gt; Int -&gt; RealSrcLoc
</span><a href="GHC.Types.SrcLoc.html#mkRealSrcLoc"><span class="hs-identifier hs-var">mkRealSrcLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;&lt;interactive&gt;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-442"></span><span>
</span><span id="line-443"></span><span id="local-6989586621682983048"><span id="local-6989586621682983049"><span id="local-6989586621682983050"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initTcRnIf"><span class="hs-identifier hs-type">initTcRnIf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span>              </span><span class="annot"><span class="hs-comment">-- ^ Tag for unique supply</span></span><span>
</span><span id="line-444"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-445"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682983048"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682983049"><span class="hs-identifier hs-type">lcl</span></a></span><span>
</span><span id="line-446"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983048"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983049"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983050"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-447"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682983050"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-448"></span><span id="initTcRnIf"><span class="annot"><span class="annottext">initTcRnIf :: forall gbl lcl a.
Char -&gt; HscEnv -&gt; gbl -&gt; lcl -&gt; TcRnIf gbl lcl a -&gt; IO a
</span><a href="GHC.Tc.Utils.Monad.html#initTcRnIf"><span class="hs-identifier hs-var hs-var">initTcRnIf</span></a></span></span><span> </span><span id="local-6989586621682984409"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682984409"><span class="hs-identifier hs-var">uniq_tag</span></a></span></span><span> </span><span id="local-6989586621682984410"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682984410"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682984411"><span class="annot"><span class="annottext">gbl
</span><a href="#local-6989586621682984411"><span class="hs-identifier hs-var">gbl_env</span></a></span></span><span> </span><span id="local-6989586621682984412"><span class="annot"><span class="annottext">lcl
</span><a href="#local-6989586621682984412"><span class="hs-identifier hs-var">lcl_env</span></a></span></span><span> </span><span id="local-6989586621682984413"><span class="annot"><span class="annottext">TcRnIf gbl lcl a
</span><a href="#local-6989586621682984413"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-449"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984414"><span class="annot"><span class="annottext">env :: Env gbl lcl
</span><a href="#local-6989586621682984414"><span class="hs-identifier hs-var hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">env_top :: HscEnv
</span><a href="GHC.Tc.Types.html#env_top"><span class="hs-identifier hs-var">env_top</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682984410"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-450"></span><span>                            </span><span class="annot"><span class="annottext">env_ut :: Char
</span><a href="GHC.Tc.Types.html#env_ut"><span class="hs-identifier hs-var">env_ut</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682984409"><span class="hs-identifier hs-var">uniq_tag</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-451"></span><span>                            </span><span class="annot"><span class="annottext">env_gbl :: gbl
</span><a href="GHC.Tc.Types.html#env_gbl"><span class="hs-identifier hs-var">env_gbl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">gbl
</span><a href="#local-6989586621682984411"><span class="hs-identifier hs-var">gbl_env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-452"></span><span>                            </span><span class="annot"><span class="annottext">env_lcl :: lcl
</span><a href="GHC.Tc.Types.html#env_lcl"><span class="hs-identifier hs-var">env_lcl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">lcl
</span><a href="#local-6989586621682984412"><span class="hs-identifier hs-var">lcl_env</span></a></span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-453"></span><span>
</span><span id="line-454"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Env gbl lcl -&gt; TcRnIf gbl lcl a -&gt; IO a
forall env a. env -&gt; IOEnv env a -&gt; IO a
</span><a href="GHC.Data.IOEnv.html#runIOEnv"><span class="hs-identifier hs-var">runIOEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Env gbl lcl
</span><a href="#local-6989586621682984414"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf gbl lcl a
</span><a href="#local-6989586621682984413"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-455"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-456"></span><span>
</span><span id="line-457"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Simple accessors
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-464"></span><span>
</span><span id="line-465"></span><span id="local-6989586621682983076"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#discardResult"><span class="hs-identifier hs-type">discardResult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983076"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-466"></span><span id="discardResult"><span class="annot"><span class="annottext">discardResult :: forall a. TcM a -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#discardResult"><span class="hs-identifier hs-var hs-var">discardResult</span></a></span></span><span> </span><span id="local-6989586621682984423"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682984423"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682984423"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a -&gt; TcM () -&gt; TcM ()
forall a b.
IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; TcM ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-467"></span><span>
</span><span id="line-468"></span><span id="local-6989586621682983080"><span id="local-6989586621682983081"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-type">getTopEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983080"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983081"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span></span></span><span>
</span><span id="line-469"></span><span id="getTopEnv"><span class="annot"><span class="annottext">getTopEnv :: forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var hs-var">getTopEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984426"><span class="annot"><a href="#local-6989586621682984426"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env gbl lcl) (Env gbl lcl)
forall env. IOEnv env env
</span><a href="GHC.Data.IOEnv.html#getEnv"><span class="hs-identifier hs-var">getEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#env_top"><span class="hs-identifier hs-var">env_top</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984426"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-470"></span><span>
</span><span id="line-471"></span><span id="local-6989586621682983087"><span id="local-6989586621682983088"><span id="local-6989586621682983089"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updTopEnv"><span class="hs-identifier hs-type">updTopEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983087"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983088"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983089"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983087"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983088"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983089"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-472"></span><span id="updTopEnv"><span class="annot"><span class="annottext">updTopEnv :: forall gbl lcl a.
(HscEnv -&gt; HscEnv) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updTopEnv"><span class="hs-identifier hs-var hs-var">updTopEnv</span></a></span></span><span> </span><span id="local-6989586621682984428"><span class="annot"><span class="annottext">HscEnv -&gt; HscEnv
</span><a href="#local-6989586621682984428"><span class="hs-identifier hs-var">upd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Env gbl lcl -&gt; Env gbl lcl)
-&gt; IOEnv (Env gbl lcl) a -&gt; IOEnv (Env gbl lcl) a
forall env env' a. (env -&gt; env') -&gt; IOEnv env' a -&gt; IOEnv env a
</span><a href="GHC.Data.IOEnv.html#updEnv"><span class="hs-identifier hs-var">updEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682984430"><span class="annot"><span class="annottext">env :: Env gbl lcl
</span><a href="#local-6989586621682984430"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">env_top :: forall gbl lcl. Env gbl lcl -&gt; HscEnv
</span><a href="GHC.Tc.Types.html#env_top"><span class="hs-identifier hs-var">env_top</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682984431"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682984431"><span class="hs-identifier hs-var">top</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-473"></span><span>                          </span><span class="annot"><span class="annottext">Env gbl lcl
</span><a href="#local-6989586621682984430"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#env_top"><span class="hs-identifier hs-var">env_top</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682984428"><span class="hs-identifier hs-type">upd</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984431"><span class="hs-identifier hs-type">top</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-474"></span><span>
</span><span id="line-475"></span><span id="local-6989586621682983096"><span id="local-6989586621682983097"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-type">getGblEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983096"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983097"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983096"><span class="hs-identifier hs-type">gbl</span></a></span></span></span><span>
</span><span id="line-476"></span><span id="getGblEnv"><span class="annot"><span class="annottext">getGblEnv :: forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var hs-var">getGblEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span class="hs-special">{</span><span id="local-6989586621682984434"><span id="local-6989586621682984435"><span id="local-6989586621682984436"><span id="local-6989586621682984437"><span class="annot"><a href="GHC.Tc.Types.html#env_top"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env gbl lcl) (Env gbl lcl)
forall env. IOEnv env env
</span><a href="GHC.Data.IOEnv.html#getEnv"><span class="hs-identifier hs-var">getEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682984436"><span class="hs-identifier hs-type">env_gbl</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-477"></span><span>
</span><span id="line-478"></span><span id="local-6989586621682983106"><span id="local-6989586621682983107"><span id="local-6989586621682983108"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updGblEnv"><span class="hs-identifier hs-type">updGblEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682983106"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682983106"><span class="hs-identifier hs-type">gbl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983106"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983107"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983108"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983106"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983107"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983108"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-479"></span><span id="updGblEnv"><span class="annot"><span class="annottext">updGblEnv :: forall gbl lcl a.
(gbl -&gt; gbl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updGblEnv"><span class="hs-identifier hs-var hs-var">updGblEnv</span></a></span></span><span> </span><span id="local-6989586621682984438"><span class="annot"><span class="annottext">gbl -&gt; gbl
</span><a href="#local-6989586621682984438"><span class="hs-identifier hs-var">upd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Env gbl lcl -&gt; Env gbl lcl)
-&gt; IOEnv (Env gbl lcl) a -&gt; IOEnv (Env gbl lcl) a
forall env env' a. (env -&gt; env') -&gt; IOEnv env' a -&gt; IOEnv env a
</span><a href="GHC.Data.IOEnv.html#updEnv"><span class="hs-identifier hs-var">updEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682984439"><span class="annot"><span class="annottext">env :: Env gbl lcl
</span><a href="#local-6989586621682984439"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">env_gbl :: forall gbl lcl. Env gbl lcl -&gt; gbl
</span><a href="GHC.Tc.Types.html#env_gbl"><span class="hs-identifier hs-var">env_gbl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682984440"><span class="annot"><span class="annottext">gbl
</span><a href="#local-6989586621682984440"><span class="hs-identifier hs-var">gbl</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-480"></span><span>                          </span><span class="annot"><span class="annottext">Env gbl lcl
</span><a href="#local-6989586621682984439"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#env_gbl"><span class="hs-identifier hs-var">env_gbl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682984438"><span class="hs-identifier hs-type">upd</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984440"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-481"></span><span>
</span><span id="line-482"></span><span id="local-6989586621682983112"><span id="local-6989586621682983113"><span id="local-6989586621682983114"><span id="local-6989586621682983115"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setGblEnv"><span class="hs-identifier hs-type">setGblEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621682983112"><span class="hs-identifier hs-type">gbl'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983112"><span class="hs-identifier hs-type">gbl'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983113"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983114"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983115"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983113"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983114"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span><span>
</span><span id="line-483"></span><span id="setGblEnv"><span class="annot"><span class="annottext">setGblEnv :: forall gbl' lcl a gbl.
gbl' -&gt; TcRnIf gbl' lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#setGblEnv"><span class="hs-identifier hs-var hs-var">setGblEnv</span></a></span></span><span> </span><span id="local-6989586621682984441"><span class="annot"><span class="annottext">gbl'
</span><a href="#local-6989586621682984441"><span class="hs-identifier hs-var">gbl_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Env gbl lcl -&gt; Env gbl' lcl)
-&gt; IOEnv (Env gbl' lcl) a -&gt; IOEnv (Env gbl lcl) a
forall env env' a. (env -&gt; env') -&gt; IOEnv env' a -&gt; IOEnv env a
</span><a href="GHC.Data.IOEnv.html#updEnv"><span class="hs-identifier hs-var">updEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682984442"><span class="annot"><span class="annottext">Env gbl lcl
</span><a href="#local-6989586621682984442"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Env gbl lcl
</span><a href="#local-6989586621682984442"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#env_gbl"><span class="hs-identifier hs-var">env_gbl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682984441"><span class="hs-identifier hs-type">gbl_env</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-484"></span><span>
</span><span id="line-485"></span><span id="local-6989586621682983120"><span id="local-6989586621682983121"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-type">getLclEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983120"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983121"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983121"><span class="hs-identifier hs-type">lcl</span></a></span></span></span><span>
</span><span id="line-486"></span><span id="getLclEnv"><span class="annot"><span class="annottext">getLclEnv :: forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var hs-var">getLclEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span class="hs-special">{</span><span id="local-6989586621682984445"><span id="local-6989586621682984446"><span id="local-6989586621682984447"><span id="local-6989586621682984448"><span class="annot"><a href="GHC.Tc.Types.html#env_top"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env gbl lcl) (Env gbl lcl)
forall env. IOEnv env env
</span><a href="GHC.Data.IOEnv.html#getEnv"><span class="hs-identifier hs-var">getEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682984448"><span class="hs-identifier hs-type">env_lcl</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-487"></span><span>
</span><span id="line-488"></span><span id="local-6989586621682983124"><span id="local-6989586621682983125"><span id="local-6989586621682983126"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-type">updLclEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682983124"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682983124"><span class="hs-identifier hs-type">lcl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983125"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983124"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983126"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983125"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983124"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983126"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-489"></span><span id="updLclEnv"><span class="annot"><span class="annottext">updLclEnv :: forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var hs-var">updLclEnv</span></a></span></span><span> </span><span id="local-6989586621682984449"><span class="annot"><span class="annottext">lcl -&gt; lcl
</span><a href="#local-6989586621682984449"><span class="hs-identifier hs-var">upd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Env gbl lcl -&gt; Env gbl lcl)
-&gt; IOEnv (Env gbl lcl) a -&gt; IOEnv (Env gbl lcl) a
forall env env' a. (env -&gt; env') -&gt; IOEnv env' a -&gt; IOEnv env a
</span><a href="GHC.Data.IOEnv.html#updEnv"><span class="hs-identifier hs-var">updEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682984450"><span class="annot"><span class="annottext">env :: Env gbl lcl
</span><a href="#local-6989586621682984450"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">env_lcl :: forall gbl lcl. Env gbl lcl -&gt; lcl
</span><a href="GHC.Tc.Types.html#env_lcl"><span class="hs-identifier hs-var">env_lcl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682984451"><span class="annot"><span class="annottext">lcl
</span><a href="#local-6989586621682984451"><span class="hs-identifier hs-var">lcl</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-490"></span><span>                          </span><span class="annot"><span class="annottext">Env gbl lcl
</span><a href="#local-6989586621682984450"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#env_lcl"><span class="hs-identifier hs-var">env_lcl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682984449"><span class="hs-identifier hs-type">upd</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984451"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-491"></span><span>
</span><span id="line-492"></span><span id="local-6989586621682983130"><span id="local-6989586621682983131"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updLclCtxt"><span class="hs-identifier hs-type">updLclCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#TcLclCtxt"><span class="hs-identifier hs-type">TcLclCtxt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#TcLclCtxt"><span class="hs-identifier hs-type">TcLclCtxt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983130"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983131"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983130"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983131"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-493"></span><span id="updLclCtxt"><span class="annot"><span class="annottext">updLclCtxt :: forall gbl a.
(TcLclCtxt -&gt; TcLclCtxt)
-&gt; TcRnIf gbl TcLclEnv a -&gt; TcRnIf gbl TcLclEnv a
</span><a href="GHC.Tc.Utils.Monad.html#updLclCtxt"><span class="hs-identifier hs-var hs-var">updLclCtxt</span></a></span></span><span> </span><span id="local-6989586621682984452"><span class="annot"><span class="annottext">TcLclCtxt -&gt; TcLclCtxt
</span><a href="#local-6989586621682984452"><span class="hs-identifier hs-var">upd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcLclEnv -&gt; TcLclEnv)
-&gt; TcRnIf gbl TcLclEnv a -&gt; TcRnIf gbl TcLclEnv a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TcLclCtxt -&gt; TcLclCtxt) -&gt; TcLclEnv -&gt; TcLclEnv
</span><a href="GHC.Tc.Types.LclEnv.html#modifyLclCtxt"><span class="hs-identifier hs-var">modifyLclCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclCtxt -&gt; TcLclCtxt
</span><a href="#local-6989586621682984452"><span class="hs-identifier hs-var">upd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-494"></span><span>
</span><span id="line-495"></span><span id="local-6989586621682983134"><span id="local-6989586621682983135"><span id="local-6989586621682983136"><span id="local-6989586621682983137"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setLclEnv"><span class="hs-identifier hs-type">setLclEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621682983134"><span class="hs-identifier hs-type">lcl'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983135"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983134"><span class="hs-identifier hs-type">lcl'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983136"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983135"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983137"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983136"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span><span>
</span><span id="line-496"></span><span id="setLclEnv"><span class="annot"><span class="annottext">setLclEnv :: forall lcl' gbl a lcl.
lcl' -&gt; TcRnIf gbl lcl' a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#setLclEnv"><span class="hs-identifier hs-var hs-var">setLclEnv</span></a></span></span><span> </span><span id="local-6989586621682984454"><span class="annot"><span class="annottext">lcl'
</span><a href="#local-6989586621682984454"><span class="hs-identifier hs-var">lcl_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Env gbl lcl -&gt; Env gbl lcl')
-&gt; IOEnv (Env gbl lcl') a -&gt; IOEnv (Env gbl lcl) a
forall env env' a. (env -&gt; env') -&gt; IOEnv env' a -&gt; IOEnv env a
</span><a href="GHC.Data.IOEnv.html#updEnv"><span class="hs-identifier hs-var">updEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682984455"><span class="annot"><span class="annottext">Env gbl lcl
</span><a href="#local-6989586621682984455"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Env gbl lcl
</span><a href="#local-6989586621682984455"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#env_lcl"><span class="hs-identifier hs-var">env_lcl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682984454"><span class="hs-identifier hs-type">lcl_env</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-497"></span><span>
</span><span id="line-498"></span><span id="local-6989586621682983142"><span id="local-6989586621682983143"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#restoreLclEnv"><span class="hs-identifier hs-type">restoreLclEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983142"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983143"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983142"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983143"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-499"></span><span class="hs-comment">-- See Note [restoreLclEnv vs setLclEnv]</span><span>
</span><span id="line-500"></span><span id="restoreLclEnv"><span class="annot"><span class="annottext">restoreLclEnv :: forall gbl a.
TcLclEnv -&gt; TcRnIf gbl TcLclEnv a -&gt; TcRnIf gbl TcLclEnv a
</span><a href="GHC.Tc.Utils.Monad.html#restoreLclEnv"><span class="hs-identifier hs-var hs-var">restoreLclEnv</span></a></span></span><span> </span><span id="local-6989586621682984456"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682984456"><span class="hs-identifier hs-var">new_lcl_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcLclEnv -&gt; TcLclEnv)
-&gt; TcRnIf gbl TcLclEnv a -&gt; TcRnIf gbl TcLclEnv a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv -&gt; TcLclEnv
</span><a href="#local-6989586621682984457"><span class="hs-identifier hs-var">upd</span></a></span><span>
</span><span id="line-501"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-502"></span><span>    </span><span id="local-6989586621682984457"><span class="annot"><span class="annottext">upd :: TcLclEnv -&gt; TcLclEnv
</span><a href="#local-6989586621682984457"><span class="hs-identifier hs-var hs-var">upd</span></a></span></span><span> </span><span id="local-6989586621682984458"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682984458"><span class="hs-identifier hs-var">old_lcl_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682984456"><span class="hs-identifier hs-var">new_lcl_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#tcl_errs"><span class="hs-identifier hs-var">tcl_errs</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#tcl_errs"><span class="hs-identifier hs-var">tcl_errs</span></a></span><span>  </span><span class="annot"><a href="#local-6989586621682984458"><span class="hs-identifier hs-type">old_lcl_env</span></a></span><span>
</span><span id="line-503"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#tcl_lie"><span class="hs-identifier hs-var">tcl_lie</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#tcl_lie"><span class="hs-identifier hs-var">tcl_lie</span></a></span><span>   </span><span class="annot"><a href="#local-6989586621682984458"><span class="hs-identifier hs-type">old_lcl_env</span></a></span><span>
</span><span id="line-504"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#tcl_usage"><span class="hs-identifier hs-var">tcl_usage</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#tcl_usage"><span class="hs-identifier hs-var">tcl_usage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984458"><span class="hs-identifier hs-type">old_lcl_env</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-505"></span><span>
</span><span id="line-506"></span><span id="local-6989586621682983146"><span id="local-6989586621682983147"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getEnvs"><span class="hs-identifier hs-type">getEnvs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983146"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983147"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682983146"><span class="hs-identifier hs-type">gbl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682983147"><span class="hs-identifier hs-type">lcl</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-507"></span><span id="getEnvs"><span class="annot"><span class="annottext">getEnvs :: forall gbl lcl. TcRnIf gbl lcl (gbl, lcl)
</span><a href="GHC.Tc.Utils.Monad.html#getEnvs"><span class="hs-identifier hs-var hs-var">getEnvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984461"><span class="annot"><a href="#local-6989586621682984461"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env gbl lcl) (Env gbl lcl)
forall env. IOEnv env env
</span><a href="GHC.Data.IOEnv.html#getEnv"><span class="hs-identifier hs-var">getEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#env_gbl"><span class="hs-identifier hs-var">env_gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984461"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#env_lcl"><span class="hs-identifier hs-var">env_lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984461"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-508"></span><span>
</span><span id="line-509"></span><span id="local-6989586621682983150"><span id="local-6989586621682983151"><span id="local-6989586621682983152"><span id="local-6989586621682983153"><span id="local-6989586621682983154"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setEnvs"><span class="hs-identifier hs-type">setEnvs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682983150"><span class="hs-identifier hs-type">gbl'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682983151"><span class="hs-identifier hs-type">lcl'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983150"><span class="hs-identifier hs-type">gbl'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983151"><span class="hs-identifier hs-type">lcl'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983152"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983153"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983154"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983152"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span></span><span>
</span><span id="line-510"></span><span id="setEnvs"><span class="annot"><span class="annottext">setEnvs :: forall gbl' lcl' a gbl lcl.
(gbl', lcl') -&gt; TcRnIf gbl' lcl' a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#setEnvs"><span class="hs-identifier hs-var hs-var">setEnvs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682984462"><span class="annot"><span class="annottext">gbl'
</span><a href="#local-6989586621682984462"><span class="hs-identifier hs-var">gbl_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682984463"><span class="annot"><span class="annottext">lcl'
</span><a href="#local-6989586621682984463"><span class="hs-identifier hs-var">lcl_env</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">gbl' -&gt; TcRnIf gbl' lcl a -&gt; TcRnIf gbl lcl a
forall gbl' lcl a gbl.
gbl' -&gt; TcRnIf gbl' lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#setGblEnv"><span class="hs-identifier hs-var">setGblEnv</span></a></span><span> </span><span class="annot"><span class="annottext">gbl'
</span><a href="#local-6989586621682984462"><span class="hs-identifier hs-var">gbl_env</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnIf gbl' lcl a -&gt; TcRnIf gbl lcl a)
-&gt; (TcRnIf gbl' lcl' a -&gt; TcRnIf gbl' lcl a)
-&gt; TcRnIf gbl' lcl' a
-&gt; TcRnIf gbl lcl a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">lcl' -&gt; TcRnIf gbl' lcl' a -&gt; TcRnIf gbl' lcl a
forall lcl' gbl a lcl.
lcl' -&gt; TcRnIf gbl lcl' a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#setLclEnv"><span class="hs-identifier hs-var">setLclEnv</span></a></span><span> </span><span class="annot"><span class="annottext">lcl'
</span><a href="#local-6989586621682984463"><span class="hs-identifier hs-var">lcl_env</span></a></span><span>
</span><span id="line-511"></span><span>
</span><span id="line-512"></span><span id="local-6989586621682983163"><span id="local-6989586621682983164"><span id="local-6989586621682983165"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updEnvs"><span class="hs-identifier hs-type">updEnvs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682983163"><span class="hs-identifier hs-type">gbl</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621682983164"><span class="hs-identifier hs-type">lcl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682983163"><span class="hs-identifier hs-type">gbl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682983164"><span class="hs-identifier hs-type">lcl</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983163"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983164"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983165"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983163"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983164"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983165"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-513"></span><span id="updEnvs"><span class="annot"><span class="annottext">updEnvs :: forall gbl lcl a.
((gbl, lcl) -&gt; (gbl, lcl)) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updEnvs"><span class="hs-identifier hs-var hs-var">updEnvs</span></a></span></span><span> </span><span id="local-6989586621682984465"><span class="annot"><span class="annottext">(gbl, lcl) -&gt; (gbl, lcl)
</span><a href="#local-6989586621682984465"><span class="hs-identifier hs-var">upd_envs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Env gbl lcl -&gt; Env gbl lcl)
-&gt; IOEnv (Env gbl lcl) a -&gt; IOEnv (Env gbl lcl) a
forall env env' a. (env -&gt; env') -&gt; IOEnv env' a -&gt; IOEnv env a
</span><a href="GHC.Data.IOEnv.html#updEnv"><span class="hs-identifier hs-var">updEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Env gbl lcl -&gt; Env gbl lcl
</span><a href="#local-6989586621682984466"><span class="hs-identifier hs-var">upd</span></a></span><span>
</span><span id="line-514"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-515"></span><span>    </span><span id="local-6989586621682984466"><span class="annot"><span class="annottext">upd :: Env gbl lcl -&gt; Env gbl lcl
</span><a href="#local-6989586621682984466"><span class="hs-identifier hs-var hs-var">upd</span></a></span></span><span> </span><span id="local-6989586621682984467"><span class="annot"><span class="annottext">env :: Env gbl lcl
</span><a href="#local-6989586621682984467"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">env_gbl :: forall gbl lcl. Env gbl lcl -&gt; gbl
</span><a href="GHC.Tc.Types.html#env_gbl"><span class="hs-identifier hs-var">env_gbl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682984468"><span class="annot"><span class="annottext">gbl
</span><a href="#local-6989586621682984468"><span class="hs-identifier hs-var">gbl</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">env_lcl :: forall gbl lcl. Env gbl lcl -&gt; lcl
</span><a href="GHC.Tc.Types.html#env_lcl"><span class="hs-identifier hs-var">env_lcl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682984469"><span class="annot"><span class="annottext">lcl
</span><a href="#local-6989586621682984469"><span class="hs-identifier hs-var">lcl</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-516"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Env gbl lcl
</span><a href="#local-6989586621682984467"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#env_gbl"><span class="hs-identifier hs-var">env_gbl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682984470"><span class="hs-identifier hs-type">gbl'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#env_lcl"><span class="hs-identifier hs-var">env_lcl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682984471"><span class="hs-identifier hs-type">lcl'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-517"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-518"></span><span>        </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span id="local-6989586621682984470"><span class="annot"><span class="annottext">gbl
</span><a href="#local-6989586621682984470"><span class="hs-identifier hs-var">gbl'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682984471"><span class="annot"><span class="annottext">lcl
</span><a href="#local-6989586621682984471"><span class="hs-identifier hs-var">lcl'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(gbl, lcl) -&gt; (gbl, lcl)
</span><a href="#local-6989586621682984465"><span class="hs-identifier hs-var">upd_envs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">gbl
</span><a href="#local-6989586621682984468"><span class="hs-identifier hs-var">gbl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lcl
</span><a href="#local-6989586621682984469"><span class="hs-identifier hs-var">lcl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-519"></span><span>
</span><span id="line-520"></span><span id="local-6989586621682983169"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#restoreEnvs"><span class="hs-identifier hs-type">restoreEnvs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983169"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983169"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-521"></span><span class="hs-comment">-- See Note [restoreLclEnv vs setLclEnv]</span><span>
</span><span id="line-522"></span><span id="restoreEnvs"><span class="annot"><span class="annottext">restoreEnvs :: forall a. (TcGblEnv, TcLclEnv) -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#restoreEnvs"><span class="hs-identifier hs-var hs-var">restoreEnvs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682984472"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682984472"><span class="hs-identifier hs-var">gbl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682984473"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682984473"><span class="hs-identifier hs-var">lcl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv
-&gt; TcRnIf TcGblEnv TcLclEnv a -&gt; TcRnIf TcGblEnv TcLclEnv a
forall gbl' lcl a gbl.
gbl' -&gt; TcRnIf gbl' lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#setGblEnv"><span class="hs-identifier hs-var">setGblEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682984472"><span class="hs-identifier hs-var">gbl</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnIf TcGblEnv TcLclEnv a -&gt; TcRnIf TcGblEnv TcLclEnv a)
-&gt; (TcRnIf TcGblEnv TcLclEnv a -&gt; TcRnIf TcGblEnv TcLclEnv a)
-&gt; TcRnIf TcGblEnv TcLclEnv a
-&gt; TcRnIf TcGblEnv TcLclEnv a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
-&gt; TcRnIf TcGblEnv TcLclEnv a -&gt; TcRnIf TcGblEnv TcLclEnv a
forall gbl a.
TcLclEnv -&gt; TcRnIf gbl TcLclEnv a -&gt; TcRnIf gbl TcLclEnv a
</span><a href="GHC.Tc.Utils.Monad.html#restoreLclEnv"><span class="hs-identifier hs-var">restoreLclEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682984473"><span class="hs-identifier hs-var">lcl</span></a></span><span>
</span><span id="line-523"></span><span>
</span><span id="line-524"></span><span class="hs-comment">{- Note [restoreLclEnv vs setLclEnv]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In the typechecker we use this idiom quite a lot
   do { (gbl_env, lcl_env) &lt;- tcRnSrcDecls ...
      ; setGblEnv gbl_env $ setLclEnv lcl_env $
        more_stuff }

The `tcRnSrcDecls` extends the environments in `gbl_env` and `lcl_env`
which we then want to be in scope in `more stuff`.

The problem is that `lcl_env :: TcLclEnv` has an IORef for error
messages `tcl_errs`, and another for constraints (`tcl_lie`), and
another for Linear Haskell usage information (`tcl_usage`).  Now
suppose we change it a tiny bit
   do { (gbl_env, lcl_env) &lt;- checkNoErrs $
                              tcRnSrcDecls ...
      ; setGblEnv gbl_env $ setLclEnv lcl_env $
        more_stuff }

That should be innocuous.  But *alas*, `checkNoErrs` gathers errors in
a fresh IORef *which is then captured in the returned `lcl_env`.  When
we do the `setLclEnv` we'll make that captured IORef into the place
where we gather error messages -- but no one is going to look at that!!!
This led to #19470 and #20981.

Solution: instead of setLclEnv use restoreLclEnv, which preserves from
the /parent/ context these mutable collection IORefs:
      tcl_errs, tcl_lie, tcl_usage
-}</span><span>
</span><span id="line-553"></span><span>
</span><span id="line-554"></span><span class="hs-comment">-- Command-line flags</span><span>
</span><span id="line-555"></span><span>
</span><span id="line-556"></span><span id="local-6989586621682983173"><span id="local-6989586621682983174"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-type">xoptM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LangExt.Extension</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983173"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983174"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-557"></span><span id="xoptM"><span class="annot"><span class="annottext">xoptM :: forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var hs-var">xoptM</span></a></span></span><span> </span><span id="local-6989586621682984477"><span class="annot"><span class="annottext">Extension
</span><a href="#local-6989586621682984477"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#xopt"><span class="hs-identifier hs-var">xopt</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="#local-6989586621682984477"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; Bool)
-&gt; IOEnv (Env gbl lcl) DynFlags -&gt; IOEnv (Env gbl lcl) Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env gbl lcl) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-558"></span><span>
</span><span id="line-559"></span><span id="local-6989586621682983181"><span id="local-6989586621682983182"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#doptM"><span class="hs-identifier hs-type">doptM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#DumpFlag"><span class="hs-identifier hs-type">DumpFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983181"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983182"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-560"></span><span id="doptM"><span class="annot"><span class="annottext">doptM :: forall gbl lcl. DumpFlag -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#doptM"><span class="hs-identifier hs-var hs-var">doptM</span></a></span></span><span> </span><span id="local-6989586621682984485"><span class="annot"><span class="annottext">DumpFlag
</span><a href="#local-6989586621682984485"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-561"></span><span>  </span><span id="local-6989586621682984486"><span class="annot"><a href="#local-6989586621682984486"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env gbl lcl) Logger
forall (m :: * -&gt; *). HasLogger m =&gt; m Logger
</span><a href="GHC.Utils.Logger.html#getLogger"><span class="hs-identifier hs-var">getLogger</span></a></span><span>
</span><span id="line-562"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Logger.html#logHasDumpFlag"><span class="hs-identifier hs-type">logHasDumpFlag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984486"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984485"><span class="hs-identifier hs-type">flag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-563"></span><span>
</span><span id="line-564"></span><span id="local-6989586621682983186"><span id="local-6989586621682983187"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#goptM"><span class="hs-identifier hs-type">goptM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#GeneralFlag"><span class="hs-identifier hs-type">GeneralFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983186"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983187"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-565"></span><span id="goptM"><span class="annot"><span class="annottext">goptM :: forall gbl lcl. GeneralFlag -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#goptM"><span class="hs-identifier hs-var hs-var">goptM</span></a></span></span><span> </span><span id="local-6989586621682984491"><span class="annot"><span class="annottext">GeneralFlag
</span><a href="#local-6989586621682984491"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="#local-6989586621682984491"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; Bool)
-&gt; IOEnv (Env gbl lcl) DynFlags -&gt; IOEnv (Env gbl lcl) Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env gbl lcl) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-566"></span><span>
</span><span id="line-567"></span><span id="local-6989586621682983191"><span id="local-6989586621682983192"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#woptM"><span class="hs-identifier hs-type">woptM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#WarningFlag"><span class="hs-identifier hs-type">WarningFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983191"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983192"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-568"></span><span id="woptM"><span class="annot"><span class="annottext">woptM :: forall gbl lcl. WarningFlag -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#woptM"><span class="hs-identifier hs-var hs-var">woptM</span></a></span></span><span> </span><span id="local-6989586621682984495"><span class="annot"><span class="annottext">WarningFlag
</span><a href="#local-6989586621682984495"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WarningFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#wopt"><span class="hs-identifier hs-var">wopt</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="#local-6989586621682984495"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; Bool)
-&gt; IOEnv (Env gbl lcl) DynFlags -&gt; IOEnv (Env gbl lcl) Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env gbl lcl) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-569"></span><span>
</span><span id="line-570"></span><span id="local-6989586621682983195"><span id="local-6989586621682983196"><span id="local-6989586621682983197"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setXOptM"><span class="hs-identifier hs-type">setXOptM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LangExt.Extension</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983195"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983196"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983197"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983195"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983196"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983197"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-571"></span><span id="setXOptM"><span class="annot"><span class="annottext">setXOptM :: forall gbl lcl a. Extension -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#setXOptM"><span class="hs-identifier hs-var hs-var">setXOptM</span></a></span></span><span> </span><span id="local-6989586621682984497"><span class="annot"><span class="annottext">Extension
</span><a href="#local-6989586621682984497"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; DynFlags) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
forall gbl lcl a.
(DynFlags -&gt; DynFlags) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updTopFlags"><span class="hs-identifier hs-var">updTopFlags</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682984498"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682984498"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Extension -&gt; DynFlags
</span><a href="GHC.Driver.DynFlags.html#xopt_set"><span class="hs-identifier hs-var">xopt_set</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682984498"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="#local-6989586621682984497"><span class="hs-identifier hs-var">flag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-572"></span><span>
</span><span id="line-573"></span><span id="local-6989586621682984500"><span id="local-6989586621682984501"><span id="local-6989586621682984502"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#unsetXOptM"><span class="hs-identifier hs-type">unsetXOptM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LangExt.Extension</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984500"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984501"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984502"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984500"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984501"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984502"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-574"></span><span id="unsetXOptM"><span class="annot"><span class="annottext">unsetXOptM :: forall gbl lcl a. Extension -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#unsetXOptM"><span class="hs-identifier hs-var hs-var">unsetXOptM</span></a></span></span><span> </span><span id="local-6989586621682984503"><span class="annot"><span class="annottext">Extension
</span><a href="#local-6989586621682984503"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; DynFlags) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
forall gbl lcl a.
(DynFlags -&gt; DynFlags) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updTopFlags"><span class="hs-identifier hs-var">updTopFlags</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682984504"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682984504"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Extension -&gt; DynFlags
</span><a href="GHC.Driver.DynFlags.html#xopt_unset"><span class="hs-identifier hs-var">xopt_unset</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682984504"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="#local-6989586621682984503"><span class="hs-identifier hs-var">flag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-575"></span><span>
</span><span id="line-576"></span><span id="local-6989586621682983207"><span id="local-6989586621682983208"><span id="local-6989586621682983209"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#unsetGOptM"><span class="hs-identifier hs-type">unsetGOptM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#GeneralFlag"><span class="hs-identifier hs-type">GeneralFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983207"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983208"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983209"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983207"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983208"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983209"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-577"></span><span id="unsetGOptM"><span class="annot"><span class="annottext">unsetGOptM :: forall gbl lcl a.
GeneralFlag -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#unsetGOptM"><span class="hs-identifier hs-var hs-var">unsetGOptM</span></a></span></span><span> </span><span id="local-6989586621682984506"><span class="annot"><span class="annottext">GeneralFlag
</span><a href="#local-6989586621682984506"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; DynFlags) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
forall gbl lcl a.
(DynFlags -&gt; DynFlags) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updTopFlags"><span class="hs-identifier hs-var">updTopFlags</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682984507"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682984507"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; GeneralFlag -&gt; DynFlags
</span><a href="GHC.Driver.DynFlags.html#gopt_unset"><span class="hs-identifier hs-var">gopt_unset</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682984507"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="#local-6989586621682984506"><span class="hs-identifier hs-var">flag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-578"></span><span>
</span><span id="line-579"></span><span id="local-6989586621682983213"><span id="local-6989586621682983214"><span id="local-6989586621682983215"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#unsetWOptM"><span class="hs-identifier hs-type">unsetWOptM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#WarningFlag"><span class="hs-identifier hs-type">WarningFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983213"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983214"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983215"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983213"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983214"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983215"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-580"></span><span id="unsetWOptM"><span class="annot"><span class="annottext">unsetWOptM :: forall gbl lcl a.
WarningFlag -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#unsetWOptM"><span class="hs-identifier hs-var hs-var">unsetWOptM</span></a></span></span><span> </span><span id="local-6989586621682984509"><span class="annot"><span class="annottext">WarningFlag
</span><a href="#local-6989586621682984509"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; DynFlags) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
forall gbl lcl a.
(DynFlags -&gt; DynFlags) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updTopFlags"><span class="hs-identifier hs-var">updTopFlags</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682984510"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682984510"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; WarningFlag -&gt; DynFlags
</span><a href="GHC.Driver.DynFlags.html#wopt_unset"><span class="hs-identifier hs-var">wopt_unset</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682984510"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="#local-6989586621682984509"><span class="hs-identifier hs-var">flag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-581"></span><span>
</span><span id="line-582"></span><span class="annot"><span class="hs-comment">-- | Do it flag is true</span></span><span>
</span><span id="line-583"></span><span id="local-6989586621682983219"><span id="local-6989586621682983220"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#whenDOptM"><span class="hs-identifier hs-type">whenDOptM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#DumpFlag"><span class="hs-identifier hs-type">DumpFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983219"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983220"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983219"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983220"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-584"></span><span id="whenDOptM"><span class="annot"><span class="annottext">whenDOptM :: forall gbl lcl. DumpFlag -&gt; TcRnIf gbl lcl () -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#whenDOptM"><span class="hs-identifier hs-var hs-var">whenDOptM</span></a></span></span><span> </span><span id="local-6989586621682984514"><span class="annot"><span class="annottext">DumpFlag
</span><a href="#local-6989586621682984514"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span id="local-6989586621682984515"><span class="annot"><span class="annottext">TcRnIf gbl lcl ()
</span><a href="#local-6989586621682984515"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621682984516"><span class="annot"><a href="#local-6989586621682984516"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DumpFlag -&gt; TcRnIf gbl lcl Bool
forall gbl lcl. DumpFlag -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#doptM"><span class="hs-identifier hs-var">doptM</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="#local-6989586621682984514"><span class="hs-identifier hs-var">flag</span></a></span><span>
</span><span id="line-585"></span><span>                                 </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="annot"><a href="#local-6989586621682984516"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984515"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-586"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#whenDOptM"><span class="hs-pragma hs-type">whenDOptM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-comment">-- see Note [INLINE conditional tracing utilities]</span><span>
</span><span id="line-587"></span><span>
</span><span id="line-588"></span><span>
</span><span id="line-589"></span><span id="local-6989586621682983223"><span id="local-6989586621682983224"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#whenGOptM"><span class="hs-identifier hs-type">whenGOptM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#GeneralFlag"><span class="hs-identifier hs-type">GeneralFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983223"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983224"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983223"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983224"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-590"></span><span id="whenGOptM"><span class="annot"><span class="annottext">whenGOptM :: forall gbl lcl.
GeneralFlag -&gt; TcRnIf gbl lcl () -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#whenGOptM"><span class="hs-identifier hs-var hs-var">whenGOptM</span></a></span></span><span> </span><span id="local-6989586621682984519"><span class="annot"><span class="annottext">GeneralFlag
</span><a href="#local-6989586621682984519"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span id="local-6989586621682984520"><span class="annot"><span class="annottext">TcRnIf gbl lcl ()
</span><a href="#local-6989586621682984520"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621682984521"><span class="annot"><a href="#local-6989586621682984521"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; TcRnIf gbl lcl Bool
forall gbl lcl. GeneralFlag -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#goptM"><span class="hs-identifier hs-var">goptM</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="#local-6989586621682984519"><span class="hs-identifier hs-var">flag</span></a></span><span>
</span><span id="line-591"></span><span>                                 </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="annot"><a href="#local-6989586621682984521"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984520"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-592"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#whenGOptM"><span class="hs-pragma hs-type">whenGOptM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-comment">-- see Note [INLINE conditional tracing utilities]</span><span>
</span><span id="line-593"></span><span>
</span><span id="line-594"></span><span id="local-6989586621682983227"><span id="local-6989586621682983228"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#whenWOptM"><span class="hs-identifier hs-type">whenWOptM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#WarningFlag"><span class="hs-identifier hs-type">WarningFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983227"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983228"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983227"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983228"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-595"></span><span id="whenWOptM"><span class="annot"><span class="annottext">whenWOptM :: forall gbl lcl.
WarningFlag -&gt; TcRnIf gbl lcl () -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#whenWOptM"><span class="hs-identifier hs-var hs-var">whenWOptM</span></a></span></span><span> </span><span id="local-6989586621682984524"><span class="annot"><span class="annottext">WarningFlag
</span><a href="#local-6989586621682984524"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span id="local-6989586621682984525"><span class="annot"><span class="annottext">TcRnIf gbl lcl ()
</span><a href="#local-6989586621682984525"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621682984526"><span class="annot"><a href="#local-6989586621682984526"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WarningFlag -&gt; TcRnIf gbl lcl Bool
forall gbl lcl. WarningFlag -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#woptM"><span class="hs-identifier hs-var">woptM</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="#local-6989586621682984524"><span class="hs-identifier hs-var">flag</span></a></span><span>
</span><span id="line-596"></span><span>                                 </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="annot"><a href="#local-6989586621682984526"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984525"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-597"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#whenWOptM"><span class="hs-pragma hs-type">whenWOptM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-comment">-- see Note [INLINE conditional tracing utilities]</span><span>
</span><span id="line-598"></span><span>
</span><span id="line-599"></span><span id="local-6989586621682983231"><span id="local-6989586621682983232"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#whenXOptM"><span class="hs-identifier hs-type">whenXOptM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LangExt.Extension</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983231"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983232"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983231"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983232"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-600"></span><span id="whenXOptM"><span class="annot"><span class="annottext">whenXOptM :: forall gbl lcl. Extension -&gt; TcRnIf gbl lcl () -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#whenXOptM"><span class="hs-identifier hs-var hs-var">whenXOptM</span></a></span></span><span> </span><span id="local-6989586621682984529"><span class="annot"><span class="annottext">Extension
</span><a href="#local-6989586621682984529"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span id="local-6989586621682984530"><span class="annot"><span class="annottext">TcRnIf gbl lcl ()
</span><a href="#local-6989586621682984530"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621682984531"><span class="annot"><a href="#local-6989586621682984531"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf gbl lcl Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="#local-6989586621682984529"><span class="hs-identifier hs-var">flag</span></a></span><span>
</span><span id="line-601"></span><span>                                 </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="annot"><a href="#local-6989586621682984531"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984530"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-602"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#whenXOptM"><span class="hs-pragma hs-type">whenXOptM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-comment">-- see Note [INLINE conditional tracing utilities]</span><span>
</span><span id="line-603"></span><span>
</span><span id="line-604"></span><span id="local-6989586621682984532"><span id="local-6989586621682984533"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#unlessXOptM"><span class="hs-identifier hs-type">unlessXOptM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LangExt.Extension</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984532"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984533"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984532"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984533"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-605"></span><span id="unlessXOptM"><span class="annot"><span class="annottext">unlessXOptM :: forall gbl lcl. Extension -&gt; TcRnIf gbl lcl () -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#unlessXOptM"><span class="hs-identifier hs-var hs-var">unlessXOptM</span></a></span></span><span> </span><span id="local-6989586621682984536"><span class="annot"><span class="annottext">Extension
</span><a href="#local-6989586621682984536"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span id="local-6989586621682984537"><span class="annot"><span class="annottext">TcRnIf gbl lcl ()
</span><a href="#local-6989586621682984537"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621682984538"><span class="annot"><a href="#local-6989586621682984538"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf gbl lcl Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="#local-6989586621682984536"><span class="hs-identifier hs-var">flag</span></a></span><span>
</span><span id="line-606"></span><span>                                   </span><span class="annot"><span class="hs-identifier hs-type">unless</span></span><span> </span><span class="annot"><a href="#local-6989586621682984538"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984537"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-607"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#unlessXOptM"><span class="hs-pragma hs-type">unlessXOptM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-comment">-- see Note [INLINE conditional tracing utilities]</span><span>
</span><span id="line-608"></span><span>
</span><span id="line-609"></span><span id="local-6989586621682983237"><span id="local-6989586621682983238"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getGhcMode"><span class="hs-identifier hs-type">getGhcMode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983237"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983238"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#GhcMode"><span class="hs-identifier hs-type">GhcMode</span></a></span></span></span><span>
</span><span id="line-610"></span><span id="getGhcMode"><span class="annot"><span class="annottext">getGhcMode :: forall gbl lcl. TcRnIf gbl lcl GhcMode
</span><a href="GHC.Tc.Utils.Monad.html#getGhcMode"><span class="hs-identifier hs-var hs-var">getGhcMode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; GhcMode
</span><a href="GHC.Driver.DynFlags.html#ghcMode"><span class="hs-identifier hs-var">ghcMode</span></a></span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; GhcMode)
-&gt; IOEnv (Env gbl lcl) DynFlags -&gt; IOEnv (Env gbl lcl) GhcMode
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env gbl lcl) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-611"></span><span>
</span><span id="line-612"></span><span id="local-6989586621682983242"><span id="local-6989586621682983243"><span id="local-6989586621682983244"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#withoutDynamicNow"><span class="hs-identifier hs-type">withoutDynamicNow</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983242"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983243"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983244"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983242"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983243"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983244"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-613"></span><span id="withoutDynamicNow"><span class="annot"><span class="annottext">withoutDynamicNow :: forall gbl lcl a. TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#withoutDynamicNow"><span class="hs-identifier hs-var hs-var">withoutDynamicNow</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; DynFlags) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
forall gbl lcl a.
(DynFlags -&gt; DynFlags) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updTopFlags"><span class="hs-identifier hs-var">updTopFlags</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682984544"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682984544"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682984544"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#dynamicNow"><span class="hs-identifier hs-var">dynamicNow</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-614"></span><span>
</span><span id="line-615"></span><span id="local-6989586621682983201"><span id="local-6989586621682983202"><span id="local-6989586621682983203"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updTopFlags"><span class="hs-identifier hs-type">updTopFlags</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983201"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983202"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983203"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983201"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983202"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983203"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-616"></span><span id="updTopFlags"><span class="annot"><span class="annottext">updTopFlags :: forall gbl lcl a.
(DynFlags -&gt; DynFlags) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updTopFlags"><span class="hs-identifier hs-var hs-var">updTopFlags</span></a></span></span><span> </span><span id="local-6989586621682984546"><span class="annot"><span class="annottext">DynFlags -&gt; DynFlags
</span><a href="#local-6989586621682984546"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HscEnv -&gt; HscEnv) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
forall gbl lcl a.
(HscEnv -&gt; HscEnv) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updTopEnv"><span class="hs-identifier hs-var">updTopEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DynFlags -&gt; DynFlags) -&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Env.html#hscUpdateFlags"><span class="hs-identifier hs-var">hscUpdateFlags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; DynFlags
</span><a href="#local-6989586621682984546"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-617"></span><span>
</span><span id="line-618"></span><span id="local-6989586621682983251"><span id="local-6989586621682983252"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getEpsVar"><span class="hs-identifier hs-type">getEpsVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983251"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983252"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.External.html#ExternalPackageState"><span class="hs-identifier hs-type">ExternalPackageState</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-619"></span><span id="getEpsVar"><span class="annot"><span class="annottext">getEpsVar :: forall gbl lcl. TcRnIf gbl lcl (TcRef ExternalPackageState)
</span><a href="GHC.Tc.Utils.Monad.html#getEpsVar"><span class="hs-identifier hs-var hs-var">getEpsVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-620"></span><span>  </span><span id="local-6989586621682984550"><span class="annot"><a href="#local-6989586621682984550"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf gbl lcl HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span>
</span><span id="line-621"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.External.html#euc_eps"><span class="hs-identifier hs-var">euc_eps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Env.html#ue_eps"><span class="hs-identifier hs-var">ue_eps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984550"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-622"></span><span>
</span><span id="line-623"></span><span id="local-6989586621682983258"><span id="local-6989586621682983259"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getEps"><span class="hs-identifier hs-type">getEps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983258"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983259"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.External.html#ExternalPackageState"><span class="hs-identifier hs-type">ExternalPackageState</span></a></span></span></span><span>
</span><span id="line-624"></span><span id="getEps"><span class="annot"><span class="annottext">getEps :: forall gbl lcl. TcRnIf gbl lcl ExternalPackageState
</span><a href="GHC.Tc.Utils.Monad.html#getEps"><span class="hs-identifier hs-var hs-var">getEps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984556"><span class="annot"><a href="#local-6989586621682984556"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf gbl lcl HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#hscEPS"><span class="hs-identifier hs-type">hscEPS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984556"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-625"></span><span>
</span><span id="line-626"></span><span class="hs-comment">-- | Update the external package state.  Returns the second result of the</span><span>
</span><span id="line-627"></span><span class="hs-comment">-- modifier function.</span><span>
</span><span id="line-628"></span><span class="hs-comment">--</span><span>
</span><span id="line-629"></span><span class="hs-comment">-- This is an atomic operation and forces evaluation of the modified EPS in</span><span>
</span><span id="line-630"></span><span class="hs-comment">-- order to avoid space leaks.</span><span>
</span><span id="line-631"></span><span id="local-6989586621682983264"><span id="local-6989586621682983265"><span id="local-6989586621682983266"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updateEps"><span class="hs-identifier hs-type">updateEps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.External.html#ExternalPackageState"><span class="hs-identifier hs-type">ExternalPackageState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.External.html#ExternalPackageState"><span class="hs-identifier hs-type">ExternalPackageState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682983264"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-632"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983265"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983266"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983264"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-633"></span><span id="updateEps"><span class="annot"><span class="annottext">updateEps :: forall a gbl lcl.
(ExternalPackageState -&gt; (ExternalPackageState, a))
-&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updateEps"><span class="hs-identifier hs-var hs-var">updateEps</span></a></span></span><span> </span><span id="local-6989586621682984562"><span class="annot"><span class="annottext">ExternalPackageState -&gt; (ExternalPackageState, a)
</span><a href="#local-6989586621682984562"><span class="hs-identifier hs-var">upd_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-634"></span><span>  </span><span class="annot"><span class="annottext">SDoc -&gt; TcRnIf gbl lcl ()
forall m n. SDoc -&gt; TcRnIf m n ()
</span><a href="GHC.Tc.Utils.Monad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;updating EPS&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-635"></span><span>  </span><span id="local-6989586621682984564"><span class="annot"><a href="#local-6989586621682984564"><span class="hs-identifier hs-var">eps_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf gbl lcl (TcRef ExternalPackageState)
forall gbl lcl. TcRnIf gbl lcl (TcRef ExternalPackageState)
</span><a href="GHC.Tc.Utils.Monad.html#getEpsVar"><span class="hs-identifier hs-var">getEpsVar</span></a></span><span>
</span><span id="line-636"></span><span>  </span><span class="annot"><a href="GHC.Data.IOEnv.html#atomicUpdMutVar%27"><span class="hs-identifier hs-type">atomicUpdMutVar'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984564"><span class="hs-identifier hs-type">eps_var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984562"><span class="hs-identifier hs-type">upd_fn</span></a></span><span>
</span><span id="line-637"></span><span>
</span><span id="line-638"></span><span class="hs-comment">-- | Update the external package state.</span><span>
</span><span id="line-639"></span><span class="hs-comment">--</span><span>
</span><span id="line-640"></span><span class="hs-comment">-- This is an atomic operation and forces evaluation of the modified EPS in</span><span>
</span><span id="line-641"></span><span class="hs-comment">-- order to avoid space leaks.</span><span>
</span><span id="line-642"></span><span id="local-6989586621682983276"><span id="local-6989586621682983277"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updateEps_"><span class="hs-identifier hs-type">updateEps_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.External.html#ExternalPackageState"><span class="hs-identifier hs-type">ExternalPackageState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.External.html#ExternalPackageState"><span class="hs-identifier hs-type">ExternalPackageState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-643"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983276"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983277"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-644"></span><span id="updateEps_"><span class="annot"><span class="annottext">updateEps_ :: forall gbl lcl.
(ExternalPackageState -&gt; ExternalPackageState) -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#updateEps_"><span class="hs-identifier hs-var hs-var">updateEps_</span></a></span></span><span> </span><span id="local-6989586621682984566"><span class="annot"><span class="annottext">ExternalPackageState -&gt; ExternalPackageState
</span><a href="#local-6989586621682984566"><span class="hs-identifier hs-var">upd_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ExternalPackageState -&gt; (ExternalPackageState, ()))
-&gt; TcRnIf gbl lcl ()
forall a gbl lcl.
(ExternalPackageState -&gt; (ExternalPackageState, a))
-&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updateEps"><span class="hs-identifier hs-var">updateEps</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682984567"><span class="annot"><span class="annottext">ExternalPackageState
</span><a href="#local-6989586621682984567"><span class="hs-identifier hs-var">eps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExternalPackageState -&gt; ExternalPackageState
</span><a href="#local-6989586621682984566"><span class="hs-identifier hs-var">upd_fn</span></a></span><span> </span><span class="annot"><span class="annottext">ExternalPackageState
</span><a href="#local-6989586621682984567"><span class="hs-identifier hs-var">eps</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-645"></span><span>
</span><span id="line-646"></span><span id="local-6989586621682983280"><span id="local-6989586621682983281"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getHpt"><span class="hs-identifier hs-type">getHpt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983280"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983281"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a></span></span></span><span>
</span><span id="line-647"></span><span id="getHpt"><span class="annot"><span class="annottext">getHpt :: forall gbl lcl. TcRnIf gbl lcl HomePackageTable
</span><a href="GHC.Tc.Utils.Monad.html#getHpt"><span class="hs-identifier hs-var hs-var">getHpt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984570"><span class="annot"><a href="#local-6989586621682984570"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf gbl lcl HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.html#hsc_HPT"><span class="hs-identifier hs-type">hsc_HPT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984570"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-648"></span><span>
</span><span id="line-649"></span><span id="local-6989586621682983285"><span id="local-6989586621682983286"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getEpsAndHug"><span class="hs-identifier hs-type">getEpsAndHug</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983285"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983286"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.External.html#ExternalPackageState"><span class="hs-identifier hs-type">ExternalPackageState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#HomeUnitGraph"><span class="hs-identifier hs-type">HomeUnitGraph</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-650"></span><span id="getEpsAndHug"><span class="annot"><span class="annottext">getEpsAndHug :: forall gbl lcl.
TcRnIf gbl lcl (ExternalPackageState, HomeUnitGraph)
</span><a href="GHC.Tc.Utils.Monad.html#getEpsAndHug"><span class="hs-identifier hs-var hs-var">getEpsAndHug</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984576"><span class="annot"><a href="#local-6989586621682984576"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf gbl lcl HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span class="hs-special">;</span><span> </span><span id="local-6989586621682984577"><span class="annot"><a href="#local-6989586621682984577"><span class="hs-identifier hs-var">eps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#hscEPS"><span class="hs-identifier hs-type">hscEPS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984576"><span class="hs-identifier hs-type">env</span></a></span><span>
</span><span id="line-651"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682984577"><span class="hs-identifier hs-type">eps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#hsc_HUG"><span class="hs-identifier hs-type">hsc_HUG</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984576"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-652"></span><span>
</span><span id="line-653"></span><span class="hs-comment">-- | A convenient wrapper for taking a @MaybeErr SDoc a@ and throwing</span><span>
</span><span id="line-654"></span><span class="hs-comment">-- an exception if it is an error.</span><span>
</span><span id="line-655"></span><span id="local-6989586621682983290"><span id="local-6989586621682983292"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#withException"><span class="hs-identifier hs-type">withException</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621682983290"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDocContext"><span class="hs-identifier hs-type">SDocContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682983290"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Maybe.html#MaybeErr"><span class="hs-identifier hs-type">MaybeErr</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983292"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682983290"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983292"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-656"></span><span id="withException"><span class="annot"><span class="annottext">withException :: forall (m :: * -&gt; *) a.
MonadIO m =&gt;
SDocContext -&gt; m (MaybeErr SDoc a) -&gt; m a
</span><a href="GHC.Tc.Utils.Monad.html#withException"><span class="hs-identifier hs-var hs-var">withException</span></a></span></span><span> </span><span id="local-6989586621682984585"><span class="annot"><span class="annottext">SDocContext
</span><a href="#local-6989586621682984585"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682984586"><span class="annot"><span class="annottext">m (MaybeErr SDoc a)
</span><a href="#local-6989586621682984586"><span class="hs-identifier hs-var">do_this</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-657"></span><span>    </span><span id="local-6989586621682984587"><span class="annot"><a href="#local-6989586621682984587"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (MaybeErr SDoc a)
</span><a href="#local-6989586621682984586"><span class="hs-identifier hs-var">do_this</span></a></span><span>
</span><span id="line-658"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682984587"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-659"></span><span>        </span><span class="annot"><a href="GHC.Data.Maybe.html#Failed"><span class="hs-identifier hs-type">Failed</span></a></span><span> </span><span id="local-6989586621682984589"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682984589"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO a -&gt; m a
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; m a) -&gt; IO a -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GhcException -&gt; IO a
forall a. GhcException -&gt; IO a
</span><a href="GHC.Utils.Panic.html#throwGhcExceptionIO"><span class="hs-identifier hs-var">throwGhcExceptionIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; GhcException
</span><a href="GHC.Utils.Panic.html#ProgramError"><span class="hs-identifier hs-var">ProgramError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDocContext -&gt; SDoc -&gt; FilePath
</span><a href="GHC.Utils.Outputable.html#renderWithContext"><span class="hs-identifier hs-var">renderWithContext</span></a></span><span> </span><span class="annot"><span class="annottext">SDocContext
</span><a href="#local-6989586621682984585"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682984589"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-660"></span><span>        </span><span class="annot"><a href="GHC.Data.Maybe.html#Succeeded"><span class="hs-identifier hs-type">Succeeded</span></a></span><span> </span><span id="local-6989586621682984594"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682984594"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; m a
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682984594"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-661"></span><span>
</span><span id="line-662"></span><span id="local-6989586621682983298"><span id="local-6989586621682983300"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#withIfaceErr"><span class="hs-identifier hs-type">withIfaceErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621682983298"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDocContext"><span class="hs-identifier hs-type">SDocContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682983298"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Maybe.html#MaybeErr"><span class="hs-identifier hs-type">MaybeErr</span></a></span><span> </span><span class="annot"><a href="GHC.Iface.Errors.Types.html#MissingInterfaceError"><span class="hs-identifier hs-type">MissingInterfaceError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983300"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682983298"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983300"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-663"></span><span id="withIfaceErr"><span class="annot"><span class="annottext">withIfaceErr :: forall (m :: * -&gt; *) a.
MonadIO m =&gt;
SDocContext -&gt; m (MaybeErr MissingInterfaceError a) -&gt; m a
</span><a href="GHC.Tc.Utils.Monad.html#withIfaceErr"><span class="hs-identifier hs-var hs-var">withIfaceErr</span></a></span></span><span> </span><span id="local-6989586621682984600"><span class="annot"><span class="annottext">SDocContext
</span><a href="#local-6989586621682984600"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682984601"><span class="annot"><span class="annottext">m (MaybeErr MissingInterfaceError a)
</span><a href="#local-6989586621682984601"><span class="hs-identifier hs-var">do_this</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-664"></span><span>    </span><span id="local-6989586621682984602"><span class="annot"><a href="#local-6989586621682984602"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (MaybeErr MissingInterfaceError a)
</span><a href="#local-6989586621682984601"><span class="hs-identifier hs-var">do_this</span></a></span><span>
</span><span id="line-665"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682984602"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-666"></span><span>        </span><span class="annot"><a href="GHC.Data.Maybe.html#Failed"><span class="hs-identifier hs-type">Failed</span></a></span><span> </span><span id="local-6989586621682984603"><span class="annot"><span class="annottext">MissingInterfaceError
</span><a href="#local-6989586621682984603"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-667"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682984607"><span class="annot"><span class="annottext">opts :: DiagnosticOpts IfaceMessage
</span><a href="#local-6989586621682984607"><span class="hs-identifier hs-var hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall opts.
HasDefaultDiagnosticOpts (DiagnosticOpts opts) =&gt;
DiagnosticOpts opts
</span><a href="GHC.Types.Error.html#defaultDiagnosticOpts"><span class="hs-identifier hs-var">defaultDiagnosticOpts</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Iface.Errors.Types.html#IfaceMessage"><span class="hs-identifier hs-type">IfaceMessage</span></a></span><span>
</span><span id="line-668"></span><span>              </span><span id="local-6989586621682984609"><span class="annot"><span class="annottext">msg :: SDoc
</span><a href="#local-6989586621682984609"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IfaceMessageOpts -&gt; MissingInterfaceError -&gt; SDoc
</span><a href="GHC.Iface.Errors.Ppr.html#missingInterfaceErrorDiagnostic"><span class="hs-identifier hs-var">missingInterfaceErrorDiagnostic</span></a></span><span> </span><span class="annot"><span class="annottext">IfaceMessageOpts
</span><a href="#local-6989586621682984607"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">MissingInterfaceError
</span><a href="#local-6989586621682984603"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-669"></span><span>          </span><span class="annot"><span class="annottext">IO a -&gt; m a
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; m a) -&gt; IO a -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GhcException -&gt; IO a
forall a. GhcException -&gt; IO a
</span><a href="GHC.Utils.Panic.html#throwGhcExceptionIO"><span class="hs-identifier hs-var">throwGhcExceptionIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; GhcException
</span><a href="GHC.Utils.Panic.html#ProgramError"><span class="hs-identifier hs-var">ProgramError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDocContext -&gt; SDoc -&gt; FilePath
</span><a href="GHC.Utils.Outputable.html#renderWithContext"><span class="hs-identifier hs-var">renderWithContext</span></a></span><span> </span><span class="annot"><span class="annottext">SDocContext
</span><a href="#local-6989586621682984600"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682984609"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-670"></span><span>        </span><span class="annot"><a href="GHC.Data.Maybe.html#Succeeded"><span class="hs-identifier hs-type">Succeeded</span></a></span><span> </span><span id="local-6989586621682984611"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682984611"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; m a
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682984611"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-671"></span><span>
</span><span id="line-672"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Arrow scopes
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-679"></span><span>
</span><span id="line-680"></span><span id="local-6989586621682983308"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newArrowScope"><span class="hs-identifier hs-type">newArrowScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983308"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983308"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-681"></span><span id="newArrowScope"><span class="annot"><span class="annottext">newArrowScope :: forall a. TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#newArrowScope"><span class="hs-identifier hs-var hs-var">newArrowScope</span></a></span></span><span>
</span><span id="line-682"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcLclEnv -&gt; TcLclEnv)
-&gt; TcRnIf TcGblEnv TcLclEnv a -&gt; TcRnIf TcGblEnv TcLclEnv a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="annot"><span class="annottext">((TcLclEnv -&gt; TcLclEnv)
 -&gt; TcRnIf TcGblEnv TcLclEnv a -&gt; TcRnIf TcGblEnv TcLclEnv a)
-&gt; (TcLclEnv -&gt; TcLclEnv)
-&gt; TcRnIf TcGblEnv TcLclEnv a
-&gt; TcRnIf TcGblEnv TcLclEnv a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682984612"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682984612"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-683"></span><span>      </span><span class="annot"><span class="annottext">(TcLclCtxt -&gt; TcLclCtxt) -&gt; TcLclEnv -&gt; TcLclEnv
</span><a href="GHC.Tc.Types.LclEnv.html#modifyLclCtxt"><span class="hs-identifier hs-var">modifyLclCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682984613"><span class="annot"><span class="annottext">TcLclCtxt
</span><a href="#local-6989586621682984613"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcLclCtxt
</span><a href="#local-6989586621682984613"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#tcl_arrow_ctxt"><span class="hs-identifier hs-var">tcl_arrow_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#ArrowCtxt"><span class="hs-identifier hs-type">ArrowCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#getLclEnvRdrEnv"><span class="hs-identifier hs-type">getLclEnvRdrEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984612"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#tcl_lie"><span class="hs-identifier hs-var">tcl_lie</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984612"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682984612"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-684"></span><span>
</span><span id="line-685"></span><span class="hs-comment">-- Return to the stored environment (from the enclosing proc)</span><span>
</span><span id="line-686"></span><span id="local-6989586621682984616"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#escapeArrowScope"><span class="hs-identifier hs-type">escapeArrowScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984616"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984616"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-687"></span><span id="escapeArrowScope"><span class="annot"><span class="annottext">escapeArrowScope :: forall a. TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#escapeArrowScope"><span class="hs-identifier hs-var hs-var">escapeArrowScope</span></a></span></span><span>
</span><span id="line-688"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcLclEnv -&gt; TcLclEnv)
-&gt; TcRnIf TcGblEnv TcLclEnv a -&gt; TcRnIf TcGblEnv TcLclEnv a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="annot"><span class="annottext">((TcLclEnv -&gt; TcLclEnv)
 -&gt; TcRnIf TcGblEnv TcLclEnv a -&gt; TcRnIf TcGblEnv TcLclEnv a)
-&gt; (TcLclEnv -&gt; TcLclEnv)
-&gt; TcRnIf TcGblEnv TcLclEnv a
-&gt; TcRnIf TcGblEnv TcLclEnv a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682984617"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682984617"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-689"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TcLclEnv -&gt; ArrowCtxt
</span><a href="GHC.Tc.Types.LclEnv.html#getLclEnvArrowCtxt"><span class="hs-identifier hs-var">getLclEnvArrowCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682984617"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-690"></span><span>      </span><span class="annot"><span class="annottext">ArrowCtxt
</span><a href="GHC.Tc.Types.LclEnv.html#NoArrowCtxt"><span class="hs-identifier hs-var">NoArrowCtxt</span></a></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682984617"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-691"></span><span>      </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#ArrowCtxt"><span class="hs-identifier hs-type">ArrowCtxt</span></a></span><span> </span><span id="local-6989586621682984619"><span class="annot"><span class="annottext">LocalRdrEnv
</span><a href="#local-6989586621682984619"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span> </span><span id="local-6989586621682984620"><span class="annot"><span class="annottext">IORef WantedConstraints
</span><a href="#local-6989586621682984620"><span class="hs-identifier hs-var">lie</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682984617"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#tcl_lcl_ctxt"><span class="hs-identifier hs-var">tcl_lcl_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#tcl_lcl_ctxt"><span class="hs-identifier hs-var">tcl_lcl_ctxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984617"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#tcl_arrow_ctxt"><span class="hs-identifier hs-var">tcl_arrow_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#NoArrowCtxt"><span class="hs-identifier hs-type">NoArrowCtxt</span></a></span><span>
</span><span id="line-692"></span><span>                                                                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#tcl_rdr"><span class="hs-identifier hs-var">tcl_rdr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682984619"><span class="hs-identifier hs-type">rdr_env</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-693"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#tcl_lie"><span class="hs-identifier hs-var">tcl_lie</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682984620"><span class="hs-identifier hs-type">lie</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-694"></span><span>
</span><span id="line-695"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Unique supply
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-702"></span><span>
</span><span id="line-703"></span><span id="local-6989586621682983311"><span id="local-6989586621682983312"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-type">newUnique</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983311"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983312"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span></span></span><span>
</span><span id="line-704"></span><span id="newUnique"><span class="annot"><span class="annottext">newUnique :: forall gbl lcl. TcRnIf gbl lcl Unique
</span><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-var hs-var">newUnique</span></a></span></span><span>
</span><span id="line-705"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984623"><span class="annot"><a href="#local-6989586621682984623"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env gbl lcl) (Env gbl lcl)
forall env. IOEnv env env
</span><a href="GHC.Data.IOEnv.html#getEnv"><span class="hs-identifier hs-var">getEnv</span></a></span><span>
</span><span id="line-706"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682984624"><span class="annot"><a href="#local-6989586621682984624"><span class="hs-identifier hs-var hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Env gbl lcl -&gt; Char
forall gbl lcl. Env gbl lcl -&gt; Char
</span><a href="GHC.Tc.Types.html#env_ut"><span class="hs-identifier hs-var">env_ut</span></a></span><span> </span><span class="annot"><span class="annottext">Env gbl lcl
</span><a href="#local-6989586621682984623"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-707"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$!</span></span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#uniqFromTag"><span class="hs-identifier hs-type">uniqFromTag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984624"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-708"></span><span>
</span><span id="line-709"></span><span id="local-6989586621682983318"><span id="local-6989586621682983319"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newUniqueSupply"><span class="hs-identifier hs-type">newUniqueSupply</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983318"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983319"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a></span></span></span><span>
</span><span id="line-710"></span><span id="newUniqueSupply"><span class="annot"><span class="annottext">newUniqueSupply :: forall gbl lcl. TcRnIf gbl lcl UniqSupply
</span><a href="GHC.Tc.Utils.Monad.html#newUniqueSupply"><span class="hs-identifier hs-var hs-var">newUniqueSupply</span></a></span></span><span>
</span><span id="line-711"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984629"><span class="annot"><a href="#local-6989586621682984629"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env gbl lcl) (Env gbl lcl)
forall env. IOEnv env env
</span><a href="GHC.Data.IOEnv.html#getEnv"><span class="hs-identifier hs-var">getEnv</span></a></span><span>
</span><span id="line-712"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682984630"><span class="annot"><a href="#local-6989586621682984630"><span class="hs-identifier hs-var hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Env gbl lcl -&gt; Char
forall gbl lcl. Env gbl lcl -&gt; Char
</span><a href="GHC.Tc.Types.html#env_ut"><span class="hs-identifier hs-var">env_ut</span></a></span><span> </span><span class="annot"><span class="annottext">Env gbl lcl
</span><a href="#local-6989586621682984629"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-713"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$!</span></span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#mkSplitUniqSupply"><span class="hs-identifier hs-type">mkSplitUniqSupply</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984630"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-714"></span><span>
</span><span id="line-715"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#cloneLocalName"><span class="hs-identifier hs-type">cloneLocalName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-716"></span><span class="hs-comment">-- Make a fresh Internal name with the same OccName and SrcSpan</span><span>
</span><span id="line-717"></span><span id="cloneLocalName"><span class="annot"><span class="annottext">cloneLocalName :: Name -&gt; TcM Name
</span><a href="GHC.Tc.Utils.Monad.html#cloneLocalName"><span class="hs-identifier hs-var hs-var">cloneLocalName</span></a></span></span><span> </span><span id="local-6989586621682984632"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682984632"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; SrcSpan -&gt; TcM Name
</span><a href="GHC.Tc.Utils.Monad.html#newNameAt"><span class="hs-identifier hs-var">newNameAt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682984632"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SrcSpan
</span><a href="GHC.Types.Name.html#nameSrcSpan"><span class="hs-identifier hs-var">nameSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682984632"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-718"></span><span>
</span><span id="line-719"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newName"><span class="hs-identifier hs-type">newName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#OccName"><span class="hs-identifier hs-type">OccName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-720"></span><span id="newName"><span class="annot"><span class="annottext">newName :: OccName -&gt; TcM Name
</span><a href="GHC.Tc.Utils.Monad.html#newName"><span class="hs-identifier hs-var hs-var">newName</span></a></span></span><span> </span><span id="local-6989586621682984635"><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621682984635"><span class="hs-identifier hs-var">occ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984636"><span class="annot"><a href="#local-6989586621682984636"><span class="hs-identifier hs-var">loc</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn SrcSpan
</span><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a></span><span>
</span><span id="line-721"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newNameAt"><span class="hs-identifier hs-type">newNameAt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984635"><span class="hs-identifier hs-type">occ</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984636"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-722"></span><span>
</span><span id="line-723"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newNameAt"><span class="hs-identifier hs-type">newNameAt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#OccName"><span class="hs-identifier hs-type">OccName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-724"></span><span id="newNameAt"><span class="annot"><span class="annottext">newNameAt :: OccName -&gt; SrcSpan -&gt; TcM Name
</span><a href="GHC.Tc.Utils.Monad.html#newNameAt"><span class="hs-identifier hs-var hs-var">newNameAt</span></a></span></span><span> </span><span id="local-6989586621682984637"><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621682984637"><span class="hs-identifier hs-var">occ</span></a></span></span><span> </span><span id="local-6989586621682984638"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682984638"><span class="hs-identifier hs-var">span</span></a></span></span><span>
</span><span id="line-725"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984639"><span class="annot"><a href="#local-6989586621682984639"><span class="hs-identifier hs-var">uniq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv Unique
forall gbl lcl. TcRnIf gbl lcl Unique
</span><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a></span><span>
</span><span id="line-726"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#mkInternalName"><span class="hs-identifier hs-type">mkInternalName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984639"><span class="hs-identifier hs-type">uniq</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984637"><span class="hs-identifier hs-type">occ</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984638"><span class="hs-identifier hs-type">span</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-727"></span><span>
</span><span id="line-728"></span><span id="local-6989586621682983325"><span id="local-6989586621682983326"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newSysName"><span class="hs-identifier hs-type">newSysName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#OccName"><span class="hs-identifier hs-type">OccName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983325"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983326"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span></span></span><span>
</span><span id="line-729"></span><span id="newSysName"><span class="annot"><span class="annottext">newSysName :: forall gbl lcl. OccName -&gt; TcRnIf gbl lcl Name
</span><a href="GHC.Tc.Utils.Monad.html#newSysName"><span class="hs-identifier hs-var hs-var">newSysName</span></a></span></span><span> </span><span id="local-6989586621682984643"><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621682984643"><span class="hs-identifier hs-var">occ</span></a></span></span><span>
</span><span id="line-730"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984644"><span class="annot"><a href="#local-6989586621682984644"><span class="hs-identifier hs-var">uniq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf gbl lcl Unique
forall gbl lcl. TcRnIf gbl lcl Unique
</span><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a></span><span>
</span><span id="line-731"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#mkSystemName"><span class="hs-identifier hs-type">mkSystemName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984644"><span class="hs-identifier hs-type">uniq</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984643"><span class="hs-identifier hs-type">occ</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-732"></span><span>
</span><span id="line-733"></span><span id="local-6989586621682983330"><span id="local-6989586621682983331"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newSysLocalId"><span class="hs-identifier hs-type">newSysLocalId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983330"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983331"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a></span></span></span><span>
</span><span id="line-734"></span><span id="newSysLocalId"><span class="annot"><span class="annottext">newSysLocalId :: forall gbl lcl. FastString -&gt; Mult -&gt; Mult -&gt; TcRnIf gbl lcl Id
</span><a href="GHC.Tc.Utils.Monad.html#newSysLocalId"><span class="hs-identifier hs-var hs-var">newSysLocalId</span></a></span></span><span> </span><span id="local-6989586621682984650"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682984650"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span id="local-6989586621682984651"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682984651"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682984652"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682984652"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-735"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984653"><span class="annot"><a href="#local-6989586621682984653"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf gbl lcl Unique
forall gbl lcl. TcRnIf gbl lcl Unique
</span><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a></span><span>
</span><span id="line-736"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.html#mkSysLocal"><span class="hs-identifier hs-type">mkSysLocal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984650"><span class="hs-identifier hs-type">fs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984653"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984651"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984652"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-737"></span><span>
</span><span id="line-738"></span><span id="local-6989586621682983335"><span id="local-6989586621682983336"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newSysLocalIds"><span class="hs-identifier hs-type">newSysLocalIds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983335"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983336"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-739"></span><span id="newSysLocalIds"><span class="annot"><span class="annottext">newSysLocalIds :: forall gbl lcl. FastString -&gt; [Scaled Mult] -&gt; TcRnIf gbl lcl [Id]
</span><a href="GHC.Tc.Utils.Monad.html#newSysLocalIds"><span class="hs-identifier hs-var hs-var">newSysLocalIds</span></a></span></span><span> </span><span id="local-6989586621682984659"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682984659"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span id="local-6989586621682984660"><span class="annot"><span class="annottext">[Scaled Mult]
</span><a href="#local-6989586621682984660"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-740"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984661"><span class="annot"><a href="#local-6989586621682984661"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env gbl lcl) [Unique]
forall (m :: * -&gt; *). MonadUnique m =&gt; m [Unique]
</span><a href="GHC.Types.Unique.Supply.html#getUniquesM"><span class="hs-identifier hs-var">getUniquesM</span></a></span><span>
</span><span id="line-741"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682984663"><span class="annot"><a href="#local-6989586621682984663"><span class="hs-identifier hs-var hs-var">mkId'</span></a></span></span><span> </span><span id="local-6989586621682984664"><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682984664"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span id="local-6989586621682984666"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682984666"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682984667"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682984667"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Unique -&gt; Mult -&gt; Mult -&gt; Id
</span><a href="GHC.Types.Id.html#mkSysLocal"><span class="hs-identifier hs-var">mkSysLocal</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682984659"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682984664"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682984666"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682984667"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-742"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">zipWith</span></span><span> </span><span class="annot"><a href="#local-6989586621682984663"><span class="hs-identifier hs-type">mkId'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984661"><span class="hs-identifier hs-type">us</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984660"><span class="hs-identifier hs-type">tys</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-743"></span><span>
</span><span id="line-744"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682983340"><span id="local-6989586621682983341"><span id="local-6989586621682984674"><span class="annot"><a href="GHC.Types.Unique.Supply.html#MonadUnique"><span class="hs-identifier hs-type">MonadUnique</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.IOEnv.html#IOEnv"><span class="hs-identifier hs-type">IOEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983340"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983341"><span class="hs-identifier hs-type">lcl</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-745"></span><span>        </span><span id="local-6989586621682984677"><span class="annot"><span class="annottext">getUniqueM :: IOEnv (Env gbl lcl) Unique
</span><a href="#local-6989586621682984677"><span class="hs-identifier hs-var hs-var hs-var">getUniqueM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env gbl lcl) Unique
forall gbl lcl. TcRnIf gbl lcl Unique
</span><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a></span><span>
</span><span id="line-746"></span><span>        </span><span id="local-6989586621682984679"><span class="annot"><span class="annottext">getUniqueSupplyM :: IOEnv (Env gbl lcl) UniqSupply
</span><a href="#local-6989586621682984679"><span class="hs-identifier hs-var hs-var hs-var">getUniqueSupplyM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env gbl lcl) UniqSupply
forall gbl lcl. TcRnIf gbl lcl UniqSupply
</span><a href="GHC.Tc.Utils.Monad.html#newUniqueSupply"><span class="hs-identifier hs-var">newUniqueSupply</span></a></span><span>
</span><span id="line-747"></span><span>
</span><span id="line-748"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Debugging
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-755"></span><span>
</span><span id="line-756"></span><span class="hs-comment">{- Note [INLINE conditional tracing utilities]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In general we want to optimise for the case where tracing is not enabled.
To ensure this happens, we ensure that traceTc and friends are inlined; this
ensures that the allocation of the document can be pushed into the tracing
path, keeping the non-traced path free of this extraneous work. For
instance, if we don't inline traceTc, we'll get

    let stuff_to_print = ...
    in traceTc &quot;wombat&quot; stuff_to_print

and the stuff_to_print thunk will be allocated in the &quot;hot path&quot;, regardless
of tracing.  But if we INLINE traceTc we get

    let stuff_to_print = ...
    in if doTracing
         then emitTraceMsg &quot;wombat&quot; stuff_to_print
         else return ()

and then we float in:

    if doTracing
      then let stuff_to_print = ...
           in emitTraceMsg &quot;wombat&quot; stuff_to_print
      else return ()

Now stuff_to_print is allocated only in the &quot;cold path&quot;.

Moreover, on the &quot;cold&quot; path, after the conditional, we want to inline
as /little/ as possible.  Performance doesn't matter here, and we'd like
to bloat the caller's code as little as possible.  So we put a NOINLINE
on 'emitTraceMsg'

See #18168.
-}</span><span>
</span><span id="line-791"></span><span>
</span><span id="line-792"></span><span class="hs-comment">-- Typechecker trace</span><span>
</span><span id="line-793"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-794"></span><span id="traceTc"><span class="annot"><span class="annottext">traceTc :: FilePath -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var hs-var">traceTc</span></a></span></span><span> </span><span id="local-6989586621682984681"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682984681"><span class="hs-identifier hs-var">herald</span></a></span></span><span> </span><span id="local-6989586621682984682"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682984682"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-795"></span><span>    </span><span class="annot"><span class="annottext">DumpFlag -&gt; FilePath -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#labelledTraceOptTcRn"><span class="hs-identifier hs-var">labelledTraceOptTcRn</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_tc_trace"><span class="hs-identifier hs-var">Opt_D_dump_tc_trace</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682984681"><span class="hs-identifier hs-var">herald</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682984682"><span class="hs-identifier hs-var">doc</span></a></span><span>
</span><span id="line-796"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-pragma hs-type">traceTc</span></a></span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-comment">-- see Note [INLINE conditional tracing utilities]</span><span>
</span><span id="line-797"></span><span>
</span><span id="line-798"></span><span class="hs-comment">-- Renamer Trace</span><span>
</span><span id="line-799"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-type">traceRn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-800"></span><span id="traceRn"><span class="annot"><span class="annottext">traceRn :: FilePath -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-var hs-var">traceRn</span></a></span></span><span> </span><span id="local-6989586621682984685"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682984685"><span class="hs-identifier hs-var">herald</span></a></span></span><span> </span><span id="local-6989586621682984686"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682984686"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-801"></span><span>    </span><span class="annot"><span class="annottext">DumpFlag -&gt; FilePath -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#labelledTraceOptTcRn"><span class="hs-identifier hs-var">labelledTraceOptTcRn</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_rn_trace"><span class="hs-identifier hs-var">Opt_D_dump_rn_trace</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682984685"><span class="hs-identifier hs-var">herald</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682984686"><span class="hs-identifier hs-var">doc</span></a></span><span>
</span><span id="line-802"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-pragma hs-type">traceRn</span></a></span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-comment">-- see Note [INLINE conditional tracing utilities]</span><span>
</span><span id="line-803"></span><span>
</span><span id="line-804"></span><span class="hs-comment">-- | Trace when a certain flag is enabled. This is like `traceOptTcRn`</span><span>
</span><span id="line-805"></span><span class="hs-comment">-- but accepts a string as a label and formats the trace message uniformly.</span><span>
</span><span id="line-806"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#labelledTraceOptTcRn"><span class="hs-identifier hs-type">labelledTraceOptTcRn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#DumpFlag"><span class="hs-identifier hs-type">DumpFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-807"></span><span id="labelledTraceOptTcRn"><span class="annot"><span class="annottext">labelledTraceOptTcRn :: DumpFlag -&gt; FilePath -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#labelledTraceOptTcRn"><span class="hs-identifier hs-var hs-var">labelledTraceOptTcRn</span></a></span></span><span> </span><span id="local-6989586621682984688"><span class="annot"><span class="annottext">DumpFlag
</span><a href="#local-6989586621682984688"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span id="local-6989586621682984689"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682984689"><span class="hs-identifier hs-var">herald</span></a></span></span><span> </span><span id="local-6989586621682984690"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682984690"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-808"></span><span>  </span><span class="annot"><span class="annottext">DumpFlag -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceOptTcRn"><span class="hs-identifier hs-var">traceOptTcRn</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="#local-6989586621682984688"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Tc.Utils.Monad.html#formatTraceMsg"><span class="hs-identifier hs-var">formatTraceMsg</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682984689"><span class="hs-identifier hs-var">herald</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682984690"><span class="hs-identifier hs-var">doc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-809"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#labelledTraceOptTcRn"><span class="hs-pragma hs-type">labelledTraceOptTcRn</span></a></span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-comment">-- see Note [INLINE conditional tracing utilities]</span><span>
</span><span id="line-810"></span><span>
</span><span id="line-811"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#formatTraceMsg"><span class="hs-identifier hs-type">formatTraceMsg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-812"></span><span id="formatTraceMsg"><span class="annot"><span class="annottext">formatTraceMsg :: FilePath -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Tc.Utils.Monad.html#formatTraceMsg"><span class="hs-identifier hs-var hs-var">formatTraceMsg</span></a></span></span><span> </span><span id="local-6989586621682984692"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682984692"><span class="hs-identifier hs-var">herald</span></a></span></span><span> </span><span id="local-6989586621682984693"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682984693"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682984692"><span class="hs-identifier hs-var">herald</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682984693"><span class="hs-identifier hs-var">doc</span></a></span><span>
</span><span id="line-813"></span><span>
</span><span id="line-814"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceOptTcRn"><span class="hs-identifier hs-type">traceOptTcRn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#DumpFlag"><span class="hs-identifier hs-type">DumpFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-815"></span><span id="traceOptTcRn"><span class="annot"><span class="annottext">traceOptTcRn :: DumpFlag -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceOptTcRn"><span class="hs-identifier hs-var hs-var">traceOptTcRn</span></a></span></span><span> </span><span id="local-6989586621682984695"><span class="annot"><span class="annottext">DumpFlag
</span><a href="#local-6989586621682984695"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span id="local-6989586621682984696"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682984696"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-816"></span><span>  </span><span class="annot"><span class="annottext">DumpFlag -&gt; TcM () -&gt; TcM ()
forall gbl lcl. DumpFlag -&gt; TcRnIf gbl lcl () -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#whenDOptM"><span class="hs-identifier hs-var">whenDOptM</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="#local-6989586621682984695"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM () -&gt; TcM ()) -&gt; TcM () -&gt; TcM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-817"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; DumpFlag -&gt; FilePath -&gt; DumpFormat -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#dumpTcRn"><span class="hs-identifier hs-var">dumpTcRn</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="#local-6989586621682984695"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Logger.html#FormatText"><span class="hs-identifier hs-var">FormatText</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682984696"><span class="hs-identifier hs-var">doc</span></a></span><span>
</span><span id="line-818"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceOptTcRn"><span class="hs-pragma hs-type">traceOptTcRn</span></a></span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-comment">-- see Note [INLINE conditional tracing utilities]</span><span>
</span><span id="line-819"></span><span>
</span><span id="line-820"></span><span class="annot"><span class="hs-comment">-- | Dump if the given 'DumpFlag' is set.</span></span><span>
</span><span id="line-821"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#dumpOptTcRn"><span class="hs-identifier hs-type">dumpOptTcRn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#DumpFlag"><span class="hs-identifier hs-type">DumpFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#DumpFormat"><span class="hs-identifier hs-type">DumpFormat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-822"></span><span id="dumpOptTcRn"><span class="annot"><span class="annottext">dumpOptTcRn :: DumpFlag -&gt; FilePath -&gt; DumpFormat -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#dumpOptTcRn"><span class="hs-identifier hs-var hs-var">dumpOptTcRn</span></a></span></span><span> </span><span id="local-6989586621682984698"><span class="annot"><span class="annottext">DumpFlag
</span><a href="#local-6989586621682984698"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span id="local-6989586621682984699"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682984699"><span class="hs-identifier hs-var">title</span></a></span></span><span> </span><span id="local-6989586621682984700"><span class="annot"><span class="annottext">DumpFormat
</span><a href="#local-6989586621682984700"><span class="hs-identifier hs-var">fmt</span></a></span></span><span> </span><span id="local-6989586621682984701"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682984701"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-823"></span><span>  </span><span class="annot"><span class="annottext">DumpFlag -&gt; TcM () -&gt; TcM ()
forall gbl lcl. DumpFlag -&gt; TcRnIf gbl lcl () -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#whenDOptM"><span class="hs-identifier hs-var">whenDOptM</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="#local-6989586621682984698"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM () -&gt; TcM ()) -&gt; TcM () -&gt; TcM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-824"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; DumpFlag -&gt; FilePath -&gt; DumpFormat -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#dumpTcRn"><span class="hs-identifier hs-var">dumpTcRn</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="#local-6989586621682984698"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682984699"><span class="hs-identifier hs-var">title</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="#local-6989586621682984700"><span class="hs-identifier hs-var">fmt</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682984701"><span class="hs-identifier hs-var">doc</span></a></span><span>
</span><span id="line-825"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#dumpOptTcRn"><span class="hs-pragma hs-type">dumpOptTcRn</span></a></span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-comment">-- see Note [INLINE conditional tracing utilities]</span><span>
</span><span id="line-826"></span><span>
</span><span id="line-827"></span><span class="hs-comment">-- | Unconditionally dump some trace output</span><span>
</span><span id="line-828"></span><span class="hs-comment">--</span><span>
</span><span id="line-829"></span><span class="hs-comment">-- Certain tests (T3017, Roles3, T12763 etc.) expect part of the</span><span>
</span><span id="line-830"></span><span class="hs-comment">-- output generated by `-ddump-types` to be in 'PprUser' style. However,</span><span>
</span><span id="line-831"></span><span class="hs-comment">-- generally we want all other debugging output to use 'PprDump'</span><span>
</span><span id="line-832"></span><span class="hs-comment">-- style. We 'PprUser' style if 'useUserStyle' is True.</span><span>
</span><span id="line-833"></span><span class="hs-comment">--</span><span>
</span><span id="line-834"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#dumpTcRn"><span class="hs-identifier hs-type">dumpTcRn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#DumpFlag"><span class="hs-identifier hs-type">DumpFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#DumpFormat"><span class="hs-identifier hs-type">DumpFormat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-835"></span><span id="dumpTcRn"><span class="annot"><span class="annottext">dumpTcRn :: Bool -&gt; DumpFlag -&gt; FilePath -&gt; DumpFormat -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#dumpTcRn"><span class="hs-identifier hs-var hs-var">dumpTcRn</span></a></span></span><span> </span><span id="local-6989586621682984704"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682984704"><span class="hs-identifier hs-var">useUserStyle</span></a></span></span><span> </span><span id="local-6989586621682984705"><span class="annot"><span class="annottext">DumpFlag
</span><a href="#local-6989586621682984705"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span id="local-6989586621682984706"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682984706"><span class="hs-identifier hs-var">title</span></a></span></span><span> </span><span id="local-6989586621682984707"><span class="annot"><span class="annottext">DumpFormat
</span><a href="#local-6989586621682984707"><span class="hs-identifier hs-var">fmt</span></a></span></span><span> </span><span id="local-6989586621682984708"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682984708"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-836"></span><span>  </span><span id="local-6989586621682984709"><span class="annot"><a href="#local-6989586621682984709"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) Logger
forall (m :: * -&gt; *). HasLogger m =&gt; m Logger
</span><a href="GHC.Utils.Logger.html#getLogger"><span class="hs-identifier hs-var">getLogger</span></a></span><span>
</span><span id="line-837"></span><span>  </span><span id="local-6989586621682984710"><span class="annot"><a href="#local-6989586621682984710"><span class="hs-identifier hs-var">name_ppr_ctx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getNamePprCtx"><span class="hs-identifier hs-type">getNamePprCtx</span></a></span><span>
</span><span id="line-838"></span><span>  </span><span id="local-6989586621682984711"><span class="annot"><a href="#local-6989586621682984711"><span class="hs-identifier hs-var">real_doc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#wrapDocLoc"><span class="hs-identifier hs-type">wrapDocLoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984708"><span class="hs-identifier hs-type">doc</span></a></span><span>
</span><span id="line-839"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682984713"><span class="annot"><a href="#local-6989586621682984713"><span class="hs-identifier hs-var hs-var">sty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682984704"><span class="hs-identifier hs-var">useUserStyle</span></a></span><span>
</span><span id="line-840"></span><span>              </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">NamePprCtx -&gt; Depth -&gt; PprStyle
</span><a href="GHC.Utils.Outputable.html#mkUserStyle"><span class="hs-identifier hs-var">mkUserStyle</span></a></span><span> </span><span class="annot"><span class="annottext">NamePprCtx
</span><a href="#local-6989586621682984710"><span class="hs-identifier hs-var">name_ppr_ctx</span></a></span><span> </span><span class="annot"><span class="annottext">Depth
</span><a href="GHC.Utils.Outputable.html#AllTheWay"><span class="hs-identifier hs-var">AllTheWay</span></a></span><span>
</span><span id="line-841"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">NamePprCtx -&gt; PprStyle
</span><a href="GHC.Utils.Outputable.html#mkDumpStyle"><span class="hs-identifier hs-var">mkDumpStyle</span></a></span><span> </span><span class="annot"><span class="annottext">NamePprCtx
</span><a href="#local-6989586621682984710"><span class="hs-identifier hs-var">name_ppr_ctx</span></a></span><span>
</span><span id="line-842"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#logDumpFile"><span class="hs-identifier hs-type">logDumpFile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984709"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984713"><span class="hs-identifier hs-type">sty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984705"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984706"><span class="hs-identifier hs-type">title</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984707"><span class="hs-identifier hs-type">fmt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984711"><span class="hs-identifier hs-type">real_doc</span></a></span><span>
</span><span id="line-843"></span><span>
</span><span id="line-844"></span><span class="hs-comment">-- | Add current location if -dppr-debug</span><span>
</span><span id="line-845"></span><span class="hs-comment">-- (otherwise the full location is usually way too much)</span><span>
</span><span id="line-846"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#wrapDocLoc"><span class="hs-identifier hs-type">wrapDocLoc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-847"></span><span id="wrapDocLoc"><span class="annot"><span class="annottext">wrapDocLoc :: SDoc -&gt; TcRn SDoc
</span><a href="GHC.Tc.Utils.Monad.html#wrapDocLoc"><span class="hs-identifier hs-var hs-var">wrapDocLoc</span></a></span></span><span> </span><span id="local-6989586621682984718"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682984718"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-848"></span><span>  </span><span id="local-6989586621682984719"><span class="annot"><a href="#local-6989586621682984719"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) Logger
forall (m :: * -&gt; *). HasLogger m =&gt; m Logger
</span><a href="GHC.Utils.Logger.html#getLogger"><span class="hs-identifier hs-var">getLogger</span></a></span><span>
</span><span id="line-849"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#logHasDumpFlag"><span class="hs-identifier hs-type">logHasDumpFlag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984719"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_D_ppr_debug"><span class="hs-identifier hs-type">Opt_D_ppr_debug</span></a></span><span>
</span><span id="line-850"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-851"></span><span>      </span><span id="local-6989586621682984721"><span class="annot"><a href="#local-6989586621682984721"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-type">getSrcSpanM</span></a></span><span>
</span><span id="line-852"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#mkLocMessage"><span class="hs-identifier hs-type">mkLocMessage</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Error.html#MCOutput"><span class="hs-identifier hs-type">MCOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984721"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984718"><span class="hs-identifier hs-type">doc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-853"></span><span>    </span><span class="hs-keyword">else</span><span>
</span><span id="line-854"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682984718"><span class="hs-identifier hs-type">doc</span></a></span><span>
</span><span id="line-855"></span><span>
</span><span id="line-856"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getNamePprCtx"><span class="hs-identifier hs-type">getNamePprCtx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#NamePprCtx"><span class="hs-identifier hs-type">NamePprCtx</span></a></span><span>
</span><span id="line-857"></span><span id="getNamePprCtx"><span class="annot"><span class="annottext">getNamePprCtx :: TcRn NamePprCtx
</span><a href="GHC.Tc.Utils.Monad.html#getNamePprCtx"><span class="hs-identifier hs-var hs-var">getNamePprCtx</span></a></span></span><span>
</span><span id="line-858"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984724"><span class="annot"><a href="#local-6989586621682984724"><span class="hs-identifier hs-var">ptc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; PromotionTickContext
</span><a href="GHC.Driver.DynFlags.html#initPromotionTickContext"><span class="hs-identifier hs-var">initPromotionTickContext</span></a></span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; PromotionTickContext)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) DynFlags
-&gt; IOEnv (Env TcGblEnv TcLclEnv) PromotionTickContext
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-859"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682984726"><span class="annot"><a href="#local-6989586621682984726"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getGlobalRdrEnv"><span class="hs-identifier hs-type">getGlobalRdrEnv</span></a></span><span>
</span><span id="line-860"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682984727"><span class="annot"><a href="#local-6989586621682984727"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-type">getTopEnv</span></a></span><span>
</span><span id="line-861"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Ppr.html#mkNamePprCtx"><span class="hs-identifier hs-type">mkNamePprCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984724"><span class="hs-identifier hs-type">ptc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984727"><span class="hs-identifier hs-type">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682984726"><span class="hs-identifier hs-type">rdr_env</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-862"></span><span>
</span><span id="line-863"></span><span class="annot"><span class="hs-comment">-- | Like logInfoTcRn, but for user consumption</span></span><span>
</span><span id="line-864"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#printForUserTcRn"><span class="hs-identifier hs-type">printForUserTcRn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-865"></span><span id="printForUserTcRn"><span class="annot"><span class="annottext">printForUserTcRn :: SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#printForUserTcRn"><span class="hs-identifier hs-var hs-var">printForUserTcRn</span></a></span></span><span> </span><span id="local-6989586621682984729"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682984729"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-866"></span><span>    </span><span id="local-6989586621682984730"><span class="annot"><a href="#local-6989586621682984730"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) Logger
forall (m :: * -&gt; *). HasLogger m =&gt; m Logger
</span><a href="GHC.Utils.Logger.html#getLogger"><span class="hs-identifier hs-var">getLogger</span></a></span><span>
</span><span id="line-867"></span><span>    </span><span id="local-6989586621682984731"><span class="annot"><a href="#local-6989586621682984731"><span class="hs-identifier hs-var">name_ppr_ctx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getNamePprCtx"><span class="hs-identifier hs-type">getNamePprCtx</span></a></span><span>
</span><span id="line-868"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Error.html#printOutputForUser"><span class="hs-identifier hs-type">printOutputForUser</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984730"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984731"><span class="hs-identifier hs-type">name_ppr_ctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984729"><span class="hs-identifier hs-type">doc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-869"></span><span>
</span><span id="line-870"></span><span class="hs-comment">{-
traceIf works in the TcRnIf monad, where no RdrEnv is
available.  Alas, they behave inconsistently with the other stuff;
e.g. are unaffected by -dump-to-file.
-}</span><span>
</span><span id="line-875"></span><span>
</span><span id="line-876"></span><span id="local-6989586621682983270"><span id="local-6989586621682983271"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceIf"><span class="hs-identifier hs-type">traceIf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983270"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983271"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-877"></span><span id="traceIf"><span class="annot"><span class="annottext">traceIf :: forall m n. SDoc -&gt; TcRnIf m n ()
</span><a href="GHC.Tc.Utils.Monad.html#traceIf"><span class="hs-identifier hs-var hs-var">traceIf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DumpFlag -&gt; SDoc -&gt; TcRnIf m n ()
forall m n. DumpFlag -&gt; SDoc -&gt; TcRnIf m n ()
</span><a href="GHC.Tc.Utils.Monad.html#traceOptIf"><span class="hs-identifier hs-var">traceOptIf</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_if_trace"><span class="hs-identifier hs-var">Opt_D_dump_if_trace</span></a></span><span>
</span><span id="line-878"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceIf"><span class="hs-pragma hs-type">traceIf</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-879"></span><span>  </span><span class="hs-comment">-- see Note [INLINE conditional tracing utilities]</span><span>
</span><span id="line-880"></span><span>
</span><span id="line-881"></span><span id="local-6989586621682983357"><span id="local-6989586621682983358"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceOptIf"><span class="hs-identifier hs-type">traceOptIf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#DumpFlag"><span class="hs-identifier hs-type">DumpFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983357"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983358"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-882"></span><span id="traceOptIf"><span class="annot"><span class="annottext">traceOptIf :: forall m n. DumpFlag -&gt; SDoc -&gt; TcRnIf m n ()
</span><a href="GHC.Tc.Utils.Monad.html#traceOptIf"><span class="hs-identifier hs-var hs-var">traceOptIf</span></a></span></span><span> </span><span id="local-6989586621682984738"><span class="annot"><span class="annottext">DumpFlag
</span><a href="#local-6989586621682984738"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span id="local-6989586621682984739"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682984739"><span class="hs-identifier hs-var">doc</span></a></span></span><span>
</span><span id="line-883"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DumpFlag -&gt; TcRnIf m n () -&gt; TcRnIf m n ()
forall gbl lcl. DumpFlag -&gt; TcRnIf gbl lcl () -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#whenDOptM"><span class="hs-identifier hs-var">whenDOptM</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="#local-6989586621682984738"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnIf m n () -&gt; TcRnIf m n ()) -&gt; TcRnIf m n () -&gt; TcRnIf m n ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>   </span><span class="hs-comment">-- No RdrEnv available, so qualify everything</span><span>
</span><span id="line-884"></span><span>        </span><span id="local-6989586621682984740"><span class="annot"><a href="#local-6989586621682984740"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env m n) Logger
forall (m :: * -&gt; *). HasLogger m =&gt; m Logger
</span><a href="GHC.Utils.Logger.html#getLogger"><span class="hs-identifier hs-var">getLogger</span></a></span><span>
</span><span id="line-885"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Error.html#putMsg"><span class="hs-identifier hs-type">putMsg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984740"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984739"><span class="hs-identifier hs-type">doc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-886"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceOptIf"><span class="hs-pragma hs-type">traceOptIf</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>  </span><span class="hs-comment">-- see Note [INLINE conditional tracing utilities]</span><span>
</span><span id="line-887"></span><span>
</span><span id="line-888"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Typechecker global environment
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-895"></span><span>
</span><span id="line-896"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getIsGHCi"><span class="hs-identifier hs-type">getIsGHCi</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-897"></span><span id="getIsGHCi"><span class="annot"><span class="annottext">getIsGHCi :: TcRn Bool
</span><a href="GHC.Tc.Utils.Monad.html#getIsGHCi"><span class="hs-identifier hs-var hs-var">getIsGHCi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984742"><span class="annot"><a href="#local-6989586621682984742"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) Module
forall (m :: * -&gt; *). HasModule m =&gt; m Module
</span><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier hs-var">getModule</span></a></span><span>
</span><span id="line-898"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#isInteractiveModule"><span class="hs-identifier hs-type">isInteractiveModule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984742"><span class="hs-identifier hs-type">mod</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-899"></span><span>
</span><span id="line-900"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getGHCiMonad"><span class="hs-identifier hs-type">getGHCiMonad</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-901"></span><span id="getGHCiMonad"><span class="annot"><span class="annottext">getGHCiMonad :: TcM Name
</span><a href="GHC.Tc.Utils.Monad.html#getGHCiMonad"><span class="hs-identifier hs-var hs-var">getGHCiMonad</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984745"><span class="annot"><a href="#local-6989586621682984745"><span class="hs-identifier hs-var">hsc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Context.html#ic_monad"><span class="hs-identifier hs-var">ic_monad</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_IC"><span class="hs-identifier hs-var">hsc_IC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984745"><span class="hs-identifier hs-type">hsc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-902"></span><span>
</span><span id="line-903"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getInteractivePrintName"><span class="hs-identifier hs-type">getInteractivePrintName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-904"></span><span id="getInteractivePrintName"><span class="annot"><span class="annottext">getInteractivePrintName :: TcM Name
</span><a href="GHC.Tc.Utils.Monad.html#getInteractivePrintName"><span class="hs-identifier hs-var hs-var">getInteractivePrintName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984747"><span class="annot"><a href="#local-6989586621682984747"><span class="hs-identifier hs-var">hsc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Context.html#ic_int_print"><span class="hs-identifier hs-var">ic_int_print</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_IC"><span class="hs-identifier hs-var">hsc_IC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984747"><span class="hs-identifier hs-type">hsc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-905"></span><span>
</span><span id="line-906"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcIsHsBootOrSig"><span class="hs-identifier hs-type">tcIsHsBootOrSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-907"></span><span id="tcIsHsBootOrSig"><span class="annot"><span class="annottext">tcIsHsBootOrSig :: TcRn Bool
</span><a href="GHC.Tc.Utils.Monad.html#tcIsHsBootOrSig"><span class="hs-identifier hs-var hs-var">tcIsHsBootOrSig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscSource -&gt; Bool
</span><a href="GHC.Types.SourceFile.html#isHsBootOrSig"><span class="hs-identifier hs-var">isHsBootOrSig</span></a></span><span> </span><span class="annot"><span class="annottext">(HscSource -&gt; Bool)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) HscSource -&gt; TcRn Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) HscSource
</span><a href="GHC.Tc.Utils.Monad.html#tcHscSource"><span class="hs-identifier hs-var">tcHscSource</span></a></span><span>
</span><span id="line-908"></span><span>
</span><span id="line-909"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcHscSource"><span class="hs-identifier hs-type">tcHscSource</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Types.SourceFile.html#HscSource"><span class="hs-identifier hs-type">HscSource</span></a></span><span>
</span><span id="line-910"></span><span id="tcHscSource"><span class="annot"><span class="annottext">tcHscSource :: IOEnv (Env TcGblEnv TcLclEnv) HscSource
</span><a href="GHC.Tc.Utils.Monad.html#tcHscSource"><span class="hs-identifier hs-var hs-var">tcHscSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984750"><span class="annot"><a href="#local-6989586621682984750"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#tcg_src"><span class="hs-identifier hs-var">tcg_src</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984750"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-911"></span><span>
</span><span id="line-912"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcIsHsig"><span class="hs-identifier hs-type">tcIsHsig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-913"></span><span id="tcIsHsig"><span class="annot"><span class="annottext">tcIsHsig :: TcRn Bool
</span><a href="GHC.Tc.Utils.Monad.html#tcIsHsig"><span class="hs-identifier hs-var hs-var">tcIsHsig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984751"><span class="annot"><a href="#local-6989586621682984751"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SourceFile.html#isHsigFile"><span class="hs-identifier hs-type">isHsigFile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#tcg_src"><span class="hs-identifier hs-var">tcg_src</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984751"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-914"></span><span>
</span><span id="line-915"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcSelfBootInfo"><span class="hs-identifier hs-type">tcSelfBootInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#SelfBootInfo"><span class="hs-identifier hs-type">SelfBootInfo</span></a></span><span>
</span><span id="line-916"></span><span id="tcSelfBootInfo"><span class="annot"><span class="annottext">tcSelfBootInfo :: TcRn SelfBootInfo
</span><a href="GHC.Tc.Utils.Monad.html#tcSelfBootInfo"><span class="hs-identifier hs-var hs-var">tcSelfBootInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984753"><span class="annot"><a href="#local-6989586621682984753"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#tcg_self_boot"><span class="hs-identifier hs-var">tcg_self_boot</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984753"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-917"></span><span>
</span><span id="line-918"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getGlobalRdrEnv"><span class="hs-identifier hs-type">getGlobalRdrEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a></span><span>
</span><span id="line-919"></span><span id="getGlobalRdrEnv"><span class="annot"><span class="annottext">getGlobalRdrEnv :: TcRn GlobalRdrEnv
</span><a href="GHC.Tc.Utils.Monad.html#getGlobalRdrEnv"><span class="hs-identifier hs-var hs-var">getGlobalRdrEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984754"><span class="annot"><a href="#local-6989586621682984754"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#tcg_rdr_env"><span class="hs-identifier hs-var">tcg_rdr_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984754"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-920"></span><span>
</span><span id="line-921"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getRdrEnvs"><span class="hs-identifier hs-type">getRdrEnvs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#LocalRdrEnv"><span class="hs-identifier hs-type">LocalRdrEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-922"></span><span id="getRdrEnvs"><span class="annot"><span class="annottext">getRdrEnvs :: TcRn (GlobalRdrEnv, LocalRdrEnv)
</span><a href="GHC.Tc.Utils.Monad.html#getRdrEnvs"><span class="hs-identifier hs-var hs-var">getRdrEnvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682984755"><span class="annot"><a href="#local-6989586621682984755"><span class="hs-identifier hs-var">gbl</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682984756"><span class="annot"><a href="#local-6989586621682984756"><span class="hs-identifier hs-var">lcl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv (TcGblEnv, TcLclEnv)
forall gbl lcl. TcRnIf gbl lcl (gbl, lcl)
</span><a href="GHC.Tc.Utils.Monad.html#getEnvs"><span class="hs-identifier hs-var">getEnvs</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#tcg_rdr_env"><span class="hs-identifier hs-var">tcg_rdr_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984755"><span class="hs-identifier hs-type">gbl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#getLclEnvRdrEnv"><span class="hs-identifier hs-type">getLclEnvRdrEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984756"><span class="hs-identifier hs-type">lcl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-923"></span><span>
</span><span id="line-924"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getImports"><span class="hs-identifier hs-type">getImports</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Deps.html#ImportAvails"><span class="hs-identifier hs-type">ImportAvails</span></a></span><span>
</span><span id="line-925"></span><span id="getImports"><span class="annot"><span class="annottext">getImports :: TcRn ImportAvails
</span><a href="GHC.Tc.Utils.Monad.html#getImports"><span class="hs-identifier hs-var hs-var">getImports</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984757"><span class="annot"><a href="#local-6989586621682984757"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#tcg_imports"><span class="hs-identifier hs-var">tcg_imports</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984757"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-926"></span><span>
</span><span id="line-927"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getFixityEnv"><span class="hs-identifier hs-type">getFixityEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Fixity.Env.html#FixityEnv"><span class="hs-identifier hs-type">FixityEnv</span></a></span><span>
</span><span id="line-928"></span><span id="getFixityEnv"><span class="annot"><span class="annottext">getFixityEnv :: TcRn FixityEnv
</span><a href="GHC.Tc.Utils.Monad.html#getFixityEnv"><span class="hs-identifier hs-var hs-var">getFixityEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984758"><span class="annot"><a href="#local-6989586621682984758"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#tcg_fix_env"><span class="hs-identifier hs-var">tcg_fix_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984758"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-929"></span><span>
</span><span id="line-930"></span><span id="local-6989586621682983363"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#extendFixityEnv"><span class="hs-identifier hs-type">extendFixityEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Types.Fixity.Env.html#FixItem"><span class="hs-identifier hs-type">FixItem</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983363"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983363"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-931"></span><span id="extendFixityEnv"><span class="annot"><span class="annottext">extendFixityEnv :: forall a. [(Name, FixItem)] -&gt; RnM a -&gt; RnM a
</span><a href="GHC.Tc.Utils.Monad.html#extendFixityEnv"><span class="hs-identifier hs-var hs-var">extendFixityEnv</span></a></span></span><span> </span><span id="local-6989586621682984759"><span class="annot"><span class="annottext">[(Name, FixItem)]
</span><a href="#local-6989586621682984759"><span class="hs-identifier hs-var">new_bit</span></a></span></span><span>
</span><span id="line-932"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcGblEnv -&gt; TcGblEnv)
-&gt; TcRnIf TcGblEnv TcLclEnv a -&gt; TcRnIf TcGblEnv TcLclEnv a
forall gbl lcl a.
(gbl -&gt; gbl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updGblEnv"><span class="hs-identifier hs-var">updGblEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682984760"><span class="annot"><span class="annottext">env :: TcGblEnv
</span><a href="#local-6989586621682984760"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcg_fix_env :: TcGblEnv -&gt; FixityEnv
</span><a href="GHC.Tc.Types.html#tcg_fix_env"><span class="hs-identifier hs-var">tcg_fix_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682984761"><span class="annot"><span class="annottext">FixityEnv
</span><a href="#local-6989586621682984761"><span class="hs-identifier hs-var">old_fix_env</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-933"></span><span>                </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682984760"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="GHC.Tc.Types.html#tcg_fix_env"><span class="hs-identifier hs-var">tcg_fix_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html#extendNameEnvList"><span class="hs-identifier hs-type">extendNameEnvList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984761"><span class="hs-identifier hs-type">old_fix_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984759"><span class="hs-identifier hs-type">new_bit</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-934"></span><span>
</span><span id="line-935"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getDeclaredDefaultTys"><span class="hs-identifier hs-type">getDeclaredDefaultTys</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Types.DefaultEnv.html#DefaultEnv"><span class="hs-identifier hs-type">DefaultEnv</span></a></span><span>
</span><span id="line-936"></span><span id="getDeclaredDefaultTys"><span class="annot"><span class="annottext">getDeclaredDefaultTys :: TcRn DefaultEnv
</span><a href="GHC.Tc.Utils.Monad.html#getDeclaredDefaultTys"><span class="hs-identifier hs-var hs-var">getDeclaredDefaultTys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984763"><span class="annot"><a href="#local-6989586621682984763"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#tcg_default"><span class="hs-identifier hs-var">tcg_default</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984763"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-937"></span><span>
</span><span id="line-938"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addDependentFiles"><span class="hs-identifier hs-type">addDependentFiles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-939"></span><span id="addDependentFiles"><span class="annot"><span class="annottext">addDependentFiles :: [FilePath] -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addDependentFiles"><span class="hs-identifier hs-var hs-var">addDependentFiles</span></a></span></span><span> </span><span id="local-6989586621682984764"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682984764"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-940"></span><span>  </span><span id="local-6989586621682984765"><span class="annot"><a href="#local-6989586621682984765"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TcGblEnv -&gt; IORef [FilePath])
-&gt; TcRnIf TcGblEnv TcLclEnv TcGblEnv
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (IORef [FilePath])
forall a b.
(a -&gt; b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; IORef [FilePath]
</span><a href="GHC.Tc.Types.html#tcg_dependent_files"><span class="hs-identifier hs-var">tcg_dependent_files</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-941"></span><span>  </span><span id="local-6989586621682984766"><span class="annot"><a href="#local-6989586621682984766"><span class="hs-identifier hs-var">dep_files</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-type">readTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984765"><span class="hs-identifier hs-type">ref</span></a></span><span>
</span><span id="line-942"></span><span>  </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#writeTcRef"><span class="hs-identifier hs-type">writeTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984765"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682984764"><span class="hs-identifier hs-type">fs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621682984766"><span class="hs-identifier hs-type">dep_files</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-943"></span><span>
</span><span id="line-944"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Error management
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-951"></span><span>
</span><span id="line-952"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-type">getSrcSpanM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span>
</span><span id="line-953"></span><span>        </span><span class="hs-comment">-- Avoid clash with Name.getSrcLoc</span><span>
</span><span id="line-954"></span><span id="getSrcSpanM"><span class="annot"><span class="annottext">getSrcSpanM :: TcRn SrcSpan
</span><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-var hs-var">getSrcSpanM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984767"><span class="annot"><a href="#local-6989586621682984767"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#RealSrcSpan"><span class="hs-identifier hs-type">RealSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#getLclEnvLoc"><span class="hs-identifier hs-type">getLclEnvLoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984767"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Data.Strict.html#Nothing"><span class="hs-identifier hs-type">Strict.Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-955"></span><span>
</span><span id="line-956"></span><span class="hs-comment">-- See Note [Error contexts in generated code]</span><span>
</span><span id="line-957"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#inGeneratedCode"><span class="hs-identifier hs-type">inGeneratedCode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-958"></span><span id="inGeneratedCode"><span class="annot"><span class="annottext">inGeneratedCode :: TcRn Bool
</span><a href="GHC.Tc.Utils.Monad.html#inGeneratedCode"><span class="hs-identifier hs-var hs-var">inGeneratedCode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLclEnv -&gt; Bool
</span><a href="GHC.Tc.Types.LclEnv.html#lclEnvInGeneratedCode"><span class="hs-identifier hs-var">lclEnvInGeneratedCode</span></a></span><span> </span><span class="annot"><span class="annottext">(TcLclEnv -&gt; Bool)
-&gt; TcRnIf TcGblEnv TcLclEnv TcLclEnv -&gt; TcRn Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span>
</span><span id="line-959"></span><span>
</span><span id="line-960"></span><span id="local-6989586621682983378"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-type">setSrcSpan</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983378"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983378"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-961"></span><span class="hs-comment">-- See Note [Error contexts in generated code]</span><span>
</span><span id="line-962"></span><span class="hs-comment">-- for the tcl_in_gen_code manipulation</span><span>
</span><span id="line-963"></span><span id="setSrcSpan"><span class="annot"><span class="annottext">setSrcSpan :: forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var hs-var">setSrcSpan</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#RealSrcSpan"><span class="hs-identifier hs-type">RealSrcSpan</span></a></span><span> </span><span id="local-6989586621682984772"><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621682984772"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe BufSpan
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682984773"><span class="annot"><span class="annottext">TcRn a
</span><a href="#local-6989586621682984773"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-964"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcLclCtxt -&gt; TcLclCtxt) -&gt; TcRn a -&gt; TcRn a
forall gbl a.
(TcLclCtxt -&gt; TcLclCtxt)
-&gt; TcRnIf gbl TcLclEnv a -&gt; TcRnIf gbl TcLclEnv a
</span><a href="GHC.Tc.Utils.Monad.html#updLclCtxt"><span class="hs-identifier hs-var">updLclCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682984774"><span class="annot"><span class="annottext">TcLclCtxt
</span><a href="#local-6989586621682984774"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcLclCtxt
</span><a href="#local-6989586621682984774"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#tcl_loc"><span class="hs-identifier hs-var">tcl_loc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682984772"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#tcl_in_gen_code"><span class="hs-identifier hs-var">tcl_in_gen_code</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-965"></span><span>              </span><span class="annot"><span class="annottext">TcRn a
</span><a href="#local-6989586621682984773"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-966"></span><span>
</span><span id="line-967"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span id="local-6989586621682984775"><span class="annot"><span class="annottext">loc :: SrcSpan
</span><a href="#local-6989586621682984775"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#UnhelpfulSpan"><span class="hs-identifier hs-type">UnhelpfulSpan</span></a></span><span> </span><span class="annot"><span class="annottext">UnhelpfulSpanReason
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682984777"><span class="annot"><span class="annottext">TcRn a
</span><a href="#local-6989586621682984777"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-968"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; Bool
</span><a href="GHC.Types.SrcLoc.html#isGeneratedSrcSpan"><span class="hs-identifier hs-var">isGeneratedSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682984775"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-969"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRn a -&gt; TcRn a
forall a. TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setInGeneratedCode"><span class="hs-identifier hs-var">setInGeneratedCode</span></a></span><span> </span><span class="annot"><span class="annottext">TcRn a
</span><a href="#local-6989586621682984777"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-970"></span><span>
</span><span id="line-971"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-972"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRn a
</span><a href="#local-6989586621682984777"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-973"></span><span>
</span><span id="line-974"></span><span class="hs-comment">-- | Mark the inner computation as being done inside generated code.</span><span>
</span><span id="line-975"></span><span class="hs-comment">--</span><span>
</span><span id="line-976"></span><span class="hs-comment">-- See Note [Error contexts in generated code]</span><span>
</span><span id="line-977"></span><span id="local-6989586621682984779"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setInGeneratedCode"><span class="hs-identifier hs-type">setInGeneratedCode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984779"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984779"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-978"></span><span id="setInGeneratedCode"><span class="annot"><span class="annottext">setInGeneratedCode :: forall a. TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setInGeneratedCode"><span class="hs-identifier hs-var hs-var">setInGeneratedCode</span></a></span></span><span> </span><span id="local-6989586621682984780"><span class="annot"><span class="annottext">TcRn a
</span><a href="#local-6989586621682984780"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-979"></span><span>  </span><span class="annot"><span class="annottext">(TcLclCtxt -&gt; TcLclCtxt) -&gt; TcRn a -&gt; TcRn a
forall gbl a.
(TcLclCtxt -&gt; TcLclCtxt)
-&gt; TcRnIf gbl TcLclEnv a -&gt; TcRnIf gbl TcLclEnv a
</span><a href="GHC.Tc.Utils.Monad.html#updLclCtxt"><span class="hs-identifier hs-var">updLclCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682984781"><span class="annot"><span class="annottext">TcLclCtxt
</span><a href="#local-6989586621682984781"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcLclCtxt
</span><a href="#local-6989586621682984781"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#tcl_in_gen_code"><span class="hs-identifier hs-var">tcl_in_gen_code</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcRn a
</span><a href="#local-6989586621682984780"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-980"></span><span>
</span><span id="line-981"></span><span id="local-6989586621682983382"><span id="local-6989586621682983384"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-type">setSrcSpanA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#EpAnn"><span class="hs-identifier hs-type">EpAnn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983382"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983384"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983384"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-982"></span><span id="setSrcSpanA"><span class="annot"><span class="annottext">setSrcSpanA :: forall ann a. EpAnn ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var hs-var">setSrcSpanA</span></a></span></span><span> </span><span id="local-6989586621682984784"><span class="annot"><span class="annottext">EpAnn ann
</span><a href="#local-6989586621682984784"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRn a -&gt; TcRn a
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpAnn ann -&gt; SrcSpan
forall a. HasLoc a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-var">locA</span></a></span><span> </span><span class="annot"><span class="annottext">EpAnn ann
</span><a href="#local-6989586621682984784"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-983"></span><span>
</span><span id="line-984"></span><span id="local-6989586621682983390"><span id="local-6989586621682983391"><span id="local-6989586621682983392"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addLocM"><span class="hs-identifier hs-type">addLocM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#HasLoc"><span class="hs-identifier hs-type">HasLoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983390"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682983391"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983392"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#GenLocated"><span class="hs-identifier hs-type">GenLocated</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983390"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983391"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983392"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span>
</span><span id="line-985"></span><span id="addLocM"><span class="annot"><span class="annottext">addLocM :: forall t a b. HasLoc t =&gt; (a -&gt; TcM b) -&gt; GenLocated t a -&gt; TcM b
</span><a href="GHC.Tc.Utils.Monad.html#addLocM"><span class="hs-identifier hs-var hs-var">addLocM</span></a></span></span><span> </span><span id="local-6989586621682984788"><span class="annot"><span class="annottext">a -&gt; TcM b
</span><a href="#local-6989586621682984788"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682984790"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682984790"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682984791"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682984791"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcM b -&gt; TcM b
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t -&gt; SrcSpan
forall a. HasLoc a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#getHasLoc"><span class="hs-identifier hs-var">getHasLoc</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682984790"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM b -&gt; TcM b) -&gt; TcM b -&gt; TcM b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; TcM b
</span><a href="#local-6989586621682984788"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682984791"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-986"></span><span>
</span><span id="line-987"></span><span id="local-6989586621682983396"><span id="local-6989586621682983397"><span id="local-6989586621682983398"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#wrapLocM"><span class="hs-identifier hs-type">wrapLocM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#HasLoc"><span class="hs-identifier hs-type">HasLoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983396"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682983397"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983398"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#GenLocated"><span class="hs-identifier hs-type">GenLocated</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983396"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983397"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983398"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-988"></span><span id="wrapLocM"><span class="annot"><span class="annottext">wrapLocM :: forall t a b.
HasLoc t =&gt;
(a -&gt; TcM b) -&gt; GenLocated t a -&gt; TcM (Located b)
</span><a href="GHC.Tc.Utils.Monad.html#wrapLocM"><span class="hs-identifier hs-var hs-var">wrapLocM</span></a></span></span><span> </span><span id="local-6989586621682984797"><span class="annot"><span class="annottext">a -&gt; TcM b
</span><a href="#local-6989586621682984797"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682984798"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682984798"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682984799"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682984799"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-989"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-990"></span><span>    </span><span id="local-6989586621682984800"><span class="annot"><span class="annottext">loc' :: SrcSpan
</span><a href="#local-6989586621682984800"><span class="hs-identifier hs-var hs-var">loc'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">t -&gt; SrcSpan
forall a. HasLoc a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#getHasLoc"><span class="hs-identifier hs-var">getHasLoc</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682984798"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-991"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRn (Located b) -&gt; TcRn (Located b)
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682984800"><span class="hs-identifier hs-var">loc'</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn (Located b) -&gt; TcRn (Located b))
-&gt; TcRn (Located b) -&gt; TcRn (Located b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984801"><span class="annot"><a href="#local-6989586621682984801"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">a -&gt; TcM b
</span><a href="#local-6989586621682984797"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682984799"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-992"></span><span>                          </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984800"><span class="hs-identifier hs-type">loc'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984801"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-993"></span><span>
</span><span id="line-994"></span><span id="local-6989586621682983405"><span id="local-6989586621682983406"><span id="local-6989586621682983407"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#wrapLocMA"><span class="hs-identifier hs-type">wrapLocMA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682983405"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983406"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#GenLocated"><span class="hs-identifier hs-type">GenLocated</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#EpAnn"><span class="hs-identifier hs-type">EpAnn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983407"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682983405"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#GenLocated"><span class="hs-identifier hs-type">GenLocated</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#EpAnn"><span class="hs-identifier hs-type">EpAnn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983407"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682983406"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-995"></span><span id="wrapLocMA"><span class="annot"><span class="annottext">wrapLocMA :: forall a b ann.
(a -&gt; TcM b)
-&gt; GenLocated (EpAnn ann) a -&gt; TcRn (GenLocated (EpAnn ann) b)
</span><a href="GHC.Tc.Utils.Monad.html#wrapLocMA"><span class="hs-identifier hs-var hs-var">wrapLocMA</span></a></span></span><span> </span><span id="local-6989586621682984804"><span class="annot"><span class="annottext">a -&gt; TcM b
</span><a href="#local-6989586621682984804"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682984805"><span class="annot"><span class="annottext">EpAnn ann
</span><a href="#local-6989586621682984805"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682984806"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682984806"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EpAnn ann
-&gt; TcRn (GenLocated (EpAnn ann) b)
-&gt; TcRn (GenLocated (EpAnn ann) b)
forall ann a. EpAnn ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">EpAnn ann
</span><a href="#local-6989586621682984805"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn (GenLocated (EpAnn ann) b)
 -&gt; TcRn (GenLocated (EpAnn ann) b))
-&gt; TcRn (GenLocated (EpAnn ann) b)
-&gt; TcRn (GenLocated (EpAnn ann) b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984807"><span class="annot"><a href="#local-6989586621682984807"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">a -&gt; TcM b
</span><a href="#local-6989586621682984804"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682984806"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-996"></span><span>                                              </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984805"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984807"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-997"></span><span>
</span><span id="line-998"></span><span id="local-6989586621682983411"><span id="local-6989586621682983412"><span id="local-6989586621682983413"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#wrapLocFstM"><span class="hs-identifier hs-type">wrapLocFstM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682983411"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682983412"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621682983413"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983411"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983412"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682983413"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-999"></span><span id="wrapLocFstM"><span class="annot"><span class="annottext">wrapLocFstM :: forall a b c. (a -&gt; TcM (b, c)) -&gt; Located a -&gt; TcM (Located b, c)
</span><a href="GHC.Tc.Utils.Monad.html#wrapLocFstM"><span class="hs-identifier hs-var hs-var">wrapLocFstM</span></a></span></span><span> </span><span id="local-6989586621682984810"><span class="annot"><span class="annottext">a -&gt; TcM (b, c)
</span><a href="#local-6989586621682984810"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682984811"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682984811"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682984812"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682984812"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1000"></span><span>  </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRn (Located b, c) -&gt; TcRn (Located b, c)
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682984811"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn (Located b, c) -&gt; TcRn (Located b, c))
-&gt; TcRn (Located b, c) -&gt; TcRn (Located b, c)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1001"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682984813"><span class="annot"><a href="#local-6989586621682984813"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682984814"><span class="annot"><a href="#local-6989586621682984814"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">a -&gt; TcM (b, c)
</span><a href="#local-6989586621682984810"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682984812"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1002"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984811"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984813"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682984814"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1003"></span><span>
</span><span id="line-1004"></span><span class="hs-comment">-- Possible instantiations:</span><span>
</span><span id="line-1005"></span><span class="hs-comment">--    wrapLocFstMA :: (a -&gt; TcM (b,c)) -&gt; LocatedA    a -&gt; TcM (LocatedA    b, c)</span><span>
</span><span id="line-1006"></span><span class="hs-comment">--    wrapLocFstMA :: (a -&gt; TcM (b,c)) -&gt; LocatedN    a -&gt; TcM (LocatedN    b, c)</span><span>
</span><span id="line-1007"></span><span class="hs-comment">--    wrapLocFstMA :: (a -&gt; TcM (b,c)) -&gt; LocatedAn t a -&gt; TcM (LocatedAn t b, c)</span><span>
</span><span id="line-1008"></span><span class="hs-comment">-- and so on.</span><span>
</span><span id="line-1009"></span><span id="local-6989586621682983417"><span id="local-6989586621682983418"><span id="local-6989586621682983419"><span id="local-6989586621682983420"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#wrapLocFstMA"><span class="hs-identifier hs-type">wrapLocFstMA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682983417"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682983418"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621682983419"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#GenLocated"><span class="hs-identifier hs-type">GenLocated</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#EpAnn"><span class="hs-identifier hs-type">EpAnn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983420"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682983417"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#GenLocated"><span class="hs-identifier hs-type">GenLocated</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#EpAnn"><span class="hs-identifier hs-type">EpAnn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983420"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682983418"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682983419"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-1010"></span><span id="wrapLocFstMA"><span class="annot"><span class="annottext">wrapLocFstMA :: forall a b c ann.
(a -&gt; TcM (b, c))
-&gt; GenLocated (EpAnn ann) a -&gt; TcM (GenLocated (EpAnn ann) b, c)
</span><a href="GHC.Tc.Utils.Monad.html#wrapLocFstMA"><span class="hs-identifier hs-var hs-var">wrapLocFstMA</span></a></span></span><span> </span><span id="local-6989586621682984817"><span class="annot"><span class="annottext">a -&gt; TcM (b, c)
</span><a href="#local-6989586621682984817"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682984818"><span class="annot"><span class="annottext">EpAnn ann
</span><a href="#local-6989586621682984818"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682984819"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682984819"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1011"></span><span>  </span><span class="annot"><span class="annottext">EpAnn ann
-&gt; TcRn (GenLocated (EpAnn ann) b, c)
-&gt; TcRn (GenLocated (EpAnn ann) b, c)
forall ann a. EpAnn ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">EpAnn ann
</span><a href="#local-6989586621682984818"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn (GenLocated (EpAnn ann) b, c)
 -&gt; TcRn (GenLocated (EpAnn ann) b, c))
-&gt; TcRn (GenLocated (EpAnn ann) b, c)
-&gt; TcRn (GenLocated (EpAnn ann) b, c)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1012"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682984820"><span class="annot"><a href="#local-6989586621682984820"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682984821"><span class="annot"><a href="#local-6989586621682984821"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">a -&gt; TcM (b, c)
</span><a href="#local-6989586621682984817"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682984819"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1013"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984818"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984820"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682984821"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1014"></span><span>
</span><span id="line-1015"></span><span id="local-6989586621682983425"><span id="local-6989586621682983426"><span id="local-6989586621682983427"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#wrapLocSndM"><span class="hs-identifier hs-type">wrapLocSndM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682983425"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682983426"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682983427"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983425"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682983426"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983427"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-1016"></span><span id="wrapLocSndM"><span class="annot"><span class="annottext">wrapLocSndM :: forall a b c. (a -&gt; TcM (b, c)) -&gt; Located a -&gt; TcM (b, Located c)
</span><a href="GHC.Tc.Utils.Monad.html#wrapLocSndM"><span class="hs-identifier hs-var hs-var">wrapLocSndM</span></a></span></span><span> </span><span id="local-6989586621682984824"><span class="annot"><span class="annottext">a -&gt; TcM (b, c)
</span><a href="#local-6989586621682984824"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682984825"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682984825"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682984826"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682984826"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1017"></span><span>  </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRn (b, Located c) -&gt; TcRn (b, Located c)
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682984825"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn (b, Located c) -&gt; TcRn (b, Located c))
-&gt; TcRn (b, Located c) -&gt; TcRn (b, Located c)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1018"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682984827"><span class="annot"><a href="#local-6989586621682984827"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682984828"><span class="annot"><a href="#local-6989586621682984828"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">a -&gt; TcM (b, c)
</span><a href="#local-6989586621682984824"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682984826"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1019"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682984827"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984825"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984828"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1020"></span><span>
</span><span id="line-1021"></span><span class="hs-comment">-- Possible instantiations:</span><span>
</span><span id="line-1022"></span><span class="hs-comment">--    wrapLocSndMA :: (a -&gt; TcM (b, c)) -&gt; LocatedA    a -&gt; TcM (b, LocatedA    c)</span><span>
</span><span id="line-1023"></span><span class="hs-comment">--    wrapLocSndMA :: (a -&gt; TcM (b, c)) -&gt; LocatedN    a -&gt; TcM (b, LocatedN    c)</span><span>
</span><span id="line-1024"></span><span class="hs-comment">--    wrapLocSndMA :: (a -&gt; TcM (b, c)) -&gt; LocatedAn t a -&gt; TcM (b, LocatedAn t c)</span><span>
</span><span id="line-1025"></span><span class="hs-comment">-- and so on.</span><span>
</span><span id="line-1026"></span><span id="local-6989586621682983431"><span id="local-6989586621682983432"><span id="local-6989586621682983433"><span id="local-6989586621682983434"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#wrapLocSndMA"><span class="hs-identifier hs-type">wrapLocSndMA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682983431"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682983432"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682983433"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#GenLocated"><span class="hs-identifier hs-type">GenLocated</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#EpAnn"><span class="hs-identifier hs-type">EpAnn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983434"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682983431"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682983432"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#GenLocated"><span class="hs-identifier hs-type">GenLocated</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#EpAnn"><span class="hs-identifier hs-type">EpAnn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983434"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682983433"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-1027"></span><span id="wrapLocSndMA"><span class="annot"><span class="annottext">wrapLocSndMA :: forall a b c ann.
(a -&gt; TcM (b, c))
-&gt; GenLocated (EpAnn ann) a -&gt; TcM (b, GenLocated (EpAnn ann) c)
</span><a href="GHC.Tc.Utils.Monad.html#wrapLocSndMA"><span class="hs-identifier hs-var hs-var">wrapLocSndMA</span></a></span></span><span> </span><span id="local-6989586621682984831"><span class="annot"><span class="annottext">a -&gt; TcM (b, c)
</span><a href="#local-6989586621682984831"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682984832"><span class="annot"><span class="annottext">EpAnn ann
</span><a href="#local-6989586621682984832"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682984833"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682984833"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1028"></span><span>  </span><span class="annot"><span class="annottext">EpAnn ann
-&gt; TcRn (b, GenLocated (EpAnn ann) c)
-&gt; TcRn (b, GenLocated (EpAnn ann) c)
forall ann a. EpAnn ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">EpAnn ann
</span><a href="#local-6989586621682984832"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn (b, GenLocated (EpAnn ann) c)
 -&gt; TcRn (b, GenLocated (EpAnn ann) c))
-&gt; TcRn (b, GenLocated (EpAnn ann) c)
-&gt; TcRn (b, GenLocated (EpAnn ann) c)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1029"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682984834"><span class="annot"><a href="#local-6989586621682984834"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682984835"><span class="annot"><a href="#local-6989586621682984835"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">a -&gt; TcM (b, c)
</span><a href="#local-6989586621682984831"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682984833"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1030"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682984834"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984832"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984835"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1031"></span><span>
</span><span id="line-1032"></span><span id="local-6989586621682983439"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#wrapLocM_"><span class="hs-identifier hs-type">wrapLocM_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682983439"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983439"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1033"></span><span id="wrapLocM_"><span class="annot"><span class="annottext">wrapLocM_ :: forall a. (a -&gt; TcM ()) -&gt; Located a -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#wrapLocM_"><span class="hs-identifier hs-var hs-var">wrapLocM_</span></a></span></span><span> </span><span id="local-6989586621682984836"><span class="annot"><span class="annottext">a -&gt; TcM ()
</span><a href="#local-6989586621682984836"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682984837"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682984837"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682984838"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682984838"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcM () -&gt; TcM ()
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682984837"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; TcM ()
</span><a href="#local-6989586621682984836"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682984838"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1034"></span><span>
</span><span id="line-1035"></span><span id="local-6989586621682983441"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#wrapLocMA_"><span class="hs-identifier hs-type">wrapLocMA_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682983441"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983441"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1036"></span><span id="wrapLocMA_"><span class="annot"><span class="annottext">wrapLocMA_ :: forall a. (a -&gt; TcM ()) -&gt; LocatedA a -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#wrapLocMA_"><span class="hs-identifier hs-var hs-var">wrapLocMA_</span></a></span></span><span> </span><span id="local-6989586621682984840"><span class="annot"><span class="annottext">a -&gt; TcM ()
</span><a href="#local-6989586621682984840"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682984841"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621682984841"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682984842"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682984842"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcM () -&gt; TcM ()
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; SrcSpan
forall a. HasLoc a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-var">locA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621682984841"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; TcM ()
</span><a href="#local-6989586621682984840"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682984842"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1037"></span><span>
</span><span id="line-1038"></span><span class="hs-comment">-- Reporting errors</span><span>
</span><span id="line-1039"></span><span>
</span><span id="line-1040"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getErrsVar"><span class="hs-identifier hs-type">getErrsVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1041"></span><span id="getErrsVar"><span class="annot"><span class="annottext">getErrsVar :: TcRn (IORef (Messages TcRnMessage))
</span><a href="GHC.Tc.Utils.Monad.html#getErrsVar"><span class="hs-identifier hs-var hs-var">getErrsVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984843"><span class="annot"><a href="#local-6989586621682984843"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#tcl_errs"><span class="hs-identifier hs-var">tcl_errs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984843"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1042"></span><span>
</span><span id="line-1043"></span><span id="local-6989586621682983444"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setErrsVar"><span class="hs-identifier hs-type">setErrsVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983444"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983444"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1044"></span><span id="setErrsVar"><span class="annot"><span class="annottext">setErrsVar :: forall a. IORef (Messages TcRnMessage) -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setErrsVar"><span class="hs-identifier hs-var hs-var">setErrsVar</span></a></span></span><span> </span><span id="local-6989586621682984844"><span class="annot"><span class="annottext">IORef (Messages TcRnMessage)
</span><a href="#local-6989586621682984844"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcLclEnv -&gt; TcLclEnv)
-&gt; TcRnIf TcGblEnv TcLclEnv a -&gt; TcRnIf TcGblEnv TcLclEnv a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682984845"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682984845"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682984845"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#tcl_errs"><span class="hs-identifier hs-var">tcl_errs</span></a></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><a href="#local-6989586621682984844"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1045"></span><span>
</span><span id="line-1046"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-type">addErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1047"></span><span id="addErr"><span class="annot"><span class="annottext">addErr :: TcRnMessage -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var hs-var">addErr</span></a></span></span><span> </span><span id="local-6989586621682984846"><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682984846"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984847"><span class="annot"><a href="#local-6989586621682984847"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn SrcSpan
</span><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrAt"><span class="hs-identifier hs-type">addErrAt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984847"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984846"><span class="hs-identifier hs-type">msg</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1048"></span><span>
</span><span id="line-1049"></span><span id="local-6989586621682983446"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failWith"><span class="hs-identifier hs-type">failWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983446"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1050"></span><span id="failWith"><span class="annot"><span class="annottext">failWith :: forall a. TcRnMessage -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWith"><span class="hs-identifier hs-var hs-var">failWith</span></a></span></span><span> </span><span id="local-6989586621682984849"><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682984849"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682984849"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">TcM ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall a b.
IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) a
forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a></span><span>
</span><span id="line-1051"></span><span>
</span><span id="line-1052"></span><span id="local-6989586621682983450"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failAt"><span class="hs-identifier hs-type">failAt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983450"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1053"></span><span id="failAt"><span class="annot"><span class="annottext">failAt :: forall a. SrcSpan -&gt; TcRnMessage -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failAt"><span class="hs-identifier hs-var hs-var">failAt</span></a></span></span><span> </span><span id="local-6989586621682984852"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682984852"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682984853"><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682984853"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRnMessage -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrAt"><span class="hs-identifier hs-var">addErrAt</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682984852"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682984853"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">TcM ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall a b.
IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) a
forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a></span><span>
</span><span id="line-1054"></span><span>
</span><span id="line-1055"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrAt"><span class="hs-identifier hs-type">addErrAt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1056"></span><span class="hs-comment">-- addErrAt is mainly (exclusively?) used by the renamer, where</span><span>
</span><span id="line-1057"></span><span class="hs-comment">-- tidying is not an issue, but it's all lazy so the extra</span><span>
</span><span id="line-1058"></span><span class="hs-comment">-- work doesn't matter</span><span>
</span><span id="line-1059"></span><span id="addErrAt"><span class="annot"><span class="annottext">addErrAt :: SrcSpan -&gt; TcRnMessage -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrAt"><span class="hs-identifier hs-var hs-var">addErrAt</span></a></span></span><span> </span><span id="local-6989586621682984854"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682984854"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682984855"><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682984855"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984856"><span class="annot"><a href="#local-6989586621682984856"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM [ErrCtxt]
</span><a href="GHC.Tc.Utils.Monad.html#getErrCtxt"><span class="hs-identifier hs-var">getErrCtxt</span></a></span><span>
</span><span id="line-1060"></span><span>                      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682984857"><span class="annot"><a href="#local-6989586621682984857"><span class="hs-identifier hs-var">tidy_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-type">liftZonkM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#tcInitTidyEnv"><span class="hs-identifier hs-type">tcInitTidyEnv</span></a></span><span>
</span><span id="line-1061"></span><span>                      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682984859"><span class="annot"><a href="#local-6989586621682984859"><span class="hs-identifier hs-var">err_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mkErrInfo"><span class="hs-identifier hs-type">mkErrInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984857"><span class="hs-identifier hs-type">tidy_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984856"><span class="hs-identifier hs-type">ctxt</span></a></span><span>
</span><span id="line-1062"></span><span>                      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682984860"><span class="annot"><a href="#local-6989586621682984860"><span class="hs-identifier hs-var hs-var">detailed_msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ErrInfo -&gt; TcRnMessage -&gt; TcRnMessageDetailed
</span><a href="GHC.Tc.Utils.Monad.html#mkDetailedMessage"><span class="hs-identifier hs-var">mkDetailedMessage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; ErrInfo
</span><a href="GHC.Tc.Errors.Types.html#ErrInfo"><span class="hs-identifier hs-var">ErrInfo</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682984859"><span class="hs-identifier hs-var">err_info</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">Outputable.empty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682984855"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-1063"></span><span>                      </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#add_long_err_at"><span class="hs-identifier hs-type">add_long_err_at</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984854"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984860"><span class="hs-identifier hs-type">detailed_msg</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1064"></span><span>
</span><span id="line-1065"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mkDetailedMessage"><span class="hs-identifier hs-type">mkDetailedMessage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#ErrInfo"><span class="hs-identifier hs-type">ErrInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessageDetailed"><span class="hs-identifier hs-type">TcRnMessageDetailed</span></a></span><span>
</span><span id="line-1066"></span><span id="mkDetailedMessage"><span class="annot"><span class="annottext">mkDetailedMessage :: ErrInfo -&gt; TcRnMessage -&gt; TcRnMessageDetailed
</span><a href="GHC.Tc.Utils.Monad.html#mkDetailedMessage"><span class="hs-identifier hs-var hs-var">mkDetailedMessage</span></a></span></span><span> </span><span id="local-6989586621682984864"><span class="annot"><span class="annottext">ErrInfo
</span><a href="#local-6989586621682984864"><span class="hs-identifier hs-var">err_info</span></a></span></span><span> </span><span id="local-6989586621682984865"><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682984865"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1067"></span><span>  </span><span class="annot"><span class="annottext">ErrInfo -&gt; TcRnMessage -&gt; TcRnMessageDetailed
</span><a href="GHC.Tc.Errors.Types.html#TcRnMessageDetailed"><span class="hs-identifier hs-var">TcRnMessageDetailed</span></a></span><span> </span><span class="annot"><span class="annottext">ErrInfo
</span><a href="#local-6989586621682984864"><span class="hs-identifier hs-var">err_info</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682984865"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-1068"></span><span>
</span><span id="line-1069"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrs"><span class="hs-identifier hs-type">addErrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1070"></span><span id="addErrs"><span class="annot"><span class="annottext">addErrs :: [(SrcSpan, TcRnMessage)] -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrs"><span class="hs-identifier hs-var hs-var">addErrs</span></a></span></span><span> </span><span id="local-6989586621682984867"><span class="annot"><span class="annottext">[(SrcSpan, TcRnMessage)]
</span><a href="#local-6989586621682984867"><span class="hs-identifier hs-var">msgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((SrcSpan, TcRnMessage) -&gt; TcM ())
-&gt; [(SrcSpan, TcRnMessage)] -&gt; TcM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">(SrcSpan, TcRnMessage) -&gt; TcM ()
</span><a href="#local-6989586621682984869"><span class="hs-identifier hs-var">add</span></a></span><span> </span><span class="annot"><span class="annottext">[(SrcSpan, TcRnMessage)]
</span><a href="#local-6989586621682984867"><span class="hs-identifier hs-var">msgs</span></a></span><span>
</span><span id="line-1071"></span><span>             </span><span class="hs-keyword">where</span><span>
</span><span id="line-1072"></span><span>               </span><span id="local-6989586621682984869"><span class="annot"><span class="annottext">add :: (SrcSpan, TcRnMessage) -&gt; TcM ()
</span><a href="#local-6989586621682984869"><span class="hs-identifier hs-var hs-var">add</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682984870"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682984870"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682984871"><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682984871"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRnMessage -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrAt"><span class="hs-identifier hs-var">addErrAt</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682984870"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682984871"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-1073"></span><span>
</span><span id="line-1074"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#checkErr"><span class="hs-identifier hs-type">checkErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1075"></span><span class="hs-comment">-- Add the error if the bool is False</span><span>
</span><span id="line-1076"></span><span id="checkErr"><span class="annot"><span class="annottext">checkErr :: Bool -&gt; TcRnMessage -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#checkErr"><span class="hs-identifier hs-var hs-var">checkErr</span></a></span></span><span> </span><span id="local-6989586621682984872"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682984872"><span class="hs-identifier hs-var">ok</span></a></span></span><span> </span><span id="local-6989586621682984873"><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682984873"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcM () -&gt; TcM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682984872"><span class="hs-identifier hs-var">ok</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682984873"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1077"></span><span>
</span><span id="line-1078"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#checkErrAt"><span class="hs-identifier hs-type">checkErrAt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1079"></span><span id="checkErrAt"><span class="annot"><span class="annottext">checkErrAt :: SrcSpan -&gt; Bool -&gt; TcRnMessage -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#checkErrAt"><span class="hs-identifier hs-var hs-var">checkErrAt</span></a></span></span><span> </span><span id="local-6989586621682984874"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682984874"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682984875"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682984875"><span class="hs-identifier hs-var">ok</span></a></span></span><span> </span><span id="local-6989586621682984876"><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682984876"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcM () -&gt; TcM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682984875"><span class="hs-identifier hs-var">ok</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRnMessage -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrAt"><span class="hs-identifier hs-var">addErrAt</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682984874"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682984876"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1080"></span><span>
</span><span id="line-1081"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addMessages"><span class="hs-identifier hs-type">addMessages</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1082"></span><span id="addMessages"><span class="annot"><span class="annottext">addMessages :: Messages TcRnMessage -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addMessages"><span class="hs-identifier hs-var hs-var">addMessages</span></a></span></span><span> </span><span id="local-6989586621682984877"><span class="annot"><span class="annottext">Messages TcRnMessage
</span><a href="#local-6989586621682984877"><span class="hs-identifier hs-var">msgs1</span></a></span></span><span>
</span><span id="line-1083"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984878"><span class="annot"><a href="#local-6989586621682984878"><span class="hs-identifier hs-var">errs_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn (IORef (Messages TcRnMessage))
</span><a href="GHC.Tc.Utils.Monad.html#getErrsVar"><span class="hs-identifier hs-var">getErrsVar</span></a></span><span>
</span><span id="line-1084"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682984879"><span class="annot"><a href="#local-6989586621682984879"><span class="hs-identifier hs-var">msgs0</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-type">readTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984878"><span class="hs-identifier hs-type">errs_var</span></a></span><span>
</span><span id="line-1085"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#writeTcRef"><span class="hs-identifier hs-type">writeTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984878"><span class="hs-identifier hs-type">errs_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682984879"><span class="hs-identifier hs-type">msgs0</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Error.html#unionMessages"><span class="hs-operator hs-type">`unionMessages`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984877"><span class="hs-identifier hs-type">msgs1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1086"></span><span>
</span><span id="line-1087"></span><span id="local-6989586621682984881"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#discardWarnings"><span class="hs-identifier hs-type">discardWarnings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984881"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984881"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1088"></span><span class="hs-comment">-- Ignore warnings inside the thing inside;</span><span>
</span><span id="line-1089"></span><span class="hs-comment">-- used to ignore-unused-variable warnings inside derived code</span><span>
</span><span id="line-1090"></span><span id="discardWarnings"><span class="annot"><span class="annottext">discardWarnings :: forall a. TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#discardWarnings"><span class="hs-identifier hs-var hs-var">discardWarnings</span></a></span></span><span> </span><span id="local-6989586621682984895"><span class="annot"><span class="annottext">TcRn a
</span><a href="#local-6989586621682984895"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1091"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984896"><span class="annot"><a href="#local-6989586621682984896"><span class="hs-identifier hs-var">errs_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn (IORef (Messages TcRnMessage))
</span><a href="GHC.Tc.Utils.Monad.html#getErrsVar"><span class="hs-identifier hs-var">getErrsVar</span></a></span><span>
</span><span id="line-1092"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682984897"><span class="annot"><a href="#local-6989586621682984897"><span class="hs-identifier hs-var">old_warns</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Types.Error.html#getWarningMessages"><span class="hs-identifier hs-type">getWarningMessages</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-type">readTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984896"><span class="hs-identifier hs-type">errs_var</span></a></span><span>
</span><span id="line-1093"></span><span>
</span><span id="line-1094"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682984899"><span class="annot"><a href="#local-6989586621682984899"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682984895"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-1095"></span><span>
</span><span id="line-1096"></span><span>        </span><span class="hs-comment">-- Revert warnings to old_warns</span><span>
</span><span id="line-1097"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682984900"><span class="annot"><a href="#local-6989586621682984900"><span class="hs-identifier hs-var">new_errs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Types.Error.html#getErrorMessages"><span class="hs-identifier hs-type">getErrorMessages</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-type">readTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984896"><span class="hs-identifier hs-type">errs_var</span></a></span><span>
</span><span id="line-1098"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#writeTcRef"><span class="hs-identifier hs-type">writeTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984896"><span class="hs-identifier hs-type">errs_var</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Types.Error.html#mkMessages"><span class="hs-identifier hs-type">mkMessages</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682984897"><span class="hs-identifier hs-type">old_warns</span></a></span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#unionBags"><span class="hs-operator hs-type">`unionBags`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984900"><span class="hs-identifier hs-type">new_errs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1099"></span><span>
</span><span id="line-1100"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682984899"><span class="hs-identifier hs-type">result</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1101"></span><span>
</span><span id="line-1102"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Shared error message stuff: renamer and typechecker
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1109"></span><span>
</span><span id="line-1110"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#add_long_err_at"><span class="hs-identifier hs-type">add_long_err_at</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessageDetailed"><span class="hs-identifier hs-type">TcRnMessageDetailed</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1111"></span><span id="add_long_err_at"><span class="annot"><span class="annottext">add_long_err_at :: SrcSpan -&gt; TcRnMessageDetailed -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#add_long_err_at"><span class="hs-identifier hs-var hs-var">add_long_err_at</span></a></span></span><span> </span><span id="local-6989586621682984904"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682984904"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682984905"><span class="annot"><span class="annottext">TcRnMessageDetailed
</span><a href="#local-6989586621682984905"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRnMessageDetailed -&gt; TcRn (MsgEnvelope TcRnMessage)
</span><a href="#local-6989586621682984906"><span class="hs-identifier hs-var">mk_long_err_at</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682984904"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnMessageDetailed
</span><a href="#local-6989586621682984905"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">TcRn (MsgEnvelope TcRnMessage)
-&gt; (MsgEnvelope TcRnMessage -&gt; TcM ()) -&gt; TcM ()
forall a b.
IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; (a -&gt; IOEnv (Env TcGblEnv TcLclEnv) b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">MsgEnvelope TcRnMessage -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#reportDiagnostic"><span class="hs-identifier hs-var">reportDiagnostic</span></a></span><span>
</span><span id="line-1112"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1113"></span><span>    </span><span class="annot"><a href="#local-6989586621682984906"><span class="hs-identifier hs-type">mk_long_err_at</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessageDetailed"><span class="hs-identifier hs-type">TcRnMessageDetailed</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#MsgEnvelope"><span class="hs-identifier hs-type">MsgEnvelope</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1114"></span><span>    </span><span id="local-6989586621682984906"><span class="annot"><span class="annottext">mk_long_err_at :: SrcSpan -&gt; TcRnMessageDetailed -&gt; TcRn (MsgEnvelope TcRnMessage)
</span><a href="#local-6989586621682984906"><span class="hs-identifier hs-var hs-var">mk_long_err_at</span></a></span></span><span> </span><span id="local-6989586621682984907"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682984907"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682984908"><span class="annot"><span class="annottext">TcRnMessageDetailed
</span><a href="#local-6989586621682984908"><span class="hs-identifier hs-var">msg</span></a></span></span><span>
</span><span id="line-1115"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984909"><span class="annot"><a href="#local-6989586621682984909"><span class="hs-identifier hs-var">name_ppr_ctx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn NamePprCtx
</span><a href="GHC.Tc.Utils.Monad.html#getNamePprCtx"><span class="hs-identifier hs-var">getNamePprCtx</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1116"></span><span>             </span><span id="local-6989586621682984910"><span class="annot"><a href="#local-6989586621682984910"><span class="hs-identifier hs-var">unit_state</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#hsc_units"><span class="hs-identifier hs-type">hsc_units</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-type">getTopEnv</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1117"></span><span>             </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#mkErrorMsgEnvelope"><span class="hs-identifier hs-type">mkErrorMsgEnvelope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984907"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984909"><span class="hs-identifier hs-type">name_ppr_ctx</span></a></span><span>
</span><span id="line-1118"></span><span>                    </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessageWithInfo"><span class="hs-identifier hs-type">TcRnMessageWithInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984910"><span class="hs-identifier hs-type">unit_state</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984908"><span class="hs-identifier hs-type">msg</span></a></span><span>
</span><span id="line-1119"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-1120"></span><span>
</span><span id="line-1121"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mkTcRnMessage"><span class="hs-identifier hs-type">mkTcRnMessage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span>
</span><span id="line-1122"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span>
</span><span id="line-1123"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#MsgEnvelope"><span class="hs-identifier hs-type">MsgEnvelope</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1124"></span><span id="mkTcRnMessage"><span class="annot"><span class="annottext">mkTcRnMessage :: SrcSpan -&gt; TcRnMessage -&gt; TcRn (MsgEnvelope TcRnMessage)
</span><a href="GHC.Tc.Utils.Monad.html#mkTcRnMessage"><span class="hs-identifier hs-var hs-var">mkTcRnMessage</span></a></span></span><span> </span><span id="local-6989586621682984914"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682984914"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682984915"><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682984915"><span class="hs-identifier hs-var">msg</span></a></span></span><span>
</span><span id="line-1125"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984916"><span class="annot"><a href="#local-6989586621682984916"><span class="hs-identifier hs-var">name_ppr_ctx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn NamePprCtx
</span><a href="GHC.Tc.Utils.Monad.html#getNamePprCtx"><span class="hs-identifier hs-var">getNamePprCtx</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1126"></span><span>         </span><span id="local-6989586621682984917"><span class="annot"><a href="#local-6989586621682984917"><span class="hs-identifier hs-var">diag_opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Diagnostic.html#initDiagOpts"><span class="hs-identifier hs-type">initDiagOpts</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-type">getDynFlags</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1127"></span><span>         </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#mkMsgEnvelope"><span class="hs-identifier hs-type">mkMsgEnvelope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984917"><span class="hs-identifier hs-type">diag_opts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984914"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984916"><span class="hs-identifier hs-type">name_ppr_ctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984915"><span class="hs-identifier hs-type">msg</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1128"></span><span>
</span><span id="line-1129"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#reportDiagnostics"><span class="hs-identifier hs-type">reportDiagnostics</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Error.html#MsgEnvelope"><span class="hs-identifier hs-type">MsgEnvelope</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1130"></span><span id="reportDiagnostics"><span class="annot"><span class="annottext">reportDiagnostics :: [MsgEnvelope TcRnMessage] -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#reportDiagnostics"><span class="hs-identifier hs-var hs-var">reportDiagnostics</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(MsgEnvelope TcRnMessage -&gt; TcM ())
-&gt; [MsgEnvelope TcRnMessage] -&gt; TcM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">MsgEnvelope TcRnMessage -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#reportDiagnostic"><span class="hs-identifier hs-var">reportDiagnostic</span></a></span><span>
</span><span id="line-1131"></span><span>
</span><span id="line-1132"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#reportDiagnostic"><span class="hs-identifier hs-type">reportDiagnostic</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Error.html#MsgEnvelope"><span class="hs-identifier hs-type">MsgEnvelope</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1133"></span><span id="reportDiagnostic"><span class="annot"><span class="annottext">reportDiagnostic :: MsgEnvelope TcRnMessage -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#reportDiagnostic"><span class="hs-identifier hs-var hs-var">reportDiagnostic</span></a></span></span><span> </span><span id="local-6989586621682984920"><span class="annot"><span class="annottext">MsgEnvelope TcRnMessage
</span><a href="#local-6989586621682984920"><span class="hs-identifier hs-var">msg</span></a></span></span><span>
</span><span id="line-1134"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Adding diagnostic:&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MsgEnvelope TcRnMessage -&gt; SDoc
forall e. Diagnostic e =&gt; MsgEnvelope e -&gt; SDoc
</span><a href="GHC.Utils.Error.html#pprLocMsgEnvelopeDefault"><span class="hs-identifier hs-var">pprLocMsgEnvelopeDefault</span></a></span><span> </span><span class="annot"><span class="annottext">MsgEnvelope TcRnMessage
</span><a href="#local-6989586621682984920"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1135"></span><span>         </span><span id="local-6989586621682984922"><span class="annot"><a href="#local-6989586621682984922"><span class="hs-identifier hs-var">errs_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn (IORef (Messages TcRnMessage))
</span><a href="GHC.Tc.Utils.Monad.html#getErrsVar"><span class="hs-identifier hs-var">getErrsVar</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1136"></span><span>         </span><span id="local-6989586621682984923"><span class="annot"><a href="#local-6989586621682984923"><span class="hs-identifier hs-var">msgs</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-type">readTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984922"><span class="hs-identifier hs-type">errs_var</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1137"></span><span>         </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#writeTcRef"><span class="hs-identifier hs-type">writeTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984922"><span class="hs-identifier hs-type">errs_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682984920"><span class="hs-identifier hs-type">msg</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Error.html#addMessage"><span class="hs-operator hs-type">`addMessage`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984923"><span class="hs-identifier hs-type">msgs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1138"></span><span>
</span><span id="line-1139"></span><span class="hs-comment">-----------------------</span><span>
</span><span id="line-1140"></span><span id="local-6989586621682984925"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#checkNoErrs"><span class="hs-identifier hs-type">checkNoErrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984925"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984925"><span class="hs-identifier hs-type">r</span></a></span></span><span>
</span><span id="line-1141"></span><span class="hs-comment">-- (checkNoErrs m) succeeds iff m succeeds and generates no errors</span><span>
</span><span id="line-1142"></span><span class="hs-comment">-- If m fails then (checkNoErrs m) fails.</span><span>
</span><span id="line-1143"></span><span class="hs-comment">-- If m succeeds, it checks whether m generated any errors messages</span><span>
</span><span id="line-1144"></span><span class="hs-comment">--      (it might have recovered internally)</span><span>
</span><span id="line-1145"></span><span class="hs-comment">--      If so, it fails too.</span><span>
</span><span id="line-1146"></span><span class="hs-comment">-- Regardless, any errors generated by m are propagated to the enclosing context.</span><span>
</span><span id="line-1147"></span><span id="checkNoErrs"><span class="annot"><span class="annottext">checkNoErrs :: forall a. TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#checkNoErrs"><span class="hs-identifier hs-var hs-var">checkNoErrs</span></a></span></span><span> </span><span id="local-6989586621682984930"><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682984930"><span class="hs-identifier hs-var">main</span></a></span></span><span>
</span><span id="line-1148"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682984931"><span class="annot"><a href="#local-6989586621682984931"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682984932"><span class="annot"><a href="#local-6989586621682984932"><span class="hs-identifier hs-var">no_errs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM r -&gt; TcRn (r, Bool)
forall a. TcRn a -&gt; TcRn (a, Bool)
</span><a href="GHC.Tc.Utils.Monad.html#askNoErrs"><span class="hs-identifier hs-var">askNoErrs</span></a></span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682984930"><span class="hs-identifier hs-var">main</span></a></span><span>
</span><span id="line-1149"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">unless</span></span><span> </span><span class="annot"><a href="#local-6989586621682984932"><span class="hs-identifier hs-type">no_errs</span></a></span><span> </span><span class="annot"><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-type">failM</span></a></span><span>
</span><span id="line-1150"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682984931"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1151"></span><span>
</span><span id="line-1152"></span><span class="hs-comment">-----------------------</span><span>
</span><span id="line-1153"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#whenNoErrs"><span class="hs-identifier hs-type">whenNoErrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1154"></span><span id="whenNoErrs"><span class="annot"><span class="annottext">whenNoErrs :: TcM () -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#whenNoErrs"><span class="hs-identifier hs-var hs-var">whenNoErrs</span></a></span></span><span> </span><span id="local-6989586621682984933"><span class="annot"><span class="annottext">TcM ()
</span><a href="#local-6989586621682984933"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM () -&gt; TcM () -&gt; TcM ()
forall r. TcRn r -&gt; TcRn r -&gt; TcRn r
</span><a href="GHC.Tc.Utils.Monad.html#ifErrsM"><span class="hs-identifier hs-var">ifErrsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; TcM ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcM ()
</span><a href="#local-6989586621682984933"><span class="hs-identifier hs-var">thing</span></a></span><span>
</span><span id="line-1155"></span><span>
</span><span id="line-1156"></span><span id="local-6989586621682983478"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#ifErrsM"><span class="hs-identifier hs-type">ifErrsM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983478"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983478"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983478"><span class="hs-identifier hs-type">r</span></a></span></span><span>
</span><span id="line-1157"></span><span class="hs-comment">--      ifErrsM bale_out normal</span><span>
</span><span id="line-1158"></span><span class="hs-comment">-- does 'bale_out' if there are errors in errors collection</span><span>
</span><span id="line-1159"></span><span class="hs-comment">-- otherwise does 'normal'</span><span>
</span><span id="line-1160"></span><span id="ifErrsM"><span class="annot"><span class="annottext">ifErrsM :: forall r. TcRn r -&gt; TcRn r -&gt; TcRn r
</span><a href="GHC.Tc.Utils.Monad.html#ifErrsM"><span class="hs-identifier hs-var hs-var">ifErrsM</span></a></span></span><span> </span><span id="local-6989586621682984938"><span class="annot"><span class="annottext">TcRn r
</span><a href="#local-6989586621682984938"><span class="hs-identifier hs-var">bale_out</span></a></span></span><span> </span><span id="local-6989586621682984939"><span class="annot"><span class="annottext">TcRn r
</span><a href="#local-6989586621682984939"><span class="hs-identifier hs-var">normal</span></a></span></span><span>
</span><span id="line-1161"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984940"><span class="annot"><a href="#local-6989586621682984940"><span class="hs-identifier hs-var">errs_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn (IORef (Messages TcRnMessage))
</span><a href="GHC.Tc.Utils.Monad.html#getErrsVar"><span class="hs-identifier hs-var">getErrsVar</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1162"></span><span>        </span><span id="local-6989586621682984941"><span class="annot"><a href="#local-6989586621682984941"><span class="hs-identifier hs-var">msgs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-type">readTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984940"><span class="hs-identifier hs-type">errs_var</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1163"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="GHC.Types.Error.html#errorsFound"><span class="hs-identifier hs-type">errorsFound</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984941"><span class="hs-identifier hs-type">msgs</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-1164"></span><span>           </span><span class="annot"><a href="#local-6989586621682984938"><span class="hs-identifier hs-type">bale_out</span></a></span><span>
</span><span id="line-1165"></span><span>        </span><span class="hs-keyword">else</span><span>
</span><span id="line-1166"></span><span>           </span><span class="annot"><a href="#local-6989586621682984939"><span class="hs-identifier hs-type">normal</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1167"></span><span>
</span><span id="line-1168"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failIfErrsM"><span class="hs-identifier hs-type">failIfErrsM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1169"></span><span class="hs-comment">-- Useful to avoid error cascades</span><span>
</span><span id="line-1170"></span><span id="failIfErrsM"><span class="annot"><span class="annottext">failIfErrsM :: TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#failIfErrsM"><span class="hs-identifier hs-var hs-var">failIfErrsM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM () -&gt; TcM () -&gt; TcM ()
forall r. TcRn r -&gt; TcRn r -&gt; TcRn r
</span><a href="GHC.Tc.Utils.Monad.html#ifErrsM"><span class="hs-identifier hs-var">ifErrsM</span></a></span><span> </span><span class="annot"><span class="annottext">TcM ()
forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; TcM ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1171"></span><span>
</span><span id="line-1172"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
        Context management for the type checker
*                                                                      *
************************************************************************
-}</span></span><span>
</span><span id="line-1178"></span><span>
</span><span id="line-1179"></span><span class="hs-comment">{- Note [Inlining addErrCtxt]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
You will notice a bunch of INLINE pragamas on addErrCtxt and friends.
The reason is to promote better eta-expansion in client modules.
Consider
    \e s. addErrCtxt c (tc_foo x) e s
It looks as if tc_foo is applied to only two arguments, but if we
inline addErrCtxt it'll turn into something more like
    \e s. tc_foo x (munge c e) s
This is much better because Called Arity analysis can see that tc_foo
is applied to four arguments.  See #18379 for a concrete example.

This reliance on delicate inlining and Called Arity is not good.
See #18202 for a more general approach.  But meanwhile, these
inlinings seem unobjectional, and they solve the immediate
problem.

Note [Error contexts in generated code]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* setSrcSpan sets tcl_in_gen_code to True if the SrcSpan is GeneratedSrcSpan,
  and back to False when we get a useful SrcSpan

* When tcl_in_gen_code is True, addErrCtxt becomes a no-op.

So typically it's better to do setSrcSpan /before/ addErrCtxt.

See Note [Rebindable syntax and XXExprGhcRn] in GHC.Hs.Expr for
more discussion of this fancy footwork, as well as
Note [Generated code and pattern-match checking] in GHC.Types.Basic for the
relation with pattern-match checks.
-}</span><span>
</span><span id="line-1210"></span><span>
</span><span id="line-1211"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getErrCtxt"><span class="hs-identifier hs-type">getErrCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.ErrCtxt.html#ErrCtxt"><span class="hs-identifier hs-type">ErrCtxt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1212"></span><span id="getErrCtxt"><span class="annot"><span class="annottext">getErrCtxt :: TcM [ErrCtxt]
</span><a href="GHC.Tc.Utils.Monad.html#getErrCtxt"><span class="hs-identifier hs-var hs-var">getErrCtxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984942"><span class="annot"><a href="#local-6989586621682984942"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#getLclEnvErrCtxt"><span class="hs-identifier hs-type">getLclEnvErrCtxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984942"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1213"></span><span>
</span><span id="line-1214"></span><span id="local-6989586621682983480"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setErrCtxt"><span class="hs-identifier hs-type">setErrCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.ErrCtxt.html#ErrCtxt"><span class="hs-identifier hs-type">ErrCtxt</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983480"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983480"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1215"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setErrCtxt"><span class="hs-pragma hs-type">setErrCtxt</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>   </span><span class="hs-comment">-- Note [Inlining addErrCtxt]</span><span>
</span><span id="line-1216"></span><span id="setErrCtxt"><span class="annot"><span class="annottext">setErrCtxt :: forall a. [ErrCtxt] -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setErrCtxt"><span class="hs-identifier hs-var hs-var">setErrCtxt</span></a></span></span><span> </span><span id="local-6989586621682984944"><span class="annot"><span class="annottext">[ErrCtxt]
</span><a href="#local-6989586621682984944"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcLclEnv -&gt; TcLclEnv)
-&gt; TcRnIf TcGblEnv TcLclEnv a -&gt; TcRnIf TcGblEnv TcLclEnv a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ErrCtxt] -&gt; TcLclEnv -&gt; TcLclEnv
</span><a href="GHC.Tc.Types.LclEnv.html#setLclEnvErrCtxt"><span class="hs-identifier hs-var">setLclEnvErrCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">[ErrCtxt]
</span><a href="#local-6989586621682984944"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1217"></span><span>
</span><span id="line-1218"></span><span class="hs-comment">-- | Add a fixed message to the error context. This message should not</span><span>
</span><span id="line-1219"></span><span class="hs-comment">-- do any tidying.</span><span>
</span><span id="line-1220"></span><span id="local-6989586621682983482"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-type">addErrCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983482"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983482"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1221"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-pragma hs-type">addErrCtxt</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>   </span><span class="hs-comment">-- Note [Inlining addErrCtxt]</span><span>
</span><span id="line-1222"></span><span id="addErrCtxt"><span class="annot"><span class="annottext">addErrCtxt :: forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var hs-var">addErrCtxt</span></a></span></span><span> </span><span id="local-6989586621682984948"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682984948"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TidyEnv -&gt; ZonkM (TidyEnv, SDoc)) -&gt; TcM a -&gt; TcM a
forall a. (TidyEnv -&gt; ZonkM (TidyEnv, SDoc)) -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxtM"><span class="hs-identifier hs-var">addErrCtxtM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682984949"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682984949"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TidyEnv, SDoc) -&gt; ZonkM (TidyEnv, SDoc)
forall a. a -&gt; ZonkM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682984949"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682984948"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1223"></span><span>
</span><span id="line-1224"></span><span class="annot"><span class="hs-comment">-- | Add a message to the error context. This message may do tidying.</span></span><span>
</span><span id="line-1225"></span><span id="local-6989586621682983484"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrCtxtM"><span class="hs-identifier hs-type">addErrCtxtM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983484"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983484"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1226"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrCtxtM"><span class="hs-pragma hs-type">addErrCtxtM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>  </span><span class="hs-comment">-- Note [Inlining addErrCtxt]</span><span>
</span><span id="line-1227"></span><span id="addErrCtxtM"><span class="annot"><span class="annottext">addErrCtxtM :: forall a. (TidyEnv -&gt; ZonkM (TidyEnv, SDoc)) -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxtM"><span class="hs-identifier hs-var hs-var">addErrCtxtM</span></a></span></span><span> </span><span id="local-6989586621682984950"><span class="annot"><span class="annottext">TidyEnv -&gt; ZonkM (TidyEnv, SDoc)
</span><a href="#local-6989586621682984950"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ErrCtxt -&gt; TcM a -&gt; TcM a
forall a. ErrCtxt -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#pushCtxt"><span class="hs-identifier hs-var">pushCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; ZonkM (TidyEnv, SDoc)
</span><a href="#local-6989586621682984950"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1228"></span><span>
</span><span id="line-1229"></span><span class="hs-comment">-- | Add a fixed landmark message to the error context. A landmark</span><span>
</span><span id="line-1230"></span><span class="hs-comment">-- message is always sure to be reported, even if there is a lot of</span><span>
</span><span id="line-1231"></span><span class="hs-comment">-- context. It also doesn't count toward the maximum number of contexts</span><span>
</span><span id="line-1232"></span><span class="hs-comment">-- reported.</span><span>
</span><span id="line-1233"></span><span id="local-6989586621682984952"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addLandmarkErrCtxt"><span class="hs-identifier hs-type">addLandmarkErrCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984952"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984952"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1234"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addLandmarkErrCtxt"><span class="hs-pragma hs-type">addLandmarkErrCtxt</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>  </span><span class="hs-comment">-- Note [Inlining addErrCtxt]</span><span>
</span><span id="line-1235"></span><span id="addLandmarkErrCtxt"><span class="annot"><span class="annottext">addLandmarkErrCtxt :: forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addLandmarkErrCtxt"><span class="hs-identifier hs-var hs-var">addLandmarkErrCtxt</span></a></span></span><span> </span><span id="local-6989586621682984954"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682984954"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TidyEnv -&gt; ZonkM (TidyEnv, SDoc)) -&gt; TcM a -&gt; TcM a
forall a. (TidyEnv -&gt; ZonkM (TidyEnv, SDoc)) -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addLandmarkErrCtxtM"><span class="hs-identifier hs-var">addLandmarkErrCtxtM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682984955"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682984955"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TidyEnv, SDoc) -&gt; ZonkM (TidyEnv, SDoc)
forall a. a -&gt; ZonkM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682984955"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682984954"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1236"></span><span>
</span><span id="line-1237"></span><span class="hs-comment">-- | Variant of 'addLandmarkErrCtxt' that allows for monadic operations</span><span>
</span><span id="line-1238"></span><span class="hs-comment">-- and tidying.</span><span>
</span><span id="line-1239"></span><span id="local-6989586621682984956"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addLandmarkErrCtxtM"><span class="hs-identifier hs-type">addLandmarkErrCtxtM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984956"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984956"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1240"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addLandmarkErrCtxtM"><span class="hs-pragma hs-type">addLandmarkErrCtxtM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>  </span><span class="hs-comment">-- Note [Inlining addErrCtxt]</span><span>
</span><span id="line-1241"></span><span id="addLandmarkErrCtxtM"><span class="annot"><span class="annottext">addLandmarkErrCtxtM :: forall a. (TidyEnv -&gt; ZonkM (TidyEnv, SDoc)) -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addLandmarkErrCtxtM"><span class="hs-identifier hs-var hs-var">addLandmarkErrCtxtM</span></a></span></span><span> </span><span id="local-6989586621682984957"><span class="annot"><span class="annottext">TidyEnv -&gt; ZonkM (TidyEnv, SDoc)
</span><a href="#local-6989586621682984957"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ErrCtxt -&gt; TcM a -&gt; TcM a
forall a. ErrCtxt -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#pushCtxt"><span class="hs-identifier hs-var">pushCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; ZonkM (TidyEnv, SDoc)
</span><a href="#local-6989586621682984957"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1242"></span><span>
</span><span id="line-1243"></span><span id="local-6989586621682983486"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#pushCtxt"><span class="hs-identifier hs-type">pushCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.ErrCtxt.html#ErrCtxt"><span class="hs-identifier hs-type">ErrCtxt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983486"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983486"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1244"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#pushCtxt"><span class="hs-pragma hs-type">pushCtxt</span></a></span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-comment">-- Note [Inlining addErrCtxt]</span><span>
</span><span id="line-1245"></span><span id="pushCtxt"><span class="annot"><span class="annottext">pushCtxt :: forall a. ErrCtxt -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#pushCtxt"><span class="hs-identifier hs-var hs-var">pushCtxt</span></a></span></span><span> </span><span id="local-6989586621682984958"><span class="annot"><span class="annottext">ErrCtxt
</span><a href="#local-6989586621682984958"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcLclEnv -&gt; TcLclEnv)
-&gt; TcRnIf TcGblEnv TcLclEnv a -&gt; TcRnIf TcGblEnv TcLclEnv a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrCtxt -&gt; TcLclEnv -&gt; TcLclEnv
</span><a href="GHC.Tc.Utils.Monad.html#updCtxt"><span class="hs-identifier hs-var">updCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">ErrCtxt
</span><a href="#local-6989586621682984958"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1246"></span><span>
</span><span id="line-1247"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updCtxt"><span class="hs-identifier hs-type">updCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.ErrCtxt.html#ErrCtxt"><span class="hs-identifier hs-type">ErrCtxt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a></span><span>
</span><span id="line-1248"></span><span class="hs-comment">-- Do not update the context if we are in generated code</span><span>
</span><span id="line-1249"></span><span class="hs-comment">-- See Note [Rebindable syntax and XXExprGhcRn] in GHC.Hs.Expr</span><span>
</span><span id="line-1250"></span><span id="updCtxt"><span class="annot"><span class="annottext">updCtxt :: ErrCtxt -&gt; TcLclEnv -&gt; TcLclEnv
</span><a href="GHC.Tc.Utils.Monad.html#updCtxt"><span class="hs-identifier hs-var hs-var">updCtxt</span></a></span></span><span> </span><span id="local-6989586621682984960"><span class="annot"><span class="annottext">ErrCtxt
</span><a href="#local-6989586621682984960"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621682984961"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682984961"><span class="hs-identifier hs-var">env</span></a></span></span><span>
</span><span id="line-1251"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcLclEnv -&gt; Bool
</span><a href="GHC.Tc.Types.LclEnv.html#lclEnvInGeneratedCode"><span class="hs-identifier hs-var">lclEnvInGeneratedCode</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682984961"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682984961"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-1252"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ErrCtxt -&gt; TcLclEnv -&gt; TcLclEnv
</span><a href="GHC.Tc.Types.LclEnv.html#addLclEnvErrCtxt"><span class="hs-identifier hs-var">addLclEnvErrCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">ErrCtxt
</span><a href="#local-6989586621682984960"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682984961"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-1253"></span><span>
</span><span id="line-1254"></span><span id="local-6989586621682984963"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#popErrCtxt"><span class="hs-identifier hs-type">popErrCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984963"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984963"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1255"></span><span id="popErrCtxt"><span class="annot"><span class="annottext">popErrCtxt :: forall a. TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#popErrCtxt"><span class="hs-identifier hs-var hs-var">popErrCtxt</span></a></span></span><span> </span><span id="local-6989586621682984964"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682984964"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcLclEnv -&gt; TcLclEnv) -&gt; TcM a -&gt; TcM a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682984965"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682984965"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[ErrCtxt] -&gt; TcLclEnv -&gt; TcLclEnv
</span><a href="GHC.Tc.Types.LclEnv.html#setLclEnvErrCtxt"><span class="hs-identifier hs-var">setLclEnvErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ErrCtxt] -&gt; [ErrCtxt]
forall {a}. [a] -&gt; [a]
</span><a href="#local-6989586621682984966"><span class="hs-identifier hs-var">pop</span></a></span><span> </span><span class="annot"><span class="annottext">([ErrCtxt] -&gt; [ErrCtxt]) -&gt; [ErrCtxt] -&gt; [ErrCtxt]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TcLclEnv -&gt; [ErrCtxt]
</span><a href="GHC.Tc.Types.LclEnv.html#getLclEnvErrCtxt"><span class="hs-identifier hs-var">getLclEnvErrCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682984965"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682984965"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM a -&gt; TcM a) -&gt; TcM a -&gt; TcM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1256"></span><span>                          </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682984964"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1257"></span><span>           </span><span class="hs-keyword">where</span><span>
</span><span id="line-1258"></span><span>             </span><span id="local-6989586621682984966"><span class="annot"><span class="annottext">pop :: [a] -&gt; [a]
</span><a href="#local-6989586621682984966"><span class="hs-identifier hs-var hs-var">pop</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1259"></span><span>             </span><span class="annot"><a href="#local-6989586621682984966"><span class="hs-identifier hs-var">pop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682984967"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682984967"><span class="hs-identifier hs-var">msgs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682984967"><span class="hs-identifier hs-var">msgs</span></a></span><span>
</span><span id="line-1260"></span><span>
</span><span id="line-1261"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getCtLocM"><span class="hs-identifier hs-type">getCtLocM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TypeOrKind"><span class="hs-identifier hs-type">TypeOrKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span>
</span><span id="line-1262"></span><span id="getCtLocM"><span class="annot"><span class="annottext">getCtLocM :: CtOrigin -&gt; Maybe TypeOrKind -&gt; TcM CtLoc
</span><a href="GHC.Tc.Utils.Monad.html#getCtLocM"><span class="hs-identifier hs-var hs-var">getCtLocM</span></a></span></span><span> </span><span id="local-6989586621682984968"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682984968"><span class="hs-identifier hs-var">origin</span></a></span></span><span> </span><span id="local-6989586621682984969"><span class="annot"><span class="annottext">Maybe TypeOrKind
</span><a href="#local-6989586621682984969"><span class="hs-identifier hs-var">t_or_k</span></a></span></span><span>
</span><span id="line-1263"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984970"><span class="annot"><a href="#local-6989586621682984970"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span>
</span><span id="line-1264"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#ctl_origin"><span class="hs-identifier hs-var">ctl_origin</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682984968"><span class="hs-identifier hs-type">origin</span></a></span><span>
</span><span id="line-1265"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#ctl_env"><span class="hs-identifier hs-var">ctl_env</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mkCtLocEnv"><span class="hs-identifier hs-type">mkCtLocEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682984970"><span class="hs-identifier hs-type">env</span></a></span><span>
</span><span id="line-1266"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#ctl_t_or_k"><span class="hs-identifier hs-var">ctl_t_or_k</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682984969"><span class="hs-identifier hs-type">t_or_k</span></a></span><span>
</span><span id="line-1267"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#ctl_depth"><span class="hs-identifier hs-var">ctl_depth</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#initialSubGoalDepth"><span class="hs-identifier hs-type">initialSubGoalDepth</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1268"></span><span>
</span><span id="line-1269"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mkCtLocEnv"><span class="hs-identifier hs-type">mkCtLocEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#CtLocEnv"><span class="hs-identifier hs-type">CtLocEnv</span></a></span><span>
</span><span id="line-1270"></span><span id="mkCtLocEnv"><span class="annot"><span class="annottext">mkCtLocEnv :: TcLclEnv -&gt; CtLocEnv
</span><a href="GHC.Tc.Utils.Monad.html#mkCtLocEnv"><span class="hs-identifier hs-var hs-var">mkCtLocEnv</span></a></span></span><span> </span><span id="local-6989586621682984977"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682984977"><span class="hs-identifier hs-var">lcl_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1271"></span><span>  </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#CtLocEnv"><span class="hs-identifier hs-type">CtLocEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctl_bndrs :: TcBinderStack
</span><a href="GHC.Tc.Types.CtLoc.html#ctl_bndrs"><span class="hs-identifier hs-var">ctl_bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLclEnv -&gt; TcBinderStack
</span><a href="GHC.Tc.Types.LclEnv.html#getLclEnvBinderStack"><span class="hs-identifier hs-var">getLclEnvBinderStack</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682984977"><span class="hs-identifier hs-var">lcl_env</span></a></span><span>
</span><span id="line-1272"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctl_ctxt :: [ErrCtxt]
</span><a href="GHC.Tc.Types.CtLoc.html#ctl_ctxt"><span class="hs-identifier hs-var">ctl_ctxt</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLclEnv -&gt; [ErrCtxt]
</span><a href="GHC.Tc.Types.LclEnv.html#getLclEnvErrCtxt"><span class="hs-identifier hs-var">getLclEnvErrCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682984977"><span class="hs-identifier hs-var">lcl_env</span></a></span><span>
</span><span id="line-1273"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctl_loc :: RealSrcSpan
</span><a href="GHC.Tc.Types.CtLoc.html#ctl_loc"><span class="hs-identifier hs-var">ctl_loc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLclEnv -&gt; RealSrcSpan
</span><a href="GHC.Tc.Types.LclEnv.html#getLclEnvLoc"><span class="hs-identifier hs-var">getLclEnvLoc</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682984977"><span class="hs-identifier hs-var">lcl_env</span></a></span><span>
</span><span id="line-1274"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctl_tclvl :: TcLevel
</span><a href="GHC.Tc.Types.CtLoc.html#ctl_tclvl"><span class="hs-identifier hs-var">ctl_tclvl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLclEnv -&gt; TcLevel
</span><a href="GHC.Tc.Types.LclEnv.html#getLclEnvTcLevel"><span class="hs-identifier hs-var">getLclEnvTcLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682984977"><span class="hs-identifier hs-var">lcl_env</span></a></span><span>
</span><span id="line-1275"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctl_in_gen_code :: Bool
</span><a href="GHC.Tc.Types.CtLoc.html#ctl_in_gen_code"><span class="hs-identifier hs-var">ctl_in_gen_code</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLclEnv -&gt; Bool
</span><a href="GHC.Tc.Types.LclEnv.html#lclEnvInGeneratedCode"><span class="hs-identifier hs-var">lclEnvInGeneratedCode</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682984977"><span class="hs-identifier hs-var">lcl_env</span></a></span><span>
</span><span id="line-1276"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctl_rdr :: LocalRdrEnv
</span><a href="GHC.Tc.Types.CtLoc.html#ctl_rdr"><span class="hs-identifier hs-var">ctl_rdr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLclEnv -&gt; LocalRdrEnv
</span><a href="GHC.Tc.Types.LclEnv.html#getLclEnvRdrEnv"><span class="hs-identifier hs-var">getLclEnvRdrEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682984977"><span class="hs-identifier hs-var">lcl_env</span></a></span><span>
</span><span id="line-1277"></span><span>           </span><span class="hs-special">}</span><span>
</span><span id="line-1278"></span><span>
</span><span id="line-1279"></span><span id="local-6989586621682983497"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setCtLocM"><span class="hs-identifier hs-type">setCtLocM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983497"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983497"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1280"></span><span class="hs-comment">-- Set the SrcSpan and error context from the CtLoc</span><span>
</span><span id="line-1281"></span><span id="setCtLocM"><span class="annot"><span class="annottext">setCtLocM :: forall a. CtLoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setCtLocM"><span class="hs-identifier hs-var hs-var">setCtLocM</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.CtLoc.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctl_env :: CtLoc -&gt; CtLocEnv
</span><a href="GHC.Tc.Types.CtLoc.html#ctl_env"><span class="hs-identifier hs-var">ctl_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682984987"><span class="annot"><span class="annottext">CtLocEnv
</span><a href="#local-6989586621682984987"><span class="hs-identifier hs-var">lcl</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682984988"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682984988"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1282"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcLclEnv -&gt; TcLclEnv) -&gt; TcM a -&gt; TcM a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682984989"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682984989"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RealSrcSpan -&gt; TcLclEnv -&gt; TcLclEnv
</span><a href="GHC.Tc.Types.LclEnv.html#setLclEnvLoc"><span class="hs-identifier hs-var">setLclEnvLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtLocEnv -&gt; RealSrcSpan
</span><a href="GHC.Tc.Types.CtLoc.html#ctl_loc"><span class="hs-identifier hs-var">ctl_loc</span></a></span><span> </span><span class="annot"><span class="annottext">CtLocEnv
</span><a href="#local-6989586621682984987"><span class="hs-identifier hs-var">lcl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1283"></span><span>                     </span><span class="annot"><span class="annottext">(TcLclEnv -&gt; TcLclEnv) -&gt; TcLclEnv -&gt; TcLclEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ErrCtxt] -&gt; TcLclEnv -&gt; TcLclEnv
</span><a href="GHC.Tc.Types.LclEnv.html#setLclEnvErrCtxt"><span class="hs-identifier hs-var">setLclEnvErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtLocEnv -&gt; [ErrCtxt]
</span><a href="GHC.Tc.Types.CtLoc.html#ctl_ctxt"><span class="hs-identifier hs-var">ctl_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">CtLocEnv
</span><a href="#local-6989586621682984987"><span class="hs-identifier hs-var">lcl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1284"></span><span>                     </span><span class="annot"><span class="annottext">(TcLclEnv -&gt; TcLclEnv) -&gt; TcLclEnv -&gt; TcLclEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TcBinderStack -&gt; TcLclEnv -&gt; TcLclEnv
</span><a href="GHC.Tc.Types.LclEnv.html#setLclEnvBinderStack"><span class="hs-identifier hs-var">setLclEnvBinderStack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtLocEnv -&gt; TcBinderStack
</span><a href="GHC.Tc.Types.CtLoc.html#ctl_bndrs"><span class="hs-identifier hs-var">ctl_bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">CtLocEnv
</span><a href="#local-6989586621682984987"><span class="hs-identifier hs-var">lcl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1285"></span><span>                     </span><span class="annot"><span class="annottext">(TcLclEnv -&gt; TcLclEnv) -&gt; TcLclEnv -&gt; TcLclEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682984989"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682984988"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1286"></span><span>
</span><span id="line-1287"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
             Error recovery and exceptions
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-1292"></span><span>
</span><span id="line-1293"></span><span id="local-6989586621682983499"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcTryM"><span class="hs-identifier hs-type">tcTryM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983499"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621682983499"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1294"></span><span class="hs-comment">-- The most basic function: catch the exception</span><span>
</span><span id="line-1295"></span><span class="hs-comment">--   Nothing =&gt; an exception happened</span><span>
</span><span id="line-1296"></span><span class="hs-comment">--   Just r  =&gt; no exception, result R</span><span>
</span><span id="line-1297"></span><span class="hs-comment">-- Errors and constraints are propagated in both cases</span><span>
</span><span id="line-1298"></span><span class="hs-comment">-- Never throws an exception</span><span>
</span><span id="line-1299"></span><span id="tcTryM"><span class="annot"><span class="annottext">tcTryM :: forall r. TcRn r -&gt; TcRn (Maybe r)
</span><a href="GHC.Tc.Utils.Monad.html#tcTryM"><span class="hs-identifier hs-var hs-var">tcTryM</span></a></span></span><span> </span><span id="local-6989586621682984995"><span class="annot"><span class="annottext">TcRn r
</span><a href="#local-6989586621682984995"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1300"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682984996"><span class="annot"><a href="#local-6989586621682984996"><span class="hs-identifier hs-var">either_res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn r -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Either IOEnvFailure r)
forall env r. IOEnv env r -&gt; IOEnv env (Either IOEnvFailure r)
</span><a href="GHC.Data.IOEnv.html#tryM"><span class="hs-identifier hs-var">tryM</span></a></span><span> </span><span class="annot"><span class="annottext">TcRn r
</span><a href="#local-6989586621682984995"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1301"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682984996"><span class="hs-identifier hs-type">either_res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1302"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">IOEnvFailure
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe r
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1303"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621682984997"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621682984997"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">r -&gt; Maybe r
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621682984997"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1304"></span><span>         </span><span class="hs-comment">-- In the Left case the exception is always the IOEnv</span><span>
</span><span id="line-1305"></span><span>         </span><span class="hs-comment">-- built-in in exception; see IOEnv.failM</span><span>
</span><span id="line-1306"></span><span>
</span><span id="line-1307"></span><span class="hs-comment">-----------------------</span><span>
</span><span id="line-1308"></span><span id="local-6989586621682983501"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#capture_constraints"><span class="hs-identifier hs-type">capture_constraints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983501"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682983501"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1309"></span><span class="hs-comment">-- capture_constraints simply captures and returns the</span><span>
</span><span id="line-1310"></span><span class="hs-comment">--                     constraints generated by thing_inside</span><span>
</span><span id="line-1311"></span><span class="hs-comment">-- Precondition: thing_inside must not throw an exception!</span><span>
</span><span id="line-1312"></span><span class="hs-comment">-- Reason for precondition: an exception would blow past the place</span><span>
</span><span id="line-1313"></span><span class="hs-comment">-- where we read the lie_var, and we'd lose the constraints altogether</span><span>
</span><span id="line-1314"></span><span id="capture_constraints"><span class="annot"><span class="annottext">capture_constraints :: forall r. TcM r -&gt; TcM (r, WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#capture_constraints"><span class="hs-identifier hs-var hs-var">capture_constraints</span></a></span></span><span> </span><span id="local-6989586621682985005"><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682985005"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1315"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985006"><span class="annot"><a href="#local-6989586621682985006"><span class="hs-identifier hs-var">lie_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WantedConstraints
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (IORef WantedConstraints)
forall (m :: * -&gt; *) a. MonadIO m =&gt; a -&gt; m (TcRef a)
</span><a href="GHC.Tc.Types.TcRef.html#newTcRef"><span class="hs-identifier hs-var">newTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="GHC.Tc.Types.Constraint.html#emptyWC"><span class="hs-identifier hs-var">emptyWC</span></a></span><span>
</span><span id="line-1316"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682985007"><span class="annot"><a href="#local-6989586621682985007"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-type">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682985008"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682985008"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682985008"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#tcl_lie"><span class="hs-identifier hs-var">tcl_lie</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682985006"><span class="hs-identifier hs-type">lie_var</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1317"></span><span>                </span><span class="annot"><a href="#local-6989586621682985005"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-1318"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682985009"><span class="annot"><a href="#local-6989586621682985009"><span class="hs-identifier hs-var">lie</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-type">readTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985006"><span class="hs-identifier hs-type">lie_var</span></a></span><span>
</span><span id="line-1319"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682985007"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682985009"><span class="hs-identifier hs-type">lie</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1320"></span><span>
</span><span id="line-1321"></span><span id="local-6989586621682983505"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#capture_messages"><span class="hs-identifier hs-type">capture_messages</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983505"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682983505"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1322"></span><span class="hs-comment">-- capture_messages simply captures and returns the</span><span>
</span><span id="line-1323"></span><span class="hs-comment">--                  errors and warnings generated by thing_inside</span><span>
</span><span id="line-1324"></span><span class="hs-comment">-- Precondition: thing_inside must not throw an exception!</span><span>
</span><span id="line-1325"></span><span class="hs-comment">-- Reason for precondition: an exception would blow past the place</span><span>
</span><span id="line-1326"></span><span class="hs-comment">-- where we read the msg_var, and we'd lose the constraints altogether</span><span>
</span><span id="line-1327"></span><span id="capture_messages"><span class="annot"><span class="annottext">capture_messages :: forall r. TcM r -&gt; TcM (r, Messages TcRnMessage)
</span><a href="GHC.Tc.Utils.Monad.html#capture_messages"><span class="hs-identifier hs-var hs-var">capture_messages</span></a></span></span><span> </span><span id="local-6989586621682985017"><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682985017"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1328"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985018"><span class="annot"><a href="#local-6989586621682985018"><span class="hs-identifier hs-var">msg_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Messages TcRnMessage -&gt; TcRn (IORef (Messages TcRnMessage))
forall (m :: * -&gt; *) a. MonadIO m =&gt; a -&gt; m (TcRef a)
</span><a href="GHC.Tc.Types.TcRef.html#newTcRef"><span class="hs-identifier hs-var">newTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">Messages TcRnMessage
forall e. Messages e
</span><a href="GHC.Types.Error.html#emptyMessages"><span class="hs-identifier hs-var">emptyMessages</span></a></span><span>
</span><span id="line-1329"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682985019"><span class="annot"><a href="#local-6989586621682985019"><span class="hs-identifier hs-var">res</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setErrsVar"><span class="hs-identifier hs-type">setErrsVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985018"><span class="hs-identifier hs-type">msg_var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985017"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-1330"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682985020"><span class="annot"><a href="#local-6989586621682985020"><span class="hs-identifier hs-var">msgs</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-type">readTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985018"><span class="hs-identifier hs-type">msg_var</span></a></span><span>
</span><span id="line-1331"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682985019"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682985020"><span class="hs-identifier hs-type">msgs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1332"></span><span>
</span><span id="line-1333"></span><span class="hs-comment">-----------------------</span><span>
</span><span id="line-1334"></span><span class="hs-comment">-- (askNoErrs m) runs m</span><span>
</span><span id="line-1335"></span><span class="hs-comment">-- If m fails,</span><span>
</span><span id="line-1336"></span><span class="hs-comment">--    then (askNoErrs m) fails, propagating only</span><span>
</span><span id="line-1337"></span><span class="hs-comment">--         insoluble constraints</span><span>
</span><span id="line-1338"></span><span class="hs-comment">--</span><span>
</span><span id="line-1339"></span><span class="hs-comment">-- If m succeeds with result r,</span><span>
</span><span id="line-1340"></span><span class="hs-comment">--    then (askNoErrs m) succeeds with result (r, b),</span><span>
</span><span id="line-1341"></span><span class="hs-comment">--         where b is True iff m generated no errors</span><span>
</span><span id="line-1342"></span><span class="hs-comment">--</span><span>
</span><span id="line-1343"></span><span class="hs-comment">-- Regardless of success or failure,</span><span>
</span><span id="line-1344"></span><span class="hs-comment">--   propagate any errors/warnings generated by m</span><span>
</span><span id="line-1345"></span><span id="local-6989586621682983477"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#askNoErrs"><span class="hs-identifier hs-type">askNoErrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983477"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682983477"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-1346"></span><span id="askNoErrs"><span class="annot"><span class="annottext">askNoErrs :: forall a. TcRn a -&gt; TcRn (a, Bool)
</span><a href="GHC.Tc.Utils.Monad.html#askNoErrs"><span class="hs-identifier hs-var hs-var">askNoErrs</span></a></span></span><span> </span><span id="local-6989586621682985027"><span class="annot"><span class="annottext">TcRn a
</span><a href="#local-6989586621682985027"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1347"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682985028"><span class="annot"><a href="#local-6989586621682985028"><span class="hs-identifier hs-var">mb_res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682985029"><span class="annot"><a href="#local-6989586621682985029"><span class="hs-identifier hs-var">lie</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682985030"><span class="annot"><a href="#local-6989586621682985030"><span class="hs-identifier hs-var">msgs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM (Maybe a, WantedConstraints)
-&gt; TcM ((Maybe a, WantedConstraints), Messages TcRnMessage)
forall r. TcM r -&gt; TcM (r, Messages TcRnMessage)
</span><a href="GHC.Tc.Utils.Monad.html#capture_messages"><span class="hs-identifier hs-var">capture_messages</span></a></span><span>    </span><span class="annot"><span class="annottext">(TcM (Maybe a, WantedConstraints)
 -&gt; TcM ((Maybe a, WantedConstraints), Messages TcRnMessage))
-&gt; TcM (Maybe a, WantedConstraints)
-&gt; TcM ((Maybe a, WantedConstraints), Messages TcRnMessage)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1348"></span><span>                                  </span><span class="annot"><span class="annottext">TcM (Maybe a) -&gt; TcM (Maybe a, WantedConstraints)
forall r. TcM r -&gt; TcM (r, WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#capture_constraints"><span class="hs-identifier hs-var">capture_constraints</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (Maybe a) -&gt; TcM (Maybe a, WantedConstraints))
-&gt; TcM (Maybe a) -&gt; TcM (Maybe a, WantedConstraints)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1349"></span><span>                                  </span><span class="annot"><span class="annottext">TcRn a -&gt; TcM (Maybe a)
forall r. TcRn r -&gt; TcRn (Maybe r)
</span><a href="GHC.Tc.Utils.Monad.html#tcTryM"><span class="hs-identifier hs-var">tcTryM</span></a></span><span> </span><span class="annot"><span class="annottext">TcRn a
</span><a href="#local-6989586621682985027"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1350"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addMessages"><span class="hs-identifier hs-type">addMessages</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985030"><span class="hs-identifier hs-type">msgs</span></a></span><span>
</span><span id="line-1351"></span><span>
</span><span id="line-1352"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682985028"><span class="hs-identifier hs-type">mb_res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1353"></span><span>           </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">WantedConstraints -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#emitConstraints"><span class="hs-identifier hs-var">emitConstraints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WantedConstraints -&gt; WantedConstraints
</span><a href="GHC.Tc.Types.Constraint.html#dropMisleading"><span class="hs-identifier hs-var">dropMisleading</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621682985029"><span class="hs-identifier hs-var">lie</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1354"></span><span>                          </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) (a, Bool)
forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1355"></span><span>
</span><span id="line-1356"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682985032"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682985032"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">WantedConstraints -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#emitConstraints"><span class="hs-identifier hs-var">emitConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621682985029"><span class="hs-identifier hs-var">lie</span></a></span><span>
</span><span id="line-1357"></span><span>                          </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682985033"><span class="annot"><span class="annottext">errs_found :: Bool
</span><a href="#local-6989586621682985033"><span class="hs-identifier hs-var hs-var">errs_found</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Messages TcRnMessage -&gt; Bool
forall e. Diagnostic e =&gt; Messages e -&gt; Bool
</span><a href="GHC.Types.Error.html#errorsFound"><span class="hs-identifier hs-var">errorsFound</span></a></span><span> </span><span class="annot"><span class="annottext">Messages TcRnMessage
</span><a href="#local-6989586621682985030"><span class="hs-identifier hs-var">msgs</span></a></span><span>
</span><span id="line-1358"></span><span>                                          </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">WantedConstraints -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#insolubleWC"><span class="hs-identifier hs-var">insolubleWC</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621682985029"><span class="hs-identifier hs-var">lie</span></a></span><span>
</span><span id="line-1359"></span><span>                          </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(a, Bool) -&gt; IOEnv (Env TcGblEnv TcLclEnv) (a, Bool)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682985032"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682985033"><span class="hs-identifier hs-var">errs_found</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1360"></span><span>
</span><span id="line-1361"></span><span class="hs-comment">-----------------------</span><span>
</span><span id="line-1362"></span><span id="local-6989586621682983508"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tryCaptureConstraints"><span class="hs-identifier hs-type">tryCaptureConstraints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983508"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621682983508"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1363"></span><span class="hs-comment">-- (tryCaptureConstraints_maybe m) runs m,</span><span>
</span><span id="line-1364"></span><span class="hs-comment">--   and returns the type constraints it generates</span><span>
</span><span id="line-1365"></span><span class="hs-comment">-- It never throws an exception; instead if thing_inside fails,</span><span>
</span><span id="line-1366"></span><span class="hs-comment">--   it returns Nothing and the /insoluble/ constraints</span><span>
</span><span id="line-1367"></span><span class="hs-comment">-- Error messages are propagated</span><span>
</span><span id="line-1368"></span><span id="tryCaptureConstraints"><span class="annot"><span class="annottext">tryCaptureConstraints :: forall a. TcM a -&gt; TcM (Maybe a, WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#tryCaptureConstraints"><span class="hs-identifier hs-var hs-var">tryCaptureConstraints</span></a></span></span><span> </span><span id="local-6989586621682985038"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682985038"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1369"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682985039"><span class="annot"><a href="#local-6989586621682985039"><span class="hs-identifier hs-var">mb_res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682985040"><span class="annot"><a href="#local-6989586621682985040"><span class="hs-identifier hs-var">lie</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM (Maybe a) -&gt; TcM (Maybe a, WantedConstraints)
forall r. TcM r -&gt; TcM (r, WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#capture_constraints"><span class="hs-identifier hs-var">capture_constraints</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (Maybe a) -&gt; TcM (Maybe a, WantedConstraints))
-&gt; TcM (Maybe a) -&gt; TcM (Maybe a, WantedConstraints)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1370"></span><span>                          </span><span class="annot"><span class="annottext">TcM a -&gt; TcM (Maybe a)
forall r. TcRn r -&gt; TcRn (Maybe r)
</span><a href="GHC.Tc.Utils.Monad.html#tcTryM"><span class="hs-identifier hs-var">tcTryM</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682985038"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1371"></span><span>
</span><span id="line-1372"></span><span>       </span><span class="hs-comment">-- See Note [Constraints and errors]</span><span>
</span><span id="line-1373"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682985041"><span class="annot"><a href="#local-6989586621682985041"><span class="hs-identifier hs-var hs-var">lie_to_keep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621682985039"><span class="hs-identifier hs-var">mb_res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1374"></span><span>                             </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WantedConstraints -&gt; WantedConstraints
</span><a href="GHC.Tc.Types.Constraint.html#dropMisleading"><span class="hs-identifier hs-var">dropMisleading</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621682985040"><span class="hs-identifier hs-var">lie</span></a></span><span>
</span><span id="line-1375"></span><span>                             </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621682985040"><span class="hs-identifier hs-var">lie</span></a></span><span>
</span><span id="line-1376"></span><span>
</span><span id="line-1377"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682985039"><span class="hs-identifier hs-type">mb_res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682985041"><span class="hs-identifier hs-type">lie_to_keep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1378"></span><span>
</span><span id="line-1379"></span><span id="local-6989586621682985042"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#captureConstraints"><span class="hs-identifier hs-type">captureConstraints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985042"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682985042"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1380"></span><span class="hs-comment">-- (captureConstraints m) runs m, and returns the type constraints it generates</span><span>
</span><span id="line-1381"></span><span class="hs-comment">-- If thing_inside fails (throwing an exception),</span><span>
</span><span id="line-1382"></span><span class="hs-comment">--   then (captureConstraints thing_inside) fails too</span><span>
</span><span id="line-1383"></span><span class="hs-comment">--   propagating the insoluble constraints only</span><span>
</span><span id="line-1384"></span><span class="hs-comment">-- Error messages are propagated in either case</span><span>
</span><span id="line-1385"></span><span id="captureConstraints"><span class="annot"><span class="annottext">captureConstraints :: forall r. TcM r -&gt; TcM (r, WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#captureConstraints"><span class="hs-identifier hs-var hs-var">captureConstraints</span></a></span></span><span> </span><span id="local-6989586621682985046"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682985046"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1386"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682985047"><span class="annot"><a href="#local-6989586621682985047"><span class="hs-identifier hs-var">mb_res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682985048"><span class="annot"><a href="#local-6989586621682985048"><span class="hs-identifier hs-var">lie</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM a -&gt; TcM (Maybe a, WantedConstraints)
forall a. TcM a -&gt; TcM (Maybe a, WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#tryCaptureConstraints"><span class="hs-identifier hs-var">tryCaptureConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682985046"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1387"></span><span>
</span><span id="line-1388"></span><span>            </span><span class="hs-comment">-- See Note [Constraints and errors]</span><span>
</span><span id="line-1389"></span><span>            </span><span class="hs-comment">-- If the thing_inside threw an exception, emit the insoluble</span><span>
</span><span id="line-1390"></span><span>            </span><span class="hs-comment">-- constraints only (returned by tryCaptureConstraints)</span><span>
</span><span id="line-1391"></span><span>            </span><span class="hs-comment">-- so that they are not lost</span><span>
</span><span id="line-1392"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682985047"><span class="hs-identifier hs-type">mb_res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1393"></span><span>           </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">WantedConstraints -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#emitConstraints"><span class="hs-identifier hs-var">emitConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621682985048"><span class="hs-identifier hs-var">lie</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) (a, WantedConstraints)
forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1394"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682985049"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682985049"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(a, WantedConstraints)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (a, WantedConstraints)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682985049"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621682985048"><span class="hs-identifier hs-var">lie</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1395"></span><span>
</span><span id="line-1396"></span><span class="hs-comment">-----------------------</span><span>
</span><span id="line-1397"></span><span class="hs-comment">-- | @tcCollectingUsage thing_inside@ runs @thing_inside@ and returns the usage</span><span>
</span><span id="line-1398"></span><span class="hs-comment">-- information which was collected as part of the execution of</span><span>
</span><span id="line-1399"></span><span class="hs-comment">-- @thing_inside@. Careful: @tcCollectingUsage thing_inside@ itself does not</span><span>
</span><span id="line-1400"></span><span class="hs-comment">-- report any usage information, it's up to the caller to incorporate the</span><span>
</span><span id="line-1401"></span><span class="hs-comment">-- returned usage information into the larger context appropriately.</span><span>
</span><span id="line-1402"></span><span id="local-6989586621682983511"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcCollectingUsage"><span class="hs-identifier hs-type">tcCollectingUsage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983511"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.UsageEnv.html#UsageEnv"><span class="hs-identifier hs-type">UsageEnv</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621682983511"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1403"></span><span id="tcCollectingUsage"><span class="annot"><span class="annottext">tcCollectingUsage :: forall a. TcM a -&gt; TcM (UsageEnv, a)
</span><a href="GHC.Tc.Utils.Monad.html#tcCollectingUsage"><span class="hs-identifier hs-var hs-var">tcCollectingUsage</span></a></span></span><span> </span><span id="local-6989586621682985056"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682985056"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1404"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985057"><span class="annot"><a href="#local-6989586621682985057"><span class="hs-identifier hs-var">local_usage_ref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UsageEnv -&gt; IOEnv (Env TcGblEnv TcLclEnv) (IORef UsageEnv)
forall (m :: * -&gt; *) a. MonadIO m =&gt; a -&gt; m (TcRef a)
</span><a href="GHC.Tc.Types.TcRef.html#newTcRef"><span class="hs-identifier hs-var">newTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">UsageEnv
</span><a href="GHC.Core.UsageEnv.html#zeroUE"><span class="hs-identifier hs-var">zeroUE</span></a></span><span>
</span><span id="line-1405"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682985058"><span class="annot"><a href="#local-6989586621682985058"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-type">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682985059"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682985059"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682985059"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#tcl_usage"><span class="hs-identifier hs-var">tcl_usage</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682985057"><span class="hs-identifier hs-type">local_usage_ref</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682985056"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-1406"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682985060"><span class="annot"><a href="#local-6989586621682985060"><span class="hs-identifier hs-var">local_usage</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-type">readTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985057"><span class="hs-identifier hs-type">local_usage_ref</span></a></span><span>
</span><span id="line-1407"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682985060"><span class="hs-identifier hs-type">local_usage</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621682985058"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1408"></span><span>
</span><span id="line-1409"></span><span class="hs-comment">-- | @tcScalingUsage mult thing_inside@ runs @thing_inside@ and scales all the</span><span>
</span><span id="line-1410"></span><span class="hs-comment">-- usage information by @mult@.</span><span>
</span><span id="line-1411"></span><span id="local-6989586621682983513"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-type">tcScalingUsage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983513"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983513"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1412"></span><span id="tcScalingUsage"><span class="annot"><span class="annottext">tcScalingUsage :: forall a. Mult -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var hs-var">tcScalingUsage</span></a></span></span><span> </span><span id="local-6989586621682985070"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682985070"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span id="local-6989586621682985071"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682985071"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1413"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682985072"><span class="annot"><a href="#local-6989586621682985072"><span class="hs-identifier hs-var">usage</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682985073"><span class="annot"><a href="#local-6989586621682985073"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM a -&gt; TcM (UsageEnv, a)
forall a. TcM a -&gt; TcM (UsageEnv, a)
</span><a href="GHC.Tc.Utils.Monad.html#tcCollectingUsage"><span class="hs-identifier hs-var">tcCollectingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682985071"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1414"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcScalingUsage&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985070"><span class="hs-identifier hs-type">mult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985072"><span class="hs-identifier hs-type">usage</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1415"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcEmitBindingUsage"><span class="hs-identifier hs-type">tcEmitBindingUsage</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Core.UsageEnv.html#scaleUE"><span class="hs-identifier hs-type">scaleUE</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985070"><span class="hs-identifier hs-type">mult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985072"><span class="hs-identifier hs-type">usage</span></a></span><span>
</span><span id="line-1416"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682985073"><span class="hs-identifier hs-type">result</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1417"></span><span>
</span><span id="line-1418"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcEmitBindingUsage"><span class="hs-identifier hs-type">tcEmitBindingUsage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.UsageEnv.html#UsageEnv"><span class="hs-identifier hs-type">UsageEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1419"></span><span id="tcEmitBindingUsage"><span class="annot"><span class="annottext">tcEmitBindingUsage :: UsageEnv -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#tcEmitBindingUsage"><span class="hs-identifier hs-var hs-var">tcEmitBindingUsage</span></a></span></span><span> </span><span id="local-6989586621682985076"><span class="annot"><span class="annottext">UsageEnv
</span><a href="#local-6989586621682985076"><span class="hs-identifier hs-var">ue</span></a></span></span><span>
</span><span id="line-1420"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985077"><span class="annot"><a href="#local-6989586621682985077"><span class="hs-identifier hs-var">lcl_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span>
</span><span id="line-1421"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682985078"><span class="annot"><a href="#local-6989586621682985078"><span class="hs-identifier hs-var hs-var">usage</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLclEnv -&gt; IORef UsageEnv
</span><a href="GHC.Tc.Types.LclEnv.html#tcl_usage"><span class="hs-identifier hs-var">tcl_usage</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682985077"><span class="hs-identifier hs-var">lcl_env</span></a></span><span>
</span><span id="line-1422"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#updTcRef"><span class="hs-identifier hs-type">updTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985078"><span class="hs-identifier hs-type">usage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.UsageEnv.html#addUE"><span class="hs-identifier hs-type">addUE</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985076"><span class="hs-identifier hs-type">ue</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1423"></span><span>
</span><span id="line-1424"></span><span class="hs-comment">-----------------------</span><span>
</span><span id="line-1425"></span><span id="local-6989586621682985080"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#attemptM"><span class="hs-identifier hs-type">attemptM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985080"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621682985080"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1426"></span><span class="hs-comment">-- (attemptM thing_inside) runs thing_inside</span><span>
</span><span id="line-1427"></span><span class="hs-comment">-- If thing_inside succeeds, returning r,</span><span>
</span><span id="line-1428"></span><span class="hs-comment">--   we return (Just r), and propagate all constraints and errors</span><span>
</span><span id="line-1429"></span><span class="hs-comment">-- If thing_inside fail, throwing an exception,</span><span>
</span><span id="line-1430"></span><span class="hs-comment">--   we return Nothing, propagating insoluble constraints,</span><span>
</span><span id="line-1431"></span><span class="hs-comment">--                      and all errors</span><span>
</span><span id="line-1432"></span><span class="hs-comment">-- attemptM never throws an exception</span><span>
</span><span id="line-1433"></span><span id="attemptM"><span class="annot"><span class="annottext">attemptM :: forall r. TcRn r -&gt; TcRn (Maybe r)
</span><a href="GHC.Tc.Utils.Monad.html#attemptM"><span class="hs-identifier hs-var hs-var">attemptM</span></a></span></span><span> </span><span id="local-6989586621682985087"><span class="annot"><span class="annottext">TcRn r
</span><a href="#local-6989586621682985087"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1434"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682985088"><span class="annot"><a href="#local-6989586621682985088"><span class="hs-identifier hs-var">mb_r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682985089"><span class="annot"><a href="#local-6989586621682985089"><span class="hs-identifier hs-var">lie</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn r -&gt; TcM (Maybe r, WantedConstraints)
forall a. TcM a -&gt; TcM (Maybe a, WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#tryCaptureConstraints"><span class="hs-identifier hs-var">tryCaptureConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">TcRn r
</span><a href="#local-6989586621682985087"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1435"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitConstraints"><span class="hs-identifier hs-type">emitConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985089"><span class="hs-identifier hs-type">lie</span></a></span><span>
</span><span id="line-1436"></span><span>
</span><span id="line-1437"></span><span>       </span><span class="hs-comment">-- Debug trace</span><span>
</span><span id="line-1438"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">isNothing</span></span><span> </span><span class="annot"><a href="#local-6989586621682985088"><span class="hs-identifier hs-type">mb_r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1439"></span><span>         </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;attemptM recovering with insoluble constraints&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1440"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985089"><span class="hs-identifier hs-type">lie</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1441"></span><span>
</span><span id="line-1442"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682985088"><span class="hs-identifier hs-type">mb_r</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1443"></span><span>
</span><span id="line-1444"></span><span class="hs-comment">-----------------------</span><span>
</span><span id="line-1445"></span><span id="local-6989586621682985091"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#recoverM"><span class="hs-identifier hs-type">recoverM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985091"><span class="hs-identifier hs-type">r</span></a></span><span>      </span><span class="hs-comment">-- Recovery action; do this if the main one fails</span><span>
</span><span id="line-1446"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985091"><span class="hs-identifier hs-type">r</span></a></span><span>      </span><span class="hs-comment">-- Main action: do this first;</span><span>
</span><span id="line-1447"></span><span>                        </span><span class="hs-comment">--  if it generates errors, propagate them all</span><span>
</span><span id="line-1448"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985091"><span class="hs-identifier hs-type">r</span></a></span></span><span>
</span><span id="line-1449"></span><span class="hs-comment">-- (recoverM recover thing_inside) runs thing_inside</span><span>
</span><span id="line-1450"></span><span class="hs-comment">-- If thing_inside fails, propagate its errors and insoluble constraints</span><span>
</span><span id="line-1451"></span><span class="hs-comment">--                        and run 'recover'</span><span>
</span><span id="line-1452"></span><span class="hs-comment">-- If thing_inside succeeds, propagate all its errors and constraints</span><span>
</span><span id="line-1453"></span><span class="hs-comment">--</span><span>
</span><span id="line-1454"></span><span class="hs-comment">-- Can fail, if 'recover' fails</span><span>
</span><span id="line-1455"></span><span id="recoverM"><span class="annot"><span class="annottext">recoverM :: forall r. TcRn r -&gt; TcRn r -&gt; TcRn r
</span><a href="GHC.Tc.Utils.Monad.html#recoverM"><span class="hs-identifier hs-var hs-var">recoverM</span></a></span></span><span> </span><span id="local-6989586621682985094"><span class="annot"><span class="annottext">TcRn r
</span><a href="#local-6989586621682985094"><span class="hs-identifier hs-var">recover</span></a></span></span><span> </span><span id="local-6989586621682985095"><span class="annot"><span class="annottext">TcRn r
</span><a href="#local-6989586621682985095"><span class="hs-identifier hs-var">thing</span></a></span></span><span>
</span><span id="line-1456"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985096"><span class="annot"><a href="#local-6989586621682985096"><span class="hs-identifier hs-var">mb_res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn r -&gt; TcRn (Maybe r)
forall r. TcRn r -&gt; TcRn (Maybe r)
</span><a href="GHC.Tc.Utils.Monad.html#attemptM"><span class="hs-identifier hs-var">attemptM</span></a></span><span> </span><span class="annot"><span class="annottext">TcRn r
</span><a href="#local-6989586621682985095"><span class="hs-identifier hs-var">thing</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1457"></span><span>         </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682985096"><span class="hs-identifier hs-type">mb_res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1458"></span><span>           </span><span class="annot"><span class="annottext">Maybe r
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRn r
</span><a href="#local-6989586621682985094"><span class="hs-identifier hs-var">recover</span></a></span><span>
</span><span id="line-1459"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682985097"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621682985097"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">r -&gt; TcRn r
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621682985097"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1460"></span><span>
</span><span id="line-1461"></span><span class="hs-comment">-----------------------</span><span>
</span><span id="line-1462"></span><span>
</span><span id="line-1463"></span><span class="hs-comment">-- | Drop elements of the input that fail, so the result</span><span>
</span><span id="line-1464"></span><span class="hs-comment">-- list can be shorter than the argument list</span><span>
</span><span id="line-1465"></span><span id="local-6989586621682983520"><span id="local-6989586621682983521"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mapAndRecoverM"><span class="hs-identifier hs-type">mapAndRecoverM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682983520"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983521"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682983520"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682983521"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-1466"></span><span id="mapAndRecoverM"><span class="annot"><span class="annottext">mapAndRecoverM :: forall a b. (a -&gt; TcRn b) -&gt; [a] -&gt; TcRn [b]
</span><a href="GHC.Tc.Utils.Monad.html#mapAndRecoverM"><span class="hs-identifier hs-var hs-var">mapAndRecoverM</span></a></span></span><span> </span><span id="local-6989586621682985103"><span class="annot"><span class="annottext">a -&gt; TcRn b
</span><a href="#local-6989586621682985103"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682985104"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682985104"><span class="hs-identifier hs-var">xs</span></a></span></span><span>
</span><span id="line-1467"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985105"><span class="annot"><a href="#local-6989586621682985105"><span class="hs-identifier hs-var">mb_rs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(a -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe b))
-&gt; [a] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [Maybe b]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcRn b -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe b)
forall r. TcRn r -&gt; TcRn (Maybe r)
</span><a href="GHC.Tc.Utils.Monad.html#attemptM"><span class="hs-identifier hs-var">attemptM</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn b -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe b))
-&gt; (a -&gt; TcRn b) -&gt; a -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe b)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; TcRn b
</span><a href="#local-6989586621682985103"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682985104"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-1468"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682985107"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682985107"><span class="annot"><a href="#local-6989586621682985107"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682985105"><span class="hs-identifier hs-type">mb_rs</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1469"></span><span>
</span><span id="line-1470"></span><span class="hs-comment">-- | Apply the function to all elements on the input list</span><span>
</span><span id="line-1471"></span><span class="hs-comment">-- If all succeed, return the list of results</span><span>
</span><span id="line-1472"></span><span class="hs-comment">-- Otherwise fail, propagating all errors</span><span>
</span><span id="line-1473"></span><span id="local-6989586621682985108"><span id="local-6989586621682985109"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mapAndReportM"><span class="hs-identifier hs-type">mapAndReportM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682985108"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985109"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682985108"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682985109"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-1474"></span><span id="mapAndReportM"><span class="annot"><span class="annottext">mapAndReportM :: forall a b. (a -&gt; TcRn b) -&gt; [a] -&gt; TcRn [b]
</span><a href="GHC.Tc.Utils.Monad.html#mapAndReportM"><span class="hs-identifier hs-var hs-var">mapAndReportM</span></a></span></span><span> </span><span id="local-6989586621682985117"><span class="annot"><span class="annottext">a -&gt; TcRn b
</span><a href="#local-6989586621682985117"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682985118"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682985118"><span class="hs-identifier hs-var">xs</span></a></span></span><span>
</span><span id="line-1475"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985119"><span class="annot"><a href="#local-6989586621682985119"><span class="hs-identifier hs-var">mb_rs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(a -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe b))
-&gt; [a] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [Maybe b]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcRn b -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe b)
forall r. TcRn r -&gt; TcRn (Maybe r)
</span><a href="GHC.Tc.Utils.Monad.html#attemptM"><span class="hs-identifier hs-var">attemptM</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn b -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe b))
-&gt; (a -&gt; TcRn b) -&gt; a -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe b)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; TcRn b
</span><a href="#local-6989586621682985117"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682985118"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-1476"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">any</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">isNothing</span></span><span> </span><span class="annot"><a href="#local-6989586621682985119"><span class="hs-identifier hs-type">mb_rs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-type">failM</span></a></span><span>
</span><span id="line-1477"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682985121"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682985121"><span class="annot"><a href="#local-6989586621682985121"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682985119"><span class="hs-identifier hs-type">mb_rs</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1478"></span><span>
</span><span id="line-1479"></span><span class="annot"><span class="hs-comment">-- | The accumulator is not updated if the action fails</span></span><span>
</span><span id="line-1480"></span><span id="local-6989586621682983532"><span id="local-6989586621682983533"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#foldAndRecoverM"><span class="hs-identifier hs-type">foldAndRecoverM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682983532"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682983533"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983532"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682983532"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682983533"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983532"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-1481"></span><span id="foldAndRecoverM"><span class="annot"><span class="annottext">foldAndRecoverM :: forall b a. (b -&gt; a -&gt; TcRn b) -&gt; b -&gt; [a] -&gt; TcRn b
</span><a href="GHC.Tc.Utils.Monad.html#foldAndRecoverM"><span class="hs-identifier hs-var hs-var">foldAndRecoverM</span></a></span></span><span> </span><span class="annot"><span class="annottext">b -&gt; a -&gt; TcRn b
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682985124"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682985124"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">b -&gt; TcRn b
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682985124"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-1482"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#foldAndRecoverM"><span class="hs-identifier hs-var">foldAndRecoverM</span></a></span><span> </span><span id="local-6989586621682985125"><span class="annot"><span class="annottext">b -&gt; a -&gt; TcRn b
</span><a href="#local-6989586621682985125"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682985126"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682985126"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682985127"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682985127"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682985128"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682985128"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1483"></span><span>                          </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985129"><span class="annot"><a href="#local-6989586621682985129"><span class="hs-identifier hs-var">mb_r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn b -&gt; TcRn (Maybe b)
forall r. TcRn r -&gt; TcRn (Maybe r)
</span><a href="GHC.Tc.Utils.Monad.html#attemptM"><span class="hs-identifier hs-var">attemptM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; a -&gt; TcRn b
</span><a href="#local-6989586621682985125"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682985126"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682985127"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1484"></span><span>                             </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682985129"><span class="hs-identifier hs-type">mb_r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1485"></span><span>                                </span><span class="annot"><span class="annottext">Maybe b
</span><span class="hs-identifier hs-var">Nothing</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(b -&gt; a -&gt; TcRn b) -&gt; b -&gt; [a] -&gt; TcRn b
forall b a. (b -&gt; a -&gt; TcRn b) -&gt; b -&gt; [a] -&gt; TcRn b
</span><a href="GHC.Tc.Utils.Monad.html#foldAndRecoverM"><span class="hs-identifier hs-var">foldAndRecoverM</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; a -&gt; TcRn b
</span><a href="#local-6989586621682985125"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682985126"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682985128"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-1486"></span><span>                                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682985130"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682985130"><span class="hs-identifier hs-var">acc'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(b -&gt; a -&gt; TcRn b) -&gt; b -&gt; [a] -&gt; TcRn b
forall b a. (b -&gt; a -&gt; TcRn b) -&gt; b -&gt; [a] -&gt; TcRn b
</span><a href="GHC.Tc.Utils.Monad.html#foldAndRecoverM"><span class="hs-identifier hs-var">foldAndRecoverM</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; a -&gt; TcRn b
</span><a href="#local-6989586621682985125"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682985130"><span class="hs-identifier hs-var">acc'</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682985128"><span class="hs-identifier hs-var">xs</span></a></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-1487"></span><span>
</span><span id="line-1488"></span><span class="hs-comment">-----------------------</span><span>
</span><span id="line-1489"></span><span id="local-6989586621682983536"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tryTc"><span class="hs-identifier hs-type">tryTc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983536"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621682983536"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1490"></span><span class="hs-comment">-- (tryTc m) executes m, and returns</span><span>
</span><span id="line-1491"></span><span class="hs-comment">--      Just r,  if m succeeds (returning r)</span><span>
</span><span id="line-1492"></span><span class="hs-comment">--      Nothing, if m fails</span><span>
</span><span id="line-1493"></span><span class="hs-comment">-- It also returns all the errors and warnings accumulated by m</span><span>
</span><span id="line-1494"></span><span class="hs-comment">-- It always succeeds (never raises an exception)</span><span>
</span><span id="line-1495"></span><span id="tryTc"><span class="annot"><span class="annottext">tryTc :: forall a. TcRn a -&gt; TcRn (Maybe a, Messages TcRnMessage)
</span><a href="GHC.Tc.Utils.Monad.html#tryTc"><span class="hs-identifier hs-var hs-var">tryTc</span></a></span></span><span> </span><span id="local-6989586621682985131"><span class="annot"><span class="annottext">TcRn a
</span><a href="#local-6989586621682985131"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1496"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM (Maybe a) -&gt; TcM (Maybe a, Messages TcRnMessage)
forall r. TcM r -&gt; TcM (r, Messages TcRnMessage)
</span><a href="GHC.Tc.Utils.Monad.html#capture_messages"><span class="hs-identifier hs-var">capture_messages</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcRn a -&gt; TcM (Maybe a)
forall r. TcRn r -&gt; TcRn (Maybe r)
</span><a href="GHC.Tc.Utils.Monad.html#attemptM"><span class="hs-identifier hs-var">attemptM</span></a></span><span> </span><span class="annot"><span class="annottext">TcRn a
</span><a href="#local-6989586621682985131"><span class="hs-identifier hs-var">thing_inside</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1497"></span><span>
</span><span id="line-1498"></span><span class="hs-comment">-----------------------</span><span>
</span><span id="line-1499"></span><span id="local-6989586621682985132"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#discardErrs"><span class="hs-identifier hs-type">discardErrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985132"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985132"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1500"></span><span class="hs-comment">-- (discardErrs m) runs m,</span><span>
</span><span id="line-1501"></span><span class="hs-comment">--   discarding all error messages and warnings generated by m</span><span>
</span><span id="line-1502"></span><span class="hs-comment">-- If m fails, discardErrs fails, and vice versa</span><span>
</span><span id="line-1503"></span><span id="discardErrs"><span class="annot"><span class="annottext">discardErrs :: forall a. TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#discardErrs"><span class="hs-identifier hs-var hs-var">discardErrs</span></a></span></span><span> </span><span id="local-6989586621682985135"><span class="annot"><span class="annottext">TcRn a
</span><a href="#local-6989586621682985135"><span class="hs-identifier hs-var">m</span></a></span></span><span>
</span><span id="line-1504"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985136"><span class="annot"><a href="#local-6989586621682985136"><span class="hs-identifier hs-var">errs_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Messages TcRnMessage -&gt; TcRn (IORef (Messages TcRnMessage))
forall (m :: * -&gt; *) a. MonadIO m =&gt; a -&gt; m (TcRef a)
</span><a href="GHC.Tc.Types.TcRef.html#newTcRef"><span class="hs-identifier hs-var">newTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">Messages TcRnMessage
forall e. Messages e
</span><a href="GHC.Types.Error.html#emptyMessages"><span class="hs-identifier hs-var">emptyMessages</span></a></span><span>
</span><span id="line-1505"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setErrsVar"><span class="hs-identifier hs-type">setErrsVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985136"><span class="hs-identifier hs-type">errs_var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985135"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1506"></span><span>
</span><span id="line-1507"></span><span class="hs-comment">-----------------------</span><span>
</span><span id="line-1508"></span><span id="local-6989586621682985137"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tryTcDiscardingErrs"><span class="hs-identifier hs-type">tryTcDiscardingErrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985137"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985137"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985137"><span class="hs-identifier hs-type">r</span></a></span></span><span>
</span><span id="line-1509"></span><span class="hs-comment">-- (tryTcDiscardingErrs recover thing_inside) tries 'thing_inside';</span><span>
</span><span id="line-1510"></span><span class="hs-comment">--      if 'main' succeeds with no error messages, it's the answer</span><span>
</span><span id="line-1511"></span><span class="hs-comment">--      otherwise discard everything from 'main', including errors,</span><span>
</span><span id="line-1512"></span><span class="hs-comment">--          and try 'recover' instead.</span><span>
</span><span id="line-1513"></span><span id="tryTcDiscardingErrs"><span class="annot"><span class="annottext">tryTcDiscardingErrs :: forall r. TcRn r -&gt; TcRn r -&gt; TcRn r
</span><a href="GHC.Tc.Utils.Monad.html#tryTcDiscardingErrs"><span class="hs-identifier hs-var hs-var">tryTcDiscardingErrs</span></a></span></span><span> </span><span id="local-6989586621682985143"><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682985143"><span class="hs-identifier hs-var">recover</span></a></span></span><span> </span><span id="local-6989586621682985144"><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682985144"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1514"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682985145"><span class="annot"><a href="#local-6989586621682985145"><span class="hs-identifier hs-var">mb_res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682985146"><span class="annot"><a href="#local-6989586621682985146"><span class="hs-identifier hs-var">lie</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682985147"><span class="annot"><a href="#local-6989586621682985147"><span class="hs-identifier hs-var">msgs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM (Maybe r, WantedConstraints)
-&gt; TcM ((Maybe r, WantedConstraints), Messages TcRnMessage)
forall r. TcM r -&gt; TcM (r, Messages TcRnMessage)
</span><a href="GHC.Tc.Utils.Monad.html#capture_messages"><span class="hs-identifier hs-var">capture_messages</span></a></span><span>    </span><span class="annot"><span class="annottext">(TcM (Maybe r, WantedConstraints)
 -&gt; TcM ((Maybe r, WantedConstraints), Messages TcRnMessage))
-&gt; TcM (Maybe r, WantedConstraints)
-&gt; TcM ((Maybe r, WantedConstraints), Messages TcRnMessage)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1515"></span><span>                                  </span><span class="annot"><span class="annottext">TcM (Maybe r) -&gt; TcM (Maybe r, WantedConstraints)
forall r. TcM r -&gt; TcM (r, WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#capture_constraints"><span class="hs-identifier hs-var">capture_constraints</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (Maybe r) -&gt; TcM (Maybe r, WantedConstraints))
-&gt; TcM (Maybe r) -&gt; TcM (Maybe r, WantedConstraints)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1516"></span><span>                                  </span><span class="annot"><span class="annottext">TcM r -&gt; TcM (Maybe r)
forall r. TcRn r -&gt; TcRn (Maybe r)
</span><a href="GHC.Tc.Utils.Monad.html#tcTryM"><span class="hs-identifier hs-var">tcTryM</span></a></span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682985144"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1517"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682985145"><span class="hs-identifier hs-type">mb_res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1518"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682985148"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621682985148"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Messages TcRnMessage -&gt; Bool
forall e. Diagnostic e =&gt; Messages e -&gt; Bool
</span><a href="GHC.Types.Error.html#errorsFound"><span class="hs-identifier hs-var">errorsFound</span></a></span><span> </span><span class="annot"><span class="annottext">Messages TcRnMessage
</span><a href="#local-6989586621682985147"><span class="hs-identifier hs-var">msgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1519"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WantedConstraints -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#insolubleWC"><span class="hs-identifier hs-var">insolubleWC</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621682985146"><span class="hs-identifier hs-var">lie</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1520"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- 'main' succeeded with no errors</span><span>
</span><span id="line-1521"></span><span>                 </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Messages TcRnMessage -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addMessages"><span class="hs-identifier hs-var">addMessages</span></a></span><span> </span><span class="annot"><span class="annottext">Messages TcRnMessage
</span><a href="#local-6989586621682985147"><span class="hs-identifier hs-var">msgs</span></a></span><span>  </span><span class="hs-comment">-- msgs might still have warnings</span><span>
</span><span id="line-1522"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">WantedConstraints -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#emitConstraints"><span class="hs-identifier hs-var">emitConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621682985146"><span class="hs-identifier hs-var">lie</span></a></span><span>
</span><span id="line-1523"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">r -&gt; TcM r
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621682985148"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1524"></span><span>
</span><span id="line-1525"></span><span>            </span><span class="annot"><span class="annottext">Maybe r
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- 'main' failed, or produced an error message</span><span>
</span><span id="line-1526"></span><span>                 </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682985143"><span class="hs-identifier hs-var">recover</span></a></span><span>     </span><span class="hs-comment">-- Discard all errors and warnings</span><span>
</span><span id="line-1527"></span><span>                             </span><span class="hs-comment">-- and unsolved constraints entirely</span><span>
</span><span id="line-1528"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-1529"></span><span>
</span><span id="line-1530"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
             Error message generation (type checker)
*                                                                      *
************************************************************************

    The addErrTc functions add an error message, but do not cause failure.
    The 'M' variants pass a TidyEnv that has already been used to
    tidy up the message; we then use it to tidy the context messages
-}</span><span>
</span><span id="line-1541"></span><span>
</span><span id="line-1542"></span><span class="hs-comment">{-

Note [Reporting warning diagnostics]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We use functions below to report warnings.  For the most part,
we do /not/ need to check any warning flags before doing so.
See https://gitlab.haskell.org/ghc/ghc/-/wikis/Errors-as-(structured)-values
for the design.

-}</span><span>
</span><span id="line-1552"></span><span>
</span><span id="line-1553"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-type">addErrTc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1554"></span><span id="addErrTc"><span class="annot"><span class="annottext">addErrTc :: TcRnMessage -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var hs-var">addErrTc</span></a></span></span><span> </span><span id="local-6989586621682985149"><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682985149"><span class="hs-identifier hs-var">err_msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985150"><span class="annot"><a href="#local-6989586621682985150"><span class="hs-identifier hs-var">env0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkM TidyEnv -&gt; TcM TidyEnv
forall a. ZonkM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-var">liftZonkM</span></a></span><span> </span><span class="annot"><span class="annottext">ZonkM TidyEnv
</span><a href="GHC.Tc.Zonk.TcType.html#tcInitTidyEnv"><span class="hs-identifier hs-var">tcInitTidyEnv</span></a></span><span>
</span><span id="line-1555"></span><span>                      </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrTcM"><span class="hs-identifier hs-type">addErrTcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682985150"><span class="hs-identifier hs-type">env0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682985149"><span class="hs-identifier hs-type">err_msg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1556"></span><span>
</span><span id="line-1557"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrTcM"><span class="hs-identifier hs-type">addErrTcM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1558"></span><span id="addErrTcM"><span class="annot"><span class="annottext">addErrTcM :: (TidyEnv, TcRnMessage) -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTcM"><span class="hs-identifier hs-var hs-var">addErrTcM</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682985151"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682985151"><span class="hs-identifier hs-var">tidy_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682985152"><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682985152"><span class="hs-identifier hs-var">err_msg</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1559"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985153"><span class="annot"><a href="#local-6989586621682985153"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM [ErrCtxt]
</span><a href="GHC.Tc.Utils.Monad.html#getErrCtxt"><span class="hs-identifier hs-var">getErrCtxt</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1560"></span><span>         </span><span id="local-6989586621682985154"><span class="annot"><a href="#local-6989586621682985154"><span class="hs-identifier hs-var">loc</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-type">getSrcSpanM</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1561"></span><span>         </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#add_err_tcm"><span class="hs-identifier hs-type">add_err_tcm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985151"><span class="hs-identifier hs-type">tidy_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985152"><span class="hs-identifier hs-type">err_msg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985154"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985153"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1562"></span><span>
</span><span id="line-1563"></span><span class="hs-comment">-- The failWith functions add an error message and cause failure</span><span>
</span><span id="line-1564"></span><span>
</span><span id="line-1565"></span><span id="local-6989586621682985156"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-type">failWithTc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985156"><span class="hs-identifier hs-type">a</span></a></span></span><span>               </span><span class="hs-comment">-- Add an error message and fail</span><span>
</span><span id="line-1566"></span><span id="failWithTc"><span class="annot"><span class="annottext">failWithTc :: forall a. TcRnMessage -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var hs-var">failWithTc</span></a></span></span><span> </span><span id="local-6989586621682985158"><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682985158"><span class="hs-identifier hs-var">err_msg</span></a></span></span><span>
</span><span id="line-1567"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682985158"><span class="hs-identifier hs-var">err_msg</span></a></span><span> </span><span class="annot"><span class="annottext">TcM ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall a b.
IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) a
forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a></span><span>
</span><span id="line-1568"></span><span>
</span><span id="line-1569"></span><span id="local-6989586621682983541"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failWithTcM"><span class="hs-identifier hs-type">failWithTcM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983541"><span class="hs-identifier hs-type">a</span></a></span></span><span>   </span><span class="hs-comment">-- Add an error message and fail</span><span>
</span><span id="line-1570"></span><span id="failWithTcM"><span class="annot"><span class="annottext">failWithTcM :: forall a. (TidyEnv, TcRnMessage) -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTcM"><span class="hs-identifier hs-var hs-var">failWithTcM</span></a></span></span><span> </span><span id="local-6989586621682985160"><span class="annot"><span class="annottext">(TidyEnv, TcRnMessage)
</span><a href="#local-6989586621682985160"><span class="hs-identifier hs-var">local_and_msg</span></a></span></span><span>
</span><span id="line-1571"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TidyEnv, TcRnMessage) -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTcM"><span class="hs-identifier hs-var">addErrTcM</span></a></span><span> </span><span class="annot"><span class="annottext">(TidyEnv, TcRnMessage)
</span><a href="#local-6989586621682985160"><span class="hs-identifier hs-var">local_and_msg</span></a></span><span> </span><span class="annot"><span class="annottext">TcM ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall a b.
IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) a
forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a></span><span>
</span><span id="line-1572"></span><span>
</span><span id="line-1573"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-type">checkTc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>         </span><span class="hs-comment">-- Check that the boolean is true</span><span>
</span><span id="line-1574"></span><span id="checkTc"><span class="annot"><span class="annottext">checkTc :: Bool -&gt; TcRnMessage -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var hs-var">checkTc</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="annot"><span class="annottext">TcRnMessage
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcM ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1575"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span id="local-6989586621682985161"><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682985161"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM ()
forall a. TcRnMessage -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682985161"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-1576"></span><span>
</span><span id="line-1577"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#checkTcM"><span class="hs-identifier hs-type">checkTcM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1578"></span><span id="checkTcM"><span class="annot"><span class="annottext">checkTcM :: Bool -&gt; (TidyEnv, TcRnMessage) -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTcM"><span class="hs-identifier hs-var hs-var">checkTcM</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="annot"><span class="annottext">(TidyEnv, TcRnMessage)
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcM ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1579"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#checkTcM"><span class="hs-identifier hs-var">checkTcM</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span id="local-6989586621682985162"><span class="annot"><span class="annottext">(TidyEnv, TcRnMessage)
</span><a href="#local-6989586621682985162"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TidyEnv, TcRnMessage) -&gt; TcM ()
forall a. (TidyEnv, TcRnMessage) -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTcM"><span class="hs-identifier hs-var">failWithTcM</span></a></span><span> </span><span class="annot"><span class="annottext">(TidyEnv, TcRnMessage)
</span><a href="#local-6989586621682985162"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-1580"></span><span>
</span><span id="line-1581"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failIfTc"><span class="hs-identifier hs-type">failIfTc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>         </span><span class="hs-comment">-- Check that the boolean is false</span><span>
</span><span id="line-1582"></span><span id="failIfTc"><span class="annot"><span class="annottext">failIfTc :: Bool -&gt; TcRnMessage -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#failIfTc"><span class="hs-identifier hs-var hs-var">failIfTc</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">TcRnMessage
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcM ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1583"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failIfTc"><span class="hs-identifier hs-var">failIfTc</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span id="local-6989586621682985163"><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682985163"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM ()
forall a. TcRnMessage -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682985163"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-1584"></span><span>
</span><span id="line-1585"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failIfTcM"><span class="hs-identifier hs-type">failIfTcM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1586"></span><span>   </span><span class="hs-comment">-- Check that the boolean is false</span><span>
</span><span id="line-1587"></span><span id="failIfTcM"><span class="annot"><span class="annottext">failIfTcM :: Bool -&gt; (TidyEnv, TcRnMessage) -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#failIfTcM"><span class="hs-identifier hs-var hs-var">failIfTcM</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">(TidyEnv, TcRnMessage)
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcM ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1588"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failIfTcM"><span class="hs-identifier hs-var">failIfTcM</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span id="local-6989586621682985164"><span class="annot"><span class="annottext">(TidyEnv, TcRnMessage)
</span><a href="#local-6989586621682985164"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TidyEnv, TcRnMessage) -&gt; TcM ()
forall a. (TidyEnv, TcRnMessage) -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTcM"><span class="hs-identifier hs-var">failWithTcM</span></a></span><span> </span><span class="annot"><span class="annottext">(TidyEnv, TcRnMessage)
</span><a href="#local-6989586621682985164"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-1589"></span><span>
</span><span id="line-1590"></span><span>
</span><span id="line-1591"></span><span class="hs-comment">--         Warnings have no 'M' variant, nor failure</span><span>
</span><span id="line-1592"></span><span>
</span><span id="line-1593"></span><span class="annot"><span class="hs-comment">-- | Display a warning if a condition is met.</span></span><span>
</span><span id="line-1594"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#warnIf"><span class="hs-identifier hs-type">warnIf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1595"></span><span id="warnIf"><span class="annot"><span class="annottext">warnIf :: Bool -&gt; TcRnMessage -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#warnIf"><span class="hs-identifier hs-var hs-var">warnIf</span></a></span></span><span> </span><span id="local-6989586621682985165"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682985165"><span class="hs-identifier hs-var">is_bad</span></a></span></span><span> </span><span id="local-6989586621682985166"><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682985166"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-comment">-- No need to check any flag here, it will be done in 'diagReasonSeverity'.</span><span>
</span><span id="line-1596"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcM () -&gt; TcM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682985165"><span class="hs-identifier hs-var">is_bad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addDiagnostic"><span class="hs-identifier hs-var">addDiagnostic</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682985166"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1597"></span><span>
</span><span id="line-1598"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#no_err_info"><span class="hs-identifier hs-type">no_err_info</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#ErrInfo"><span class="hs-identifier hs-type">ErrInfo</span></a></span><span>
</span><span id="line-1599"></span><span id="no_err_info"><span class="annot"><span class="annottext">no_err_info :: ErrInfo
</span><a href="GHC.Tc.Utils.Monad.html#no_err_info"><span class="hs-identifier hs-var hs-var">no_err_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; ErrInfo
</span><a href="GHC.Tc.Errors.Types.html#ErrInfo"><span class="hs-identifier hs-var">ErrInfo</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">Outputable.empty</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">Outputable.empty</span></a></span><span>
</span><span id="line-1600"></span><span>
</span><span id="line-1601"></span><span class="annot"><span class="hs-comment">-- | Display a warning if a condition is met.</span></span><span>
</span><span id="line-1602"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#diagnosticTc"><span class="hs-identifier hs-type">diagnosticTc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1603"></span><span id="diagnosticTc"><span class="annot"><span class="annottext">diagnosticTc :: Bool -&gt; TcRnMessage -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#diagnosticTc"><span class="hs-identifier hs-var hs-var">diagnosticTc</span></a></span></span><span> </span><span id="local-6989586621682985168"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682985168"><span class="hs-identifier hs-var">should_report</span></a></span></span><span> </span><span id="local-6989586621682985169"><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682985169"><span class="hs-identifier hs-var">warn_msg</span></a></span></span><span>
</span><span id="line-1604"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682985168"><span class="hs-identifier hs-var">should_report</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addDiagnosticTc"><span class="hs-identifier hs-var">addDiagnosticTc</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682985169"><span class="hs-identifier hs-var">warn_msg</span></a></span><span>
</span><span id="line-1605"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcM ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1606"></span><span>
</span><span id="line-1607"></span><span class="annot"><span class="hs-comment">-- | Display a diagnostic if a condition is met.</span></span><span>
</span><span id="line-1608"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#diagnosticTcM"><span class="hs-identifier hs-type">diagnosticTcM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1609"></span><span id="diagnosticTcM"><span class="annot"><span class="annottext">diagnosticTcM :: Bool -&gt; (TidyEnv, TcRnMessage) -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#diagnosticTcM"><span class="hs-identifier hs-var hs-var">diagnosticTcM</span></a></span></span><span> </span><span id="local-6989586621682985170"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682985170"><span class="hs-identifier hs-var">should_report</span></a></span></span><span> </span><span id="local-6989586621682985171"><span class="annot"><span class="annottext">(TidyEnv, TcRnMessage)
</span><a href="#local-6989586621682985171"><span class="hs-identifier hs-var">warn_msg</span></a></span></span><span>
</span><span id="line-1610"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682985170"><span class="hs-identifier hs-var">should_report</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TidyEnv, TcRnMessage) -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addDiagnosticTcM"><span class="hs-identifier hs-var">addDiagnosticTcM</span></a></span><span> </span><span class="annot"><span class="annottext">(TidyEnv, TcRnMessage)
</span><a href="#local-6989586621682985171"><span class="hs-identifier hs-var">warn_msg</span></a></span><span>
</span><span id="line-1611"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcM ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1612"></span><span>
</span><span id="line-1613"></span><span class="annot"><span class="hs-comment">-- | Display a diagnostic in the current context.</span></span><span>
</span><span id="line-1614"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addDiagnosticTc"><span class="hs-identifier hs-type">addDiagnosticTc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1615"></span><span id="addDiagnosticTc"><span class="annot"><span class="annottext">addDiagnosticTc :: TcRnMessage -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addDiagnosticTc"><span class="hs-identifier hs-var hs-var">addDiagnosticTc</span></a></span></span><span> </span><span id="local-6989586621682985172"><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682985172"><span class="hs-identifier hs-var">msg</span></a></span></span><span>
</span><span id="line-1616"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985173"><span class="annot"><a href="#local-6989586621682985173"><span class="hs-identifier hs-var">env0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkM TidyEnv -&gt; TcM TidyEnv
forall a. ZonkM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-var">liftZonkM</span></a></span><span> </span><span class="annot"><span class="annottext">ZonkM TidyEnv
</span><a href="GHC.Tc.Zonk.TcType.html#tcInitTidyEnv"><span class="hs-identifier hs-var">tcInitTidyEnv</span></a></span><span>
</span><span id="line-1617"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addDiagnosticTcM"><span class="hs-identifier hs-type">addDiagnosticTcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682985173"><span class="hs-identifier hs-type">env0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682985172"><span class="hs-identifier hs-type">msg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1618"></span><span>
</span><span id="line-1619"></span><span class="annot"><span class="hs-comment">-- | Display a diagnostic in a given context.</span></span><span>
</span><span id="line-1620"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addDiagnosticTcM"><span class="hs-identifier hs-type">addDiagnosticTcM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1621"></span><span id="addDiagnosticTcM"><span class="annot"><span class="annottext">addDiagnosticTcM :: (TidyEnv, TcRnMessage) -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addDiagnosticTcM"><span class="hs-identifier hs-var hs-var">addDiagnosticTcM</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682985174"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682985174"><span class="hs-identifier hs-var">env0</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682985175"><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682985175"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1622"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985176"><span class="annot"><a href="#local-6989586621682985176"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM [ErrCtxt]
</span><a href="GHC.Tc.Utils.Monad.html#getErrCtxt"><span class="hs-identifier hs-var">getErrCtxt</span></a></span><span>
</span><span id="line-1623"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682985177"><span class="annot"><a href="#local-6989586621682985177"><span class="hs-identifier hs-var">extra</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mkErrInfo"><span class="hs-identifier hs-type">mkErrInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985174"><span class="hs-identifier hs-type">env0</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985176"><span class="hs-identifier hs-type">ctxt</span></a></span><span>
</span><span id="line-1624"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682985178"><span class="annot"><a href="#local-6989586621682985178"><span class="hs-identifier hs-var hs-var">err_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; ErrInfo
</span><a href="GHC.Tc.Errors.Types.html#ErrInfo"><span class="hs-identifier hs-var">ErrInfo</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682985177"><span class="hs-identifier hs-var">extra</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">Outputable.empty</span></a></span><span>
</span><span id="line-1625"></span><span>            </span><span id="local-6989586621682985179"><span class="annot"><a href="#local-6989586621682985179"><span class="hs-identifier hs-var hs-var">detailed_msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ErrInfo -&gt; TcRnMessage -&gt; TcRnMessageDetailed
</span><a href="GHC.Tc.Utils.Monad.html#mkDetailedMessage"><span class="hs-identifier hs-var">mkDetailedMessage</span></a></span><span> </span><span class="annot"><span class="annottext">ErrInfo
</span><a href="#local-6989586621682985178"><span class="hs-identifier hs-var">err_info</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682985175"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-1626"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#add_diagnostic"><span class="hs-identifier hs-type">add_diagnostic</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985179"><span class="hs-identifier hs-type">detailed_msg</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1627"></span><span>
</span><span id="line-1628"></span><span class="hs-comment">-- | A variation of 'addDiagnostic' that takes a function to produce a 'TcRnDsMessage'</span><span>
</span><span id="line-1629"></span><span class="hs-comment">-- given some additional context about the diagnostic.</span><span>
</span><span id="line-1630"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addDetailedDiagnostic"><span class="hs-identifier hs-type">addDetailedDiagnostic</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Errors.Types.html#ErrInfo"><span class="hs-identifier hs-type">ErrInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1631"></span><span id="addDetailedDiagnostic"><span class="annot"><span class="annottext">addDetailedDiagnostic :: (ErrInfo -&gt; TcRnMessage) -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addDetailedDiagnostic"><span class="hs-identifier hs-var hs-var">addDetailedDiagnostic</span></a></span></span><span> </span><span id="local-6989586621682985181"><span class="annot"><span class="annottext">ErrInfo -&gt; TcRnMessage
</span><a href="#local-6989586621682985181"><span class="hs-identifier hs-var">mkMsg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1632"></span><span>  </span><span id="local-6989586621682985182"><span class="annot"><a href="#local-6989586621682985182"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn SrcSpan
</span><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a></span><span>
</span><span id="line-1633"></span><span>  </span><span id="local-6989586621682985183"><span class="annot"><a href="#local-6989586621682985183"><span class="hs-identifier hs-var">name_ppr_ctx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getNamePprCtx"><span class="hs-identifier hs-type">getNamePprCtx</span></a></span><span>
</span><span id="line-1634"></span><span>  </span><span class="hs-glyph">!</span><span id="local-6989586621682985184"><span class="annot"><a href="#local-6989586621682985184"><span class="hs-identifier hs-var">diag_opts</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Diagnostic.html#initDiagOpts"><span class="hs-identifier hs-type">initDiagOpts</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-type">getDynFlags</span></a></span><span>
</span><span id="line-1635"></span><span>  </span><span id="local-6989586621682985185"><span class="annot"><a href="#local-6989586621682985185"><span class="hs-identifier hs-var">env0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-type">liftZonkM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#tcInitTidyEnv"><span class="hs-identifier hs-type">tcInitTidyEnv</span></a></span><span>
</span><span id="line-1636"></span><span>  </span><span id="local-6989586621682985186"><span class="annot"><a href="#local-6989586621682985186"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getErrCtxt"><span class="hs-identifier hs-type">getErrCtxt</span></a></span><span>
</span><span id="line-1637"></span><span>  </span><span id="local-6989586621682985187"><span class="annot"><a href="#local-6989586621682985187"><span class="hs-identifier hs-var">err_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mkErrInfo"><span class="hs-identifier hs-type">mkErrInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985185"><span class="hs-identifier hs-type">env0</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985186"><span class="hs-identifier hs-type">ctxt</span></a></span><span>
</span><span id="line-1638"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#reportDiagnostic"><span class="hs-identifier hs-type">reportDiagnostic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Error.html#mkMsgEnvelope"><span class="hs-identifier hs-type">mkMsgEnvelope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985184"><span class="hs-identifier hs-type">diag_opts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985182"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985183"><span class="hs-identifier hs-type">name_ppr_ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682985181"><span class="hs-identifier hs-type">mkMsg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Errors.Types.html#ErrInfo"><span class="hs-identifier hs-type">ErrInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985187"><span class="hs-identifier hs-type">err_info</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-type">empty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1639"></span><span>
</span><span id="line-1640"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addTcRnDiagnostic"><span class="hs-identifier hs-type">addTcRnDiagnostic</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1641"></span><span id="addTcRnDiagnostic"><span class="annot"><span class="annottext">addTcRnDiagnostic :: TcRnMessage -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addTcRnDiagnostic"><span class="hs-identifier hs-var hs-var">addTcRnDiagnostic</span></a></span></span><span> </span><span id="local-6989586621682985188"><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682985188"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1642"></span><span>  </span><span id="local-6989586621682985189"><span class="annot"><a href="#local-6989586621682985189"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn SrcSpan
</span><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a></span><span>
</span><span id="line-1643"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mkTcRnMessage"><span class="hs-identifier hs-type">mkTcRnMessage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985189"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985188"><span class="hs-identifier hs-type">msg</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;=</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#reportDiagnostic"><span class="hs-identifier hs-type">reportDiagnostic</span></a></span><span>
</span><span id="line-1644"></span><span>
</span><span id="line-1645"></span><span class="hs-comment">-- | Display a diagnostic for the current source location, taken from</span><span>
</span><span id="line-1646"></span><span class="hs-comment">-- the 'TcRn' monad.</span><span>
</span><span id="line-1647"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addDiagnostic"><span class="hs-identifier hs-type">addDiagnostic</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1648"></span><span id="addDiagnostic"><span class="annot"><span class="annottext">addDiagnostic :: TcRnMessage -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addDiagnostic"><span class="hs-identifier hs-var hs-var">addDiagnostic</span></a></span></span><span> </span><span id="local-6989586621682985190"><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682985190"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnMessageDetailed -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#add_diagnostic"><span class="hs-identifier hs-var">add_diagnostic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrInfo -&gt; TcRnMessage -&gt; TcRnMessageDetailed
</span><a href="GHC.Tc.Utils.Monad.html#mkDetailedMessage"><span class="hs-identifier hs-var">mkDetailedMessage</span></a></span><span> </span><span class="annot"><span class="annottext">ErrInfo
</span><a href="GHC.Tc.Utils.Monad.html#no_err_info"><span class="hs-identifier hs-var">no_err_info</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682985190"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1649"></span><span>
</span><span id="line-1650"></span><span class="annot"><span class="hs-comment">-- | Display a diagnostic for a given source location.</span></span><span>
</span><span id="line-1651"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addDiagnosticAt"><span class="hs-identifier hs-type">addDiagnosticAt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1652"></span><span id="addDiagnosticAt"><span class="annot"><span class="annottext">addDiagnosticAt :: SrcSpan -&gt; TcRnMessage -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addDiagnosticAt"><span class="hs-identifier hs-var hs-var">addDiagnosticAt</span></a></span></span><span> </span><span id="local-6989586621682985191"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682985191"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682985192"><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682985192"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1653"></span><span>  </span><span id="local-6989586621682985193"><span class="annot"><a href="#local-6989586621682985193"><span class="hs-identifier hs-var">unit_state</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; HscEnv -&gt; UnitState
HscEnv -&gt; UnitState
</span><a href="GHC.Driver.Env.html#hsc_units"><span class="hs-identifier hs-var">hsc_units</span></a></span><span> </span><span class="annot"><span class="annottext">(HscEnv -&gt; UnitState)
-&gt; TcRnIf TcGblEnv TcLclEnv HscEnv
-&gt; IOEnv (Env TcGblEnv TcLclEnv) UnitState
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span>
</span><span id="line-1654"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682985194"><span class="annot"><a href="#local-6989586621682985194"><span class="hs-identifier hs-var hs-var">detailed_msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ErrInfo -&gt; TcRnMessage -&gt; TcRnMessageDetailed
</span><a href="GHC.Tc.Utils.Monad.html#mkDetailedMessage"><span class="hs-identifier hs-var">mkDetailedMessage</span></a></span><span> </span><span class="annot"><span class="annottext">ErrInfo
</span><a href="GHC.Tc.Utils.Monad.html#no_err_info"><span class="hs-identifier hs-var">no_err_info</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682985192"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-1655"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mkTcRnMessage"><span class="hs-identifier hs-type">mkTcRnMessage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985191"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessageWithInfo"><span class="hs-identifier hs-type">TcRnMessageWithInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985193"><span class="hs-identifier hs-type">unit_state</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985194"><span class="hs-identifier hs-type">detailed_msg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;=</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#reportDiagnostic"><span class="hs-identifier hs-type">reportDiagnostic</span></a></span><span>
</span><span id="line-1656"></span><span>
</span><span id="line-1657"></span><span class="hs-comment">-- | Display a diagnostic, with an optional flag, for the current source</span><span>
</span><span id="line-1658"></span><span class="hs-comment">-- location.</span><span>
</span><span id="line-1659"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#add_diagnostic"><span class="hs-identifier hs-type">add_diagnostic</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessageDetailed"><span class="hs-identifier hs-type">TcRnMessageDetailed</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1660"></span><span id="add_diagnostic"><span class="annot"><span class="annottext">add_diagnostic :: TcRnMessageDetailed -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#add_diagnostic"><span class="hs-identifier hs-var hs-var">add_diagnostic</span></a></span></span><span> </span><span id="local-6989586621682985195"><span class="annot"><span class="annottext">TcRnMessageDetailed
</span><a href="#local-6989586621682985195"><span class="hs-identifier hs-var">msg</span></a></span></span><span>
</span><span id="line-1661"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985196"><span class="annot"><a href="#local-6989586621682985196"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn SrcSpan
</span><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a></span><span>
</span><span id="line-1662"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682985197"><span class="annot"><a href="#local-6989586621682985197"><span class="hs-identifier hs-var">unit_state</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#hsc_units"><span class="hs-identifier hs-type">hsc_units</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-type">getTopEnv</span></a></span><span>
</span><span id="line-1663"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mkTcRnMessage"><span class="hs-identifier hs-type">mkTcRnMessage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985196"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessageWithInfo"><span class="hs-identifier hs-type">TcRnMessageWithInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985197"><span class="hs-identifier hs-type">unit_state</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985195"><span class="hs-identifier hs-type">msg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;=</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#reportDiagnostic"><span class="hs-identifier hs-type">reportDiagnostic</span></a></span><span>
</span><span id="line-1664"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-1665"></span><span>
</span><span id="line-1666"></span><span>
</span><span id="line-1667"></span><span class="hs-comment">{-
-----------------------------------
        Other helper functions
-}</span><span>
</span><span id="line-1671"></span><span>
</span><span id="line-1672"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#add_err_tcm"><span class="hs-identifier hs-type">add_err_tcm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span>
</span><span id="line-1673"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.ErrCtxt.html#ErrCtxt"><span class="hs-identifier hs-type">ErrCtxt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1674"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1675"></span><span id="add_err_tcm"><span class="annot"><span class="annottext">add_err_tcm :: TidyEnv -&gt; TcRnMessage -&gt; SrcSpan -&gt; [ErrCtxt] -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#add_err_tcm"><span class="hs-identifier hs-var hs-var">add_err_tcm</span></a></span></span><span> </span><span id="local-6989586621682985198"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682985198"><span class="hs-identifier hs-var">tidy_env</span></a></span></span><span> </span><span id="local-6989586621682985199"><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621682985199"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621682985200"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682985200"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682985201"><span class="annot"><span class="annottext">[ErrCtxt]
</span><a href="#local-6989586621682985201"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span>
</span><span id="line-1676"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985202"><span class="annot"><a href="#local-6989586621682985202"><span class="hs-identifier hs-var">err_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; [ErrCtxt] -&gt; TcRn SDoc
</span><a href="GHC.Tc.Utils.Monad.html#mkErrInfo"><span class="hs-identifier hs-var">mkErrInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682985198"><span class="hs-identifier hs-var">tidy_env</span></a></span><span> </span><span class="annot"><span class="annottext">[ErrCtxt]
</span><a href="#local-6989586621682985201"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1677"></span><span>        </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#add_long_err_at"><span class="hs-identifier hs-type">add_long_err_at</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985200"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mkDetailedMessage"><span class="hs-identifier hs-type">mkDetailedMessage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Errors.Types.html#ErrInfo"><span class="hs-identifier hs-type">ErrInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985202"><span class="hs-identifier hs-type">err_info</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-type">Outputable.empty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682985199"><span class="hs-identifier hs-type">msg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1678"></span><span>
</span><span id="line-1679"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mkErrInfo"><span class="hs-identifier hs-type">mkErrInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.ErrCtxt.html#ErrCtxt"><span class="hs-identifier hs-type">ErrCtxt</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-1680"></span><span class="hs-comment">-- Tidy the error info, trimming excessive contexts</span><span>
</span><span id="line-1681"></span><span id="mkErrInfo"><span class="annot"><span class="annottext">mkErrInfo :: TidyEnv -&gt; [ErrCtxt] -&gt; TcRn SDoc
</span><a href="GHC.Tc.Utils.Monad.html#mkErrInfo"><span class="hs-identifier hs-var hs-var">mkErrInfo</span></a></span></span><span> </span><span id="local-6989586621682985203"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682985203"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682985204"><span class="annot"><span class="annottext">[ErrCtxt]
</span><a href="#local-6989586621682985204"><span class="hs-identifier hs-var">ctxts</span></a></span></span><span>
</span><span id="line-1682"></span><span class="hs-comment">--  = do</span><span>
</span><span id="line-1683"></span><span class="hs-comment">--       dbg &lt;- hasPprDebug &lt;$&gt; getDynFlags</span><span>
</span><span id="line-1684"></span><span class="hs-comment">--       if dbg                -- In -dppr-debug style the output</span><span>
</span><span id="line-1685"></span><span class="hs-comment">--          then return empty  -- just becomes too voluminous</span><span>
</span><span id="line-1686"></span><span class="hs-comment">--          else go dbg 0 env ctxts</span><span>
</span><span id="line-1687"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Int -&gt; TidyEnv -&gt; [ErrCtxt] -&gt; TcRn SDoc
</span><a href="#local-6989586621682985205"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682985203"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">[ErrCtxt]
</span><a href="#local-6989586621682985204"><span class="hs-identifier hs-var">ctxts</span></a></span><span>
</span><span id="line-1688"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1689"></span><span>   </span><span class="annot"><a href="#local-6989586621682985205"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.ErrCtxt.html#ErrCtxt"><span class="hs-identifier hs-type">ErrCtxt</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-1690"></span><span>   </span><span id="local-6989586621682985205"><span class="annot"><span class="annottext">go :: Bool -&gt; Int -&gt; TidyEnv -&gt; [ErrCtxt] -&gt; TcRn SDoc
</span><a href="#local-6989586621682985205"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn SDoc
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-1691"></span><span>   </span><span class="annot"><a href="#local-6989586621682985205"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682985206"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682985206"><span class="hs-identifier hs-var">dbg</span></a></span></span><span> </span><span id="local-6989586621682985207"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682985207"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682985208"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682985208"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682985209"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682985209"><span class="hs-identifier hs-var">is_landmark</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682985210"><span class="annot"><span class="annottext">TidyEnv -&gt; ZonkM (TidyEnv, SDoc)
</span><a href="#local-6989586621682985210"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682985211"><span class="annot"><span class="annottext">[ErrCtxt]
</span><a href="#local-6989586621682985211"><span class="hs-identifier hs-var">ctxts</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1692"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682985209"><span class="hs-identifier hs-var">is_landmark</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682985207"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.Tc.Utils.Monad.html#mAX_CONTEXTS"><span class="hs-identifier hs-var">mAX_CONTEXTS</span></a></span><span> </span><span class="hs-comment">-- Too verbose || dbg</span><span>
</span><span id="line-1693"></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682985214"><span class="annot"><a href="#local-6989586621682985214"><span class="hs-identifier hs-var">env'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682985215"><span class="annot"><a href="#local-6989586621682985215"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkM (TidyEnv, SDoc) -&gt; TcM (TidyEnv, SDoc)
forall a. ZonkM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-var">liftZonkM</span></a></span><span> </span><span class="annot"><span class="annottext">(ZonkM (TidyEnv, SDoc) -&gt; TcM (TidyEnv, SDoc))
-&gt; ZonkM (TidyEnv, SDoc) -&gt; TcM (TidyEnv, SDoc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; ZonkM (TidyEnv, SDoc)
</span><a href="#local-6989586621682985210"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682985208"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-1694"></span><span>          </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682985216"><span class="annot"><a href="#local-6989586621682985216"><span class="hs-identifier hs-var hs-var">n'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682985209"><span class="hs-identifier hs-var">is_landmark</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682985207"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682985207"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1695"></span><span>          </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682985218"><span class="annot"><a href="#local-6989586621682985218"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682985205"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985206"><span class="hs-identifier hs-type">dbg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985216"><span class="hs-identifier hs-type">n'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985214"><span class="hs-identifier hs-type">env'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985211"><span class="hs-identifier hs-type">ctxts</span></a></span><span>
</span><span id="line-1696"></span><span>          </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682985215"><span class="hs-identifier hs-type">msg</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985218"><span class="hs-identifier hs-type">rest</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1697"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1698"></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Int -&gt; TidyEnv -&gt; [ErrCtxt] -&gt; TcRn SDoc
</span><a href="#local-6989586621682985205"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682985206"><span class="hs-identifier hs-var">dbg</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682985207"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682985208"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">[ErrCtxt]
</span><a href="#local-6989586621682985211"><span class="hs-identifier hs-var">ctxts</span></a></span><span>
</span><span id="line-1699"></span><span>
</span><span id="line-1700"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mAX_CONTEXTS"><span class="hs-identifier hs-type">mAX_CONTEXTS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>     </span><span class="hs-comment">-- No more than this number of non-landmark contexts</span><span>
</span><span id="line-1701"></span><span id="mAX_CONTEXTS"><span class="annot"><span class="annottext">mAX_CONTEXTS :: Int
</span><a href="GHC.Tc.Utils.Monad.html#mAX_CONTEXTS"><span class="hs-identifier hs-var hs-var">mAX_CONTEXTS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span>
</span><span id="line-1702"></span><span>
</span><span id="line-1703"></span><span class="hs-comment">-- debugTc is useful for monadic debugging code</span><span>
</span><span id="line-1704"></span><span>
</span><span id="line-1705"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#debugTc"><span class="hs-identifier hs-type">debugTc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1706"></span><span id="debugTc"><span class="annot"><span class="annottext">debugTc :: TcM () -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#debugTc"><span class="hs-identifier hs-var hs-var">debugTc</span></a></span></span><span> </span><span id="local-6989586621682985220"><span class="annot"><span class="annottext">TcM ()
</span><a href="#local-6989586621682985220"><span class="hs-identifier hs-var">thing</span></a></span></span><span>
</span><span id="line-1707"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Utils.Constants.html#debugIsOn"><span class="hs-identifier hs-var">debugIsOn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM ()
</span><a href="#local-6989586621682985220"><span class="hs-identifier hs-var">thing</span></a></span><span>
</span><span id="line-1708"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcM ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1709"></span><span>
</span><span id="line-1710"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
             Type constraints
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1717"></span><span>
</span><span id="line-1718"></span><span id="local-6989586621682983544"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addTopEvBinds"><span class="hs-identifier hs-type">addTopEvBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBind"><span class="hs-identifier hs-type">EvBind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983544"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983544"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1719"></span><span id="addTopEvBinds"><span class="annot"><span class="annottext">addTopEvBinds :: forall a. Bag EvBind -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addTopEvBinds"><span class="hs-identifier hs-var hs-var">addTopEvBinds</span></a></span></span><span> </span><span id="local-6989586621682985221"><span class="annot"><span class="annottext">Bag EvBind
</span><a href="#local-6989586621682985221"><span class="hs-identifier hs-var">new_ev_binds</span></a></span></span><span> </span><span id="local-6989586621682985222"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682985222"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1720"></span><span>  </span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">(TcGblEnv -&gt; TcGblEnv) -&gt; TcM a -&gt; TcM a
forall gbl lcl a.
(gbl -&gt; gbl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updGblEnv"><span class="hs-identifier hs-var">updGblEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; TcGblEnv
</span><a href="#local-6989586621682985223"><span class="hs-identifier hs-var">upd_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682985222"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1721"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1722"></span><span>    </span><span id="local-6989586621682985223"><span class="annot"><span class="annottext">upd_env :: TcGblEnv -&gt; TcGblEnv
</span><a href="#local-6989586621682985223"><span class="hs-identifier hs-var hs-var">upd_env</span></a></span></span><span> </span><span id="local-6989586621682985224"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682985224"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682985224"><span class="hs-identifier hs-var">tcg_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_ev_binds"><span class="hs-identifier hs-var">tcg_ev_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_ev_binds"><span class="hs-identifier hs-var">tcg_ev_binds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985224"><span class="hs-identifier hs-type">tcg_env</span></a></span><span>
</span><span id="line-1723"></span><span>                                               </span><span class="annot"><a href="GHC.Data.Bag.html#unionBags"><span class="hs-operator hs-type">`unionBags`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985221"><span class="hs-identifier hs-type">new_ev_binds</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1724"></span><span>
</span><span id="line-1725"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newTcEvBinds"><span class="hs-identifier hs-type">newTcEvBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span>
</span><span id="line-1726"></span><span id="newTcEvBinds"><span class="annot"><span class="annottext">newTcEvBinds :: TcM EvBindsVar
</span><a href="GHC.Tc.Utils.Monad.html#newTcEvBinds"><span class="hs-identifier hs-var hs-var">newTcEvBinds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985225"><span class="annot"><a href="#local-6989586621682985225"><span class="hs-identifier hs-var">binds_ref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EvBindMap -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TcRef EvBindMap)
forall (m :: * -&gt; *) a. MonadIO m =&gt; a -&gt; m (TcRef a)
</span><a href="GHC.Tc.Types.TcRef.html#newTcRef"><span class="hs-identifier hs-var">newTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindMap
</span><a href="GHC.Tc.Types.Evidence.html#emptyEvBindMap"><span class="hs-identifier hs-var">emptyEvBindMap</span></a></span><span>
</span><span id="line-1727"></span><span>                  </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682985227"><span class="annot"><a href="#local-6989586621682985227"><span class="hs-identifier hs-var">tcvs_ref</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#newTcRef"><span class="hs-identifier hs-type">newTcRef</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#emptyVarSet"><span class="hs-identifier hs-type">emptyVarSet</span></a></span><span>
</span><span id="line-1728"></span><span>                  </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682985229"><span class="annot"><a href="#local-6989586621682985229"><span class="hs-identifier hs-var">uniq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-type">newUnique</span></a></span><span>
</span><span id="line-1729"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;newTcEvBinds&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;unique =&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985229"><span class="hs-identifier hs-type">uniq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1730"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#ebv_binds"><span class="hs-identifier hs-var">ebv_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682985225"><span class="hs-identifier hs-type">binds_ref</span></a></span><span>
</span><span id="line-1731"></span><span>                                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#ebv_tcvs"><span class="hs-identifier hs-var">ebv_tcvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682985227"><span class="hs-identifier hs-type">tcvs_ref</span></a></span><span>
</span><span id="line-1732"></span><span>                                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#ebv_uniq"><span class="hs-identifier hs-var">ebv_uniq</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682985229"><span class="hs-identifier hs-type">uniq</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1733"></span><span>
</span><span id="line-1734"></span><span class="hs-comment">-- | Creates an EvBindsVar incapable of holding any bindings. It still</span><span>
</span><span id="line-1735"></span><span class="hs-comment">-- tracks covar usages (see comments on ebv_tcvs in &quot;GHC.Tc.Types.Evidence&quot;), thus</span><span>
</span><span id="line-1736"></span><span class="hs-comment">-- must be made monadically</span><span>
</span><span id="line-1737"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newNoTcEvBinds"><span class="hs-identifier hs-type">newNoTcEvBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span>
</span><span id="line-1738"></span><span id="newNoTcEvBinds"><span class="annot"><span class="annottext">newNoTcEvBinds :: TcM EvBindsVar
</span><a href="GHC.Tc.Utils.Monad.html#newNoTcEvBinds"><span class="hs-identifier hs-var hs-var">newNoTcEvBinds</span></a></span></span><span>
</span><span id="line-1739"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985235"><span class="annot"><a href="#local-6989586621682985235"><span class="hs-identifier hs-var">tcvs_ref</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TcRef VarSet)
forall (m :: * -&gt; *) a. MonadIO m =&gt; a -&gt; m (TcRef a)
</span><a href="GHC.Tc.Types.TcRef.html#newTcRef"><span class="hs-identifier hs-var">newTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="GHC.Types.Var.Set.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a></span><span>
</span><span id="line-1740"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682985236"><span class="annot"><a href="#local-6989586621682985236"><span class="hs-identifier hs-var">uniq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-type">newUnique</span></a></span><span>
</span><span id="line-1741"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;newNoTcEvBinds&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;unique =&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985236"><span class="hs-identifier hs-type">uniq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1742"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#CoEvBindsVar"><span class="hs-identifier hs-type">CoEvBindsVar</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#ebv_tcvs"><span class="hs-identifier hs-var">ebv_tcvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682985235"><span class="hs-identifier hs-type">tcvs_ref</span></a></span><span>
</span><span id="line-1743"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#ebv_uniq"><span class="hs-identifier hs-var">ebv_uniq</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682985236"><span class="hs-identifier hs-type">uniq</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1744"></span><span>
</span><span id="line-1745"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#cloneEvBindsVar"><span class="hs-identifier hs-type">cloneEvBindsVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span>
</span><span id="line-1746"></span><span class="hs-comment">-- Clone the refs, so that any binding created when</span><span>
</span><span id="line-1747"></span><span class="hs-comment">-- solving don't pollute the original</span><span>
</span><span id="line-1748"></span><span id="cloneEvBindsVar"><span class="annot"><span class="annottext">cloneEvBindsVar :: EvBindsVar -&gt; TcM EvBindsVar
</span><a href="GHC.Tc.Utils.Monad.html#cloneEvBindsVar"><span class="hs-identifier hs-var hs-var">cloneEvBindsVar</span></a></span></span><span> </span><span id="local-6989586621682985238"><span class="annot"><span class="annottext">ebv :: EvBindsVar
</span><a href="#local-6989586621682985238"><span class="hs-identifier hs-var">ebv</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1749"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985239"><span class="annot"><a href="#local-6989586621682985239"><span class="hs-identifier hs-var">binds_ref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EvBindMap -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TcRef EvBindMap)
forall (m :: * -&gt; *) a. MonadIO m =&gt; a -&gt; m (TcRef a)
</span><a href="GHC.Tc.Types.TcRef.html#newTcRef"><span class="hs-identifier hs-var">newTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindMap
</span><a href="GHC.Tc.Types.Evidence.html#emptyEvBindMap"><span class="hs-identifier hs-var">emptyEvBindMap</span></a></span><span>
</span><span id="line-1750"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682985240"><span class="annot"><a href="#local-6989586621682985240"><span class="hs-identifier hs-var">tcvs_ref</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#newTcRef"><span class="hs-identifier hs-type">newTcRef</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#emptyVarSet"><span class="hs-identifier hs-type">emptyVarSet</span></a></span><span>
</span><span id="line-1751"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682985238"><span class="hs-identifier hs-type">ebv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#ebv_binds"><span class="hs-identifier hs-var">ebv_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682985239"><span class="hs-identifier hs-type">binds_ref</span></a></span><span>
</span><span id="line-1752"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#ebv_tcvs"><span class="hs-identifier hs-var">ebv_tcvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682985240"><span class="hs-identifier hs-type">tcvs_ref</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1753"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#cloneEvBindsVar"><span class="hs-identifier hs-var">cloneEvBindsVar</span></a></span><span> </span><span id="local-6989586621682985241"><span class="annot"><span class="annottext">ebv :: EvBindsVar
</span><a href="#local-6989586621682985241"><span class="hs-identifier hs-var">ebv</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#CoEvBindsVar"><span class="hs-identifier hs-type">CoEvBindsVar</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1754"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985242"><span class="annot"><a href="#local-6989586621682985242"><span class="hs-identifier hs-var">tcvs_ref</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TcRef VarSet)
forall (m :: * -&gt; *) a. MonadIO m =&gt; a -&gt; m (TcRef a)
</span><a href="GHC.Tc.Types.TcRef.html#newTcRef"><span class="hs-identifier hs-var">newTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="GHC.Types.Var.Set.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a></span><span>
</span><span id="line-1755"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682985241"><span class="hs-identifier hs-type">ebv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#ebv_tcvs"><span class="hs-identifier hs-var">ebv_tcvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682985242"><span class="hs-identifier hs-type">tcvs_ref</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1756"></span><span>
</span><span id="line-1757"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getTcEvTyCoVars"><span class="hs-identifier hs-type">getTcEvTyCoVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#TyCoVarSet"><span class="hs-identifier hs-type">TyCoVarSet</span></a></span><span>
</span><span id="line-1758"></span><span id="getTcEvTyCoVars"><span class="annot"><span class="annottext">getTcEvTyCoVars :: EvBindsVar -&gt; TcM VarSet
</span><a href="GHC.Tc.Utils.Monad.html#getTcEvTyCoVars"><span class="hs-identifier hs-var hs-var">getTcEvTyCoVars</span></a></span></span><span> </span><span id="local-6989586621682985244"><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621682985244"><span class="hs-identifier hs-var">ev_binds_var</span></a></span></span><span>
</span><span id="line-1759"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRef VarSet -&gt; TcM VarSet
forall (m :: * -&gt; *) a. MonadIO m =&gt; TcRef a -&gt; m a
</span><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvBindsVar -&gt; TcRef VarSet
</span><a href="GHC.Tc.Types.Evidence.html#ebv_tcvs"><span class="hs-identifier hs-var">ebv_tcvs</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621682985244"><span class="hs-identifier hs-var">ev_binds_var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1760"></span><span>
</span><span id="line-1761"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getTcEvBindsMap"><span class="hs-identifier hs-type">getTcEvBindsMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindMap"><span class="hs-identifier hs-type">EvBindMap</span></a></span><span>
</span><span id="line-1762"></span><span id="getTcEvBindsMap"><span class="annot"><span class="annottext">getTcEvBindsMap :: EvBindsVar -&gt; TcM EvBindMap
</span><a href="GHC.Tc.Utils.Monad.html#getTcEvBindsMap"><span class="hs-identifier hs-var hs-var">getTcEvBindsMap</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ebv_binds :: EvBindsVar -&gt; TcRef EvBindMap
</span><a href="GHC.Tc.Types.Evidence.html#ebv_binds"><span class="hs-identifier hs-var">ebv_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682985245"><span class="annot"><span class="annottext">TcRef EvBindMap
</span><a href="#local-6989586621682985245"><span class="hs-identifier hs-var">ev_ref</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1763"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRef EvBindMap -&gt; TcM EvBindMap
forall (m :: * -&gt; *) a. MonadIO m =&gt; TcRef a -&gt; m a
</span><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef EvBindMap
</span><a href="#local-6989586621682985245"><span class="hs-identifier hs-var">ev_ref</span></a></span><span>
</span><span id="line-1764"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getTcEvBindsMap"><span class="hs-identifier hs-var">getTcEvBindsMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#CoEvBindsVar"><span class="hs-identifier hs-type">CoEvBindsVar</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1765"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvBindMap -&gt; TcM EvBindMap
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">EvBindMap
</span><a href="GHC.Tc.Types.Evidence.html#emptyEvBindMap"><span class="hs-identifier hs-var">emptyEvBindMap</span></a></span><span>
</span><span id="line-1766"></span><span>
</span><span id="line-1767"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setTcEvBindsMap"><span class="hs-identifier hs-type">setTcEvBindsMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindMap"><span class="hs-identifier hs-type">EvBindMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1768"></span><span id="setTcEvBindsMap"><span class="annot"><span class="annottext">setTcEvBindsMap :: EvBindsVar -&gt; EvBindMap -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#setTcEvBindsMap"><span class="hs-identifier hs-var hs-var">setTcEvBindsMap</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ebv_binds :: EvBindsVar -&gt; TcRef EvBindMap
</span><a href="GHC.Tc.Types.Evidence.html#ebv_binds"><span class="hs-identifier hs-var">ebv_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682985246"><span class="annot"><span class="annottext">TcRef EvBindMap
</span><a href="#local-6989586621682985246"><span class="hs-identifier hs-var">ev_ref</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682985247"><span class="annot"><span class="annottext">EvBindMap
</span><a href="#local-6989586621682985247"><span class="hs-identifier hs-var">binds</span></a></span></span><span>
</span><span id="line-1769"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRef EvBindMap -&gt; EvBindMap -&gt; TcM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; TcRef a -&gt; a -&gt; m ()
</span><a href="GHC.Tc.Types.TcRef.html#writeTcRef"><span class="hs-identifier hs-var">writeTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef EvBindMap
</span><a href="#local-6989586621682985246"><span class="hs-identifier hs-var">ev_ref</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindMap
</span><a href="#local-6989586621682985247"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-1770"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setTcEvBindsMap"><span class="hs-identifier hs-var">setTcEvBindsMap</span></a></span><span> </span><span id="local-6989586621682985248"><span class="annot"><span class="annottext">v :: EvBindsVar
</span><a href="#local-6989586621682985248"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#CoEvBindsVar"><span class="hs-identifier hs-type">CoEvBindsVar</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682985249"><span class="annot"><span class="annottext">EvBindMap
</span><a href="#local-6989586621682985249"><span class="hs-identifier hs-var">ev_binds</span></a></span></span><span>
</span><span id="line-1771"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">EvBindMap -&gt; Bool
</span><a href="GHC.Tc.Types.Evidence.html#isEmptyEvBindMap"><span class="hs-identifier hs-var">isEmptyEvBindMap</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindMap
</span><a href="#local-6989586621682985249"><span class="hs-identifier hs-var">ev_binds</span></a></span><span>
</span><span id="line-1772"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcM ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1773"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1774"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc -&gt; TcM ()
forall a. HasCallStack =&gt; FilePath -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;setTcEvBindsMap&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvBindsVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621682985248"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindMap -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindMap
</span><a href="#local-6989586621682985249"><span class="hs-identifier hs-var">ev_binds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1775"></span><span>
</span><span id="line-1776"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addTcEvBind"><span class="hs-identifier hs-type">addTcEvBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBind"><span class="hs-identifier hs-type">EvBind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1777"></span><span class="hs-comment">-- Add a binding to the TcEvBinds by side effect</span><span>
</span><span id="line-1778"></span><span id="addTcEvBind"><span class="annot"><span class="annottext">addTcEvBind :: EvBindsVar -&gt; EvBind -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addTcEvBind"><span class="hs-identifier hs-var hs-var">addTcEvBind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ebv_binds :: EvBindsVar -&gt; TcRef EvBindMap
</span><a href="GHC.Tc.Types.Evidence.html#ebv_binds"><span class="hs-identifier hs-var">ebv_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682985251"><span class="annot"><span class="annottext">TcRef EvBindMap
</span><a href="#local-6989586621682985251"><span class="hs-identifier hs-var">ev_ref</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ebv_uniq :: EvBindsVar -&gt; Unique
</span><a href="GHC.Tc.Types.Evidence.html#ebv_uniq"><span class="hs-identifier hs-var">ebv_uniq</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682985252"><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682985252"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682985253"><span class="annot"><span class="annottext">EvBind
</span><a href="#local-6989586621682985253"><span class="hs-identifier hs-var">ev_bind</span></a></span></span><span>
</span><span id="line-1779"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;addTcEvBind&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcM ()) -&gt; SDoc -&gt; TcM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Unique -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682985252"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-1780"></span><span>                                 </span><span class="annot"><span class="annottext">EvBind -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">EvBind
</span><a href="#local-6989586621682985253"><span class="hs-identifier hs-var">ev_bind</span></a></span><span>
</span><span id="line-1781"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682985254"><span class="annot"><a href="#local-6989586621682985254"><span class="hs-identifier hs-var">bnds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRef EvBindMap -&gt; TcM EvBindMap
forall (m :: * -&gt; *) a. MonadIO m =&gt; TcRef a -&gt; m a
</span><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef EvBindMap
</span><a href="#local-6989586621682985251"><span class="hs-identifier hs-var">ev_ref</span></a></span><span>
</span><span id="line-1782"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#writeTcRef"><span class="hs-identifier hs-type">writeTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985251"><span class="hs-identifier hs-type">ev_ref</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#extendEvBinds"><span class="hs-identifier hs-type">extendEvBinds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985254"><span class="hs-identifier hs-type">bnds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985253"><span class="hs-identifier hs-type">ev_bind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1783"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addTcEvBind"><span class="hs-identifier hs-var">addTcEvBind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#CoEvBindsVar"><span class="hs-identifier hs-type">CoEvBindsVar</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ebv_uniq :: EvBindsVar -&gt; Unique
</span><a href="GHC.Tc.Types.Evidence.html#ebv_uniq"><span class="hs-identifier hs-var">ebv_uniq</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682985256"><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682985256"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682985257"><span class="annot"><span class="annottext">EvBind
</span><a href="#local-6989586621682985257"><span class="hs-identifier hs-var">ev_bind</span></a></span></span><span>
</span><span id="line-1784"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc -&gt; TcM ()
forall a. HasCallStack =&gt; FilePath -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;addTcEvBind CoEvBindsVar&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvBind -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">EvBind
</span><a href="#local-6989586621682985257"><span class="hs-identifier hs-var">ev_bind</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Unique -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682985256"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1785"></span><span>
</span><span id="line-1786"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#chooseUniqueOccTc"><span class="hs-identifier hs-type">chooseUniqueOccTc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#OccSet"><span class="hs-identifier hs-type">OccSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#OccName"><span class="hs-identifier hs-type">OccName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#OccName"><span class="hs-identifier hs-type">OccName</span></a></span><span>
</span><span id="line-1787"></span><span id="chooseUniqueOccTc"><span class="annot"><span class="annottext">chooseUniqueOccTc :: (OccSet -&gt; OccName) -&gt; TcM OccName
</span><a href="GHC.Tc.Utils.Monad.html#chooseUniqueOccTc"><span class="hs-identifier hs-var hs-var">chooseUniqueOccTc</span></a></span></span><span> </span><span id="local-6989586621682985258"><span class="annot"><span class="annottext">OccSet -&gt; OccName
</span><a href="#local-6989586621682985258"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1788"></span><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985259"><span class="annot"><a href="#local-6989586621682985259"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-1789"></span><span>     </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682985260"><span class="annot"><a href="#local-6989586621682985260"><span class="hs-identifier hs-var hs-var">dfun_n_var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; IORef OccSet
</span><a href="GHC.Tc.Types.html#tcg_dfun_n"><span class="hs-identifier hs-var">tcg_dfun_n</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682985259"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-1790"></span><span>     </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682985261"><span class="annot"><a href="#local-6989586621682985261"><span class="hs-identifier hs-var">set</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-type">readTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985260"><span class="hs-identifier hs-type">dfun_n_var</span></a></span><span>
</span><span id="line-1791"></span><span>     </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682985262"><span class="annot"><a href="#local-6989586621682985262"><span class="hs-identifier hs-var hs-var">occ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccSet -&gt; OccName
</span><a href="#local-6989586621682985258"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">OccSet
</span><a href="#local-6989586621682985261"><span class="hs-identifier hs-var">set</span></a></span><span>
</span><span id="line-1792"></span><span>     </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#writeTcRef"><span class="hs-identifier hs-type">writeTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985260"><span class="hs-identifier hs-type">dfun_n_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#extendOccSet"><span class="hs-identifier hs-type">extendOccSet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985261"><span class="hs-identifier hs-type">set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985262"><span class="hs-identifier hs-type">occ</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1793"></span><span>     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682985262"><span class="hs-identifier hs-type">occ</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1794"></span><span>
</span><span id="line-1795"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newZonkAnyType"><span class="hs-identifier hs-type">newZonkAnyType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-1796"></span><span class="hs-comment">-- Return a type (ZonkAny @k n), where n is fresh</span><span>
</span><span id="line-1797"></span><span class="hs-comment">-- Recall  ZonkAny :: forall k. Natural -&gt; k</span><span>
</span><span id="line-1798"></span><span class="hs-comment">-- See Note [Any types] in GHC.Builtin.Types, wrinkle (Any4)</span><span>
</span><span id="line-1799"></span><span id="newZonkAnyType"><span class="annot"><span class="annottext">newZonkAnyType :: Mult -&gt; TcM Mult
</span><a href="GHC.Tc.Utils.Monad.html#newZonkAnyType"><span class="hs-identifier hs-var hs-var">newZonkAnyType</span></a></span></span><span> </span><span id="local-6989586621682985266"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682985266"><span class="hs-identifier hs-var">kind</span></a></span></span><span>
</span><span id="line-1800"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985267"><span class="annot"><a href="#local-6989586621682985267"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-1801"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682985268"><span class="annot"><a href="#local-6989586621682985268"><span class="hs-identifier hs-var hs-var">zany_n_var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; IORef Integer
</span><a href="GHC.Tc.Types.html#tcg_zany_n"><span class="hs-identifier hs-var">tcg_zany_n</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682985267"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-1802"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682985269"><span class="annot"><a href="#local-6989586621682985269"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-type">readTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985268"><span class="hs-identifier hs-type">zany_n_var</span></a></span><span>
</span><span id="line-1803"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682985270"><span class="annot"><a href="#local-6989586621682985270"><span class="hs-identifier hs-var hs-var">i2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682985269"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1804"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#writeTcRef"><span class="hs-identifier hs-type">writeTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985268"><span class="hs-identifier hs-type">zany_n_var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985270"><span class="hs-identifier hs-type">i2</span></a></span><span>
</span><span id="line-1805"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-type">mkTyConApp</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#zonkAnyTyCon"><span class="hs-identifier hs-type">zonkAnyTyCon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682985266"><span class="hs-identifier hs-type">kind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Type.html#mkNumLitTy"><span class="hs-identifier hs-type">mkNumLitTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985269"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1806"></span><span>
</span><span id="line-1807"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getConstraintVar"><span class="hs-identifier hs-type">getConstraintVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1808"></span><span id="getConstraintVar"><span class="annot"><span class="annottext">getConstraintVar :: IOEnv (Env TcGblEnv TcLclEnv) (IORef WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#getConstraintVar"><span class="hs-identifier hs-var hs-var">getConstraintVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985272"><span class="annot"><a href="#local-6989586621682985272"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#tcl_lie"><span class="hs-identifier hs-var">tcl_lie</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985272"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1809"></span><span>
</span><span id="line-1810"></span><span id="local-6989586621682983547"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setConstraintVar"><span class="hs-identifier hs-type">setConstraintVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983547"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983547"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1811"></span><span id="setConstraintVar"><span class="annot"><span class="annottext">setConstraintVar :: forall a. IORef WantedConstraints -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setConstraintVar"><span class="hs-identifier hs-var hs-var">setConstraintVar</span></a></span></span><span> </span><span id="local-6989586621682985273"><span class="annot"><span class="annottext">IORef WantedConstraints
</span><a href="#local-6989586621682985273"><span class="hs-identifier hs-var">lie_var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcLclEnv -&gt; TcLclEnv)
-&gt; TcRnIf TcGblEnv TcLclEnv a -&gt; TcRnIf TcGblEnv TcLclEnv a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682985274"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682985274"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682985274"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#tcl_lie"><span class="hs-identifier hs-var">tcl_lie</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682985273"><span class="hs-identifier hs-type">lie_var</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1812"></span><span>
</span><span id="line-1813"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitStaticConstraints"><span class="hs-identifier hs-type">emitStaticConstraints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1814"></span><span id="emitStaticConstraints"><span class="annot"><span class="annottext">emitStaticConstraints :: WantedConstraints -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#emitStaticConstraints"><span class="hs-identifier hs-var hs-var">emitStaticConstraints</span></a></span></span><span> </span><span id="local-6989586621682985275"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621682985275"><span class="hs-identifier hs-var">static_lie</span></a></span></span><span>
</span><span id="line-1815"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985276"><span class="annot"><a href="#local-6989586621682985276"><span class="hs-identifier hs-var">gbl_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-1816"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#updTcRef"><span class="hs-identifier hs-type">updTcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#tcg_static_wc"><span class="hs-identifier hs-var">tcg_static_wc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985276"><span class="hs-identifier hs-type">gbl_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">`andWC`</span></span><span> </span><span class="annot"><span class="hs-identifier">static_lie</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1817"></span><span>
</span><span id="line-1818"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitConstraints"><span class="hs-identifier hs-type">emitConstraints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1819"></span><span id="emitConstraints"><span class="annot"><span class="annottext">emitConstraints :: WantedConstraints -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#emitConstraints"><span class="hs-identifier hs-var hs-var">emitConstraints</span></a></span></span><span> </span><span id="local-6989586621682985278"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621682985278"><span class="hs-identifier hs-var">ct</span></a></span></span><span>
</span><span id="line-1820"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">WantedConstraints -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#isEmptyWC"><span class="hs-identifier hs-var">isEmptyWC</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621682985278"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-1821"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcM ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1822"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1823"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985279"><span class="annot"><a href="#local-6989586621682985279"><span class="hs-identifier hs-var">lie_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) (IORef WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#getConstraintVar"><span class="hs-identifier hs-var">getConstraintVar</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1824"></span><span>         </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#updTcRef"><span class="hs-identifier hs-type">updTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985279"><span class="hs-identifier hs-type">lie_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">`andWC`</span></span><span> </span><span class="annot"><span class="hs-identifier">ct</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1825"></span><span>
</span><span id="line-1826"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitSimple"><span class="hs-identifier hs-type">emitSimple</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1827"></span><span id="emitSimple"><span class="annot"><span class="annottext">emitSimple :: Ct -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#emitSimple"><span class="hs-identifier hs-var hs-var">emitSimple</span></a></span></span><span> </span><span id="local-6989586621682985280"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621682985280"><span class="hs-identifier hs-var">ct</span></a></span></span><span>
</span><span id="line-1828"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985281"><span class="annot"><a href="#local-6989586621682985281"><span class="hs-identifier hs-var">lie_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) (IORef WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#getConstraintVar"><span class="hs-identifier hs-var">getConstraintVar</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1829"></span><span>         </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#updTcRef"><span class="hs-identifier hs-type">updTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985281"><span class="hs-identifier hs-type">lie_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">`addSimples`</span></span><span> </span><span class="annot"><span class="hs-identifier">unitBag</span></span><span> </span><span class="annot"><span class="hs-identifier">ct</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1830"></span><span>
</span><span id="line-1831"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitSimples"><span class="hs-identifier hs-type">emitSimples</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1832"></span><span id="emitSimples"><span class="annot"><span class="annottext">emitSimples :: Bag Ct -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#emitSimples"><span class="hs-identifier hs-var hs-var">emitSimples</span></a></span></span><span> </span><span id="local-6989586621682985285"><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621682985285"><span class="hs-identifier hs-var">cts</span></a></span></span><span>
</span><span id="line-1833"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985286"><span class="annot"><a href="#local-6989586621682985286"><span class="hs-identifier hs-var">lie_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) (IORef WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#getConstraintVar"><span class="hs-identifier hs-var">getConstraintVar</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1834"></span><span>         </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#updTcRef"><span class="hs-identifier hs-type">updTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985286"><span class="hs-identifier hs-type">lie_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">`addSimples`</span></span><span> </span><span class="annot"><span class="hs-identifier">cts</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1835"></span><span>
</span><span id="line-1836"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitImplication"><span class="hs-identifier hs-type">emitImplication</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Implication"><span class="hs-identifier hs-type">Implication</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1837"></span><span id="emitImplication"><span class="annot"><span class="annottext">emitImplication :: Implication -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#emitImplication"><span class="hs-identifier hs-var hs-var">emitImplication</span></a></span></span><span> </span><span id="local-6989586621682985287"><span class="annot"><span class="annottext">Implication
</span><a href="#local-6989586621682985287"><span class="hs-identifier hs-var">ct</span></a></span></span><span>
</span><span id="line-1838"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985288"><span class="annot"><a href="#local-6989586621682985288"><span class="hs-identifier hs-var">lie_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) (IORef WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#getConstraintVar"><span class="hs-identifier hs-var">getConstraintVar</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1839"></span><span>         </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#updTcRef"><span class="hs-identifier hs-type">updTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985288"><span class="hs-identifier hs-type">lie_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">`addImplics`</span></span><span> </span><span class="annot"><span class="hs-identifier">unitBag</span></span><span> </span><span class="annot"><span class="hs-identifier">ct</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1840"></span><span>
</span><span id="line-1841"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitImplications"><span class="hs-identifier hs-type">emitImplications</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Implication"><span class="hs-identifier hs-type">Implication</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1842"></span><span id="emitImplications"><span class="annot"><span class="annottext">emitImplications :: Bag Implication -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#emitImplications"><span class="hs-identifier hs-var hs-var">emitImplications</span></a></span></span><span> </span><span id="local-6989586621682985290"><span class="annot"><span class="annottext">Bag Implication
</span><a href="#local-6989586621682985290"><span class="hs-identifier hs-var">ct</span></a></span></span><span>
</span><span id="line-1843"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcM () -&gt; TcM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bag Implication -&gt; Bool
forall a. Bag a -&gt; Bool
</span><a href="GHC.Data.Bag.html#isEmptyBag"><span class="hs-identifier hs-var">isEmptyBag</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Implication
</span><a href="#local-6989586621682985290"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM () -&gt; TcM ()) -&gt; TcM () -&gt; TcM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1844"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985292"><span class="annot"><a href="#local-6989586621682985292"><span class="hs-identifier hs-var">lie_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) (IORef WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#getConstraintVar"><span class="hs-identifier hs-var">getConstraintVar</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1845"></span><span>         </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#updTcRef"><span class="hs-identifier hs-type">updTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985292"><span class="hs-identifier hs-type">lie_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">`addImplics`</span></span><span> </span><span class="annot"><span class="hs-identifier">ct</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1846"></span><span>
</span><span id="line-1847"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitDelayedErrors"><span class="hs-identifier hs-type">emitDelayedErrors</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DelayedError"><span class="hs-identifier hs-type">DelayedError</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1848"></span><span id="emitDelayedErrors"><span class="annot"><span class="annottext">emitDelayedErrors :: Bag DelayedError -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#emitDelayedErrors"><span class="hs-identifier hs-var hs-var">emitDelayedErrors</span></a></span></span><span> </span><span id="local-6989586621682985293"><span class="annot"><span class="annottext">Bag DelayedError
</span><a href="#local-6989586621682985293"><span class="hs-identifier hs-var">errs</span></a></span></span><span>
</span><span id="line-1849"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;emitDelayedErrors&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bag DelayedError -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Bag DelayedError
</span><a href="#local-6989586621682985293"><span class="hs-identifier hs-var">errs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1850"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682985294"><span class="annot"><a href="#local-6989586621682985294"><span class="hs-identifier hs-var">lie_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) (IORef WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#getConstraintVar"><span class="hs-identifier hs-var">getConstraintVar</span></a></span><span>
</span><span id="line-1851"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#updTcRef"><span class="hs-identifier hs-type">updTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985294"><span class="hs-identifier hs-type">lie_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">`addDelayedErrors`</span></span><span> </span><span class="annot"><span class="hs-identifier">errs</span></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-1852"></span><span>
</span><span id="line-1853"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitHole"><span class="hs-identifier hs-type">emitHole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Hole"><span class="hs-identifier hs-type">Hole</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1854"></span><span id="emitHole"><span class="annot"><span class="annottext">emitHole :: Hole -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#emitHole"><span class="hs-identifier hs-var hs-var">emitHole</span></a></span></span><span> </span><span id="local-6989586621682985296"><span class="annot"><span class="annottext">Hole
</span><a href="#local-6989586621682985296"><span class="hs-identifier hs-var">hole</span></a></span></span><span>
</span><span id="line-1855"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;emitHole&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hole -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Hole
</span><a href="#local-6989586621682985296"><span class="hs-identifier hs-var">hole</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1856"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682985297"><span class="annot"><a href="#local-6989586621682985297"><span class="hs-identifier hs-var">lie_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) (IORef WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#getConstraintVar"><span class="hs-identifier hs-var">getConstraintVar</span></a></span><span>
</span><span id="line-1857"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#updTcRef"><span class="hs-identifier hs-type">updTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985297"><span class="hs-identifier hs-type">lie_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">`addHoles`</span></span><span> </span><span class="annot"><span class="hs-identifier">unitBag</span></span><span> </span><span class="annot"><span class="hs-identifier">hole</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1858"></span><span>
</span><span id="line-1859"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitHoles"><span class="hs-identifier hs-type">emitHoles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Hole"><span class="hs-identifier hs-type">Hole</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1860"></span><span id="emitHoles"><span class="annot"><span class="annottext">emitHoles :: Bag Hole -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#emitHoles"><span class="hs-identifier hs-var hs-var">emitHoles</span></a></span></span><span> </span><span id="local-6989586621682985299"><span class="annot"><span class="annottext">Bag Hole
</span><a href="#local-6989586621682985299"><span class="hs-identifier hs-var">holes</span></a></span></span><span>
</span><span id="line-1861"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;emitHoles&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bag Hole -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Hole
</span><a href="#local-6989586621682985299"><span class="hs-identifier hs-var">holes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1862"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682985300"><span class="annot"><a href="#local-6989586621682985300"><span class="hs-identifier hs-var">lie_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) (IORef WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#getConstraintVar"><span class="hs-identifier hs-var">getConstraintVar</span></a></span><span>
</span><span id="line-1863"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#updTcRef"><span class="hs-identifier hs-type">updTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985300"><span class="hs-identifier hs-type">lie_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">`addHoles`</span></span><span> </span><span class="annot"><span class="hs-identifier">holes</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1864"></span><span>
</span><span id="line-1865"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitNotConcreteError"><span class="hs-identifier hs-type">emitNotConcreteError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#NotConcreteError"><span class="hs-identifier hs-type">NotConcreteError</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1866"></span><span id="emitNotConcreteError"><span class="annot"><span class="annottext">emitNotConcreteError :: NotConcreteError -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#emitNotConcreteError"><span class="hs-identifier hs-var hs-var">emitNotConcreteError</span></a></span></span><span> </span><span id="local-6989586621682985301"><span class="annot"><span class="annottext">NotConcreteError
</span><a href="#local-6989586621682985301"><span class="hs-identifier hs-var">err</span></a></span></span><span>
</span><span id="line-1867"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;emitNotConcreteError&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NotConcreteError -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">NotConcreteError
</span><a href="#local-6989586621682985301"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1868"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682985302"><span class="annot"><a href="#local-6989586621682985302"><span class="hs-identifier hs-var">lie_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) (IORef WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#getConstraintVar"><span class="hs-identifier hs-var">getConstraintVar</span></a></span><span>
</span><span id="line-1869"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#updTcRef"><span class="hs-identifier hs-type">updTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985302"><span class="hs-identifier hs-type">lie_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">`addNotConcreteError`</span></span><span> </span><span class="annot"><span class="hs-identifier">err</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1870"></span><span>
</span><span id="line-1871"></span><span class="annot"><span class="hs-comment">-- | Throw out any constraints emitted by the thing_inside</span></span><span>
</span><span id="line-1872"></span><span id="local-6989586621682985304"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#discardConstraints"><span class="hs-identifier hs-type">discardConstraints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985304"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985304"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1873"></span><span id="discardConstraints"><span class="annot"><span class="annottext">discardConstraints :: forall a. TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#discardConstraints"><span class="hs-identifier hs-var hs-var">discardConstraints</span></a></span></span><span> </span><span id="local-6989586621682985306"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682985306"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a, WantedConstraints) -&gt; a
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((a, WantedConstraints) -&gt; a)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (a, WantedConstraints) -&gt; TcM a
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TcM a -&gt; IOEnv (Env TcGblEnv TcLclEnv) (a, WantedConstraints)
forall r. TcM r -&gt; TcM (r, WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#captureConstraints"><span class="hs-identifier hs-var">captureConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682985306"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1874"></span><span>
</span><span id="line-1875"></span><span class="annot"><span class="hs-comment">-- | The name says it all. The returned TcLevel is the *inner* TcLevel.</span></span><span>
</span><span id="line-1876"></span><span id="local-6989586621682983556"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#pushLevelAndCaptureConstraints"><span class="hs-identifier hs-type">pushLevelAndCaptureConstraints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983556"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682983556"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1877"></span><span id="pushLevelAndCaptureConstraints"><span class="annot"><span class="annottext">pushLevelAndCaptureConstraints :: forall a. TcM a -&gt; TcM (TcLevel, WantedConstraints, a)
</span><a href="GHC.Tc.Utils.Monad.html#pushLevelAndCaptureConstraints"><span class="hs-identifier hs-var hs-var">pushLevelAndCaptureConstraints</span></a></span></span><span> </span><span id="local-6989586621682985316"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682985316"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1878"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985317"><span class="annot"><a href="#local-6989586621682985317"><span class="hs-identifier hs-var">tclvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TcLevel
</span><a href="GHC.Tc.Utils.Monad.html#getTcLevel"><span class="hs-identifier hs-var">getTcLevel</span></a></span><span>
</span><span id="line-1879"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682985318"><span class="annot"><a href="#local-6989586621682985318"><span class="hs-identifier hs-var hs-var">tclvl'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; TcLevel
</span><a href="GHC.Tc.Utils.TcType.html#pushTcLevel"><span class="hs-identifier hs-var">pushTcLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682985317"><span class="hs-identifier hs-var">tclvl</span></a></span><span>
</span><span id="line-1880"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;pushLevelAndCaptureConstraints {&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985318"><span class="hs-identifier hs-type">tclvl'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1881"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682985320"><span class="annot"><a href="#local-6989586621682985320"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682985321"><span class="annot"><a href="#local-6989586621682985321"><span class="hs-identifier hs-var">lie</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-type">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#setLclEnvTcLevel"><span class="hs-identifier hs-type">setLclEnvTcLevel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985318"><span class="hs-identifier hs-type">tclvl'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1882"></span><span>                       </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#captureConstraints"><span class="hs-identifier hs-type">captureConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985316"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-1883"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;pushLevelAndCaptureConstraints }&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985318"><span class="hs-identifier hs-type">tclvl'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1884"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682985318"><span class="hs-identifier hs-type">tclvl'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682985321"><span class="hs-identifier hs-type">lie</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682985320"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1885"></span><span>
</span><span id="line-1886"></span><span id="local-6989586621682985323"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#pushTcLevelM_"><span class="hs-identifier hs-type">pushTcLevelM_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985323"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985323"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1887"></span><span id="pushTcLevelM_"><span class="annot"><span class="annottext">pushTcLevelM_ :: forall a. TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#pushTcLevelM_"><span class="hs-identifier hs-var hs-var">pushTcLevelM_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcLclEnv -&gt; TcLclEnv)
-&gt; TcRnIf TcGblEnv TcLclEnv a -&gt; TcRnIf TcGblEnv TcLclEnv a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TcLevel -&gt; TcLevel) -&gt; TcLclEnv -&gt; TcLclEnv
</span><a href="GHC.Tc.Types.LclEnv.html#modifyLclEnvTcLevel"><span class="hs-identifier hs-var">modifyLclEnvTcLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; TcLevel
</span><a href="GHC.Tc.Utils.TcType.html#pushTcLevel"><span class="hs-identifier hs-var">pushTcLevel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1888"></span><span>
</span><span id="line-1889"></span><span id="local-6989586621682983559"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#pushTcLevelM"><span class="hs-identifier hs-type">pushTcLevelM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983559"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682983559"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1890"></span><span class="hs-comment">-- See Note [TcLevel assignment] in GHC.Tc.Utils.TcType</span><span>
</span><span id="line-1891"></span><span id="pushTcLevelM"><span class="annot"><span class="annottext">pushTcLevelM :: forall a. TcM a -&gt; TcM (TcLevel, a)
</span><a href="GHC.Tc.Utils.Monad.html#pushTcLevelM"><span class="hs-identifier hs-var hs-var">pushTcLevelM</span></a></span></span><span> </span><span id="local-6989586621682985328"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682985328"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1892"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985329"><span class="annot"><a href="#local-6989586621682985329"><span class="hs-identifier hs-var">tclvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TcLevel
</span><a href="GHC.Tc.Utils.Monad.html#getTcLevel"><span class="hs-identifier hs-var">getTcLevel</span></a></span><span>
</span><span id="line-1893"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682985330"><span class="annot"><a href="#local-6989586621682985330"><span class="hs-identifier hs-var hs-var">tclvl'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; TcLevel
</span><a href="GHC.Tc.Utils.TcType.html#pushTcLevel"><span class="hs-identifier hs-var">pushTcLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682985329"><span class="hs-identifier hs-var">tclvl</span></a></span><span>
</span><span id="line-1894"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682985331"><span class="annot"><a href="#local-6989586621682985331"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-type">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#setLclEnvTcLevel"><span class="hs-identifier hs-type">setLclEnvTcLevel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985330"><span class="hs-identifier hs-type">tclvl'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682985328"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-1895"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682985330"><span class="hs-identifier hs-type">tclvl'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682985331"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1896"></span><span>
</span><span id="line-1897"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getTcLevel"><span class="hs-identifier hs-type">getTcLevel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span>
</span><span id="line-1898"></span><span id="getTcLevel"><span class="annot"><span class="annottext">getTcLevel :: TcM TcLevel
</span><a href="GHC.Tc.Utils.Monad.html#getTcLevel"><span class="hs-identifier hs-var hs-var">getTcLevel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985332"><span class="annot"><a href="#local-6989586621682985332"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span>
</span><span id="line-1899"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$!</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#getLclEnvTcLevel"><span class="hs-identifier hs-type">getLclEnvTcLevel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985332"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1900"></span><span>
</span><span id="line-1901"></span><span id="local-6989586621682983561"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setTcLevel"><span class="hs-identifier hs-type">setTcLevel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983561"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983561"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1902"></span><span id="setTcLevel"><span class="annot"><span class="annottext">setTcLevel :: forall a. TcLevel -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setTcLevel"><span class="hs-identifier hs-var hs-var">setTcLevel</span></a></span></span><span> </span><span id="local-6989586621682985333"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682985333"><span class="hs-identifier hs-var">tclvl</span></a></span></span><span> </span><span id="local-6989586621682985334"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682985334"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1903"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcLclEnv -&gt; TcLclEnv) -&gt; TcM a -&gt; TcM a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLevel -&gt; TcLclEnv -&gt; TcLclEnv
</span><a href="GHC.Tc.Types.LclEnv.html#setLclEnvTcLevel"><span class="hs-identifier hs-var">setLclEnvTcLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682985333"><span class="hs-identifier hs-var">tclvl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682985334"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1904"></span><span>
</span><span id="line-1905"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#isTouchableTcM"><span class="hs-identifier hs-type">isTouchableTcM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1906"></span><span id="isTouchableTcM"><span class="annot"><span class="annottext">isTouchableTcM :: Id -&gt; TcRn Bool
</span><a href="GHC.Tc.Utils.Monad.html#isTouchableTcM"><span class="hs-identifier hs-var hs-var">isTouchableTcM</span></a></span></span><span> </span><span id="local-6989586621682985336"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682985336"><span class="hs-identifier hs-var">tv</span></a></span></span><span>
</span><span id="line-1907"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985337"><span class="annot"><a href="#local-6989586621682985337"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TcLevel
</span><a href="GHC.Tc.Utils.Monad.html#getTcLevel"><span class="hs-identifier hs-var">getTcLevel</span></a></span><span>
</span><span id="line-1908"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#isTouchableMetaTyVar"><span class="hs-identifier hs-type">isTouchableMetaTyVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985337"><span class="hs-identifier hs-type">lvl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985336"><span class="hs-identifier hs-type">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1909"></span><span>
</span><span id="line-1910"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getLclTypeEnv"><span class="hs-identifier hs-type">getLclTypeEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#TcTypeEnv"><span class="hs-identifier hs-type">TcTypeEnv</span></a></span><span>
</span><span id="line-1911"></span><span id="getLclTypeEnv"><span class="annot"><span class="annottext">getLclTypeEnv :: TcM TcTypeEnv
</span><a href="GHC.Tc.Utils.Monad.html#getLclTypeEnv"><span class="hs-identifier hs-var hs-var">getLclTypeEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985339"><span class="annot"><a href="#local-6989586621682985339"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#getLclEnvTypeEnv"><span class="hs-identifier hs-type">getLclEnvTypeEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985339"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1912"></span><span>
</span><span id="line-1913"></span><span id="local-6989586621682983563"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setLclTypeEnv"><span class="hs-identifier hs-type">setLclTypeEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983563"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983563"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1914"></span><span class="hs-comment">-- Set the local type envt, but do *not* disturb other fields,</span><span>
</span><span id="line-1915"></span><span class="hs-comment">-- notably the lie_var</span><span>
</span><span id="line-1916"></span><span id="setLclTypeEnv"><span class="annot"><span class="annottext">setLclTypeEnv :: forall a. TcLclEnv -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setLclTypeEnv"><span class="hs-identifier hs-var hs-var">setLclTypeEnv</span></a></span></span><span> </span><span id="local-6989586621682985341"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682985341"><span class="hs-identifier hs-var">lcl_env</span></a></span></span><span> </span><span id="local-6989586621682985342"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682985342"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1917"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcLclEnv -&gt; TcLclEnv) -&gt; TcM a -&gt; TcM a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTypeEnv -&gt; TcLclEnv -&gt; TcLclEnv
</span><a href="GHC.Tc.Types.LclEnv.html#setLclEnvTypeEnv"><span class="hs-identifier hs-var">setLclEnvTypeEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLclEnv -&gt; TcTypeEnv
</span><a href="GHC.Tc.Types.LclEnv.html#getLclEnvTypeEnv"><span class="hs-identifier hs-var">getLclEnvTypeEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682985341"><span class="hs-identifier hs-var">lcl_env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682985342"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1918"></span><span>
</span><span id="line-1919"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTcConstraints"><span class="hs-identifier hs-type">traceTcConstraints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1920"></span><span id="traceTcConstraints"><span class="annot"><span class="annottext">traceTcConstraints :: FilePath -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTcConstraints"><span class="hs-identifier hs-var hs-var">traceTcConstraints</span></a></span></span><span> </span><span id="local-6989586621682985344"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682985344"><span class="hs-identifier hs-var">msg</span></a></span></span><span>
</span><span id="line-1921"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985345"><span class="annot"><a href="#local-6989586621682985345"><span class="hs-identifier hs-var">lie_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) (IORef WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#getConstraintVar"><span class="hs-identifier hs-var">getConstraintVar</span></a></span><span>
</span><span id="line-1922"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682985346"><span class="annot"><a href="#local-6989586621682985346"><span class="hs-identifier hs-var">lie</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-type">readTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985345"><span class="hs-identifier hs-type">lie_var</span></a></span><span>
</span><span id="line-1923"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceOptTcRn"><span class="hs-identifier hs-type">traceOptTcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_D_dump_tc_trace"><span class="hs-identifier hs-type">Opt_D_dump_tc_trace</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1924"></span><span>         </span><span class="annot"><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-type">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682985344"><span class="hs-identifier hs-type">msg</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;: LIE:&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985346"><span class="hs-identifier hs-type">lie</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1925"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-1926"></span><span>
</span><span id="line-1927"></span><span class="hs-keyword">data</span><span> </span><span id="IsExtraConstraint"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#IsExtraConstraint"><span class="hs-identifier hs-var">IsExtraConstraint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="YesExtraConstraint"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#YesExtraConstraint"><span class="hs-identifier hs-var">YesExtraConstraint</span></a></span></span><span>
</span><span id="line-1928"></span><span>                       </span><span class="hs-glyph">|</span><span> </span><span id="NoExtraConstraint"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#NoExtraConstraint"><span class="hs-identifier hs-var">NoExtraConstraint</span></a></span></span><span>
</span><span id="line-1929"></span><span>
</span><span id="line-1930"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#IsExtraConstraint"><span class="hs-identifier hs-type">IsExtraConstraint</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1931"></span><span>  </span><span id="local-6989586621682985354"><span class="annot"><span class="annottext">ppr :: IsExtraConstraint -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="annot"><span class="annottext">IsExtraConstraint
</span><a href="GHC.Tc.Utils.Monad.html#YesExtraConstraint"><span class="hs-identifier hs-var">YesExtraConstraint</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;YesExtraConstraint&quot;</span></span><span>
</span><span id="line-1932"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">IsExtraConstraint
</span><a href="GHC.Tc.Utils.Monad.html#NoExtraConstraint"><span class="hs-identifier hs-var">NoExtraConstraint</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;NoExtraConstraint&quot;</span></span><span>
</span><span id="line-1933"></span><span>
</span><span id="line-1934"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitAnonTypeHole"><span class="hs-identifier hs-type">emitAnonTypeHole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#IsExtraConstraint"><span class="hs-identifier hs-type">IsExtraConstraint</span></a></span><span>
</span><span id="line-1935"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1936"></span><span id="emitAnonTypeHole"><span class="annot"><span class="annottext">emitAnonTypeHole :: IsExtraConstraint -&gt; Id -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#emitAnonTypeHole"><span class="hs-identifier hs-var hs-var">emitAnonTypeHole</span></a></span></span><span> </span><span id="local-6989586621682985355"><span class="annot"><span class="annottext">IsExtraConstraint
</span><a href="#local-6989586621682985355"><span class="hs-identifier hs-var">extra_constraints</span></a></span></span><span> </span><span id="local-6989586621682985356"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682985356"><span class="hs-identifier hs-var">tv</span></a></span></span><span>
</span><span id="line-1937"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985357"><span class="annot"><a href="#local-6989586621682985357"><span class="hs-identifier hs-var">ct_loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; Maybe TypeOrKind -&gt; TcM CtLoc
</span><a href="GHC.Tc.Utils.Monad.html#getCtLocM"><span class="hs-identifier hs-var">getCtLocM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#TypeHoleOrigin"><span class="hs-identifier hs-var">TypeHoleOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621682985359"><span class="hs-identifier hs-var">occ</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe TypeOrKind
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1938"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682985360"><span class="annot"><a href="#local-6989586621682985360"><span class="hs-identifier hs-var hs-var">hole</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Hole"><span class="hs-identifier hs-type">Hole</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hole_sort :: HoleSort
</span><a href="GHC.Tc.Types.Constraint.html#hole_sort"><span class="hs-identifier hs-var">hole_sort</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HoleSort
</span><a href="#local-6989586621682985363"><span class="hs-identifier hs-var">sort</span></a></span><span>
</span><span id="line-1939"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hole_occ :: RdrName
</span><a href="GHC.Tc.Types.Constraint.html#hole_occ"><span class="hs-identifier hs-var">hole_occ</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; RdrName
</span><a href="GHC.Types.Name.Reader.html#mkRdrUnqual"><span class="hs-identifier hs-var">mkRdrUnqual</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621682985359"><span class="hs-identifier hs-var">occ</span></a></span><span>
</span><span id="line-1940"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hole_ty :: Mult
</span><a href="GHC.Tc.Types.Constraint.html#hole_ty"><span class="hs-identifier hs-var">hole_ty</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Mult
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682985356"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1941"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hole_loc :: CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#hole_loc"><span class="hs-identifier hs-var">hole_loc</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682985357"><span class="hs-identifier hs-var">ct_loc</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1942"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitHole"><span class="hs-identifier hs-type">emitHole</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985360"><span class="hs-identifier hs-type">hole</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1943"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1944"></span><span>    </span><span id="local-6989586621682985359"><span class="annot"><span class="annottext">occ :: OccName
</span><a href="#local-6989586621682985359"><span class="hs-identifier hs-var hs-var">occ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkTyVarOccFS"><span class="hs-identifier hs-var">mkTyVarOccFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;_&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1945"></span><span>    </span><span id="local-6989586621682985363"><span class="annot"><span class="annottext">sort :: HoleSort
</span><a href="#local-6989586621682985363"><span class="hs-identifier hs-var hs-var">sort</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IsExtraConstraint
</span><a href="GHC.Tc.Utils.Monad.html#YesExtraConstraint"><span class="hs-identifier hs-var">YesExtraConstraint</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IsExtraConstraint
</span><a href="#local-6989586621682985355"><span class="hs-identifier hs-var">extra_constraints</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HoleSort
</span><a href="GHC.Tc.Types.Constraint.html#ConstraintHole"><span class="hs-identifier hs-var">ConstraintHole</span></a></span><span>
</span><span id="line-1946"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HoleSort
</span><a href="GHC.Tc.Types.Constraint.html#TypeHole"><span class="hs-identifier hs-var">TypeHole</span></a></span><span>
</span><span id="line-1947"></span><span>
</span><span id="line-1948"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitNamedTypeHole"><span class="hs-identifier hs-type">emitNamedTypeHole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1949"></span><span id="emitNamedTypeHole"><span class="annot"><span class="annottext">emitNamedTypeHole :: (Name, Id) -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#emitNamedTypeHole"><span class="hs-identifier hs-var hs-var">emitNamedTypeHole</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682985372"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682985372"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682985373"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682985373"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1950"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985374"><span class="annot"><a href="#local-6989586621682985374"><span class="hs-identifier hs-var">ct_loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcM CtLoc -&gt; TcM CtLoc
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SrcSpan
</span><a href="GHC.Types.Name.html#nameSrcSpan"><span class="hs-identifier hs-var">nameSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682985372"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM CtLoc -&gt; TcM CtLoc) -&gt; TcM CtLoc -&gt; TcM CtLoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1951"></span><span>                   </span><span class="annot"><span class="annottext">CtOrigin -&gt; Maybe TypeOrKind -&gt; TcM CtLoc
</span><a href="GHC.Tc.Utils.Monad.html#getCtLocM"><span class="hs-identifier hs-var">getCtLocM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#TypeHoleOrigin"><span class="hs-identifier hs-var">TypeHoleOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621682985375"><span class="hs-identifier hs-var">occ</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe TypeOrKind
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1952"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682985376"><span class="annot"><a href="#local-6989586621682985376"><span class="hs-identifier hs-var hs-var">hole</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Hole"><span class="hs-identifier hs-type">Hole</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hole_sort :: HoleSort
</span><a href="GHC.Tc.Types.Constraint.html#hole_sort"><span class="hs-identifier hs-var">hole_sort</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HoleSort
</span><a href="GHC.Tc.Types.Constraint.html#TypeHole"><span class="hs-identifier hs-var">TypeHole</span></a></span><span>
</span><span id="line-1953"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hole_occ :: RdrName
</span><a href="GHC.Tc.Types.Constraint.html#hole_occ"><span class="hs-identifier hs-var">hole_occ</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; RdrName
</span><a href="GHC.Types.Name.Reader.html#nameRdrName"><span class="hs-identifier hs-var">nameRdrName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682985372"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1954"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hole_ty :: Mult
</span><a href="GHC.Tc.Types.Constraint.html#hole_ty"><span class="hs-identifier hs-var">hole_ty</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Mult
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682985373"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1955"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hole_loc :: CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#hole_loc"><span class="hs-identifier hs-var">hole_loc</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682985374"><span class="hs-identifier hs-var">ct_loc</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1956"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitHole"><span class="hs-identifier hs-type">emitHole</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985376"><span class="hs-identifier hs-type">hole</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1957"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1958"></span><span>    </span><span id="local-6989586621682985375"><span class="annot"><span class="annottext">occ :: OccName
</span><a href="#local-6989586621682985375"><span class="hs-identifier hs-var hs-var">occ</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682985372"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1959"></span><span>
</span><span id="line-1960"></span><span class="hs-comment">{- Note [Constraints and errors]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider this (#12124):

  foo :: Maybe Int
  foo = return (case Left 3 of
                  Left -&gt; 1  -- Hard error here!
                  _    -&gt; 0)

The call to 'return' will generate a (Monad m) wanted constraint; but
then there'll be &quot;hard error&quot; (i.e. an exception in the TcM monad), from
the unsaturated Left constructor pattern.

We'll recover in tcPolyBinds, using recoverM.  But then the final
tcSimplifyTop will see that (Monad m) constraint, with 'm' utterly
un-filled-in, and will emit a misleading error message.

The underlying problem is that an exception interrupts the constraint
gathering process. Bottom line: if we have an exception, it's best
simply to discard any gathered constraints.  Hence in 'attemptM' we
capture the constraints in a fresh variable, and only emit them into
the surrounding context if we exit normally.  If an exception is
raised, simply discard the collected constraints... we have a hard
error to report.  So this capture-the-emit dance isn't as stupid as it
looks :-).

However suppose we throw an exception inside an invocation of
captureConstraints, and discard all the constraints. Some of those
constraints might be &quot;variable out of scope&quot; Hole constraints, and that
might have been the actual original cause of the exception!  For
example (#12529):
   f = p @ Int
Here 'p' is out of scope, so we get an insoluble Hole constraint. But
the visible type application fails in the monad (throws an exception).
We must not discard the out-of-scope error.

It's distressingly delicate though:

* If we discard too /many/ constraints we may fail to report the error
  that led us to interrupt the constraint gathering process.

  One particular example &quot;variable out of scope&quot; Hole constraints. For
  example (#12529):
   f = p @ Int
  Here 'p' is out of scope, so we get an insoluble Hole constraint. But
  the visible type application fails in the monad (throws an exception).
  We must not discard the out-of-scope error.

  Also GHC.Tc.Solver.simplifyAndEmitFlatConstraints may fail having
  emitted some constraints with skolem-escape problems.

* If we discard too /few/ constraints, we may get the misleading
  class constraints mentioned above.  But we may /also/ end up taking
  constraints built at some inner level, and emitting them at some
  outer level, and then breaking the TcLevel invariants
  See Note [TcLevel invariants] in GHC.Tc.Utils.TcType

So dropMisleading has a horridly ad-hoc structure.  It keeps only
/insoluble/ flat constraints (which are unlikely to very visibly trip
up on the TcLevel invariant, but all /implication/ constraints (except
the class constraints inside them).  The implication constraints are
OK because they set the ambient level before attempting to solve any
inner constraints.  Ugh! I hate this. But it seems to work.

However note that freshly-generated constraints like (Int ~ Bool), or
((a -&gt; b) ~ Int) are all CNonCanonical, and hence won't be flagged as
insoluble.  The constraint solver does that.  So they'll be discarded.
That's probably ok; but see th/5358 as a not-so-good example:
   t1 :: Int
   t1 x = x   -- Manifestly wrong

   foo = $(...raises exception...)
We report the exception, but not the bug in t1.  Oh well.  Possible
solution: make GHC.Tc.Utils.Unify.uType spot manifestly-insoluble constraints.


************************************************************************
*                                                                      *
             Template Haskell context
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-2042"></span><span>
</span><span id="line-2043"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#recordThUse"><span class="hs-identifier hs-type">recordThUse</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2044"></span><span id="recordThUse"><span class="annot"><span class="annottext">recordThUse :: TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#recordThUse"><span class="hs-identifier hs-var hs-var">recordThUse</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985378"><span class="annot"><a href="#local-6989586621682985378"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#writeTcRef"><span class="hs-identifier hs-type">writeTcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#tcg_th_used"><span class="hs-identifier hs-var">tcg_th_used</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985378"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2045"></span><span>
</span><span id="line-2046"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#recordThSpliceUse"><span class="hs-identifier hs-type">recordThSpliceUse</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2047"></span><span id="recordThSpliceUse"><span class="annot"><span class="annottext">recordThSpliceUse :: TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#recordThSpliceUse"><span class="hs-identifier hs-var hs-var">recordThSpliceUse</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985379"><span class="annot"><a href="#local-6989586621682985379"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#writeTcRef"><span class="hs-identifier hs-type">writeTcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#tcg_th_splice_used"><span class="hs-identifier hs-var">tcg_th_splice_used</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985379"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2048"></span><span>
</span><span id="line-2049"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#recordThNeededRuntimeDeps"><span class="hs-identifier hs-type">recordThNeededRuntimeDeps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Linker.Types.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Linker.Types.html#PkgsLoaded"><span class="hs-identifier hs-type">PkgsLoaded</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2050"></span><span id="recordThNeededRuntimeDeps"><span class="annot"><span class="annottext">recordThNeededRuntimeDeps :: [Linkable] -&gt; UniqDFM UnitId LoadedPkgInfo -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#recordThNeededRuntimeDeps"><span class="hs-identifier hs-var hs-var">recordThNeededRuntimeDeps</span></a></span></span><span> </span><span id="local-6989586621682985381"><span class="annot"><span class="annottext">[Linkable]
</span><a href="#local-6989586621682985381"><span class="hs-identifier hs-var">new_links</span></a></span></span><span> </span><span id="local-6989586621682985382"><span class="annot"><span class="annottext">UniqDFM UnitId LoadedPkgInfo
</span><a href="#local-6989586621682985382"><span class="hs-identifier hs-var">new_pkgs</span></a></span></span><span>
</span><span id="line-2051"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985383"><span class="annot"><a href="#local-6989586621682985383"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-2052"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#updTcRef"><span class="hs-identifier hs-type">updTcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#tcg_th_needed_deps"><span class="hs-identifier hs-var">tcg_th_needed_deps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985383"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682985384"><span class="annot"><span class="annottext">[Linkable]
</span><a href="#local-6989586621682985384"><span class="hs-identifier hs-var">needed_links</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682985385"><span class="annot"><span class="annottext">UniqDFM UnitId LoadedPkgInfo
</span><a href="#local-6989586621682985385"><span class="hs-identifier hs-var">needed_pkgs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2053"></span><span>           </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682985386"><span class="annot"><span class="annottext">links :: [Linkable]
</span><a href="#local-6989586621682985386"><span class="hs-identifier hs-var hs-var">links</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Linkable]
</span><a href="#local-6989586621682985381"><span class="hs-identifier hs-var">new_links</span></a></span><span> </span><span class="annot"><span class="annottext">[Linkable] -&gt; [Linkable] -&gt; [Linkable]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Linkable]
</span><a href="#local-6989586621682985384"><span class="hs-identifier hs-var">needed_links</span></a></span><span>
</span><span id="line-2054"></span><span>               </span><span class="hs-glyph">!</span><span id="local-6989586621682985387"><span class="annot"><span class="annottext">pkgs :: UniqDFM UnitId LoadedPkgInfo
</span><a href="#local-6989586621682985387"><span class="hs-identifier hs-var hs-var">pkgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqDFM UnitId LoadedPkgInfo
-&gt; UniqDFM UnitId LoadedPkgInfo -&gt; UniqDFM UnitId LoadedPkgInfo
forall {k} (key :: k) elt.
UniqDFM key elt -&gt; UniqDFM key elt -&gt; UniqDFM key elt
</span><a href="GHC.Types.Unique.DFM.html#plusUDFM"><span class="hs-identifier hs-var">plusUDFM</span></a></span><span> </span><span class="annot"><span class="annottext">UniqDFM UnitId LoadedPkgInfo
</span><a href="#local-6989586621682985385"><span class="hs-identifier hs-var">needed_pkgs</span></a></span><span> </span><span class="annot"><span class="annottext">UniqDFM UnitId LoadedPkgInfo
</span><a href="#local-6989586621682985382"><span class="hs-identifier hs-var">new_pkgs</span></a></span><span>
</span><span id="line-2055"></span><span>               </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Linkable]
</span><a href="#local-6989586621682985386"><span class="hs-identifier hs-var">links</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UniqDFM UnitId LoadedPkgInfo
</span><a href="#local-6989586621682985387"><span class="hs-identifier hs-var">pkgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2056"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-2057"></span><span>
</span><span id="line-2058"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#keepAlive"><span class="hs-identifier hs-type">keepAlive</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- Record the name in the keep-alive set</span><span>
</span><span id="line-2059"></span><span id="keepAlive"><span class="annot"><span class="annottext">keepAlive :: Name -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#keepAlive"><span class="hs-identifier hs-var hs-var">keepAlive</span></a></span></span><span> </span><span id="local-6989586621682985389"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682985389"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-2060"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985390"><span class="annot"><a href="#local-6989586621682985390"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-2061"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-type">traceRn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;keep alive&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985389"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2062"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#updTcRef"><span class="hs-identifier hs-type">updTcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#tcg_keep"><span class="hs-identifier hs-var">tcg_keep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985390"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">`extendNameSet`</span></span><span> </span><span class="annot"><span class="hs-identifier">name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2063"></span><span>
</span><span id="line-2064"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getStage"><span class="hs-identifier hs-type">getStage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.TH.html#ThStage"><span class="hs-identifier hs-type">ThStage</span></a></span><span>
</span><span id="line-2065"></span><span id="getStage"><span class="annot"><span class="annottext">getStage :: TcM ThStage
</span><a href="GHC.Tc.Utils.Monad.html#getStage"><span class="hs-identifier hs-var hs-var">getStage</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985392"><span class="annot"><a href="#local-6989586621682985392"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#getLclEnvThStage"><span class="hs-identifier hs-type">getLclEnvThStage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985392"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2066"></span><span>
</span><span id="line-2067"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getStageAndBindLevel"><span class="hs-identifier hs-type">getStageAndBindLevel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Basic.html#TopLevelFlag"><span class="hs-identifier hs-type">TopLevelFlag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TH.html#ThLevel"><span class="hs-identifier hs-type">ThLevel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TH.html#ThStage"><span class="hs-identifier hs-type">ThStage</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2068"></span><span id="getStageAndBindLevel"><span class="annot"><span class="annottext">getStageAndBindLevel :: Name -&gt; TcRn (Maybe (TopLevelFlag, Int, ThStage))
</span><a href="GHC.Tc.Utils.Monad.html#getStageAndBindLevel"><span class="hs-identifier hs-var hs-var">getStageAndBindLevel</span></a></span></span><span> </span><span id="local-6989586621682985395"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682985395"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-2069"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985396"><span class="annot"><a href="#local-6989586621682985396"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span class="hs-special">;</span><span>
</span><span id="line-2070"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html#lookupNameEnv"><span class="hs-identifier hs-type">lookupNameEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#getLclEnvThBndrs"><span class="hs-identifier hs-type">getLclEnvThBndrs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985396"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682985395"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2071"></span><span>           </span><span class="annot"><span class="annottext">Maybe (TopLevelFlag, Int)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (TopLevelFlag, Int, ThStage)
-&gt; TcRn (Maybe (TopLevelFlag, Int, ThStage))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (TopLevelFlag, Int, ThStage)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2072"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682985399"><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621682985399"><span class="hs-identifier hs-var">top_lvl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682985400"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682985400"><span class="hs-identifier hs-var">bind_lvl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (TopLevelFlag, Int, ThStage)
-&gt; TcRn (Maybe (TopLevelFlag, Int, ThStage))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TopLevelFlag, Int, ThStage) -&gt; Maybe (TopLevelFlag, Int, ThStage)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621682985399"><span class="hs-identifier hs-var">top_lvl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682985400"><span class="hs-identifier hs-var">bind_lvl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcLclEnv -&gt; ThStage
</span><a href="GHC.Tc.Types.LclEnv.html#getLclEnvThStage"><span class="hs-identifier hs-var">getLclEnvThStage</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682985396"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2073"></span><span>
</span><span id="line-2074"></span><span id="local-6989586621682983573"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setStage"><span class="hs-identifier hs-type">setStage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TH.html#ThStage"><span class="hs-identifier hs-type">ThStage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983573"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983573"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2075"></span><span id="setStage"><span class="annot"><span class="annottext">setStage :: forall a. ThStage -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setStage"><span class="hs-identifier hs-var hs-var">setStage</span></a></span></span><span> </span><span id="local-6989586621682985401"><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621682985401"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcLclEnv -&gt; TcLclEnv)
-&gt; TcRnIf TcGblEnv TcLclEnv a -&gt; TcRnIf TcGblEnv TcLclEnv a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThStage -&gt; TcLclEnv -&gt; TcLclEnv
</span><a href="GHC.Tc.Types.LclEnv.html#setLclEnvThStage"><span class="hs-identifier hs-var">setLclEnvThStage</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621682985401"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2076"></span><span>
</span><span id="line-2077"></span><span class="hs-comment">-- | Adds the given modFinalizers to the global environment and set them to use</span><span>
</span><span id="line-2078"></span><span class="hs-comment">-- the current local environment.</span><span>
</span><span id="line-2079"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addModFinalizersWithLclEnv"><span class="hs-identifier hs-type">addModFinalizersWithLclEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#ThModFinalizers"><span class="hs-identifier hs-type">ThModFinalizers</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2080"></span><span id="addModFinalizersWithLclEnv"><span class="annot"><span class="annottext">addModFinalizersWithLclEnv :: ThModFinalizers -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addModFinalizersWithLclEnv"><span class="hs-identifier hs-var hs-var">addModFinalizersWithLclEnv</span></a></span></span><span> </span><span id="local-6989586621682985403"><span class="annot"><span class="annottext">ThModFinalizers
</span><a href="#local-6989586621682985403"><span class="hs-identifier hs-var">mod_finalizers</span></a></span></span><span>
</span><span id="line-2081"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621682985404"><span class="annot"><a href="#local-6989586621682985404"><span class="hs-identifier hs-var">lcl_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span>
</span><span id="line-2082"></span><span>       </span><span id="local-6989586621682985405"><span class="annot"><a href="#local-6989586621682985405"><span class="hs-identifier hs-var">th_modfinalizers_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_th_modfinalizers"><span class="hs-identifier hs-var">tcg_th_modfinalizers</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-type">getGblEnv</span></a></span><span>
</span><span id="line-2083"></span><span>       </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#updTcRef"><span class="hs-identifier hs-type">updTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985405"><span class="hs-identifier hs-type">th_modfinalizers_var</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682985406"><span class="annot"><span class="annottext">[(TcLclEnv, ThModFinalizers)]
</span><a href="#local-6989586621682985406"><span class="hs-identifier hs-var">fins</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2084"></span><span>         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621682985404"><span class="hs-identifier hs-var">lcl_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ThModFinalizers
</span><a href="#local-6989586621682985403"><span class="hs-identifier hs-var">mod_finalizers</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcLclEnv, ThModFinalizers)
-&gt; [(TcLclEnv, ThModFinalizers)] -&gt; [(TcLclEnv, ThModFinalizers)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(TcLclEnv, ThModFinalizers)]
</span><a href="#local-6989586621682985406"><span class="hs-identifier hs-var">fins</span></a></span><span>
</span><span id="line-2085"></span><span>
</span><span id="line-2086"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
             Safe Haskell context
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-2093"></span><span>
</span><span id="line-2094"></span><span class="hs-comment">-- | Mark that safe inference has failed</span><span>
</span><span id="line-2095"></span><span class="hs-comment">-- See Note [Safe Haskell Overlapping Instances Implementation]</span><span>
</span><span id="line-2096"></span><span class="hs-comment">-- although this is used for more than just that failure case.</span><span>
</span><span id="line-2097"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#recordUnsafeInfer"><span class="hs-identifier hs-type">recordUnsafeInfer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2098"></span><span id="recordUnsafeInfer"><span class="annot"><span class="annottext">recordUnsafeInfer :: Messages TcRnMessage -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#recordUnsafeInfer"><span class="hs-identifier hs-var hs-var">recordUnsafeInfer</span></a></span></span><span> </span><span id="local-6989586621682985407"><span class="annot"><span class="annottext">Messages TcRnMessage
</span><a href="#local-6989586621682985407"><span class="hs-identifier hs-var">msgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2099"></span><span>    </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv -&gt; (TcGblEnv -&gt; TcM ()) -&gt; TcM ()
forall a b.
IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; (a -&gt; IOEnv (Env TcGblEnv TcLclEnv) b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682985408"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682985408"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">IORef Bool -&gt; Bool -&gt; TcM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; TcRef a -&gt; a -&gt; m ()
</span><a href="GHC.Tc.Types.TcRef.html#writeTcRef"><span class="hs-identifier hs-var">writeTcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; IORef Bool
</span><a href="GHC.Tc.Types.html#tcg_safe_infer"><span class="hs-identifier hs-var">tcg_safe_infer</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682985408"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2100"></span><span>                             </span><span class="annot"><span class="annottext">IORef (Messages TcRnMessage) -&gt; Messages TcRnMessage -&gt; TcM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; TcRef a -&gt; a -&gt; m ()
</span><a href="GHC.Tc.Types.TcRef.html#writeTcRef"><span class="hs-identifier hs-var">writeTcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; IORef (Messages TcRnMessage)
</span><a href="GHC.Tc.Types.html#tcg_safe_infer_reasons"><span class="hs-identifier hs-var">tcg_safe_infer_reasons</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682985408"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Messages TcRnMessage
</span><a href="#local-6989586621682985407"><span class="hs-identifier hs-var">msgs</span></a></span><span>
</span><span id="line-2101"></span><span>
</span><span id="line-2102"></span><span class="annot"><span class="hs-comment">-- | Figure out the final correct safe haskell mode</span></span><span>
</span><span id="line-2103"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#finalSafeMode"><span class="hs-identifier hs-type">finalSafeMode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Types.SafeHaskell.html#SafeHaskellMode"><span class="hs-identifier hs-type">SafeHaskellMode</span></a></span><span>
</span><span id="line-2104"></span><span id="finalSafeMode"><span class="annot"><span class="annottext">finalSafeMode :: DynFlags -&gt; TcGblEnv -&gt; IO SafeHaskellMode
</span><a href="GHC.Tc.Utils.Monad.html#finalSafeMode"><span class="hs-identifier hs-var hs-var">finalSafeMode</span></a></span></span><span> </span><span id="local-6989586621682985409"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682985409"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621682985410"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682985410"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2105"></span><span>    </span><span id="local-6989586621682985411"><span class="annot"><a href="#local-6989586621682985411"><span class="hs-identifier hs-var">safeInf</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef Bool -&gt; IO Bool
forall a. IORef a -&gt; IO a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; IORef Bool
</span><a href="GHC.Tc.Types.html#tcg_safe_infer"><span class="hs-identifier hs-var">tcg_safe_infer</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682985410"><span class="hs-identifier hs-var">tcg_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2106"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#safeHaskell"><span class="hs-identifier hs-var">safeHaskell</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985409"><span class="hs-identifier hs-type">dflags</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2107"></span><span>        </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Types.SafeHaskell.html#Sf_None"><span class="hs-identifier hs-var">Sf_None</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#safeInferOn"><span class="hs-identifier hs-var">safeInferOn</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682985409"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682985411"><span class="hs-identifier hs-var">safeInf</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Types.SafeHaskell.html#Sf_SafeInferred"><span class="hs-identifier hs-var">Sf_SafeInferred</span></a></span><span>
</span><span id="line-2108"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Types.SafeHaskell.html#Sf_None"><span class="hs-identifier hs-var">Sf_None</span></a></span><span>
</span><span id="line-2109"></span><span>        </span><span id="local-6989586621682985416"><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="#local-6989586621682985416"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="#local-6989586621682985416"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-2110"></span><span>
</span><span id="line-2111"></span><span class="annot"><span class="hs-comment">-- | Switch instances to safe instances if we're in Safe mode.</span></span><span>
</span><span id="line-2112"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#fixSafeInstances"><span class="hs-identifier hs-type">fixSafeInstances</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SafeHaskell.html#SafeHaskellMode"><span class="hs-identifier hs-type">SafeHaskellMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2113"></span><span id="fixSafeInstances"><span class="annot"><span class="annottext">fixSafeInstances :: SafeHaskellMode -&gt; [ClsInst] -&gt; [ClsInst]
</span><a href="GHC.Tc.Utils.Monad.html#fixSafeInstances"><span class="hs-identifier hs-var hs-var">fixSafeInstances</span></a></span></span><span> </span><span id="local-6989586621682985417"><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="#local-6989586621682985417"><span class="hs-identifier hs-var">sfMode</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="#local-6989586621682985417"><span class="hs-identifier hs-var">sfMode</span></a></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode -&gt; SafeHaskellMode -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Types.SafeHaskell.html#Sf_Safe"><span class="hs-identifier hs-var">Sf_Safe</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="#local-6989586621682985417"><span class="hs-identifier hs-var">sfMode</span></a></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode -&gt; SafeHaskellMode -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Types.SafeHaskell.html#Sf_SafeInferred"><span class="hs-identifier hs-var">Sf_SafeInferred</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ClsInst] -&gt; [ClsInst]
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-2114"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#fixSafeInstances"><span class="hs-identifier hs-var">fixSafeInstances</span></a></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ClsInst -&gt; ClsInst) -&gt; [ClsInst] -&gt; [ClsInst]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">ClsInst -&gt; ClsInst
</span><a href="#local-6989586621682985421"><span class="hs-identifier hs-var">fixSafe</span></a></span><span>
</span><span id="line-2115"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682985421"><span class="annot"><span class="annottext">fixSafe :: ClsInst -&gt; ClsInst
</span><a href="#local-6989586621682985421"><span class="hs-identifier hs-var hs-var">fixSafe</span></a></span></span><span> </span><span id="local-6989586621682985422"><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621682985422"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682985423"><span class="annot"><span class="annottext">new_flag :: OverlapFlag
</span><a href="#local-6989586621682985423"><span class="hs-identifier hs-var hs-var">new_flag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClsInst -&gt; OverlapFlag
</span><a href="GHC.Core.InstEnv.html#is_flag"><span class="hs-identifier hs-var">is_flag</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621682985422"><span class="hs-identifier hs-var">inst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#isSafeOverlap"><span class="hs-identifier hs-var">isSafeOverlap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2116"></span><span>                       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621682985422"><span class="hs-identifier hs-var">inst</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#is_flag"><span class="hs-identifier hs-var">is_flag</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682985423"><span class="hs-identifier hs-type">new_flag</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2117"></span><span>
</span><span id="line-2118"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
             Stuff for the renamer's local env
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-2125"></span><span>
</span><span id="line-2126"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getLocalRdrEnv"><span class="hs-identifier hs-type">getLocalRdrEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#LocalRdrEnv"><span class="hs-identifier hs-type">LocalRdrEnv</span></a></span><span>
</span><span id="line-2127"></span><span id="getLocalRdrEnv"><span class="annot"><span class="annottext">getLocalRdrEnv :: RnM LocalRdrEnv
</span><a href="GHC.Tc.Utils.Monad.html#getLocalRdrEnv"><span class="hs-identifier hs-var hs-var">getLocalRdrEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985426"><span class="annot"><a href="#local-6989586621682985426"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#getLclEnvRdrEnv"><span class="hs-identifier hs-type">getLclEnvRdrEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985426"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2128"></span><span>
</span><span id="line-2129"></span><span id="local-6989586621682983579"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setLocalRdrEnv"><span class="hs-identifier hs-type">setLocalRdrEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#LocalRdrEnv"><span class="hs-identifier hs-type">LocalRdrEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983579"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983579"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2130"></span><span id="setLocalRdrEnv"><span class="annot"><span class="annottext">setLocalRdrEnv :: forall a. LocalRdrEnv -&gt; RnM a -&gt; RnM a
</span><a href="GHC.Tc.Utils.Monad.html#setLocalRdrEnv"><span class="hs-identifier hs-var hs-var">setLocalRdrEnv</span></a></span></span><span> </span><span id="local-6989586621682985427"><span class="annot"><span class="annottext">LocalRdrEnv
</span><a href="#local-6989586621682985427"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span> </span><span id="local-6989586621682985428"><span class="annot"><span class="annottext">RnM a
</span><a href="#local-6989586621682985428"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-2131"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcLclEnv -&gt; TcLclEnv) -&gt; RnM a -&gt; RnM a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocalRdrEnv -&gt; TcLclEnv -&gt; TcLclEnv
</span><a href="GHC.Tc.Types.LclEnv.html#setLclEnvRdrEnv"><span class="hs-identifier hs-var">setLclEnvRdrEnv</span></a></span><span> </span><span class="annot"><span class="annottext">LocalRdrEnv
</span><a href="#local-6989586621682985427"><span class="hs-identifier hs-var">rdr_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RnM a
</span><a href="#local-6989586621682985428"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-2132"></span><span>
</span><span id="line-2133"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
             Stuff for interface decls
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-2140"></span><span>
</span><span id="line-2141"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mkIfLclEnv"><span class="hs-identifier hs-type">mkIfLclEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#IsBootInterface"><span class="hs-identifier hs-type">IsBootInterface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfLclEnv"><span class="hs-identifier hs-type">IfLclEnv</span></a></span><span>
</span><span id="line-2142"></span><span id="mkIfLclEnv"><span class="annot"><span class="annottext">mkIfLclEnv :: Module -&gt; SDoc -&gt; IsBootInterface -&gt; IfLclEnv
</span><a href="GHC.Tc.Utils.Monad.html#mkIfLclEnv"><span class="hs-identifier hs-var hs-var">mkIfLclEnv</span></a></span></span><span> </span><span id="local-6989586621682985430"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682985430"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span id="local-6989586621682985431"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682985431"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682985432"><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621682985432"><span class="hs-identifier hs-var">boot</span></a></span></span><span>
</span><span id="line-2143"></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfLclEnv"><span class="hs-identifier hs-type">IfLclEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">if_mod :: Module
</span><a href="GHC.Tc.Types.html#if_mod"><span class="hs-identifier hs-var">if_mod</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682985430"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-2144"></span><span>                                </span><span class="annot"><span class="annottext">if_loc :: SDoc
</span><a href="GHC.Tc.Types.html#if_loc"><span class="hs-identifier hs-var">if_loc</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682985431"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-2145"></span><span>                                </span><span class="annot"><span class="annottext">if_boot :: IsBootInterface
</span><a href="GHC.Tc.Types.html#if_boot"><span class="hs-identifier hs-var">if_boot</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621682985432"><span class="hs-identifier hs-var">boot</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-2146"></span><span>                                </span><span class="annot"><span class="annottext">if_nsubst :: Maybe NameShape
</span><a href="GHC.Tc.Types.html#if_nsubst"><span class="hs-identifier hs-var">if_nsubst</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe NameShape
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-2147"></span><span>                                </span><span class="annot"><span class="annottext">if_implicits_env :: Maybe TypeEnv
</span><a href="GHC.Tc.Types.html#if_implicits_env"><span class="hs-identifier hs-var">if_implicits_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe TypeEnv
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-2148"></span><span>                                </span><span class="annot"><span class="annottext">if_tv_env :: FastStringEnv Id
</span><a href="GHC.Tc.Types.html#if_tv_env"><span class="hs-identifier hs-var">if_tv_env</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastStringEnv Id
forall a. FastStringEnv a
</span><a href="GHC.Data.FastString.Env.html#emptyFsEnv"><span class="hs-identifier hs-var">emptyFsEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-2149"></span><span>                                </span><span class="annot"><span class="annottext">if_id_env :: FastStringEnv Id
</span><a href="GHC.Tc.Types.html#if_id_env"><span class="hs-identifier hs-var">if_id_env</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastStringEnv Id
forall a. FastStringEnv a
</span><a href="GHC.Data.FastString.Env.html#emptyFsEnv"><span class="hs-identifier hs-var">emptyFsEnv</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2150"></span><span>
</span><span id="line-2151"></span><span class="hs-comment">-- | Run an 'IfG' (top-level interface monad) computation inside an existing</span><span>
</span><span id="line-2152"></span><span class="hs-comment">-- 'TcRn' (typecheck-renaming monad) computation by initializing an 'IfGblEnv'</span><span>
</span><span id="line-2153"></span><span class="hs-comment">-- based on 'TcGblEnv'.</span><span>
</span><span id="line-2154"></span><span id="local-6989586621682983585"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initIfaceTcRn"><span class="hs-identifier hs-type">initIfaceTcRn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfG"><span class="hs-identifier hs-type">IfG</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983585"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983585"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2155"></span><span id="initIfaceTcRn"><span class="annot"><span class="annottext">initIfaceTcRn :: forall a. IfG a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#initIfaceTcRn"><span class="hs-identifier hs-var hs-var">initIfaceTcRn</span></a></span></span><span> </span><span id="local-6989586621682985451"><span class="annot"><span class="annottext">IfG a
</span><a href="#local-6989586621682985451"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-2156"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985452"><span class="annot"><a href="#local-6989586621682985452"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-2157"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682985453"><span class="annot"><a href="#local-6989586621682985453"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-type">getTopEnv</span></a></span><span>
</span><span id="line-2158"></span><span>          </span><span class="hs-comment">-- bangs to avoid leaking the envs (#19356)</span><span>
</span><span id="line-2159"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682985454"><span class="annot"><a href="#local-6989586621682985454"><span class="hs-identifier hs-var hs-var">mhome_unit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Maybe HomeUnit
</span><a href="GHC.Driver.Env.html#hsc_home_unit_maybe"><span class="hs-identifier hs-var">hsc_home_unit_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682985453"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2160"></span><span>              </span><span class="hs-glyph">!</span><span id="local-6989586621682985455"><span class="annot"><a href="#local-6989586621682985455"><span class="hs-identifier hs-var hs-var">knot_vars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; KnotVars (IORef TypeEnv)
</span><a href="GHC.Tc.Types.html#tcg_type_env_var"><span class="hs-identifier hs-var">tcg_type_env_var</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682985452"><span class="hs-identifier hs-var">tcg_env</span></a></span><span>
</span><span id="line-2161"></span><span>              </span><span class="hs-comment">-- When we are instantiating a signature, we DEFINITELY</span><span>
</span><span id="line-2162"></span><span>              </span><span class="hs-comment">-- do not want to knot tie.</span><span>
</span><span id="line-2163"></span><span>              </span><span id="local-6989586621682985456"><span class="annot"><a href="#local-6989586621682985456"><span class="hs-identifier hs-var hs-var">is_instantiate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool -&gt; Bool
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeUnit -&gt; Bool
forall u. GenHomeUnit u -&gt; Bool
</span><a href="GHC.Unit.Home.html#isHomeUnitInstantiating"><span class="hs-identifier hs-var">isHomeUnitInstantiating</span></a></span><span> </span><span class="annot"><span class="annottext">(HomeUnit -&gt; Bool) -&gt; Maybe HomeUnit -&gt; Maybe Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe HomeUnit
</span><a href="#local-6989586621682985454"><span class="hs-identifier hs-var">mhome_unit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2164"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985459"><span class="annot"><a href="#local-6989586621682985459"><span class="hs-identifier hs-var hs-var">if_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfGblEnv"><span class="hs-identifier hs-type">IfGblEnv</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-2165"></span><span>                            </span><span class="annot"><span class="annottext">if_doc :: SDoc
</span><a href="GHC.Tc.Types.html#if_doc"><span class="hs-identifier hs-var">if_doc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;initIfaceTcRn&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-2166"></span><span>                            </span><span class="annot"><span class="annottext">if_rec_types :: KnotVars (IfG TypeEnv)
</span><a href="GHC.Tc.Types.html#if_rec_types"><span class="hs-identifier hs-var">if_rec_types</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2167"></span><span>                                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682985456"><span class="hs-identifier hs-var">is_instantiate</span></a></span><span>
</span><span id="line-2168"></span><span>                                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">KnotVars (IfG TypeEnv)
forall a. KnotVars a
</span><a href="GHC.Driver.Env.KnotVars.html#emptyKnotVars"><span class="hs-identifier hs-var">emptyKnotVars</span></a></span><span>
</span><span id="line-2169"></span><span>                                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">IORef TypeEnv -&gt; IfG TypeEnv
forall (m :: * -&gt; *) a. MonadIO m =&gt; TcRef a -&gt; m a
</span><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">(IORef TypeEnv -&gt; IfG TypeEnv)
-&gt; KnotVars (IORef TypeEnv) -&gt; KnotVars (IfG TypeEnv)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">KnotVars (IORef TypeEnv)
</span><a href="#local-6989586621682985455"><span class="hs-identifier hs-var">knot_vars</span></a></span><span>
</span><span id="line-2170"></span><span>                            </span><span class="hs-special">}</span><span>
</span><span id="line-2171"></span><span>                         </span><span class="hs-special">}</span><span>
</span><span id="line-2172"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setEnvs"><span class="hs-identifier hs-type">setEnvs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682985459"><span class="hs-identifier hs-type">if_env</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682985451"><span class="hs-identifier hs-type">thing_inside</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2173"></span><span>
</span><span id="line-2174"></span><span class="hs-comment">-- | 'initIfaceLoad' can be used when there's no chance that the action will</span><span>
</span><span id="line-2175"></span><span class="hs-comment">-- call 'typecheckIface' when inside a module loop and hence 'tcIfaceGlobal'.</span><span>
</span><span id="line-2176"></span><span id="local-6989586621682983592"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initIfaceLoad"><span class="hs-identifier hs-type">initIfaceLoad</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfG"><span class="hs-identifier hs-type">IfG</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983592"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682983592"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2177"></span><span id="initIfaceLoad"><span class="annot"><span class="annottext">initIfaceLoad :: forall a. HscEnv -&gt; IfG a -&gt; IO a
</span><a href="GHC.Tc.Utils.Monad.html#initIfaceLoad"><span class="hs-identifier hs-var hs-var">initIfaceLoad</span></a></span></span><span> </span><span id="local-6989586621682985463"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682985463"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682985464"><span class="annot"><span class="annottext">IfG a
</span><a href="#local-6989586621682985464"><span class="hs-identifier hs-var">do_this</span></a></span></span><span>
</span><span id="line-2178"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682985466"><span class="annot"><span class="annottext">gbl_env :: IfGblEnv
</span><a href="#local-6989586621682985466"><span class="hs-identifier hs-var hs-var">gbl_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfGblEnv"><span class="hs-identifier hs-type">IfGblEnv</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-2179"></span><span>                        </span><span class="annot"><span class="annottext">if_doc :: SDoc
</span><a href="GHC.Tc.Types.html#if_doc"><span class="hs-identifier hs-var">if_doc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;initIfaceLoad&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-2180"></span><span>                        </span><span class="annot"><span class="annottext">if_rec_types :: KnotVars (IfG TypeEnv)
</span><a href="GHC.Tc.Types.html#if_rec_types"><span class="hs-identifier hs-var">if_rec_types</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnotVars (IfG TypeEnv)
forall a. KnotVars a
</span><a href="GHC.Driver.Env.KnotVars.html#emptyKnotVars"><span class="hs-identifier hs-var">emptyKnotVars</span></a></span><span>
</span><span id="line-2181"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-2182"></span><span>      </span><span class="annot"><span class="annottext">Char -&gt; HscEnv -&gt; IfGblEnv -&gt; () -&gt; IfG a -&gt; IO a
forall gbl lcl a.
Char -&gt; HscEnv -&gt; gbl -&gt; lcl -&gt; TcRnIf gbl lcl a -&gt; IO a
</span><a href="GHC.Tc.Utils.Monad.html#initTcRnIf"><span class="hs-identifier hs-var">initTcRnIf</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'i'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682985463"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_type_env_vars"><span class="hs-identifier hs-var">hsc_type_env_vars</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Driver.Env.KnotVars.html#emptyKnotVars"><span class="hs-identifier hs-type">emptyKnotVars</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IfGblEnv
</span><a href="#local-6989586621682985466"><span class="hs-identifier hs-var">gbl_env</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IfG a
</span><a href="#local-6989586621682985464"><span class="hs-identifier hs-var">do_this</span></a></span><span>
</span><span id="line-2183"></span><span>
</span><span id="line-2184"></span><span class="hs-comment">-- | This is used when we are doing to call 'typecheckModule' on an 'ModIface',</span><span>
</span><span id="line-2185"></span><span class="hs-comment">-- if it's part of a loop with some other modules then we need to use their</span><span>
</span><span id="line-2186"></span><span class="hs-comment">-- IORef TypeEnv vars when typechecking but crucially not our own.</span><span>
</span><span id="line-2187"></span><span id="local-6989586621682983594"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initIfaceLoadModule"><span class="hs-identifier hs-type">initIfaceLoadModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfG"><span class="hs-identifier hs-type">IfG</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983594"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682983594"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2188"></span><span id="initIfaceLoadModule"><span class="annot"><span class="annottext">initIfaceLoadModule :: forall a. HscEnv -&gt; Module -&gt; IfG a -&gt; IO a
</span><a href="GHC.Tc.Utils.Monad.html#initIfaceLoadModule"><span class="hs-identifier hs-var hs-var">initIfaceLoadModule</span></a></span></span><span> </span><span id="local-6989586621682985470"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682985470"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682985471"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682985471"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span id="local-6989586621682985472"><span class="annot"><span class="annottext">IfG a
</span><a href="#local-6989586621682985472"><span class="hs-identifier hs-var">do_this</span></a></span></span><span>
</span><span id="line-2189"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682985473"><span class="annot"><span class="annottext">gbl_env :: IfGblEnv
</span><a href="#local-6989586621682985473"><span class="hs-identifier hs-var hs-var">gbl_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfGblEnv"><span class="hs-identifier hs-type">IfGblEnv</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-2190"></span><span>                        </span><span class="annot"><span class="annottext">if_doc :: SDoc
</span><a href="GHC.Tc.Types.html#if_doc"><span class="hs-identifier hs-var">if_doc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;initIfaceLoadModule&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-2191"></span><span>                        </span><span class="annot"><span class="annottext">if_rec_types :: KnotVars (IfG TypeEnv)
</span><a href="GHC.Tc.Types.html#if_rec_types"><span class="hs-identifier hs-var">if_rec_types</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef TypeEnv -&gt; IfG TypeEnv
forall (m :: * -&gt; *) a. MonadIO m =&gt; TcRef a -&gt; m a
</span><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">(IORef TypeEnv -&gt; IfG TypeEnv)
-&gt; KnotVars (IORef TypeEnv) -&gt; KnotVars (IfG TypeEnv)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Module -&gt; KnotVars (IORef TypeEnv) -&gt; KnotVars (IORef TypeEnv)
forall a. Module -&gt; KnotVars a -&gt; KnotVars a
</span><a href="GHC.Driver.Env.KnotVars.html#knotVarsWithout"><span class="hs-identifier hs-var">knotVarsWithout</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682985471"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; KnotVars (IORef TypeEnv)
</span><a href="GHC.Driver.Env.Types.html#hsc_type_env_vars"><span class="hs-identifier hs-var">hsc_type_env_vars</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682985470"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2192"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-2193"></span><span>      </span><span class="annot"><span class="annottext">Char -&gt; HscEnv -&gt; IfGblEnv -&gt; () -&gt; IfG a -&gt; IO a
forall gbl lcl a.
Char -&gt; HscEnv -&gt; gbl -&gt; lcl -&gt; TcRnIf gbl lcl a -&gt; IO a
</span><a href="GHC.Tc.Utils.Monad.html#initTcRnIf"><span class="hs-identifier hs-var">initTcRnIf</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'i'</span></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682985470"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">IfGblEnv
</span><a href="#local-6989586621682985473"><span class="hs-identifier hs-var">gbl_env</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IfG a
</span><a href="#local-6989586621682985472"><span class="hs-identifier hs-var">do_this</span></a></span><span>
</span><span id="line-2194"></span><span>
</span><span id="line-2195"></span><span id="local-6989586621682983597"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initIfaceCheck"><span class="hs-identifier hs-type">initIfaceCheck</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfG"><span class="hs-identifier hs-type">IfG</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983597"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682983597"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2196"></span><span class="hs-comment">-- Used when checking the up-to-date-ness of the old Iface</span><span>
</span><span id="line-2197"></span><span class="hs-comment">-- Initialise the environment with no useful info at all</span><span>
</span><span id="line-2198"></span><span id="initIfaceCheck"><span class="annot"><span class="annottext">initIfaceCheck :: forall a. SDoc -&gt; HscEnv -&gt; IfG a -&gt; IO a
</span><a href="GHC.Tc.Utils.Monad.html#initIfaceCheck"><span class="hs-identifier hs-var hs-var">initIfaceCheck</span></a></span></span><span> </span><span id="local-6989586621682985479"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682985479"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span id="local-6989586621682985480"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682985480"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682985481"><span class="annot"><span class="annottext">IfG a
</span><a href="#local-6989586621682985481"><span class="hs-identifier hs-var">do_this</span></a></span></span><span>
</span><span id="line-2199"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682985482"><span class="annot"><span class="annottext">gbl_env :: IfGblEnv
</span><a href="#local-6989586621682985482"><span class="hs-identifier hs-var hs-var">gbl_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfGblEnv"><span class="hs-identifier hs-type">IfGblEnv</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-2200"></span><span>                        </span><span class="annot"><span class="annottext">if_doc :: SDoc
</span><a href="GHC.Tc.Types.html#if_doc"><span class="hs-identifier hs-var">if_doc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;initIfaceCheck&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682985479"><span class="hs-identifier hs-var">doc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-2201"></span><span>                        </span><span class="annot"><span class="annottext">if_rec_types :: KnotVars (IfG TypeEnv)
</span><a href="GHC.Tc.Types.html#if_rec_types"><span class="hs-identifier hs-var">if_rec_types</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef TypeEnv -&gt; IfG TypeEnv
forall (m :: * -&gt; *) a. MonadIO m =&gt; TcRef a -&gt; m a
</span><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">(IORef TypeEnv -&gt; IfG TypeEnv)
-&gt; KnotVars (IORef TypeEnv) -&gt; KnotVars (IfG TypeEnv)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; KnotVars (IORef TypeEnv)
</span><a href="GHC.Driver.Env.Types.html#hsc_type_env_vars"><span class="hs-identifier hs-var">hsc_type_env_vars</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682985480"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2202"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-2203"></span><span>      </span><span class="annot"><span class="annottext">Char -&gt; HscEnv -&gt; IfGblEnv -&gt; () -&gt; IfG a -&gt; IO a
forall gbl lcl a.
Char -&gt; HscEnv -&gt; gbl -&gt; lcl -&gt; TcRnIf gbl lcl a -&gt; IO a
</span><a href="GHC.Tc.Utils.Monad.html#initTcRnIf"><span class="hs-identifier hs-var">initTcRnIf</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'i'</span></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682985480"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">IfGblEnv
</span><a href="#local-6989586621682985482"><span class="hs-identifier hs-var">gbl_env</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IfG a
</span><a href="#local-6989586621682985481"><span class="hs-identifier hs-var">do_this</span></a></span><span>
</span><span id="line-2204"></span><span>
</span><span id="line-2205"></span><span id="local-6989586621682983599"><span id="local-6989586621682983601"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initIfaceLcl"><span class="hs-identifier hs-type">initIfaceLcl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#IsBootInterface"><span class="hs-identifier hs-type">IsBootInterface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfL"><span class="hs-identifier hs-type">IfL</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983599"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfM"><span class="hs-identifier hs-type">IfM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983601"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983599"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-2206"></span><span id="initIfaceLcl"><span class="annot"><span class="annottext">initIfaceLcl :: forall a lcl.
Module -&gt; SDoc -&gt; IsBootInterface -&gt; IfL a -&gt; IfM lcl a
</span><a href="GHC.Tc.Utils.Monad.html#initIfaceLcl"><span class="hs-identifier hs-var hs-var">initIfaceLcl</span></a></span></span><span> </span><span id="local-6989586621682985483"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682985483"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span id="local-6989586621682985484"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682985484"><span class="hs-identifier hs-var">loc_doc</span></a></span></span><span> </span><span id="local-6989586621682985485"><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621682985485"><span class="hs-identifier hs-var">hi_boot_file</span></a></span></span><span> </span><span id="local-6989586621682985486"><span class="annot"><span class="annottext">IfL a
</span><a href="#local-6989586621682985486"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-2207"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IfLclEnv -&gt; IfL a -&gt; TcRnIf IfGblEnv lcl a
forall lcl' gbl a lcl.
lcl' -&gt; TcRnIf gbl lcl' a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#setLclEnv"><span class="hs-identifier hs-var">setLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; SDoc -&gt; IsBootInterface -&gt; IfLclEnv
</span><a href="GHC.Tc.Utils.Monad.html#mkIfLclEnv"><span class="hs-identifier hs-var">mkIfLclEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682985483"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682985484"><span class="hs-identifier hs-var">loc_doc</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621682985485"><span class="hs-identifier hs-var">hi_boot_file</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IfL a
</span><a href="#local-6989586621682985486"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-2208"></span><span>
</span><span id="line-2209"></span><span class="hs-comment">-- | Initialize interface typechecking, but with a 'NameShape'</span><span>
</span><span id="line-2210"></span><span class="hs-comment">-- to apply when typechecking top-level 'OccName's (see</span><span>
</span><span id="line-2211"></span><span class="hs-comment">-- 'lookupIfaceTop')</span><span>
</span><span id="line-2212"></span><span id="local-6989586621682983605"><span id="local-6989586621682983606"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initIfaceLclWithSubst"><span class="hs-identifier hs-type">initIfaceLclWithSubst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#IsBootInterface"><span class="hs-identifier hs-type">IsBootInterface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#NameShape"><span class="hs-identifier hs-type">NameShape</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfL"><span class="hs-identifier hs-type">IfL</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983605"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfM"><span class="hs-identifier hs-type">IfM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983606"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983605"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-2213"></span><span id="initIfaceLclWithSubst"><span class="annot"><span class="annottext">initIfaceLclWithSubst :: forall a lcl.
Module
-&gt; SDoc -&gt; IsBootInterface -&gt; NameShape -&gt; IfL a -&gt; IfM lcl a
</span><a href="GHC.Tc.Utils.Monad.html#initIfaceLclWithSubst"><span class="hs-identifier hs-var hs-var">initIfaceLclWithSubst</span></a></span></span><span> </span><span id="local-6989586621682985488"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682985488"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span id="local-6989586621682985489"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682985489"><span class="hs-identifier hs-var">loc_doc</span></a></span></span><span> </span><span id="local-6989586621682985490"><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621682985490"><span class="hs-identifier hs-var">hi_boot_file</span></a></span></span><span> </span><span id="local-6989586621682985491"><span class="annot"><span class="annottext">NameShape
</span><a href="#local-6989586621682985491"><span class="hs-identifier hs-var">nsubst</span></a></span></span><span> </span><span id="local-6989586621682985492"><span class="annot"><span class="annottext">IfL a
</span><a href="#local-6989586621682985492"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-2214"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IfLclEnv -&gt; IfL a -&gt; TcRnIf IfGblEnv lcl a
forall lcl' gbl a lcl.
lcl' -&gt; TcRnIf gbl lcl' a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#setLclEnv"><span class="hs-identifier hs-var">setLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; SDoc -&gt; IsBootInterface -&gt; IfLclEnv
</span><a href="GHC.Tc.Utils.Monad.html#mkIfLclEnv"><span class="hs-identifier hs-var">mkIfLclEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682985488"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682985489"><span class="hs-identifier hs-var">loc_doc</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621682985490"><span class="hs-identifier hs-var">hi_boot_file</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#if_nsubst"><span class="hs-identifier hs-var">if_nsubst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621682985491"><span class="hs-identifier hs-type">nsubst</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IfL a
</span><a href="#local-6989586621682985492"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-2215"></span><span>
</span><span id="line-2216"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getIfModule"><span class="hs-identifier hs-type">getIfModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfL"><span class="hs-identifier hs-type">IfL</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-2217"></span><span id="getIfModule"><span class="annot"><span class="annottext">getIfModule :: IfL Module
</span><a href="GHC.Tc.Utils.Monad.html#getIfModule"><span class="hs-identifier hs-var hs-var">getIfModule</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985493"><span class="annot"><a href="#local-6989586621682985493"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf IfGblEnv IfLclEnv IfLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#if_mod"><span class="hs-identifier hs-var">if_mod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985493"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2218"></span><span>
</span><span id="line-2219"></span><span class="hs-comment">--------------------</span><span>
</span><span id="line-2220"></span><span id="local-6989586621682983609"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failIfM"><span class="hs-identifier hs-type">failIfM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfL"><span class="hs-identifier hs-type">IfL</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983609"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2221"></span><span class="hs-comment">-- The Iface monad doesn't have a place to accumulate errors, so we</span><span>
</span><span id="line-2222"></span><span class="hs-comment">-- just fall over fast if one happens; it &quot;shouldn't happen&quot;.</span><span>
</span><span id="line-2223"></span><span class="hs-comment">-- We use IfL here so that we can get context info out of the local env</span><span>
</span><span id="line-2224"></span><span id="failIfM"><span class="annot"><span class="annottext">failIfM :: forall a. SDoc -&gt; IfL a
</span><a href="GHC.Tc.Utils.Monad.html#failIfM"><span class="hs-identifier hs-var hs-var">failIfM</span></a></span></span><span> </span><span id="local-6989586621682985503"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682985503"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2225"></span><span>    </span><span id="local-6989586621682985504"><span class="annot"><a href="#local-6989586621682985504"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf IfGblEnv IfLclEnv IfLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span>
</span><span id="line-2226"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682985505"><span class="annot"><a href="#local-6989586621682985505"><span class="hs-identifier hs-var hs-var">full_msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IfLclEnv -&gt; SDoc
</span><a href="GHC.Tc.Types.html#if_loc"><span class="hs-identifier hs-var">if_loc</span></a></span><span> </span><span class="annot"><span class="annottext">IfLclEnv
</span><a href="#local-6989586621682985504"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682985503"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-2227"></span><span>    </span><span id="local-6989586621682985509"><span class="annot"><a href="#local-6989586621682985509"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#getLogger"><span class="hs-identifier hs-type">getLogger</span></a></span><span>
</span><span id="line-2228"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Logger.html#logMsg"><span class="hs-identifier hs-type">logMsg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985509"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Error.html#MCFatal"><span class="hs-identifier hs-type">MCFatal</span></a></span><span>
</span><span id="line-2229"></span><span>             </span><span class="annot"><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-type">noSrcSpan</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#withPprStyle"><span class="hs-identifier hs-type">withPprStyle</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#defaultErrStyle"><span class="hs-identifier hs-type">defaultErrStyle</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985505"><span class="hs-identifier hs-type">full_msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2230"></span><span>    </span><span class="annot"><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-type">failM</span></a></span><span>
</span><span id="line-2231"></span><span>
</span><span id="line-2232"></span><span class="hs-comment">--------------------</span><span>
</span><span id="line-2233"></span><span>
</span><span id="line-2234"></span><span class="hs-comment">-- | Run thing_inside in an interleaved thread.</span><span>
</span><span id="line-2235"></span><span class="hs-comment">-- It shares everything with the parent thread, so this is DANGEROUS.</span><span>
</span><span id="line-2236"></span><span class="hs-comment">--</span><span>
</span><span id="line-2237"></span><span class="hs-comment">-- It throws an error if the computation fails</span><span>
</span><span id="line-2238"></span><span class="hs-comment">--</span><span>
</span><span id="line-2239"></span><span class="hs-comment">-- It's used for lazily type-checking interface</span><span>
</span><span id="line-2240"></span><span class="hs-comment">-- signatures, which is pretty benign.</span><span>
</span><span id="line-2241"></span><span class="hs-comment">--</span><span>
</span><span id="line-2242"></span><span class="hs-comment">-- See Note [Masking exceptions in forkM]</span><span>
</span><span id="line-2243"></span><span id="local-6989586621682983612"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#forkM"><span class="hs-identifier hs-type">forkM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfL"><span class="hs-identifier hs-type">IfL</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983612"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfL"><span class="hs-identifier hs-type">IfL</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983612"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2244"></span><span id="forkM"><span class="annot"><span class="annottext">forkM :: forall a. SDoc -&gt; IfL a -&gt; IfL a
</span><a href="GHC.Tc.Utils.Monad.html#forkM"><span class="hs-identifier hs-var hs-var">forkM</span></a></span></span><span> </span><span id="local-6989586621682985539"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682985539"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span id="local-6989586621682985540"><span class="annot"><span class="annottext">IfL a
</span><a href="#local-6989586621682985540"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-2245"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IfL a -&gt; IfL a
forall env a. IOEnv env a -&gt; IOEnv env a
</span><a href="GHC.Data.IOEnv.html#unsafeInterleaveM"><span class="hs-identifier hs-var">unsafeInterleaveM</span></a></span><span> </span><span class="annot"><span class="annottext">(IfL a -&gt; IfL a) -&gt; IfL a -&gt; IfL a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IfL a -&gt; IfL a
forall env a. IOEnv env a -&gt; IOEnv env a
</span><a href="GHC.Data.IOEnv.html#uninterruptibleMaskM_"><span class="hs-identifier hs-var">uninterruptibleMaskM_</span></a></span><span> </span><span class="annot"><span class="annottext">(IfL a -&gt; IfL a) -&gt; IfL a -&gt; IfL a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2246"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; IOEnv (Env IfGblEnv IfLclEnv) ()
forall m n. SDoc -&gt; TcRnIf m n ()
</span><a href="GHC.Tc.Utils.Monad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Starting fork {&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682985539"><span class="hs-identifier hs-var">doc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2247"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682985543"><span class="annot"><a href="#local-6989586621682985543"><span class="hs-identifier hs-var">mb_res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IfL a -&gt; IOEnv (Env IfGblEnv IfLclEnv) (Either IOEnvFailure a)
forall env r. IOEnv env r -&gt; IOEnv env (Either IOEnvFailure r)
</span><a href="GHC.Data.IOEnv.html#tryM"><span class="hs-identifier hs-var">tryM</span></a></span><span> </span><span class="annot"><span class="annottext">(IfL a -&gt; IOEnv (Env IfGblEnv IfLclEnv) (Either IOEnvFailure a))
-&gt; IfL a -&gt; IOEnv (Env IfGblEnv IfLclEnv) (Either IOEnvFailure a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2248"></span><span>                   </span><span class="annot"><span class="annottext">(IfLclEnv -&gt; IfLclEnv) -&gt; IfL a -&gt; IfL a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682985544"><span class="annot"><span class="annottext">IfLclEnv
</span><a href="#local-6989586621682985544"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IfLclEnv
</span><a href="#local-6989586621682985544"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#if_loc"><span class="hs-identifier hs-var">if_loc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#if_loc"><span class="hs-identifier hs-var">if_loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985544"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985539"><span class="hs-identifier hs-type">doc</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IfL a -&gt; IfL a) -&gt; IfL a -&gt; IfL a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2249"></span><span>                   </span><span class="annot"><span class="annottext">IfL a
</span><a href="#local-6989586621682985540"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-2250"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682985543"><span class="hs-identifier hs-type">mb_res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2251"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621682985545"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682985545"><span class="hs-identifier hs-var">r</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; IOEnv (Env IfGblEnv IfLclEnv) ()
forall m n. SDoc -&gt; TcRnIf m n ()
</span><a href="GHC.Tc.Utils.Monad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;} ending fork&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682985539"><span class="hs-identifier hs-var">doc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2252"></span><span>                            </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">a -&gt; IfL a
forall a. a -&gt; IOEnv (Env IfGblEnv IfLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682985545"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2253"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621682985546"><span class="annot"><span class="annottext">IOEnvFailure
</span><a href="#local-6989586621682985546"><span class="hs-identifier hs-var">exn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-2254"></span><span>                </span><span class="hs-comment">-- Bleat about errors in the forked thread, if -ddump-if-trace is on</span><span>
</span><span id="line-2255"></span><span>                </span><span class="hs-comment">-- Otherwise we silently discard errors. Errors can legitimately</span><span>
</span><span id="line-2256"></span><span>                </span><span class="hs-comment">-- happen when compiling interface signatures.</span><span>
</span><span id="line-2257"></span><span>                  </span><span class="annot"><span class="annottext">DumpFlag
-&gt; IOEnv (Env IfGblEnv IfLclEnv) ()
-&gt; IOEnv (Env IfGblEnv IfLclEnv) ()
forall gbl lcl. DumpFlag -&gt; TcRnIf gbl lcl () -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#whenDOptM"><span class="hs-identifier hs-var">whenDOptM</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_if_trace"><span class="hs-identifier hs-var">Opt_D_dump_if_trace</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env IfGblEnv IfLclEnv) ()
 -&gt; IOEnv (Env IfGblEnv IfLclEnv) ())
-&gt; IOEnv (Env IfGblEnv IfLclEnv) ()
-&gt; IOEnv (Env IfGblEnv IfLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2258"></span><span>                      </span><span id="local-6989586621682985547"><span class="annot"><a href="#local-6989586621682985547"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env IfGblEnv IfLclEnv) Logger
forall (m :: * -&gt; *). HasLogger m =&gt; m Logger
</span><a href="GHC.Utils.Logger.html#getLogger"><span class="hs-identifier hs-var">getLogger</span></a></span><span>
</span><span id="line-2259"></span><span>                      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682985548"><span class="annot"><a href="#local-6989586621682985548"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;forkM failed:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682985539"><span class="hs-identifier hs-var">doc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2260"></span><span>                                   </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IOEnvFailure -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">IOEnvFailure
</span><a href="#local-6989586621682985546"><span class="hs-identifier hs-var">exn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2261"></span><span>                      </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#logMsg"><span class="hs-identifier hs-type">logMsg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985547"><span class="hs-identifier hs-type">logger</span></a></span><span>
</span><span id="line-2262"></span><span>                                         </span><span class="annot"><a href="GHC.Types.Error.html#MCFatal"><span class="hs-identifier hs-type">MCFatal</span></a></span><span>
</span><span id="line-2263"></span><span>                                         </span><span class="annot"><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-type">noSrcSpan</span></a></span><span>
</span><span id="line-2264"></span><span>                                         </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#withPprStyle"><span class="hs-identifier hs-type">withPprStyle</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#defaultErrStyle"><span class="hs-identifier hs-type">defaultErrStyle</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985548"><span class="hs-identifier hs-type">msg</span></a></span><span>
</span><span id="line-2265"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; IOEnv (Env IfGblEnv IfLclEnv) ()
forall m n. SDoc -&gt; TcRnIf m n ()
</span><a href="GHC.Tc.Utils.Monad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;} ending fork (badly)&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682985539"><span class="hs-identifier hs-var">doc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2266"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IfL a
forall a. HasCallStack =&gt; FilePath -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#pgmError"><span class="hs-identifier hs-var">pgmError</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Cannot continue after interface file error&quot;</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2267"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-2268"></span><span>
</span><span id="line-2269"></span><span id="local-6989586621682983618"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setImplicitEnvM"><span class="hs-identifier hs-type">setImplicitEnvM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.TypeEnv.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfL"><span class="hs-identifier hs-type">IfL</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983618"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfL"><span class="hs-identifier hs-type">IfL</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983618"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2270"></span><span id="setImplicitEnvM"><span class="annot"><span class="annottext">setImplicitEnvM :: forall a. TypeEnv -&gt; IfL a -&gt; IfL a
</span><a href="GHC.Tc.Utils.Monad.html#setImplicitEnvM"><span class="hs-identifier hs-var hs-var">setImplicitEnvM</span></a></span></span><span> </span><span id="local-6989586621682985551"><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621682985551"><span class="hs-identifier hs-var">tenv</span></a></span></span><span> </span><span id="local-6989586621682985552"><span class="annot"><span class="annottext">IfL a
</span><a href="#local-6989586621682985552"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IfLclEnv -&gt; IfLclEnv) -&gt; IfL a -&gt; IfL a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682985553"><span class="annot"><span class="annottext">IfLclEnv
</span><a href="#local-6989586621682985553"><span class="hs-identifier hs-var">lcl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IfLclEnv
</span><a href="#local-6989586621682985553"><span class="hs-identifier hs-var">lcl</span></a></span><span>
</span><span id="line-2271"></span><span>                                     </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#if_implicits_env"><span class="hs-identifier hs-var">if_implicits_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621682985551"><span class="hs-identifier hs-type">tenv</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IfL a
</span><a href="#local-6989586621682985552"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-2272"></span><span>
</span><span id="line-2273"></span><span class="hs-comment">{-
Note [Masking exceptions in forkM]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

When using GHC-as-API it must be possible to interrupt snippets of code
executed using runStmt (#1381). Since commit 02c4ab04 this is almost possible
by throwing an asynchronous interrupt to the GHC thread. However, there is a
subtle problem: runStmt first typechecks the code before running it, and the
exception might interrupt the type checker rather than the code. Moreover, the
typechecker might be inside an unsafeInterleaveIO (through forkM), and
more importantly might be inside an exception handler inside that
unsafeInterleaveIO. If that is the case, the exception handler will rethrow the
asynchronous exception as a synchronous exception, and the exception will end
up as the value of the unsafeInterleaveIO thunk (see #8006 for a detailed
discussion).  We don't currently know a general solution to this problem, but
we can use uninterruptibleMask_ to avoid the situation.
-}</span><span>
</span><span id="line-2290"></span><span>
</span><span id="line-2291"></span><span class="annot"><span class="hs-comment">-- | Get the next cost centre index associated with a given name.</span></span><span>
</span><span id="line-2292"></span><span id="local-6989586621682983620"><span id="local-6989586621682983621"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getCCIndexM"><span class="hs-identifier hs-type">getCCIndexM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682983620"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a></span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.State.html#CostCentreState"><span class="hs-identifier hs-type">CostCentreState</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983620"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983621"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.State.html#CostCentreIndex"><span class="hs-identifier hs-type">CostCentreIndex</span></a></span></span></span><span>
</span><span id="line-2293"></span><span id="getCCIndexM"><span class="annot"><span class="annottext">getCCIndexM :: forall gbl lcl.
(gbl -&gt; IORef CostCentreState)
-&gt; FastString -&gt; TcRnIf gbl lcl CostCentreIndex
</span><a href="GHC.Tc.Utils.Monad.html#getCCIndexM"><span class="hs-identifier hs-var hs-var">getCCIndexM</span></a></span></span><span> </span><span id="local-6989586621682985560"><span class="annot"><span class="annottext">gbl -&gt; IORef CostCentreState
</span><a href="#local-6989586621682985560"><span class="hs-identifier hs-var">get_ccs</span></a></span></span><span> </span><span id="local-6989586621682985561"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682985561"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2294"></span><span>  </span><span id="local-6989586621682985562"><span class="annot"><a href="#local-6989586621682985562"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf gbl lcl gbl
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-2295"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682985563"><span class="annot"><a href="#local-6989586621682985563"><span class="hs-identifier hs-var hs-var">cc_st_ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">gbl -&gt; IORef CostCentreState
</span><a href="#local-6989586621682985560"><span class="hs-identifier hs-var">get_ccs</span></a></span><span> </span><span class="annot"><span class="annottext">gbl
</span><a href="#local-6989586621682985562"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-2296"></span><span>  </span><span id="local-6989586621682985564"><span class="annot"><a href="#local-6989586621682985564"><span class="hs-identifier hs-var">cc_st</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-type">readTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985563"><span class="hs-identifier hs-type">cc_st_ref</span></a></span><span>
</span><span id="line-2297"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682985565"><span class="annot"><a href="#local-6989586621682985565"><span class="hs-identifier hs-var">idx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682985566"><span class="annot"><a href="#local-6989586621682985566"><span class="hs-identifier hs-var">cc_st'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.State.html#getCCIndex"><span class="hs-identifier hs-type">getCCIndex</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985561"><span class="hs-identifier hs-type">nm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985564"><span class="hs-identifier hs-type">cc_st</span></a></span><span>
</span><span id="line-2298"></span><span>  </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#writeTcRef"><span class="hs-identifier hs-type">writeTcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985563"><span class="hs-identifier hs-type">cc_st_ref</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985566"><span class="hs-identifier hs-type">cc_st'</span></a></span><span>
</span><span id="line-2299"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682985565"><span class="hs-identifier hs-type">idx</span></a></span><span>
</span><span id="line-2300"></span><span>
</span><span id="line-2301"></span><span class="annot"><span class="hs-comment">-- | See 'getCCIndexM'.</span></span><span>
</span><span id="line-2302"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getCCIndexTcM"><span class="hs-identifier hs-type">getCCIndexTcM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.State.html#CostCentreIndex"><span class="hs-identifier hs-type">CostCentreIndex</span></a></span><span>
</span><span id="line-2303"></span><span id="getCCIndexTcM"><span class="annot"><span class="annottext">getCCIndexTcM :: FastString -&gt; TcM CostCentreIndex
</span><a href="GHC.Tc.Utils.Monad.html#getCCIndexTcM"><span class="hs-identifier hs-var hs-var">getCCIndexTcM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcGblEnv -&gt; IORef CostCentreState)
-&gt; FastString -&gt; TcM CostCentreIndex
forall gbl lcl.
(gbl -&gt; IORef CostCentreState)
-&gt; FastString -&gt; TcRnIf gbl lcl CostCentreIndex
</span><a href="GHC.Tc.Utils.Monad.html#getCCIndexM"><span class="hs-identifier hs-var">getCCIndexM</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; IORef CostCentreState
</span><a href="GHC.Tc.Types.html#tcg_cc_st"><span class="hs-identifier hs-var">tcg_cc_st</span></a></span><span>
</span><span id="line-2304"></span><span>
</span><span id="line-2305"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-2306"></span><span>
</span><span id="line-2307"></span><span class="hs-comment">-- | Lift a computation from the dedicated zonking monad 'ZonkM' to the</span><span>
</span><span id="line-2308"></span><span class="hs-comment">-- full-fledged 'TcM' monad.</span><span>
</span><span id="line-2309"></span><span id="local-6989586621682983454"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-type">liftZonkM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983454"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682983454"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2310"></span><span id="liftZonkM"><span class="annot"><span class="annottext">liftZonkM :: forall a. ZonkM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-var hs-var">liftZonkM</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span id="local-6989586621682985577"><span class="annot"><span class="annottext">ZonkGblEnv -&gt; IO a
</span><a href="#local-6989586621682985577"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2311"></span><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985578"><span class="annot"><a href="#local-6989586621682985578"><span class="hs-identifier hs-var">logger</span></a></span></span><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) Logger
forall (m :: * -&gt; *). HasLogger m =&gt; m Logger
</span><a href="GHC.Utils.Logger.html#getLogger"><span class="hs-identifier hs-var">getLogger</span></a></span><span>
</span><span id="line-2312"></span><span>     </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682985579"><span class="annot"><a href="#local-6989586621682985579"><span class="hs-identifier hs-var">name_ppr_ctx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getNamePprCtx"><span class="hs-identifier hs-type">getNamePprCtx</span></a></span><span>
</span><span id="line-2313"></span><span>     </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682985580"><span class="annot"><a href="#local-6989586621682985580"><span class="hs-identifier hs-var">lvl</span></a></span></span><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getTcLevel"><span class="hs-identifier hs-type">getTcLevel</span></a></span><span>
</span><span id="line-2314"></span><span>     </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682985581"><span class="annot"><a href="#local-6989586621682985581"><span class="hs-identifier hs-var">src_span</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-type">getSrcSpanM</span></a></span><span>
</span><span id="line-2315"></span><span>     </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682985582"><span class="annot"><a href="#local-6989586621682985582"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#getLclEnvBinderStack"><span class="hs-identifier hs-type">getLclEnvBinderStack</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-type">getLclEnv</span></a></span><span>
</span><span id="line-2316"></span><span>     </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682985583"><span class="annot"><a href="#local-6989586621682985583"><span class="hs-identifier hs-var hs-var">zge</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkGblEnv"><span class="hs-identifier hs-type">ZonkGblEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">zge_logger :: Logger
</span><a href="GHC.Tc.Zonk.Monad.html#zge_logger"><span class="hs-identifier hs-var">zge_logger</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682985578"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-2317"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">zge_name_ppr_ctx :: NamePprCtx
</span><a href="GHC.Tc.Zonk.Monad.html#zge_name_ppr_ctx"><span class="hs-identifier hs-var">zge_name_ppr_ctx</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NamePprCtx
</span><a href="#local-6989586621682985579"><span class="hs-identifier hs-var">name_ppr_ctx</span></a></span><span>
</span><span id="line-2318"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">zge_src_span :: SrcSpan
</span><a href="GHC.Tc.Zonk.Monad.html#zge_src_span"><span class="hs-identifier hs-var">zge_src_span</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682985581"><span class="hs-identifier hs-var">src_span</span></a></span><span>
</span><span id="line-2319"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">zge_tc_level :: TcLevel
</span><a href="GHC.Tc.Zonk.Monad.html#zge_tc_level"><span class="hs-identifier hs-var">zge_tc_level</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682985580"><span class="hs-identifier hs-var">lvl</span></a></span><span>
</span><span id="line-2320"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">zge_binder_stack :: TcBinderStack
</span><a href="GHC.Tc.Zonk.Monad.html#zge_binder_stack"><span class="hs-identifier hs-var">zge_binder_stack</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcBinderStack
</span><a href="#local-6989586621682985582"><span class="hs-identifier hs-var">bndrs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2321"></span><span>     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682985577"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985583"><span class="hs-identifier hs-type">zge</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2322"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-pragma hs-type">liftZonkM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-2323"></span><span>
</span><span id="line-2324"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-2325"></span><span>
</span><span id="line-2326"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getCompleteMatchesTcM"><span class="hs-identifier hs-type">getCompleteMatchesTcM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.CompleteMatch.html#CompleteMatches"><span class="hs-identifier hs-type">CompleteMatches</span></a></span><span>
</span><span id="line-2327"></span><span id="getCompleteMatchesTcM"><span class="annot"><span class="annottext">getCompleteMatchesTcM :: TcM CompleteMatches
</span><a href="GHC.Tc.Utils.Monad.html#getCompleteMatchesTcM"><span class="hs-identifier hs-var hs-var">getCompleteMatchesTcM</span></a></span></span><span>
</span><span id="line-2328"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682985590"><span class="annot"><a href="#local-6989586621682985590"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span>
</span><span id="line-2329"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682985591"><span class="annot"><a href="#local-6989586621682985591"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-type">getGblEnv</span></a></span><span>
</span><span id="line-2330"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682985592"><span class="annot"><a href="#local-6989586621682985592"><span class="hs-identifier hs-var">eps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#hscEPS"><span class="hs-identifier hs-type">hscEPS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985590"><span class="hs-identifier hs-type">hsc_env</span></a></span><span>
</span><span id="line-2331"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#localAndImportedCompleteMatches"><span class="hs-identifier hs-type">localAndImportedCompleteMatches</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#tcg_complete_matches"><span class="hs-identifier hs-var">tcg_complete_matches</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985591"><span class="hs-identifier hs-type">tcg_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682985590"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682985592"><span class="hs-identifier hs-type">eps</span></a></span><span>
</span><span id="line-2332"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-2333"></span><span>
</span><span id="line-2334"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#localAndImportedCompleteMatches"><span class="hs-identifier hs-type">localAndImportedCompleteMatches</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.CompleteMatch.html#CompleteMatches"><span class="hs-identifier hs-type">CompleteMatches</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.External.html#ExternalPackageState"><span class="hs-identifier hs-type">ExternalPackageState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.CompleteMatch.html#CompleteMatches"><span class="hs-identifier hs-type">CompleteMatches</span></a></span><span>
</span><span id="line-2335"></span><span id="localAndImportedCompleteMatches"><span class="annot"><span class="annottext">localAndImportedCompleteMatches :: CompleteMatches
-&gt; HscEnv -&gt; ExternalPackageState -&gt; CompleteMatches
</span><a href="GHC.Tc.Utils.Monad.html#localAndImportedCompleteMatches"><span class="hs-identifier hs-var hs-var">localAndImportedCompleteMatches</span></a></span></span><span> </span><span id="local-6989586621682985593"><span class="annot"><span class="annottext">CompleteMatches
</span><a href="#local-6989586621682985593"><span class="hs-identifier hs-var">tcg_comps</span></a></span></span><span> </span><span id="local-6989586621682985594"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682985594"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682985595"><span class="annot"><span class="annottext">ExternalPackageState
</span><a href="#local-6989586621682985595"><span class="hs-identifier hs-var">eps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2336"></span><span>     </span><span class="annot"><span class="annottext">CompleteMatches
</span><a href="#local-6989586621682985593"><span class="hs-identifier hs-var">tcg_comps</span></a></span><span>                </span><span class="hs-comment">-- from the current module</span><span>
</span><span id="line-2337"></span><span>  </span><span class="annot"><span class="annottext">CompleteMatches -&gt; CompleteMatches -&gt; CompleteMatches
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; CompleteMatches
</span><a href="GHC.Driver.Env.html#hptCompleteSigs"><span class="hs-identifier hs-var">hptCompleteSigs</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682985594"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>  </span><span class="hs-comment">-- from the home package</span><span>
</span><span id="line-2338"></span><span>  </span><span class="annot"><span class="annottext">CompleteMatches -&gt; CompleteMatches -&gt; CompleteMatches
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ExternalPackageState -&gt; CompleteMatches
</span><a href="GHC.Unit.External.html#eps_complete_matches"><span class="hs-identifier hs-var">eps_complete_matches</span></a></span><span> </span><span class="annot"><span class="annottext">ExternalPackageState
</span><a href="#local-6989586621682985595"><span class="hs-identifier hs-var">eps</span></a></span><span> </span><span class="hs-comment">-- from imports</span><span>
</span><span id="line-2339"></span></pre></body></html>