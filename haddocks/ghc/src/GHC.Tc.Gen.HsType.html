<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds           #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts    #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE MonadComprehensions #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes          #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies        #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns        #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE RecursiveDo        #-}</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-incomplete-uni-patterns #-}</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998

-}</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="annot"><span class="hs-comment">-- | Typechecking user-specified @MonoTypes@</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html"><span class="hs-identifier">GHC.Tc.Gen.HsType</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-20"></span><span>        </span><span class="hs-comment">-- Type signatures</span><span>
</span><span id="line-21"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#kcClassSigType"><span class="hs-identifier">kcClassSigType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcClassSigType"><span class="hs-identifier">tcClassSigType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsSigType"><span class="hs-identifier">tcHsSigType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsSigWcType"><span class="hs-identifier">tcHsSigWcType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsPartialSigType"><span class="hs-identifier">tcHsPartialSigType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcStandaloneKindSig"><span class="hs-identifier">tcStandaloneKindSig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#funsSigCtxt"><span class="hs-identifier">funsSigCtxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#addSigCtxt"><span class="hs-identifier">addSigCtxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#pprSigCtxt"><span class="hs-identifier">pprSigCtxt</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsClsInstType"><span class="hs-identifier">tcHsClsInstType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsDefault"><span class="hs-identifier">tcHsDefault</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsDeriv"><span class="hs-identifier">tcHsDeriv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcDerivStrategy"><span class="hs-identifier">tcDerivStrategy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsTypeApp"><span class="hs-identifier">tcHsTypeApp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>        </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#UserTypeCtxt"><span class="hs-identifier">UserTypeCtxt</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindImplicitTKBndrs_Tv"><span class="hs-identifier">bindImplicitTKBndrs_Tv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindImplicitTKBndrs_Skol"><span class="hs-identifier">bindImplicitTKBndrs_Skol</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>            </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindImplicitTKBndrs_Q_Tv"><span class="hs-identifier">bindImplicitTKBndrs_Q_Tv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindImplicitTKBndrs_Q_Skol"><span class="hs-identifier">bindImplicitTKBndrs_Q_Skol</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindExplicitTKBndrs_Tv"><span class="hs-identifier">bindExplicitTKBndrs_Tv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindExplicitTKBndrs_Skol"><span class="hs-identifier">bindExplicitTKBndrs_Skol</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>            </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindExplicitTKBndrs_Q_Tv"><span class="hs-identifier">bindExplicitTKBndrs_Q_Tv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindExplicitTKBndrs_Q_Skol"><span class="hs-identifier">bindExplicitTKBndrs_Q_Skol</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindOuterFamEqnTKBndrs_Q_Tv"><span class="hs-identifier">bindOuterFamEqnTKBndrs_Q_Tv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindOuterFamEqnTKBndrs"><span class="hs-identifier">bindOuterFamEqnTKBndrs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcOuterTKBndrs"><span class="hs-identifier">tcOuterTKBndrs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#scopedSortOuter"><span class="hs-identifier">scopedSortOuter</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#outerTyVars"><span class="hs-identifier">outerTyVars</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#outerTyVarBndrs"><span class="hs-identifier">outerTyVarBndrs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindOuterSigTKBndrs_Tv"><span class="hs-identifier">bindOuterSigTKBndrs_Tv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcExplicitTKBndrs"><span class="hs-identifier">tcExplicitTKBndrs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindNamedWildCardBinders"><span class="hs-identifier">bindNamedWildCardBinders</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span>        </span><span class="hs-comment">-- Type checking type and class decls, and instances thereof</span><span>
</span><span id="line-43"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindTyClTyVars"><span class="hs-identifier">bindTyClTyVars</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindTyClTyVarsAndZonk"><span class="hs-identifier">bindTyClTyVarsAndZonk</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcFamTyPats"><span class="hs-identifier">tcFamTyPats</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#etaExpandAlgTyCon"><span class="hs-identifier">etaExpandAlgTyCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcbVisibilities"><span class="hs-identifier">tcbVisibilities</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span>          </span><span class="hs-comment">-- tyvars</span><span>
</span><span id="line-48"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#zonkAndScopedSort"><span class="hs-identifier">zonkAndScopedSort</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span>        </span><span class="hs-comment">-- Kind-checking types</span><span>
</span><span id="line-51"></span><span>        </span><span class="hs-comment">-- No kind generalisation, no checkValidType</span><span>
</span><span id="line-52"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#InitialKindStrategy"><span class="hs-identifier">InitialKindStrategy</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SAKS_or_CUSK"><span class="hs-identifier">SAKS_or_CUSK</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#ContextKind"><span class="hs-identifier">ContextKind</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#kcDeclHeader"><span class="hs-identifier">kcDeclHeader</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#checkForDuplicateScopedTyVars"><span class="hs-identifier">checkForDuplicateScopedTyVars</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsLiftedType"><span class="hs-identifier">tcHsLiftedType</span></a></span><span class="hs-special">,</span><span>   </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsOpenType"><span class="hs-identifier">tcHsOpenType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsLiftedTypeNC"><span class="hs-identifier">tcHsLiftedTypeNC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsOpenTypeNC"><span class="hs-identifier">tcHsOpenTypeNC</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcInferLHsType"><span class="hs-identifier">tcInferLHsType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcInferLHsTypeKind"><span class="hs-identifier">tcInferLHsTypeKind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcInferLHsTypeUnsaturated"><span class="hs-identifier">tcInferLHsTypeUnsaturated</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcCheckLHsTypeInContext"><span class="hs-identifier">tcCheckLHsTypeInContext</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcCheckLHsType"><span class="hs-identifier">tcCheckLHsType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsContext"><span class="hs-identifier">tcHsContext</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcLHsPredType"><span class="hs-identifier">tcLHsPredType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#kindGeneralizeAll"><span class="hs-identifier">kindGeneralizeAll</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span>        </span><span class="hs-comment">-- Sort-checking kinds</span><span>
</span><span id="line-65"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcLHsKindSig"><span class="hs-identifier">tcLHsKindSig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#checkDataKindSig"><span class="hs-identifier">checkDataKindSig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#DataSort"><span class="hs-identifier">DataSort</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#checkClassKindSig"><span class="hs-identifier">checkClassKindSig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span>        </span><span class="hs-comment">-- Multiplicity</span><span>
</span><span id="line-69"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcMult"><span class="hs-identifier">tcMult</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span>        </span><span class="hs-comment">-- Pattern type signatures</span><span>
</span><span id="line-72"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsPatSigType"><span class="hs-identifier">tcHsPatSigType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsTyPat"><span class="hs-identifier">tcHsTyPat</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-73"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#HoleMode"><span class="hs-identifier">HoleMode</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span>        </span><span class="hs-comment">-- Error messages</span><span>
</span><span id="line-76"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#funAppCtxt"><span class="hs-identifier">funAppCtxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#addTyConFlavCtxt"><span class="hs-identifier">addTyConFlavCtxt</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span>        </span><span class="hs-comment">-- Utils</span><span>
</span><span id="line-79"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tyLitFromLit"><span class="hs-identifier">tyLitFromLit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tyLitFromOverloadedLit"><span class="hs-identifier">tyLitFromOverloadedLit</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-80"></span><span>   </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Prelude.Basic.html#head"><span class="hs-identifier">head</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">init</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">last</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Prelude.Basic.html#tail"><span class="hs-identifier">tail</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.html"><span class="hs-identifier">GHC.Hs</span></a></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html"><span class="hs-identifier">GHC.Rename.Utils</span></a></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html"><span class="hs-identifier">GHC.Tc.Errors.Types</span></a></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html"><span class="hs-identifier">GHC.Tc.Types.Origin</span></a></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html"><span class="hs-identifier">GHC.Tc.Types.LclEnv</span></a></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html"><span class="hs-identifier">GHC.Tc.Types.Constraint</span></a></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html"><span class="hs-identifier">GHC.Tc.Utils.Env</span></a></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html"><span class="hs-identifier">GHC.Tc.Utils.TcMType</span></a></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Validity.html"><span class="hs-identifier">GHC.Tc.Validity</span></a></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html"><span class="hs-identifier">GHC.Tc.Utils.Unify</span></a></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.IfaceToCore.html"><span class="hs-identifier">GHC.IfaceToCore</span></a></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.html"><span class="hs-identifier">GHC.Tc.Solver</span></a></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Type.html"><span class="hs-identifier">GHC.Tc.Zonk.Type</span></a></span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></a></span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html"><span class="hs-identifier">GHC.Tc.Utils.Instantiate</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcInstInvisibleTyBinders"><span class="hs-identifier">tcInstInvisibleTyBinders</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcInstInvisibleTyBindersN"><span class="hs-identifier">tcInstInvisibleTyBindersN</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-100"></span><span>                                  </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcInstInvisibleTyBinder"><span class="hs-identifier">tcInstInvisibleTyBinder</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcSkolemiseInvisibleBndrs"><span class="hs-identifier">tcSkolemiseInvisibleBndrs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-101"></span><span>                                  </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcInstTypeBndrs"><span class="hs-identifier">tcInstTypeBndrs</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html"><span class="hs-identifier">GHC.Tc.Zonk.TcType</span></a></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html"><span class="hs-identifier">GHC.Core.TyCo.Rep</span></a></span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html"><span class="hs-identifier">GHC.Core.TyCo.Ppr</span></a></span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.Prim.html"><span class="hs-identifier">GHC.Builtin.Types.Prim</span></a></span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Error.html"><span class="hs-identifier">GHC.Types.Error</span></a></span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html"><span class="hs-identifier">GHC.Types.Name.Env</span></a></span><span>
</span><span id="line-111"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html"><span class="hs-identifier">GHC.Types.Name.Reader</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#lookupLocalRdrOcc"><span class="hs-identifier">lookupLocalRdrOcc</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.html"><span class="hs-identifier">GHC.Types.Var</span></a></span><span>
</span><span id="line-113"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html"><span class="hs-identifier">GHC.Types.Var.Set</span></a></span><span>
</span><span id="line-114"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html"><span class="hs-identifier">GHC.Core.ConLike</span></a></span><span>
</span><span id="line-116"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span>
</span><span id="line-117"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Class.html"><span class="hs-identifier">GHC.Core.Class</span></a></span><span>
</span><span id="line-118"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-119"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html"><span class="hs-identifier">GHC.Types.Var.Env</span></a></span><span>
</span><span id="line-120"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html"><span class="hs-identifier">GHC.Builtin.Types</span></a></span><span>
</span><span id="line-121"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span>
</span><span id="line-122"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-123"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.html"><span class="hs-identifier">GHC.Types.Unique</span></a></span><span>
</span><span id="line-124"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html"><span class="hs-identifier">GHC.Types.Unique.FM</span></a></span><span>
</span><span id="line-125"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-126"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html"><span class="hs-identifier">GHC.Types.Unique.Supply</span></a></span><span>
</span><span id="line-127"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-128"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-129"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#wildCardName"><span class="hs-identifier">wildCardName</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html"><span class="hs-identifier">GHC.Driver.DynFlags</span></a></span><span>
</span><span id="line-131"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../ghc-boot-9.12.2-1a37/src/GHC.LanguageExtensions.html"><span class="hs-identifier">GHC.LanguageExtensions</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LangExt</span></span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-134"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.List.Infinite.html"><span class="hs-identifier">GHC.Data.List.Infinite</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Data.List.Infinite.html#Infinite"><span class="hs-identifier">Infinite</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Data.List.Infinite.html"><span class="hs-identifier">GHC.Data.List.Infinite</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Inf</span></span><span>
</span><span id="line-136"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.List.SetOps.html"><span class="hs-identifier">GHC.Data.List.SetOps</span></a></span><span>
</span><span id="line-137"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-138"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html"><span class="hs-identifier">GHC.Data.Bag</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#unitBag"><span class="hs-identifier">unitBag</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Function.html"><span class="hs-identifier">Data.Function</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">on</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#nonEmpty"><span class="hs-identifier">nonEmpty</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NE</span></span><span>
</span><span id="line-143"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">mapAccumL</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-145"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Tuple.html"><span class="hs-identifier">Data.Tuple</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">swap</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SourceText.html"><span class="hs-identifier">GHC.Types.SourceText</span></a></span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span class="hs-comment">{-
        ----------------------------
                General notes
        ----------------------------

Unlike with expressions, type-checking types both does some checking and
desugars at the same time. This is necessary because we often want to perform
equality checks on the types right away, and it would be incredibly painful
to do this on un-desugared types. Luckily, desugared types are close enough
to HsTypes to make the error messages sane.

During type-checking, we perform as little validity checking as possible.
Generally, after type-checking, you will want to do validity checking, say
with GHC.Tc.Validity.checkValidType.

Validity checking
~~~~~~~~~~~~~~~~~
Some of the validity check could in principle be done by the kind checker,
but not all:

- During desugaring, we normalise by expanding type synonyms.  Only
  after this step can we check things like type-synonym saturation
  e.g.  type T k = k Int
        type S a = a
  Then (T S) is ok, because T is saturated; (T S) expands to (S Int);
  and then S is saturated.  This is a GHC extension.

- Similarly, also a GHC extension, we look through synonyms before complaining
  about the form of a class or instance declaration

- Ambiguity checks involve functional dependencies

Also, in a mutually recursive group of types, we can't look at the TyCon until we've
finished building the loop.  So to keep things simple, we postpone most validity
checking until step (3).

%************************************************************************
%*                                                                      *
              Check types AND do validity checking
*                                                                      *
************************************************************************

Note [Keeping implicitly quantified variables in order]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When the user implicitly quantifies over variables (say, in a type
signature), we need to come up with some ordering on these variables.
This is done by bumping the TcLevel, bringing the tyvars into scope,
and then type-checking the thing_inside. The constraints are all
wrapped in an implication, which is then solved. Finally, we can
zonk all the binders and then order them with scopedSort.

It's critical to solve before zonking and ordering in order to uncover
any unifications. You might worry that this eager solving could cause
trouble elsewhere. I don't think it will. Because it will solve only
in an increased TcLevel, it can't unify anything that was mentioned
elsewhere. Additionally, we require that the order of implicitly
quantified variables is manifest by the scope of these variables, so
we're not going to learn more information later that will help order
these variables.

Note [Recipe for checking a signature]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Kind-checking a user-written signature requires several steps:

 0. Bump the TcLevel
 1.   Bind any lexically-scoped type variables.
 2.   Generate constraints.
 3. Solve constraints.
 4. Sort any implicitly-bound variables into dependency order
 5. Promote tyvars and/or kind-generalize.
 6. Zonk.
 7. Check validity.

Very similar steps also apply when kind-checking a type or class
declaration.

The general pattern looks something like this.  (But NB every
specific instance varies in one way or another!)

    do { (tclvl, wanted, (spec_tkvs, ty))
              &lt;- pushLevelAndSolveEqualitiesX &quot;tc_top_lhs_type&quot; $
                 bindImplicitTKBndrs_Skol sig_vars              $
                 &lt;kind-check the type&gt;

       ; spec_tkvs &lt;- zonkAndScopedSort spec_tkvs

       ; reportUnsolvedEqualities skol_info spec_tkvs tclvl wanted

       ; let ty1 = mkSpecForAllTys spec_tkvs ty
       ; kvs &lt;- kindGeneralizeAll ty1

       ; final_ty &lt;- zonkTcTypeToType (mkInfForAllTys kvs ty1)

       ; checkValidType final_ty

This pattern is repeated many times in GHC.Tc.Gen.HsType,
GHC.Tc.Gen.Sig, and GHC.Tc.TyCl, with variations.  In more detail:

* pushLevelAndSolveEqualitiesX (Step 0, step 3) bumps the TcLevel,
  calls the thing inside to generate constraints, solves those
  constraints as much as possible, returning the residual unsolved
  constraints in 'wanted'.

* bindImplicitTKBndrs_Skol (Step 1) binds the user-specified type
  variables E.g.  when kind-checking f :: forall a. F a -&gt; a we must
  bring 'a' into scope before kind-checking (F a -&gt; a)

* zonkAndScopedSort (Step 4) puts those user-specified variables in
  the dependency order.  (For &quot;implicit&quot; variables the order is no
  user-specified.  E.g.  forall (a::k1) (b::k2). blah k1 and k2 are
  implicitly brought into scope.

* reportUnsolvedEqualities (Step 3 continued) reports any unsolved
  equalities, carefully wrapping them in an implication that binds the
  skolems.  We can't do that in pushLevelAndSolveEqualitiesX because
  that function doesn't have access to the skolems.

* kindGeneralize (Step 5). See Note [Kind generalisation]

* The final zonkTcTypeToType must happen after promoting/generalizing,
  because promoting and generalizing fill in metavariables.


Doing Step 3 (constraint solving) eagerly (rather than building an
implication constraint and solving later) is necessary for several
reasons:

* Exactly as for Solver.simplifyInfer: when generalising, we solve all
  the constraints we can so that we don't have to quantify over them
  or, since we don't quantify over constraints in kinds, float them
  and inhibit generalisation.

* Most signatures also bring implicitly quantified variables into
  scope, and solving is necessary to get these in the right order
  (Step 4) see Note [Keeping implicitly quantified variables in
  order]).

Note [Kind generalisation]
~~~~~~~~~~~~~~~~~~~~~~~~~~
Step 5 of Note [Recipe for checking a signature], namely
kind-generalisation, is done by
    kindGeneraliseAll
    kindGeneraliseSome
    kindGeneraliseNone

Here, we have to deal with the fact that metatyvars generated in the
type will have a bumped TcLevel, because explicit foralls raise the
TcLevel. To avoid these variables from ever being visible in the
surrounding context, we must obey the following dictum:

  Every metavariable in a type must either be
    (A) generalized, or
    (B) promoted, or        See Note [Promotion in signatures]
    (C) a cause to error    See Note [Naughty quantification candidates]
                            in GHC.Tc.Utils.TcMType

There are three steps (look at kindGeneraliseSome):

1. candidateQTyVarsOfType finds the free variables of the type or kind,
   to generalise

2. filterConstrainedCandidates filters out candidates that appear
   in the unsolved 'wanteds', and promotes the ones that get filtered out
   thereby.

3. quantifyTyVars quantifies the remaining type variables

The kindGeneralize functions do not require pre-zonking; they zonk as they
go.

kindGeneraliseAll specialises for the case where step (2) is vacuous.
kindGeneraliseNone specialises for the case where we do no quantification,
but we must still promote.

If you are actually doing kind-generalization, you need to bump the
level before generating constraints, as we will only generalize
variables with a TcLevel higher than the ambient one.
Hence the &quot;pushLevel&quot; in pushLevelAndSolveEqualities.

Note [Promotion in signatures]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
If an unsolved metavariable in a signature is not generalized
(because we're not generalizing the construct -- e.g., pattern
sig -- or because the metavars are constrained -- see kindGeneralizeSome)
we need to promote to maintain (WantedInv) of Note [TcLevel invariants]
in GHC.Tc.Utils.TcType. Note that promotion is identical in effect to generalizing
and the reinstantiating with a fresh metavariable at the current level.
So in some sense, we generalize *all* variables, but then re-instantiate
some of them.

Here is an example of why we must promote:
  foo (x :: forall a. a -&gt; Proxy b) = ...

In the pattern signature, `b` is unbound, and will thus be brought into
scope. We do not know its kind: it will be assigned kappa[2]. Note that
kappa is at TcLevel 2, because it is invented under a forall. (A priori,
the kind kappa might depend on `a`, so kappa rightly has a higher TcLevel
than the surrounding context.) This kappa cannot be solved for while checking
the pattern signature (which is not kind-generalized). When we are checking
the *body* of foo, though, we need to unify the type of x with the argument
type of bar. At this point, the ambient TcLevel is 1, and spotting a
metavariable with level 2 would violate the (WantedInv) invariant of
Note [TcLevel invariants]. So, instead of kind-generalizing,
we promote the metavariable to level 1. This is all done in kindGeneralizeNone.

-}</span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#funsSigCtxt"><span class="hs-identifier hs-type">funsSigCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedN"><span class="hs-identifier hs-type">LocatedN</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a></span><span>
</span><span id="line-356"></span><span class="hs-comment">-- Returns FunSigCtxt, with no redundant-context-reporting,</span><span>
</span><span id="line-357"></span><span class="hs-comment">-- form a list of located names</span><span>
</span><span id="line-358"></span><span id="funsSigCtxt"><span class="annot"><span class="annottext">funsSigCtxt :: [GenLocated SrcSpanAnnN Name] -&gt; UserTypeCtxt
</span><a href="GHC.Tc.Gen.HsType.html#funsSigCtxt"><span class="hs-identifier hs-var hs-var">funsSigCtxt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683076448"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683076448"><span class="hs-identifier hs-var">name1</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnN Name]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; ReportRedundantConstraints -&gt; UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#FunSigCtxt"><span class="hs-identifier hs-var">FunSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683076448"><span class="hs-identifier hs-var">name1</span></a></span><span> </span><span class="annot"><span class="annottext">ReportRedundantConstraints
</span><a href="GHC.Tc.Types.Origin.html#NoRRC"><span class="hs-identifier hs-var">NoRRC</span></a></span><span>
</span><span id="line-359"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#funsSigCtxt"><span class="hs-identifier hs-var">funsSigCtxt</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; UserTypeCtxt
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;funSigCtxt&quot;</span></span><span>
</span><span id="line-360"></span><span>
</span><span id="line-361"></span><span id="local-6989586621683075040"><span id="local-6989586621683075042"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#addSigCtxt"><span class="hs-identifier hs-type">addSigCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075040"><span class="hs-identifier hs-type">hs_ty</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075040"><span class="hs-identifier hs-type">hs_ty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075042"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075042"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-362"></span><span id="addSigCtxt"><span class="annot"><span class="annottext">addSigCtxt :: forall hs_ty a.
Outputable hs_ty =&gt;
UserTypeCtxt -&gt; LocatedA hs_ty -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.HsType.html#addSigCtxt"><span class="hs-identifier hs-var hs-var">addSigCtxt</span></a></span></span><span> </span><span id="local-6989586621683076455"><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621683076455"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683076456"><span class="annot"><span class="annottext">LocatedA hs_ty
</span><a href="#local-6989586621683076456"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span> </span><span id="local-6989586621683076457"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683076457"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-363"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcM a -&gt; TcM a
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocatedA hs_ty -&gt; SrcSpan
forall a e. HasLoc a =&gt; GenLocated a e -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#getLocA"><span class="hs-identifier hs-var">getLocA</span></a></span><span> </span><span class="annot"><span class="annottext">LocatedA hs_ty
</span><a href="#local-6989586621683076456"><span class="hs-identifier hs-var">hs_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM a -&gt; TcM a) -&gt; TcM a -&gt; TcM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-364"></span><span>    </span><span class="annot"><span class="annottext">SDoc -&gt; TcM a -&gt; TcM a
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UserTypeCtxt -&gt; LocatedA hs_ty -&gt; SDoc
forall hs_ty.
Outputable hs_ty =&gt;
UserTypeCtxt -&gt; LocatedA hs_ty -&gt; SDoc
</span><a href="GHC.Tc.Gen.HsType.html#pprSigCtxt"><span class="hs-identifier hs-var">pprSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621683076455"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">LocatedA hs_ty
</span><a href="#local-6989586621683076456"><span class="hs-identifier hs-var">hs_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM a -&gt; TcM a) -&gt; TcM a -&gt; TcM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-365"></span><span>    </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683076457"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span id="local-6989586621683075056"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#pprSigCtxt"><span class="hs-identifier hs-type">pprSigCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075056"><span class="hs-identifier hs-type">hs_ty</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075056"><span class="hs-identifier hs-type">hs_ty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span></span><span>
</span><span id="line-368"></span><span class="hs-comment">-- (pprSigCtxt ctxt &lt;extra&gt; &lt;type&gt;)</span><span>
</span><span id="line-369"></span><span class="hs-comment">-- prints    In the type signature for 'f':</span><span>
</span><span id="line-370"></span><span class="hs-comment">--              f :: &lt;type&gt;</span><span>
</span><span id="line-371"></span><span class="hs-comment">-- The &lt;extra&gt; is either empty or &quot;the ambiguity check for&quot;</span><span>
</span><span id="line-372"></span><span id="pprSigCtxt"><span class="annot"><span class="annottext">pprSigCtxt :: forall hs_ty.
Outputable hs_ty =&gt;
UserTypeCtxt -&gt; LocatedA hs_ty -&gt; SDoc
</span><a href="GHC.Tc.Gen.HsType.html#pprSigCtxt"><span class="hs-identifier hs-var hs-var">pprSigCtxt</span></a></span></span><span> </span><span id="local-6989586621683076472"><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621683076472"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683076473"><span class="annot"><span class="annottext">LocatedA hs_ty
</span><a href="#local-6989586621683076473"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span>
</span><span id="line-373"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683076474"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683076474"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt -&gt; Maybe Name
</span><a href="GHC.Tc.Types.Origin.html#isSigMaybe"><span class="hs-identifier hs-var">isSigMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621683076472"><span class="hs-identifier hs-var">ctxt</span></a></span><span>
</span><span id="line-374"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In the type signature:&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span>       </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. OutputableBndr a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pprPrefixOcc"><span class="hs-identifier hs-var">pprPrefixOcc</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683076474"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">LocatedA hs_ty -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LocatedA hs_ty
</span><a href="#local-6989586621683076473"><span class="hs-identifier hs-var">hs_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span>
</span><span id="line-377"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-378"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt -&gt; SDoc
</span><a href="GHC.Tc.Types.Origin.html#pprUserTypeCtxt"><span class="hs-identifier hs-var">pprUserTypeCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621683076472"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-379"></span><span>       </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocatedA hs_ty -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LocatedA hs_ty
</span><a href="#local-6989586621683076473"><span class="hs-identifier hs-var">hs_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-380"></span><span>
</span><span id="line-381"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsSigWcType"><span class="hs-identifier hs-type">tcHsSigWcType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsSigWcType"><span class="hs-identifier hs-type">LHsSigWcType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-382"></span><span class="hs-comment">-- This one is used when we have a LHsSigWcType, but in</span><span>
</span><span id="line-383"></span><span class="hs-comment">-- a place where wildcards aren't allowed. The renamer has</span><span>
</span><span id="line-384"></span><span class="hs-comment">-- already checked this, so we can simply ignore it.</span><span>
</span><span id="line-385"></span><span id="tcHsSigWcType"><span class="annot"><span class="annottext">tcHsSigWcType :: UserTypeCtxt -&gt; LHsSigWcType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcHsSigWcType"><span class="hs-identifier hs-var hs-var">tcHsSigWcType</span></a></span></span><span> </span><span id="local-6989586621683076485"><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621683076485"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683076486"><span class="annot"><span class="annottext">LHsSigWcType GhcRn
</span><a href="#local-6989586621683076486"><span class="hs-identifier hs-var">sig_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt -&gt; LHsSigType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcHsSigType"><span class="hs-identifier hs-var">tcHsSigType</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621683076485"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsSigWcType GhcRn -&gt; LHsSigType GhcRn
forall pass. LHsSigWcType pass -&gt; LHsSigType pass
</span><a href="GHC.Hs.Type.html#dropWildCards"><span class="hs-identifier hs-var">dropWildCards</span></a></span><span> </span><span class="annot"><span class="annottext">LHsSigWcType GhcRn
</span><a href="#local-6989586621683076486"><span class="hs-identifier hs-var">sig_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-386"></span><span>
</span><span id="line-387"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#kcClassSigType"><span class="hs-identifier hs-type">kcClassSigType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedN"><span class="hs-identifier hs-type">LocatedN</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsSigType"><span class="hs-identifier hs-type">LHsSigType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-388"></span><span class="hs-comment">-- This is a special form of tcClassSigType that is used during the</span><span>
</span><span id="line-389"></span><span class="hs-comment">-- kind-checking phase to infer the kind of class variables. Cf. tc_lhs_sig_type.</span><span>
</span><span id="line-390"></span><span class="hs-comment">-- Importantly, this does *not* kind-generalize. Consider</span><span>
</span><span id="line-391"></span><span class="hs-comment">--   class SC f where</span><span>
</span><span id="line-392"></span><span class="hs-comment">--     meth :: forall a (x :: f a). Proxy x -&gt; ()</span><span>
</span><span id="line-393"></span><span class="hs-comment">-- When instantiating Proxy with kappa, we must unify kappa := f a. But we're</span><span>
</span><span id="line-394"></span><span class="hs-comment">-- still working out the kind of f, and thus f a will have a coercion in it.</span><span>
</span><span id="line-395"></span><span class="hs-comment">-- Coercions may block unification (Note [Equalities with incompatible kinds] in</span><span>
</span><span id="line-396"></span><span class="hs-comment">-- GHC.Tc.Solver.Equality, wrinkle (EIK2)) and so we fail to unify. If we try to</span><span>
</span><span id="line-397"></span><span class="hs-comment">-- kind-generalize, we'll end up promoting kappa to the top level (because</span><span>
</span><span id="line-398"></span><span class="hs-comment">-- kind-generalization is normally done right before adding a binding to the context),</span><span>
</span><span id="line-399"></span><span class="hs-comment">-- and then we can't set kappa := f a, because a is local.</span><span>
</span><span id="line-400"></span><span id="kcClassSigType"><span class="annot"><span class="annottext">kcClassSigType :: [GenLocated SrcSpanAnnN Name] -&gt; LHsSigType GhcRn -&gt; TcM ()
</span><a href="GHC.Tc.Gen.HsType.html#kcClassSigType"><span class="hs-identifier hs-var hs-var">kcClassSigType</span></a></span></span><span> </span><span id="local-6989586621683076488"><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnN Name]
</span><a href="#local-6989586621683076488"><span class="hs-identifier hs-var">names</span></a></span></span><span>
</span><span id="line-401"></span><span>    </span><span id="local-6989586621683076489"><span class="annot"><span class="annottext">sig_ty :: LHsSigType GhcRn
</span><a href="#local-6989586621683076489"><span class="hs-identifier hs-var">sig_ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsSig"><span class="hs-identifier hs-type">HsSig</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sig_bndrs :: forall pass. HsSigType pass -&gt; HsOuterSigTyVarBndrs pass
</span><a href="Language.Haskell.Syntax.Type.html#sig_bndrs"><span class="hs-identifier hs-var">sig_bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683076492"><span class="annot"><span class="annottext">HsOuterSigTyVarBndrs GhcRn
</span><a href="#local-6989586621683076492"><span class="hs-identifier hs-var">hs_outer_bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sig_body :: forall pass. HsSigType pass -&gt; LHsType pass
</span><a href="Language.Haskell.Syntax.Type.html#sig_body"><span class="hs-identifier hs-var">sig_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683076494"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076494"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-402"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
-&gt; GenLocated SrcSpanAnnA (HsSigType GhcRn) -&gt; TcM () -&gt; TcM ()
forall hs_ty a.
Outputable hs_ty =&gt;
UserTypeCtxt -&gt; LocatedA hs_ty -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.HsType.html#addSigCtxt"><span class="hs-identifier hs-var">addSigCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnN Name] -&gt; UserTypeCtxt
</span><a href="GHC.Tc.Gen.HsType.html#funsSigCtxt"><span class="hs-identifier hs-var">funsSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnN Name]
</span><a href="#local-6989586621683076488"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsSigType GhcRn
GenLocated SrcSpanAnnA (HsSigType GhcRn)
</span><a href="#local-6989586621683076489"><span class="hs-identifier hs-var">sig_ty</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM () -&gt; TcM ()) -&gt; TcM () -&gt; TcM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-403"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsOuterSigTyVarBndrs GhcRn
-&gt; TcM Type -&gt; TcM (HsOuterTyVarBndrs Specificity GhcTc, Type)
forall a.
HsOuterSigTyVarBndrs GhcRn
-&gt; TcM a -&gt; TcM (HsOuterTyVarBndrs Specificity GhcTc, a)
</span><a href="GHC.Tc.Gen.HsType.html#bindOuterSigTKBndrs_Tv"><span class="hs-identifier hs-var">bindOuterSigTKBndrs_Tv</span></a></span><span> </span><span class="annot"><span class="annottext">HsOuterSigTyVarBndrs GhcRn
</span><a href="#local-6989586621683076492"><span class="hs-identifier hs-var">hs_outer_bndrs</span></a></span><span>    </span><span class="annot"><span class="annottext">(TcM Type -&gt; TcM (HsOuterTyVarBndrs Specificity GhcTc, Type))
-&gt; TcM Type -&gt; TcM (HsOuterTyVarBndrs Specificity GhcTc, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-404"></span><span>              </span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcCheckLHsType"><span class="hs-identifier hs-var">tcCheckLHsType</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076494"><span class="hs-identifier hs-var">hs_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span>
</span><span id="line-405"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-406"></span><span>
</span><span id="line-407"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcClassSigType"><span class="hs-identifier hs-type">tcClassSigType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedN"><span class="hs-identifier hs-type">LocatedN</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsSigType"><span class="hs-identifier hs-type">LHsSigType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-408"></span><span class="hs-comment">-- Does not do validity checking</span><span>
</span><span id="line-409"></span><span id="tcClassSigType"><span class="annot"><span class="annottext">tcClassSigType :: [GenLocated SrcSpanAnnN Name] -&gt; LHsSigType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcClassSigType"><span class="hs-identifier hs-var hs-var">tcClassSigType</span></a></span></span><span> </span><span id="local-6989586621683076496"><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnN Name]
</span><a href="#local-6989586621683076496"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span id="local-6989586621683076497"><span class="annot"><span class="annottext">LHsSigType GhcRn
</span><a href="#local-6989586621683076497"><span class="hs-identifier hs-var">sig_ty</span></a></span></span><span>
</span><span id="line-410"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
-&gt; GenLocated SrcSpanAnnA (HsSigType GhcRn) -&gt; TcM Type -&gt; TcM Type
forall hs_ty a.
Outputable hs_ty =&gt;
UserTypeCtxt -&gt; LocatedA hs_ty -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.HsType.html#addSigCtxt"><span class="hs-identifier hs-var">addSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621683076498"><span class="hs-identifier hs-var">sig_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsSigType GhcRn
GenLocated SrcSpanAnnA (HsSigType GhcRn)
</span><a href="#local-6989586621683076497"><span class="hs-identifier hs-var">sig_ty</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM Type -&gt; TcM Type) -&gt; TcM Type -&gt; TcM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-411"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683076499"><span class="annot"><a href="#local-6989586621683076499"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon -&gt; IOEnv (Env TcGblEnv TcLclEnv) SkolemInfo
forall (m :: * -&gt; *). MonadIO m =&gt; SkolemInfoAnon -&gt; m SkolemInfo
</span><a href="GHC.Tc.Types.Origin.html#mkSkolemInfo"><span class="hs-identifier hs-var">mkSkolemInfo</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon
</span><a href="#local-6989586621683076501"><span class="hs-identifier hs-var">skol_info_anon</span></a></span><span>
</span><span id="line-412"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683076502"><span class="annot"><a href="#local-6989586621683076502"><span class="hs-identifier hs-var">implic</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683076503"><span class="annot"><a href="#local-6989586621683076503"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tc_lhs_sig_type"><span class="hs-identifier hs-type">tc_lhs_sig_type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076499"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076497"><span class="hs-identifier hs-type">sig_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#TheKind"><span class="hs-identifier hs-type">TheKind</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-type">liftedTypeKind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-413"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitImplication"><span class="hs-identifier hs-type">emitImplication</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076502"><span class="hs-identifier hs-type">implic</span></a></span><span>
</span><span id="line-414"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683076503"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-415"></span><span>       </span><span class="hs-comment">-- Do not zonk-to-Type, nor perform a validity check</span><span>
</span><span id="line-416"></span><span>       </span><span class="hs-comment">-- We are in a knot with the class and associated types</span><span>
</span><span id="line-417"></span><span>       </span><span class="hs-comment">-- Zonking and validity checking is done by tcClassDecl</span><span>
</span><span id="line-418"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-419"></span><span>       </span><span class="hs-comment">-- No need to fail here if the type has an error:</span><span>
</span><span id="line-420"></span><span>       </span><span class="hs-comment">--   If we're in the kind-checking phase, the solveEqualities</span><span>
</span><span id="line-421"></span><span>       </span><span class="hs-comment">--     in kcTyClGroup catches the error</span><span>
</span><span id="line-422"></span><span>       </span><span class="hs-comment">--   If we're in the type-checking phase, the solveEqualities</span><span>
</span><span id="line-423"></span><span>       </span><span class="hs-comment">--     in tcClassDecl1 gets it</span><span>
</span><span id="line-424"></span><span>       </span><span class="hs-comment">-- Failing fast here degrades the error message in, e.g., tcfail135:</span><span>
</span><span id="line-425"></span><span>       </span><span class="hs-comment">--   class Foo f where</span><span>
</span><span id="line-426"></span><span>       </span><span class="hs-comment">--     baa :: f a -&gt; f</span><span>
</span><span id="line-427"></span><span>       </span><span class="hs-comment">-- If we fail fast, we're told that f has kind `k1` when we wanted `*`.</span><span>
</span><span id="line-428"></span><span>       </span><span class="hs-comment">-- It should be that f has kind `k2 -&gt; *`, but we never get a chance</span><span>
</span><span id="line-429"></span><span>       </span><span class="hs-comment">-- to run the solver where the kind of f is touchable. This is</span><span>
</span><span id="line-430"></span><span>       </span><span class="hs-comment">-- painfully delicate.</span><span>
</span><span id="line-431"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-432"></span><span>    </span><span id="local-6989586621683076498"><span class="annot"><span class="annottext">sig_ctxt :: UserTypeCtxt
</span><a href="#local-6989586621683076498"><span class="hs-identifier hs-var hs-var">sig_ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnN Name] -&gt; UserTypeCtxt
</span><a href="GHC.Tc.Gen.HsType.html#funsSigCtxt"><span class="hs-identifier hs-var">funsSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnN Name]
</span><a href="#local-6989586621683076496"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-433"></span><span>    </span><span id="local-6989586621683076501"><span class="annot"><span class="annottext">skol_info_anon :: SkolemInfoAnon
</span><a href="#local-6989586621683076501"><span class="hs-identifier hs-var hs-var">skol_info_anon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt -&gt; SkolemInfoAnon
</span><a href="GHC.Tc.Types.Origin.html#SigTypeSkol"><span class="hs-identifier hs-var">SigTypeSkol</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621683076498"><span class="hs-identifier hs-var">sig_ctxt</span></a></span><span>
</span><span id="line-434"></span><span>
</span><span id="line-435"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsSigType"><span class="hs-identifier hs-type">tcHsSigType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsSigType"><span class="hs-identifier hs-type">LHsSigType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-436"></span><span class="hs-comment">-- Does validity checking</span><span>
</span><span id="line-437"></span><span class="hs-comment">-- See Note [Recipe for checking a signature]</span><span>
</span><span id="line-438"></span><span id="tcHsSigType"><span class="annot"><span class="annottext">tcHsSigType :: UserTypeCtxt -&gt; LHsSigType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcHsSigType"><span class="hs-identifier hs-var hs-var">tcHsSigType</span></a></span></span><span> </span><span id="local-6989586621683076508"><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621683076508"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683076509"><span class="annot"><span class="annottext">LHsSigType GhcRn
</span><a href="#local-6989586621683076509"><span class="hs-identifier hs-var">sig_ty</span></a></span></span><span>
</span><span id="line-439"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
-&gt; GenLocated SrcSpanAnnA (HsSigType GhcRn) -&gt; TcM Type -&gt; TcM Type
forall hs_ty a.
Outputable hs_ty =&gt;
UserTypeCtxt -&gt; LocatedA hs_ty -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.HsType.html#addSigCtxt"><span class="hs-identifier hs-var">addSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621683076508"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsSigType GhcRn
GenLocated SrcSpanAnnA (HsSigType GhcRn)
</span><a href="#local-6989586621683076509"><span class="hs-identifier hs-var">sig_ty</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM Type -&gt; TcM Type) -&gt; TcM Type -&gt; TcM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-440"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcHsSigType {&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsSigType GhcRn) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsSigType GhcRn
GenLocated SrcSpanAnnA (HsSigType GhcRn)
</span><a href="#local-6989586621683076509"><span class="hs-identifier hs-var">sig_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-441"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683076511"><span class="annot"><a href="#local-6989586621683076511"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon -&gt; IOEnv (Env TcGblEnv TcLclEnv) SkolemInfo
forall (m :: * -&gt; *). MonadIO m =&gt; SkolemInfoAnon -&gt; m SkolemInfo
</span><a href="GHC.Tc.Types.Origin.html#mkSkolemInfo"><span class="hs-identifier hs-var">mkSkolemInfo</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon
</span><a href="#local-6989586621683076512"><span class="hs-identifier hs-var">skol_info</span></a></span><span>
</span><span id="line-442"></span><span>          </span><span class="hs-comment">-- Generalise here: see Note [Kind generalisation]</span><span>
</span><span id="line-443"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683076513"><span class="annot"><a href="#local-6989586621683076513"><span class="hs-identifier hs-var">implic</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683076514"><span class="annot"><a href="#local-6989586621683076514"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tc_lhs_sig_type"><span class="hs-identifier hs-type">tc_lhs_sig_type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076511"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076509"><span class="hs-identifier hs-type">sig_ty</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#expectedKindInCtxt"><span class="hs-identifier hs-type">expectedKindInCtxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076508"><span class="hs-identifier hs-type">ctxt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-444"></span><span>
</span><span id="line-445"></span><span>       </span><span class="hs-comment">-- Float out constraints, failing fast if not possible</span><span>
</span><span id="line-446"></span><span>       </span><span class="hs-comment">-- See Note [Failure in local type signatures] in GHC.Tc.Solver</span><span>
</span><span id="line-447"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcHsSigType 2&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076513"><span class="hs-identifier hs-type">implic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-448"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.html#simplifyAndEmitFlatConstraints"><span class="hs-identifier hs-type">simplifyAndEmitFlatConstraints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#mkImplicWC"><span class="hs-identifier hs-type">mkImplicWC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Bag.html#unitBag"><span class="hs-identifier hs-type">unitBag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076513"><span class="hs-identifier hs-type">implic</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-449"></span><span>
</span><span id="line-450"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683076518"><span class="annot"><a href="#local-6989586621683076518"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-type">liftZonkM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-type">zonkTcType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076514"><span class="hs-identifier hs-type">ty</span></a></span><span>
</span><span id="line-451"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Validity.html#checkValidType"><span class="hs-identifier hs-type">checkValidType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076508"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076518"><span class="hs-identifier hs-type">ty</span></a></span><span>
</span><span id="line-452"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;end tcHsSigType }&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076518"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-453"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683076518"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-454"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-455"></span><span>    </span><span id="local-6989586621683076512"><span class="annot"><span class="annottext">skol_info :: SkolemInfoAnon
</span><a href="#local-6989586621683076512"><span class="hs-identifier hs-var hs-var">skol_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt -&gt; SkolemInfoAnon
</span><a href="GHC.Tc.Types.Origin.html#SigTypeSkol"><span class="hs-identifier hs-var">SigTypeSkol</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621683076508"><span class="hs-identifier hs-var">ctxt</span></a></span><span>
</span><span id="line-456"></span><span>
</span><span id="line-457"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tc_lhs_sig_type"><span class="hs-identifier hs-type">tc_lhs_sig_type</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsSigType"><span class="hs-identifier hs-type">LHsSigType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-458"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#ContextKind"><span class="hs-identifier hs-type">ContextKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Implication"><span class="hs-identifier hs-type">Implication</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-459"></span><span class="hs-comment">-- Kind-checks/desugars an 'LHsSigType',</span><span>
</span><span id="line-460"></span><span class="hs-comment">--   solve equalities,</span><span>
</span><span id="line-461"></span><span class="hs-comment">--   and then kind-generalizes.</span><span>
</span><span id="line-462"></span><span class="hs-comment">-- This will never emit constraints, as it uses solveEqualities internally.</span><span>
</span><span id="line-463"></span><span class="hs-comment">-- No validity checking or zonking</span><span>
</span><span id="line-464"></span><span class="hs-comment">-- Returns also an implication for the unsolved constraints</span><span>
</span><span id="line-465"></span><span id="tc_lhs_sig_type"><span class="annot"><span class="annottext">tc_lhs_sig_type :: SkolemInfo
-&gt; LHsSigType GhcRn -&gt; ContextKind -&gt; TcM (Implication, Type)
</span><a href="GHC.Tc.Gen.HsType.html#tc_lhs_sig_type"><span class="hs-identifier hs-var hs-var">tc_lhs_sig_type</span></a></span></span><span> </span><span id="local-6989586621683076523"><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621683076523"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span id="local-6989586621683076524"><span class="annot"><span class="annottext">full_hs_ty :: LHsSigType GhcRn
</span><a href="#local-6989586621683076524"><span class="hs-identifier hs-var">full_hs_ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683076525"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683076525"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsSig"><span class="hs-identifier hs-type">HsSig</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sig_bndrs :: forall pass. HsSigType pass -&gt; HsOuterSigTyVarBndrs pass
</span><a href="Language.Haskell.Syntax.Type.html#sig_bndrs"><span class="hs-identifier hs-var">sig_bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683076526"><span class="annot"><span class="annottext">HsOuterSigTyVarBndrs GhcRn
</span><a href="#local-6989586621683076526"><span class="hs-identifier hs-var">hs_outer_bndrs</span></a></span></span><span>
</span><span id="line-466"></span><span>                                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sig_body :: forall pass. HsSigType pass -&gt; LHsType pass
</span><a href="Language.Haskell.Syntax.Type.html#sig_body"><span class="hs-identifier hs-var">sig_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683076527"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076527"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683076528"><span class="annot"><span class="annottext">ContextKind
</span><a href="#local-6989586621683076528"><span class="hs-identifier hs-var">ctxt_kind</span></a></span></span><span>
</span><span id="line-467"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; TcM (Implication, Type) -&gt; TcM (Implication, Type)
forall ann a. EpAnn ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683076525"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (Implication, Type) -&gt; TcM (Implication, Type))
-&gt; TcM (Implication, Type) -&gt; TcM (Implication, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-468"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683076530"><span class="annot"><a href="#local-6989586621683076530"><span class="hs-identifier hs-var">tc_lvl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683076531"><span class="annot"><a href="#local-6989586621683076531"><span class="hs-identifier hs-var">wanted</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683076532"><span class="annot"><a href="#local-6989586621683076532"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683076533"><span class="annot"><a href="#local-6989586621683076533"><span class="hs-identifier hs-var">outer_bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683076534"><span class="annot"><a href="#local-6989586621683076534"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-469"></span><span>              </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String
-&gt; TcM (Type, (HsOuterTyVarBndrs Specificity GhcTc, Type))
-&gt; TcM
     (TcLevel, WantedConstraints,
      (Type, (HsOuterTyVarBndrs Specificity GhcTc, Type)))
forall a. String -&gt; TcM a -&gt; TcM (TcLevel, WantedConstraints, a)
</span><a href="GHC.Tc.Solver.html#pushLevelAndSolveEqualitiesX"><span class="hs-identifier hs-var">pushLevelAndSolveEqualitiesX</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc_lhs_sig_type&quot;</span></span><span> </span><span class="annot"><span class="annottext">(TcM (Type, (HsOuterTyVarBndrs Specificity GhcTc, Type))
 -&gt; TcM
      (TcLevel, WantedConstraints,
       (Type, (HsOuterTyVarBndrs Specificity GhcTc, Type))))
-&gt; TcM (Type, (HsOuterTyVarBndrs Specificity GhcTc, Type))
-&gt; TcM
     (TcLevel, WantedConstraints,
      (Type, (HsOuterTyVarBndrs Specificity GhcTc, Type)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-470"></span><span>                 </span><span class="hs-comment">-- See Note [Failure in local type signatures]</span><span>
</span><span id="line-471"></span><span>                 </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683076536"><span class="annot"><a href="#local-6989586621683076536"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ContextKind -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#newExpectedKind"><span class="hs-identifier hs-var">newExpectedKind</span></a></span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="#local-6989586621683076528"><span class="hs-identifier hs-var">ctxt_kind</span></a></span><span>
</span><span id="line-472"></span><span>                          </span><span class="hs-comment">-- See Note [Escaping kind in type signatures]</span><span>
</span><span id="line-473"></span><span>                    </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683076538"><span class="annot"><a href="#local-6989586621683076538"><span class="hs-identifier hs-var">stuff</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcOuterTKBndrs"><span class="hs-identifier hs-type">tcOuterTKBndrs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076523"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076526"><span class="hs-identifier hs-type">hs_outer_bndrs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-474"></span><span>                               </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcCheckLHsType"><span class="hs-identifier hs-type">tcCheckLHsType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076527"><span class="hs-identifier hs-type">hs_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076536"><span class="hs-identifier hs-type">exp_kind</span></a></span><span>
</span><span id="line-475"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683076536"><span class="hs-identifier hs-type">exp_kind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683076538"><span class="hs-identifier hs-type">stuff</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-476"></span><span>
</span><span id="line-477"></span><span>       </span><span class="hs-comment">-- Default any unconstrained variables free in the kind</span><span>
</span><span id="line-478"></span><span>       </span><span class="hs-comment">-- See Note [Escaping kind in type signatures]</span><span>
</span><span id="line-479"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683076539"><span class="annot"><a href="#local-6989586621683076539"><span class="hs-identifier hs-var">exp_kind_dvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#candidateQTyVarsOfType"><span class="hs-identifier hs-type">candidateQTyVarsOfType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076532"><span class="hs-identifier hs-type">exp_kind</span></a></span><span>
</span><span id="line-480"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#doNotQuantifyTyVars"><span class="hs-identifier hs-type">doNotQuantifyTyVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076539"><span class="hs-identifier hs-type">exp_kind_dvs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683076542"><span class="hs-identifier hs-type">err_ctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076532"><span class="hs-identifier hs-type">exp_kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-481"></span><span>
</span><span id="line-482"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc_lhs_sig_type&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076526"><span class="hs-identifier hs-type">hs_outer_bndrs</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076533"><span class="hs-identifier hs-type">outer_bndrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-483"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683076544"><span class="annot"><a href="#local-6989586621683076544"><span class="hs-identifier hs-var">outer_bndrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#scopedSortOuter"><span class="hs-identifier hs-type">scopedSortOuter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076533"><span class="hs-identifier hs-type">outer_bndrs</span></a></span><span>
</span><span id="line-484"></span><span>
</span><span id="line-485"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683076545"><span class="annot"><a href="#local-6989586621683076545"><span class="hs-identifier hs-var">outer_tv_bndrs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier">InvisTVBinder</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#outerTyVarBndrs"><span class="hs-identifier hs-type">outerTyVarBndrs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076544"><span class="hs-identifier hs-type">outer_bndrs</span></a></span><span>
</span><span id="line-486"></span><span>             </span><span id="local-6989586621683076547"><span class="annot"><a href="#local-6989586621683076547"><span class="hs-identifier hs-var hs-var">ty1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[VarBndr TcTyVar Specificity] -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkInvisForAllTys"><span class="hs-identifier hs-var">mkInvisForAllTys</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr TcTyVar Specificity]
</span><a href="#local-6989586621683076545"><span class="hs-identifier hs-var">outer_tv_bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683076534"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-487"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683076549"><span class="annot"><a href="#local-6989586621683076549"><span class="hs-identifier hs-var">kvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#kindGeneralizeSome"><span class="hs-identifier hs-type">kindGeneralizeSome</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076523"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076531"><span class="hs-identifier hs-type">wanted</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076547"><span class="hs-identifier hs-type">ty1</span></a></span><span>
</span><span id="line-488"></span><span>
</span><span id="line-489"></span><span>       </span><span class="hs-comment">-- Build an implication for any as-yet-unsolved kind equalities</span><span>
</span><span id="line-490"></span><span>       </span><span class="hs-comment">-- See Note [Skolem escape in type signatures]</span><span>
</span><span id="line-491"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683076551"><span class="annot"><a href="#local-6989586621683076551"><span class="hs-identifier hs-var">implic</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#buildTvImplication"><span class="hs-identifier hs-type">buildTvImplication</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#getSkolemInfo"><span class="hs-identifier hs-type">getSkolemInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076523"><span class="hs-identifier hs-type">skol_info</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683076549"><span class="hs-identifier hs-type">kvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076530"><span class="hs-identifier hs-type">tc_lvl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076531"><span class="hs-identifier hs-type">wanted</span></a></span><span>
</span><span id="line-492"></span><span>
</span><span id="line-493"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683076551"><span class="hs-identifier hs-type">implic</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Type.html#mkInfForAllTys"><span class="hs-identifier hs-type">mkInfForAllTys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076549"><span class="hs-identifier hs-type">kvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076547"><span class="hs-identifier hs-type">ty1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-494"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-495"></span><span>    </span><span id="local-6989586621683076542"><span class="annot"><span class="annottext">err_ctx :: Type -&gt; TidyEnv -&gt; ZonkM (TidyEnv, UninferrableTyVarCtx)
</span><a href="#local-6989586621683076542"><span class="hs-identifier hs-var hs-var">err_ctx</span></a></span></span><span> </span><span id="local-6989586621683076555"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683076555"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span> </span><span id="local-6989586621683076556"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621683076556"><span class="hs-identifier hs-var">tidy_env</span></a></span></span><span>
</span><span id="line-496"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683076557"><span class="annot"><a href="#local-6989586621683076557"><span class="hs-identifier hs-var">tidy_env2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683076558"><span class="annot"><a href="#local-6989586621683076558"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; ZonkM (TidyEnv, Type)
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTidyTcType"><span class="hs-identifier hs-var">zonkTidyTcType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621683076556"><span class="hs-identifier hs-var">tidy_env</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683076555"><span class="hs-identifier hs-var">exp_kind</span></a></span><span>
</span><span id="line-497"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683076557"><span class="hs-identifier hs-type">tidy_env2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#UninfTyCtx_Sig"><span class="hs-identifier hs-type">UninfTyCtx_Sig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076558"><span class="hs-identifier hs-type">exp_kind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076524"><span class="hs-identifier hs-type">full_hs_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-498"></span><span>
</span><span id="line-499"></span><span>
</span><span id="line-500"></span><span>
</span><span id="line-501"></span><span class="hs-comment">{- Note [Escaping kind in type signatures]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider kind-checking the signature for `foo` (#19495, #24686):
  type family T (r :: RuntimeRep) :: TYPE r

  foo :: forall (r :: RuntimeRep). T r
  foo = ...

We kind-check the type with expected kind `TYPE delta` (see newExpectedKind),
where `delta :: RuntimeRep` is as-yet unknown. (We can't use `TYPE LiftedRep`
because we allow signatures like `foo :: Int#`.)

Suppose we are at level L currently.  We do this
  * pushLevelAndSolveEqualitiesX: moves to level L+1
  * newExpectedKind: allocates delta{L+1}. Note carefully that
    this call is /outside/ the tcOuterTKBndrs call.
  * tcOuterTKBndrs: pushes the level again to L+2, binds skolem r{L+2}
  * kind-check the body (T r) :: TYPE delta{L+1}

Then
* We can't unify delta{L+1} with r{L+2}.
  And rightly so: skolem would escape.

* If delta{L+1} is unified with some-kind{L}, that is fine.
  This can happen
      \(x::a) -&gt; let y :: a; y = x in ...(x :: Int#)...
  Here (x :: a :: TYPE gamma) is in the environment when we check
  the signature y::a.  We unify delta := gamma, and all is well.

* If delta{L+1} is unconstrained, we /must not/ quantify over it!
  E.g. Consider f :: Any   where Any :: forall k. k
  We kind-check this with expected kind TYPE kappa. We get
      Any @(TYPE kappa) :: TYPE kappa
  We don't want to generalise to     forall k. Any @k
  because that is ill-kinded: the kind of the body of the forall,
  (Any @k :: k) mentions the bound variable k.

  Instead we want to default it to LiftedRep.

  An alternative would be to promote it, similar to the monomorphism
  restriction, but the MR is pretty confusing.  Defaulting seems better

How does that defaulting happen?  Well, since we /currently/ default
RuntimeRep variables during generalisation, it'll happen in
kindGeneralize. But in principle we might allow generalisation over
RuntimeRep variables in future.  Moreover, what if we had
   kappa{L+1} := F alpha{L+1}
where F :: Type -&gt; RuntimeRep.   Now it's alpha that is free in the kind
and it /won't/ be defaulted.

So we use doNotQuantifyTyVars to either default the free vars of
exp_kind (if possible), or error (if not).

Note [Skolem escape in type signatures]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
tcHsSigType is tricky.  Consider (T11142)
  foo :: forall b. (forall k (a :: k). SameKind a b) -&gt; ()
This is ill-kinded because of a nested skolem-escape.

That will show up as an un-solvable constraint in the implication
returned by buildTvImplication in tc_lhs_sig_type.  See Note [Skolem
escape prevention] in GHC.Tc.Utils.TcType for why it is unsolvable
(the unification variable for b's kind is untouchable).

Then, in GHC.Tc.Solver.simplifyAndEmitFlatConstraints (called from tcHsSigType)
we'll try to float out the constraint, be unable to do so, and fail.
See GHC.Tc.Solver Note [Failure in local type signatures] for more
detail on this.

The separation between tcHsSigType and tc_lhs_sig_type is because
tcClassSigType wants to use the latter, but *not* fail fast, because
there are skolems from the class decl which are in scope; but it's fine
not to because tcClassDecl1 has a solveEqualities wrapped around all
the tcClassSigType calls.

That's why tcHsSigType does simplifyAndEmitFlatConstraints (which
fails fast) but tcClassSigType just does emitImplication (which does
not).  Ugh.

c.f. see also Note [Skolem escape and forall-types]. The difference
is that we don't need to simplify at a forall type, only at the
top level of a signature.
-}</span><span>
</span><span id="line-584"></span><span>
</span><span id="line-585"></span><span class="hs-comment">-- Does validity checking and zonking.</span><span>
</span><span id="line-586"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcStandaloneKindSig"><span class="hs-identifier hs-type">tcStandaloneKindSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#LStandaloneKindSig"><span class="hs-identifier hs-type">LStandaloneKindSig</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-587"></span><span id="tcStandaloneKindSig"><span class="annot"><span class="annottext">tcStandaloneKindSig :: LStandaloneKindSig GhcRn -&gt; TcM (Name, Type)
</span><a href="GHC.Tc.Gen.HsType.html#tcStandaloneKindSig"><span class="hs-identifier hs-var hs-var">tcStandaloneKindSig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#StandaloneKindSig"><span class="hs-identifier hs-type">StandaloneKindSig</span></a></span><span> </span><span class="annot"><span class="annottext">XStandaloneKindSig GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683076563"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683076563"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683076564"><span class="annot"><span class="annottext">LHsSigType GhcRn
</span><a href="#local-6989586621683076564"><span class="hs-identifier hs-var">ksig</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-588"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
-&gt; GenLocated SrcSpanAnnA (HsSigType GhcRn)
-&gt; TcM (Name, Type)
-&gt; TcM (Name, Type)
forall hs_ty a.
Outputable hs_ty =&gt;
UserTypeCtxt -&gt; LocatedA hs_ty -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.HsType.html#addSigCtxt"><span class="hs-identifier hs-var">addSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621683076565"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsSigType GhcRn
GenLocated SrcSpanAnnA (HsSigType GhcRn)
</span><a href="#local-6989586621683076564"><span class="hs-identifier hs-var">ksig</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (Name, Type) -&gt; TcM (Name, Type))
-&gt; TcM (Name, Type) -&gt; TcM (Name, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-589"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683076566"><span class="annot"><a href="#local-6989586621683076566"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeOrKind -&gt; UserTypeCtxt -&gt; LHsSigType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_top_lhs_type"><span class="hs-identifier hs-var">tc_top_lhs_type</span></a></span><span> </span><span class="annot"><span class="annottext">TypeOrKind
</span><a href="GHC.Types.Basic.html#KindLevel"><span class="hs-identifier hs-var">KindLevel</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621683076565"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsSigType GhcRn
</span><a href="#local-6989586621683076564"><span class="hs-identifier hs-var">ksig</span></a></span><span>
</span><span id="line-590"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Validity.html#checkValidType"><span class="hs-identifier hs-type">checkValidType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076565"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076566"><span class="hs-identifier hs-type">kind</span></a></span><span>
</span><span id="line-591"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683076563"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683076566"><span class="hs-identifier hs-type">kind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-592"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-593"></span><span>   </span><span id="local-6989586621683076565"><span class="annot"><span class="annottext">ctxt :: UserTypeCtxt
</span><a href="#local-6989586621683076565"><span class="hs-identifier hs-var hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#StandaloneKindSigCtxt"><span class="hs-identifier hs-var">StandaloneKindSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683076563"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-594"></span><span>
</span><span id="line-595"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcTopLHsType"><span class="hs-identifier hs-type">tcTopLHsType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsSigType"><span class="hs-identifier hs-type">LHsSigType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-596"></span><span id="tcTopLHsType"><span class="annot"><span class="annottext">tcTopLHsType :: UserTypeCtxt -&gt; LHsSigType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcTopLHsType"><span class="hs-identifier hs-var hs-var">tcTopLHsType</span></a></span></span><span> </span><span id="local-6989586621683076571"><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621683076571"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683076572"><span class="annot"><span class="annottext">LHsSigType GhcRn
</span><a href="#local-6989586621683076572"><span class="hs-identifier hs-var">lsig_ty</span></a></span></span><span>
</span><span id="line-597"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM Type -&gt; TcM Type
forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Monad.html#checkNoErrs"><span class="hs-identifier hs-var">checkNoErrs</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM Type -&gt; TcM Type) -&gt; TcM Type -&gt; TcM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>  </span><span class="hs-comment">-- Fail eagerly to avoid follow-on errors.  We are at</span><span>
</span><span id="line-598"></span><span>                   </span><span class="hs-comment">-- top level so these constraints will never be solved later.</span><span>
</span><span id="line-599"></span><span>    </span><span class="annot"><span class="annottext">TypeOrKind -&gt; UserTypeCtxt -&gt; LHsSigType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_top_lhs_type"><span class="hs-identifier hs-var">tc_top_lhs_type</span></a></span><span> </span><span class="annot"><span class="annottext">TypeOrKind
</span><a href="GHC.Types.Basic.html#TypeLevel"><span class="hs-identifier hs-var">TypeLevel</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621683076571"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsSigType GhcRn
</span><a href="#local-6989586621683076572"><span class="hs-identifier hs-var">lsig_ty</span></a></span><span>
</span><span id="line-600"></span><span>
</span><span id="line-601"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tc_top_lhs_type"><span class="hs-identifier hs-type">tc_top_lhs_type</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TypeOrKind"><span class="hs-identifier hs-type">TypeOrKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsSigType"><span class="hs-identifier hs-type">LHsSigType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-602"></span><span class="hs-comment">-- tc_top_lhs_type is used for kind-checking top-level LHsSigTypes where</span><span>
</span><span id="line-603"></span><span class="hs-comment">--   we want to fully solve /all/ equalities, and report errors</span><span>
</span><span id="line-604"></span><span class="hs-comment">-- Does zonking, but not validity checking because it's used</span><span>
</span><span id="line-605"></span><span class="hs-comment">--   for things (like deriving and instances) that aren't</span><span>
</span><span id="line-606"></span><span class="hs-comment">--   ordinary types</span><span>
</span><span id="line-607"></span><span class="hs-comment">-- Used for both types and kinds</span><span>
</span><span id="line-608"></span><span id="tc_top_lhs_type"><span class="annot"><span class="annottext">tc_top_lhs_type :: TypeOrKind -&gt; UserTypeCtxt -&gt; LHsSigType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_top_lhs_type"><span class="hs-identifier hs-var hs-var">tc_top_lhs_type</span></a></span></span><span> </span><span id="local-6989586621683076575"><span class="annot"><span class="annottext">TypeOrKind
</span><a href="#local-6989586621683076575"><span class="hs-identifier hs-var">tyki</span></a></span></span><span> </span><span id="local-6989586621683076576"><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621683076576"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683076577"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683076577"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683076578"><span class="annot"><span class="annottext">sig_ty :: HsSigType GhcRn
</span><a href="#local-6989586621683076578"><span class="hs-identifier hs-var">sig_ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsSig"><span class="hs-identifier hs-type">HsSig</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sig_bndrs :: forall pass. HsSigType pass -&gt; HsOuterSigTyVarBndrs pass
</span><a href="Language.Haskell.Syntax.Type.html#sig_bndrs"><span class="hs-identifier hs-var">sig_bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683076579"><span class="annot"><span class="annottext">HsOuterSigTyVarBndrs GhcRn
</span><a href="#local-6989586621683076579"><span class="hs-identifier hs-var">hs_outer_bndrs</span></a></span></span><span>
</span><span id="line-609"></span><span>                                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sig_body :: forall pass. HsSigType pass -&gt; LHsType pass
</span><a href="Language.Haskell.Syntax.Type.html#sig_body"><span class="hs-identifier hs-var">sig_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683076580"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076580"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-610"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; TcM Type -&gt; TcM Type
forall ann a. EpAnn ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683076577"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM Type -&gt; TcM Type) -&gt; TcM Type -&gt; TcM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-611"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc_top_lhs_type {&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsSigType GhcRn -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsSigType GhcRn
</span><a href="#local-6989586621683076578"><span class="hs-identifier hs-var">sig_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-612"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683076581"><span class="annot"><a href="#local-6989586621683076581"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon -&gt; IOEnv (Env TcGblEnv TcLclEnv) SkolemInfo
forall (m :: * -&gt; *). MonadIO m =&gt; SkolemInfoAnon -&gt; m SkolemInfo
</span><a href="GHC.Tc.Types.Origin.html#mkSkolemInfo"><span class="hs-identifier hs-var">mkSkolemInfo</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon
</span><a href="#local-6989586621683076582"><span class="hs-identifier hs-var">skol_info_anon</span></a></span><span>
</span><span id="line-613"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683076583"><span class="annot"><a href="#local-6989586621683076583"><span class="hs-identifier hs-var">tclvl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683076584"><span class="annot"><a href="#local-6989586621683076584"><span class="hs-identifier hs-var">wanted</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683076585"><span class="annot"><a href="#local-6989586621683076585"><span class="hs-identifier hs-var">outer_bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683076586"><span class="annot"><a href="#local-6989586621683076586"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-614"></span><span>              </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.html#pushLevelAndSolveEqualitiesX"><span class="hs-identifier hs-type">pushLevelAndSolveEqualitiesX</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc_top_lhs_type&quot;</span></span><span>    </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-615"></span><span>                 </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683076587"><span class="annot"><a href="#local-6989586621683076587"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#newExpectedKind"><span class="hs-identifier hs-type">newExpectedKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#expectedKindInCtxt"><span class="hs-identifier hs-type">expectedKindInCtxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076576"><span class="hs-identifier hs-type">ctxt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-616"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcOuterTKBndrs"><span class="hs-identifier hs-type">tcOuterTKBndrs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076581"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076579"><span class="hs-identifier hs-type">hs_outer_bndrs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-617"></span><span>                      </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tc_check_lhs_type"><span class="hs-identifier hs-type">tc_check_lhs_type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#mkMode"><span class="hs-identifier hs-type">mkMode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076575"><span class="hs-identifier hs-type">tyki</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683076580"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076587"><span class="hs-identifier hs-type">kind</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-618"></span><span>
</span><span id="line-619"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683076590"><span class="annot"><a href="#local-6989586621683076590"><span class="hs-identifier hs-var">outer_bndrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#scopedSortOuter"><span class="hs-identifier hs-type">scopedSortOuter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076585"><span class="hs-identifier hs-type">outer_bndrs</span></a></span><span>
</span><span id="line-620"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683076591"><span class="annot"><a href="#local-6989586621683076591"><span class="hs-identifier hs-var hs-var">outer_tv_bndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsOuterTyVarBndrs Specificity GhcTc
-&gt; [VarBndr TcTyVar Specificity]
</span><a href="GHC.Tc.Gen.HsType.html#outerTyVarBndrs"><span class="hs-identifier hs-var">outerTyVarBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">HsOuterTyVarBndrs Specificity GhcTc
</span><a href="#local-6989586621683076590"><span class="hs-identifier hs-var">outer_bndrs</span></a></span><span>
</span><span id="line-621"></span><span>             </span><span id="local-6989586621683076592"><span class="annot"><a href="#local-6989586621683076592"><span class="hs-identifier hs-var hs-var">ty1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[VarBndr TcTyVar Specificity] -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkInvisForAllTys"><span class="hs-identifier hs-var">mkInvisForAllTys</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr TcTyVar Specificity]
</span><a href="#local-6989586621683076591"><span class="hs-identifier hs-var">outer_tv_bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683076586"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-622"></span><span>
</span><span id="line-623"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683076593"><span class="annot"><a href="#local-6989586621683076593"><span class="hs-identifier hs-var">kvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#kindGeneralizeAll"><span class="hs-identifier hs-type">kindGeneralizeAll</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076581"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076592"><span class="hs-identifier hs-type">ty1</span></a></span><span>  </span><span class="hs-comment">-- &quot;All&quot; because it's a top-level type</span><span>
</span><span id="line-624"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.html#reportUnsolvedEqualities"><span class="hs-identifier hs-type">reportUnsolvedEqualities</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076581"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076593"><span class="hs-identifier hs-type">kvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076583"><span class="hs-identifier hs-type">tclvl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076584"><span class="hs-identifier hs-type">wanted</span></a></span><span>
</span><span id="line-625"></span><span>
</span><span id="line-626"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683076595"><span class="annot"><a href="#local-6989586621683076595"><span class="hs-identifier hs-var">final_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Env.html#initZonkEnv"><span class="hs-identifier hs-type">initZonkEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Env.html#DefaultFlexi"><span class="hs-identifier hs-type">DefaultFlexi</span></a></span><span>
</span><span id="line-627"></span><span>                   </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Type.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-type">zonkTcTypeToTypeX</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#mkInfForAllTys"><span class="hs-identifier hs-type">mkInfForAllTys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076593"><span class="hs-identifier hs-type">kvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076592"><span class="hs-identifier hs-type">ty1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-628"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc_top_lhs_type }&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076578"><span class="hs-identifier hs-type">sig_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076595"><span class="hs-identifier hs-type">final_ty</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-629"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683076595"><span class="hs-identifier hs-type">final_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-630"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-631"></span><span>    </span><span id="local-6989586621683076582"><span class="annot"><span class="annottext">skol_info_anon :: SkolemInfoAnon
</span><a href="#local-6989586621683076582"><span class="hs-identifier hs-var hs-var">skol_info_anon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt -&gt; SkolemInfoAnon
</span><a href="GHC.Tc.Types.Origin.html#SigTypeSkol"><span class="hs-identifier hs-var">SigTypeSkol</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621683076576"><span class="hs-identifier hs-var">ctxt</span></a></span><span>
</span><span id="line-632"></span><span>
</span><span id="line-633"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcClassConstraint"><span class="hs-identifier hs-type">tcClassConstraint</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-634"></span><span class="hs-comment">-- Like tcHsSigType, but for a simple class constraint of form ( C ty1 ty2 )</span><span>
</span><span id="line-635"></span><span class="hs-comment">-- Returns the C, [ty1, ty2], and the kinds of C's remaining arguments</span><span>
</span><span id="line-636"></span><span class="hs-comment">-- E.g.    class C (a::*) (b::k-&gt;k)</span><span>
</span><span id="line-637"></span><span class="hs-comment">--         tcClassConstraint ( C Int ) returns Right ([k], C, [k, Int], [k-&gt;k])</span><span>
</span><span id="line-638"></span><span class="hs-comment">-- Return values are fully zonked</span><span>
</span><span id="line-639"></span><span id="tcClassConstraint"><span class="annot"><span class="annottext">tcClassConstraint :: Type
-&gt; TcM (Either (Maybe TyCon) ([TcTyVar], Class, [Type], [Type]))
</span><a href="GHC.Tc.Gen.HsType.html#tcClassConstraint"><span class="hs-identifier hs-var hs-var">tcClassConstraint</span></a></span></span><span> </span><span id="local-6989586621683076602"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683076602"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-640"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683076603"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683076603"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683076604"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683076604"><span class="hs-identifier hs-var">pred</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([TcTyVar], Type)
</span><a href="GHC.Core.Type.html#splitForAllTyCoVars"><span class="hs-identifier hs-var">splitForAllTyCoVars</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683076602"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-641"></span><span>             </span><span class="hs-special">(</span><span id="local-6989586621683076606"><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621683076606"><span class="hs-identifier hs-var">kind_args</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([Scaled Type], Type)
</span><a href="GHC.Core.Type.html#splitFunTys"><span class="hs-identifier hs-var">splitFunTys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683076604"><span class="hs-identifier hs-var">pred</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-642"></span><span>      </span><span class="hs-comment">-- Checking that `pred` a is type class application</span><span>
</span><span id="line-643"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683076604"><span class="hs-identifier hs-var">pred</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-644"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683076610"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683076610"><span class="hs-identifier hs-var">tyCon</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683076611"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683076611"><span class="hs-identifier hs-var">tyConArgs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-645"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe Class
</span><a href="GHC.Core.TyCon.html#tyConClass_maybe"><span class="hs-identifier hs-var">tyConClass_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683076610"><span class="hs-identifier hs-var">tyCon</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-646"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683076613"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683076613"><span class="hs-identifier hs-var">clas</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-647"></span><span>                </span><span class="annot"><span class="annottext">Either (Maybe TyCon) ([TcTyVar], Class, [Type], [Type])
-&gt; TcM (Either (Maybe TyCon) ([TcTyVar], Class, [Type], [Type]))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([TcTyVar], Class, [Type], [Type])
-&gt; Either (Maybe TyCon) ([TcTyVar], Class, [Type], [Type])
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683076603"><span class="hs-identifier hs-var">tvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683076613"><span class="hs-identifier hs-var">clas</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683076611"><span class="hs-identifier hs-var">tyConArgs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Scaled Type -&gt; Type) -&gt; [Scaled Type] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Scaled Type -&gt; Type
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621683076606"><span class="hs-identifier hs-var">kind_args</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-648"></span><span>              </span><span class="annot"><span class="annottext">Maybe Class
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either (Maybe TyCon) ([TcTyVar], Class, [Type], [Type])
-&gt; TcM (Either (Maybe TyCon) ([TcTyVar], Class, [Type], [Type]))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe TyCon
-&gt; Either (Maybe TyCon) ([TcTyVar], Class, [Type], [Type])
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Maybe TyCon
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683076610"><span class="hs-identifier hs-var">tyCon</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-649"></span><span>          </span><span class="annot"><span class="annottext">Maybe (TyCon, [Type])
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either (Maybe TyCon) ([TcTyVar], Class, [Type], [Type])
-&gt; TcM (Either (Maybe TyCon) ([TcTyVar], Class, [Type], [Type]))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe TyCon
-&gt; Either (Maybe TyCon) ([TcTyVar], Class, [Type], [Type])
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">Maybe TyCon
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-650"></span><span>
</span><span id="line-651"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsDefault"><span class="hs-identifier hs-type">tcHsDefault</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsSigType"><span class="hs-identifier hs-type">LHsSigType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-652"></span><span class="hs-comment">-- Like tcHsSigType, but for the default ( C ty1 ty2 ) (ty1', ty2', ...) declaration</span><span>
</span><span id="line-653"></span><span class="hs-comment">-- See Note [Named default declarations] in GHC.Tc.Gen.Default</span><span>
</span><span id="line-654"></span><span id="tcHsDefault"><span class="annot"><span class="annottext">tcHsDefault :: LHsSigType GhcRn -&gt; TcM ([TcTyVar], Class, [Type], [Type])
</span><a href="GHC.Tc.Gen.HsType.html#tcHsDefault"><span class="hs-identifier hs-var hs-var">tcHsDefault</span></a></span></span><span> </span><span id="local-6989586621683076615"><span class="annot"><span class="annottext">LHsSigType GhcRn
</span><a href="#local-6989586621683076615"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span>
</span><span id="line-655"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt -&gt; LHsSigType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcTopLHsType"><span class="hs-identifier hs-var">tcTopLHsType</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#DefaultDeclCtxt"><span class="hs-identifier hs-var">DefaultDeclCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsSigType GhcRn
</span><a href="#local-6989586621683076615"><span class="hs-identifier hs-var">hs_ty</span></a></span><span>
</span><span id="line-656"></span><span>    </span><span class="annot"><span class="annottext">TcM Type
-&gt; (Type
    -&gt; TcM (Either (Maybe TyCon) ([TcTyVar], Class, [Type], [Type])))
-&gt; TcM (Either (Maybe TyCon) ([TcTyVar], Class, [Type], [Type]))
forall a b.
IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; (a -&gt; IOEnv (Env TcGblEnv TcLclEnv) b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Type
-&gt; TcM (Either (Maybe TyCon) ([TcTyVar], Class, [Type], [Type]))
</span><a href="GHC.Tc.Gen.HsType.html#tcClassConstraint"><span class="hs-identifier hs-var">tcClassConstraint</span></a></span><span>
</span><span id="line-657"></span><span>    </span><span class="annot"><span class="annottext">TcM (Either (Maybe TyCon) ([TcTyVar], Class, [Type], [Type]))
-&gt; (Either (Maybe TyCon) ([TcTyVar], Class, [Type], [Type])
    -&gt; TcM ([TcTyVar], Class, [Type], [Type]))
-&gt; TcM ([TcTyVar], Class, [Type], [Type])
forall a b.
IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; (a -&gt; IOEnv (Env TcGblEnv TcLclEnv) b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">(Maybe TyCon -&gt; TcM ([TcTyVar], Class, [Type], [Type]))
-&gt; (([TcTyVar], Class, [Type], [Type])
    -&gt; TcM ([TcTyVar], Class, [Type], [Type]))
-&gt; Either (Maybe TyCon) ([TcTyVar], Class, [Type], [Type])
-&gt; TcM ([TcTyVar], Class, [Type], [Type])
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcM ([TcTyVar], Class, [Type], [Type])
-&gt; Maybe TyCon -&gt; TcM ([TcTyVar], Class, [Type], [Type])
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(TcM ([TcTyVar], Class, [Type], [Type])
 -&gt; Maybe TyCon -&gt; TcM ([TcTyVar], Class, [Type], [Type]))
-&gt; TcM ([TcTyVar], Class, [Type], [Type])
-&gt; Maybe TyCon
-&gt; TcM ([TcTyVar], Class, [Type], [Type])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM ([TcTyVar], Class, [Type], [Type])
forall a. TcRnMessage -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; TcM ([TcTyVar], Class, [Type], [Type]))
-&gt; TcRnMessage -&gt; TcM ([TcTyVar], Class, [Type], [Type])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LHsSigType GhcRn -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnIllegalDefaultClass"><span class="hs-identifier hs-var">TcRnIllegalDefaultClass</span></a></span><span> </span><span class="annot"><span class="annottext">LHsSigType GhcRn
</span><a href="#local-6989586621683076615"><span class="hs-identifier hs-var">hs_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([TcTyVar], Class, [Type], [Type])
-&gt; TcM ([TcTyVar], Class, [Type], [Type])
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-658"></span><span>
</span><span id="line-659"></span><span class="hs-comment">-----------------</span><span>
</span><span id="line-660"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsDeriv"><span class="hs-identifier hs-type">tcHsDeriv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsSigType"><span class="hs-identifier hs-type">LHsSigType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-661"></span><span class="hs-comment">-- Like tcHsSigType, but for the ...deriving( C ty1 ty2 ) clause</span><span>
</span><span id="line-662"></span><span class="hs-comment">-- Returns the C, [ty1, ty2], and the kinds of C's remaining arguments</span><span>
</span><span id="line-663"></span><span class="hs-comment">-- E.g.    class C (a::*) (b::k-&gt;k)</span><span>
</span><span id="line-664"></span><span class="hs-comment">--         data T a b = ... deriving( C Int )</span><span>
</span><span id="line-665"></span><span class="hs-comment">--    returns ([k], C, [k, Int], [k-&gt;k])</span><span>
</span><span id="line-666"></span><span class="hs-comment">-- Return values are fully zonked</span><span>
</span><span id="line-667"></span><span id="tcHsDeriv"><span class="annot"><span class="annottext">tcHsDeriv :: LHsSigType GhcRn -&gt; TcM ([TcTyVar], Class, [Type], [Type])
</span><a href="GHC.Tc.Gen.HsType.html#tcHsDeriv"><span class="hs-identifier hs-var hs-var">tcHsDeriv</span></a></span></span><span> </span><span id="local-6989586621683076621"><span class="annot"><span class="annottext">LHsSigType GhcRn
</span><a href="#local-6989586621683076621"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span>
</span><span id="line-668"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683076622"><span class="annot"><a href="#local-6989586621683076622"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt -&gt; LHsSigType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcTopLHsType"><span class="hs-identifier hs-var">tcTopLHsType</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#DerivClauseCtxt"><span class="hs-identifier hs-var">DerivClauseCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsSigType GhcRn
</span><a href="#local-6989586621683076621"><span class="hs-identifier hs-var">hs_ty</span></a></span><span>
</span><span id="line-669"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683076624"><span class="annot"><a href="#local-6989586621683076624"><span class="hs-identifier hs-var">constrained</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcClassConstraint"><span class="hs-identifier hs-type">tcClassConstraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076622"><span class="hs-identifier hs-type">ty</span></a></span><span>
</span><span id="line-670"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683076624"><span class="hs-identifier hs-type">constrained</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-671"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">Maybe TyCon
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM ([TcTyVar], Class, [Type], [Type])
forall a. TcRnMessage -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsSigType GhcRn -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnIllegalDerivingItem"><span class="hs-identifier hs-var">TcRnIllegalDerivingItem</span></a></span><span> </span><span class="annot"><span class="annottext">LHsSigType GhcRn
</span><a href="#local-6989586621683076621"><span class="hs-identifier hs-var">hs_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-672"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683076626"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683076626"><span class="hs-identifier hs-var">tyCon</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-673"></span><span>             </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM ([TcTyVar], Class, [Type], [Type])
forall a. TcRnMessage -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; TcM ([TcTyVar], Class, [Type], [Type]))
-&gt; TcRnMessage -&gt; TcM ([TcTyVar], Class, [Type], [Type])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IllegalInstanceReason -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnIllegalInstance"><span class="hs-identifier hs-var">TcRnIllegalInstance</span></a></span><span>
</span><span id="line-674"></span><span>                        </span><span class="annot"><span class="annottext">(IllegalInstanceReason -&gt; TcRnMessage)
-&gt; IllegalInstanceReason -&gt; TcRnMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypedThing -&gt; IllegalClassInstanceReason -&gt; IllegalInstanceReason
</span><a href="GHC.Tc.Errors.Types.html#IllegalClassInstance"><span class="hs-identifier hs-var">IllegalClassInstance</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; TypedThing
</span><a href="GHC.Tc.Types.Origin.html#TypeThing"><span class="hs-identifier hs-var">TypeThing</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683076622"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-675"></span><span>                        </span><span class="annot"><span class="annottext">(IllegalClassInstanceReason -&gt; IllegalInstanceReason)
-&gt; IllegalClassInstanceReason -&gt; IllegalInstanceReason
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IllegalInstanceHeadReason -&gt; IllegalClassInstanceReason
</span><a href="GHC.Tc.Errors.Types.html#IllegalInstanceHead"><span class="hs-identifier hs-var">IllegalInstanceHead</span></a></span><span>
</span><span id="line-676"></span><span>                        </span><span class="annot"><span class="annottext">(IllegalInstanceHeadReason -&gt; IllegalClassInstanceReason)
-&gt; IllegalInstanceHeadReason -&gt; IllegalClassInstanceReason
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe TyCon -&gt; IllegalInstanceHeadReason
</span><a href="GHC.Tc.Errors.Types.html#InstHeadNonClass"><span class="hs-identifier hs-var">InstHeadNonClass</span></a></span><span>
</span><span id="line-677"></span><span>                        </span><span class="annot"><span class="annottext">(Maybe TyCon -&gt; IllegalInstanceHeadReason)
-&gt; Maybe TyCon -&gt; IllegalInstanceHeadReason
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe TyCon
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683076626"><span class="hs-identifier hs-var">tyCon</span></a></span><span>
</span><span id="line-678"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621683076632"><span class="annot"><span class="annottext">([TcTyVar], Class, [Type], [Type])
</span><a href="#local-6989586621683076632"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([TcTyVar], Class, [Type], [Type])
-&gt; TcM ([TcTyVar], Class, [Type], [Type])
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([TcTyVar], Class, [Type], [Type])
</span><a href="#local-6989586621683076632"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-679"></span><span>
</span><span id="line-680"></span><span class="hs-comment">-- | Typecheck a deriving strategy. For most deriving strategies, this is a</span><span>
</span><span id="line-681"></span><span class="hs-comment">-- no-op, but for the @via@ strategy, this requires typechecking the @via@ type.</span><span>
</span><span id="line-682"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcDerivStrategy"><span class="hs-identifier hs-type">tcDerivStrategy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#LDerivStrategy"><span class="hs-identifier hs-type">LDerivStrategy</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-683"></span><span>                   </span><span class="annot"><span class="hs-comment">-- ^ The deriving strategy</span></span><span>
</span><span id="line-684"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#LDerivStrategy"><span class="hs-identifier hs-type">LDerivStrategy</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-685"></span><span>                   </span><span class="hs-comment">-- ^ The typechecked deriving strategy and the tyvars that it binds</span><span>
</span><span id="line-686"></span><span>                   </span><span class="hs-comment">-- (if using 'ViaStrategy').</span><span>
</span><span id="line-687"></span><span id="tcDerivStrategy"><span class="annot"><span class="annottext">tcDerivStrategy :: Maybe (LDerivStrategy GhcRn)
-&gt; TcM (Maybe (LDerivStrategy GhcTc), [TcTyVar])
</span><a href="GHC.Tc.Gen.HsType.html#tcDerivStrategy"><span class="hs-identifier hs-var hs-var">tcDerivStrategy</span></a></span></span><span> </span><span id="local-6989586621683076634"><span class="annot"><span class="annottext">Maybe (LDerivStrategy GhcRn)
</span><a href="#local-6989586621683076634"><span class="hs-identifier hs-var">mb_lds</span></a></span></span><span>
</span><span id="line-688"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (LDerivStrategy GhcRn)
</span><a href="#local-6989586621683076634"><span class="hs-identifier hs-var">mb_lds</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-689"></span><span>      </span><span class="annot"><span class="annottext">Maybe (LDerivStrategy GhcRn)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (GenLocated EpAnnCO (DerivStrategy GhcTc))
-&gt; TcM
     (Maybe (GenLocated EpAnnCO (DerivStrategy GhcTc)), [TcTyVar])
forall ds a. ds -&gt; TcM (ds, [a])
</span><a href="#local-6989586621683076635"><span class="hs-identifier hs-var">boring_case</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (GenLocated EpAnnCO (DerivStrategy GhcTc))
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-690"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683076636"><span class="annot"><span class="annottext">EpAnnCO
</span><a href="#local-6989586621683076636"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683076637"><span class="annot"><span class="annottext">DerivStrategy GhcRn
</span><a href="#local-6989586621683076637"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-691"></span><span>        </span><span class="annot"><span class="annottext">EpAnnCO
-&gt; TcM (Maybe (LDerivStrategy GhcTc), [TcTyVar])
-&gt; TcM (Maybe (LDerivStrategy GhcTc), [TcTyVar])
forall ann a. EpAnn ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">EpAnnCO
</span><a href="#local-6989586621683076636"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (Maybe (LDerivStrategy GhcTc), [TcTyVar])
 -&gt; TcM (Maybe (LDerivStrategy GhcTc), [TcTyVar]))
-&gt; TcM (Maybe (LDerivStrategy GhcTc), [TcTyVar])
-&gt; TcM (Maybe (LDerivStrategy GhcTc), [TcTyVar])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-692"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621683076638"><span class="annot"><a href="#local-6989586621683076638"><span class="hs-identifier hs-var">ds'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683076639"><span class="annot"><a href="#local-6989586621683076639"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DerivStrategy GhcRn -&gt; TcM (DerivStrategy GhcTc, [TcTyVar])
</span><a href="#local-6989586621683076640"><span class="hs-identifier hs-var">tc_deriv_strategy</span></a></span><span> </span><span class="annot"><span class="annottext">DerivStrategy GhcRn
</span><a href="#local-6989586621683076637"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-693"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076636"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076638"><span class="hs-identifier hs-type">ds'</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683076639"><span class="hs-identifier hs-type">tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-694"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-695"></span><span>    </span><span class="annot"><a href="#local-6989586621683076640"><span class="hs-identifier hs-type">tc_deriv_strategy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#DerivStrategy"><span class="hs-identifier hs-type">DerivStrategy</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-696"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#DerivStrategy"><span class="hs-identifier hs-type">DerivStrategy</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-697"></span><span>    </span><span id="local-6989586621683076640"><span class="annot"><span class="annottext">tc_deriv_strategy :: DerivStrategy GhcRn -&gt; TcM (DerivStrategy GhcTc, [TcTyVar])
</span><a href="#local-6989586621683076640"><span class="hs-identifier hs-var hs-var">tc_deriv_strategy</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#StockStrategy"><span class="hs-identifier hs-type">StockStrategy</span></a></span><span>    </span><span class="annot"><span class="annottext">XStockStrategy GhcRn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DerivStrategy GhcTc -&gt; TcM (DerivStrategy GhcTc, [TcTyVar])
forall ds a. ds -&gt; TcM (ds, [a])
</span><a href="#local-6989586621683076635"><span class="hs-identifier hs-var">boring_case</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XStockStrategy GhcTc -&gt; DerivStrategy GhcTc
forall pass. XStockStrategy pass -&gt; DerivStrategy pass
</span><a href="Language.Haskell.Syntax.Decls.html#StockStrategy"><span class="hs-identifier hs-var">StockStrategy</span></a></span><span>    </span><span class="annot"><span class="annottext">XStockStrategy GhcTc
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-698"></span><span>    </span><span class="annot"><a href="#local-6989586621683076640"><span class="hs-identifier hs-var">tc_deriv_strategy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#AnyclassStrategy"><span class="hs-identifier hs-type">AnyclassStrategy</span></a></span><span> </span><span class="annot"><span class="annottext">XAnyClassStrategy GhcRn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DerivStrategy GhcTc -&gt; TcM (DerivStrategy GhcTc, [TcTyVar])
forall ds a. ds -&gt; TcM (ds, [a])
</span><a href="#local-6989586621683076635"><span class="hs-identifier hs-var">boring_case</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XAnyClassStrategy GhcTc -&gt; DerivStrategy GhcTc
forall pass. XAnyClassStrategy pass -&gt; DerivStrategy pass
</span><a href="Language.Haskell.Syntax.Decls.html#AnyclassStrategy"><span class="hs-identifier hs-var">AnyclassStrategy</span></a></span><span> </span><span class="annot"><span class="annottext">XAnyClassStrategy GhcTc
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-699"></span><span>    </span><span class="annot"><a href="#local-6989586621683076640"><span class="hs-identifier hs-var">tc_deriv_strategy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#NewtypeStrategy"><span class="hs-identifier hs-type">NewtypeStrategy</span></a></span><span>  </span><span class="annot"><span class="annottext">XNewtypeStrategy GhcRn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DerivStrategy GhcTc -&gt; TcM (DerivStrategy GhcTc, [TcTyVar])
forall ds a. ds -&gt; TcM (ds, [a])
</span><a href="#local-6989586621683076635"><span class="hs-identifier hs-var">boring_case</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XNewtypeStrategy GhcTc -&gt; DerivStrategy GhcTc
forall pass. XNewtypeStrategy pass -&gt; DerivStrategy pass
</span><a href="Language.Haskell.Syntax.Decls.html#NewtypeStrategy"><span class="hs-identifier hs-var">NewtypeStrategy</span></a></span><span>  </span><span class="annot"><span class="annottext">XNewtypeStrategy GhcTc
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-700"></span><span>    </span><span class="annot"><a href="#local-6989586621683076640"><span class="hs-identifier hs-var">tc_deriv_strategy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#ViaStrategy"><span class="hs-identifier hs-type">ViaStrategy</span></a></span><span> </span><span id="local-6989586621683076645"><span class="annot"><span class="annottext">XViaStrategy GhcRn
</span><a href="#local-6989586621683076645"><span class="hs-identifier hs-var">hs_sig</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-701"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683076646"><span class="annot"><a href="#local-6989586621683076646"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt -&gt; LHsSigType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcTopLHsType"><span class="hs-identifier hs-var">tcTopLHsType</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#DerivClauseCtxt"><span class="hs-identifier hs-var">DerivClauseCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">XViaStrategy GhcRn
LHsSigType GhcRn
</span><a href="#local-6989586621683076645"><span class="hs-identifier hs-var">hs_sig</span></a></span><span>
</span><span id="line-702"></span><span>             </span><span class="hs-comment">-- rec {..}: see Note [Keeping SkolemInfo inside a SkolemTv]</span><span>
</span><span id="line-703"></span><span>             </span><span class="hs-comment">--           in GHC.Tc.Utils.TcType</span><span>
</span><span id="line-704"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">rec</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683076647"><span class="annot"><a href="#local-6989586621683076647"><span class="hs-identifier hs-var">via_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683076648"><span class="annot"><a href="#local-6989586621683076648"><span class="hs-identifier hs-var">via_pred</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcSkolemiseInvisibleBndrs"><span class="hs-identifier hs-type">tcSkolemiseInvisibleBndrs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#DerivSkol"><span class="hs-identifier hs-type">DerivSkol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076648"><span class="hs-identifier hs-type">via_pred</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683076646"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-705"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#ViaStrategy"><span class="hs-identifier hs-type">ViaStrategy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076648"><span class="hs-identifier hs-type">via_pred</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683076647"><span class="hs-identifier hs-type">via_tvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-706"></span><span>
</span><span id="line-707"></span><span>    </span><span id="local-6989586621683075121"><span id="local-6989586621683075122"><span class="annot"><a href="#local-6989586621683076635"><span class="hs-identifier hs-type">boring_case</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621683075121"><span class="hs-identifier hs-type">ds</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683075121"><span class="hs-identifier hs-type">ds</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683075122"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-708"></span><span>    </span><span id="local-6989586621683076635"><span class="annot"><span class="annottext">boring_case :: forall ds a. ds -&gt; TcM (ds, [a])
</span><a href="#local-6989586621683076635"><span class="hs-identifier hs-var hs-var">boring_case</span></a></span></span><span> </span><span id="local-6989586621683076651"><span class="annot"><span class="annottext">ds
</span><a href="#local-6989586621683076651"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ds, [a]) -&gt; IOEnv (Env TcGblEnv TcLclEnv) (ds, [a])
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ds
</span><a href="#local-6989586621683076651"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-709"></span><span>
</span><span id="line-710"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsClsInstType"><span class="hs-identifier hs-type">tcHsClsInstType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a></span><span>    </span><span class="hs-comment">-- InstDeclCtxt or SpecInstCtxt</span><span>
</span><span id="line-711"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsSigType"><span class="hs-identifier hs-type">LHsSigType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-712"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-713"></span><span class="hs-comment">-- Like tcHsSigType, but for a class instance declaration</span><span>
</span><span id="line-714"></span><span id="tcHsClsInstType"><span class="annot"><span class="annottext">tcHsClsInstType :: UserTypeCtxt -&gt; LHsSigType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcHsClsInstType"><span class="hs-identifier hs-var hs-var">tcHsClsInstType</span></a></span></span><span> </span><span id="local-6989586621683076652"><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621683076652"><span class="hs-identifier hs-var">user_ctxt</span></a></span></span><span> </span><span id="local-6989586621683076653"><span class="annot"><span class="annottext">LHsSigType GhcRn
</span><a href="#local-6989586621683076653"><span class="hs-identifier hs-var">hs_inst_ty</span></a></span></span><span>
</span><span id="line-715"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcM Type -&gt; TcM Type
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsSigType GhcRn) -&gt; SrcSpan
forall a e. HasLoc a =&gt; GenLocated a e -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#getLocA"><span class="hs-identifier hs-var">getLocA</span></a></span><span> </span><span class="annot"><span class="annottext">LHsSigType GhcRn
GenLocated SrcSpanAnnA (HsSigType GhcRn)
</span><a href="#local-6989586621683076653"><span class="hs-identifier hs-var">hs_inst_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM Type -&gt; TcM Type) -&gt; TcM Type -&gt; TcM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-716"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683076654"><span class="annot"><a href="#local-6989586621683076654"><span class="hs-identifier hs-var">inst_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt -&gt; LHsSigType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcTopLHsType"><span class="hs-identifier hs-var">tcTopLHsType</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621683076652"><span class="hs-identifier hs-var">user_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsSigType GhcRn
</span><a href="#local-6989586621683076653"><span class="hs-identifier hs-var">hs_inst_ty</span></a></span><span>
</span><span id="line-717"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Validity.html#checkValidInstance"><span class="hs-identifier hs-type">checkValidInstance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076652"><span class="hs-identifier hs-type">user_ctxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076653"><span class="hs-identifier hs-type">hs_inst_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076654"><span class="hs-identifier hs-type">inst_ty</span></a></span><span>
</span><span id="line-718"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683076654"><span class="hs-identifier hs-type">inst_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-719"></span><span>
</span><span id="line-720"></span><span class="hs-comment">----------------------------------------------</span><span>
</span><span id="line-721"></span><span class="annot"><span class="hs-comment">-- | Type-check a visible type application</span></span><span>
</span><span id="line-722"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsTypeApp"><span class="hs-identifier hs-type">tcHsTypeApp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsWcType"><span class="hs-identifier hs-type">LHsWcType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-723"></span><span class="hs-comment">-- See Note [Recipe for checking a signature] in GHC.Tc.Gen.HsType</span><span>
</span><span id="line-724"></span><span id="tcHsTypeApp"><span class="annot"><span class="annottext">tcHsTypeApp :: LHsWcType GhcRn -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcHsTypeApp"><span class="hs-identifier hs-var hs-var">tcHsTypeApp</span></a></span></span><span> </span><span id="local-6989586621683076656"><span class="annot"><span class="annottext">LHsWcType GhcRn
</span><a href="#local-6989586621683076656"><span class="hs-identifier hs-var">wc_ty</span></a></span></span><span> </span><span id="local-6989586621683076657"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683076657"><span class="hs-identifier hs-var">kind</span></a></span></span><span>
</span><span id="line-725"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsWC"><span class="hs-identifier hs-type">HsWC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hswc_ext :: forall pass thing. HsWildCardBndrs pass thing -&gt; XHsWC pass thing
</span><a href="Language.Haskell.Syntax.Type.html#hswc_ext"><span class="hs-identifier hs-var">hswc_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683076660"><span class="annot"><span class="annottext">XHsWC GhcRn (LHsType GhcRn)
</span><a href="#local-6989586621683076660"><span class="hs-identifier hs-var">sig_wcs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hswc_body :: forall pass thing. HsWildCardBndrs pass thing -&gt; thing
</span><a href="Language.Haskell.Syntax.Type.html#hswc_body"><span class="hs-identifier hs-var">hswc_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683076662"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076662"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsWcType GhcRn
</span><a href="#local-6989586621683076656"><span class="hs-identifier hs-var">wc_ty</span></a></span><span>
</span><span id="line-726"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683076663"><span class="annot"><a href="#local-6989586621683076663"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeOrKind -&gt; HoleMode -&gt; TcM TcTyMode
</span><a href="GHC.Tc.Gen.HsType.html#mkHoleMode"><span class="hs-identifier hs-var">mkHoleMode</span></a></span><span> </span><span class="annot"><span class="annottext">TypeOrKind
</span><a href="GHC.Types.Basic.html#TypeLevel"><span class="hs-identifier hs-var">TypeLevel</span></a></span><span> </span><span class="annot"><span class="annottext">HoleMode
</span><a href="GHC.Tc.Gen.HsType.html#HM_VTA"><span class="hs-identifier hs-var">HM_VTA</span></a></span><span>
</span><span id="line-727"></span><span>                 </span><span class="hs-comment">-- HM_VTA: See Note [Wildcards in visible type application]</span><span>
</span><span id="line-728"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683076666"><span class="annot"><a href="#local-6989586621683076666"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#addTypeCtxt"><span class="hs-identifier hs-type">addTypeCtxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076662"><span class="hs-identifier hs-type">hs_ty</span></a></span><span>                  </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-729"></span><span>               </span><span class="annot"><a href="GHC.Tc.Solver.html#solveEqualities"><span class="hs-identifier hs-type">solveEqualities</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcHsTypeApp&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-730"></span><span>               </span><span class="hs-comment">-- We are looking at a user-written type, very like a</span><span>
</span><span id="line-731"></span><span>               </span><span class="hs-comment">-- signature so we want to solve its equalities right now</span><span>
</span><span id="line-732"></span><span>               </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindNamedWildCardBinders"><span class="hs-identifier hs-type">bindNamedWildCardBinders</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076660"><span class="hs-identifier hs-type">sig_wcs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">[(Name, TcTyVar)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-733"></span><span>               </span><span class="annot"><span class="annottext">TcTyMode -&gt; LHsType GhcRn -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_check_lhs_type"><span class="hs-identifier hs-var">tc_check_lhs_type</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076663"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076662"><span class="hs-identifier hs-var">hs_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683076657"><span class="hs-identifier hs-var">kind</span></a></span><span>
</span><span id="line-734"></span><span>
</span><span id="line-735"></span><span>       </span><span class="hs-comment">-- We do not kind-generalize type applications: we just</span><span>
</span><span id="line-736"></span><span>       </span><span class="hs-comment">-- instantiate with exactly what the user says.</span><span>
</span><span id="line-737"></span><span>       </span><span class="hs-comment">-- See Note [No generalization in type application]</span><span>
</span><span id="line-738"></span><span>       </span><span class="hs-comment">-- We still must call kindGeneralizeNone, though, according</span><span>
</span><span id="line-739"></span><span>       </span><span class="hs-comment">-- to Note [Recipe for checking a signature]</span><span>
</span><span id="line-740"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#kindGeneralizeNone"><span class="hs-identifier hs-type">kindGeneralizeNone</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076666"><span class="hs-identifier hs-type">ty</span></a></span><span>
</span><span id="line-741"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683076670"><span class="annot"><a href="#local-6989586621683076670"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-type">liftZonkM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-type">zonkTcType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076666"><span class="hs-identifier hs-type">ty</span></a></span><span>
</span><span id="line-742"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Validity.html#checkValidType"><span class="hs-identifier hs-type">checkValidType</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#TypeAppCtxt"><span class="hs-identifier hs-type">TypeAppCtxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076670"><span class="hs-identifier hs-type">ty</span></a></span><span>
</span><span id="line-743"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683076670"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-744"></span><span>
</span><span id="line-745"></span><span class="hs-comment">{- Note [Wildcards in visible type application]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
A HsWildCardBndrs's hswc_ext now only includes /named/ wildcards, so
any unnamed wildcards stay unchanged in hswc_body.  When called in
tcHsTypeApp, tcCheckLHsTypeInContext will call emitAnonTypeHole
on these anonymous wildcards. However, this would trigger
error/warning when an anonymous wildcard is passed in as a visible type
argument, which we do not want because users should be able to write
@_ to skip a instantiating a type variable variable without fuss. The
solution is to switch the PartialTypeSignatures flags here to let the
typechecker know that it's checking a '@_' and do not emit hole
constraints on it.  See related Note [Wildcards in visible kind
application] and Note [The wildcard story for types] in GHC.Hs.Type

Ugh!

Note [No generalization in type application]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We do not kind-generalize type applications. Imagine

  id @(Proxy Nothing)

If we kind-generalized, we would get

  id @(forall {k}. Proxy @(Maybe k) (Nothing @k))

which is very sneakily impredicative instantiation.

There is also the possibility of mentioning a wildcard
(`id @(Proxy _)`), which definitely should not be kind-generalized.

-}</span><span>
</span><span id="line-777"></span><span>
</span><span id="line-778"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcFamTyPats"><span class="hs-identifier hs-type">tcFamTyPats</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>
</span><span id="line-779"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#HsFamEqnPats"><span class="hs-identifier hs-type">HsFamEqnPats</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>                </span><span class="hs-comment">-- Patterns</span><span>
</span><span id="line-780"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span class="hs-special">)</span><span>          </span><span class="hs-comment">-- (lhs_type, lhs_kind)</span><span>
</span><span id="line-781"></span><span class="hs-comment">-- Check the LHS of a type/data family instance</span><span>
</span><span id="line-782"></span><span class="hs-comment">-- e.g.   type instance F ty1 .. tyn = ...</span><span>
</span><span id="line-783"></span><span class="hs-comment">-- Used for both type and data families</span><span>
</span><span id="line-784"></span><span id="tcFamTyPats"><span class="annot"><span class="annottext">tcFamTyPats :: TyCon -&gt; HsFamEqnPats GhcRn -&gt; TcM (Type, Type)
</span><a href="GHC.Tc.Gen.HsType.html#tcFamTyPats"><span class="hs-identifier hs-var hs-var">tcFamTyPats</span></a></span></span><span> </span><span id="local-6989586621683076673"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683076673"><span class="hs-identifier hs-var">fam_tc</span></a></span></span><span> </span><span id="local-6989586621683076674"><span class="annot"><span class="annottext">HsFamEqnPats GhcRn
</span><a href="#local-6989586621683076674"><span class="hs-identifier hs-var">hs_pats</span></a></span></span><span>
</span><span id="line-785"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcFamTyPats {&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcM ()) -&gt; SDoc -&gt; TcM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-786"></span><span>         </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683076673"><span class="hs-identifier hs-var">fam_tc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;arity:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683076675"><span class="hs-identifier hs-var">fam_arity</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-787"></span><span>
</span><span id="line-788"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683076676"><span class="annot"><a href="#local-6989586621683076676"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeOrKind -&gt; HoleMode -&gt; TcM TcTyMode
</span><a href="GHC.Tc.Gen.HsType.html#mkHoleMode"><span class="hs-identifier hs-var">mkHoleMode</span></a></span><span> </span><span class="annot"><span class="annottext">TypeOrKind
</span><a href="GHC.Types.Basic.html#TypeLevel"><span class="hs-identifier hs-var">TypeLevel</span></a></span><span> </span><span class="annot"><span class="annottext">HoleMode
</span><a href="GHC.Tc.Gen.HsType.html#HM_FamPat"><span class="hs-identifier hs-var">HM_FamPat</span></a></span><span>
</span><span id="line-789"></span><span>                 </span><span class="hs-comment">-- HM_FamPat: See Note [Wildcards in family instances] in</span><span>
</span><span id="line-790"></span><span>                 </span><span class="hs-comment">-- GHC.Rename.Module</span><span>
</span><span id="line-791"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683076678"><span class="annot"><a href="#local-6989586621683076678"><span class="hs-identifier hs-var hs-var">fun_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683076673"><span class="hs-identifier hs-var">fam_tc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-792"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683076680"><span class="annot"><a href="#local-6989586621683076680"><span class="hs-identifier hs-var">fam_app</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683076681"><span class="annot"><a href="#local-6989586621683076681"><span class="hs-identifier hs-var">res_kind</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcInferTyApps"><span class="hs-identifier hs-type">tcInferTyApps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076676"><span class="hs-identifier hs-type">mode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076683"><span class="hs-identifier hs-type">lhs_fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076678"><span class="hs-identifier hs-type">fun_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076674"><span class="hs-identifier hs-type">hs_pats</span></a></span><span>
</span><span id="line-793"></span><span>
</span><span id="line-794"></span><span>       </span><span class="hs-comment">-- Hack alert: see Note [tcFamTyPats: zonking the result kind]</span><span>
</span><span id="line-795"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683076684"><span class="annot"><a href="#local-6989586621683076684"><span class="hs-identifier hs-var">res_kind</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-type">liftZonkM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-type">zonkTcType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076681"><span class="hs-identifier hs-type">res_kind</span></a></span><span>
</span><span id="line-796"></span><span>
</span><span id="line-797"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;End tcFamTyPats }&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-798"></span><span>         </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076673"><span class="hs-identifier hs-type">fam_tc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;res_kind:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076684"><span class="hs-identifier hs-type">res_kind</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-799"></span><span>
</span><span id="line-800"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683076680"><span class="hs-identifier hs-type">fam_app</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683076684"><span class="hs-identifier hs-type">res_kind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-801"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-802"></span><span>    </span><span id="local-6989586621683076685"><span class="annot"><span class="annottext">fam_name :: Name
</span><a href="#local-6989586621683076685"><span class="hs-identifier hs-var hs-var">fam_name</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Name
</span><a href="GHC.Core.TyCon.html#tyConName"><span class="hs-identifier hs-var">tyConName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683076673"><span class="hs-identifier hs-var">fam_tc</span></a></span><span>
</span><span id="line-803"></span><span>    </span><span id="local-6989586621683076675"><span class="annot"><span class="annottext">fam_arity :: Int
</span><a href="#local-6989586621683076675"><span class="hs-identifier hs-var hs-var">fam_arity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Int
</span><a href="GHC.Core.TyCon.html#tyConArity"><span class="hs-identifier hs-var">tyConArity</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683076673"><span class="hs-identifier hs-var">fam_tc</span></a></span><span>
</span><span id="line-804"></span><span>    </span><span id="local-6989586621683076683"><span class="annot"><span class="annottext">lhs_fun :: GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621683076683"><span class="hs-identifier hs-var hs-var">lhs_fun</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsType GhcRn -&gt; GenLocated SrcSpanAnnA (HsType GhcRn)
forall e a. HasAnnotation e =&gt; a -&gt; GenLocated e a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XTyVar GhcRn -&gt; PromotionFlag -&gt; LIdP GhcRn -&gt; HsType GhcRn
forall pass.
XTyVar pass -&gt; PromotionFlag -&gt; LIdP pass -&gt; HsType pass
</span><a href="Language.Haskell.Syntax.Type.html#HsTyVar"><span class="hs-identifier hs-var">HsTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">XTyVar GhcRn
forall a. NoAnn a =&gt; a
</span><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-var">noAnn</span></a></span><span> </span><span class="annot"><span class="annottext">PromotionFlag
</span><a href="Language.Haskell.Syntax.Type.html#NotPromoted"><span class="hs-identifier hs-var">NotPromoted</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; GenLocated SrcSpanAnnN Name
forall e a. HasAnnotation e =&gt; a -&gt; GenLocated e a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683076685"><span class="hs-identifier hs-var">fam_name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-805"></span><span>
</span><span id="line-806"></span><span class="hs-comment">{- Note [tcFamTyPats: zonking the result kind]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider (#19250)
    F :: forall k. k -&gt; k
    type instance F (x :: Constraint) = ()

The tricky point is this:
  is that () an empty type tuple (() :: Type), or
  an empty constraint tuple (() :: Constraint)?
We work this out in a hacky way, by looking at the expected kind:
see Note [Inferring tuple kinds].

In this case, we kind-check the RHS using the kind gotten from the LHS:
see the call to tcCheckLHsTypeInContext in tcTyFamInstEqnGuts in GHC.Tc.Tycl.

But we want the kind from the LHS to be /zonked/, so that when
kind-checking the RHS (tcCheckLHsTypeInContext) we can &quot;see&quot; what we learned
from kind-checking the LHS (tcFamTyPats).  In our example above, the
type of the LHS is just `kappa` (by instantiating the forall k), but
then we learn (from x::Constraint) that kappa ~ Constraint.  We want
that info when kind-checking the RHS.

Easy solution: just zonk that return kind.  Of course this won't help
if there is lots of type-family reduction to do, but it works fine in
common cases.
-}</span><span>
</span><span id="line-832"></span><span>
</span><span id="line-833"></span><span>
</span><span id="line-834"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
            The main kind checker: no validity checks here
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-841"></span><span>
</span><span id="line-842"></span><span class="hs-comment">---------------------------</span><span>
</span><span id="line-843"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsOpenType"><span class="hs-identifier hs-type">tcHsOpenType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsLiftedType"><span class="hs-identifier hs-type">tcHsLiftedType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-844"></span><span>  </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsOpenTypeNC"><span class="hs-identifier hs-type">tcHsOpenTypeNC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsLiftedTypeNC"><span class="hs-identifier hs-type">tcHsLiftedTypeNC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-845"></span><span class="hs-comment">-- Used for type signatures</span><span>
</span><span id="line-846"></span><span class="hs-comment">-- Do not do validity checking</span><span>
</span><span id="line-847"></span><span id="tcHsOpenType"><span class="annot"><span class="annottext">tcHsOpenType :: LHsType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcHsOpenType"><span class="hs-identifier hs-var hs-var">tcHsOpenType</span></a></span></span><span>   </span><span id="local-6989586621683076692"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076692"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; TcM Type -&gt; TcM Type
forall a. LHsType GhcRn -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.HsType.html#addTypeCtxt"><span class="hs-identifier hs-var">addTypeCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076692"><span class="hs-identifier hs-var">hs_ty</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM Type -&gt; TcM Type) -&gt; TcM Type -&gt; TcM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcHsOpenTypeNC"><span class="hs-identifier hs-var">tcHsOpenTypeNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076692"><span class="hs-identifier hs-var">hs_ty</span></a></span><span>
</span><span id="line-848"></span><span id="tcHsLiftedType"><span class="annot"><span class="annottext">tcHsLiftedType :: LHsType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcHsLiftedType"><span class="hs-identifier hs-var hs-var">tcHsLiftedType</span></a></span></span><span> </span><span id="local-6989586621683076693"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076693"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; TcM Type -&gt; TcM Type
forall a. LHsType GhcRn -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.HsType.html#addTypeCtxt"><span class="hs-identifier hs-var">addTypeCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076693"><span class="hs-identifier hs-var">hs_ty</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM Type -&gt; TcM Type) -&gt; TcM Type -&gt; TcM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcHsLiftedTypeNC"><span class="hs-identifier hs-var">tcHsLiftedTypeNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076693"><span class="hs-identifier hs-var">hs_ty</span></a></span><span>
</span><span id="line-849"></span><span>
</span><span id="line-850"></span><span id="tcHsOpenTypeNC"><span class="annot"><span class="annottext">tcHsOpenTypeNC :: LHsType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcHsOpenTypeNC"><span class="hs-identifier hs-var hs-var">tcHsOpenTypeNC</span></a></span></span><span>   </span><span id="local-6989586621683076694"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076694"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683076695"><span class="annot"><a href="#local-6989586621683076695"><span class="hs-identifier hs-var">ek</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM Type
</span><a href="GHC.Tc.Utils.TcMType.html#newOpenTypeKind"><span class="hs-identifier hs-var">newOpenTypeKind</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcCheckLHsType"><span class="hs-identifier hs-type">tcCheckLHsType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076694"><span class="hs-identifier hs-type">hs_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076695"><span class="hs-identifier hs-type">ek</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-851"></span><span id="tcHsLiftedTypeNC"><span class="annot"><span class="annottext">tcHsLiftedTypeNC :: LHsType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcHsLiftedTypeNC"><span class="hs-identifier hs-var hs-var">tcHsLiftedTypeNC</span></a></span></span><span> </span><span id="local-6989586621683076697"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076697"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcCheckLHsType"><span class="hs-identifier hs-var">tcCheckLHsType</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076697"><span class="hs-identifier hs-var">hs_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span>
</span><span id="line-852"></span><span>
</span><span id="line-853"></span><span class="hs-comment">-- Like tcCheckLHsType, but takes an expected kind</span><span>
</span><span id="line-854"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcCheckLHsTypeInContext"><span class="hs-identifier hs-type">tcCheckLHsTypeInContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#ContextKind"><span class="hs-identifier hs-type">ContextKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-855"></span><span id="tcCheckLHsTypeInContext"><span class="annot"><span class="annottext">tcCheckLHsTypeInContext :: LHsType GhcRn -&gt; ContextKind -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcCheckLHsTypeInContext"><span class="hs-identifier hs-var hs-var">tcCheckLHsTypeInContext</span></a></span></span><span> </span><span id="local-6989586621683076698"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076698"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span> </span><span id="local-6989586621683076699"><span class="annot"><span class="annottext">ContextKind
</span><a href="#local-6989586621683076699"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span>
</span><span id="line-856"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; TcM Type -&gt; TcM Type
forall a. LHsType GhcRn -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.HsType.html#addTypeCtxt"><span class="hs-identifier hs-var">addTypeCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076698"><span class="hs-identifier hs-var">hs_ty</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM Type -&gt; TcM Type) -&gt; TcM Type -&gt; TcM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-857"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683076700"><span class="annot"><a href="#local-6989586621683076700"><span class="hs-identifier hs-var">ek</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ContextKind -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#newExpectedKind"><span class="hs-identifier hs-var">newExpectedKind</span></a></span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="#local-6989586621683076699"><span class="hs-identifier hs-var">exp_kind</span></a></span><span>
</span><span id="line-858"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcCheckLHsType"><span class="hs-identifier hs-type">tcCheckLHsType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076698"><span class="hs-identifier hs-type">hs_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076700"><span class="hs-identifier hs-type">ek</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-859"></span><span>
</span><span id="line-860"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcInferLHsType"><span class="hs-identifier hs-type">tcInferLHsType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-861"></span><span id="tcInferLHsType"><span class="annot"><span class="annottext">tcInferLHsType :: LHsType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcInferLHsType"><span class="hs-identifier hs-var hs-var">tcInferLHsType</span></a></span></span><span> </span><span id="local-6989586621683076701"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076701"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span>
</span><span id="line-862"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683076702"><span class="annot"><a href="#local-6989586621683076702"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683076703"><span class="annot"><a href="#local-6989586621683076703"><span class="hs-identifier hs-var">_kind</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; TcM (Type, Type)
</span><a href="GHC.Tc.Gen.HsType.html#tcInferLHsTypeKind"><span class="hs-identifier hs-var">tcInferLHsTypeKind</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076701"><span class="hs-identifier hs-var">hs_ty</span></a></span><span>
</span><span id="line-863"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683076702"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-864"></span><span>
</span><span id="line-865"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcInferLHsTypeKind"><span class="hs-identifier hs-type">tcInferLHsTypeKind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-866"></span><span class="hs-comment">-- Called from outside: set the context</span><span>
</span><span id="line-867"></span><span class="hs-comment">-- Eagerly instantiate any trailing invisible binders</span><span>
</span><span id="line-868"></span><span id="tcInferLHsTypeKind"><span class="annot"><span class="annottext">tcInferLHsTypeKind :: LHsType GhcRn -&gt; TcM (Type, Type)
</span><a href="GHC.Tc.Gen.HsType.html#tcInferLHsTypeKind"><span class="hs-identifier hs-var hs-var">tcInferLHsTypeKind</span></a></span></span><span> </span><span id="local-6989586621683076704"><span class="annot"><span class="annottext">lhs_ty :: LHsType GhcRn
</span><a href="#local-6989586621683076704"><span class="hs-identifier hs-var">lhs_ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683076705"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683076705"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683076706"><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683076706"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-869"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; TcM (Type, Type) -&gt; TcM (Type, Type)
forall a. LHsType GhcRn -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.HsType.html#addTypeCtxt"><span class="hs-identifier hs-var">addTypeCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076704"><span class="hs-identifier hs-var">lhs_ty</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (Type, Type) -&gt; TcM (Type, Type))
-&gt; TcM (Type, Type) -&gt; TcM (Type, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-870"></span><span>    </span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; TcM (Type, Type) -&gt; TcM (Type, Type)
forall ann a. EpAnn ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683076705"><span class="hs-identifier hs-var">loc</span></a></span><span>    </span><span class="annot"><span class="annottext">(TcM (Type, Type) -&gt; TcM (Type, Type))
-&gt; TcM (Type, Type) -&gt; TcM (Type, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>  </span><span class="hs-comment">-- Cover the tcInstInvisibleTyBinders</span><span>
</span><span id="line-871"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683076707"><span class="annot"><a href="#local-6989586621683076707"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683076708"><span class="annot"><a href="#local-6989586621683076708"><span class="hs-identifier hs-var">res_kind</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcTyMode -&gt; HsType GhcRn -&gt; TcM (Type, Type)
</span><a href="GHC.Tc.Gen.HsType.html#tc_infer_hs_type"><span class="hs-identifier hs-var">tc_infer_hs_type</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="GHC.Tc.Gen.HsType.html#typeLevelMode"><span class="hs-identifier hs-var">typeLevelMode</span></a></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683076706"><span class="hs-identifier hs-var">hs_ty</span></a></span><span>
</span><span id="line-872"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcInstInvisibleTyBinders"><span class="hs-identifier hs-type">tcInstInvisibleTyBinders</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076707"><span class="hs-identifier hs-type">res_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076708"><span class="hs-identifier hs-type">res_kind</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-873"></span><span>  </span><span class="hs-comment">-- See Note [Do not always instantiate eagerly in types]</span><span>
</span><span id="line-874"></span><span>
</span><span id="line-875"></span><span class="hs-comment">-- Used to check the argument of GHCi :kind</span><span>
</span><span id="line-876"></span><span class="hs-comment">-- Allow and report wildcards, e.g. :kind T _</span><span>
</span><span id="line-877"></span><span class="hs-comment">-- Do not saturate family applications: see Note [Dealing with :kind]</span><span>
</span><span id="line-878"></span><span class="hs-comment">-- Does not instantiate eagerly; See Note [Do not always instantiate eagerly in types]</span><span>
</span><span id="line-879"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcInferLHsTypeUnsaturated"><span class="hs-identifier hs-type">tcInferLHsTypeUnsaturated</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-880"></span><span id="tcInferLHsTypeUnsaturated"><span class="annot"><span class="annottext">tcInferLHsTypeUnsaturated :: LHsType GhcRn -&gt; TcM (Type, Type)
</span><a href="GHC.Tc.Gen.HsType.html#tcInferLHsTypeUnsaturated"><span class="hs-identifier hs-var hs-var">tcInferLHsTypeUnsaturated</span></a></span></span><span> </span><span id="local-6989586621683076711"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076711"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span>
</span><span id="line-881"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; TcM (Type, Type) -&gt; TcM (Type, Type)
forall a. LHsType GhcRn -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.HsType.html#addTypeCtxt"><span class="hs-identifier hs-var">addTypeCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076711"><span class="hs-identifier hs-var">hs_ty</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (Type, Type) -&gt; TcM (Type, Type))
-&gt; TcM (Type, Type) -&gt; TcM (Type, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-882"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683076712"><span class="annot"><a href="#local-6989586621683076712"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeOrKind -&gt; HoleMode -&gt; TcM TcTyMode
</span><a href="GHC.Tc.Gen.HsType.html#mkHoleMode"><span class="hs-identifier hs-var">mkHoleMode</span></a></span><span> </span><span class="annot"><span class="annottext">TypeOrKind
</span><a href="GHC.Types.Basic.html#TypeLevel"><span class="hs-identifier hs-var">TypeLevel</span></a></span><span> </span><span class="annot"><span class="annottext">HoleMode
</span><a href="GHC.Tc.Gen.HsType.html#HM_Sig"><span class="hs-identifier hs-var">HM_Sig</span></a></span><span>  </span><span class="hs-comment">-- Allow and report holes</span><span>
</span><span id="line-883"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#splitHsAppTys_maybe"><span class="hs-identifier hs-type">splitHsAppTys_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-type">unLoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076711"><span class="hs-identifier hs-type">hs_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-884"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683076716"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076716"><span class="hs-identifier hs-var">hs_fun_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683076717"><span class="annot"><span class="annottext">HsFamEqnPats GhcRn
</span><a href="#local-6989586621683076717"><span class="hs-identifier hs-var">hs_args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-885"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683076718"><span class="annot"><a href="#local-6989586621683076718"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683076719"><span class="annot"><a href="#local-6989586621683076719"><span class="hs-identifier hs-var">_ki</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcTyMode -&gt; LHsType GhcRn -&gt; TcM (Type, Type)
</span><a href="GHC.Tc.Gen.HsType.html#tcInferTyAppHead"><span class="hs-identifier hs-var">tcInferTyAppHead</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076712"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076716"><span class="hs-identifier hs-var">hs_fun_ty</span></a></span><span>
</span><span id="line-886"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcInferTyApps_nosat"><span class="hs-identifier hs-type">tcInferTyApps_nosat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076712"><span class="hs-identifier hs-type">mode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076716"><span class="hs-identifier hs-type">hs_fun_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076718"><span class="hs-identifier hs-type">fun_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076717"><span class="hs-identifier hs-type">hs_args</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-887"></span><span>                      </span><span class="hs-comment">-- Notice the 'nosat'; do not instantiate trailing</span><span>
</span><span id="line-888"></span><span>                      </span><span class="hs-comment">-- invisible arguments of a type family.</span><span>
</span><span id="line-889"></span><span>                      </span><span class="hs-comment">-- See Note [Dealing with :kind]</span><span>
</span><span id="line-890"></span><span>           </span><span class="annot"><span class="annottext">Maybe (LHsType GhcRn, HsFamEqnPats GhcRn)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcTyMode -&gt; LHsType GhcRn -&gt; TcM (Type, Type)
</span><a href="GHC.Tc.Gen.HsType.html#tc_infer_lhs_type"><span class="hs-identifier hs-var">tc_infer_lhs_type</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076712"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076711"><span class="hs-identifier hs-var">hs_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-891"></span><span>
</span><span id="line-892"></span><span class="hs-comment">{- Note [Dealing with :kind]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider this GHCi command
  ghci&gt; type family F :: Either j k
  ghci&gt; :kind F
  F :: forall {j,k}. Either j k

We will only get the 'forall' if we /refrain/ from saturating those
invisible binders. But generally we /do/ saturate those invisible
binders (see tcInferTyApps), and we want to do so for nested application
even in GHCi.  Consider for example (#16287)
  ghci&gt; type family F :: k
  ghci&gt; data T :: (forall k. k) -&gt; Type
  ghci&gt; :kind T F
We want to reject this. It's just at the very top level that we want
to switch off saturation.

So tcInferLHsTypeUnsaturated does a little special case for top level
applications.  Actually the common case is a bare variable, as above.

Note [Do not always instantiate eagerly in types]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Terms are eagerly instantiated. This means that if you say

  x = id

then `id` gets instantiated to have type alpha -&gt; alpha. The variable
alpha is then unconstrained and regeneralized. So we may well end up with
  x = /\x. id @a
But we cannot do this in types, as we have no type-level lambda.

So, we must be careful only to instantiate at the last possible moment, when
we're sure we're never going to want the lost polymorphism again. This is done
in calls to `tcInstInvisibleTyBinders`; a particular case in point is in
`checkExpectedKind`.

Otherwise, we are careful /not/ to instantiate.  For example:
* at a variable  in `tcTyVar`
* in `tcInferLHsTypeUnsaturated`, which is used by :kind in GHCi.

************************************************************************
*                                                                      *
      Type-checking modes
*                                                                      *
************************************************************************

The kind-checker is parameterised by a TcTyMode, which contains some
information about where we're checking a type.

The renamer issues errors about what it can. All errors issued here must
concern things that the renamer can't handle.

-}</span><span>
</span><span id="line-945"></span><span>
</span><span id="line-946"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcMult"><span class="hs-identifier hs-type">tcMult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsArrow"><span class="hs-identifier hs-type">HsArrow</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span>
</span><span id="line-947"></span><span id="tcMult"><span class="annot"><span class="annottext">tcMult :: HsArrow GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcMult"><span class="hs-identifier hs-var hs-var">tcMult</span></a></span></span><span> </span><span id="local-6989586621683076724"><span class="annot"><span class="annottext">HsArrow GhcRn
</span><a href="#local-6989586621683076724"><span class="hs-identifier hs-var">hc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyMode -&gt; HsArrow GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_mult"><span class="hs-identifier hs-var">tc_mult</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="GHC.Tc.Gen.HsType.html#typeLevelMode"><span class="hs-identifier hs-var">typeLevelMode</span></a></span><span> </span><span class="annot"><span class="annottext">HsArrow GhcRn
</span><a href="#local-6989586621683076724"><span class="hs-identifier hs-var">hc</span></a></span><span>
</span><span id="line-948"></span><span>
</span><span id="line-949"></span><span class="hs-comment">-- | Info about the context in which we're checking a type. Currently,</span><span>
</span><span id="line-950"></span><span class="hs-comment">-- differentiates only between types and kinds, but this will likely</span><span>
</span><span id="line-951"></span><span class="hs-comment">-- grow, at least to include the distinction between patterns and</span><span>
</span><span id="line-952"></span><span class="hs-comment">-- not-patterns.</span><span>
</span><span id="line-953"></span><span class="hs-comment">--</span><span>
</span><span id="line-954"></span><span class="hs-comment">-- To find out where the mode is used, search for 'mode_tyki'</span><span>
</span><span id="line-955"></span><span class="hs-comment">--</span><span>
</span><span id="line-956"></span><span class="hs-comment">-- This data type is purely local, not exported from this module</span><span>
</span><span id="line-957"></span><span class="hs-keyword">data</span><span> </span><span id="TcTyMode"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#TcTyMode"><span class="hs-identifier hs-var">TcTyMode</span></a></span></span><span>
</span><span id="line-958"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="TcTyMode"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#TcTyMode"><span class="hs-identifier hs-var">TcTyMode</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="mode_tyki"><span class="annot"><span class="annottext">TcTyMode -&gt; TypeOrKind
</span><a href="GHC.Tc.Gen.HsType.html#mode_tyki"><span class="hs-identifier hs-var hs-var">mode_tyki</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TypeOrKind"><span class="hs-identifier hs-type">TypeOrKind</span></a></span><span>
</span><span id="line-959"></span><span>             </span><span class="hs-special">,</span><span> </span><span id="mode_holes"><span class="annot"><span class="annottext">TcTyMode -&gt; HoleInfo
</span><a href="GHC.Tc.Gen.HsType.html#mode_holes"><span class="hs-identifier hs-var hs-var">mode_holes</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#HoleInfo"><span class="hs-identifier hs-type">HoleInfo</span></a></span><span>   </span><span class="hs-special">}</span><span>
</span><span id="line-960"></span><span>
</span><span id="line-961"></span><span class="hs-comment">-- See Note [Levels for wildcards]</span><span>
</span><span id="line-962"></span><span class="hs-comment">-- Nothing &lt;=&gt; no wildcards expected</span><span>
</span><span id="line-963"></span><span class="hs-keyword">type</span><span> </span><span id="HoleInfo"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#HoleInfo"><span class="hs-identifier hs-var">HoleInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#HoleMode"><span class="hs-identifier hs-type">HoleMode</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-964"></span><span>
</span><span id="line-965"></span><span class="hs-comment">-- HoleMode says how to treat the occurrences</span><span>
</span><span id="line-966"></span><span class="hs-comment">-- of anonymous wildcards; see tcAnonWildCardOcc</span><span>
</span><span id="line-967"></span><span class="hs-keyword">data</span><span> </span><span id="HoleMode"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#HoleMode"><span class="hs-identifier hs-var">HoleMode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="HM_Sig"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#HM_Sig"><span class="hs-identifier hs-var">HM_Sig</span></a></span></span><span>      </span><span class="hs-comment">-- Partial type signatures: f :: _ -&gt; Int</span><span>
</span><span id="line-968"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span id="HM_FamPat"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#HM_FamPat"><span class="hs-identifier hs-var">HM_FamPat</span></a></span></span><span>   </span><span class="hs-comment">-- Family instances: F _ Int = Bool</span><span>
</span><span id="line-969"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span id="HM_VTA"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#HM_VTA"><span class="hs-identifier hs-var">HM_VTA</span></a></span></span><span>      </span><span class="hs-comment">-- Visible type and kind application:</span><span>
</span><span id="line-970"></span><span>                            </span><span class="hs-comment">--   f @(Maybe _)</span><span>
</span><span id="line-971"></span><span>                            </span><span class="hs-comment">--   Maybe @(_ -&gt; _)</span><span>
</span><span id="line-972"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span id="HM_TyAppPat"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#HM_TyAppPat"><span class="hs-identifier hs-var">HM_TyAppPat</span></a></span></span><span> </span><span class="hs-comment">-- Visible type applications in patterns:</span><span>
</span><span id="line-973"></span><span>                            </span><span class="hs-comment">--   foo (Con @_ @t x) = ...</span><span>
</span><span id="line-974"></span><span>                            </span><span class="hs-comment">--   case x of Con @_ @t v -&gt; ...</span><span>
</span><span id="line-975"></span><span>
</span><span id="line-976"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#mkMode"><span class="hs-identifier hs-type">mkMode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TypeOrKind"><span class="hs-identifier hs-type">TypeOrKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a></span><span>
</span><span id="line-977"></span><span id="mkMode"><span class="annot"><span class="annottext">mkMode :: TypeOrKind -&gt; TcTyMode
</span><a href="GHC.Tc.Gen.HsType.html#mkMode"><span class="hs-identifier hs-var hs-var">mkMode</span></a></span></span><span> </span><span id="local-6989586621683076730"><span class="annot"><span class="annottext">TypeOrKind
</span><a href="#local-6989586621683076730"><span class="hs-identifier hs-var">tyki</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mode_tyki :: TypeOrKind
</span><a href="GHC.Tc.Gen.HsType.html#mode_tyki"><span class="hs-identifier hs-var">mode_tyki</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeOrKind
</span><a href="#local-6989586621683076730"><span class="hs-identifier hs-var">tyki</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mode_holes :: HoleInfo
</span><a href="GHC.Tc.Gen.HsType.html#mode_holes"><span class="hs-identifier hs-var">mode_holes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HoleInfo
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-978"></span><span>
</span><span id="line-979"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#typeLevelMode"><span class="hs-identifier hs-type">typeLevelMode</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#kindLevelMode"><span class="hs-identifier hs-type">kindLevelMode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a></span><span>
</span><span id="line-980"></span><span class="hs-comment">-- These modes expect no wildcards (holes) in the type</span><span>
</span><span id="line-981"></span><span id="kindLevelMode"><span class="annot"><span class="annottext">kindLevelMode :: TcTyMode
</span><a href="GHC.Tc.Gen.HsType.html#kindLevelMode"><span class="hs-identifier hs-var hs-var">kindLevelMode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeOrKind -&gt; TcTyMode
</span><a href="GHC.Tc.Gen.HsType.html#mkMode"><span class="hs-identifier hs-var">mkMode</span></a></span><span> </span><span class="annot"><span class="annottext">TypeOrKind
</span><a href="GHC.Types.Basic.html#KindLevel"><span class="hs-identifier hs-var">KindLevel</span></a></span><span>
</span><span id="line-982"></span><span id="typeLevelMode"><span class="annot"><span class="annottext">typeLevelMode :: TcTyMode
</span><a href="GHC.Tc.Gen.HsType.html#typeLevelMode"><span class="hs-identifier hs-var hs-var">typeLevelMode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeOrKind -&gt; TcTyMode
</span><a href="GHC.Tc.Gen.HsType.html#mkMode"><span class="hs-identifier hs-var">mkMode</span></a></span><span> </span><span class="annot"><span class="annottext">TypeOrKind
</span><a href="GHC.Types.Basic.html#TypeLevel"><span class="hs-identifier hs-var">TypeLevel</span></a></span><span>
</span><span id="line-983"></span><span>
</span><span id="line-984"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#mkHoleMode"><span class="hs-identifier hs-type">mkHoleMode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TypeOrKind"><span class="hs-identifier hs-type">TypeOrKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#HoleMode"><span class="hs-identifier hs-type">HoleMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a></span><span>
</span><span id="line-985"></span><span id="mkHoleMode"><span class="annot"><span class="annottext">mkHoleMode :: TypeOrKind -&gt; HoleMode -&gt; TcM TcTyMode
</span><a href="GHC.Tc.Gen.HsType.html#mkHoleMode"><span class="hs-identifier hs-var hs-var">mkHoleMode</span></a></span></span><span> </span><span id="local-6989586621683076732"><span class="annot"><span class="annottext">TypeOrKind
</span><a href="#local-6989586621683076732"><span class="hs-identifier hs-var">tyki</span></a></span></span><span> </span><span id="local-6989586621683076733"><span class="annot"><span class="annottext">HoleMode
</span><a href="#local-6989586621683076733"><span class="hs-identifier hs-var">hm</span></a></span></span><span>
</span><span id="line-986"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683076734"><span class="annot"><a href="#local-6989586621683076734"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TcLevel
</span><a href="GHC.Tc.Utils.Monad.html#getTcLevel"><span class="hs-identifier hs-var">getTcLevel</span></a></span><span>
</span><span id="line-987"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#mode_tyki"><span class="hs-identifier hs-var">mode_tyki</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683076732"><span class="hs-identifier hs-type">tyki</span></a></span><span>
</span><span id="line-988"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#mode_holes"><span class="hs-identifier hs-var">mode_holes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683076734"><span class="hs-identifier hs-type">lvl</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621683076733"><span class="hs-identifier hs-type">hm</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-989"></span><span>
</span><span id="line-990"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#HoleMode"><span class="hs-identifier hs-type">HoleMode</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-991"></span><span>  </span><span id="local-6989586621683076743"><span class="annot"><span class="annottext">ppr :: HoleMode -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="annot"><span class="annottext">HoleMode
</span><a href="GHC.Tc.Gen.HsType.html#HM_Sig"><span class="hs-identifier hs-var">HM_Sig</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;HM_Sig&quot;</span></span><span>
</span><span id="line-992"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HoleMode
</span><a href="GHC.Tc.Gen.HsType.html#HM_FamPat"><span class="hs-identifier hs-var">HM_FamPat</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;HM_FamPat&quot;</span></span><span>
</span><span id="line-993"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HoleMode
</span><a href="GHC.Tc.Gen.HsType.html#HM_VTA"><span class="hs-identifier hs-var">HM_VTA</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;HM_VTA&quot;</span></span><span>
</span><span id="line-994"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HoleMode
</span><a href="GHC.Tc.Gen.HsType.html#HM_TyAppPat"><span class="hs-identifier hs-var">HM_TyAppPat</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;HM_TyAppPat&quot;</span></span><span>
</span><span id="line-995"></span><span>
</span><span id="line-996"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-997"></span><span>  </span><span id="local-6989586621683076758"><span class="annot"><span class="annottext">ppr :: TcTyMode -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mode_tyki :: TcTyMode -&gt; TypeOrKind
</span><a href="GHC.Tc.Gen.HsType.html#mode_tyki"><span class="hs-identifier hs-var">mode_tyki</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683076759"><span class="annot"><span class="annottext">TypeOrKind
</span><a href="#local-6989586621683076759"><span class="hs-identifier hs-var">tyki</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mode_holes :: TcTyMode -&gt; HoleInfo
</span><a href="GHC.Tc.Gen.HsType.html#mode_holes"><span class="hs-identifier hs-var">mode_holes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683076760"><span class="annot"><span class="annottext">HoleInfo
</span><a href="#local-6989586621683076760"><span class="hs-identifier hs-var">hm</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-998"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TcTyMode&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#braces"><span class="hs-identifier hs-var">braces</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TypeOrKind -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TypeOrKind
</span><a href="#local-6989586621683076759"><span class="hs-identifier hs-var">tyki</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span>
</span><span id="line-999"></span><span>                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HoleInfo -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HoleInfo
</span><a href="#local-6989586621683076760"><span class="hs-identifier hs-var">hm</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1000"></span><span>
</span><span id="line-1001"></span><span class="hs-comment">{-
Note [Bidirectional type checking]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In types, as in terms, we use bidirectional type infefence.  The main workhorse
function looks like this:

    type ExpKind = ExpType
    data ExpType = Check TcSigmaKind | Infer ...(hole TcRhoType)...

    tcHsType :: TcTyMode -&gt; HsType GhcRn -&gt; ExpKind -&gt; TcM TcType

* When the `ExpKind` argument is (Check ki), we /check/ that the type has
  kind `ki`
* When the `ExpKind` argument is (Infer hole), we /infer/ the kind of the
  type, and fill the hole with that kind
-}</span><span>
</span><span id="line-1017"></span><span>
</span><span id="line-1018"></span><span class="hs-comment">------------------------------------------</span><span>
</span><span id="line-1019"></span><span class="hs-comment">-- | Check and desugar a type, returning the core type and its</span><span>
</span><span id="line-1020"></span><span class="hs-comment">-- possibly-polymorphic kind. Much like 'tcInferRho' at the expression</span><span>
</span><span id="line-1021"></span><span class="hs-comment">-- level.</span><span>
</span><span id="line-1022"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tc_infer_lhs_type"><span class="hs-identifier hs-type">tc_infer_lhs_type</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1023"></span><span id="tc_infer_lhs_type"><span class="annot"><span class="annottext">tc_infer_lhs_type :: TcTyMode -&gt; LHsType GhcRn -&gt; TcM (Type, Type)
</span><a href="GHC.Tc.Gen.HsType.html#tc_infer_lhs_type"><span class="hs-identifier hs-var hs-var">tc_infer_lhs_type</span></a></span></span><span> </span><span id="local-6989586621683076764"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076764"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683076765"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683076765"><span class="hs-identifier hs-var">span</span></a></span></span><span> </span><span id="local-6989586621683076766"><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683076766"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1024"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; TcM (Type, Type) -&gt; TcM (Type, Type)
forall ann a. EpAnn ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683076765"><span class="hs-identifier hs-var">span</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (Type, Type) -&gt; TcM (Type, Type))
-&gt; TcM (Type, Type) -&gt; TcM (Type, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1025"></span><span>    </span><span class="annot"><span class="annottext">TcTyMode -&gt; HsType GhcRn -&gt; TcM (Type, Type)
</span><a href="GHC.Tc.Gen.HsType.html#tc_infer_hs_type"><span class="hs-identifier hs-var">tc_infer_hs_type</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076764"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683076766"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1026"></span><span>
</span><span id="line-1027"></span><span class="hs-comment">---------------------------</span><span>
</span><span id="line-1028"></span><span class="hs-comment">-- | Infer the kind of a type and desugar. This is the &quot;up&quot; type-checker,</span><span>
</span><span id="line-1029"></span><span class="hs-comment">-- as described in Note [Bidirectional type checking]</span><span>
</span><span id="line-1030"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tc_infer_hs_type"><span class="hs-identifier hs-type">tc_infer_hs_type</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsType"><span class="hs-identifier hs-type">HsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1031"></span><span>
</span><span id="line-1032"></span><span id="tc_infer_hs_type"><span class="annot"><span class="annottext">tc_infer_hs_type :: TcTyMode -&gt; HsType GhcRn -&gt; TcM (Type, Type)
</span><a href="GHC.Tc.Gen.HsType.html#tc_infer_hs_type"><span class="hs-identifier hs-var hs-var">tc_infer_hs_type</span></a></span></span><span> </span><span id="local-6989586621683076767"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076767"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621683076768"><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683076768"><span class="hs-identifier hs-var">rn_ty</span></a></span></span><span>
</span><span id="line-1033"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ExpSigmaType -&gt; TcM Type) -&gt; TcM (Type, Type)
forall a. (ExpSigmaType -&gt; TcM a) -&gt; TcM (a, Type)
</span><a href="GHC.Tc.Utils.TcMType.html#tcInfer"><span class="hs-identifier hs-var">tcInfer</span></a></span><span> </span><span class="annot"><span class="annottext">((ExpSigmaType -&gt; TcM Type) -&gt; TcM (Type, Type))
-&gt; (ExpSigmaType -&gt; TcM Type) -&gt; TcM (Type, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683076770"><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076770"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcTyMode -&gt; HsType GhcRn -&gt; ExpSigmaType -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcHsType"><span class="hs-identifier hs-var">tcHsType</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076767"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683076768"><span class="hs-identifier hs-var">rn_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076770"><span class="hs-identifier hs-var">exp_kind</span></a></span><span>
</span><span id="line-1034"></span><span>
</span><span id="line-1035"></span><span class="hs-comment">{-
Note [Typechecking HsCoreTys]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
HsCoreTy is an escape hatch that allows embedding Core Types in HsTypes.
As such, there's not much to be done in order to typecheck an HsCoreTy,
since it's already been typechecked to some extent. There is one thing that
we must do, however: we must substitute the type variables from the tcl_env.
To see why, consider GeneralizedNewtypeDeriving, which is one of the main
clients of HsCoreTy (example adapted from #14579):

  newtype T a = MkT a deriving newtype Eq

This will produce an InstInfo GhcPs that looks roughly like this:

  instance forall a_1. Eq a_1 =&gt; Eq (T a_1) where
    (==) = coerce @(  a_1 -&gt;   a_1 -&gt; Bool) -- The type within @(...) is an HsCoreTy
                  @(T a_1 -&gt; T a_1 -&gt; Bool) -- So is this
                  (==)

This is then fed into the renamer. Since all of the type variables in this
InstInfo use Exact RdrNames, the resulting InstInfo GhcRn looks basically
identical. Things get more interesting when the InstInfo is fed into the
typechecker, however. GHC will first generate fresh skolems to instantiate
the instance-bound type variables with. In the example above, we might generate
the skolem a_2 and use that to instantiate a_1, which extends the local type
environment (tcl_env) with [a_1 :-&gt; a_2]. This gives us:

  instance forall a_2. Eq a_2 =&gt; Eq (T a_2) where ...

To ensure that the body of this instance is well scoped, every occurrence of
the `a` type variable should refer to a_2, the new skolem. However, the
HsCoreTys mention a_1, not a_2. Luckily, the tcl_env provides exactly the
substitution we need ([a_1 :-&gt; a_2]) to fix up the scoping. We apply this
substitution to each HsCoreTy and all is well:

  instance forall a_2. Eq a_2 =&gt; Eq (T a_2) where
    (==) = coerce @(  a_2 -&gt;   a_2 -&gt; Bool)
                  @(T a_2 -&gt; T a_2 -&gt; Bool)
                  (==)
-}</span><span>
</span><span id="line-1075"></span><span>
</span><span id="line-1076"></span><span class="hs-comment">------------------------------------------</span><span>
</span><span id="line-1077"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcCheckLHsType"><span class="hs-identifier hs-type">tcCheckLHsType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-1078"></span><span id="tcCheckLHsType"><span class="annot"><span class="annottext">tcCheckLHsType :: LHsType GhcRn -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcCheckLHsType"><span class="hs-identifier hs-var hs-var">tcCheckLHsType</span></a></span></span><span> </span><span id="local-6989586621683076772"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076772"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span> </span><span id="local-6989586621683076773"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683076773"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span>
</span><span id="line-1079"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyMode -&gt; LHsType GhcRn -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_check_lhs_type"><span class="hs-identifier hs-var">tc_check_lhs_type</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="GHC.Tc.Gen.HsType.html#typeLevelMode"><span class="hs-identifier hs-var">typeLevelMode</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076772"><span class="hs-identifier hs-var">hs_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683076773"><span class="hs-identifier hs-var">exp_kind</span></a></span><span>
</span><span id="line-1080"></span><span>
</span><span id="line-1081"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tc_check_lhs_type"><span class="hs-identifier hs-type">tc_check_lhs_type</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-1082"></span><span id="tc_check_lhs_type"><span class="annot"><span class="annottext">tc_check_lhs_type :: TcTyMode -&gt; LHsType GhcRn -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_check_lhs_type"><span class="hs-identifier hs-var hs-var">tc_check_lhs_type</span></a></span></span><span> </span><span id="local-6989586621683076774"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076774"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683076775"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683076775"><span class="hs-identifier hs-var">span</span></a></span></span><span> </span><span id="local-6989586621683076776"><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683076776"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683076777"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683076777"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span>
</span><span id="line-1083"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; TcM Type -&gt; TcM Type
forall ann a. EpAnn ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683076775"><span class="hs-identifier hs-var">span</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM Type -&gt; TcM Type) -&gt; TcM Type -&gt; TcM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1084"></span><span>    </span><span class="annot"><span class="annottext">TcTyMode -&gt; HsType GhcRn -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_check_hs_type"><span class="hs-identifier hs-var">tc_check_hs_type</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076774"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683076776"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683076777"><span class="hs-identifier hs-var">exp_kind</span></a></span><span>
</span><span id="line-1085"></span><span>
</span><span id="line-1086"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tc_check_hs_type"><span class="hs-identifier hs-type">tc_check_hs_type</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsType"><span class="hs-identifier hs-type">HsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-1087"></span><span class="hs-comment">-- See Note [Bidirectional type checking]</span><span>
</span><span id="line-1088"></span><span id="tc_check_hs_type"><span class="annot"><span class="annottext">tc_check_hs_type :: TcTyMode -&gt; HsType GhcRn -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_check_hs_type"><span class="hs-identifier hs-var hs-var">tc_check_hs_type</span></a></span></span><span> </span><span id="local-6989586621683076779"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076779"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621683076780"><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683076780"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683076781"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683076781"><span class="hs-identifier hs-var">ek</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyMode -&gt; HsType GhcRn -&gt; ExpSigmaType -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcHsType"><span class="hs-identifier hs-var">tcHsType</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076779"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683076780"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; ExpSigmaType
</span><a href="GHC.Tc.Utils.TcType.html#Check"><span class="hs-identifier hs-var">Check</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683076781"><span class="hs-identifier hs-var">ek</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1089"></span><span>
</span><span id="line-1090"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcLHsType"><span class="hs-identifier hs-type">tcLHsType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpKind"><span class="hs-identifier hs-type">ExpKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-1091"></span><span id="tcLHsType"><span class="annot"><span class="annottext">tcLHsType :: TcTyMode -&gt; LHsType GhcRn -&gt; ExpSigmaType -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcLHsType"><span class="hs-identifier hs-var hs-var">tcLHsType</span></a></span></span><span> </span><span id="local-6989586621683076785"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076785"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683076786"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683076786"><span class="hs-identifier hs-var">span</span></a></span></span><span> </span><span id="local-6989586621683076787"><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683076787"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683076788"><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076788"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span>
</span><span id="line-1092"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; TcM Type -&gt; TcM Type
forall ann a. EpAnn ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683076786"><span class="hs-identifier hs-var">span</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM Type -&gt; TcM Type) -&gt; TcM Type -&gt; TcM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1093"></span><span>    </span><span class="annot"><span class="annottext">TcTyMode -&gt; HsType GhcRn -&gt; ExpSigmaType -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcHsType"><span class="hs-identifier hs-var">tcHsType</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076785"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683076787"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076788"><span class="hs-identifier hs-var">exp_kind</span></a></span><span>
</span><span id="line-1094"></span><span>
</span><span id="line-1095"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsType"><span class="hs-identifier hs-type">tcHsType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsType"><span class="hs-identifier hs-type">HsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpKind"><span class="hs-identifier hs-type">ExpKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-1096"></span><span class="hs-comment">-- The main workhorse for type kind checking</span><span>
</span><span id="line-1097"></span><span class="hs-comment">-- See Note [Bidirectional type checking]</span><span>
</span><span id="line-1098"></span><span>
</span><span id="line-1099"></span><span id="tcHsType"><span class="annot"><span class="annottext">tcHsType :: TcTyMode -&gt; HsType GhcRn -&gt; ExpSigmaType -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcHsType"><span class="hs-identifier hs-var hs-var">tcHsType</span></a></span></span><span> </span><span id="local-6989586621683076789"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076789"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsParTy"><span class="hs-identifier hs-type">HsParTy</span></a></span><span> </span><span class="annot"><span class="annottext">XParTy GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683076791"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076791"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>   </span><span id="local-6989586621683076792"><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076792"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyMode -&gt; LHsType GhcRn -&gt; ExpSigmaType -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcLHsType"><span class="hs-identifier hs-var">tcLHsType</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076789"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076791"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076792"><span class="hs-identifier hs-var">exp_kind</span></a></span><span>
</span><span id="line-1100"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsType"><span class="hs-identifier hs-var">tcHsType</span></a></span><span> </span><span id="local-6989586621683076793"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076793"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsDocTy"><span class="hs-identifier hs-type">HsDocTy</span></a></span><span> </span><span class="annot"><span class="annottext">XDocTy GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683076795"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076795"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">LHsDoc GhcRn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683076796"><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076796"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyMode -&gt; LHsType GhcRn -&gt; ExpSigmaType -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcLHsType"><span class="hs-identifier hs-var">tcLHsType</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076793"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076795"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076796"><span class="hs-identifier hs-var">exp_kind</span></a></span><span>
</span><span id="line-1101"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsType"><span class="hs-identifier hs-var">tcHsType</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683076797"><span class="annot"><span class="annottext">ty :: HsType GhcRn
</span><a href="#local-6989586621683076797"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsBangTy"><span class="hs-identifier hs-type">HsBangTy</span></a></span><span> </span><span class="annot"><span class="annottext">XBangTy GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683076799"><span class="annot"><span class="annottext">HsBang
</span><a href="#local-6989586621683076799"><span class="hs-identifier hs-var">bang</span></a></span></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1102"></span><span>    </span><span class="hs-comment">-- While top-level bangs at this point are eliminated (eg !(Maybe Int)),</span><span>
</span><span id="line-1103"></span><span>    </span><span class="hs-comment">-- other kinds of bangs are not (eg ((!Maybe) Int)). These kinds of</span><span>
</span><span id="line-1104"></span><span>    </span><span class="hs-comment">-- bangs are invalid, so fail. (#7210, #14761)</span><span>
</span><span id="line-1105"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM Type
forall a. TcRnMessage -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWith"><span class="hs-identifier hs-var">failWith</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; TcM Type) -&gt; TcRnMessage -&gt; TcM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn -&gt; HsBang -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnUnexpectedAnnotation"><span class="hs-identifier hs-var">TcRnUnexpectedAnnotation</span></a></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683076797"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">HsBang
</span><a href="#local-6989586621683076799"><span class="hs-identifier hs-var">bang</span></a></span><span>
</span><span id="line-1106"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsType"><span class="hs-identifier hs-var">tcHsType</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683076802"><span class="annot"><span class="annottext">ty :: HsType GhcRn
</span><a href="#local-6989586621683076802"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsRecTy"><span class="hs-identifier hs-type">HsRecTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span class="annot"><span class="annottext">ExpSigmaType
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1107"></span><span>      </span><span class="hs-comment">-- Record types (which only show up temporarily in constructor</span><span>
</span><span id="line-1108"></span><span>      </span><span class="hs-comment">-- signatures) should have been removed by now</span><span>
</span><span id="line-1109"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM Type
forall a. TcRnMessage -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; TcM Type) -&gt; TcRnMessage -&gt; TcM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Either (HsType GhcPs) (HsType GhcRn) -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnIllegalRecordSyntax"><span class="hs-identifier hs-var">TcRnIllegalRecordSyntax</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsType GhcRn -&gt; Either (HsType GhcPs) (HsType GhcRn)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683076802"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1110"></span><span>
</span><span id="line-1111"></span><span class="hs-comment">-- HsSpliced is an annotation produced by 'GHC.Rename.Splice.rnSpliceType'.</span><span>
</span><span id="line-1112"></span><span class="hs-comment">-- Here we get rid of it and add the finalizers to the global environment</span><span>
</span><span id="line-1113"></span><span class="hs-comment">-- while capturing the local environment.</span><span>
</span><span id="line-1114"></span><span class="hs-comment">--</span><span>
</span><span id="line-1115"></span><span class="hs-comment">-- See Note [Delaying modFinalizers in untyped splices].</span><span>
</span><span id="line-1116"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsType"><span class="hs-identifier hs-var">tcHsType</span></a></span><span> </span><span id="local-6989586621683076805"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076805"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsSpliceTy"><span class="hs-identifier hs-type">HsSpliceTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsUntypedSpliceTop"><span class="hs-identifier hs-type">HsUntypedSpliceTop</span></a></span><span> </span><span id="local-6989586621683076808"><span class="annot"><span class="annottext">ThModFinalizers
</span><a href="#local-6989586621683076808"><span class="hs-identifier hs-var">mod_finalizers</span></a></span></span><span> </span><span id="local-6989586621683076809"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621683076809"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsUntypedSplice GhcRn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-1117"></span><span>           </span><span id="local-6989586621683076810"><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076810"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span>
</span><span id="line-1118"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">ThModFinalizers -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addModFinalizersWithLclEnv"><span class="hs-identifier hs-var">addModFinalizersWithLclEnv</span></a></span><span> </span><span class="annot"><span class="annottext">ThModFinalizers
</span><a href="#local-6989586621683076808"><span class="hs-identifier hs-var">mod_finalizers</span></a></span><span>
</span><span id="line-1119"></span><span>       </span><span class="annot"><span class="annottext">TcTyMode -&gt; LHsType GhcRn -&gt; ExpSigmaType -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcLHsType"><span class="hs-identifier hs-var">tcLHsType</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076805"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621683076809"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076810"><span class="hs-identifier hs-var">exp_kind</span></a></span><span>
</span><span id="line-1120"></span><span>
</span><span id="line-1121"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsType"><span class="hs-identifier hs-var">tcHsType</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsSpliceTy"><span class="hs-identifier hs-type">HsSpliceTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsUntypedSpliceNested"><span class="hs-identifier hs-type">HsUntypedSpliceNested</span></a></span><span> </span><span id="local-6989586621683076813"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683076813"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683076814"><span class="annot"><span class="annottext">HsUntypedSplice GhcRn
</span><a href="#local-6989586621683076814"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM Type
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcHsType: invalid nested splice&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Maybe Name -&gt; HsUntypedSplice GhcRn -&gt; SDoc
forall (p :: Pass).
OutputableBndrId p =&gt;
Bool -&gt; Maybe Name -&gt; HsUntypedSplice (GhcPass p) -&gt; SDoc
</span><a href="GHC.Hs.Expr.html#pprUntypedSplice"><span class="hs-identifier hs-var">pprUntypedSplice</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Maybe Name
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683076813"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsUntypedSplice GhcRn
</span><a href="#local-6989586621683076814"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1122"></span><span>
</span><span id="line-1123"></span><span class="hs-comment">---------- Functions and applications</span><span>
</span><span id="line-1124"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsType"><span class="hs-identifier hs-var">tcHsType</span></a></span><span> </span><span id="local-6989586621683076817"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076817"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsFunTy"><span class="hs-identifier hs-type">HsFunTy</span></a></span><span> </span><span class="annot"><span class="annottext">XFunTy GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683076819"><span class="annot"><span class="annottext">HsArrow GhcRn
</span><a href="#local-6989586621683076819"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span id="local-6989586621683076820"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076820"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621683076821"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076821"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683076822"><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076822"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span>
</span><span id="line-1125"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyMode
-&gt; HsArrow GhcRn
-&gt; LHsType GhcRn
-&gt; LHsType GhcRn
-&gt; ExpSigmaType
-&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_fun_type"><span class="hs-identifier hs-var">tc_fun_type</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076817"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">HsArrow GhcRn
</span><a href="#local-6989586621683076819"><span class="hs-identifier hs-var">mult</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076820"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076821"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076822"><span class="hs-identifier hs-var">exp_kind</span></a></span><span>
</span><span id="line-1126"></span><span>
</span><span id="line-1127"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsType"><span class="hs-identifier hs-var">tcHsType</span></a></span><span> </span><span id="local-6989586621683076824"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076824"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOpTy"><span class="hs-identifier hs-type">HsOpTy</span></a></span><span> </span><span class="annot"><span class="annottext">XOpTy GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PromotionFlag
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683076826"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076826"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683076827"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683076827"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683076828"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076828"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683076829"><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076829"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span>
</span><span id="line-1128"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683076827"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#unrestrictedFunTyConKey"><span class="hs-identifier hs-var">unrestrictedFunTyConKey</span></a></span><span>
</span><span id="line-1129"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyMode
-&gt; HsArrow GhcRn
-&gt; LHsType GhcRn
-&gt; LHsType GhcRn
-&gt; ExpSigmaType
-&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_fun_type"><span class="hs-identifier hs-var">tc_fun_type</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076824"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XUnrestrictedArrow (GenLocated SrcSpanAnnA (HsType GhcRn)) GhcRn
-&gt; HsArrowOf (GenLocated SrcSpanAnnA (HsType GhcRn)) GhcRn
forall mult pass.
XUnrestrictedArrow mult pass -&gt; HsArrowOf mult pass
</span><a href="Language.Haskell.Syntax.Type.html#HsUnrestrictedArrow"><span class="hs-identifier hs-var">HsUnrestrictedArrow</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XUnrestrictedArrow (GenLocated SrcSpanAnnA (HsType GhcRn)) GhcRn
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076826"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076828"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076829"><span class="hs-identifier hs-var">exp_kind</span></a></span><span>
</span><span id="line-1130"></span><span>
</span><span id="line-1131"></span><span class="hs-comment">--------- Foralls</span><span>
</span><span id="line-1132"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsType"><span class="hs-identifier hs-var">tcHsType</span></a></span><span> </span><span id="local-6989586621683076833"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076833"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621683076834"><span class="annot"><span class="annottext">t :: HsType GhcRn
</span><a href="#local-6989586621683076834"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsForAllTy"><span class="hs-identifier hs-type">HsForAllTy</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hst_tele :: forall pass. HsType pass -&gt; HsForAllTelescope pass
</span><a href="Language.Haskell.Syntax.Type.html#hst_tele"><span class="hs-identifier hs-var">hst_tele</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683076837"><span class="annot"><span class="annottext">HsForAllTelescope GhcRn
</span><a href="#local-6989586621683076837"><span class="hs-identifier hs-var">tele</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hst_body :: forall pass. HsType pass -&gt; LHsType pass
</span><a href="Language.Haskell.Syntax.Type.html#hst_body"><span class="hs-identifier hs-var">hst_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683076839"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076839"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683076840"><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076840"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span>
</span><span id="line-1133"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsForAllInvis"><span class="hs-identifier hs-type">HsForAllInvis</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsForAllTelescope GhcRn
</span><a href="#local-6989586621683076837"><span class="hs-identifier hs-var">tele</span></a></span><span>
</span><span id="line-1134"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsForAllTelescope GhcRn
-&gt; GenLocated SrcSpanAnnA (HsType GhcRn)
-&gt; ExpSigmaType
-&gt; TcM Type
</span><a href="#local-6989586621683076842"><span class="hs-identifier hs-var">tc_hs_forall_ty</span></a></span><span> </span><span class="annot"><span class="annottext">HsForAllTelescope GhcRn
</span><a href="#local-6989586621683076837"><span class="hs-identifier hs-var">tele</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621683076839"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076840"><span class="hs-identifier hs-var">exp_kind</span></a></span><span>
</span><span id="line-1135"></span><span>                 </span><span class="hs-comment">-- For an invisible forall, we allow the body to have</span><span>
</span><span id="line-1136"></span><span>                 </span><span class="hs-comment">-- an arbitrary kind (hence exp_kind above).</span><span>
</span><span id="line-1137"></span><span>                 </span><span class="hs-comment">-- See Note [Body kind of a HsForAllTy]</span><span>
</span><span id="line-1138"></span><span>
</span><span id="line-1139"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsForAllVis"><span class="hs-identifier hs-type">HsForAllVis</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsForAllTelescope GhcRn
</span><a href="#local-6989586621683076837"><span class="hs-identifier hs-var">tele</span></a></span><span>
</span><span id="line-1140"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683076844"><span class="annot"><a href="#local-6989586621683076844"><span class="hs-identifier hs-var">ek</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM Type
</span><a href="GHC.Tc.Utils.TcMType.html#newOpenTypeKind"><span class="hs-identifier hs-var">newOpenTypeKind</span></a></span><span>
</span><span id="line-1141"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683076845"><span class="annot"><a href="#local-6989586621683076845"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683076842"><span class="hs-identifier hs-type">tc_hs_forall_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076837"><span class="hs-identifier hs-type">tele</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076839"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#Check"><span class="hs-identifier hs-type">Check</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076844"><span class="hs-identifier hs-type">ek</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1142"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#checkExpKind"><span class="hs-identifier hs-type">checkExpKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076834"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076845"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076844"><span class="hs-identifier hs-type">ek</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076840"><span class="hs-identifier hs-type">exp_kind</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1143"></span><span>                 </span><span class="hs-comment">-- For a visible forall, we require that the body is of kind TYPE r.</span><span>
</span><span id="line-1144"></span><span>                 </span><span class="hs-comment">-- See Note [Body kind of a HsForAllTy]</span><span>
</span><span id="line-1145"></span><span>
</span><span id="line-1146"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1147"></span><span>    </span><span id="local-6989586621683076842"><span class="annot"><span class="annottext">tc_hs_forall_ty :: HsForAllTelescope GhcRn
-&gt; GenLocated SrcSpanAnnA (HsType GhcRn)
-&gt; ExpSigmaType
-&gt; TcM Type
</span><a href="#local-6989586621683076842"><span class="hs-identifier hs-var hs-var">tc_hs_forall_ty</span></a></span></span><span> </span><span id="local-6989586621683076847"><span class="annot"><span class="annottext">HsForAllTelescope GhcRn
</span><a href="#local-6989586621683076847"><span class="hs-identifier hs-var">tele</span></a></span></span><span> </span><span id="local-6989586621683076848"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621683076848"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683076849"><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076849"><span class="hs-identifier hs-var">ek</span></a></span></span><span>
</span><span id="line-1148"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683076850"><span class="annot"><a href="#local-6989586621683076850"><span class="hs-identifier hs-var">tv_bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683076851"><span class="annot"><a href="#local-6989586621683076851"><span class="hs-identifier hs-var">ty'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcTyMode
-&gt; HsForAllTelescope GhcRn
-&gt; TcM Type
-&gt; TcM ([TcTyVarBinder], Type)
forall a.
TcTyMode
-&gt; HsForAllTelescope GhcRn -&gt; TcM a -&gt; TcM ([TcTyVarBinder], a)
</span><a href="GHC.Tc.Gen.HsType.html#tcTKTelescope"><span class="hs-identifier hs-var">tcTKTelescope</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076833"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">HsForAllTelescope GhcRn
</span><a href="#local-6989586621683076847"><span class="hs-identifier hs-var">tele</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM Type -&gt; TcM ([TcTyVarBinder], Type))
-&gt; TcM Type -&gt; TcM ([TcTyVarBinder], Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1149"></span><span>                                </span><span class="annot"><span class="annottext">TcTyMode -&gt; LHsType GhcRn -&gt; ExpSigmaType -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcLHsType"><span class="hs-identifier hs-var">tcLHsType</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076833"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621683076848"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076849"><span class="hs-identifier hs-var">ek</span></a></span><span>
</span><span id="line-1150"></span><span>                 </span><span class="hs-comment">-- Pass on the mode from the type, to any wildcards</span><span>
</span><span id="line-1151"></span><span>                 </span><span class="hs-comment">-- in kind signatures on the forall'd variables</span><span>
</span><span id="line-1152"></span><span>                 </span><span class="hs-comment">-- e.g.      f :: _ -&gt; Int -&gt; forall (a :: _). blah</span><span>
</span><span id="line-1153"></span><span>
</span><span id="line-1154"></span><span>             </span><span class="hs-comment">-- Do not kind-generalise here!  See Note [Kind generalisation]</span><span>
</span><span id="line-1155"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#mkForAllTys"><span class="hs-identifier hs-type">mkForAllTys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076850"><span class="hs-identifier hs-type">tv_bndrs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076851"><span class="hs-identifier hs-type">ty'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1156"></span><span>
</span><span id="line-1157"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsType"><span class="hs-identifier hs-var">tcHsType</span></a></span><span> </span><span id="local-6989586621683076854"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076854"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621683076855"><span class="annot"><span class="annottext">t :: HsType GhcRn
</span><a href="#local-6989586621683076855"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsQualTy"><span class="hs-identifier hs-type">HsQualTy</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hst_ctxt :: forall pass. HsType pass -&gt; LHsContext pass
</span><a href="Language.Haskell.Syntax.Type.html#hst_ctxt"><span class="hs-identifier hs-var">hst_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683076858"><span class="annot"><span class="annottext">LHsContext GhcRn
</span><a href="#local-6989586621683076858"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hst_body :: forall pass. HsType pass -&gt; LHsType pass
</span><a href="Language.Haskell.Syntax.Type.html#hst_body"><span class="hs-identifier hs-var">hst_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683076859"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076859"><span class="hs-identifier hs-var">rn_ty</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683076860"><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076860"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span>
</span><span id="line-1158"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsType GhcRn)] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnC [GenLocated SrcSpanAnnA (HsType GhcRn)]
-&gt; [GenLocated SrcSpanAnnA (HsType GhcRn)]
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsContext GhcRn
GenLocated SrcSpanAnnC [GenLocated SrcSpanAnnA (HsType GhcRn)]
</span><a href="#local-6989586621683076858"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1159"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyMode -&gt; LHsType GhcRn -&gt; ExpSigmaType -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcLHsType"><span class="hs-identifier hs-var">tcLHsType</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076854"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076859"><span class="hs-identifier hs-var">rn_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076860"><span class="hs-identifier hs-var">exp_kind</span></a></span><span>
</span><span id="line-1160"></span><span>    </span><span class="hs-comment">-- See Note [Body kind of a HsQualTy], point (BK1)</span><span>
</span><span id="line-1161"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#Check"><span class="hs-identifier hs-type">Check</span></a></span><span> </span><span id="local-6989586621683076862"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683076862"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076860"><span class="hs-identifier hs-var">exp_kind</span></a></span><span>     </span><span class="hs-comment">-- Checking mode</span><span>
</span><span id="line-1162"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isConstraintLikeKind"><span class="hs-identifier hs-var">isConstraintLikeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683076862"><span class="hs-identifier hs-var">kind</span></a></span><span>  </span><span class="hs-comment">-- CONSTRAINT rep</span><span>
</span><span id="line-1163"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683076864"><span class="annot"><a href="#local-6989586621683076864"><span class="hs-identifier hs-var">ctxt'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcTyMode -&gt; LHsContext GhcRn -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.HsType.html#tc_hs_context"><span class="hs-identifier hs-var">tc_hs_context</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076854"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">LHsContext GhcRn
</span><a href="#local-6989586621683076858"><span class="hs-identifier hs-var">ctxt</span></a></span><span>
</span><span id="line-1164"></span><span>         </span><span class="hs-comment">-- See Note [Body kind of a HsQualTy], point (BK2)</span><span>
</span><span id="line-1165"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683076866"><span class="annot"><a href="#local-6989586621683076866"><span class="hs-identifier hs-var">ty'</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tc_check_lhs_type"><span class="hs-identifier hs-type">tc_check_lhs_type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076854"><span class="hs-identifier hs-type">mode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076859"><span class="hs-identifier hs-type">rn_ty</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#constraintKind"><span class="hs-identifier hs-type">constraintKind</span></a></span><span>
</span><span id="line-1166"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683076868"><span class="annot"><a href="#local-6989586621683076868"><span class="hs-identifier hs-var hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Type -&gt; Type
HasDebugCallStack =&gt; [Type] -&gt; Type -&gt; Type
</span><a href="GHC.Tc.Utils.TcType.html#tcMkDFunPhiTy"><span class="hs-identifier hs-var">tcMkDFunPhiTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683076864"><span class="hs-identifier hs-var">ctxt'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683076866"><span class="hs-identifier hs-var">ty'</span></a></span><span>
</span><span id="line-1167"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#checkExpKind"><span class="hs-identifier hs-type">checkExpKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076855"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076868"><span class="hs-identifier hs-type">res_ty</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#constraintKind"><span class="hs-identifier hs-type">constraintKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076860"><span class="hs-identifier hs-type">exp_kind</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1168"></span><span>
</span><span id="line-1169"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1170"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683076870"><span class="annot"><a href="#local-6989586621683076870"><span class="hs-identifier hs-var">ctxt'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcTyMode -&gt; LHsContext GhcRn -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.HsType.html#tc_hs_context"><span class="hs-identifier hs-var">tc_hs_context</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076854"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">LHsContext GhcRn
</span><a href="#local-6989586621683076858"><span class="hs-identifier hs-var">ctxt</span></a></span><span>
</span><span id="line-1171"></span><span>
</span><span id="line-1172"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683076871"><span class="annot"><a href="#local-6989586621683076871"><span class="hs-identifier hs-var">ek</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newOpenTypeKind"><span class="hs-identifier hs-type">newOpenTypeKind</span></a></span><span>  </span><span class="hs-comment">-- The body kind (result of the function) can</span><span>
</span><span id="line-1173"></span><span>                                </span><span class="hs-comment">-- be TYPE r, for any r, hence newOpenTypeKind</span><span>
</span><span id="line-1174"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683076872"><span class="annot"><a href="#local-6989586621683076872"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tc_check_lhs_type"><span class="hs-identifier hs-type">tc_check_lhs_type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076854"><span class="hs-identifier hs-type">mode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076859"><span class="hs-identifier hs-type">rn_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076871"><span class="hs-identifier hs-type">ek</span></a></span><span>
</span><span id="line-1175"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683076873"><span class="annot"><a href="#local-6989586621683076873"><span class="hs-identifier hs-var hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Type -&gt; Type
HasDebugCallStack =&gt; [Type] -&gt; Type -&gt; Type
</span><a href="GHC.Tc.Utils.TcType.html#tcMkPhiTy"><span class="hs-identifier hs-var">tcMkPhiTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683076870"><span class="hs-identifier hs-var">ctxt'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683076872"><span class="hs-identifier hs-var">ty'</span></a></span><span>
</span><span id="line-1176"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#checkExpKind"><span class="hs-identifier hs-type">checkExpKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076855"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076873"><span class="hs-identifier hs-type">res_ty</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-type">liftedTypeKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076860"><span class="hs-identifier hs-type">exp_kind</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1177"></span><span>
</span><span id="line-1178"></span><span class="hs-comment">--------- Lists, arrays, and tuples</span><span>
</span><span id="line-1179"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsType"><span class="hs-identifier hs-var">tcHsType</span></a></span><span> </span><span id="local-6989586621683076875"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076875"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621683076876"><span class="annot"><span class="annottext">rn_ty :: HsType GhcRn
</span><a href="#local-6989586621683076876"><span class="hs-identifier hs-var">rn_ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsListTy"><span class="hs-identifier hs-type">HsListTy</span></a></span><span> </span><span class="annot"><span class="annottext">XListTy GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683076878"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076878"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683076879"><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076879"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span>
</span><span id="line-1180"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683076880"><span class="annot"><a href="#local-6989586621683076880"><span class="hs-identifier hs-var">tau_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcTyMode -&gt; LHsType GhcRn -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_check_lhs_type"><span class="hs-identifier hs-var">tc_check_lhs_type</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076875"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076878"><span class="hs-identifier hs-var">elt_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span>
</span><span id="line-1181"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Iface.Load.html#checkWiredInTyCon"><span class="hs-identifier hs-type">checkWiredInTyCon</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#listTyCon"><span class="hs-identifier hs-type">listTyCon</span></a></span><span>
</span><span id="line-1182"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#checkExpKind"><span class="hs-identifier hs-type">checkExpKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076876"><span class="hs-identifier hs-type">rn_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Builtin.Types.html#mkListTy"><span class="hs-identifier hs-type">mkListTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076880"><span class="hs-identifier hs-type">tau_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-type">liftedTypeKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076879"><span class="hs-identifier hs-type">exp_kind</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1183"></span><span>
</span><span id="line-1184"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsType"><span class="hs-identifier hs-var">tcHsType</span></a></span><span> </span><span id="local-6989586621683076884"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076884"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621683076885"><span class="annot"><span class="annottext">rn_ty :: HsType GhcRn
</span><a href="#local-6989586621683076885"><span class="hs-identifier hs-var">rn_ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTupleTy"><span class="hs-identifier hs-type">HsTupleTy</span></a></span><span> </span><span class="annot"><span class="annottext">XTupleTy GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683076887"><span class="annot"><span class="annottext">HsTupleSort
</span><a href="#local-6989586621683076887"><span class="hs-identifier hs-var">tup_sort</span></a></span></span><span> </span><span id="local-6989586621683076888"><span class="annot"><span class="annottext">[LHsType GhcRn]
</span><a href="#local-6989586621683076888"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683076889"><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076889"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span>
</span><span id="line-1185"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621683076890"><span class="annot"><a href="#local-6989586621683076890"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpSigmaType -&gt; TcM Type
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076889"><span class="hs-identifier hs-var">exp_kind</span></a></span><span>
</span><span id="line-1186"></span><span>       </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tc_hs_tuple_ty"><span class="hs-identifier hs-type">tc_hs_tuple_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076885"><span class="hs-identifier hs-type">rn_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076884"><span class="hs-identifier hs-type">mode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076887"><span class="hs-identifier hs-type">tup_sort</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076888"><span class="hs-identifier hs-type">tys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076890"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1187"></span><span>
</span><span id="line-1188"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsType"><span class="hs-identifier hs-var">tcHsType</span></a></span><span> </span><span id="local-6989586621683076893"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076893"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621683076894"><span class="annot"><span class="annottext">rn_ty :: HsType GhcRn
</span><a href="#local-6989586621683076894"><span class="hs-identifier hs-var">rn_ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsSumTy"><span class="hs-identifier hs-type">HsSumTy</span></a></span><span> </span><span class="annot"><span class="annottext">XSumTy GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683076896"><span class="annot"><span class="annottext">[LHsType GhcRn]
</span><a href="#local-6989586621683076896"><span class="hs-identifier hs-var">hs_tys</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683076897"><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076897"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span>
</span><span id="line-1189"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683076898"><span class="annot"><span class="annottext">arity :: Int
</span><a href="#local-6989586621683076898"><span class="hs-identifier hs-var hs-var hs-var">arity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsType GhcRn)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[LHsType GhcRn]
[GenLocated SrcSpanAnnA (HsType GhcRn)]
</span><a href="#local-6989586621683076896"><span class="hs-identifier hs-var">hs_tys</span></a></span><span>
</span><span id="line-1190"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683076900"><span class="annot"><a href="#local-6989586621683076900"><span class="hs-identifier hs-var">arg_kinds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsType GhcRn) -&gt; TcM Type)
-&gt; [GenLocated SrcSpanAnnA (HsType GhcRn)] -&gt; TcM [Type]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcRn)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM Type
</span><a href="GHC.Tc.Utils.TcMType.html#newOpenTypeKind"><span class="hs-identifier hs-var">newOpenTypeKind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LHsType GhcRn]
[GenLocated SrcSpanAnnA (HsType GhcRn)]
</span><a href="#local-6989586621683076896"><span class="hs-identifier hs-var">hs_tys</span></a></span><span>
</span><span id="line-1191"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683076902"><span class="annot"><a href="#local-6989586621683076902"><span class="hs-identifier hs-var">tau_tys</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">zipWithM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tc_check_lhs_type"><span class="hs-identifier hs-type">tc_check_lhs_type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076893"><span class="hs-identifier hs-type">mode</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683076896"><span class="hs-identifier hs-type">hs_tys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076900"><span class="hs-identifier hs-type">arg_kinds</span></a></span><span>
</span><span id="line-1192"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683076904"><span class="annot"><a href="#local-6989586621683076904"><span class="hs-identifier hs-var hs-var">arg_reps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; [Type] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#kindRep"><span class="hs-identifier hs-var">kindRep</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683076900"><span class="hs-identifier hs-var">arg_kinds</span></a></span><span>
</span><span id="line-1193"></span><span>             </span><span id="local-6989586621683076906"><span class="annot"><a href="#local-6989586621683076906"><span class="hs-identifier hs-var hs-var">arg_tys</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683076904"><span class="hs-identifier hs-var">arg_reps</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; [Type]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683076902"><span class="hs-identifier hs-var">tau_tys</span></a></span><span>
</span><span id="line-1194"></span><span>             </span><span id="local-6989586621683076907"><span class="annot"><a href="#local-6989586621683076907"><span class="hs-identifier hs-var hs-var">sum_ty</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; TyCon
</span><a href="GHC.Builtin.Types.html#sumTyCon"><span class="hs-identifier hs-var">sumTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683076898"><span class="hs-identifier hs-var">arity</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683076906"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-1195"></span><span>             </span><span id="local-6989586621683076909"><span class="annot"><a href="#local-6989586621683076909"><span class="hs-identifier hs-var hs-var">sum_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Type
</span><a href="GHC.Builtin.Types.html#unboxedSumKind"><span class="hs-identifier hs-var">unboxedSumKind</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683076904"><span class="hs-identifier hs-var">arg_reps</span></a></span><span>
</span><span id="line-1196"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#checkExpKind"><span class="hs-identifier hs-type">checkExpKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076894"><span class="hs-identifier hs-type">rn_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076907"><span class="hs-identifier hs-type">sum_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076909"><span class="hs-identifier hs-type">sum_kind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076897"><span class="hs-identifier hs-type">exp_kind</span></a></span><span>
</span><span id="line-1197"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-1198"></span><span>
</span><span id="line-1199"></span><span class="hs-comment">--------- Promoted lists and tuples</span><span>
</span><span id="line-1200"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsType"><span class="hs-identifier hs-var">tcHsType</span></a></span><span> </span><span id="local-6989586621683076911"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076911"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621683076912"><span class="annot"><span class="annottext">rn_ty :: HsType GhcRn
</span><a href="#local-6989586621683076912"><span class="hs-identifier hs-var">rn_ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsExplicitListTy"><span class="hs-identifier hs-type">HsExplicitListTy</span></a></span><span> </span><span class="annot"><span class="annottext">XExplicitListTy GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PromotionFlag
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683076914"><span class="annot"><span class="annottext">[LHsType GhcRn]
</span><a href="#local-6989586621683076914"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683076915"><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076915"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span>
</span><span id="line-1201"></span><span>  </span><span class="hs-comment">-- See Note [Kind-checking explicit lists]</span><span>
</span><span id="line-1202"></span><span>
</span><span id="line-1203"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsType GhcRn)] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[LHsType GhcRn]
[GenLocated SrcSpanAnnA (HsType GhcRn)]
</span><a href="#local-6989586621683076914"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-1204"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683076916"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621683076916"><span class="hs-identifier hs-var hs-var hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="GHC.Core.TyCon.html#mkTyConTy"><span class="hs-identifier hs-var">mkTyConTy</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.html#promotedNilDataCon"><span class="hs-identifier hs-var">promotedNilDataCon</span></a></span><span>
</span><span id="line-1205"></span><span>       </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683076919"><span class="annot"><span class="annottext">kind :: Type
</span><a href="#local-6989586621683076919"><span class="hs-identifier hs-var hs-var">kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcTyVar] -&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#mkSpecForAllTys"><span class="hs-identifier hs-var">mkSpecForAllTys</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcTyVar
</span><a href="GHC.Builtin.Types.Prim.html#alphaTyVar"><span class="hs-identifier hs-var">alphaTyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; Type -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="GHC.Builtin.Types.html#mkListTy"><span class="hs-identifier hs-var">mkListTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.Prim.html#alphaTy"><span class="hs-identifier hs-var">alphaTy</span></a></span><span>
</span><span id="line-1206"></span><span>       </span><span class="annot"><span class="annottext">HsType GhcRn -&gt; Type -&gt; Type -&gt; ExpSigmaType -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#checkExpKind"><span class="hs-identifier hs-var">checkExpKind</span></a></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683076912"><span class="hs-identifier hs-var">rn_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683076916"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683076919"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076915"><span class="hs-identifier hs-var">exp_kind</span></a></span><span>
</span><span id="line-1207"></span><span>
</span><span id="line-1208"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1209"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683076923"><span class="annot"><a href="#local-6989586621683076923"><span class="hs-identifier hs-var">tks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsType GhcRn) -&gt; TcM (Type, Type))
-&gt; [GenLocated SrcSpanAnnA (HsType GhcRn)]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [(Type, Type)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyMode -&gt; LHsType GhcRn -&gt; TcM (Type, Type)
</span><a href="GHC.Tc.Gen.HsType.html#tc_infer_lhs_type"><span class="hs-identifier hs-var">tc_infer_lhs_type</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076911"><span class="hs-identifier hs-var">mode</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LHsType GhcRn]
[GenLocated SrcSpanAnnA (HsType GhcRn)]
</span><a href="#local-6989586621683076914"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-1210"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683076924"><span class="annot"><a href="#local-6989586621683076924"><span class="hs-identifier hs-var">taus'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683076925"><span class="annot"><a href="#local-6989586621683076925"><span class="hs-identifier hs-var">kind</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#unifyKinds"><span class="hs-identifier hs-type">unifyKinds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076914"><span class="hs-identifier hs-type">tys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076923"><span class="hs-identifier hs-type">tks</span></a></span><span>
</span><span id="line-1211"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683076927"><span class="annot"><a href="#local-6989586621683076927"><span class="hs-identifier hs-var hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Type -&gt; Type -&gt; Type) -&gt; Type -&gt; [Type] -&gt; Type
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type -&gt; Type
</span><a href="#local-6989586621683076929"><span class="hs-identifier hs-var">mk_cons</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683076925"><span class="hs-identifier hs-var">kind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="#local-6989586621683076930"><span class="hs-identifier hs-var">mk_nil</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683076925"><span class="hs-identifier hs-var">kind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683076924"><span class="hs-identifier hs-var">taus'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1212"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#checkExpKind"><span class="hs-identifier hs-type">checkExpKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076912"><span class="hs-identifier hs-type">rn_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076927"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Builtin.Types.html#mkListTy"><span class="hs-identifier hs-type">mkListTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076925"><span class="hs-identifier hs-type">kind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683076915"><span class="hs-identifier hs-type">exp_kind</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1213"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1214"></span><span>    </span><span id="local-6989586621683076929"><span class="annot"><span class="annottext">mk_cons :: Type -&gt; Type -&gt; Type -&gt; Type
</span><a href="#local-6989586621683076929"><span class="hs-identifier hs-var hs-var">mk_cons</span></a></span></span><span> </span><span id="local-6989586621683076931"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683076931"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621683076932"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683076932"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621683076933"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683076933"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; TyCon
</span><a href="GHC.Core.DataCon.html#promoteDataCon"><span class="hs-identifier hs-var">promoteDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="GHC.Builtin.Types.html#consDataCon"><span class="hs-identifier hs-var">consDataCon</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683076931"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683076932"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683076933"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1215"></span><span>    </span><span id="local-6989586621683076930"><span class="annot"><span class="annottext">mk_nil :: Type -&gt; Type
</span><a href="#local-6989586621683076930"><span class="hs-identifier hs-var hs-var">mk_nil</span></a></span></span><span>  </span><span id="local-6989586621683076936"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683076936"><span class="hs-identifier hs-var">k</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; TyCon
</span><a href="GHC.Core.DataCon.html#promoteDataCon"><span class="hs-identifier hs-var">promoteDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="GHC.Builtin.Types.html#nilDataCon"><span class="hs-identifier hs-var">nilDataCon</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683076936"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1216"></span><span>
</span><span id="line-1217"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsType"><span class="hs-identifier hs-var">tcHsType</span></a></span><span> </span><span id="local-6989586621683076938"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076938"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621683076939"><span class="annot"><span class="annottext">rn_ty :: HsType GhcRn
</span><a href="#local-6989586621683076939"><span class="hs-identifier hs-var">rn_ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsExplicitTupleTy"><span class="hs-identifier hs-type">HsExplicitTupleTy</span></a></span><span> </span><span class="annot"><span class="annottext">XExplicitTupleTy GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PromotionFlag
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683076941"><span class="annot"><span class="annottext">[LHsType GhcRn]
</span><a href="#local-6989586621683076941"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683076942"><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076942"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span>
</span><span id="line-1218"></span><span>  </span><span class="hs-comment">-- using newMetaKindVar means that we force instantiations of any polykinded</span><span>
</span><span id="line-1219"></span><span>  </span><span class="hs-comment">-- types. At first, I just used tc_infer_lhs_type, but that led to #11255.</span><span>
</span><span id="line-1220"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683076943"><span class="annot"><a href="#local-6989586621683076943"><span class="hs-identifier hs-var">ks</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TcM Type -&gt; TcM [Type]
forall (m :: * -&gt; *) a. Applicative m =&gt; Int -&gt; m a -&gt; m [a]
</span><span class="hs-identifier hs-var">replicateM</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683076945"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">TcM Type
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaKindVar"><span class="hs-identifier hs-var">newMetaKindVar</span></a></span><span>
</span><span id="line-1221"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683076947"><span class="annot"><a href="#local-6989586621683076947"><span class="hs-identifier hs-var">taus</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">zipWithM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tc_check_lhs_type"><span class="hs-identifier hs-type">tc_check_lhs_type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076938"><span class="hs-identifier hs-type">mode</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683076941"><span class="hs-identifier hs-type">tys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076943"><span class="hs-identifier hs-type">ks</span></a></span><span>
</span><span id="line-1222"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683076948"><span class="annot"><a href="#local-6989586621683076948"><span class="hs-identifier hs-var hs-var">kind_con</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; Int -&gt; TyCon
</span><a href="GHC.Builtin.Types.html#tupleTyCon"><span class="hs-identifier hs-var">tupleTyCon</span></a></span><span>           </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683076945"><span class="hs-identifier hs-var">arity</span></a></span><span>
</span><span id="line-1223"></span><span>             </span><span id="local-6989586621683076951"><span class="annot"><a href="#local-6989586621683076951"><span class="hs-identifier hs-var hs-var">ty_con</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; Int -&gt; TyCon
</span><a href="GHC.Builtin.Types.html#promotedTupleDataCon"><span class="hs-identifier hs-var">promotedTupleDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683076945"><span class="hs-identifier hs-var">arity</span></a></span><span>
</span><span id="line-1224"></span><span>             </span><span id="local-6989586621683076953"><span class="annot"><a href="#local-6989586621683076953"><span class="hs-identifier hs-var hs-var">tup_k</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683076948"><span class="hs-identifier hs-var">kind_con</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683076943"><span class="hs-identifier hs-var">ks</span></a></span><span>
</span><span id="line-1225"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#checkTupSize"><span class="hs-identifier hs-type">checkTupSize</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076945"><span class="hs-identifier hs-type">arity</span></a></span><span>
</span><span id="line-1226"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#checkExpKind"><span class="hs-identifier hs-type">checkExpKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076939"><span class="hs-identifier hs-type">rn_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-type">mkTyConApp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076951"><span class="hs-identifier hs-type">ty_con</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683076943"><span class="hs-identifier hs-type">ks</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621683076947"><span class="hs-identifier hs-type">taus</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683076953"><span class="hs-identifier hs-type">tup_k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076942"><span class="hs-identifier hs-type">exp_kind</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1227"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1228"></span><span>    </span><span id="local-6989586621683076945"><span class="annot"><span class="annottext">arity :: Int
</span><a href="#local-6989586621683076945"><span class="hs-identifier hs-var hs-var">arity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsType GhcRn)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[LHsType GhcRn]
[GenLocated SrcSpanAnnA (HsType GhcRn)]
</span><a href="#local-6989586621683076941"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-1229"></span><span>
</span><span id="line-1230"></span><span class="hs-comment">--------- Constraint types</span><span>
</span><span id="line-1231"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsType"><span class="hs-identifier hs-var">tcHsType</span></a></span><span> </span><span id="local-6989586621683076955"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076955"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621683076956"><span class="annot"><span class="annottext">rn_ty :: HsType GhcRn
</span><a href="#local-6989586621683076956"><span class="hs-identifier hs-var">rn_ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsIParamTy"><span class="hs-identifier hs-type">HsIParamTy</span></a></span><span> </span><span class="annot"><span class="annottext">XIParamTy GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">EpAnnCO
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683076958"><span class="annot"><span class="annottext">HsIPName
</span><a href="#local-6989586621683076958"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683076959"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076959"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683076960"><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076960"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span>
</span><span id="line-1232"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcM ()
forall (m :: * -&gt; *). (HasCallStack, Applicative m) =&gt; Bool -&gt; m ()
</span><a href="GHC.Utils.Panic.Plain.html#massert"><span class="hs-identifier hs-var">massert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeOrKind -&gt; Bool
</span><a href="GHC.Types.Basic.html#isTypeLevel"><span class="hs-identifier hs-var">isTypeLevel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyMode -&gt; TypeOrKind
</span><a href="GHC.Tc.Gen.HsType.html#mode_tyki"><span class="hs-identifier hs-var">mode_tyki</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076955"><span class="hs-identifier hs-var">mode</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1233"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683076963"><span class="annot"><a href="#local-6989586621683076963"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcTyMode -&gt; LHsType GhcRn -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_check_lhs_type"><span class="hs-identifier hs-var">tc_check_lhs_type</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076955"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683076959"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span>
</span><span id="line-1234"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683076964"><span class="annot"><a href="#local-6989586621683076964"><span class="hs-identifier hs-var hs-var">n'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Type
</span><a href="GHC.Core.Type.html#mkStrLitTy"><span class="hs-identifier hs-var">mkStrLitTy</span></a></span><span> </span><span class="annot"><span class="annottext">(FastString -&gt; Type) -&gt; FastString -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HsIPName -&gt; FastString
</span><a href="Language.Haskell.Syntax.Type.html#hsIPNameFS"><span class="hs-identifier hs-var">hsIPNameFS</span></a></span><span> </span><span class="annot"><span class="annottext">HsIPName
</span><a href="#local-6989586621683076958"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1235"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683076967"><span class="annot"><a href="#local-6989586621683076967"><span class="hs-identifier hs-var">ipClass</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcLookupClass"><span class="hs-identifier hs-type">tcLookupClass</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#ipClassName"><span class="hs-identifier hs-type">ipClassName</span></a></span><span>
</span><span id="line-1236"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#checkExpKind"><span class="hs-identifier hs-type">checkExpKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076956"><span class="hs-identifier hs-type">rn_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Predicate.html#mkClassPred"><span class="hs-identifier hs-type">mkClassPred</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076967"><span class="hs-identifier hs-type">ipClass</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683076964"><span class="hs-identifier hs-type">n'</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621683076963"><span class="hs-identifier hs-type">ty'</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1237"></span><span>                           </span><span class="annot"><a href="GHC.Builtin.Types.html#constraintKind"><span class="hs-identifier hs-type">constraintKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076960"><span class="hs-identifier hs-type">exp_kind</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1238"></span><span>
</span><span id="line-1239"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsType"><span class="hs-identifier hs-var">tcHsType</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683076971"><span class="annot"><span class="annottext">rn_ty :: HsType GhcRn
</span><a href="#local-6989586621683076971"><span class="hs-identifier hs-var">rn_ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsStarTy"><span class="hs-identifier hs-type">HsStarTy</span></a></span><span> </span><span class="annot"><span class="annottext">XStarTy GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683076973"><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076973"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span>
</span><span id="line-1240"></span><span>  </span><span class="hs-comment">-- Desugaring 'HsStarTy' to 'Data.Kind.Type' here means that we don't</span><span>
</span><span id="line-1241"></span><span>  </span><span class="hs-comment">-- have to handle it in 'coreView'</span><span>
</span><span id="line-1242"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsType GhcRn -&gt; Type -&gt; Type -&gt; ExpSigmaType -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#checkExpKind"><span class="hs-identifier hs-var">checkExpKind</span></a></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683076971"><span class="hs-identifier hs-var">rn_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076973"><span class="hs-identifier hs-var">exp_kind</span></a></span><span>
</span><span id="line-1243"></span><span>
</span><span id="line-1244"></span><span class="hs-comment">--------- Literals</span><span>
</span><span id="line-1245"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsType"><span class="hs-identifier hs-var">tcHsType</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683076974"><span class="annot"><span class="annottext">rn_ty :: HsType GhcRn
</span><a href="#local-6989586621683076974"><span class="hs-identifier hs-var">rn_ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTyLit"><span class="hs-identifier hs-type">HsTyLit</span></a></span><span> </span><span class="annot"><span class="annottext">XTyLit GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsNumTy"><span class="hs-identifier hs-type">HsNumTy</span></a></span><span> </span><span class="annot"><span class="annottext">XNumTy GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683076977"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621683076977"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683076978"><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076978"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span>
</span><span id="line-1246"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TcM ()
</span><a href="GHC.Iface.Load.html#checkWiredInTyCon"><span class="hs-identifier hs-var">checkWiredInTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.html#naturalTyCon"><span class="hs-identifier hs-var">naturalTyCon</span></a></span><span>
</span><span id="line-1247"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsType GhcRn -&gt; Type -&gt; Type -&gt; ExpSigmaType -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#checkExpKind"><span class="hs-identifier hs-var">checkExpKind</span></a></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683076974"><span class="hs-identifier hs-var">rn_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Type
</span><a href="GHC.Core.Type.html#mkNumLitTy"><span class="hs-identifier hs-var">mkNumLitTy</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621683076977"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#naturalTy"><span class="hs-identifier hs-var">naturalTy</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076978"><span class="hs-identifier hs-var">exp_kind</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1248"></span><span>
</span><span id="line-1249"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsType"><span class="hs-identifier hs-var">tcHsType</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683076982"><span class="annot"><span class="annottext">rn_ty :: HsType GhcRn
</span><a href="#local-6989586621683076982"><span class="hs-identifier hs-var">rn_ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTyLit"><span class="hs-identifier hs-type">HsTyLit</span></a></span><span> </span><span class="annot"><span class="annottext">XTyLit GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsStrTy"><span class="hs-identifier hs-type">HsStrTy</span></a></span><span> </span><span class="annot"><span class="annottext">XStrTy GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683076984"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683076984"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683076985"><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076985"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span>
</span><span id="line-1250"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TcM ()
</span><a href="GHC.Iface.Load.html#checkWiredInTyCon"><span class="hs-identifier hs-var">checkWiredInTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.html#typeSymbolKindCon"><span class="hs-identifier hs-var">typeSymbolKindCon</span></a></span><span>
</span><span id="line-1251"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsType GhcRn -&gt; Type -&gt; Type -&gt; ExpSigmaType -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#checkExpKind"><span class="hs-identifier hs-var">checkExpKind</span></a></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683076982"><span class="hs-identifier hs-var">rn_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; Type
</span><a href="GHC.Core.Type.html#mkStrLitTy"><span class="hs-identifier hs-var">mkStrLitTy</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683076984"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#typeSymbolKind"><span class="hs-identifier hs-var">typeSymbolKind</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076985"><span class="hs-identifier hs-var">exp_kind</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1252"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsType"><span class="hs-identifier hs-var">tcHsType</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683076988"><span class="annot"><span class="annottext">rn_ty :: HsType GhcRn
</span><a href="#local-6989586621683076988"><span class="hs-identifier hs-var">rn_ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTyLit"><span class="hs-identifier hs-type">HsTyLit</span></a></span><span> </span><span class="annot"><span class="annottext">XTyLit GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsCharTy"><span class="hs-identifier hs-type">HsCharTy</span></a></span><span> </span><span class="annot"><span class="annottext">XCharTy GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683076990"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621683076990"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683076991"><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076991"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span>
</span><span id="line-1253"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TcM ()
</span><a href="GHC.Iface.Load.html#checkWiredInTyCon"><span class="hs-identifier hs-var">checkWiredInTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.html#charTyCon"><span class="hs-identifier hs-var">charTyCon</span></a></span><span>
</span><span id="line-1254"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsType GhcRn -&gt; Type -&gt; Type -&gt; ExpSigmaType -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#checkExpKind"><span class="hs-identifier hs-var">checkExpKind</span></a></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683076988"><span class="hs-identifier hs-var">rn_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Type
</span><a href="GHC.Core.Type.html#mkCharLitTy"><span class="hs-identifier hs-var">mkCharLitTy</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621683076990"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#charTy"><span class="hs-identifier hs-var">charTy</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076991"><span class="hs-identifier hs-var">exp_kind</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1255"></span><span>
</span><span id="line-1256"></span><span class="hs-comment">--------- Wildcards</span><span>
</span><span id="line-1257"></span><span>
</span><span id="line-1258"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsType"><span class="hs-identifier hs-var">tcHsType</span></a></span><span> </span><span id="local-6989586621683076995"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683076995"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621683076996"><span class="annot"><span class="annottext">ty :: HsType GhcRn
</span><a href="#local-6989586621683076996"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsWildCardTy"><span class="hs-identifier hs-type">HsWildCardTy</span></a></span><span> </span><span class="annot"><span class="annottext">XWildCardTy GhcRn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683076998"><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076998"><span class="hs-identifier hs-var">ek</span></a></span></span><span>
</span><span id="line-1259"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621683076999"><span class="annot"><a href="#local-6989586621683076999"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpSigmaType -&gt; TcM Type
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683076998"><span class="hs-identifier hs-var">ek</span></a></span><span>
</span><span id="line-1260"></span><span>       </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcAnonWildCardOcc"><span class="hs-identifier hs-type">tcAnonWildCardOcc</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#NoExtraConstraint"><span class="hs-identifier hs-type">NoExtraConstraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076995"><span class="hs-identifier hs-type">mode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076996"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683076999"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-1261"></span><span>
</span><span id="line-1262"></span><span class="hs-comment">--------- Type applications</span><span>
</span><span id="line-1263"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsType"><span class="hs-identifier hs-var">tcHsType</span></a></span><span> </span><span id="local-6989586621683077002"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077002"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621683077003"><span class="annot"><span class="annottext">rn_ty :: HsType GhcRn
</span><a href="#local-6989586621683077003"><span class="hs-identifier hs-var">rn_ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTyVar"><span class="hs-identifier hs-type">HsTyVar</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>     </span><span id="local-6989586621683077004"><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683077004"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyMode -&gt; HsType GhcRn -&gt; ExpSigmaType -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_app_ty"><span class="hs-identifier hs-var">tc_app_ty</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077002"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683077003"><span class="hs-identifier hs-var">rn_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683077004"><span class="hs-identifier hs-var">exp_kind</span></a></span><span>
</span><span id="line-1264"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsType"><span class="hs-identifier hs-var">tcHsType</span></a></span><span> </span><span id="local-6989586621683077006"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077006"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621683077007"><span class="annot"><span class="annottext">rn_ty :: HsType GhcRn
</span><a href="#local-6989586621683077007"><span class="hs-identifier hs-var">rn_ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsAppTy"><span class="hs-identifier hs-type">HsAppTy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>     </span><span id="local-6989586621683077009"><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683077009"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyMode -&gt; HsType GhcRn -&gt; ExpSigmaType -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_app_ty"><span class="hs-identifier hs-var">tc_app_ty</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077006"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683077007"><span class="hs-identifier hs-var">rn_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683077009"><span class="hs-identifier hs-var">exp_kind</span></a></span><span>
</span><span id="line-1265"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsType"><span class="hs-identifier hs-var">tcHsType</span></a></span><span> </span><span id="local-6989586621683077010"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077010"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621683077011"><span class="annot"><span class="annottext">rn_ty :: HsType GhcRn
</span><a href="#local-6989586621683077011"><span class="hs-identifier hs-var">rn_ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsAppKindTy"><span class="hs-identifier hs-type">HsAppKindTy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683077013"><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683077013"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyMode -&gt; HsType GhcRn -&gt; ExpSigmaType -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_app_ty"><span class="hs-identifier hs-var">tc_app_ty</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077010"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683077011"><span class="hs-identifier hs-var">rn_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683077013"><span class="hs-identifier hs-var">exp_kind</span></a></span><span>
</span><span id="line-1266"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsType"><span class="hs-identifier hs-var">tcHsType</span></a></span><span> </span><span id="local-6989586621683077014"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077014"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621683077015"><span class="annot"><span class="annottext">rn_ty :: HsType GhcRn
</span><a href="#local-6989586621683077015"><span class="hs-identifier hs-var">rn_ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOpTy"><span class="hs-identifier hs-type">HsOpTy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span id="local-6989586621683077016"><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683077016"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyMode -&gt; HsType GhcRn -&gt; ExpSigmaType -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_app_ty"><span class="hs-identifier hs-var">tc_app_ty</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077014"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683077015"><span class="hs-identifier hs-var">rn_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683077016"><span class="hs-identifier hs-var">exp_kind</span></a></span><span>
</span><span id="line-1267"></span><span>
</span><span id="line-1268"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsType"><span class="hs-identifier hs-var">tcHsType</span></a></span><span> </span><span id="local-6989586621683077017"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077017"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621683077018"><span class="annot"><span class="annottext">rn_ty :: HsType GhcRn
</span><a href="#local-6989586621683077018"><span class="hs-identifier hs-var">rn_ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsKindSig"><span class="hs-identifier hs-type">HsKindSig</span></a></span><span> </span><span class="annot"><span class="annottext">XKindSig GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683077020"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077020"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683077021"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077021"><span class="hs-identifier hs-var">sig</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683077022"><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683077022"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span>
</span><span id="line-1269"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683077023"><span class="annot"><span class="annottext">mode' :: TcTyMode
</span><a href="#local-6989586621683077023"><span class="hs-identifier hs-var hs-var hs-var">mode'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077017"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#mode_tyki"><span class="hs-identifier hs-var">mode_tyki</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#KindLevel"><span class="hs-identifier hs-type">KindLevel</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1270"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683077024"><span class="annot"><a href="#local-6989586621683077024"><span class="hs-identifier hs-var">sig'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcTyMode -&gt; UserTypeCtxt -&gt; LHsType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_lhs_kind_sig"><span class="hs-identifier hs-var">tc_lhs_kind_sig</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077023"><span class="hs-identifier hs-var">mode'</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#KindSigCtxt"><span class="hs-identifier hs-var">KindSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077021"><span class="hs-identifier hs-var">sig</span></a></span><span>
</span><span id="line-1271"></span><span>                 </span><span class="hs-comment">-- We must typecheck the kind signature, and solve all</span><span>
</span><span id="line-1272"></span><span>                 </span><span class="hs-comment">-- its equalities etc; from this point on we may do</span><span>
</span><span id="line-1273"></span><span>                 </span><span class="hs-comment">-- things like instantiate its foralls, so it needs</span><span>
</span><span id="line-1274"></span><span>                 </span><span class="hs-comment">-- to be fully determined (#14904)</span><span>
</span><span id="line-1275"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcHsType:sig&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077020"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077024"><span class="hs-identifier hs-type">sig'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1276"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683077027"><span class="annot"><a href="#local-6989586621683077027"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcAddKindSigPlaceholders"><span class="hs-identifier hs-type">tcAddKindSigPlaceholders</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077021"><span class="hs-identifier hs-type">sig</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1277"></span><span>                </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tc_check_lhs_type"><span class="hs-identifier hs-type">tc_check_lhs_type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077017"><span class="hs-identifier hs-type">mode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077020"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077024"><span class="hs-identifier hs-type">sig'</span></a></span><span>
</span><span id="line-1278"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#checkExpKind"><span class="hs-identifier hs-type">checkExpKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077018"><span class="hs-identifier hs-type">rn_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077027"><span class="hs-identifier hs-type">ty'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077024"><span class="hs-identifier hs-type">sig'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077022"><span class="hs-identifier hs-type">exp_kind</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1279"></span><span>
</span><span id="line-1280"></span><span class="hs-comment">-- See Note [Typechecking HsCoreTys]</span><span>
</span><span id="line-1281"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsType"><span class="hs-identifier hs-var">tcHsType</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683077029"><span class="annot"><span class="annottext">rn_ty :: HsType GhcRn
</span><a href="#local-6989586621683077029"><span class="hs-identifier hs-var">rn_ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#XHsType"><span class="hs-identifier hs-type">XHsType</span></a></span><span> </span><span id="local-6989586621683077031"><span class="annot"><span class="annottext">XXType GhcRn
</span><a href="#local-6989586621683077031"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683077032"><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683077032"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span>
</span><span id="line-1282"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621683077033"><span class="annot"><a href="#local-6989586621683077033"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span>
</span><span id="line-1283"></span><span>       </span><span class="hs-comment">-- Raw uniques since we go from NameEnv to TvSubstEnv.</span><span>
</span><span id="line-1284"></span><span>       </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621683077035"><span class="hs-identifier hs-type">subst_prs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1285"></span><span>           </span><span id="local-6989586621683077035"><span class="annot"><a href="#local-6989586621683077035"><span class="hs-identifier hs-var hs-var">subst_prs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Unique
forall a. Uniquable a =&gt; a -&gt; Unique
</span><a href="GHC.Types.Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077037"><span class="hs-identifier hs-var">nm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077038"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1286"></span><span>                       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#ATyVar"><span class="hs-identifier hs-type">ATyVar</span></a></span><span> </span><span id="local-6989586621683077037"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077037"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span id="local-6989586621683077038"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077038"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NameEnv TcTyThing -&gt; [TcTyThing]
forall a. NameEnv a -&gt; [a]
</span><a href="GHC.Types.Name.Env.html#nonDetNameEnvElts"><span class="hs-identifier hs-var">nonDetNameEnvElts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLclEnv -&gt; NameEnv TcTyThing
</span><a href="GHC.Tc.Types.LclEnv.html#getLclEnvTypeEnv"><span class="hs-identifier hs-var">getLclEnvTypeEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621683077033"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1287"></span><span>           </span><span id="local-6989586621683077044"><span class="annot"><a href="#local-6989586621683077044"><span class="hs-identifier hs-var hs-var">subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; TvSubstEnv -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#mkTvSubst"><span class="hs-identifier hs-var">mkTvSubst</span></a></span><span>
</span><span id="line-1288"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TcTyVar] -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#mkInScopeSetList"><span class="hs-identifier hs-var">mkInScopeSetList</span></a></span><span> </span><span class="annot"><span class="annottext">([TcTyVar] -&gt; InScopeSet) -&gt; [TcTyVar] -&gt; InScopeSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Unique, TcTyVar) -&gt; TcTyVar) -&gt; [(Unique, TcTyVar)] -&gt; [TcTyVar]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Unique, TcTyVar) -&gt; TcTyVar
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(Unique, TcTyVar)]
</span><a href="#local-6989586621683077035"><span class="hs-identifier hs-var">subst_prs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1289"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Unique, Type)] -&gt; TvSubstEnv
forall {k} elt (key :: k). [(Unique, elt)] -&gt; UniqFM key elt
</span><a href="GHC.Types.Unique.FM.html#listToUFM_Directly"><span class="hs-identifier hs-var">listToUFM_Directly</span></a></span><span> </span><span class="annot"><span class="annottext">([(Unique, Type)] -&gt; TvSubstEnv) -&gt; [(Unique, Type)] -&gt; TvSubstEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Unique, TcTyVar) -&gt; (Unique, Type))
-&gt; [(Unique, TcTyVar)] -&gt; [(Unique, Type)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TcTyVar -&gt; Type) -&gt; (Unique, TcTyVar) -&gt; (Unique, Type)
forall a b. (a -&gt; b) -&gt; (Unique, a) -&gt; (Unique, b)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Unique, TcTyVar)]
</span><a href="#local-6989586621683077035"><span class="hs-identifier hs-var">subst_prs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1290"></span><span>           </span><span id="local-6989586621683077050"><span class="annot"><a href="#local-6989586621683077050"><span class="hs-identifier hs-var hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077044"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">XXType GhcRn
Type
</span><a href="#local-6989586621683077031"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1291"></span><span>       </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#checkExpKind"><span class="hs-identifier hs-type">checkExpKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077029"><span class="hs-identifier hs-type">rn_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077050"><span class="hs-identifier hs-type">ty'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-type">typeKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077050"><span class="hs-identifier hs-type">ty'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683077032"><span class="hs-identifier hs-type">exp_kind</span></a></span><span>
</span><span id="line-1292"></span><span>
</span><span id="line-1293"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tc_hs_tuple_ty"><span class="hs-identifier hs-type">tc_hs_tuple_ty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsType"><span class="hs-identifier hs-type">HsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-1294"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a></span><span>
</span><span id="line-1295"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTupleSort"><span class="hs-identifier hs-type">HsTupleSort</span></a></span><span>
</span><span id="line-1296"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1297"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span>
</span><span id="line-1298"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-1299"></span><span class="hs-comment">-- See Note [Distinguishing tuple kinds] in GHC.Hs.Type</span><span>
</span><span id="line-1300"></span><span class="hs-comment">-- See Note [Inferring tuple kinds]</span><span>
</span><span id="line-1301"></span><span id="tc_hs_tuple_ty"><span class="annot"><span class="annottext">tc_hs_tuple_ty :: HsType GhcRn
-&gt; TcTyMode -&gt; HsTupleSort -&gt; [LHsType GhcRn] -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_hs_tuple_ty"><span class="hs-identifier hs-var hs-var">tc_hs_tuple_ty</span></a></span></span><span> </span><span id="local-6989586621683077052"><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683077052"><span class="hs-identifier hs-var">rn_ty</span></a></span></span><span> </span><span id="local-6989586621683077053"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077053"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span class="annot"><span class="annottext">HsTupleSort
</span><a href="Language.Haskell.Syntax.Type.html#HsBoxedOrConstraintTuple"><span class="hs-identifier hs-var">HsBoxedOrConstraintTuple</span></a></span><span> </span><span id="local-6989586621683077055"><span class="annot"><span class="annottext">[LHsType GhcRn]
</span><a href="#local-6989586621683077055"><span class="hs-identifier hs-var">hs_tys</span></a></span></span><span> </span><span id="local-6989586621683077056"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077056"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span>
</span><span id="line-1302"></span><span>     </span><span class="hs-comment">-- (NB: not zonking before looking at exp_k, to avoid left-right bias)</span><span>
</span><span id="line-1303"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683077057"><span class="annot"><span class="annottext">TupleSort
</span><a href="#local-6989586621683077057"><span class="hs-identifier hs-var">tup_sort</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe TupleSort
</span><a href="GHC.Tc.Gen.HsType.html#tupKindSort_maybe"><span class="hs-identifier hs-var">tupKindSort_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077056"><span class="hs-identifier hs-var">exp_kind</span></a></span><span>
</span><span id="line-1304"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcHsType tuple&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsType GhcRn)] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsType GhcRn]
[GenLocated SrcSpanAnnA (HsType GhcRn)]
</span><a href="#local-6989586621683077055"><span class="hs-identifier hs-var">hs_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcM () -&gt; TcM Type -&gt; TcM Type
forall a b.
IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span>
</span><span id="line-1305"></span><span>    </span><span class="annot"><span class="annottext">HsType GhcRn
-&gt; TcTyMode -&gt; TupleSort -&gt; [LHsType GhcRn] -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_tuple"><span class="hs-identifier hs-var">tc_tuple</span></a></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683077052"><span class="hs-identifier hs-var">rn_ty</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077053"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">TupleSort
</span><a href="#local-6989586621683077057"><span class="hs-identifier hs-var">tup_sort</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsType GhcRn]
</span><a href="#local-6989586621683077055"><span class="hs-identifier hs-var">hs_tys</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077056"><span class="hs-identifier hs-var">exp_kind</span></a></span><span>
</span><span id="line-1306"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1307"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcHsType tuple 2&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsType GhcRn)] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsType GhcRn]
[GenLocated SrcSpanAnnA (HsType GhcRn)]
</span><a href="#local-6989586621683077055"><span class="hs-identifier hs-var">hs_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1308"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077060"><span class="annot"><a href="#local-6989586621683077060"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077061"><span class="annot"><a href="#local-6989586621683077061"><span class="hs-identifier hs-var">kinds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsType GhcRn) -&gt; TcM (Type, Type))
-&gt; [GenLocated SrcSpanAnnA (HsType GhcRn)]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ([Type], [Type])
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; m (b, c)) -&gt; [a] -&gt; m ([b], [c])
</span><span class="hs-identifier hs-var">mapAndUnzipM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyMode -&gt; LHsType GhcRn -&gt; TcM (Type, Type)
</span><a href="GHC.Tc.Gen.HsType.html#tc_infer_lhs_type"><span class="hs-identifier hs-var">tc_infer_lhs_type</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077053"><span class="hs-identifier hs-var">mode</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LHsType GhcRn]
[GenLocated SrcSpanAnnA (HsType GhcRn)]
</span><a href="#local-6989586621683077055"><span class="hs-identifier hs-var">hs_tys</span></a></span><span>
</span><span id="line-1309"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683077063"><span class="annot"><a href="#local-6989586621683077063"><span class="hs-identifier hs-var">kinds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-type">liftZonkM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-type">zonkTcType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077061"><span class="hs-identifier hs-type">kinds</span></a></span><span>
</span><span id="line-1310"></span><span>           </span><span class="hs-comment">-- Infer each arg type separately, because errors can be</span><span>
</span><span id="line-1311"></span><span>           </span><span class="hs-comment">-- confusing if we give them a shared kind.  Eg #7410</span><span>
</span><span id="line-1312"></span><span>           </span><span class="hs-comment">-- (Either Int, Int), we do not want to get an error saying</span><span>
</span><span id="line-1313"></span><span>           </span><span class="hs-comment">-- &quot;the second argument of a tuple should have kind *-&gt;*&quot;</span><span>
</span><span id="line-1314"></span><span>
</span><span id="line-1315"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077064"><span class="annot"><a href="#local-6989586621683077064"><span class="hs-identifier hs-var">arg_kind</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077065"><span class="annot"><a href="#local-6989586621683077065"><span class="hs-identifier hs-var">tup_sort</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1316"></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683077066"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621683077067"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683077066"><span class="annot"><a href="#local-6989586621683077066"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683077063"><span class="hs-identifier hs-type">kinds</span></a></span><span>
</span><span id="line-1317"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683077067"><span class="annot"><a href="#local-6989586621683077067"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tupKindSort_maybe"><span class="hs-identifier hs-type">tupKindSort_maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077066"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1318"></span><span>                    </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621683077068"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077068"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683077069"><span class="annot"><span class="annottext">TupleSort
</span><a href="#local-6989586621683077069"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[(Type, TupleSort)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077068"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TupleSort
</span><a href="#local-6989586621683077069"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1319"></span><span>                    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TupleSort
</span><a href="GHC.Types.Basic.html#BoxedTuple"><span class="hs-identifier hs-var">BoxedTuple</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1320"></span><span>         </span><span class="hs-comment">-- In the [] case, it's not clear what the kind is, so guess *</span><span>
</span><span id="line-1321"></span><span>
</span><span id="line-1322"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683077071"><span class="annot"><a href="#local-6989586621683077071"><span class="hs-identifier hs-var">tys'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">sequence</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-type">setSrcSpanA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077073"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1323"></span><span>                            </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#checkExpectedKind"><span class="hs-identifier hs-type">checkExpectedKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077075"><span class="hs-identifier hs-type">hs_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077076"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077077"><span class="hs-identifier hs-type">kind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077064"><span class="hs-identifier hs-type">arg_kind</span></a></span><span>
</span><span id="line-1324"></span><span>                          </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683077073"><span class="annot"><a href="#local-6989586621683077073"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683077075"><span class="annot"><a href="#local-6989586621683077075"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621683077076"><span class="annot"><a href="#local-6989586621683077076"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683077077"><span class="annot"><a href="#local-6989586621683077077"><span class="hs-identifier hs-var">kind</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">zip3</span></span><span> </span><span class="annot"><a href="#local-6989586621683077055"><span class="hs-identifier hs-type">hs_tys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077060"><span class="hs-identifier hs-type">tys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077063"><span class="hs-identifier hs-type">kinds</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1325"></span><span>
</span><span id="line-1326"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#finish_tuple"><span class="hs-identifier hs-type">finish_tuple</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077052"><span class="hs-identifier hs-type">rn_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077065"><span class="hs-identifier hs-type">tup_sort</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077071"><span class="hs-identifier hs-type">tys'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">const</span></span><span> </span><span class="annot"><a href="#local-6989586621683077064"><span class="hs-identifier hs-type">arg_kind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683077071"><span class="hs-identifier hs-type">tys'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683077056"><span class="hs-identifier hs-type">exp_kind</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1327"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tc_hs_tuple_ty"><span class="hs-identifier hs-var">tc_hs_tuple_ty</span></a></span><span> </span><span id="local-6989586621683077080"><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683077080"><span class="hs-identifier hs-var">rn_ty</span></a></span></span><span> </span><span id="local-6989586621683077081"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077081"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span class="annot"><span class="annottext">HsTupleSort
</span><a href="Language.Haskell.Syntax.Type.html#HsUnboxedTuple"><span class="hs-identifier hs-var">HsUnboxedTuple</span></a></span><span> </span><span id="local-6989586621683077083"><span class="annot"><span class="annottext">[LHsType GhcRn]
</span><a href="#local-6989586621683077083"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span id="local-6989586621683077084"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077084"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1328"></span><span>    </span><span class="annot"><span class="annottext">HsType GhcRn
-&gt; TcTyMode -&gt; TupleSort -&gt; [LHsType GhcRn] -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_tuple"><span class="hs-identifier hs-var">tc_tuple</span></a></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683077080"><span class="hs-identifier hs-var">rn_ty</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077081"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">TupleSort
</span><a href="GHC.Types.Basic.html#UnboxedTuple"><span class="hs-identifier hs-var">UnboxedTuple</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsType GhcRn]
</span><a href="#local-6989586621683077083"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077084"><span class="hs-identifier hs-var">exp_kind</span></a></span><span>
</span><span id="line-1329"></span><span>
</span><span id="line-1330"></span><span class="hs-comment">{-
Note [Kind-checking explicit lists]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In a type, suppose we have an application (F [t1,t2]),
where [t1,t2] is an explicit list, and
   F :: [ki] -&gt; blah

Then we want to return the type
   F ((:) @ki t2 ((:) @ki t2 ([] @ki)))
where the argument list is instantiated to F's argument kind `ki`.

But what about (G []), where
   G :: (forall k. [k]) -&gt; blah

Here we want to return (G []), with no instantiation at all.  But since we have
no lambda in types, we must be careful not to instantiate that `[]`, because we
can't re-generalise it.  Hence, when kind-checking an explicit list, we need a
special case for `[]`.

Note [Variable Specificity and Forall Visibility]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
A HsForAllTy contains an HsForAllTelescope to denote the visibility of the forall
binder. Furthermore, each invisible type variable binder also has a
Specificity. Together, these determine the variable binders (ForAllTyFlag) for each
variable in the generated ForAllTy type.

This table summarises this relation:
----------------------------------------------------------------------------
| User-written type         HsForAllTelescope   Specificity        ForAllTyFlag
|---------------------------------------------------------------------------
| f :: forall a. type       HsForAllInvis       SpecifiedSpec      Specified
| f :: forall {a}. type     HsForAllInvis       InferredSpec       Inferred
| f :: forall a -&gt; type     HsForAllVis         SpecifiedSpec      Required
| f :: forall {a} -&gt; type   HsForAllVis         InferredSpec       /
|   This last form is nonsensical and is thus rejected.
----------------------------------------------------------------------------

For more information regarding the interpretation of the resulting ForAllTyFlag, see
Note [VarBndrs, ForAllTyBinders, TyConBinders, and visibility] in &quot;GHC.Core.TyCo.Rep&quot;.
-}</span><span>
</span><span id="line-1370"></span><span>
</span><span id="line-1371"></span><span class="hs-comment">------------------------------------------</span><span>
</span><span id="line-1372"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tc_mult"><span class="hs-identifier hs-type">tc_mult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsArrow"><span class="hs-identifier hs-type">HsArrow</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span>
</span><span id="line-1373"></span><span id="tc_mult"><span class="annot"><span class="annottext">tc_mult :: TcTyMode -&gt; HsArrow GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_mult"><span class="hs-identifier hs-var hs-var">tc_mult</span></a></span></span><span> </span><span id="local-6989586621683077086"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077086"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621683077087"><span class="annot"><span class="annottext">HsArrow GhcRn
</span><a href="#local-6989586621683077087"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyMode -&gt; LHsType GhcRn -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_check_lhs_type"><span class="hs-identifier hs-var">tc_check_lhs_type</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077086"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsArrow GhcRn -&gt; LHsType GhcRn
</span><a href="GHC.Hs.Type.html#arrowToHsType"><span class="hs-identifier hs-var">arrowToHsType</span></a></span><span> </span><span class="annot"><span class="annottext">HsArrow GhcRn
</span><a href="#local-6989586621683077087"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#multiplicityTy"><span class="hs-identifier hs-var">multiplicityTy</span></a></span><span>
</span><span id="line-1374"></span><span class="hs-comment">------------------------------------------</span><span>
</span><span id="line-1375"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tc_fun_type"><span class="hs-identifier hs-type">tc_fun_type</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsArrow"><span class="hs-identifier hs-type">HsArrow</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpKind"><span class="hs-identifier hs-type">ExpKind</span></a></span><span>
</span><span id="line-1376"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-1377"></span><span id="tc_fun_type"><span class="annot"><span class="annottext">tc_fun_type :: TcTyMode
-&gt; HsArrow GhcRn
-&gt; LHsType GhcRn
-&gt; LHsType GhcRn
-&gt; ExpSigmaType
-&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_fun_type"><span class="hs-identifier hs-var hs-var">tc_fun_type</span></a></span></span><span> </span><span id="local-6989586621683077090"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077090"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621683077091"><span class="annot"><span class="annottext">HsArrow GhcRn
</span><a href="#local-6989586621683077091"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span id="local-6989586621683077092"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077092"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621683077093"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077093"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span id="local-6989586621683077094"><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683077094"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TcTyMode -&gt; TypeOrKind
</span><a href="GHC.Tc.Gen.HsType.html#mode_tyki"><span class="hs-identifier hs-var">mode_tyki</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077090"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1378"></span><span>  </span><span class="annot"><span class="annottext">TypeOrKind
</span><a href="GHC.Types.Basic.html#TypeLevel"><span class="hs-identifier hs-var">TypeLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1379"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc_fun_type&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcRn) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621683077092"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcRn) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621683077093"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1380"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683077095"><span class="annot"><a href="#local-6989586621683077095"><span class="hs-identifier hs-var">arg_k</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM Type
</span><a href="GHC.Tc.Utils.TcMType.html#newOpenTypeKind"><span class="hs-identifier hs-var">newOpenTypeKind</span></a></span><span>
</span><span id="line-1381"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683077096"><span class="annot"><a href="#local-6989586621683077096"><span class="hs-identifier hs-var">res_k</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newOpenTypeKind"><span class="hs-identifier hs-type">newOpenTypeKind</span></a></span><span>
</span><span id="line-1382"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683077097"><span class="annot"><a href="#local-6989586621683077097"><span class="hs-identifier hs-var">ty1'</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tc_check_lhs_type"><span class="hs-identifier hs-type">tc_check_lhs_type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077090"><span class="hs-identifier hs-type">mode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077092"><span class="hs-identifier hs-type">ty1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077095"><span class="hs-identifier hs-type">arg_k</span></a></span><span>
</span><span id="line-1383"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683077098"><span class="annot"><a href="#local-6989586621683077098"><span class="hs-identifier hs-var">ty2'</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tc_check_lhs_type"><span class="hs-identifier hs-type">tc_check_lhs_type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077090"><span class="hs-identifier hs-type">mode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077093"><span class="hs-identifier hs-type">ty2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077096"><span class="hs-identifier hs-type">res_k</span></a></span><span>
</span><span id="line-1384"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683077099"><span class="annot"><a href="#local-6989586621683077099"><span class="hs-identifier hs-var">mult'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tc_mult"><span class="hs-identifier hs-type">tc_mult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077090"><span class="hs-identifier hs-type">mode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077091"><span class="hs-identifier hs-type">mult</span></a></span><span>
</span><span id="line-1385"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#checkExpKind"><span class="hs-identifier hs-type">checkExpKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsFunTy"><span class="hs-identifier hs-type">HsFunTy</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077091"><span class="hs-identifier hs-type">mult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077092"><span class="hs-identifier hs-type">ty1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077093"><span class="hs-identifier hs-type">ty2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1386"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#tcMkVisFunTy"><span class="hs-identifier hs-type">tcMkVisFunTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077099"><span class="hs-identifier hs-type">mult'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077097"><span class="hs-identifier hs-type">ty1'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077098"><span class="hs-identifier hs-type">ty2'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1387"></span><span>                      </span><span class="annot"><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-type">liftedTypeKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077094"><span class="hs-identifier hs-type">exp_kind</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1388"></span><span>  </span><span class="annot"><span class="annottext">TypeOrKind
</span><a href="GHC.Types.Basic.html#KindLevel"><span class="hs-identifier hs-var">KindLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-comment">-- no representation polymorphism in kinds. yet.</span><span>
</span><span id="line-1389"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683077101"><span class="annot"><a href="#local-6989586621683077101"><span class="hs-identifier hs-var">ty1'</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcTyMode -&gt; LHsType GhcRn -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_check_lhs_type"><span class="hs-identifier hs-var">tc_check_lhs_type</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077090"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077092"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span>
</span><span id="line-1390"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683077102"><span class="annot"><a href="#local-6989586621683077102"><span class="hs-identifier hs-var">ty2'</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tc_check_lhs_type"><span class="hs-identifier hs-type">tc_check_lhs_type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077090"><span class="hs-identifier hs-type">mode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077093"><span class="hs-identifier hs-type">ty2</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-type">liftedTypeKind</span></a></span><span>
</span><span id="line-1391"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683077103"><span class="annot"><a href="#local-6989586621683077103"><span class="hs-identifier hs-var">mult'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tc_mult"><span class="hs-identifier hs-type">tc_mult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077090"><span class="hs-identifier hs-type">mode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077091"><span class="hs-identifier hs-type">mult</span></a></span><span>
</span><span id="line-1392"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#checkExpKind"><span class="hs-identifier hs-type">checkExpKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsFunTy"><span class="hs-identifier hs-type">HsFunTy</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077091"><span class="hs-identifier hs-type">mult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077092"><span class="hs-identifier hs-type">ty1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077093"><span class="hs-identifier hs-type">ty2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1393"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#tcMkVisFunTy"><span class="hs-identifier hs-type">tcMkVisFunTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077103"><span class="hs-identifier hs-type">mult'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077101"><span class="hs-identifier hs-type">ty1'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077102"><span class="hs-identifier hs-type">ty2'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1394"></span><span>                      </span><span class="annot"><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-type">liftedTypeKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077094"><span class="hs-identifier hs-type">exp_kind</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1395"></span><span>
</span><span id="line-1396"></span><span class="hs-comment">{- Note [Skolem escape and forall-types]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
See also Note [Checking telescopes].

Consider
  f :: forall a. (forall kb (b :: kb). Proxy '[a, b]) -&gt; ()

The Proxy '[a,b] forces a and b to have the same kind.  But a's
kind must be bound outside the 'forall a', and hence escapes.
We discover this by building an implication constraint for
each forall.  So the inner implication constraint will look like
    forall kb (b::kb).  kb ~ ka
where ka is a's kind.  We can't unify these two, /even/ if ka is
unification variable, because it would be untouchable inside
this inner implication.

That's what the pushLevelAndCaptureConstraints, plus subsequent
buildTvImplication/emitImplication is all about, when kind-checking
HsForAllTy.

Note that

* We don't need to /simplify/ the constraints here
  because we aren't generalising. We just capture them.

* We can't use emitResidualTvConstraint, because that has a fast-path
  for empty constraints.  We can't take that fast path here, because
  we must do the bad-telescope check even if there are no inner wanted
  constraints. See Note [Checking telescopes] in
  GHC.Tc.Types.Constraint.  Lacking this check led to #16247.
-}</span><span>
</span><span id="line-1427"></span><span>
</span><span id="line-1428"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                Tuples
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-1433"></span><span>
</span><span id="line-1434"></span><span class="hs-comment">---------------------------</span><span>
</span><span id="line-1435"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tupKindSort_maybe"><span class="hs-identifier hs-type">tupKindSort_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TupleSort"><span class="hs-identifier hs-type">TupleSort</span></a></span><span>
</span><span id="line-1436"></span><span id="tupKindSort_maybe"><span class="annot"><span class="annottext">tupKindSort_maybe :: Type -&gt; Maybe TupleSort
</span><a href="GHC.Tc.Gen.HsType.html#tupKindSort_maybe"><span class="hs-identifier hs-var hs-var">tupKindSort_maybe</span></a></span></span><span> </span><span id="local-6989586621683077104"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077104"><span class="hs-identifier hs-var">k</span></a></span></span><span>
</span><span id="line-1437"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077105"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077105"><span class="hs-identifier hs-var">k'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (Type, Coercion)
</span><a href="GHC.Core.Type.html#splitCastTy_maybe"><span class="hs-identifier hs-var">splitCastTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077104"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe TupleSort
</span><a href="GHC.Tc.Gen.HsType.html#tupKindSort_maybe"><span class="hs-identifier hs-var">tupKindSort_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077105"><span class="hs-identifier hs-var">k'</span></a></span><span>
</span><span id="line-1438"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683077107"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077107"><span class="hs-identifier hs-var">k'</span></a></span></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Type
</span><a href="GHC.Core.Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077104"><span class="hs-identifier hs-var">k</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe TupleSort
</span><a href="GHC.Tc.Gen.HsType.html#tupKindSort_maybe"><span class="hs-identifier hs-var">tupKindSort_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077107"><span class="hs-identifier hs-var">k'</span></a></span><span>
</span><span id="line-1439"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isConstraintKind"><span class="hs-identifier hs-var">isConstraintKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077104"><span class="hs-identifier hs-var">k</span></a></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TupleSort -&gt; Maybe TupleSort
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">TupleSort
</span><a href="GHC.Types.Basic.html#ConstraintTuple"><span class="hs-identifier hs-var">ConstraintTuple</span></a></span><span>
</span><span id="line-1440"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#tcIsLiftedTypeKind"><span class="hs-identifier hs-var">tcIsLiftedTypeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077104"><span class="hs-identifier hs-var">k</span></a></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TupleSort -&gt; Maybe TupleSort
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">TupleSort
</span><a href="GHC.Types.Basic.html#BoxedTuple"><span class="hs-identifier hs-var">BoxedTuple</span></a></span><span>
</span><span id="line-1441"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe TupleSort
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1442"></span><span>
</span><span id="line-1443"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tc_tuple"><span class="hs-identifier hs-type">tc_tuple</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsType"><span class="hs-identifier hs-type">HsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TupleSort"><span class="hs-identifier hs-type">TupleSort</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-1444"></span><span id="tc_tuple"><span class="annot"><span class="annottext">tc_tuple :: HsType GhcRn
-&gt; TcTyMode -&gt; TupleSort -&gt; [LHsType GhcRn] -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_tuple"><span class="hs-identifier hs-var hs-var">tc_tuple</span></a></span></span><span> </span><span id="local-6989586621683077112"><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683077112"><span class="hs-identifier hs-var">rn_ty</span></a></span></span><span> </span><span id="local-6989586621683077113"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077113"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621683077114"><span class="annot"><span class="annottext">TupleSort
</span><a href="#local-6989586621683077114"><span class="hs-identifier hs-var">tup_sort</span></a></span></span><span> </span><span id="local-6989586621683077115"><span class="annot"><span class="annottext">[LHsType GhcRn]
</span><a href="#local-6989586621683077115"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span id="local-6989586621683077116"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077116"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span>
</span><span id="line-1445"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683077117"><span class="annot"><a href="#local-6989586621683077117"><span class="hs-identifier hs-var">arg_kinds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TupleSort
</span><a href="#local-6989586621683077114"><span class="hs-identifier hs-var">tup_sort</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1446"></span><span>           </span><span class="annot"><span class="annottext">TupleSort
</span><a href="GHC.Types.Basic.html#BoxedTuple"><span class="hs-identifier hs-var">BoxedTuple</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM [Type]
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Type -&gt; [Type]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683077119"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1447"></span><span>           </span><span class="annot"><span class="annottext">TupleSort
</span><a href="GHC.Types.Basic.html#UnboxedTuple"><span class="hs-identifier hs-var">UnboxedTuple</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TcM Type -&gt; TcM [Type]
forall (m :: * -&gt; *) a. Applicative m =&gt; Int -&gt; m a -&gt; m [a]
</span><span class="hs-identifier hs-var">replicateM</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683077119"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">TcM Type
</span><a href="GHC.Tc.Utils.TcMType.html#newOpenTypeKind"><span class="hs-identifier hs-var">newOpenTypeKind</span></a></span><span>
</span><span id="line-1448"></span><span>           </span><span class="annot"><span class="annottext">TupleSort
</span><a href="GHC.Types.Basic.html#ConstraintTuple"><span class="hs-identifier hs-var">ConstraintTuple</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM [Type]
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Type -&gt; [Type]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683077119"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#constraintKind"><span class="hs-identifier hs-var">constraintKind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1449"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683077120"><span class="annot"><a href="#local-6989586621683077120"><span class="hs-identifier hs-var">tau_tys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">zipWithM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tc_check_lhs_type"><span class="hs-identifier hs-type">tc_check_lhs_type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077113"><span class="hs-identifier hs-type">mode</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683077115"><span class="hs-identifier hs-type">tys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077117"><span class="hs-identifier hs-type">arg_kinds</span></a></span><span>
</span><span id="line-1450"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#finish_tuple"><span class="hs-identifier hs-type">finish_tuple</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077112"><span class="hs-identifier hs-type">rn_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077114"><span class="hs-identifier hs-type">tup_sort</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077120"><span class="hs-identifier hs-type">tau_tys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077117"><span class="hs-identifier hs-type">arg_kinds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077116"><span class="hs-identifier hs-type">exp_kind</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1451"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1452"></span><span>    </span><span id="local-6989586621683077119"><span class="annot"><span class="annottext">arity :: Int
</span><a href="#local-6989586621683077119"><span class="hs-identifier hs-var hs-var">arity</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsType GhcRn)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[LHsType GhcRn]
[GenLocated SrcSpanAnnA (HsType GhcRn)]
</span><a href="#local-6989586621683077115"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-1453"></span><span>
</span><span id="line-1454"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#finish_tuple"><span class="hs-identifier hs-type">finish_tuple</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsType"><span class="hs-identifier hs-type">HsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-1455"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TupleSort"><span class="hs-identifier hs-type">TupleSort</span></a></span><span>
</span><span id="line-1456"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span>    </span><span class="annot"><span class="hs-comment">-- ^ argument types</span></span><span>
</span><span id="line-1457"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span class="hs-special">]</span><span>    </span><span class="annot"><span class="hs-comment">-- ^ of these kinds</span></span><span>
</span><span id="line-1458"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ expected kind of the whole tuple</span></span><span>
</span><span id="line-1459"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-1460"></span><span id="finish_tuple"><span class="annot"><span class="annottext">finish_tuple :: HsType GhcRn -&gt; TupleSort -&gt; [Type] -&gt; [Type] -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#finish_tuple"><span class="hs-identifier hs-var hs-var">finish_tuple</span></a></span></span><span> </span><span id="local-6989586621683077121"><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683077121"><span class="hs-identifier hs-var">rn_ty</span></a></span></span><span> </span><span id="local-6989586621683077122"><span class="annot"><span class="annottext">TupleSort
</span><a href="#local-6989586621683077122"><span class="hs-identifier hs-var">tup_sort</span></a></span></span><span> </span><span id="local-6989586621683077123"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683077123"><span class="hs-identifier hs-var">tau_tys</span></a></span></span><span> </span><span id="local-6989586621683077124"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683077124"><span class="hs-identifier hs-var">tau_kinds</span></a></span></span><span> </span><span id="local-6989586621683077125"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077125"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1461"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;finish_tuple&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TupleSort -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TupleSort
</span><a href="#local-6989586621683077122"><span class="hs-identifier hs-var">tup_sort</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683077124"><span class="hs-identifier hs-var">tau_kinds</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077125"><span class="hs-identifier hs-var">exp_kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1462"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TupleSort
</span><a href="#local-6989586621683077122"><span class="hs-identifier hs-var">tup_sort</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1463"></span><span>    </span><span class="annot"><span class="annottext">TupleSort
</span><a href="GHC.Types.Basic.html#ConstraintTuple"><span class="hs-identifier hs-var">ConstraintTuple</span></a></span><span>
</span><span id="line-1464"></span><span>      </span><span class="hs-glyph">|</span><span>  </span><span class="hs-special">[</span><span id="local-6989586621683077126"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077126"><span class="hs-identifier hs-var">tau_ty</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683077123"><span class="hs-identifier hs-var">tau_tys</span></a></span><span>
</span><span id="line-1465"></span><span>         </span><span class="hs-comment">-- Drop any uses of 1-tuple constraints here.</span><span>
</span><span id="line-1466"></span><span>         </span><span class="hs-comment">-- See Note [Ignore unary constraint tuples]</span><span>
</span><span id="line-1467"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; TcM Type
</span><a href="#local-6989586621683077127"><span class="hs-identifier hs-var">check_expected_kind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077126"><span class="hs-identifier hs-var">tau_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#constraintKind"><span class="hs-identifier hs-var">constraintKind</span></a></span><span>
</span><span id="line-1468"></span><span>      </span><span class="hs-glyph">|</span><span>  </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1469"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683077128"><span class="annot"><span class="annottext">tycon :: TyCon
</span><a href="#local-6989586621683077128"><span class="hs-identifier hs-var hs-var hs-var">tycon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TyCon
</span><a href="GHC.Builtin.Types.html#cTupleTyCon"><span class="hs-identifier hs-var">cTupleTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683077130"><span class="hs-identifier hs-var">arity</span></a></span><span>
</span><span id="line-1470"></span><span>            </span><span class="annot"><span class="annottext">Int -&gt; TcM ()
</span><a href="GHC.Rename.Utils.html#checkCTupSize"><span class="hs-identifier hs-var">checkCTupSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683077130"><span class="hs-identifier hs-var">arity</span></a></span><span>
</span><span id="line-1471"></span><span>            </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; TcM Type
</span><a href="#local-6989586621683077127"><span class="hs-identifier hs-var">check_expected_kind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683077128"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683077123"><span class="hs-identifier hs-var">tau_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#constraintKind"><span class="hs-identifier hs-var">constraintKind</span></a></span><span>
</span><span id="line-1472"></span><span>    </span><span class="annot"><span class="annottext">TupleSort
</span><a href="GHC.Types.Basic.html#BoxedTuple"><span class="hs-identifier hs-var">BoxedTuple</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1473"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683077132"><span class="annot"><span class="annottext">tycon :: TyCon
</span><a href="#local-6989586621683077132"><span class="hs-identifier hs-var hs-var hs-var">tycon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; Int -&gt; TyCon
</span><a href="GHC.Builtin.Types.html#tupleTyCon"><span class="hs-identifier hs-var">tupleTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683077130"><span class="hs-identifier hs-var">arity</span></a></span><span>
</span><span id="line-1474"></span><span>      </span><span class="annot"><span class="annottext">Int -&gt; TcM ()
</span><a href="GHC.Rename.Utils.html#checkTupSize"><span class="hs-identifier hs-var">checkTupSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683077130"><span class="hs-identifier hs-var">arity</span></a></span><span>
</span><span id="line-1475"></span><span>      </span><span class="annot"><span class="annottext">TyCon -&gt; TcM ()
</span><a href="GHC.Iface.Load.html#checkWiredInTyCon"><span class="hs-identifier hs-var">checkWiredInTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683077132"><span class="hs-identifier hs-var">tycon</span></a></span><span>
</span><span id="line-1476"></span><span>      </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; TcM Type
</span><a href="#local-6989586621683077127"><span class="hs-identifier hs-var">check_expected_kind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683077132"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683077123"><span class="hs-identifier hs-var">tau_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span>
</span><span id="line-1477"></span><span>    </span><span class="annot"><span class="annottext">TupleSort
</span><a href="GHC.Types.Basic.html#UnboxedTuple"><span class="hs-identifier hs-var">UnboxedTuple</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1478"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683077133"><span class="annot"><span class="annottext">tycon :: TyCon
</span><a href="#local-6989586621683077133"><span class="hs-identifier hs-var hs-var hs-var">tycon</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; Int -&gt; TyCon
</span><a href="GHC.Builtin.Types.html#tupleTyCon"><span class="hs-identifier hs-var">tupleTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683077130"><span class="hs-identifier hs-var">arity</span></a></span><span>
</span><span id="line-1479"></span><span>          </span><span id="local-6989586621683077135"><span class="annot"><span class="annottext">tau_reps :: [Type]
</span><a href="#local-6989586621683077135"><span class="hs-identifier hs-var hs-var hs-var">tau_reps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; [Type] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#kindRep"><span class="hs-identifier hs-var">kindRep</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683077124"><span class="hs-identifier hs-var">tau_kinds</span></a></span><span>
</span><span id="line-1480"></span><span>          </span><span class="hs-comment">-- See also Note [Unboxed tuple RuntimeRep vars] in GHC.Core.TyCon</span><span>
</span><span id="line-1481"></span><span>          </span><span id="local-6989586621683077136"><span class="annot"><span class="annottext">arg_tys :: [Type]
</span><a href="#local-6989586621683077136"><span class="hs-identifier hs-var hs-var hs-var">arg_tys</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683077135"><span class="hs-identifier hs-var">tau_reps</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; [Type]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683077123"><span class="hs-identifier hs-var">tau_tys</span></a></span><span>
</span><span id="line-1482"></span><span>          </span><span id="local-6989586621683077137"><span class="annot"><span class="annottext">res_kind :: Type
</span><a href="#local-6989586621683077137"><span class="hs-identifier hs-var hs-var hs-var">res_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Type
</span><a href="GHC.Builtin.Types.html#unboxedTupleKind"><span class="hs-identifier hs-var">unboxedTupleKind</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683077135"><span class="hs-identifier hs-var">tau_reps</span></a></span><span>
</span><span id="line-1483"></span><span>      </span><span class="annot"><span class="annottext">Int -&gt; TcM ()
</span><a href="GHC.Rename.Utils.html#checkTupSize"><span class="hs-identifier hs-var">checkTupSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683077130"><span class="hs-identifier hs-var">arity</span></a></span><span>
</span><span id="line-1484"></span><span>      </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; TcM Type
</span><a href="#local-6989586621683077127"><span class="hs-identifier hs-var">check_expected_kind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683077133"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683077136"><span class="hs-identifier hs-var">arg_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077137"><span class="hs-identifier hs-var">res_kind</span></a></span><span>
</span><span id="line-1485"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1486"></span><span>    </span><span id="local-6989586621683077130"><span class="annot"><span class="annottext">arity :: Int
</span><a href="#local-6989586621683077130"><span class="hs-identifier hs-var hs-var">arity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683077123"><span class="hs-identifier hs-var">tau_tys</span></a></span><span>
</span><span id="line-1487"></span><span>    </span><span id="local-6989586621683077127"><span class="annot"><span class="annottext">check_expected_kind :: Type -&gt; Type -&gt; TcM Type
</span><a href="#local-6989586621683077127"><span class="hs-identifier hs-var hs-var">check_expected_kind</span></a></span></span><span> </span><span id="local-6989586621683077139"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077139"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683077140"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077140"><span class="hs-identifier hs-var">act_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1488"></span><span>      </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt;
HsType GhcRn -&gt; Type -&gt; Type -&gt; Type -&gt; TcM Type
HsType GhcRn -&gt; Type -&gt; Type -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#checkExpectedKind"><span class="hs-identifier hs-var">checkExpectedKind</span></a></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683077121"><span class="hs-identifier hs-var">rn_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077139"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077140"><span class="hs-identifier hs-var">act_kind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077125"><span class="hs-identifier hs-var">exp_kind</span></a></span><span>
</span><span id="line-1489"></span><span>
</span><span id="line-1490"></span><span class="hs-comment">{-
Note [Ignore unary constraint tuples]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
GHC provides unary tuples and unboxed tuples (see Note [One-tuples] in
GHC.Builtin.Types) but does *not* provide unary constraint tuples. Why? First,
recall the definition of a unary tuple data type:

  data Solo a = Solo a

Note that `Solo a` is *not* the same thing as `a`, since Solo is boxed and
lazy. Therefore, the presence of `Solo` matters semantically. On the other
hand, suppose we had a unary constraint tuple:

  class a =&gt; Solo% a

This compiles down a newtype (i.e., a cast) in Core, so `Solo% a` is
semantically equivalent to `a`. Therefore, a 1-tuple constraint would have
no user-visible impact, nor would it allow you to express anything that
you couldn't otherwise.

We could simply add Solo% for consistency with tuples (Solo) and unboxed
tuples (Solo#), but that would require even more magic to wire in another
magical class, so we opt not to do so. We must be careful, however, since
one can try to sneak in uses of unary constraint tuples through Template
Haskell, such as in this program (from #17511):

  f :: $(pure (ForallT [] [TupleT 1 `AppT` (ConT ''Show `AppT` ConT ''Int)]
                       (ConT ''String)))
  -- f :: Solo% (Show Int) =&gt; String
  f = &quot;abc&quot;

This use of `TupleT 1` will produce an HsBoxedOrConstraintTuple of arity 1,
and since it is used in a Constraint position, GHC will attempt to treat
it as thought it were a constraint tuple, which can potentially lead to
trouble if one attempts to look up the name of a constraint tuple of arity
1 (as it won't exist). To avoid this trouble, we simply take any unary
constraint tuples discovered when typechecking and drop them&#8212;i.e., treat
&quot;Solo% a&quot; as though the user had written &quot;a&quot;. This is always safe to do
since the two constraints should be semantically equivalent.
-}</span><span>
</span><span id="line-1530"></span><span>
</span><span id="line-1531"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                Type applications
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-1536"></span><span>
</span><span id="line-1537"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#splitHsAppTys_maybe"><span class="hs-identifier hs-type">splitHsAppTys_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsType"><span class="hs-identifier hs-type">HsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsTypeArg"><span class="hs-identifier hs-type">LHsTypeArg</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1538"></span><span id="splitHsAppTys_maybe"><span class="annot"><span class="annottext">splitHsAppTys_maybe :: HsType GhcRn -&gt; Maybe (LHsType GhcRn, HsFamEqnPats GhcRn)
</span><a href="GHC.Tc.Gen.HsType.html#splitHsAppTys_maybe"><span class="hs-identifier hs-var hs-var">splitHsAppTys_maybe</span></a></span></span><span> </span><span id="local-6989586621683077142"><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683077142"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span>
</span><span id="line-1539"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HsType GhcRn -&gt; Bool
</span><a href="#local-6989586621683077143"><span class="hs-identifier hs-var">is_app</span></a></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683077142"><span class="hs-identifier hs-var">hs_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsType GhcRn),
 [HsArg
    GhcRn
    (GenLocated SrcSpanAnnA (HsType GhcRn))
    (GenLocated SrcSpanAnnA (HsType GhcRn))])
-&gt; Maybe
     (GenLocated SrcSpanAnnA (HsType GhcRn),
      [HsArg
         GhcRn
         (GenLocated SrcSpanAnnA (HsType GhcRn))
         (GenLocated SrcSpanAnnA (HsType GhcRn))])
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsType GhcRn -&gt; (LHsType GhcRn, HsFamEqnPats GhcRn)
</span><a href="GHC.Tc.Gen.HsType.html#splitHsAppTys"><span class="hs-identifier hs-var">splitHsAppTys</span></a></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683077142"><span class="hs-identifier hs-var">hs_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1540"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (LHsType GhcRn, HsFamEqnPats GhcRn)
Maybe
  (GenLocated SrcSpanAnnA (HsType GhcRn),
   [HsArg
      GhcRn
      (GenLocated SrcSpanAnnA (HsType GhcRn))
      (GenLocated SrcSpanAnnA (HsType GhcRn))])
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1541"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1542"></span><span>    </span><span class="annot"><a href="#local-6989586621683077143"><span class="hs-identifier hs-type">is_app</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsType"><span class="hs-identifier hs-type">HsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1543"></span><span>    </span><span id="local-6989586621683077143"><span class="annot"><span class="annottext">is_app :: HsType GhcRn -&gt; Bool
</span><a href="#local-6989586621683077143"><span class="hs-identifier hs-var hs-var">is_app</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsAppKindTy"><span class="hs-identifier hs-type">HsAppKindTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1544"></span><span>    </span><span class="annot"><a href="#local-6989586621683077143"><span class="hs-identifier hs-var">is_app</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsAppTy"><span class="hs-identifier hs-type">HsAppTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1545"></span><span>    </span><span class="annot"><a href="#local-6989586621683077143"><span class="hs-identifier hs-var">is_app</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOpTy"><span class="hs-identifier hs-type">HsOpTy</span></a></span><span> </span><span class="annot"><span class="annottext">XOpTy GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PromotionFlag
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683077145"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077145"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077145"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#unrestrictedFunTyConKey"><span class="hs-identifier hs-var">unrestrictedFunTyConKey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1546"></span><span>      </span><span class="hs-comment">-- I'm not sure why this funTyConKey test is necessary</span><span>
</span><span id="line-1547"></span><span>      </span><span class="hs-comment">-- Can it even happen?  Perhaps for   t1 `(-&gt;)` t2</span><span>
</span><span id="line-1548"></span><span>      </span><span class="hs-comment">-- but then maybe it's ok to treat that like a normal</span><span>
</span><span id="line-1549"></span><span>      </span><span class="hs-comment">-- application rather than using the special rule for HsFunTy</span><span>
</span><span id="line-1550"></span><span>    </span><span class="annot"><a href="#local-6989586621683077143"><span class="hs-identifier hs-var">is_app</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTyVar"><span class="hs-identifier hs-type">HsTyVar</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1551"></span><span>    </span><span class="annot"><a href="#local-6989586621683077143"><span class="hs-identifier hs-var">is_app</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsParTy"><span class="hs-identifier hs-type">HsParTy</span></a></span><span> </span><span class="annot"><span class="annottext">XParTy GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683077147"><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683077147"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsType GhcRn -&gt; Bool
</span><a href="#local-6989586621683077143"><span class="hs-identifier hs-var">is_app</span></a></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683077147"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1552"></span><span>    </span><span class="annot"><a href="#local-6989586621683077143"><span class="hs-identifier hs-var">is_app</span></a></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn
</span><span class="hs-identifier">_</span></span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1553"></span><span>
</span><span id="line-1554"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#splitHsAppTys"><span class="hs-identifier hs-type">splitHsAppTys</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsType"><span class="hs-identifier hs-type">HsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsTypeArg"><span class="hs-identifier hs-type">LHsTypeArg</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1555"></span><span>
</span><span id="line-1556"></span><span id="splitHsAppTys"><span class="annot"><span class="annottext">splitHsAppTys :: HsType GhcRn -&gt; (LHsType GhcRn, HsFamEqnPats GhcRn)
</span><a href="GHC.Tc.Gen.HsType.html#splitHsAppTys"><span class="hs-identifier hs-var hs-var">splitHsAppTys</span></a></span></span><span> </span><span id="local-6989586621683077148"><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683077148"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
-&gt; HsFamEqnPats GhcRn -&gt; (LHsType GhcRn, HsFamEqnPats GhcRn)
</span><a href="#local-6989586621683077149"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsType GhcRn -&gt; GenLocated SrcSpanAnnA (HsType GhcRn)
forall e a. HasAnnotation e =&gt; a -&gt; GenLocated e a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683077148"><span class="hs-identifier hs-var">hs_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1557"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1558"></span><span>    </span><span class="annot"><a href="#local-6989586621683077149"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-1559"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsArg"><span class="hs-identifier hs-type">HsArg</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsKind"><span class="hs-identifier hs-type">LHsKind</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1560"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1561"></span><span>           </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsArg"><span class="hs-identifier hs-type">HsArg</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsKind"><span class="hs-identifier hs-type">LHsKind</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- AZ temp</span><span>
</span><span id="line-1562"></span><span>    </span><span id="local-6989586621683077149"><span class="annot"><span class="annottext">go :: LHsType GhcRn
-&gt; HsFamEqnPats GhcRn -&gt; (LHsType GhcRn, HsFamEqnPats GhcRn)
</span><a href="#local-6989586621683077149"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsAppTy"><span class="hs-identifier hs-type">HsAppTy</span></a></span><span> </span><span class="annot"><span class="annottext">XAppTy GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683077150"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077150"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621683077151"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077151"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>      </span><span id="local-6989586621683077152"><span class="annot"><span class="annottext">HsFamEqnPats GhcRn
</span><a href="#local-6989586621683077152"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
-&gt; HsFamEqnPats GhcRn -&gt; (LHsType GhcRn, HsFamEqnPats GhcRn)
</span><a href="#local-6989586621683077149"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077150"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XValArg GhcRn
-&gt; GenLocated SrcSpanAnnA (HsType GhcRn)
-&gt; HsArg
     GhcRn
     (GenLocated SrcSpanAnnA (HsType GhcRn))
     (GenLocated SrcSpanAnnA (HsType GhcRn))
forall p tm ty. XValArg p -&gt; tm -&gt; HsArg p tm ty
</span><a href="Language.Haskell.Syntax.Type.html#HsValArg"><span class="hs-identifier hs-var">HsValArg</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XValArg GhcRn
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621683077151"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">HsArg
  GhcRn
  (GenLocated SrcSpanAnnA (HsType GhcRn))
  (GenLocated SrcSpanAnnA (HsType GhcRn))
-&gt; [HsArg
      GhcRn
      (GenLocated SrcSpanAnnA (HsType GhcRn))
      (GenLocated SrcSpanAnnA (HsType GhcRn))]
-&gt; [HsArg
      GhcRn
      (GenLocated SrcSpanAnnA (HsType GhcRn))
      (GenLocated SrcSpanAnnA (HsType GhcRn))]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">HsFamEqnPats GhcRn
[HsArg
   GhcRn
   (GenLocated SrcSpanAnnA (HsType GhcRn))
   (GenLocated SrcSpanAnnA (HsType GhcRn))]
</span><a href="#local-6989586621683077152"><span class="hs-keyword hs-var">as</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1563"></span><span>    </span><span class="annot"><a href="#local-6989586621683077149"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsAppKindTy"><span class="hs-identifier hs-type">HsAppKindTy</span></a></span><span> </span><span class="annot"><span class="annottext">XAppKindTy GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683077154"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077154"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683077155"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077155"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683077156"><span class="annot"><span class="annottext">HsFamEqnPats GhcRn
</span><a href="#local-6989586621683077156"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
-&gt; HsFamEqnPats GhcRn -&gt; (LHsType GhcRn, HsFamEqnPats GhcRn)
</span><a href="#local-6989586621683077149"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077154"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XTypeArg GhcRn
-&gt; GenLocated SrcSpanAnnA (HsType GhcRn)
-&gt; HsArg
     GhcRn
     (GenLocated SrcSpanAnnA (HsType GhcRn))
     (GenLocated SrcSpanAnnA (HsType GhcRn))
forall p tm ty. XTypeArg p -&gt; ty -&gt; HsArg p tm ty
</span><a href="Language.Haskell.Syntax.Type.html#HsTypeArg"><span class="hs-identifier hs-var">HsTypeArg</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XTypeArg GhcRn
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621683077155"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">HsArg
  GhcRn
  (GenLocated SrcSpanAnnA (HsType GhcRn))
  (GenLocated SrcSpanAnnA (HsType GhcRn))
-&gt; [HsArg
      GhcRn
      (GenLocated SrcSpanAnnA (HsType GhcRn))
      (GenLocated SrcSpanAnnA (HsType GhcRn))]
-&gt; [HsArg
      GhcRn
      (GenLocated SrcSpanAnnA (HsType GhcRn))
      (GenLocated SrcSpanAnnA (HsType GhcRn))]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">HsFamEqnPats GhcRn
[HsArg
   GhcRn
   (GenLocated SrcSpanAnnA (HsType GhcRn))
   (GenLocated SrcSpanAnnA (HsType GhcRn))]
</span><a href="#local-6989586621683077156"><span class="hs-keyword hs-var">as</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1564"></span><span>    </span><span class="annot"><a href="#local-6989586621683077149"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683077158"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683077158"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsParTy"><span class="hs-identifier hs-type">HsParTy</span></a></span><span> </span><span class="annot"><span class="annottext">XParTy GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683077159"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077159"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>        </span><span id="local-6989586621683077160"><span class="annot"><span class="annottext">HsFamEqnPats GhcRn
</span><a href="#local-6989586621683077160"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
-&gt; HsFamEqnPats GhcRn -&gt; (LHsType GhcRn, HsFamEqnPats GhcRn)
</span><a href="#local-6989586621683077149"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077159"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XArgPar GhcRn
-&gt; HsArg
     GhcRn
     (GenLocated SrcSpanAnnA (HsType GhcRn))
     (GenLocated SrcSpanAnnA (HsType GhcRn))
forall p tm ty. XArgPar p -&gt; HsArg p tm ty
</span><a href="Language.Haskell.Syntax.Type.html#HsArgPar"><span class="hs-identifier hs-var">HsArgPar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; SrcSpan
forall a. HasLoc a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-var">locA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683077158"><span class="hs-identifier hs-var">sp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsArg
  GhcRn
  (GenLocated SrcSpanAnnA (HsType GhcRn))
  (GenLocated SrcSpanAnnA (HsType GhcRn))
-&gt; [HsArg
      GhcRn
      (GenLocated SrcSpanAnnA (HsType GhcRn))
      (GenLocated SrcSpanAnnA (HsType GhcRn))]
-&gt; [HsArg
      GhcRn
      (GenLocated SrcSpanAnnA (HsType GhcRn))
      (GenLocated SrcSpanAnnA (HsType GhcRn))]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">HsFamEqnPats GhcRn
[HsArg
   GhcRn
   (GenLocated SrcSpanAnnA (HsType GhcRn))
   (GenLocated SrcSpanAnnA (HsType GhcRn))]
</span><a href="#local-6989586621683077160"><span class="hs-keyword hs-var">as</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1565"></span><span>    </span><span class="annot"><a href="#local-6989586621683077149"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOpTy"><span class="hs-identifier hs-type">HsOpTy</span></a></span><span> </span><span class="annot"><span class="annottext">XOpTy GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683077163"><span class="annot"><span class="annottext">PromotionFlag
</span><a href="#local-6989586621683077163"><span class="hs-identifier hs-var">prom</span></a></span></span><span> </span><span id="local-6989586621683077164"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077164"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621683077165"><span class="annot"><span class="annottext">op :: LIdP GhcRn
</span><a href="#local-6989586621683077165"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683077166"><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621683077166"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683077167"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077167"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683077168"><span class="annot"><span class="annottext">HsFamEqnPats GhcRn
</span><a href="#local-6989586621683077168"><span class="hs-keyword hs-var">as</span></a></span></span><span>
</span><span id="line-1566"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; HsType GhcRn -&gt; GenLocated SrcSpanAnnA (HsType GhcRn)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnN -&gt; SrcSpanAnnA
forall a b. (HasLoc a, HasAnnotation b) =&gt; a -&gt; b
</span><a href="GHC.Parser.Annotation.html#l2l"><span class="hs-identifier hs-var">l2l</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621683077166"><span class="hs-identifier hs-var">sp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XTyVar GhcRn -&gt; PromotionFlag -&gt; LIdP GhcRn -&gt; HsType GhcRn
forall pass.
XTyVar pass -&gt; PromotionFlag -&gt; LIdP pass -&gt; HsType pass
</span><a href="Language.Haskell.Syntax.Type.html#HsTyVar"><span class="hs-identifier hs-var">HsTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">XTyVar GhcRn
EpToken &quot;'&quot;
forall a. NoAnn a =&gt; a
</span><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-var">noAnn</span></a></span><span> </span><span class="annot"><span class="annottext">PromotionFlag
</span><a href="#local-6989586621683077163"><span class="hs-identifier hs-var">prom</span></a></span><span> </span><span class="annot"><span class="annottext">LIdP GhcRn
</span><a href="#local-6989586621683077165"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1567"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">XValArg GhcRn
-&gt; GenLocated SrcSpanAnnA (HsType GhcRn)
-&gt; HsArg
     GhcRn
     (GenLocated SrcSpanAnnA (HsType GhcRn))
     (GenLocated SrcSpanAnnA (HsType GhcRn))
forall p tm ty. XValArg p -&gt; tm -&gt; HsArg p tm ty
</span><a href="Language.Haskell.Syntax.Type.html#HsValArg"><span class="hs-identifier hs-var">HsValArg</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XValArg GhcRn
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621683077164"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">HsArg
  GhcRn
  (GenLocated SrcSpanAnnA (HsType GhcRn))
  (GenLocated SrcSpanAnnA (HsType GhcRn))
-&gt; [HsArg
      GhcRn
      (GenLocated SrcSpanAnnA (HsType GhcRn))
      (GenLocated SrcSpanAnnA (HsType GhcRn))]
-&gt; [HsArg
      GhcRn
      (GenLocated SrcSpanAnnA (HsType GhcRn))
      (GenLocated SrcSpanAnnA (HsType GhcRn))]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">XValArg GhcRn
-&gt; GenLocated SrcSpanAnnA (HsType GhcRn)
-&gt; HsArg
     GhcRn
     (GenLocated SrcSpanAnnA (HsType GhcRn))
     (GenLocated SrcSpanAnnA (HsType GhcRn))
forall p tm ty. XValArg p -&gt; tm -&gt; HsArg p tm ty
</span><a href="Language.Haskell.Syntax.Type.html#HsValArg"><span class="hs-identifier hs-var">HsValArg</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XValArg GhcRn
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621683077167"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">HsArg
  GhcRn
  (GenLocated SrcSpanAnnA (HsType GhcRn))
  (GenLocated SrcSpanAnnA (HsType GhcRn))
-&gt; [HsArg
      GhcRn
      (GenLocated SrcSpanAnnA (HsType GhcRn))
      (GenLocated SrcSpanAnnA (HsType GhcRn))]
-&gt; [HsArg
      GhcRn
      (GenLocated SrcSpanAnnA (HsType GhcRn))
      (GenLocated SrcSpanAnnA (HsType GhcRn))]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">HsFamEqnPats GhcRn
[HsArg
   GhcRn
   (GenLocated SrcSpanAnnA (HsType GhcRn))
   (GenLocated SrcSpanAnnA (HsType GhcRn))]
</span><a href="#local-6989586621683077168"><span class="hs-keyword hs-var">as</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1568"></span><span>    </span><span class="annot"><a href="#local-6989586621683077149"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621683077170"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077170"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621683077171"><span class="annot"><span class="annottext">HsFamEqnPats GhcRn
</span><a href="#local-6989586621683077171"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077170"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsFamEqnPats GhcRn
</span><a href="#local-6989586621683077171"><span class="hs-keyword hs-var">as</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1569"></span><span>
</span><span id="line-1570"></span><span class="hs-comment">---------------------------</span><span>
</span><span id="line-1571"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcInferTyAppHead"><span class="hs-identifier hs-type">tcInferTyAppHead</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1572"></span><span class="hs-comment">-- Version of tc_infer_lhs_type specialised for the head of an</span><span>
</span><span id="line-1573"></span><span class="hs-comment">-- application. In particular, for a HsTyVar (which includes type</span><span>
</span><span id="line-1574"></span><span class="hs-comment">-- constructors, it does not zoom off into tcInferTyApps and family</span><span>
</span><span id="line-1575"></span><span class="hs-comment">-- saturation</span><span>
</span><span id="line-1576"></span><span id="tcInferTyAppHead"><span class="annot"><span class="annottext">tcInferTyAppHead :: TcTyMode -&gt; LHsType GhcRn -&gt; TcM (Type, Type)
</span><a href="GHC.Tc.Gen.HsType.html#tcInferTyAppHead"><span class="hs-identifier hs-var hs-var">tcInferTyAppHead</span></a></span></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTyVar"><span class="hs-identifier hs-type">HsTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">XTyVar GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PromotionFlag
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683077172"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077172"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1577"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM (Type, Type)
</span><a href="GHC.Tc.Gen.HsType.html#tcTyVar"><span class="hs-identifier hs-var">tcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077172"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1578"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcInferTyAppHead"><span class="hs-identifier hs-var">tcInferTyAppHead</span></a></span><span> </span><span id="local-6989586621683077174"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077174"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621683077175"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077175"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1579"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyMode -&gt; LHsType GhcRn -&gt; TcM (Type, Type)
</span><a href="GHC.Tc.Gen.HsType.html#tc_infer_lhs_type"><span class="hs-identifier hs-var">tc_infer_lhs_type</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077174"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077175"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1580"></span><span>
</span><span id="line-1581"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tc_app_ty"><span class="hs-identifier hs-type">tc_app_ty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsType"><span class="hs-identifier hs-type">HsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpKind"><span class="hs-identifier hs-type">ExpKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-1582"></span><span id="tc_app_ty"><span class="annot"><span class="annottext">tc_app_ty :: TcTyMode -&gt; HsType GhcRn -&gt; ExpSigmaType -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_app_ty"><span class="hs-identifier hs-var hs-var">tc_app_ty</span></a></span></span><span> </span><span id="local-6989586621683077176"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077176"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621683077177"><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683077177"><span class="hs-identifier hs-var">rn_ty</span></a></span></span><span> </span><span id="local-6989586621683077178"><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621683077178"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span>
</span><span id="line-1583"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077179"><span class="annot"><a href="#local-6989586621683077179"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077180"><span class="annot"><a href="#local-6989586621683077180"><span class="hs-identifier hs-var">_ki</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcTyMode -&gt; LHsType GhcRn -&gt; TcM (Type, Type)
</span><a href="GHC.Tc.Gen.HsType.html#tcInferTyAppHead"><span class="hs-identifier hs-var">tcInferTyAppHead</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077176"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077181"><span class="hs-identifier hs-var">hs_fun_ty</span></a></span><span>
</span><span id="line-1584"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077182"><span class="annot"><a href="#local-6989586621683077182"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077183"><span class="annot"><a href="#local-6989586621683077183"><span class="hs-identifier hs-var">infered_kind</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcInferTyApps"><span class="hs-identifier hs-type">tcInferTyApps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077176"><span class="hs-identifier hs-type">mode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077181"><span class="hs-identifier hs-type">hs_fun_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077179"><span class="hs-identifier hs-type">fun_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077184"><span class="hs-identifier hs-type">hs_args</span></a></span><span>
</span><span id="line-1585"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#checkExpKind"><span class="hs-identifier hs-type">checkExpKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077177"><span class="hs-identifier hs-type">rn_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077182"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077183"><span class="hs-identifier hs-type">infered_kind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077178"><span class="hs-identifier hs-type">exp_kind</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1586"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1587"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683077181"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077181"><span class="hs-identifier hs-var">hs_fun_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077184"><span class="annot"><span class="annottext">HsFamEqnPats GhcRn
</span><a href="#local-6989586621683077184"><span class="hs-identifier hs-var">hs_args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsType GhcRn -&gt; (LHsType GhcRn, HsFamEqnPats GhcRn)
</span><a href="GHC.Tc.Gen.HsType.html#splitHsAppTys"><span class="hs-identifier hs-var">splitHsAppTys</span></a></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683077177"><span class="hs-identifier hs-var">rn_ty</span></a></span><span>
</span><span id="line-1588"></span><span>
</span><span id="line-1589"></span><span class="hs-comment">---------------------------</span><span>
</span><span id="line-1590"></span><span class="hs-comment">-- | Apply a type of a given kind to a list of arguments. This instantiates</span><span>
</span><span id="line-1591"></span><span class="hs-comment">-- invisible parameters as necessary. Always consumes all the arguments,</span><span>
</span><span id="line-1592"></span><span class="hs-comment">-- using matchExpectedFunKind as necessary.</span><span>
</span><span id="line-1593"></span><span class="hs-comment">-- This takes an optional @VarEnv Kind@ which maps kind variables to kinds.-</span><span>
</span><span id="line-1594"></span><span class="hs-comment">-- These kinds should be used to instantiate invisible kind variables;</span><span>
</span><span id="line-1595"></span><span class="hs-comment">-- they come from an enclosing class for an associated type/data family.</span><span>
</span><span id="line-1596"></span><span class="hs-comment">--</span><span>
</span><span id="line-1597"></span><span class="hs-comment">-- tcInferTyApps also arranges to saturate any trailing invisible arguments</span><span>
</span><span id="line-1598"></span><span class="hs-comment">--   of a type-family application, which is usually the right thing to do</span><span>
</span><span id="line-1599"></span><span class="hs-comment">-- tcInferTyApps_nosat does not do this saturation; it is used only</span><span>
</span><span id="line-1600"></span><span class="hs-comment">--   by &quot;:kind&quot; in GHCi</span><span>
</span><span id="line-1601"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcInferTyApps"><span class="hs-identifier hs-type">tcInferTyApps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcInferTyApps_nosat"><span class="hs-identifier hs-type">tcInferTyApps_nosat</span></a></span><span>
</span><span id="line-1602"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a></span><span>
</span><span id="line-1603"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ Function (for printing only)</span></span><span>
</span><span id="line-1604"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>               </span><span class="annot"><span class="hs-comment">-- ^ Function</span></span><span>
</span><span id="line-1605"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsTypeArg"><span class="hs-identifier hs-type">LHsTypeArg</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>   </span><span class="annot"><span class="hs-comment">-- ^ Args</span></span><span>
</span><span id="line-1606"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ (f args, result kind)</span></span><span>
</span><span id="line-1607"></span><span id="tcInferTyApps"><span class="annot"><span class="annottext">tcInferTyApps :: TcTyMode
-&gt; LHsType GhcRn -&gt; Type -&gt; HsFamEqnPats GhcRn -&gt; TcM (Type, Type)
</span><a href="GHC.Tc.Gen.HsType.html#tcInferTyApps"><span class="hs-identifier hs-var hs-var">tcInferTyApps</span></a></span></span><span> </span><span id="local-6989586621683077185"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077185"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621683077186"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077186"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span> </span><span id="local-6989586621683077187"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077187"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621683077188"><span class="annot"><span class="annottext">HsFamEqnPats GhcRn
</span><a href="#local-6989586621683077188"><span class="hs-identifier hs-var">hs_args</span></a></span></span><span>
</span><span id="line-1608"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077189"><span class="annot"><a href="#local-6989586621683077189"><span class="hs-identifier hs-var">f_args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077190"><span class="annot"><a href="#local-6989586621683077190"><span class="hs-identifier hs-var">res_k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcTyMode
-&gt; LHsType GhcRn -&gt; Type -&gt; HsFamEqnPats GhcRn -&gt; TcM (Type, Type)
</span><a href="GHC.Tc.Gen.HsType.html#tcInferTyApps_nosat"><span class="hs-identifier hs-var">tcInferTyApps_nosat</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077185"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077186"><span class="hs-identifier hs-var">hs_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077187"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">HsFamEqnPats GhcRn
</span><a href="#local-6989586621683077188"><span class="hs-identifier hs-var">hs_args</span></a></span><span>
</span><span id="line-1609"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#saturateFamApp"><span class="hs-identifier hs-type">saturateFamApp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077189"><span class="hs-identifier hs-type">f_args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077190"><span class="hs-identifier hs-type">res_k</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1610"></span><span>
</span><span id="line-1611"></span><span id="tcInferTyApps_nosat"><span class="annot"><span class="annottext">tcInferTyApps_nosat :: TcTyMode
-&gt; LHsType GhcRn -&gt; Type -&gt; HsFamEqnPats GhcRn -&gt; TcM (Type, Type)
</span><a href="GHC.Tc.Gen.HsType.html#tcInferTyApps_nosat"><span class="hs-identifier hs-var hs-var">tcInferTyApps_nosat</span></a></span></span><span> </span><span id="local-6989586621683077192"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077192"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621683077193"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077193"><span class="hs-identifier hs-var">orig_hs_ty</span></a></span></span><span> </span><span id="local-6989586621683077194"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077194"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621683077195"><span class="annot"><span class="annottext">HsFamEqnPats GhcRn
</span><a href="#local-6989586621683077195"><span class="hs-identifier hs-var">orig_hs_args</span></a></span></span><span>
</span><span id="line-1612"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcInferTyApps {&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcRn) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621683077193"><span class="hs-identifier hs-var">orig_hs_ty</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[HsArg
   GhcRn
   (GenLocated SrcSpanAnnA (HsType GhcRn))
   (GenLocated SrcSpanAnnA (HsType GhcRn))]
-&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsFamEqnPats GhcRn
[HsArg
   GhcRn
   (GenLocated SrcSpanAnnA (HsType GhcRn))
   (GenLocated SrcSpanAnnA (HsType GhcRn))]
</span><a href="#local-6989586621683077195"><span class="hs-identifier hs-var">orig_hs_args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1613"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077196"><span class="annot"><a href="#local-6989586621683077196"><span class="hs-identifier hs-var">f_args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077197"><span class="annot"><a href="#local-6989586621683077197"><span class="hs-identifier hs-var">res_k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Type
-&gt; [HsArg
      GhcRn
      (GenLocated SrcSpanAnnA (HsType GhcRn))
      (GenLocated SrcSpanAnnA (HsType GhcRn))]
-&gt; TcM (Type, Type)
</span><a href="#local-6989586621683077198"><span class="hs-identifier hs-var">go_init</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077194"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">HsFamEqnPats GhcRn
[HsArg
   GhcRn
   (GenLocated SrcSpanAnnA (HsType GhcRn))
   (GenLocated SrcSpanAnnA (HsType GhcRn))]
</span><a href="#local-6989586621683077195"><span class="hs-identifier hs-var">orig_hs_args</span></a></span><span>
</span><span id="line-1614"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcInferTyApps }&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077196"><span class="hs-identifier hs-type">f_args</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-type">dcolon</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077197"><span class="hs-identifier hs-type">res_k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1615"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683077196"><span class="hs-identifier hs-type">f_args</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683077197"><span class="hs-identifier hs-type">res_k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1616"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1617"></span><span>
</span><span id="line-1618"></span><span>    </span><span class="hs-comment">-- go_init just initialises the auxiliary</span><span>
</span><span id="line-1619"></span><span>    </span><span class="hs-comment">-- arguments of the 'go' loop</span><span>
</span><span id="line-1620"></span><span>    </span><span id="local-6989586621683077198"><span class="annot"><span class="annottext">go_init :: Int
-&gt; Type
-&gt; [HsArg
      GhcRn
      (GenLocated SrcSpanAnnA (HsType GhcRn))
      (GenLocated SrcSpanAnnA (HsType GhcRn))]
-&gt; TcM (Type, Type)
</span><a href="#local-6989586621683077198"><span class="hs-identifier hs-var hs-var">go_init</span></a></span></span><span> </span><span id="local-6989586621683077199"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683077199"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621683077200"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077200"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621683077201"><span class="annot"><span class="annottext">[HsArg
   GhcRn
   (GenLocated SrcSpanAnnA (HsType GhcRn))
   (GenLocated SrcSpanAnnA (HsType GhcRn))]
</span><a href="#local-6989586621683077201"><span class="hs-identifier hs-var">all_args</span></a></span></span><span>
</span><span id="line-1621"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Type -&gt; Subst -&gt; Type -&gt; HsFamEqnPats GhcRn -&gt; TcM (Type, Type)
</span><a href="#local-6989586621683077202"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683077199"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077200"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077203"><span class="hs-identifier hs-var">empty_subst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077204"><span class="hs-identifier hs-var">fun_ki</span></a></span><span> </span><span class="annot"><span class="annottext">HsFamEqnPats GhcRn
[HsArg
   GhcRn
   (GenLocated SrcSpanAnnA (HsType GhcRn))
   (GenLocated SrcSpanAnnA (HsType GhcRn))]
</span><a href="#local-6989586621683077201"><span class="hs-identifier hs-var">all_args</span></a></span><span>
</span><span id="line-1622"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1623"></span><span>        </span><span id="local-6989586621683077204"><span class="annot"><span class="annottext">fun_ki :: Type
</span><a href="#local-6989586621683077204"><span class="hs-identifier hs-var hs-var">fun_ki</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077200"><span class="hs-identifier hs-var">fun</span></a></span><span>
</span><span id="line-1624"></span><span>           </span><span class="hs-comment">-- We do (typeKind fun) here, even though the caller</span><span>
</span><span id="line-1625"></span><span>           </span><span class="hs-comment">-- knows the function kind, to absolutely guarantee</span><span>
</span><span id="line-1626"></span><span>           </span><span class="hs-comment">-- INVARIANT for 'go'</span><span>
</span><span id="line-1627"></span><span>           </span><span class="hs-comment">-- Note that in a typical application (F t1 t2 t3),</span><span>
</span><span id="line-1628"></span><span>           </span><span class="hs-comment">-- the 'fun' is just a TyCon, so typeKind is fast</span><span>
</span><span id="line-1629"></span><span>
</span><span id="line-1630"></span><span>        </span><span id="local-6989586621683077203"><span class="annot"><span class="annottext">empty_subst :: Subst
</span><a href="#local-6989586621683077203"><span class="hs-identifier hs-var hs-var">empty_subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#mkEmptySubst"><span class="hs-identifier hs-var">mkEmptySubst</span></a></span><span> </span><span class="annot"><span class="annottext">(InScopeSet -&gt; Subst) -&gt; InScopeSet -&gt; Subst
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TyVarSet -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a></span><span> </span><span class="annot"><span class="annottext">(TyVarSet -&gt; InScopeSet) -&gt; TyVarSet -&gt; InScopeSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1631"></span><span>                      </span><span class="annot"><span class="annottext">Type -&gt; TyVarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077204"><span class="hs-identifier hs-var">fun_ki</span></a></span><span>
</span><span id="line-1632"></span><span>
</span><span id="line-1633"></span><span>    </span><span class="annot"><a href="#local-6989586621683077202"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>             </span><span class="hs-comment">-- The # of the next argument</span><span>
</span><span id="line-1634"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>          </span><span class="hs-comment">-- Function applied to some args</span><span>
</span><span id="line-1635"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span>        </span><span class="hs-comment">-- Applies to function kind</span><span>
</span><span id="line-1636"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span>          </span><span class="hs-comment">-- Function kind</span><span>
</span><span id="line-1637"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsTypeArg"><span class="hs-identifier hs-type">LHsTypeArg</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- Un-type-checked args</span><span>
</span><span id="line-1638"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Result type and its kind</span><span>
</span><span id="line-1639"></span><span>    </span><span class="hs-comment">-- INVARIANT: in any call (go n fun subst fun_ki args)</span><span>
</span><span id="line-1640"></span><span>    </span><span class="hs-comment">--               typeKind fun  =  subst(fun_ki)</span><span>
</span><span id="line-1641"></span><span>    </span><span class="hs-comment">-- So the 'subst' and 'fun_ki' arguments are simply</span><span>
</span><span id="line-1642"></span><span>    </span><span class="hs-comment">-- there to avoid repeatedly calling typeKind.</span><span>
</span><span id="line-1643"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1644"></span><span>    </span><span class="hs-comment">-- Reason for INVARIANT: to support the Purely Kinded Type Invariant</span><span>
</span><span id="line-1645"></span><span>    </span><span class="hs-comment">-- it's important that if fun_ki has a forall, then so does</span><span>
</span><span id="line-1646"></span><span>    </span><span class="hs-comment">-- (typeKind fun), because the next thing we are going to do</span><span>
</span><span id="line-1647"></span><span>    </span><span class="hs-comment">-- is apply 'fun' to an argument type.</span><span>
</span><span id="line-1648"></span><span>
</span><span id="line-1649"></span><span>    </span><span class="hs-comment">-- Dispatch on all_args first, for performance reasons</span><span>
</span><span id="line-1650"></span><span>    </span><span id="local-6989586621683077202"><span class="annot"><span class="annottext">go :: Int
-&gt; Type -&gt; Subst -&gt; Type -&gt; HsFamEqnPats GhcRn -&gt; TcM (Type, Type)
</span><a href="#local-6989586621683077202"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621683077208"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683077208"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621683077209"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077209"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621683077210"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077210"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621683077211"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077211"><span class="hs-identifier hs-var">fun_ki</span></a></span></span><span> </span><span id="local-6989586621683077212"><span class="annot"><span class="annottext">HsFamEqnPats GhcRn
</span><a href="#local-6989586621683077212"><span class="hs-identifier hs-var">all_args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsFamEqnPats GhcRn
[HsArg
   GhcRn
   (GenLocated SrcSpanAnnA (HsType GhcRn))
   (GenLocated SrcSpanAnnA (HsType GhcRn))]
</span><a href="#local-6989586621683077212"><span class="hs-identifier hs-var">all_args</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (PiTyVarBinder, Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitPiTy_maybe"><span class="hs-identifier hs-var">tcSplitPiTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077211"><span class="hs-identifier hs-var">fun_ki</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1651"></span><span>
</span><span id="line-1652"></span><span>      </span><span class="hs-comment">---------------- No user-written args left. We're done!</span><span>
</span><span id="line-1653"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (PiTyVarBinder, Type)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Type, Type) -&gt; TcM (Type, Type)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077209"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077210"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077211"><span class="hs-identifier hs-var">fun_ki</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1654"></span><span>
</span><span id="line-1655"></span><span>      </span><span class="hs-comment">---------------- HsArgPar: We don't care about parens here</span><span>
</span><span id="line-1656"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsArgPar"><span class="hs-identifier hs-type">HsArgPar</span></a></span><span> </span><span class="annot"><span class="annottext">XArgPar GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683077214"><span class="annot"><span class="annottext">[HsArg
   GhcRn
   (GenLocated SrcSpanAnnA (HsType GhcRn))
   (GenLocated SrcSpanAnnA (HsType GhcRn))]
</span><a href="#local-6989586621683077214"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (PiTyVarBinder, Type)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Type -&gt; Subst -&gt; Type -&gt; HsFamEqnPats GhcRn -&gt; TcM (Type, Type)
</span><a href="#local-6989586621683077202"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683077208"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077209"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077210"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077211"><span class="hs-identifier hs-var">fun_ki</span></a></span><span> </span><span class="annot"><span class="annottext">HsFamEqnPats GhcRn
[HsArg
   GhcRn
   (GenLocated SrcSpanAnnA (HsType GhcRn))
   (GenLocated SrcSpanAnnA (HsType GhcRn))]
</span><a href="#local-6989586621683077214"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1657"></span><span>
</span><span id="line-1658"></span><span>      </span><span class="hs-comment">---------------- HsTypeArg: a kind application (fun @ki)</span><span>
</span><span id="line-1659"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTypeArg"><span class="hs-identifier hs-type">HsTypeArg</span></a></span><span> </span><span class="annot"><span class="annottext">XTypeArg GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683077215"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621683077215"><span class="hs-identifier hs-var">hs_ki_arg</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683077216"><span class="annot"><span class="annottext">[HsArg
   GhcRn
   (GenLocated SrcSpanAnnA (HsType GhcRn))
   (GenLocated SrcSpanAnnA (HsType GhcRn))]
</span><a href="#local-6989586621683077216"><span class="hs-identifier hs-var">hs_args</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077217"><span class="annot"><span class="annottext">PiTyVarBinder
</span><a href="#local-6989586621683077217"><span class="hs-identifier hs-var">ki_binder</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077218"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077218"><span class="hs-identifier hs-var">inner_ki</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1660"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PiTyVarBinder
</span><a href="#local-6989586621683077217"><span class="hs-identifier hs-var">ki_binder</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1661"></span><span>
</span><span id="line-1662"></span><span>        </span><span class="hs-comment">-- FunTy with PredTy on LHS, or ForAllTy with Inferred</span><span>
</span><span id="line-1663"></span><span>        </span><span class="annot"><a href="GHC.Types.Var.html#Named"><span class="hs-identifier hs-type">Named</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span id="local-6989586621683077221"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077221"><span class="hs-identifier hs-var">kv</span></a></span></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="Language.Haskell.Syntax.Specificity.html#Inferred"><span class="hs-identifier hs-var">Inferred</span></a></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Type -&gt; TcM (Type, Type)
</span><a href="#local-6989586621683077223"><span class="hs-identifier hs-var">instantiate</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077221"><span class="hs-identifier hs-var">kv</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077218"><span class="hs-identifier hs-var">inner_ki</span></a></span><span>
</span><span id="line-1664"></span><span>
</span><span id="line-1665"></span><span>        </span><span class="annot"><a href="GHC.Types.Var.html#Named"><span class="hs-identifier hs-type">Named</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="Language.Haskell.Syntax.Specificity.html#Specified"><span class="hs-identifier hs-var">Specified</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-comment">-- Visible kind application</span><span>
</span><span id="line-1666"></span><span>          </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcInferTyApps (vis kind app)&quot;</span></span><span>
</span><span id="line-1667"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PiTyVarBinder -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">PiTyVarBinder
</span><a href="#local-6989586621683077217"><span class="hs-identifier hs-var">ki_binder</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcRn) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621683077215"><span class="hs-identifier hs-var">hs_ki_arg</span></a></span><span>
</span><span id="line-1668"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PiTyVarBinder -&gt; Type
</span><a href="GHC.Types.Var.html#piTyBinderType"><span class="hs-identifier hs-var">piTyBinderType</span></a></span><span> </span><span class="annot"><span class="annottext">PiTyVarBinder
</span><a href="#local-6989586621683077217"><span class="hs-identifier hs-var">ki_binder</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1669"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077210"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1670"></span><span>
</span><span id="line-1671"></span><span>             </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683077226"><span class="annot"><span class="annottext">exp_kind :: Type
</span><a href="#local-6989586621683077226"><span class="hs-identifier hs-var hs-var hs-var">exp_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077210"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; Type -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PiTyVarBinder -&gt; Type
</span><a href="GHC.Types.Var.html#piTyBinderType"><span class="hs-identifier hs-var">piTyBinderType</span></a></span><span> </span><span class="annot"><span class="annottext">PiTyVarBinder
</span><a href="#local-6989586621683077217"><span class="hs-identifier hs-var">ki_binder</span></a></span><span>
</span><span id="line-1672"></span><span>             </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683077227"><span class="annot"><a href="#local-6989586621683077227"><span class="hs-identifier hs-var">arg_mode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeOrKind -&gt; HoleMode -&gt; TcM TcTyMode
</span><a href="GHC.Tc.Gen.HsType.html#mkHoleMode"><span class="hs-identifier hs-var">mkHoleMode</span></a></span><span> </span><span class="annot"><span class="annottext">TypeOrKind
</span><a href="GHC.Types.Basic.html#KindLevel"><span class="hs-identifier hs-var">KindLevel</span></a></span><span> </span><span class="annot"><span class="annottext">HoleMode
</span><a href="GHC.Tc.Gen.HsType.html#HM_VTA"><span class="hs-identifier hs-var">HM_VTA</span></a></span><span>
</span><span id="line-1673"></span><span>                   </span><span class="hs-comment">-- HM_VKA: see Note [Wildcards in visible kind application]</span><span>
</span><span id="line-1674"></span><span>             </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683077228"><span class="annot"><a href="#local-6989586621683077228"><span class="hs-identifier hs-var">ki_arg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-type">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#funAppCtxt"><span class="hs-identifier hs-type">funAppCtxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077193"><span class="hs-identifier hs-type">orig_hs_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077215"><span class="hs-identifier hs-type">hs_ki_arg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077208"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1675"></span><span>                         </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tc_check_lhs_type"><span class="hs-identifier hs-type">tc_check_lhs_type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077227"><span class="hs-identifier hs-type">arg_mode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077215"><span class="hs-identifier hs-type">hs_ki_arg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077226"><span class="hs-identifier hs-type">exp_kind</span></a></span><span>
</span><span id="line-1676"></span><span>
</span><span id="line-1677"></span><span>             </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcInferTyApps (vis kind app)&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077226"><span class="hs-identifier hs-type">exp_kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1678"></span><span>             </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077229"><span class="annot"><a href="#local-6989586621683077229"><span class="hs-identifier hs-var">subst'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077230"><span class="annot"><a href="#local-6989586621683077230"><span class="hs-identifier hs-var">fun'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#mkAppTyM"><span class="hs-identifier hs-type">mkAppTyM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077210"><span class="hs-identifier hs-type">subst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077209"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077217"><span class="hs-identifier hs-type">ki_binder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077228"><span class="hs-identifier hs-type">ki_arg</span></a></span><span>
</span><span id="line-1679"></span><span>             </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="#local-6989586621683077202"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683077208"><span class="hs-identifier hs-type">n</span></a></span><span class="annot"><span class="hs-operator hs-type">+</span></span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683077230"><span class="hs-identifier hs-type">fun'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077229"><span class="hs-identifier hs-type">subst'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077218"><span class="hs-identifier hs-type">inner_ki</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077216"><span class="hs-identifier hs-type">hs_args</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1680"></span><span>
</span><span id="line-1681"></span><span>        </span><span class="hs-comment">-- Attempted visible kind application (fun @ki), but fun_ki is</span><span>
</span><span id="line-1682"></span><span>        </span><span class="hs-comment">--   forall k -&gt; blah   or   k1 -&gt; k2</span><span>
</span><span id="line-1683"></span><span>        </span><span class="hs-comment">-- So we need a normal application.  Error.</span><span>
</span><span id="line-1684"></span><span>        </span><span class="annot"><span class="annottext">PiTyVarBinder
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcRn) -&gt; Type -&gt; TcM (Type, Type)
forall {a}. GenLocated SrcSpanAnnA (HsType GhcRn) -&gt; Type -&gt; TcRn a
</span><a href="#local-6989586621683077233"><span class="hs-identifier hs-var">ty_app_err</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621683077215"><span class="hs-identifier hs-var">hs_ki_arg</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TcM (Type, Type)) -&gt; Type -&gt; TcM (Type, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077210"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077211"><span class="hs-identifier hs-var">fun_ki</span></a></span><span>
</span><span id="line-1685"></span><span>
</span><span id="line-1686"></span><span>      </span><span class="hs-comment">-- No binder; try applying the substitution, or fail if that's not possible</span><span>
</span><span id="line-1687"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTypeArg"><span class="hs-identifier hs-type">HsTypeArg</span></a></span><span> </span><span class="annot"><span class="annottext">XTypeArg GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683077234"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621683077234"><span class="hs-identifier hs-var">ki_arg</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[HsArg
   GhcRn
   (GenLocated SrcSpanAnnA (HsType GhcRn))
   (GenLocated SrcSpanAnnA (HsType GhcRn))]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (PiTyVarBinder, Type)
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (Type, Type) -&gt; TcM (Type, Type)
</span><a href="#local-6989586621683077235"><span class="hs-identifier hs-var">try_again_after_substing_or</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (Type, Type) -&gt; TcM (Type, Type))
-&gt; TcM (Type, Type) -&gt; TcM (Type, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1688"></span><span>                                           </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcRn) -&gt; Type -&gt; TcM (Type, Type)
forall {a}. GenLocated SrcSpanAnnA (HsType GhcRn) -&gt; Type -&gt; TcRn a
</span><a href="#local-6989586621683077233"><span class="hs-identifier hs-var">ty_app_err</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621683077234"><span class="hs-identifier hs-var">ki_arg</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077236"><span class="hs-identifier hs-var">substed_fun_ki</span></a></span><span>
</span><span id="line-1689"></span><span>
</span><span id="line-1690"></span><span>      </span><span class="hs-comment">---------------- HsValArg: a normal argument (fun ty)</span><span>
</span><span id="line-1691"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsValArg"><span class="hs-identifier hs-type">HsValArg</span></a></span><span> </span><span class="annot"><span class="annottext">XValArg GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683077237"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621683077237"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683077238"><span class="annot"><span class="annottext">[HsArg
   GhcRn
   (GenLocated SrcSpanAnnA (HsType GhcRn))
   (GenLocated SrcSpanAnnA (HsType GhcRn))]
</span><a href="#local-6989586621683077238"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077239"><span class="annot"><span class="annottext">PiTyVarBinder
</span><a href="#local-6989586621683077239"><span class="hs-identifier hs-var">ki_binder</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077240"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077240"><span class="hs-identifier hs-var">inner_ki</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1692"></span><span>        </span><span class="hs-comment">-- next binder is invisible; need to instantiate it</span><span>
</span><span id="line-1693"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Named"><span class="hs-identifier hs-type">Named</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span id="local-6989586621683077241"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077241"><span class="hs-identifier hs-var">kv</span></a></span></span><span> </span><span id="local-6989586621683077242"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621683077242"><span class="hs-identifier hs-var">flag</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PiTyVarBinder
</span><a href="#local-6989586621683077239"><span class="hs-identifier hs-var">ki_binder</span></a></span><span>
</span><span id="line-1694"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag -&gt; Bool
</span><a href="Language.Haskell.Syntax.Specificity.html#isInvisibleForAllTyFlag"><span class="hs-identifier hs-var">isInvisibleForAllTyFlag</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621683077242"><span class="hs-identifier hs-var">flag</span></a></span><span>   </span><span class="hs-comment">-- ForAllTy with Inferred or Specified</span><span>
</span><span id="line-1695"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Type -&gt; TcM (Type, Type)
</span><a href="#local-6989586621683077223"><span class="hs-identifier hs-var">instantiate</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077241"><span class="hs-identifier hs-var">kv</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077240"><span class="hs-identifier hs-var">inner_ki</span></a></span><span>
</span><span id="line-1696"></span><span>
</span><span id="line-1697"></span><span>        </span><span class="hs-comment">-- &quot;normal&quot; case</span><span>
</span><span id="line-1698"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1699"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcInferTyApps (vis normal app)&quot;</span></span><span>
</span><span id="line-1700"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PiTyVarBinder -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">PiTyVarBinder
</span><a href="#local-6989586621683077239"><span class="hs-identifier hs-var">ki_binder</span></a></span><span>
</span><span id="line-1701"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcRn) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621683077237"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-1702"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PiTyVarBinder -&gt; Type
</span><a href="GHC.Types.Var.html#piTyBinderType"><span class="hs-identifier hs-var">piTyBinderType</span></a></span><span> </span><span class="annot"><span class="annottext">PiTyVarBinder
</span><a href="#local-6989586621683077239"><span class="hs-identifier hs-var">ki_binder</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1703"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077210"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1704"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683077244"><span class="annot"><span class="annottext">exp_kind :: Type
</span><a href="#local-6989586621683077244"><span class="hs-identifier hs-var hs-var hs-var">exp_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077210"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; Type -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PiTyVarBinder -&gt; Type
</span><a href="GHC.Types.Var.html#piTyBinderType"><span class="hs-identifier hs-var">piTyBinderType</span></a></span><span> </span><span class="annot"><span class="annottext">PiTyVarBinder
</span><a href="#local-6989586621683077239"><span class="hs-identifier hs-var">ki_binder</span></a></span><span>
</span><span id="line-1705"></span><span>                </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683077245"><span class="annot"><a href="#local-6989586621683077245"><span class="hs-identifier hs-var">arg'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcM Type -&gt; TcM Type
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcRn)
-&gt; GenLocated SrcSpanAnnA (HsType GhcRn) -&gt; Int -&gt; SDoc
forall fun arg.
(Outputable fun, Outputable arg) =&gt;
fun -&gt; arg -&gt; Int -&gt; SDoc
</span><a href="GHC.Tc.Gen.HsType.html#funAppCtxt"><span class="hs-identifier hs-var">funAppCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621683077193"><span class="hs-identifier hs-var">orig_hs_ty</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621683077237"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683077208"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM Type -&gt; TcM Type) -&gt; TcM Type -&gt; TcM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1706"></span><span>                          </span><span class="annot"><span class="annottext">TcTyMode -&gt; LHsType GhcRn -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_check_lhs_type"><span class="hs-identifier hs-var">tc_check_lhs_type</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077192"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621683077237"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077244"><span class="hs-identifier hs-var">exp_kind</span></a></span><span>
</span><span id="line-1707"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcInferTyApps (vis normal app) 2&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077244"><span class="hs-identifier hs-type">exp_kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1708"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077246"><span class="annot"><a href="#local-6989586621683077246"><span class="hs-identifier hs-var">subst'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077247"><span class="annot"><a href="#local-6989586621683077247"><span class="hs-identifier hs-var">fun'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#mkAppTyM"><span class="hs-identifier hs-type">mkAppTyM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077210"><span class="hs-identifier hs-type">subst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077209"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077239"><span class="hs-identifier hs-type">ki_binder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077245"><span class="hs-identifier hs-type">arg'</span></a></span><span>
</span><span id="line-1709"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="#local-6989586621683077202"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683077208"><span class="hs-identifier hs-type">n</span></a></span><span class="annot"><span class="hs-operator hs-type">+</span></span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683077247"><span class="hs-identifier hs-type">fun'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077246"><span class="hs-identifier hs-type">subst'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077240"><span class="hs-identifier hs-type">inner_ki</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077238"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1710"></span><span>
</span><span id="line-1711"></span><span>          </span><span class="hs-comment">-- no binder; try applying the substitution, or infer another arrow in fun kind</span><span>
</span><span id="line-1712"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsValArg"><span class="hs-identifier hs-type">HsValArg</span></a></span><span> </span><span class="annot"><span class="annottext">XValArg GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcRn)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[HsArg
   GhcRn
   (GenLocated SrcSpanAnnA (HsType GhcRn))
   (GenLocated SrcSpanAnnA (HsType GhcRn))]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (PiTyVarBinder, Type)
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-1713"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (Type, Type) -&gt; TcM (Type, Type)
</span><a href="#local-6989586621683077235"><span class="hs-identifier hs-var">try_again_after_substing_or</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (Type, Type) -&gt; TcM (Type, Type))
-&gt; TcM (Type, Type) -&gt; TcM (Type, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1714"></span><span>           </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683077248"><span class="annot"><span class="annottext">arrows_needed :: Int
</span><a href="#local-6989586621683077248"><span class="hs-identifier hs-var hs-var hs-var">arrows_needed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[HsArg
   GhcRn
   (GenLocated SrcSpanAnnA (HsType GhcRn))
   (GenLocated SrcSpanAnnA (HsType GhcRn))]
-&gt; Int
forall p tm ty. [HsArg p tm ty] -&gt; Int
</span><a href="#local-6989586621683077249"><span class="hs-identifier hs-var">n_initial_val_args</span></a></span><span> </span><span class="annot"><span class="annottext">HsFamEqnPats GhcRn
[HsArg
   GhcRn
   (GenLocated SrcSpanAnnA (HsType GhcRn))
   (GenLocated SrcSpanAnnA (HsType GhcRn))]
</span><a href="#local-6989586621683077212"><span class="hs-identifier hs-var">all_args</span></a></span><span>
</span><span id="line-1715"></span><span>              </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683077250"><span class="annot"><a href="#local-6989586621683077250"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypedThing -&gt; Int -&gt; Type -&gt; TcM Coercion
</span><a href="GHC.Tc.Utils.Unify.html#matchExpectedFunKind"><span class="hs-identifier hs-var">matchExpectedFunKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsType GhcRn -&gt; TypedThing
</span><a href="GHC.Tc.Types.Origin.html#HsTypeRnThing"><span class="hs-identifier hs-var">HsTypeRnThing</span></a></span><span> </span><span class="annot"><span class="annottext">(HsType GhcRn -&gt; TypedThing) -&gt; HsType GhcRn -&gt; TypedThing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcRn) -&gt; HsType GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621683077253"><span class="hs-identifier hs-var">hs_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683077248"><span class="hs-identifier hs-var">arrows_needed</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077236"><span class="hs-identifier hs-var">substed_fun_ki</span></a></span><span>
</span><span id="line-1716"></span><span>
</span><span id="line-1717"></span><span>              </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683077254"><span class="annot"><a href="#local-6989586621683077254"><span class="hs-identifier hs-var">fun'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-type">liftZonkM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-type">zonkTcType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683077209"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Type.html#mkCastTy"><span class="hs-operator hs-type">`mkCastTy`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077250"><span class="hs-identifier hs-type">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1718"></span><span>                     </span><span class="hs-comment">-- This zonk is essential, to expose the fruits</span><span>
</span><span id="line-1719"></span><span>                     </span><span class="hs-comment">-- of matchExpectedFunKind to the 'go' loop</span><span>
</span><span id="line-1720"></span><span>
</span><span id="line-1721"></span><span>              </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcInferTyApps (no binder)&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1722"></span><span>                   </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077209"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-type">dcolon</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077211"><span class="hs-identifier hs-type">fun_ki</span></a></span><span>
</span><span id="line-1723"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077248"><span class="hs-identifier hs-type">arrows_needed</span></a></span><span>
</span><span id="line-1724"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077250"><span class="hs-identifier hs-type">co</span></a></span><span>
</span><span id="line-1725"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077254"><span class="hs-identifier hs-type">fun'</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-type">dcolon</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-type">typeKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077254"><span class="hs-identifier hs-type">fun'</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1726"></span><span>              </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="#local-6989586621683077198"><span class="hs-identifier hs-type">go_init</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077208"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077254"><span class="hs-identifier hs-type">fun'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077212"><span class="hs-identifier hs-type">all_args</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1727"></span><span>                </span><span class="hs-comment">-- Use go_init to establish go's INVARIANT</span><span>
</span><span id="line-1728"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1729"></span><span>        </span><span id="local-6989586621683077223"><span class="annot"><span class="annottext">instantiate :: TcTyVar -&gt; Type -&gt; TcM (Type, Type)
</span><a href="#local-6989586621683077223"><span class="hs-identifier hs-var hs-var">instantiate</span></a></span></span><span> </span><span id="local-6989586621683077256"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077256"><span class="hs-identifier hs-var">ki_binder</span></a></span></span><span> </span><span id="local-6989586621683077257"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077257"><span class="hs-identifier hs-var">inner_ki</span></a></span></span><span>
</span><span id="line-1730"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcInferTyApps (need to instantiate)&quot;</span></span><span>
</span><span id="line-1731"></span><span>                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077256"><span class="hs-identifier hs-var">ki_binder</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077210"><span class="hs-identifier hs-var">subst</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1732"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077258"><span class="annot"><a href="#local-6989586621683077258"><span class="hs-identifier hs-var">subst'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077259"><span class="annot"><a href="#local-6989586621683077259"><span class="hs-identifier hs-var">arg'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; TcTyVar -&gt; TcM (Subst, Type)
</span><a href="GHC.Tc.Utils.Instantiate.html#tcInstInvisibleTyBinder"><span class="hs-identifier hs-var">tcInstInvisibleTyBinder</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077210"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077256"><span class="hs-identifier hs-var">ki_binder</span></a></span><span>
</span><span id="line-1733"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="#local-6989586621683077202"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077208"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#mkAppTy"><span class="hs-identifier hs-type">mkAppTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077209"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077259"><span class="hs-identifier hs-type">arg'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683077258"><span class="hs-identifier hs-type">subst'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077257"><span class="hs-identifier hs-type">inner_ki</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077212"><span class="hs-identifier hs-type">all_args</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1734"></span><span>                 </span><span class="hs-comment">-- Because tcInvisibleTyBinder instantiate ki_binder,</span><span>
</span><span id="line-1735"></span><span>                 </span><span class="hs-comment">-- the kind of arg' will have the same shape as the kind</span><span>
</span><span id="line-1736"></span><span>                 </span><span class="hs-comment">-- of ki_binder.  So we don't need mkAppTyM here.</span><span>
</span><span id="line-1737"></span><span>
</span><span id="line-1738"></span><span>        </span><span id="local-6989586621683077235"><span class="annot"><span class="annottext">try_again_after_substing_or :: TcM (Type, Type) -&gt; TcM (Type, Type)
</span><a href="#local-6989586621683077235"><span class="hs-identifier hs-var hs-var">try_again_after_substing_or</span></a></span></span><span> </span><span id="local-6989586621683077261"><span class="annot"><span class="annottext">TcM (Type, Type)
</span><a href="#local-6989586621683077261"><span class="hs-identifier hs-var">fallthrough</span></a></span></span><span>
</span><span id="line-1739"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst -&gt; Bool
</span><a href="GHC.Core.TyCo.Subst.html#isEmptyTCvSubst"><span class="hs-identifier hs-var">isEmptyTCvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077210"><span class="hs-identifier hs-var">subst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1740"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Type -&gt; Subst -&gt; Type -&gt; HsFamEqnPats GhcRn -&gt; TcM (Type, Type)
</span><a href="#local-6989586621683077202"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683077208"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077209"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077263"><span class="hs-identifier hs-var">zapped_subst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077236"><span class="hs-identifier hs-var">substed_fun_ki</span></a></span><span> </span><span class="annot"><span class="annottext">HsFamEqnPats GhcRn
</span><a href="#local-6989586621683077212"><span class="hs-identifier hs-var">all_args</span></a></span><span>
</span><span id="line-1741"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1742"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM (Type, Type)
</span><a href="#local-6989586621683077261"><span class="hs-identifier hs-var">fallthrough</span></a></span><span>
</span><span id="line-1743"></span><span>
</span><span id="line-1744"></span><span>        </span><span id="local-6989586621683077263"><span class="annot"><span class="annottext">zapped_subst :: Subst
</span><a href="#local-6989586621683077263"><span class="hs-identifier hs-var hs-var">zapped_subst</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#zapSubst"><span class="hs-identifier hs-var">zapSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077210"><span class="hs-identifier hs-var">subst</span></a></span><span>
</span><span id="line-1745"></span><span>        </span><span id="local-6989586621683077236"><span class="annot"><span class="annottext">substed_fun_ki :: Type
</span><a href="#local-6989586621683077236"><span class="hs-identifier hs-var hs-var">substed_fun_ki</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077210"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077211"><span class="hs-identifier hs-var">fun_ki</span></a></span><span>
</span><span id="line-1746"></span><span>        </span><span id="local-6989586621683077253"><span class="annot"><span class="annottext">hs_ty :: LHsType GhcRn
</span><a href="#local-6989586621683077253"><span class="hs-identifier hs-var hs-var">hs_ty</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; HsFamEqnPats GhcRn -&gt; LHsType GhcRn
</span><a href="GHC.Tc.Gen.HsType.html#appTypeToArg"><span class="hs-identifier hs-var">appTypeToArg</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077193"><span class="hs-identifier hs-var">orig_hs_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
-&gt; [HsArg
      GhcRn
      (GenLocated SrcSpanAnnA (HsType GhcRn))
      (GenLocated SrcSpanAnnA (HsType GhcRn))]
-&gt; [HsArg
      GhcRn
      (GenLocated SrcSpanAnnA (HsType GhcRn))
      (GenLocated SrcSpanAnnA (HsType GhcRn))]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683077208"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsFamEqnPats GhcRn
[HsArg
   GhcRn
   (GenLocated SrcSpanAnnA (HsType GhcRn))
   (GenLocated SrcSpanAnnA (HsType GhcRn))]
</span><a href="#local-6989586621683077195"><span class="hs-identifier hs-var">orig_hs_args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1747"></span><span>
</span><span id="line-1748"></span><span>    </span><span id="local-6989586621683075273"><span id="local-6989586621683075274"><span id="local-6989586621683075275"><span class="annot"><a href="#local-6989586621683077249"><span class="hs-identifier hs-type">n_initial_val_args</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsArg"><span class="hs-identifier hs-type">HsArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075273"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075274"><span class="hs-identifier hs-type">tm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075275"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span></span></span></span><span>
</span><span id="line-1749"></span><span>    </span><span class="hs-comment">-- Count how many leading HsValArgs we have</span><span>
</span><span id="line-1750"></span><span>    </span><span id="local-6989586621683077249"><span class="annot"><span class="annottext">n_initial_val_args :: forall p tm ty. [HsArg p tm ty] -&gt; Int
</span><a href="#local-6989586621683077249"><span class="hs-identifier hs-var hs-var">n_initial_val_args</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsValArg"><span class="hs-identifier hs-type">HsValArg</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683077270"><span class="annot"><span class="annottext">[HsArg p tm ty]
</span><a href="#local-6989586621683077270"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">[HsArg p tm ty] -&gt; Int
forall p tm ty. [HsArg p tm ty] -&gt; Int
</span><a href="#local-6989586621683077249"><span class="hs-identifier hs-var">n_initial_val_args</span></a></span><span> </span><span class="annot"><span class="annottext">[HsArg p tm ty]
</span><a href="#local-6989586621683077270"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1751"></span><span>    </span><span class="annot"><a href="#local-6989586621683077249"><span class="hs-identifier hs-var">n_initial_val_args</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsArgPar"><span class="hs-identifier hs-type">HsArgPar</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683077271"><span class="annot"><span class="annottext">[HsArg p tm ty]
</span><a href="#local-6989586621683077271"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[HsArg p tm ty] -&gt; Int
forall p tm ty. [HsArg p tm ty] -&gt; Int
</span><a href="#local-6989586621683077249"><span class="hs-identifier hs-var">n_initial_val_args</span></a></span><span> </span><span class="annot"><span class="annottext">[HsArg p tm ty]
</span><a href="#local-6989586621683077271"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1752"></span><span>    </span><span class="annot"><a href="#local-6989586621683077249"><span class="hs-identifier hs-var">n_initial_val_args</span></a></span><span> </span><span class="annot"><span class="annottext">[HsArg p tm ty]
</span><span class="hs-identifier">_</span></span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1753"></span><span>
</span><span id="line-1754"></span><span>    </span><span id="local-6989586621683077233"><span class="annot"><span class="annottext">ty_app_err :: GenLocated SrcSpanAnnA (HsType GhcRn) -&gt; Type -&gt; TcRn a
</span><a href="#local-6989586621683077233"><span class="hs-identifier hs-var hs-var">ty_app_err</span></a></span></span><span> </span><span id="local-6989586621683077272"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621683077272"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span id="local-6989586621683077273"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077273"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1755"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcRn a
forall a. TcRnMessage -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWith"><span class="hs-identifier hs-var">failWith</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; TcRn a) -&gt; TcRnMessage -&gt; TcRn a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; Type -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnInvalidVisibleKindArgument"><span class="hs-identifier hs-var">TcRnInvalidVisibleKindArgument</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621683077272"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077273"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1756"></span><span>
</span><span id="line-1757"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#mkAppTyM"><span class="hs-identifier hs-type">mkAppTyM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span>
</span><span id="line-1758"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#PiTyBinder"><span class="hs-identifier hs-type">PiTyBinder</span></a></span><span>    </span><span class="hs-comment">-- fun, plus its top-level binder</span><span>
</span><span id="line-1759"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>                  </span><span class="hs-comment">-- arg</span><span>
</span><span id="line-1760"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Extended subst, plus (fun arg)</span><span>
</span><span id="line-1761"></span><span class="hs-comment">-- Precondition: the application (fun arg) is well-kinded after zonking</span><span>
</span><span id="line-1762"></span><span class="hs-comment">--               That is, the application makes sense</span><span>
</span><span id="line-1763"></span><span class="hs-comment">--</span><span>
</span><span id="line-1764"></span><span class="hs-comment">-- Precondition: for (mkAppTyM subst fun bndr arg)</span><span>
</span><span id="line-1765"></span><span class="hs-comment">--       typeKind fun  =  Pi bndr. body</span><span>
</span><span id="line-1766"></span><span class="hs-comment">--  That is, fun always has a ForAllTy or FunTy at the top</span><span>
</span><span id="line-1767"></span><span class="hs-comment">--           and 'bndr' is fun's pi-binder</span><span>
</span><span id="line-1768"></span><span class="hs-comment">--</span><span>
</span><span id="line-1769"></span><span class="hs-comment">-- Postcondition: if fun and arg satisfy (PKTI), the purely-kinded type</span><span>
</span><span id="line-1770"></span><span class="hs-comment">--                invariant, then so does the result type (fun arg)</span><span>
</span><span id="line-1771"></span><span class="hs-comment">--</span><span>
</span><span id="line-1772"></span><span class="hs-comment">-- We do not require that</span><span>
</span><span id="line-1773"></span><span class="hs-comment">--    typeKind arg = tyVarKind (binderVar bndr)</span><span>
</span><span id="line-1774"></span><span class="hs-comment">-- This must be true after zonking (precondition 1), but it's not</span><span>
</span><span id="line-1775"></span><span class="hs-comment">-- required for the (PKTI).</span><span>
</span><span id="line-1776"></span><span id="mkAppTyM"><span class="annot"><span class="annottext">mkAppTyM :: Subst -&gt; Type -&gt; PiTyVarBinder -&gt; Type -&gt; TcM (Subst, Type)
</span><a href="GHC.Tc.Gen.HsType.html#mkAppTyM"><span class="hs-identifier hs-var hs-var">mkAppTyM</span></a></span></span><span> </span><span id="local-6989586621683077276"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077276"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621683077277"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077277"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621683077278"><span class="annot"><span class="annottext">PiTyVarBinder
</span><a href="#local-6989586621683077278"><span class="hs-identifier hs-var">ki_binder</span></a></span></span><span> </span><span id="local-6989586621683077279"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077279"><span class="hs-identifier hs-var">arg</span></a></span></span><span>
</span><span id="line-1777"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- See Note [mkAppTyM]: Nasty case 2</span><span>
</span><span id="line-1778"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-type">TyConApp</span></a></span><span> </span><span id="local-6989586621683077281"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683077281"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621683077282"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683077282"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077277"><span class="hs-identifier hs-var">fun</span></a></span><span>
</span><span id="line-1779"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isTypeSynonymTyCon"><span class="hs-identifier hs-var">isTypeSynonymTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683077281"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1780"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683077282"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Int -&gt; Bool
forall a. [a] -&gt; Int -&gt; Bool
</span><a href="GHC.Utils.Misc.html#lengthIs"><span class="hs-operator hs-var">`lengthIs`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Int
</span><a href="GHC.Core.TyCon.html#tyConArity"><span class="hs-identifier hs-var">tyConArity</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683077281"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-1781"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(TcTyVar -&gt; Bool) -&gt; [TcTyVar] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="GHC.Tc.Gen.HsType.html#isTrickyTvBinder"><span class="hs-identifier hs-var">isTrickyTvBinder</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [TcTyVar]
</span><a href="GHC.Core.TyCon.html#tyConTyVars"><span class="hs-identifier hs-var">tyConTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683077281"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- We could cache this in the synonym</span><span>
</span><span id="line-1782"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077288"><span class="annot"><a href="#local-6989586621683077288"><span class="hs-identifier hs-var">arg'</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683077289"><span class="annot"><a href="#local-6989586621683077289"><span class="hs-identifier hs-var">args'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkM [Type] -&gt; TcM [Type]
forall a. ZonkM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-var">liftZonkM</span></a></span><span> </span><span class="annot"><span class="annottext">(ZonkM [Type] -&gt; TcM [Type]) -&gt; ZonkM [Type] -&gt; TcM [Type]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; ZonkM [Type]
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcTypes"><span class="hs-identifier hs-var">zonkTcTypes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077279"><span class="hs-identifier hs-var">arg</span></a></span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; [Type]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683077282"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1783"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683077291"><span class="annot"><a href="#local-6989586621683077291"><span class="hs-identifier hs-var hs-var">subst'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PiTyVarBinder
</span><a href="#local-6989586621683077278"><span class="hs-identifier hs-var">ki_binder</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1784"></span><span>                        </span><span class="annot"><a href="GHC.Types.Var.html#Anon"><span class="hs-identifier hs-type">Anon</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077276"><span class="hs-identifier hs-var">subst</span></a></span><span>
</span><span id="line-1785"></span><span>                        </span><span class="annot"><a href="GHC.Types.Var.html#Named"><span class="hs-identifier hs-type">Named</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span id="local-6989586621683077293"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077293"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; TcTyVar -&gt; Type -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#extendTvSubstAndInScope"><span class="hs-identifier hs-var">extendTvSubstAndInScope</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077276"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077293"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077288"><span class="hs-identifier hs-var">arg'</span></a></span><span>
</span><span id="line-1786"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683077291"><span class="hs-identifier hs-type">subst'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-type">mkTyConApp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077281"><span class="hs-identifier hs-type">tc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683077289"><span class="hs-identifier hs-type">args'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683077288"><span class="hs-identifier hs-type">arg'</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1787"></span><span>
</span><span id="line-1788"></span><span>
</span><span id="line-1789"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#mkAppTyM"><span class="hs-identifier hs-var">mkAppTyM</span></a></span><span> </span><span id="local-6989586621683077295"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077295"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621683077296"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077296"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Anon"><span class="hs-identifier hs-type">Anon</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683077297"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077297"><span class="hs-identifier hs-var">arg</span></a></span></span><span>
</span><span id="line-1790"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Subst, Type) -&gt; TcM (Subst, Type)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077295"><span class="hs-identifier hs-var">subst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.Tc.Gen.HsType.html#mk_app_ty"><span class="hs-identifier hs-var">mk_app_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077296"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077297"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1791"></span><span>
</span><span id="line-1792"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#mkAppTyM"><span class="hs-identifier hs-var">mkAppTyM</span></a></span><span> </span><span id="local-6989586621683077299"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077299"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621683077300"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077300"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Named"><span class="hs-identifier hs-type">Named</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span id="local-6989586621683077301"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077301"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683077302"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077302"><span class="hs-identifier hs-var">arg</span></a></span></span><span>
</span><span id="line-1793"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683077303"><span class="annot"><a href="#local-6989586621683077303"><span class="hs-identifier hs-var">arg'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="GHC.Tc.Gen.HsType.html#isTrickyTvBinder"><span class="hs-identifier hs-var">isTrickyTvBinder</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077301"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1794"></span><span>                 </span><span class="hs-keyword">then</span><span> </span><span class="hs-comment">-- See Note [mkAppTyM]: Nasty case 1</span><span>
</span><span id="line-1795"></span><span>                      </span><span class="annot"><span class="annottext">ZonkM Type -&gt; TcM Type
forall a. ZonkM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-var">liftZonkM</span></a></span><span> </span><span class="annot"><span class="annottext">(ZonkM Type -&gt; TcM Type) -&gt; ZonkM Type -&gt; TcM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; ZonkM Type
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077302"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-1796"></span><span>                 </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>     </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077302"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-1797"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#extendTvSubstAndInScope"><span class="hs-identifier hs-type">extendTvSubstAndInScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077299"><span class="hs-identifier hs-type">subst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077301"><span class="hs-identifier hs-type">tv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077303"><span class="hs-identifier hs-type">arg'</span></a></span><span>
</span><span id="line-1798"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#mk_app_ty"><span class="hs-identifier hs-type">mk_app_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077300"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077303"><span class="hs-identifier hs-type">arg'</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1799"></span><span>
</span><span id="line-1800"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#mk_app_ty"><span class="hs-identifier hs-type">mk_app_ty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-1801"></span><span class="hs-comment">-- This function just adds an ASSERT for mkAppTyM's precondition</span><span>
</span><span id="line-1802"></span><span id="mk_app_ty"><span class="annot"><span class="annottext">mk_app_ty :: Type -&gt; Type -&gt; Type
</span><a href="GHC.Tc.Gen.HsType.html#mk_app_ty"><span class="hs-identifier hs-var hs-var">mk_app_ty</span></a></span></span><span> </span><span id="local-6989586621683077304"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077304"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621683077305"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077305"><span class="hs-identifier hs-var">arg</span></a></span></span><span>
</span><span id="line-1803"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; Type -&gt; Type
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isPiTy"><span class="hs-identifier hs-var">isPiTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077308"><span class="hs-identifier hs-var">fun_kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1804"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077304"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077308"><span class="hs-identifier hs-var">fun_kind</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077305"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; Type -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1805"></span><span>    </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#mkAppTy"><span class="hs-identifier hs-var">mkAppTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077304"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077305"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-1806"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1807"></span><span>    </span><span id="local-6989586621683077308"><span class="annot"><span class="annottext">fun_kind :: Type
</span><a href="#local-6989586621683077308"><span class="hs-identifier hs-var hs-var">fun_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077304"><span class="hs-identifier hs-var">fun</span></a></span><span>
</span><span id="line-1808"></span><span>
</span><span id="line-1809"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#isTrickyTvBinder"><span class="hs-identifier hs-type">isTrickyTvBinder</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1810"></span><span class="hs-comment">-- NB: isTrickyTvBinder is just an optimisation</span><span>
</span><span id="line-1811"></span><span class="hs-comment">-- It would be absolutely sound to return True always</span><span>
</span><span id="line-1812"></span><span id="isTrickyTvBinder"><span class="annot"><span class="annottext">isTrickyTvBinder :: TcTyVar -&gt; Bool
</span><a href="GHC.Tc.Gen.HsType.html#isTrickyTvBinder"><span class="hs-identifier hs-var hs-var">isTrickyTvBinder</span></a></span></span><span> </span><span id="local-6989586621683077309"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077309"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isPiTy"><span class="hs-identifier hs-var">isPiTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; Type
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077309"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1813"></span><span>
</span><span id="line-1814"></span><span class="hs-comment">{- Note [The Purely Kinded Type Invariant (PKTI)]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
During type inference, we maintain this invariant

 (PKTI) It is legal to call 'typeKind' on any Type ty,
        on any sub-term of ty, /without/ zonking ty

        Moreover, any such returned kind
        will itself satisfy (PKTI)

By &quot;legal to call typeKind&quot; we mean &quot;typeKind will not crash&quot;.
The way in which typeKind can crash is in applications
    (a t1 t2 .. tn)
if 'a' is a type variable whose kind doesn't have enough arrows
or foralls.  (The crash is in piResultTys.)

The loop in tcInferTyApps has to be very careful to maintain the (PKTI).
For example, suppose
    kappa is a unification variable
    We have already unified kappa := Type
      yielding    co :: Refl (Type -&gt; Type)
    a :: kappa
then consider the type
    (a Int)
If we call typeKind on that, we'll crash, because the (un-zonked)
kind of 'a' is just kappa, not an arrow kind.  So we must zonk first.

So the type inference engine is very careful when building applications.
This happens in tcInferTyApps. Suppose we are kind-checking the type (a Int),
where (a :: kappa).  Then in tcInferApps we'll run out of binders on
a's kind, so we'll call matchExpectedFunKind, and unify
   kappa := kappa1 -&gt; kappa2,  with evidence co :: kappa ~ (kappa1 ~ kappa2)
At this point we must zonk the function type to expose the arrrow, so
that (a Int) will satisfy (PKTI).

The absence of this caused #14174 and #14520.

The calls to mkAppTyM is the other place we are very careful; see Note [mkAppTyM].

Wrinkle around FunTy:
Note that the PKTI does *not* guarantee anything about the shape of FunTys.
Specifically, when we have (FunTy vis mult arg res), it should be the case
that arg :: TYPE rr1 and res :: TYPE rr2, for some rr1 and rr2. However, we
might not have this. Example: if the user writes (a -&gt; b), then we might
invent a :: kappa1 and b :: kappa2. We soon will check whether kappa1 ~ TYPE rho1
(for some rho1), and that will lead to kappa1 := TYPE rho1 (ditto for kappa2).
However, when we build the FunTy, we might not have zonked `a`, and so the
FunTy will be built without being able to purely extract the RuntimeReps.

Because the PKTI does not guarantee that the RuntimeReps are available in a FunTy,
we must be aware of this when splitting: splitTyConApp and splitAppTy will *not*
split a FunTy if the RuntimeReps are not available. See also Note [Decomposing FunTy]
in GHC.Tc.Solver.Equality.

Note [mkAppTyM]
~~~~~~~~~~~~~~~
mkAppTyM is trying to guarantee the Purely Kinded Type Invariant
(PKTI) for its result type (fun arg).  There are two ways it can go wrong:

* Nasty case 1: forall types (polykinds/T14174a)
    T :: forall (p :: *-&gt;*). p Int -&gt; p Bool
  Now kind-check (T x), where x::kappa.
  Well, T and x both satisfy the PKTI, but
     T x :: x Int -&gt; x Bool
  and (x Int) does /not/ satisfy the PKTI.

* Nasty case 2: type synonyms
    type S f a = f a
  Even though (S ff aa) would satisfy the (PKTI) if S was a data type
  (i.e. nasty case 1 is dealt with), it might still not satisfy (PKTI)
  if S is a type synonym, because the /expansion/ of (S ff aa) is
  (ff aa), and /that/ does not satisfy (PKTI).  E.g. perhaps
  (ff :: kappa), where 'kappa' has already been unified with (*-&gt;*).

  We check for nasty case 2 on the final argument of a type synonym.

Notice that in both cases the trickiness only happens if the
bound variable has a pi-type.  Hence isTrickyTvBinder.
-}</span><span>
</span><span id="line-1893"></span><span>
</span><span id="line-1894"></span><span>
</span><span id="line-1895"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#saturateFamApp"><span class="hs-identifier hs-type">saturateFamApp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1896"></span><span class="hs-comment">-- Precondition for (saturateFamApp ty kind):</span><span>
</span><span id="line-1897"></span><span class="hs-comment">--     typeKind ty = kind</span><span>
</span><span id="line-1898"></span><span class="hs-comment">--</span><span>
</span><span id="line-1899"></span><span class="hs-comment">-- If 'ty' is an unsaturated family application with trailing</span><span>
</span><span id="line-1900"></span><span class="hs-comment">-- invisible arguments, instantiate them.</span><span>
</span><span id="line-1901"></span><span class="hs-comment">-- See Note [saturateFamApp]</span><span>
</span><span id="line-1902"></span><span>
</span><span id="line-1903"></span><span id="saturateFamApp"><span class="annot"><span class="annottext">saturateFamApp :: Type -&gt; Type -&gt; TcM (Type, Type)
</span><a href="GHC.Tc.Gen.HsType.html#saturateFamApp"><span class="hs-identifier hs-var hs-var">saturateFamApp</span></a></span></span><span> </span><span id="local-6989586621683077311"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077311"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683077312"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077312"><span class="hs-identifier hs-var">kind</span></a></span></span><span>
</span><span id="line-1904"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077313"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683077313"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077314"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683077314"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077311"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1905"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#tyConMustBeSaturated"><span class="hs-identifier hs-var">tyConMustBeSaturated</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683077313"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1906"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683077317"><span class="annot"><span class="annottext">n_to_inst :: Int
</span><a href="#local-6989586621683077317"><span class="hs-identifier hs-var hs-var">n_to_inst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Int
</span><a href="GHC.Core.TyCon.html#tyConArity"><span class="hs-identifier hs-var">tyConArity</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683077313"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683077314"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1907"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077318"><span class="annot"><a href="#local-6989586621683077318"><span class="hs-identifier hs-var">extra_args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077319"><span class="annot"><a href="#local-6989586621683077319"><span class="hs-identifier hs-var">ki'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Type -&gt; TcM ([Type], Type)
</span><a href="GHC.Tc.Utils.Instantiate.html#tcInstInvisibleTyBindersN"><span class="hs-identifier hs-var">tcInstInvisibleTyBindersN</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683077317"><span class="hs-identifier hs-var">n_to_inst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077312"><span class="hs-identifier hs-var">kind</span></a></span><span>
</span><span id="line-1908"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683077311"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Type.html#mkAppTys"><span class="hs-operator hs-type">`mkAppTys`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077318"><span class="hs-identifier hs-type">extra_args</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683077319"><span class="hs-identifier hs-type">ki'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1909"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1910"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type, Type) -&gt; TcM (Type, Type)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077311"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077312"><span class="hs-identifier hs-var">kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1911"></span><span>
</span><span id="line-1912"></span><span class="hs-comment">{- Note [saturateFamApp]
~~~~~~~~~~~~~~~~~~~~~~~~
Consider
   type family F :: Either j k
   type instance F @Type = Right Maybe
   type instance F @Type = Right Either```

Then F :: forall {j,k}. Either j k

The two type instances do a visible kind application that instantiates
'j' but not 'k'.  But we want to end up with instances that look like
  type instance F @Type @(*-&gt;*) = Right @Type @(*-&gt;*) Maybe

so that F has arity 2.  We must instantiate that trailing invisible
binder. In general, Invisible binders precede Specified and Required,
so this is only going to bite for apparently-nullary families.

Note that
  type family F2 :: forall k. k -&gt; *
is quite different and really does have arity 0.

It's not just type instances where we need to saturate those
unsaturated arguments: see #11246.  Hence doing this in tcInferApps.
-}</span><span>
</span><span id="line-1936"></span><span>
</span><span id="line-1937"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#appTypeToArg"><span class="hs-identifier hs-type">appTypeToArg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsTypeArg"><span class="hs-identifier hs-type">LHsTypeArg</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-1938"></span><span id="appTypeToArg"><span class="annot"><span class="annottext">appTypeToArg :: LHsType GhcRn -&gt; HsFamEqnPats GhcRn -&gt; LHsType GhcRn
</span><a href="GHC.Tc.Gen.HsType.html#appTypeToArg"><span class="hs-identifier hs-var hs-var">appTypeToArg</span></a></span></span><span> </span><span id="local-6989586621683077321"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077321"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077321"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-1939"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#appTypeToArg"><span class="hs-identifier hs-var">appTypeToArg</span></a></span><span> </span><span id="local-6989586621683077322"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077322"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsValArg"><span class="hs-identifier hs-type">HsValArg</span></a></span><span> </span><span class="annot"><span class="annottext">XValArg GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683077323"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077323"><span class="hs-identifier hs-var">arg</span></a></span></span><span>   </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683077324"><span class="annot"><span class="annottext">HsFamEqnPats GhcRn
</span><a href="#local-6989586621683077324"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; HsFamEqnPats GhcRn -&gt; LHsType GhcRn
</span><a href="GHC.Tc.Gen.HsType.html#appTypeToArg"><span class="hs-identifier hs-var">appTypeToArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; LHsType GhcRn -&gt; LHsType GhcRn
forall (p :: Pass).
LHsType (GhcPass p) -&gt; LHsType (GhcPass p) -&gt; LHsType (GhcPass p)
</span><a href="GHC.Hs.Type.html#mkHsAppTy"><span class="hs-identifier hs-var">mkHsAppTy</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077322"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077323"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsFamEqnPats GhcRn
</span><a href="#local-6989586621683077324"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1940"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#appTypeToArg"><span class="hs-identifier hs-var">appTypeToArg</span></a></span><span> </span><span id="local-6989586621683077326"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077326"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsArgPar"><span class="hs-identifier hs-type">HsArgPar</span></a></span><span> </span><span class="annot"><span class="annottext">XArgPar GhcRn
</span><span class="hs-identifier">_</span></span><span>       </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683077327"><span class="annot"><span class="annottext">HsFamEqnPats GhcRn
</span><a href="#local-6989586621683077327"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; HsFamEqnPats GhcRn -&gt; LHsType GhcRn
</span><a href="GHC.Tc.Gen.HsType.html#appTypeToArg"><span class="hs-identifier hs-var">appTypeToArg</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077326"><span class="hs-identifier hs-var">f</span></a></span><span>                 </span><span class="annot"><span class="annottext">HsFamEqnPats GhcRn
</span><a href="#local-6989586621683077327"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1941"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#appTypeToArg"><span class="hs-identifier hs-var">appTypeToArg</span></a></span><span> </span><span id="local-6989586621683077328"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077328"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTypeArg"><span class="hs-identifier hs-type">HsTypeArg</span></a></span><span> </span><span class="annot"><span class="annottext">XTypeArg GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683077329"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077329"><span class="hs-identifier hs-var">arg</span></a></span></span><span>  </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683077330"><span class="annot"><span class="annottext">HsFamEqnPats GhcRn
</span><a href="#local-6989586621683077330"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1942"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; HsFamEqnPats GhcRn -&gt; LHsType GhcRn
</span><a href="GHC.Tc.Gen.HsType.html#appTypeToArg"><span class="hs-identifier hs-var">appTypeToArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XAppKindTy GhcRn -&gt; LHsType GhcRn -&gt; LHsType GhcRn -&gt; LHsType GhcRn
forall (p :: Pass).
XAppKindTy (GhcPass p)
-&gt; LHsType (GhcPass p)
-&gt; LHsType (GhcPass p)
-&gt; LHsType (GhcPass p)
</span><a href="GHC.Hs.Type.html#mkHsAppKindTy"><span class="hs-identifier hs-var">mkHsAppKindTy</span></a></span><span> </span><span class="annot"><span class="annottext">XAppKindTy GhcRn
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077328"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077329"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsFamEqnPats GhcRn
</span><a href="#local-6989586621683077330"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1943"></span><span>
</span><span id="line-1944"></span><span>
</span><span id="line-1945"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                checkExpectedKind
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-1950"></span><span>
</span><span id="line-1951"></span><span class="hs-comment">-- | This instantiates invisible arguments for the type being checked if it must</span><span>
</span><span id="line-1952"></span><span class="hs-comment">-- be saturated and is not yet saturated. It then calls and uses the result</span><span>
</span><span id="line-1953"></span><span class="hs-comment">-- from checkExpectedKindX to build the final type</span><span>
</span><span id="line-1954"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#checkExpectedKind"><span class="hs-identifier hs-type">checkExpectedKind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span>
</span><span id="line-1955"></span><span>                  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsType"><span class="hs-identifier hs-type">HsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ type we're checking (for printing)</span></span><span>
</span><span id="line-1956"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>             </span><span class="annot"><span class="hs-comment">-- ^ type we're checking</span></span><span>
</span><span id="line-1957"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span>             </span><span class="annot"><span class="hs-comment">-- ^ the known kind of that type</span></span><span>
</span><span id="line-1958"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span>             </span><span class="annot"><span class="hs-comment">-- ^ the expected kind</span></span><span>
</span><span id="line-1959"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-1960"></span><span class="hs-comment">-- Just a convenience wrapper to save calls to 'ppr'</span><span>
</span><span id="line-1961"></span><span id="checkExpectedKind"><span class="annot"><span class="annottext">checkExpectedKind :: HasDebugCallStack =&gt;
HsType GhcRn -&gt; Type -&gt; Type -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#checkExpectedKind"><span class="hs-identifier hs-var hs-var">checkExpectedKind</span></a></span></span><span> </span><span id="local-6989586621683077357"><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683077357"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span> </span><span id="local-6989586621683077358"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077358"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683077359"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077359"><span class="hs-identifier hs-var">act_kind</span></a></span></span><span> </span><span id="local-6989586621683077360"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077360"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span>
</span><span id="line-1962"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;checkExpectedKind&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077358"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077359"><span class="hs-identifier hs-var">act_kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1963"></span><span>
</span><span id="line-1964"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077361"><span class="annot"><a href="#local-6989586621683077361"><span class="hs-identifier hs-var">new_args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077362"><span class="annot"><a href="#local-6989586621683077362"><span class="hs-identifier hs-var">act_kind'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Type -&gt; TcM ([Type], Type)
</span><a href="GHC.Tc.Utils.Instantiate.html#tcInstInvisibleTyBindersN"><span class="hs-identifier hs-var">tcInstInvisibleTyBindersN</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683077363"><span class="hs-identifier hs-var">n_to_inst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077359"><span class="hs-identifier hs-var">act_kind</span></a></span><span>
</span><span id="line-1965"></span><span>
</span><span id="line-1966"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683077364"><span class="annot"><a href="#local-6989586621683077364"><span class="hs-identifier hs-var hs-var">origin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#TypeEqOrigin"><span class="hs-identifier hs-type">TypeEqOrigin</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">uo_actual :: Type
</span><a href="GHC.Tc.Types.Origin.html#uo_actual"><span class="hs-identifier hs-var">uo_actual</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077362"><span class="hs-identifier hs-var">act_kind'</span></a></span><span>
</span><span id="line-1967"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">uo_expected :: Type
</span><a href="GHC.Tc.Types.Origin.html#uo_expected"><span class="hs-identifier hs-var">uo_expected</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077360"><span class="hs-identifier hs-var">exp_kind</span></a></span><span>
</span><span id="line-1968"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">uo_thing :: Maybe TypedThing
</span><a href="GHC.Tc.Types.Origin.html#uo_thing"><span class="hs-identifier hs-var">uo_thing</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypedThing -&gt; Maybe TypedThing
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsType GhcRn -&gt; TypedThing
</span><a href="GHC.Tc.Types.Origin.html#HsTypeRnThing"><span class="hs-identifier hs-var">HsTypeRnThing</span></a></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683077357"><span class="hs-identifier hs-var">hs_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1969"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">uo_visible :: Bool
</span><a href="GHC.Tc.Types.Origin.html#uo_visible"><span class="hs-identifier hs-var">uo_visible</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-comment">-- the hs_ty is visible</span><span>
</span><span id="line-1970"></span><span>
</span><span id="line-1971"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;checkExpectedKindX&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1972"></span><span>         </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077357"><span class="hs-identifier hs-type">hs_ty</span></a></span><span>
</span><span id="line-1973"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;act_kind':&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077362"><span class="hs-identifier hs-type">act_kind'</span></a></span><span>
</span><span id="line-1974"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;exp_kind:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077360"><span class="hs-identifier hs-type">exp_kind</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1975"></span><span>
</span><span id="line-1976"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683077370"><span class="annot"><a href="#local-6989586621683077370"><span class="hs-identifier hs-var hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077358"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkAppTys"><span class="hs-operator hs-var">`mkAppTys`</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683077361"><span class="hs-identifier hs-var">new_args</span></a></span><span>
</span><span id="line-1977"></span><span>
</span><span id="line-1978"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621683077362"><span class="hs-identifier hs-type">act_kind'</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Compare.html#tcEqType"><span class="hs-operator hs-type">`tcEqType`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077360"><span class="hs-identifier hs-type">exp_kind</span></a></span><span>
</span><span id="line-1979"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683077370"><span class="hs-identifier hs-type">res_ty</span></a></span><span>  </span><span class="hs-comment">-- This is very common</span><span>
</span><span id="line-1980"></span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683077372"><span class="annot"><a href="#local-6989586621683077372"><span class="hs-identifier hs-var">co_k</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#unifyTypeAndEmit"><span class="hs-identifier hs-type">unifyTypeAndEmit</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#KindLevel"><span class="hs-identifier hs-type">KindLevel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077364"><span class="hs-identifier hs-type">origin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077362"><span class="hs-identifier hs-type">act_kind'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077360"><span class="hs-identifier hs-type">exp_kind</span></a></span><span>
</span><span id="line-1981"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;checkExpectedKind&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077359"><span class="hs-identifier hs-type">act_kind</span></a></span><span>
</span><span id="line-1982"></span><span>                                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077360"><span class="hs-identifier hs-type">exp_kind</span></a></span><span>
</span><span id="line-1983"></span><span>                                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077372"><span class="hs-identifier hs-type">co_k</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1984"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683077370"><span class="hs-identifier hs-type">res_ty</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Type.html#mkCastTy"><span class="hs-operator hs-type">`mkCastTy`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077372"><span class="hs-identifier hs-type">co_k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1985"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-1986"></span><span>      </span><span class="hs-comment">-- We need to make sure that both kinds have the same number of implicit</span><span>
</span><span id="line-1987"></span><span>      </span><span class="hs-comment">-- foralls out front. If the actual kind has more, instantiate accordingly.</span><span>
</span><span id="line-1988"></span><span>      </span><span class="hs-comment">-- Otherwise, just pass the type &amp; kind through: the errors are caught</span><span>
</span><span id="line-1989"></span><span>      </span><span class="hs-comment">-- in unifyType.</span><span>
</span><span id="line-1990"></span><span>      </span><span id="local-6989586621683077374"><span class="annot"><span class="annottext">n_exp_invis_bndrs :: Int
</span><a href="#local-6989586621683077374"><span class="hs-identifier hs-var hs-var">n_exp_invis_bndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Int
</span><a href="GHC.Core.Type.html#invisibleTyBndrCount"><span class="hs-identifier hs-var">invisibleTyBndrCount</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077360"><span class="hs-identifier hs-var">exp_kind</span></a></span><span>
</span><span id="line-1991"></span><span>      </span><span id="local-6989586621683077376"><span class="annot"><span class="annottext">n_act_invis_bndrs :: Int
</span><a href="#local-6989586621683077376"><span class="hs-identifier hs-var hs-var">n_act_invis_bndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Int
</span><a href="GHC.Core.Type.html#invisibleTyBndrCount"><span class="hs-identifier hs-var">invisibleTyBndrCount</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077359"><span class="hs-identifier hs-var">act_kind</span></a></span><span>
</span><span id="line-1992"></span><span>      </span><span id="local-6989586621683077363"><span class="annot"><span class="annottext">n_to_inst :: Int
</span><a href="#local-6989586621683077363"><span class="hs-identifier hs-var hs-var">n_to_inst</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683077376"><span class="hs-identifier hs-var">n_act_invis_bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683077374"><span class="hs-identifier hs-var">n_exp_invis_bndrs</span></a></span><span>
</span><span id="line-1993"></span><span>
</span><span id="line-1994"></span><span>
</span><span id="line-1995"></span><span class="hs-comment">-- tyr &lt;- checkExpKind hs_ty ty (act_ki :: Kind) (exp_ki :: ExpKind)</span><span>
</span><span id="line-1996"></span><span class="hs-comment">--     requires that `ty` has kind `act_ki`</span><span>
</span><span id="line-1997"></span><span class="hs-comment">-- It checks that the actual kind `act_ki` matches the expected kind `exp_ki`</span><span>
</span><span id="line-1998"></span><span class="hs-comment">-- and returns `tyr`, a possibly-casted form of `ty`, that has precisely kind `exp_ki`</span><span>
</span><span id="line-1999"></span><span class="hs-comment">-- `hs_ty` is purely for error messages</span><span>
</span><span id="line-2000"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#checkExpKind"><span class="hs-identifier hs-type">checkExpKind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsType"><span class="hs-identifier hs-type">HsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpKind"><span class="hs-identifier hs-type">ExpKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-2001"></span><span id="checkExpKind"><span class="annot"><span class="annottext">checkExpKind :: HsType GhcRn -&gt; Type -&gt; Type -&gt; ExpSigmaType -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#checkExpKind"><span class="hs-identifier hs-var hs-var">checkExpKind</span></a></span></span><span> </span><span id="local-6989586621683077377"><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683077377"><span class="hs-identifier hs-var">rn_ty</span></a></span></span><span> </span><span id="local-6989586621683077378"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077378"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683077379"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077379"><span class="hs-identifier hs-var">ki</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#Check"><span class="hs-identifier hs-type">Check</span></a></span><span> </span><span id="local-6989586621683077380"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077380"><span class="hs-identifier hs-var">ki'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2002"></span><span>  </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt;
HsType GhcRn -&gt; Type -&gt; Type -&gt; Type -&gt; TcM Type
HsType GhcRn -&gt; Type -&gt; Type -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#checkExpectedKind"><span class="hs-identifier hs-var">checkExpectedKind</span></a></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683077377"><span class="hs-identifier hs-var">rn_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077378"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077379"><span class="hs-identifier hs-var">ki</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077380"><span class="hs-identifier hs-var">ki'</span></a></span><span>
</span><span id="line-2003"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#checkExpKind"><span class="hs-identifier hs-var">checkExpKind</span></a></span><span> </span><span id="local-6989586621683077381"><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683077381"><span class="hs-identifier hs-var">_rn_ty</span></a></span></span><span> </span><span id="local-6989586621683077382"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077382"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683077383"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077383"><span class="hs-identifier hs-var">ki</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#Infer"><span class="hs-identifier hs-type">Infer</span></a></span><span> </span><span id="local-6989586621683077385"><span class="annot"><span class="annottext">InferResult
</span><a href="#local-6989586621683077385"><span class="hs-identifier hs-var">cell</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2004"></span><span>  </span><span id="local-6989586621683077386"><span class="annot"><a href="#local-6989586621683077386"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; InferResult -&gt; TcM Coercion
</span><a href="GHC.Tc.Utils.Unify.html#fillInferResult"><span class="hs-identifier hs-var">fillInferResult</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077383"><span class="hs-identifier hs-var">ki</span></a></span><span> </span><span class="annot"><span class="annottext">InferResult
</span><a href="#local-6989586621683077385"><span class="hs-identifier hs-var">cell</span></a></span><span>
</span><span id="line-2005"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683077382"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Type.html#mkCastTy"><span class="hs-operator hs-type">`mkCastTy`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077386"><span class="hs-identifier hs-type">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2006"></span><span>
</span><span id="line-2007"></span><span class="hs-comment">---------------------------</span><span>
</span><span id="line-2008"></span><span>
</span><span id="line-2009"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsContext"><span class="hs-identifier hs-type">tcHsContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsContext"><span class="hs-identifier hs-type">LHsContext</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2010"></span><span id="tcHsContext"><span class="annot"><span class="annottext">tcHsContext :: Maybe (LHsContext GhcRn) -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.HsType.html#tcHsContext"><span class="hs-identifier hs-var hs-var">tcHsContext</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (LHsContext GhcRn)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM [Type]
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2011"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsContext"><span class="hs-identifier hs-var">tcHsContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683077389"><span class="annot"><span class="annottext">LHsContext GhcRn
</span><a href="#local-6989586621683077389"><span class="hs-identifier hs-var">cxt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyMode -&gt; LHsContext GhcRn -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.HsType.html#tc_hs_context"><span class="hs-identifier hs-var">tc_hs_context</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="GHC.Tc.Gen.HsType.html#typeLevelMode"><span class="hs-identifier hs-var">typeLevelMode</span></a></span><span> </span><span class="annot"><span class="annottext">LHsContext GhcRn
</span><a href="#local-6989586621683077389"><span class="hs-identifier hs-var">cxt</span></a></span><span>
</span><span id="line-2012"></span><span>
</span><span id="line-2013"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcLHsPredType"><span class="hs-identifier hs-type">tcLHsPredType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a></span><span>
</span><span id="line-2014"></span><span id="tcLHsPredType"><span class="annot"><span class="annottext">tcLHsPredType :: LHsType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcLHsPredType"><span class="hs-identifier hs-var hs-var">tcLHsPredType</span></a></span></span><span> </span><span id="local-6989586621683077390"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077390"><span class="hs-identifier hs-var">pred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyMode -&gt; LHsType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_lhs_pred"><span class="hs-identifier hs-var">tc_lhs_pred</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="GHC.Tc.Gen.HsType.html#typeLevelMode"><span class="hs-identifier hs-var">typeLevelMode</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077390"><span class="hs-identifier hs-var">pred</span></a></span><span>
</span><span id="line-2015"></span><span>
</span><span id="line-2016"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tc_hs_context"><span class="hs-identifier hs-type">tc_hs_context</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsContext"><span class="hs-identifier hs-type">LHsContext</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2017"></span><span id="tc_hs_context"><span class="annot"><span class="annottext">tc_hs_context :: TcTyMode -&gt; LHsContext GhcRn -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.HsType.html#tc_hs_context"><span class="hs-identifier hs-var hs-var">tc_hs_context</span></a></span></span><span> </span><span id="local-6989586621683077392"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077392"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621683077393"><span class="annot"><span class="annottext">LHsContext GhcRn
</span><a href="#local-6989586621683077393"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsType GhcRn) -&gt; TcM Type)
-&gt; [GenLocated SrcSpanAnnA (HsType GhcRn)] -&gt; TcM [Type]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyMode -&gt; LHsType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_lhs_pred"><span class="hs-identifier hs-var">tc_lhs_pred</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077392"><span class="hs-identifier hs-var">mode</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnC [GenLocated SrcSpanAnnA (HsType GhcRn)]
-&gt; [GenLocated SrcSpanAnnA (HsType GhcRn)]
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsContext GhcRn
GenLocated SrcSpanAnnC [GenLocated SrcSpanAnnA (HsType GhcRn)]
</span><a href="#local-6989586621683077393"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2018"></span><span>
</span><span id="line-2019"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tc_lhs_pred"><span class="hs-identifier hs-type">tc_lhs_pred</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a></span><span>
</span><span id="line-2020"></span><span id="tc_lhs_pred"><span class="annot"><span class="annottext">tc_lhs_pred :: TcTyMode -&gt; LHsType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_lhs_pred"><span class="hs-identifier hs-var hs-var">tc_lhs_pred</span></a></span></span><span> </span><span id="local-6989586621683077394"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077394"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621683077395"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077395"><span class="hs-identifier hs-var">pred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyMode -&gt; LHsType GhcRn -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_check_lhs_type"><span class="hs-identifier hs-var">tc_check_lhs_type</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077394"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077395"><span class="hs-identifier hs-var">pred</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#constraintKind"><span class="hs-identifier hs-var">constraintKind</span></a></span><span>
</span><span id="line-2021"></span><span>
</span><span id="line-2022"></span><span class="hs-comment">---------------------------</span><span>
</span><span id="line-2023"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcTyVar"><span class="hs-identifier hs-type">tcTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2024"></span><span class="hs-comment">-- See Note [Type checking recursive type and class declarations]</span><span>
</span><span id="line-2025"></span><span class="hs-comment">-- in GHC.Tc.TyCl</span><span>
</span><span id="line-2026"></span><span class="hs-comment">-- This does not instantiate. See Note [Do not always instantiate eagerly in types]</span><span>
</span><span id="line-2027"></span><span id="tcTyVar"><span class="annot"><span class="annottext">tcTyVar :: Name -&gt; TcM (Type, Type)
</span><a href="GHC.Tc.Gen.HsType.html#tcTyVar"><span class="hs-identifier hs-var hs-var">tcTyVar</span></a></span></span><span> </span><span id="local-6989586621683077396"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077396"><span class="hs-identifier hs-var">name</span></a></span></span><span>         </span><span class="hs-comment">-- Could be a tyvar, a tycon, or a datacon</span><span>
</span><span id="line-2028"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;lk1&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077396"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2029"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683077397"><span class="annot"><a href="#local-6989586621683077397"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM TcTyThing
</span><a href="GHC.Tc.Utils.Env.html#tcLookup"><span class="hs-identifier hs-var">tcLookup</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077396"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-2030"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683077397"><span class="hs-identifier hs-type">thing</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2031"></span><span>           </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#ATyVar"><span class="hs-identifier hs-type">ATyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683077399"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077399"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Type, Type) -&gt; TcM (Type, Type)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077399"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Type
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077399"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2032"></span><span>
</span><span id="line-2033"></span><span>           </span><span class="hs-comment">-- See Note [Recursion through the kinds]</span><span>
</span><span id="line-2034"></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyThing -&gt; Maybe TyCon
</span><a href="GHC.Tc.Types.BasicTypes.html#tcTyThingTyCon_maybe"><span class="hs-identifier hs-var">tcTyThingTyCon_maybe</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683077401"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683077401"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- TyCon or TcTyCon</span><span>
</span><span id="line-2035"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Type, Type) -&gt; TcM (Type, Type)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="GHC.Core.TyCon.html#mkTyConTy"><span class="hs-identifier hs-var">mkTyConTy</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683077401"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="GHC.Core.TyCon.html#tyConKind"><span class="hs-identifier hs-var">tyConKind</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683077401"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2036"></span><span>
</span><span id="line-2037"></span><span>           </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#AGlobal"><span class="hs-identifier hs-type">AGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.TyThing.html#AConLike"><span class="hs-identifier hs-type">AConLike</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-type">RealDataCon</span></a></span><span> </span><span id="local-6989586621683077406"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683077406"><span class="hs-identifier hs-var">dc</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2038"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcM () -&gt; TcM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isFamInstTyCon"><span class="hs-identifier hs-var">isFamInstTyCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; TyCon
</span><a href="GHC.Core.DataCon.html#dataConTyCon"><span class="hs-identifier hs-var">dataConTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683077406"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM () -&gt; TcM ()) -&gt; TcM () -&gt; TcM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2039"></span><span>                       </span><span class="hs-comment">-- see #15245</span><span>
</span><span id="line-2040"></span><span>                       </span><span class="annot"><span class="annottext">Name -&gt; PromotionErr -&gt; TcM ()
forall a. Name -&gt; PromotionErr -&gt; TcM a
</span><a href="GHC.Tc.Gen.HsType.html#promotionErr"><span class="hs-identifier hs-var">promotionErr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077396"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">PromotionErr
</span><a href="GHC.Tc.Errors.Types.PromotionErr.html#FamDataConPE"><span class="hs-identifier hs-var">FamDataConPE</span></a></span><span>
</span><span id="line-2041"></span><span>                   </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TcTyVar]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EqSpec]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077412"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683077412"><span class="hs-identifier hs-var hs-var">theta</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon
-&gt; ([TcTyVar], [TcTyVar], [EqSpec], [Type], [Scaled Type], Type)
</span><a href="GHC.Core.DataCon.html#dataConFullSig"><span class="hs-identifier hs-var">dataConFullSig</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683077406"><span class="hs-identifier hs-var">dc</span></a></span><span>
</span><span id="line-2042"></span><span>                   </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcTyVar&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683077406"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683077412"><span class="hs-identifier hs-var">theta</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2043"></span><span>                     </span><span class="hs-comment">-- promotionErr: Note [No constraints in kinds] in GHC.Tc.Validity</span><span>
</span><span id="line-2044"></span><span>                   </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcM () -&gt; TcM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683077412"><span class="hs-identifier hs-var">theta</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM () -&gt; TcM ()) -&gt; TcM () -&gt; TcM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2045"></span><span>                     </span><span class="annot"><span class="annottext">Name -&gt; PromotionErr -&gt; TcM ()
forall a. Name -&gt; PromotionErr -&gt; TcM a
</span><a href="GHC.Tc.Gen.HsType.html#promotionErr"><span class="hs-identifier hs-var">promotionErr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077396"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type] -&gt; PromotionErr
</span><a href="GHC.Tc.Errors.Types.PromotionErr.html#ConstrainedDataConPE"><span class="hs-identifier hs-var">ConstrainedDataConPE</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683077412"><span class="hs-identifier hs-var">theta</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2046"></span><span>                   </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683077416"><span class="annot"><span class="annottext">tc :: TyCon
</span><a href="#local-6989586621683077416"><span class="hs-identifier hs-var hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; TyCon
</span><a href="GHC.Core.DataCon.html#promoteDataCon"><span class="hs-identifier hs-var">promoteDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683077406"><span class="hs-identifier hs-var">dc</span></a></span><span>
</span><span id="line-2047"></span><span>                   </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(Type, Type) -&gt; TcM (Type, Type)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683077416"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="GHC.Core.TyCon.html#tyConKind"><span class="hs-identifier hs-var">tyConKind</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683077416"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2048"></span><span>
</span><span id="line-2049"></span><span>           </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#AGlobal"><span class="hs-identifier hs-type">AGlobal</span></a></span><span> </span><span class="annot"><a href="GHC.Types.TyThing.html#AnId"><span class="hs-identifier hs-type">AnId</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; PromotionErr -&gt; TcM (Type, Type)
forall a. Name -&gt; PromotionErr -&gt; TcM a
</span><a href="GHC.Tc.Gen.HsType.html#promotionErr"><span class="hs-identifier hs-var">promotionErr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077396"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">PromotionErr
</span><a href="GHC.Tc.Errors.Types.PromotionErr.html#TermVariablePE"><span class="hs-identifier hs-var">TermVariablePE</span></a></span><span>
</span><span id="line-2050"></span><span>           </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#ATcId"><span class="hs-identifier hs-type">ATcId</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; PromotionErr -&gt; TcM (Type, Type)
forall a. Name -&gt; PromotionErr -&gt; TcM a
</span><a href="GHC.Tc.Gen.HsType.html#promotionErr"><span class="hs-identifier hs-var">promotionErr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077396"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">PromotionErr
</span><a href="GHC.Tc.Errors.Types.PromotionErr.html#TermVariablePE"><span class="hs-identifier hs-var">TermVariablePE</span></a></span><span>
</span><span id="line-2051"></span><span>           </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#APromotionErr"><span class="hs-identifier hs-type">APromotionErr</span></a></span><span> </span><span id="local-6989586621683077421"><span class="annot"><span class="annottext">PromotionErr
</span><a href="#local-6989586621683077421"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; PromotionErr -&gt; TcM (Type, Type)
forall a. Name -&gt; PromotionErr -&gt; TcM a
</span><a href="GHC.Tc.Gen.HsType.html#promotionErr"><span class="hs-identifier hs-var">promotionErr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077396"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">PromotionErr
</span><a href="#local-6989586621683077421"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-2052"></span><span>
</span><span id="line-2053"></span><span>           </span><span class="annot"><span class="annottext">TcTyThing
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WrongThingSort -&gt; TcTyThing -&gt; Name -&gt; TcM (Type, Type)
forall a. WrongThingSort -&gt; TcTyThing -&gt; Name -&gt; TcM a
</span><a href="GHC.Tc.Utils.Env.html#wrongThingErr"><span class="hs-identifier hs-var">wrongThingErr</span></a></span><span> </span><span class="annot"><span class="annottext">WrongThingSort
</span><a href="GHC.Tc.Errors.Types.html#WrongThingType"><span class="hs-identifier hs-var">WrongThingType</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyThing
</span><a href="#local-6989586621683077397"><span class="hs-identifier hs-var">thing</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077396"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2054"></span><span>
</span><span id="line-2055"></span><span class="hs-comment">{-
Note [Recursion through the kinds]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider these examples

Ticket #11554:
  data P (x :: k) = Q
  data A :: Type where
    MkA :: forall (a :: A). P a -&gt; A

Ticket #12174
  data V a
  data T = forall (a :: T). MkT (V a)

The type is recursive (which is fine) but it is recursive /through the
kinds/.  In earlier versions of GHC this caused a loop in the compiler
(to do with knot-tying) but there is nothing fundamentally wrong with
the code (kinds are types, and the recursive declarations are OK). But
it's hard to distinguish &quot;recursion through the kinds&quot; from &quot;recursion
through the types&quot;. Consider this (also #11554):

  data PB k (x :: k) = Q
  data B :: Type where
    MkB :: P B a -&gt; B

Here the occurrence of B is not obviously in a kind position.

So now GHC allows all these programs.  #12081 and #15942 are other
examples.

Note [Body kind of a HsForAllTy]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The body of a forall is usually a type.
Because of representation polymorphism, it can be a TYPE r, for any r.
(In fact, GHC can itself construct a function with an
unboxed tuple inside a for-all via CPR analysis; see
typecheck/should_compile/tc170).

A forall can also be used in an instance head, then the body should
be a constraint.

Right now, we do not have any easy way to enforce that a type is
either a TYPE something or CONSTRAINT something, so we accept any kind.
This is unsound (#22063). We could fix this by implementing a TypeLike
predicate, see #20000.

For a forall with a required argument, we do not allow constraints;
e.g. forall a -&gt; Eq a is invalid. Therefore, we can enforce that the body
is a TYPE something in this case (#24176).

Note [Body kind of a HsQualTy]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
If ctxt is non-empty, the HsQualTy really is a /function/, so the
kind of the result really is '*', and in that case the kind of the
body-type can be lifted or unlifted.

However, consider
    instance Eq a =&gt; Eq [a] where ...
or
    f :: (Eq a =&gt; Eq [a]) =&gt; blah
Here both body-kind and result kind of the HsQualTy is Constraint rather than *.
Rather crudely we tell the difference by looking at exp_kind. It's
very convenient to typecheck instance types like any other HsSigType.

(BK1) How do we figure out the right body kind?

Well, it's a bit of a kludge: I just look at the expected kind, `exp_kind`.
If we are in checking mode (`exp_kind` = `Check k`), and the pushed-in kind
`k` is `CONSTRAINT rep`, then we check that the body type has kind `Constraint` too.

This is a kludge because it wouldn't work if any unification was
involved to compute that result kind -- but it isn't.

Note that in the kludgy &quot;figure out whether we are in a type or constraint&quot;
check, we only check if `k` is a `CONSTRAINT rep`, not `Constraint`.
That turns out to give a better error message in T25243.

(BK2)

Note that, once we are in the constraint case, we check that the body has
kind Constraint; see the call to tc_check_lhs_type. (In contrast, for
types we check that the body has kind TYPE kappa for some fresh unification
variable kappa.)
Reason: we don't yet have support for constraints that are not lifted: it's
not possible to declare a class returning a different type than CONSTRAINT LiftedRep.
Evidence is always lifted, the fat arrow c =&gt; t requires c to be
a lifted constraint. In a far future, if we add support for non-lifted
constraints, we could allow c1 =&gt; c2 where
c1 :: CONSTRAINT rep1, c2 :: CONSTRAINT rep2
have arbitrary representations rep1 and rep2.

Note [Inferring tuple kinds]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Give a tuple type (a,b,c), which the parser labels as HsBoxedOrConstraintTuple,
we try to figure out whether it's a tuple of kind * or Constraint.
  Step 1: look at the expected kind
  Step 2: infer argument kinds

If after Step 2 it's not clear from the arguments that it's
Constraint, then it must be *.  Once having decided that we re-check
the arguments to give good error messages in
  e.g.  (Maybe, Maybe)

Note that we will still fail to infer the correct kind in this case:

  type T a = ((a,a), D a)
  type family D :: Constraint -&gt; Constraint

While kind checking T, we do not yet know the kind of D, so we will default the
kind of T to * -&gt; *. It works if we annotate `a` with kind `Constraint`.

Note [Desugaring types]
~~~~~~~~~~~~~~~~~~~~~~~
The type desugarer is phase 2 of dealing with HsTypes.  Specifically:

  * It transforms from HsType to Type

  * It zonks any kinds.  The returned type should have no mutable kind
    or type variables (hence returning Type not TcType):
      - any unconstrained kind variables are defaulted to (Any @Type) just
        as in GHC.Tc.Zonk.Type.
      - there are no mutable type variables because we are
        kind-checking a type
    Reason: the returned type may be put in a TyCon or DataCon where
    it will never subsequently be zonked.

You might worry about nested scopes:
        ..a:kappa in scope..
            let f :: forall b. T '[a,b] -&gt; Int
In this case, f's type could have a mutable kind variable kappa in it;
and we might then default it to (Any @Type) when dealing with f's type
signature.  But we don't expect this to happen because we can't get a
lexically scoped type variable with a mutable kind variable in it.  A
delicate point, this.  If it becomes an issue we might need to
distinguish top-level from nested uses.

Moreover
  * it cannot fail,
  * it does no unifications
  * it does no validity checking, except for structural matters, such as
        (a) spurious ! annotations.
        (b) a class used as a type

Note [Kind of a type splice]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider these terms, each with TH type splice inside:
     [| e1 :: Maybe $(..blah..) |]
     [| e2 :: $(..blah..) |]
When kind-checking the type signature, we'll kind-check the splice
$(..blah..); we want to give it a kind that can fit in any context,
as if $(..blah..) :: forall k. k.

In the e1 example, the context of the splice fixes kappa to *.  But
in the e2 example, we'll desugar the type, zonking the kind unification
variables as we go.  When we encounter the unconstrained kappa, we
want to default it to 'Type', not to (Any @Type).

-}</span><span>
</span><span id="line-2213"></span><span>
</span><span id="line-2214"></span><span id="local-6989586621683075143"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#addTypeCtxt"><span class="hs-identifier hs-type">addTypeCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075143"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075143"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2215"></span><span>        </span><span class="hs-comment">-- Wrap a context around only if we want to show that contexts.</span><span>
</span><span id="line-2216"></span><span>        </span><span class="hs-comment">-- Omit invisible ones and ones user's won't grok</span><span>
</span><span id="line-2217"></span><span id="addTypeCtxt"><span class="annot"><span class="annottext">addTypeCtxt :: forall a. LHsType GhcRn -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.HsType.html#addTypeCtxt"><span class="hs-identifier hs-var hs-var">addTypeCtxt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsWildCardTy"><span class="hs-identifier hs-type">HsWildCardTy</span></a></span><span> </span><span class="annot"><span class="annottext">XWildCardTy GhcRn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683077427"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683077427"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683077427"><span class="hs-identifier hs-var">thing</span></a></span><span>   </span><span class="hs-comment">-- &quot;In the type '_'&quot; just isn't helpful.</span><span>
</span><span id="line-2218"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#addTypeCtxt"><span class="hs-identifier hs-var">addTypeCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683077428"><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683077428"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683077429"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683077429"><span class="hs-identifier hs-var">thing</span></a></span></span><span>
</span><span id="line-2219"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcM a -&gt; TcM a
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683077430"><span class="hs-identifier hs-var">doc</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683077429"><span class="hs-identifier hs-var">thing</span></a></span><span>
</span><span id="line-2220"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2221"></span><span>    </span><span id="local-6989586621683077430"><span class="annot"><span class="annottext">doc :: SDoc
</span><a href="#local-6989586621683077430"><span class="hs-identifier hs-var hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In the type&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsType GhcRn -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683077428"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2222"></span><span>
</span><span id="line-2223"></span><span>
</span><span id="line-2224"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                Type-variable binders
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-2229"></span><span>
</span><span id="line-2230"></span><span id="local-6989586621683075145"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindNamedWildCardBinders"><span class="hs-identifier hs-type">bindNamedWildCardBinders</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2231"></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075145"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2232"></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075145"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2233"></span><span class="hs-comment">-- Bring into scope the /named/ wildcard binders.  Remember that</span><span>
</span><span id="line-2234"></span><span class="hs-comment">-- plain wildcards _ are anonymous and dealt with by HsWildCardTy</span><span>
</span><span id="line-2235"></span><span class="hs-comment">-- Soe Note [The wildcard story for types] in GHC.Hs.Type</span><span>
</span><span id="line-2236"></span><span id="bindNamedWildCardBinders"><span class="annot"><span class="annottext">bindNamedWildCardBinders :: forall a. HsQTvsRn -&gt; ([(Name, TcTyVar)] -&gt; TcM a) -&gt; TcM a
</span><a href="GHC.Tc.Gen.HsType.html#bindNamedWildCardBinders"><span class="hs-identifier hs-var hs-var">bindNamedWildCardBinders</span></a></span></span><span> </span><span id="local-6989586621683077435"><span class="annot"><span class="annottext">HsQTvsRn
</span><a href="#local-6989586621683077435"><span class="hs-identifier hs-var">wc_names</span></a></span></span><span> </span><span id="local-6989586621683077436"><span class="annot"><span class="annottext">[(Name, TcTyVar)] -&gt; TcM a
</span><a href="#local-6989586621683077436"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-2237"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683077437"><span class="annot"><a href="#local-6989586621683077437"><span class="hs-identifier hs-var">wcs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar)
-&gt; HsQTvsRn -&gt; TcM [TcTyVar]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
</span><a href="GHC.Tc.Gen.HsType.html#newNamedWildTyVar"><span class="hs-identifier hs-var">newNamedWildTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">HsQTvsRn
</span><a href="#local-6989586621683077435"><span class="hs-identifier hs-var">wc_names</span></a></span><span>
</span><span id="line-2238"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683077439"><span class="annot"><a href="#local-6989586621683077439"><span class="hs-identifier hs-var hs-var">wc_prs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsQTvsRn
</span><a href="#local-6989586621683077435"><span class="hs-identifier hs-var">wc_names</span></a></span><span> </span><span class="annot"><span class="annottext">HsQTvsRn -&gt; [TcTyVar] -&gt; [(Name, TcTyVar)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-operator hs-var">`zip`</span></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683077437"><span class="hs-identifier hs-var">wcs</span></a></span><span>
</span><span id="line-2239"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcExtendNameTyVarEnv"><span class="hs-identifier hs-type">tcExtendNameTyVarEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077439"><span class="hs-identifier hs-type">wc_prs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2240"></span><span>         </span><span class="annot"><a href="#local-6989586621683077436"><span class="hs-identifier hs-type">thing_inside</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077439"><span class="hs-identifier hs-type">wc_prs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2241"></span><span>
</span><span id="line-2242"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#newNamedWildTyVar"><span class="hs-identifier hs-type">newNamedWildTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span>
</span><span id="line-2243"></span><span class="annot"><span class="hs-comment">-- ^ New unification variable '_' for a wildcard</span></span><span>
</span><span id="line-2244"></span><span id="newNamedWildTyVar"><span class="annot"><span class="annottext">newNamedWildTyVar :: Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
</span><a href="GHC.Tc.Gen.HsType.html#newNamedWildTyVar"><span class="hs-identifier hs-var hs-var">newNamedWildTyVar</span></a></span></span><span> </span><span id="local-6989586621683077441"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077441"><span class="hs-identifier hs-var">_name</span></a></span></span><span>   </span><span class="hs-comment">-- Currently ignoring the &quot;_x&quot; wildcard name used in the type</span><span>
</span><span id="line-2245"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683077442"><span class="annot"><a href="#local-6989586621683077442"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM Type
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaKindVar"><span class="hs-identifier hs-var">newMetaKindVar</span></a></span><span>
</span><span id="line-2246"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683077443"><span class="annot"><a href="#local-6989586621683077443"><span class="hs-identifier hs-var">details</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newMetaDetails"><span class="hs-identifier hs-type">newMetaDetails</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TauTv"><span class="hs-identifier hs-type">TauTv</span></a></span><span>
</span><span id="line-2247"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683077446"><span class="annot"><a href="#local-6989586621683077446"><span class="hs-identifier hs-var">wc_name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarName"><span class="hs-identifier hs-type">newMetaTyVarName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-type">fsLit</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;w&quot;</span></span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- See Note [Wildcard names]</span><span>
</span><span id="line-2248"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683077449"><span class="annot"><a href="#local-6989586621683077449"><span class="hs-identifier hs-var hs-var">tyvar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; TcTyVarDetails -&gt; TcTyVar
</span><a href="GHC.Types.Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077446"><span class="hs-identifier hs-var">wc_name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077442"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVarDetails
</span><a href="#local-6989586621683077443"><span class="hs-identifier hs-var">details</span></a></span><span>
</span><span id="line-2249"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;newWildTyVar&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077449"><span class="hs-identifier hs-type">tyvar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2250"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683077449"><span class="hs-identifier hs-type">tyvar</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2251"></span><span>
</span><span id="line-2252"></span><span class="hs-comment">---------------------------</span><span>
</span><span id="line-2253"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcAnonWildCardOcc"><span class="hs-identifier hs-type">tcAnonWildCardOcc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#IsExtraConstraint"><span class="hs-identifier hs-type">IsExtraConstraint</span></a></span><span>
</span><span id="line-2254"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsType"><span class="hs-identifier hs-type">HsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-2255"></span><span id="tcAnonWildCardOcc"><span class="annot"><span class="annottext">tcAnonWildCardOcc :: IsExtraConstraint -&gt; TcTyMode -&gt; HsType GhcRn -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcAnonWildCardOcc"><span class="hs-identifier hs-var hs-var">tcAnonWildCardOcc</span></a></span></span><span> </span><span id="local-6989586621683077451"><span class="annot"><span class="annottext">IsExtraConstraint
</span><a href="#local-6989586621683077451"><span class="hs-identifier hs-var">is_extra</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mode_holes :: TcTyMode -&gt; HoleInfo
</span><a href="GHC.Tc.Gen.HsType.html#mode_holes"><span class="hs-identifier hs-var">mode_holes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077452"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683077452"><span class="hs-identifier hs-var">hole_lvl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077453"><span class="annot"><span class="annottext">HoleMode
</span><a href="#local-6989586621683077453"><span class="hs-identifier hs-var">hole_mode</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2256"></span><span>                  </span><span id="local-6989586621683077454"><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683077454"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683077455"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077455"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span>
</span><span id="line-2257"></span><span>    </span><span class="hs-comment">-- hole_lvl: see Note [Checking partial type signatures]</span><span>
</span><span id="line-2258"></span><span>    </span><span class="hs-comment">--           esp the bullet on nested forall types</span><span>
</span><span id="line-2259"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683077456"><span class="annot"><a href="#local-6989586621683077456"><span class="hs-identifier hs-var">kv_details</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; TcM TcTyVarDetails
</span><a href="GHC.Tc.Utils.TcMType.html#newTauTvDetailsAtLevel"><span class="hs-identifier hs-var">newTauTvDetailsAtLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683077452"><span class="hs-identifier hs-var">hole_lvl</span></a></span><span>
</span><span id="line-2260"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683077458"><span class="annot"><a href="#local-6989586621683077458"><span class="hs-identifier hs-var">kv_name</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarName"><span class="hs-identifier hs-type">newMetaTyVarName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-type">fsLit</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;k&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-2261"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683077459"><span class="annot"><a href="#local-6989586621683077459"><span class="hs-identifier hs-var">wc_details</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newTauTvDetailsAtLevel"><span class="hs-identifier hs-type">newTauTvDetailsAtLevel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077452"><span class="hs-identifier hs-type">hole_lvl</span></a></span><span>
</span><span id="line-2262"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683077460"><span class="annot"><a href="#local-6989586621683077460"><span class="hs-identifier hs-var">wc_name</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarName"><span class="hs-identifier hs-type">newMetaTyVarName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077461"><span class="hs-identifier hs-type">wc_nm</span></a></span><span>
</span><span id="line-2263"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683077462"><span class="annot"><a href="#local-6989586621683077462"><span class="hs-identifier hs-var hs-var">kv</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; TcTyVarDetails -&gt; TcTyVar
</span><a href="GHC.Types.Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077458"><span class="hs-identifier hs-var">kv_name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVarDetails
</span><a href="#local-6989586621683077456"><span class="hs-identifier hs-var">kv_details</span></a></span><span>
</span><span id="line-2264"></span><span>             </span><span id="local-6989586621683077463"><span class="annot"><a href="#local-6989586621683077463"><span class="hs-identifier hs-var hs-var">wc_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077462"><span class="hs-identifier hs-var">kv</span></a></span><span>
</span><span id="line-2265"></span><span>             </span><span id="local-6989586621683077464"><span class="annot"><a href="#local-6989586621683077464"><span class="hs-identifier hs-var hs-var">wc_tv</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; TcTyVarDetails -&gt; TcTyVar
</span><a href="GHC.Types.Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077460"><span class="hs-identifier hs-var">wc_name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077463"><span class="hs-identifier hs-var">wc_kind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVarDetails
</span><a href="#local-6989586621683077459"><span class="hs-identifier hs-var">wc_details</span></a></span><span>
</span><span id="line-2266"></span><span>
</span><span id="line-2267"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcAnonWildCardOcc&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077452"><span class="hs-identifier hs-type">hole_lvl</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077465"><span class="hs-identifier hs-type">emit_holes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2268"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="annot"><a href="#local-6989586621683077465"><span class="hs-identifier hs-type">emit_holes</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2269"></span><span>         </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitAnonTypeHole"><span class="hs-identifier hs-type">emitAnonTypeHole</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077451"><span class="hs-identifier hs-type">is_extra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077464"><span class="hs-identifier hs-type">wc_tv</span></a></span><span>
</span><span id="line-2270"></span><span>         </span><span class="hs-comment">-- Why the 'when' guard?</span><span>
</span><span id="line-2271"></span><span>         </span><span class="hs-comment">-- See Note [Wildcards in visible kind application]</span><span>
</span><span id="line-2272"></span><span>
</span><span id="line-2273"></span><span>       </span><span class="hs-comment">-- You might think that this would always just unify</span><span>
</span><span id="line-2274"></span><span>       </span><span class="hs-comment">-- wc_kind with exp_kind, so we could avoid even creating kv</span><span>
</span><span id="line-2275"></span><span>       </span><span class="hs-comment">-- But the level numbers might not allow that unification,</span><span>
</span><span id="line-2276"></span><span>       </span><span class="hs-comment">-- so we have to do it properly (T14140a)</span><span>
</span><span id="line-2277"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#checkExpectedKind"><span class="hs-identifier hs-type">checkExpectedKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077454"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-type">mkTyVarTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077464"><span class="hs-identifier hs-type">wc_tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683077463"><span class="hs-identifier hs-type">wc_kind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077455"><span class="hs-identifier hs-type">exp_kind</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2278"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2279"></span><span>     </span><span class="hs-comment">-- See Note [Wildcard names]</span><span>
</span><span id="line-2280"></span><span>     </span><span id="local-6989586621683077461"><span class="annot"><span class="annottext">wc_nm :: FastString
</span><a href="#local-6989586621683077461"><span class="hs-identifier hs-var hs-var">wc_nm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HoleMode
</span><a href="#local-6989586621683077453"><span class="hs-identifier hs-var">hole_mode</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2281"></span><span>               </span><span class="annot"><span class="annottext">HoleMode
</span><a href="GHC.Tc.Gen.HsType.html#HM_Sig"><span class="hs-identifier hs-var">HM_Sig</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;w&quot;</span></span><span>
</span><span id="line-2282"></span><span>               </span><span class="annot"><span class="annottext">HoleMode
</span><a href="GHC.Tc.Gen.HsType.html#HM_FamPat"><span class="hs-identifier hs-var">HM_FamPat</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_&quot;</span></span><span>
</span><span id="line-2283"></span><span>               </span><span class="annot"><span class="annottext">HoleMode
</span><a href="GHC.Tc.Gen.HsType.html#HM_VTA"><span class="hs-identifier hs-var">HM_VTA</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;w&quot;</span></span><span>
</span><span id="line-2284"></span><span>               </span><span class="annot"><span class="annottext">HoleMode
</span><a href="GHC.Tc.Gen.HsType.html#HM_TyAppPat"><span class="hs-identifier hs-var">HM_TyAppPat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_&quot;</span></span><span>
</span><span id="line-2285"></span><span>
</span><span id="line-2286"></span><span>     </span><span id="local-6989586621683077465"><span class="annot"><span class="annottext">emit_holes :: Bool
</span><a href="#local-6989586621683077465"><span class="hs-identifier hs-var hs-var">emit_holes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HoleMode
</span><a href="#local-6989586621683077453"><span class="hs-identifier hs-var">hole_mode</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2287"></span><span>                     </span><span class="annot"><span class="annottext">HoleMode
</span><a href="GHC.Tc.Gen.HsType.html#HM_Sig"><span class="hs-identifier hs-var">HM_Sig</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2288"></span><span>                     </span><span class="annot"><span class="annottext">HoleMode
</span><a href="GHC.Tc.Gen.HsType.html#HM_FamPat"><span class="hs-identifier hs-var">HM_FamPat</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2289"></span><span>                     </span><span class="annot"><span class="annottext">HoleMode
</span><a href="GHC.Tc.Gen.HsType.html#HM_VTA"><span class="hs-identifier hs-var">HM_VTA</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2290"></span><span>                     </span><span class="annot"><span class="annottext">HoleMode
</span><a href="GHC.Tc.Gen.HsType.html#HM_TyAppPat"><span class="hs-identifier hs-var">HM_TyAppPat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2291"></span><span>
</span><span id="line-2292"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcAnonWildCardOcc"><span class="hs-identifier hs-var">tcAnonWildCardOcc</span></a></span><span> </span><span id="local-6989586621683077467"><span class="annot"><span class="annottext">IsExtraConstraint
</span><a href="#local-6989586621683077467"><span class="hs-identifier hs-var">is_extra</span></a></span></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-2293"></span><span class="hs-comment">-- mode_holes is Nothing. This means we have an anonymous wildcard</span><span>
</span><span id="line-2294"></span><span class="hs-comment">-- in an unexpected place. The renamer rejects these wildcards in 'checkAnonWildcard',</span><span>
</span><span id="line-2295"></span><span class="hs-comment">-- but it is possible for a wildcard to be introduced by a Template Haskell splice,</span><span>
</span><span id="line-2296"></span><span class="hs-comment">-- as per #15433. To account for this, we throw a generic catch-all error message.</span><span>
</span><span id="line-2297"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM Type
forall a. TcRnMessage -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWith"><span class="hs-identifier hs-var">failWith</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; TcM Type) -&gt; TcRnMessage -&gt; TcM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; BadAnonWildcardContext -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnIllegalWildcardInType"><span class="hs-identifier hs-var">TcRnIllegalWildcardInType</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">BadAnonWildcardContext
</span><a href="#local-6989586621683077469"><span class="hs-identifier hs-var">reason</span></a></span><span>
</span><span id="line-2298"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-2299"></span><span>      </span><span id="local-6989586621683077469"><span class="annot"><span class="annottext">reason :: BadAnonWildcardContext
</span><a href="#local-6989586621683077469"><span class="hs-identifier hs-var hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2300"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IsExtraConstraint
</span><a href="#local-6989586621683077467"><span class="hs-identifier hs-var">is_extra</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2301"></span><span>          </span><span class="annot"><span class="annottext">IsExtraConstraint
</span><a href="GHC.Tc.Utils.Monad.html#YesExtraConstraint"><span class="hs-identifier hs-var">YesExtraConstraint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2302"></span><span>            </span><span class="annot"><span class="annottext">SoleExtraConstraintWildcardAllowed -&gt; BadAnonWildcardContext
</span><a href="GHC.Tc.Errors.Types.html#ExtraConstraintWildcardNotAllowed"><span class="hs-identifier hs-var">ExtraConstraintWildcardNotAllowed</span></a></span><span>
</span><span id="line-2303"></span><span>              </span><span class="annot"><span class="annottext">SoleExtraConstraintWildcardAllowed
</span><a href="GHC.Tc.Errors.Types.html#SoleExtraConstraintWildcardNotAllowed"><span class="hs-identifier hs-var">SoleExtraConstraintWildcardNotAllowed</span></a></span><span>
</span><span id="line-2304"></span><span>          </span><span class="annot"><span class="annottext">IsExtraConstraint
</span><a href="GHC.Tc.Utils.Monad.html#NoExtraConstraint"><span class="hs-identifier hs-var">NoExtraConstraint</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2305"></span><span>            </span><span class="annot"><span class="annottext">BadAnonWildcardContext
</span><a href="GHC.Tc.Errors.Types.html#WildcardsNotAllowedAtAll"><span class="hs-identifier hs-var">WildcardsNotAllowedAtAll</span></a></span><span>
</span><span id="line-2306"></span><span>
</span><span id="line-2307"></span><span class="hs-comment">{- Note [Wildcard names]
~~~~~~~~~~~~~~~~~~~~~~~~
So we hackily use the mode_holes flag to control the name used
for wildcards:

* For proper holes (whether in a visible type application (VTA) or no),
  we rename the '_' to 'w'. This is so that we see variables like 'w0'
  or 'w1' in error messages, a vast improvement upon '_0' and '_1'. For
  example, we prefer
       Found type wildcard &#8216;_&#8217; standing for &#8216;w0&#8217;
  over
       Found type wildcard &#8216;_&#8217; standing for &#8216;_1&#8217;

  Even in the VTA case, where we do not emit an error to be printed, we
  want to do the renaming, as the variables may appear in other,
  non-wildcard error messages.

* However, holes in the left-hand sides of type families (&quot;type
  patterns&quot;) stand for type variables which we do not care to name --
  much like the use of an underscore in an ordinary term-level
  pattern. When we spot these, we neither wish to generate an error
  message nor to rename the variable.  We don't rename the variable so
  that we can pretty-print a type family LHS as, e.g.,
    F _ Int _ = ...
  and not
     F w1 Int w2 = ...

  See also Note [Wildcards in family instances] in
  GHC.Rename.Module. The choice of HM_FamPat is made in
  tcFamTyPats. There is also some unsavory magic, relying on that
  underscore, in GHC.Core.Coercion.tidyCoAxBndrsForUser.

Note [Wildcards in visible kind application]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
There are cases where users might want to pass in a wildcard as a visible kind
argument, for instance:

data T :: forall k1 k2. k1 &#8594; k2 &#8594; Type where
  MkT :: T a b
x :: T @_ @Nat False n
x = MkT

So we should allow '@_' without emitting any hole constraints, and
regardless of whether PartialTypeSignatures is enabled or not. But how
would the typechecker know which '_' is being used in VKA and which is
not when it calls emitNamedTypeHole in
tcHsPartialSigType on all HsWildCardBndrs?  The solution is to neither
rename nor include unnamed wildcards in HsWildCardBndrs, but instead
give every anonymous wildcard a fresh wild tyvar in tcAnonWildCardOcc.

And whenever we see a '@', we set mode_holes to HM_VKA, so that
we do not call emitAnonTypeHole in tcAnonWildCardOcc.
See related Note [Wildcards in visible type application] here and
Note [The wildcard story for types] in GHC.Hs.Type
-}</span><span>
</span><span id="line-2362"></span><span>
</span><span id="line-2363"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
             Kind inference for type declarations
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-2368"></span><span>
</span><span id="line-2369"></span><span class="hs-comment">-- See Note [kcCheckDeclHeader vs kcInferDeclHeader]</span><span>
</span><span id="line-2370"></span><span class="hs-keyword">data</span><span> </span><span id="InitialKindStrategy"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#InitialKindStrategy"><span class="hs-identifier hs-var">InitialKindStrategy</span></a></span></span><span>
</span><span id="line-2371"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="InitialKindCheck"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#InitialKindCheck"><span class="hs-identifier hs-var">InitialKindCheck</span></a></span></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SAKS_or_CUSK"><span class="hs-identifier hs-type">SAKS_or_CUSK</span></a></span><span>
</span><span id="line-2372"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="InitialKindInfer"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#InitialKindInfer"><span class="hs-identifier hs-var">InitialKindInfer</span></a></span></span><span>
</span><span id="line-2373"></span><span>
</span><span id="line-2374"></span><span class="hs-comment">-- Does the declaration have a standalone kind signature (SAKS) or a complete</span><span>
</span><span id="line-2375"></span><span class="hs-comment">-- user-supplied kind (CUSK)?</span><span>
</span><span id="line-2376"></span><span class="hs-keyword">data</span><span> </span><span id="SAKS_or_CUSK"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SAKS_or_CUSK"><span class="hs-identifier hs-var">SAKS_or_CUSK</span></a></span></span><span>
</span><span id="line-2377"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="SAKS"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SAKS"><span class="hs-identifier hs-var">SAKS</span></a></span></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span>  </span><span class="hs-comment">-- Standalone kind signature, fully zonked! (zonkTcTypeToType)</span><span>
</span><span id="line-2378"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="CUSK"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#CUSK"><span class="hs-identifier hs-var">CUSK</span></a></span></span><span>       </span><span class="hs-comment">-- Complete user-supplied kind (CUSK)</span><span>
</span><span id="line-2379"></span><span>
</span><span id="line-2380"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SAKS_or_CUSK"><span class="hs-identifier hs-type">SAKS_or_CUSK</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2381"></span><span>  </span><span id="local-6989586621683077484"><span class="annot"><span class="annottext">ppr :: SAKS_or_CUSK -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SAKS"><span class="hs-identifier hs-type">SAKS</span></a></span><span> </span><span id="local-6989586621683077485"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077485"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SAKS&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077485"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-2382"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">SAKS_or_CUSK
</span><a href="GHC.Tc.Gen.HsType.html#CUSK"><span class="hs-identifier hs-var">CUSK</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;CUSK&quot;</span></span><span>
</span><span id="line-2383"></span><span>
</span><span id="line-2384"></span><span class="hs-comment">-- See Note [kcCheckDeclHeader vs kcInferDeclHeader]</span><span>
</span><span id="line-2385"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#kcDeclHeader"><span class="hs-identifier hs-type">kcDeclHeader</span></a></span><span>
</span><span id="line-2386"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#InitialKindStrategy"><span class="hs-identifier hs-type">InitialKindStrategy</span></a></span><span>
</span><span id="line-2387"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>               </span><span class="annot"><span class="hs-comment">-- ^ of the thing being checked</span></span><span>
</span><span id="line-2388"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TyConFlavour"><span class="hs-identifier hs-type">TyConFlavour</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ What sort of 'TyCon' is being checked</span></span><span>
</span><span id="line-2389"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsQTyVars"><span class="hs-identifier hs-type">LHsQTyVars</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ Binders in the header</span></span><span>
</span><span id="line-2390"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#ContextKind"><span class="hs-identifier hs-type">ContextKind</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ The result kind</span></span><span>
</span><span id="line-2391"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCon"><span class="hs-identifier hs-type">TcTyCon</span></a></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ A suitably-kinded TcTyCon</span></span><span>
</span><span id="line-2392"></span><span id="kcDeclHeader"><span class="annot"><span class="annottext">kcDeclHeader :: InitialKindStrategy
-&gt; Name
-&gt; TyConFlavour TyCon
-&gt; LHsQTyVars GhcRn
-&gt; TcM ContextKind
-&gt; TcM TyCon
</span><a href="GHC.Tc.Gen.HsType.html#kcDeclHeader"><span class="hs-identifier hs-var hs-var">kcDeclHeader</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#InitialKindCheck"><span class="hs-identifier hs-type">InitialKindCheck</span></a></span><span> </span><span id="local-6989586621683077487"><span class="annot"><span class="annottext">SAKS_or_CUSK
</span><a href="#local-6989586621683077487"><span class="hs-identifier hs-var">msig</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SAKS_or_CUSK
-&gt; Name
-&gt; TyConFlavour TyCon
-&gt; LHsQTyVars GhcRn
-&gt; TcM ContextKind
-&gt; TcM TyCon
</span><a href="GHC.Tc.Gen.HsType.html#kcCheckDeclHeader"><span class="hs-identifier hs-var">kcCheckDeclHeader</span></a></span><span> </span><span class="annot"><span class="annottext">SAKS_or_CUSK
</span><a href="#local-6989586621683077487"><span class="hs-identifier hs-var">msig</span></a></span><span>
</span><span id="line-2393"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#kcDeclHeader"><span class="hs-identifier hs-var">kcDeclHeader</span></a></span><span> </span><span class="annot"><span class="annottext">InitialKindStrategy
</span><a href="GHC.Tc.Gen.HsType.html#InitialKindInfer"><span class="hs-identifier hs-var">InitialKindInfer</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
-&gt; TyConFlavour TyCon
-&gt; LHsQTyVars GhcRn
-&gt; TcM ContextKind
-&gt; TcM TyCon
</span><a href="GHC.Tc.Gen.HsType.html#kcInferDeclHeader"><span class="hs-identifier hs-var">kcInferDeclHeader</span></a></span><span>
</span><span id="line-2394"></span><span>
</span><span id="line-2395"></span><span class="hs-comment">{- Note [kcCheckDeclHeader vs kcInferDeclHeader]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
kcCheckDeclHeader and kcInferDeclHeader are responsible for getting the initial kind
of a type constructor.

* kcCheckDeclHeader: the TyCon has a standalone kind signature or a CUSK. In that
  case, find the full, final, poly-kinded kind of the TyCon.  It's very like a
  term-level binding where we have a complete type signature for the function.

* kcInferDeclHeader: the TyCon has neither a standalone kind signature nor a
  CUSK. Find a monomorphic kind, with unification variables in it; they will be
  generalised later.  It's very like a term-level binding where we do not have a
  type signature (or, more accurately, where we have a partial type signature),
  so we infer the type and generalise.
-}</span><span>
</span><span id="line-2410"></span><span>
</span><span id="line-2411"></span><span class="hs-comment">------------------------------</span><span>
</span><span id="line-2412"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#kcCheckDeclHeader"><span class="hs-identifier hs-type">kcCheckDeclHeader</span></a></span><span>
</span><span id="line-2413"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SAKS_or_CUSK"><span class="hs-identifier hs-type">SAKS_or_CUSK</span></a></span><span>
</span><span id="line-2414"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>               </span><span class="annot"><span class="hs-comment">-- ^ of the thing being checked</span></span><span>
</span><span id="line-2415"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TyConFlavour"><span class="hs-identifier hs-type">TyConFlavour</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ What sort of 'TyCon' is being checked</span></span><span>
</span><span id="line-2416"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsQTyVars"><span class="hs-identifier hs-type">LHsQTyVars</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ Binders in the header</span></span><span>
</span><span id="line-2417"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#ContextKind"><span class="hs-identifier hs-type">ContextKind</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ The result kind. AnyKind == no result signature</span></span><span>
</span><span id="line-2418"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#PolyTcTyCon"><span class="hs-identifier hs-type">PolyTcTyCon</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ A suitably-kinded generalized TcTyCon</span></span><span>
</span><span id="line-2419"></span><span id="kcCheckDeclHeader"><span class="annot"><span class="annottext">kcCheckDeclHeader :: SAKS_or_CUSK
-&gt; Name
-&gt; TyConFlavour TyCon
-&gt; LHsQTyVars GhcRn
-&gt; TcM ContextKind
-&gt; TcM TyCon
</span><a href="GHC.Tc.Gen.HsType.html#kcCheckDeclHeader"><span class="hs-identifier hs-var hs-var">kcCheckDeclHeader</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SAKS"><span class="hs-identifier hs-type">SAKS</span></a></span><span> </span><span id="local-6989586621683077491"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077491"><span class="hs-identifier hs-var">sig</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
-&gt; Name
-&gt; TyConFlavour TyCon
-&gt; LHsQTyVars GhcRn
-&gt; TcM ContextKind
-&gt; TcM TyCon
</span><a href="GHC.Tc.Gen.HsType.html#kcCheckDeclHeader_sig"><span class="hs-identifier hs-var">kcCheckDeclHeader_sig</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077491"><span class="hs-identifier hs-var">sig</span></a></span><span>
</span><span id="line-2420"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#kcCheckDeclHeader"><span class="hs-identifier hs-var">kcCheckDeclHeader</span></a></span><span> </span><span class="annot"><span class="annottext">SAKS_or_CUSK
</span><a href="GHC.Tc.Gen.HsType.html#CUSK"><span class="hs-identifier hs-var">CUSK</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
-&gt; TyConFlavour TyCon
-&gt; LHsQTyVars GhcRn
-&gt; TcM ContextKind
-&gt; TcM TyCon
</span><a href="GHC.Tc.Gen.HsType.html#kcCheckDeclHeader_cusk"><span class="hs-identifier hs-var">kcCheckDeclHeader_cusk</span></a></span><span>
</span><span id="line-2421"></span><span>
</span><span id="line-2422"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#kcCheckDeclHeader_cusk"><span class="hs-identifier hs-type">kcCheckDeclHeader_cusk</span></a></span><span>
</span><span id="line-2423"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>               </span><span class="annot"><span class="hs-comment">-- ^ of the thing being checked</span></span><span>
</span><span id="line-2424"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TyConFlavour"><span class="hs-identifier hs-type">TyConFlavour</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ What sort of 'TyCon' is being checked</span></span><span>
</span><span id="line-2425"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsQTyVars"><span class="hs-identifier hs-type">LHsQTyVars</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ Binders in the header</span></span><span>
</span><span id="line-2426"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#ContextKind"><span class="hs-identifier hs-type">ContextKind</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ The result kind</span></span><span>
</span><span id="line-2427"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#PolyTcTyCon"><span class="hs-identifier hs-type">PolyTcTyCon</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ A suitably-kinded generalized TcTyCon</span></span><span>
</span><span id="line-2428"></span><span id="kcCheckDeclHeader_cusk"><span class="annot"><span class="annottext">kcCheckDeclHeader_cusk :: Name
-&gt; TyConFlavour TyCon
-&gt; LHsQTyVars GhcRn
-&gt; TcM ContextKind
-&gt; TcM TyCon
</span><a href="GHC.Tc.Gen.HsType.html#kcCheckDeclHeader_cusk"><span class="hs-identifier hs-var hs-var">kcCheckDeclHeader_cusk</span></a></span></span><span> </span><span id="local-6989586621683077494"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077494"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621683077495"><span class="annot"><span class="annottext">TyConFlavour TyCon
</span><a href="#local-6989586621683077495"><span class="hs-identifier hs-var">flav</span></a></span></span><span>
</span><span id="line-2429"></span><span>              </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsQTvs"><span class="hs-identifier hs-type">HsQTvs</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsq_ext :: forall pass. LHsQTyVars pass -&gt; XHsQTvs pass
</span><a href="Language.Haskell.Syntax.Type.html#hsq_ext"><span class="hs-identifier hs-var">hsq_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683077498"><span class="annot"><span class="annottext">XHsQTvs GhcRn
</span><a href="#local-6989586621683077498"><span class="hs-identifier hs-var">kv_ns</span></a></span></span><span>
</span><span id="line-2430"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hsq_explicit :: forall pass.
LHsQTyVars pass -&gt; [LHsTyVarBndr (HsBndrVis pass) pass]
</span><a href="Language.Haskell.Syntax.Type.html#hsq_explicit"><span class="hs-identifier hs-var">hsq_explicit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683077500"><span class="annot"><span class="annottext">[LHsTyVarBndr (HsBndrVis GhcRn) GhcRn]
</span><a href="#local-6989586621683077500"><span class="hs-identifier hs-var">hs_tvs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683077501"><span class="annot"><span class="annottext">TcM ContextKind
</span><a href="#local-6989586621683077501"><span class="hs-identifier hs-var">kc_res_ki</span></a></span></span><span>
</span><span id="line-2431"></span><span>  </span><span class="hs-comment">-- CUSK case</span><span>
</span><span id="line-2432"></span><span>  </span><span class="hs-comment">-- See Note [Required, Specified, and Inferred for types] in GHC.Tc.TyCl</span><span>
</span><span id="line-2433"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TyConFlavour TyCon -&gt; TcM TyCon -&gt; TcM TyCon
forall tc a. Name -&gt; TyConFlavour tc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.HsType.html#addTyConFlavCtxt"><span class="hs-identifier hs-var">addTyConFlavCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077494"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">TyConFlavour TyCon
</span><a href="#local-6989586621683077495"><span class="hs-identifier hs-var">flav</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM TyCon -&gt; TcM TyCon) -&gt; TcM TyCon -&gt; TcM TyCon
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2434"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683077502"><span class="annot"><a href="#local-6989586621683077502"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon -&gt; IOEnv (Env TcGblEnv TcLclEnv) SkolemInfo
forall (m :: * -&gt; *). MonadIO m =&gt; SkolemInfoAnon -&gt; m SkolemInfo
</span><a href="GHC.Tc.Types.Origin.html#mkSkolemInfo"><span class="hs-identifier hs-var">mkSkolemInfo</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon
</span><a href="#local-6989586621683077503"><span class="hs-identifier hs-var">skol_info_anon</span></a></span><span>
</span><span id="line-2435"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077504"><span class="annot"><a href="#local-6989586621683077504"><span class="hs-identifier hs-var">tclvl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077505"><span class="annot"><a href="#local-6989586621683077505"><span class="hs-identifier hs-var">wanted</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077506"><span class="annot"><a href="#local-6989586621683077506"><span class="hs-identifier hs-var">scoped_kvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077507"><span class="annot"><a href="#local-6989586621683077507"><span class="hs-identifier hs-var">tc_bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077508"><span class="annot"><a href="#local-6989586621683077508"><span class="hs-identifier hs-var">res_kind</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2436"></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.html#pushLevelAndSolveEqualitiesX"><span class="hs-identifier hs-type">pushLevelAndSolveEqualitiesX</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;kcCheckDeclHeader_cusk&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2437"></span><span>              </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindImplicitTKBndrs_Q_Skol"><span class="hs-identifier hs-type">bindImplicitTKBndrs_Q_Skol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077502"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077498"><span class="hs-identifier hs-type">kv_ns</span></a></span><span>                      </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2438"></span><span>              </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindExplicitTKBndrs_Q_Skol"><span class="hs-identifier hs-type">bindExplicitTKBndrs_Q_Skol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077502"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077509"><span class="hs-identifier hs-type">ctxt_kind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077500"><span class="hs-identifier hs-type">hs_tvs</span></a></span><span>           </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2439"></span><span>              </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#newExpectedKind"><span class="hs-identifier hs-type">newExpectedKind</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="#local-6989586621683077501"><span class="hs-identifier hs-type">kc_res_ki</span></a></span><span>
</span><span id="line-2440"></span><span>
</span><span id="line-2441"></span><span>           </span><span class="hs-comment">-- Now, because we're in a CUSK,</span><span>
</span><span id="line-2442"></span><span>           </span><span class="hs-comment">-- we quantify over the mentioned kind vars</span><span>
</span><span id="line-2443"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683077511"><span class="annot"><a href="#local-6989586621683077511"><span class="hs-identifier hs-var hs-var">spec_req_tkvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683077506"><span class="hs-identifier hs-var">scoped_kvs</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar] -&gt; [TcTyVar] -&gt; [TcTyVar]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[VarBndr TcTyVar (HsBndrVis GhcRn)] -&gt; [TcTyVar]
forall tv argf. [VarBndr tv argf] -&gt; [tv]
</span><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-var">binderVars</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr TcTyVar (HsBndrVis GhcRn)]
</span><a href="#local-6989586621683077507"><span class="hs-identifier hs-var">tc_bndrs</span></a></span><span>
</span><span id="line-2444"></span><span>             </span><span id="local-6989586621683077513"><span class="annot"><a href="#local-6989586621683077513"><span class="hs-identifier hs-var hs-var">all_kinds</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077508"><span class="hs-identifier hs-var">res_kind</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; [Type]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">(TcTyVar -&gt; Type) -&gt; [TcTyVar] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Type
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683077511"><span class="hs-identifier hs-var">spec_req_tkvs</span></a></span><span>
</span><span id="line-2445"></span><span>
</span><span id="line-2446"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683077514"><span class="annot"><a href="#local-6989586621683077514"><span class="hs-identifier hs-var">candidates</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#candidateQTyVarsOfKinds"><span class="hs-identifier hs-type">candidateQTyVarsOfKinds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077513"><span class="hs-identifier hs-type">all_kinds</span></a></span><span>
</span><span id="line-2447"></span><span>             </span><span class="hs-comment">-- 'candidates' are all the variables that we are going to</span><span>
</span><span id="line-2448"></span><span>             </span><span class="hs-comment">-- skolemise and then quantify over.  We do not include spec_req_tvs</span><span>
</span><span id="line-2449"></span><span>             </span><span class="hs-comment">-- because they are /already/ skolems</span><span>
</span><span id="line-2450"></span><span>
</span><span id="line-2451"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683077516"><span class="annot"><a href="#local-6989586621683077516"><span class="hs-identifier hs-var">inferred</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#quantifyTyVars"><span class="hs-identifier hs-type">quantifyTyVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077502"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#DefaultNonStandardTyVars"><span class="hs-identifier hs-type">DefaultNonStandardTyVars</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2452"></span><span>                     </span><span class="annot"><a href="#local-6989586621683077514"><span class="hs-identifier hs-type">candidates</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#delCandidates"><span class="hs-operator hs-type">`delCandidates`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077511"><span class="hs-identifier hs-type">spec_req_tkvs</span></a></span><span>
</span><span id="line-2453"></span><span>                     </span><span class="hs-comment">-- NB: 'inferred' comes back sorted in dependency order</span><span>
</span><span id="line-2454"></span><span>
</span><span id="line-2455"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077520"><span class="annot"><a href="#local-6989586621683077520"><span class="hs-identifier hs-var">scoped_kvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077521"><span class="annot"><a href="#local-6989586621683077521"><span class="hs-identifier hs-var">tc_bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077522"><span class="annot"><a href="#local-6989586621683077522"><span class="hs-identifier hs-var">res_kind</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-type">liftZonkM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2456"></span><span>          </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683077523"><span class="annot"><a href="#local-6989586621683077523"><span class="hs-identifier hs-var">scoped_kvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTyCoVarKind"><span class="hs-identifier hs-type">zonkTyCoVarKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077506"><span class="hs-identifier hs-type">scoped_kvs</span></a></span><span>      </span><span class="hs-comment">-- scoped_kvs and tc_bndrs are skolems,</span><span>
</span><span id="line-2457"></span><span>             </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683077525"><span class="annot"><a href="#local-6989586621683077525"><span class="hs-identifier hs-var">tc_bndrs</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTyCoVarBndrKind"><span class="hs-identifier hs-type">zonkTyCoVarBndrKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077507"><span class="hs-identifier hs-type">tc_bndrs</span></a></span><span>    </span><span class="hs-comment">-- so zonkTyCoVarBndrKind suffices</span><span>
</span><span id="line-2458"></span><span>             </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683077527"><span class="annot"><a href="#local-6989586621683077527"><span class="hs-identifier hs-var">res_kind</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-type">zonkTcType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077508"><span class="hs-identifier hs-type">res_kind</span></a></span><span>
</span><span id="line-2459"></span><span>             </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683077523"><span class="hs-identifier hs-type">scoped_kvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683077525"><span class="hs-identifier hs-type">tc_bndrs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683077527"><span class="hs-identifier hs-type">res_kind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2460"></span><span>
</span><span id="line-2461"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683077528"><span class="annot"><a href="#local-6989586621683077528"><span class="hs-identifier hs-var hs-var">mentioned_kv_set</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; TyVarSet
</span><a href="GHC.Tc.Utils.TcMType.html#candidateKindVars"><span class="hs-identifier hs-var">candidateKindVars</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683077514"><span class="hs-identifier hs-var">candidates</span></a></span><span>
</span><span id="line-2462"></span><span>             </span><span id="local-6989586621683077530"><span class="annot"><a href="#local-6989586621683077530"><span class="hs-identifier hs-var hs-var">specified</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcTyVar] -&gt; [TcTyVar]
</span><a href="GHC.Core.TyCo.FVs.html#scopedSort"><span class="hs-identifier hs-var">scopedSort</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683077520"><span class="hs-identifier hs-var">scoped_kvs</span></a></span><span>
</span><span id="line-2463"></span><span>                                </span><span class="hs-comment">-- NB: maintain the L-R order of scoped_kvs</span><span>
</span><span id="line-2464"></span><span>
</span><span id="line-2465"></span><span>             </span><span id="local-6989586621683077532"><span class="annot"><a href="#local-6989586621683077532"><span class="hs-identifier hs-var hs-var">all_tcbs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">ForAllTyFlag -&gt; [TcTyVar] -&gt; [TyConBinder]
</span><a href="GHC.Core.TyCon.html#mkNamedTyConBinders"><span class="hs-identifier hs-var">mkNamedTyConBinders</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="Language.Haskell.Syntax.Specificity.html#Inferred"><span class="hs-identifier hs-var">Inferred</span></a></span><span>  </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683077516"><span class="hs-identifier hs-var">inferred</span></a></span><span>
</span><span id="line-2466"></span><span>                      </span><span class="annot"><span class="annottext">[TyConBinder] -&gt; [TyConBinder] -&gt; [TyConBinder]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag -&gt; [TcTyVar] -&gt; [TyConBinder]
</span><a href="GHC.Core.TyCon.html#mkNamedTyConBinders"><span class="hs-identifier hs-var">mkNamedTyConBinders</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="Language.Haskell.Syntax.Specificity.html#Specified"><span class="hs-identifier hs-var">Specified</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683077530"><span class="hs-identifier hs-var">specified</span></a></span><span>
</span><span id="line-2467"></span><span>                      </span><span class="annot"><span class="annottext">[TyConBinder] -&gt; [TyConBinder] -&gt; [TyConBinder]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(VarBndr TcTyVar (HsBndrVis GhcRn) -&gt; TyConBinder)
-&gt; [VarBndr TcTyVar (HsBndrVis GhcRn)] -&gt; [TyConBinder]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVarSet -&gt; VarBndr TcTyVar (HsBndrVis GhcRn) -&gt; TyConBinder
</span><a href="GHC.Tc.Gen.HsType.html#mkExplicitTyConBinder"><span class="hs-identifier hs-var">mkExplicitTyConBinder</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarSet
</span><a href="#local-6989586621683077528"><span class="hs-identifier hs-var">mentioned_kv_set</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[VarBndr TcTyVar (HsBndrVis GhcRn)]
</span><a href="#local-6989586621683077521"><span class="hs-identifier hs-var">tc_bndrs</span></a></span><span>
</span><span id="line-2468"></span><span>
</span><span id="line-2469"></span><span>       </span><span class="hs-comment">-- Eta expand if necessary; we are building a PolyTyCon</span><span>
</span><span id="line-2470"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077535"><span class="annot"><a href="#local-6989586621683077535"><span class="hs-identifier hs-var">eta_tcbs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077536"><span class="annot"><a href="#local-6989586621683077536"><span class="hs-identifier hs-var">res_kind</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#etaExpandAlgTyCon"><span class="hs-identifier hs-type">etaExpandAlgTyCon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077495"><span class="hs-identifier hs-type">flav</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077502"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077532"><span class="hs-identifier hs-type">all_tcbs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077522"><span class="hs-identifier hs-type">res_kind</span></a></span><span>
</span><span id="line-2471"></span><span>
</span><span id="line-2472"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683077537"><span class="annot"><a href="#local-6989586621683077537"><span class="hs-identifier hs-var hs-var">all_tv_prs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcTyVar] -&gt; [(Name, TcTyVar)]
</span><a href="GHC.Tc.Utils.TcType.html#mkTyVarNamePairs"><span class="hs-identifier hs-var">mkTyVarNamePairs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683077520"><span class="hs-identifier hs-var">scoped_kvs</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar] -&gt; [TcTyVar] -&gt; [TcTyVar]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[VarBndr TcTyVar (HsBndrVis GhcRn)] -&gt; [TcTyVar]
forall tv argf. [VarBndr tv argf] -&gt; [tv]
</span><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-var">binderVars</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr TcTyVar (HsBndrVis GhcRn)]
</span><a href="#local-6989586621683077521"><span class="hs-identifier hs-var">tc_bndrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2473"></span><span>             </span><span id="local-6989586621683077539"><span class="annot"><a href="#local-6989586621683077539"><span class="hs-identifier hs-var hs-var">final_tcbs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621683077532"><span class="hs-identifier hs-var">all_tcbs</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder] -&gt; [TyConBinder] -&gt; [TyConBinder]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#chkAppend"><span class="hs-operator hs-var">`chkAppend`</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621683077535"><span class="hs-identifier hs-var">eta_tcbs</span></a></span><span>
</span><span id="line-2474"></span><span>             </span><span id="local-6989586621683077541"><span class="annot"><a href="#local-6989586621683077541"><span class="hs-identifier hs-var hs-var">tycon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
-&gt; [TyConBinder]
-&gt; Type
-&gt; [(Name, TcTyVar)]
-&gt; Bool
-&gt; TyConFlavour TyCon
-&gt; TyCon
</span><a href="GHC.Core.TyCon.html#mkTcTyCon"><span class="hs-identifier hs-var">mkTcTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077494"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621683077539"><span class="hs-identifier hs-var">final_tcbs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077536"><span class="hs-identifier hs-var">res_kind</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, TcTyVar)]
</span><a href="#local-6989586621683077537"><span class="hs-identifier hs-var">all_tv_prs</span></a></span><span>
</span><span id="line-2475"></span><span>                               </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-comment">-- Make a PolyTcTyCon, fully generalised</span><span>
</span><span id="line-2476"></span><span>                               </span><span class="annot"><span class="annottext">TyConFlavour TyCon
</span><a href="#local-6989586621683077495"><span class="hs-identifier hs-var">flav</span></a></span><span>
</span><span id="line-2477"></span><span>
</span><span id="line-2478"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.html#reportUnsolvedEqualities"><span class="hs-identifier hs-type">reportUnsolvedEqualities</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077502"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-type">binderVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077539"><span class="hs-identifier hs-type">final_tcbs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2479"></span><span>                                  </span><span class="annot"><a href="#local-6989586621683077504"><span class="hs-identifier hs-type">tclvl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077505"><span class="hs-identifier hs-type">wanted</span></a></span><span>
</span><span id="line-2480"></span><span>
</span><span id="line-2481"></span><span>         </span><span class="hs-comment">-- If the ordering from</span><span>
</span><span id="line-2482"></span><span>         </span><span class="hs-comment">-- Note [Required, Specified, and Inferred for types] in GHC.Tc.TyCl</span><span>
</span><span id="line-2483"></span><span>         </span><span class="hs-comment">-- doesn't work, we catch it here, before an error cascade</span><span>
</span><span id="line-2484"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Validity.html#checkTyConTelescope"><span class="hs-identifier hs-type">checkTyConTelescope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077541"><span class="hs-identifier hs-type">tycon</span></a></span><span>
</span><span id="line-2485"></span><span>
</span><span id="line-2486"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;kcCheckDeclHeader_cusk &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2487"></span><span>         </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;name&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077494"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-2488"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;candidates&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077514"><span class="hs-identifier hs-type">candidates</span></a></span><span>
</span><span id="line-2489"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;mentioned_kv_set&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077528"><span class="hs-identifier hs-type">mentioned_kv_set</span></a></span><span>
</span><span id="line-2490"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;kv_ns&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077498"><span class="hs-identifier hs-type">kv_ns</span></a></span><span>
</span><span id="line-2491"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;hs_tvs&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077500"><span class="hs-identifier hs-type">hs_tvs</span></a></span><span>
</span><span id="line-2492"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;scoped_kvs&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077520"><span class="hs-identifier hs-type">scoped_kvs</span></a></span><span>
</span><span id="line-2493"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;spec_req_tvs&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html#pprTyVars"><span class="hs-identifier hs-type">pprTyVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077511"><span class="hs-identifier hs-type">spec_req_tkvs</span></a></span><span>
</span><span id="line-2494"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;all_kinds&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077513"><span class="hs-identifier hs-type">all_kinds</span></a></span><span>
</span><span id="line-2495"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc_tvs&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html#pprTyVars"><span class="hs-identifier hs-type">pprTyVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-type">binderVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077521"><span class="hs-identifier hs-type">tc_bndrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2496"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;res_kind&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077536"><span class="hs-identifier hs-type">res_kind</span></a></span><span>
</span><span id="line-2497"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;inferred&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077516"><span class="hs-identifier hs-type">inferred</span></a></span><span>
</span><span id="line-2498"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;specified&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077530"><span class="hs-identifier hs-type">specified</span></a></span><span>
</span><span id="line-2499"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;final_tcbs&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077539"><span class="hs-identifier hs-type">final_tcbs</span></a></span><span>
</span><span id="line-2500"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;mkTyConKind final_tc_bndrs res_kind&quot;</span></span><span>
</span><span id="line-2501"></span><span>                </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#mkTyConKind"><span class="hs-identifier hs-type">mkTyConKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077539"><span class="hs-identifier hs-type">final_tcbs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077536"><span class="hs-identifier hs-type">res_kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2502"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;all_tv_prs&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077537"><span class="hs-identifier hs-type">all_tv_prs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2503"></span><span>
</span><span id="line-2504"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683077541"><span class="hs-identifier hs-type">tycon</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2505"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2506"></span><span>    </span><span id="local-6989586621683077503"><span class="annot"><span class="annottext">skol_info_anon :: SkolemInfoAnon
</span><a href="#local-6989586621683077503"><span class="hs-identifier hs-var hs-var">skol_info_anon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyConFlavour TyCon -&gt; Name -&gt; SkolemInfoAnon
</span><a href="GHC.Tc.Types.Origin.html#TyConSkol"><span class="hs-identifier hs-var">TyConSkol</span></a></span><span> </span><span class="annot"><span class="annottext">TyConFlavour TyCon
</span><a href="#local-6989586621683077495"><span class="hs-identifier hs-var">flav</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077494"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-2507"></span><span>    </span><span id="local-6989586621683077509"><span class="annot"><span class="annottext">ctxt_kind :: ContextKind
</span><a href="#local-6989586621683077509"><span class="hs-identifier hs-var hs-var">ctxt_kind</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyConFlavour TyCon -&gt; Bool
forall tc. TyConFlavour tc -&gt; Bool
</span><a href="GHC.Core.TyCon.html#tcFlavourIsOpen"><span class="hs-identifier hs-var">tcFlavourIsOpen</span></a></span><span> </span><span class="annot"><span class="annottext">TyConFlavour TyCon
</span><a href="#local-6989586621683077495"><span class="hs-identifier hs-var">flav</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#TheKind"><span class="hs-identifier hs-var">TheKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span>
</span><span id="line-2508"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#AnyKind"><span class="hs-identifier hs-var">AnyKind</span></a></span><span>
</span><span id="line-2509"></span><span>
</span><span id="line-2510"></span><span class="annot"><span class="hs-comment">-- | Create a TyConBinder for a user-written type variable binder.</span></span><span>
</span><span id="line-2511"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#mkExplicitTyConBinder"><span class="hs-identifier hs-type">mkExplicitTyConBinder</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#TyCoVarSet"><span class="hs-identifier hs-type">TyCoVarSet</span></a></span><span> </span><span class="hs-comment">-- variables that are used dependently</span><span>
</span><span id="line-2512"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#VarBndr"><span class="hs-identifier hs-type">VarBndr</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsBndrVis"><span class="hs-identifier hs-type">HsBndrVis</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2513"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyConBinder"><span class="hs-identifier hs-type">TyConBinder</span></a></span><span>
</span><span id="line-2514"></span><span id="mkExplicitTyConBinder"><span class="annot"><span class="annottext">mkExplicitTyConBinder :: TyVarSet -&gt; VarBndr TcTyVar (HsBndrVis GhcRn) -&gt; TyConBinder
</span><a href="GHC.Tc.Gen.HsType.html#mkExplicitTyConBinder"><span class="hs-identifier hs-var hs-var">mkExplicitTyConBinder</span></a></span></span><span> </span><span id="local-6989586621683077550"><span class="annot"><span class="annottext">TyVarSet
</span><a href="#local-6989586621683077550"><span class="hs-identifier hs-var">dep_set</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span id="local-6989586621683077551"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077551"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621683077552"><span class="annot"><span class="annottext">HsBndrVis GhcRn
</span><a href="#local-6989586621683077552"><span class="hs-identifier hs-var">flag</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2515"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsBndrVis GhcRn
</span><a href="#local-6989586621683077552"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2516"></span><span>    </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsBndrRequired"><span class="hs-identifier hs-type">HsBndrRequired</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyVarSet -&gt; TcTyVar -&gt; TyConBinder
</span><a href="GHC.Core.TyCon.html#mkRequiredTyConBinder"><span class="hs-identifier hs-var">mkRequiredTyConBinder</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarSet
</span><a href="#local-6989586621683077550"><span class="hs-identifier hs-var">dep_set</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077551"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-2517"></span><span>    </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsBndrInvisible"><span class="hs-identifier hs-type">HsBndrInvisible</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag -&gt; TcTyVar -&gt; TyConBinder
</span><a href="GHC.Core.TyCon.html#mkNamedTyConBinder"><span class="hs-identifier hs-var">mkNamedTyConBinder</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="Language.Haskell.Syntax.Specificity.html#Specified"><span class="hs-identifier hs-var">Specified</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077551"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-2518"></span><span>
</span><span id="line-2519"></span><span class="hs-comment">-- | Kind-check a 'LHsQTyVars'. Used in 'inferInitialKind' (for tycon kinds and</span><span>
</span><span id="line-2520"></span><span class="hs-comment">-- other kinds).</span><span>
</span><span id="line-2521"></span><span class="hs-comment">--</span><span>
</span><span id="line-2522"></span><span class="hs-comment">-- This function does not do telescope checking.</span><span>
</span><span id="line-2523"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#kcInferDeclHeader"><span class="hs-identifier hs-type">kcInferDeclHeader</span></a></span><span>
</span><span id="line-2524"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>               </span><span class="annot"><span class="hs-comment">-- ^ of the thing being checked</span></span><span>
</span><span id="line-2525"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TyConFlavour"><span class="hs-identifier hs-type">TyConFlavour</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ What sort of 'TyCon' is being checked</span></span><span>
</span><span id="line-2526"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsQTyVars"><span class="hs-identifier hs-type">LHsQTyVars</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-2527"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#ContextKind"><span class="hs-identifier hs-type">ContextKind</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ The result kind</span></span><span>
</span><span id="line-2528"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#MonoTcTyCon"><span class="hs-identifier hs-type">MonoTcTyCon</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ A suitably-kinded non-generalized TcTyCon</span></span><span>
</span><span id="line-2529"></span><span id="kcInferDeclHeader"><span class="annot"><span class="annottext">kcInferDeclHeader :: Name
-&gt; TyConFlavour TyCon
-&gt; LHsQTyVars GhcRn
-&gt; TcM ContextKind
-&gt; TcM TyCon
</span><a href="GHC.Tc.Gen.HsType.html#kcInferDeclHeader"><span class="hs-identifier hs-var hs-var">kcInferDeclHeader</span></a></span></span><span> </span><span id="local-6989586621683077558"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077558"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621683077559"><span class="annot"><span class="annottext">TyConFlavour TyCon
</span><a href="#local-6989586621683077559"><span class="hs-identifier hs-var">flav</span></a></span></span><span>
</span><span id="line-2530"></span><span>              </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsQTvs"><span class="hs-identifier hs-type">HsQTvs</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsq_ext :: forall pass. LHsQTyVars pass -&gt; XHsQTvs pass
</span><a href="Language.Haskell.Syntax.Type.html#hsq_ext"><span class="hs-identifier hs-var">hsq_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683077560"><span class="annot"><span class="annottext">XHsQTvs GhcRn
</span><a href="#local-6989586621683077560"><span class="hs-identifier hs-var">kv_ns</span></a></span></span><span>
</span><span id="line-2531"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hsq_explicit :: forall pass.
LHsQTyVars pass -&gt; [LHsTyVarBndr (HsBndrVis pass) pass]
</span><a href="Language.Haskell.Syntax.Type.html#hsq_explicit"><span class="hs-identifier hs-var">hsq_explicit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683077561"><span class="annot"><span class="annottext">[LHsTyVarBndr (HsBndrVis GhcRn) GhcRn]
</span><a href="#local-6989586621683077561"><span class="hs-identifier hs-var">hs_bndrs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683077562"><span class="annot"><span class="annottext">TcM ContextKind
</span><a href="#local-6989586621683077562"><span class="hs-identifier hs-var">kc_res_ki</span></a></span></span><span>
</span><span id="line-2532"></span><span>  </span><span class="hs-comment">-- No standalone kind signature and no CUSK.</span><span>
</span><span id="line-2533"></span><span>  </span><span class="hs-comment">-- See Note [Required, Specified, and Inferred for types] in GHC.Tc.TyCl</span><span>
</span><span id="line-2534"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TyConFlavour TyCon -&gt; TcM TyCon -&gt; TcM TyCon
forall tc a. Name -&gt; TyConFlavour tc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.HsType.html#addTyConFlavCtxt"><span class="hs-identifier hs-var">addTyConFlavCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077558"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">TyConFlavour TyCon
</span><a href="#local-6989586621683077559"><span class="hs-identifier hs-var">flav</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM TyCon -&gt; TcM TyCon) -&gt; TcM TyCon -&gt; TcM TyCon
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2535"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [LHsTyVarBndr (HsBndrVis GhcRn) GhcRn] -&gt; TcM ()
</span><a href="GHC.Tc.Gen.HsType.html#rejectInvisibleBinders"><span class="hs-identifier hs-var">rejectInvisibleBinders</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077558"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsTyVarBndr (HsBndrVis GhcRn) GhcRn]
</span><a href="#local-6989586621683077561"><span class="hs-identifier hs-var">hs_bndrs</span></a></span><span>
</span><span id="line-2536"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077564"><span class="annot"><a href="#local-6989586621683077564"><span class="hs-identifier hs-var">scoped_kvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077565"><span class="annot"><a href="#local-6989586621683077565"><span class="hs-identifier hs-var">tc_bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077566"><span class="annot"><a href="#local-6989586621683077566"><span class="hs-identifier hs-var">res_kind</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2537"></span><span>           </span><span class="hs-comment">-- Why bindImplicitTKBndrs_Q_Tv which uses newTyVarTyVar?</span><span>
</span><span id="line-2538"></span><span>           </span><span class="hs-comment">-- See Note [Inferring kinds for type declarations] in GHC.Tc.TyCl</span><span>
</span><span id="line-2539"></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsQTvsRn
-&gt; TcM ([VarBndr TcTyVar (HsBndrVis GhcRn)], Type)
-&gt; TcM ([TcTyVar], ([VarBndr TcTyVar (HsBndrVis GhcRn)], Type))
forall a. HsQTvsRn -&gt; TcM a -&gt; TcM ([TcTyVar], a)
</span><a href="GHC.Tc.Gen.HsType.html#bindImplicitTKBndrs_Q_Tv"><span class="hs-identifier hs-var">bindImplicitTKBndrs_Q_Tv</span></a></span><span> </span><span class="annot"><span class="annottext">HsQTvsRn
XHsQTvs GhcRn
</span><a href="#local-6989586621683077560"><span class="hs-identifier hs-var">kv_ns</span></a></span><span>              </span><span class="annot"><span class="annottext">(TcM ([VarBndr TcTyVar (HsBndrVis GhcRn)], Type)
 -&gt; TcM ([TcTyVar], ([VarBndr TcTyVar (HsBndrVis GhcRn)], Type)))
-&gt; TcM ([VarBndr TcTyVar (HsBndrVis GhcRn)], Type)
-&gt; TcM ([TcTyVar], ([VarBndr TcTyVar (HsBndrVis GhcRn)], Type))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2540"></span><span>              </span><span class="annot"><span class="annottext">ContextKind
-&gt; [LHsTyVarBndr (HsBndrVis GhcRn) GhcRn]
-&gt; TcM Type
-&gt; TcM ([VarBndr TcTyVar (HsBndrVis GhcRn)], Type)
forall flag a.
OutputableBndrFlag flag 'Renamed =&gt;
ContextKind
-&gt; [LHsTyVarBndr flag GhcRn]
-&gt; TcM a
-&gt; TcM ([VarBndr TcTyVar flag], a)
</span><a href="GHC.Tc.Gen.HsType.html#bindExplicitTKBndrs_Q_Tv"><span class="hs-identifier hs-var">bindExplicitTKBndrs_Q_Tv</span></a></span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="#local-6989586621683077567"><span class="hs-identifier hs-var">ctxt_kind</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsTyVarBndr (HsBndrVis GhcRn) GhcRn]
</span><a href="#local-6989586621683077561"><span class="hs-identifier hs-var">hs_bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM Type -&gt; TcM ([VarBndr TcTyVar (HsBndrVis GhcRn)], Type))
-&gt; TcM Type -&gt; TcM ([VarBndr TcTyVar (HsBndrVis GhcRn)], Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2541"></span><span>              </span><span class="annot"><span class="annottext">ContextKind -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#newExpectedKind"><span class="hs-identifier hs-var">newExpectedKind</span></a></span><span> </span><span class="annot"><span class="annottext">(ContextKind -&gt; TcM Type) -&gt; TcM ContextKind -&gt; TcM Type
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TcM ContextKind
</span><a href="#local-6989586621683077562"><span class="hs-identifier hs-var">kc_res_ki</span></a></span><span>
</span><span id="line-2542"></span><span>              </span><span class="hs-comment">-- Why &quot;_Tv&quot; not &quot;_Skol&quot;? See third wrinkle in</span><span>
</span><span id="line-2543"></span><span>              </span><span class="hs-comment">-- Note [Inferring kinds for type declarations] in GHC.Tc.TyCl,</span><span>
</span><span id="line-2544"></span><span>
</span><span id="line-2545"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span>   </span><span class="hs-comment">-- NB: Don't add scoped_kvs to tyConTyVars, because they</span><span>
</span><span id="line-2546"></span><span>               </span><span class="hs-comment">-- might unify with kind vars in other types in a mutually</span><span>
</span><span id="line-2547"></span><span>               </span><span class="hs-comment">-- recursive group.</span><span>
</span><span id="line-2548"></span><span>               </span><span class="hs-comment">-- See Note [Inferring kinds for type declarations] in GHC.Tc.TyCl</span><span>
</span><span id="line-2549"></span><span>
</span><span id="line-2550"></span><span>             </span><span id="local-6989586621683077568"><span class="annot"><a href="#local-6989586621683077568"><span class="hs-identifier hs-var hs-var">tc_tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[VarBndr TcTyVar (HsBndrVis GhcRn)] -&gt; [TcTyVar]
forall tv argf. [VarBndr tv argf] -&gt; [tv]
</span><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-var">binderVars</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr TcTyVar (HsBndrVis GhcRn)]
</span><a href="#local-6989586621683077565"><span class="hs-identifier hs-var">tc_bndrs</span></a></span><span>
</span><span id="line-2551"></span><span>               </span><span class="hs-comment">-- Discard visibility flags. We made sure all of them are HsBndrRequired</span><span>
</span><span id="line-2552"></span><span>               </span><span class="hs-comment">-- by the call to rejectInvisibleBinders above.</span><span>
</span><span id="line-2553"></span><span>
</span><span id="line-2554"></span><span>             </span><span id="local-6989586621683077569"><span class="annot"><a href="#local-6989586621683077569"><span class="hs-identifier hs-var hs-var">tc_binders</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcTyVar] -&gt; [TyConBinder]
</span><a href="GHC.Core.TyCon.html#mkAnonTyConBinders"><span class="hs-identifier hs-var">mkAnonTyConBinders</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683077568"><span class="hs-identifier hs-var">tc_tvs</span></a></span><span>
</span><span id="line-2555"></span><span>               </span><span class="hs-comment">-- This has to be mkAnonTyConBinder!</span><span>
</span><span id="line-2556"></span><span>               </span><span class="hs-comment">-- See Note [No polymorphic recursion in type decls] in GHC.Tc.TyCl</span><span>
</span><span id="line-2557"></span><span>               </span><span class="hs-comment">--</span><span>
</span><span id="line-2558"></span><span>               </span><span class="hs-comment">-- Also, note that tc_binders has the tyvars from only the</span><span>
</span><span id="line-2559"></span><span>               </span><span class="hs-comment">-- user-written type variable binders.</span><span>
</span><span id="line-2560"></span><span>               </span><span class="hs-comment">-- See S1 Note [TcTyCon, MonoTcTyCon, and PolyTcTyCon] in GHC.Tc.TyCl</span><span>
</span><span id="line-2561"></span><span>
</span><span id="line-2562"></span><span>             </span><span id="local-6989586621683077571"><span class="annot"><a href="#local-6989586621683077571"><span class="hs-identifier hs-var hs-var">all_tv_prs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcTyVar] -&gt; [(Name, TcTyVar)]
</span><a href="GHC.Tc.Utils.TcType.html#mkTyVarNamePairs"><span class="hs-identifier hs-var">mkTyVarNamePairs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683077564"><span class="hs-identifier hs-var">scoped_kvs</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar] -&gt; [TcTyVar] -&gt; [TcTyVar]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683077568"><span class="hs-identifier hs-var">tc_tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2563"></span><span>               </span><span class="hs-comment">-- NB: bindExplicitTKBndrs_Q_Tv does not clone;</span><span>
</span><span id="line-2564"></span><span>               </span><span class="hs-comment">--     ditto Implicit</span><span>
</span><span id="line-2565"></span><span>               </span><span class="hs-comment">-- See Note [Cloning for type variable binders]</span><span>
</span><span id="line-2566"></span><span>
</span><span id="line-2567"></span><span>             </span><span id="local-6989586621683077572"><span class="annot"><a href="#local-6989586621683077572"><span class="hs-identifier hs-var hs-var">tycon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
-&gt; [TyConBinder]
-&gt; Type
-&gt; [(Name, TcTyVar)]
-&gt; Bool
-&gt; TyConFlavour TyCon
-&gt; TyCon
</span><a href="GHC.Core.TyCon.html#mkTcTyCon"><span class="hs-identifier hs-var">mkTcTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077558"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621683077569"><span class="hs-identifier hs-var">tc_binders</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077566"><span class="hs-identifier hs-var">res_kind</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, TcTyVar)]
</span><a href="#local-6989586621683077571"><span class="hs-identifier hs-var">all_tv_prs</span></a></span><span>
</span><span id="line-2568"></span><span>                               </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- Make a MonoTcTyCon</span><span>
</span><span id="line-2569"></span><span>                               </span><span class="annot"><span class="annottext">TyConFlavour TyCon
</span><a href="#local-6989586621683077559"><span class="hs-identifier hs-var">flav</span></a></span><span>
</span><span id="line-2570"></span><span>
</span><span id="line-2571"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;kcInferDeclHeader: not-cusk&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2572"></span><span>         </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077558"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077560"><span class="hs-identifier hs-type">kv_ns</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077561"><span class="hs-identifier hs-type">hs_bndrs</span></a></span><span>
</span><span id="line-2573"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077564"><span class="hs-identifier hs-type">scoped_kvs</span></a></span><span>
</span><span id="line-2574"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077568"><span class="hs-identifier hs-type">tc_tvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#mkTyConKind"><span class="hs-identifier hs-type">mkTyConKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077569"><span class="hs-identifier hs-type">tc_binders</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077566"><span class="hs-identifier hs-type">res_kind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2575"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683077572"><span class="hs-identifier hs-type">tycon</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2576"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2577"></span><span>    </span><span id="local-6989586621683077567"><span class="annot"><span class="annottext">ctxt_kind :: ContextKind
</span><a href="#local-6989586621683077567"><span class="hs-identifier hs-var hs-var">ctxt_kind</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyConFlavour TyCon -&gt; Bool
forall tc. TyConFlavour tc -&gt; Bool
</span><a href="GHC.Core.TyCon.html#tcFlavourIsOpen"><span class="hs-identifier hs-var">tcFlavourIsOpen</span></a></span><span> </span><span class="annot"><span class="annottext">TyConFlavour TyCon
</span><a href="#local-6989586621683077559"><span class="hs-identifier hs-var">flav</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#TheKind"><span class="hs-identifier hs-var">TheKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span>
</span><span id="line-2578"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#AnyKind"><span class="hs-identifier hs-var">AnyKind</span></a></span><span>
</span><span id="line-2579"></span><span>
</span><span id="line-2580"></span><span class="hs-comment">-- rejectInvisibleBinders is called on on the inference code path; there is</span><span>
</span><span id="line-2581"></span><span class="hs-comment">-- no standalone kind signature, nor CUSK.</span><span>
</span><span id="line-2582"></span><span class="hs-comment">-- See Note [No inference for invisible binders in type decls] in GHC.Tc.TyCl</span><span>
</span><span id="line-2583"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#rejectInvisibleBinders"><span class="hs-identifier hs-type">rejectInvisibleBinders</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsTyVarBndr"><span class="hs-identifier hs-type">LHsTyVarBndr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsBndrVis"><span class="hs-identifier hs-type">HsBndrVis</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2584"></span><span id="rejectInvisibleBinders"><span class="annot"><span class="annottext">rejectInvisibleBinders :: Name -&gt; [LHsTyVarBndr (HsBndrVis GhcRn) GhcRn] -&gt; TcM ()
</span><a href="GHC.Tc.Gen.HsType.html#rejectInvisibleBinders"><span class="hs-identifier hs-var hs-var">rejectInvisibleBinders</span></a></span></span><span> </span><span id="local-6989586621683077573"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077573"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsTyVarBndr (HsBndrVis GhcRn) GhcRn)
 -&gt; TcM ())
-&gt; [GenLocated SrcSpanAnnA (HsTyVarBndr (HsBndrVis GhcRn) GhcRn)]
-&gt; TcM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">LHsTyVarBndr (HsBndrVis GhcRn) GhcRn -&gt; TcM ()
GenLocated SrcSpanAnnA (HsTyVarBndr (HsBndrVis GhcRn) GhcRn)
-&gt; TcM ()
</span><a href="#local-6989586621683077575"><span class="hs-identifier hs-var">check_bndr_vis</span></a></span><span>
</span><span id="line-2585"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2586"></span><span>    </span><span class="annot"><a href="#local-6989586621683077575"><span class="hs-identifier hs-type">check_bndr_vis</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsTyVarBndr"><span class="hs-identifier hs-type">LHsTyVarBndr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsBndrVis"><span class="hs-identifier hs-type">HsBndrVis</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2587"></span><span>    </span><span id="local-6989586621683077575"><span class="annot"><span class="annottext">check_bndr_vis :: LHsTyVarBndr (HsBndrVis GhcRn) GhcRn -&gt; TcM ()
</span><a href="#local-6989586621683077575"><span class="hs-identifier hs-var hs-var">check_bndr_vis</span></a></span></span><span> </span><span id="local-6989586621683077576"><span class="annot"><span class="annottext">LHsTyVarBndr (HsBndrVis GhcRn) GhcRn
</span><a href="#local-6989586621683077576"><span class="hs-identifier hs-var">bndr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2588"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; TcM () -&gt; TcM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsBndrVis GhcRn -&gt; Bool
forall pass. HsBndrVis pass -&gt; Bool
</span><a href="Language.Haskell.Syntax.Type.html#isHsBndrInvisible"><span class="hs-identifier hs-var">isHsBndrInvisible</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsTyVarBndr (HsBndrVis GhcRn) GhcRn -&gt; HsBndrVis GhcRn
forall flag (pass :: Pass). HsTyVarBndr flag (GhcPass pass) -&gt; flag
</span><a href="GHC.Hs.Type.html#hsTyVarBndrFlag"><span class="hs-identifier hs-var">hsTyVarBndrFlag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsTyVarBndr (HsBndrVis GhcRn) GhcRn)
-&gt; HsTyVarBndr (HsBndrVis GhcRn) GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsTyVarBndr (HsBndrVis GhcRn) GhcRn
GenLocated SrcSpanAnnA (HsTyVarBndr (HsBndrVis GhcRn) GhcRn)
</span><a href="#local-6989586621683077576"><span class="hs-identifier hs-var">bndr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM () -&gt; TcM ()) -&gt; TcM () -&gt; TcM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2589"></span><span>        </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; LHsTyVarBndr (HsBndrVis GhcRn) GhcRn -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnInvisBndrWithoutSig"><span class="hs-identifier hs-var">TcRnInvisBndrWithoutSig</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077573"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">LHsTyVarBndr (HsBndrVis GhcRn) GhcRn
</span><a href="#local-6989586621683077576"><span class="hs-identifier hs-var">bndr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2590"></span><span>
</span><span id="line-2591"></span><span class="hs-comment">-- | Kind-check a declaration header against a standalone kind signature.</span><span>
</span><span id="line-2592"></span><span class="hs-comment">-- See Note [kcCheckDeclHeader_sig]</span><span>
</span><span id="line-2593"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#kcCheckDeclHeader_sig"><span class="hs-identifier hs-type">kcCheckDeclHeader_sig</span></a></span><span>
</span><span id="line-2594"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span>               </span><span class="annot"><span class="hs-comment">-- ^ Standalone kind signature, fully zonked! (zonkTcTypeToType)</span></span><span>
</span><span id="line-2595"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>               </span><span class="annot"><span class="hs-comment">-- ^ of the thing being checked</span></span><span>
</span><span id="line-2596"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TyConFlavour"><span class="hs-identifier hs-type">TyConFlavour</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ What sort of 'TyCon' is being checked</span></span><span>
</span><span id="line-2597"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsQTyVars"><span class="hs-identifier hs-type">LHsQTyVars</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ Binders in the header</span></span><span>
</span><span id="line-2598"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#ContextKind"><span class="hs-identifier hs-type">ContextKind</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ The result kind. AnyKind == no result signature</span></span><span>
</span><span id="line-2599"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#PolyTcTyCon"><span class="hs-identifier hs-type">PolyTcTyCon</span></a></span><span>    </span><span class="hs-comment">-- ^ A suitably-kinded, fully generalised TcTyCon</span><span>
</span><span id="line-2600"></span><span class="hs-comment">-- Postcondition to (kcCheckDeclHeader_sig sig_kind n f hs_tvs kc_res_ki):</span><span>
</span><span id="line-2601"></span><span class="hs-comment">--   kind(returned PolyTcTyCon) = sig_kind</span><span>
</span><span id="line-2602"></span><span class="hs-comment">--</span><span>
</span><span id="line-2603"></span><span id="kcCheckDeclHeader_sig"><span class="annot"><span class="annottext">kcCheckDeclHeader_sig :: Type
-&gt; Name
-&gt; TyConFlavour TyCon
-&gt; LHsQTyVars GhcRn
-&gt; TcM ContextKind
-&gt; TcM TyCon
</span><a href="GHC.Tc.Gen.HsType.html#kcCheckDeclHeader_sig"><span class="hs-identifier hs-var hs-var">kcCheckDeclHeader_sig</span></a></span></span><span> </span><span id="local-6989586621683077581"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077581"><span class="hs-identifier hs-var">sig_kind</span></a></span></span><span> </span><span id="local-6989586621683077582"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077582"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621683077583"><span class="annot"><span class="annottext">TyConFlavour TyCon
</span><a href="#local-6989586621683077583"><span class="hs-identifier hs-var">flav</span></a></span></span><span>
</span><span id="line-2604"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsQTvs"><span class="hs-identifier hs-type">HsQTvs</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsq_ext :: forall pass. LHsQTyVars pass -&gt; XHsQTvs pass
</span><a href="Language.Haskell.Syntax.Type.html#hsq_ext"><span class="hs-identifier hs-var">hsq_ext</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683077584"><span class="annot"><span class="annottext">XHsQTvs GhcRn
</span><a href="#local-6989586621683077584"><span class="hs-identifier hs-var">implicit_nms</span></a></span></span><span>
</span><span id="line-2605"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hsq_explicit :: forall pass.
LHsQTyVars pass -&gt; [LHsTyVarBndr (HsBndrVis pass) pass]
</span><a href="Language.Haskell.Syntax.Type.html#hsq_explicit"><span class="hs-identifier hs-var">hsq_explicit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683077585"><span class="annot"><span class="annottext">[LHsTyVarBndr (HsBndrVis GhcRn) GhcRn]
</span><a href="#local-6989586621683077585"><span class="hs-identifier hs-var">hs_tv_bndrs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683077586"><span class="annot"><span class="annottext">TcM ContextKind
</span><a href="#local-6989586621683077586"><span class="hs-identifier hs-var">kc_res_ki</span></a></span></span><span>
</span><span id="line-2606"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TyConFlavour TyCon -&gt; TcM TyCon -&gt; TcM TyCon
forall tc a. Name -&gt; TyConFlavour tc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.HsType.html#addTyConFlavCtxt"><span class="hs-identifier hs-var">addTyConFlavCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077582"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">TyConFlavour TyCon
</span><a href="#local-6989586621683077583"><span class="hs-identifier hs-var">flav</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM TyCon -&gt; TcM TyCon) -&gt; TcM TyCon -&gt; TcM TyCon
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2607"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683077587"><span class="annot"><a href="#local-6989586621683077587"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon -&gt; IOEnv (Env TcGblEnv TcLclEnv) SkolemInfo
forall (m :: * -&gt; *). MonadIO m =&gt; SkolemInfoAnon -&gt; m SkolemInfo
</span><a href="GHC.Tc.Types.Origin.html#mkSkolemInfo"><span class="hs-identifier hs-var">mkSkolemInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyConFlavour TyCon -&gt; Name -&gt; SkolemInfoAnon
</span><a href="GHC.Tc.Types.Origin.html#TyConSkol"><span class="hs-identifier hs-var">TyConSkol</span></a></span><span> </span><span class="annot"><span class="annottext">TyConFlavour TyCon
</span><a href="#local-6989586621683077583"><span class="hs-identifier hs-var">flav</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077582"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2608"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683077588"><span class="annot"><a href="#local-6989586621683077588"><span class="hs-identifier hs-var hs-var">avoid_occs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; OccName) -&gt; HsQTvsRn -&gt; [OccName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LHsTyVarBndr (HsBndrVis GhcRn) GhcRn] -&gt; [IdP GhcRn]
forall flag (p :: Pass).
[LHsTyVarBndr flag (GhcPass p)] -&gt; [IdP (GhcPass p)]
</span><a href="GHC.Hs.Type.html#hsLTyVarNames"><span class="hs-identifier hs-var">hsLTyVarNames</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsTyVarBndr (HsBndrVis GhcRn) GhcRn]
</span><a href="#local-6989586621683077585"><span class="hs-identifier hs-var">hs_tv_bndrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2609"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077591"><span class="annot"><a href="#local-6989586621683077591"><span class="hs-identifier hs-var">sig_tcbs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier">TcTyConBinder</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077593"><span class="annot"><a href="#local-6989586621683077593"><span class="hs-identifier hs-var">sig_res_kind</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier">Kind</span></span><span class="hs-special">)</span><span>
</span><span id="line-2610"></span><span>             </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#splitTyConKind"><span class="hs-identifier hs-type">splitTyConKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077587"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#emptyInScopeSet"><span class="hs-identifier hs-type">emptyInScopeSet</span></a></span><span>
</span><span id="line-2611"></span><span>                               </span><span class="annot"><a href="#local-6989586621683077588"><span class="hs-identifier hs-type">avoid_occs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077581"><span class="hs-identifier hs-type">sig_kind</span></a></span><span>
</span><span id="line-2612"></span><span>
</span><span id="line-2613"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;kcCheckDeclHeader_sig {&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2614"></span><span>           </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;sig_kind:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077581"><span class="hs-identifier hs-type">sig_kind</span></a></span><span>
</span><span id="line-2615"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;sig_tcbs:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077591"><span class="hs-identifier hs-type">sig_tcbs</span></a></span><span>
</span><span id="line-2616"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;sig_res_kind:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077593"><span class="hs-identifier hs-type">sig_res_kind</span></a></span><span>
</span><span id="line-2617"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;implict_nms:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077584"><span class="hs-identifier hs-type">implicit_nms</span></a></span><span>
</span><span id="line-2618"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;hs_tv_bndrs:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077585"><span class="hs-identifier hs-type">hs_tv_bndrs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2619"></span><span>
</span><span id="line-2620"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077596"><span class="annot"><a href="#local-6989586621683077596"><span class="hs-identifier hs-var">tclvl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077597"><span class="annot"><a href="#local-6989586621683077597"><span class="hs-identifier hs-var">wanted</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077598"><span class="annot"><a href="#local-6989586621683077598"><span class="hs-identifier hs-var">implicit_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077599"><span class="annot"><a href="#local-6989586621683077599"><span class="hs-identifier hs-var">skol_tcbs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077600"><span class="annot"><a href="#local-6989586621683077600"><span class="hs-identifier hs-var">skol_scoped_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077601"><span class="annot"><a href="#local-6989586621683077601"><span class="hs-identifier hs-var">extra_tcbs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077602"><span class="annot"><a href="#local-6989586621683077602"><span class="hs-identifier hs-var">tycon_res_kind</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2621"></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.html#pushLevelAndSolveEqualitiesX"><span class="hs-identifier hs-type">pushLevelAndSolveEqualitiesX</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;kcCheckDeclHeader_sig&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>  </span><span class="hs-comment">-- #16687</span><span>
</span><span id="line-2622"></span><span>              </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindImplicitTKBndrs_Q_Tv"><span class="hs-identifier hs-type">bindImplicitTKBndrs_Q_Tv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077584"><span class="hs-identifier hs-type">implicit_nms</span></a></span><span>                </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>  </span><span class="hs-comment">-- Q means don't clone</span><span>
</span><span id="line-2623"></span><span>              </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#matchUpSigWithDecl"><span class="hs-identifier hs-type">matchUpSigWithDecl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077582"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077591"><span class="hs-identifier hs-type">sig_tcbs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077593"><span class="hs-identifier hs-type">sig_res_kind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077585"><span class="hs-identifier hs-type">hs_tv_bndrs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683077604"><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621683077604"><span class="hs-identifier hs-var">excess_sig_tcbs</span></a></span></span><span> </span><span id="local-6989586621683077605"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077605"><span class="hs-identifier hs-var">sig_res_kind</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2624"></span><span>              </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Kind-check the result kind annotation, if present:</span><span>
</span><span id="line-2625"></span><span>                   </span><span class="hs-comment">--    data T a b :: res_ki where ...</span><span>
</span><span id="line-2626"></span><span>                   </span><span class="hs-comment">--               ^^^^^^^^^</span><span>
</span><span id="line-2627"></span><span>                   </span><span class="hs-comment">-- We do it here because at this point the environment has been</span><span>
</span><span id="line-2628"></span><span>                   </span><span class="hs-comment">-- extended with both 'implicit_tcv_prs' and 'explicit_tv_prs'.</span><span>
</span><span id="line-2629"></span><span>                   </span><span class="hs-comment">--</span><span>
</span><span id="line-2630"></span><span>                   </span><span class="hs-comment">-- Also see Note [Arity of type families and type synonyms]</span><span>
</span><span id="line-2631"></span><span>                 </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683077606"><span class="annot"><a href="#local-6989586621683077606"><span class="hs-identifier hs-var">res_kind</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier">ContextKind</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM ContextKind
</span><a href="#local-6989586621683077586"><span class="hs-identifier hs-var">kc_res_ki</span></a></span><span>
</span><span id="line-2632"></span><span>
</span><span id="line-2633"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683077607"><span class="annot"><a href="#local-6989586621683077607"><span class="hs-identifier hs-var hs-var">sig_res_kind'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyConBinder] -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCon.html#mkTyConKind"><span class="hs-identifier hs-var">mkTyConKind</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621683077604"><span class="hs-identifier hs-var">excess_sig_tcbs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077605"><span class="hs-identifier hs-var">sig_res_kind</span></a></span><span>
</span><span id="line-2634"></span><span>
</span><span id="line-2635"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;kcCheckDeclHeader_sig 2&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-2636"></span><span>                    </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;excess_sig_tcbs&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077604"><span class="hs-identifier hs-type">excess_sig_tcbs</span></a></span><span>
</span><span id="line-2637"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;res_kind&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077606"><span class="hs-identifier hs-type">res_kind</span></a></span><span>
</span><span id="line-2638"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;sig_res_kind'&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077607"><span class="hs-identifier hs-type">sig_res_kind'</span></a></span><span>
</span><span id="line-2639"></span><span>                         </span><span class="hs-special">]</span><span>
</span><span id="line-2640"></span><span>
</span><span id="line-2641"></span><span>                 </span><span class="hs-comment">-- Unify res_ki (from the type declaration) with</span><span>
</span><span id="line-2642"></span><span>                 </span><span class="hs-comment">-- sig_res_kind', the residual kind from the kind signature.</span><span>
</span><span id="line-2643"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#checkExpectedResKind"><span class="hs-identifier hs-type">checkExpectedResKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077607"><span class="hs-identifier hs-type">sig_res_kind'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077606"><span class="hs-identifier hs-type">res_kind</span></a></span><span>
</span><span id="line-2644"></span><span>
</span><span id="line-2645"></span><span>                 </span><span class="hs-comment">-- Add more binders for data/newtype, so the result kind has no arrows</span><span>
</span><span id="line-2646"></span><span>                 </span><span class="hs-comment">-- See Note [Datatype return kinds]</span><span>
</span><span id="line-2647"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621683077604"><span class="hs-identifier hs-type">excess_sig_tcbs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">||</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#needsEtaExpansion"><span class="hs-identifier hs-type">needsEtaExpansion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077583"><span class="hs-identifier hs-type">flav</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2648"></span><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>              </span><span class="annot"><a href="#local-6989586621683077607"><span class="hs-identifier hs-type">sig_res_kind'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2649"></span><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683077604"><span class="hs-identifier hs-type">excess_sig_tcbs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683077605"><span class="hs-identifier hs-type">sig_res_kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2650"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-2651"></span><span>
</span><span id="line-2652"></span><span>
</span><span id="line-2653"></span><span>        </span><span class="hs-comment">-- Check that there are no unsolved equalities</span><span>
</span><span id="line-2654"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683077611"><span class="annot"><a href="#local-6989586621683077611"><span class="hs-identifier hs-var hs-var">all_tcbs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621683077599"><span class="hs-identifier hs-var">skol_tcbs</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder] -&gt; [TyConBinder] -&gt; [TyConBinder]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621683077601"><span class="hs-identifier hs-var">extra_tcbs</span></a></span><span>
</span><span id="line-2655"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.html#reportUnsolvedEqualities"><span class="hs-identifier hs-type">reportUnsolvedEqualities</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077587"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-type">binderVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077611"><span class="hs-identifier hs-type">all_tcbs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683077596"><span class="hs-identifier hs-type">tclvl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077597"><span class="hs-identifier hs-type">wanted</span></a></span><span>
</span><span id="line-2656"></span><span>
</span><span id="line-2657"></span><span>        </span><span class="hs-comment">-- Check that distinct binders map to distinct tyvars (see #20916). For example</span><span>
</span><span id="line-2658"></span><span>        </span><span class="hs-comment">--    type T :: k -&gt; k -&gt; Type</span><span>
</span><span id="line-2659"></span><span>        </span><span class="hs-comment">--    data T (a::p) (b::q) = ...</span><span>
</span><span id="line-2660"></span><span>        </span><span class="hs-comment">-- Here p and q both map to the same kind variable k.  We don't allow this</span><span>
</span><span id="line-2661"></span><span>        </span><span class="hs-comment">-- so we must check that they are distinct.  A similar thing happens</span><span>
</span><span id="line-2662"></span><span>        </span><span class="hs-comment">-- in GHC.Tc.TyCl.swizzleTcTyConBinders during inference.</span><span>
</span><span id="line-2663"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-2664"></span><span>        </span><span class="hs-comment">-- With visible dependent quantification, one of the binders involved</span><span>
</span><span id="line-2665"></span><span>        </span><span class="hs-comment">-- may be explicit.  Consider #24604</span><span>
</span><span id="line-2666"></span><span>        </span><span class="hs-comment">--    type UF :: forall zk -&gt; zk -&gt; Constraint</span><span>
</span><span id="line-2667"></span><span>        </span><span class="hs-comment">--    class UF kk (xb :: k)</span><span>
</span><span id="line-2668"></span><span>        </span><span class="hs-comment">-- Here `k` and `kk` both denote the same variable; but only `k` is implicit</span><span>
</span><span id="line-2669"></span><span>        </span><span class="hs-comment">-- Hence we need to add skol_scoped_tvs</span><span>
</span><span id="line-2670"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683077612"><span class="annot"><a href="#local-6989586621683077612"><span class="hs-identifier hs-var">implicit_tvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-type">liftZonkM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcTyVarsToTcTyVars"><span class="hs-identifier hs-type">zonkTcTyVarsToTcTyVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077598"><span class="hs-identifier hs-type">implicit_tvs</span></a></span><span>
</span><span id="line-2671"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683077614"><span class="annot"><a href="#local-6989586621683077614"><span class="hs-identifier hs-var hs-var">implicit_prs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsQTvsRn
XHsQTvs GhcRn
</span><a href="#local-6989586621683077584"><span class="hs-identifier hs-var">implicit_nms</span></a></span><span> </span><span class="annot"><span class="annottext">HsQTvsRn -&gt; [TcTyVar] -&gt; [(Name, TcTyVar)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-operator hs-var">`zip`</span></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683077612"><span class="hs-identifier hs-var">implicit_tvs</span></a></span><span>
</span><span id="line-2672"></span><span>              </span><span id="local-6989586621683077615"><span class="annot"><a href="#local-6989586621683077615"><span class="hs-identifier hs-var hs-var">dup_chk_prs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Name, TcTyVar)]
</span><a href="#local-6989586621683077614"><span class="hs-identifier hs-var">implicit_prs</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, TcTyVar)] -&gt; [(Name, TcTyVar)] -&gt; [(Name, TcTyVar)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[TcTyVar] -&gt; [(Name, TcTyVar)]
</span><a href="GHC.Tc.Utils.TcType.html#mkTyVarNamePairs"><span class="hs-identifier hs-var">mkTyVarNamePairs</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683077600"><span class="hs-identifier hs-var">skol_scoped_tvs</span></a></span><span>
</span><span id="line-2673"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621683077584"><span class="hs-identifier hs-type">implicit_nms</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>  </span><span class="hs-comment">-- No need if no implicit tyvars</span><span>
</span><span id="line-2674"></span><span>          </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#checkForDuplicateScopedTyVars"><span class="hs-identifier hs-type">checkForDuplicateScopedTyVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077615"><span class="hs-identifier hs-type">dup_chk_prs</span></a></span><span>
</span><span id="line-2675"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#checkForDisconnectedScopedTyVars"><span class="hs-identifier hs-type">checkForDisconnectedScopedTyVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077582"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077583"><span class="hs-identifier hs-type">flav</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077611"><span class="hs-identifier hs-type">all_tcbs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077614"><span class="hs-identifier hs-type">implicit_prs</span></a></span><span>
</span><span id="line-2676"></span><span>
</span><span id="line-2677"></span><span>        </span><span class="hs-comment">-- Swizzle the Names so that the TyCon uses the user-declared implicit names</span><span>
</span><span id="line-2678"></span><span>        </span><span class="hs-comment">-- E.g  type T :: k -&gt; Type</span><span>
</span><span id="line-2679"></span><span>        </span><span class="hs-comment">--      data T (a :: j) = ....</span><span>
</span><span id="line-2680"></span><span>        </span><span class="hs-comment">-- We want the TyConBinders of T to be [j, a::j], not [k, a::k]</span><span>
</span><span id="line-2681"></span><span>        </span><span class="hs-comment">-- Why? So that the TyConBinders of the TyCon will lexically scope over the</span><span>
</span><span id="line-2682"></span><span>        </span><span class="hs-comment">-- associated types and methods of a class.</span><span>
</span><span id="line-2683"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683077617"><span class="annot"><a href="#local-6989586621683077617"><span class="hs-identifier hs-var hs-var">swizzle_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(TcTyVar, Name)] -&gt; VarEnv Name
forall a. [(TcTyVar, a)] -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#mkVarEnv"><span class="hs-identifier hs-var">mkVarEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Name, TcTyVar) -&gt; (TcTyVar, Name))
-&gt; [(Name, TcTyVar)] -&gt; [(TcTyVar, Name)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Name, TcTyVar) -&gt; (TcTyVar, Name)
forall a b. (a, b) -&gt; (b, a)
</span><span class="hs-identifier hs-var">swap</span></span><span> </span><span class="annot"><span class="annottext">[(Name, TcTyVar)]
</span><a href="#local-6989586621683077614"><span class="hs-identifier hs-var">implicit_prs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2684"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621683077619"><span class="annot"><a href="#local-6989586621683077619"><span class="hs-identifier hs-var">subst</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077620"><span class="annot"><a href="#local-6989586621683077620"><span class="hs-identifier hs-var">swizzled_tcbs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapAccumL</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#swizzleTcb"><span class="hs-identifier hs-type">swizzleTcb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077617"><span class="hs-identifier hs-type">swizzle_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#emptySubst"><span class="hs-identifier hs-type">emptySubst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077611"><span class="hs-identifier hs-type">all_tcbs</span></a></span><span>
</span><span id="line-2685"></span><span>              </span><span id="local-6989586621683077623"><span class="annot"><a href="#local-6989586621683077623"><span class="hs-identifier hs-var hs-var">swizzled_kind</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077619"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077602"><span class="hs-identifier hs-var">tycon_res_kind</span></a></span><span>
</span><span id="line-2686"></span><span>              </span><span id="local-6989586621683077624"><span class="annot"><a href="#local-6989586621683077624"><span class="hs-identifier hs-var hs-var">all_tv_prs</span></a></span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcTyVar] -&gt; [(Name, TcTyVar)]
</span><a href="GHC.Tc.Utils.TcType.html#mkTyVarNamePairs"><span class="hs-identifier hs-var">mkTyVarNamePairs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyConBinder] -&gt; [TcTyVar]
forall tv argf. [VarBndr tv argf] -&gt; [tv]
</span><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-var">binderVars</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621683077620"><span class="hs-identifier hs-var">swizzled_tcbs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2687"></span><span>
</span><span id="line-2688"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;kcCheckDeclHeader swizzle&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-2689"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;sig_tcbs =&quot;</span></span><span>       </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077591"><span class="hs-identifier hs-type">sig_tcbs</span></a></span><span>
</span><span id="line-2690"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;implicit_prs =&quot;</span></span><span>   </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077614"><span class="hs-identifier hs-type">implicit_prs</span></a></span><span>
</span><span id="line-2691"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;hs_tv_bndrs =&quot;</span></span><span>    </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077585"><span class="hs-identifier hs-type">hs_tv_bndrs</span></a></span><span>
</span><span id="line-2692"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;all_tcbs =&quot;</span></span><span>       </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html#pprTyVars"><span class="hs-identifier hs-type">pprTyVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-type">binderVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077611"><span class="hs-identifier hs-type">all_tcbs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2693"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;swizzled_tcbs =&quot;</span></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html#pprTyVars"><span class="hs-identifier hs-type">pprTyVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-type">binderVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077620"><span class="hs-identifier hs-type">swizzled_tcbs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2694"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tycon_res_kind =&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077602"><span class="hs-identifier hs-type">tycon_res_kind</span></a></span><span>
</span><span id="line-2695"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;swizzled_kind =&quot;</span></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077623"><span class="hs-identifier hs-type">swizzled_kind</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2696"></span><span>
</span><span id="line-2697"></span><span>        </span><span class="hs-comment">-- Build the final, generalized PolyTcTyCon</span><span>
</span><span id="line-2698"></span><span>        </span><span class="hs-comment">-- NB: all_tcbs must bind the tyvars in the range of all_tv_prs</span><span>
</span><span id="line-2699"></span><span>        </span><span class="hs-comment">--     because the tv_prs is used when (say) typechecking the RHS of</span><span>
</span><span id="line-2700"></span><span>        </span><span class="hs-comment">--     a type synonym.</span><span>
</span><span id="line-2701"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683077625"><span class="annot"><a href="#local-6989586621683077625"><span class="hs-identifier hs-var hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
-&gt; [TyConBinder]
-&gt; Type
-&gt; [(Name, TcTyVar)]
-&gt; Bool
-&gt; TyConFlavour TyCon
-&gt; TyCon
</span><a href="GHC.Core.TyCon.html#mkTcTyCon"><span class="hs-identifier hs-var">mkTcTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077582"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621683077620"><span class="hs-identifier hs-var">swizzled_tcbs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077623"><span class="hs-identifier hs-var">swizzled_kind</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, TcTyVar)]
</span><a href="#local-6989586621683077624"><span class="hs-identifier hs-var">all_tv_prs</span></a></span><span>
</span><span id="line-2702"></span><span>                             </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-comment">-- Make a PolyTcTyCon, fully generalised</span><span>
</span><span id="line-2703"></span><span>                             </span><span class="annot"><span class="annottext">TyConFlavour TyCon
</span><a href="#local-6989586621683077583"><span class="hs-identifier hs-var">flav</span></a></span><span>
</span><span id="line-2704"></span><span>
</span><span id="line-2705"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;kcCheckDeclHeader_sig }&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-2706"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tyConName = &quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#tyConName"><span class="hs-identifier hs-var">tyConName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077625"><span class="hs-identifier hs-type">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2707"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;sig_kind =&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html#debugPprType"><span class="hs-identifier hs-type">debugPprType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077581"><span class="hs-identifier hs-type">sig_kind</span></a></span><span>
</span><span id="line-2708"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tyConKind =&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html#debugPprType"><span class="hs-identifier hs-type">debugPprType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#tyConKind"><span class="hs-identifier hs-var">tyConKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077625"><span class="hs-identifier hs-type">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2709"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tyConBinders = &quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#tyConBinders"><span class="hs-identifier hs-var">tyConBinders</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077625"><span class="hs-identifier hs-type">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2710"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tyConResKind&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html#debugPprType"><span class="hs-identifier hs-type">debugPprType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#tyConResKind"><span class="hs-identifier hs-var">tyConResKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077625"><span class="hs-identifier hs-type">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2711"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-2712"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683077625"><span class="hs-identifier hs-type">tc</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2713"></span><span>
</span><span id="line-2714"></span><span class="hs-comment">-- | Check the result kind annotation on a type constructor against</span><span>
</span><span id="line-2715"></span><span class="hs-comment">-- the corresponding section of the standalone kind signature.</span><span>
</span><span id="line-2716"></span><span class="hs-comment">-- Drops invisible binders that interfere with unification.</span><span>
</span><span id="line-2717"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#checkExpectedResKind"><span class="hs-identifier hs-type">checkExpectedResKind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ the result kind from the separate kind signature</span></span><span>
</span><span id="line-2718"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#ContextKind"><span class="hs-identifier hs-type">ContextKind</span></a></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the result kind from the declaration header</span></span><span>
</span><span id="line-2719"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2720"></span><span id="checkExpectedResKind"><span class="annot"><span class="annottext">checkExpectedResKind :: Type -&gt; ContextKind -&gt; TcM ()
</span><a href="GHC.Tc.Gen.HsType.html#checkExpectedResKind"><span class="hs-identifier hs-var hs-var">checkExpectedResKind</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#AnyKind"><span class="hs-identifier hs-var">AnyKind</span></a></span><span>
</span><span id="line-2721"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcM ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- No signature in the declaration header</span><span>
</span><span id="line-2722"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#checkExpectedResKind"><span class="hs-identifier hs-var">checkExpectedResKind</span></a></span><span> </span><span id="local-6989586621683077629"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077629"><span class="hs-identifier hs-var">sig_kind</span></a></span></span><span> </span><span id="local-6989586621683077630"><span class="annot"><span class="annottext">ContextKind
</span><a href="#local-6989586621683077630"><span class="hs-identifier hs-var">res_ki</span></a></span></span><span>
</span><span id="line-2723"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683077631"><span class="annot"><a href="#local-6989586621683077631"><span class="hs-identifier hs-var">actual_res_ki</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ContextKind -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#newExpectedKind"><span class="hs-identifier hs-var">newExpectedKind</span></a></span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="#local-6989586621683077630"><span class="hs-identifier hs-var">res_ki</span></a></span><span>
</span><span id="line-2724"></span><span>
</span><span id="line-2725"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- Drop invisible binders from sig_kind until they match up</span><span>
</span><span id="line-2726"></span><span>             </span><span class="hs-comment">-- with res_ki.  By analogy with checkExpectedKind.</span><span>
</span><span id="line-2727"></span><span>             </span><span id="local-6989586621683077632"><span class="annot"><a href="#local-6989586621683077632"><span class="hs-identifier hs-var hs-var">n_res_invis_bndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Int
</span><a href="GHC.Core.Type.html#invisibleTyBndrCount"><span class="hs-identifier hs-var">invisibleTyBndrCount</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077631"><span class="hs-identifier hs-var">actual_res_ki</span></a></span><span>
</span><span id="line-2728"></span><span>             </span><span id="local-6989586621683077633"><span class="annot"><a href="#local-6989586621683077633"><span class="hs-identifier hs-var hs-var">n_sig_invis_bndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Int
</span><a href="GHC.Core.Type.html#invisibleTyBndrCount"><span class="hs-identifier hs-var">invisibleTyBndrCount</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077629"><span class="hs-identifier hs-var">sig_kind</span></a></span><span>
</span><span id="line-2729"></span><span>             </span><span id="local-6989586621683077634"><span class="annot"><a href="#local-6989586621683077634"><span class="hs-identifier hs-var hs-var">n_to_inst</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683077633"><span class="hs-identifier hs-var">n_sig_invis_bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683077632"><span class="hs-identifier hs-var">n_res_invis_bndrs</span></a></span><span>
</span><span id="line-2730"></span><span>
</span><span id="line-2731"></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077635"><span class="annot"><a href="#local-6989586621683077635"><span class="hs-identifier hs-var">sig_kind'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.Type.html#splitInvisPiTysN"><span class="hs-identifier hs-type">splitInvisPiTysN</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077634"><span class="hs-identifier hs-type">n_to_inst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077629"><span class="hs-identifier hs-type">sig_kind</span></a></span><span>
</span><span id="line-2732"></span><span>
</span><span id="line-2733"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#discardResult"><span class="hs-identifier hs-type">discardResult</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#unifyKind"><span class="hs-identifier hs-type">unifyKind</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="annot"><a href="#local-6989586621683077635"><span class="hs-identifier hs-type">sig_kind'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077631"><span class="hs-identifier hs-type">actual_res_ki</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2734"></span><span>
</span><span id="line-2735"></span><span id="local-6989586621683075339"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#matchUpSigWithDecl"><span class="hs-identifier hs-type">matchUpSigWithDecl</span></a></span><span>
</span><span id="line-2736"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>                        </span><span class="hs-comment">-- Name of the type constructor for error messages</span><span>
</span><span id="line-2737"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyConBinder"><span class="hs-identifier hs-type">TcTyConBinder</span></a></span><span class="hs-special">]</span><span>             </span><span class="hs-comment">-- TcTyConBinders (with skolem TcTyVars) from the separate kind signature</span><span>
</span><span id="line-2738"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span>                      </span><span class="hs-comment">-- The tail end of the kind signature</span><span>
</span><span id="line-2739"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsTyVarBndr"><span class="hs-identifier hs-type">LHsTyVarBndr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsBndrVis"><span class="hs-identifier hs-type">HsBndrVis</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- User-written binders in decl</span><span>
</span><span id="line-2740"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyConBinder"><span class="hs-identifier hs-type">TcTyConBinder</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075339"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- All user-written binders are in scope</span><span>
</span><span id="line-2741"></span><span>                                           </span><span class="hs-comment">--   Argument is excess TyConBinders and tail kind</span><span>
</span><span id="line-2742"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyConBinder"><span class="hs-identifier hs-type">TcTyConBinder</span></a></span><span class="hs-special">]</span><span>       </span><span class="hs-comment">-- Skolemised binders, with TcTyVars</span><span>
</span><span id="line-2743"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span>             </span><span class="hs-comment">-- Skolem tyvars brought into lexical scope by this matching-up</span><span>
</span><span id="line-2744"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683075339"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">)</span></span><span>
</span><span id="line-2745"></span><span class="hs-comment">-- See Note [Matching a kind signature with a declaration]</span><span>
</span><span id="line-2746"></span><span class="hs-comment">-- Invariant: Length of returned TyConBinders + length of excess TyConBinders</span><span>
</span><span id="line-2747"></span><span class="hs-comment">--            = length of incoming TyConBinders</span><span>
</span><span id="line-2748"></span><span id="matchUpSigWithDecl"><span class="annot"><span class="annottext">matchUpSigWithDecl :: forall a.
Name
-&gt; [TyConBinder]
-&gt; Type
-&gt; [LHsTyVarBndr (HsBndrVis GhcRn) GhcRn]
-&gt; ([TyConBinder] -&gt; Type -&gt; TcM a)
-&gt; TcM ([TyConBinder], [TcTyVar], a)
</span><a href="GHC.Tc.Gen.HsType.html#matchUpSigWithDecl"><span class="hs-identifier hs-var hs-var">matchUpSigWithDecl</span></a></span></span><span> </span><span id="local-6989586621683077665"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077665"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621683077666"><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621683077666"><span class="hs-identifier hs-var">sig_tcbs</span></a></span></span><span> </span><span id="local-6989586621683077667"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077667"><span class="hs-identifier hs-var">sig_res_kind</span></a></span></span><span> </span><span id="local-6989586621683077668"><span class="annot"><span class="annottext">[LHsTyVarBndr (HsBndrVis GhcRn) GhcRn]
</span><a href="#local-6989586621683077668"><span class="hs-identifier hs-var">hs_bndrs</span></a></span></span><span> </span><span id="local-6989586621683077669"><span class="annot"><span class="annottext">[TyConBinder] -&gt; Type -&gt; TcM a
</span><a href="#local-6989586621683077669"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-2749"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst
-&gt; [TyConBinder]
-&gt; [GenLocated SrcSpanAnnA (HsTyVarBndr (HsBndrVis GhcRn) GhcRn)]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ([TyConBinder], [TcTyVar], a)
</span><a href="#local-6989586621683077670"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="GHC.Core.TyCo.Subst.html#emptySubst"><span class="hs-identifier hs-var">emptySubst</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621683077666"><span class="hs-identifier hs-var">sig_tcbs</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsTyVarBndr (HsBndrVis GhcRn) GhcRn]
[GenLocated SrcSpanAnnA (HsTyVarBndr (HsBndrVis GhcRn) GhcRn)]
</span><a href="#local-6989586621683077668"><span class="hs-identifier hs-var">hs_bndrs</span></a></span><span>
</span><span id="line-2750"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2751"></span><span>    </span><span id="local-6989586621683077670"><span class="annot"><span class="annottext">go :: Subst
-&gt; [TyConBinder]
-&gt; [GenLocated SrcSpanAnnA (HsTyVarBndr (HsBndrVis GhcRn) GhcRn)]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ([TyConBinder], [TcTyVar], a)
</span><a href="#local-6989586621683077670"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621683077671"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077671"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621683077672"><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621683077672"><span class="hs-identifier hs-var">tcbs</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2752"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077673"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077673"><span class="hs-identifier hs-var hs-var">subst'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077674"><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621683077674"><span class="hs-identifier hs-var hs-var">tcbs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; [TyConBinder] -&gt; (Subst, [TyConBinder])
</span><a href="GHC.Tc.Gen.HsType.html#substTyConBindersX"><span class="hs-identifier hs-var">substTyConBindersX</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077671"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621683077672"><span class="hs-identifier hs-var">tcbs</span></a></span><span>
</span><span id="line-2753"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683077676"><span class="annot"><a href="#local-6989586621683077676"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TyConBinder] -&gt; Type -&gt; TcM a
</span><a href="#local-6989586621683077669"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621683077674"><span class="hs-identifier hs-var">tcbs'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077673"><span class="hs-identifier hs-var">subst'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077667"><span class="hs-identifier hs-var">sig_res_kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2754"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683077676"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2755"></span><span>
</span><span id="line-2756"></span><span>    </span><span class="annot"><a href="#local-6989586621683077670"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621683077677"><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsTyVarBndr (HsBndrVis GhcRn) GhcRn)]
</span><a href="#local-6989586621683077677"><span class="hs-identifier hs-var">hs_bndrs</span></a></span></span><span>
</span><span id="line-2757"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnMessage
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ([TyConBinder], [TcTyVar], a)
forall a. TcRnMessage -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; [LHsTyVarBndr (HsBndrVis GhcRn) GhcRn] -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnTooManyBinders"><span class="hs-identifier hs-var">TcRnTooManyBinders</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077667"><span class="hs-identifier hs-var">sig_res_kind</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsTyVarBndr (HsBndrVis GhcRn) GhcRn]
[GenLocated SrcSpanAnnA (HsTyVarBndr (HsBndrVis GhcRn) GhcRn)]
</span><a href="#local-6989586621683077677"><span class="hs-identifier hs-var">hs_bndrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2758"></span><span>
</span><span id="line-2759"></span><span>    </span><span class="annot"><a href="#local-6989586621683077670"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621683077679"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077679"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077680"><span class="annot"><span class="annottext">TyConBinder
</span><a href="#local-6989586621683077680"><span class="hs-identifier hs-var">tcb</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683077681"><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621683077681"><span class="hs-identifier hs-var">tcbs'</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683077682"><span class="annot"><span class="annottext">hs_bndrs :: [GenLocated SrcSpanAnnA (HsTyVarBndr (HsBndrVis GhcRn) GhcRn)]
</span><a href="#local-6989586621683077682"><span class="hs-identifier hs-var">hs_bndrs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621683077683"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsTyVarBndr (HsBndrVis GhcRn) GhcRn)
</span><a href="#local-6989586621683077683"><span class="hs-identifier hs-var">hs_bndr</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683077684"><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsTyVarBndr (HsBndrVis GhcRn) GhcRn)]
</span><a href="#local-6989586621683077684"><span class="hs-identifier hs-var">hs_bndrs'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2760"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyConBndrVis -&gt; HsBndrVis GhcRn -&gt; Bool
</span><a href="#local-6989586621683077685"><span class="hs-identifier hs-var">zippable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyConBinder -&gt; TyConBndrVis
forall tv argf. VarBndr tv argf -&gt; argf
</span><a href="GHC.Types.Var.html#binderFlag"><span class="hs-identifier hs-var">binderFlag</span></a></span><span> </span><span class="annot"><span class="annottext">TyConBinder
</span><a href="#local-6989586621683077680"><span class="hs-identifier hs-var">tcb</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsTyVarBndr (HsBndrVis GhcRn) GhcRn -&gt; HsBndrVis GhcRn
forall flag (pass :: Pass). HsTyVarBndr flag (GhcPass pass) -&gt; flag
</span><a href="GHC.Hs.Type.html#hsTyVarBndrFlag"><span class="hs-identifier hs-var">hsTyVarBndrFlag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsTyVarBndr (HsBndrVis GhcRn) GhcRn)
-&gt; HsTyVarBndr (HsBndrVis GhcRn) GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsTyVarBndr (HsBndrVis GhcRn) GhcRn)
</span><a href="#local-6989586621683077683"><span class="hs-identifier hs-var">hs_bndr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2761"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- Visible TyConBinder, so match up with the hs_bndrs</span><span>
</span><span id="line-2762"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span id="local-6989586621683077687"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077687"><span class="hs-identifier hs-var hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621683077688"><span class="annot"><span class="annottext">TyConBndrVis
</span><a href="#local-6989586621683077688"><span class="hs-identifier hs-var hs-var">vis</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyConBinder
</span><a href="#local-6989586621683077680"><span class="hs-identifier hs-var">tcb</span></a></span><span>
</span><span id="line-2763"></span><span>                 </span><span id="local-6989586621683077689"><span class="annot"><span class="annottext">tv' :: TcTyVar
</span><a href="#local-6989586621683077689"><span class="hs-identifier hs-var hs-var hs-var">tv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; TcTyVar -&gt; TcTyVar
</span><a href="GHC.Types.Var.html#updateTyVarKind"><span class="hs-identifier hs-var">updateTyVarKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077679"><span class="hs-identifier hs-var">subst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcTyVar -&gt; TcTyVar) -&gt; TcTyVar -&gt; TcTyVar
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2764"></span><span>                       </span><span class="annot"><span class="annottext">TcTyVar -&gt; (Name -&gt; TcTyVar) -&gt; Maybe Name -&gt; TcTyVar
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077687"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; Name -&gt; TcTyVar
</span><a href="GHC.Types.Var.html#setTyVarName"><span class="hs-identifier hs-var">setTyVarName</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077687"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsTyVarBndr (HsBndrVis GhcRn) GhcRn -&gt; Maybe (IdP GhcRn)
forall flag (p :: Pass).
LHsTyVarBndr flag (GhcPass p) -&gt; Maybe (IdP (GhcPass p))
</span><a href="GHC.Hs.Type.html#hsLTyVarName"><span class="hs-identifier hs-var">hsLTyVarName</span></a></span><span> </span><span class="annot"><span class="annottext">LHsTyVarBndr (HsBndrVis GhcRn) GhcRn
GenLocated SrcSpanAnnA (HsTyVarBndr (HsBndrVis GhcRn) GhcRn)
</span><a href="#local-6989586621683077683"><span class="hs-identifier hs-var">hs_bndr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2765"></span><span>                   </span><span class="hs-comment">-- Give the skolem the Name of the HsTyVarBndr, so that if it</span><span>
</span><span id="line-2766"></span><span>                   </span><span class="hs-comment">-- appears in an error message it has a name and binding site</span><span>
</span><span id="line-2767"></span><span>                   </span><span class="hs-comment">-- that come from the type declaration, not the kind signature</span><span>
</span><span id="line-2768"></span><span>                 </span><span id="local-6989586621683077694"><span class="annot"><span class="annottext">subst' :: Subst
</span><a href="#local-6989586621683077694"><span class="hs-identifier hs-var hs-var hs-var">subst'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; TcTyVar -&gt; TcTyVar -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#extendTCvSubstWithClone"><span class="hs-identifier hs-var">extendTCvSubstWithClone</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077679"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077687"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077689"><span class="hs-identifier hs-var">tv'</span></a></span><span>
</span><span id="line-2769"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsTyVarBndr (HsBndrVis GhcRn) GhcRn -&gt; Type -&gt; TcM ()
</span><a href="#local-6989586621683077696"><span class="hs-identifier hs-var">tc_hs_bndr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsTyVarBndr (HsBndrVis GhcRn) GhcRn)
-&gt; HsTyVarBndr (HsBndrVis GhcRn) GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsTyVarBndr (HsBndrVis GhcRn) GhcRn)
</span><a href="#local-6989586621683077683"><span class="hs-identifier hs-var">hs_bndr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; Type
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077689"><span class="hs-identifier hs-var">tv'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2770"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;musd1&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyConBinder -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyConBinder
</span><a href="#local-6989586621683077680"><span class="hs-identifier hs-var">tcb</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsTyVarBndr (HsBndrVis GhcRn) GhcRn)
-&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsTyVarBndr (HsBndrVis GhcRn) GhcRn)
</span><a href="#local-6989586621683077683"><span class="hs-identifier hs-var">hs_bndr</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077689"><span class="hs-identifier hs-var">tv'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2771"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077697"><span class="annot"><a href="#local-6989586621683077697"><span class="hs-identifier hs-var">tcbs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077698"><span class="annot"><a href="#local-6989586621683077698"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077699"><span class="annot"><a href="#local-6989586621683077699"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ([TyConBinder], [TcTyVar], a)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ([TyConBinder], [TcTyVar], a)
forall r. [TcTyVar] -&gt; TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Env.html#tcExtendTyVarEnv"><span class="hs-identifier hs-var">tcExtendTyVarEnv</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077689"><span class="hs-identifier hs-var">tv'</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) ([TyConBinder], [TcTyVar], a)
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) ([TyConBinder], [TcTyVar], a))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ([TyConBinder], [TcTyVar], a)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ([TyConBinder], [TcTyVar], a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2772"></span><span>                                  </span><span class="annot"><span class="annottext">Subst
-&gt; [TyConBinder]
-&gt; [GenLocated SrcSpanAnnA (HsTyVarBndr (HsBndrVis GhcRn) GhcRn)]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ([TyConBinder], [TcTyVar], a)
</span><a href="#local-6989586621683077670"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077694"><span class="hs-identifier hs-var">subst'</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621683077681"><span class="hs-identifier hs-var">tcbs'</span></a></span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsTyVarBndr (HsBndrVis GhcRn) GhcRn)]
</span><a href="#local-6989586621683077684"><span class="hs-identifier hs-var">hs_bndrs'</span></a></span><span>
</span><span id="line-2773"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077689"><span class="hs-identifier hs-type">tv'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077688"><span class="hs-identifier hs-type">vis</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621683077697"><span class="hs-identifier hs-type">tcbs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683077689"><span class="hs-identifier hs-type">tv'</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><a href="#local-6989586621683077698"><span class="hs-identifier hs-type">tvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683077699"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2774"></span><span>             </span><span class="hs-comment">-- We do a tcExtendTyVarEnv [tv'], so we return tv' in</span><span>
</span><span id="line-2775"></span><span>             </span><span class="hs-comment">-- the list of lexically-scoped skolem type variables</span><span>
</span><span id="line-2776"></span><span>
</span><span id="line-2777"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyConBndrVis -&gt; Bool
</span><a href="#local-6989586621683077701"><span class="hs-identifier hs-var">skippable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyConBinder -&gt; TyConBndrVis
forall tv argf. VarBndr tv argf -&gt; argf
</span><a href="GHC.Types.Var.html#binderFlag"><span class="hs-identifier hs-var">binderFlag</span></a></span><span> </span><span class="annot"><span class="annottext">TyConBinder
</span><a href="#local-6989586621683077680"><span class="hs-identifier hs-var">tcb</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2778"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- Invisible TyConBinder, so do not consume one of the hs_bndrs</span><span>
</span><span id="line-2779"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077702"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077702"><span class="hs-identifier hs-var hs-var">subst'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077703"><span class="annot"><span class="annottext">TyConBinder
</span><a href="#local-6989586621683077703"><span class="hs-identifier hs-var hs-var">tcb'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; TyConBinder -&gt; (Subst, TyConBinder)
</span><a href="GHC.Tc.Gen.HsType.html#substTyConBinderX"><span class="hs-identifier hs-var">substTyConBinderX</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077679"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TyConBinder
</span><a href="#local-6989586621683077680"><span class="hs-identifier hs-var">tcb</span></a></span><span>
</span><span id="line-2780"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;musd2&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyConBinder -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyConBinder
</span><a href="#local-6989586621683077680"><span class="hs-identifier hs-var">tcb</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsTyVarBndr (HsBndrVis GhcRn) GhcRn)
-&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsTyVarBndr (HsBndrVis GhcRn) GhcRn)
</span><a href="#local-6989586621683077683"><span class="hs-identifier hs-var">hs_bndr</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">TyConBinder -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyConBinder
</span><a href="#local-6989586621683077703"><span class="hs-identifier hs-var">tcb'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2781"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077705"><span class="annot"><a href="#local-6989586621683077705"><span class="hs-identifier hs-var">tcbs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077706"><span class="annot"><a href="#local-6989586621683077706"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077707"><span class="annot"><a href="#local-6989586621683077707"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Subst
-&gt; [TyConBinder]
-&gt; [GenLocated SrcSpanAnnA (HsTyVarBndr (HsBndrVis GhcRn) GhcRn)]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ([TyConBinder], [TcTyVar], a)
</span><a href="#local-6989586621683077670"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077702"><span class="hs-identifier hs-var">subst'</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621683077681"><span class="hs-identifier hs-var">tcbs'</span></a></span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsTyVarBndr (HsBndrVis GhcRn) GhcRn)]
</span><a href="#local-6989586621683077682"><span class="hs-identifier hs-var">hs_bndrs</span></a></span><span>
</span><span id="line-2782"></span><span>                   </span><span class="hs-comment">-- NB: pass on hs_bndrs unchanged; we do not consume a</span><span>
</span><span id="line-2783"></span><span>                   </span><span class="hs-comment">--     HsTyVarBndr for an invisible TyConBinder</span><span>
</span><span id="line-2784"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683077703"><span class="hs-identifier hs-type">tcb'</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621683077705"><span class="hs-identifier hs-type">tcbs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683077706"><span class="hs-identifier hs-type">tvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683077707"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2785"></span><span>                   </span><span class="hs-comment">-- Return `tvs`; no new lexically-scoped TyVars brought into scope</span><span>
</span><span id="line-2786"></span><span>
</span><span id="line-2787"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2788"></span><span>          </span><span class="hs-comment">-- At this point we conclude that:</span><span>
</span><span id="line-2789"></span><span>          </span><span class="hs-comment">--   * the quantifier (tcb) is visible: (ty -&gt; ...), (forall a -&gt; ...)</span><span>
</span><span id="line-2790"></span><span>          </span><span class="hs-comment">--   * the binder (hs_bndr) is invisible: @t, @(t :: k)</span><span>
</span><span id="line-2791"></span><span>          </span><span class="hs-comment">-- Any other combination should have been handled by the zippable/skippable clauses.</span><span>
</span><span id="line-2792"></span><span>          </span><span class="annot"><span class="annottext">TcRnMessage
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ([TyConBinder], [TcTyVar], a)
forall a. TcRnMessage -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; LHsTyVarBndr (HsBndrVis GhcRn) GhcRn -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnInvalidInvisTyVarBndr"><span class="hs-identifier hs-var">TcRnInvalidInvisTyVarBndr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077665"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">LHsTyVarBndr (HsBndrVis GhcRn) GhcRn
GenLocated SrcSpanAnnA (HsTyVarBndr (HsBndrVis GhcRn) GhcRn)
</span><a href="#local-6989586621683077683"><span class="hs-identifier hs-var">hs_bndr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2793"></span><span>
</span><span id="line-2794"></span><span>    </span><span class="annot"><a href="#local-6989586621683077696"><span class="hs-identifier hs-type">tc_hs_bndr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTyVarBndr"><span class="hs-identifier hs-type">HsTyVarBndr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsBndrVis"><span class="hs-identifier hs-type">HsBndrVis</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2795"></span><span>    </span><span id="local-6989586621683077696"><span class="annot"><span class="annottext">tc_hs_bndr :: HsTyVarBndr (HsBndrVis GhcRn) GhcRn -&gt; Type -&gt; TcM ()
</span><a href="#local-6989586621683077696"><span class="hs-identifier hs-var hs-var">tc_hs_bndr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTvb"><span class="hs-identifier hs-type">HsTvb</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tvb_kind :: forall flag pass. HsTyVarBndr flag pass -&gt; HsBndrKind pass
</span><a href="Language.Haskell.Syntax.Type.html#tvb_kind"><span class="hs-identifier hs-var">tvb_kind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsBndrNoKind"><span class="hs-identifier hs-type">HsBndrNoKind</span></a></span><span> </span><span class="annot"><span class="annottext">XBndrNoKind GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcM ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2796"></span><span>    </span><span class="annot"><a href="#local-6989586621683077696"><span class="hs-identifier hs-var">tc_hs_bndr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTvb"><span class="hs-identifier hs-type">HsTvb</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tvb_kind :: forall flag pass. HsTyVarBndr flag pass -&gt; HsBndrKind pass
</span><a href="Language.Haskell.Syntax.Type.html#tvb_kind"><span class="hs-identifier hs-var">tvb_kind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsBndrKind"><span class="hs-identifier hs-type">HsBndrKind</span></a></span><span> </span><span class="annot"><span class="annottext">XBndrKind GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683077713"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077713"><span class="hs-identifier hs-var">kind</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tvb_var :: forall flag pass. HsTyVarBndr flag pass -&gt; HsBndrVar pass
</span><a href="Language.Haskell.Syntax.Type.html#tvb_var"><span class="hs-identifier hs-var">tvb_var</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683077715"><span class="annot"><span class="annottext">HsBndrVar GhcRn
</span><a href="#local-6989586621683077715"><span class="hs-identifier hs-var">bvar</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2797"></span><span>               </span><span id="local-6989586621683077716"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077716"><span class="hs-identifier hs-var">expected_kind</span></a></span></span><span>
</span><span id="line-2798"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;musd3:unifying&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcRn) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621683077713"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077716"><span class="hs-identifier hs-var">expected_kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2799"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsBndrVar GhcRn -&gt; LHsType GhcRn -&gt; Type -&gt; TcM ()
</span><a href="GHC.Tc.Gen.HsType.html#tcHsTvbKind"><span class="hs-identifier hs-var">tcHsTvbKind</span></a></span><span> </span><span class="annot"><span class="annottext">HsBndrVar GhcRn
</span><a href="#local-6989586621683077715"><span class="hs-identifier hs-var">bvar</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077713"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077716"><span class="hs-identifier hs-var">expected_kind</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2800"></span><span>
</span><span id="line-2801"></span><span>    </span><span class="hs-comment">-- See GHC Proposal #425, section &quot;Kind checking&quot;,</span><span>
</span><span id="line-2802"></span><span>    </span><span class="hs-comment">-- where zippable and skippable are defined.</span><span>
</span><span id="line-2803"></span><span>    </span><span class="hs-comment">-- In particular: we match up if</span><span>
</span><span id="line-2804"></span><span>    </span><span class="hs-comment">-- (a) HsBndr looks like @k, and TyCon binder is forall k. (NamedTCB Specified)</span><span>
</span><span id="line-2805"></span><span>    </span><span class="hs-comment">-- (b) HsBndr looks like a,  and TyCon binder is forall k -&gt; (NamedTCB Required)</span><span>
</span><span id="line-2806"></span><span>    </span><span class="hs-comment">--                                            or k -&gt; (AnonTCB)</span><span>
</span><span id="line-2807"></span><span>    </span><span class="annot"><a href="#local-6989586621683077685"><span class="hs-identifier hs-type">zippable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyConBndrVis"><span class="hs-identifier hs-type">TyConBndrVis</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsBndrVis"><span class="hs-identifier hs-type">HsBndrVis</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2808"></span><span>    </span><span id="local-6989586621683077685"><span class="annot"><span class="annottext">zippable :: TyConBndrVis -&gt; HsBndrVis GhcRn -&gt; Bool
</span><a href="#local-6989586621683077685"><span class="hs-identifier hs-var hs-var">zippable</span></a></span></span><span> </span><span id="local-6989586621683077718"><span class="annot"><span class="annottext">TyConBndrVis
</span><a href="#local-6989586621683077718"><span class="hs-identifier hs-var">vis</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsBndrInvisible"><span class="hs-identifier hs-type">HsBndrInvisible</span></a></span><span> </span><span class="annot"><span class="annottext">XBndrInvisible GhcRn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyConBndrVis -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isInvisSpecTcbVis"><span class="hs-identifier hs-var">isInvisSpecTcbVis</span></a></span><span> </span><span class="annot"><span class="annottext">TyConBndrVis
</span><a href="#local-6989586621683077718"><span class="hs-identifier hs-var">vis</span></a></span><span>  </span><span class="hs-comment">-- (a)</span><span>
</span><span id="line-2809"></span><span>    </span><span class="annot"><a href="#local-6989586621683077685"><span class="hs-identifier hs-var">zippable</span></a></span><span> </span><span id="local-6989586621683077720"><span class="annot"><span class="annottext">TyConBndrVis
</span><a href="#local-6989586621683077720"><span class="hs-identifier hs-var">vis</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsBndrRequired"><span class="hs-identifier hs-type">HsBndrRequired</span></a></span><span> </span><span class="annot"><span class="annottext">XBndrRequired GhcRn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyConBndrVis -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isVisibleTcbVis"><span class="hs-identifier hs-var">isVisibleTcbVis</span></a></span><span> </span><span class="annot"><span class="annottext">TyConBndrVis
</span><a href="#local-6989586621683077720"><span class="hs-identifier hs-var">vis</span></a></span><span>    </span><span class="hs-comment">-- (b)</span><span>
</span><span id="line-2810"></span><span>
</span><span id="line-2811"></span><span>    </span><span class="hs-comment">-- See GHC Proposal #425, section &quot;Kind checking&quot;,</span><span>
</span><span id="line-2812"></span><span>    </span><span class="hs-comment">-- where zippable and skippable are defined.</span><span>
</span><span id="line-2813"></span><span>    </span><span class="annot"><a href="#local-6989586621683077701"><span class="hs-identifier hs-type">skippable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyConBndrVis"><span class="hs-identifier hs-type">TyConBndrVis</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2814"></span><span>    </span><span id="local-6989586621683077701"><span class="annot"><span class="annottext">skippable :: TyConBndrVis -&gt; Bool
</span><a href="#local-6989586621683077701"><span class="hs-identifier hs-var hs-var">skippable</span></a></span></span><span> </span><span id="local-6989586621683077722"><span class="annot"><span class="annottext">TyConBndrVis
</span><a href="#local-6989586621683077722"><span class="hs-identifier hs-var">vis</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyConBndrVis -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isVisibleTcbVis"><span class="hs-identifier hs-var">isVisibleTcbVis</span></a></span><span> </span><span class="annot"><span class="annottext">TyConBndrVis
</span><a href="#local-6989586621683077722"><span class="hs-identifier hs-var">vis</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2815"></span><span>
</span><span id="line-2816"></span><span class="hs-comment">-- Check the kind of a type variable binder</span><span>
</span><span id="line-2817"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsTvbKind"><span class="hs-identifier hs-type">tcHsTvbKind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsBndrVar"><span class="hs-identifier hs-type">HsBndrVar</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsKind"><span class="hs-identifier hs-type">LHsKind</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2818"></span><span id="tcHsTvbKind"><span class="annot"><span class="annottext">tcHsTvbKind :: HsBndrVar GhcRn -&gt; LHsType GhcRn -&gt; Type -&gt; TcM ()
</span><a href="GHC.Tc.Gen.HsType.html#tcHsTvbKind"><span class="hs-identifier hs-var hs-var">tcHsTvbKind</span></a></span></span><span> </span><span id="local-6989586621683077723"><span class="annot"><span class="annottext">HsBndrVar GhcRn
</span><a href="#local-6989586621683077723"><span class="hs-identifier hs-var">bvar</span></a></span></span><span> </span><span id="local-6989586621683077724"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077724"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span id="local-6989586621683077725"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077725"><span class="hs-identifier hs-var">expected_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2819"></span><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683077726"><span class="annot"><a href="#local-6989586621683077726"><span class="hs-identifier hs-var">sig_kind</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt -&gt; LHsType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcLHsKindSig"><span class="hs-identifier hs-var">tcLHsKindSig</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621683077727"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683077724"><span class="hs-identifier hs-var">kind</span></a></span><span>
</span><span id="line-2820"></span><span>     </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcHsTvbKind:unifying&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077726"><span class="hs-identifier hs-type">sig_kind</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077725"><span class="hs-identifier hs-type">expected_kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2821"></span><span>     </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#discardResult"><span class="hs-identifier hs-type">discardResult</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-comment">-- See Note [discardResult in tcHsTvbKind]</span><span>
</span><span id="line-2822"></span><span>       </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#unifyKind"><span class="hs-identifier hs-type">unifyKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077728"><span class="hs-identifier hs-type">mb_thing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077726"><span class="hs-identifier hs-type">sig_kind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077725"><span class="hs-identifier hs-type">expected_kind</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2823"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2824"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683077727"><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621683077727"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077728"><span class="annot"><span class="annottext">Maybe TypedThing
</span><a href="#local-6989586621683077728"><span class="hs-identifier hs-var">mb_thing</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsBndrVar GhcRn
</span><a href="#local-6989586621683077723"><span class="hs-identifier hs-var">bvar</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2825"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsBndrVar"><span class="hs-identifier hs-type">HsBndrVar</span></a></span><span> </span><span class="annot"><span class="annottext">XBndrVar GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683077730"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077730"><span class="hs-identifier hs-var">hs_nm</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#TyVarBndrKindCtxt"><span class="hs-identifier hs-var">TyVarBndrKindCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077730"><span class="hs-identifier hs-var">hs_nm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TypedThing -&gt; Maybe TypedThing
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; TypedThing
</span><a href="GHC.Tc.Types.Origin.html#NameThing"><span class="hs-identifier hs-var">NameThing</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077730"><span class="hs-identifier hs-var">hs_nm</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2826"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsBndrWildCard"><span class="hs-identifier hs-type">HsBndrWildCard</span></a></span><span> </span><span class="annot"><span class="annottext">XBndrWildCard GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#KindSigCtxt"><span class="hs-identifier hs-var">KindSigCtxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe TypedThing
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-2827"></span><span>
</span><span id="line-2828"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#substTyConBinderX"><span class="hs-identifier hs-type">substTyConBinderX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyConBinder"><span class="hs-identifier hs-type">TyConBinder</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyConBinder"><span class="hs-identifier hs-type">TyConBinder</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2829"></span><span id="substTyConBinderX"><span class="annot"><span class="annottext">substTyConBinderX :: Subst -&gt; TyConBinder -&gt; (Subst, TyConBinder)
</span><a href="GHC.Tc.Gen.HsType.html#substTyConBinderX"><span class="hs-identifier hs-var hs-var">substTyConBinderX</span></a></span></span><span> </span><span id="local-6989586621683077734"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077734"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span id="local-6989586621683077735"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077735"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621683077736"><span class="annot"><span class="annottext">TyConBndrVis
</span><a href="#local-6989586621683077736"><span class="hs-identifier hs-var">vis</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2830"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077737"><span class="hs-identifier hs-var">subst'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TyConBndrVis -&gt; TyConBinder
forall var argf. var -&gt; argf -&gt; VarBndr var argf
</span><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077738"><span class="hs-identifier hs-var">tv'</span></a></span><span> </span><span class="annot"><span class="annottext">TyConBndrVis
</span><a href="#local-6989586621683077736"><span class="hs-identifier hs-var">vis</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2831"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2832"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683077737"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077737"><span class="hs-identifier hs-var">subst'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077738"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077738"><span class="hs-identifier hs-var">tv'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; TcTyVar -&gt; (Subst, TcTyVar)
Subst -&gt; TcTyVar -&gt; (Subst, TcTyVar)
</span><a href="GHC.Core.TyCo.Subst.html#substTyVarBndr"><span class="hs-identifier hs-var">substTyVarBndr</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077734"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077735"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-2833"></span><span>
</span><span id="line-2834"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#substTyConBindersX"><span class="hs-identifier hs-type">substTyConBindersX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCon.html#TyConBinder"><span class="hs-identifier hs-type">TyConBinder</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCon.html#TyConBinder"><span class="hs-identifier hs-type">TyConBinder</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2835"></span><span id="substTyConBindersX"><span class="annot"><span class="annottext">substTyConBindersX :: Subst -&gt; [TyConBinder] -&gt; (Subst, [TyConBinder])
</span><a href="GHC.Tc.Gen.HsType.html#substTyConBindersX"><span class="hs-identifier hs-var hs-var">substTyConBindersX</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Subst -&gt; TyConBinder -&gt; (Subst, TyConBinder))
-&gt; Subst -&gt; [TyConBinder] -&gt; (Subst, [TyConBinder])
forall (t :: * -&gt; *) s a b.
Traversable t =&gt;
(s -&gt; a -&gt; (s, b)) -&gt; s -&gt; t a -&gt; (s, t b)
</span><span class="hs-identifier hs-var">mapAccumL</span></span><span> </span><span class="annot"><span class="annottext">Subst -&gt; TyConBinder -&gt; (Subst, TyConBinder)
</span><a href="GHC.Tc.Gen.HsType.html#substTyConBinderX"><span class="hs-identifier hs-var">substTyConBinderX</span></a></span><span>
</span><span id="line-2836"></span><span>
</span><span id="line-2837"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#swizzleTcb"><span class="hs-identifier hs-type">swizzleTcb</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#VarEnv"><span class="hs-identifier hs-type">VarEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyConBinder"><span class="hs-identifier hs-type">TyConBinder</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyConBinder"><span class="hs-identifier hs-type">TyConBinder</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2838"></span><span id="swizzleTcb"><span class="annot"><span class="annottext">swizzleTcb :: VarEnv Name -&gt; Subst -&gt; TyConBinder -&gt; (Subst, TyConBinder)
</span><a href="GHC.Tc.Gen.HsType.html#swizzleTcb"><span class="hs-identifier hs-var hs-var">swizzleTcb</span></a></span></span><span> </span><span id="local-6989586621683077740"><span class="annot"><span class="annottext">VarEnv Name
</span><a href="#local-6989586621683077740"><span class="hs-identifier hs-var">swizzle_env</span></a></span></span><span> </span><span id="local-6989586621683077741"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077741"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span id="local-6989586621683077742"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077742"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621683077743"><span class="annot"><span class="annottext">TyConBndrVis
</span><a href="#local-6989586621683077743"><span class="hs-identifier hs-var">vis</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2839"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077744"><span class="hs-identifier hs-var">subst'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TyConBndrVis -&gt; TyConBinder
forall var argf. var -&gt; argf -&gt; VarBndr var argf
</span><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077745"><span class="hs-identifier hs-var">tv2</span></a></span><span> </span><span class="annot"><span class="annottext">TyConBndrVis
</span><a href="#local-6989586621683077743"><span class="hs-identifier hs-var">vis</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2840"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2841"></span><span>    </span><span id="local-6989586621683077744"><span class="annot"><span class="annottext">subst' :: Subst
</span><a href="#local-6989586621683077744"><span class="hs-identifier hs-var hs-var">subst'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; TcTyVar -&gt; TcTyVar -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#extendTCvSubstWithClone"><span class="hs-identifier hs-var">extendTCvSubstWithClone</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077741"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077742"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077745"><span class="hs-identifier hs-var">tv2</span></a></span><span>
</span><span id="line-2842"></span><span>    </span><span id="local-6989586621683077746"><span class="annot"><span class="annottext">tv1 :: TcTyVar
</span><a href="#local-6989586621683077746"><span class="hs-identifier hs-var hs-var">tv1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; TcTyVar -&gt; TcTyVar
</span><a href="GHC.Types.Var.html#updateTyVarKind"><span class="hs-identifier hs-var">updateTyVarKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683077741"><span class="hs-identifier hs-var">subst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077742"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-2843"></span><span>    </span><span id="local-6989586621683077745"><span class="annot"><span class="annottext">tv2 :: TcTyVar
</span><a href="#local-6989586621683077745"><span class="hs-identifier hs-var hs-var">tv2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">VarEnv Name -&gt; TcTyVar -&gt; Maybe Name
forall a. VarEnv a -&gt; TcTyVar -&gt; Maybe a
</span><a href="GHC.Types.Var.Env.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Name
</span><a href="#local-6989586621683077740"><span class="hs-identifier hs-var">swizzle_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077742"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2844"></span><span>             </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683077748"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077748"><span class="hs-identifier hs-var">user_name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Name -&gt; TcTyVar
</span><a href="GHC.Types.Var.html#setTyVarName"><span class="hs-identifier hs-var">setTyVarName</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077746"><span class="hs-identifier hs-var">tv1</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077748"><span class="hs-identifier hs-var">user_name</span></a></span><span>
</span><span id="line-2845"></span><span>             </span><span class="annot"><span class="annottext">Maybe Name
</span><span class="hs-identifier hs-var">Nothing</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077746"><span class="hs-identifier hs-var">tv1</span></a></span><span>
</span><span id="line-2846"></span><span>    </span><span class="hs-comment">-- NB: the SrcSpan on an implicitly-bound name deliberately spans</span><span>
</span><span id="line-2847"></span><span>    </span><span class="hs-comment">-- the whole declaration. e.g.</span><span>
</span><span id="line-2848"></span><span>    </span><span class="hs-comment">--    data T (a :: k) (b :: Type -&gt; k) = ....</span><span>
</span><span id="line-2849"></span><span>    </span><span class="hs-comment">-- There is no single binding site for 'k'.</span><span>
</span><span id="line-2850"></span><span>    </span><span class="hs-comment">-- See Note [Source locations for implicitly bound type variables]</span><span>
</span><span id="line-2851"></span><span>    </span><span class="hs-comment">-- in GHC.Tc.Rename.HsType</span><span>
</span><span id="line-2852"></span><span>
</span><span id="line-2853"></span><span class="hs-comment">{- Note [kcCheckDeclHeader_sig]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Given a kind signature 'sig_kind' and a declaration header,
kcCheckDeclHeader_sig verifies that the declaration conforms to the
signature. The end result is a PolyTcTyCon 'tc' such that:
  tyConKind tc == sig_kind

Basic plan is this:
  * splitTyConKind: Take the Kind from the separate kind signature, and
    decompose it all the way to a [TyConBinder] and a Kind in the corner.

    NB: these TyConBinders contain TyVars, not TcTyVars.

  * matchUpSigWithDecl: match the [TyConBinder] from the signature with
    the [LHsTyVarBndr (HsBndrVis GhcRn) GhcRn] from the declaration.  The latter are the
    explicit, user-written binders.  e.g.
        data T (a :: k) b = ....
    There may be more of the former than the latter, because the former
    include invisible binders.  matchUpSigWithDecl uses isVisibleTcbVis
    to decide which TyConBinders are visible.

  * matchUpSigWithDecl also skolemises the [TyConBinder] to produce
    a [TyConBinder], corresponding 1-1 with the consumed [TyConBinder].
    Each new TyConBinder
      - Uses the Name from the LHsTyVarBndr, if available, both because that's
        what the user expects, and because the binding site accurately comes
        from the data/type declaration.
      - Uses a skolem TcTyVar.  We need these to allow unification.

  * machUpSigWithDecl also unifies the user-supplied kind signature for each
    LHsTyVarBndr with the kind that comes from the TyConBinder (itself coming
    from the separate kind signature).

  * Finally, kcCheckDeclHeader_sig unifies the return kind of the separate
    signature with the kind signature (if any) in the data/type declaration.
    E.g.
           type S :: forall k. k -&gt; k -&gt; Type
           type family S (a :: j) :: j -&gt; Type
    Here we match up the 'k -&gt;' with (a :: j); and then must unify the leftover
    part of the signature (k -&gt; Type) with the kind signature of the decl,
    (j -&gt; Type).  This unification, done in kcCheckDeclHeader, needs TcTyVars.

Note [Arity of type families and type synonyms]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider

  type F0 :: forall k. k -&gt; k -&gt; Type
  type family F0

  type F1 :: forall k. k -&gt; k -&gt; Type
  type family F1 @k

  type F2a :: forall k. k -&gt; k -&gt; Type
  type family F2a @k a

  type F2b :: forall k. k -&gt; k -&gt; Type
  type family F2b a

  type F3 :: forall k. k -&gt; k -&gt; Type
  type family F3 a b

All five have the same /kind/, but what /arity/ do they have?
For a type family, the arity is critical:
* A type family must always appear saturated (up to its arity)
* A type family can match only on `arity` arguments, not further ones
* The arity is recorded by `tyConArity`, and is equal to the number of
  `TyConBinders` in the `TyCon`.
* In this context &quot;arity&quot; includes both kind and type arguments.

The arity is not determined by the kind signature (all five have the same signature).
Rather, it is determined by the declaration of the family:
* `F0` has arity 0.
* `F1` has arity 1.
* `F2a` has arity 2.
* `F2b` also has arity 2: the kind argument is invisible.
* `F3` has arity 3; again the kind argument is invisible.

The matching-up of kind signature with the declaration itself is done by
`matchUpWithSigDecl`.

Note [discardResult in tcHsTvbKind]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We use 'unifyKind' to check inline kind annotations in declaration headers
against the signature.

  type T :: [i] -&gt; Maybe j -&gt; Type
  data T (a :: [k1]) (b :: Maybe k2) :: Type where ...

Here, we will unify:

       [k1] ~ [i]
  Maybe k2  ~ Maybe j
      Type  ~ Type

The end result is that we fill in unification variables k1, k2:

    k1  :=  i
    k2  :=  j

We also validate that the user isn't confused:

  type T :: Type -&gt; Type
  data T (a :: Bool) = ...

This will report that (Type ~ Bool) failed to unify.

Now, consider the following example:

  type family Id a where Id x = x
  type T :: Bool -&gt; Type
  type T (a :: Id Bool) = ...

We will unify (Bool ~ Id Bool), and this will produce a non-reflexive coercion.
However, we are free to discard it, as the kind of 'T' is determined by the
signature, not by the inline kind annotation:

      we have   T ::    Bool -&gt; Type
  rather than   T :: Id Bool -&gt; Type

This (Id Bool) will not show up anywhere after we're done validating it, so we
have no use for the produced coercion.

Note [Kind variable ordering for associated types]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
What should be the kind of `T` in the following example? (#15591)

  class C (a :: Type) where
    type T (x :: f a)

As per Note [Ordering of implicit variables] in GHC.Rename.HsType, we want to quantify
the kind variables in left-to-right order of first occurrence in order to
support visible kind application. But we cannot perform this analysis on just
T alone, since its variable `a` actually occurs /before/ `f` if you consider
the fact that `a` was previously bound by the parent class `C`. That is to say,
the kind of `T` should end up being:

  T :: forall a f. f a -&gt; Type

(It wouldn't necessarily be /wrong/ if the kind ended up being, say,
forall f a. f a -&gt; Type, but that would not be as predictable for users of
visible kind application.)

In contrast, if `T` were redefined to be a top-level type family, like `T2`
below:

  type family T2 (x :: f (a :: Type))

Then `a` first appears /after/ `f`, so the kind of `T2` should be:

  T2 :: forall f a. f a -&gt; Type

In order to make this distinction, we need to know (in kcCheckDeclHeader) which
type variables have been bound by the parent class (if there is one). With
the class-bound variables in hand, we can ensure that we always quantify
these first.
-}</span><span>
</span><span id="line-3009"></span><span>
</span><span id="line-3010"></span><span>
</span><span id="line-3011"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
             Expected kinds
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-3016"></span><span>
</span><span id="line-3017"></span><span class="annot"><span class="hs-comment">-- | Describes the kind expected in a certain context.</span></span><span>
</span><span id="line-3018"></span><span class="hs-keyword">data</span><span> </span><span id="ContextKind"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#ContextKind"><span class="hs-identifier hs-var">ContextKind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TheKind"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#TheKind"><span class="hs-identifier hs-var">TheKind</span></a></span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ a specific kind</span></span><span>
</span><span id="line-3019"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span id="AnyKind"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#AnyKind"><span class="hs-identifier hs-var">AnyKind</span></a></span></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ any kind will do</span></span><span>
</span><span id="line-3020"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span id="OpenKind"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#OpenKind"><span class="hs-identifier hs-var">OpenKind</span></a></span></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ something of the form @TYPE _@</span></span><span>
</span><span id="line-3021"></span><span>
</span><span id="line-3022"></span><span class="hs-comment">-- debug only</span><span>
</span><span id="line-3023"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#ContextKind"><span class="hs-identifier hs-type">ContextKind</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-3024"></span><span>  </span><span id="local-6989586621683077756"><span class="annot"><span class="annottext">ppr :: ContextKind -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#AnyKind"><span class="hs-identifier hs-var">AnyKind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;AnyKind&quot;</span></span><span>
</span><span id="line-3025"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#OpenKind"><span class="hs-identifier hs-var">OpenKind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;OpenKind&quot;</span></span><span>
</span><span id="line-3026"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#TheKind"><span class="hs-identifier hs-type">TheKind</span></a></span><span> </span><span id="local-6989586621683077757"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077757"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TheKind&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077757"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-3027"></span><span>
</span><span id="line-3028"></span><span class="hs-comment">-----------------------</span><span>
</span><span id="line-3029"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#newExpectedKind"><span class="hs-identifier hs-type">newExpectedKind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#ContextKind"><span class="hs-identifier hs-type">ContextKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span>
</span><span id="line-3030"></span><span id="newExpectedKind"><span class="annot"><span class="annottext">newExpectedKind :: ContextKind -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#newExpectedKind"><span class="hs-identifier hs-var hs-var">newExpectedKind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#TheKind"><span class="hs-identifier hs-type">TheKind</span></a></span><span> </span><span id="local-6989586621683077758"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077758"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683077758"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-3031"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#newExpectedKind"><span class="hs-identifier hs-var">newExpectedKind</span></a></span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#AnyKind"><span class="hs-identifier hs-var">AnyKind</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM Type
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaKindVar"><span class="hs-identifier hs-var">newMetaKindVar</span></a></span><span>
</span><span id="line-3032"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#newExpectedKind"><span class="hs-identifier hs-var">newExpectedKind</span></a></span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#OpenKind"><span class="hs-identifier hs-var">OpenKind</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM Type
</span><a href="GHC.Tc.Utils.TcMType.html#newOpenTypeKind"><span class="hs-identifier hs-var">newOpenTypeKind</span></a></span><span>
</span><span id="line-3033"></span><span>
</span><span id="line-3034"></span><span class="hs-comment">-----------------------</span><span>
</span><span id="line-3035"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#expectedKindInCtxt"><span class="hs-identifier hs-type">expectedKindInCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#ContextKind"><span class="hs-identifier hs-type">ContextKind</span></a></span><span>
</span><span id="line-3036"></span><span class="hs-comment">-- Depending on the context, we might accept any kind (for instance, in a TH</span><span>
</span><span id="line-3037"></span><span class="hs-comment">-- splice), or only certain kinds (like in type signatures).</span><span>
</span><span id="line-3038"></span><span id="expectedKindInCtxt"><span class="annot"><span class="annottext">expectedKindInCtxt :: UserTypeCtxt -&gt; ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#expectedKindInCtxt"><span class="hs-identifier hs-var hs-var">expectedKindInCtxt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#TySynCtxt"><span class="hs-identifier hs-type">TySynCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#AnyKind"><span class="hs-identifier hs-var">AnyKind</span></a></span><span>
</span><span id="line-3039"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#expectedKindInCtxt"><span class="hs-identifier hs-var">expectedKindInCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#GhciCtxt"><span class="hs-identifier hs-type">GhciCtxt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#AnyKind"><span class="hs-identifier hs-var">AnyKind</span></a></span><span>
</span><span id="line-3040"></span><span class="hs-comment">-- The types in a 'default' decl can have varying kinds</span><span>
</span><span id="line-3041"></span><span class="hs-comment">-- See Note [Extended defaults]&quot; in GHC.Tc.Utils.Env</span><span>
</span><span id="line-3042"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#expectedKindInCtxt"><span class="hs-identifier hs-var">expectedKindInCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#DefaultDeclCtxt"><span class="hs-identifier hs-var">DefaultDeclCtxt</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#AnyKind"><span class="hs-identifier hs-var">AnyKind</span></a></span><span>
</span><span id="line-3043"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#expectedKindInCtxt"><span class="hs-identifier hs-var">expectedKindInCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#DerivClauseCtxt"><span class="hs-identifier hs-var">DerivClauseCtxt</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#AnyKind"><span class="hs-identifier hs-var">AnyKind</span></a></span><span>
</span><span id="line-3044"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#expectedKindInCtxt"><span class="hs-identifier hs-var">expectedKindInCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#TypeAppCtxt"><span class="hs-identifier hs-var">TypeAppCtxt</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#AnyKind"><span class="hs-identifier hs-var">AnyKind</span></a></span><span>
</span><span id="line-3045"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#expectedKindInCtxt"><span class="hs-identifier hs-var">expectedKindInCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#ForSigCtxt"><span class="hs-identifier hs-type">ForSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#TheKind"><span class="hs-identifier hs-var">TheKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span>
</span><span id="line-3046"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#expectedKindInCtxt"><span class="hs-identifier hs-var">expectedKindInCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#InstDeclCtxt"><span class="hs-identifier hs-type">InstDeclCtxt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#TheKind"><span class="hs-identifier hs-var">TheKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#constraintKind"><span class="hs-identifier hs-var">constraintKind</span></a></span><span>
</span><span id="line-3047"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#expectedKindInCtxt"><span class="hs-identifier hs-var">expectedKindInCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#SpecInstCtxt"><span class="hs-identifier hs-var">SpecInstCtxt</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#TheKind"><span class="hs-identifier hs-var">TheKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#constraintKind"><span class="hs-identifier hs-var">constraintKind</span></a></span><span>
</span><span id="line-3048"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#expectedKindInCtxt"><span class="hs-identifier hs-var">expectedKindInCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><span class="hs-identifier">_</span></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#OpenKind"><span class="hs-identifier hs-var">OpenKind</span></a></span><span>
</span><span id="line-3049"></span><span>
</span><span id="line-3050"></span><span>
</span><span id="line-3051"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
          Scoped tyvars that map to the same thing
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-3056"></span><span>
</span><span id="line-3057"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#checkForDisconnectedScopedTyVars"><span class="hs-identifier hs-type">checkForDisconnectedScopedTyVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TyConFlavour"><span class="hs-identifier hs-type">TyConFlavour</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyConBinder"><span class="hs-identifier hs-type">TcTyConBinder</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3058"></span><span>                                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3059"></span><span class="hs-comment">-- See Note [Disconnected type variables]</span><span>
</span><span id="line-3060"></span><span class="hs-comment">-- For the type synonym case see Note [Out of arity type variables]</span><span>
</span><span id="line-3061"></span><span class="hs-comment">-- `scoped_prs` is the mapping gotten by unifying</span><span>
</span><span id="line-3062"></span><span class="hs-comment">--    - the standalone kind signature for T, with</span><span>
</span><span id="line-3063"></span><span class="hs-comment">--    - the header of the type/class declaration for T</span><span>
</span><span id="line-3064"></span><span id="checkForDisconnectedScopedTyVars"><span class="annot"><span class="annottext">checkForDisconnectedScopedTyVars :: Name
-&gt; TyConFlavour TyCon
-&gt; [TyConBinder]
-&gt; [(Name, TcTyVar)]
-&gt; TcM ()
</span><a href="GHC.Tc.Gen.HsType.html#checkForDisconnectedScopedTyVars"><span class="hs-identifier hs-var hs-var">checkForDisconnectedScopedTyVars</span></a></span></span><span> </span><span id="local-6989586621683077764"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077764"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621683077765"><span class="annot"><span class="annottext">TyConFlavour TyCon
</span><a href="#local-6989586621683077765"><span class="hs-identifier hs-var">flav</span></a></span></span><span> </span><span id="local-6989586621683077766"><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621683077766"><span class="hs-identifier hs-var">all_tcbs</span></a></span></span><span> </span><span id="local-6989586621683077767"><span class="annot"><span class="annottext">[(Name, TcTyVar)]
</span><a href="#local-6989586621683077767"><span class="hs-identifier hs-var">scoped_prs</span></a></span></span><span>
</span><span id="line-3065"></span><span>         </span><span class="hs-comment">-- needsEtaExpansion: see wrinkle (DTV1) in Note [Disconnected type variables]</span><span>
</span><span id="line-3066"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyConFlavour TyCon -&gt; Bool
forall tc. TyConFlavour tc -&gt; Bool
</span><a href="GHC.Tc.Gen.HsType.html#needsEtaExpansion"><span class="hs-identifier hs-var">needsEtaExpansion</span></a></span><span> </span><span class="annot"><span class="annottext">TyConFlavour TyCon
</span><a href="#local-6989586621683077765"><span class="hs-identifier hs-var">flav</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Name, TcTyVar) -&gt; TcM ()) -&gt; [(Name, TcTyVar)] -&gt; TcM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">(Name, TcTyVar) -&gt; TcM ()
</span><a href="#local-6989586621683077768"><span class="hs-identifier hs-var">report_disconnected</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Name, TcTyVar) -&gt; Bool) -&gt; [(Name, TcTyVar)] -&gt; [(Name, TcTyVar)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#filterOut"><span class="hs-identifier hs-var">filterOut</span></a></span><span> </span><span class="annot"><span class="annottext">(Name, TcTyVar) -&gt; Bool
</span><a href="#local-6989586621683077770"><span class="hs-identifier hs-var">ok</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, TcTyVar)]
</span><a href="#local-6989586621683077767"><span class="hs-identifier hs-var">scoped_prs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3067"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyConFlavour TyCon
</span><a href="#local-6989586621683077765"><span class="hs-identifier hs-var">flav</span></a></span><span> </span><span class="annot"><span class="annottext">TyConFlavour TyCon -&gt; TyConFlavour TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyConFlavour TyCon
forall tc. TyConFlavour tc
</span><a href="GHC.Types.Basic.html#TypeSynonymFlavour"><span class="hs-identifier hs-var">TypeSynonymFlavour</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Name, TcTyVar) -&gt; TcM ()) -&gt; [(Name, TcTyVar)] -&gt; TcM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">(Name, TcTyVar) -&gt; TcM ()
</span><a href="#local-6989586621683077772"><span class="hs-identifier hs-var">report_out_of_arity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Name, TcTyVar) -&gt; Bool) -&gt; [(Name, TcTyVar)] -&gt; [(Name, TcTyVar)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#filterOut"><span class="hs-identifier hs-var">filterOut</span></a></span><span> </span><span class="annot"><span class="annottext">(Name, TcTyVar) -&gt; Bool
</span><a href="#local-6989586621683077770"><span class="hs-identifier hs-var">ok</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, TcTyVar)]
</span><a href="#local-6989586621683077767"><span class="hs-identifier hs-var">scoped_prs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3068"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcM ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3069"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3070"></span><span>    </span><span id="local-6989586621683077773"><span class="annot"><span class="annottext">all_tvs :: TyVarSet
</span><a href="#local-6989586621683077773"><span class="hs-identifier hs-var hs-var">all_tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcTyVar] -&gt; TyVarSet
</span><a href="GHC.Types.Var.Set.html#mkVarSet"><span class="hs-identifier hs-var">mkVarSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyConBinder] -&gt; [TcTyVar]
forall tv argf. [VarBndr tv argf] -&gt; [tv]
</span><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-var">binderVars</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621683077766"><span class="hs-identifier hs-var">all_tcbs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3071"></span><span>    </span><span id="local-6989586621683077770"><span class="annot"><span class="annottext">ok :: (Name, TcTyVar) -&gt; Bool
</span><a href="#local-6989586621683077770"><span class="hs-identifier hs-var hs-var">ok</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077775"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077775"><span class="hs-identifier hs-var">tc_tv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077775"><span class="hs-identifier hs-var">tc_tv</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TyVarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarSet
</span><a href="#local-6989586621683077773"><span class="hs-identifier hs-var">all_tvs</span></a></span><span>
</span><span id="line-3072"></span><span>
</span><span id="line-3073"></span><span>    </span><span class="annot"><a href="#local-6989586621683077768"><span class="hs-identifier hs-type">report_disconnected</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3074"></span><span>    </span><span id="local-6989586621683077768"><span class="annot"><span class="annottext">report_disconnected :: (Name, TcTyVar) -&gt; TcM ()
</span><a href="#local-6989586621683077768"><span class="hs-identifier hs-var hs-var">report_disconnected</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077777"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077777"><span class="hs-identifier hs-var">nm</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-3075"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcM () -&gt; TcM ()
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SrcSpan
forall a. NamedThing a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Types.Name.html#getSrcSpan"><span class="hs-identifier hs-var">getSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077777"><span class="hs-identifier hs-var">nm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM () -&gt; TcM ()) -&gt; TcM () -&gt; TcM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-3076"></span><span>        </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; TcM ()) -&gt; TcRnMessage -&gt; TcM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnDisconnectedTyVar"><span class="hs-identifier hs-var">TcRnDisconnectedTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077777"><span class="hs-identifier hs-var">nm</span></a></span><span>
</span><span id="line-3077"></span><span>
</span><span id="line-3078"></span><span>    </span><span class="annot"><a href="#local-6989586621683077772"><span class="hs-identifier hs-type">report_out_of_arity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3079"></span><span>    </span><span id="local-6989586621683077772"><span class="annot"><span class="annottext">report_out_of_arity :: (Name, TcTyVar) -&gt; TcM ()
</span><a href="#local-6989586621683077772"><span class="hs-identifier hs-var hs-var">report_out_of_arity</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077781"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077781"><span class="hs-identifier hs-var">tv_nm</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-3080"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcM () -&gt; TcM ()
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SrcSpan
forall a. NamedThing a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Types.Name.html#getSrcSpan"><span class="hs-identifier hs-var">getSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077781"><span class="hs-identifier hs-var">tv_nm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM () -&gt; TcM ()) -&gt; TcM () -&gt; TcM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-3081"></span><span>        </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; TcM ()) -&gt; TcRnMessage -&gt; TcM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnOutOfArityTyVar"><span class="hs-identifier hs-var">TcRnOutOfArityTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077764"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077781"><span class="hs-identifier hs-var">tv_nm</span></a></span><span>
</span><span id="line-3082"></span><span>
</span><span id="line-3083"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#checkForDuplicateScopedTyVars"><span class="hs-identifier hs-type">checkForDuplicateScopedTyVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3084"></span><span class="hs-comment">-- Check for duplicates</span><span>
</span><span id="line-3085"></span><span class="hs-comment">-- See Note [Aliasing in type and class declarations]</span><span>
</span><span id="line-3086"></span><span id="checkForDuplicateScopedTyVars"><span class="annot"><span class="annottext">checkForDuplicateScopedTyVars :: [(Name, TcTyVar)] -&gt; TcM ()
</span><a href="GHC.Tc.Gen.HsType.html#checkForDuplicateScopedTyVars"><span class="hs-identifier hs-var hs-var">checkForDuplicateScopedTyVars</span></a></span></span><span> </span><span id="local-6989586621683077783"><span class="annot"><span class="annottext">[(Name, TcTyVar)]
</span><a href="#local-6989586621683077783"><span class="hs-identifier hs-var">scoped_prs</span></a></span></span><span>
</span><span id="line-3087"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcM () -&gt; TcM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Name, Name)] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[(Name, Name)]
</span><a href="#local-6989586621683077784"><span class="hs-identifier hs-var">err_prs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM () -&gt; TcM ()) -&gt; TcM () -&gt; TcM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-3088"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">((Name, Name) -&gt; TcM ()) -&gt; [(Name, Name)] -&gt; TcM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">(Name, Name) -&gt; TcM ()
</span><a href="#local-6989586621683077785"><span class="hs-identifier hs-var">report_dup</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, Name)]
</span><a href="#local-6989586621683077784"><span class="hs-identifier hs-var">err_prs</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcM ()
forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3089"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3090"></span><span>    </span><span class="hs-comment">-------------- Error reporting ------------</span><span>
</span><span id="line-3091"></span><span>    </span><span class="annot"><a href="#local-6989586621683077784"><span class="hs-identifier hs-type">err_prs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-3092"></span><span>    </span><span id="local-6989586621683077784"><span class="annot"><span class="annottext">err_prs :: [(Name, Name)]
</span><a href="#local-6989586621683077784"><span class="hs-identifier hs-var hs-var">err_prs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077787"><span class="hs-identifier hs-var">n1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077788"><span class="hs-identifier hs-var">n2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3093"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683077789"><span class="annot"><span class="annottext">NonEmpty (Name, TcTyVar)
</span><a href="#local-6989586621683077789"><span class="hs-identifier hs-var">prs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Name, TcTyVar) -&gt; (Name, TcTyVar) -&gt; Bool)
-&gt; [(Name, TcTyVar)] -&gt; [NonEmpty (Name, TcTyVar)]
forall a. (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [NonEmpty a]
</span><a href="GHC.Data.List.SetOps.html#findDupsEq"><span class="hs-identifier hs-var">findDupsEq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; TcTyVar -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(==)</span></span><span> </span><span class="annot"><span class="annottext">(TcTyVar -&gt; TcTyVar -&gt; Bool)
-&gt; ((Name, TcTyVar) -&gt; TcTyVar)
-&gt; (Name, TcTyVar)
-&gt; (Name, TcTyVar)
-&gt; Bool
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="annot"><span class="annottext">(Name, TcTyVar) -&gt; TcTyVar
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Name, TcTyVar)]
</span><a href="#local-6989586621683077783"><span class="hs-identifier hs-var">scoped_prs</span></a></span><span>
</span><span id="line-3094"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077787"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077787"><span class="hs-identifier hs-var">n1</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TcTyVar
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621683077788"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077788"><span class="hs-identifier hs-var">n2</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TcTyVar
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[(Name, TcTyVar)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">((Name, TcTyVar) -&gt; (Name, TcTyVar) -&gt; Bool)
-&gt; NonEmpty (Name, TcTyVar) -&gt; NonEmpty (Name, TcTyVar)
forall a. (a -&gt; a -&gt; Bool) -&gt; NonEmpty a -&gt; NonEmpty a
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#nubBy"><span class="hs-identifier hs-var">NE.nubBy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(==)</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Name -&gt; Bool)
-&gt; ((Name, TcTyVar) -&gt; Name)
-&gt; (Name, TcTyVar)
-&gt; (Name, TcTyVar)
-&gt; Bool
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="annot"><span class="annottext">(Name, TcTyVar) -&gt; Name
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty (Name, TcTyVar)
</span><a href="#local-6989586621683077789"><span class="hs-identifier hs-var">prs</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3095"></span><span>              </span><span class="hs-comment">-- This nubBy avoids bogus error reports when we have</span><span>
</span><span id="line-3096"></span><span>              </span><span class="hs-comment">--    [(&quot;f&quot;, f), ..., (&quot;f&quot;,f)....] in swizzle_prs</span><span>
</span><span id="line-3097"></span><span>              </span><span class="hs-comment">-- which happens with  class C f where { type T f }</span><span>
</span><span id="line-3098"></span><span>
</span><span id="line-3099"></span><span>    </span><span class="annot"><a href="#local-6989586621683077785"><span class="hs-identifier hs-type">report_dup</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3100"></span><span>    </span><span id="local-6989586621683077785"><span class="annot"><span class="annottext">report_dup :: (Name, Name) -&gt; TcM ()
</span><a href="#local-6989586621683077785"><span class="hs-identifier hs-var hs-var">report_dup</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077794"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077794"><span class="hs-identifier hs-var">n1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683077795"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077795"><span class="hs-identifier hs-var">n2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-3101"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcM () -&gt; TcM ()
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SrcSpan
forall a. NamedThing a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Types.Name.html#getSrcSpan"><span class="hs-identifier hs-var">getSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077795"><span class="hs-identifier hs-var">n2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM () -&gt; TcM ()) -&gt; TcM () -&gt; TcM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-3102"></span><span>        </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; TcM ()) -&gt; TcRnMessage -&gt; TcM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnDifferentNamesForTyVar"><span class="hs-identifier hs-var">TcRnDifferentNamesForTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077794"><span class="hs-identifier hs-var">n1</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683077795"><span class="hs-identifier hs-var">n2</span></a></span><span>
</span><span id="line-3103"></span><span>
</span><span id="line-3104"></span><span>
</span><span id="line-3105"></span><span class="hs-comment">{- Note [Aliasing in type and class declarations]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider
  data SameKind (a::k) (b::k)
  data T1 (a::k1) (b::k2) c = MkT (SameKind a b) c
We do not allow this, because `k1` and `k2` would both stand for the same type
variable -- they are both aliases for `k`.

Other examples
  data T2 (a::k1)                 = MkT2 (SameKind a Int) -- k1 stands for Type
  data T3 @k1 @k2 (a::k1) (b::k2) = MkT (SameKind a b)    -- k1 and k2 are aliases

  type UF :: forall zk. zk -&gt; Constraint
  class UF @kk (xb :: k) where   -- kk and k are aliases
    op :: (xs::kk) -&gt; Bool

See #24604 for an example that crashed GHC.

There is a design choice here. It would be possible to allow implicit type variables
like `k1` and `k2` in T1's declartion to stand for /abitrary kinds/.  This is in fact
the rule we use in /terms/ pattern signatures:
    f :: [Int] -&gt; Int
    f ((x::a) : xs) = ...
Here `a` stands for `Int`.  But in type /signatures/ we make a different choice:
    f1 :: forall (a::k1) (b::k2). SameKind a b -&gt; blah
    f2 :: forall (a::k). SameKind a Int -&gt; blah

Here f1's signature is rejected because `k1` and `k2` are aliased; and f2's is
rejected because `k` stands for `Int`.

Our current choice is that type and class declarations behave more like signatures;
we do not allow aliasing.  That is what `checkForDuplicateScopedTyVars` checks.
See !12328 for some design discussion.


Note [Disconnected type variables]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
This note applies when kind-checking the header of a type/class decl that has
a separate, standalone kind signature.  See #24083.

Consider:
   type S a = Type

   type C :: forall k. S k -&gt; Constraint
   class C (a :: S kk) where
     op :: ...kk...

Note that the class has a separate kind signature, so the elaborated decl should
look like
   class C @kk (a :: S kk) where ...

But how can we &quot;connect up&quot; the scoped variable `kk` with the skolem kind from the
standalone kind signature for `C`?  In general we do this by unifying the two.
For example
   type T k = (k,Type)
   type W :: forall k. T k -&gt; Type
   data W (a :: (x,Type)) = ..blah blah..

When we encounter (a :: (x,Type)) we unify the kind (x,Type) with the kind (T k)
from the standalone kind signature.  Of course, unification looks through synonyms
so we end up with the mapping [x :-&gt; k] that connects the scoped type variable `x`
with the kind from the signature.

But in our earlier example this unification is ineffective -- because `S` is a
phantom synonym that just discards its argument.  So our plan is this:

  if matchUpSigWithDecl fails to connect `kk with `k`, by unification,
  we give up and complain about a &quot;disconnected&quot; type variable.

See #24083 for dicussion of alternatives, none satisfactory.  Also the fix is
easy: just add an explicit `@kk` parameter to the declaration, to bind `kk`
explicitly, rather than binding it implicitly via unification.

(DTV1) We only want to make this check when there /are/ scoped type variables; and
  that is determined by needsEtaExpansion.  Examples:

     type C :: x -&gt; y -&gt; Constraint
     class C a :: b -&gt; Constraint where { ... }
     -- The a,b scope over the &quot;...&quot;

     type D :: forall k. k -&gt; Type
     data family D :: kk -&gt; Type
     -- Nothing for `kk` to scope over!

  In the latter data-family case, the match-up stuff in kcCheckDeclHeader_sig will
  return [] for `extra_tcbs`, and in fact `all_tcbs` will be empty.  So if we do
  the check-for-disconnected-tyvars check we'll complain that `kk` is not bound
  to one of `all_tcbs` (see #24083, comments about the `singletons` package).

  The scoped-tyvar stuff is needed precisely for data/class/newtype declarations,
  where needsEtaExpansion is True.

Note [Out of arity type variables]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
(Relevant ticket: #24470)
Type synonyms have a special scoping rule that allows implicit quantification in
the outermost kind signature:

  type P_e :: k -&gt; Type
  type P_e @k = Proxy :: k -&gt; Type     -- explicit binding

  type P_i    = Proxy :: k -&gt; Type     -- implicit binding (relies on the special rule)

This is a deprecated feature (warning flag: -Wimplicit-rhs-quantification) but
we have to support it for a couple more releases. It is explained in more detail
in Note [Implicit quantification in type synonyms] in GHC.Rename.HsType.

Type synonyms `P_e` and `P_i` are equivalent.  Both of them have kind
`forall k. k -&gt; Type` and arity 1. (Recall that the arity of a type synonym is
the number of arguments it requires at use sites; the arity matter because
unsaturated application of type families and type synonyms is not allowed).

We start to see problems when implicit RHS quantification (as in `P_i`) is
combined with a standalone king signature (like the one that `P_e` has).
That is:

  type P_i_sig :: k -&gt; Type
  type P_i_sig = Proxy :: k -&gt; Type

Per GHC Proposal #425, the arity of `P_i_sig` is determined /by the LHS only/,
which has no binders. So the arity of `P_i_sig` is 0.
At the same time, the legacy implicit quantification rule dictates that `k` is
brought into scope, as if there was a binder `@k` on the LHS.

We end up with a `k` that is in scope on the RHS but cannot be bound implicitly
on the LHS without affecting the arity. This led to #24470 (a compiler crash)

  GHC internal error: &#8216;k&#8217; is not in scope during type checking,
                      but it passed the renamer

This problem occurs only if the arity of the type synonym is insufficiently
high to accommodate an implicit binding. It can be worked around by adding an
unused binder on the LHS:

  type P_w :: k -&gt; Type
  type P_w @_w = Proxy :: k -&gt; Type

The variable `_w` is unused. The only effect of the `@_w` binder is that the
arity of `P_w` is changed from 0 to 1. However, bumping the arity is exactly
what's needed to make the implicit binding of `k` possible.

All this is a rather unfortunate bit of accidental complexity that will go away
when GHC drops support for implicit RHS quantification. In the meantime, we
ought to produce a proper error message instead of a compiler panic, and we do
that with a check in checkForDisconnectedScopedTyVars:

  | flav == TypeSynonymFlavour = mapM_ report_out_of_arity (filterOut ok scoped_prs)

-}</span><span>
</span><span id="line-3254"></span><span>
</span><span id="line-3255"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
             Bringing type variables into scope
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-3260"></span><span>
</span><span id="line-3261"></span><span class="hs-comment">--------------------------------------</span><span>
</span><span id="line-3262"></span><span class="hs-comment">--    HsForAllTelescope</span><span>
</span><span id="line-3263"></span><span class="hs-comment">--------------------------------------</span><span>
</span><span id="line-3264"></span><span>
</span><span id="line-3265"></span><span id="local-6989586621683075184"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcTKTelescope"><span class="hs-identifier hs-type">tcTKTelescope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a></span><span>
</span><span id="line-3266"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsForAllTelescope"><span class="hs-identifier hs-type">HsForAllTelescope</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-3267"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075184"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-3268"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyVarBinder"><span class="hs-identifier hs-type">TcTyVarBinder</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683075184"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-3269"></span><span class="hs-comment">-- A HsForAllTelescope comes only from a HsForAllTy,</span><span>
</span><span id="line-3270"></span><span class="hs-comment">-- an explicit, user-written forall type</span><span>
</span><span id="line-3271"></span><span id="tcTKTelescope"><span class="annot"><span class="annottext">tcTKTelescope :: forall a.
TcTyMode
-&gt; HsForAllTelescope GhcRn -&gt; TcM a -&gt; TcM ([TcTyVarBinder], a)
</span><a href="GHC.Tc.Gen.HsType.html#tcTKTelescope"><span class="hs-identifier hs-var hs-var">tcTKTelescope</span></a></span></span><span> </span><span id="local-6989586621683077815"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077815"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621683077816"><span class="annot"><span class="annottext">HsForAllTelescope GhcRn
</span><a href="#local-6989586621683077816"><span class="hs-identifier hs-var">tele</span></a></span></span><span> </span><span id="local-6989586621683077817"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683077817"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsForAllTelescope GhcRn
</span><a href="#local-6989586621683077816"><span class="hs-identifier hs-var">tele</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3272"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsForAllVis"><span class="hs-identifier hs-type">HsForAllVis</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsf_vis_bndrs :: forall pass. HsForAllTelescope pass -&gt; [LHsTyVarBndr () pass]
</span><a href="Language.Haskell.Syntax.Type.html#hsf_vis_bndrs"><span class="hs-identifier hs-var">hsf_vis_bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683077819"><span class="annot"><span class="annottext">[LHsTyVarBndr () GhcRn]
</span><a href="#local-6989586621683077819"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3273"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683077820"><span class="annot"><a href="#local-6989586621683077820"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon -&gt; IOEnv (Env TcGblEnv TcLclEnv) SkolemInfo
forall (m :: * -&gt; *). MonadIO m =&gt; SkolemInfoAnon -&gt; m SkolemInfo
</span><a href="GHC.Tc.Types.Origin.html#mkSkolemInfo"><span class="hs-identifier hs-var">mkSkolemInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVarBndrs -&gt; SkolemInfoAnon
</span><a href="GHC.Tc.Types.Origin.html#ForAllSkol"><span class="hs-identifier hs-var">ForAllSkol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[HsTyVarBndr () GhcRn] -&gt; TyVarBndrs
forall flag.
OutputableBndrFlag flag 'Renamed =&gt;
[HsTyVarBndr flag GhcRn] -&gt; TyVarBndrs
</span><a href="GHC.Tc.Types.Origin.html#HsTyVarBndrsRn"><span class="hs-identifier hs-var">HsTyVarBndrsRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsTyVarBndr () GhcRn)
-&gt; HsTyVarBndr () GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsTyVarBndr () GhcRn)
 -&gt; HsTyVarBndr () GhcRn)
-&gt; [GenLocated SrcSpanAnnA (HsTyVarBndr () GhcRn)]
-&gt; [HsTyVarBndr () GhcRn]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[LHsTyVarBndr () GhcRn]
[GenLocated SrcSpanAnnA (HsTyVarBndr () GhcRn)]
</span><a href="#local-6989586621683077819"><span class="hs-identifier hs-var">bndrs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3274"></span><span>          </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683077824"><span class="annot"><a href="#local-6989586621683077824"><span class="hs-identifier hs-var hs-var">skol_mode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SkolemMode
HasDebugCallStack =&gt; SkolemMode
</span><a href="GHC.Tc.Gen.HsType.html#smVanilla"><span class="hs-identifier hs-var">smVanilla</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_clone"><span class="hs-identifier hs-var">sm_clone</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_holes"><span class="hs-identifier hs-var">sm_holes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#mode_holes"><span class="hs-identifier hs-var">mode_holes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077815"><span class="hs-identifier hs-type">mode</span></a></span><span>
</span><span id="line-3275"></span><span>                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_tvtv"><span class="hs-identifier hs-var">sm_tvtv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SMDSkolemTv"><span class="hs-identifier hs-type">SMDSkolemTv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077820"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3276"></span><span>          </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077830"><span class="annot"><a href="#local-6989586621683077830"><span class="hs-identifier hs-var">req_tv_bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077831"><span class="annot"><a href="#local-6989586621683077831"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcExplicitTKBndrsX"><span class="hs-identifier hs-type">tcExplicitTKBndrsX</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077824"><span class="hs-identifier hs-type">skol_mode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077819"><span class="hs-identifier hs-type">bndrs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077817"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-3277"></span><span>            </span><span class="hs-comment">-- req_tv_bndrs :: [VarBndr TyVar ()],</span><span>
</span><span id="line-3278"></span><span>            </span><span class="hs-comment">-- but we want [VarBndr TyVar ForAllTyFlag]</span><span>
</span><span id="line-3279"></span><span>          </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#tyVarReqToBinders"><span class="hs-identifier hs-type">tyVarReqToBinders</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077830"><span class="hs-identifier hs-type">req_tv_bndrs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683077831"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3280"></span><span>
</span><span id="line-3281"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsForAllInvis"><span class="hs-identifier hs-type">HsForAllInvis</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsf_invis_bndrs :: forall pass.
HsForAllTelescope pass -&gt; [LHsTyVarBndr Specificity pass]
</span><a href="Language.Haskell.Syntax.Type.html#hsf_invis_bndrs"><span class="hs-identifier hs-var">hsf_invis_bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683077835"><span class="annot"><span class="annottext">[LHsTyVarBndr Specificity GhcRn]
</span><a href="#local-6989586621683077835"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3282"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683077836"><span class="annot"><a href="#local-6989586621683077836"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon -&gt; IOEnv (Env TcGblEnv TcLclEnv) SkolemInfo
forall (m :: * -&gt; *). MonadIO m =&gt; SkolemInfoAnon -&gt; m SkolemInfo
</span><a href="GHC.Tc.Types.Origin.html#mkSkolemInfo"><span class="hs-identifier hs-var">mkSkolemInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVarBndrs -&gt; SkolemInfoAnon
</span><a href="GHC.Tc.Types.Origin.html#ForAllSkol"><span class="hs-identifier hs-var">ForAllSkol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[HsTyVarBndr Specificity GhcRn] -&gt; TyVarBndrs
forall flag.
OutputableBndrFlag flag 'Renamed =&gt;
[HsTyVarBndr flag GhcRn] -&gt; TyVarBndrs
</span><a href="GHC.Tc.Types.Origin.html#HsTyVarBndrsRn"><span class="hs-identifier hs-var">HsTyVarBndrsRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsTyVarBndr Specificity GhcRn)
-&gt; HsTyVarBndr Specificity GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsTyVarBndr Specificity GhcRn)
 -&gt; HsTyVarBndr Specificity GhcRn)
-&gt; [GenLocated SrcSpanAnnA (HsTyVarBndr Specificity GhcRn)]
-&gt; [HsTyVarBndr Specificity GhcRn]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[LHsTyVarBndr Specificity GhcRn]
[GenLocated SrcSpanAnnA (HsTyVarBndr Specificity GhcRn)]
</span><a href="#local-6989586621683077835"><span class="hs-identifier hs-var">bndrs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3283"></span><span>          </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683077837"><span class="annot"><a href="#local-6989586621683077837"><span class="hs-identifier hs-var hs-var">skol_mode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SkolemMode
HasDebugCallStack =&gt; SkolemMode
</span><a href="GHC.Tc.Gen.HsType.html#smVanilla"><span class="hs-identifier hs-var">smVanilla</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_clone"><span class="hs-identifier hs-var">sm_clone</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_holes"><span class="hs-identifier hs-var">sm_holes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#mode_holes"><span class="hs-identifier hs-var">mode_holes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077815"><span class="hs-identifier hs-type">mode</span></a></span><span>
</span><span id="line-3284"></span><span>                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_tvtv"><span class="hs-identifier hs-var">sm_tvtv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SMDSkolemTv"><span class="hs-identifier hs-type">SMDSkolemTv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077836"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3285"></span><span>          </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077838"><span class="annot"><a href="#local-6989586621683077838"><span class="hs-identifier hs-var">inv_tv_bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077839"><span class="annot"><a href="#local-6989586621683077839"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcExplicitTKBndrsX"><span class="hs-identifier hs-type">tcExplicitTKBndrsX</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077837"><span class="hs-identifier hs-type">skol_mode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077835"><span class="hs-identifier hs-type">bndrs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077817"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-3286"></span><span>            </span><span class="hs-comment">-- inv_tv_bndrs :: [VarBndr TyVar Specificity],</span><span>
</span><span id="line-3287"></span><span>            </span><span class="hs-comment">-- but we want [VarBndr TyVar ForAllTyFlag]</span><span>
</span><span id="line-3288"></span><span>          </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#tyVarSpecToBinders"><span class="hs-identifier hs-type">tyVarSpecToBinders</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077838"><span class="hs-identifier hs-type">inv_tv_bndrs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683077839"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3289"></span><span>
</span><span id="line-3290"></span><span class="hs-comment">--------------------------------------</span><span>
</span><span id="line-3291"></span><span class="hs-comment">--    HsOuterTyVarBndrs</span><span>
</span><span id="line-3292"></span><span class="hs-comment">--------------------------------------</span><span>
</span><span id="line-3293"></span><span>
</span><span id="line-3294"></span><span id="local-6989586621683075400"><span id="local-6989586621683075401"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindOuterTKBndrsX"><span class="hs-identifier hs-type">bindOuterTKBndrsX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Type.html#OutputableBndrFlag"><span class="hs-identifier hs-type">OutputableBndrFlag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075400"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Hs.Extension.html#Renamed"><span class="hs-identifier hs-type">Renamed</span></a></span><span>  </span><span class="hs-comment">-- Only to support traceTc</span><span>
</span><span id="line-3295"></span><span>                  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SkolemMode"><span class="hs-identifier hs-type">SkolemMode</span></a></span><span>
</span><span id="line-3296"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOuterTyVarBndrs"><span class="hs-identifier hs-type">HsOuterTyVarBndrs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075400"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-3297"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075401"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-3298"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOuterTyVarBndrs"><span class="hs-identifier hs-type">HsOuterTyVarBndrs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075400"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683075401"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-3299"></span><span id="bindOuterTKBndrsX"><span class="annot"><span class="annottext">bindOuterTKBndrsX :: forall flag a.
OutputableBndrFlag flag 'Renamed =&gt;
SkolemMode
-&gt; HsOuterTyVarBndrs flag GhcRn
-&gt; TcM a
-&gt; TcM (HsOuterTyVarBndrs flag GhcTc, a)
</span><a href="GHC.Tc.Gen.HsType.html#bindOuterTKBndrsX"><span class="hs-identifier hs-var hs-var">bindOuterTKBndrsX</span></a></span></span><span> </span><span id="local-6989586621683077848"><span class="annot"><span class="annottext">SkolemMode
</span><a href="#local-6989586621683077848"><span class="hs-identifier hs-var">skol_mode</span></a></span></span><span> </span><span id="local-6989586621683077849"><span class="annot"><span class="annottext">HsOuterTyVarBndrs flag GhcRn
</span><a href="#local-6989586621683077849"><span class="hs-identifier hs-var">outer_bndrs</span></a></span></span><span> </span><span id="local-6989586621683077850"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683077850"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-3300"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsOuterTyVarBndrs flag GhcRn
</span><a href="#local-6989586621683077849"><span class="hs-identifier hs-var">outer_bndrs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3301"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOuterImplicit"><span class="hs-identifier hs-type">HsOuterImplicit</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">hso_ximplicit :: forall flag pass.
HsOuterTyVarBndrs flag pass -&gt; XHsOuterImplicit pass
</span><a href="Language.Haskell.Syntax.Type.html#hso_ximplicit"><span class="hs-identifier hs-var">hso_ximplicit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683077853"><span class="annot"><span class="annottext">XHsOuterImplicit GhcRn
</span><a href="#local-6989586621683077853"><span class="hs-identifier hs-var">imp_tvs</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3302"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077854"><span class="annot"><a href="#local-6989586621683077854"><span class="hs-identifier hs-var">imp_tvs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077855"><span class="annot"><a href="#local-6989586621683077855"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SkolemMode -&gt; HsQTvsRn -&gt; TcM a -&gt; TcM ([TcTyVar], a)
forall a. SkolemMode -&gt; HsQTvsRn -&gt; TcM a -&gt; TcM ([TcTyVar], a)
</span><a href="GHC.Tc.Gen.HsType.html#bindImplicitTKBndrsX"><span class="hs-identifier hs-var">bindImplicitTKBndrsX</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemMode
</span><a href="#local-6989586621683077848"><span class="hs-identifier hs-var">skol_mode</span></a></span><span> </span><span class="annot"><span class="annottext">HsQTvsRn
XHsOuterImplicit GhcRn
</span><a href="#local-6989586621683077853"><span class="hs-identifier hs-var">imp_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683077850"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-3303"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOuterImplicit"><span class="hs-identifier hs-type">HsOuterImplicit</span></a></span><span class="hs-special">{</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#hso_ximplicit"><span class="hs-identifier hs-var">hso_ximplicit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683077854"><span class="hs-identifier hs-type">imp_tvs'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-3304"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683077855"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3305"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOuterExplicit"><span class="hs-identifier hs-type">HsOuterExplicit</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">hso_bndrs :: forall flag pass.
HsOuterTyVarBndrs flag pass -&gt; [LHsTyVarBndr flag (NoGhcTc pass)]
</span><a href="Language.Haskell.Syntax.Type.html#hso_bndrs"><span class="hs-identifier hs-var">hso_bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683077859"><span class="annot"><span class="annottext">[LHsTyVarBndr flag (NoGhcTc GhcRn)]
</span><a href="#local-6989586621683077859"><span class="hs-identifier hs-var">exp_bndrs</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3306"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077860"><span class="annot"><a href="#local-6989586621683077860"><span class="hs-identifier hs-var">exp_tvs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077861"><span class="annot"><a href="#local-6989586621683077861"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SkolemMode
-&gt; [LHsTyVarBndr flag GhcRn]
-&gt; TcM a
-&gt; TcM ([VarBndr TcTyVar flag], a)
forall flag a.
OutputableBndrFlag flag 'Renamed =&gt;
SkolemMode
-&gt; [LHsTyVarBndr flag GhcRn]
-&gt; TcM a
-&gt; TcM ([VarBndr TcTyVar flag], a)
</span><a href="GHC.Tc.Gen.HsType.html#bindExplicitTKBndrsX"><span class="hs-identifier hs-var">bindExplicitTKBndrsX</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemMode
</span><a href="#local-6989586621683077848"><span class="hs-identifier hs-var">skol_mode</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsTyVarBndr flag (NoGhcTc GhcRn)]
[LHsTyVarBndr flag GhcRn]
</span><a href="#local-6989586621683077859"><span class="hs-identifier hs-var">exp_bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683077850"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-3307"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOuterExplicit"><span class="hs-identifier hs-type">HsOuterExplicit</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#hso_xexplicit"><span class="hs-identifier hs-var">hso_xexplicit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683077860"><span class="hs-identifier hs-type">exp_tvs'</span></a></span><span>
</span><span id="line-3308"></span><span>                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#hso_bndrs"><span class="hs-identifier hs-var">hso_bndrs</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683077859"><span class="hs-identifier hs-type">exp_bndrs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3309"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683077861"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3310"></span><span>
</span><span id="line-3311"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-3312"></span><span id="local-6989586621683075412"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#outerTyVars"><span class="hs-identifier hs-type">outerTyVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOuterTyVarBndrs"><span class="hs-identifier hs-type">HsOuterTyVarBndrs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075412"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-3313"></span><span class="hs-comment">-- The returned [TcTyVar] is not necessarily in dependency order</span><span>
</span><span id="line-3314"></span><span class="hs-comment">-- at least for the HsOuterImplicit case</span><span>
</span><span id="line-3315"></span><span id="outerTyVars"><span class="annot"><span class="annottext">outerTyVars :: forall flag. HsOuterTyVarBndrs flag GhcTc -&gt; [TcTyVar]
</span><a href="GHC.Tc.Gen.HsType.html#outerTyVars"><span class="hs-identifier hs-var hs-var">outerTyVars</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOuterImplicit"><span class="hs-identifier hs-type">HsOuterImplicit</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hso_ximplicit :: forall flag pass.
HsOuterTyVarBndrs flag pass -&gt; XHsOuterImplicit pass
</span><a href="Language.Haskell.Syntax.Type.html#hso_ximplicit"><span class="hs-identifier hs-var">hso_ximplicit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683077864"><span class="annot"><span class="annottext">XHsOuterImplicit GhcTc
</span><a href="#local-6989586621683077864"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
XHsOuterImplicit GhcTc
</span><a href="#local-6989586621683077864"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-3316"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#outerTyVars"><span class="hs-identifier hs-var">outerTyVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOuterExplicit"><span class="hs-identifier hs-type">HsOuterExplicit</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hso_xexplicit :: forall flag pass.
HsOuterTyVarBndrs flag pass -&gt; XHsOuterExplicit pass flag
</span><a href="Language.Haskell.Syntax.Type.html#hso_xexplicit"><span class="hs-identifier hs-var">hso_xexplicit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683077865"><span class="annot"><span class="annottext">XHsOuterExplicit GhcTc flag
</span><a href="#local-6989586621683077865"><span class="hs-identifier hs-var">tvbs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[VarBndr TcTyVar flag] -&gt; [TcTyVar]
forall tv argf. [VarBndr tv argf] -&gt; [tv]
</span><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-var">binderVars</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr TcTyVar flag]
XHsOuterExplicit GhcTc flag
</span><a href="#local-6989586621683077865"><span class="hs-identifier hs-var">tvbs</span></a></span><span>
</span><span id="line-3317"></span><span>
</span><span id="line-3318"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-3319"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#outerTyVarBndrs"><span class="hs-identifier hs-type">outerTyVarBndrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOuterTyVarBndrs"><span class="hs-identifier hs-type">HsOuterTyVarBndrs</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Specificity.html#Specificity"><span class="hs-identifier hs-type">Specificity</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#InvisTVBinder"><span class="hs-identifier hs-type">InvisTVBinder</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3320"></span><span id="outerTyVarBndrs"><span class="annot"><span class="annottext">outerTyVarBndrs :: HsOuterTyVarBndrs Specificity GhcTc
-&gt; [VarBndr TcTyVar Specificity]
</span><a href="GHC.Tc.Gen.HsType.html#outerTyVarBndrs"><span class="hs-identifier hs-var hs-var">outerTyVarBndrs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOuterImplicit"><span class="hs-identifier hs-type">HsOuterImplicit</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">hso_ximplicit :: forall flag pass.
HsOuterTyVarBndrs flag pass -&gt; XHsOuterImplicit pass
</span><a href="Language.Haskell.Syntax.Type.html#hso_ximplicit"><span class="hs-identifier hs-var">hso_ximplicit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683077866"><span class="annot"><span class="annottext">XHsOuterImplicit GhcTc
</span><a href="#local-6989586621683077866"><span class="hs-identifier hs-var">imp_tvs</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcTyVar -&gt; Specificity -&gt; VarBndr TcTyVar Specificity
forall var argf. var -&gt; argf -&gt; VarBndr var argf
</span><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077867"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">Specificity
</span><a href="Language.Haskell.Syntax.Specificity.html#SpecifiedSpec"><span class="hs-identifier hs-var">SpecifiedSpec</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621683077867"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683077867"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
XHsOuterImplicit GhcTc
</span><a href="#local-6989586621683077866"><span class="hs-identifier hs-var">imp_tvs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3321"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#outerTyVarBndrs"><span class="hs-identifier hs-var">outerTyVarBndrs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOuterExplicit"><span class="hs-identifier hs-type">HsOuterExplicit</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">hso_xexplicit :: forall flag pass.
HsOuterTyVarBndrs flag pass -&gt; XHsOuterExplicit pass flag
</span><a href="Language.Haskell.Syntax.Type.html#hso_xexplicit"><span class="hs-identifier hs-var">hso_xexplicit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683077869"><span class="annot"><span class="annottext">XHsOuterExplicit GhcTc Specificity
</span><a href="#local-6989586621683077869"><span class="hs-identifier hs-var">exp_tvs</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[VarBndr TcTyVar Specificity]
XHsOuterExplicit GhcTc Specificity
</span><a href="#local-6989586621683077869"><span class="hs-identifier hs-var">exp_tvs</span></a></span><span>
</span><span id="line-3322"></span><span>
</span><span id="line-3323"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-3324"></span><span id="local-6989586621683075086"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#scopedSortOuter"><span class="hs-identifier hs-type">scopedSortOuter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOuterTyVarBndrs"><span class="hs-identifier hs-type">HsOuterTyVarBndrs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075086"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOuterTyVarBndrs"><span class="hs-identifier hs-type">HsOuterTyVarBndrs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075086"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-3325"></span><span class="hs-comment">-- Sort any /implicit/ binders into dependency order</span><span>
</span><span id="line-3326"></span><span class="hs-comment">--     (zonking first so we can see the dependencies)</span><span>
</span><span id="line-3327"></span><span class="hs-comment">-- /Explicit/ ones are already in the right order</span><span>
</span><span id="line-3328"></span><span id="scopedSortOuter"><span class="annot"><span class="annottext">scopedSortOuter :: forall flag.
HsOuterTyVarBndrs flag GhcTc -&gt; TcM (HsOuterTyVarBndrs flag GhcTc)
</span><a href="GHC.Tc.Gen.HsType.html#scopedSortOuter"><span class="hs-identifier hs-var hs-var">scopedSortOuter</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOuterImplicit"><span class="hs-identifier hs-type">HsOuterImplicit</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">hso_ximplicit :: forall flag pass.
HsOuterTyVarBndrs flag pass -&gt; XHsOuterImplicit pass
</span><a href="Language.Haskell.Syntax.Type.html#hso_ximplicit"><span class="hs-identifier hs-var">hso_ximplicit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683077873"><span class="annot"><span class="annottext">XHsOuterImplicit GhcTc
</span><a href="#local-6989586621683077873"><span class="hs-identifier hs-var">imp_tvs</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-3329"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683077874"><span class="annot"><a href="#local-6989586621683077874"><span class="hs-identifier hs-var">imp_tvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TcTyVar] -&gt; TcM [TcTyVar]
</span><a href="GHC.Tc.Gen.HsType.html#zonkAndScopedSort"><span class="hs-identifier hs-var">zonkAndScopedSort</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
XHsOuterImplicit GhcTc
</span><a href="#local-6989586621683077873"><span class="hs-identifier hs-var">imp_tvs</span></a></span><span>
</span><span id="line-3330"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOuterImplicit"><span class="hs-identifier hs-type">HsOuterImplicit</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#hso_ximplicit"><span class="hs-identifier hs-var">hso_ximplicit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683077874"><span class="hs-identifier hs-type">imp_tvs</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3331"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#scopedSortOuter"><span class="hs-identifier hs-var">scopedSortOuter</span></a></span><span> </span><span id="local-6989586621683077875"><span class="annot"><span class="annottext">bndrs :: HsOuterTyVarBndrs flag GhcTc
</span><a href="#local-6989586621683077875"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOuterExplicit"><span class="hs-identifier hs-type">HsOuterExplicit</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-3332"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- No need to dependency-sort (or zonk) explicit quantifiers</span><span>
</span><span id="line-3333"></span><span>    </span><span class="annot"><span class="annottext">HsOuterTyVarBndrs flag GhcTc
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsOuterTyVarBndrs flag GhcTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">HsOuterTyVarBndrs flag GhcTc
</span><a href="#local-6989586621683077875"><span class="hs-identifier hs-var">bndrs</span></a></span><span>
</span><span id="line-3334"></span><span>
</span><span id="line-3335"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-3336"></span><span id="local-6989586621683075068"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindOuterSigTKBndrs_Tv"><span class="hs-identifier hs-type">bindOuterSigTKBndrs_Tv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOuterSigTyVarBndrs"><span class="hs-identifier hs-type">HsOuterSigTyVarBndrs</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-3337"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075068"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOuterSigTyVarBndrs"><span class="hs-identifier hs-type">HsOuterSigTyVarBndrs</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683075068"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-3338"></span><span id="bindOuterSigTKBndrs_Tv"><span class="annot"><span class="annottext">bindOuterSigTKBndrs_Tv :: forall a.
HsOuterSigTyVarBndrs GhcRn
-&gt; TcM a -&gt; TcM (HsOuterTyVarBndrs Specificity GhcTc, a)
</span><a href="GHC.Tc.Gen.HsType.html#bindOuterSigTKBndrs_Tv"><span class="hs-identifier hs-var hs-var">bindOuterSigTKBndrs_Tv</span></a></span></span><span>
</span><span id="line-3339"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SkolemMode
-&gt; HsOuterSigTyVarBndrs GhcRn
-&gt; TcM a
-&gt; TcM (HsOuterTyVarBndrs Specificity GhcTc, a)
forall flag a.
OutputableBndrFlag flag 'Renamed =&gt;
SkolemMode
-&gt; HsOuterTyVarBndrs flag GhcRn
-&gt; TcM a
-&gt; TcM (HsOuterTyVarBndrs flag GhcTc, a)
</span><a href="GHC.Tc.Gen.HsType.html#bindOuterTKBndrsX"><span class="hs-identifier hs-var">bindOuterTKBndrsX</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SkolemMode
HasDebugCallStack =&gt; SkolemMode
</span><a href="GHC.Tc.Gen.HsType.html#smVanilla"><span class="hs-identifier hs-var">smVanilla</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_clone"><span class="hs-identifier hs-var">sm_clone</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_tvtv"><span class="hs-identifier hs-var">sm_tvtv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SMDTyVarTv"><span class="hs-identifier hs-type">SMDTyVarTv</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-3340"></span><span>
</span><span id="line-3341"></span><span id="local-6989586621683075418"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindOuterSigTKBndrs_Tv_M"><span class="hs-identifier hs-type">bindOuterSigTKBndrs_Tv_M</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a></span><span>
</span><span id="line-3342"></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOuterSigTyVarBndrs"><span class="hs-identifier hs-type">HsOuterSigTyVarBndrs</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-3343"></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075418"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOuterSigTyVarBndrs"><span class="hs-identifier hs-type">HsOuterSigTyVarBndrs</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683075418"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-3344"></span><span class="hs-comment">-- Do not push level; do not make implication constraint; use Tvs</span><span>
</span><span id="line-3345"></span><span class="hs-comment">-- Two major clients of this &quot;bind-only&quot; path are:</span><span>
</span><span id="line-3346"></span><span class="hs-comment">--    Note [Using TyVarTvs for kind-checking GADTs] in GHC.Tc.TyCl</span><span>
</span><span id="line-3347"></span><span class="hs-comment">--    Note [Checking partial type signatures]</span><span>
</span><span id="line-3348"></span><span id="bindOuterSigTKBndrs_Tv_M"><span class="annot"><span class="annottext">bindOuterSigTKBndrs_Tv_M :: forall a.
TcTyMode
-&gt; HsOuterSigTyVarBndrs GhcRn
-&gt; TcM a
-&gt; TcM (HsOuterTyVarBndrs Specificity GhcTc, a)
</span><a href="GHC.Tc.Gen.HsType.html#bindOuterSigTKBndrs_Tv_M"><span class="hs-identifier hs-var hs-var">bindOuterSigTKBndrs_Tv_M</span></a></span></span><span> </span><span id="local-6989586621683077882"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077882"><span class="hs-identifier hs-var">mode</span></a></span></span><span>
</span><span id="line-3349"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SkolemMode
-&gt; HsOuterSigTyVarBndrs GhcRn
-&gt; TcM a
-&gt; TcM (HsOuterTyVarBndrs Specificity GhcTc, a)
forall flag a.
OutputableBndrFlag flag 'Renamed =&gt;
SkolemMode
-&gt; HsOuterTyVarBndrs flag GhcRn
-&gt; TcM a
-&gt; TcM (HsOuterTyVarBndrs flag GhcTc, a)
</span><a href="GHC.Tc.Gen.HsType.html#bindOuterTKBndrsX"><span class="hs-identifier hs-var">bindOuterTKBndrsX</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SkolemMode
HasDebugCallStack =&gt; SkolemMode
</span><a href="GHC.Tc.Gen.HsType.html#smVanilla"><span class="hs-identifier hs-var">smVanilla</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_clone"><span class="hs-identifier hs-var">sm_clone</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_tvtv"><span class="hs-identifier hs-var">sm_tvtv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SMDTyVarTv"><span class="hs-identifier hs-type">SMDTyVarTv</span></a></span><span>
</span><span id="line-3350"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_holes"><span class="hs-identifier hs-var">sm_holes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#mode_holes"><span class="hs-identifier hs-var">mode_holes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077882"><span class="hs-identifier hs-type">mode</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-3351"></span><span>
</span><span id="line-3352"></span><span id="local-6989586621683075421"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindOuterFamEqnTKBndrs_Q_Tv"><span class="hs-identifier hs-type">bindOuterFamEqnTKBndrs_Q_Tv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOuterFamEqnTyVarBndrs"><span class="hs-identifier hs-type">HsOuterFamEqnTyVarBndrs</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-3353"></span><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075421"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-3354"></span><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOuterFamEqnTyVarBndrs"><span class="hs-identifier hs-type">HsOuterFamEqnTyVarBndrs</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683075421"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-3355"></span><span id="bindOuterFamEqnTKBndrs_Q_Tv"><span class="annot"><span class="annottext">bindOuterFamEqnTKBndrs_Q_Tv :: forall a.
HsOuterFamEqnTyVarBndrs GhcRn
-&gt; TcM a -&gt; TcM (HsOuterFamEqnTyVarBndrs GhcTc, a)
</span><a href="GHC.Tc.Gen.HsType.html#bindOuterFamEqnTKBndrs_Q_Tv"><span class="hs-identifier hs-var hs-var">bindOuterFamEqnTKBndrs_Q_Tv</span></a></span></span><span> </span><span id="local-6989586621683077885"><span class="annot"><span class="annottext">HsOuterFamEqnTyVarBndrs GhcRn
</span><a href="#local-6989586621683077885"><span class="hs-identifier hs-var">hs_bndrs</span></a></span></span><span> </span><span id="local-6989586621683077886"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683077886"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-3356"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SkolemMode
-&gt; HsOuterFamEqnTyVarBndrs GhcRn
-&gt; TcM a
-&gt; TcM (HsOuterFamEqnTyVarBndrs GhcTc, a)
forall flag a.
OutputableBndrFlag flag 'Renamed =&gt;
SkolemMode
-&gt; HsOuterTyVarBndrs flag GhcRn
-&gt; TcM a
-&gt; TcM (HsOuterTyVarBndrs flag GhcTc, a)
</span><a href="GHC.Tc.Gen.HsType.html#bindOuterTKBndrsX"><span class="hs-identifier hs-var">bindOuterTKBndrsX</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SkolemMode
HasDebugCallStack =&gt; SkolemMode
</span><a href="GHC.Tc.Gen.HsType.html#smVanilla"><span class="hs-identifier hs-var">smVanilla</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_clone"><span class="hs-identifier hs-var">sm_clone</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_parent"><span class="hs-identifier hs-var">sm_parent</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span>
</span><span id="line-3357"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_tvtv"><span class="hs-identifier hs-var">sm_tvtv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SMDTyVarTv"><span class="hs-identifier hs-type">SMDTyVarTv</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-3358"></span><span>                      </span><span class="annot"><span class="annottext">HsOuterFamEqnTyVarBndrs GhcRn
</span><a href="#local-6989586621683077885"><span class="hs-identifier hs-var">hs_bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683077886"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-3359"></span><span>    </span><span class="hs-comment">-- sm_clone=False: see Note [Cloning for type variable binders]</span><span>
</span><span id="line-3360"></span><span>
</span><span id="line-3361"></span><span id="local-6989586621683075423"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindOuterFamEqnTKBndrs"><span class="hs-identifier hs-type">bindOuterFamEqnTKBndrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a></span><span>
</span><span id="line-3362"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOuterFamEqnTyVarBndrs"><span class="hs-identifier hs-type">HsOuterFamEqnTyVarBndrs</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-3363"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075423"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-3364"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOuterFamEqnTyVarBndrs"><span class="hs-identifier hs-type">HsOuterFamEqnTyVarBndrs</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683075423"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-3365"></span><span id="bindOuterFamEqnTKBndrs"><span class="annot"><span class="annottext">bindOuterFamEqnTKBndrs :: forall a.
SkolemInfo
-&gt; HsOuterFamEqnTyVarBndrs GhcRn
-&gt; TcM a
-&gt; TcM (HsOuterFamEqnTyVarBndrs GhcTc, a)
</span><a href="GHC.Tc.Gen.HsType.html#bindOuterFamEqnTKBndrs"><span class="hs-identifier hs-var hs-var">bindOuterFamEqnTKBndrs</span></a></span></span><span> </span><span id="local-6989586621683077890"><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621683077890"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span>
</span><span id="line-3366"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SkolemMode
-&gt; HsOuterFamEqnTyVarBndrs GhcRn
-&gt; TcM a
-&gt; TcM (HsOuterFamEqnTyVarBndrs GhcTc, a)
forall flag a.
OutputableBndrFlag flag 'Renamed =&gt;
SkolemMode
-&gt; HsOuterTyVarBndrs flag GhcRn
-&gt; TcM a
-&gt; TcM (HsOuterTyVarBndrs flag GhcTc, a)
</span><a href="GHC.Tc.Gen.HsType.html#bindOuterTKBndrsX"><span class="hs-identifier hs-var">bindOuterTKBndrsX</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SkolemMode
HasDebugCallStack =&gt; SkolemMode
</span><a href="GHC.Tc.Gen.HsType.html#smVanilla"><span class="hs-identifier hs-var">smVanilla</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_clone"><span class="hs-identifier hs-var">sm_clone</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_parent"><span class="hs-identifier hs-var">sm_parent</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span>
</span><span id="line-3367"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_tvtv"><span class="hs-identifier hs-var">sm_tvtv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SMDSkolemTv"><span class="hs-identifier hs-type">SMDSkolemTv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077890"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-3368"></span><span>    </span><span class="hs-comment">-- sm_clone=False: see Note [Cloning for type variable binders]</span><span>
</span><span id="line-3369"></span><span>
</span><span id="line-3370"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-3371"></span><span id="local-6989586621683075081"><span id="local-6989586621683075082"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcOuterTKBndrs"><span class="hs-identifier hs-type">tcOuterTKBndrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Type.html#OutputableBndrFlag"><span class="hs-identifier hs-type">OutputableBndrFlag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075081"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Hs.Extension.html#Renamed"><span class="hs-identifier hs-type">Renamed</span></a></span><span>   </span><span class="hs-comment">-- Only to support traceTc</span><span>
</span><span id="line-3372"></span><span>               </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a></span><span>
</span><span id="line-3373"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOuterTyVarBndrs"><span class="hs-identifier hs-type">HsOuterTyVarBndrs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075081"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-3374"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075082"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOuterTyVarBndrs"><span class="hs-identifier hs-type">HsOuterTyVarBndrs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075081"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683075082"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-3375"></span><span id="tcOuterTKBndrs"><span class="annot"><span class="annottext">tcOuterTKBndrs :: forall flag a.
OutputableBndrFlag flag 'Renamed =&gt;
SkolemInfo
-&gt; HsOuterTyVarBndrs flag GhcRn
-&gt; TcM a
-&gt; TcM (HsOuterTyVarBndrs flag GhcTc, a)
</span><a href="GHC.Tc.Gen.HsType.html#tcOuterTKBndrs"><span class="hs-identifier hs-var hs-var">tcOuterTKBndrs</span></a></span></span><span> </span><span id="local-6989586621683077894"><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621683077894"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span>
</span><span id="line-3376"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SkolemMode
-&gt; SkolemInfo
-&gt; HsOuterTyVarBndrs flag GhcRn
-&gt; TcM a
-&gt; TcM (HsOuterTyVarBndrs flag GhcTc, a)
forall flag a.
OutputableBndrFlag flag 'Renamed =&gt;
SkolemMode
-&gt; SkolemInfo
-&gt; HsOuterTyVarBndrs flag GhcRn
-&gt; TcM a
-&gt; TcM (HsOuterTyVarBndrs flag GhcTc, a)
</span><a href="GHC.Tc.Gen.HsType.html#tcOuterTKBndrsX"><span class="hs-identifier hs-var">tcOuterTKBndrsX</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SkolemMode
HasDebugCallStack =&gt; SkolemMode
</span><a href="GHC.Tc.Gen.HsType.html#smVanilla"><span class="hs-identifier hs-var">smVanilla</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_clone"><span class="hs-identifier hs-var">sm_clone</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span>
</span><span id="line-3377"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_tvtv"><span class="hs-identifier hs-var">sm_tvtv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SMDSkolemTv"><span class="hs-identifier hs-type">SMDSkolemTv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077894"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-3378"></span><span>                    </span><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621683077894"><span class="hs-identifier hs-var">skol_info</span></a></span><span>
</span><span id="line-3379"></span><span>  </span><span class="hs-comment">-- Do not clone the outer binders</span><span>
</span><span id="line-3380"></span><span>  </span><span class="hs-comment">-- See Note [Cloning for type variable binders] under &quot;must not&quot;</span><span>
</span><span id="line-3381"></span><span>
</span><span id="line-3382"></span><span id="local-6989586621683075427"><span id="local-6989586621683075428"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcOuterTKBndrsX"><span class="hs-identifier hs-type">tcOuterTKBndrsX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Type.html#OutputableBndrFlag"><span class="hs-identifier hs-type">OutputableBndrFlag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075427"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Hs.Extension.html#Renamed"><span class="hs-identifier hs-type">Renamed</span></a></span><span>   </span><span class="hs-comment">-- Only to support traceTc</span><span>
</span><span id="line-3383"></span><span>                </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SkolemMode"><span class="hs-identifier hs-type">SkolemMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a></span><span>
</span><span id="line-3384"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOuterTyVarBndrs"><span class="hs-identifier hs-type">HsOuterTyVarBndrs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075427"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-3385"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075428"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOuterTyVarBndrs"><span class="hs-identifier hs-type">HsOuterTyVarBndrs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075427"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683075428"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-3386"></span><span class="hs-comment">-- Push level, capture constraints, make implication</span><span>
</span><span id="line-3387"></span><span id="tcOuterTKBndrsX"><span class="annot"><span class="annottext">tcOuterTKBndrsX :: forall flag a.
OutputableBndrFlag flag 'Renamed =&gt;
SkolemMode
-&gt; SkolemInfo
-&gt; HsOuterTyVarBndrs flag GhcRn
-&gt; TcM a
-&gt; TcM (HsOuterTyVarBndrs flag GhcTc, a)
</span><a href="GHC.Tc.Gen.HsType.html#tcOuterTKBndrsX"><span class="hs-identifier hs-var hs-var">tcOuterTKBndrsX</span></a></span></span><span> </span><span id="local-6989586621683077902"><span class="annot"><span class="annottext">SkolemMode
</span><a href="#local-6989586621683077902"><span class="hs-identifier hs-var">skol_mode</span></a></span></span><span> </span><span id="local-6989586621683077903"><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621683077903"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span id="local-6989586621683077904"><span class="annot"><span class="annottext">HsOuterTyVarBndrs flag GhcRn
</span><a href="#local-6989586621683077904"><span class="hs-identifier hs-var">outer_bndrs</span></a></span></span><span> </span><span id="local-6989586621683077905"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683077905"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-3388"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsOuterTyVarBndrs flag GhcRn
</span><a href="#local-6989586621683077904"><span class="hs-identifier hs-var">outer_bndrs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3389"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOuterImplicit"><span class="hs-identifier hs-type">HsOuterImplicit</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">hso_ximplicit :: forall flag pass.
HsOuterTyVarBndrs flag pass -&gt; XHsOuterImplicit pass
</span><a href="Language.Haskell.Syntax.Type.html#hso_ximplicit"><span class="hs-identifier hs-var">hso_ximplicit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683077906"><span class="annot"><span class="annottext">XHsOuterImplicit GhcRn
</span><a href="#local-6989586621683077906"><span class="hs-identifier hs-var">imp_tvs</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3390"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077907"><span class="annot"><a href="#local-6989586621683077907"><span class="hs-identifier hs-var">imp_tvs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077908"><span class="annot"><a href="#local-6989586621683077908"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SkolemMode -&gt; SkolemInfo -&gt; HsQTvsRn -&gt; TcM a -&gt; TcM ([TcTyVar], a)
forall a.
SkolemMode -&gt; SkolemInfo -&gt; HsQTvsRn -&gt; TcM a -&gt; TcM ([TcTyVar], a)
</span><a href="GHC.Tc.Gen.HsType.html#tcImplicitTKBndrsX"><span class="hs-identifier hs-var">tcImplicitTKBndrsX</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemMode
</span><a href="#local-6989586621683077902"><span class="hs-identifier hs-var">skol_mode</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621683077903"><span class="hs-identifier hs-var">skol_info</span></a></span><span> </span><span class="annot"><span class="annottext">HsQTvsRn
XHsOuterImplicit GhcRn
</span><a href="#local-6989586621683077906"><span class="hs-identifier hs-var">imp_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683077905"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-3391"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOuterImplicit"><span class="hs-identifier hs-type">HsOuterImplicit</span></a></span><span class="hs-special">{</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#hso_ximplicit"><span class="hs-identifier hs-var">hso_ximplicit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683077907"><span class="hs-identifier hs-type">imp_tvs'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-3392"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683077908"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3393"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOuterExplicit"><span class="hs-identifier hs-type">HsOuterExplicit</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">hso_bndrs :: forall flag pass.
HsOuterTyVarBndrs flag pass -&gt; [LHsTyVarBndr flag (NoGhcTc pass)]
</span><a href="Language.Haskell.Syntax.Type.html#hso_bndrs"><span class="hs-identifier hs-var">hso_bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683077910"><span class="annot"><span class="annottext">[LHsTyVarBndr flag (NoGhcTc GhcRn)]
</span><a href="#local-6989586621683077910"><span class="hs-identifier hs-var">exp_bndrs</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3394"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077911"><span class="annot"><a href="#local-6989586621683077911"><span class="hs-identifier hs-var">exp_tvs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077912"><span class="annot"><a href="#local-6989586621683077912"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SkolemMode
-&gt; [LHsTyVarBndr flag GhcRn]
-&gt; TcM a
-&gt; TcM ([VarBndr TcTyVar flag], a)
forall flag a.
OutputableBndrFlag flag 'Renamed =&gt;
SkolemMode
-&gt; [LHsTyVarBndr flag GhcRn]
-&gt; TcM a
-&gt; TcM ([VarBndr TcTyVar flag], a)
</span><a href="GHC.Tc.Gen.HsType.html#tcExplicitTKBndrsX"><span class="hs-identifier hs-var">tcExplicitTKBndrsX</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemMode
</span><a href="#local-6989586621683077902"><span class="hs-identifier hs-var">skol_mode</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsTyVarBndr flag (NoGhcTc GhcRn)]
[LHsTyVarBndr flag GhcRn]
</span><a href="#local-6989586621683077910"><span class="hs-identifier hs-var">exp_bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683077905"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-3395"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsOuterExplicit"><span class="hs-identifier hs-type">HsOuterExplicit</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#hso_xexplicit"><span class="hs-identifier hs-var">hso_xexplicit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683077911"><span class="hs-identifier hs-type">exp_tvs'</span></a></span><span>
</span><span id="line-3396"></span><span>                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#hso_bndrs"><span class="hs-identifier hs-var">hso_bndrs</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683077910"><span class="hs-identifier hs-type">exp_bndrs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3397"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683077912"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3398"></span><span>
</span><span id="line-3399"></span><span class="hs-comment">--------------------------------------</span><span>
</span><span id="line-3400"></span><span class="hs-comment">--    Explicit tyvar binders</span><span>
</span><span id="line-3401"></span><span class="hs-comment">--------------------------------------</span><span>
</span><span id="line-3402"></span><span>
</span><span id="line-3403"></span><span id="local-6989586621683075432"><span id="local-6989586621683075433"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcExplicitTKBndrs"><span class="hs-identifier hs-type">tcExplicitTKBndrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Type.html#OutputableBndrFlag"><span class="hs-identifier hs-type">OutputableBndrFlag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075432"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Hs.Extension.html#Renamed"><span class="hs-identifier hs-type">Renamed</span></a></span><span>    </span><span class="hs-comment">-- Only to suppor traceTc</span><span>
</span><span id="line-3404"></span><span>                  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a></span><span>
</span><span id="line-3405"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsTyVarBndr"><span class="hs-identifier hs-type">LHsTyVarBndr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075432"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3406"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075433"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-3407"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#VarBndr"><span class="hs-identifier hs-type">VarBndr</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075432"><span class="hs-identifier hs-type">flag</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683075433"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-3408"></span><span id="tcExplicitTKBndrs"><span class="annot"><span class="annottext">tcExplicitTKBndrs :: forall flag a.
OutputableBndrFlag flag 'Renamed =&gt;
SkolemInfo
-&gt; [LHsTyVarBndr flag GhcRn]
-&gt; TcM a
-&gt; TcM ([VarBndr TcTyVar flag], a)
</span><a href="GHC.Tc.Gen.HsType.html#tcExplicitTKBndrs"><span class="hs-identifier hs-var hs-var">tcExplicitTKBndrs</span></a></span></span><span> </span><span id="local-6989586621683077916"><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621683077916"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span>
</span><span id="line-3409"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SkolemMode
-&gt; [LHsTyVarBndr flag GhcRn]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ([VarBndr TcTyVar flag], a)
forall flag a.
OutputableBndrFlag flag 'Renamed =&gt;
SkolemMode
-&gt; [LHsTyVarBndr flag GhcRn]
-&gt; TcM a
-&gt; TcM ([VarBndr TcTyVar flag], a)
</span><a href="GHC.Tc.Gen.HsType.html#tcExplicitTKBndrsX"><span class="hs-identifier hs-var">tcExplicitTKBndrsX</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SkolemMode
HasDebugCallStack =&gt; SkolemMode
</span><a href="GHC.Tc.Gen.HsType.html#smVanilla"><span class="hs-identifier hs-var">smVanilla</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_clone"><span class="hs-identifier hs-var">sm_clone</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_tvtv"><span class="hs-identifier hs-var">sm_tvtv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SMDSkolemTv"><span class="hs-identifier hs-type">SMDSkolemTv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077916"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-3410"></span><span>
</span><span id="line-3411"></span><span id="local-6989586621683075395"><span id="local-6989586621683075396"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcExplicitTKBndrsX"><span class="hs-identifier hs-type">tcExplicitTKBndrsX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Type.html#OutputableBndrFlag"><span class="hs-identifier hs-type">OutputableBndrFlag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075395"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Hs.Extension.html#Renamed"><span class="hs-identifier hs-type">Renamed</span></a></span><span>    </span><span class="hs-comment">-- Only to suppor traceTc</span><span>
</span><span id="line-3412"></span><span>                   </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SkolemMode"><span class="hs-identifier hs-type">SkolemMode</span></a></span><span>
</span><span id="line-3413"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsTyVarBndr"><span class="hs-identifier hs-type">LHsTyVarBndr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075395"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3414"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075396"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-3415"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#VarBndr"><span class="hs-identifier hs-type">VarBndr</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075395"><span class="hs-identifier hs-type">flag</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683075396"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-3416"></span><span class="hs-comment">-- Push level, capture constraints, and emit an implication constraint.</span><span>
</span><span id="line-3417"></span><span class="hs-comment">-- The implication constraint has a ForAllSkol ic_info,</span><span>
</span><span id="line-3418"></span><span class="hs-comment">--   so that it is subject to a telescope test.</span><span>
</span><span id="line-3419"></span><span id="tcExplicitTKBndrsX"><span class="annot"><span class="annottext">tcExplicitTKBndrsX :: forall flag a.
OutputableBndrFlag flag 'Renamed =&gt;
SkolemMode
-&gt; [LHsTyVarBndr flag GhcRn]
-&gt; TcM a
-&gt; TcM ([VarBndr TcTyVar flag], a)
</span><a href="GHC.Tc.Gen.HsType.html#tcExplicitTKBndrsX"><span class="hs-identifier hs-var hs-var">tcExplicitTKBndrsX</span></a></span></span><span> </span><span id="local-6989586621683077930"><span class="annot"><span class="annottext">SkolemMode
</span><a href="#local-6989586621683077930"><span class="hs-identifier hs-var">skol_mode</span></a></span></span><span> </span><span id="local-6989586621683077931"><span class="annot"><span class="annottext">[LHsTyVarBndr flag GhcRn]
</span><a href="#local-6989586621683077931"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span> </span><span id="local-6989586621683077932"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683077932"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsTyVarBndr flag GhcRn)]
-&gt; Maybe
     (NonEmpty (GenLocated SrcSpanAnnA (HsTyVarBndr flag GhcRn)))
forall a. [a] -&gt; Maybe (NonEmpty a)
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#nonEmpty"><span class="hs-identifier hs-var">nonEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsTyVarBndr flag GhcRn]
[GenLocated SrcSpanAnnA (HsTyVarBndr flag GhcRn)]
</span><a href="#local-6989586621683077931"><span class="hs-identifier hs-var">bndrs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3420"></span><span>    </span><span class="annot"><span class="annottext">Maybe (NonEmpty (GenLocated SrcSpanAnnA (HsTyVarBndr flag GhcRn)))
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3421"></span><span>       </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683077933"><span class="annot"><a href="#local-6989586621683077933"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683077932"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-3422"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683077933"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3423"></span><span>
</span><span id="line-3424"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683077934"><span class="annot"><span class="annottext">NonEmpty (GenLocated SrcSpanAnnA (HsTyVarBndr flag GhcRn))
</span><a href="#local-6989586621683077934"><span class="hs-identifier hs-var">bndrs1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3425"></span><span>       </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077935"><span class="annot"><a href="#local-6989586621683077935"><span class="hs-identifier hs-var">tclvl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077936"><span class="annot"><a href="#local-6989586621683077936"><span class="hs-identifier hs-var">wanted</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683077937"><span class="annot"><a href="#local-6989586621683077937"><span class="hs-identifier hs-var">skol_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683077938"><span class="annot"><a href="#local-6989586621683077938"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3426"></span><span>             </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM ([VarBndr TcTyVar flag], a)
-&gt; TcM (TcLevel, WantedConstraints, ([VarBndr TcTyVar flag], a))
forall a. TcM a -&gt; TcM (TcLevel, WantedConstraints, a)
</span><a href="GHC.Tc.Utils.Monad.html#pushLevelAndCaptureConstraints"><span class="hs-identifier hs-var">pushLevelAndCaptureConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM ([VarBndr TcTyVar flag], a)
 -&gt; TcM (TcLevel, WantedConstraints, ([VarBndr TcTyVar flag], a)))
-&gt; TcM ([VarBndr TcTyVar flag], a)
-&gt; TcM (TcLevel, WantedConstraints, ([VarBndr TcTyVar flag], a))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-3427"></span><span>                </span><span class="annot"><span class="annottext">SkolemMode
-&gt; [LHsTyVarBndr flag GhcRn]
-&gt; TcM a
-&gt; TcM ([VarBndr TcTyVar flag], a)
forall flag a.
OutputableBndrFlag flag 'Renamed =&gt;
SkolemMode
-&gt; [LHsTyVarBndr flag GhcRn]
-&gt; TcM a
-&gt; TcM ([VarBndr TcTyVar flag], a)
</span><a href="GHC.Tc.Gen.HsType.html#bindExplicitTKBndrsX"><span class="hs-identifier hs-var">bindExplicitTKBndrsX</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemMode
</span><a href="#local-6989586621683077930"><span class="hs-identifier hs-var">skol_mode</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsTyVarBndr flag GhcRn]
</span><a href="#local-6989586621683077931"><span class="hs-identifier hs-var">bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM a -&gt; TcM ([VarBndr TcTyVar flag], a))
-&gt; TcM a -&gt; TcM ([VarBndr TcTyVar flag], a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-3428"></span><span>                </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683077932"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-3429"></span><span>
</span><span id="line-3430"></span><span>       </span><span class="hs-comment">-- Set up SkolemInfo for telescope test</span><span>
</span><span id="line-3431"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683077940"><span class="annot"><a href="#local-6989586621683077940"><span class="hs-identifier hs-var hs-var">bndr_1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty (GenLocated SrcSpanAnnA (HsTyVarBndr flag GhcRn))
-&gt; GenLocated SrcSpanAnnA (HsTyVarBndr flag GhcRn)
forall a. NonEmpty a -&gt; a
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#head"><span class="hs-identifier hs-var">NE.head</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (GenLocated SrcSpanAnnA (HsTyVarBndr flag GhcRn))
</span><a href="#local-6989586621683077934"><span class="hs-identifier hs-var">bndrs1</span></a></span><span class="hs-special">;</span><span> </span><span id="local-6989586621683077942"><span class="annot"><a href="#local-6989586621683077942"><span class="hs-identifier hs-var hs-var">bndr_n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty (GenLocated SrcSpanAnnA (HsTyVarBndr flag GhcRn))
-&gt; GenLocated SrcSpanAnnA (HsTyVarBndr flag GhcRn)
forall a. NonEmpty a -&gt; a
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#last"><span class="hs-identifier hs-var">NE.last</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (GenLocated SrcSpanAnnA (HsTyVarBndr flag GhcRn))
</span><a href="#local-6989586621683077934"><span class="hs-identifier hs-var">bndrs1</span></a></span><span>
</span><span id="line-3432"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683077944"><span class="annot"><a href="#local-6989586621683077944"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#mkSkolemInfo"><span class="hs-identifier hs-type">mkSkolemInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#ForAllSkol"><span class="hs-identifier hs-type">ForAllSkol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#HsTyVarBndrsRn"><span class="hs-identifier hs-type">HsTyVarBndrsRn</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-type">unLoc</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621683077931"><span class="hs-identifier hs-type">bndrs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3433"></span><span>         </span><span class="hs-comment">-- Notice that we use ForAllSkol here, ignoring the enclosing</span><span>
</span><span id="line-3434"></span><span>         </span><span class="hs-comment">-- skol_info unlike tcImplicitTKBndrs, because the bad-telescope</span><span>
</span><span id="line-3435"></span><span>         </span><span class="hs-comment">-- test applies only to ForAllSkol</span><span>
</span><span id="line-3436"></span><span>
</span><span id="line-3437"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-type">setSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#combineSrcSpans"><span class="hs-identifier hs-type">combineSrcSpans</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#getLocA"><span class="hs-identifier hs-type">getLocA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077940"><span class="hs-identifier hs-type">bndr_1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#getLocA"><span class="hs-identifier hs-type">getLocA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077942"><span class="hs-identifier hs-type">bndr_n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3438"></span><span>       </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#emitResidualTvConstraint"><span class="hs-identifier hs-type">emitResidualTvConstraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077944"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-type">binderVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077937"><span class="hs-identifier hs-type">skol_tvs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683077935"><span class="hs-identifier hs-type">tclvl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077936"><span class="hs-identifier hs-type">wanted</span></a></span><span>
</span><span id="line-3439"></span><span>
</span><span id="line-3440"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683077937"><span class="hs-identifier hs-type">skol_tvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683077938"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3441"></span><span>
</span><span id="line-3442"></span><span class="hs-comment">----------------</span><span>
</span><span id="line-3443"></span><span class="hs-comment">-- | Skolemise the 'HsTyVarBndr's in an 'HsForAllTelescope' with the supplied</span><span>
</span><span id="line-3444"></span><span class="hs-comment">-- 'TcTyMode'.</span><span>
</span><span id="line-3445"></span><span id="local-6989586621683077947"><span id="local-6989586621683077948"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindExplicitTKBndrs_Skol"><span class="hs-identifier hs-type">bindExplicitTKBndrs_Skol</span></a></span><span>
</span><span id="line-3446"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#OutputableBndrFlag"><span class="hs-identifier hs-type">OutputableBndrFlag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077947"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Hs.Extension.html#Renamed"><span class="hs-identifier hs-type">Renamed</span></a></span><span class="hs-special">)</span><span>      </span><span class="hs-comment">-- Only to suppor traceTc</span><span>
</span><span id="line-3447"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a></span><span>
</span><span id="line-3448"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsTyVarBndr"><span class="hs-identifier hs-type">LHsTyVarBndr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077947"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3449"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077948"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-3450"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#VarBndr"><span class="hs-identifier hs-type">VarBndr</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077947"><span class="hs-identifier hs-type">flag</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683077948"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-3451"></span><span>
</span><span id="line-3452"></span><span id="local-6989586621683075443"><span id="local-6989586621683075444"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindExplicitTKBndrs_Tv"><span class="hs-identifier hs-type">bindExplicitTKBndrs_Tv</span></a></span><span>
</span><span id="line-3453"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#OutputableBndrFlag"><span class="hs-identifier hs-type">OutputableBndrFlag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075443"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Hs.Extension.html#Renamed"><span class="hs-identifier hs-type">Renamed</span></a></span><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- Only to suppor traceTc</span><span>
</span><span id="line-3454"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsTyVarBndr"><span class="hs-identifier hs-type">LHsTyVarBndr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075443"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3455"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075444"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-3456"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#VarBndr"><span class="hs-identifier hs-type">VarBndr</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075443"><span class="hs-identifier hs-type">flag</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683075444"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-3457"></span><span>
</span><span id="line-3458"></span><span id="bindExplicitTKBndrs_Skol"><span class="annot"><span class="annottext">bindExplicitTKBndrs_Skol :: forall flag a.
OutputableBndrFlag flag 'Renamed =&gt;
SkolemInfo
-&gt; [LHsTyVarBndr flag GhcRn]
-&gt; TcM a
-&gt; TcM ([VarBndr TcTyVar flag], a)
</span><a href="GHC.Tc.Gen.HsType.html#bindExplicitTKBndrs_Skol"><span class="hs-identifier hs-var hs-var">bindExplicitTKBndrs_Skol</span></a></span></span><span> </span><span id="local-6989586621683077952"><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621683077952"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SkolemMode
-&gt; [LHsTyVarBndr flag GhcRn]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ([VarBndr TcTyVar flag], a)
forall flag a.
OutputableBndrFlag flag 'Renamed =&gt;
SkolemMode
-&gt; [LHsTyVarBndr flag GhcRn]
-&gt; TcM a
-&gt; TcM ([VarBndr TcTyVar flag], a)
</span><a href="GHC.Tc.Gen.HsType.html#bindExplicitTKBndrsX"><span class="hs-identifier hs-var">bindExplicitTKBndrsX</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SkolemMode
HasDebugCallStack =&gt; SkolemMode
</span><a href="GHC.Tc.Gen.HsType.html#smVanilla"><span class="hs-identifier hs-var">smVanilla</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_clone"><span class="hs-identifier hs-var">sm_clone</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_tvtv"><span class="hs-identifier hs-var">sm_tvtv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SMDSkolemTv"><span class="hs-identifier hs-type">SMDSkolemTv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077952"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-3459"></span><span id="bindExplicitTKBndrs_Tv"><span class="annot"><span class="annottext">bindExplicitTKBndrs_Tv :: forall flag a.
OutputableBndrFlag flag 'Renamed =&gt;
[LHsTyVarBndr flag GhcRn]
-&gt; TcM a -&gt; TcM ([VarBndr TcTyVar flag], a)
</span><a href="GHC.Tc.Gen.HsType.html#bindExplicitTKBndrs_Tv"><span class="hs-identifier hs-var hs-var">bindExplicitTKBndrs_Tv</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SkolemMode
-&gt; [LHsTyVarBndr flag GhcRn]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ([VarBndr TcTyVar flag], a)
forall flag a.
OutputableBndrFlag flag 'Renamed =&gt;
SkolemMode
-&gt; [LHsTyVarBndr flag GhcRn]
-&gt; TcM a
-&gt; TcM ([VarBndr TcTyVar flag], a)
</span><a href="GHC.Tc.Gen.HsType.html#bindExplicitTKBndrsX"><span class="hs-identifier hs-var">bindExplicitTKBndrsX</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SkolemMode
HasDebugCallStack =&gt; SkolemMode
</span><a href="GHC.Tc.Gen.HsType.html#smVanilla"><span class="hs-identifier hs-var">smVanilla</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_clone"><span class="hs-identifier hs-var">sm_clone</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_tvtv"><span class="hs-identifier hs-var">sm_tvtv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SMDTyVarTv"><span class="hs-identifier hs-type">SMDTyVarTv</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-3460"></span><span>   </span><span class="hs-comment">-- sm_clone: see Note [Cloning for type variable binders]</span><span>
</span><span id="line-3461"></span><span>
</span><span id="line-3462"></span><span id="local-6989586621683075315"><span id="local-6989586621683075316"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindExplicitTKBndrs_Q_Skol"><span class="hs-identifier hs-type">bindExplicitTKBndrs_Q_Skol</span></a></span><span>
</span><span id="line-3463"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#OutputableBndrFlag"><span class="hs-identifier hs-type">OutputableBndrFlag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075315"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Hs.Extension.html#Renamed"><span class="hs-identifier hs-type">Renamed</span></a></span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- Only to support traceTc</span><span>
</span><span id="line-3464"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a></span><span>
</span><span id="line-3465"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#ContextKind"><span class="hs-identifier hs-type">ContextKind</span></a></span><span>
</span><span id="line-3466"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsTyVarBndr"><span class="hs-identifier hs-type">LHsTyVarBndr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075315"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3467"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075316"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-3468"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#VarBndr"><span class="hs-identifier hs-type">VarBndr</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075315"><span class="hs-identifier hs-type">flag</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683075316"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-3469"></span><span>
</span><span id="line-3470"></span><span id="local-6989586621683075327"><span id="local-6989586621683075328"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindExplicitTKBndrs_Q_Tv"><span class="hs-identifier hs-type">bindExplicitTKBndrs_Q_Tv</span></a></span><span>
</span><span id="line-3471"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#OutputableBndrFlag"><span class="hs-identifier hs-type">OutputableBndrFlag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075327"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Hs.Extension.html#Renamed"><span class="hs-identifier hs-type">Renamed</span></a></span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- Only to support traceTc</span><span>
</span><span id="line-3472"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#ContextKind"><span class="hs-identifier hs-type">ContextKind</span></a></span><span>
</span><span id="line-3473"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsTyVarBndr"><span class="hs-identifier hs-type">LHsTyVarBndr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075327"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3474"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075328"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-3475"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#VarBndr"><span class="hs-identifier hs-type">VarBndr</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075327"><span class="hs-identifier hs-type">flag</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683075328"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-3476"></span><span class="hs-comment">-- These do not clone: see Note [Cloning for type variable binders]</span><span>
</span><span id="line-3477"></span><span id="bindExplicitTKBndrs_Q_Skol"><span class="annot"><span class="annottext">bindExplicitTKBndrs_Q_Skol :: forall flag a.
OutputableBndrFlag flag 'Renamed =&gt;
SkolemInfo
-&gt; ContextKind
-&gt; [LHsTyVarBndr flag GhcRn]
-&gt; TcM a
-&gt; TcM ([VarBndr TcTyVar flag], a)
</span><a href="GHC.Tc.Gen.HsType.html#bindExplicitTKBndrs_Q_Skol"><span class="hs-identifier hs-var hs-var">bindExplicitTKBndrs_Q_Skol</span></a></span></span><span> </span><span id="local-6989586621683077959"><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621683077959"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span id="local-6989586621683077960"><span class="annot"><span class="annottext">ContextKind
</span><a href="#local-6989586621683077960"><span class="hs-identifier hs-var">ctxt_kind</span></a></span></span><span> </span><span id="local-6989586621683077961"><span class="annot"><span class="annottext">[LHsTyVarBndr flag GhcRn]
</span><a href="#local-6989586621683077961"><span class="hs-identifier hs-var">hs_bndrs</span></a></span></span><span> </span><span id="local-6989586621683077962"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683077962"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-3478"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SkolemMode
-&gt; [LHsTyVarBndr flag GhcRn]
-&gt; TcM a
-&gt; TcM ([VarBndr TcTyVar flag], a)
forall flag a.
OutputableBndrFlag flag 'Renamed =&gt;
SkolemMode
-&gt; [LHsTyVarBndr flag GhcRn]
-&gt; TcM a
-&gt; TcM ([VarBndr TcTyVar flag], a)
</span><a href="GHC.Tc.Gen.HsType.html#bindExplicitTKBndrsX"><span class="hs-identifier hs-var">bindExplicitTKBndrsX</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SkolemMode
HasDebugCallStack =&gt; SkolemMode
</span><a href="GHC.Tc.Gen.HsType.html#smVanilla"><span class="hs-identifier hs-var">smVanilla</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_clone"><span class="hs-identifier hs-var">sm_clone</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_parent"><span class="hs-identifier hs-var">sm_parent</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span>
</span><span id="line-3479"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_kind"><span class="hs-identifier hs-var">sm_kind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683077960"><span class="hs-identifier hs-type">ctxt_kind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_tvtv"><span class="hs-identifier hs-var">sm_tvtv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SMDSkolemTv"><span class="hs-identifier hs-type">SMDSkolemTv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077959"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-3480"></span><span>                         </span><span class="annot"><span class="annottext">[LHsTyVarBndr flag GhcRn]
</span><a href="#local-6989586621683077961"><span class="hs-identifier hs-var">hs_bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683077962"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-3481"></span><span>    </span><span class="hs-comment">-- sm_clone=False: see Note [Cloning for type variable binders]</span><span>
</span><span id="line-3482"></span><span>
</span><span id="line-3483"></span><span id="bindExplicitTKBndrs_Q_Tv"><span class="annot"><span class="annottext">bindExplicitTKBndrs_Q_Tv :: forall flag a.
OutputableBndrFlag flag 'Renamed =&gt;
ContextKind
-&gt; [LHsTyVarBndr flag GhcRn]
-&gt; TcM a
-&gt; TcM ([VarBndr TcTyVar flag], a)
</span><a href="GHC.Tc.Gen.HsType.html#bindExplicitTKBndrs_Q_Tv"><span class="hs-identifier hs-var hs-var">bindExplicitTKBndrs_Q_Tv</span></a></span></span><span>  </span><span id="local-6989586621683077967"><span class="annot"><span class="annottext">ContextKind
</span><a href="#local-6989586621683077967"><span class="hs-identifier hs-var">ctxt_kind</span></a></span></span><span> </span><span id="local-6989586621683077968"><span class="annot"><span class="annottext">[LHsTyVarBndr flag GhcRn]
</span><a href="#local-6989586621683077968"><span class="hs-identifier hs-var">hs_bndrs</span></a></span></span><span> </span><span id="local-6989586621683077969"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683077969"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-3484"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SkolemMode
-&gt; [LHsTyVarBndr flag GhcRn]
-&gt; TcM a
-&gt; TcM ([VarBndr TcTyVar flag], a)
forall flag a.
OutputableBndrFlag flag 'Renamed =&gt;
SkolemMode
-&gt; [LHsTyVarBndr flag GhcRn]
-&gt; TcM a
-&gt; TcM ([VarBndr TcTyVar flag], a)
</span><a href="GHC.Tc.Gen.HsType.html#bindExplicitTKBndrsX"><span class="hs-identifier hs-var">bindExplicitTKBndrsX</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SkolemMode
HasDebugCallStack =&gt; SkolemMode
</span><a href="GHC.Tc.Gen.HsType.html#smVanilla"><span class="hs-identifier hs-var">smVanilla</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_clone"><span class="hs-identifier hs-var">sm_clone</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_parent"><span class="hs-identifier hs-var">sm_parent</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span>
</span><span id="line-3485"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_tvtv"><span class="hs-identifier hs-var">sm_tvtv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SMDTyVarTv"><span class="hs-identifier hs-type">SMDTyVarTv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_kind"><span class="hs-identifier hs-var">sm_kind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683077967"><span class="hs-identifier hs-type">ctxt_kind</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-3486"></span><span>                         </span><span class="annot"><span class="annottext">[LHsTyVarBndr flag GhcRn]
</span><a href="#local-6989586621683077968"><span class="hs-identifier hs-var">hs_bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683077969"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-3487"></span><span>    </span><span class="hs-comment">-- sm_clone=False: see Note [Cloning for type variable binders]</span><span>
</span><span id="line-3488"></span><span>
</span><span id="line-3489"></span><span id="local-6989586621683077970"><span id="local-6989586621683077971"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindExplicitTKBndrsX"><span class="hs-identifier hs-type">bindExplicitTKBndrsX</span></a></span><span>
</span><span id="line-3490"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#OutputableBndrFlag"><span class="hs-identifier hs-type">OutputableBndrFlag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077970"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Hs.Extension.html#Renamed"><span class="hs-identifier hs-type">Renamed</span></a></span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- Only to support traceTc</span><span>
</span><span id="line-3491"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SkolemMode"><span class="hs-identifier hs-type">SkolemMode</span></a></span><span>
</span><span id="line-3492"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsTyVarBndr"><span class="hs-identifier hs-type">LHsTyVarBndr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077970"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3493"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077971"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-3494"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#VarBndr"><span class="hs-identifier hs-type">VarBndr</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077970"><span class="hs-identifier hs-type">flag</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683077971"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>  </span><span class="hs-comment">-- Returned [TcTyVar] are in 1-1 correspondence</span><span>
</span><span id="line-3495"></span><span>                                      </span><span class="hs-comment">-- with the passed-in [LHsTyVarBndr]</span><span>
</span><span id="line-3496"></span><span id="bindExplicitTKBndrsX"><span class="annot"><span class="annottext">bindExplicitTKBndrsX :: forall flag a.
OutputableBndrFlag flag 'Renamed =&gt;
SkolemMode
-&gt; [LHsTyVarBndr flag GhcRn]
-&gt; TcM a
-&gt; TcM ([VarBndr TcTyVar flag], a)
</span><a href="GHC.Tc.Gen.HsType.html#bindExplicitTKBndrsX"><span class="hs-identifier hs-var hs-var">bindExplicitTKBndrsX</span></a></span></span><span> </span><span id="local-6989586621683077986"><span class="annot"><span class="annottext">skol_mode :: SkolemMode
</span><a href="#local-6989586621683077986"><span class="hs-identifier hs-var">skol_mode</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SM"><span class="hs-identifier hs-type">SM</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sm_parent :: SkolemMode -&gt; Bool
</span><a href="GHC.Tc.Gen.HsType.html#sm_parent"><span class="hs-identifier hs-var">sm_parent</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683077988"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683077988"><span class="hs-identifier hs-var">check_parent</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sm_kind :: SkolemMode -&gt; ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#sm_kind"><span class="hs-identifier hs-var">sm_kind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683077989"><span class="annot"><span class="annottext">ContextKind
</span><a href="#local-6989586621683077989"><span class="hs-identifier hs-var">ctxt_kind</span></a></span></span><span>
</span><span id="line-3497"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sm_holes :: SkolemMode -&gt; HoleInfo
</span><a href="GHC.Tc.Gen.HsType.html#sm_holes"><span class="hs-identifier hs-var">sm_holes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683077990"><span class="annot"><span class="annottext">HoleInfo
</span><a href="#local-6989586621683077990"><span class="hs-identifier hs-var">hole_info</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-3498"></span><span>                     </span><span id="local-6989586621683077991"><span class="annot"><span class="annottext">[LHsTyVarBndr flag GhcRn]
</span><a href="#local-6989586621683077991"><span class="hs-identifier hs-var">hs_tvs</span></a></span></span><span> </span><span id="local-6989586621683077992"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683077992"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-3499"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;bindExplicitTKBndrs&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsTyVarBndr flag GhcRn)] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsTyVarBndr flag GhcRn]
[GenLocated SrcSpanAnnA (HsTyVarBndr flag GhcRn)]
</span><a href="#local-6989586621683077991"><span class="hs-identifier hs-var">hs_tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3500"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsTyVarBndr flag GhcRn)]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ([VarBndr TcTyVar flag], a)
</span><a href="#local-6989586621683077993"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsTyVarBndr flag GhcRn]
[GenLocated SrcSpanAnnA (HsTyVarBndr flag GhcRn)]
</span><a href="#local-6989586621683077991"><span class="hs-identifier hs-var">hs_tvs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3501"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3502"></span><span>    </span><span id="local-6989586621683077994"><span class="annot"><span class="annottext">tc_ki_mode :: TcTyMode
</span><a href="#local-6989586621683077994"><span class="hs-identifier hs-var hs-var">tc_ki_mode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mode_tyki :: TypeOrKind
</span><a href="GHC.Tc.Gen.HsType.html#mode_tyki"><span class="hs-identifier hs-var">mode_tyki</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeOrKind
</span><a href="GHC.Types.Basic.html#KindLevel"><span class="hs-identifier hs-var">KindLevel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mode_holes :: HoleInfo
</span><a href="GHC.Tc.Gen.HsType.html#mode_holes"><span class="hs-identifier hs-var">mode_holes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HoleInfo
</span><a href="#local-6989586621683077990"><span class="hs-identifier hs-var">hole_info</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3503"></span><span>                 </span><span class="hs-comment">-- Inherit the HoleInfo from the context</span><span>
</span><span id="line-3504"></span><span>
</span><span id="line-3505"></span><span>    </span><span id="local-6989586621683077993"><span class="annot"><span class="annottext">go :: [GenLocated SrcSpanAnnA (HsTyVarBndr flag GhcRn)]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ([VarBndr TcTyVar flag], a)
</span><a href="#local-6989586621683077993"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683077995"><span class="annot"><a href="#local-6989586621683077995"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683077992"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-3506"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683077995"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3507"></span><span>    </span><span class="annot"><a href="#local-6989586621683077993"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683077996"><span class="annot"><span class="annottext">HsTyVarBndr flag GhcRn
</span><a href="#local-6989586621683077996"><span class="hs-identifier hs-var">hs_tv</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683077997"><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsTyVarBndr flag GhcRn)]
</span><a href="#local-6989586621683077997"><span class="hs-identifier hs-var">hs_tvs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-3508"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683077998"><span class="annot"><a href="#local-6989586621683077998"><span class="hs-identifier hs-var">lcl_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM (NameEnv TcTyThing)
</span><a href="GHC.Tc.Utils.Monad.html#getLclTypeEnv"><span class="hs-identifier hs-var">getLclTypeEnv</span></a></span><span>
</span><span id="line-3509"></span><span>            </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683078000"><span class="annot"><a href="#local-6989586621683078000"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683078001"><span class="hs-identifier hs-type">tc_hs_bndr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077998"><span class="hs-identifier hs-type">lcl_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077996"><span class="hs-identifier hs-type">hs_tv</span></a></span><span>
</span><span id="line-3510"></span><span>            </span><span class="hs-comment">-- Extend the environment as we go, in case a binder</span><span>
</span><span id="line-3511"></span><span>            </span><span class="hs-comment">-- is mentioned in the kind of a later binder</span><span>
</span><span id="line-3512"></span><span>            </span><span class="hs-comment">--   e.g. forall k (a::k). blah</span><span>
</span><span id="line-3513"></span><span>            </span><span class="hs-comment">-- NB: tv's Name may differ from hs_tv's</span><span>
</span><span id="line-3514"></span><span>            </span><span class="hs-comment">-- See Note [Cloning for type variable binders]</span><span>
</span><span id="line-3515"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683078002"><span class="annot"><a href="#local-6989586621683078002"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683078003"><span class="annot"><a href="#local-6989586621683078003"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcExtendNameTyVarEnv"><span class="hs-identifier hs-type">tcExtendNameTyVarEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#mk_tvb_pairs"><span class="hs-identifier hs-type">mk_tvb_pairs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077996"><span class="hs-identifier hs-type">hs_tv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078000"><span class="hs-identifier hs-type">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-3516"></span><span>                           </span><span class="annot"><a href="#local-6989586621683077993"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077997"><span class="hs-identifier hs-type">hs_tvs</span></a></span><span>
</span><span id="line-3517"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078000"><span class="hs-identifier hs-type">tv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#hsTyVarBndrFlag"><span class="hs-identifier hs-type">hsTyVarBndrFlag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077996"><span class="hs-identifier hs-type">hs_tv</span></a></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><a href="#local-6989586621683078002"><span class="hs-identifier hs-type">tvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683078003"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3518"></span><span>
</span><span id="line-3519"></span><span>    </span><span id="local-6989586621683075453"><span class="annot"><a href="#local-6989586621683078001"><span class="hs-identifier hs-type">tc_hs_bndr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.LclEnv.html#TcTypeEnv"><span class="hs-identifier hs-type">TcTypeEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTyVarBndr"><span class="hs-identifier hs-type">HsTyVarBndr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075453"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span></span><span>
</span><span id="line-3520"></span><span>    </span><span id="local-6989586621683078001"><span class="annot"><span class="annottext">tc_hs_bndr :: forall flag.
NameEnv TcTyThing
-&gt; HsTyVarBndr flag GhcRn -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
</span><a href="#local-6989586621683078001"><span class="hs-identifier hs-var hs-var">tc_hs_bndr</span></a></span></span><span> </span><span id="local-6989586621683078010"><span class="annot"><span class="annottext">NameEnv TcTyThing
</span><a href="#local-6989586621683078010"><span class="hs-identifier hs-var">lcl_env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTvb"><span class="hs-identifier hs-type">HsTvb</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tvb_var :: forall flag pass. HsTyVarBndr flag pass -&gt; HsBndrVar pass
</span><a href="Language.Haskell.Syntax.Type.html#tvb_var"><span class="hs-identifier hs-var">tvb_var</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683078011"><span class="annot"><span class="annottext">HsBndrVar GhcRn
</span><a href="#local-6989586621683078011"><span class="hs-identifier hs-var">bvar</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tvb_kind :: forall flag pass. HsTyVarBndr flag pass -&gt; HsBndrKind pass
</span><a href="Language.Haskell.Syntax.Type.html#tvb_kind"><span class="hs-identifier hs-var">tvb_kind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683078012"><span class="annot"><span class="annottext">HsBndrKind GhcRn
</span><a href="#local-6989586621683078012"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-3521"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683077988"><span class="hs-identifier hs-var">check_parent</span></a></span><span>
</span><span id="line-3522"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsBndrVar"><span class="hs-identifier hs-type">HsBndrVar</span></a></span><span> </span><span class="annot"><span class="annottext">XBndrVar GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683078013"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683078013"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsBndrVar GhcRn
</span><a href="#local-6989586621683078011"><span class="hs-identifier hs-var">bvar</span></a></span><span>
</span><span id="line-3523"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#ATyVar"><span class="hs-identifier hs-type">ATyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683078014"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683078014"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NameEnv TcTyThing -&gt; Name -&gt; Maybe TcTyThing
forall a. NameEnv a -&gt; Name -&gt; Maybe a
</span><a href="GHC.Types.Name.Env.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">NameEnv TcTyThing
</span><a href="#local-6989586621683078010"><span class="hs-identifier hs-var">lcl_env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683078013"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-3524"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; HsBndrKind GhcRn -&gt; TcM ()
</span><a href="#local-6989586621683078016"><span class="hs-identifier hs-var">check_hs_bndr_kind</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683078013"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; Type
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683078014"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsBndrKind GhcRn
</span><a href="#local-6989586621683078012"><span class="hs-identifier hs-var">kind</span></a></span><span>
</span><span id="line-3525"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683078014"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3526"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-3527"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683078017"><span class="annot"><a href="#local-6989586621683078017"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsBndrVar GhcRn -&gt; TcM Name
</span><a href="GHC.Tc.Gen.HsType.html#tcHsBndrVarName"><span class="hs-identifier hs-var">tcHsBndrVarName</span></a></span><span> </span><span class="annot"><span class="annottext">HsBndrVar GhcRn
</span><a href="#local-6989586621683078011"><span class="hs-identifier hs-var">bvar</span></a></span><span>
</span><span id="line-3528"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683078019"><span class="annot"><a href="#local-6989586621683078019"><span class="hs-identifier hs-var">kind'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683078020"><span class="hs-identifier hs-type">tc_hs_bndr_kind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078017"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078012"><span class="hs-identifier hs-type">kind</span></a></span><span>
</span><span id="line-3529"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#newTyVarBndr"><span class="hs-identifier hs-type">newTyVarBndr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683077986"><span class="hs-identifier hs-type">skol_mode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078017"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078019"><span class="hs-identifier hs-type">kind'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3530"></span><span>
</span><span id="line-3531"></span><span>    </span><span class="annot"><a href="#local-6989586621683078020"><span class="hs-identifier hs-type">tc_hs_bndr_kind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsBndrKind"><span class="hs-identifier hs-type">HsBndrKind</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span>
</span><span id="line-3532"></span><span>    </span><span id="local-6989586621683078020"><span class="annot"><span class="annottext">tc_hs_bndr_kind :: Name -&gt; HsBndrKind GhcRn -&gt; TcM Type
</span><a href="#local-6989586621683078020"><span class="hs-identifier hs-var hs-var">tc_hs_bndr_kind</span></a></span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsBndrNoKind"><span class="hs-identifier hs-type">HsBndrNoKind</span></a></span><span> </span><span class="annot"><span class="annottext">XBndrNoKind GhcRn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContextKind -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#newExpectedKind"><span class="hs-identifier hs-var">newExpectedKind</span></a></span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="#local-6989586621683077989"><span class="hs-identifier hs-var">ctxt_kind</span></a></span><span>
</span><span id="line-3533"></span><span>    </span><span class="annot"><a href="#local-6989586621683078020"><span class="hs-identifier hs-var">tc_hs_bndr_kind</span></a></span><span> </span><span id="local-6989586621683078022"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683078022"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsBndrKind"><span class="hs-identifier hs-type">HsBndrKind</span></a></span><span> </span><span class="annot"><span class="annottext">XBndrKind GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683078023"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683078023"><span class="hs-identifier hs-var">kind</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyMode -&gt; UserTypeCtxt -&gt; LHsType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_lhs_kind_sig"><span class="hs-identifier hs-var">tc_lhs_kind_sig</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077994"><span class="hs-identifier hs-var">tc_ki_mode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#TyVarBndrKindCtxt"><span class="hs-identifier hs-var">TyVarBndrKindCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683078022"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683078023"><span class="hs-identifier hs-var">kind</span></a></span><span>
</span><span id="line-3534"></span><span>
</span><span id="line-3535"></span><span>    </span><span class="hs-comment">-- Check the HsBndrKind against the kind of the parent type variable,</span><span>
</span><span id="line-3536"></span><span>    </span><span class="hs-comment">-- e.g. the following is rejected:</span><span>
</span><span id="line-3537"></span><span>    </span><span class="hs-comment">--   class C (m :: * -&gt; *) where</span><span>
</span><span id="line-3538"></span><span>    </span><span class="hs-comment">--     type F (m :: *) = ...</span><span>
</span><span id="line-3539"></span><span>    </span><span class="annot"><a href="#local-6989586621683078016"><span class="hs-identifier hs-type">check_hs_bndr_kind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsBndrKind"><span class="hs-identifier hs-type">HsBndrKind</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3540"></span><span>    </span><span id="local-6989586621683078016"><span class="annot"><span class="annottext">check_hs_bndr_kind :: Name -&gt; Type -&gt; HsBndrKind GhcRn -&gt; TcM ()
</span><a href="#local-6989586621683078016"><span class="hs-identifier hs-var hs-var">check_hs_bndr_kind</span></a></span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span>    </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span>           </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsBndrNoKind"><span class="hs-identifier hs-type">HsBndrNoKind</span></a></span><span> </span><span class="annot"><span class="annottext">XBndrNoKind GhcRn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcM ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3541"></span><span>    </span><span class="annot"><a href="#local-6989586621683078016"><span class="hs-identifier hs-var">check_hs_bndr_kind</span></a></span><span> </span><span id="local-6989586621683078024"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683078024"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621683078025"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078025"><span class="hs-identifier hs-var">parent_kind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsBndrKind"><span class="hs-identifier hs-type">HsBndrKind</span></a></span><span> </span><span class="annot"><span class="annottext">XBndrKind GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683078026"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683078026"><span class="hs-identifier hs-var">kind</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3542"></span><span>      </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683078027"><span class="annot"><a href="#local-6989586621683078027"><span class="hs-identifier hs-var">kind'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcTyMode -&gt; UserTypeCtxt -&gt; LHsType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_lhs_kind_sig"><span class="hs-identifier hs-var">tc_lhs_kind_sig</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683077994"><span class="hs-identifier hs-var">tc_ki_mode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#TyVarBndrKindCtxt"><span class="hs-identifier hs-var">TyVarBndrKindCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683078024"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683078026"><span class="hs-identifier hs-var">kind</span></a></span><span>
</span><span id="line-3543"></span><span>         </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#discardResult"><span class="hs-identifier hs-type">discardResult</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-3544"></span><span>           </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#unifyKind"><span class="hs-identifier hs-type">unifyKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#NameThing"><span class="hs-identifier hs-type">NameThing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078024"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683078027"><span class="hs-identifier hs-type">kind'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078025"><span class="hs-identifier hs-type">parent_kind</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3545"></span><span>
</span><span id="line-3546"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsBndrVarName"><span class="hs-identifier hs-type">tcHsBndrVarName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsBndrVar"><span class="hs-identifier hs-type">HsBndrVar</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-3547"></span><span id="tcHsBndrVarName"><span class="annot"><span class="annottext">tcHsBndrVarName :: HsBndrVar GhcRn -&gt; TcM Name
</span><a href="GHC.Tc.Gen.HsType.html#tcHsBndrVarName"><span class="hs-identifier hs-var hs-var">tcHsBndrVarName</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsBndrVar"><span class="hs-identifier hs-type">HsBndrVar</span></a></span><span> </span><span class="annot"><span class="annottext">XBndrVar GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683078028"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683078028"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Name
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683078028"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-3548"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsBndrVarName"><span class="hs-identifier hs-var">tcHsBndrVarName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsBndrWildCard"><span class="hs-identifier hs-type">HsBndrWildCard</span></a></span><span> </span><span class="annot"><span class="annottext">XBndrWildCard GhcRn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; TcM Name
forall gbl lcl. OccName -&gt; TcRnIf gbl lcl Name
</span><a href="GHC.Tc.Utils.Monad.html#newSysName"><span class="hs-identifier hs-var">newSysName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkTyVarOcc"><span class="hs-identifier hs-var">mkTyVarOcc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-3549"></span><span>
</span><span id="line-3550"></span><span id="local-6989586621683075454"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#mk_tvb_pairs"><span class="hs-identifier hs-type">mk_tvb_pairs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTyVarBndr"><span class="hs-identifier hs-type">HsTyVarBndr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075454"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span><span>
</span><span id="line-3551"></span><span id="mk_tvb_pairs"><span class="annot"><span class="annottext">mk_tvb_pairs :: forall flag. HsTyVarBndr flag GhcRn -&gt; TcTyVar -&gt; [(Name, TcTyVar)]
</span><a href="GHC.Tc.Gen.HsType.html#mk_tvb_pairs"><span class="hs-identifier hs-var hs-var">mk_tvb_pairs</span></a></span></span><span> </span><span id="local-6989586621683078031"><span class="annot"><span class="annottext">HsTyVarBndr flag GhcRn
</span><a href="#local-6989586621683078031"><span class="hs-identifier hs-var">tvb</span></a></span></span><span> </span><span id="local-6989586621683078032"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683078032"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3552"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsTyVarBndr flag GhcRn -&gt; Maybe (IdP GhcRn)
forall flag (p :: Pass).
HsTyVarBndr flag (GhcPass p) -&gt; Maybe (IdP (GhcPass p))
</span><a href="GHC.Hs.Type.html#hsTyVarName"><span class="hs-identifier hs-var">hsTyVarName</span></a></span><span> </span><span class="annot"><span class="annottext">HsTyVarBndr flag GhcRn
</span><a href="#local-6989586621683078031"><span class="hs-identifier hs-var">tvb</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3553"></span><span>    </span><span class="annot"><span class="annottext">Maybe (IdP GhcRn)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-3554"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683078034"><span class="annot"><span class="annottext">IdP GhcRn
</span><a href="#local-6989586621683078034"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">IdP GhcRn
Name
</span><a href="#local-6989586621683078034"><span class="hs-identifier hs-var">nm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683078032"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-3555"></span><span>
</span><span id="line-3556"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#newTyVarBndr"><span class="hs-identifier hs-type">newTyVarBndr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SkolemMode"><span class="hs-identifier hs-type">SkolemMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span>
</span><span id="line-3557"></span><span id="newTyVarBndr"><span class="annot"><span class="annottext">newTyVarBndr :: SkolemMode -&gt; Name -&gt; Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
</span><a href="GHC.Tc.Gen.HsType.html#newTyVarBndr"><span class="hs-identifier hs-var hs-var">newTyVarBndr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SM"><span class="hs-identifier hs-type">SM</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sm_clone :: SkolemMode -&gt; Bool
</span><a href="GHC.Tc.Gen.HsType.html#sm_clone"><span class="hs-identifier hs-var">sm_clone</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683078035"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683078035"><span class="hs-identifier hs-var">clone</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sm_tvtv :: SkolemMode -&gt; SkolemModeDetails
</span><a href="GHC.Tc.Gen.HsType.html#sm_tvtv"><span class="hs-identifier hs-var">sm_tvtv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683078036"><span class="annot"><span class="annottext">SkolemModeDetails
</span><a href="#local-6989586621683078036"><span class="hs-identifier hs-var">tvtv</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683078037"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683078037"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621683078038"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078038"><span class="hs-identifier hs-var">kind</span></a></span></span><span>
</span><span id="line-3558"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683078039"><span class="annot"><a href="#local-6989586621683078039"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683078035"><span class="hs-identifier hs-var">clone</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3559"></span><span>              </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683078040"><span class="annot"><a href="#local-6989586621683078040"><span class="hs-identifier hs-var">uniq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv Unique
forall gbl lcl. TcRnIf gbl lcl Unique
</span><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a></span><span>
</span><span id="line-3560"></span><span>                         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#setNameUnique"><span class="hs-identifier hs-type">setNameUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078037"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078040"><span class="hs-identifier hs-type">uniq</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3561"></span><span>              </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Name
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683078037"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-3562"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683078043"><span class="annot"><a href="#local-6989586621683078043"><span class="hs-identifier hs-var">details</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683078036"><span class="hs-identifier hs-type">tvtv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3563"></span><span>                 </span><span class="annot"><span class="annottext">SkolemModeDetails
</span><a href="GHC.Tc.Gen.HsType.html#SMDTyVarTv"><span class="hs-identifier hs-var">SMDTyVarTv</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MetaInfo -&gt; TcM TcTyVarDetails
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaDetails"><span class="hs-identifier hs-var">newMetaDetails</span></a></span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="GHC.Tc.Utils.TcType.html#TyVarTv"><span class="hs-identifier hs-var">TyVarTv</span></a></span><span>
</span><span id="line-3564"></span><span>                 </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SMDSkolemTv"><span class="hs-identifier hs-type">SMDSkolemTv</span></a></span><span> </span><span id="local-6989586621683078045"><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621683078045"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3565"></span><span>                  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683078046"><span class="annot"><a href="#local-6989586621683078046"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TcLevel
</span><a href="GHC.Tc.Utils.Monad.html#getTcLevel"><span class="hs-identifier hs-var">getTcLevel</span></a></span><span>
</span><span id="line-3566"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SkolemTv"><span class="hs-identifier hs-type">SkolemTv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078045"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078046"><span class="hs-identifier hs-type">lvl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3567"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#mkTcTyVar"><span class="hs-identifier hs-type">mkTcTyVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078039"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078038"><span class="hs-identifier hs-type">kind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078043"><span class="hs-identifier hs-type">details</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3568"></span><span>
</span><span id="line-3569"></span><span class="hs-comment">--------------------------------------</span><span>
</span><span id="line-3570"></span><span class="hs-comment">--    Implicit tyvar binders</span><span>
</span><span id="line-3571"></span><span class="hs-comment">--------------------------------------</span><span>
</span><span id="line-3572"></span><span>
</span><span id="line-3573"></span><span id="local-6989586621683075431"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcImplicitTKBndrsX"><span class="hs-identifier hs-type">tcImplicitTKBndrsX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SkolemMode"><span class="hs-identifier hs-type">SkolemMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a></span><span>
</span><span id="line-3574"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3575"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075431"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-3576"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683075431"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-3577"></span><span class="hs-comment">-- The workhorse:</span><span>
</span><span id="line-3578"></span><span class="hs-comment">--    push level, capture constraints, and emit an implication constraint</span><span>
</span><span id="line-3579"></span><span id="tcImplicitTKBndrsX"><span class="annot"><span class="annottext">tcImplicitTKBndrsX :: forall a.
SkolemMode -&gt; SkolemInfo -&gt; HsQTvsRn -&gt; TcM a -&gt; TcM ([TcTyVar], a)
</span><a href="GHC.Tc.Gen.HsType.html#tcImplicitTKBndrsX"><span class="hs-identifier hs-var hs-var">tcImplicitTKBndrsX</span></a></span></span><span> </span><span id="local-6989586621683078054"><span class="annot"><span class="annottext">SkolemMode
</span><a href="#local-6989586621683078054"><span class="hs-identifier hs-var">skol_mode</span></a></span></span><span> </span><span id="local-6989586621683078055"><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621683078055"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span id="local-6989586621683078056"><span class="annot"><span class="annottext">HsQTvsRn
</span><a href="#local-6989586621683078056"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span> </span><span id="local-6989586621683078057"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683078057"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-3580"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HsQTvsRn -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">HsQTvsRn
</span><a href="#local-6989586621683078056"><span class="hs-identifier hs-var">bndrs</span></a></span><span>  </span><span class="hs-comment">-- Short-cut the common case with no quantifiers</span><span>
</span><span id="line-3581"></span><span>                </span><span class="hs-comment">-- E.g. f :: Int -&gt; Int</span><span>
</span><span id="line-3582"></span><span>                </span><span class="hs-comment">--      makes a HsOuterImplicit with empty bndrs,</span><span>
</span><span id="line-3583"></span><span>                </span><span class="hs-comment">--      and tcOuterTKBndrsX goes via here</span><span>
</span><span id="line-3584"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683078058"><span class="annot"><a href="#local-6989586621683078058"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683078057"><span class="hs-identifier hs-var">thing_inside</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683078058"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3585"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-3586"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683078059"><span class="annot"><a href="#local-6989586621683078059"><span class="hs-identifier hs-var">tclvl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683078060"><span class="annot"><a href="#local-6989586621683078060"><span class="hs-identifier hs-var">wanted</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683078061"><span class="annot"><a href="#local-6989586621683078061"><span class="hs-identifier hs-var">skol_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683078062"><span class="annot"><a href="#local-6989586621683078062"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3587"></span><span>             </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) ([TcTyVar], a)
-&gt; TcM (TcLevel, WantedConstraints, ([TcTyVar], a))
forall a. TcM a -&gt; TcM (TcLevel, WantedConstraints, a)
</span><a href="GHC.Tc.Utils.Monad.html#pushLevelAndCaptureConstraints"><span class="hs-identifier hs-var">pushLevelAndCaptureConstraints</span></a></span><span>       </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) ([TcTyVar], a)
 -&gt; TcM (TcLevel, WantedConstraints, ([TcTyVar], a)))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ([TcTyVar], a)
-&gt; TcM (TcLevel, WantedConstraints, ([TcTyVar], a))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-3588"></span><span>                </span><span class="annot"><span class="annottext">SkolemMode
-&gt; HsQTvsRn
-&gt; TcM a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ([TcTyVar], a)
forall a. SkolemMode -&gt; HsQTvsRn -&gt; TcM a -&gt; TcM ([TcTyVar], a)
</span><a href="GHC.Tc.Gen.HsType.html#bindImplicitTKBndrsX"><span class="hs-identifier hs-var">bindImplicitTKBndrsX</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemMode
</span><a href="#local-6989586621683078054"><span class="hs-identifier hs-var">skol_mode</span></a></span><span> </span><span class="annot"><span class="annottext">HsQTvsRn
</span><a href="#local-6989586621683078056"><span class="hs-identifier hs-var">bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM a -&gt; IOEnv (Env TcGblEnv TcLclEnv) ([TcTyVar], a))
-&gt; TcM a -&gt; IOEnv (Env TcGblEnv TcLclEnv) ([TcTyVar], a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-3589"></span><span>                </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683078057"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-3590"></span><span>
</span><span id="line-3591"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#emitResidualTvConstraint"><span class="hs-identifier hs-type">emitResidualTvConstraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078055"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078061"><span class="hs-identifier hs-type">skol_tvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078059"><span class="hs-identifier hs-type">tclvl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078060"><span class="hs-identifier hs-type">wanted</span></a></span><span>
</span><span id="line-3592"></span><span>
</span><span id="line-3593"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683078061"><span class="hs-identifier hs-type">skol_tvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683078062"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3594"></span><span>
</span><span id="line-3595"></span><span class="hs-comment">------------------</span><span>
</span><span id="line-3596"></span><span id="local-6989586621683075314"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindImplicitTKBndrs_Skol"><span class="hs-identifier hs-type">bindImplicitTKBndrs_Skol</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-3597"></span><span>  </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindImplicitTKBndrs_Q_Skol"><span class="hs-identifier hs-type">bindImplicitTKBndrs_Q_Skol</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075314"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683075314"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-3598"></span><span>
</span><span id="line-3599"></span><span id="local-6989586621683075326"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindImplicitTKBndrs_Tv"><span class="hs-identifier hs-type">bindImplicitTKBndrs_Tv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindImplicitTKBndrs_Q_Tv"><span class="hs-identifier hs-type">bindImplicitTKBndrs_Q_Tv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075326"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683075326"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-3600"></span><span id="bindImplicitTKBndrs_Skol"><span class="annot"><span class="annottext">bindImplicitTKBndrs_Skol :: forall a. SkolemInfo -&gt; HsQTvsRn -&gt; TcM a -&gt; TcM ([TcTyVar], a)
</span><a href="GHC.Tc.Gen.HsType.html#bindImplicitTKBndrs_Skol"><span class="hs-identifier hs-var hs-var">bindImplicitTKBndrs_Skol</span></a></span></span><span> </span><span id="local-6989586621683078064"><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621683078064"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SkolemMode -&gt; HsQTvsRn -&gt; TcM a -&gt; TcM ([TcTyVar], a)
forall a. SkolemMode -&gt; HsQTvsRn -&gt; TcM a -&gt; TcM ([TcTyVar], a)
</span><a href="GHC.Tc.Gen.HsType.html#bindImplicitTKBndrsX"><span class="hs-identifier hs-var">bindImplicitTKBndrsX</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SkolemMode
HasDebugCallStack =&gt; SkolemMode
</span><a href="GHC.Tc.Gen.HsType.html#smVanilla"><span class="hs-identifier hs-var">smVanilla</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_clone"><span class="hs-identifier hs-var">sm_clone</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_tvtv"><span class="hs-identifier hs-var">sm_tvtv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SMDSkolemTv"><span class="hs-identifier hs-type">SMDSkolemTv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078064"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-3601"></span><span id="bindImplicitTKBndrs_Tv"><span class="annot"><span class="annottext">bindImplicitTKBndrs_Tv :: forall a. HsQTvsRn -&gt; TcM a -&gt; TcM ([TcTyVar], a)
</span><a href="GHC.Tc.Gen.HsType.html#bindImplicitTKBndrs_Tv"><span class="hs-identifier hs-var hs-var">bindImplicitTKBndrs_Tv</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SkolemMode -&gt; HsQTvsRn -&gt; TcM a -&gt; TcM ([TcTyVar], a)
forall a. SkolemMode -&gt; HsQTvsRn -&gt; TcM a -&gt; TcM ([TcTyVar], a)
</span><a href="GHC.Tc.Gen.HsType.html#bindImplicitTKBndrsX"><span class="hs-identifier hs-var">bindImplicitTKBndrsX</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SkolemMode
HasDebugCallStack =&gt; SkolemMode
</span><a href="GHC.Tc.Gen.HsType.html#smVanilla"><span class="hs-identifier hs-var">smVanilla</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_clone"><span class="hs-identifier hs-var">sm_clone</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_tvtv"><span class="hs-identifier hs-var">sm_tvtv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SMDTyVarTv"><span class="hs-identifier hs-type">SMDTyVarTv</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-3602"></span><span id="bindImplicitTKBndrs_Q_Skol"><span class="annot"><span class="annottext">bindImplicitTKBndrs_Q_Skol :: forall a. SkolemInfo -&gt; HsQTvsRn -&gt; TcM a -&gt; TcM ([TcTyVar], a)
</span><a href="GHC.Tc.Gen.HsType.html#bindImplicitTKBndrs_Q_Skol"><span class="hs-identifier hs-var hs-var">bindImplicitTKBndrs_Q_Skol</span></a></span></span><span> </span><span id="local-6989586621683078067"><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621683078067"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SkolemMode -&gt; HsQTvsRn -&gt; TcM a -&gt; TcM ([TcTyVar], a)
forall a. SkolemMode -&gt; HsQTvsRn -&gt; TcM a -&gt; TcM ([TcTyVar], a)
</span><a href="GHC.Tc.Gen.HsType.html#bindImplicitTKBndrsX"><span class="hs-identifier hs-var">bindImplicitTKBndrsX</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SkolemMode
HasDebugCallStack =&gt; SkolemMode
</span><a href="GHC.Tc.Gen.HsType.html#smVanilla"><span class="hs-identifier hs-var">smVanilla</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_clone"><span class="hs-identifier hs-var">sm_clone</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_parent"><span class="hs-identifier hs-var">sm_parent</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_tvtv"><span class="hs-identifier hs-var">sm_tvtv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SMDSkolemTv"><span class="hs-identifier hs-type">SMDSkolemTv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078067"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-3603"></span><span id="bindImplicitTKBndrs_Q_Tv"><span class="annot"><span class="annottext">bindImplicitTKBndrs_Q_Tv :: forall a. HsQTvsRn -&gt; TcM a -&gt; TcM ([TcTyVar], a)
</span><a href="GHC.Tc.Gen.HsType.html#bindImplicitTKBndrs_Q_Tv"><span class="hs-identifier hs-var hs-var">bindImplicitTKBndrs_Q_Tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SkolemMode -&gt; HsQTvsRn -&gt; TcM a -&gt; TcM ([TcTyVar], a)
forall a. SkolemMode -&gt; HsQTvsRn -&gt; TcM a -&gt; TcM ([TcTyVar], a)
</span><a href="GHC.Tc.Gen.HsType.html#bindImplicitTKBndrsX"><span class="hs-identifier hs-var">bindImplicitTKBndrsX</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SkolemMode
HasDebugCallStack =&gt; SkolemMode
</span><a href="GHC.Tc.Gen.HsType.html#smVanilla"><span class="hs-identifier hs-var">smVanilla</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_clone"><span class="hs-identifier hs-var">sm_clone</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_parent"><span class="hs-identifier hs-var">sm_parent</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#sm_tvtv"><span class="hs-identifier hs-var">sm_tvtv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SMDTyVarTv"><span class="hs-identifier hs-type">SMDTyVarTv</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-3604"></span><span>
</span><span id="line-3605"></span><span id="local-6989586621683075407"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindImplicitTKBndrsX"><span class="hs-identifier hs-type">bindImplicitTKBndrsX</span></a></span><span>
</span><span id="line-3606"></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SkolemMode"><span class="hs-identifier hs-type">SkolemMode</span></a></span><span>
</span><span id="line-3607"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span>               </span><span class="hs-comment">-- Generated by renamer; not in dependency order</span><span>
</span><span id="line-3608"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075407"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-3609"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683075407"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>   </span><span class="hs-comment">-- Returned [TcTyVar] are in 1-1 correspondence</span><span>
</span><span id="line-3610"></span><span>                           </span><span class="hs-comment">-- with the passed in [Name]</span><span>
</span><span id="line-3611"></span><span id="bindImplicitTKBndrsX"><span class="annot"><span class="annottext">bindImplicitTKBndrsX :: forall a. SkolemMode -&gt; HsQTvsRn -&gt; TcM a -&gt; TcM ([TcTyVar], a)
</span><a href="GHC.Tc.Gen.HsType.html#bindImplicitTKBndrsX"><span class="hs-identifier hs-var hs-var">bindImplicitTKBndrsX</span></a></span></span><span> </span><span id="local-6989586621683078081"><span class="annot"><span class="annottext">skol_mode :: SkolemMode
</span><a href="#local-6989586621683078081"><span class="hs-identifier hs-var">skol_mode</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SM"><span class="hs-identifier hs-type">SM</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sm_parent :: SkolemMode -&gt; Bool
</span><a href="GHC.Tc.Gen.HsType.html#sm_parent"><span class="hs-identifier hs-var">sm_parent</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683078082"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683078082"><span class="hs-identifier hs-var">check_parent</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sm_kind :: SkolemMode -&gt; ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#sm_kind"><span class="hs-identifier hs-var">sm_kind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683078083"><span class="annot"><span class="annottext">ContextKind
</span><a href="#local-6989586621683078083"><span class="hs-identifier hs-var">ctxt_kind</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-3612"></span><span>                     </span><span id="local-6989586621683078084"><span class="annot"><span class="annottext">HsQTvsRn
</span><a href="#local-6989586621683078084"><span class="hs-identifier hs-var">tv_names</span></a></span></span><span> </span><span id="local-6989586621683078085"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683078085"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-3613"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683078086"><span class="annot"><a href="#local-6989586621683078086"><span class="hs-identifier hs-var">lcl_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM (NameEnv TcTyThing)
</span><a href="GHC.Tc.Utils.Monad.html#getLclTypeEnv"><span class="hs-identifier hs-var">getLclTypeEnv</span></a></span><span>
</span><span id="line-3614"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683078087"><span class="annot"><a href="#local-6989586621683078087"><span class="hs-identifier hs-var">tkvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683078088"><span class="hs-identifier hs-type">new_tv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078086"><span class="hs-identifier hs-type">lcl_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683078084"><span class="hs-identifier hs-type">tv_names</span></a></span><span>
</span><span id="line-3615"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;bindImplicitTKBndrsX&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078084"><span class="hs-identifier hs-type">tv_names</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078087"><span class="hs-identifier hs-type">tkvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3616"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683078089"><span class="annot"><a href="#local-6989586621683078089"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcExtendNameTyVarEnv"><span class="hs-identifier hs-type">tcExtendNameTyVarEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683078084"><span class="hs-identifier hs-type">tv_names</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`zip`</span></span><span> </span><span class="annot"><a href="#local-6989586621683078087"><span class="hs-identifier hs-type">tkvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3617"></span><span>                </span><span class="annot"><a href="#local-6989586621683078085"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-3618"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683078087"><span class="hs-identifier hs-type">tkvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683078089"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3619"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3620"></span><span>    </span><span id="local-6989586621683078088"><span class="annot"><span class="annottext">new_tv :: NameEnv TcTyThing -&gt; Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
</span><a href="#local-6989586621683078088"><span class="hs-identifier hs-var hs-var">new_tv</span></a></span></span><span> </span><span id="local-6989586621683078090"><span class="annot"><span class="annottext">NameEnv TcTyThing
</span><a href="#local-6989586621683078090"><span class="hs-identifier hs-var">lcl_env</span></a></span></span><span> </span><span id="local-6989586621683078091"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683078091"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-3621"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683078082"><span class="hs-identifier hs-var">check_parent</span></a></span><span>
</span><span id="line-3622"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#ATyVar"><span class="hs-identifier hs-type">ATyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683078092"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683078092"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NameEnv TcTyThing -&gt; Name -&gt; Maybe TcTyThing
forall a. NameEnv a -&gt; Name -&gt; Maybe a
</span><a href="GHC.Types.Name.Env.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">NameEnv TcTyThing
</span><a href="#local-6989586621683078090"><span class="hs-identifier hs-var">lcl_env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683078091"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-3623"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683078092"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-3624"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-3625"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683078093"><span class="annot"><a href="#local-6989586621683078093"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ContextKind -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#newExpectedKind"><span class="hs-identifier hs-var">newExpectedKind</span></a></span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="#local-6989586621683078083"><span class="hs-identifier hs-var">ctxt_kind</span></a></span><span>
</span><span id="line-3626"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#newTyVarBndr"><span class="hs-identifier hs-type">newTyVarBndr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078081"><span class="hs-identifier hs-type">skol_mode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078091"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078093"><span class="hs-identifier hs-type">kind</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3627"></span><span>
</span><span id="line-3628"></span><span class="hs-comment">--------------------------------------</span><span>
</span><span id="line-3629"></span><span class="hs-comment">--           SkolemMode</span><span>
</span><span id="line-3630"></span><span class="hs-comment">--------------------------------------</span><span>
</span><span id="line-3631"></span><span>
</span><span id="line-3632"></span><span class="hs-comment">-- | 'SkolemMode' describes how to typecheck an explicit ('HsTyVarBndr') or</span><span>
</span><span id="line-3633"></span><span class="hs-comment">-- implicit ('Name') binder in a type. It is just a record of flags</span><span>
</span><span id="line-3634"></span><span class="hs-comment">-- that describe what sort of 'TcTyVar' to create.</span><span>
</span><span id="line-3635"></span><span class="hs-keyword">data</span><span> </span><span id="SkolemMode"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SkolemMode"><span class="hs-identifier hs-var">SkolemMode</span></a></span></span><span>
</span><span id="line-3636"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="SM"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SM"><span class="hs-identifier hs-var">SM</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="sm_parent"><span class="annot"><span class="annottext">SkolemMode -&gt; Bool
</span><a href="GHC.Tc.Gen.HsType.html#sm_parent"><span class="hs-identifier hs-var hs-var">sm_parent</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>    </span><span class="hs-comment">-- True &lt;=&gt; check the in-scope parent type variable</span><span>
</span><span id="line-3637"></span><span>                              </span><span class="hs-comment">-- Used only for asssociated types</span><span>
</span><span id="line-3638"></span><span>
</span><span id="line-3639"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="sm_clone"><span class="annot"><span class="annottext">SkolemMode -&gt; Bool
</span><a href="GHC.Tc.Gen.HsType.html#sm_clone"><span class="hs-identifier hs-var hs-var">sm_clone</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>    </span><span class="hs-comment">-- True &lt;=&gt; fresh unique</span><span>
</span><span id="line-3640"></span><span>                              </span><span class="hs-comment">-- See Note [Cloning for type variable binders]</span><span>
</span><span id="line-3641"></span><span>
</span><span id="line-3642"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="sm_tvtv"><span class="annot"><span class="annottext">SkolemMode -&gt; SkolemModeDetails
</span><a href="GHC.Tc.Gen.HsType.html#sm_tvtv"><span class="hs-identifier hs-var hs-var">sm_tvtv</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SkolemModeDetails"><span class="hs-identifier hs-type">SkolemModeDetails</span></a></span><span>    </span><span class="hs-comment">-- True &lt;=&gt; use a TyVarTv, rather than SkolemTv</span><span>
</span><span id="line-3643"></span><span>                              </span><span class="hs-comment">-- Why?  See Note [Inferring kinds for type declarations]</span><span>
</span><span id="line-3644"></span><span>                              </span><span class="hs-comment">-- in GHC.Tc.TyCl, and (in this module)</span><span>
</span><span id="line-3645"></span><span>                              </span><span class="hs-comment">-- Note [Checking partial type signatures]</span><span>
</span><span id="line-3646"></span><span>
</span><span id="line-3647"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="sm_kind"><span class="annot"><span class="annottext">SkolemMode -&gt; ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#sm_kind"><span class="hs-identifier hs-var hs-var">sm_kind</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#ContextKind"><span class="hs-identifier hs-type">ContextKind</span></a></span><span>  </span><span class="hs-comment">-- Use this for the kind of any new binders</span><span>
</span><span id="line-3648"></span><span>
</span><span id="line-3649"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="sm_holes"><span class="annot"><span class="annottext">SkolemMode -&gt; HoleInfo
</span><a href="GHC.Tc.Gen.HsType.html#sm_holes"><span class="hs-identifier hs-var hs-var">sm_holes</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#HoleInfo"><span class="hs-identifier hs-type">HoleInfo</span></a></span><span>     </span><span class="hs-comment">-- What to do for wildcards in the kind</span><span>
</span><span id="line-3650"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-3651"></span><span>
</span><span id="line-3652"></span><span class="hs-keyword">data</span><span> </span><span id="SkolemModeDetails"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SkolemModeDetails"><span class="hs-identifier hs-var">SkolemModeDetails</span></a></span></span><span>
</span><span id="line-3653"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="SMDTyVarTv"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SMDTyVarTv"><span class="hs-identifier hs-var">SMDTyVarTv</span></a></span></span><span>
</span><span id="line-3654"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="SMDSkolemTv"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SMDSkolemTv"><span class="hs-identifier hs-var">SMDSkolemTv</span></a></span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a></span><span>
</span><span id="line-3655"></span><span>
</span><span id="line-3656"></span><span>
</span><span id="line-3657"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#smVanilla"><span class="hs-identifier hs-type">smVanilla</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SkolemMode"><span class="hs-identifier hs-type">SkolemMode</span></a></span><span>
</span><span id="line-3658"></span><span id="smVanilla"><span class="annot"><span class="annottext">smVanilla :: HasDebugCallStack =&gt; SkolemMode
</span><a href="GHC.Tc.Gen.HsType.html#smVanilla"><span class="hs-identifier hs-var hs-var">smVanilla</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SM"><span class="hs-identifier hs-type">SM</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sm_clone :: Bool
</span><a href="GHC.Tc.Gen.HsType.html#sm_clone"><span class="hs-identifier hs-var">sm_clone</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;sm_clone&quot;</span></span><span>  </span><span class="hs-comment">-- We always override this</span><span>
</span><span id="line-3659"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sm_parent :: Bool
</span><a href="GHC.Tc.Gen.HsType.html#sm_parent"><span class="hs-identifier hs-var">sm_parent</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-3660"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sm_tvtv :: SkolemModeDetails
</span><a href="GHC.Tc.Gen.HsType.html#sm_tvtv"><span class="hs-identifier hs-var">sm_tvtv</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; SkolemModeDetails
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;sm_tvtv&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc
HasCallStack =&gt; SDoc
</span><a href="GHC.Utils.Panic.html#callStackDoc"><span class="hs-identifier hs-var">callStackDoc</span></a></span><span> </span><span class="hs-comment">-- We always override this</span><span>
</span><span id="line-3661"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sm_kind :: ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#sm_kind"><span class="hs-identifier hs-var">sm_kind</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#AnyKind"><span class="hs-identifier hs-var">AnyKind</span></a></span><span>
</span><span id="line-3662"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sm_holes :: HoleInfo
</span><a href="GHC.Tc.Gen.HsType.html#sm_holes"><span class="hs-identifier hs-var">sm_holes</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HoleInfo
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3663"></span><span>
</span><span id="line-3664"></span><span class="hs-comment">{- Note [Cloning for type variable binders]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Sometimes we must clone the Name of a type variable binder (written in
the source program); and sometimes we must not. This is controlled by
the sm_clone field of SkolemMode.

In some cases it doesn't matter whether or not we clone. Perhaps
it'd be better to use MustClone/MayClone/MustNotClone.

When we /must not/ clone
* In the binders of a type signature (tcOuterTKBndrs)
      f :: forall a{27}. blah
      f = rhs
  Then 'a' scopes over 'rhs'. When we kind-check the signature (tcHsSigType),
  we must get the type (forall a{27}. blah) for the Id f, because
  we bring that type variable into scope when we typecheck 'rhs'.

* In the binders of a data family instance (bindOuterFamEqnTKBndrs)
     data instance
       forall p q. D (p,q) = D1 p | D2 q
  We kind-check the LHS in tcDataFamInstHeader, and then separately
  (in tcDataFamInstDecl) bring p,q into scope before looking at the
  the constructor decls.

* bindExplicitTKBndrs_Q_Tv/bindImplicitTKBndrs_Q_Tv do not clone
  We take advantage of this in kcInferDeclHeader:
     all_tv_prs = mkTyVarNamePairs (scoped_kvs ++ tc_tvs)
  If we cloned, we'd need to take a bit more care here; not hard.

* bindExplicitTKBndrs_Q_Skol, bindExplicitTKBndrs_Skol, do not clone.
  There is no need, I think.

  The payoff here is that avoiding gratuitous cloning means that we can
  almost always take the fast path in swizzleTcTyConBndrs.

When we /must/ clone.
* bindOuterSigTKBndrs_Tv, bindExplicitTKBndrs_Tv do cloning

  This for a narrow and tricky reason which, alas, I couldn't find a
  simpler way round.  #16221 is the poster child:

     data SameKind :: k -&gt; k -&gt; *
     data T a = forall k2 (b :: k2). MkT (SameKind a b) !Int

  When kind-checking T, we give (a :: kappa1). Then:

  - In kcConDecl we make a TyVarTv unification variable kappa2 for k2
    (as described in Note [Using TyVarTvs for kind-checking GADTs],
    even though this example is an existential)
  - So we get (b :: kappa2) via bindExplicitTKBndrs_Tv
  - We end up unifying kappa1 := kappa2, because of the (SameKind a b)

  Now we generalise over kappa2. But if kappa2's Name is precisely k2
  (i.e. we did not clone) we'll end up giving T the utterly final kind
    T :: forall k2. k2 -&gt; *
  Nothing directly wrong with that but when we typecheck the data constructor
  we have k2 in scope; but then it's brought into scope /again/ when we find
  the forall k2.  This is chaotic, and we end up giving it the type
    MkT :: forall k2 (a :: k2) k2 (b :: k2).
           SameKind @k2 a b -&gt; Int -&gt; T @{k2} a
  which is bogus -- because of the shadowing of k2, we can't
  apply T to the kind or a!

  And there no reason /not/ to clone the Name when making a unification
  variable.  So that's what we do.
-}</span><span>
</span><span id="line-3730"></span><span>
</span><span id="line-3731"></span><span class="hs-comment">--------------------------------------</span><span>
</span><span id="line-3732"></span><span class="hs-comment">-- Binding type/class variables in the</span><span>
</span><span id="line-3733"></span><span class="hs-comment">-- kind-checking and typechecking phases</span><span>
</span><span id="line-3734"></span><span class="hs-comment">--------------------------------------</span><span>
</span><span id="line-3735"></span><span>
</span><span id="line-3736"></span><span id="local-6989586621683075470"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindTyClTyVars"><span class="hs-identifier hs-type">bindTyClTyVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyConBinder"><span class="hs-identifier hs-type">TcTyConBinder</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075470"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075470"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-3737"></span><span class="hs-comment">-- ^ Bring into scope the binders of a PolyTcTyCon</span><span>
</span><span id="line-3738"></span><span class="hs-comment">-- Used for the type variables of a type or class decl</span><span>
</span><span id="line-3739"></span><span class="hs-comment">-- in the &quot;kind checking&quot; and &quot;type checking&quot; pass,</span><span>
</span><span id="line-3740"></span><span class="hs-comment">-- but not in the initial-kind run.</span><span>
</span><span id="line-3741"></span><span id="bindTyClTyVars"><span class="annot"><span class="annottext">bindTyClTyVars :: forall a. Name -&gt; ([TyConBinder] -&gt; Type -&gt; TcM a) -&gt; TcM a
</span><a href="GHC.Tc.Gen.HsType.html#bindTyClTyVars"><span class="hs-identifier hs-var hs-var">bindTyClTyVars</span></a></span></span><span> </span><span id="local-6989586621683078108"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683078108"><span class="hs-identifier hs-var">tycon_name</span></a></span></span><span> </span><span id="local-6989586621683078109"><span class="annot"><span class="annottext">[TyConBinder] -&gt; Type -&gt; TcM a
</span><a href="#local-6989586621683078109"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-3742"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683078110"><span class="annot"><a href="#local-6989586621683078110"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Name -&gt; TcM TyCon
Name -&gt; TcM TyCon
</span><a href="GHC.Tc.Utils.Env.html#tcLookupTcTyCon"><span class="hs-identifier hs-var">tcLookupTcTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683078108"><span class="hs-identifier hs-var">tycon_name</span></a></span><span>     </span><span class="hs-comment">-- The tycon is a PolyTcTyCon</span><span>
</span><span id="line-3743"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683078112"><span class="annot"><a href="#local-6989586621683078112"><span class="hs-identifier hs-var hs-var">res_kind</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="GHC.Core.TyCon.html#tyConResKind"><span class="hs-identifier hs-var">tyConResKind</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683078110"><span class="hs-identifier hs-var">tycon</span></a></span><span>
</span><span id="line-3744"></span><span>             </span><span id="local-6989586621683078113"><span class="annot"><a href="#local-6989586621683078113"><span class="hs-identifier hs-var hs-var">binders</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [TyConBinder]
</span><a href="GHC.Core.TyCon.html#tyConBinders"><span class="hs-identifier hs-var">tyConBinders</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683078110"><span class="hs-identifier hs-var">tycon</span></a></span><span>
</span><span id="line-3745"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;bindTyClTyVars&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078108"><span class="hs-identifier hs-type">tycon_name</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078113"><span class="hs-identifier hs-type">binders</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3746"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcExtendTyVarEnv"><span class="hs-identifier hs-type">tcExtendTyVarEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-type">binderVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078113"><span class="hs-identifier hs-type">binders</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-3747"></span><span>         </span><span class="annot"><a href="#local-6989586621683078109"><span class="hs-identifier hs-type">thing_inside</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078113"><span class="hs-identifier hs-type">binders</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078112"><span class="hs-identifier hs-type">res_kind</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3748"></span><span>
</span><span id="line-3749"></span><span id="local-6989586621683078114"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindTyClTyVarsAndZonk"><span class="hs-identifier hs-type">bindTyClTyVarsAndZonk</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCon.html#TyConBinder"><span class="hs-identifier hs-type">TyConBinder</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078114"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078114"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-3750"></span><span class="hs-comment">-- Like bindTyClTyVars, but in addition</span><span>
</span><span id="line-3751"></span><span class="hs-comment">-- zonk the skolem TcTyVars of a PolyTcTyCon to TyVars</span><span>
</span><span id="line-3752"></span><span class="hs-comment">-- We always do this same zonking after a call to bindTyClTyVars, but</span><span>
</span><span id="line-3753"></span><span class="hs-comment">-- here we do it right away because there are no more unifications to come</span><span>
</span><span id="line-3754"></span><span id="bindTyClTyVarsAndZonk"><span class="annot"><span class="annottext">bindTyClTyVarsAndZonk :: forall a. Name -&gt; ([TyConBinder] -&gt; Type -&gt; TcM a) -&gt; TcM a
</span><a href="GHC.Tc.Gen.HsType.html#bindTyClTyVarsAndZonk"><span class="hs-identifier hs-var hs-var">bindTyClTyVarsAndZonk</span></a></span></span><span> </span><span id="local-6989586621683078120"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683078120"><span class="hs-identifier hs-var">tycon_name</span></a></span></span><span> </span><span id="local-6989586621683078121"><span class="annot"><span class="annottext">[TyConBinder] -&gt; Type -&gt; TcM a
</span><a href="#local-6989586621683078121"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-3755"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; ([TyConBinder] -&gt; Type -&gt; TcM a) -&gt; TcM a
forall a. Name -&gt; ([TyConBinder] -&gt; Type -&gt; TcM a) -&gt; TcM a
</span><a href="GHC.Tc.Gen.HsType.html#bindTyClTyVars"><span class="hs-identifier hs-var">bindTyClTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683078120"><span class="hs-identifier hs-var">tycon_name</span></a></span><span> </span><span class="annot"><span class="annottext">(([TyConBinder] -&gt; Type -&gt; TcM a) -&gt; TcM a)
-&gt; ([TyConBinder] -&gt; Type -&gt; TcM a) -&gt; TcM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683078122"><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621683078122"><span class="hs-identifier hs-var">tc_bndrs</span></a></span></span><span> </span><span id="local-6989586621683078123"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078123"><span class="hs-identifier hs-var">tc_kind</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3756"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683078124"><span class="annot"><a href="#local-6989586621683078124"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683078125"><span class="annot"><a href="#local-6989586621683078125"><span class="hs-identifier hs-var">kind</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkFlexi
-&gt; ZonkT (IOEnv (Env TcGblEnv TcLclEnv)) ([TyConBinder], Type)
-&gt; TcM ([TyConBinder], Type)
forall (m :: * -&gt; *) b. MonadIO m =&gt; ZonkFlexi -&gt; ZonkT m b -&gt; m b
</span><a href="GHC.Tc.Zonk.Env.html#initZonkEnv"><span class="hs-identifier hs-var">initZonkEnv</span></a></span><span> </span><span class="annot"><span class="annottext">ZonkFlexi
</span><a href="GHC.Tc.Zonk.Env.html#NoFlexi"><span class="hs-identifier hs-var">NoFlexi</span></a></span><span> </span><span class="annot"><span class="annottext">(ZonkT (IOEnv (Env TcGblEnv TcLclEnv)) ([TyConBinder], Type)
 -&gt; TcM ([TyConBinder], Type))
-&gt; ZonkT (IOEnv (Env TcGblEnv TcLclEnv)) ([TyConBinder], Type)
-&gt; TcM ([TyConBinder], Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-3757"></span><span>          </span><span class="annot"><span class="annottext">ZonkBndrT (IOEnv (Env TcGblEnv TcLclEnv)) [TyConBinder]
-&gt; forall r.
   ([TyConBinder] -&gt; ZonkT (IOEnv (Env TcGblEnv TcLclEnv)) r)
   -&gt; ZonkT (IOEnv (Env TcGblEnv TcLclEnv)) r
forall (m :: * -&gt; *) a.
ZonkBndrT m a -&gt; forall r. (a -&gt; ZonkT m r) -&gt; ZonkT m r
</span><a href="GHC.Tc.Zonk.Env.html#runZonkBndrT"><span class="hs-identifier hs-var">runZonkBndrT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyConBinder]
-&gt; ZonkBndrT (IOEnv (Env TcGblEnv TcLclEnv)) [TyConBinder]
forall vis.
[VarBndr TcTyVar vis] -&gt; ZonkBndrTcM [VarBndr TcTyVar vis]
</span><a href="GHC.Tc.Zonk.Type.html#zonkTyVarBindersX"><span class="hs-identifier hs-var">zonkTyVarBindersX</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621683078122"><span class="hs-identifier hs-var">tc_bndrs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(([TyConBinder]
  -&gt; ZonkT (IOEnv (Env TcGblEnv TcLclEnv)) ([TyConBinder], Type))
 -&gt; ZonkT (IOEnv (Env TcGblEnv TcLclEnv)) ([TyConBinder], Type))
-&gt; ([TyConBinder]
    -&gt; ZonkT (IOEnv (Env TcGblEnv TcLclEnv)) ([TyConBinder], Type))
-&gt; ZonkT (IOEnv (Env TcGblEnv TcLclEnv)) ([TyConBinder], Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683078129"><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621683078129"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3758"></span><span>            </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683078130"><span class="annot"><a href="#local-6989586621683078130"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ZonkT (IOEnv (Env TcGblEnv TcLclEnv)) Type
</span><a href="GHC.Tc.Zonk.Type.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078123"><span class="hs-identifier hs-var">tc_kind</span></a></span><span>
</span><span id="line-3759"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683078129"><span class="hs-identifier hs-type">bndrs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683078130"><span class="hs-identifier hs-type">kind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3760"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="#local-6989586621683078121"><span class="hs-identifier hs-type">thing_inside</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078124"><span class="hs-identifier hs-type">bndrs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078125"><span class="hs-identifier hs-type">kind</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3761"></span><span>
</span><span id="line-3762"></span><span>
</span><span id="line-3763"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
             Kind generalisation
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-3768"></span><span>
</span><span id="line-3769"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#zonkAndScopedSort"><span class="hs-identifier hs-type">zonkAndScopedSort</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3770"></span><span id="zonkAndScopedSort"><span class="annot"><span class="annottext">zonkAndScopedSort :: [TcTyVar] -&gt; TcM [TcTyVar]
</span><a href="GHC.Tc.Gen.HsType.html#zonkAndScopedSort"><span class="hs-identifier hs-var hs-var">zonkAndScopedSort</span></a></span></span><span> </span><span id="local-6989586621683078131"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683078131"><span class="hs-identifier hs-var">spec_tkvs</span></a></span></span><span>
</span><span id="line-3771"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683078132"><span class="annot"><a href="#local-6989586621683078132"><span class="hs-identifier hs-var">spec_tkvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkM [TcTyVar] -&gt; TcM [TcTyVar]
forall a. ZonkM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-var">liftZonkM</span></a></span><span> </span><span class="annot"><span class="annottext">(ZonkM [TcTyVar] -&gt; TcM [TcTyVar])
-&gt; ZonkM [TcTyVar] -&gt; TcM [TcTyVar]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TcTyVar] -&gt; ZonkM [TcTyVar]
HasDebugCallStack =&gt; [TcTyVar] -&gt; ZonkM [TcTyVar]
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTcTyVarsToTcTyVars"><span class="hs-identifier hs-var">zonkTcTyVarsToTcTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683078131"><span class="hs-identifier hs-var">spec_tkvs</span></a></span><span>
</span><span id="line-3772"></span><span>         </span><span class="hs-comment">-- Zonk the kinds, to we can do the dependency analysis</span><span>
</span><span id="line-3773"></span><span>
</span><span id="line-3774"></span><span>       </span><span class="hs-comment">-- Do a stable topological sort, following</span><span>
</span><span id="line-3775"></span><span>       </span><span class="hs-comment">-- Note [Ordering of implicit variables] in GHC.Rename.HsType</span><span>
</span><span id="line-3776"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.FVs.html#scopedSort"><span class="hs-identifier hs-type">scopedSort</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078132"><span class="hs-identifier hs-type">spec_tkvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3777"></span><span>
</span><span id="line-3778"></span><span class="hs-comment">-- | Generalize some of the free variables in the given type.</span><span>
</span><span id="line-3779"></span><span class="hs-comment">-- All such variables should be *kind* variables; any type variables</span><span>
</span><span id="line-3780"></span><span class="hs-comment">-- should be explicitly quantified (with a `forall`) before now.</span><span>
</span><span id="line-3781"></span><span class="hs-comment">--</span><span>
</span><span id="line-3782"></span><span class="hs-comment">-- The WantedConstraints are un-solved kind constraints. Generally</span><span>
</span><span id="line-3783"></span><span class="hs-comment">-- they'll be reported as errors later, but meanwhile we refrain</span><span>
</span><span id="line-3784"></span><span class="hs-comment">-- from quantifying over any variable free in these unsolved</span><span>
</span><span id="line-3785"></span><span class="hs-comment">-- constraints. See Note [Failure in local type signatures].</span><span>
</span><span id="line-3786"></span><span class="hs-comment">--</span><span>
</span><span id="line-3787"></span><span class="hs-comment">-- But in all cases, generalize only those variables whose TcLevel is</span><span>
</span><span id="line-3788"></span><span class="hs-comment">-- strictly greater than the ambient level. This &quot;strictly greater</span><span>
</span><span id="line-3789"></span><span class="hs-comment">-- than&quot; means that you likely need to push the level before creating</span><span>
</span><span id="line-3790"></span><span class="hs-comment">-- whatever type gets passed here.</span><span>
</span><span id="line-3791"></span><span class="hs-comment">--</span><span>
</span><span id="line-3792"></span><span class="hs-comment">-- Any variable whose level is greater than the ambient level but is</span><span>
</span><span id="line-3793"></span><span class="hs-comment">-- not selected to be generalized will be promoted. (See [Promoting</span><span>
</span><span id="line-3794"></span><span class="hs-comment">-- unification variables] in &quot;GHC.Tc.Solver&quot; and Note [Recipe for</span><span>
</span><span id="line-3795"></span><span class="hs-comment">-- checking a signature].)</span><span>
</span><span id="line-3796"></span><span class="hs-comment">--</span><span>
</span><span id="line-3797"></span><span class="hs-comment">-- The resulting KindVar are the variables to quantify over, in the</span><span>
</span><span id="line-3798"></span><span class="hs-comment">-- correct, well-scoped order. They should generally be Inferred, not</span><span>
</span><span id="line-3799"></span><span class="hs-comment">-- Specified, but that's really up to the caller of this function.</span><span>
</span><span id="line-3800"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#kindGeneralizeSome"><span class="hs-identifier hs-type">kindGeneralizeSome</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a></span><span>
</span><span id="line-3801"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span>
</span><span id="line-3802"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ needn't be zonked</span></span><span>
</span><span id="line-3803"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#KindVar"><span class="hs-identifier hs-type">KindVar</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3804"></span><span id="kindGeneralizeSome"><span class="annot"><span class="annottext">kindGeneralizeSome :: SkolemInfo -&gt; WantedConstraints -&gt; Type -&gt; TcM [TcTyVar]
</span><a href="GHC.Tc.Gen.HsType.html#kindGeneralizeSome"><span class="hs-identifier hs-var hs-var">kindGeneralizeSome</span></a></span></span><span> </span><span id="local-6989586621683078134"><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621683078134"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span id="local-6989586621683078135"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621683078135"><span class="hs-identifier hs-var">wanted</span></a></span></span><span> </span><span id="local-6989586621683078136"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078136"><span class="hs-identifier hs-var">kind_or_type</span></a></span></span><span>
</span><span id="line-3805"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Use the &quot;Kind&quot; variant here, as any types we see</span><span>
</span><span id="line-3806"></span><span>         </span><span class="hs-comment">-- here will already have all type variables quantified;</span><span>
</span><span id="line-3807"></span><span>         </span><span class="hs-comment">-- thus, every free variable is really a kv, never a tv.</span><span>
</span><span id="line-3808"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683078137"><span class="annot"><a href="#local-6989586621683078137"><span class="hs-identifier hs-var">dvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM CandidatesQTvs
</span><a href="GHC.Tc.Utils.TcMType.html#candidateQTyVarsOfKind"><span class="hs-identifier hs-var">candidateQTyVarsOfKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078136"><span class="hs-identifier hs-var">kind_or_type</span></a></span><span>
</span><span id="line-3809"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683078139"><span class="annot"><a href="#local-6989586621683078139"><span class="hs-identifier hs-var">filtered_dvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#filterConstrainedCandidates"><span class="hs-identifier hs-type">filterConstrainedCandidates</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078135"><span class="hs-identifier hs-type">wanted</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078137"><span class="hs-identifier hs-type">dvs</span></a></span><span>
</span><span id="line-3810"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;kindGeneralizeSome&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-3811"></span><span>         </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;type:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078136"><span class="hs-identifier hs-type">kind_or_type</span></a></span><span>
</span><span id="line-3812"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;dvs:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078137"><span class="hs-identifier hs-type">dvs</span></a></span><span>
</span><span id="line-3813"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;filtered_dvs:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078139"><span class="hs-identifier hs-type">filtered_dvs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3814"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#quantifyTyVars"><span class="hs-identifier hs-type">quantifyTyVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078134"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#DefaultNonStandardTyVars"><span class="hs-identifier hs-type">DefaultNonStandardTyVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078139"><span class="hs-identifier hs-type">filtered_dvs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3815"></span><span>
</span><span id="line-3816"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#filterConstrainedCandidates"><span class="hs-identifier hs-type">filterConstrainedCandidates</span></a></span><span>
</span><span id="line-3817"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span>    </span><span class="hs-comment">-- Don't quantify over variables free in these</span><span>
</span><span id="line-3818"></span><span>                          </span><span class="hs-comment">--   Not necessarily fully zonked</span><span>
</span><span id="line-3819"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a></span><span>       </span><span class="hs-comment">-- Candidates for quantification</span><span>
</span><span id="line-3820"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#CandidatesQTvs"><span class="hs-identifier hs-type">CandidatesQTvs</span></a></span><span>
</span><span id="line-3821"></span><span class="hs-comment">-- filterConstrainedCandidates removes any candidates that are free in</span><span>
</span><span id="line-3822"></span><span class="hs-comment">-- 'wanted'; instead, it promotes them.  This bit is very much like</span><span>
</span><span id="line-3823"></span><span class="hs-comment">-- decidePromotedTyVars in GHC.Tc.Solver, but constraints are so much</span><span>
</span><span id="line-3824"></span><span class="hs-comment">-- simpler in kinds, it is much easier here. (In particular, we never</span><span>
</span><span id="line-3825"></span><span class="hs-comment">-- quantify over a constraint in a type.)</span><span>
</span><span id="line-3826"></span><span id="filterConstrainedCandidates"><span class="annot"><span class="annottext">filterConstrainedCandidates :: WantedConstraints -&gt; CandidatesQTvs -&gt; TcM CandidatesQTvs
</span><a href="GHC.Tc.Gen.HsType.html#filterConstrainedCandidates"><span class="hs-identifier hs-var hs-var">filterConstrainedCandidates</span></a></span></span><span> </span><span id="local-6989586621683078141"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621683078141"><span class="hs-identifier hs-var">wanted</span></a></span></span><span> </span><span id="local-6989586621683078142"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683078142"><span class="hs-identifier hs-var">dvs</span></a></span></span><span>
</span><span id="line-3827"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">WantedConstraints -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#isEmptyWC"><span class="hs-identifier hs-var">isEmptyWC</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621683078141"><span class="hs-identifier hs-var">wanted</span></a></span><span>   </span><span class="hs-comment">-- Fast path for a common case</span><span>
</span><span id="line-3828"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; TcM CandidatesQTvs
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621683078142"><span class="hs-identifier hs-var">dvs</span></a></span><span>
</span><span id="line-3829"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-3830"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683078144"><span class="annot"><a href="#local-6989586621683078144"><span class="hs-identifier hs-var">wc_tvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkM TyVarSet -&gt; TcM TyVarSet
forall a. ZonkM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-var">liftZonkM</span></a></span><span> </span><span class="annot"><span class="annottext">(ZonkM TyVarSet -&gt; TcM TyVarSet) -&gt; ZonkM TyVarSet -&gt; TcM TyVarSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TyVarSet -&gt; ZonkM TyVarSet
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTyCoVarsAndFV"><span class="hs-identifier hs-var">zonkTyCoVarsAndFV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WantedConstraints -&gt; TyVarSet
</span><a href="GHC.Tc.Types.Constraint.html#tyCoVarsOfWC"><span class="hs-identifier hs-var">tyCoVarsOfWC</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621683078141"><span class="hs-identifier hs-var">wanted</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3831"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683078147"><span class="annot"><a href="#local-6989586621683078147"><span class="hs-identifier hs-var">to_promote</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683078148"><span class="annot"><a href="#local-6989586621683078148"><span class="hs-identifier hs-var">dvs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#partitionCandidates"><span class="hs-identifier hs-type">partitionCandidates</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078142"><span class="hs-identifier hs-type">dvs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">`elemVarSet`</span></span><span> </span><span class="annot"><span class="hs-identifier">wc_tvs</span></span><span class="hs-special">)</span><span>
</span><span id="line-3832"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#promoteTyVarSet"><span class="hs-identifier hs-type">promoteTyVarSet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078147"><span class="hs-identifier hs-type">to_promote</span></a></span><span>
</span><span id="line-3833"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683078148"><span class="hs-identifier hs-type">dvs'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3834"></span><span>
</span><span id="line-3835"></span><span class="hs-comment">-- |- Specialised version of 'kindGeneralizeSome', but with empty</span><span>
</span><span id="line-3836"></span><span class="hs-comment">-- WantedConstraints, so no filtering is needed</span><span>
</span><span id="line-3837"></span><span class="hs-comment">-- i.e.   kindGeneraliseAll = kindGeneralizeSome emptyWC</span><span>
</span><span id="line-3838"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#kindGeneralizeAll"><span class="hs-identifier hs-type">kindGeneralizeAll</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#KindVar"><span class="hs-identifier hs-type">KindVar</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3839"></span><span id="kindGeneralizeAll"><span class="annot"><span class="annottext">kindGeneralizeAll :: SkolemInfo -&gt; Type -&gt; TcM [TcTyVar]
</span><a href="GHC.Tc.Gen.HsType.html#kindGeneralizeAll"><span class="hs-identifier hs-var hs-var">kindGeneralizeAll</span></a></span></span><span> </span><span id="local-6989586621683078151"><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621683078151"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span id="local-6989586621683078152"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078152"><span class="hs-identifier hs-var">kind_or_type</span></a></span></span><span>
</span><span id="line-3840"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;kindGeneralizeAll&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078152"><span class="hs-identifier hs-var">kind_or_type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3841"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683078153"><span class="annot"><a href="#local-6989586621683078153"><span class="hs-identifier hs-var">dvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM CandidatesQTvs
</span><a href="GHC.Tc.Utils.TcMType.html#candidateQTyVarsOfKind"><span class="hs-identifier hs-var">candidateQTyVarsOfKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078152"><span class="hs-identifier hs-var">kind_or_type</span></a></span><span>
</span><span id="line-3842"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#quantifyTyVars"><span class="hs-identifier hs-type">quantifyTyVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078151"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#DefaultNonStandardTyVars"><span class="hs-identifier hs-type">DefaultNonStandardTyVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078153"><span class="hs-identifier hs-type">dvs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3843"></span><span>
</span><span id="line-3844"></span><span class="hs-comment">-- | Specialized version of 'kindGeneralizeSome', but where no variables</span><span>
</span><span id="line-3845"></span><span class="hs-comment">-- can be generalized, but perhaps some may need to be promoted.</span><span>
</span><span id="line-3846"></span><span class="hs-comment">-- Use this variant when it is unknowable whether metavariables might</span><span>
</span><span id="line-3847"></span><span class="hs-comment">-- later be constrained.</span><span>
</span><span id="line-3848"></span><span class="hs-comment">--</span><span>
</span><span id="line-3849"></span><span class="hs-comment">-- To see why this promotion is needed, see</span><span>
</span><span id="line-3850"></span><span class="hs-comment">-- Note [Recipe for checking a signature], and especially</span><span>
</span><span id="line-3851"></span><span class="hs-comment">-- Note [Promotion in signatures].</span><span>
</span><span id="line-3852"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#kindGeneralizeNone"><span class="hs-identifier hs-type">kindGeneralizeNone</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>  </span><span class="hs-comment">-- needn't be zonked</span><span>
</span><span id="line-3853"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3854"></span><span id="kindGeneralizeNone"><span class="annot"><span class="annottext">kindGeneralizeNone :: Type -&gt; TcM ()
</span><a href="GHC.Tc.Gen.HsType.html#kindGeneralizeNone"><span class="hs-identifier hs-var hs-var">kindGeneralizeNone</span></a></span></span><span> </span><span id="local-6989586621683078154"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078154"><span class="hs-identifier hs-var">kind_or_type</span></a></span></span><span>
</span><span id="line-3855"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;kindGeneralizeNone&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078154"><span class="hs-identifier hs-var">kind_or_type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3856"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683078155"><span class="annot"><a href="#local-6989586621683078155"><span class="hs-identifier hs-var">dvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM CandidatesQTvs
</span><a href="GHC.Tc.Utils.TcMType.html#candidateQTyVarsOfKind"><span class="hs-identifier hs-var">candidateQTyVarsOfKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078154"><span class="hs-identifier hs-var">kind_or_type</span></a></span><span>
</span><span id="line-3857"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#promoteTyVarSet"><span class="hs-identifier hs-type">promoteTyVarSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#candidateKindVars"><span class="hs-identifier hs-type">candidateKindVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078155"><span class="hs-identifier hs-type">dvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3858"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3859"></span><span>
</span><span id="line-3860"></span><span class="hs-comment">{- Note [Levels and generalisation]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider
  f x = e
with no type signature. We are currently at level i.
We must
  * Push the level to level (i+1)
  * Allocate a fresh alpha[i+1] for the result type
  * Check that e :: alpha[i+1], gathering constraint WC
  * Solve WC as far as possible
  * Zonking the result type alpha[i+1], say to beta[i-1] -&gt; gamma[i]
  * Find the free variables with level &gt; i, in this case gamma[i]
  * Skolemise those free variables and quantify over them, giving
       f :: forall g. beta[i-1] -&gt; g
  * Emit the residual constraint wrapped in an implication for g,
    thus   forall g. WC

All of this happens for types too.  Consider
  f :: Int -&gt; (forall a. Proxy a -&gt; Int)

Note [Kind generalisation]
~~~~~~~~~~~~~~~~~~~~~~~~~~
We do kind generalisation only at the outer level of a type signature.
For example, consider
  T :: forall k. k -&gt; *
  f :: (forall a. T a -&gt; Int) -&gt; Int
When kind-checking f's type signature we generalise the kind at
the outermost level, thus:
  f1 :: forall k. (forall (a:k). T k a -&gt; Int) -&gt; Int  -- YES!
and *not* at the inner forall:
  f2 :: (forall k. forall (a:k). T k a -&gt; Int) -&gt; Int  -- NO!
Reason: same as for HM inference on value level declarations,
we want to infer the most general type.  The f2 type signature
would be *less applicable* than f1, because it requires a more
polymorphic argument.

NB: There are no explicit kind variables written in f's signature.
When there are, the renamer adds these kind variables to the list of
variables bound by the forall, so you can indeed have a type that's
higher-rank in its kind. But only by explicit request.

Note [Kinds of quantified type variables]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
tcTyVarBndrsGen quantifies over a specified list of type variables,
*and* over the kind variables mentioned in the kinds of those tyvars.

Note that we must zonk those kinds (obviously) but less obviously, we
must return type variables whose kinds are zonked too. Example
    (a :: k7)  where  k7 := k9 -&gt; k9
We must return
    [k9, a:k9-&gt;k9]
and NOT
    [k9, a:k7]
Reason: we're going to turn this into a for-all type,
   forall k9. forall (a:k7). blah
which the type checker will then instantiate, and instantiate does not
look through unification variables!

Hence using zonked_kinds when forming tvs'.

-}</span><span>
</span><span id="line-3921"></span><span>
</span><span id="line-3922"></span><span class="hs-comment">-----------------------------------</span><span>
</span><span id="line-3923"></span><span id="local-6989586621683075324"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#etaExpandAlgTyCon"><span class="hs-identifier hs-type">etaExpandAlgTyCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TyConFlavour"><span class="hs-identifier hs-type">TyConFlavour</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075324"><span class="hs-identifier hs-type">tc</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a></span><span>
</span><span id="line-3924"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyConBinder"><span class="hs-identifier hs-type">TcTyConBinder</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span>
</span><span id="line-3925"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyConBinder"><span class="hs-identifier hs-type">TcTyConBinder</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-3926"></span><span id="etaExpandAlgTyCon"><span class="annot"><span class="annottext">etaExpandAlgTyCon :: forall tc.
TyConFlavour tc
-&gt; SkolemInfo -&gt; [TyConBinder] -&gt; Type -&gt; TcM ([TyConBinder], Type)
</span><a href="GHC.Tc.Gen.HsType.html#etaExpandAlgTyCon"><span class="hs-identifier hs-var hs-var">etaExpandAlgTyCon</span></a></span></span><span> </span><span id="local-6989586621683078159"><span class="annot"><span class="annottext">TyConFlavour tc
</span><a href="#local-6989586621683078159"><span class="hs-identifier hs-var">flav</span></a></span></span><span> </span><span id="local-6989586621683078160"><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621683078160"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span id="local-6989586621683078161"><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621683078161"><span class="hs-identifier hs-var">tcbs</span></a></span></span><span> </span><span id="local-6989586621683078162"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078162"><span class="hs-identifier hs-var">res_kind</span></a></span></span><span>
</span><span id="line-3927"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyConFlavour tc -&gt; Bool
forall tc. TyConFlavour tc -&gt; Bool
</span><a href="GHC.Tc.Gen.HsType.html#needsEtaExpansion"><span class="hs-identifier hs-var">needsEtaExpansion</span></a></span><span> </span><span class="annot"><span class="annottext">TyConFlavour tc
</span><a href="#local-6989586621683078159"><span class="hs-identifier hs-var">flav</span></a></span><span>
</span><span id="line-3928"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SkolemInfo
-&gt; InScopeSet -&gt; [OccName] -&gt; Type -&gt; TcM ([TyConBinder], Type)
</span><a href="GHC.Tc.Gen.HsType.html#splitTyConKind"><span class="hs-identifier hs-var">splitTyConKind</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621683078160"><span class="hs-identifier hs-var">skol_info</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621683078163"><span class="hs-identifier hs-var">in_scope</span></a></span><span> </span><span class="annot"><span class="annottext">[OccName]
</span><a href="#local-6989586621683078164"><span class="hs-identifier hs-var">avoid_occs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078162"><span class="hs-identifier hs-var">res_kind</span></a></span><span>
</span><span id="line-3929"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-3930"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([TyConBinder], Type) -&gt; TcM ([TyConBinder], Type)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078162"><span class="hs-identifier hs-var">res_kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3931"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3932"></span><span>    </span><span id="local-6989586621683078165"><span class="annot"><span class="annottext">tyvars :: [TcTyVar]
</span><a href="#local-6989586621683078165"><span class="hs-identifier hs-var hs-var">tyvars</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyConBinder] -&gt; [TcTyVar]
forall tv argf. [VarBndr tv argf] -&gt; [tv]
</span><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-var">binderVars</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621683078161"><span class="hs-identifier hs-var">tcbs</span></a></span><span>
</span><span id="line-3933"></span><span>    </span><span id="local-6989586621683078163"><span class="annot"><span class="annottext">in_scope :: InScopeSet
</span><a href="#local-6989586621683078163"><span class="hs-identifier hs-var hs-var">in_scope</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcTyVar] -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#mkInScopeSetList"><span class="hs-identifier hs-var">mkInScopeSetList</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683078165"><span class="hs-identifier hs-var">tyvars</span></a></span><span>
</span><span id="line-3934"></span><span>    </span><span id="local-6989586621683078164"><span class="annot"><span class="annottext">avoid_occs :: [OccName]
</span><a href="#local-6989586621683078164"><span class="hs-identifier hs-var hs-var">avoid_occs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcTyVar -&gt; OccName) -&gt; [TcTyVar] -&gt; [OccName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; OccName
forall a. NamedThing a =&gt; a -&gt; OccName
</span><a href="GHC.Types.Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621683078165"><span class="hs-identifier hs-var">tyvars</span></a></span><span>
</span><span id="line-3935"></span><span>
</span><span id="line-3936"></span><span id="local-6989586621683078167"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#needsEtaExpansion"><span class="hs-identifier hs-type">needsEtaExpansion</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TyConFlavour"><span class="hs-identifier hs-type">TyConFlavour</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078167"><span class="hs-identifier hs-type">tc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-3937"></span><span id="needsEtaExpansion"><span class="annot"><span class="annottext">needsEtaExpansion :: forall tc. TyConFlavour tc -&gt; Bool
</span><a href="GHC.Tc.Gen.HsType.html#needsEtaExpansion"><span class="hs-identifier hs-var hs-var">needsEtaExpansion</span></a></span></span><span> </span><span class="annot"><span class="annottext">TyConFlavour tc
</span><a href="GHC.Types.Basic.html#NewtypeFlavour"><span class="hs-identifier hs-var">NewtypeFlavour</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-3938"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#needsEtaExpansion"><span class="hs-identifier hs-var">needsEtaExpansion</span></a></span><span> </span><span class="annot"><span class="annottext">TyConFlavour tc
</span><a href="GHC.Types.Basic.html#DataTypeFlavour"><span class="hs-identifier hs-var">DataTypeFlavour</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-3939"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#needsEtaExpansion"><span class="hs-identifier hs-var">needsEtaExpansion</span></a></span><span> </span><span class="annot"><span class="annottext">TyConFlavour tc
</span><a href="GHC.Types.Basic.html#ClassFlavour"><span class="hs-identifier hs-var">ClassFlavour</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-3940"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#needsEtaExpansion"><span class="hs-identifier hs-var">needsEtaExpansion</span></a></span><span> </span><span class="annot"><span class="annottext">TyConFlavour tc
</span><span class="hs-identifier">_</span></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-3941"></span><span>
</span><span id="line-3942"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#splitTyConKind"><span class="hs-identifier hs-type">splitTyConKind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a></span><span>
</span><span id="line-3943"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#InScopeSet"><span class="hs-identifier hs-type">InScopeSet</span></a></span><span>
</span><span id="line-3944"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#OccName"><span class="hs-identifier hs-type">OccName</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- Avoid these OccNames</span><span>
</span><span id="line-3945"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span>       </span><span class="hs-comment">-- Must be zonked</span><span>
</span><span id="line-3946"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyConBinder"><span class="hs-identifier hs-type">TcTyConBinder</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3947"></span><span class="hs-comment">-- GADT decls can have a (perhaps partial) kind signature</span><span>
</span><span id="line-3948"></span><span class="hs-comment">--      e.g.  data T a :: * -&gt; * -&gt; * where ...</span><span>
</span><span id="line-3949"></span><span class="hs-comment">-- This function makes up suitable (kinded) TyConBinders for the</span><span>
</span><span id="line-3950"></span><span class="hs-comment">-- argument kinds.  E.g. in this case it might return</span><span>
</span><span id="line-3951"></span><span class="hs-comment">--   ([b::*, c::*], *)</span><span>
</span><span id="line-3952"></span><span class="hs-comment">-- Skolemises the type as it goes, returning skolem TcTyVars</span><span>
</span><span id="line-3953"></span><span class="hs-comment">-- Never emits constraints.</span><span>
</span><span id="line-3954"></span><span class="hs-comment">-- It's a little trickier than you might think: see Note [splitTyConKind]</span><span>
</span><span id="line-3955"></span><span class="hs-comment">-- See also Note [Datatype return kinds] in GHC.Tc.TyCl</span><span>
</span><span id="line-3956"></span><span id="splitTyConKind"><span class="annot"><span class="annottext">splitTyConKind :: SkolemInfo
-&gt; InScopeSet -&gt; [OccName] -&gt; Type -&gt; TcM ([TyConBinder], Type)
</span><a href="GHC.Tc.Gen.HsType.html#splitTyConKind"><span class="hs-identifier hs-var hs-var">splitTyConKind</span></a></span></span><span> </span><span id="local-6989586621683078171"><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621683078171"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span id="local-6989586621683078172"><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621683078172"><span class="hs-identifier hs-var">in_scope</span></a></span></span><span> </span><span id="local-6989586621683078173"><span class="annot"><span class="annottext">[OccName]
</span><a href="#local-6989586621683078173"><span class="hs-identifier hs-var">avoid_occs</span></a></span></span><span> </span><span id="local-6989586621683078174"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078174"><span class="hs-identifier hs-var">kind</span></a></span></span><span>
</span><span id="line-3957"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683078175"><span class="annot"><a href="#local-6989586621683078175"><span class="hs-identifier hs-var">loc</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn SrcSpan
</span><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a></span><span>
</span><span id="line-3958"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683078177"><span class="annot"><a href="#local-6989586621683078177"><span class="hs-identifier hs-var">new_uniqs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#getUniquesM"><span class="hs-identifier hs-type">getUniquesM</span></a></span><span>
</span><span id="line-3959"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683078179"><span class="annot"><a href="#local-6989586621683078179"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getLocalRdrEnv"><span class="hs-identifier hs-type">getLocalRdrEnv</span></a></span><span>
</span><span id="line-3960"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683078181"><span class="annot"><a href="#local-6989586621683078181"><span class="hs-identifier hs-var">lvl</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getTcLevel"><span class="hs-identifier hs-type">getTcLevel</span></a></span><span>
</span><span id="line-3961"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683078182"><span class="annot"><a href="#local-6989586621683078182"><span class="hs-identifier hs-var hs-var">new_occs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(OccName -&gt; Bool) -&gt; Infinite OccName -&gt; Infinite OccName
forall a. (a -&gt; Bool) -&gt; Infinite a -&gt; Infinite a
</span><a href="GHC.Data.List.Infinite.html#filter"><span class="hs-identifier hs-var">Inf.filter</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683078184"><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683078184"><span class="hs-identifier hs-var">occ</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3962"></span><span>                  </span><span class="annot"><span class="annottext">Maybe Name -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocalRdrEnv -&gt; OccName -&gt; Maybe Name
</span><a href="GHC.Types.Name.Reader.html#lookupLocalRdrOcc"><span class="hs-identifier hs-var">lookupLocalRdrOcc</span></a></span><span> </span><span class="annot"><span class="annottext">LocalRdrEnv
</span><a href="#local-6989586621683078179"><span class="hs-identifier hs-var">rdr_env</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683078184"><span class="hs-identifier hs-var">occ</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-3963"></span><span>                  </span><span class="hs-comment">-- Note [Avoid name clashes for associated data types]</span><span>
</span><span id="line-3964"></span><span>                  </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683078184"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="annot"><span class="annottext">OccName -&gt; [OccName] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[OccName]
</span><a href="#local-6989586621683078173"><span class="hs-identifier hs-var">avoid_occs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Infinite OccName -&gt; Infinite OccName)
-&gt; Infinite OccName -&gt; Infinite OccName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NameSpace -&gt; String -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkOccName"><span class="hs-identifier hs-var">mkOccName</span></a></span><span> </span><span class="annot"><span class="annottext">NameSpace
</span><a href="GHC.Types.Name.Occurrence.html#tvName"><span class="hs-identifier hs-var">tvName</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; OccName) -&gt; Infinite String -&gt; Infinite OccName
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Infinite String
</span><a href="GHC.Builtin.Names.html#allNameStrings"><span class="hs-identifier hs-var">allNameStrings</span></a></span><span>
</span><span id="line-3965"></span><span>              </span><span id="local-6989586621683078191"><span class="annot"><a href="#local-6989586621683078191"><span class="hs-identifier hs-var hs-var">subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#mkEmptySubst"><span class="hs-identifier hs-var">mkEmptySubst</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621683078172"><span class="hs-identifier hs-var">in_scope</span></a></span><span>
</span><span id="line-3966"></span><span>              </span><span id="local-6989586621683078192"><span class="annot"><a href="#local-6989586621683078192"><span class="hs-identifier hs-var hs-var">details</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SkolemInfo -&gt; TcLevel -&gt; Bool -&gt; TcTyVarDetails
</span><a href="GHC.Tc.Utils.TcType.html#SkolemTv"><span class="hs-identifier hs-var">SkolemTv</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621683078171"><span class="hs-identifier hs-var">skol_info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLevel -&gt; TcLevel
</span><a href="GHC.Tc.Utils.TcType.html#pushTcLevel"><span class="hs-identifier hs-var">pushTcLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621683078181"><span class="hs-identifier hs-var">lvl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-3967"></span><span>                        </span><span class="hs-comment">-- As always, allocate skolems one level in</span><span>
</span><span id="line-3968"></span><span>
</span><span id="line-3969"></span><span>              </span><span id="local-6989586621683078194"><span class="annot"><a href="#local-6989586621683078194"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621683078195"><span class="annot"><span class="annottext">Infinite OccName
</span><a href="#local-6989586621683078195"><span class="hs-identifier hs-var">occs</span></a></span></span><span> </span><span id="local-6989586621683078196"><span class="annot"><span class="annottext">[Unique]
</span><a href="#local-6989586621683078196"><span class="hs-identifier hs-var">uniqs</span></a></span></span><span> </span><span id="local-6989586621683078197"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683078197"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621683078198"><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621683078198"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621683078199"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078199"><span class="hs-identifier hs-var">kind</span></a></span></span><span>
</span><span id="line-3970"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (PiTyVarBinder, Type)
</span><a href="GHC.Core.Type.html#splitPiTy_maybe"><span class="hs-identifier hs-var">splitPiTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078199"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3971"></span><span>                    </span><span class="annot"><span class="annottext">Maybe (PiTyVarBinder, Type)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyConBinder] -&gt; [TyConBinder]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621683078198"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683078197"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078199"><span class="hs-identifier hs-var">kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3972"></span><span>
</span><span id="line-3973"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Anon"><span class="hs-identifier hs-type">Anon</span></a></span><span> </span><span id="local-6989586621683078202"><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621683078202"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span id="local-6989586621683078203"><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621683078203"><span class="hs-identifier hs-var">af</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683078204"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078204"><span class="hs-identifier hs-var">kind'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-3974"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ([TyConBinder], Type) -&gt; ([TyConBinder], Type)
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621683078203"><span class="hs-identifier hs-var">af</span></a></span><span> </span><span class="annot"><span class="annottext">FunTyFlag -&gt; FunTyFlag -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="GHC.Types.Var.html#FTF_T_T"><span class="hs-identifier hs-var">FTF_T_T</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(([TyConBinder], Type) -&gt; ([TyConBinder], Type))
-&gt; ([TyConBinder], Type) -&gt; ([TyConBinder], Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-3975"></span><span>                         </span><span class="annot"><span class="annottext">Infinite OccName
-&gt; [Unique]
-&gt; Subst
-&gt; [TyConBinder]
-&gt; Type
-&gt; ([TyConBinder], Type)
</span><a href="#local-6989586621683078194"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Infinite OccName
</span><a href="#local-6989586621683078207"><span class="hs-identifier hs-var">occs'</span></a></span><span> </span><span class="annot"><span class="annottext">[Unique]
</span><a href="#local-6989586621683078208"><span class="hs-identifier hs-var">uniqs'</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683078209"><span class="hs-identifier hs-var">subst'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyConBinder
</span><a href="#local-6989586621683078210"><span class="hs-identifier hs-var">tcb</span></a></span><span> </span><span class="annot"><span class="annottext">TyConBinder -&gt; [TyConBinder] -&gt; [TyConBinder]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621683078198"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078204"><span class="hs-identifier hs-var">kind'</span></a></span><span>
</span><span id="line-3976"></span><span>                      </span><span class="hs-keyword">where</span><span>
</span><span id="line-3977"></span><span>                        </span><span id="local-6989586621683078210"><span class="annot"><span class="annottext">tcb :: TyConBinder
</span><a href="#local-6989586621683078210"><span class="hs-identifier hs-var hs-var">tcb</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TyConBndrVis -&gt; TyConBinder
forall var argf. var -&gt; argf -&gt; VarBndr var argf
</span><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683078211"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">TyConBndrVis
</span><a href="GHC.Core.TyCon.html#AnonTCB"><span class="hs-identifier hs-var">AnonTCB</span></a></span><span>
</span><span id="line-3978"></span><span>                        </span><span id="local-6989586621683078213"><span class="annot"><span class="annottext">arg' :: Type
</span><a href="#local-6989586621683078213"><span class="hs-identifier hs-var hs-var">arg'</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683078197"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled Type -&gt; Type
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621683078202"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3979"></span><span>                        </span><span id="local-6989586621683078214"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621683078214"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; OccName -&gt; SrcSpan -&gt; Name
</span><a href="GHC.Types.Name.html#mkInternalName"><span class="hs-identifier hs-var">mkInternalName</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621683078216"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683078217"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683078175"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-3980"></span><span>                        </span><span id="local-6989586621683078211"><span class="annot"><span class="annottext">tv :: TcTyVar
</span><a href="#local-6989586621683078211"><span class="hs-identifier hs-var hs-var">tv</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; TcTyVarDetails -&gt; TcTyVar
</span><a href="GHC.Types.Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683078214"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078213"><span class="hs-identifier hs-var">arg'</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVarDetails
</span><a href="#local-6989586621683078192"><span class="hs-identifier hs-var">details</span></a></span><span>
</span><span id="line-3981"></span><span>                        </span><span id="local-6989586621683078209"><span class="annot"><span class="annottext">subst' :: Subst
</span><a href="#local-6989586621683078209"><span class="hs-identifier hs-var hs-var">subst'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; TcTyVar -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#extendSubstInScope"><span class="hs-identifier hs-var">extendSubstInScope</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683078197"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683078211"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-3982"></span><span>                        </span><span id="local-6989586621683078216"><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621683078216"><span class="hs-identifier hs-var">uniq</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683078208"><span class="annot"><span class="annottext">[Unique]
</span><a href="#local-6989586621683078208"><span class="hs-identifier hs-var">uniqs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Unique]
</span><a href="#local-6989586621683078196"><span class="hs-identifier hs-var">uniqs</span></a></span><span>
</span><span id="line-3983"></span><span>                        </span><span class="annot"><a href="GHC.Data.List.Infinite.html#Inf"><span class="hs-identifier hs-type">Inf</span></a></span><span> </span><span id="local-6989586621683078217"><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621683078217"><span class="hs-identifier hs-var">occ</span></a></span></span><span> </span><span id="local-6989586621683078207"><span class="annot"><span class="annottext">Infinite OccName
</span><a href="#local-6989586621683078207"><span class="hs-identifier hs-var">occs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Infinite OccName
</span><a href="#local-6989586621683078195"><span class="hs-identifier hs-var">occs</span></a></span><span>
</span><span id="line-3984"></span><span>
</span><span id="line-3985"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Named"><span class="hs-identifier hs-type">Named</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span id="local-6989586621683078220"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683078220"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621683078221"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621683078221"><span class="hs-identifier hs-var">vis</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621683078222"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078222"><span class="hs-identifier hs-var">kind'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-3986"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Infinite OccName
-&gt; [Unique]
-&gt; Subst
-&gt; [TyConBinder]
-&gt; Type
-&gt; ([TyConBinder], Type)
</span><a href="#local-6989586621683078194"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Infinite OccName
</span><a href="#local-6989586621683078195"><span class="hs-identifier hs-var">occs</span></a></span><span> </span><span class="annot"><span class="annottext">[Unique]
</span><a href="#local-6989586621683078196"><span class="hs-identifier hs-var">uniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683078223"><span class="hs-identifier hs-var">subst'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyConBinder
</span><a href="#local-6989586621683078224"><span class="hs-identifier hs-var">tcb</span></a></span><span> </span><span class="annot"><span class="annottext">TyConBinder -&gt; [TyConBinder] -&gt; [TyConBinder]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621683078198"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078222"><span class="hs-identifier hs-var">kind'</span></a></span><span>
</span><span id="line-3987"></span><span>                      </span><span class="hs-keyword">where</span><span>
</span><span id="line-3988"></span><span>                        </span><span id="local-6989586621683078224"><span class="annot"><span class="annottext">tcb :: TyConBinder
</span><a href="#local-6989586621683078224"><span class="hs-identifier hs-var hs-var">tcb</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TyConBndrVis -&gt; TyConBinder
forall var argf. var -&gt; argf -&gt; VarBndr var argf
</span><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683078225"><span class="hs-identifier hs-var">tv'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ForAllTyFlag -&gt; TyConBndrVis
</span><a href="GHC.Core.TyCon.html#NamedTCB"><span class="hs-identifier hs-var">NamedTCB</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621683078221"><span class="hs-identifier hs-var">vis</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3989"></span><span>                        </span><span id="local-6989586621683078227"><span class="annot"><span class="annottext">tc_tyvar :: TcTyVar
</span><a href="#local-6989586621683078227"><span class="hs-identifier hs-var hs-var">tc_tyvar</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; TcTyVarDetails -&gt; TcTyVar
</span><a href="GHC.Types.Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; Name
</span><a href="GHC.Types.Var.html#tyVarName"><span class="hs-identifier hs-var">tyVarName</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683078220"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; Type
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683078220"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcTyVarDetails
</span><a href="#local-6989586621683078192"><span class="hs-identifier hs-var">details</span></a></span><span>
</span><span id="line-3990"></span><span>                        </span><span class="hs-special">(</span><span id="local-6989586621683078223"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683078223"><span class="hs-identifier hs-var">subst'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683078225"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683078225"><span class="hs-identifier hs-var">tv'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; TcTyVar -&gt; (Subst, TcTyVar)
Subst -&gt; TcTyVar -&gt; (Subst, TcTyVar)
</span><a href="GHC.Core.TyCo.Subst.html#substTyVarBndr"><span class="hs-identifier hs-var">substTyVarBndr</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683078197"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683078227"><span class="hs-identifier hs-var">tc_tyvar</span></a></span><span>
</span><span id="line-3991"></span><span>
</span><span id="line-3992"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683078194"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078182"><span class="hs-identifier hs-type">new_occs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078177"><span class="hs-identifier hs-type">new_uniqs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078191"><span class="hs-identifier hs-type">subst</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621683078174"><span class="hs-identifier hs-type">kind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3993"></span><span>
</span><span id="line-3994"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#isAllowedDataResKind"><span class="hs-identifier hs-type">isAllowedDataResKind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#AllowedDataResKind"><span class="hs-identifier hs-type">AllowedDataResKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-3995"></span><span id="isAllowedDataResKind"><span class="annot"><span class="annottext">isAllowedDataResKind :: AllowedDataResKind -&gt; Type -&gt; Bool
</span><a href="GHC.Tc.Gen.HsType.html#isAllowedDataResKind"><span class="hs-identifier hs-var hs-var">isAllowedDataResKind</span></a></span></span><span> </span><span class="annot"><span class="annottext">AllowedDataResKind
</span><a href="GHC.Tc.Errors.Types.html#AnyTYPEKind"><span class="hs-identifier hs-var">AnyTYPEKind</span></a></span><span>  </span><span id="local-6989586621683078231"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078231"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isTypeLikeKind"><span class="hs-identifier hs-var">isTypeLikeKind</span></a></span><span>     </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078231"><span class="hs-identifier hs-var">kind</span></a></span><span>
</span><span id="line-3996"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#isAllowedDataResKind"><span class="hs-identifier hs-var">isAllowedDataResKind</span></a></span><span> </span><span class="annot"><span class="annottext">AllowedDataResKind
</span><a href="GHC.Tc.Errors.Types.html#AnyBoxedKind"><span class="hs-identifier hs-var">AnyBoxedKind</span></a></span><span> </span><span id="local-6989586621683078234"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078234"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#tcIsBoxedTypeKind"><span class="hs-identifier hs-var">tcIsBoxedTypeKind</span></a></span><span>  </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078234"><span class="hs-identifier hs-var">kind</span></a></span><span>
</span><span id="line-3997"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#isAllowedDataResKind"><span class="hs-identifier hs-var">isAllowedDataResKind</span></a></span><span> </span><span class="annot"><span class="annottext">AllowedDataResKind
</span><a href="GHC.Tc.Errors.Types.html#LiftedKind"><span class="hs-identifier hs-var">LiftedKind</span></a></span><span>   </span><span id="local-6989586621683078237"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078237"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#tcIsLiftedTypeKind"><span class="hs-identifier hs-var">tcIsLiftedTypeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078237"><span class="hs-identifier hs-var">kind</span></a></span><span>
</span><span id="line-3998"></span><span>
</span><span id="line-3999"></span><span class="hs-comment">-- | Checks that the return kind in a data declaration's kind signature is</span><span>
</span><span id="line-4000"></span><span class="hs-comment">-- permissible. There are three cases:</span><span>
</span><span id="line-4001"></span><span class="hs-comment">--</span><span>
</span><span id="line-4002"></span><span class="hs-comment">-- If dealing with a @data@, @newtype@, @data instance@, or @newtype instance@</span><span>
</span><span id="line-4003"></span><span class="hs-comment">-- declaration, check that the return kind is @Type@.</span><span>
</span><span id="line-4004"></span><span class="hs-comment">--</span><span>
</span><span id="line-4005"></span><span class="hs-comment">-- If the declaration is a @newtype@ or @newtype instance@ and the</span><span>
</span><span id="line-4006"></span><span class="hs-comment">-- @UnliftedNewtypes@ extension is enabled, this check is slightly relaxed so</span><span>
</span><span id="line-4007"></span><span class="hs-comment">-- that a return kind of the form @TYPE r@ (for some @r@) is permitted.</span><span>
</span><span id="line-4008"></span><span class="hs-comment">-- See @Note [Implementation of UnliftedNewtypes]@ in &quot;GHC.Tc.TyCl&quot;.</span><span>
</span><span id="line-4009"></span><span class="hs-comment">--</span><span>
</span><span id="line-4010"></span><span class="hs-comment">-- If dealing with a @data family@ declaration, check that the return kind is</span><span>
</span><span id="line-4011"></span><span class="hs-comment">-- either of the form:</span><span>
</span><span id="line-4012"></span><span class="hs-comment">--</span><span>
</span><span id="line-4013"></span><span class="hs-comment">-- 1. @TYPE r@ (for some @r@), or</span><span>
</span><span id="line-4014"></span><span class="hs-comment">--</span><span>
</span><span id="line-4015"></span><span class="hs-comment">-- 2. @k@ (where @k@ is a bare kind variable; see #12369)</span><span>
</span><span id="line-4016"></span><span class="hs-comment">--</span><span>
</span><span id="line-4017"></span><span class="hs-comment">-- See also Note [Datatype return kinds] in &quot;GHC.Tc.TyCl&quot;</span><span>
</span><span id="line-4018"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#checkDataKindSig"><span class="hs-identifier hs-type">checkDataKindSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#DataSort"><span class="hs-identifier hs-type">DataSort</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span>  </span><span class="hs-comment">-- any arguments in the kind are stripped off</span><span>
</span><span id="line-4019"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-4020"></span><span id="checkDataKindSig"><span class="annot"><span class="annottext">checkDataKindSig :: DataSort -&gt; Type -&gt; TcM ()
</span><a href="GHC.Tc.Gen.HsType.html#checkDataKindSig"><span class="hs-identifier hs-var hs-var">checkDataKindSig</span></a></span></span><span> </span><span id="local-6989586621683078238"><span class="annot"><span class="annottext">DataSort
</span><a href="#local-6989586621683078238"><span class="hs-identifier hs-var">data_sort</span></a></span></span><span> </span><span id="local-6989586621683078239"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078239"><span class="hs-identifier hs-var">kind</span></a></span></span><span>
</span><span id="line-4021"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683078240"><span class="annot"><a href="#local-6989586621683078240"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-4022"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;checkDataKindSig&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078239"><span class="hs-identifier hs-type">kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4023"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-type">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683078243"><span class="hs-identifier hs-type">tYPE_ok</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078240"><span class="hs-identifier hs-type">dflags</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">||</span></span><span> </span><span class="annot"><a href="#local-6989586621683078244"><span class="hs-identifier hs-type">is_kind_var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4024"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683078245"><span class="hs-identifier hs-type">err_msg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078240"><span class="hs-identifier hs-type">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4025"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-4026"></span><span>    </span><span id="local-6989586621683078246"><span class="annot"><span class="annottext">res_kind :: Type
</span><a href="#local-6989586621683078246"><span class="hs-identifier hs-var hs-var">res_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([PiTyVarBinder], Type) -&gt; Type
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; ([PiTyVarBinder], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitPiTys"><span class="hs-identifier hs-var">tcSplitPiTys</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078239"><span class="hs-identifier hs-var">kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4027"></span><span>       </span><span class="hs-comment">-- Look for the result kind after</span><span>
</span><span id="line-4028"></span><span>       </span><span class="hs-comment">-- peeling off any foralls and arrows</span><span>
</span><span id="line-4029"></span><span>
</span><span id="line-4030"></span><span>    </span><span class="annot"><a href="#local-6989586621683078248"><span class="hs-identifier hs-type">is_newtype</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-4031"></span><span>    </span><span id="local-6989586621683078248"><span class="annot"><span class="annottext">is_newtype :: Bool
</span><a href="#local-6989586621683078248"><span class="hs-identifier hs-var hs-var">is_newtype</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4032"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DataSort
</span><a href="#local-6989586621683078238"><span class="hs-identifier hs-var">data_sort</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-4033"></span><span>        </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#DataDeclSort"><span class="hs-identifier hs-type">DataDeclSort</span></a></span><span>     </span><span id="local-6989586621683078250"><span class="annot"><span class="annottext">NewOrData
</span><a href="#local-6989586621683078250"><span class="hs-identifier hs-var">new_or_data</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NewOrData
</span><a href="#local-6989586621683078250"><span class="hs-identifier hs-var">new_or_data</span></a></span><span> </span><span class="annot"><span class="annottext">NewOrData -&gt; NewOrData -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">NewOrData
</span><a href="Language.Haskell.Syntax.Decls.html#NewType"><span class="hs-identifier hs-var">NewType</span></a></span><span>
</span><span id="line-4034"></span><span>        </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#DataInstanceSort"><span class="hs-identifier hs-type">DataInstanceSort</span></a></span><span> </span><span id="local-6989586621683078253"><span class="annot"><span class="annottext">NewOrData
</span><a href="#local-6989586621683078253"><span class="hs-identifier hs-var">new_or_data</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NewOrData
</span><a href="#local-6989586621683078253"><span class="hs-identifier hs-var">new_or_data</span></a></span><span> </span><span class="annot"><span class="annottext">NewOrData -&gt; NewOrData -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">NewOrData
</span><a href="Language.Haskell.Syntax.Decls.html#NewType"><span class="hs-identifier hs-var">NewType</span></a></span><span>
</span><span id="line-4035"></span><span>        </span><span class="annot"><span class="annottext">DataSort
</span><a href="GHC.Tc.Errors.Types.html#DataFamilySort"><span class="hs-identifier hs-var">DataFamilySort</span></a></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-4036"></span><span>
</span><span id="line-4037"></span><span>    </span><span class="annot"><a href="#local-6989586621683078255"><span class="hs-identifier hs-type">is_datatype</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-4038"></span><span>    </span><span id="local-6989586621683078255"><span class="annot"><span class="annottext">is_datatype :: Bool
</span><a href="#local-6989586621683078255"><span class="hs-identifier hs-var hs-var">is_datatype</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4039"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DataSort
</span><a href="#local-6989586621683078238"><span class="hs-identifier hs-var">data_sort</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-4040"></span><span>        </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#DataDeclSort"><span class="hs-identifier hs-type">DataDeclSort</span></a></span><span>     </span><span class="annot"><span class="annottext">NewOrData
</span><a href="Language.Haskell.Syntax.Decls.html#DataType"><span class="hs-identifier hs-var">DataType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-4041"></span><span>        </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#DataInstanceSort"><span class="hs-identifier hs-type">DataInstanceSort</span></a></span><span> </span><span class="annot"><span class="annottext">NewOrData
</span><a href="Language.Haskell.Syntax.Decls.html#DataType"><span class="hs-identifier hs-var">DataType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-4042"></span><span>        </span><span class="annot"><span class="annottext">DataSort
</span><span class="hs-identifier">_</span></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-4043"></span><span>
</span><span id="line-4044"></span><span>    </span><span class="annot"><a href="#local-6989586621683078257"><span class="hs-identifier hs-type">is_data_family</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-4045"></span><span>    </span><span id="local-6989586621683078257"><span class="annot"><span class="annottext">is_data_family :: Bool
</span><a href="#local-6989586621683078257"><span class="hs-identifier hs-var hs-var">is_data_family</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4046"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DataSort
</span><a href="#local-6989586621683078238"><span class="hs-identifier hs-var">data_sort</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-4047"></span><span>        </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#DataDeclSort"><span class="hs-identifier hs-type">DataDeclSort</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-4048"></span><span>        </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#DataInstanceSort"><span class="hs-identifier hs-type">DataInstanceSort</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-4049"></span><span>        </span><span class="annot"><span class="annottext">DataSort
</span><a href="GHC.Tc.Errors.Types.html#DataFamilySort"><span class="hs-identifier hs-var">DataFamilySort</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-4050"></span><span>
</span><span id="line-4051"></span><span>    </span><span class="annot"><a href="#local-6989586621683078258"><span class="hs-identifier hs-type">allowed_kind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#AllowedDataResKind"><span class="hs-identifier hs-type">AllowedDataResKind</span></a></span><span>
</span><span id="line-4052"></span><span>    </span><span id="local-6989586621683078258"><span class="annot"><span class="annottext">allowed_kind :: DynFlags -&gt; AllowedDataResKind
</span><a href="#local-6989586621683078258"><span class="hs-identifier hs-var hs-var">allowed_kind</span></a></span></span><span> </span><span id="local-6989586621683078259"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683078259"><span class="hs-identifier hs-var">dflags</span></a></span></span><span>
</span><span id="line-4053"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683078248"><span class="hs-identifier hs-var">is_newtype</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Extension -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#xopt"><span class="hs-identifier hs-var">xopt</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.UnliftedNewtypes</span></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683078259"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-4054"></span><span>        </span><span class="hs-comment">-- With UnliftedNewtypes, we allow kinds other than Type, but they</span><span>
</span><span id="line-4055"></span><span>        </span><span class="hs-comment">-- must still be of the form `TYPE r` since we don't want to accept</span><span>
</span><span id="line-4056"></span><span>        </span><span class="hs-comment">-- Constraint or Nat.</span><span>
</span><span id="line-4057"></span><span>        </span><span class="hs-comment">-- See Note [Implementation of UnliftedNewtypes] in GHC.Tc.TyCl.</span><span>
</span><span id="line-4058"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AllowedDataResKind
</span><a href="GHC.Tc.Errors.Types.html#AnyTYPEKind"><span class="hs-identifier hs-var">AnyTYPEKind</span></a></span><span>
</span><span id="line-4059"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683078257"><span class="hs-identifier hs-var">is_data_family</span></a></span><span>
</span><span id="line-4060"></span><span>        </span><span class="hs-comment">-- If this is a `data family` declaration, we don't need to check if</span><span>
</span><span id="line-4061"></span><span>        </span><span class="hs-comment">-- UnliftedNewtypes is enabled, since data family declarations can</span><span>
</span><span id="line-4062"></span><span>        </span><span class="hs-comment">-- have return kind `TYPE r` unconditionally (#16827).</span><span>
</span><span id="line-4063"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AllowedDataResKind
</span><a href="GHC.Tc.Errors.Types.html#AnyTYPEKind"><span class="hs-identifier hs-var">AnyTYPEKind</span></a></span><span>
</span><span id="line-4064"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683078255"><span class="hs-identifier hs-var">is_datatype</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Extension -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#xopt"><span class="hs-identifier hs-var">xopt</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.UnliftedDatatypes</span></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683078259"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-4065"></span><span>        </span><span class="hs-comment">-- With UnliftedDatatypes, we allow kinds other than Type, but they</span><span>
</span><span id="line-4066"></span><span>        </span><span class="hs-comment">-- must still be of the form `TYPE (BoxedRep l)`, so that we don't</span><span>
</span><span id="line-4067"></span><span>        </span><span class="hs-comment">-- accept result kinds like `TYPE IntRep`.</span><span>
</span><span id="line-4068"></span><span>        </span><span class="hs-comment">-- See Note [Implementation of UnliftedDatatypes] in GHC.Tc.TyCl.</span><span>
</span><span id="line-4069"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AllowedDataResKind
</span><a href="GHC.Tc.Errors.Types.html#AnyBoxedKind"><span class="hs-identifier hs-var">AnyBoxedKind</span></a></span><span>
</span><span id="line-4070"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-4071"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AllowedDataResKind
</span><a href="GHC.Tc.Errors.Types.html#LiftedKind"><span class="hs-identifier hs-var">LiftedKind</span></a></span><span>
</span><span id="line-4072"></span><span>
</span><span id="line-4073"></span><span>    </span><span class="annot"><a href="#local-6989586621683078243"><span class="hs-identifier hs-type">tYPE_ok</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-4074"></span><span>    </span><span id="local-6989586621683078243"><span class="annot"><span class="annottext">tYPE_ok :: DynFlags -&gt; Bool
</span><a href="#local-6989586621683078243"><span class="hs-identifier hs-var hs-var">tYPE_ok</span></a></span></span><span> </span><span id="local-6989586621683078263"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683078263"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AllowedDataResKind -&gt; Type -&gt; Bool
</span><a href="GHC.Tc.Gen.HsType.html#isAllowedDataResKind"><span class="hs-identifier hs-var">isAllowedDataResKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; AllowedDataResKind
</span><a href="#local-6989586621683078258"><span class="hs-identifier hs-var">allowed_kind</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683078263"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078246"><span class="hs-identifier hs-var">res_kind</span></a></span><span>
</span><span id="line-4075"></span><span>
</span><span id="line-4076"></span><span>    </span><span class="hs-comment">-- In the particular case of a data family, permit a return kind of the</span><span>
</span><span id="line-4077"></span><span>    </span><span class="hs-comment">-- form `:: k` (where `k` is a bare kind variable).</span><span>
</span><span id="line-4078"></span><span>    </span><span class="annot"><a href="#local-6989586621683078244"><span class="hs-identifier hs-type">is_kind_var</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-4079"></span><span>    </span><span id="local-6989586621683078244"><span class="annot"><span class="annottext">is_kind_var :: Bool
</span><a href="#local-6989586621683078244"><span class="hs-identifier hs-var hs-var">is_kind_var</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683078257"><span class="hs-identifier hs-var">is_data_family</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (TcTyVar, Coercion) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Maybe (TcTyVar, Coercion)
</span><a href="GHC.Core.Type.html#getCastedTyVar_maybe"><span class="hs-identifier hs-var">getCastedTyVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078246"><span class="hs-identifier hs-var">res_kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4080"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-4081"></span><span>
</span><span id="line-4082"></span><span>    </span><span class="annot"><a href="#local-6989586621683078245"><span class="hs-identifier hs-type">err_msg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span>
</span><span id="line-4083"></span><span>    </span><span id="local-6989586621683078245"><span class="annot"><span class="annottext">err_msg :: DynFlags -&gt; TcRnMessage
</span><a href="#local-6989586621683078245"><span class="hs-identifier hs-var hs-var">err_msg</span></a></span></span><span> </span><span id="local-6989586621683078266"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683078266"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4084"></span><span>      </span><span class="annot"><span class="annottext">DataSort
-&gt; AllowedDataResKind
-&gt; Type
-&gt; Maybe SuggestUnliftedTypes
-&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnInvalidReturnKind"><span class="hs-identifier hs-var">TcRnInvalidReturnKind</span></a></span><span> </span><span class="annot"><span class="annottext">DataSort
</span><a href="#local-6989586621683078238"><span class="hs-identifier hs-var">data_sort</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; AllowedDataResKind
</span><a href="#local-6989586621683078258"><span class="hs-identifier hs-var">allowed_kind</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683078266"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078239"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Maybe SuggestUnliftedTypes
</span><a href="#local-6989586621683078268"><span class="hs-identifier hs-var">ext_hint</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683078266"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4085"></span><span>
</span><span id="line-4086"></span><span>    </span><span id="local-6989586621683078268"><span class="annot"><span class="annottext">ext_hint :: DynFlags -&gt; Maybe SuggestUnliftedTypes
</span><a href="#local-6989586621683078268"><span class="hs-identifier hs-var hs-var">ext_hint</span></a></span></span><span> </span><span id="local-6989586621683078269"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683078269"><span class="hs-identifier hs-var">dflags</span></a></span></span><span>
</span><span id="line-4087"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isTypeLikeKind"><span class="hs-identifier hs-var">isTypeLikeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078239"><span class="hs-identifier hs-var">kind</span></a></span><span>
</span><span id="line-4088"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683078248"><span class="hs-identifier hs-var">is_newtype</span></a></span><span>
</span><span id="line-4089"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Extension -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#xopt"><span class="hs-identifier hs-var">xopt</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.UnliftedNewtypes</span></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683078269"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4090"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SuggestUnliftedTypes -&gt; Maybe SuggestUnliftedTypes
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">SuggestUnliftedTypes
</span><a href="GHC.Tc.Errors.Types.html#SuggestUnliftedNewtypes"><span class="hs-identifier hs-var">SuggestUnliftedNewtypes</span></a></span><span>
</span><span id="line-4091"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#tcIsBoxedTypeKind"><span class="hs-identifier hs-var">tcIsBoxedTypeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078239"><span class="hs-identifier hs-var">kind</span></a></span><span>
</span><span id="line-4092"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683078255"><span class="hs-identifier hs-var">is_datatype</span></a></span><span>
</span><span id="line-4093"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Extension -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#xopt"><span class="hs-identifier hs-var">xopt</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.UnliftedDatatypes</span></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683078269"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4094"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SuggestUnliftedTypes -&gt; Maybe SuggestUnliftedTypes
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">SuggestUnliftedTypes
</span><a href="GHC.Tc.Errors.Types.html#SuggestUnliftedDatatypes"><span class="hs-identifier hs-var">SuggestUnliftedDatatypes</span></a></span><span>
</span><span id="line-4095"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-4096"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe SuggestUnliftedTypes
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-4097"></span><span>
</span><span id="line-4098"></span><span class="hs-comment">-- | Checks that the result kind of a class is exactly `Constraint`, rejecting</span><span>
</span><span id="line-4099"></span><span class="hs-comment">-- type synonyms and type families that reduce to `Constraint`. See #16826.</span><span>
</span><span id="line-4100"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#checkClassKindSig"><span class="hs-identifier hs-type">checkClassKindSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-4101"></span><span id="checkClassKindSig"><span class="annot"><span class="annottext">checkClassKindSig :: Type -&gt; TcM ()
</span><a href="GHC.Tc.Gen.HsType.html#checkClassKindSig"><span class="hs-identifier hs-var hs-var">checkClassKindSig</span></a></span></span><span> </span><span id="local-6989586621683078272"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078272"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRnMessage -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isConstraintKind"><span class="hs-identifier hs-var">isConstraintKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078272"><span class="hs-identifier hs-var">kind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcRnMessage
</span><a href="#local-6989586621683078273"><span class="hs-identifier hs-var">err_msg</span></a></span><span>
</span><span id="line-4102"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-4103"></span><span>    </span><span class="annot"><a href="#local-6989586621683078273"><span class="hs-identifier hs-type">err_msg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span>
</span><span id="line-4104"></span><span>    </span><span id="local-6989586621683078273"><span class="annot"><span class="annottext">err_msg :: TcRnMessage
</span><a href="#local-6989586621683078273"><span class="hs-identifier hs-var hs-var">err_msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnClassKindNotConstraint"><span class="hs-identifier hs-var">TcRnClassKindNotConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078272"><span class="hs-identifier hs-var">kind</span></a></span><span>
</span><span id="line-4105"></span><span>
</span><span id="line-4106"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcbVisibilities"><span class="hs-identifier hs-type">tcbVisibilities</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCon.html#TyConBndrVis"><span class="hs-identifier hs-type">TyConBndrVis</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-4107"></span><span class="hs-comment">-- Result is in 1-1 correspondence with orig_args</span><span>
</span><span id="line-4108"></span><span id="tcbVisibilities"><span class="annot"><span class="annottext">tcbVisibilities :: TyCon -&gt; [Type] -&gt; [TyConBndrVis]
</span><a href="GHC.Tc.Gen.HsType.html#tcbVisibilities"><span class="hs-identifier hs-var hs-var">tcbVisibilities</span></a></span></span><span> </span><span id="local-6989586621683078275"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683078275"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621683078276"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683078276"><span class="hs-identifier hs-var">orig_args</span></a></span></span><span>
</span><span id="line-4109"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Subst -&gt; [Type] -&gt; [TyConBndrVis]
</span><a href="#local-6989586621683078277"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="GHC.Core.TyCon.html#tyConKind"><span class="hs-identifier hs-var">tyConKind</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683078275"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683078278"><span class="hs-identifier hs-var">init_subst</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683078276"><span class="hs-identifier hs-var">orig_args</span></a></span><span>
</span><span id="line-4110"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-4111"></span><span>    </span><span id="local-6989586621683078278"><span class="annot"><span class="annottext">init_subst :: Subst
</span><a href="#local-6989586621683078278"><span class="hs-identifier hs-var hs-var">init_subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#mkEmptySubst"><span class="hs-identifier hs-var">mkEmptySubst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVarSet -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type] -&gt; TyVarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683078276"><span class="hs-identifier hs-var">orig_args</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4112"></span><span>    </span><span id="local-6989586621683078277"><span class="annot"><span class="annottext">go :: Type -&gt; Subst -&gt; [Type] -&gt; [TyConBndrVis]
</span><a href="#local-6989586621683078277"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Subst
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-4113"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-4114"></span><span>
</span><span id="line-4115"></span><span>    </span><span class="annot"><a href="#local-6989586621683078277"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621683078280"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078280"><span class="hs-identifier hs-var">fun_kind</span></a></span></span><span> </span><span id="local-6989586621683078281"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683078281"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621683078282"><span class="annot"><span class="annottext">all_args :: [Type]
</span><a href="#local-6989586621683078282"><span class="hs-identifier hs-var">all_args</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621683078283"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078283"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621683078284"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683078284"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-4116"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683078285"><span class="annot"><span class="annottext">PiTyVarBinder
</span><a href="#local-6989586621683078285"><span class="hs-identifier hs-var">tcb</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683078286"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078286"><span class="hs-identifier hs-var">inner_kind</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (PiTyVarBinder, Type)
</span><a href="GHC.Core.Type.html#splitPiTy_maybe"><span class="hs-identifier hs-var">splitPiTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078280"><span class="hs-identifier hs-var">fun_kind</span></a></span><span>
</span><span id="line-4117"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PiTyVarBinder
</span><a href="#local-6989586621683078285"><span class="hs-identifier hs-var">tcb</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-4118"></span><span>          </span><span class="annot"><a href="GHC.Types.Var.html#Anon"><span class="hs-identifier hs-type">Anon</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683078287"><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621683078287"><span class="hs-identifier hs-var">af</span></a></span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; [TyConBndrVis] -&gt; [TyConBndrVis]
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621683078287"><span class="hs-identifier hs-var">af</span></a></span><span> </span><span class="annot"><span class="annottext">FunTyFlag -&gt; FunTyFlag -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="GHC.Types.Var.html#FTF_T_T"><span class="hs-identifier hs-var">FTF_T_T</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([TyConBndrVis] -&gt; [TyConBndrVis])
-&gt; [TyConBndrVis] -&gt; [TyConBndrVis]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-4119"></span><span>                                 </span><span class="annot"><span class="annottext">TyConBndrVis
</span><a href="GHC.Core.TyCon.html#AnonTCB"><span class="hs-identifier hs-var">AnonTCB</span></a></span><span>      </span><span class="annot"><span class="annottext">TyConBndrVis -&gt; [TyConBndrVis] -&gt; [TyConBndrVis]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Subst -&gt; [Type] -&gt; [TyConBndrVis]
</span><a href="#local-6989586621683078277"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078286"><span class="hs-identifier hs-var">inner_kind</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683078281"><span class="hs-identifier hs-var">subst</span></a></span><span>  </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683078284"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-4120"></span><span>          </span><span class="annot"><a href="GHC.Types.Var.html#Named"><span class="hs-identifier hs-type">Named</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span id="local-6989586621683078288"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683078288"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621683078289"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621683078289"><span class="hs-identifier hs-var">vis</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag -&gt; TyConBndrVis
</span><a href="GHC.Core.TyCon.html#NamedTCB"><span class="hs-identifier hs-var">NamedTCB</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621683078289"><span class="hs-identifier hs-var">vis</span></a></span><span> </span><span class="annot"><span class="annottext">TyConBndrVis -&gt; [TyConBndrVis] -&gt; [TyConBndrVis]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Subst -&gt; [Type] -&gt; [TyConBndrVis]
</span><a href="#local-6989586621683078277"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078286"><span class="hs-identifier hs-var">inner_kind</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683078290"><span class="hs-identifier hs-var">subst'</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683078284"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-4121"></span><span>                 </span><span class="hs-keyword">where</span><span>
</span><span id="line-4122"></span><span>                    </span><span id="local-6989586621683078290"><span class="annot"><span class="annottext">subst' :: Subst
</span><a href="#local-6989586621683078290"><span class="hs-identifier hs-var hs-var">subst'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; TcTyVar -&gt; Type -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#extendTCvSubst"><span class="hs-identifier hs-var">extendTCvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683078281"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683078288"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078283"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-4123"></span><span>
</span><span id="line-4124"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst -&gt; Bool
</span><a href="GHC.Core.TyCo.Subst.html#isEmptyTCvSubst"><span class="hs-identifier hs-var">isEmptyTCvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683078281"><span class="hs-identifier hs-var">subst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4125"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Subst -&gt; [Type] -&gt; [TyConBndrVis]
</span><a href="#local-6989586621683078277"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683078281"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078280"><span class="hs-identifier hs-var">fun_kind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621683078278"><span class="hs-identifier hs-var">init_subst</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683078282"><span class="hs-identifier hs-var">all_args</span></a></span><span>
</span><span id="line-4126"></span><span>
</span><span id="line-4127"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-4128"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; [TyConBndrVis]
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;addTcbVisibilities&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683078275"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621683078276"><span class="hs-identifier hs-var">orig_args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4129"></span><span>
</span><span id="line-4130"></span><span>
</span><span id="line-4131"></span><span class="hs-comment">{- Note [splitTyConKind]
~~~~~~~~~~~~~~~~~~~~~~~~
Given
  data T (a::*) :: * -&gt; forall k. k -&gt; *
we want to generate the extra TyConBinders for T, so we finally get
  (a::*) (b::*) (k::*) (c::k)
The function splitTyConKind generates these extra TyConBinders from
the result kind signature.  The same function is also used by
kcCheckDeclHeader_sig to get the [TyConBinder] from the Kind of
the TyCon given in a standalone kind signature.  E.g.
  type T :: forall (a::*). * -&gt; forall k. k -&gt; *

We need to take care to give the TyConBinders
  (a) Uniques that are fresh: the TyConBinders of a TyCon
      must have distinct uniques.

  (b) Preferably, OccNames that are fresh. If we happen to re-use
      OccNames that are other TyConBinders, we'll get a TyCon with
      TyConBinders like [a_72, a_53]; same OccName, different Uniques.
      Then when pretty-printing (e.g. in GHCi :info) we'll see
          data T a a0
      whereas we'd prefer
          data T a b
      (NB: the tidying happens in the conversion to Iface syntax,
      which happens as part of pretty-printing a TyThing.)

      Using fresh OccNames is not essential; it's cosmetic.
      And also see Note [Avoid name clashes for associated data types].

For (a) perhaps surprisingly, duplicated uniques can happen, even if
we use fresh uniques for Anon arrows.  Consider
   data T :: forall k. k -&gt; forall k. k -&gt; *
where the two k's are identical even up to their uniques.  Surprisingly,
this can happen: see #14515, #19092,3,4.  Then if we use those k's in
as TyConBinders we'll get duplicated uniques.

For (b) we'd like to avoid OccName clashes with the tyvars declared by
the user before the &quot;::&quot;; in the above example that is 'a'.

It's reasonably easy to solve all this; just run down the list with a
substitution; hence the recursive 'go' function.  But for the Uniques
it has to be done.

Note [Avoid name clashes for associated data types]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider    class C a b where
               data D b :: * -&gt; *
When typechecking the decl for D, we'll invent an extra type variable
for D, to fill out its kind.  Ideally we don't want this type variable
to be 'a', because when pretty printing we'll get
            class C a b where
               data D b a0
(NB: the tidying happens in the conversion to Iface syntax, which happens
as part of pretty-printing a TyThing.)

That's why we look in the LocalRdrEnv to see what's in scope. This is
important only to get nice-looking output when doing &quot;:info C&quot; in GHCi.
It isn't essential for correctness.


************************************************************************
*                                                                      *
             Partial signatures
*                                                                      *
************************************************************************

-}</span><span>
</span><span id="line-4198"></span><span>
</span><span id="line-4199"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsPartialSigType"><span class="hs-identifier hs-type">tcHsPartialSigType</span></a></span><span>
</span><span id="line-4200"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a></span><span>
</span><span id="line-4201"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsSigWcType"><span class="hs-identifier hs-type">LHsSigWcType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>       </span><span class="hs-comment">-- The type signature</span><span>
</span><span id="line-4202"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- Wildcards</span><span>
</span><span id="line-4203"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>       </span><span class="hs-comment">-- Extra-constraints wildcard</span><span>
</span><span id="line-4204"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Types.Var.html#InvisTVBinder"><span class="hs-identifier hs-type">InvisTVBinder</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- Original tyvar names, in correspondence with</span><span>
</span><span id="line-4205"></span><span>                              </span><span class="hs-comment">--   the implicitly and explicitly bound type variables</span><span>
</span><span id="line-4206"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a></span><span>        </span><span class="hs-comment">-- Theta part</span><span>
</span><span id="line-4207"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-special">)</span><span>           </span><span class="hs-comment">-- Tau part</span><span>
</span><span id="line-4208"></span><span class="hs-comment">-- See Note [Checking partial type signatures]</span><span>
</span><span id="line-4209"></span><span id="tcHsPartialSigType"><span class="annot"><span class="annottext">tcHsPartialSigType :: UserTypeCtxt
-&gt; LHsSigWcType GhcRn
-&gt; TcM
     ([(Name, TcTyVar)], Maybe Type,
      [(Name, VarBndr TcTyVar Specificity)], [Type], Type)
</span><a href="GHC.Tc.Gen.HsType.html#tcHsPartialSigType"><span class="hs-identifier hs-var hs-var">tcHsPartialSigType</span></a></span></span><span> </span><span id="local-6989586621683078293"><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621683078293"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683078294"><span class="annot"><span class="annottext">LHsSigWcType GhcRn
</span><a href="#local-6989586621683078294"><span class="hs-identifier hs-var">sig_ty</span></a></span></span><span>
</span><span id="line-4210"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsWC"><span class="hs-identifier hs-type">HsWC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hswc_ext :: forall pass thing. HsWildCardBndrs pass thing -&gt; XHsWC pass thing
</span><a href="Language.Haskell.Syntax.Type.html#hswc_ext"><span class="hs-identifier hs-var">hswc_ext</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683078295"><span class="annot"><span class="annottext">XHsWC GhcRn (LHsSigType GhcRn)
</span><a href="#local-6989586621683078295"><span class="hs-identifier hs-var">sig_wcs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hswc_body :: forall pass thing. HsWildCardBndrs pass thing -&gt; thing
</span><a href="Language.Haskell.Syntax.Type.html#hswc_body"><span class="hs-identifier hs-var">hswc_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683078296"><span class="annot"><span class="annottext">LHsSigType GhcRn
</span><a href="#local-6989586621683078296"><span class="hs-identifier hs-var">sig_ty</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsSigWcType GhcRn
</span><a href="#local-6989586621683078294"><span class="hs-identifier hs-var">sig_ty</span></a></span><span>
</span><span id="line-4211"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsSig"><span class="hs-identifier hs-type">HsSig</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">sig_bndrs :: forall pass. HsSigType pass -&gt; HsOuterSigTyVarBndrs pass
</span><a href="Language.Haskell.Syntax.Type.html#sig_bndrs"><span class="hs-identifier hs-var">sig_bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683078297"><span class="annot"><span class="annottext">HsOuterSigTyVarBndrs GhcRn
</span><a href="#local-6989586621683078297"><span class="hs-identifier hs-var">hs_outer_bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sig_body :: forall pass. HsSigType pass -&gt; LHsType pass
</span><a href="Language.Haskell.Syntax.Type.html#sig_body"><span class="hs-identifier hs-var">sig_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683078298"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683078298"><span class="hs-identifier hs-var">body_ty</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsSigType GhcRn
</span><a href="#local-6989586621683078296"><span class="hs-identifier hs-var">sig_ty</span></a></span><span>
</span><span id="line-4212"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683078299"><span class="annot"><span class="annottext">Maybe (LHsContext GhcRn)
</span><a href="#local-6989586621683078299"><span class="hs-identifier hs-var">hs_ctxt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683078300"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683078300"><span class="hs-identifier hs-var">hs_tau</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; (Maybe (LHsContext GhcRn), LHsType GhcRn)
forall (pass :: Pass).
LHsType (GhcPass pass)
-&gt; (Maybe (LHsContext (GhcPass pass)), LHsType (GhcPass pass))
</span><a href="GHC.Hs.Type.html#splitLHsQualTy"><span class="hs-identifier hs-var">splitLHsQualTy</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683078298"><span class="hs-identifier hs-var">body_ty</span></a></span><span>
</span><span id="line-4213"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
-&gt; GenLocated SrcSpanAnnA (HsSigType GhcRn)
-&gt; TcM
     ([(Name, TcTyVar)], Maybe Type,
      [(Name, VarBndr TcTyVar Specificity)], [Type], Type)
-&gt; TcM
     ([(Name, TcTyVar)], Maybe Type,
      [(Name, VarBndr TcTyVar Specificity)], [Type], Type)
forall hs_ty a.
Outputable hs_ty =&gt;
UserTypeCtxt -&gt; LocatedA hs_ty -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.HsType.html#addSigCtxt"><span class="hs-identifier hs-var">addSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621683078293"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsSigType GhcRn
GenLocated SrcSpanAnnA (HsSigType GhcRn)
</span><a href="#local-6989586621683078296"><span class="hs-identifier hs-var">sig_ty</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM
   ([(Name, TcTyVar)], Maybe Type,
    [(Name, VarBndr TcTyVar Specificity)], [Type], Type)
 -&gt; TcM
      ([(Name, TcTyVar)], Maybe Type,
       [(Name, VarBndr TcTyVar Specificity)], [Type], Type))
-&gt; TcM
     ([(Name, TcTyVar)], Maybe Type,
      [(Name, VarBndr TcTyVar Specificity)], [Type], Type)
-&gt; TcM
     ([(Name, TcTyVar)], Maybe Type,
      [(Name, VarBndr TcTyVar Specificity)], [Type], Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-4214"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683078302"><span class="annot"><a href="#local-6989586621683078302"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeOrKind -&gt; HoleMode -&gt; TcM TcTyMode
</span><a href="GHC.Tc.Gen.HsType.html#mkHoleMode"><span class="hs-identifier hs-var">mkHoleMode</span></a></span><span> </span><span class="annot"><span class="annottext">TypeOrKind
</span><a href="GHC.Types.Basic.html#TypeLevel"><span class="hs-identifier hs-var">TypeLevel</span></a></span><span> </span><span class="annot"><span class="annottext">HoleMode
</span><a href="GHC.Tc.Gen.HsType.html#HM_Sig"><span class="hs-identifier hs-var">HM_Sig</span></a></span><span>
</span><span id="line-4215"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683078303"><span class="annot"><a href="#local-6989586621683078303"><span class="hs-identifier hs-var">outer_bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683078304"><span class="annot"><a href="#local-6989586621683078304"><span class="hs-identifier hs-var">wcs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683078305"><span class="annot"><a href="#local-6989586621683078305"><span class="hs-identifier hs-var">wcx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683078306"><span class="annot"><a href="#local-6989586621683078306"><span class="hs-identifier hs-var">theta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683078307"><span class="annot"><a href="#local-6989586621683078307"><span class="hs-identifier hs-var">tau</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4216"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.html#solveEqualities"><span class="hs-identifier hs-type">solveEqualities</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcHsPartialSigType&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-4217"></span><span>               </span><span class="hs-comment">-- See Note [Failure in local type signatures]</span><span>
</span><span id="line-4218"></span><span>               </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindNamedWildCardBinders"><span class="hs-identifier hs-type">bindNamedWildCardBinders</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078295"><span class="hs-identifier hs-type">sig_wcs</span></a></span><span>             </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683078308"><span class="annot"><span class="annottext">[(Name, TcTyVar)]
</span><a href="#local-6989586621683078308"><span class="hs-identifier hs-var">wcs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4219"></span><span>               </span><span class="annot"><span class="annottext">TcTyMode
-&gt; HsOuterSigTyVarBndrs GhcRn
-&gt; TcM ([(Name, TcTyVar)], Maybe Type, [Type], Type)
-&gt; TcM
     (HsOuterTyVarBndrs Specificity GhcTc,
      ([(Name, TcTyVar)], Maybe Type, [Type], Type))
forall a.
TcTyMode
-&gt; HsOuterSigTyVarBndrs GhcRn
-&gt; TcM a
-&gt; TcM (HsOuterTyVarBndrs Specificity GhcTc, a)
</span><a href="GHC.Tc.Gen.HsType.html#bindOuterSigTKBndrs_Tv_M"><span class="hs-identifier hs-var">bindOuterSigTKBndrs_Tv_M</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683078302"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">HsOuterSigTyVarBndrs GhcRn
</span><a href="#local-6989586621683078297"><span class="hs-identifier hs-var">hs_outer_bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM ([(Name, TcTyVar)], Maybe Type, [Type], Type)
 -&gt; TcM
      (HsOuterTyVarBndrs Specificity GhcTc,
       ([(Name, TcTyVar)], Maybe Type, [Type], Type)))
-&gt; TcM ([(Name, TcTyVar)], Maybe Type, [Type], Type)
-&gt; TcM
     (HsOuterTyVarBndrs Specificity GhcTc,
      ([(Name, TcTyVar)], Maybe Type, [Type], Type))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-4220"></span><span>               </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>   </span><span class="hs-comment">-- Instantiate the type-class context; but if there</span><span>
</span><span id="line-4221"></span><span>                      </span><span class="hs-comment">-- is an extra-constraints wildcard, just discard it here</span><span>
</span><span id="line-4222"></span><span>                    </span><span class="hs-special">(</span><span id="local-6989586621683078309"><span class="annot"><a href="#local-6989586621683078309"><span class="hs-identifier hs-var">theta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683078310"><span class="annot"><a href="#local-6989586621683078310"><span class="hs-identifier hs-var">wcx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcTyMode -&gt; Maybe (LHsContext GhcRn) -&gt; TcM ([Type], Maybe Type)
</span><a href="GHC.Tc.Gen.HsType.html#tcPartialContext"><span class="hs-identifier hs-var">tcPartialContext</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683078302"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (LHsContext GhcRn)
</span><a href="#local-6989586621683078299"><span class="hs-identifier hs-var">hs_ctxt</span></a></span><span>
</span><span id="line-4223"></span><span>
</span><span id="line-4224"></span><span>                  </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683078312"><span class="annot"><a href="#local-6989586621683078312"><span class="hs-identifier hs-var">ek</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newOpenTypeKind"><span class="hs-identifier hs-type">newOpenTypeKind</span></a></span><span>
</span><span id="line-4225"></span><span>                  </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683078313"><span class="annot"><a href="#local-6989586621683078313"><span class="hs-identifier hs-var">tau</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-comment">-- Don't do (addTypeCtxt hs_tau) here else we get</span><span>
</span><span id="line-4226"></span><span>                           </span><span class="hs-comment">--   In the type &lt;blah&gt;</span><span>
</span><span id="line-4227"></span><span>                           </span><span class="hs-comment">--   In the type signature: foo :: &lt;blah&gt;</span><span>
</span><span id="line-4228"></span><span>                           </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tc_check_lhs_type"><span class="hs-identifier hs-type">tc_check_lhs_type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078302"><span class="hs-identifier hs-type">mode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078300"><span class="hs-identifier hs-type">hs_tau</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078312"><span class="hs-identifier hs-type">ek</span></a></span><span>
</span><span id="line-4229"></span><span>
</span><span id="line-4230"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683078308"><span class="hs-identifier hs-type">wcs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683078310"><span class="hs-identifier hs-type">wcx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683078309"><span class="hs-identifier hs-type">theta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683078313"><span class="hs-identifier hs-type">tau</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4231"></span><span>
</span><span id="line-4232"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcHsPartialSigType 2&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-type">empty</span></a></span><span>
</span><span id="line-4233"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683078315"><span class="annot"><a href="#local-6989586621683078315"><span class="hs-identifier hs-var">outer_bndrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#scopedSortOuter"><span class="hs-identifier hs-type">scopedSortOuter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078303"><span class="hs-identifier hs-type">outer_bndrs</span></a></span><span>
</span><span id="line-4234"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683078316"><span class="annot"><a href="#local-6989586621683078316"><span class="hs-identifier hs-var hs-var">outer_tv_bndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsOuterTyVarBndrs Specificity GhcTc
-&gt; [VarBndr TcTyVar Specificity]
</span><a href="GHC.Tc.Gen.HsType.html#outerTyVarBndrs"><span class="hs-identifier hs-var">outerTyVarBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">HsOuterTyVarBndrs Specificity GhcTc
</span><a href="#local-6989586621683078315"><span class="hs-identifier hs-var">outer_bndrs</span></a></span><span>
</span><span id="line-4235"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcHsPartialSigType 3&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-type">empty</span></a></span><span>
</span><span id="line-4236"></span><span>
</span><span id="line-4237"></span><span>         </span><span class="hs-comment">-- No kind-generalization here:</span><span>
</span><span id="line-4238"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#kindGeneralizeNone"><span class="hs-identifier hs-type">kindGeneralizeNone</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#mkInvisForAllTys"><span class="hs-identifier hs-type">mkInvisForAllTys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078316"><span class="hs-identifier hs-type">outer_tv_bndrs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-4239"></span><span>                             </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#tcMkPhiTy"><span class="hs-identifier hs-type">tcMkPhiTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078306"><span class="hs-identifier hs-type">theta</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-4240"></span><span>                             </span><span class="annot"><a href="#local-6989586621683078307"><span class="hs-identifier hs-type">tau</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4241"></span><span>
</span><span id="line-4242"></span><span>       </span><span class="hs-comment">-- Spit out the wildcards (including the extra-constraints one)</span><span>
</span><span id="line-4243"></span><span>       </span><span class="hs-comment">-- as &quot;hole&quot; constraints, so that they'll be reported if necessary</span><span>
</span><span id="line-4244"></span><span>       </span><span class="hs-comment">-- See Note [Extra-constraint holes in partial type signatures]</span><span>
</span><span id="line-4245"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitNamedTypeHole"><span class="hs-identifier hs-type">emitNamedTypeHole</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078304"><span class="hs-identifier hs-type">wcs</span></a></span><span>
</span><span id="line-4246"></span><span>
</span><span id="line-4247"></span><span>         </span><span class="hs-comment">-- The &quot;tau&quot; from tcHsPartialSigType might very well have some foralls</span><span>
</span><span id="line-4248"></span><span>         </span><span class="hs-comment">-- at the top, hidden behind a type synonym. Instantiate them! E.g.</span><span>
</span><span id="line-4249"></span><span>         </span><span class="hs-comment">--    type T x = forall b. x -&gt; b -&gt; b</span><span>
</span><span id="line-4250"></span><span>         </span><span class="hs-comment">--    f :: forall a. T (a,_)</span><span>
</span><span id="line-4251"></span><span>         </span><span class="hs-comment">-- We must instantiate the `forall b` just as we do the `forall a`!</span><span>
</span><span id="line-4252"></span><span>         </span><span class="hs-comment">-- Missing this led to #21667.</span><span>
</span><span id="line-4253"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683078318"><span class="annot"><a href="#local-6989586621683078318"><span class="hs-identifier hs-var">tv_prs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683078319"><span class="annot"><a href="#local-6989586621683078319"><span class="hs-identifier hs-var">theta'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683078320"><span class="annot"><a href="#local-6989586621683078320"><span class="hs-identifier hs-var">tau</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcInstTypeBndrs"><span class="hs-identifier hs-type">tcInstTypeBndrs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078307"><span class="hs-identifier hs-type">tau</span></a></span><span>
</span><span id="line-4254"></span><span>
</span><span id="line-4255"></span><span>         </span><span class="hs-comment">-- We return a proper (Name,InvisTVBinder) environment, to be sure that</span><span>
</span><span id="line-4256"></span><span>         </span><span class="hs-comment">-- we bring the right name into scope in the function body.</span><span>
</span><span id="line-4257"></span><span>         </span><span class="hs-comment">-- Test case: partial-sigs/should_compile/LocalDefinitionBug</span><span>
</span><span id="line-4258"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621683078321"><span class="hs-identifier hs-type">outer_bndr_names</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-4259"></span><span>             </span><span id="local-6989586621683078321"><span class="annot"><a href="#local-6989586621683078321"><span class="hs-identifier hs-var hs-var">outer_bndr_names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsOuterSigTyVarBndrs GhcRn -&gt; HsQTvsRn
forall flag. HsOuterTyVarBndrs flag GhcRn -&gt; HsQTvsRn
</span><a href="GHC.Hs.Type.html#hsOuterTyVarNames"><span class="hs-identifier hs-var">hsOuterTyVarNames</span></a></span><span> </span><span class="annot"><span class="annottext">HsOuterSigTyVarBndrs GhcRn
</span><a href="#local-6989586621683078297"><span class="hs-identifier hs-var">hs_outer_bndrs</span></a></span><span>
</span><span id="line-4260"></span><span>             </span><span class="annot"><a href="#local-6989586621683078323"><span class="hs-identifier hs-type">tv_prs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Types.Var.html#InvisTVBinder"><span class="hs-identifier hs-type">InvisTVBinder</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-4261"></span><span>             </span><span id="local-6989586621683078323"><span class="annot"><a href="#local-6989586621683078323"><span class="hs-identifier hs-var hs-var">tv_prs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsQTvsRn
</span><a href="#local-6989586621683078321"><span class="hs-identifier hs-var">outer_bndr_names</span></a></span><span> </span><span class="annot"><span class="annottext">HsQTvsRn
-&gt; [VarBndr TcTyVar Specificity]
-&gt; [(Name, VarBndr TcTyVar Specificity)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-operator hs-var">`zip`</span></span><span> </span><span class="annot"><span class="annottext">[VarBndr TcTyVar Specificity]
</span><a href="#local-6989586621683078316"><span class="hs-identifier hs-var">outer_tv_bndrs</span></a></span><span>
</span><span id="line-4262"></span><span>
</span><span id="line-4263"></span><span>       </span><span class="hs-comment">-- Zonk, so that any nested foralls can &quot;see&quot; their occurrences</span><span>
</span><span id="line-4264"></span><span>       </span><span class="hs-comment">-- See Note [Checking partial type signatures], and in particular</span><span>
</span><span id="line-4265"></span><span>       </span><span class="hs-comment">-- Note [Levels for wildcards]</span><span>
</span><span id="line-4266"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683078324"><span class="annot"><a href="#local-6989586621683078324"><span class="hs-identifier hs-var">tv_prs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683078325"><span class="annot"><a href="#local-6989586621683078325"><span class="hs-identifier hs-var">theta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683078326"><span class="annot"><a href="#local-6989586621683078326"><span class="hs-identifier hs-var">tau</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-type">liftZonkM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-4267"></span><span>         </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683078327"><span class="annot"><a href="#local-6989586621683078327"><span class="hs-identifier hs-var">tv_prs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#mapSndM"><span class="hs-identifier hs-type">mapSndM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkInvisTVBinder"><span class="hs-identifier hs-type">zonkInvisTVBinder</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683078323"><span class="hs-identifier hs-type">tv_prs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621683078318"><span class="hs-identifier hs-type">tv_prs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4268"></span><span>            </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683078330"><span class="annot"><a href="#local-6989586621683078330"><span class="hs-identifier hs-var">theta</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span>    </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-type">zonkTcType</span></a></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683078306"><span class="hs-identifier hs-type">theta</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621683078319"><span class="hs-identifier hs-type">theta'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4269"></span><span>            </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683078331"><span class="annot"><a href="#local-6989586621683078331"><span class="hs-identifier hs-var">tau</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-type">zonkTcType</span></a></span><span>                </span><span class="annot"><a href="#local-6989586621683078320"><span class="hs-identifier hs-type">tau</span></a></span><span>
</span><span id="line-4270"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683078327"><span class="hs-identifier hs-type">tv_prs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683078330"><span class="hs-identifier hs-type">theta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683078331"><span class="hs-identifier hs-type">tau</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4271"></span><span>
</span><span id="line-4272"></span><span>      </span><span class="hs-comment">-- NB: checkValidType on the final inferred type will be</span><span>
</span><span id="line-4273"></span><span>      </span><span class="hs-comment">--     done later by checkInferredPolyId.  We can't do it</span><span>
</span><span id="line-4274"></span><span>      </span><span class="hs-comment">--     here because we don't have a complete type to check</span><span>
</span><span id="line-4275"></span><span>
</span><span id="line-4276"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcHsPartialSigType&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078324"><span class="hs-identifier hs-type">tv_prs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4277"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683078304"><span class="hs-identifier hs-type">wcs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683078305"><span class="hs-identifier hs-type">wcx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683078324"><span class="hs-identifier hs-type">tv_prs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683078325"><span class="hs-identifier hs-type">theta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683078326"><span class="hs-identifier hs-type">tau</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4278"></span><span>
</span><span id="line-4279"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcPartialContext"><span class="hs-identifier hs-type">tcPartialContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsContext"><span class="hs-identifier hs-type">LHsContext</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4280"></span><span id="tcPartialContext"><span class="annot"><span class="annottext">tcPartialContext :: TcTyMode -&gt; Maybe (LHsContext GhcRn) -&gt; TcM ([Type], Maybe Type)
</span><a href="GHC.Tc.Gen.HsType.html#tcPartialContext"><span class="hs-identifier hs-var hs-var">tcPartialContext</span></a></span></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe (LHsContext GhcRn)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Type], Maybe Type) -&gt; TcM ([Type], Maybe Type)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Type
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-4281"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcPartialContext"><span class="hs-identifier hs-var">tcPartialContext</span></a></span><span> </span><span id="local-6989586621683078332"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683078332"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnC
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683078333"><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsType GhcRn)]
</span><a href="#local-6989586621683078333"><span class="hs-identifier hs-var">hs_theta</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4282"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683078334"><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsType GhcRn)]
</span><a href="#local-6989586621683078334"><span class="hs-identifier hs-var">hs_theta1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683078335"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621683078335"><span class="hs-identifier hs-var">hs_ctxt_last</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsType GhcRn)]
-&gt; Maybe
     ([GenLocated SrcSpanAnnA (HsType GhcRn)],
      GenLocated SrcSpanAnnA (HsType GhcRn))
forall a. [a] -&gt; Maybe ([a], a)
</span><a href="GHC.Utils.Misc.html#snocView"><span class="hs-identifier hs-var">snocView</span></a></span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsType GhcRn)]
</span><a href="#local-6989586621683078333"><span class="hs-identifier hs-var">hs_theta</span></a></span><span>
</span><span id="line-4283"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683078337"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683078337"><span class="hs-identifier hs-var">wc_loc</span></a></span></span><span> </span><span id="local-6989586621683078338"><span class="annot"><span class="annottext">ty :: HsType GhcRn
</span><a href="#local-6989586621683078338"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsWildCardTy"><span class="hs-identifier hs-type">HsWildCardTy</span></a></span><span> </span><span class="annot"><span class="annottext">XWildCardTy GhcRn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; LHsType GhcRn
forall (p :: Pass). LHsType (GhcPass p) -&gt; LHsType (GhcPass p)
</span><a href="GHC.Hs.Type.html#ignoreParens"><span class="hs-identifier hs-var">ignoreParens</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621683078335"><span class="hs-identifier hs-var">hs_ctxt_last</span></a></span><span>
</span><span id="line-4284"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683078340"><span class="annot"><a href="#local-6989586621683078340"><span class="hs-identifier hs-var">wc_tv_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; TcM Type -&gt; TcM Type
forall ann a. EpAnn ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683078337"><span class="hs-identifier hs-var">wc_loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM Type -&gt; TcM Type) -&gt; TcM Type -&gt; TcM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-4285"></span><span>                     </span><span class="annot"><span class="annottext">IsExtraConstraint -&gt; TcTyMode -&gt; HsType GhcRn -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcAnonWildCardOcc"><span class="hs-identifier hs-var">tcAnonWildCardOcc</span></a></span><span> </span><span class="annot"><span class="annottext">IsExtraConstraint
</span><a href="GHC.Tc.Utils.Monad.html#YesExtraConstraint"><span class="hs-identifier hs-var">YesExtraConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683078332"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683078338"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#constraintKind"><span class="hs-identifier hs-var">constraintKind</span></a></span><span>
</span><span id="line-4286"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683078341"><span class="annot"><a href="#local-6989586621683078341"><span class="hs-identifier hs-var">theta</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tc_lhs_pred"><span class="hs-identifier hs-type">tc_lhs_pred</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078332"><span class="hs-identifier hs-type">mode</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683078334"><span class="hs-identifier hs-type">hs_theta1</span></a></span><span>
</span><span id="line-4287"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683078341"><span class="hs-identifier hs-type">theta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621683078340"><span class="hs-identifier hs-type">wc_tv_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4288"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-4289"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683078342"><span class="annot"><a href="#local-6989586621683078342"><span class="hs-identifier hs-var">theta</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsType GhcRn) -&gt; TcM Type)
-&gt; [GenLocated SrcSpanAnnA (HsType GhcRn)] -&gt; TcM [Type]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyMode -&gt; LHsType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_lhs_pred"><span class="hs-identifier hs-var">tc_lhs_pred</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683078332"><span class="hs-identifier hs-var">mode</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsType GhcRn)]
</span><a href="#local-6989586621683078333"><span class="hs-identifier hs-var">hs_theta</span></a></span><span>
</span><span id="line-4290"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683078342"><span class="hs-identifier hs-type">theta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4291"></span><span>
</span><span id="line-4292"></span><span class="hs-comment">{- Note [Checking partial type signatures]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
This Note is about tcHsPartialSigType.  See also
Note [Recipe for checking a signature]

When we have a partial signature like
   f :: forall a. a -&gt; _
we do the following

* tcHsPartialSigType does not make quantified type (forall a. blah)
  and then instantiate it -- it makes no sense to instantiate a type
  with wildcards in it.  Rather, tcHsPartialSigType just returns the
  'a' and the 'blah' separately.

  Nor, for the same reason, do we push a level in tcHsPartialSigType.

* We instantiate 'a' to a unification variable, a TyVarTv, and /not/
  a skolem; hence the &quot;_Tv&quot; in bindExplicitTKBndrs_Tv.  Consider
    f :: forall a. a -&gt; _
    g :: forall b. _ -&gt; b
    f = g
    g = f
  They are typechecked as a recursive group, with monomorphic types,
  so 'a' and 'b' will get unified together.  Very like kind inference
  for mutually recursive data types (sans CUSKs or SAKS); see
  Note [Cloning for type variable binders]

* In GHC.Tc.Gen.Sig.tcUserSigType we return a PartialSig, which (unlike
  the companion CompleteSig) contains the original, as-yet-unchecked
  source-code LHsSigWcType

* Then, for f and g /separately/, we call tcInstSig, which in turn
  call tcHsPartialSig (defined near this Note).  It kind-checks the
  LHsSigWcType, creating fresh unification variables for each &quot;_&quot;
  wildcard.  It's important that the wildcards for f and g are distinct
  because they might get instantiated completely differently.  E.g.
     f,g :: forall a. a -&gt; _
     f x = a
     g x = True
  It's really as if we'd written two distinct signatures.

* Nested foralls. See Note [Levels for wildcards]

* Just as for ordinary signatures, we must solve local equalities and
  zonk the type after kind-checking it, to ensure that all the nested
  forall binders can &quot;see&quot; their occurrences

  Just as for ordinary signatures, this zonk also gets any Refl casts
  out of the way of instantiation.  Example: #18008 had
       foo :: (forall a. (Show a =&gt; blah) |&gt; Refl) -&gt; _
  and that Refl cast messed things up.  See #18062.

Note [Levels for wildcards]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider
     f :: forall b. (forall a. a -&gt; _) -&gt; b
We do /not/ allow the &quot;_&quot; to be instantiated to 'a'; although we do
(as before) allow it to be instantiated to the (top level) 'b'.
Why not?  Suppose
   f x = (x True, x 'c')

During typecking the RHS we must instantiate that (forall a. a -&gt; _),
so we must know /precisely/ where all the a's are; they must not be
hidden under (possibly-not-yet-filled-in) unification variables!

We achieve this as follows:

- For /named/ wildcards such sas
     g :: forall b. (forall la. a -&gt; _x) -&gt; b
  there is no problem: we create them at the outer level (ie the
  ambient level of the signature itself), and push the level when we
  go inside a forall.  So now the unification variable for the &quot;_x&quot;
  can't unify with skolem 'a'.

- For /anonymous/ wildcards, such as 'f' above, we carry the ambient
  level of the signature to the hole in the TcLevel part of the
  mode_holes field of TcTyMode.  Then, in tcAnonWildCardOcc we us that
  level (and /not/ the level ambient at the occurrence of &quot;_&quot;) to
  create the unification variable for the wildcard.  That is the sole
  purpose of the TcLevel in the mode_holes field: to transport the
  ambient level of the signature down to the anonymous wildcard
  occurrences.

Note [Extra-constraint holes in partial type signatures]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider
  f :: (_) =&gt; a -&gt; a
  f x = ...

* The renamer leaves '_' untouched.

* Then, in tcHsPartialSigType, we make a new hole TcTyVar, in
  tcWildCardBinders.

* GHC.Tc.Gen.Bind.chooseInferredQuantifiers fills in that hole TcTyVar
  with the inferred constraints, e.g. (Eq a, Show a)

* GHC.Tc.Errors.mkHoleError finally reports the error.

An annoying difficulty happens if there are more than 64 inferred
constraints. Then we need to fill in the TcTyVar with (say) a 70-tuple.
Where do we find the TyCon?  For good reasons we only have constraint
tuples up to 62 (see Note [How tuples work] in GHC.Builtin.Types).  So how
can we make a 70-tuple?  This was the root cause of #14217.

It's incredibly tiresome, because we only need this type to fill
in the hole, to communicate to the error reporting machinery.  Nothing
more.  So I use a HACK:

* I make an /ordinary/ tuple of the constraints, in
  GHC.Tc.Gen.Bind.chooseInferredQuantifiers. This is ill-kinded because
  ordinary tuples can't contain constraints, but it works fine. And for
  ordinary tuples we don't have the same limit as for constraint
  tuples (which need selectors and an associated class).

* Because it is ill-kinded (unifying something of kind Constraint with
  something of kind Type), it should trip an assert in writeMetaTyVarRef.

Result works fine, but it may eventually bite us.

See also Note [Do not simplify ConstraintHoles] in GHC.Tc.Solver for
information about how these are printed.

************************************************************************
*                                                                      *
      Pattern signatures (i.e signatures that occur in patterns)
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-4420"></span><span>
</span><span id="line-4421"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsPatSigType"><span class="hs-identifier hs-type">tcHsPatSigType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a></span><span>
</span><span id="line-4422"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#HoleMode"><span class="hs-identifier hs-type">HoleMode</span></a></span><span> </span><span class="hs-comment">-- HM_Sig when in a SigPat, HM_TyAppPat when in a ConPat checking type applications.</span><span>
</span><span id="line-4423"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsPatSigType"><span class="hs-identifier hs-type">HsPatSigType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>          </span><span class="hs-comment">-- The type signature</span><span>
</span><span id="line-4424"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#ContextKind"><span class="hs-identifier hs-type">ContextKind</span></a></span><span>                </span><span class="hs-comment">-- What kind is expected</span><span>
</span><span id="line-4425"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- Wildcards</span><span>
</span><span id="line-4426"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- The new bit of type environment, binding</span><span>
</span><span id="line-4427"></span><span>                                              </span><span class="hs-comment">-- the scoped type variables</span><span>
</span><span id="line-4428"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- The type</span><span>
</span><span id="line-4429"></span><span class="hs-comment">-- Used for type-checking type signatures in</span><span>
</span><span id="line-4430"></span><span class="hs-comment">-- (a) patterns           e.g  f (x::Int) = e</span><span>
</span><span id="line-4431"></span><span class="hs-comment">-- (b) RULE forall bndrs  e.g. forall (x::Int). f x = x</span><span>
</span><span id="line-4432"></span><span class="hs-comment">-- See Note [Pattern signature binders and scoping] in GHC.Hs.Type</span><span>
</span><span id="line-4433"></span><span class="hs-comment">--</span><span>
</span><span id="line-4434"></span><span class="hs-comment">-- This may emit constraints</span><span>
</span><span id="line-4435"></span><span class="hs-comment">-- See Note [Recipe for checking a signature]</span><span>
</span><span id="line-4436"></span><span id="tcHsPatSigType"><span class="annot"><span class="annottext">tcHsPatSigType :: UserTypeCtxt
-&gt; HoleMode
-&gt; HsPatSigType GhcRn
-&gt; ContextKind
-&gt; TcM ([(Name, TcTyVar)], [(Name, TcTyVar)], Type)
</span><a href="GHC.Tc.Gen.HsType.html#tcHsPatSigType"><span class="hs-identifier hs-var hs-var">tcHsPatSigType</span></a></span></span><span> </span><span id="local-6989586621683078343"><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621683078343"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683078344"><span class="annot"><span class="annottext">HoleMode
</span><a href="#local-6989586621683078344"><span class="hs-identifier hs-var">hole_mode</span></a></span></span><span>
</span><span id="line-4437"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsPS"><span class="hs-identifier hs-type">HsPS</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsps_ext :: forall pass. HsPatSigType pass -&gt; XHsPS pass
</span><a href="Language.Haskell.Syntax.Type.html#hsps_ext"><span class="hs-identifier hs-var">hsps_ext</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Type.html#HsPSRn"><span class="hs-identifier hs-type">HsPSRn</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsps_nwcs :: HsPSRn -&gt; HsQTvsRn
</span><a href="GHC.Hs.Type.html#hsps_nwcs"><span class="hs-identifier hs-var">hsps_nwcs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683078349"><span class="annot"><span class="annottext">HsQTvsRn
</span><a href="#local-6989586621683078349"><span class="hs-identifier hs-var">sig_wcs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hsps_imp_tvs :: HsPSRn -&gt; HsQTvsRn
</span><a href="GHC.Hs.Type.html#hsps_imp_tvs"><span class="hs-identifier hs-var">hsps_imp_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683078351"><span class="annot"><span class="annottext">HsQTvsRn
</span><a href="#local-6989586621683078351"><span class="hs-identifier hs-var">sig_ns</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4438"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hsps_body :: forall pass. HsPatSigType pass -&gt; LHsType pass
</span><a href="Language.Haskell.Syntax.Type.html#hsps_body"><span class="hs-identifier hs-var">hsps_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683078353"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683078353"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-4439"></span><span>  </span><span id="local-6989586621683078354"><span class="annot"><span class="annottext">ContextKind
</span><a href="#local-6989586621683078354"><span class="hs-identifier hs-var">ctxt_kind</span></a></span></span><span>
</span><span id="line-4440"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
-&gt; HoleMode
-&gt; LHsType GhcRn
-&gt; HsQTvsRn
-&gt; HsQTvsRn
-&gt; ContextKind
-&gt; TcM ([(Name, TcTyVar)], [(Name, TcTyVar)], Type)
</span><a href="GHC.Tc.Gen.HsType.html#tc_type_in_pat"><span class="hs-identifier hs-var">tc_type_in_pat</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621683078343"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">HoleMode
</span><a href="#local-6989586621683078344"><span class="hs-identifier hs-var">hole_mode</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683078353"><span class="hs-identifier hs-var">hs_ty</span></a></span><span> </span><span class="annot"><span class="annottext">HsQTvsRn
</span><a href="#local-6989586621683078349"><span class="hs-identifier hs-var">sig_wcs</span></a></span><span> </span><span class="annot"><span class="annottext">HsQTvsRn
</span><a href="#local-6989586621683078351"><span class="hs-identifier hs-var">sig_ns</span></a></span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="#local-6989586621683078354"><span class="hs-identifier hs-var">ctxt_kind</span></a></span><span>
</span><span id="line-4441"></span><span>
</span><span id="line-4442"></span><span>
</span><span id="line-4443"></span><span class="hs-comment">-- Typecheck type patterns, in data constructor patterns, e.g</span><span>
</span><span id="line-4444"></span><span class="hs-comment">--    f (MkT @a @(Maybe b) ...) = ...</span><span>
</span><span id="line-4445"></span><span class="hs-comment">--</span><span>
</span><span id="line-4446"></span><span class="hs-comment">-- We have two completely separate typing rules,</span><span>
</span><span id="line-4447"></span><span class="hs-comment">--   one for binder type patterns  (handled by `tc_bndr_in_pat`)</span><span>
</span><span id="line-4448"></span><span class="hs-comment">--   one for unifier type patterns (handled by `tc_type_in_pat`)</span><span>
</span><span id="line-4449"></span><span class="hs-comment">-- The two cases are distinguished by `tyPatToBndr`.</span><span>
</span><span id="line-4450"></span><span class="hs-comment">-- See Note [Type patterns: binders and unifiers]</span><span>
</span><span id="line-4451"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcHsTyPat"><span class="hs-identifier hs-type">tcHsTyPat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTyPat"><span class="hs-identifier hs-type">HsTyPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>               </span><span class="hs-comment">-- The type pattern</span><span>
</span><span id="line-4452"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span>                        </span><span class="hs-comment">-- What kind is expected</span><span>
</span><span id="line-4453"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- Wildcards</span><span>
</span><span id="line-4454"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- The new bit of type environment, binding</span><span>
</span><span id="line-4455"></span><span>                                         </span><span class="hs-comment">-- the scoped type variables</span><span>
</span><span id="line-4456"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span>               </span><span class="hs-comment">-- The type</span><span>
</span><span id="line-4457"></span><span id="tcHsTyPat"><span class="annot"><span class="annottext">tcHsTyPat :: HsTyPat GhcRn
-&gt; Type -&gt; TcM ([(Name, TcTyVar)], [(Name, TcTyVar)], Type)
</span><a href="GHC.Tc.Gen.HsType.html#tcHsTyPat"><span class="hs-identifier hs-var hs-var">tcHsTyPat</span></a></span></span><span> </span><span id="local-6989586621683078356"><span class="annot"><span class="annottext">hs_pat :: HsTyPat GhcRn
</span><a href="#local-6989586621683078356"><span class="hs-identifier hs-var">hs_pat</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTP"><span class="hs-identifier hs-type">HsTP</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">hstp_ext :: forall pass. HsTyPat pass -&gt; XHsTP pass
</span><a href="Language.Haskell.Syntax.Type.html#hstp_ext"><span class="hs-identifier hs-var">hstp_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683078359"><span class="annot"><span class="annottext">XHsTP GhcRn
</span><a href="#local-6989586621683078359"><span class="hs-identifier hs-var">hstp_rn</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hstp_body :: forall pass. HsTyPat pass -&gt; LHsType pass
</span><a href="Language.Haskell.Syntax.Type.html#hstp_body"><span class="hs-identifier hs-var">hstp_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683078361"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683078361"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683078362"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078362"><span class="hs-identifier hs-var">expected_kind</span></a></span></span><span>
</span><span id="line-4458"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsTyPat GhcRn -&gt; Maybe (HsTyVarBndr () GhcRn)
</span><a href="GHC.Tc.Gen.HsType.html#tyPatToBndr"><span class="hs-identifier hs-var">tyPatToBndr</span></a></span><span> </span><span class="annot"><span class="annottext">HsTyPat GhcRn
</span><a href="#local-6989586621683078356"><span class="hs-identifier hs-var">hs_pat</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-4459"></span><span>    </span><span class="annot"><span class="annottext">Maybe (HsTyVarBndr () GhcRn)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcRn)
-&gt; HsQTvsRn
-&gt; HsQTvsRn
-&gt; ContextKind
-&gt; TcM ([(Name, TcTyVar)], [(Name, TcTyVar)], Type)
</span><a href="#local-6989586621683078364"><span class="hs-identifier hs-var">tc_unif_in_pat</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621683078361"><span class="hs-identifier hs-var">hs_ty</span></a></span><span> </span><span class="annot"><span class="annottext">HsQTvsRn
</span><a href="#local-6989586621683078365"><span class="hs-identifier hs-var">wcs</span></a></span><span> </span><span class="annot"><span class="annottext">HsQTvsRn
</span><a href="#local-6989586621683078366"><span class="hs-identifier hs-var">all_ns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#TheKind"><span class="hs-identifier hs-var">TheKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078362"><span class="hs-identifier hs-var">expected_kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4460"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683078367"><span class="annot"><span class="annottext">HsTyVarBndr () GhcRn
</span><a href="#local-6989586621683078367"><span class="hs-identifier hs-var">bndr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HsTyVarBndr () GhcRn
-&gt; HsQTvsRn
-&gt; HsQTvsRn
-&gt; Type
-&gt; TcM ([(Name, TcTyVar)], [(Name, TcTyVar)], Type)
forall flag.
HsTyVarBndr flag GhcRn
-&gt; HsQTvsRn
-&gt; HsQTvsRn
-&gt; Type
-&gt; TcM ([(Name, TcTyVar)], [(Name, TcTyVar)], Type)
</span><a href="GHC.Tc.Gen.HsType.html#tc_bndr_in_pat"><span class="hs-identifier hs-var">tc_bndr_in_pat</span></a></span><span> </span><span class="annot"><span class="annottext">HsTyVarBndr () GhcRn
</span><a href="#local-6989586621683078367"><span class="hs-identifier hs-var">bndr</span></a></span><span>  </span><span class="annot"><span class="annottext">HsQTvsRn
</span><a href="#local-6989586621683078365"><span class="hs-identifier hs-var">wcs</span></a></span><span> </span><span class="annot"><span class="annottext">HsQTvsRn
</span><a href="#local-6989586621683078369"><span class="hs-identifier hs-var">imp_ns</span></a></span><span>  </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078362"><span class="hs-identifier hs-var">expected_kind</span></a></span><span>
</span><span id="line-4461"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-4462"></span><span>    </span><span id="local-6989586621683078366"><span class="annot"><span class="annottext">all_ns :: HsQTvsRn
</span><a href="#local-6989586621683078366"><span class="hs-identifier hs-var hs-var">all_ns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsQTvsRn
</span><a href="#local-6989586621683078369"><span class="hs-identifier hs-var">imp_ns</span></a></span><span> </span><span class="annot"><span class="annottext">HsQTvsRn -&gt; HsQTvsRn -&gt; HsQTvsRn
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">HsQTvsRn
</span><a href="#local-6989586621683078370"><span class="hs-identifier hs-var">exp_ns</span></a></span><span>
</span><span id="line-4463"></span><span>    </span><span class="annot"><a href="GHC.Hs.Type.html#HsTPRn"><span class="hs-identifier hs-type">HsTPRn</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">hstp_nwcs :: HsTyPatRn -&gt; HsQTvsRn
</span><a href="GHC.Hs.Type.html#hstp_nwcs"><span class="hs-identifier hs-var">hstp_nwcs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683078365"><span class="annot"><span class="annottext">HsQTvsRn
</span><a href="#local-6989586621683078365"><span class="hs-identifier hs-var">wcs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hstp_imp_tvs :: HsTyPatRn -&gt; HsQTvsRn
</span><a href="GHC.Hs.Type.html#hstp_imp_tvs"><span class="hs-identifier hs-var">hstp_imp_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683078369"><span class="annot"><span class="annottext">HsQTvsRn
</span><a href="#local-6989586621683078369"><span class="hs-identifier hs-var">imp_ns</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hstp_exp_tvs :: HsTyPatRn -&gt; HsQTvsRn
</span><a href="GHC.Hs.Type.html#hstp_exp_tvs"><span class="hs-identifier hs-var">hstp_exp_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683078370"><span class="annot"><span class="annottext">HsQTvsRn
</span><a href="#local-6989586621683078370"><span class="hs-identifier hs-var">exp_ns</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XHsTP GhcRn
</span><a href="#local-6989586621683078359"><span class="hs-identifier hs-var">hstp_rn</span></a></span><span>
</span><span id="line-4464"></span><span>    </span><span id="local-6989586621683078364"><span class="annot"><span class="annottext">tc_unif_in_pat :: LHsType GhcRn
-&gt; HsQTvsRn
-&gt; HsQTvsRn
-&gt; ContextKind
-&gt; TcM ([(Name, TcTyVar)], [(Name, TcTyVar)], Type)
</span><a href="#local-6989586621683078364"><span class="hs-identifier hs-var hs-var">tc_unif_in_pat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
-&gt; HoleMode
-&gt; LHsType GhcRn
-&gt; HsQTvsRn
-&gt; HsQTvsRn
-&gt; ContextKind
-&gt; TcM ([(Name, TcTyVar)], [(Name, TcTyVar)], Type)
</span><a href="GHC.Tc.Gen.HsType.html#tc_type_in_pat"><span class="hs-identifier hs-var">tc_type_in_pat</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#TypeAppCtxt"><span class="hs-identifier hs-var">TypeAppCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">HoleMode
</span><a href="GHC.Tc.Gen.HsType.html#HM_TyAppPat"><span class="hs-identifier hs-var">HM_TyAppPat</span></a></span><span>
</span><span id="line-4465"></span><span>
</span><span id="line-4466"></span><span class="hs-comment">-- `tc_bndr_in_pat` is used in type patterns to handle the binders case.</span><span>
</span><span id="line-4467"></span><span class="hs-comment">-- See Note [Type patterns: binders and unifiers]</span><span>
</span><span id="line-4468"></span><span id="local-6989586621683075517"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tc_bndr_in_pat"><span class="hs-identifier hs-type">tc_bndr_in_pat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTyVarBndr"><span class="hs-identifier hs-type">HsTyVarBndr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075517"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-4469"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- All named wildcards in type</span><span>
</span><span id="line-4470"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- Implicit (but not explicit) binders in type</span><span>
</span><span id="line-4471"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span>    </span><span class="hs-comment">-- Expected kind</span><span>
</span><span id="line-4472"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- Wildcards</span><span>
</span><span id="line-4473"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- The new bit of type environment, binding</span><span>
</span><span id="line-4474"></span><span>                                              </span><span class="hs-comment">-- the scoped type variables</span><span>
</span><span id="line-4475"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span></span><span>               </span><span class="hs-comment">-- The type</span><span>
</span><span id="line-4476"></span><span id="tc_bndr_in_pat"><span class="annot"><span class="annottext">tc_bndr_in_pat :: forall flag.
HsTyVarBndr flag GhcRn
-&gt; HsQTvsRn
-&gt; HsQTvsRn
-&gt; Type
-&gt; TcM ([(Name, TcTyVar)], [(Name, TcTyVar)], Type)
</span><a href="GHC.Tc.Gen.HsType.html#tc_bndr_in_pat"><span class="hs-identifier hs-var hs-var">tc_bndr_in_pat</span></a></span></span><span> </span><span id="local-6989586621683078404"><span class="annot"><span class="annottext">HsTyVarBndr flag GhcRn
</span><a href="#local-6989586621683078404"><span class="hs-identifier hs-var">bndr</span></a></span></span><span> </span><span id="local-6989586621683078405"><span class="annot"><span class="annottext">HsQTvsRn
</span><a href="#local-6989586621683078405"><span class="hs-identifier hs-var">wcs</span></a></span></span><span> </span><span id="local-6989586621683078406"><span class="annot"><span class="annottext">HsQTvsRn
</span><a href="#local-6989586621683078406"><span class="hs-identifier hs-var">imp_ns</span></a></span></span><span> </span><span id="local-6989586621683078407"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078407"><span class="hs-identifier hs-var">expected_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-4477"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTvb"><span class="hs-identifier hs-type">HsTvb</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tvb_var :: forall flag pass. HsTyVarBndr flag pass -&gt; HsBndrVar pass
</span><a href="Language.Haskell.Syntax.Type.html#tvb_var"><span class="hs-identifier hs-var">tvb_var</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683078408"><span class="annot"><span class="annottext">HsBndrVar GhcRn
</span><a href="#local-6989586621683078408"><span class="hs-identifier hs-var hs-var">bvar</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tvb_kind :: forall flag pass. HsTyVarBndr flag pass -&gt; HsBndrKind pass
</span><a href="Language.Haskell.Syntax.Type.html#tvb_kind"><span class="hs-identifier hs-var">tvb_kind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683078409"><span class="annot"><span class="annottext">HsBndrKind GhcRn
</span><a href="#local-6989586621683078409"><span class="hs-identifier hs-var hs-var">bkind</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsTyVarBndr flag GhcRn
</span><a href="#local-6989586621683078404"><span class="hs-identifier hs-var">bndr</span></a></span><span>
</span><span id="line-4478"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc_bndr_in_pat 1&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078407"><span class="hs-identifier hs-var">expected_kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4479"></span><span>  </span><span id="local-6989586621683078410"><span class="annot"><a href="#local-6989586621683078410"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsBndrVar GhcRn -&gt; TcM Name
</span><a href="GHC.Tc.Gen.HsType.html#tcHsBndrVarName"><span class="hs-identifier hs-var">tcHsBndrVarName</span></a></span><span> </span><span class="annot"><span class="annottext">HsBndrVar GhcRn
</span><a href="#local-6989586621683078408"><span class="hs-identifier hs-var">bvar</span></a></span><span>
</span><span id="line-4480"></span><span>  </span><span id="local-6989586621683078411"><span class="annot"><a href="#local-6989586621683078411"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newPatTyVar"><span class="hs-identifier hs-type">newPatTyVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078410"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078407"><span class="hs-identifier hs-type">expected_kind</span></a></span><span>
</span><span id="line-4481"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683078409"><span class="hs-identifier hs-type">bkind</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-4482"></span><span>    </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsBndrNoKind"><span class="hs-identifier hs-type">HsBndrNoKind</span></a></span><span> </span><span class="annot"><span class="annottext">XBndrNoKind GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4483"></span><span>      </span><span class="annot"><span class="annottext">([(Name, TcTyVar)], [(Name, TcTyVar)], Type)
-&gt; TcM ([(Name, TcTyVar)], [(Name, TcTyVar)], Type)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsTyVarBndr flag GhcRn -&gt; TcTyVar -&gt; [(Name, TcTyVar)]
forall flag. HsTyVarBndr flag GhcRn -&gt; TcTyVar -&gt; [(Name, TcTyVar)]
</span><a href="GHC.Tc.Gen.HsType.html#mk_tvb_pairs"><span class="hs-identifier hs-var">mk_tvb_pairs</span></a></span><span> </span><span class="annot"><span class="annottext">HsTyVarBndr flag GhcRn
</span><a href="#local-6989586621683078404"><span class="hs-identifier hs-var">bndr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683078411"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683078411"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4484"></span><span>    </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsBndrKind"><span class="hs-identifier hs-type">HsBndrKind</span></a></span><span> </span><span class="annot"><span class="annottext">XBndrKind GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683078413"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683078413"><span class="hs-identifier hs-var">ki</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-4485"></span><span>      </span><span id="local-6989586621683078414"><span class="annot"><a href="#local-6989586621683078414"><span class="hs-identifier hs-var">tkv_prs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Name, TcTyVar))
-&gt; HsQTvsRn -&gt; IOEnv (Env TcGblEnv TcLclEnv) [(Name, TcTyVar)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Name, TcTyVar)
</span><a href="#local-6989586621683078415"><span class="hs-identifier hs-var">new_implicit_tv</span></a></span><span> </span><span class="annot"><span class="annottext">HsQTvsRn
</span><a href="#local-6989586621683078406"><span class="hs-identifier hs-var">imp_ns</span></a></span><span>
</span><span id="line-4486"></span><span>      </span><span id="local-6989586621683078416"><span class="annot"><a href="#local-6989586621683078416"><span class="hs-identifier hs-var">wcs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#addTypeCtxt"><span class="hs-identifier hs-type">addTypeCtxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078413"><span class="hs-identifier hs-type">ki</span></a></span><span>              </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-4487"></span><span>             </span><span class="annot"><a href="GHC.Tc.Solver.html#solveEqualities"><span class="hs-identifier hs-type">solveEqualities</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc_bndr_in_pat&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-4488"></span><span>               </span><span class="hs-comment">-- See Note [Failure in local type signatures]</span><span>
</span><span id="line-4489"></span><span>               </span><span class="hs-comment">-- and c.f #16033</span><span>
</span><span id="line-4490"></span><span>             </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindNamedWildCardBinders"><span class="hs-identifier hs-type">bindNamedWildCardBinders</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078405"><span class="hs-identifier hs-type">wcs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683078417"><span class="annot"><span class="annottext">[(Name, TcTyVar)]
</span><a href="#local-6989586621683078417"><span class="hs-identifier hs-var">wcs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4491"></span><span>             </span><span class="annot"><span class="annottext">[(Name, TcTyVar)]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [(Name, TcTyVar)]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [(Name, TcTyVar)]
forall r. [(Name, TcTyVar)] -&gt; TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Env.html#tcExtendNameTyVarEnv"><span class="hs-identifier hs-var">tcExtendNameTyVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, TcTyVar)]
</span><a href="#local-6989586621683078414"><span class="hs-identifier hs-var">tkv_prs</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) [(Name, TcTyVar)]
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) [(Name, TcTyVar)])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [(Name, TcTyVar)]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [(Name, TcTyVar)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-4492"></span><span>             </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">HsBndrVar GhcRn -&gt; LHsType GhcRn -&gt; Type -&gt; TcM ()
</span><a href="GHC.Tc.Gen.HsType.html#tcHsTvbKind"><span class="hs-identifier hs-var">tcHsTvbKind</span></a></span><span> </span><span class="annot"><span class="annottext">HsBndrVar GhcRn
</span><a href="#local-6989586621683078408"><span class="hs-identifier hs-var">bvar</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683078413"><span class="hs-identifier hs-var">ki</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078407"><span class="hs-identifier hs-var">expected_kind</span></a></span><span>
</span><span id="line-4493"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[(Name, TcTyVar)]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [(Name, TcTyVar)]
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">[(Name, TcTyVar)]
</span><a href="#local-6989586621683078417"><span class="hs-identifier hs-var">wcs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4494"></span><span>
</span><span id="line-4495"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitNamedTypeHole"><span class="hs-identifier hs-type">emitNamedTypeHole</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078416"><span class="hs-identifier hs-type">wcs</span></a></span><span>
</span><span id="line-4496"></span><span>
</span><span id="line-4497"></span><span>      </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc_bndr_in_pat 2&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-4498"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;expected_kind&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078407"><span class="hs-identifier hs-type">expected_kind</span></a></span><span>
</span><span id="line-4499"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;wcs&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078416"><span class="hs-identifier hs-type">wcs</span></a></span><span>
</span><span id="line-4500"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;(name,tv)&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683078410"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621683078411"><span class="hs-identifier hs-type">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4501"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tkv_prs&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078414"><span class="hs-identifier hs-type">tkv_prs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-4502"></span><span>
</span><span id="line-4503"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683078418"><span class="annot"><a href="#local-6989586621683078418"><span class="hs-identifier hs-var hs-var">tvb_prs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsTyVarBndr flag GhcRn -&gt; TcTyVar -&gt; [(Name, TcTyVar)]
forall flag. HsTyVarBndr flag GhcRn -&gt; TcTyVar -&gt; [(Name, TcTyVar)]
</span><a href="GHC.Tc.Gen.HsType.html#mk_tvb_pairs"><span class="hs-identifier hs-var">mk_tvb_pairs</span></a></span><span> </span><span class="annot"><span class="annottext">HsTyVarBndr flag GhcRn
</span><a href="#local-6989586621683078404"><span class="hs-identifier hs-var">bndr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621683078411"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-4504"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683078416"><span class="hs-identifier hs-type">wcs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683078418"><span class="hs-identifier hs-type">tvb_prs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621683078414"><span class="hs-identifier hs-type">tkv_prs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-type">mkTyVarTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078411"><span class="hs-identifier hs-type">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4505"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-4506"></span><span>    </span><span id="local-6989586621683078415"><span class="annot"><span class="annottext">new_implicit_tv :: Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Name, TcTyVar)
</span><a href="#local-6989586621683078415"><span class="hs-identifier hs-var hs-var">new_implicit_tv</span></a></span></span><span> </span><span id="local-6989586621683078422"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683078422"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-4507"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683078423"><span class="annot"><a href="#local-6989586621683078423"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM Type
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaKindVar"><span class="hs-identifier hs-var">newMetaKindVar</span></a></span><span>
</span><span id="line-4508"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683078424"><span class="annot"><a href="#local-6989586621683078424"><span class="hs-identifier hs-var">tv</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newPatTyVar"><span class="hs-identifier hs-type">newPatTyVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078422"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078423"><span class="hs-identifier hs-type">kind</span></a></span><span>
</span><span id="line-4509"></span><span>             </span><span class="hs-comment">-- NB: tv's Name is fresh</span><span>
</span><span id="line-4510"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683078422"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683078424"><span class="hs-identifier hs-type">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4511"></span><span>
</span><span id="line-4512"></span><span class="annot"><span class="hs-comment">-- * In type patterns `tc_type_in_pat` is used to handle the unifiers case.</span></span><span>
</span><span id="line-4513"></span><span class="hs-comment">--   See Note [Type patterns: binders and unifiers]</span><span>
</span><span id="line-4514"></span><span class="hs-comment">--</span><span>
</span><span id="line-4515"></span><span class="annot"><span class="hs-comment">-- * In patterns `tc_type_in_pat` is used to check pattern signatures.</span></span><span>
</span><span id="line-4516"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tc_type_in_pat"><span class="hs-identifier hs-type">tc_type_in_pat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a></span><span>
</span><span id="line-4517"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#HoleMode"><span class="hs-identifier hs-type">HoleMode</span></a></span><span> </span><span class="hs-comment">-- HM_Sig when in a SigPat, HM_TyAppPat when in a ConPat checking type applications.</span><span>
</span><span id="line-4518"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>          </span><span class="hs-comment">-- The type in pattern</span><span>
</span><span id="line-4519"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span>                 </span><span class="hs-comment">-- All named wildcards in type</span><span>
</span><span id="line-4520"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span>                 </span><span class="hs-comment">-- All binders in type</span><span>
</span><span id="line-4521"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#ContextKind"><span class="hs-identifier hs-type">ContextKind</span></a></span><span>                </span><span class="hs-comment">-- What kind is expected</span><span>
</span><span id="line-4522"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- Wildcards</span><span>
</span><span id="line-4523"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- The new bit of type environment, binding</span><span>
</span><span id="line-4524"></span><span>                                              </span><span class="hs-comment">-- the scoped type variables</span><span>
</span><span id="line-4525"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- The type</span><span>
</span><span id="line-4526"></span><span id="tc_type_in_pat"><span class="annot"><span class="annottext">tc_type_in_pat :: UserTypeCtxt
-&gt; HoleMode
-&gt; LHsType GhcRn
-&gt; HsQTvsRn
-&gt; HsQTvsRn
-&gt; ContextKind
-&gt; TcM ([(Name, TcTyVar)], [(Name, TcTyVar)], Type)
</span><a href="GHC.Tc.Gen.HsType.html#tc_type_in_pat"><span class="hs-identifier hs-var hs-var">tc_type_in_pat</span></a></span></span><span> </span><span id="local-6989586621683078425"><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621683078425"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683078426"><span class="annot"><span class="annottext">HoleMode
</span><a href="#local-6989586621683078426"><span class="hs-identifier hs-var">hole_mode</span></a></span></span><span> </span><span id="local-6989586621683078427"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683078427"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span> </span><span id="local-6989586621683078428"><span class="annot"><span class="annottext">HsQTvsRn
</span><a href="#local-6989586621683078428"><span class="hs-identifier hs-var">wcs</span></a></span></span><span> </span><span id="local-6989586621683078429"><span class="annot"><span class="annottext">HsQTvsRn
</span><a href="#local-6989586621683078429"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span id="local-6989586621683078430"><span class="annot"><span class="annottext">ContextKind
</span><a href="#local-6989586621683078430"><span class="hs-identifier hs-var">ctxt_kind</span></a></span></span><span>
</span><span id="line-4527"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
-&gt; GenLocated SrcSpanAnnA (HsType GhcRn)
-&gt; TcM ([(Name, TcTyVar)], [(Name, TcTyVar)], Type)
-&gt; TcM ([(Name, TcTyVar)], [(Name, TcTyVar)], Type)
forall hs_ty a.
Outputable hs_ty =&gt;
UserTypeCtxt -&gt; LocatedA hs_ty -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.HsType.html#addSigCtxt"><span class="hs-identifier hs-var">addSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621683078425"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621683078427"><span class="hs-identifier hs-var">hs_ty</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM ([(Name, TcTyVar)], [(Name, TcTyVar)], Type)
 -&gt; TcM ([(Name, TcTyVar)], [(Name, TcTyVar)], Type))
-&gt; TcM ([(Name, TcTyVar)], [(Name, TcTyVar)], Type)
-&gt; TcM ([(Name, TcTyVar)], [(Name, TcTyVar)], Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-4528"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683078431"><span class="annot"><a href="#local-6989586621683078431"><span class="hs-identifier hs-var">tkv_prs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Name, TcTyVar))
-&gt; HsQTvsRn -&gt; IOEnv (Env TcGblEnv TcLclEnv) [(Name, TcTyVar)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Name, TcTyVar)
</span><a href="#local-6989586621683078432"><span class="hs-identifier hs-var">new_implicit_tv</span></a></span><span> </span><span class="annot"><span class="annottext">HsQTvsRn
</span><a href="#local-6989586621683078429"><span class="hs-identifier hs-var">ns</span></a></span><span>
</span><span id="line-4529"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683078433"><span class="annot"><a href="#local-6989586621683078433"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#mkHoleMode"><span class="hs-identifier hs-type">mkHoleMode</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TypeLevel"><span class="hs-identifier hs-type">TypeLevel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078426"><span class="hs-identifier hs-type">hole_mode</span></a></span><span>
</span><span id="line-4530"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683078434"><span class="annot"><a href="#local-6989586621683078434"><span class="hs-identifier hs-var">wcs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683078435"><span class="annot"><a href="#local-6989586621683078435"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-4531"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#addTypeCtxt"><span class="hs-identifier hs-type">addTypeCtxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078427"><span class="hs-identifier hs-type">hs_ty</span></a></span><span>                </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-4532"></span><span>               </span><span class="annot"><a href="GHC.Tc.Solver.html#solveEqualities"><span class="hs-identifier hs-type">solveEqualities</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc_type_in_pat&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-4533"></span><span>                 </span><span class="hs-comment">-- See Note [Failure in local type signatures]</span><span>
</span><span id="line-4534"></span><span>                 </span><span class="hs-comment">-- and c.f #16033</span><span>
</span><span id="line-4535"></span><span>               </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#bindNamedWildCardBinders"><span class="hs-identifier hs-type">bindNamedWildCardBinders</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078428"><span class="hs-identifier hs-type">wcs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683078436"><span class="annot"><span class="annottext">[(Name, TcTyVar)]
</span><a href="#local-6989586621683078436"><span class="hs-identifier hs-var">wcs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4536"></span><span>               </span><span class="annot"><span class="annottext">[(Name, TcTyVar)]
-&gt; TcM ([(Name, TcTyVar)], Type) -&gt; TcM ([(Name, TcTyVar)], Type)
forall r. [(Name, TcTyVar)] -&gt; TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Env.html#tcExtendNameTyVarEnv"><span class="hs-identifier hs-var">tcExtendNameTyVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, TcTyVar)]
</span><a href="#local-6989586621683078431"><span class="hs-identifier hs-var">tkv_prs</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM ([(Name, TcTyVar)], Type) -&gt; TcM ([(Name, TcTyVar)], Type))
-&gt; TcM ([(Name, TcTyVar)], Type) -&gt; TcM ([(Name, TcTyVar)], Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-4537"></span><span>               </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683078437"><span class="annot"><a href="#local-6989586621683078437"><span class="hs-identifier hs-var">ek</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ContextKind -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#newExpectedKind"><span class="hs-identifier hs-var">newExpectedKind</span></a></span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="#local-6989586621683078430"><span class="hs-identifier hs-var">ctxt_kind</span></a></span><span>
</span><span id="line-4538"></span><span>                  </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683078438"><span class="annot"><a href="#local-6989586621683078438"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tc_check_lhs_type"><span class="hs-identifier hs-type">tc_check_lhs_type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078433"><span class="hs-identifier hs-type">mode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078427"><span class="hs-identifier hs-type">hs_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078437"><span class="hs-identifier hs-type">ek</span></a></span><span>
</span><span id="line-4539"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683078436"><span class="hs-identifier hs-type">wcs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683078438"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4540"></span><span>
</span><span id="line-4541"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitNamedTypeHole"><span class="hs-identifier hs-type">emitNamedTypeHole</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078434"><span class="hs-identifier hs-type">wcs</span></a></span><span>
</span><span id="line-4542"></span><span>
</span><span id="line-4543"></span><span>          </span><span class="hs-comment">-- ty might have tyvars that are at a higher TcLevel (if hs_ty</span><span>
</span><span id="line-4544"></span><span>          </span><span class="hs-comment">-- contains a forall). Promote these.</span><span>
</span><span id="line-4545"></span><span>          </span><span class="hs-comment">-- Ex: f (x :: forall a. Proxy a -&gt; ()) = ... x ...</span><span>
</span><span id="line-4546"></span><span>          </span><span class="hs-comment">-- When we instantiate x, we have to compare the kind of the argument</span><span>
</span><span id="line-4547"></span><span>          </span><span class="hs-comment">-- to a's kind, which will be a metavariable.</span><span>
</span><span id="line-4548"></span><span>          </span><span class="hs-comment">-- kindGeneralizeNone does this:</span><span>
</span><span id="line-4549"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#kindGeneralizeNone"><span class="hs-identifier hs-type">kindGeneralizeNone</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078435"><span class="hs-identifier hs-type">ty</span></a></span><span>
</span><span id="line-4550"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683078439"><span class="annot"><a href="#local-6989586621683078439"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-type">liftZonkM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-type">zonkTcType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078435"><span class="hs-identifier hs-type">ty</span></a></span><span>
</span><span id="line-4551"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Validity.html#checkValidType"><span class="hs-identifier hs-type">checkValidType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078425"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078439"><span class="hs-identifier hs-type">ty</span></a></span><span>
</span><span id="line-4552"></span><span>
</span><span id="line-4553"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc_type_in_pat&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078431"><span class="hs-identifier hs-type">tkv_prs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4554"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683078434"><span class="hs-identifier hs-type">wcs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683078431"><span class="hs-identifier hs-type">tkv_prs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683078439"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4555"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-4556"></span><span>    </span><span id="local-6989586621683078432"><span class="annot"><span class="annottext">new_implicit_tv :: Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Name, TcTyVar)
</span><a href="#local-6989586621683078432"><span class="hs-identifier hs-var hs-var">new_implicit_tv</span></a></span></span><span> </span><span id="local-6989586621683078440"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683078440"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-4557"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683078441"><span class="annot"><a href="#local-6989586621683078441"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM Type
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaKindVar"><span class="hs-identifier hs-var">newMetaKindVar</span></a></span><span>
</span><span id="line-4558"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683078442"><span class="annot"><a href="#local-6989586621683078442"><span class="hs-identifier hs-var">tv</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683078425"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-4559"></span><span>                       </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#RuleSigCtxt"><span class="hs-identifier hs-type">RuleSigCtxt</span></a></span><span> </span><span id="local-6989586621683078444"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683078444"><span class="hs-identifier hs-var">rname</span></a></span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-4560"></span><span>                        </span><span id="local-6989586621683078445"><span class="annot"><a href="#local-6989586621683078445"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon -&gt; IOEnv (Env TcGblEnv TcLclEnv) SkolemInfo
forall (m :: * -&gt; *). MonadIO m =&gt; SkolemInfoAnon -&gt; m SkolemInfo
</span><a href="GHC.Tc.Types.Origin.html#mkSkolemInfo"><span class="hs-identifier hs-var">mkSkolemInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; SkolemInfoAnon
</span><a href="GHC.Tc.Types.Origin.html#RuleSkol"><span class="hs-identifier hs-var">RuleSkol</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683078444"><span class="hs-identifier hs-var">rname</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4561"></span><span>                        </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newSkolemTyVar"><span class="hs-identifier hs-type">newSkolemTyVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078445"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078440"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078441"><span class="hs-identifier hs-type">kind</span></a></span><span>
</span><span id="line-4562"></span><span>                       </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><span class="hs-identifier">_</span></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#newPatTyVar"><span class="hs-identifier hs-var">newPatTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683078440"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078441"><span class="hs-identifier hs-var">kind</span></a></span><span>
</span><span id="line-4563"></span><span>                       </span><span class="hs-comment">-- See Note [Typechecking pattern signature binders]</span><span>
</span><span id="line-4564"></span><span>             </span><span class="hs-comment">-- NB: tv's Name may be fresh (in the case of newPatTyVar)</span><span>
</span><span id="line-4565"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683078440"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683078442"><span class="hs-identifier hs-type">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4566"></span><span>
</span><span id="line-4567"></span><span class="hs-comment">-- See Note [Type patterns: binders and unifiers]</span><span>
</span><span id="line-4568"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tyPatToBndr"><span class="hs-identifier hs-type">tyPatToBndr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTyPat"><span class="hs-identifier hs-type">HsTyPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTyVarBndr"><span class="hs-identifier hs-type">HsTyVarBndr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4569"></span><span id="tyPatToBndr"><span class="annot"><span class="annottext">tyPatToBndr :: HsTyPat GhcRn -&gt; Maybe (HsTyVarBndr () GhcRn)
</span><a href="GHC.Tc.Gen.HsType.html#tyPatToBndr"><span class="hs-identifier hs-var hs-var">tyPatToBndr</span></a></span></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTP"><span class="hs-identifier hs-type">HsTP</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">hstp_body :: forall pass. HsTyPat pass -&gt; LHsType pass
</span><a href="Language.Haskell.Syntax.Type.html#hstp_body"><span class="hs-identifier hs-var">hstp_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683078448"><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683078448"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsType GhcRn -&gt; Maybe (HsTyVarBndr () GhcRn)
</span><a href="#local-6989586621683078449"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683078448"><span class="hs-identifier hs-var">hs_ty</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4570"></span><span>  </span><span class="annot"><a href="#local-6989586621683078449"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsType"><span class="hs-identifier hs-type">HsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTyVarBndr"><span class="hs-identifier hs-type">HsTyVarBndr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4571"></span><span>  </span><span id="local-6989586621683078449"><span class="annot"><span class="annottext">go :: HsType GhcRn -&gt; Maybe (HsTyVarBndr () GhcRn)
</span><a href="#local-6989586621683078449"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsParTy"><span class="hs-identifier hs-type">HsParTy</span></a></span><span> </span><span class="annot"><span class="annottext">XParTy GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683078450"><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683078450"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsType GhcRn -&gt; Maybe (HsTyVarBndr () GhcRn)
</span><a href="#local-6989586621683078449"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683078450"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-4572"></span><span>  </span><span class="annot"><a href="#local-6989586621683078449"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsKindSig"><span class="hs-identifier hs-type">HsKindSig</span></a></span><span> </span><span class="annot"><span class="annottext">XKindSig GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683078451"><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683078451"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683078452"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683078452"><span class="hs-identifier hs-var">ki</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-4573"></span><span>    </span><span id="local-6989586621683078453"><span class="annot"><a href="#local-6989586621683078453"><span class="hs-identifier hs-var">bvar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsType GhcRn -&gt; Maybe (HsBndrVar GhcRn)
</span><a href="#local-6989586621683078454"><span class="hs-identifier hs-var">go_bvar</span></a></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683078451"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-4574"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683078455"><span class="annot"><a href="#local-6989586621683078455"><span class="hs-identifier hs-var hs-var">bkind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XBndrKind GhcRn -&gt; LHsType GhcRn -&gt; HsBndrKind GhcRn
forall pass. XBndrKind pass -&gt; LHsKind pass -&gt; HsBndrKind pass
</span><a href="Language.Haskell.Syntax.Type.html#HsBndrKind"><span class="hs-identifier hs-var">HsBndrKind</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XBndrKind GhcRn
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683078452"><span class="hs-identifier hs-var">ki</span></a></span><span>
</span><span id="line-4575"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTvb"><span class="hs-identifier hs-type">HsTvb</span></a></span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-type">noAnn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683078453"><span class="hs-identifier hs-type">bvar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078455"><span class="hs-identifier hs-type">bkind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4576"></span><span>  </span><span class="annot"><a href="#local-6989586621683078449"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621683078456"><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683078456"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-4577"></span><span>    </span><span id="local-6989586621683078457"><span class="annot"><a href="#local-6989586621683078457"><span class="hs-identifier hs-var">bvar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsType GhcRn -&gt; Maybe (HsBndrVar GhcRn)
</span><a href="#local-6989586621683078454"><span class="hs-identifier hs-var">go_bvar</span></a></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn
</span><a href="#local-6989586621683078456"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-4578"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683078458"><span class="annot"><a href="#local-6989586621683078458"><span class="hs-identifier hs-var hs-var">bkind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XBndrNoKind GhcRn -&gt; HsBndrKind GhcRn
forall pass. XBndrNoKind pass -&gt; HsBndrKind pass
</span><a href="Language.Haskell.Syntax.Type.html#HsBndrNoKind"><span class="hs-identifier hs-var">HsBndrNoKind</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XBndrNoKind GhcRn
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span>
</span><span id="line-4579"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTvb"><span class="hs-identifier hs-type">HsTvb</span></a></span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-type">noAnn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683078457"><span class="hs-identifier hs-type">bvar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078458"><span class="hs-identifier hs-type">bkind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4580"></span><span>
</span><span id="line-4581"></span><span>  </span><span class="annot"><a href="#local-6989586621683078454"><span class="hs-identifier hs-type">go_bvar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsType"><span class="hs-identifier hs-type">HsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsBndrVar"><span class="hs-identifier hs-type">HsBndrVar</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4582"></span><span>  </span><span id="local-6989586621683078454"><span class="annot"><span class="annottext">go_bvar :: HsType GhcRn -&gt; Maybe (HsBndrVar GhcRn)
</span><a href="#local-6989586621683078454"><span class="hs-identifier hs-var hs-var">go_bvar</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTyVar"><span class="hs-identifier hs-type">HsTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">XTyVar GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PromotionFlag
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683078459"><span class="annot"><span class="annottext">LIdP GhcRn
</span><a href="#local-6989586621683078459"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-4583"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="GHC.Types.Name.html#isTyVarName"><span class="hs-identifier hs-var">isTyVarName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnN Name -&gt; Name
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LIdP GhcRn
GenLocated SrcSpanAnnN Name
</span><a href="#local-6989586621683078459"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4584"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsBndrVar GhcRn -&gt; Maybe (HsBndrVar GhcRn)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XBndrVar GhcRn -&gt; LIdP GhcRn -&gt; HsBndrVar GhcRn
forall pass. XBndrVar pass -&gt; LIdP pass -&gt; HsBndrVar pass
</span><a href="Language.Haskell.Syntax.Type.html#HsBndrVar"><span class="hs-identifier hs-var">HsBndrVar</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XBndrVar GhcRn
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">LIdP GhcRn
</span><a href="#local-6989586621683078459"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4585"></span><span>  </span><span class="annot"><a href="#local-6989586621683078454"><span class="hs-identifier hs-var">go_bvar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsWildCardTy"><span class="hs-identifier hs-type">HsWildCardTy</span></a></span><span> </span><span class="annot"><span class="annottext">XWildCardTy GhcRn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-4586"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsBndrVar GhcRn -&gt; Maybe (HsBndrVar GhcRn)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XBndrWildCard GhcRn -&gt; HsBndrVar GhcRn
forall pass. XBndrWildCard pass -&gt; HsBndrVar pass
</span><a href="Language.Haskell.Syntax.Type.html#HsBndrWildCard"><span class="hs-identifier hs-var">HsBndrWildCard</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XBndrWildCard GhcRn
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4587"></span><span>  </span><span class="annot"><a href="#local-6989586621683078454"><span class="hs-identifier hs-var">go_bvar</span></a></span><span> </span><span class="annot"><span class="annottext">HsType GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (HsBndrVar GhcRn)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-4588"></span><span>
</span><span id="line-4589"></span><span class="hs-comment">{- Note [Type patterns: binders and unifiers]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
A type pattern, of type `HsTyPat`, represents a type argument in a data
constructor pattern.  For example
    f (MkT @a @(Maybe b) p q) = ...
Here the `@a` and `@(Maybe b)` are type patterns.  In general, then a
`HsTyPat` is represented by a `HsType`.

However, for /typechecking/ purposes (only) we distinguish two categories of
type pattern:
* Binder type patterns
* Unifier type patterns

Binder type patterns are a subset of type patterns described by the following grammar:

  bvar ::= tv  | '_'        -- type variable or wildcard
  tp_bndr ::=
      bvar                  -- plain binder
    | bvar '::' kind        -- binder with kind annotation
    | '(' tp_bndr ')'       -- parentheses

This subset of HsTyPat can be represented by HsTyVarBndr, which is also used
in foralls and type declaration headers.

Unifier type patterns include all other forms of type patterns, such as `Maybe x`.
This distinction allows the typechecker to accept more programs.
Consider this example from #18986:

  data T where
    MkT :: forall (f :: forall k. k -&gt; Type).
      f Int -&gt; f Maybe -&gt; T

  k :: T -&gt; ()
  k (MkT @f (x :: f Int) (y :: f Maybe)) = ()

In general case (if we treat `f` as a unifier) we would create a metavariable for its kind:
  f :: kappa
Checking `x :: f Int` would unify
  kappa := Type -&gt; Type
and then checking `y :: f Maybe` would unify
  kappa := (Type -&gt; Type) -&gt; Type
leading to a type error:
    &#8226; Expecting one more argument to &#8216;Maybe&#8217;
      Expected a type, but &#8216;Maybe&#8217; has kind &#8216;* -&gt; *&#8217;

However, `@f` is a simple type variable binder, we don't need a metavariable for its kind, we
can add it directly to the context with its polymorphic kind:
  f :: forall k . k -&gt; Type
This way both `f Int` and `f Maybe` can be accepted because `k` can be instantiated differently at
each call site.

Note [Typechecking pattern signature binders]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
See also Note [Type variables in the type environment] in GHC.Tc.Utils.
Consider

  data T where
    MkT :: forall a. a -&gt; (a -&gt; Int) -&gt; T

  f :: T -&gt; ...
  f (MkT x (f :: b -&gt; c)) = &lt;blah&gt;

Here
 * The pattern (MkT p1 p2) creates a *skolem* type variable 'a_sk',
   It must be a skolem so that it retains its identity, and
   GHC.Tc.Errors.getSkolemInfo can thereby find the binding site for the skolem.

 * The type signature pattern (f :: b -&gt; c) makes fresh meta-tyvars
   beta and gamma (TauTvs), and binds &quot;b&quot; :-&gt; beta, &quot;c&quot; :-&gt; gamma in the
   environment

 * Then unification makes beta := a_sk, gamma := Int
   That's why we must make beta and gamma a MetaTv,
   not a SkolemTv, so that it can unify to a_sk (or Int, respectively).

 * Finally, in '&lt;blah&gt;' we have the envt &quot;b&quot; :-&gt; beta, &quot;c&quot; :-&gt; gamma,
   so we return the pairs (&quot;b&quot; :-&gt; beta, &quot;c&quot; :-&gt; gamma) from tcHsPatSigType,

Another example (#13881):
   fl :: forall (l :: [a]). Sing l -&gt; Sing l
   fl (SNil :: Sing (l :: [y])) = SNil
When we reach the pattern signature, 'l' is in scope from the
outer 'forall':
   &quot;a&quot; :-&gt; a_sk :: *
   &quot;l&quot; :-&gt; l_sk :: [a_sk]
We make up a fresh meta-TauTv, y_sig, for 'y', and kind-check
the pattern signature
   Sing (l :: [y])
That unifies y_sig := a_sk.  We return from tcHsPatSigType with
the pair (&quot;y&quot; :-&gt; y_sig).

For RULE binders, though, things are a bit different (yuk).
  RULE &quot;foo&quot; forall (x::a) (y::[a]).  f x y = ...
Here this really is the binding site of the type variable so we'd like
to use a skolem, so that we get a complaint if we unify two of them
together.  Hence the new_implicit_tv function in tcHsPatSigType.


************************************************************************
*                                                                      *
        Checking kinds
*                                                                      *
************************************************************************

-}</span><span>
</span><span id="line-4694"></span><span>
</span><span id="line-4695"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#unifyKinds"><span class="hs-identifier hs-type">unifyKinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4696"></span><span id="unifyKinds"><span class="annot"><span class="annottext">unifyKinds :: [LHsType GhcRn] -&gt; [(Type, Type)] -&gt; TcM ([Type], Type)
</span><a href="GHC.Tc.Gen.HsType.html#unifyKinds"><span class="hs-identifier hs-var hs-var">unifyKinds</span></a></span></span><span> </span><span id="local-6989586621683078461"><span class="annot"><span class="annottext">[LHsType GhcRn]
</span><a href="#local-6989586621683078461"><span class="hs-identifier hs-var">rn_tys</span></a></span></span><span> </span><span id="local-6989586621683078462"><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621683078462"><span class="hs-identifier hs-var">act_kinds</span></a></span></span><span>
</span><span id="line-4697"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683078463"><span class="annot"><a href="#local-6989586621683078463"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM Type
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaKindVar"><span class="hs-identifier hs-var">newMetaKindVar</span></a></span><span>
</span><span id="line-4698"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683078464"><span class="annot"><a href="#local-6989586621683078464"><span class="hs-identifier hs-var hs-var">check</span></a></span></span><span> </span><span id="local-6989586621683078465"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621683078465"><span class="hs-identifier hs-var">rn_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683078466"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078466"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683078467"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078467"><span class="hs-identifier hs-var">act_kind</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-4699"></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt;
HsType GhcRn -&gt; Type -&gt; Type -&gt; Type -&gt; TcM Type
HsType GhcRn -&gt; Type -&gt; Type -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#checkExpectedKind"><span class="hs-identifier hs-var">checkExpectedKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcRn) -&gt; HsType GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621683078465"><span class="hs-identifier hs-var">rn_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078466"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078467"><span class="hs-identifier hs-var">act_kind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621683078463"><span class="hs-identifier hs-var">kind</span></a></span><span>
</span><span id="line-4700"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683078468"><span class="annot"><a href="#local-6989586621683078468"><span class="hs-identifier hs-var">tys'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">zipWithM</span></span><span> </span><span class="annot"><a href="#local-6989586621683078464"><span class="hs-identifier hs-type">check</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078461"><span class="hs-identifier hs-type">rn_tys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078462"><span class="hs-identifier hs-type">act_kinds</span></a></span><span>
</span><span id="line-4701"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683078468"><span class="hs-identifier hs-type">tys'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683078463"><span class="hs-identifier hs-type">kind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4702"></span><span>
</span><span id="line-4703"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Sort checking kinds
*                                                                      *
************************************************************************

tcLHsKindSig converts a user-written kind to an internal, sort-checked kind.
It does sort checking and desugaring at the same time, in one single pass.
-}</span><span>
</span><span id="line-4713"></span><span>
</span><span id="line-4714"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcLHsKindSig"><span class="hs-identifier hs-type">tcLHsKindSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsKind"><span class="hs-identifier hs-type">LHsKind</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span>
</span><span id="line-4715"></span><span id="tcLHsKindSig"><span class="annot"><span class="annottext">tcLHsKindSig :: UserTypeCtxt -&gt; LHsType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcLHsKindSig"><span class="hs-identifier hs-var hs-var">tcLHsKindSig</span></a></span></span><span> </span><span id="local-6989586621683078469"><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621683078469"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683078470"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683078470"><span class="hs-identifier hs-var">hs_kind</span></a></span></span><span>
</span><span id="line-4716"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyMode -&gt; UserTypeCtxt -&gt; LHsType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_lhs_kind_sig"><span class="hs-identifier hs-var">tc_lhs_kind_sig</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="GHC.Tc.Gen.HsType.html#kindLevelMode"><span class="hs-identifier hs-var">kindLevelMode</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621683078469"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683078470"><span class="hs-identifier hs-var">hs_kind</span></a></span><span>
</span><span id="line-4717"></span><span>
</span><span id="line-4718"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tc_lhs_kind_sig"><span class="hs-identifier hs-type">tc_lhs_kind_sig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#TcTyMode"><span class="hs-identifier hs-type">TcTyMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsKind"><span class="hs-identifier hs-type">LHsKind</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span>
</span><span id="line-4719"></span><span id="tc_lhs_kind_sig"><span class="annot"><span class="annottext">tc_lhs_kind_sig :: TcTyMode -&gt; UserTypeCtxt -&gt; LHsType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_lhs_kind_sig"><span class="hs-identifier hs-var hs-var">tc_lhs_kind_sig</span></a></span></span><span> </span><span id="local-6989586621683078471"><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683078471"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621683078472"><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621683078472"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621683078473"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683078473"><span class="hs-identifier hs-var">hs_kind</span></a></span></span><span>
</span><span id="line-4720"></span><span class="hs-comment">-- See  Note [Recipe for checking a signature] in GHC.Tc.Gen.HsType</span><span>
</span><span id="line-4721"></span><span class="hs-comment">-- Result is zonked</span><span>
</span><span id="line-4722"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683078474"><span class="annot"><a href="#local-6989586621683078474"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcM Type -&gt; TcM Type
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In the kind&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcRn) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
GenLocated SrcSpanAnnA (HsType GhcRn)
</span><a href="#local-6989586621683078473"><span class="hs-identifier hs-var">hs_kind</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM Type -&gt; TcM Type) -&gt; TcM Type -&gt; TcM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-4723"></span><span>                 </span><span class="annot"><span class="annottext">String -&gt; TcM Type -&gt; TcM Type
forall a. String -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Solver.html#solveEqualities"><span class="hs-identifier hs-var">solveEqualities</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcLHsKindSig&quot;</span></span><span> </span><span class="annot"><span class="annottext">(TcM Type -&gt; TcM Type) -&gt; TcM Type -&gt; TcM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-4724"></span><span>                 </span><span class="annot"><span class="annottext">TcTyMode -&gt; LHsType GhcRn -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tc_check_lhs_type"><span class="hs-identifier hs-var">tc_check_lhs_type</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyMode
</span><a href="#local-6989586621683078471"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621683078473"><span class="hs-identifier hs-var">hs_kind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span>
</span><span id="line-4725"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcLHsKindSig&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078473"><span class="hs-identifier hs-type">hs_kind</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078474"><span class="hs-identifier hs-type">kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4726"></span><span>       </span><span class="hs-comment">-- No generalization:</span><span>
</span><span id="line-4727"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#kindGeneralizeNone"><span class="hs-identifier hs-type">kindGeneralizeNone</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078474"><span class="hs-identifier hs-type">kind</span></a></span><span>
</span><span id="line-4728"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683078475"><span class="annot"><a href="#local-6989586621683078475"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#liftZonkM"><span class="hs-identifier hs-type">liftZonkM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTcType"><span class="hs-identifier hs-type">zonkTcType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078474"><span class="hs-identifier hs-type">kind</span></a></span><span>
</span><span id="line-4729"></span><span>         </span><span class="hs-comment">-- This zonk is very important in the case of higher rank kinds</span><span>
</span><span id="line-4730"></span><span>         </span><span class="hs-comment">-- E.g. #13879    f :: forall (p :: forall z (y::z). &lt;blah&gt;).</span><span>
</span><span id="line-4731"></span><span>         </span><span class="hs-comment">--                          &lt;more blah&gt;</span><span>
</span><span id="line-4732"></span><span>         </span><span class="hs-comment">--      When instantiating p's kind at occurrences of p in &lt;more blah&gt;</span><span>
</span><span id="line-4733"></span><span>         </span><span class="hs-comment">--      it's crucial that the kind we instantiate is fully zonked,</span><span>
</span><span id="line-4734"></span><span>         </span><span class="hs-comment">--      else we may fail to substitute properly</span><span>
</span><span id="line-4735"></span><span>
</span><span id="line-4736"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Validity.html#checkValidType"><span class="hs-identifier hs-type">checkValidType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078472"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078475"><span class="hs-identifier hs-type">kind</span></a></span><span>
</span><span id="line-4737"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcLHsKindSig2&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683078475"><span class="hs-identifier hs-type">kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4738"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683078475"><span class="hs-identifier hs-type">kind</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4739"></span><span>
</span><span id="line-4740"></span><span id="local-6989586621683075292"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#promotionErr"><span class="hs-identifier hs-type">promotionErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.PromotionErr.html#PromotionErr"><span class="hs-identifier hs-type">PromotionErr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075292"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-4741"></span><span id="promotionErr"><span class="annot"><span class="annottext">promotionErr :: forall a. Name -&gt; PromotionErr -&gt; TcM a
</span><a href="GHC.Tc.Gen.HsType.html#promotionErr"><span class="hs-identifier hs-var hs-var">promotionErr</span></a></span></span><span> </span><span id="local-6989586621683078476"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683078476"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621683078477"><span class="annot"><span class="annottext">PromotionErr
</span><a href="#local-6989586621683078477"><span class="hs-identifier hs-var">err</span></a></span></span><span>
</span><span id="line-4742"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM a
forall a. TcRnMessage -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; TcM a) -&gt; TcRnMessage -&gt; TcM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; PromotionErr -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnUnpromotableThing"><span class="hs-identifier hs-var">TcRnUnpromotableThing</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683078476"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">PromotionErr
</span><a href="#local-6989586621683078477"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-4743"></span><span>
</span><span id="line-4744"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
          Error messages and such
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-4751"></span><span>
</span><span id="line-4752"></span><span>
</span><span id="line-4753"></span><span class="hs-comment">-- | Make an appropriate message for an error in a function argument.</span><span>
</span><span id="line-4754"></span><span class="hs-comment">-- Used for both expressions and types.</span><span>
</span><span id="line-4755"></span><span id="local-6989586621683075270"><span id="local-6989586621683075271"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#funAppCtxt"><span class="hs-identifier hs-type">funAppCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075270"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075271"><span class="hs-identifier hs-type">arg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683075270"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683075271"><span class="hs-identifier hs-type">arg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span></span></span><span>
</span><span id="line-4756"></span><span id="funAppCtxt"><span class="annot"><span class="annottext">funAppCtxt :: forall fun arg.
(Outputable fun, Outputable arg) =&gt;
fun -&gt; arg -&gt; Int -&gt; SDoc
</span><a href="GHC.Tc.Gen.HsType.html#funAppCtxt"><span class="hs-identifier hs-var hs-var">funAppCtxt</span></a></span></span><span> </span><span id="local-6989586621683078488"><span class="annot"><span class="annottext">fun
</span><a href="#local-6989586621683078488"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621683078489"><span class="annot"><span class="annottext">arg
</span><a href="#local-6989586621683078489"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span id="local-6989586621683078490"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683078490"><span class="hs-identifier hs-var">arg_no</span></a></span></span><span>
</span><span id="line-4757"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In the&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#speakNth"><span class="hs-identifier hs-var">speakNth</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683078490"><span class="hs-identifier hs-var">arg_no</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;argument of&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-4758"></span><span>                    </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">fun -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">fun
</span><a href="#local-6989586621683078488"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;, namely&quot;</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-4759"></span><span>       </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">arg -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">arg
</span><a href="#local-6989586621683078489"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4760"></span><span>
</span><span id="line-4761"></span><span class="annot"><span class="hs-comment">-- | Add a &quot;In the data declaration for T&quot; or some such.</span></span><span>
</span><span id="line-4762"></span><span id="local-6989586621683075312"><span id="local-6989586621683075313"><span class="annot"><a href="GHC.Tc.Gen.HsType.html#addTyConFlavCtxt"><span class="hs-identifier hs-type">addTyConFlavCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TyConFlavour"><span class="hs-identifier hs-type">TyConFlavour</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075312"><span class="hs-identifier hs-type">tc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075313"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683075313"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-4763"></span><span id="addTyConFlavCtxt"><span class="annot"><span class="annottext">addTyConFlavCtxt :: forall tc a. Name -&gt; TyConFlavour tc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.HsType.html#addTyConFlavCtxt"><span class="hs-identifier hs-var hs-var">addTyConFlavCtxt</span></a></span></span><span> </span><span id="local-6989586621683078499"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683078499"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621683078500"><span class="annot"><span class="annottext">TyConFlavour tc
</span><a href="#local-6989586621683078500"><span class="hs-identifier hs-var">flav</span></a></span></span><span>
</span><span id="line-4764"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcM a -&gt; TcM a
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcM a -&gt; TcM a) -&gt; SDoc -&gt; TcM a -&gt; TcM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In the&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyConFlavour tc -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyConFlavour tc
</span><a href="#local-6989586621683078500"><span class="hs-identifier hs-var">flav</span></a></span><span>
</span><span id="line-4765"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;declaration for&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683078499"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4766"></span><span>
</span><span id="line-4767"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
          Utils for constructing TyLit
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-4774"></span><span>
</span><span id="line-4775"></span><span>
</span><span id="line-4776"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tyLitFromLit"><span class="hs-identifier hs-type">tyLitFromLit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#HsLit"><span class="hs-identifier hs-type">HsLit</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTyLit"><span class="hs-identifier hs-type">HsTyLit</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4777"></span><span id="tyLitFromLit"><span class="annot"><span class="annottext">tyLitFromLit :: HsLit GhcRn -&gt; Maybe (HsTyLit GhcRn)
</span><a href="GHC.Tc.Gen.HsType.html#tyLitFromLit"><span class="hs-identifier hs-var hs-var">tyLitFromLit</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#HsString"><span class="hs-identifier hs-type">HsString</span></a></span><span> </span><span id="local-6989586621683078502"><span class="annot"><span class="annottext">XHsString GhcRn
</span><a href="#local-6989586621683078502"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621683078503"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683078503"><span class="hs-identifier hs-var">str</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsTyLit GhcRn -&gt; Maybe (HsTyLit GhcRn)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XStrTy GhcRn -&gt; FastString -&gt; HsTyLit GhcRn
forall pass. XStrTy pass -&gt; FastString -&gt; HsTyLit pass
</span><a href="Language.Haskell.Syntax.Type.html#HsStrTy"><span class="hs-identifier hs-var">HsStrTy</span></a></span><span> </span><span class="annot"><span class="annottext">XStrTy GhcRn
XHsString GhcRn
</span><a href="#local-6989586621683078502"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683078503"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4778"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tyLitFromLit"><span class="hs-identifier hs-var">tyLitFromLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#HsMultilineString"><span class="hs-identifier hs-type">HsMultilineString</span></a></span><span> </span><span id="local-6989586621683078505"><span class="annot"><span class="annottext">XHsMultilineString GhcRn
</span><a href="#local-6989586621683078505"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621683078506"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683078506"><span class="hs-identifier hs-var">str</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsTyLit GhcRn -&gt; Maybe (HsTyLit GhcRn)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XStrTy GhcRn -&gt; FastString -&gt; HsTyLit GhcRn
forall pass. XStrTy pass -&gt; FastString -&gt; HsTyLit pass
</span><a href="Language.Haskell.Syntax.Type.html#HsStrTy"><span class="hs-identifier hs-var">HsStrTy</span></a></span><span> </span><span class="annot"><span class="annottext">XStrTy GhcRn
XHsMultilineString GhcRn
</span><a href="#local-6989586621683078505"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683078506"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4779"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tyLitFromLit"><span class="hs-identifier hs-var">tyLitFromLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#HsChar"><span class="hs-identifier hs-type">HsChar</span></a></span><span> </span><span id="local-6989586621683078508"><span class="annot"><span class="annottext">XHsChar GhcRn
</span><a href="#local-6989586621683078508"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621683078509"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621683078509"><span class="hs-identifier hs-var">char</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsTyLit GhcRn -&gt; Maybe (HsTyLit GhcRn)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XCharTy GhcRn -&gt; Char -&gt; HsTyLit GhcRn
forall pass. XCharTy pass -&gt; Char -&gt; HsTyLit pass
</span><a href="Language.Haskell.Syntax.Type.html#HsCharTy"><span class="hs-identifier hs-var">HsCharTy</span></a></span><span> </span><span class="annot"><span class="annottext">XCharTy GhcRn
XHsChar GhcRn
</span><a href="#local-6989586621683078508"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621683078509"><span class="hs-identifier hs-var">char</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4780"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tyLitFromLit"><span class="hs-identifier hs-var">tyLitFromLit</span></a></span><span> </span><span class="annot"><span class="annottext">HsLit GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (HsTyLit GhcRn)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-4781"></span><span>
</span><span id="line-4782"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tyLitFromOverloadedLit"><span class="hs-identifier hs-type">tyLitFromOverloadedLit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#OverLitVal"><span class="hs-identifier hs-type">OverLitVal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTyLit"><span class="hs-identifier hs-type">HsTyLit</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4783"></span><span id="tyLitFromOverloadedLit"><span class="annot"><span class="annottext">tyLitFromOverloadedLit :: OverLitVal -&gt; Maybe (HsTyLit GhcRn)
</span><a href="GHC.Tc.Gen.HsType.html#tyLitFromOverloadedLit"><span class="hs-identifier hs-var hs-var">tyLitFromOverloadedLit</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#HsIntegral"><span class="hs-identifier hs-type">HsIntegral</span></a></span><span> </span><span id="local-6989586621683078511"><span class="annot"><span class="annottext">IntegralLit
</span><a href="#local-6989586621683078511"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsTyLit GhcRn -&gt; Maybe (HsTyLit GhcRn)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(HsTyLit GhcRn -&gt; Maybe (HsTyLit GhcRn))
-&gt; HsTyLit GhcRn -&gt; Maybe (HsTyLit GhcRn)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">XNumTy GhcRn -&gt; Integer -&gt; HsTyLit GhcRn
forall pass. XNumTy pass -&gt; Integer -&gt; HsTyLit pass
</span><a href="Language.Haskell.Syntax.Type.html#HsNumTy"><span class="hs-identifier hs-var">HsNumTy</span></a></span><span> </span><span class="annot"><span class="annottext">XNumTy GhcRn
SourceText
</span><a href="GHC.Types.SourceText.html#NoSourceText"><span class="hs-identifier hs-var">NoSourceText</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IntegralLit -&gt; Integer
</span><a href="GHC.Types.SourceText.html#il_value"><span class="hs-identifier hs-var">il_value</span></a></span><span> </span><span class="annot"><span class="annottext">IntegralLit
</span><a href="#local-6989586621683078511"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4784"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tyLitFromOverloadedLit"><span class="hs-identifier hs-var">tyLitFromOverloadedLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#HsIsString"><span class="hs-identifier hs-type">HsIsString</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683078515"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683078515"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsTyLit GhcRn -&gt; Maybe (HsTyLit GhcRn)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(HsTyLit GhcRn -&gt; Maybe (HsTyLit GhcRn))
-&gt; HsTyLit GhcRn -&gt; Maybe (HsTyLit GhcRn)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">XStrTy GhcRn -&gt; FastString -&gt; HsTyLit GhcRn
forall pass. XStrTy pass -&gt; FastString -&gt; HsTyLit pass
</span><a href="Language.Haskell.Syntax.Type.html#HsStrTy"><span class="hs-identifier hs-var">HsStrTy</span></a></span><span> </span><span class="annot"><span class="annottext">XStrTy GhcRn
SourceText
</span><a href="GHC.Types.SourceText.html#NoSourceText"><span class="hs-identifier hs-var">NoSourceText</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683078515"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-4785"></span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tyLitFromOverloadedLit"><span class="hs-identifier hs-var">tyLitFromOverloadedLit</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#HsFractional"><span class="hs-identifier hs-type">HsFractional</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (HsTyLit GhcRn)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-4786"></span></pre></body></html>