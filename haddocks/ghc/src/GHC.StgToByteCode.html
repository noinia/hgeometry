<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveFunctor              #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards            #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts           #-}</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-comment">--</span><span>
</span><span id="line-8"></span><span class="hs-comment">--  (c) The University of Glasgow 2002-2006</span><span>
</span><span id="line-9"></span><span class="hs-comment">--</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="annot"><span class="hs-comment">-- | GHC.StgToByteCode: Generate bytecode from STG</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html"><span class="hs-identifier">GHC.StgToByteCode</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#UnlinkedBCO"><span class="hs-identifier">UnlinkedBCO</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#byteCodeGen"><span class="hs-identifier">byteCodeGen</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html"><span class="hs-identifier">GHC.Driver.DynFlags</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html"><span class="hs-identifier">GHC.Driver.Env</span></a></span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html"><span class="hs-identifier">GHC.ByteCode.Instr</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.ByteCode.Asm.html"><span class="hs-identifier">GHC.ByteCode.Asm</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html"><span class="hs-identifier">GHC.ByteCode.Types</span></a></span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.CallConv.html"><span class="hs-identifier">GHC.Cmm.CallConv</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html"><span class="hs-identifier">GHC.Cmm.Expr</span></a></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Reg.html"><span class="hs-identifier">GHC.Cmm.Reg</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Cmm.Reg.html#GlobalArgRegs"><span class="hs-identifier">GlobalArgRegs</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html"><span class="hs-identifier">GHC.Cmm.Node</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Utils.html"><span class="hs-identifier">GHC.Cmm.Utils</span></a></span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.html"><span class="hs-identifier">GHC.Platform</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.Profile.html"><span class="hs-identifier">GHC.Platform.Profile</span></a></span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html"><span class="hs-identifier">GHC.Runtime.Interpreter</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.FFI.html"><span class="hs-identifier">GHCi.FFI</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html"><span class="hs-identifier">GHCi.RemoteTypes</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.ForeignCall.html"><span class="hs-identifier">GHC.Types.ForeignCall</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.html"><span class="hs-identifier">GHC.Core</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Literal.html"><span class="hs-identifier">GHC.Types.Literal</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.PrimOps.html"><span class="hs-identifier">GHC.Builtin.PrimOps</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.PrimOps.Ids.html"><span class="hs-identifier">GHC.Builtin.PrimOps.Ids</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Builtin.PrimOps.Ids.html#primOpId"><span class="hs-identifier">primOpId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Compare.html"><span class="hs-identifier">GHC.Core.TyCo.Compare</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-identifier">eqType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.RepType.html"><span class="hs-identifier">GHC.Types.RepType</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html"><span class="hs-identifier">GHC.Utils.Logger</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html"><span class="hs-identifier">GHC.Types.Var.Set</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.Prim.html"><span class="hs-identifier">GHC.Builtin.Types.Prim</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html"><span class="hs-identifier">GHC.Core.TyCo.Ppr</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html#pprType"><span class="hs-identifier">pprType</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html"><span class="hs-identifier">GHC.Utils.Error</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Uniques.html"><span class="hs-identifier">GHC.Builtin.Uniques</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Exception.html"><span class="hs-identifier">GHC.Utils.Exception</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">evaluate</span></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Closure.html"><span class="hs-identifier">GHC.StgToCmm.Closure</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Closure.html#NonVoid"><span class="hs-identifier">NonVoid</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Closure.html#fromNonVoid"><span class="hs-identifier">fromNonVoid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Closure.html#idPrimRepU"><span class="hs-identifier">idPrimRepU</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>                              </span><span class="annot"><a href="GHC.StgToCmm.Closure.html#addIdReps"><span class="hs-identifier">addIdReps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Closure.html#addArgReps"><span class="hs-identifier">addArgReps</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>                              </span><span class="annot"><a href="GHC.StgToCmm.Closure.html#assertNonVoidIds"><span class="hs-identifier">assertNonVoidIds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Closure.html#assertNonVoidStgArgs"><span class="hs-identifier">assertNonVoidStgArgs</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Layout.html"><span class="hs-identifier">GHC.StgToCmm.Layout</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Layout.html"><span class="hs-identifier">GHC.Runtime.Heap.Layout</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Heap.Layout.html#WordOff"><span class="hs-identifier">WordOff</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Layout.html#ByteOff"><span class="hs-identifier">ByteOff</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Layout.html#wordsToBytes"><span class="hs-identifier">wordsToBytes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Bitmap.html"><span class="hs-identifier">GHC.Data.Bitmap</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FlatBag.html"><span class="hs-identifier">GHC.Data.FlatBag</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">FlatBag</span></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html"><span class="hs-identifier">GHC.Data.OrdList</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html"><span class="hs-identifier">GHC.Types.Name.Env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Env.html#mkNameEnv"><span class="hs-identifier">mkNameEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Tickish.html"><span class="hs-identifier">GHC.Types.Tickish</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SptEntry.html"><span class="hs-identifier">GHC.Types.SptEntry</span></a></span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">genericReplicate</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">genericLength</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">intersperse</span></span><span>
</span><span id="line-73"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">partition</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">scanl'</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">sortBy</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">zip4</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">zip6</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Foreign.html"><span class="hs-identifier">Foreign</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">shiftL</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">shiftR</span></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Char.html"><span class="hs-identifier">Data.Char</span></a></span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html"><span class="hs-identifier">GHC.Unit.Module</span></a></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html"><span class="hs-identifier">GHC.Unit.Home.ModInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#lookupHpt"><span class="hs-identifier">lookupHpt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../array-0.5.8.0-9044/src/Data.Array.html"><span class="hs-identifier">Data.Array</span></a></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Coerce.html"><span class="hs-identifier">Data.Coerce</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">coerce</span></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.html"><span class="hs-identifier">Data.ByteString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier">ByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.html"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#Map"><span class="hs-identifier">Map</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.IntMap.html"><span class="hs-identifier">Data.IntMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.IntMap.Internal.html#IntMap"><span class="hs-identifier">IntMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.html"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.IntMap.html"><span class="hs-identifier">Data.IntMap</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IntMap</span></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Data.FiniteMap.html"><span class="hs-identifier">GHC.Data.FiniteMap</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Ord.html"><span class="hs-identifier">Data.Ord</span></a></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Either.html"><span class="hs-identifier">Data.Either</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">partitionEithers</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html"><span class="hs-identifier">GHC.Stg.Syntax</span></a></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.IntSet.html"><span class="hs-identifier">Data.IntSet</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IntSet</span></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.CoreToIface.html"><span class="hs-identifier">GHC.CoreToIface</span></a></span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-97"></span><span class="hs-comment">-- Generating byte code for a complete module</span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="annot"><a href="GHC.StgToByteCode.html#byteCodeGen"><span class="hs-identifier hs-type">byteCodeGen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-100"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-101"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgTopBinding"><span class="hs-identifier hs-type">CgStgTopBinding</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-102"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-103"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ModBreaks"><span class="hs-identifier hs-type">ModBreaks</span></a></span><span>
</span><span id="line-104"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.SptEntry.html#SptEntry"><span class="hs-identifier hs-type">SptEntry</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-105"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#CompiledByteCode"><span class="hs-identifier hs-type">CompiledByteCode</span></a></span><span>
</span><span id="line-106"></span><span id="byteCodeGen"><span class="annot"><span class="annottext">byteCodeGen :: HscEnv
-&gt; Module
-&gt; [CgStgTopBinding]
-&gt; [TyCon]
-&gt; Maybe ModBreaks
-&gt; [SptEntry]
-&gt; IO CompiledByteCode
</span><a href="GHC.StgToByteCode.html#byteCodeGen"><span class="hs-identifier hs-var hs-var">byteCodeGen</span></a></span></span><span> </span><span id="local-6989586621682965823"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682965823"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682965824"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682965824"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span id="local-6989586621682965825"><span class="annot"><span class="annottext">[CgStgTopBinding]
</span><a href="#local-6989586621682965825"><span class="hs-identifier hs-var">binds</span></a></span></span><span> </span><span id="local-6989586621682965826"><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621682965826"><span class="hs-identifier hs-var">tycs</span></a></span></span><span> </span><span id="local-6989586621682965827"><span class="annot"><span class="annottext">Maybe ModBreaks
</span><a href="#local-6989586621682965827"><span class="hs-identifier hs-var">mb_modBreaks</span></a></span></span><span> </span><span id="local-6989586621682965828"><span class="annot"><span class="annottext">[SptEntry]
</span><a href="#local-6989586621682965828"><span class="hs-identifier hs-var">spt_entries</span></a></span></span><span>
</span><span id="line-107"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; SDoc
-&gt; (CompiledByteCode -&gt; ())
-&gt; IO CompiledByteCode
-&gt; IO CompiledByteCode
forall (m :: * -&gt; *) a.
MonadIO m =&gt;
Logger -&gt; SDoc -&gt; (a -&gt; ()) -&gt; m a -&gt; m a
</span><a href="GHC.Utils.Error.html#withTiming"><span class="hs-identifier hs-var">withTiming</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682965830"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-108"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.StgToByteCode&quot;</span></span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#brackets"><span class="hs-identifier hs-var">brackets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682965824"><span class="hs-identifier hs-var">this_mod</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; CompiledByteCode -&gt; ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO CompiledByteCode -&gt; IO CompiledByteCode)
-&gt; IO CompiledByteCode -&gt; IO CompiledByteCode
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-110"></span><span>        </span><span class="hs-comment">-- Split top-level binds into strings and others.</span><span>
</span><span id="line-111"></span><span>        </span><span class="hs-comment">-- See Note [Generating code for top-level string literal bindings].</span><span>
</span><span id="line-112"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682965836"><span class="annot"><span class="annottext">[(Id, ByteString)]
</span><a href="#local-6989586621682965836"><span class="hs-identifier hs-var hs-var">strings</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682965837"><span class="annot"><span class="annottext">[GenStgBinding 'CodeGen]
</span><a href="#local-6989586621682965837"><span class="hs-identifier hs-var hs-var">lifted_binds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Either (Id, ByteString) (GenStgBinding 'CodeGen)]
-&gt; ([(Id, ByteString)], [GenStgBinding 'CodeGen])
forall a b. [Either a b] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">partitionEithers</span></span><span> </span><span class="annot"><span class="annottext">([Either (Id, ByteString) (GenStgBinding 'CodeGen)]
 -&gt; ([(Id, ByteString)], [GenStgBinding 'CodeGen]))
-&gt; [Either (Id, ByteString) (GenStgBinding 'CodeGen)]
-&gt; ([(Id, ByteString)], [GenStgBinding 'CodeGen])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-comment">-- list monad</span><span>
</span><span id="line-113"></span><span>                </span><span id="local-6989586621682965838"><span class="annot"><a href="#local-6989586621682965838"><span class="hs-identifier hs-var">bnd</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CgStgTopBinding]
</span><a href="#local-6989586621682965825"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-114"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682965838"><span class="hs-identifier hs-type">bnd</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-115"></span><span>                  </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTopLifted"><span class="hs-identifier hs-type">StgTopLifted</span></a></span><span> </span><span id="local-6989586621682965840"><span class="annot"><span class="annottext">GenStgBinding 'CodeGen
</span><a href="#local-6989586621682965840"><span class="hs-identifier hs-var">bnd</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GenStgBinding 'CodeGen
-&gt; Either (Id, ByteString) (GenStgBinding 'CodeGen)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'CodeGen
</span><a href="#local-6989586621682965840"><span class="hs-identifier hs-var">bnd</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-116"></span><span>                  </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTopStringLit"><span class="hs-identifier hs-type">StgTopStringLit</span></a></span><span> </span><span id="local-6989586621682965842"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682965842"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621682965843"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682965843"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Id, ByteString)
-&gt; Either (Id, ByteString) (GenStgBinding 'CodeGen)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682965842"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621682965843"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-117"></span><span>            </span><span id="local-6989586621682965844"><span class="annot"><span class="annottext">flattenBind :: GenStgBinding pass -&gt; [(BinderP pass, GenStgRhs pass)]
</span><a href="#local-6989586621682965844"><span class="hs-identifier hs-var hs-var hs-var">flattenBind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgNonRec"><span class="hs-identifier hs-type">StgNonRec</span></a></span><span> </span><span id="local-6989586621682965846"><span class="annot"><span class="annottext">BinderP pass
</span><a href="#local-6989586621682965846"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621682965847"><span class="annot"><span class="annottext">GenStgRhs pass
</span><a href="#local-6989586621682965847"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">BinderP pass
</span><a href="#local-6989586621682965846"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">GenStgRhs pass
</span><a href="#local-6989586621682965847"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-118"></span><span>            </span><span class="annot"><a href="#local-6989586621682965844"><span class="hs-identifier hs-var">flattenBind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRec"><span class="hs-identifier hs-type">StgRec</span></a></span><span> </span><span id="local-6989586621682965849"><span class="annot"><span class="annottext">[(BinderP pass, GenStgRhs pass)]
</span><a href="#local-6989586621682965849"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(BinderP pass, GenStgRhs pass)]
</span><a href="#local-6989586621682965849"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-119"></span><span>        </span><span id="local-6989586621682965850"><span class="annot"><a href="#local-6989586621682965850"><span class="hs-identifier hs-var">stringPtrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; [(Id, ByteString)] -&gt; IO AddrEnv
</span><a href="GHC.StgToByteCode.html#allocateTopStrings"><span class="hs-identifier hs-var">allocateTopStrings</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682965852"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, ByteString)]
</span><a href="#local-6989586621682965836"><span class="hs-identifier hs-var">strings</span></a></span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#BcM_State"><span class="hs-identifier hs-type">BcM_State</span></a></span><span class="hs-special">{</span><span id="local-6989586621682965854"><span id="local-6989586621682965855"><span id="local-6989586621682965856"><span id="local-6989586621682965857"><span id="local-6989586621682965858"><span id="local-6989586621682965859"><span id="local-6989586621682965860"><span class="annot"><a href="#local-6989586621682965854"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682965868"><span class="annot"><a href="#local-6989586621682965868"><span class="hs-identifier hs-var">proto_bcos</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-122"></span><span>           </span><span class="annot"><a href="GHC.StgToByteCode.html#runBc"><span class="hs-identifier hs-type">runBc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682965823"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682965824"><span class="hs-identifier hs-type">this_mod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682965827"><span class="hs-identifier hs-type">mb_modBreaks</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-123"></span><span>             </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682965870"><span class="annot"><a href="#local-6989586621682965870"><span class="hs-identifier hs-var hs-var">flattened_binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenStgBinding 'CodeGen -&gt; [(Id, CgStgRhs)])
-&gt; [GenStgBinding 'CodeGen] -&gt; [(Id, CgStgRhs)]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'CodeGen -&gt; [(Id, CgStgRhs)]
GenStgBinding 'CodeGen -&gt; [(BinderP 'CodeGen, CgStgRhs)]
forall {pass :: StgPass}.
GenStgBinding pass -&gt; [(BinderP pass, GenStgRhs pass)]
</span><a href="#local-6989586621682965844"><span class="hs-identifier hs-var">flattenBind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenStgBinding 'CodeGen] -&gt; [GenStgBinding 'CodeGen]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[GenStgBinding 'CodeGen]
</span><a href="#local-6989586621682965837"><span class="hs-identifier hs-var">lifted_binds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>             </span><span class="annot"><a href="GHC.Data.FlatBag.html#fromList"><span class="hs-identifier hs-type">FlatBag.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fromIntegral</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">length</span></span><span> </span><span class="annot"><a href="#local-6989586621682965870"><span class="hs-identifier hs-type">flattened_binds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#schemeTopBind"><span class="hs-identifier hs-type">schemeTopBind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682965870"><span class="hs-identifier hs-type">flattened_binds</span></a></span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Misc.html#notNull"><span class="hs-identifier hs-type">notNull</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682965857"><span class="hs-identifier hs-type">ffis</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>             </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-type">panic</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;GHC.StgToByteCode.byteCodeGen: missing final emitBc?&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span>        </span><span class="annot"><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-type">putDumpFileMaybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682965830"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_D_dump_BCOs"><span class="hs-identifier hs-type">Opt_D_dump_BCOs</span></a></span><span>
</span><span id="line-130"></span><span>           </span><span class="annot"><span class="hs-string">&quot;Proto-BCOs&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#FormatByteCode"><span class="hs-identifier hs-type">FormatByteCode</span></a></span><span>
</span><span id="line-131"></span><span>           </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">intersperse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-type">char</span></a></span><span> </span><span class="annot"><span class="hs-char">' '</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Data.FlatBag.html#elemsFlatBag"><span class="hs-identifier hs-type">elemsFlatBag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682965868"><span class="hs-identifier hs-type">proto_bcos</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682965887"><span class="annot"><a href="#local-6989586621682965887"><span class="hs-identifier hs-var hs-var">mod_breaks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ModBreaks
</span><a href="#local-6989586621682965858"><span class="hs-identifier hs-var">modBreaks</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-134"></span><span>             </span><span class="annot"><span class="annottext">Maybe ModBreaks
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ModBreaks
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-135"></span><span>             </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682965888"><span class="annot"><span class="annottext">ModBreaks
</span><a href="#local-6989586621682965888"><span class="hs-identifier hs-var">mb</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModBreaks -&gt; Maybe ModBreaks
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ModBreaks
</span><a href="#local-6989586621682965888"><span class="hs-identifier hs-var">mb</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#modBreaks_breakInfo"><span class="hs-identifier hs-var">modBreaks_breakInfo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682965859"><span class="hs-identifier hs-type">breakInfo</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-136"></span><span>        </span><span id="local-6989586621682965890"><span class="annot"><a href="#local-6989586621682965890"><span class="hs-identifier hs-var">cbc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.ByteCode.Asm.html#assembleBCOs"><span class="hs-identifier hs-type">assembleBCOs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682965852"><span class="hs-identifier hs-type">interp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682965892"><span class="hs-identifier hs-type">profile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682965868"><span class="hs-identifier hs-type">proto_bcos</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682965826"><span class="hs-identifier hs-type">tycs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682965850"><span class="hs-identifier hs-type">stringPtrs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682965887"><span class="hs-identifier hs-type">mod_breaks</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682965828"><span class="hs-identifier hs-type">spt_entries</span></a></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span>        </span><span class="hs-comment">-- Squash space leaks in the CompiledByteCode.  This is really</span><span>
</span><span id="line-139"></span><span>        </span><span class="hs-comment">-- important, because when loading a set of modules into GHCi</span><span>
</span><span id="line-140"></span><span>        </span><span class="hs-comment">-- we don't touch the CompiledByteCode until the end when we</span><span>
</span><span id="line-141"></span><span>        </span><span class="hs-comment">-- do linking.  Forcing out the thunks here reduces space</span><span>
</span><span id="line-142"></span><span>        </span><span class="hs-comment">-- usage by more than 50% when loading a large number of</span><span>
</span><span id="line-143"></span><span>        </span><span class="hs-comment">-- modules.</span><span>
</span><span id="line-144"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">evaluate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.ByteCode.Types.html#seqCompiledByteCode"><span class="hs-identifier hs-type">seqCompiledByteCode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682965890"><span class="hs-identifier hs-type">cbc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682965890"><span class="hs-identifier hs-type">cbc</span></a></span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682965894"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621682965894"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682965823"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-149"></span><span>        </span><span id="local-6989586621682965830"><span class="annot"><span class="annottext">logger :: Logger
</span><a href="#local-6989586621682965830"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682965823"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-150"></span><span>        </span><span id="local-6989586621682965852"><span class="annot"><span class="annottext">interp :: Interp
</span><a href="#local-6989586621682965852"><span class="hs-identifier hs-var hs-var">interp</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Interp
</span><a href="GHC.Driver.Env.html#hscInterp"><span class="hs-identifier hs-var">hscInterp</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682965823"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-151"></span><span>        </span><span id="local-6989586621682965892"><span class="annot"><span class="annottext">profile :: Profile
</span><a href="#local-6989586621682965892"><span class="hs-identifier hs-var hs-var">profile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Profile
</span><a href="GHC.Driver.DynFlags.html#targetProfile"><span class="hs-identifier hs-var">targetProfile</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682965894"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span class="annot"><span class="hs-comment">-- | see Note [Generating code for top-level string literal bindings]</span></span><span>
</span><span id="line-154"></span><span class="annot"><a href="GHC.StgToByteCode.html#allocateTopStrings"><span class="hs-identifier hs-type">allocateTopStrings</span></a></span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../bytestring-0.12.2.0-7dd0/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#AddrEnv"><span class="hs-identifier hs-type">AddrEnv</span></a></span><span>
</span><span id="line-158"></span><span id="allocateTopStrings"><span class="annot"><span class="annottext">allocateTopStrings :: Interp -&gt; [(Id, ByteString)] -&gt; IO AddrEnv
</span><a href="GHC.StgToByteCode.html#allocateTopStrings"><span class="hs-identifier hs-var hs-var">allocateTopStrings</span></a></span></span><span> </span><span id="local-6989586621682965899"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682965899"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682965900"><span class="annot"><span class="annottext">[(Id, ByteString)]
</span><a href="#local-6989586621682965900"><span class="hs-identifier hs-var">topStrings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span id="local-6989586621682965901"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682965901"><span class="hs-identifier hs-var hs-var">bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682965902"><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621682965902"><span class="hs-identifier hs-var hs-var">strings</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Id, ByteString)] -&gt; ([Id], [ByteString])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">[(Id, ByteString)]
</span><a href="#local-6989586621682965900"><span class="hs-identifier hs-var">topStrings</span></a></span><span>
</span><span id="line-160"></span><span>  </span><span id="local-6989586621682965904"><span class="annot"><a href="#local-6989586621682965904"><span class="hs-identifier hs-var">ptrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; Message [RemotePtr ()] -&gt; IO [RemotePtr ()]
forall a. Binary a =&gt; Interp -&gt; Message a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#interpCmd"><span class="hs-identifier hs-var">interpCmd</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682965899"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="annot"><span class="annottext">(Message [RemotePtr ()] -&gt; IO [RemotePtr ()])
-&gt; Message [RemotePtr ()] -&gt; IO [RemotePtr ()]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; Message [RemotePtr ()]
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#MallocStrings"><span class="hs-identifier hs-var">MallocStrings</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621682965902"><span class="hs-identifier hs-var">strings</span></a></span><span>
</span><span id="line-161"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html#mkNameEnv"><span class="hs-identifier hs-type">mkNameEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">zipWith</span></span><span> </span><span class="annot"><a href="#local-6989586621682965908"><span class="hs-identifier hs-type">mk_entry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682965901"><span class="hs-identifier hs-type">bndrs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682965904"><span class="hs-identifier hs-type">ptrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-163"></span><span>    </span><span id="local-6989586621682965908"><span class="annot"><span class="annottext">mk_entry :: a -&gt; RemotePtr () -&gt; (Name, (Name, AddrPtr))
</span><a href="#local-6989586621682965908"><span class="hs-identifier hs-var hs-var">mk_entry</span></a></span></span><span> </span><span id="local-6989586621682965911"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682965911"><span class="hs-identifier hs-var">bndr</span></a></span></span><span> </span><span id="local-6989586621682965912"><span class="annot"><span class="annottext">RemotePtr ()
</span><a href="#local-6989586621682965912"><span class="hs-identifier hs-var">ptr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682965913"><span class="annot"><span class="annottext">nm :: Name
</span><a href="#local-6989586621682965913"><span class="hs-identifier hs-var hs-var">nm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Name
forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682965911"><span class="hs-identifier hs-var">bndr</span></a></span><span>
</span><span id="line-164"></span><span>                        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682965913"><span class="hs-identifier hs-var">nm</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682965913"><span class="hs-identifier hs-var">nm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RemotePtr () -&gt; AddrPtr
</span><a href="GHC.ByteCode.Types.html#AddrPtr"><span class="hs-identifier hs-var">AddrPtr</span></a></span><span> </span><span class="annot"><span class="annottext">RemotePtr ()
</span><a href="#local-6989586621682965912"><span class="hs-identifier hs-var">ptr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span class="hs-comment">{- Note [Generating code for top-level string literal bindings]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
As described in Note [Compilation plan for top-level string literals]
in GHC.Core, the core-to-core optimizer can introduce top-level Addr#
bindings to represent string literals. The creates two challenges for
the bytecode compiler: (1) compiling the bindings themselves, and
(2) compiling references to such bindings. Here is a summary on how
we deal with them:

  1. Top-level string literal bindings are separated from the rest of
     the module. Memory for them is allocated immediately, via
     interpCmd, in allocateTopStrings, and the resulting AddrEnv is
     recorded in the bc_strs field of the CompiledByteCode result.

  2. When we encounter a reference to a top-level string literal, we
     generate a PUSH_ADDR pseudo-instruction, which is assembled to
     a PUSH_UBX instruction with a BCONPtrAddr argument.

  3. The loader accumulates string literal bindings from loaded
     bytecode in the addr_env field of the LinkerEnv.

  4. The BCO linker resolves BCONPtrAddr references by searching both
     the addr_env (to find literals defined in bytecode) and the native
     symbol table (to find literals defined in native code).

This strategy works alright, but it does have one significant problem:
we never free the memory that we allocate for the top-level strings.
In theory, we could explicitly free it when BCOs are unloaded, but
this comes with its own complications; see #22400 for why. For now,
we just accept the leak, but it would nice to find something better. -}</span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-198"></span><span class="hs-comment">-- Compilation schema for the bytecode generator</span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="hs-keyword">type</span><span> </span><span id="BCInstrList"><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-var">BCInstrList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#OrdList"><span class="hs-identifier hs-type">OrdList</span></a></span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html#BCInstr"><span class="hs-identifier hs-type">BCInstr</span></a></span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span class="annot"><a href="GHC.StgToByteCode.html#wordsToBytes"><span class="hs-identifier hs-type">wordsToBytes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span>
</span><span id="line-203"></span><span id="wordsToBytes"><span class="annot"><span class="annottext">wordsToBytes :: Platform -&gt; WordOff -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordsToBytes"><span class="hs-identifier hs-var hs-var">wordsToBytes</span></a></span></span><span> </span><span id="local-6989586621682965918"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682965918"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteOff
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; ByteOff) -&gt; (WordOff -&gt; Int) -&gt; WordOff -&gt; ByteOff
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Int
</span><a href="GHC.Platform.html#platformWordSizeInBytes"><span class="hs-identifier hs-var">platformWordSizeInBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682965918"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; (WordOff -&gt; Int) -&gt; WordOff -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="hs-comment">-- Used when we know we have a whole number of words</span><span>
</span><span id="line-206"></span><span class="annot"><a href="GHC.StgToByteCode.html#bytesToWords"><span class="hs-identifier hs-type">bytesToWords</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a></span><span>
</span><span id="line-207"></span><span id="bytesToWords"><span class="annot"><span class="annottext">bytesToWords :: Platform -&gt; ByteOff -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#bytesToWords"><span class="hs-identifier hs-var hs-var">bytesToWords</span></a></span></span><span> </span><span id="local-6989586621682965923"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682965923"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span> </span><span id="local-6989586621682965925"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682965925"><span class="hs-identifier hs-var">bytes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682965926"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682965926"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682965927"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682965927"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682965925"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; (Int, Int)
forall a. Integral a =&gt; a -&gt; a -&gt; (a, a)
</span><span class="hs-operator hs-var">`quotRem`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; Int
</span><a href="GHC.Platform.html#platformWordSizeInBytes"><span class="hs-identifier hs-var">platformWordSizeInBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682965923"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682965927"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-210"></span><span>           </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int -&gt; WordOff
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682965926"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-211"></span><span>           </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; WordOff
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.StgToByteCode.bytesToWords&quot;</span></span><span>
</span><span id="line-212"></span><span>                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;bytes=&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682965925"><span class="hs-identifier hs-var">bytes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span class="annot"><a href="GHC.StgToByteCode.html#wordSize"><span class="hs-identifier hs-type">wordSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span>
</span><span id="line-215"></span><span id="wordSize"><span class="annot"><span class="annottext">wordSize :: Platform -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordSize"><span class="hs-identifier hs-var hs-var">wordSize</span></a></span></span><span> </span><span id="local-6989586621682965932"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682965932"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteOff
</span><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-var">ByteOff</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; Int
</span><a href="GHC.Platform.html#platformWordSizeInBytes"><span class="hs-identifier hs-var">platformWordSizeInBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682965932"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span class="hs-keyword">type</span><span> </span><span id="Sequel"><span class="annot"><a href="GHC.StgToByteCode.html#Sequel"><span class="hs-identifier hs-var">Sequel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span> </span><span class="hs-comment">-- back off to this depth before ENTER</span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span class="hs-keyword">type</span><span> </span><span id="StackDepth"><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-var">StackDepth</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span class="hs-comment">-- | Maps Ids to their stack depth. This allows us to avoid having to mess with</span><span>
</span><span id="line-222"></span><span class="hs-comment">-- it after each push/pop.</span><span>
</span><span id="line-223"></span><span class="hs-keyword">type</span><span> </span><span id="BCEnv"><span class="annot"><a href="GHC.StgToByteCode.html#BCEnv"><span class="hs-identifier hs-var">BCEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-type">StackDepth</span></a></span><span> </span><span class="hs-comment">-- To find vars on the stack</span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span class="hs-comment">{-
ppBCEnv :: BCEnv -&gt; SDoc
ppBCEnv p
   = text &quot;begin-env&quot;
     $$ nest 4 (vcat (map pp_one (sortBy cmp_snd (Map.toList p))))
     $$ text &quot;end-env&quot;
     where
        pp_one (var, ByteOff offset) = int offset &lt;&gt; colon &lt;+&gt; ppr var &lt;+&gt; ppr (bcIdArgReps var)
        cmp_snd x y = compare (snd x) (snd y)
-}</span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span class="hs-comment">-- Create a BCO and do a spot of peephole optimisation on the insns</span><span>
</span><span id="line-237"></span><span class="hs-comment">-- at the same time.</span><span>
</span><span id="line-238"></span><span id="local-6989586621682964885"><span class="annot"><a href="GHC.StgToByteCode.html#mkProtoBCO"><span class="hs-identifier hs-type">mkProtoBCO</span></a></span><span>
</span><span id="line-239"></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span>
</span><span id="line-240"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682964885"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-241"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span>
</span><span id="line-242"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgAlt"><span class="hs-identifier hs-type">CgStgAlt</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgRhs"><span class="hs-identifier hs-type">CgStgRhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>                </span><span class="annot"><span class="hs-comment">-- ^ original expression; for debugging only</span></span><span>
</span><span id="line-244"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ arity</span></span><span>
</span><span id="line-245"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ bitmap size</span></span><span>
</span><span id="line-246"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Runtime.Heap.Layout.html#StgWord"><span class="hs-identifier hs-type">StgWord</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-comment">-- ^ bitmap</span></span><span>
</span><span id="line-247"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ True &lt;=&gt; is a return point, rather than a function</span></span><span>
</span><span id="line-248"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.ByteCode.Types.html#FFIInfo"><span class="hs-identifier hs-type">FFIInfo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-249"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html#ProtoBCO"><span class="hs-identifier hs-type">ProtoBCO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682964885"><span class="hs-identifier hs-type">name</span></a></span></span><span>
</span><span id="line-250"></span><span id="mkProtoBCO"><span class="annot"><span class="annottext">mkProtoBCO :: forall name.
Platform
-&gt; name
-&gt; OrdList BCInstr
-&gt; Either [CgStgAlt] CgStgRhs
-&gt; Int
-&gt; WordOff
-&gt; [StgWord]
-&gt; Bool
-&gt; [FFIInfo]
-&gt; ProtoBCO name
</span><a href="GHC.StgToByteCode.html#mkProtoBCO"><span class="hs-identifier hs-var hs-var">mkProtoBCO</span></a></span></span><span> </span><span id="local-6989586621682965948"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682965948"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621682965949"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621682965949"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span id="local-6989586621682965950"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621682965950"><span class="hs-identifier hs-var">instrs_ordlist</span></a></span></span><span> </span><span id="local-6989586621682965951"><span class="annot"><span class="annottext">Either [CgStgAlt] CgStgRhs
</span><a href="#local-6989586621682965951"><span class="hs-identifier hs-var">origin</span></a></span></span><span> </span><span id="local-6989586621682965952"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682965952"><span class="hs-identifier hs-var">arity</span></a></span></span><span> </span><span id="local-6989586621682965953"><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682965953"><span class="hs-identifier hs-var">bitmap_size</span></a></span></span><span> </span><span id="local-6989586621682965954"><span class="annot"><span class="annottext">[StgWord]
</span><a href="#local-6989586621682965954"><span class="hs-identifier hs-var">bitmap</span></a></span></span><span> </span><span id="local-6989586621682965955"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682965955"><span class="hs-identifier hs-var">is_ret</span></a></span></span><span> </span><span id="local-6989586621682965956"><span class="annot"><span class="annottext">[FFIInfo]
</span><a href="#local-6989586621682965956"><span class="hs-identifier hs-var">ffis</span></a></span></span><span>
</span><span id="line-251"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html#ProtoBCO"><span class="hs-identifier hs-type">ProtoBCO</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-252"></span><span>        </span><span class="annot"><span class="annottext">protoBCOName :: name
</span><a href="GHC.ByteCode.Instr.html#protoBCOName"><span class="hs-identifier hs-var">protoBCOName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621682965949"><span class="hs-identifier hs-var">nm</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-253"></span><span>        </span><span class="annot"><span class="annottext">protoBCOInstrs :: [BCInstr]
</span><a href="GHC.ByteCode.Instr.html#protoBCOInstrs"><span class="hs-identifier hs-var">protoBCOInstrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[BCInstr]
</span><a href="#local-6989586621682965960"><span class="hs-identifier hs-var">maybe_with_stack_check</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-254"></span><span>        </span><span class="annot"><span class="annottext">protoBCOBitmap :: [StgWord]
</span><a href="GHC.ByteCode.Instr.html#protoBCOBitmap"><span class="hs-identifier hs-var">protoBCOBitmap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[StgWord]
</span><a href="#local-6989586621682965954"><span class="hs-identifier hs-var">bitmap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-255"></span><span>        </span><span class="annot"><span class="annottext">protoBCOBitmapSize :: Word
</span><a href="GHC.ByteCode.Instr.html#protoBCOBitmapSize"><span class="hs-identifier hs-var">protoBCOBitmapSize</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; Word
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682965953"><span class="hs-identifier hs-var">bitmap_size</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-256"></span><span>        </span><span class="annot"><span class="annottext">protoBCOArity :: Int
</span><a href="GHC.ByteCode.Instr.html#protoBCOArity"><span class="hs-identifier hs-var">protoBCOArity</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682965952"><span class="hs-identifier hs-var">arity</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-257"></span><span>        </span><span class="annot"><span class="annottext">protoBCOExpr :: Either [CgStgAlt] CgStgRhs
</span><a href="GHC.ByteCode.Instr.html#protoBCOExpr"><span class="hs-identifier hs-var">protoBCOExpr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either [CgStgAlt] CgStgRhs
</span><a href="#local-6989586621682965951"><span class="hs-identifier hs-var">origin</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-258"></span><span>        </span><span class="annot"><span class="annottext">protoBCOFFIs :: [FFIInfo]
</span><a href="GHC.ByteCode.Instr.html#protoBCOFFIs"><span class="hs-identifier hs-var">protoBCOFFIs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FFIInfo]
</span><a href="#local-6989586621682965956"><span class="hs-identifier hs-var">ffis</span></a></span><span>
</span><span id="line-259"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-260"></span><span>     </span><span class="hs-keyword">where</span><span>
</span><span id="line-261"></span><span>        </span><span class="hs-comment">-- Overestimate the stack usage (in words) of this BCO,</span><span>
</span><span id="line-262"></span><span>        </span><span class="hs-comment">-- and if &gt;= iNTERP_STACK_CHECK_THRESH, add an explicit</span><span>
</span><span id="line-263"></span><span>        </span><span class="hs-comment">-- stack check.  (The interpreter always does a stack check</span><span>
</span><span id="line-264"></span><span>        </span><span class="hs-comment">-- for iNTERP_STACK_CHECK_THRESH words at the start of each</span><span>
</span><span id="line-265"></span><span>        </span><span class="hs-comment">-- BCO anyway, so we only need to add an explicit one in the</span><span>
</span><span id="line-266"></span><span>        </span><span class="hs-comment">-- (hopefully rare) cases when the (overestimated) stack use</span><span>
</span><span id="line-267"></span><span>        </span><span class="hs-comment">-- exceeds iNTERP_STACK_CHECK_THRESH.</span><span>
</span><span id="line-268"></span><span>        </span><span id="local-6989586621682965960"><span class="annot"><span class="annottext">maybe_with_stack_check :: [BCInstr]
</span><a href="#local-6989586621682965960"><span class="hs-identifier hs-var hs-var">maybe_with_stack_check</span></a></span></span><span>
</span><span id="line-269"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682965955"><span class="hs-identifier hs-var">is_ret</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621682965967"><span class="hs-identifier hs-var">stack_usage</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PlatformConstants -&gt; Int
</span><a href="GHC.Platform.Constants.html#pc_AP_STACK_SPLIM"><span class="hs-identifier hs-var">pc_AP_STACK_SPLIM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; PlatformConstants
</span><a href="GHC.Platform.html#platformConstants"><span class="hs-identifier hs-var">platformConstants</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682965948"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[BCInstr]
</span><a href="#local-6989586621682965971"><span class="hs-identifier hs-var">peep_d</span></a></span><span>
</span><span id="line-270"></span><span>                </span><span class="hs-comment">-- don't do stack checks at return points,</span><span>
</span><span id="line-271"></span><span>                </span><span class="hs-comment">-- everything is aggregated up to the top BCO</span><span>
</span><span id="line-272"></span><span>                </span><span class="hs-comment">-- (which must be a function).</span><span>
</span><span id="line-273"></span><span>                </span><span class="hs-comment">-- That is, unless the stack usage is &gt;= AP_STACK_SPLIM,</span><span>
</span><span id="line-274"></span><span>                </span><span class="hs-comment">-- see bug #1466.</span><span>
</span><span id="line-275"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621682965967"><span class="hs-identifier hs-var">stack_usage</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.ByteCode.Asm.html#iNTERP_STACK_CHECK_THRESH"><span class="hs-identifier hs-var">iNTERP_STACK_CHECK_THRESH</span></a></span><span>
</span><span id="line-276"></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#STKCHECK"><span class="hs-identifier hs-var">STKCHECK</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621682965967"><span class="hs-identifier hs-var">stack_usage</span></a></span><span> </span><span class="annot"><span class="annottext">BCInstr -&gt; [BCInstr] -&gt; [BCInstr]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[BCInstr]
</span><a href="#local-6989586621682965971"><span class="hs-identifier hs-var">peep_d</span></a></span><span>
</span><span id="line-277"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-278"></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[BCInstr]
</span><a href="#local-6989586621682965971"><span class="hs-identifier hs-var">peep_d</span></a></span><span>     </span><span class="hs-comment">-- the supposedly common case</span><span>
</span><span id="line-279"></span><span>
</span><span id="line-280"></span><span>        </span><span class="hs-comment">-- We assume that this sum doesn't wrap</span><span>
</span><span id="line-281"></span><span>        </span><span id="local-6989586621682965967"><span class="annot"><span class="annottext">stack_usage :: Word
</span><a href="#local-6989586621682965967"><span class="hs-identifier hs-var hs-var">stack_usage</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Word] -&gt; Word
forall a. Num a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">sum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(BCInstr -&gt; Word) -&gt; [BCInstr] -&gt; [Word]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">BCInstr -&gt; Word
</span><a href="GHC.ByteCode.Instr.html#bciStackUse"><span class="hs-identifier hs-var">bciStackUse</span></a></span><span> </span><span class="annot"><span class="annottext">[BCInstr]
</span><a href="#local-6989586621682965971"><span class="hs-identifier hs-var">peep_d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span>        </span><span class="hs-comment">-- Merge local pushes</span><span>
</span><span id="line-284"></span><span>        </span><span id="local-6989586621682965971"><span class="annot"><span class="annottext">peep_d :: [BCInstr]
</span><a href="#local-6989586621682965971"><span class="hs-identifier hs-var hs-var">peep_d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[BCInstr] -&gt; [BCInstr]
</span><a href="#local-6989586621682965976"><span class="hs-identifier hs-var">peep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrdList BCInstr -&gt; [BCInstr]
forall a. OrdList a -&gt; [a]
</span><a href="GHC.Data.OrdList.html#fromOL"><span class="hs-identifier hs-var">fromOL</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621682965950"><span class="hs-identifier hs-var">instrs_ordlist</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span>        </span><span id="local-6989586621682965976"><span class="annot"><span class="annottext">peep :: [BCInstr] -&gt; [BCInstr]
</span><a href="#local-6989586621682965976"><span class="hs-identifier hs-var hs-var">peep</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.ByteCode.Instr.html#PUSH_L"><span class="hs-identifier hs-type">PUSH_L</span></a></span><span> </span><span id="local-6989586621682965985"><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682965985"><span class="hs-identifier hs-var">off1</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html#PUSH_L"><span class="hs-identifier hs-type">PUSH_L</span></a></span><span> </span><span id="local-6989586621682965986"><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682965986"><span class="hs-identifier hs-var">off2</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html#PUSH_L"><span class="hs-identifier hs-type">PUSH_L</span></a></span><span> </span><span id="local-6989586621682965987"><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682965987"><span class="hs-identifier hs-var">off3</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682965988"><span class="annot"><span class="annottext">[BCInstr]
</span><a href="#local-6989586621682965988"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; WordOff -&gt; WordOff -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_LLL"><span class="hs-identifier hs-var">PUSH_LLL</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682965985"><span class="hs-identifier hs-var">off1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682965986"><span class="hs-identifier hs-var">off2</span></a></span><span class="annot"><span class="annottext">WordOff -&gt; WordOff -&gt; WordOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">WordOff
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682965987"><span class="hs-identifier hs-var">off3</span></a></span><span class="annot"><span class="annottext">WordOff -&gt; WordOff -&gt; WordOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">WordOff
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BCInstr -&gt; [BCInstr] -&gt; [BCInstr]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[BCInstr] -&gt; [BCInstr]
</span><a href="#local-6989586621682965976"><span class="hs-identifier hs-var">peep</span></a></span><span> </span><span class="annot"><span class="annottext">[BCInstr]
</span><a href="#local-6989586621682965988"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-288"></span><span>        </span><span class="annot"><a href="#local-6989586621682965976"><span class="hs-identifier hs-var">peep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.ByteCode.Instr.html#PUSH_L"><span class="hs-identifier hs-type">PUSH_L</span></a></span><span> </span><span id="local-6989586621682965990"><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682965990"><span class="hs-identifier hs-var">off1</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html#PUSH_L"><span class="hs-identifier hs-type">PUSH_L</span></a></span><span> </span><span id="local-6989586621682965991"><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682965991"><span class="hs-identifier hs-var">off2</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682965992"><span class="annot"><span class="annottext">[BCInstr]
</span><a href="#local-6989586621682965992"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; WordOff -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_LL"><span class="hs-identifier hs-var">PUSH_LL</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682965990"><span class="hs-identifier hs-var">off1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682965991"><span class="hs-identifier hs-var">off2</span></a></span><span class="annot"><span class="annottext">WordOff -&gt; WordOff -&gt; WordOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">WordOff
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BCInstr -&gt; [BCInstr] -&gt; [BCInstr]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[BCInstr] -&gt; [BCInstr]
</span><a href="#local-6989586621682965976"><span class="hs-identifier hs-var">peep</span></a></span><span> </span><span class="annot"><span class="annottext">[BCInstr]
</span><a href="#local-6989586621682965992"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-290"></span><span>        </span><span class="annot"><a href="#local-6989586621682965976"><span class="hs-identifier hs-var">peep</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682965994"><span class="annot"><span class="annottext">BCInstr
</span><a href="#local-6989586621682965994"><span class="hs-identifier hs-var">i</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682965995"><span class="annot"><span class="annottext">[BCInstr]
</span><a href="#local-6989586621682965995"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BCInstr
</span><a href="#local-6989586621682965994"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">BCInstr -&gt; [BCInstr] -&gt; [BCInstr]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[BCInstr] -&gt; [BCInstr]
</span><a href="#local-6989586621682965976"><span class="hs-identifier hs-var">peep</span></a></span><span> </span><span class="annot"><span class="annottext">[BCInstr]
</span><a href="#local-6989586621682965995"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-292"></span><span>        </span><span class="annot"><a href="#local-6989586621682965976"><span class="hs-identifier hs-var">peep</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-293"></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span class="annot"><a href="GHC.StgToByteCode.html#argBits"><span class="hs-identifier hs-type">argBits</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToCmm.ArgRep.html#ArgRep"><span class="hs-identifier hs-type">ArgRep</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">]</span><span>
</span><span id="line-296"></span><span id="argBits"><span class="annot"><span class="annottext">argBits :: Platform -&gt; [ArgRep] -&gt; [Bool]
</span><a href="GHC.StgToByteCode.html#argBits"><span class="hs-identifier hs-var hs-var">argBits</span></a></span></span><span> </span><span class="annot"><span class="annottext">Platform
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-297"></span><span class="annot"><a href="GHC.StgToByteCode.html#argBits"><span class="hs-identifier hs-var">argBits</span></a></span><span> </span><span id="local-6989586621682965997"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682965997"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682965998"><span class="annot"><span class="annottext">ArgRep
</span><a href="#local-6989586621682965998"><span class="hs-identifier hs-var">rep</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682965999"><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621682965999"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ArgRep -&gt; Bool
</span><a href="GHC.StgToByteCode.html#isFollowableArg"><span class="hs-identifier hs-var">isFollowableArg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="#local-6989586621682965998"><span class="hs-identifier hs-var">rep</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; [Bool] -&gt; [Bool]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; [ArgRep] -&gt; [Bool]
</span><a href="GHC.StgToByteCode.html#argBits"><span class="hs-identifier hs-var">argBits</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682965997"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621682965999"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-299"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool -&gt; [Bool]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; ArgRep -&gt; Int
</span><a href="GHC.StgToCmm.ArgRep.html#argRepSizeW"><span class="hs-identifier hs-var">argRepSizeW</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682965997"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="#local-6989586621682965998"><span class="hs-identifier hs-var">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">[Bool] -&gt; [Bool] -&gt; [Bool]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; [ArgRep] -&gt; [Bool]
</span><a href="GHC.StgToByteCode.html#argBits"><span class="hs-identifier hs-var">argBits</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682965997"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621682965999"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-302"></span><span class="hs-comment">-- schemeTopBind</span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span class="hs-comment">-- Compile code for the right-hand side of a top-level binding</span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeTopBind"><span class="hs-identifier hs-type">schemeTopBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgRhs"><span class="hs-identifier hs-type">CgStgRhs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.ByteCode.Instr.html#ProtoBCO"><span class="hs-identifier hs-type">ProtoBCO</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span id="schemeTopBind"><span class="annot"><span class="annottext">schemeTopBind :: (Id, CgStgRhs) -&gt; BcM (ProtoBCO Name)
</span><a href="GHC.StgToByteCode.html#schemeTopBind"><span class="hs-identifier hs-var hs-var">schemeTopBind</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682966003"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966003"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966004"><span class="annot"><span class="annottext">CgStgRhs
</span><a href="#local-6989586621682966004"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-308"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682966005"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682966005"><span class="hs-identifier hs-var">data_con</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Maybe DataCon
</span><a href="GHC.Types.Id.html#isDataConWorkId_maybe"><span class="hs-identifier hs-var">isDataConWorkId_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966003"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-309"></span><span>    </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isNullaryRepDataCon"><span class="hs-identifier hs-var">isNullaryRepDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682966005"><span class="hs-identifier hs-var">data_con</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-310"></span><span>    </span><span id="local-6989586621682966008"><span class="annot"><a href="#local-6989586621682966008"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Profile -&gt; Platform
</span><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="annottext">(Profile -&gt; Platform) -&gt; BcM Profile -&gt; BcM Platform
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">BcM Profile
</span><a href="GHC.StgToByteCode.html#getProfile"><span class="hs-identifier hs-var">getProfile</span></a></span><span>
</span><span id="line-311"></span><span>        </span><span class="hs-comment">-- Special case for the worker of a nullary data con.</span><span>
</span><span id="line-312"></span><span>        </span><span class="hs-comment">-- It'll look like this:        Nil = /\a -&gt; Nil a</span><span>
</span><span id="line-313"></span><span>        </span><span class="hs-comment">-- If we feed it into schemeR, we'll get</span><span>
</span><span id="line-314"></span><span>        </span><span class="hs-comment">--      Nil = Nil</span><span>
</span><span id="line-315"></span><span>        </span><span class="hs-comment">-- because mkConAppCode treats nullary constructor applications</span><span>
</span><span id="line-316"></span><span>        </span><span class="hs-comment">-- by just re-using the single top-level definition.  So</span><span>
</span><span id="line-317"></span><span>        </span><span class="hs-comment">-- for the worker itself, we must allocate it directly.</span><span>
</span><span id="line-318"></span><span>    </span><span class="hs-comment">-- ioToBc (putStrLn $ &quot;top level BCO&quot;)</span><span>
</span><span id="line-319"></span><span>    </span><span class="annot"><a href="GHC.StgToByteCode.html#emitBc"><span class="hs-identifier hs-type">emitBc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#mkProtoBCO"><span class="hs-identifier hs-type">mkProtoBCO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966008"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-type">getName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966003"><span class="hs-identifier hs-type">id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-type">toOL</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.ByteCode.Instr.html#PACK"><span class="hs-identifier hs-type">PACK</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966005"><span class="hs-identifier hs-type">data_con</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html#RETURN"><span class="hs-identifier hs-type">RETURN</span></a></span><span> </span><span class="annot"><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-type">P</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><a href="#local-6989586621682966004"><span class="hs-identifier hs-type">rhs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-special">[</span><span class="hs-comment">{-no bitmap-}</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span class="hs-comment">{-not alts-}</span><span class="hs-special">)</span><span>
</span><span id="line-321"></span><span>
</span><span id="line-322"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-323"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; (Name, CgStgRhs) -&gt; BcM (ProtoBCO Name)
</span><a href="GHC.StgToByteCode.html#schemeR"><span class="hs-identifier hs-var">schemeR</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-comment">{- No free variables -}</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966003"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CgStgRhs
</span><a href="#local-6989586621682966004"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-324"></span><span>
</span><span id="line-325"></span><span>
</span><span id="line-326"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-327"></span><span class="hs-comment">-- schemeR</span><span>
</span><span id="line-328"></span><span>
</span><span id="line-329"></span><span class="hs-comment">-- Compile code for a right-hand side, to give a BCO that,</span><span>
</span><span id="line-330"></span><span class="hs-comment">-- when executed with the free variables and arguments on top of the stack,</span><span>
</span><span id="line-331"></span><span class="hs-comment">-- will return with a pointer to the result on top of the stack, after</span><span>
</span><span id="line-332"></span><span class="hs-comment">-- removing the free variables and arguments.</span><span>
</span><span id="line-333"></span><span class="hs-comment">--</span><span>
</span><span id="line-334"></span><span class="hs-comment">-- Park the resulting BCO in the monad.  Also requires the</span><span>
</span><span id="line-335"></span><span class="hs-comment">-- name of the variable to which this value was bound,</span><span>
</span><span id="line-336"></span><span class="hs-comment">-- so as to give the resulting BCO a name.</span><span>
</span><span id="line-337"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeR"><span class="hs-identifier hs-type">schemeR</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>                 </span><span class="hs-comment">-- Free vars of the RHS, ordered as they</span><span>
</span><span id="line-338"></span><span>                                </span><span class="hs-comment">-- will appear in the thunk.  Empty for</span><span>
</span><span id="line-339"></span><span>                                </span><span class="hs-comment">-- top-level things, which have no free vars.</span><span>
</span><span id="line-340"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgRhs"><span class="hs-identifier hs-type">CgStgRhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-341"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.ByteCode.Instr.html#ProtoBCO"><span class="hs-identifier hs-type">ProtoBCO</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-342"></span><span id="schemeR"><span class="annot"><span class="annottext">schemeR :: [Id] -&gt; (Name, CgStgRhs) -&gt; BcM (ProtoBCO Name)
</span><a href="GHC.StgToByteCode.html#schemeR"><span class="hs-identifier hs-var hs-var">schemeR</span></a></span></span><span> </span><span id="local-6989586621682966017"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682966017"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682966018"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682966018"><span class="hs-identifier hs-var">nm</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966019"><span class="annot"><span class="annottext">CgStgRhs
</span><a href="#local-6989586621682966019"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-343"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id]
-&gt; Name -&gt; CgStgRhs -&gt; ([Id], CgStgExpr) -&gt; BcM (ProtoBCO Name)
</span><a href="GHC.StgToByteCode.html#schemeR_wrk"><span class="hs-identifier hs-var">schemeR_wrk</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682966017"><span class="hs-identifier hs-var">fvs</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682966018"><span class="hs-identifier hs-var">nm</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgRhs
</span><a href="#local-6989586621682966019"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CgStgRhs -&gt; ([Id], CgStgExpr)
</span><a href="GHC.StgToByteCode.html#collect"><span class="hs-identifier hs-var">collect</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgRhs
</span><a href="#local-6989586621682966019"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span class="hs-comment">-- If an expression is a lambda, return the</span><span>
</span><span id="line-346"></span><span class="hs-comment">-- list of arguments to the lambda (in R-to-L order) and the</span><span>
</span><span id="line-347"></span><span class="hs-comment">-- underlying expression</span><span>
</span><span id="line-348"></span><span>
</span><span id="line-349"></span><span class="annot"><a href="GHC.StgToByteCode.html#collect"><span class="hs-identifier hs-type">collect</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgRhs"><span class="hs-identifier hs-type">CgStgRhs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgExpr"><span class="hs-identifier hs-type">CgStgExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-350"></span><span id="collect"><span class="annot"><span class="annottext">collect :: CgStgRhs -&gt; ([Id], CgStgExpr)
</span><a href="GHC.StgToByteCode.html#collect"><span class="hs-identifier hs-var hs-var">collect</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRhsClosure"><span class="hs-identifier hs-type">StgRhsClosure</span></a></span><span> </span><span class="annot"><span class="annottext">XRhsClosure 'CodeGen
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CostCentreStack
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">UpdateFlag
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682966024"><span class="annot"><span class="annottext">[BinderP 'CodeGen]
</span><a href="#local-6989586621682966024"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621682966025"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682966025"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id]
[BinderP 'CodeGen]
</span><a href="#local-6989586621682966024"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682966025"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-351"></span><span class="annot"><a href="GHC.StgToByteCode.html#collect"><span class="hs-identifier hs-var">collect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRhsCon"><span class="hs-identifier hs-type">StgRhsCon</span></a></span><span> </span><span id="local-6989586621682966027"><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621682966027"><span class="hs-identifier hs-var">_cc</span></a></span></span><span> </span><span id="local-6989586621682966028"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682966028"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span id="local-6989586621682966029"><span class="annot"><span class="annottext">ConstructorNumber
</span><a href="#local-6989586621682966029"><span class="hs-identifier hs-var">cnum</span></a></span></span><span> </span><span id="local-6989586621682966030"><span class="annot"><span class="annottext">[StgTickish]
</span><a href="#local-6989586621682966030"><span class="hs-identifier hs-var">_ticks</span></a></span></span><span> </span><span id="local-6989586621682966031"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682966031"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621682966032"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682966032"><span class="hs-identifier hs-var">_typ</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DataCon
-&gt; ConstructorNumber -&gt; [StgArg] -&gt; [[PrimRep]] -&gt; CgStgExpr
forall (pass :: StgPass).
DataCon
-&gt; ConstructorNumber -&gt; [StgArg] -&gt; [[PrimRep]] -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgConApp"><span class="hs-identifier hs-var">StgConApp</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682966028"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">ConstructorNumber
</span><a href="#local-6989586621682966029"><span class="hs-identifier hs-var">cnum</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682966031"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeR_wrk"><span class="hs-identifier hs-type">schemeR_wrk</span></a></span><span>
</span><span id="line-354"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-355"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-356"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgRhs"><span class="hs-identifier hs-type">CgStgRhs</span></a></span><span>            </span><span class="hs-comment">-- expression e, for debugging only</span><span>
</span><span id="line-357"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgExpr"><span class="hs-identifier hs-type">CgStgExpr</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- result of collect on e</span><span>
</span><span id="line-358"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.ByteCode.Instr.html#ProtoBCO"><span class="hs-identifier hs-type">ProtoBCO</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span id="schemeR_wrk"><span class="annot"><span class="annottext">schemeR_wrk :: [Id]
-&gt; Name -&gt; CgStgRhs -&gt; ([Id], CgStgExpr) -&gt; BcM (ProtoBCO Name)
</span><a href="GHC.StgToByteCode.html#schemeR_wrk"><span class="hs-identifier hs-var hs-var">schemeR_wrk</span></a></span></span><span> </span><span id="local-6989586621682966034"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682966034"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span id="local-6989586621682966035"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682966035"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span id="local-6989586621682966036"><span class="annot"><span class="annottext">CgStgRhs
</span><a href="#local-6989586621682966036"><span class="hs-identifier hs-var">original_body</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682966037"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682966037"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966038"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682966038"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-361"></span><span>     </span><span id="local-6989586621682966039"><span class="annot"><a href="#local-6989586621682966039"><span class="hs-identifier hs-var">profile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BcM Profile
</span><a href="GHC.StgToByteCode.html#getProfile"><span class="hs-identifier hs-var">getProfile</span></a></span><span>
</span><span id="line-362"></span><span>     </span><span class="hs-keyword">let</span><span>
</span><span id="line-363"></span><span>         </span><span id="local-6989586621682966040"><span class="annot"><a href="#local-6989586621682966040"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Profile -&gt; Platform
</span><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682966039"><span class="hs-identifier hs-var">profile</span></a></span><span>
</span><span id="line-364"></span><span>         </span><span id="local-6989586621682966041"><span class="annot"><a href="#local-6989586621682966041"><span class="hs-identifier hs-var hs-var">all_args</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; [Id]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682966037"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; [Id] -&gt; [Id]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682966034"><span class="hs-identifier hs-var">fvs</span></a></span><span>
</span><span id="line-365"></span><span>         </span><span id="local-6989586621682966042"><span class="annot"><a href="#local-6989586621682966042"><span class="hs-identifier hs-var hs-var">arity</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682966041"><span class="hs-identifier hs-var">all_args</span></a></span><span>
</span><span id="line-366"></span><span>         </span><span class="hs-comment">-- all_args are the args in reverse order.  We're compiling a function</span><span>
</span><span id="line-367"></span><span>         </span><span class="hs-comment">-- \fv1..fvn x1..xn -&gt; e</span><span>
</span><span id="line-368"></span><span>         </span><span class="hs-comment">-- i.e. the fvs come first</span><span>
</span><span id="line-369"></span><span>
</span><span id="line-370"></span><span>         </span><span class="hs-comment">-- Stack arguments always take a whole number of words, we never pack</span><span>
</span><span id="line-371"></span><span>         </span><span class="hs-comment">-- them unlike constructor fields.</span><span>
</span><span id="line-372"></span><span>         </span><span id="local-6989586621682966043"><span class="annot"><a href="#local-6989586621682966043"><span class="hs-identifier hs-var hs-var">szsb_args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; ByteOff) -&gt; [Id] -&gt; [ByteOff]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; WordOff -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordsToBytes"><span class="hs-identifier hs-var">wordsToBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966040"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">(WordOff -&gt; ByteOff) -&gt; (Id -&gt; WordOff) -&gt; Id -&gt; ByteOff
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Id -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#idSizeW"><span class="hs-identifier hs-var">idSizeW</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966040"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682966041"><span class="hs-identifier hs-var">all_args</span></a></span><span>
</span><span id="line-373"></span><span>         </span><span id="local-6989586621682966045"><span class="annot"><a href="#local-6989586621682966045"><span class="hs-identifier hs-var hs-var">sum_szsb_args</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ByteOff] -&gt; ByteOff
forall a. Num a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">sum</span></span><span> </span><span class="annot"><span class="annottext">[ByteOff]
</span><a href="#local-6989586621682966043"><span class="hs-identifier hs-var">szsb_args</span></a></span><span>
</span><span id="line-374"></span><span>         </span><span id="local-6989586621682966046"><span class="annot"><a href="#local-6989586621682966046"><span class="hs-identifier hs-var hs-var">p_init</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Id, ByteOff)] -&gt; Map Id ByteOff
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">Map.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; [ByteOff] -&gt; [(Id, ByteOff)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682966041"><span class="hs-identifier hs-var">all_args</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff -&gt; [ByteOff] -&gt; [ByteOff]
</span><a href="GHC.StgToByteCode.html#mkStackOffsets"><span class="hs-identifier hs-var">mkStackOffsets</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">[ByteOff]
</span><a href="#local-6989586621682966043"><span class="hs-identifier hs-var">szsb_args</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span>
</span><span id="line-376"></span><span>         </span><span class="hs-comment">-- make the arg bitmap</span><span>
</span><span id="line-377"></span><span>         </span><span id="local-6989586621682966049"><span class="annot"><a href="#local-6989586621682966049"><span class="hs-identifier hs-var hs-var">bits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; [ArgRep] -&gt; [Bool]
</span><a href="GHC.StgToByteCode.html#argBits"><span class="hs-identifier hs-var">argBits</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966040"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ArgRep] -&gt; [ArgRep]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Id -&gt; ArgRep) -&gt; [Id] -&gt; [ArgRep]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; Id -&gt; ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#idArgRep"><span class="hs-identifier hs-var">idArgRep</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966040"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682966041"><span class="hs-identifier hs-var">all_args</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-378"></span><span>         </span><span id="local-6989586621682966051"><span class="annot"><a href="#local-6989586621682966051"><span class="hs-identifier hs-var hs-var">bitmap_size</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Bool] -&gt; WordOff
forall i a. Num i =&gt; [a] -&gt; i
</span><span class="hs-identifier hs-var">genericLength</span></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621682966049"><span class="hs-identifier hs-var">bits</span></a></span><span>
</span><span id="line-379"></span><span>         </span><span id="local-6989586621682966052"><span class="annot"><a href="#local-6989586621682966052"><span class="hs-identifier hs-var hs-var">bitmap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; [Bool] -&gt; [StgWord]
</span><a href="GHC.Data.Bitmap.html#mkBitmap"><span class="hs-identifier hs-var">mkBitmap</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966040"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621682966049"><span class="hs-identifier hs-var">bits</span></a></span><span>
</span><span id="line-380"></span><span>     </span><span id="local-6989586621682966054"><span class="annot"><a href="#local-6989586621682966054"><span class="hs-identifier hs-var">body_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#schemeER_wrk"><span class="hs-identifier hs-type">schemeER_wrk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966045"><span class="hs-identifier hs-type">sum_szsb_args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966046"><span class="hs-identifier hs-type">p_init</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966038"><span class="hs-identifier hs-type">body</span></a></span><span>
</span><span id="line-381"></span><span>
</span><span id="line-382"></span><span>     </span><span class="annot"><a href="GHC.StgToByteCode.html#emitBc"><span class="hs-identifier hs-type">emitBc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#mkProtoBCO"><span class="hs-identifier hs-type">mkProtoBCO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966040"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966035"><span class="hs-identifier hs-type">nm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966054"><span class="hs-identifier hs-type">body_code</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><a href="#local-6989586621682966036"><span class="hs-identifier hs-type">original_body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-383"></span><span>                 </span><span class="annot"><a href="#local-6989586621682966042"><span class="hs-identifier hs-type">arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966051"><span class="hs-identifier hs-type">bitmap_size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966052"><span class="hs-identifier hs-type">bitmap</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span class="hs-comment">{-not alts-}</span><span class="hs-special">)</span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span class="hs-comment">-- | Introduce break instructions for ticked expressions.</span><span>
</span><span id="line-386"></span><span class="hs-comment">-- If no breakpoint information is available, the instruction is omitted.</span><span>
</span><span id="line-387"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeER_wrk"><span class="hs-identifier hs-type">schemeER_wrk</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-type">StackDepth</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCEnv"><span class="hs-identifier hs-type">BCEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgExpr"><span class="hs-identifier hs-type">CgStgExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span>
</span><span id="line-388"></span><span id="schemeER_wrk"><span class="annot"><span class="annottext">schemeER_wrk :: ByteOff -&gt; Map Id ByteOff -&gt; CgStgExpr -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#schemeER_wrk"><span class="hs-identifier hs-var hs-var">schemeER_wrk</span></a></span></span><span> </span><span id="local-6989586621682966056"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966056"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682966057"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966057"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTick"><span class="hs-identifier hs-type">StgTick</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Tickish.html#Breakpoint"><span class="hs-identifier hs-type">Breakpoint</span></a></span><span> </span><span id="local-6989586621682966060"><span class="annot"><span class="annottext">XBreakpoint 'TickishPassStg
</span><a href="#local-6989586621682966060"><span class="hs-identifier hs-var">tick_ty</span></a></span></span><span> </span><span id="local-6989586621682966061"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682966061"><span class="hs-identifier hs-var">tick_no</span></a></span></span><span> </span><span id="local-6989586621682966062"><span class="annot"><span class="annottext">[XTickishId 'TickishPassStg]
</span><a href="#local-6989586621682966062"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span id="local-6989586621682966063"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682966063"><span class="hs-identifier hs-var">tick_mod</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682966064"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682966064"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-389"></span><span>  </span><span id="local-6989586621682966065"><span class="annot"><a href="#local-6989586621682966065"><span class="hs-identifier hs-var">code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; CgStgExpr -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966056"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966057"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682966064"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-390"></span><span>  </span><span id="local-6989586621682966067"><span class="annot"><a href="#local-6989586621682966067"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#getHscEnv"><span class="hs-identifier hs-type">getHscEnv</span></a></span><span>
</span><span id="line-391"></span><span>  </span><span id="local-6989586621682966069"><span class="annot"><a href="#local-6989586621682966069"><span class="hs-identifier hs-var">current_mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#getCurrentModule"><span class="hs-identifier hs-type">getCurrentModule</span></a></span><span>
</span><span id="line-392"></span><span>  </span><span id="local-6989586621682966071"><span class="annot"><a href="#local-6989586621682966071"><span class="hs-identifier hs-var">mb_current_mod_breaks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#getCurrentModBreaks"><span class="hs-identifier hs-type">getCurrentModBreaks</span></a></span><span>
</span><span id="line-393"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682966071"><span class="hs-identifier hs-type">mb_current_mod_breaks</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-394"></span><span>    </span><span class="hs-comment">-- if we're not generating ModBreaks for this module for some reason, we</span><span>
</span><span id="line-395"></span><span>    </span><span class="hs-comment">-- can't store breakpoint occurrence information.</span><span>
</span><span id="line-396"></span><span>    </span><span class="annot"><span class="annottext">Maybe ModBreaks
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr -&gt; BcM (OrdList BCInstr)
forall a. a -&gt; BcM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621682966065"><span class="hs-identifier hs-var">code</span></a></span><span>
</span><span id="line-397"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682966073"><span class="annot"><span class="annottext">ModBreaks
</span><a href="#local-6989586621682966073"><span class="hs-identifier hs-var">current_mod_breaks</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Module -&gt; Module -&gt; Maybe ModBreaks -&gt; Maybe ModBreaks
</span><a href="GHC.StgToByteCode.html#break_info"><span class="hs-identifier hs-var">break_info</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682966067"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682966063"><span class="hs-identifier hs-var">tick_mod</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682966069"><span class="hs-identifier hs-var">current_mod</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModBreaks
</span><a href="#local-6989586621682966071"><span class="hs-identifier hs-var">mb_current_mod_breaks</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-398"></span><span>      </span><span class="annot"><span class="annottext">Maybe ModBreaks
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr -&gt; BcM (OrdList BCInstr)
forall a. a -&gt; BcM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621682966065"><span class="hs-identifier hs-var">code</span></a></span><span>
</span><span id="line-399"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ModBreaks"><span class="hs-identifier hs-type">ModBreaks</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">modBreaks_flags :: ModBreaks -&gt; ForeignRef BreakArray
</span><a href="GHC.ByteCode.Types.html#modBreaks_flags"><span class="hs-identifier hs-var">modBreaks_flags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682966077"><span class="annot"><span class="annottext">ForeignRef BreakArray
</span><a href="#local-6989586621682966077"><span class="hs-identifier hs-var">breaks</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">modBreaks_module :: ModBreaks -&gt; RemotePtr ModuleName
</span><a href="GHC.ByteCode.Types.html#modBreaks_module"><span class="hs-identifier hs-var">modBreaks_module</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682966079"><span class="annot"><span class="annottext">RemotePtr ModuleName
</span><a href="#local-6989586621682966079"><span class="hs-identifier hs-var">tick_mod_ptr</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">modBreaks_ccs :: ModBreaks -&gt; Array Int (RemotePtr CostCentre)
</span><a href="GHC.ByteCode.Types.html#modBreaks_ccs"><span class="hs-identifier hs-var">modBreaks_ccs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682966081"><span class="annot"><span class="annottext">Array Int (RemotePtr CostCentre)
</span><a href="#local-6989586621682966081"><span class="hs-identifier hs-var">cc_arr</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-400"></span><span>        </span><span id="local-6989586621682966082"><span class="annot"><a href="#local-6989586621682966082"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Profile -&gt; Platform
</span><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="annottext">(Profile -&gt; Platform) -&gt; BcM Profile -&gt; BcM Platform
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">BcM Profile
</span><a href="GHC.StgToByteCode.html#getProfile"><span class="hs-identifier hs-var">getProfile</span></a></span><span>
</span><span id="line-401"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682966083"><span class="annot"><a href="#local-6989586621682966083"><span class="hs-identifier hs-var hs-var">idOffSets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; [Id] -&gt; [Maybe (Id, WordOff)]
</span><a href="GHC.StgToByteCode.html#getVarOffSets"><span class="hs-identifier hs-var">getVarOffSets</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966082"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966056"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966057"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
[XTickishId 'TickishPassStg]
</span><a href="#local-6989586621682966062"><span class="hs-identifier hs-var">fvs</span></a></span><span>
</span><span id="line-402"></span><span>            </span><span id="local-6989586621682966085"><span class="annot"><a href="#local-6989586621682966085"><span class="hs-identifier hs-var hs-var">ty_vars</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Id]
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfTypesWellScoped"><span class="hs-identifier hs-var">tyCoVarsOfTypesWellScoped</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
XBreakpoint 'TickishPassStg
</span><a href="#local-6989586621682966060"><span class="hs-identifier hs-var">tick_ty</span></a></span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; [Type]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">(Id -&gt; Type) -&gt; [Id] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
[XTickishId 'TickishPassStg]
</span><a href="#local-6989586621682966062"><span class="hs-identifier hs-var">fvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-403"></span><span>            </span><span class="annot"><a href="#local-6989586621682966088"><span class="hs-identifier hs-type">toWord</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span class="hs-special">)</span><span>
</span><span id="line-404"></span><span>            </span><span id="local-6989586621682966088"><span class="annot"><a href="#local-6989586621682966088"><span class="hs-identifier hs-var hs-var">toWord</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Id, WordOff) -&gt; (Id, Word))
-&gt; Maybe (Id, WordOff) -&gt; Maybe (Id, Word)
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682966089"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966089"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966090"><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966090"><span class="hs-identifier hs-var">wo</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966089"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; Word
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966090"><span class="hs-identifier hs-var">wo</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-405"></span><span>            </span><span id="local-6989586621682966091"><span class="annot"><a href="#local-6989586621682966091"><span class="hs-identifier hs-var hs-var">breakInfo</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; [Maybe (Id, Word)] -&gt; Type -&gt; CgBreakInfo
</span><a href="GHC.CoreToIface.html#dehydrateCgBreakInfo"><span class="hs-identifier hs-var">dehydrateCgBreakInfo</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682966085"><span class="hs-identifier hs-var">ty_vars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Maybe (Id, WordOff) -&gt; Maybe (Id, Word))
-&gt; [Maybe (Id, WordOff)] -&gt; [Maybe (Id, Word)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Id, WordOff) -&gt; Maybe (Id, Word)
</span><a href="#local-6989586621682966088"><span class="hs-identifier hs-var">toWord</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe (Id, WordOff)]
</span><a href="#local-6989586621682966083"><span class="hs-identifier hs-var">idOffSets</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
XBreakpoint 'TickishPassStg
</span><a href="#local-6989586621682966060"><span class="hs-identifier hs-var">tick_ty</span></a></span><span>
</span><span id="line-406"></span><span>
</span><span id="line-407"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682966093"><span class="annot"><a href="#local-6989586621682966093"><span class="hs-identifier hs-var hs-var">info_mod_ptr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModBreaks -&gt; RemotePtr ModuleName
</span><a href="GHC.ByteCode.Types.html#modBreaks_module"><span class="hs-identifier hs-var">modBreaks_module</span></a></span><span> </span><span class="annot"><span class="annottext">ModBreaks
</span><a href="#local-6989586621682966073"><span class="hs-identifier hs-var">current_mod_breaks</span></a></span><span>
</span><span id="line-408"></span><span>        </span><span id="local-6989586621682966094"><span class="annot"><a href="#local-6989586621682966094"><span class="hs-identifier hs-var">infox</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#newBreakInfo"><span class="hs-identifier hs-type">newBreakInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966091"><span class="hs-identifier hs-type">breakInfo</span></a></span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682966096"><span class="annot"><a href="#local-6989586621682966096"><span class="hs-identifier hs-var hs-var">cc</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682966097"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682966097"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Maybe Interp
</span><a href="GHC.Driver.Env.Types.html#hsc_interp"><span class="hs-identifier hs-var">hsc_interp</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682966067"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-411"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; Bool
</span><a href="GHC.Runtime.Interpreter.html#interpreterProfiled"><span class="hs-identifier hs-var">interpreterProfiled</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682966097"><span class="hs-identifier hs-var">interp</span></a></span><span>
</span><span id="line-412"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Array Int (RemotePtr CostCentre)
</span><a href="#local-6989586621682966081"><span class="hs-identifier hs-var">cc_arr</span></a></span><span> </span><span class="annot"><span class="annottext">Array Int (RemotePtr CostCentre) -&gt; Int -&gt; RemotePtr CostCentre
forall i e. Ix i =&gt; Array i e -&gt; i -&gt; e
</span><span class="hs-operator hs-var">!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682966061"><span class="hs-identifier hs-var">tick_no</span></a></span><span>
</span><span id="line-413"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr CostCentre -&gt; RemotePtr CostCentre
forall a. Ptr a -&gt; RemotePtr a
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#toRemotePtr"><span class="hs-identifier hs-var">toRemotePtr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr CostCentre
forall a. Ptr a
</span><span class="hs-identifier hs-var">nullPtr</span></span><span>
</span><span id="line-414"></span><span>
</span><span id="line-415"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- cast that checks that round-tripping through Word16 doesn't change the value</span><span>
</span><span id="line-416"></span><span>            </span><span id="local-6989586621682966129"><span class="annot"><a href="#local-6989586621682966129"><span class="hs-identifier hs-var hs-var">toW16</span></a></span></span><span> </span><span id="local-6989586621682966130"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682966130"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682966131"><span class="annot"><span class="annottext">r :: Word16
</span><a href="#local-6989586621682966131"><span class="hs-identifier hs-var hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Word16
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682966130"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span>
</span><span id="line-417"></span><span>                      </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; a
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621682966131"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682966130"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-418"></span><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621682966131"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-419"></span><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; Word16
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;schemeER_wrk: breakpoint tick/info index too large!&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682966130"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-420"></span><span>            </span><span id="local-6989586621682966132"><span class="annot"><a href="#local-6989586621682966132"><span class="hs-identifier hs-var hs-var">breakInstr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForeignRef BreakArray
-&gt; RemotePtr ModuleName
-&gt; Word16
-&gt; RemotePtr ModuleName
-&gt; Word16
-&gt; RemotePtr CostCentre
-&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#BRK_FUN"><span class="hs-identifier hs-var">BRK_FUN</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignRef BreakArray
</span><a href="#local-6989586621682966077"><span class="hs-identifier hs-var">breaks</span></a></span><span> </span><span class="annot"><span class="annottext">RemotePtr ModuleName
</span><a href="#local-6989586621682966079"><span class="hs-identifier hs-var">tick_mod_ptr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Word16
forall {a}. (Integral a, Outputable a) =&gt; a -&gt; Word16
</span><a href="#local-6989586621682966129"><span class="hs-identifier hs-var">toW16</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682966061"><span class="hs-identifier hs-var">tick_no</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RemotePtr ModuleName
</span><a href="#local-6989586621682966093"><span class="hs-identifier hs-var">info_mod_ptr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Word16
forall {a}. (Integral a, Outputable a) =&gt; a -&gt; Word16
</span><a href="#local-6989586621682966129"><span class="hs-identifier hs-var">toW16</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682966094"><span class="hs-identifier hs-var">infox</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RemotePtr CostCentre
</span><a href="#local-6989586621682966096"><span class="hs-identifier hs-var">cc</span></a></span><span>
</span><span id="line-421"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682966132"><span class="hs-identifier hs-type">breakInstr</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-type">`consOL`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966065"><span class="hs-identifier hs-type">code</span></a></span><span>
</span><span id="line-422"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeER_wrk"><span class="hs-identifier hs-var">schemeER_wrk</span></a></span><span> </span><span id="local-6989586621682966135"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966135"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682966136"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966136"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621682966137"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682966137"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; CgStgExpr -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966135"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966136"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682966137"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-423"></span><span>
</span><span id="line-424"></span><span class="hs-comment">-- | Determine the GHCi-allocated 'BreakArray' and module pointer for the module</span><span>
</span><span id="line-425"></span><span class="hs-comment">-- from which the breakpoint originates.</span><span>
</span><span id="line-426"></span><span class="hs-comment">-- These are stored in 'ModBreaks' as remote pointers in order to allow the BCOs</span><span>
</span><span id="line-427"></span><span class="hs-comment">-- to refer to pointers in GHCi's address space.</span><span>
</span><span id="line-428"></span><span class="hs-comment">-- They are initialized in 'GHC.HsToCore.Breakpoints.mkModBreaks', called by</span><span>
</span><span id="line-429"></span><span class="hs-comment">-- 'GHC.HsToCore.deSugar'.</span><span>
</span><span id="line-430"></span><span class="hs-comment">--</span><span>
</span><span id="line-431"></span><span class="hs-comment">-- Breakpoints might be disabled because we're in TH, because</span><span>
</span><span id="line-432"></span><span class="hs-comment">-- @-fno-break-points@ was specified, or because a module was reloaded without</span><span>
</span><span id="line-433"></span><span class="hs-comment">-- reinitializing 'ModBreaks'.</span><span>
</span><span id="line-434"></span><span class="hs-comment">--</span><span>
</span><span id="line-435"></span><span class="hs-comment">-- If the module stored in the breakpoint is the currently processed module, use</span><span>
</span><span id="line-436"></span><span class="hs-comment">-- the 'ModBreaks' from the state.</span><span>
</span><span id="line-437"></span><span class="hs-comment">-- If that is 'Nothing', consider breakpoints to be disabled and skip the</span><span>
</span><span id="line-438"></span><span class="hs-comment">-- instruction.</span><span>
</span><span id="line-439"></span><span class="hs-comment">--</span><span>
</span><span id="line-440"></span><span class="hs-comment">-- If the breakpoint is inlined from another module, look it up in the home</span><span>
</span><span id="line-441"></span><span class="hs-comment">-- package table.</span><span>
</span><span id="line-442"></span><span class="hs-comment">-- If the module doesn't exist there, or its module pointer is null (which means</span><span>
</span><span id="line-443"></span><span class="hs-comment">-- that the 'ModBreaks' value is uninitialized), skip the instruction.</span><span>
</span><span id="line-444"></span><span class="annot"><a href="GHC.StgToByteCode.html#break_info"><span class="hs-identifier hs-type">break_info</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-445"></span><span>  </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-446"></span><span>  </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-447"></span><span>  </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-448"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ModBreaks"><span class="hs-identifier hs-type">ModBreaks</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-449"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ModBreaks"><span class="hs-identifier hs-type">ModBreaks</span></a></span><span>
</span><span id="line-450"></span><span id="break_info"><span class="annot"><span class="annottext">break_info :: HscEnv -&gt; Module -&gt; Module -&gt; Maybe ModBreaks -&gt; Maybe ModBreaks
</span><a href="GHC.StgToByteCode.html#break_info"><span class="hs-identifier hs-var hs-var">break_info</span></a></span></span><span> </span><span id="local-6989586621682966138"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682966138"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682966139"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682966139"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span id="local-6989586621682966140"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682966140"><span class="hs-identifier hs-var">current_mod</span></a></span></span><span> </span><span id="local-6989586621682966141"><span class="annot"><span class="annottext">Maybe ModBreaks
</span><a href="#local-6989586621682966141"><span class="hs-identifier hs-var">current_mod_breaks</span></a></span></span><span>
</span><span id="line-451"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682966139"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; Module -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682966140"><span class="hs-identifier hs-var">current_mod</span></a></span><span>
</span><span id="line-452"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModBreaks -&gt; Maybe ModBreaks
</span><a href="#local-6989586621682966142"><span class="hs-identifier hs-var">check_mod_ptr</span></a></span><span> </span><span class="annot"><span class="annottext">(ModBreaks -&gt; Maybe ModBreaks)
-&gt; Maybe ModBreaks -&gt; Maybe ModBreaks
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe ModBreaks
</span><a href="#local-6989586621682966141"><span class="hs-identifier hs-var">current_mod_breaks</span></a></span><span>
</span><span id="line-453"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682966144"><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621682966144"><span class="hs-identifier hs-var">hp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HomePackageTable -&gt; ModuleName -&gt; Maybe HomeModInfo
</span><a href="GHC.Unit.Home.ModInfo.html#lookupHpt"><span class="hs-identifier hs-var">lookupHpt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; HomePackageTable
</span><a href="GHC.Driver.Env.html#hsc_HPT"><span class="hs-identifier hs-var">hsc_HPT</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682966138"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682966139"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-454"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModBreaks -&gt; Maybe ModBreaks
</span><a href="#local-6989586621682966142"><span class="hs-identifier hs-var">check_mod_ptr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeModInfo -&gt; ModBreaks
</span><a href="GHC.Runtime.Interpreter.html#getModBreaks"><span class="hs-identifier hs-var">getModBreaks</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621682966144"><span class="hs-identifier hs-var">hp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-455"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-456"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ModBreaks
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-457"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-458"></span><span>    </span><span id="local-6989586621682966142"><span class="annot"><span class="annottext">check_mod_ptr :: ModBreaks -&gt; Maybe ModBreaks
</span><a href="#local-6989586621682966142"><span class="hs-identifier hs-var hs-var">check_mod_ptr</span></a></span></span><span> </span><span id="local-6989586621682966150"><span class="annot"><span class="annottext">ModBreaks
</span><a href="#local-6989586621682966150"><span class="hs-identifier hs-var">mb</span></a></span></span><span>
</span><span id="line-459"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682966151"><span class="annot"><span class="annottext">RemotePtr ModuleName
</span><a href="#local-6989586621682966151"><span class="hs-identifier hs-var">mod_ptr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModBreaks -&gt; RemotePtr ModuleName
</span><a href="GHC.ByteCode.Types.html#modBreaks_module"><span class="hs-identifier hs-var">modBreaks_module</span></a></span><span> </span><span class="annot"><span class="annottext">ModBreaks
</span><a href="#local-6989586621682966150"><span class="hs-identifier hs-var">mb</span></a></span><span>
</span><span id="line-460"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RemotePtr ModuleName -&gt; Ptr ModuleName
forall a. RemotePtr a -&gt; Ptr a
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#fromRemotePtr"><span class="hs-identifier hs-var">fromRemotePtr</span></a></span><span> </span><span class="annot"><span class="annottext">RemotePtr ModuleName
</span><a href="#local-6989586621682966151"><span class="hs-identifier hs-var">mod_ptr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr ModuleName -&gt; Ptr ModuleName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Ptr ModuleName
forall a. Ptr a
</span><span class="hs-identifier hs-var">nullPtr</span></span><span>
</span><span id="line-461"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModBreaks -&gt; Maybe ModBreaks
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ModBreaks
</span><a href="#local-6989586621682966150"><span class="hs-identifier hs-var">mb</span></a></span><span>
</span><span id="line-462"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-463"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ModBreaks
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-464"></span><span>
</span><span id="line-465"></span><span class="annot"><a href="GHC.StgToByteCode.html#getVarOffSets"><span class="hs-identifier hs-type">getVarOffSets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-type">StackDepth</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCEnv"><span class="hs-identifier hs-type">BCEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-466"></span><span id="getVarOffSets"><span class="annot"><span class="annottext">getVarOffSets :: Platform
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; [Id] -&gt; [Maybe (Id, WordOff)]
</span><a href="GHC.StgToByteCode.html#getVarOffSets"><span class="hs-identifier hs-var hs-var">getVarOffSets</span></a></span></span><span> </span><span id="local-6989586621682966154"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966154"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621682966155"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966155"><span class="hs-identifier hs-var">depth</span></a></span></span><span> </span><span id="local-6989586621682966156"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966156"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Maybe (Id, WordOff)) -&gt; [Id] -&gt; [Maybe (Id, WordOff)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Maybe (Id, WordOff)
</span><a href="#local-6989586621682966157"><span class="hs-identifier hs-var">getOffSet</span></a></span><span>
</span><span id="line-467"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-468"></span><span>    </span><span id="local-6989586621682966157"><span class="annot"><span class="annottext">getOffSet :: Id -&gt; Maybe (Id, WordOff)
</span><a href="#local-6989586621682966157"><span class="hs-identifier hs-var hs-var">getOffSet</span></a></span></span><span> </span><span id="local-6989586621682966158"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966158"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Map Id ByteOff -&gt; Maybe ByteOff
</span><a href="GHC.StgToByteCode.html#lookupBCEnv_maybe"><span class="hs-identifier hs-var">lookupBCEnv_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966158"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966156"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-469"></span><span>        </span><span class="annot"><span class="annottext">Maybe ByteOff
</span><span class="hs-identifier hs-var">Nothing</span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Id, WordOff)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-470"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682966160"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966160"><span class="hs-identifier hs-var">offset</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-471"></span><span>            </span><span class="hs-comment">-- michalt: I'm not entirely sure why we need the stack</span><span>
</span><span id="line-472"></span><span>            </span><span class="hs-comment">-- adjustment by 2 here. I initially thought that there's</span><span>
</span><span id="line-473"></span><span>            </span><span class="hs-comment">-- something off with getIdValFromApStack (the only user of this</span><span>
</span><span id="line-474"></span><span>            </span><span class="hs-comment">-- value), but it looks ok to me. My current hypothesis is that</span><span>
</span><span id="line-475"></span><span>            </span><span class="hs-comment">-- this &quot;adjustment&quot; is needed due to stack manipulation for</span><span>
</span><span id="line-476"></span><span>            </span><span class="hs-comment">-- BRK_FUN in Interpreter.c In any case, this is used only when</span><span>
</span><span id="line-477"></span><span>            </span><span class="hs-comment">-- we trigger a breakpoint.</span><span>
</span><span id="line-478"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682966161"><span class="annot"><span class="annottext">var_depth_ws :: WordOff
</span><a href="#local-6989586621682966161"><span class="hs-identifier hs-var hs-var">var_depth_ws</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#bytesToWords"><span class="hs-identifier hs-var">bytesToWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966154"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966155"><span class="hs-identifier hs-var">depth</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966160"><span class="hs-identifier hs-var">offset</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; WordOff -&gt; WordOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><span class="hs-number">2</span></span><span>
</span><span id="line-479"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Id, WordOff) -&gt; Maybe (Id, WordOff)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966158"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966161"><span class="hs-identifier hs-var">var_depth_ws</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-480"></span><span>
</span><span id="line-481"></span><span class="annot"><a href="GHC.StgToByteCode.html#fvsToEnv"><span class="hs-identifier hs-type">fvsToEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCEnv"><span class="hs-identifier hs-type">BCEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgRhs"><span class="hs-identifier hs-type">CgStgRhs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-482"></span><span class="hs-comment">-- Takes the free variables of a right-hand side, and</span><span>
</span><span id="line-483"></span><span class="hs-comment">-- delivers an ordered list of the local variables that will</span><span>
</span><span id="line-484"></span><span class="hs-comment">-- be captured in the thunk for the RHS</span><span>
</span><span id="line-485"></span><span class="hs-comment">-- The BCEnv argument tells which variables are in the local</span><span>
</span><span id="line-486"></span><span class="hs-comment">-- environment: these are the ones that should be captured</span><span>
</span><span id="line-487"></span><span class="hs-comment">--</span><span>
</span><span id="line-488"></span><span class="hs-comment">-- The code that constructs the thunk, and the code that executes</span><span>
</span><span id="line-489"></span><span class="hs-comment">-- it, have to agree about this layout</span><span>
</span><span id="line-490"></span><span>
</span><span id="line-491"></span><span id="fvsToEnv"><span class="annot"><span class="annottext">fvsToEnv :: Map Id ByteOff -&gt; CgStgRhs -&gt; [Id]
</span><a href="GHC.StgToByteCode.html#fvsToEnv"><span class="hs-identifier hs-var hs-var">fvsToEnv</span></a></span></span><span> </span><span id="local-6989586621682966164"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966164"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621682966165"><span class="annot"><span class="annottext">CgStgRhs
</span><a href="#local-6989586621682966165"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966166"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682966166"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966166"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DIdSet -&gt; [Id]
</span><a href="GHC.Types.Var.Set.html#dVarSetElems"><span class="hs-identifier hs-var">dVarSetElems</span></a></span><span> </span><span class="annot"><span class="annottext">(DIdSet -&gt; [Id]) -&gt; DIdSet -&gt; [Id]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CgStgRhs -&gt; DIdSet
forall (pass :: StgPass).
(XRhsClosure pass ~ DIdSet) =&gt;
GenStgRhs pass -&gt; DIdSet
</span><a href="GHC.Stg.Syntax.html#freeVarsOfRhs"><span class="hs-identifier hs-var">freeVarsOfRhs</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgRhs
</span><a href="#local-6989586621682966165"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-492"></span><span>                       </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966166"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Map Id ByteOff -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#member"><span class="hs-operator hs-var">`Map.member`</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966164"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-493"></span><span>
</span><span id="line-494"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-495"></span><span class="hs-comment">-- schemeE</span><span>
</span><span id="line-496"></span><span>
</span><span id="line-497"></span><span class="hs-comment">-- Returning an unlifted value.</span><span>
</span><span id="line-498"></span><span class="hs-comment">-- Heave it on the stack, SLIDE, and RETURN.</span><span>
</span><span id="line-499"></span><span class="annot"><a href="GHC.StgToByteCode.html#returnUnliftedAtom"><span class="hs-identifier hs-type">returnUnliftedAtom</span></a></span><span>
</span><span id="line-500"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-type">StackDepth</span></a></span><span>
</span><span id="line-501"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#Sequel"><span class="hs-identifier hs-type">Sequel</span></a></span><span>
</span><span id="line-502"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCEnv"><span class="hs-identifier hs-type">BCEnv</span></a></span><span>
</span><span id="line-503"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span>
</span><span id="line-504"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span>
</span><span id="line-505"></span><span id="returnUnliftedAtom"><span class="annot"><span class="annottext">returnUnliftedAtom :: ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; StgArg -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#returnUnliftedAtom"><span class="hs-identifier hs-var hs-var">returnUnliftedAtom</span></a></span></span><span> </span><span id="local-6989586621682966171"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966171"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682966172"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966172"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682966173"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966173"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621682966174"><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621682966174"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-506"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682966175"><span class="annot"><span class="annottext">reps :: [PrimRep]
</span><a href="#local-6989586621682966175"><span class="hs-identifier hs-var hs-var hs-var">reps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StgArg -&gt; [PrimRep]
</span><a href="GHC.Stg.Syntax.html#stgArgRep"><span class="hs-identifier hs-var">stgArgRep</span></a></span><span> </span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621682966174"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-507"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682966177"><span class="annot"><a href="#local-6989586621682966177"><span class="hs-identifier hs-var">push</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966178"><span class="annot"><a href="#local-6989586621682966178"><span class="hs-identifier hs-var">szb</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; Map Id ByteOff -&gt; StgArg -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushAtom"><span class="hs-identifier hs-var">pushAtom</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966171"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966173"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621682966174"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-508"></span><span>    </span><span id="local-6989586621682966180"><span class="annot"><a href="#local-6989586621682966180"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#returnUnliftedReps"><span class="hs-identifier hs-type">returnUnliftedReps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966171"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966172"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966178"><span class="hs-identifier hs-type">szb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966175"><span class="hs-identifier hs-type">reps</span></a></span><span>
</span><span id="line-509"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682966177"><span class="hs-identifier hs-type">push</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966180"><span class="hs-identifier hs-type">ret</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-510"></span><span>
</span><span id="line-511"></span><span class="hs-comment">-- return an unlifted value from the top of the stack</span><span>
</span><span id="line-512"></span><span class="annot"><a href="GHC.StgToByteCode.html#returnUnliftedReps"><span class="hs-identifier hs-type">returnUnliftedReps</span></a></span><span>
</span><span id="line-513"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-type">StackDepth</span></a></span><span>
</span><span id="line-514"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#Sequel"><span class="hs-identifier hs-type">Sequel</span></a></span><span>
</span><span id="line-515"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span>    </span><span class="hs-comment">-- size of the thing we're returning</span><span>
</span><span id="line-516"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCon.html#PrimRep"><span class="hs-identifier hs-type">PrimRep</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- representations</span><span>
</span><span id="line-517"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span>
</span><span id="line-518"></span><span id="returnUnliftedReps"><span class="annot"><span class="annottext">returnUnliftedReps :: ByteOff -&gt; ByteOff -&gt; ByteOff -&gt; [PrimRep] -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#returnUnliftedReps"><span class="hs-identifier hs-var hs-var">returnUnliftedReps</span></a></span></span><span> </span><span id="local-6989586621682966183"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966183"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682966184"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966184"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682966185"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966185"><span class="hs-identifier hs-var">szb</span></a></span></span><span> </span><span id="local-6989586621682966186"><span class="annot"><span class="annottext">[PrimRep]
</span><a href="#local-6989586621682966186"><span class="hs-identifier hs-var">reps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-519"></span><span>    </span><span id="local-6989586621682966187"><span class="annot"><a href="#local-6989586621682966187"><span class="hs-identifier hs-var">profile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BcM Profile
</span><a href="GHC.StgToByteCode.html#getProfile"><span class="hs-identifier hs-var">getProfile</span></a></span><span>
</span><span id="line-520"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682966188"><span class="annot"><a href="#local-6989586621682966188"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Profile -&gt; Platform
</span><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682966187"><span class="hs-identifier hs-var">profile</span></a></span><span>
</span><span id="line-521"></span><span>    </span><span id="local-6989586621682966189"><span class="annot"><a href="#local-6989586621682966189"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682966186"><span class="hs-identifier hs-type">reps</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-522"></span><span>             </span><span class="hs-comment">-- use RETURN for nullary/unary representations</span><span>
</span><span id="line-523"></span><span>             </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr -&gt; BcM (OrdList BCInstr)
forall a. a -&gt; BcM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BCInstr -&gt; OrdList BCInstr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(BCInstr -&gt; OrdList BCInstr) -&gt; BCInstr -&gt; OrdList BCInstr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgRep -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#RETURN"><span class="hs-identifier hs-var">RETURN</span></a></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#V"><span class="hs-identifier hs-var">V</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-524"></span><span>             </span><span class="hs-special">[</span><span id="local-6989586621682966192"><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621682966192"><span class="hs-identifier hs-var">rep</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr -&gt; BcM (OrdList BCInstr)
forall a. a -&gt; BcM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BCInstr -&gt; OrdList BCInstr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">(BCInstr -&gt; OrdList BCInstr) -&gt; BCInstr -&gt; OrdList BCInstr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArgRep -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#RETURN"><span class="hs-identifier hs-var">RETURN</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; PrimRep -&gt; ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#toArgRep"><span class="hs-identifier hs-var">toArgRep</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966188"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621682966192"><span class="hs-identifier hs-var">rep</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-525"></span><span>             </span><span class="hs-comment">-- otherwise use RETURN_TUPLE with a tuple descriptor</span><span>
</span><span id="line-526"></span><span>             </span><span id="local-6989586621682966194"><span class="annot"><span class="annottext">[PrimRep]
</span><a href="#local-6989586621682966194"><span class="hs-identifier hs-var">nv_reps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-527"></span><span>               </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682966195"><span class="annot"><span class="annottext">NativeCallInfo
</span><a href="#local-6989586621682966195"><span class="hs-identifier hs-var hs-var">call_info</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966196"><span class="annot"><span class="annottext">[(PrimRep, ByteOff)]
</span><a href="#local-6989586621682966196"><span class="hs-identifier hs-var hs-var">args_offsets</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Profile
-&gt; NativeCallType
-&gt; ByteOff
-&gt; (PrimRep -&gt; PrimRep)
-&gt; [PrimRep]
-&gt; (NativeCallInfo, [(PrimRep, ByteOff)])
forall a.
Profile
-&gt; NativeCallType
-&gt; ByteOff
-&gt; (a -&gt; PrimRep)
-&gt; [a]
-&gt; (NativeCallInfo, [(a, ByteOff)])
</span><a href="GHC.StgToByteCode.html#layoutNativeCall"><span class="hs-identifier hs-var">layoutNativeCall</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682966187"><span class="hs-identifier hs-var">profile</span></a></span><span> </span><span class="annot"><span class="annottext">NativeCallType
</span><a href="GHC.ByteCode.Types.html#NativeTupleReturn"><span class="hs-identifier hs-var">NativeTupleReturn</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; PrimRep
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">[PrimRep]
</span><a href="#local-6989586621682966194"><span class="hs-identifier hs-var">nv_reps</span></a></span><span>
</span><span id="line-528"></span><span>               </span><span id="local-6989586621682966200"><span class="annot"><a href="#local-6989586621682966200"><span class="hs-identifier hs-var">tuple_bco</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([FFIInfo] -&gt; ProtoBCO Name) -&gt; BcM (ProtoBCO Name)
</span><a href="GHC.StgToByteCode.html#emitBc"><span class="hs-identifier hs-var">emitBc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform
-&gt; NativeCallInfo
-&gt; [(PrimRep, ByteOff)]
-&gt; [FFIInfo]
-&gt; ProtoBCO Name
</span><a href="GHC.StgToByteCode.html#tupleBCO"><span class="hs-identifier hs-var">tupleBCO</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966188"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">NativeCallInfo
</span><a href="#local-6989586621682966195"><span class="hs-identifier hs-var">call_info</span></a></span><span> </span><span class="annot"><span class="annottext">[(PrimRep, ByteOff)]
</span><a href="#local-6989586621682966196"><span class="hs-identifier hs-var">args_offsets</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-529"></span><span>               </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html#PUSH_UBX"><span class="hs-identifier hs-type">PUSH_UBX</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.ByteCode.Asm.html#mkNativeCallInfoLit"><span class="hs-identifier hs-type">mkNativeCallInfoLit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966188"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966195"><span class="hs-identifier hs-type">call_info</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-type">`consOL`</span></a></span><span>
</span><span id="line-530"></span><span>                        </span><span class="annot"><a href="GHC.ByteCode.Instr.html#PUSH_BCO"><span class="hs-identifier hs-type">PUSH_BCO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966200"><span class="hs-identifier hs-type">tuple_bco</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-type">`consOL`</span></a></span><span>
</span><span id="line-531"></span><span>                        </span><span class="annot"><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-type">unitOL</span></a></span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html#RETURN_TUPLE"><span class="hs-identifier hs-type">RETURN_TUPLE</span></a></span><span>
</span><span id="line-532"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#mkSlideB"><span class="hs-identifier hs-type">mkSlideB</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966188"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966185"><span class="hs-identifier hs-type">szb</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682966183"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">-</span></span><span> </span><span class="annot"><a href="#local-6989586621682966184"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- clear to sequel</span><span>
</span><span id="line-533"></span><span>             </span><span class="annot"><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-type">`consOL`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966189"><span class="hs-identifier hs-type">ret</span></a></span><span class="hs-special">)</span><span>                 </span><span class="hs-comment">-- go</span><span>
</span><span id="line-534"></span><span>
</span><span id="line-535"></span><span class="hs-comment">-- construct and return an unboxed tuple</span><span>
</span><span id="line-536"></span><span class="annot"><a href="GHC.StgToByteCode.html#returnUnboxedTuple"><span class="hs-identifier hs-type">returnUnboxedTuple</span></a></span><span>
</span><span id="line-537"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-type">StackDepth</span></a></span><span>
</span><span id="line-538"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#Sequel"><span class="hs-identifier hs-type">Sequel</span></a></span><span>
</span><span id="line-539"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCEnv"><span class="hs-identifier hs-type">BCEnv</span></a></span><span>
</span><span id="line-540"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-541"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span>
</span><span id="line-542"></span><span id="returnUnboxedTuple"><span class="annot"><span class="annottext">returnUnboxedTuple :: ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; [StgArg] -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#returnUnboxedTuple"><span class="hs-identifier hs-var hs-var">returnUnboxedTuple</span></a></span></span><span> </span><span id="local-6989586621682966208"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966208"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682966209"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966209"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682966210"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966210"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621682966211"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682966211"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-543"></span><span>    </span><span id="local-6989586621682966212"><span class="annot"><a href="#local-6989586621682966212"><span class="hs-identifier hs-var">profile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BcM Profile
</span><a href="GHC.StgToByteCode.html#getProfile"><span class="hs-identifier hs-var">getProfile</span></a></span><span>
</span><span id="line-544"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682966213"><span class="annot"><a href="#local-6989586621682966213"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Profile -&gt; Platform
</span><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682966212"><span class="hs-identifier hs-var">profile</span></a></span><span>
</span><span id="line-545"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682966214"><span class="annot"><a href="#local-6989586621682966214"><span class="hs-identifier hs-var">call_info</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966215"><span class="annot"><a href="#local-6989586621682966215"><span class="hs-identifier hs-var">tuple_components</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#layoutNativeCall"><span class="hs-identifier hs-type">layoutNativeCall</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966212"><span class="hs-identifier hs-type">profile</span></a></span><span>
</span><span id="line-546"></span><span>                                                         </span><span class="annot"><a href="GHC.ByteCode.Types.html#NativeTupleReturn"><span class="hs-identifier hs-type">NativeTupleReturn</span></a></span><span>
</span><span id="line-547"></span><span>                                                         </span><span class="annot"><a href="#local-6989586621682966208"><span class="hs-identifier hs-type">d</span></a></span><span>
</span><span id="line-548"></span><span>                                                         </span><span class="annot"><a href="GHC.Stg.Syntax.html#stgArgRepU"><span class="hs-identifier hs-type">stgArgRepU</span></a></span><span>
</span><span id="line-549"></span><span>                                                         </span><span class="annot"><a href="#local-6989586621682966211"><span class="hs-identifier hs-type">es</span></a></span><span>
</span><span id="line-550"></span><span>        </span><span id="local-6989586621682966217"><span class="annot"><a href="#local-6989586621682966217"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-identifier">_</span></span><span>   </span><span id="local-6989586621682966218"><span class="annot"><span class="annottext">[OrdList BCInstr]
</span><a href="#local-6989586621682966218"><span class="hs-identifier hs-var">pushes</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[OrdList BCInstr] -&gt; BcM [OrdList BCInstr]
forall a. a -&gt; BcM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[OrdList BCInstr] -&gt; [OrdList BCInstr]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[OrdList BCInstr]
</span><a href="#local-6989586621682966218"><span class="hs-identifier hs-var">pushes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-551"></span><span>        </span><span class="annot"><a href="#local-6989586621682966217"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682966219"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966219"><span class="hs-identifier hs-var">dd</span></a></span></span><span> </span><span id="local-6989586621682966220"><span class="annot"><span class="annottext">[OrdList BCInstr]
</span><a href="#local-6989586621682966220"><span class="hs-identifier hs-var">pushes</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682966221"><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621682966221"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966222"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966222"><span class="hs-identifier hs-var">off</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682966223"><span class="annot"><span class="annottext">[(StgArg, ByteOff)]
</span><a href="#local-6989586621682966223"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682966224"><span class="annot"><a href="#local-6989586621682966224"><span class="hs-identifier hs-var">push</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966225"><span class="annot"><a href="#local-6989586621682966225"><span class="hs-identifier hs-var">szb</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; Map Id ByteOff -&gt; StgArg -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushAtom"><span class="hs-identifier hs-var">pushAtom</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966219"><span class="hs-identifier hs-var">dd</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966210"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621682966221"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-552"></span><span>                                         </span><span class="annot"><a href="GHC.Utils.Panic.Plain.html#massert"><span class="hs-identifier hs-type">massert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682966222"><span class="hs-identifier hs-type">off</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="#local-6989586621682966219"><span class="hs-identifier hs-type">dd</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><a href="#local-6989586621682966225"><span class="hs-identifier hs-type">szb</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-553"></span><span>                                         </span><span class="annot"><a href="#local-6989586621682966217"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682966219"><span class="hs-identifier hs-type">dd</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><a href="#local-6989586621682966225"><span class="hs-identifier hs-type">szb</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682966224"><span class="hs-identifier hs-type">push</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><a href="#local-6989586621682966220"><span class="hs-identifier hs-type">pushes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682966223"><span class="hs-identifier hs-type">cs</span></a></span><span>
</span><span id="line-554"></span><span>    </span><span id="local-6989586621682966227"><span class="annot"><a href="#local-6989586621682966227"><span class="hs-identifier hs-var">pushes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682966217"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966208"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621682966215"><span class="hs-identifier hs-type">tuple_components</span></a></span><span>
</span><span id="line-555"></span><span>
</span><span id="line-556"></span><span>    </span><span id="local-6989586621682966228"><span class="annot"><a href="#local-6989586621682966228"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#returnUnliftedReps"><span class="hs-identifier hs-type">returnUnliftedReps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966208"><span class="hs-identifier hs-type">d</span></a></span><span>
</span><span id="line-557"></span><span>                              </span><span class="annot"><a href="#local-6989586621682966209"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-558"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#wordsToBytes"><span class="hs-identifier hs-type">wordsToBytes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966213"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#nativeCallSize"><span class="hs-identifier hs-var">nativeCallSize</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966214"><span class="hs-identifier hs-type">call_info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-559"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#stgArgRepU"><span class="hs-identifier hs-type">stgArgRepU</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966211"><span class="hs-identifier hs-type">es</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-560"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">mconcat</span></span><span> </span><span class="annot"><a href="#local-6989586621682966227"><span class="hs-identifier hs-type">pushes</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966228"><span class="hs-identifier hs-type">ret</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-561"></span><span>
</span><span id="line-562"></span><span class="hs-comment">-- Compile code to apply the given expression to the remaining args</span><span>
</span><span id="line-563"></span><span class="hs-comment">-- on the stack, returning a HNF.</span><span>
</span><span id="line-564"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-type">schemeE</span></a></span><span>
</span><span id="line-565"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-type">StackDepth</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#Sequel"><span class="hs-identifier hs-type">Sequel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCEnv"><span class="hs-identifier hs-type">BCEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgExpr"><span class="hs-identifier hs-type">CgStgExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span>
</span><span id="line-566"></span><span id="schemeE"><span class="annot"><span class="annottext">schemeE :: ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; CgStgExpr -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var hs-var">schemeE</span></a></span></span><span> </span><span id="local-6989586621682966230"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966230"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682966231"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966231"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682966232"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966232"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgLit"><span class="hs-identifier hs-type">StgLit</span></a></span><span> </span><span id="local-6989586621682966234"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682966234"><span class="hs-identifier hs-var">lit</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; StgArg -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#returnUnliftedAtom"><span class="hs-identifier hs-var">returnUnliftedAtom</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966230"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966231"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966232"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Literal -&gt; StgArg
</span><a href="GHC.Stg.Syntax.html#StgLitArg"><span class="hs-identifier hs-var">StgLitArg</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682966234"><span class="hs-identifier hs-var">lit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-567"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span id="local-6989586621682966236"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966236"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682966237"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966237"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682966238"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966238"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgApp"><span class="hs-identifier hs-type">StgApp</span></a></span><span> </span><span id="local-6989586621682966240"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966240"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-568"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Bool
Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnliftedType"><span class="hs-identifier hs-var">isUnliftedType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966240"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; StgArg -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#returnUnliftedAtom"><span class="hs-identifier hs-var">returnUnliftedAtom</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966236"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966237"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966238"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; StgArg
</span><a href="GHC.Stg.Syntax.html#StgVarArg"><span class="hs-identifier hs-var">StgVarArg</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966240"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-569"></span><span class="hs-comment">-- Delegate tail-calls to schemeT.</span><span>
</span><span id="line-570"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span id="local-6989586621682966243"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966243"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682966244"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966244"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682966245"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966245"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621682966246"><span class="annot"><span class="annottext">e :: CgStgExpr
</span><a href="#local-6989586621682966246"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgApp"><span class="hs-identifier hs-type">StgApp</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; CgStgExpr -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#schemeT"><span class="hs-identifier hs-var">schemeT</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966243"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966244"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966245"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682966246"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-571"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span id="local-6989586621682966248"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966248"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682966249"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966249"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682966250"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966250"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621682966251"><span class="annot"><span class="annottext">e :: CgStgExpr
</span><a href="#local-6989586621682966251"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgConApp"><span class="hs-identifier hs-type">StgConApp</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; CgStgExpr -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#schemeT"><span class="hs-identifier hs-var">schemeT</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966248"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966249"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966250"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682966251"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-572"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span id="local-6989586621682966252"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966252"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682966253"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966253"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682966254"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966254"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621682966255"><span class="annot"><span class="annottext">e :: CgStgExpr
</span><a href="#local-6989586621682966255"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgOpApp"><span class="hs-identifier hs-type">StgOpApp</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; CgStgExpr -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#schemeT"><span class="hs-identifier hs-var">schemeT</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966252"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966253"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966254"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682966255"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-573"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span id="local-6989586621682966257"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966257"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682966258"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966258"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682966259"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966259"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgLetNoEscape"><span class="hs-identifier hs-type">StgLetNoEscape</span></a></span><span> </span><span id="local-6989586621682966261"><span class="annot"><span class="annottext">XLetNoEscape 'CodeGen
</span><a href="#local-6989586621682966261"><span class="hs-identifier hs-var">xlet</span></a></span></span><span> </span><span id="local-6989586621682966262"><span class="annot"><span class="annottext">GenStgBinding 'CodeGen
</span><a href="#local-6989586621682966262"><span class="hs-identifier hs-var">bnd</span></a></span></span><span> </span><span id="local-6989586621682966263"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682966263"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-574"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; CgStgExpr -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966257"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966258"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966259"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XLet 'CodeGen -&gt; GenStgBinding 'CodeGen -&gt; CgStgExpr -&gt; CgStgExpr
forall (pass :: StgPass).
XLet pass
-&gt; GenStgBinding pass -&gt; GenStgExpr pass -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgLet"><span class="hs-identifier hs-var">StgLet</span></a></span><span> </span><span class="annot"><span class="annottext">XLetNoEscape 'CodeGen
XLet 'CodeGen
</span><a href="#local-6989586621682966261"><span class="hs-identifier hs-var">xlet</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'CodeGen
</span><a href="#local-6989586621682966262"><span class="hs-identifier hs-var">bnd</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682966263"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-575"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span id="local-6989586621682966265"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966265"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682966266"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966266"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682966267"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966267"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgLet"><span class="hs-identifier hs-type">StgLet</span></a></span><span> </span><span id="local-6989586621682966268"><span class="annot"><span class="annottext">XLet 'CodeGen
</span><a href="#local-6989586621682966268"><span class="hs-identifier hs-var">_xlet</span></a></span></span><span>
</span><span id="line-576"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgNonRec"><span class="hs-identifier hs-type">StgNonRec</span></a></span><span> </span><span id="local-6989586621682966269"><span class="annot"><span class="annottext">BinderP 'CodeGen
</span><a href="#local-6989586621682966269"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRhsCon"><span class="hs-identifier hs-type">StgRhsCon</span></a></span><span> </span><span id="local-6989586621682966270"><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621682966270"><span class="hs-identifier hs-var">_cc</span></a></span></span><span> </span><span id="local-6989586621682966271"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682966271"><span class="hs-identifier hs-var">data_con</span></a></span></span><span> </span><span id="local-6989586621682966272"><span class="annot"><span class="annottext">ConstructorNumber
</span><a href="#local-6989586621682966272"><span class="hs-identifier hs-var">_cnum</span></a></span></span><span> </span><span id="local-6989586621682966273"><span class="annot"><span class="annottext">[StgTickish]
</span><a href="#local-6989586621682966273"><span class="hs-identifier hs-var">_ticks</span></a></span></span><span> </span><span id="local-6989586621682966274"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682966274"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621682966275"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682966275"><span class="hs-identifier hs-var">_typ</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-577"></span><span>                      </span><span id="local-6989586621682966276"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682966276"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-578"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- Special case for a non-recursive let whose RHS is a</span><span>
</span><span id="line-579"></span><span>        </span><span class="hs-comment">-- saturated constructor application.</span><span>
</span><span id="line-580"></span><span>        </span><span class="hs-comment">-- Just allocate the constructor and carry on</span><span>
</span><span id="line-581"></span><span>        </span><span id="local-6989586621682966277"><span class="annot"><a href="#local-6989586621682966277"><span class="hs-identifier hs-var">alloc_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff
-&gt; Map Id ByteOff
-&gt; DataCon
-&gt; [StgArg]
-&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#mkConAppCode"><span class="hs-identifier hs-var">mkConAppCode</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966265"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966266"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966267"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682966271"><span class="hs-identifier hs-var">data_con</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682966274"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-582"></span><span>        </span><span id="local-6989586621682966279"><span class="annot"><a href="#local-6989586621682966279"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-type">getDynFlags</span></a></span><span>
</span><span id="line-583"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682966282"><span class="annot"><a href="#local-6989586621682966282"><span class="hs-identifier hs-var hs-var">d2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966265"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordSize"><span class="hs-identifier hs-var">wordSize</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966279"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-584"></span><span>        </span><span id="local-6989586621682966283"><span class="annot"><a href="#local-6989586621682966283"><span class="hs-identifier hs-var">body_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-type">schemeE</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966282"><span class="hs-identifier hs-type">d2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966266"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-type">Map.insert</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966269"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966282"><span class="hs-identifier hs-type">d2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966267"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682966276"><span class="hs-identifier hs-type">body</span></a></span><span>
</span><span id="line-585"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682966277"><span class="hs-identifier hs-type">alloc_code</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966283"><span class="hs-identifier hs-type">body_code</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-586"></span><span class="hs-comment">-- General case for let.  Generates correct, if inefficient, code in</span><span>
</span><span id="line-587"></span><span class="hs-comment">-- all situations.</span><span>
</span><span id="line-588"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span id="local-6989586621682966285"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966285"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682966286"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966286"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682966287"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966287"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgLet"><span class="hs-identifier hs-type">StgLet</span></a></span><span> </span><span id="local-6989586621682966288"><span class="annot"><span class="annottext">XLet 'CodeGen
</span><a href="#local-6989586621682966288"><span class="hs-identifier hs-var">_ext</span></a></span></span><span> </span><span id="local-6989586621682966289"><span class="annot"><span class="annottext">GenStgBinding 'CodeGen
</span><a href="#local-6989586621682966289"><span class="hs-identifier hs-var">binds</span></a></span></span><span> </span><span id="local-6989586621682966290"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682966290"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-589"></span><span>     </span><span id="local-6989586621682966291"><span class="annot"><a href="#local-6989586621682966291"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.DynFlags.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; Platform) -&gt; BcM DynFlags -&gt; BcM Platform
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">BcM DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-590"></span><span>     </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682966292"><span class="annot"><a href="#local-6989586621682966292"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682966293"><span class="annot"><a href="#local-6989586621682966293"><span class="hs-identifier hs-var">rhss</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682966289"><span class="hs-identifier hs-type">binds</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgNonRec"><span class="hs-identifier hs-type">StgNonRec</span></a></span><span> </span><span id="local-6989586621682966294"><span class="annot"><span class="annottext">BinderP 'CodeGen
</span><a href="#local-6989586621682966294"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682966295"><span class="annot"><span class="annottext">CgStgRhs
</span><a href="#local-6989586621682966295"><span class="hs-identifier hs-var">rhs</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">Id
BinderP 'CodeGen
</span><a href="#local-6989586621682966294"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="annot"><span class="annottext">CgStgRhs
</span><a href="#local-6989586621682966295"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-591"></span><span>                                   </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRec"><span class="hs-identifier hs-type">StgRec</span></a></span><span> </span><span id="local-6989586621682966296"><span class="annot"><span class="annottext">[(BinderP 'CodeGen, CgStgRhs)]
</span><a href="#local-6989586621682966296"><span class="hs-identifier hs-var">xs_n_rhss</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(Id, CgStgRhs)] -&gt; ([Id], [CgStgRhs])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">[(Id, CgStgRhs)]
[(BinderP 'CodeGen, CgStgRhs)]
</span><a href="#local-6989586621682966296"><span class="hs-identifier hs-var">xs_n_rhss</span></a></span><span>
</span><span id="line-592"></span><span>         </span><span id="local-6989586621682966297"><span class="annot"><a href="#local-6989586621682966297"><span class="hs-identifier hs-var hs-var">n_binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; WordOff
forall i a. Num i =&gt; [a] -&gt; i
</span><span class="hs-identifier hs-var">genericLength</span></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682966292"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-593"></span><span>
</span><span id="line-594"></span><span>         </span><span id="local-6989586621682966298"><span class="annot"><a href="#local-6989586621682966298"><span class="hs-identifier hs-var hs-var">fvss</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CgStgRhs -&gt; [Id]) -&gt; [CgStgRhs] -&gt; [[Id]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Id ByteOff -&gt; CgStgRhs -&gt; [Id]
</span><a href="GHC.StgToByteCode.html#fvsToEnv"><span class="hs-identifier hs-var">fvsToEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966299"><span class="hs-identifier hs-var">p'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CgStgRhs]
</span><a href="#local-6989586621682966293"><span class="hs-identifier hs-var">rhss</span></a></span><span>
</span><span id="line-595"></span><span>
</span><span id="line-596"></span><span>         </span><span class="hs-comment">-- Sizes of free vars</span><span>
</span><span id="line-597"></span><span>         </span><span id="local-6989586621682966300"><span class="annot"><a href="#local-6989586621682966300"><span class="hs-identifier hs-var hs-var">size_w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Id -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#idSizeW"><span class="hs-identifier hs-var">idSizeW</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966291"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-598"></span><span>         </span><span id="local-6989586621682966301"><span class="annot"><a href="#local-6989586621682966301"><span class="hs-identifier hs-var hs-var">sizes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Id] -&gt; WordOff) -&gt; [[Id]] -&gt; [WordOff]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682966302"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682966302"><span class="hs-identifier hs-var">rhs_fvs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[WordOff] -&gt; WordOff
forall a. Num a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">sum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Id -&gt; WordOff) -&gt; [Id] -&gt; [WordOff]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; WordOff
</span><a href="#local-6989586621682966300"><span class="hs-identifier hs-var">size_w</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682966302"><span class="hs-identifier hs-var">rhs_fvs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[Id]]
</span><a href="#local-6989586621682966298"><span class="hs-identifier hs-var">fvss</span></a></span><span>
</span><span id="line-599"></span><span>
</span><span id="line-600"></span><span>         </span><span class="hs-comment">-- the arity of each rhs</span><span>
</span><span id="line-601"></span><span>         </span><span id="local-6989586621682966303"><span class="annot"><a href="#local-6989586621682966303"><span class="hs-identifier hs-var hs-var">arities</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CgStgRhs -&gt; HalfWord) -&gt; [CgStgRhs] -&gt; [HalfWord]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; HalfWord
forall i a. Num i =&gt; [a] -&gt; i
</span><span class="hs-identifier hs-var">genericLength</span></span><span> </span><span class="annot"><span class="annottext">([Id] -&gt; HalfWord) -&gt; (CgStgRhs -&gt; [Id]) -&gt; CgStgRhs -&gt; HalfWord
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">([Id], CgStgExpr) -&gt; [Id]
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(([Id], CgStgExpr) -&gt; [Id])
-&gt; (CgStgRhs -&gt; ([Id], CgStgExpr)) -&gt; CgStgRhs -&gt; [Id]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CgStgRhs -&gt; ([Id], CgStgExpr)
</span><a href="GHC.StgToByteCode.html#collect"><span class="hs-identifier hs-var">collect</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CgStgRhs]
</span><a href="#local-6989586621682966293"><span class="hs-identifier hs-var">rhss</span></a></span><span>
</span><span id="line-602"></span><span>
</span><span id="line-603"></span><span>         </span><span class="hs-comment">-- This p', d' defn is safe because all the items being pushed</span><span>
</span><span id="line-604"></span><span>         </span><span class="hs-comment">-- are ptrs, so all have size 1 word.  d' and p' reflect the stack</span><span>
</span><span id="line-605"></span><span>         </span><span class="hs-comment">-- after the closures have been allocated in the heap (but not</span><span>
</span><span id="line-606"></span><span>         </span><span class="hs-comment">-- filled in), and pointers to them parked on the stack.</span><span>
</span><span id="line-607"></span><span>         </span><span id="local-6989586621682966305"><span class="annot"><a href="#local-6989586621682966305"><span class="hs-identifier hs-var hs-var">offsets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; [ByteOff] -&gt; [ByteOff]
</span><a href="GHC.StgToByteCode.html#mkStackOffsets"><span class="hs-identifier hs-var">mkStackOffsets</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966285"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WordOff -&gt; ByteOff -&gt; [ByteOff]
forall i a. Integral i =&gt; i -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">genericReplicate</span></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966297"><span class="hs-identifier hs-var">n_binds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordSize"><span class="hs-identifier hs-var">wordSize</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966291"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-608"></span><span>         </span><span id="local-6989586621682966299"><span class="annot"><a href="#local-6989586621682966299"><span class="hs-identifier hs-var hs-var">p'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Id, ByteOff)] -&gt; Map Id ByteOff -&gt; Map Id ByteOff
forall key elt.
Ord key =&gt;
[(key, elt)] -&gt; Map key elt -&gt; Map key elt
</span><a href="GHC.Data.FiniteMap.html#insertList"><span class="hs-identifier hs-var">Map.insertList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; [ByteOff] -&gt; [(Id, ByteOff)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="#local-6989586621682966307"><span class="hs-identifier hs-var">zipE</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682966292"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteOff]
</span><a href="#local-6989586621682966305"><span class="hs-identifier hs-var">offsets</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966287"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-609"></span><span>         </span><span id="local-6989586621682966308"><span class="annot"><a href="#local-6989586621682966308"><span class="hs-identifier hs-var hs-var">d'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966285"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; WordOff -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordsToBytes"><span class="hs-identifier hs-var">wordsToBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966291"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966297"><span class="hs-identifier hs-var">n_binds</span></a></span><span>
</span><span id="line-610"></span><span>         </span><span id="local-6989586621682966307"><span class="annot"><a href="#local-6989586621682966307"><span class="hs-identifier hs-var hs-var">zipE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [a] -&gt; [b] -&gt; [(a, b)]
forall a b. HasDebugCallStack =&gt; String -&gt; [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="GHC.Utils.Misc.html#zipEqual"><span class="hs-identifier hs-var">zipEqual</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;schemeE&quot;</span></span><span>
</span><span id="line-611"></span><span>
</span><span id="line-612"></span><span>         </span><span class="hs-comment">-- ToDo: don't build thunks for things with no free variables</span><span>
</span><span id="line-613"></span><span>         </span><span class="annot"><a href="#local-6989586621682966311"><span class="hs-identifier hs-type">build_thunk</span></a></span><span>
</span><span id="line-614"></span><span>             </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-type">StackDepth</span></a></span><span>
</span><span id="line-615"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-616"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a></span><span>
</span><span id="line-617"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html#ProtoBCO"><span class="hs-identifier hs-type">ProtoBCO</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-618"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a></span><span>
</span><span id="line-619"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#HalfWord"><span class="hs-identifier hs-type">HalfWord</span></a></span><span>
</span><span id="line-620"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span>
</span><span id="line-621"></span><span>         </span><span id="local-6989586621682966311"><span class="annot"><a href="#local-6989586621682966311"><span class="hs-identifier hs-var hs-var">build_thunk</span></a></span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621682966312"><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966312"><span class="hs-identifier hs-var">size</span></a></span></span><span> </span><span id="local-6989586621682966313"><span class="annot"><span class="annottext">ProtoBCO Name
</span><a href="#local-6989586621682966313"><span class="hs-identifier hs-var">bco</span></a></span></span><span> </span><span id="local-6989586621682966314"><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966314"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span id="local-6989586621682966315"><span class="annot"><span class="annottext">HalfWord
</span><a href="#local-6989586621682966315"><span class="hs-identifier hs-var">arity</span></a></span></span><span>
</span><span id="line-622"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr -&gt; BcM (OrdList BCInstr)
forall a. a -&gt; BcM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProtoBCO Name -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_BCO"><span class="hs-identifier hs-var">PUSH_BCO</span></a></span><span> </span><span class="annot"><span class="annottext">ProtoBCO Name
</span><a href="#local-6989586621682966313"><span class="hs-identifier hs-var">bco</span></a></span><span> </span><span class="annot"><span class="annottext">BCInstr -&gt; OrdList BCInstr -&gt; OrdList BCInstr
forall a. a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-var">`consOL`</span></a></span><span> </span><span class="annot"><span class="annottext">BCInstr -&gt; OrdList BCInstr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WordOff -&gt; HalfWord -&gt; BCInstr
</span><a href="#local-6989586621682966316"><span class="hs-identifier hs-var">mkap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966314"><span class="hs-identifier hs-var">off</span></a></span><span class="annot"><span class="annottext">WordOff -&gt; WordOff -&gt; WordOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966312"><span class="hs-identifier hs-var">size</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WordOff -&gt; HalfWord
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966312"><span class="hs-identifier hs-var">size</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-623"></span><span>           </span><span class="hs-keyword">where</span><span>
</span><span id="line-624"></span><span>                </span><span id="local-6989586621682966316"><span class="annot"><span class="annottext">mkap :: WordOff -&gt; HalfWord -&gt; BCInstr
</span><a href="#local-6989586621682966316"><span class="hs-identifier hs-var hs-var">mkap</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HalfWord
</span><a href="#local-6989586621682966315"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">HalfWord -&gt; HalfWord -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">HalfWord
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; HalfWord -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#MKAP"><span class="hs-identifier hs-var">MKAP</span></a></span><span>
</span><span id="line-625"></span><span>                     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; HalfWord -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#MKPAP"><span class="hs-identifier hs-var">MKPAP</span></a></span><span>
</span><span id="line-626"></span><span>         </span><span class="annot"><a href="#local-6989586621682966311"><span class="hs-identifier hs-var">build_thunk</span></a></span><span> </span><span id="local-6989586621682966319"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966319"><span class="hs-identifier hs-var">dd</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682966320"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966320"><span class="hs-identifier hs-var">fv</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682966321"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682966321"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682966322"><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966322"><span class="hs-identifier hs-var">size</span></a></span></span><span> </span><span id="local-6989586621682966323"><span class="annot"><span class="annottext">ProtoBCO Name
</span><a href="#local-6989586621682966323"><span class="hs-identifier hs-var">bco</span></a></span></span><span> </span><span id="local-6989586621682966324"><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966324"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span id="local-6989586621682966325"><span class="annot"><span class="annottext">HalfWord
</span><a href="#local-6989586621682966325"><span class="hs-identifier hs-var">arity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-627"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682966326"><span class="annot"><a href="#local-6989586621682966326"><span class="hs-identifier hs-var">push_code</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966327"><span class="annot"><a href="#local-6989586621682966327"><span class="hs-identifier hs-var">pushed_szb</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; Map Id ByteOff -&gt; StgArg -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushAtom"><span class="hs-identifier hs-var">pushAtom</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966319"><span class="hs-identifier hs-var">dd</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966299"><span class="hs-identifier hs-var">p'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; StgArg
</span><a href="GHC.Stg.Syntax.html#StgVarArg"><span class="hs-identifier hs-var">StgVarArg</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966320"><span class="hs-identifier hs-var">fv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-628"></span><span>              </span><span id="local-6989586621682966328"><span class="annot"><a href="#local-6989586621682966328"><span class="hs-identifier hs-var">more_push_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-629"></span><span>                  </span><span class="annot"><a href="#local-6989586621682966311"><span class="hs-identifier hs-type">build_thunk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682966319"><span class="hs-identifier hs-type">dd</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><a href="#local-6989586621682966327"><span class="hs-identifier hs-type">pushed_szb</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682966321"><span class="hs-identifier hs-type">fvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966322"><span class="hs-identifier hs-type">size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966323"><span class="hs-identifier hs-type">bco</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966324"><span class="hs-identifier hs-type">off</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966325"><span class="hs-identifier hs-type">arity</span></a></span><span>
</span><span id="line-630"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682966326"><span class="hs-identifier hs-type">push_code</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966328"><span class="hs-identifier hs-type">more_push_code</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-631"></span><span>
</span><span id="line-632"></span><span>         </span><span id="local-6989586621682966329"><span class="annot"><a href="#local-6989586621682966329"><span class="hs-identifier hs-var hs-var">alloc_code</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[BCInstr] -&gt; OrdList BCInstr
forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(WordOff -&gt; HalfWord -&gt; BCInstr)
-&gt; [WordOff] -&gt; [HalfWord] -&gt; [BCInstr]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; HalfWord -&gt; BCInstr
</span><a href="#local-6989586621682966330"><span class="hs-identifier hs-var">mkAlloc</span></a></span><span> </span><span class="annot"><span class="annottext">[WordOff]
</span><a href="#local-6989586621682966301"><span class="hs-identifier hs-var">sizes</span></a></span><span> </span><span class="annot"><span class="annottext">[HalfWord]
</span><a href="#local-6989586621682966303"><span class="hs-identifier hs-var">arities</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-633"></span><span>           </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682966330"><span class="annot"><span class="annottext">mkAlloc :: WordOff -&gt; HalfWord -&gt; BCInstr
</span><a href="#local-6989586621682966330"><span class="hs-identifier hs-var hs-var">mkAlloc</span></a></span></span><span> </span><span id="local-6989586621682966331"><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966331"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span class="annot"><span class="annottext">HalfWord
</span><span class="hs-number">0</span></span><span>
</span><span id="line-634"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682966332"><span class="hs-identifier hs-var">is_tick</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HalfWord -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#ALLOC_AP_NOUPD"><span class="hs-identifier hs-var">ALLOC_AP_NOUPD</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WordOff -&gt; HalfWord
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966331"><span class="hs-identifier hs-var">sz</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-635"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HalfWord -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#ALLOC_AP"><span class="hs-identifier hs-var">ALLOC_AP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WordOff -&gt; HalfWord
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966331"><span class="hs-identifier hs-var">sz</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-636"></span><span>                 </span><span class="annot"><a href="#local-6989586621682966330"><span class="hs-identifier hs-var">mkAlloc</span></a></span><span> </span><span id="local-6989586621682966335"><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966335"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span id="local-6989586621682966336"><span class="annot"><span class="annottext">HalfWord
</span><a href="#local-6989586621682966336"><span class="hs-identifier hs-var">arity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HalfWord -&gt; HalfWord -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#ALLOC_PAP"><span class="hs-identifier hs-var">ALLOC_PAP</span></a></span><span> </span><span class="annot"><span class="annottext">HalfWord
</span><a href="#local-6989586621682966336"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WordOff -&gt; HalfWord
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966335"><span class="hs-identifier hs-var">sz</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-637"></span><span>
</span><span id="line-638"></span><span>         </span><span id="local-6989586621682966332"><span class="annot"><a href="#local-6989586621682966332"><span class="hs-identifier hs-var hs-var">is_tick</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'CodeGen
</span><a href="#local-6989586621682966289"><span class="hs-identifier hs-var">binds</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-639"></span><span>                     </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgNonRec"><span class="hs-identifier hs-type">StgNonRec</span></a></span><span> </span><span id="local-6989586621682966338"><span class="annot"><span class="annottext">BinderP 'CodeGen
</span><a href="#local-6989586621682966338"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="annot"><span class="annottext">CgStgRhs
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; FastString
</span><a href="GHC.Types.Name.Occurrence.html#occNameFS"><span class="hs-identifier hs-var">occNameFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; OccName
forall a. NamedThing a =&gt; a -&gt; OccName
</span><a href="GHC.Types.Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
BinderP 'CodeGen
</span><a href="#local-6989586621682966338"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FastString -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="GHC.StgToByteCode.html#tickFS"><span class="hs-identifier hs-var">tickFS</span></a></span><span>
</span><span id="line-640"></span><span>                     </span><span id="local-6989586621682966342"><span class="annot"><span class="annottext">GenStgBinding 'CodeGen
</span><a href="#local-6989586621682966342"><span class="hs-identifier hs-var">_other</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-641"></span><span>
</span><span id="line-642"></span><span>         </span><span id="local-6989586621682966346"><span class="annot"><a href="#local-6989586621682966346"><span class="hs-identifier hs-var hs-var">compile_bind</span></a></span></span><span> </span><span id="local-6989586621682966347"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966347"><span class="hs-identifier hs-var">d'</span></a></span></span><span> </span><span id="local-6989586621682966348"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682966348"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span id="local-6989586621682966349"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682966349"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682966350"><span class="annot"><span class="annottext">CgStgRhs
</span><a href="#local-6989586621682966350"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-glyph">::</span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgRhs"><span class="hs-identifier hs-type">CgStgRhs</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682966351"><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966351"><span class="hs-identifier hs-var">size</span></a></span></span><span> </span><span id="local-6989586621682966352"><span class="annot"><span class="annottext">HalfWord
</span><a href="#local-6989586621682966352"><span class="hs-identifier hs-var">arity</span></a></span></span><span> </span><span id="local-6989586621682966353"><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966353"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-643"></span><span>                </span><span id="local-6989586621682966354"><span class="annot"><a href="#local-6989586621682966354"><span class="hs-identifier hs-var">bco</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; (Name, CgStgRhs) -&gt; BcM (ProtoBCO Name)
</span><a href="GHC.StgToByteCode.html#schemeR"><span class="hs-identifier hs-var">schemeR</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682966348"><span class="hs-identifier hs-var">fvs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Name
forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682966349"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">CgStgRhs
</span><a href="#local-6989586621682966350"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-644"></span><span>                </span><span class="annot"><a href="#local-6989586621682966311"><span class="hs-identifier hs-type">build_thunk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966347"><span class="hs-identifier hs-type">d'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966348"><span class="hs-identifier hs-type">fvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966351"><span class="hs-identifier hs-type">size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966354"><span class="hs-identifier hs-type">bco</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966353"><span class="hs-identifier hs-type">off</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966352"><span class="hs-identifier hs-type">arity</span></a></span><span>
</span><span id="line-645"></span><span>
</span><span id="line-646"></span><span>         </span><span id="local-6989586621682966355"><span class="annot"><a href="#local-6989586621682966355"><span class="hs-identifier hs-var hs-var">compile_binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-647"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; [Id]
-&gt; Id
-&gt; CgStgRhs
-&gt; WordOff
-&gt; HalfWord
-&gt; WordOff
-&gt; BcM (OrdList BCInstr)
forall {a}.
NamedThing a =&gt;
ByteOff
-&gt; [Id]
-&gt; a
-&gt; CgStgRhs
-&gt; WordOff
-&gt; HalfWord
-&gt; WordOff
-&gt; BcM (OrdList BCInstr)
</span><a href="#local-6989586621682966346"><span class="hs-identifier hs-var">compile_bind</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966308"><span class="hs-identifier hs-var">d'</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682966356"><span class="hs-identifier hs-var">fvs</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966357"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgRhs
</span><a href="#local-6989586621682966358"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966359"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">HalfWord
</span><a href="#local-6989586621682966360"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966361"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-648"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682966356"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682966356"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966357"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966357"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966358"><span class="annot"><span class="annottext">CgStgRhs
</span><a href="#local-6989586621682966358"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966359"><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966359"><span class="hs-identifier hs-var">size</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966360"><span class="annot"><span class="annottext">HalfWord
</span><a href="#local-6989586621682966360"><span class="hs-identifier hs-var">arity</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966361"><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966361"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-649"></span><span>                </span><span class="annot"><span class="annottext">[[Id]]
-&gt; [Id]
-&gt; [CgStgRhs]
-&gt; [WordOff]
-&gt; [HalfWord]
-&gt; [WordOff]
-&gt; [([Id], Id, CgStgRhs, WordOff, HalfWord, WordOff)]
forall a b c d e f.
[a] -&gt; [b] -&gt; [c] -&gt; [d] -&gt; [e] -&gt; [f] -&gt; [(a, b, c, d, e, f)]
</span><span class="hs-identifier hs-var">zip6</span></span><span> </span><span class="annot"><span class="annottext">[[Id]]
</span><a href="#local-6989586621682966298"><span class="hs-identifier hs-var">fvss</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682966292"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[CgStgRhs]
</span><a href="#local-6989586621682966293"><span class="hs-identifier hs-var">rhss</span></a></span><span> </span><span class="annot"><span class="annottext">[WordOff]
</span><a href="#local-6989586621682966301"><span class="hs-identifier hs-var">sizes</span></a></span><span> </span><span class="annot"><span class="annottext">[HalfWord]
</span><a href="#local-6989586621682966303"><span class="hs-identifier hs-var">arities</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966297"><span class="hs-identifier hs-var">n_binds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966297"><span class="hs-identifier hs-var">n_binds</span></a></span><span class="annot"><span class="annottext">WordOff -&gt; WordOff -&gt; WordOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">WordOff
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">WordOff
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-650"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-651"></span><span>     </span><span id="local-6989586621682966362"><span class="annot"><a href="#local-6989586621682966362"><span class="hs-identifier hs-var">body_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-type">schemeE</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966308"><span class="hs-identifier hs-type">d'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966286"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966299"><span class="hs-identifier hs-type">p'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966290"><span class="hs-identifier hs-type">body</span></a></span><span>
</span><span id="line-652"></span><span>     </span><span id="local-6989586621682966363"><span class="annot"><a href="#local-6989586621682966363"><span class="hs-identifier hs-var">thunk_codes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">sequence</span></span><span> </span><span class="annot"><a href="#local-6989586621682966355"><span class="hs-identifier hs-type">compile_binds</span></a></span><span>
</span><span id="line-653"></span><span>     </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682966329"><span class="hs-identifier hs-type">alloc_code</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#concatOL"><span class="hs-identifier hs-type">concatOL</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966363"><span class="hs-identifier hs-type">thunk_codes</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966362"><span class="hs-identifier hs-type">body_code</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-654"></span><span>
</span><span id="line-655"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span id="local-6989586621682966366"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966366"><span class="hs-identifier hs-var">_d</span></a></span></span><span> </span><span id="local-6989586621682966367"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966367"><span class="hs-identifier hs-var">_s</span></a></span></span><span> </span><span id="local-6989586621682966368"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966368"><span class="hs-identifier hs-var">_p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTick"><span class="hs-identifier hs-type">StgTick</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Tickish.html#Breakpoint"><span class="hs-identifier hs-type">Breakpoint</span></a></span><span> </span><span class="annot"><span class="annottext">XBreakpoint 'TickishPassStg
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682966369"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682966369"><span class="hs-identifier hs-var">bp_id</span></a></span></span><span> </span><span class="annot"><span class="annottext">[XTickishId 'TickishPassStg]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Module
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682966370"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682966370"><span class="hs-identifier hs-var">_rhs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-656"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; BcM (OrdList BCInstr)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;schemeE: Breakpoint without let binding: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-657"></span><span>            </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682966369"><span class="hs-identifier hs-var">bp_id</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-658"></span><span>            </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; forgot to run bcPrep?&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-659"></span><span>
</span><span id="line-660"></span><span class="hs-comment">-- ignore other kinds of tick</span><span>
</span><span id="line-661"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span id="local-6989586621682966372"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966372"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682966373"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966373"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682966374"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966374"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTick"><span class="hs-identifier hs-type">StgTick</span></a></span><span> </span><span class="annot"><span class="annottext">StgTickish
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682966375"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682966375"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; CgStgExpr -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966372"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966373"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966374"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682966375"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-662"></span><span>
</span><span id="line-663"></span><span class="hs-comment">-- no alts: scrut is guaranteed to diverge</span><span>
</span><span id="line-664"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span id="local-6989586621682966376"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966376"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682966377"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966377"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682966378"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966378"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgCase"><span class="hs-identifier hs-type">StgCase</span></a></span><span> </span><span id="local-6989586621682966380"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682966380"><span class="hs-identifier hs-var">scrut</span></a></span></span><span> </span><span class="annot"><span class="annottext">BinderP 'CodeGen
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">AltType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; CgStgExpr -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966376"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966377"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966378"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682966380"><span class="hs-identifier hs-var">scrut</span></a></span><span>
</span><span id="line-665"></span><span>
</span><span id="line-666"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span id="local-6989586621682966381"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966381"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682966382"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966382"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682966383"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966383"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgCase"><span class="hs-identifier hs-type">StgCase</span></a></span><span> </span><span id="local-6989586621682966384"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682966384"><span class="hs-identifier hs-var">scrut</span></a></span></span><span> </span><span id="local-6989586621682966385"><span class="annot"><span class="annottext">BinderP 'CodeGen
</span><a href="#local-6989586621682966385"><span class="hs-identifier hs-var">bndr</span></a></span></span><span> </span><span class="annot"><span class="annottext">AltType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682966386"><span class="annot"><span class="annottext">[CgStgAlt]
</span><a href="#local-6989586621682966386"><span class="hs-identifier hs-var">alts</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-667"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff
-&gt; Map Id ByteOff
-&gt; CgStgExpr
-&gt; Id
-&gt; [CgStgAlt]
-&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#doCase"><span class="hs-identifier hs-var">doCase</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966381"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966382"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966383"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682966384"><span class="hs-identifier hs-var">scrut</span></a></span><span> </span><span class="annot"><span class="annottext">Id
BinderP 'CodeGen
</span><a href="#local-6989586621682966385"><span class="hs-identifier hs-var">bndr</span></a></span><span> </span><span class="annot"><span class="annottext">[CgStgAlt]
</span><a href="#local-6989586621682966386"><span class="hs-identifier hs-var">alts</span></a></span><span>
</span><span id="line-668"></span><span>
</span><span id="line-669"></span><span>
</span><span id="line-670"></span><span class="hs-comment">{-
   Ticked Expressions
   ------------------

  The idea is that the &quot;breakpoint&lt;n,fvs&gt; E&quot; is really just an annotation on
  the code. When we find such a thing, we pull out the useful information,
  and then compile the code as if it was just the expression E.
-}</span><span>
</span><span id="line-678"></span><span>
</span><span id="line-679"></span><span class="hs-comment">-- Compile code to do a tail call.  Specifically, push the fn,</span><span>
</span><span id="line-680"></span><span class="hs-comment">-- slide the on-stack app back down to the sequel depth,</span><span>
</span><span id="line-681"></span><span class="hs-comment">-- and enter.  Four cases:</span><span>
</span><span id="line-682"></span><span class="hs-comment">--</span><span>
</span><span id="line-683"></span><span class="hs-comment">-- 0.  (Nasty hack).</span><span>
</span><span id="line-684"></span><span class="hs-comment">--     An application &quot;GHC.Prim.tagToEnum# &lt;type&gt; unboxed-int&quot;.</span><span>
</span><span id="line-685"></span><span class="hs-comment">--     The int will be on the stack.  Generate a code sequence</span><span>
</span><span id="line-686"></span><span class="hs-comment">--     to convert it to the relevant constructor, SLIDE and ENTER.</span><span>
</span><span id="line-687"></span><span class="hs-comment">--</span><span>
</span><span id="line-688"></span><span class="hs-comment">-- 1.  The fn denotes a ccall.  Defer to generateCCall.</span><span>
</span><span id="line-689"></span><span class="hs-comment">--</span><span>
</span><span id="line-690"></span><span class="hs-comment">-- 2.  An unboxed tuple: push the components on the top of</span><span>
</span><span id="line-691"></span><span class="hs-comment">--     the stack and return.</span><span>
</span><span id="line-692"></span><span class="hs-comment">--</span><span>
</span><span id="line-693"></span><span class="hs-comment">-- 3.  Application of a constructor, by defn saturated.</span><span>
</span><span id="line-694"></span><span class="hs-comment">--     Split the args into ptrs and non-ptrs, and push the nonptrs,</span><span>
</span><span id="line-695"></span><span class="hs-comment">--     then the ptrs, and then do PACK and RETURN.</span><span>
</span><span id="line-696"></span><span class="hs-comment">--</span><span>
</span><span id="line-697"></span><span class="hs-comment">-- 4.  Otherwise, it must be a function call.  Push the args</span><span>
</span><span id="line-698"></span><span class="hs-comment">--     right to left, SLIDE and ENTER.</span><span>
</span><span id="line-699"></span><span>
</span><span id="line-700"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeT"><span class="hs-identifier hs-type">schemeT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-type">StackDepth</span></a></span><span>   </span><span class="hs-comment">-- Stack depth</span><span>
</span><span id="line-701"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#Sequel"><span class="hs-identifier hs-type">Sequel</span></a></span><span>       </span><span class="hs-comment">-- Sequel depth</span><span>
</span><span id="line-702"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCEnv"><span class="hs-identifier hs-type">BCEnv</span></a></span><span>        </span><span class="hs-comment">-- stack env</span><span>
</span><span id="line-703"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgExpr"><span class="hs-identifier hs-type">CgStgExpr</span></a></span><span>
</span><span id="line-704"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span>
</span><span id="line-705"></span><span>
</span><span id="line-706"></span><span>   </span><span class="hs-comment">-- Case 0</span><span>
</span><span id="line-707"></span><span id="schemeT"><span class="annot"><span class="annottext">schemeT :: ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; CgStgExpr -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#schemeT"><span class="hs-identifier hs-var hs-var">schemeT</span></a></span></span><span> </span><span id="local-6989586621682966388"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966388"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682966389"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966389"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682966390"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966390"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621682966391"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682966391"><span class="hs-identifier hs-var">app</span></a></span></span><span>
</span><span id="line-708"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682966392"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966392"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966393"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682966393"><span class="hs-identifier hs-var">constr_names</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CgStgExpr -&gt; Maybe (Id, [Name])
</span><a href="GHC.StgToByteCode.html#maybe_is_tagToEnum_call"><span class="hs-identifier hs-var">maybe_is_tagToEnum_call</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682966391"><span class="hs-identifier hs-var">app</span></a></span><span>
</span><span id="line-709"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff
-&gt; Map Id ByteOff
-&gt; Id
-&gt; [Name]
-&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#implement_tagToId"><span class="hs-identifier hs-var">implement_tagToId</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966388"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966389"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966390"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966392"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682966393"><span class="hs-identifier hs-var">constr_names</span></a></span><span>
</span><span id="line-710"></span><span>
</span><span id="line-711"></span><span>   </span><span class="hs-comment">-- Case 1</span><span>
</span><span id="line-712"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeT"><span class="hs-identifier hs-var">schemeT</span></a></span><span> </span><span id="local-6989586621682966396"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966396"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682966397"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966397"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682966398"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966398"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgOpApp"><span class="hs-identifier hs-type">StgOpApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgFCallOp"><span class="hs-identifier hs-type">StgFCallOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.ForeignCall.html#CCall"><span class="hs-identifier hs-type">CCall</span></a></span><span> </span><span id="local-6989586621682966401"><span class="annot"><span class="annottext">CCallSpec
</span><a href="#local-6989586621682966401"><span class="hs-identifier hs-var">ccall_spec</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682966402"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682966402"><span class="hs-identifier hs-var">_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682966403"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682966403"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621682966404"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682966404"><span class="hs-identifier hs-var">result_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-713"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">CCallSpec -&gt; Bool
</span><a href="GHC.StgToByteCode.html#isSupportedCConv"><span class="hs-identifier hs-var">isSupportedCConv</span></a></span><span> </span><span class="annot"><span class="annottext">CCallSpec
</span><a href="#local-6989586621682966401"><span class="hs-identifier hs-var">ccall_spec</span></a></span><span>
</span><span id="line-714"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff
-&gt; Map Id ByteOff
-&gt; CCallSpec
-&gt; Type
-&gt; [StgArg]
-&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#generateCCall"><span class="hs-identifier hs-var">generateCCall</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966396"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966397"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966398"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">CCallSpec
</span><a href="#local-6989586621682966401"><span class="hs-identifier hs-var">ccall_spec</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682966404"><span class="hs-identifier hs-var">result_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682966403"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-715"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">BcM (OrdList BCInstr)
forall a. a
</span><a href="GHC.StgToByteCode.html#unsupportedCConvException"><span class="hs-identifier hs-var">unsupportedCConvException</span></a></span><span>
</span><span id="line-716"></span><span>
</span><span id="line-717"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeT"><span class="hs-identifier hs-var">schemeT</span></a></span><span> </span><span id="local-6989586621682966408"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966408"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682966409"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966409"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682966410"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966410"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgOpApp"><span class="hs-identifier hs-type">StgOpApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgPrimOp"><span class="hs-identifier hs-type">StgPrimOp</span></a></span><span> </span><span id="local-6989586621682966412"><span class="annot"><span class="annottext">PrimOp
</span><a href="#local-6989586621682966412"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682966413"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682966413"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621682966414"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682966414"><span class="hs-identifier hs-var">_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-718"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff
-&gt; Map Id ByteOff
-&gt; Id
-&gt; [StgArg]
-&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#doTailCall"><span class="hs-identifier hs-var">doTailCall</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966408"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966409"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966410"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimOp -&gt; Id
</span><a href="GHC.Builtin.PrimOps.Ids.html#primOpId"><span class="hs-identifier hs-var">primOpId</span></a></span><span> </span><span class="annot"><span class="annottext">PrimOp
</span><a href="#local-6989586621682966412"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[StgArg] -&gt; [StgArg]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682966413"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-719"></span><span>
</span><span id="line-720"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeT"><span class="hs-identifier hs-var">schemeT</span></a></span><span> </span><span id="local-6989586621682966416"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966416"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682966417"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966417"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682966418"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966418"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgOpApp"><span class="hs-identifier hs-type">StgOpApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgPrimCallOp"><span class="hs-identifier hs-type">StgPrimCallOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Builtin.PrimOps.html#PrimCall"><span class="hs-identifier hs-type">PrimCall</span></a></span><span> </span><span id="local-6989586621682966421"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682966421"><span class="hs-keyword hs-var">label</span></a></span></span><span> </span><span id="local-6989586621682966422"><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621682966422"><span class="hs-keyword hs-var">unit</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682966423"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682966423"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621682966424"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682966424"><span class="hs-identifier hs-var">result_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-721"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff
-&gt; Map Id ByteOff
-&gt; FastString
-&gt; Maybe (GenUnit UnitId)
-&gt; Type
-&gt; [StgArg]
-&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#generatePrimCall"><span class="hs-identifier hs-var">generatePrimCall</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966416"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966417"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966418"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682966421"><span class="hs-keyword hs-var">label</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; Maybe (GenUnit UnitId)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621682966422"><span class="hs-keyword hs-var">unit</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682966424"><span class="hs-identifier hs-var">result_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682966423"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-722"></span><span>
</span><span id="line-723"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeT"><span class="hs-identifier hs-var">schemeT</span></a></span><span> </span><span id="local-6989586621682966426"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966426"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682966427"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966427"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682966428"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966428"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgConApp"><span class="hs-identifier hs-type">StgConApp</span></a></span><span> </span><span id="local-6989586621682966429"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682966429"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621682966430"><span class="annot"><span class="annottext">ConstructorNumber
</span><a href="#local-6989586621682966430"><span class="hs-identifier hs-var">_cn</span></a></span></span><span> </span><span id="local-6989586621682966431"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682966431"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621682966432"><span class="annot"><span class="annottext">[[PrimRep]]
</span><a href="#local-6989586621682966432"><span class="hs-identifier hs-var">_tys</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-724"></span><span>   </span><span class="hs-comment">-- Case 2: Unboxed tuple</span><span>
</span><span id="line-725"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isUnboxedTupleDataCon"><span class="hs-identifier hs-var">isUnboxedTupleDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682966429"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isUnboxedSumDataCon"><span class="hs-identifier hs-var">isUnboxedSumDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682966429"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-726"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; [StgArg] -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#returnUnboxedTuple"><span class="hs-identifier hs-var">returnUnboxedTuple</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966426"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966427"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966428"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682966431"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-727"></span><span>
</span><span id="line-728"></span><span>   </span><span class="hs-comment">-- Case 3: Ordinary data constructor</span><span>
</span><span id="line-729"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-730"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621682966436"><span class="annot"><a href="#local-6989586621682966436"><span class="hs-identifier hs-var">alloc_con</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff
-&gt; Map Id ByteOff
-&gt; DataCon
-&gt; [StgArg]
-&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#mkConAppCode"><span class="hs-identifier hs-var">mkConAppCode</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966426"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966427"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966428"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682966429"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682966431"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-731"></span><span>        </span><span id="local-6989586621682966437"><span class="annot"><a href="#local-6989586621682966437"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#getProfile"><span class="hs-identifier hs-type">getProfile</span></a></span><span>
</span><span id="line-732"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682966436"><span class="hs-identifier hs-type">alloc_con</span></a></span><span>         </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span>
</span><span id="line-733"></span><span>                </span><span class="annot"><a href="GHC.StgToByteCode.html#mkSlideW"><span class="hs-identifier hs-type">mkSlideW</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#bytesToWords"><span class="hs-identifier hs-type">bytesToWords</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966437"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682966426"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">-</span></span><span> </span><span class="annot"><a href="#local-6989586621682966427"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-type">`snocOL`</span></a></span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html#RETURN"><span class="hs-identifier hs-type">RETURN</span></a></span><span> </span><span class="annot"><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-type">P</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-734"></span><span>
</span><span id="line-735"></span><span>   </span><span class="hs-comment">-- Case 4: Tail call of function</span><span>
</span><span id="line-736"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeT"><span class="hs-identifier hs-var">schemeT</span></a></span><span> </span><span id="local-6989586621682966440"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966440"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682966441"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966441"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682966442"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966442"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgApp"><span class="hs-identifier hs-type">StgApp</span></a></span><span> </span><span id="local-6989586621682966443"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966443"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span id="local-6989586621682966444"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682966444"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-737"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff
-&gt; Map Id ByteOff
-&gt; Id
-&gt; [StgArg]
-&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#doTailCall"><span class="hs-identifier hs-var">doTailCall</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966440"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966441"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966442"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966443"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[StgArg] -&gt; [StgArg]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682966444"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-738"></span><span>
</span><span id="line-739"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeT"><span class="hs-identifier hs-var">schemeT</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682966445"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682966445"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; BcM (OrdList BCInstr)
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.StgToByteCode.schemeT&quot;</span></span><span>
</span><span id="line-740"></span><span>                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StgPprOpts -&gt; CgStgExpr -&gt; SDoc
forall (pass :: StgPass).
OutputablePass pass =&gt;
StgPprOpts -&gt; GenStgExpr pass -&gt; SDoc
</span><a href="GHC.Stg.Syntax.html#pprStgExpr"><span class="hs-identifier hs-var">pprStgExpr</span></a></span><span> </span><span class="annot"><span class="annottext">StgPprOpts
</span><a href="GHC.Stg.Syntax.html#shortStgPprOpts"><span class="hs-identifier hs-var">shortStgPprOpts</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682966445"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-741"></span><span>
</span><span id="line-742"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-743"></span><span class="hs-comment">-- Generate code to build a constructor application,</span><span>
</span><span id="line-744"></span><span class="hs-comment">-- leaving it on top of the stack</span><span>
</span><span id="line-745"></span><span>
</span><span id="line-746"></span><span class="annot"><a href="GHC.StgToByteCode.html#mkConAppCode"><span class="hs-identifier hs-type">mkConAppCode</span></a></span><span>
</span><span id="line-747"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-type">StackDepth</span></a></span><span>
</span><span id="line-748"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#Sequel"><span class="hs-identifier hs-type">Sequel</span></a></span><span>
</span><span id="line-749"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCEnv"><span class="hs-identifier hs-type">BCEnv</span></a></span><span>
</span><span id="line-750"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span>                  </span><span class="hs-comment">-- The data constructor</span><span>
</span><span id="line-751"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span class="hs-special">]</span><span>                 </span><span class="hs-comment">-- Args, in *reverse* order</span><span>
</span><span id="line-752"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span>
</span><span id="line-753"></span><span id="mkConAppCode"><span class="annot"><span class="annottext">mkConAppCode :: ByteOff
-&gt; ByteOff
-&gt; Map Id ByteOff
-&gt; DataCon
-&gt; [StgArg]
-&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#mkConAppCode"><span class="hs-identifier hs-var hs-var">mkConAppCode</span></a></span></span><span> </span><span id="local-6989586621682966448"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966448"><span class="hs-identifier hs-var">orig_d</span></a></span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682966449"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966449"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621682966450"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682966450"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621682966451"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682966451"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BcM (OrdList BCInstr)
</span><a href="#local-6989586621682966452"><span class="hs-identifier hs-var">app_code</span></a></span><span>
</span><span id="line-754"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-755"></span><span>    </span><span id="local-6989586621682966452"><span class="annot"><span class="annottext">app_code :: BcM (OrdList BCInstr)
</span><a href="#local-6989586621682966452"><span class="hs-identifier hs-var hs-var">app_code</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-756"></span><span>        </span><span id="local-6989586621682966453"><span class="annot"><a href="#local-6989586621682966453"><span class="hs-identifier hs-var">profile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BcM Profile
</span><a href="GHC.StgToByteCode.html#getProfile"><span class="hs-identifier hs-var">getProfile</span></a></span><span>
</span><span id="line-757"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682966454"><span class="annot"><a href="#local-6989586621682966454"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Profile -&gt; Platform
</span><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682966453"><span class="hs-identifier hs-var">profile</span></a></span><span>
</span><span id="line-758"></span><span>
</span><span id="line-759"></span><span>            </span><span id="local-6989586621682966455"><span class="annot"><a href="#local-6989586621682966455"><span class="hs-identifier hs-var hs-var">non_voids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-760"></span><span>                </span><span class="annot"><span class="annottext">[NonVoid StgArg] -&gt; [NonVoid (PrimRep, StgArg)]
</span><a href="GHC.StgToCmm.Closure.html#addArgReps"><span class="hs-identifier hs-var">addArgReps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[StgArg] -&gt; [NonVoid StgArg]
</span><a href="GHC.StgToCmm.Closure.html#assertNonVoidStgArgs"><span class="hs-identifier hs-var">assertNonVoidStgArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682966451"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-761"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966456"><span class="annot"><a href="#local-6989586621682966456"><span class="hs-identifier hs-var">args_offsets</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-762"></span><span>                </span><span class="annot"><a href="GHC.StgToCmm.Layout.html#mkVirtHeapOffsetsWithPadding"><span class="hs-identifier hs-type">mkVirtHeapOffsetsWithPadding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966453"><span class="hs-identifier hs-type">profile</span></a></span><span> </span><span class="annot"><a href="GHC.StgToCmm.Layout.html#StdHeader"><span class="hs-identifier hs-type">StdHeader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966455"><span class="hs-identifier hs-type">non_voids</span></a></span><span>
</span><span id="line-763"></span><span>
</span><span id="line-764"></span><span>            </span><span id="local-6989586621682966459"><span class="annot"><a href="#local-6989586621682966459"><span class="hs-identifier hs-var hs-var">do_pushery</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682966460"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966460"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682966461"><span class="annot"><span class="annottext">FieldOffOrPadding StgArg
</span><a href="#local-6989586621682966461"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682966462"><span class="annot"><span class="annottext">[FieldOffOrPadding StgArg]
</span><a href="#local-6989586621682966462"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-765"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621682966463"><span class="annot"><a href="#local-6989586621682966463"><span class="hs-identifier hs-var">push</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966464"><span class="annot"><a href="#local-6989586621682966464"><span class="hs-identifier hs-var">arg_bytes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FieldOffOrPadding StgArg
</span><a href="#local-6989586621682966461"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-766"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Layout.html#Padding"><span class="hs-identifier hs-type">Padding</span></a></span><span> </span><span id="local-6989586621682966466"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682966466"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(OrdList BCInstr, ByteOff) -&gt; BcM (OrdList BCInstr, ByteOff)
forall a. a -&gt; BcM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">((OrdList BCInstr, ByteOff) -&gt; BcM (OrdList BCInstr, ByteOff))
-&gt; (OrdList BCInstr, ByteOff) -&gt; BcM (OrdList BCInstr, ByteOff)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushPadding"><span class="hs-identifier hs-var">pushPadding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ByteOff
</span><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-var">ByteOff</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682966466"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-767"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Layout.html#FieldOff"><span class="hs-identifier hs-type">FieldOff</span></a></span><span> </span><span id="local-6989586621682966470"><span class="annot"><span class="annottext">NonVoid StgArg
</span><a href="#local-6989586621682966470"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; Map Id ByteOff -&gt; StgArg -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushConstrAtom"><span class="hs-identifier hs-var">pushConstrAtom</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966460"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966449"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonVoid StgArg -&gt; StgArg
forall a. NonVoid a -&gt; a
</span><a href="GHC.StgToCmm.Closure.html#fromNonVoid"><span class="hs-identifier hs-var">fromNonVoid</span></a></span><span> </span><span class="annot"><span class="annottext">NonVoid StgArg
</span><a href="#local-6989586621682966470"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-768"></span><span>                </span><span id="local-6989586621682966472"><span class="annot"><a href="#local-6989586621682966472"><span class="hs-identifier hs-var">more_push_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682966459"><span class="hs-identifier hs-type">do_pushery</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682966460"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><a href="#local-6989586621682966464"><span class="hs-identifier hs-type">arg_bytes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682966462"><span class="hs-identifier hs-type">args</span></a></span><span>
</span><span id="line-769"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682966463"><span class="hs-identifier hs-type">push</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966472"><span class="hs-identifier hs-type">more_push_code</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-770"></span><span>            </span><span class="annot"><a href="#local-6989586621682966459"><span class="hs-identifier hs-var">do_pushery</span></a></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682966473"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966473"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-771"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682966474"><span class="annot"><span class="annottext">n_arg_words :: WordOff
</span><a href="#local-6989586621682966474"><span class="hs-identifier hs-var hs-var">n_arg_words</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#bytesToWords"><span class="hs-identifier hs-var">bytesToWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966454"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966473"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966448"><span class="hs-identifier hs-var">orig_d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-772"></span><span>                </span><span class="annot"><span class="annottext">OrdList BCInstr -&gt; BcM (OrdList BCInstr)
forall a. a -&gt; BcM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BCInstr -&gt; OrdList BCInstr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; WordOff -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PACK"><span class="hs-identifier hs-var">PACK</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682966450"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966474"><span class="hs-identifier hs-var">n_arg_words</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-773"></span><span>
</span><span id="line-774"></span><span>        </span><span class="hs-comment">-- Push on the stack in the reverse order.</span><span>
</span><span id="line-775"></span><span>        </span><span class="annot"><a href="#local-6989586621682966459"><span class="hs-identifier hs-type">do_pushery</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966448"><span class="hs-identifier hs-type">orig_d</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">reverse</span></span><span> </span><span class="annot"><a href="#local-6989586621682966456"><span class="hs-identifier hs-type">args_offsets</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-776"></span><span>
</span><span id="line-777"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-778"></span><span class="hs-comment">-- Generate code for a tail-call</span><span>
</span><span id="line-779"></span><span>
</span><span id="line-780"></span><span class="annot"><a href="GHC.StgToByteCode.html#doTailCall"><span class="hs-identifier hs-type">doTailCall</span></a></span><span>
</span><span id="line-781"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-type">StackDepth</span></a></span><span>
</span><span id="line-782"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#Sequel"><span class="hs-identifier hs-type">Sequel</span></a></span><span>
</span><span id="line-783"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCEnv"><span class="hs-identifier hs-type">BCEnv</span></a></span><span>
</span><span id="line-784"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-785"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-786"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span>
</span><span id="line-787"></span><span id="doTailCall"><span class="annot"><span class="annottext">doTailCall :: ByteOff
-&gt; ByteOff
-&gt; Map Id ByteOff
-&gt; Id
-&gt; [StgArg]
-&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#doTailCall"><span class="hs-identifier hs-var hs-var">doTailCall</span></a></span></span><span> </span><span id="local-6989586621682966475"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966475"><span class="hs-identifier hs-var">init_d</span></a></span></span><span> </span><span id="local-6989586621682966476"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966476"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682966477"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966477"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621682966478"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966478"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span id="local-6989586621682966479"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682966479"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-788"></span><span>   </span><span id="local-6989586621682966480"><span class="annot"><a href="#local-6989586621682966480"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Profile -&gt; Platform
</span><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="annottext">(Profile -&gt; Platform) -&gt; BcM Profile -&gt; BcM Platform
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">BcM Profile
</span><a href="GHC.StgToByteCode.html#getProfile"><span class="hs-identifier hs-var">getProfile</span></a></span><span>
</span><span id="line-789"></span><span>   </span><span class="annot"><a href="#local-6989586621682966481"><span class="hs-identifier hs-type">do_pushes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966475"><span class="hs-identifier hs-type">init_d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966479"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#atomRep"><span class="hs-identifier hs-type">atomRep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966480"><span class="hs-identifier hs-type">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682966479"><span class="hs-identifier hs-type">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-790"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-791"></span><span>  </span><span id="local-6989586621682966481"><span class="annot"><span class="annottext">do_pushes :: ByteOff -&gt; [StgArg] -&gt; [ArgRep] -&gt; BcM (OrdList BCInstr)
</span><a href="#local-6989586621682966481"><span class="hs-identifier hs-var hs-var">do_pushes</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682966483"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966483"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621682966484"><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621682966484"><span class="hs-identifier hs-var">reps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-792"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; (() -&gt; BcM ()) -&gt; () -&gt; BcM ()
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ArgRep] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621682966484"><span class="hs-identifier hs-var">reps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">() -&gt; BcM ()
forall a. a -&gt; BcM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-793"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682966487"><span class="annot"><a href="#local-6989586621682966487"><span class="hs-identifier hs-var">push_fn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966488"><span class="annot"><a href="#local-6989586621682966488"><span class="hs-identifier hs-var">sz</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; Map Id ByteOff -&gt; StgArg -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushAtom"><span class="hs-identifier hs-var">pushAtom</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966483"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966477"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; StgArg
</span><a href="GHC.Stg.Syntax.html#StgVarArg"><span class="hs-identifier hs-var">StgVarArg</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966478"><span class="hs-identifier hs-var">fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-794"></span><span>        </span><span id="local-6989586621682966489"><span class="annot"><a href="#local-6989586621682966489"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#getProfile"><span class="hs-identifier hs-type">getProfile</span></a></span><span>
</span><span id="line-795"></span><span>        </span><span class="annot"><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-type">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682966488"><span class="hs-identifier hs-type">sz</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#wordSize"><span class="hs-identifier hs-type">wordSize</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966489"><span class="hs-identifier hs-type">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-796"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682966490"><span class="annot"><a href="#local-6989586621682966490"><span class="hs-identifier hs-var hs-var">slide</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff -&gt; ByteOff -&gt; BCInstr
</span><a href="GHC.StgToByteCode.html#mkSlideB"><span class="hs-identifier hs-var">mkSlideB</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966489"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966483"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966475"><span class="hs-identifier hs-var">init_d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordSize"><span class="hs-identifier hs-var">wordSize</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966489"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966475"><span class="hs-identifier hs-var">init_d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966476"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-797"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682966487"><span class="hs-identifier hs-type">push_fn</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682966490"><span class="hs-identifier hs-type">slide</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-type">`consOL`</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-type">unitOL</span></a></span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html#ENTER"><span class="hs-identifier hs-type">ENTER</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-798"></span><span>  </span><span class="annot"><a href="#local-6989586621682966481"><span class="hs-identifier hs-var">do_pushes</span></a></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682966492"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966492"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682966493"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682966493"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621682966494"><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621682966494"><span class="hs-identifier hs-var">reps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-799"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682966495"><span class="annot"><span class="annottext">BCInstr
</span><a href="#local-6989586621682966495"><span class="hs-identifier hs-var hs-var">push_apply</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966496"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682966496"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966497"><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621682966497"><span class="hs-identifier hs-var hs-var">rest_of_reps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ArgRep] -&gt; (BCInstr, Int, [ArgRep])
</span><a href="GHC.StgToByteCode.html#findPushSeq"><span class="hs-identifier hs-var">findPushSeq</span></a></span><span> </span><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621682966494"><span class="hs-identifier hs-var">reps</span></a></span><span>
</span><span id="line-800"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621682966499"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682966499"><span class="hs-identifier hs-var hs-var">these_args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966500"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682966500"><span class="hs-identifier hs-var hs-var">rest_of_args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [StgArg] -&gt; ([StgArg], [StgArg])
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682966496"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682966493"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-801"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682966502"><span class="annot"><a href="#local-6989586621682966502"><span class="hs-identifier hs-var">next_d</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966503"><span class="annot"><a href="#local-6989586621682966503"><span class="hs-identifier hs-var">push_code</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; [StgArg] -&gt; BcM (ByteOff, OrdList BCInstr)
</span><a href="#local-6989586621682966504"><span class="hs-identifier hs-var">push_seq</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966492"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682966499"><span class="hs-identifier hs-var">these_args</span></a></span><span>
</span><span id="line-802"></span><span>      </span><span id="local-6989586621682966505"><span class="annot"><a href="#local-6989586621682966505"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#getProfile"><span class="hs-identifier hs-type">getProfile</span></a></span><span>
</span><span id="line-803"></span><span>      </span><span id="local-6989586621682966506"><span class="annot"><a href="#local-6989586621682966506"><span class="hs-identifier hs-var">instrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682966481"><span class="hs-identifier hs-type">do_pushes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682966502"><span class="hs-identifier hs-type">next_d</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#wordSize"><span class="hs-identifier hs-type">wordSize</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966505"><span class="hs-identifier hs-type">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682966500"><span class="hs-identifier hs-type">rest_of_args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966497"><span class="hs-identifier hs-type">rest_of_reps</span></a></span><span>
</span><span id="line-804"></span><span>      </span><span class="hs-comment">--                          ^^^ for the PUSH_APPLY_ instruction</span><span>
</span><span id="line-805"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682966503"><span class="hs-identifier hs-type">push_code</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682966495"><span class="hs-identifier hs-type">push_apply</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-type">`consOL`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966506"><span class="hs-identifier hs-type">instrs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-806"></span><span>
</span><span id="line-807"></span><span>  </span><span id="local-6989586621682966504"><span class="annot"><span class="annottext">push_seq :: ByteOff -&gt; [StgArg] -&gt; BcM (ByteOff, OrdList BCInstr)
</span><a href="#local-6989586621682966504"><span class="hs-identifier hs-var hs-var">push_seq</span></a></span></span><span> </span><span id="local-6989586621682966507"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966507"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ByteOff, OrdList BCInstr) -&gt; BcM (ByteOff, OrdList BCInstr)
forall a. a -&gt; BcM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966507"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
forall a. OrdList a
</span><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-var">nilOL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-808"></span><span>  </span><span class="annot"><a href="#local-6989586621682966504"><span class="hs-identifier hs-var">push_seq</span></a></span><span> </span><span id="local-6989586621682966509"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966509"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682966510"><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621682966510"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682966511"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682966511"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-809"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682966512"><span class="annot"><a href="#local-6989586621682966512"><span class="hs-identifier hs-var">push_code</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966513"><span class="annot"><a href="#local-6989586621682966513"><span class="hs-identifier hs-var">sz</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; Map Id ByteOff -&gt; StgArg -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushAtom"><span class="hs-identifier hs-var">pushAtom</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966509"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966477"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621682966510"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-810"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682966514"><span class="annot"><a href="#local-6989586621682966514"><span class="hs-identifier hs-var">final_d</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966515"><span class="annot"><a href="#local-6989586621682966515"><span class="hs-identifier hs-var">more_push_code</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682966504"><span class="hs-identifier hs-type">push_seq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682966509"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><a href="#local-6989586621682966513"><span class="hs-identifier hs-type">sz</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682966511"><span class="hs-identifier hs-type">args</span></a></span><span>
</span><span id="line-811"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682966514"><span class="hs-identifier hs-type">final_d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682966512"><span class="hs-identifier hs-type">push_code</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966515"><span class="hs-identifier hs-type">more_push_code</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-812"></span><span>
</span><span id="line-813"></span><span class="hs-comment">-- v. similar to CgStackery.findMatch, ToDo: merge</span><span>
</span><span id="line-814"></span><span class="annot"><a href="GHC.StgToByteCode.html#findPushSeq"><span class="hs-identifier hs-type">findPushSeq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToCmm.ArgRep.html#ArgRep"><span class="hs-identifier hs-type">ArgRep</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.ByteCode.Instr.html#BCInstr"><span class="hs-identifier hs-type">BCInstr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToCmm.ArgRep.html#ArgRep"><span class="hs-identifier hs-type">ArgRep</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-815"></span><span id="findPushSeq"><span class="annot"><span class="annottext">findPushSeq :: [ArgRep] -&gt; (BCInstr, Int, [ArgRep])
</span><a href="GHC.StgToByteCode.html#findPushSeq"><span class="hs-identifier hs-var hs-var">findPushSeq</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682966516"><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621682966516"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-816"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_APPLY_PPPPPP"><span class="hs-identifier hs-var">PUSH_APPLY_PPPPPP</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">6</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621682966516"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-817"></span><span class="annot"><a href="GHC.StgToByteCode.html#findPushSeq"><span class="hs-identifier hs-var">findPushSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682966518"><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621682966518"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-818"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_APPLY_PPPPP"><span class="hs-identifier hs-var">PUSH_APPLY_PPPPP</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621682966518"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-819"></span><span class="annot"><a href="GHC.StgToByteCode.html#findPushSeq"><span class="hs-identifier hs-var">findPushSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682966520"><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621682966520"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-820"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_APPLY_PPPP"><span class="hs-identifier hs-var">PUSH_APPLY_PPPP</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621682966520"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-821"></span><span class="annot"><a href="GHC.StgToByteCode.html#findPushSeq"><span class="hs-identifier hs-var">findPushSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682966522"><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621682966522"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-822"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_APPLY_PPP"><span class="hs-identifier hs-var">PUSH_APPLY_PPP</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621682966522"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-823"></span><span class="annot"><a href="GHC.StgToByteCode.html#findPushSeq"><span class="hs-identifier hs-var">findPushSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682966524"><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621682966524"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-824"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_APPLY_PP"><span class="hs-identifier hs-var">PUSH_APPLY_PP</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621682966524"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-825"></span><span class="annot"><a href="GHC.StgToByteCode.html#findPushSeq"><span class="hs-identifier hs-var">findPushSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682966526"><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621682966526"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-826"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_APPLY_P"><span class="hs-identifier hs-var">PUSH_APPLY_P</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621682966526"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-827"></span><span class="annot"><a href="GHC.StgToByteCode.html#findPushSeq"><span class="hs-identifier hs-var">findPushSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#V"><span class="hs-identifier hs-var">V</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682966528"><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621682966528"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-828"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_APPLY_V"><span class="hs-identifier hs-var">PUSH_APPLY_V</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621682966528"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-829"></span><span class="annot"><a href="GHC.StgToByteCode.html#findPushSeq"><span class="hs-identifier hs-var">findPushSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#N"><span class="hs-identifier hs-var">N</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682966531"><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621682966531"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-830"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_APPLY_N"><span class="hs-identifier hs-var">PUSH_APPLY_N</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621682966531"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-831"></span><span class="annot"><a href="GHC.StgToByteCode.html#findPushSeq"><span class="hs-identifier hs-var">findPushSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#F"><span class="hs-identifier hs-var">F</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682966534"><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621682966534"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-832"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_APPLY_F"><span class="hs-identifier hs-var">PUSH_APPLY_F</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621682966534"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-833"></span><span class="annot"><a href="GHC.StgToByteCode.html#findPushSeq"><span class="hs-identifier hs-var">findPushSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#D"><span class="hs-identifier hs-var">D</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682966537"><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621682966537"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-834"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_APPLY_D"><span class="hs-identifier hs-var">PUSH_APPLY_D</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621682966537"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-835"></span><span class="annot"><a href="GHC.StgToByteCode.html#findPushSeq"><span class="hs-identifier hs-var">findPushSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#L"><span class="hs-identifier hs-var">L</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682966540"><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621682966540"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-836"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_APPLY_L"><span class="hs-identifier hs-var">PUSH_APPLY_L</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621682966540"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-837"></span><span class="annot"><a href="GHC.StgToByteCode.html#findPushSeq"><span class="hs-identifier hs-var">findPushSeq</span></a></span><span> </span><span id="local-6989586621682966542"><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621682966542"><span class="hs-identifier hs-var">argReps</span></a></span></span><span>
</span><span id="line-838"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(ArgRep -&gt; Bool) -&gt; [ArgRep] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgRep -&gt; [ArgRep] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#V16"><span class="hs-identifier hs-var">V16</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#V32"><span class="hs-identifier hs-var">V32</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#V64"><span class="hs-identifier hs-var">V64</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621682966542"><span class="hs-identifier hs-var">argReps</span></a></span><span>
</span><span id="line-839"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (BCInstr, Int, [ArgRep])
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#sorry"><span class="hs-identifier hs-var">sorry</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SIMD vector operations are not available in GHCi&quot;</span></span><span>
</span><span id="line-840"></span><span class="annot"><a href="GHC.StgToByteCode.html#findPushSeq"><span class="hs-identifier hs-var">findPushSeq</span></a></span><span> </span><span class="annot"><span class="annottext">[ArgRep]
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-841"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (BCInstr, Int, [ArgRep])
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.StgToByteCode.findPushSeq&quot;</span></span><span>
</span><span id="line-842"></span><span>
</span><span id="line-843"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-844"></span><span class="hs-comment">-- Case expressions</span><span>
</span><span id="line-845"></span><span>
</span><span id="line-846"></span><span class="annot"><a href="GHC.StgToByteCode.html#doCase"><span class="hs-identifier hs-type">doCase</span></a></span><span>
</span><span id="line-847"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-type">StackDepth</span></a></span><span>
</span><span id="line-848"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#Sequel"><span class="hs-identifier hs-type">Sequel</span></a></span><span>
</span><span id="line-849"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCEnv"><span class="hs-identifier hs-type">BCEnv</span></a></span><span>
</span><span id="line-850"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgExpr"><span class="hs-identifier hs-type">CgStgExpr</span></a></span><span>
</span><span id="line-851"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-852"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgAlt"><span class="hs-identifier hs-type">CgStgAlt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-853"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span>
</span><span id="line-854"></span><span id="doCase"><span class="annot"><span class="annottext">doCase :: ByteOff
-&gt; ByteOff
-&gt; Map Id ByteOff
-&gt; CgStgExpr
-&gt; Id
-&gt; [CgStgAlt]
-&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#doCase"><span class="hs-identifier hs-var hs-var">doCase</span></a></span></span><span> </span><span id="local-6989586621682966549"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966549"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682966550"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966550"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682966551"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966551"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621682966552"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682966552"><span class="hs-identifier hs-var">scrut</span></a></span></span><span> </span><span id="local-6989586621682966553"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966553"><span class="hs-identifier hs-var">bndr</span></a></span></span><span> </span><span id="local-6989586621682966554"><span class="annot"><span class="annottext">[CgStgAlt]
</span><a href="#local-6989586621682966554"><span class="hs-identifier hs-var">alts</span></a></span></span><span>
</span><span id="line-855"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-856"></span><span>     </span><span id="local-6989586621682966555"><span class="annot"><a href="#local-6989586621682966555"><span class="hs-identifier hs-var">profile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BcM Profile
</span><a href="GHC.StgToByteCode.html#getProfile"><span class="hs-identifier hs-var">getProfile</span></a></span><span>
</span><span id="line-857"></span><span>     </span><span id="local-6989586621682966556"><span class="annot"><a href="#local-6989586621682966556"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#getHscEnv"><span class="hs-identifier hs-type">getHscEnv</span></a></span><span>
</span><span id="line-858"></span><span>     </span><span class="hs-keyword">let</span><span>
</span><span id="line-859"></span><span>        </span><span id="local-6989586621682966557"><span class="annot"><a href="#local-6989586621682966557"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Profile -&gt; Platform
</span><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682966555"><span class="hs-identifier hs-var">profile</span></a></span><span>
</span><span id="line-860"></span><span>
</span><span id="line-861"></span><span>        </span><span class="hs-comment">-- Are we dealing with an unboxed tuple with a tuple return frame?</span><span>
</span><span id="line-862"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-863"></span><span>        </span><span class="hs-comment">-- 'Simple' tuples with at most one non-void component,</span><span>
</span><span id="line-864"></span><span>        </span><span class="hs-comment">-- like (# Word# #) or (# Int#, State# RealWorld #) do not have a</span><span>
</span><span id="line-865"></span><span>        </span><span class="hs-comment">-- tuple return frame. This is because (# foo #) and (# foo, Void# #)</span><span>
</span><span id="line-866"></span><span>        </span><span class="hs-comment">-- have the same runtime rep. We have more efficient specialized</span><span>
</span><span id="line-867"></span><span>        </span><span class="hs-comment">-- return frames for the situations with one non-void element.</span><span>
</span><span id="line-868"></span><span>
</span><span id="line-869"></span><span>        </span><span id="local-6989586621682966558"><span class="annot"><a href="#local-6989586621682966558"><span class="hs-identifier hs-var hs-var">non_void_arg_reps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Type -&gt; [ArgRep]
</span><a href="GHC.StgToByteCode.html#typeArgReps"><span class="hs-identifier hs-var">typeArgReps</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966557"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682966560"><span class="hs-identifier hs-var">bndr_ty</span></a></span><span>
</span><span id="line-870"></span><span>        </span><span id="local-6989586621682966561"><span class="annot"><a href="#local-6989586621682966561"><span class="hs-identifier hs-var hs-var">ubx_tuple_frame</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-871"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnboxedTupleType"><span class="hs-identifier hs-var">isUnboxedTupleType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682966560"><span class="hs-identifier hs-var">bndr_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnboxedSumType"><span class="hs-identifier hs-var">isUnboxedSumType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682966560"><span class="hs-identifier hs-var">bndr_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-872"></span><span>          </span><span class="annot"><span class="annottext">[ArgRep] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621682966558"><span class="hs-identifier hs-var">non_void_arg_reps</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-873"></span><span>
</span><span id="line-874"></span><span>        </span><span id="local-6989586621682966565"><span class="annot"><a href="#local-6989586621682966565"><span class="hs-identifier hs-var hs-var">profiling</span></a></span></span><span>
</span><span id="line-875"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682966566"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682966566"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Maybe Interp
</span><a href="GHC.Driver.Env.Types.html#hsc_interp"><span class="hs-identifier hs-var">hsc_interp</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682966556"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-876"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; Bool
</span><a href="GHC.Runtime.Interpreter.html#interpreterProfiled"><span class="hs-identifier hs-var">interpreterProfiled</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682966566"><span class="hs-identifier hs-var">interp</span></a></span><span>
</span><span id="line-877"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-878"></span><span>
</span><span id="line-879"></span><span>        </span><span class="hs-comment">-- Top of stack is the return itbl, as usual.</span><span>
</span><span id="line-880"></span><span>        </span><span class="hs-comment">-- underneath it is the pointer to the alt_code BCO.</span><span>
</span><span id="line-881"></span><span>        </span><span class="hs-comment">-- When an alt is entered, it assumes the returned value is</span><span>
</span><span id="line-882"></span><span>        </span><span class="hs-comment">-- on top of the itbl; see Note [Return convention for non-tuple values]</span><span>
</span><span id="line-883"></span><span>        </span><span class="hs-comment">-- for details.</span><span>
</span><span id="line-884"></span><span>        </span><span class="annot"><a href="#local-6989586621682966567"><span class="hs-identifier hs-type">ret_frame_size_b</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-type">StackDepth</span></a></span><span>
</span><span id="line-885"></span><span>        </span><span id="local-6989586621682966567"><span class="annot"><a href="#local-6989586621682966567"><span class="hs-identifier hs-var hs-var">ret_frame_size_b</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682966561"><span class="hs-identifier hs-var">ubx_tuple_frame</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-886"></span><span>                             </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682966565"><span class="hs-identifier hs-var">profiling</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">5</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">4</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordSize"><span class="hs-identifier hs-var">wordSize</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966557"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-887"></span><span>                         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordSize"><span class="hs-identifier hs-var">wordSize</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966557"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-888"></span><span>
</span><span id="line-889"></span><span>        </span><span class="hs-comment">-- The stack space used to save/restore the CCCS when profiling</span><span>
</span><span id="line-890"></span><span>        </span><span id="local-6989586621682966568"><span class="annot"><a href="#local-6989586621682966568"><span class="hs-identifier hs-var hs-var">save_ccs_size_b</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682966565"><span class="hs-identifier hs-var">profiling</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-891"></span><span>                          </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682966561"><span class="hs-identifier hs-var">ubx_tuple_frame</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordSize"><span class="hs-identifier hs-var">wordSize</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966557"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-892"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">0</span></span><span>
</span><span id="line-893"></span><span>
</span><span id="line-894"></span><span>        </span><span class="hs-comment">-- The size of the return frame info table pointer if one exists</span><span>
</span><span id="line-895"></span><span>        </span><span class="annot"><a href="#local-6989586621682966570"><span class="hs-identifier hs-type">unlifted_itbl_size_b</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-type">StackDepth</span></a></span><span>
</span><span id="line-896"></span><span>        </span><span id="local-6989586621682966570"><span class="annot"><a href="#local-6989586621682966570"><span class="hs-identifier hs-var hs-var">unlifted_itbl_size_b</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682966561"><span class="hs-identifier hs-var">ubx_tuple_frame</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordSize"><span class="hs-identifier hs-var">wordSize</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966557"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-897"></span><span>                             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">0</span></span><span>
</span><span id="line-898"></span><span>
</span><span id="line-899"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682966571"><span class="annot"><a href="#local-6989586621682966571"><span class="hs-identifier hs-var">bndr_size</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966572"><span class="annot"><a href="#local-6989586621682966572"><span class="hs-identifier hs-var">call_info</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966573"><span class="annot"><a href="#local-6989586621682966573"><span class="hs-identifier hs-var">args_offsets</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-900"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="#local-6989586621682966561"><span class="hs-identifier hs-type">ubx_tuple_frame</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-901"></span><span>               </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682966574"><span class="annot"><a href="#local-6989586621682966574"><span class="hs-identifier hs-var hs-var">bndr_reps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; [PrimRep]
Type -&gt; [PrimRep]
</span><a href="GHC.Types.RepType.html#typePrimRep"><span class="hs-identifier hs-var">typePrimRep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966553"><span class="hs-identifier hs-var">bndr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-902"></span><span>                   </span><span class="hs-special">(</span><span id="local-6989586621682966576"><span class="annot"><a href="#local-6989586621682966576"><span class="hs-identifier hs-var">call_info</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966577"><span class="annot"><a href="#local-6989586621682966577"><span class="hs-identifier hs-var">args_offsets</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-903"></span><span>                       </span><span class="annot"><a href="GHC.StgToByteCode.html#layoutNativeCall"><span class="hs-identifier hs-type">layoutNativeCall</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966555"><span class="hs-identifier hs-type">profile</span></a></span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#NativeTupleReturn"><span class="hs-identifier hs-type">NativeTupleReturn</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">id</span></span><span> </span><span class="annot"><a href="#local-6989586621682966574"><span class="hs-identifier hs-type">bndr_reps</span></a></span><span>
</span><span id="line-904"></span><span>               </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#wordsToBytes"><span class="hs-identifier hs-type">wordsToBytes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966557"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.ByteCode.Types.html#nativeCallSize"><span class="hs-identifier hs-var">nativeCallSize</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966576"><span class="hs-identifier hs-type">call_info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-905"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682966576"><span class="hs-identifier hs-type">call_info</span></a></span><span>
</span><span id="line-906"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682966577"><span class="hs-identifier hs-type">args_offsets</span></a></span><span>
</span><span id="line-907"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-908"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#wordsToBytes"><span class="hs-identifier hs-type">wordsToBytes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966557"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#idSizeW"><span class="hs-identifier hs-type">idSizeW</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966557"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966553"><span class="hs-identifier hs-type">bndr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-909"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#voidTupleReturnInfo"><span class="hs-identifier hs-type">voidTupleReturnInfo</span></a></span><span>
</span><span id="line-910"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-911"></span><span>                         </span><span class="hs-special">)</span><span>
</span><span id="line-912"></span><span>
</span><span id="line-913"></span><span>        </span><span class="hs-comment">-- depth of stack after the return value has been pushed</span><span>
</span><span id="line-914"></span><span>        </span><span id="local-6989586621682966579"><span class="annot"><a href="#local-6989586621682966579"><span class="hs-identifier hs-var hs-var">d_bndr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-915"></span><span>            </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966549"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966567"><span class="hs-identifier hs-var">ret_frame_size_b</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966571"><span class="hs-identifier hs-var">bndr_size</span></a></span><span>
</span><span id="line-916"></span><span>
</span><span id="line-917"></span><span>        </span><span class="hs-comment">-- depth of stack after the extra info table for an unlifted return</span><span>
</span><span id="line-918"></span><span>        </span><span class="hs-comment">-- has been pushed, if any.  This is the stack depth at the</span><span>
</span><span id="line-919"></span><span>        </span><span class="hs-comment">-- continuation.</span><span>
</span><span id="line-920"></span><span>        </span><span id="local-6989586621682966580"><span class="annot"><a href="#local-6989586621682966580"><span class="hs-identifier hs-var hs-var">d_alts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966549"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966567"><span class="hs-identifier hs-var">ret_frame_size_b</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966571"><span class="hs-identifier hs-var">bndr_size</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966570"><span class="hs-identifier hs-var">unlifted_itbl_size_b</span></a></span><span>
</span><span id="line-921"></span><span>
</span><span id="line-922"></span><span>        </span><span class="hs-comment">-- Env in which to compile the alts, not including</span><span>
</span><span id="line-923"></span><span>        </span><span class="hs-comment">-- any vars bound by the alts themselves</span><span>
</span><span id="line-924"></span><span>        </span><span id="local-6989586621682966581"><span class="annot"><a href="#local-6989586621682966581"><span class="hs-identifier hs-var hs-var">p_alts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; ByteOff -&gt; Map Id ByteOff -&gt; Map Id ByteOff
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">Map.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966553"><span class="hs-identifier hs-var">bndr</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966579"><span class="hs-identifier hs-var">d_bndr</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966551"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-925"></span><span>
</span><span id="line-926"></span><span>        </span><span id="local-6989586621682966560"><span class="annot"><a href="#local-6989586621682966560"><span class="hs-identifier hs-var hs-var">bndr_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966553"><span class="hs-identifier hs-var">bndr</span></a></span><span>
</span><span id="line-927"></span><span>        </span><span id="local-6989586621682966582"><span class="annot"><a href="#local-6989586621682966582"><span class="hs-identifier hs-var hs-var">isAlgCase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isAlgType"><span class="hs-identifier hs-var">isAlgType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682966560"><span class="hs-identifier hs-var">bndr_ty</span></a></span><span>
</span><span id="line-928"></span><span>
</span><span id="line-929"></span><span>        </span><span class="hs-comment">-- given an alt, return a discr and code for it.</span><span>
</span><span id="line-930"></span><span>        </span><span class="annot"><a href="#local-6989586621682966584"><span class="hs-identifier hs-type">codeAlt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgAlt"><span class="hs-identifier hs-type">CgStgAlt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#Discr"><span class="hs-identifier hs-type">Discr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-931"></span><span>        </span><span id="local-6989586621682966584"><span class="annot"><a href="#local-6989586621682966584"><span class="hs-identifier hs-var hs-var">codeAlt</span></a></span></span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#GenStgAlt"><span class="hs-identifier hs-type">GenStgAlt</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">alt_con :: forall (pass :: StgPass). GenStgAlt pass -&gt; AltCon
</span><a href="GHC.Stg.Syntax.html#alt_con"><span class="hs-identifier hs-var">alt_con</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">AltCon
</span><a href="GHC.Core.html#DEFAULT"><span class="hs-identifier hs-var">DEFAULT</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">alt_bndrs :: forall (pass :: StgPass). GenStgAlt pass -&gt; [BinderP pass]
</span><a href="GHC.Stg.Syntax.html#alt_bndrs"><span class="hs-identifier hs-var">alt_bndrs</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">[BinderP 'CodeGen]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">alt_rhs :: forall (pass :: StgPass). GenStgAlt pass -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#alt_rhs"><span class="hs-identifier hs-var">alt_rhs</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621682966590"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682966590"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-932"></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621682966591"><span class="annot"><a href="#local-6989586621682966591"><span class="hs-identifier hs-var">rhs_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; CgStgExpr -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966580"><span class="hs-identifier hs-var">d_alts</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966550"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966581"><span class="hs-identifier hs-var">p_alts</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682966590"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-933"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#NoDiscr"><span class="hs-identifier hs-type">NoDiscr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682966591"><span class="hs-identifier hs-type">rhs_code</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-934"></span><span>
</span><span id="line-935"></span><span>        </span><span class="annot"><a href="#local-6989586621682966584"><span class="hs-identifier hs-var">codeAlt</span></a></span><span> </span><span id="local-6989586621682966593"><span class="annot"><span class="annottext">alt :: CgStgAlt
</span><a href="#local-6989586621682966593"><span class="hs-identifier hs-var">alt</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Stg.Syntax.html#GenStgAlt"><span class="hs-identifier hs-type">GenStgAlt</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">alt_con :: forall (pass :: StgPass). GenStgAlt pass -&gt; AltCon
</span><a href="GHC.Stg.Syntax.html#alt_con"><span class="hs-identifier hs-var">alt_con</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">AltCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">alt_bndrs :: forall (pass :: StgPass). GenStgAlt pass -&gt; [BinderP pass]
</span><a href="GHC.Stg.Syntax.html#alt_bndrs"><span class="hs-identifier hs-var">alt_bndrs</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621682966594"><span class="annot"><span class="annottext">[BinderP 'CodeGen]
</span><a href="#local-6989586621682966594"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">alt_rhs :: forall (pass :: StgPass). GenStgAlt pass -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#alt_rhs"><span class="hs-identifier hs-var">alt_rhs</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621682966595"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682966595"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-936"></span><span>           </span><span class="hs-comment">-- primitive or nullary constructor alt: no need to UNPACK</span><span>
</span><span id="line-937"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682966596"><span class="hs-identifier hs-var">real_bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-938"></span><span>                </span><span id="local-6989586621682966597"><span class="annot"><a href="#local-6989586621682966597"><span class="hs-identifier hs-var">rhs_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; CgStgExpr -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966580"><span class="hs-identifier hs-var">d_alts</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966550"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966581"><span class="hs-identifier hs-var">p_alts</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682966595"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-939"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682966598"><span class="hs-identifier hs-type">my_discr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966593"><span class="hs-identifier hs-type">alt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682966597"><span class="hs-identifier hs-type">rhs_code</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-940"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnboxedTupleType"><span class="hs-identifier hs-var">isUnboxedTupleType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682966560"><span class="hs-identifier hs-var">bndr_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnboxedSumType"><span class="hs-identifier hs-var">isUnboxedSumType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682966560"><span class="hs-identifier hs-var">bndr_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-941"></span><span>             </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682966599"><span class="annot"><span class="annottext">bndr_ty :: NonVoid Id -&gt; PrimRep
</span><a href="#local-6989586621682966599"><span class="hs-identifier hs-var hs-var">bndr_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; PrimRep
</span><a href="GHC.StgToCmm.Closure.html#idPrimRepU"><span class="hs-identifier hs-var">idPrimRepU</span></a></span><span> </span><span class="annot"><span class="annottext">(Id -&gt; PrimRep) -&gt; (NonVoid Id -&gt; Id) -&gt; NonVoid Id -&gt; PrimRep
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NonVoid Id -&gt; Id
forall a. NonVoid a -&gt; a
</span><a href="GHC.StgToCmm.Closure.html#fromNonVoid"><span class="hs-identifier hs-var">fromNonVoid</span></a></span><span>
</span><span id="line-942"></span><span>                 </span><span id="local-6989586621682966600"><span class="annot"><span class="annottext">tuple_start :: ByteOff
</span><a href="#local-6989586621682966600"><span class="hs-identifier hs-var hs-var">tuple_start</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966579"><span class="hs-identifier hs-var">d_bndr</span></a></span><span>
</span><span id="line-943"></span><span>                 </span><span class="hs-special">(</span><span id="local-6989586621682966601"><span class="annot"><span class="annottext">NativeCallInfo
</span><a href="#local-6989586621682966601"><span class="hs-identifier hs-var">call_info</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966602"><span class="annot"><span class="annottext">[(NonVoid Id, ByteOff)]
</span><a href="#local-6989586621682966602"><span class="hs-identifier hs-var">args_offsets</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-944"></span><span>                   </span><span class="annot"><span class="annottext">Profile
-&gt; NativeCallType
-&gt; ByteOff
-&gt; (NonVoid Id -&gt; PrimRep)
-&gt; [NonVoid Id]
-&gt; (NativeCallInfo, [(NonVoid Id, ByteOff)])
forall a.
Profile
-&gt; NativeCallType
-&gt; ByteOff
-&gt; (a -&gt; PrimRep)
-&gt; [a]
-&gt; (NativeCallInfo, [(a, ByteOff)])
</span><a href="GHC.StgToByteCode.html#layoutNativeCall"><span class="hs-identifier hs-var">layoutNativeCall</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682966555"><span class="hs-identifier hs-var">profile</span></a></span><span>
</span><span id="line-945"></span><span>                                    </span><span class="annot"><span class="annottext">NativeCallType
</span><a href="GHC.ByteCode.Types.html#NativeTupleReturn"><span class="hs-identifier hs-var">NativeTupleReturn</span></a></span><span>
</span><span id="line-946"></span><span>                                    </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">0</span></span><span>
</span><span id="line-947"></span><span>                                    </span><span class="annot"><span class="annottext">NonVoid Id -&gt; PrimRep
</span><a href="#local-6989586621682966599"><span class="hs-identifier hs-var">bndr_ty</span></a></span><span>
</span><span id="line-948"></span><span>                                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; [NonVoid Id]
</span><a href="GHC.StgToCmm.Closure.html#assertNonVoidIds"><span class="hs-identifier hs-var">assertNonVoidIds</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
[BinderP 'CodeGen]
</span><a href="#local-6989586621682966594"><span class="hs-identifier hs-var">bndrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-949"></span><span>
</span><span id="line-950"></span><span>                 </span><span id="local-6989586621682966603"><span class="annot"><span class="annottext">stack_bot :: ByteOff
</span><a href="#local-6989586621682966603"><span class="hs-identifier hs-var hs-var">stack_bot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966580"><span class="hs-identifier hs-var">d_alts</span></a></span><span>
</span><span id="line-951"></span><span>
</span><span id="line-952"></span><span>                 </span><span id="local-6989586621682966604"><span class="annot"><span class="annottext">p' :: Map Id ByteOff
</span><a href="#local-6989586621682966604"><span class="hs-identifier hs-var hs-var">p'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Id, ByteOff)] -&gt; Map Id ByteOff -&gt; Map Id ByteOff
forall key elt.
Ord key =&gt;
[(key, elt)] -&gt; Map key elt -&gt; Map key elt
</span><a href="GHC.Data.FiniteMap.html#insertList"><span class="hs-identifier hs-var">Map.insertList</span></a></span><span>
</span><span id="line-953"></span><span>                        </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966605"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966600"><span class="hs-identifier hs-var">tuple_start</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span>
</span><span id="line-954"></span><span>                                </span><span class="annot"><span class="annottext">Platform -&gt; WordOff -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordsToBytes"><span class="hs-identifier hs-var">wordsToBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966557"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NativeCallInfo -&gt; WordOff
</span><a href="GHC.ByteCode.Types.html#nativeCallSize"><span class="hs-identifier hs-var">nativeCallSize</span></a></span><span> </span><span class="annot"><span class="annottext">NativeCallInfo
</span><a href="#local-6989586621682966601"><span class="hs-identifier hs-var">call_info</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span>
</span><span id="line-955"></span><span>                                </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966606"><span class="hs-identifier hs-var">offset</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-956"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Closure.html#NonVoid"><span class="hs-identifier hs-type">NonVoid</span></a></span><span> </span><span id="local-6989586621682966605"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966605"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966606"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966606"><span class="hs-identifier hs-var">offset</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(NonVoid Id, ByteOff)]
</span><a href="#local-6989586621682966602"><span class="hs-identifier hs-var">args_offsets</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-957"></span><span>                        </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966581"><span class="hs-identifier hs-var">p_alts</span></a></span><span>
</span><span id="line-958"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-959"></span><span>               </span><span id="local-6989586621682966608"><span class="annot"><a href="#local-6989586621682966608"><span class="hs-identifier hs-var">rhs_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; CgStgExpr -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966603"><span class="hs-identifier hs-var">stack_bot</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966550"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966604"><span class="hs-identifier hs-var">p'</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682966595"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-960"></span><span>               </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#NoDiscr"><span class="hs-identifier hs-type">NoDiscr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682966608"><span class="hs-identifier hs-type">rhs_code</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-961"></span><span>           </span><span class="hs-comment">-- algebraic alt with some binders</span><span>
</span><span id="line-962"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-963"></span><span>             </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682966609"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682966609"><span class="hs-identifier hs-var">tot_wds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966610"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682966610"><span class="hs-identifier hs-var">_ptrs_wds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966611"><span class="annot"><span class="annottext">[(NonVoid Id, Int)]
</span><a href="#local-6989586621682966611"><span class="hs-identifier hs-var">args_offsets</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-964"></span><span>                     </span><span class="annot"><span class="annottext">Profile
-&gt; ClosureHeader
-&gt; [NonVoid (PrimRep, Id)]
-&gt; (Int, Int, [(NonVoid Id, Int)])
forall a.
Profile
-&gt; ClosureHeader
-&gt; [NonVoid (PrimRep, a)]
-&gt; (Int, Int, [(NonVoid a, Int)])
</span><a href="GHC.StgToCmm.Layout.html#mkVirtHeapOffsets"><span class="hs-identifier hs-var">mkVirtHeapOffsets</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682966555"><span class="hs-identifier hs-var">profile</span></a></span><span> </span><span class="annot"><span class="annottext">ClosureHeader
</span><a href="GHC.StgToCmm.Layout.html#NoHeader"><span class="hs-identifier hs-var">NoHeader</span></a></span><span>
</span><span id="line-965"></span><span>                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[NonVoid Id] -&gt; [NonVoid (PrimRep, Id)]
</span><a href="GHC.StgToCmm.Closure.html#addIdReps"><span class="hs-identifier hs-var">addIdReps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; [NonVoid Id]
</span><a href="GHC.StgToCmm.Closure.html#assertNonVoidIds"><span class="hs-identifier hs-var">assertNonVoidIds</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682966596"><span class="hs-identifier hs-var">real_bndrs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-966"></span><span>                 </span><span id="local-6989586621682966614"><span class="annot"><span class="annottext">size :: WordOff
</span><a href="#local-6989586621682966614"><span class="hs-identifier hs-var hs-var">size</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; WordOff
</span><a href="GHC.ByteCode.Types.html#WordOff"><span class="hs-identifier hs-var">WordOff</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682966609"><span class="hs-identifier hs-var">tot_wds</span></a></span><span>
</span><span id="line-967"></span><span>
</span><span id="line-968"></span><span>                 </span><span id="local-6989586621682966616"><span class="annot"><span class="annottext">stack_bot :: ByteOff
</span><a href="#local-6989586621682966616"><span class="hs-identifier hs-var hs-var">stack_bot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966580"><span class="hs-identifier hs-var">d_alts</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; WordOff -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordsToBytes"><span class="hs-identifier hs-var">wordsToBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966557"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966614"><span class="hs-identifier hs-var">size</span></a></span><span>
</span><span id="line-969"></span><span>
</span><span id="line-970"></span><span>                 </span><span class="hs-comment">-- convert offsets from Sp into offsets into the virtual stack</span><span>
</span><span id="line-971"></span><span>                 </span><span id="local-6989586621682966617"><span class="annot"><span class="annottext">p' :: Map Id ByteOff
</span><a href="#local-6989586621682966617"><span class="hs-identifier hs-var hs-var">p'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Id, ByteOff)] -&gt; Map Id ByteOff -&gt; Map Id ByteOff
forall key elt.
Ord key =&gt;
[(key, elt)] -&gt; Map key elt -&gt; Map key elt
</span><a href="GHC.Data.FiniteMap.html#insertList"><span class="hs-identifier hs-var">Map.insertList</span></a></span><span>
</span><span id="line-972"></span><span>                        </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966618"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966616"><span class="hs-identifier hs-var">stack_bot</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteOff
</span><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-var">ByteOff</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682966619"><span class="hs-identifier hs-var">offset</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-973"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Closure.html#NonVoid"><span class="hs-identifier hs-type">NonVoid</span></a></span><span> </span><span id="local-6989586621682966618"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966618"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966619"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682966619"><span class="hs-identifier hs-var">offset</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(NonVoid Id, Int)]
</span><a href="#local-6989586621682966611"><span class="hs-identifier hs-var">args_offsets</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-974"></span><span>                        </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966581"><span class="hs-identifier hs-var">p_alts</span></a></span><span>
</span><span id="line-975"></span><span>
</span><span id="line-976"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-977"></span><span>             </span><span class="annot"><span class="annottext">Bool -&gt; BcM ()
forall (m :: * -&gt; *). (HasCallStack, Applicative m) =&gt; Bool -&gt; m ()
</span><a href="GHC.Utils.Panic.Plain.html#massert"><span class="hs-identifier hs-var">massert</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682966582"><span class="hs-identifier hs-var">isAlgCase</span></a></span><span>
</span><span id="line-978"></span><span>             </span><span id="local-6989586621682966620"><span class="annot"><a href="#local-6989586621682966620"><span class="hs-identifier hs-var">rhs_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; CgStgExpr -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966616"><span class="hs-identifier hs-var">stack_bot</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966550"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966617"><span class="hs-identifier hs-var">p'</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621682966595"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-979"></span><span>             </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682966598"><span class="hs-identifier hs-type">my_discr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966593"><span class="hs-identifier hs-type">alt</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-980"></span><span>                     </span><span class="annot"><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-type">unitOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.ByteCode.Instr.html#UNPACK"><span class="hs-identifier hs-type">UNPACK</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966614"><span class="hs-identifier hs-type">size</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966620"><span class="hs-identifier hs-type">rhs_code</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-981"></span><span>           </span><span class="hs-keyword">where</span><span>
</span><span id="line-982"></span><span>             </span><span id="local-6989586621682966596"><span class="annot"><span class="annottext">real_bndrs :: [Id]
</span><a href="#local-6989586621682966596"><span class="hs-identifier hs-var hs-var">real_bndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Bool) -&gt; [Id] -&gt; [Id]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#filterOut"><span class="hs-identifier hs-var">filterOut</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
[BinderP 'CodeGen]
</span><a href="#local-6989586621682966594"><span class="hs-identifier hs-var">bndrs</span></a></span><span>
</span><span id="line-983"></span><span>
</span><span id="line-984"></span><span>        </span><span id="local-6989586621682966598"><span class="annot"><a href="#local-6989586621682966598"><span class="hs-identifier hs-var hs-var">my_discr</span></a></span></span><span> </span><span id="local-6989586621682966648"><span class="annot"><span class="annottext">GenStgAlt pass
</span><a href="#local-6989586621682966648"><span class="hs-identifier hs-var">alt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GenStgAlt pass -&gt; AltCon
forall (pass :: StgPass). GenStgAlt pass -&gt; AltCon
</span><a href="GHC.Stg.Syntax.html#alt_con"><span class="hs-identifier hs-var">alt_con</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgAlt pass
</span><a href="#local-6989586621682966648"><span class="hs-identifier hs-var">alt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-985"></span><span>            </span><span class="annot"><span class="annottext">AltCon
</span><a href="GHC.Core.html#DEFAULT"><span class="hs-identifier hs-var">DEFAULT</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Discr
</span><a href="GHC.StgToByteCode.html#NoDiscr"><span class="hs-identifier hs-var">NoDiscr</span></a></span><span> </span><span class="hs-comment">{-shouldn't really happen-}</span><span>
</span><span id="line-986"></span><span>            </span><span class="annot"><a href="GHC.Core.html#DataAlt"><span class="hs-identifier hs-type">DataAlt</span></a></span><span> </span><span id="local-6989586621682966650"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682966650"><span class="hs-identifier hs-var">dc</span></a></span></span><span>
</span><span id="line-987"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isUnboxedTupleDataCon"><span class="hs-identifier hs-var">isUnboxedTupleDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682966650"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isUnboxedSumDataCon"><span class="hs-identifier hs-var">isUnboxedSumDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682966650"><span class="hs-identifier hs-var">dc</span></a></span><span>
</span><span id="line-988"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Discr
</span><a href="GHC.StgToByteCode.html#NoDiscr"><span class="hs-identifier hs-var">NoDiscr</span></a></span><span>
</span><span id="line-989"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-990"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrP"><span class="hs-identifier hs-var">DiscrP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Word16
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Int
</span><a href="GHC.Core.DataCon.html#dataConTag"><span class="hs-identifier hs-var">dataConTag</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682966650"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.Types.Basic.html#fIRST_TAG"><span class="hs-identifier hs-var">fIRST_TAG</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-991"></span><span>            </span><span class="annot"><a href="GHC.Core.html#LitAlt"><span class="hs-identifier hs-type">LitAlt</span></a></span><span> </span><span id="local-6989586621682966655"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682966655"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682966655"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-992"></span><span>              </span><span class="annot"><a href="GHC.Types.Literal.html#LitNumber"><span class="hs-identifier hs-type">LitNumber</span></a></span><span> </span><span class="annot"><span class="annottext">LitNumType
</span><a href="GHC.Types.Literal.html#LitNumInt"><span class="hs-identifier hs-var">LitNumInt</span></a></span><span> </span><span id="local-6989586621682966658"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682966658"><span class="hs-identifier hs-var">i</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrI"><span class="hs-identifier hs-var">DiscrI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Int
forall a. Num a =&gt; Integer -&gt; a
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682966658"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-993"></span><span>              </span><span class="annot"><a href="GHC.Types.Literal.html#LitNumber"><span class="hs-identifier hs-type">LitNumber</span></a></span><span> </span><span class="annot"><span class="annottext">LitNumType
</span><a href="GHC.Types.Literal.html#LitNumInt8"><span class="hs-identifier hs-var">LitNumInt8</span></a></span><span> </span><span id="local-6989586621682966661"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682966661"><span class="hs-identifier hs-var">i</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int8 -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrI8"><span class="hs-identifier hs-var">DiscrI8</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Int8
forall a. Num a =&gt; Integer -&gt; a
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682966661"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-994"></span><span>              </span><span class="annot"><a href="GHC.Types.Literal.html#LitNumber"><span class="hs-identifier hs-type">LitNumber</span></a></span><span> </span><span class="annot"><span class="annottext">LitNumType
</span><a href="GHC.Types.Literal.html#LitNumInt16"><span class="hs-identifier hs-var">LitNumInt16</span></a></span><span> </span><span id="local-6989586621682966664"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682966664"><span class="hs-identifier hs-var">i</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int16 -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrI16"><span class="hs-identifier hs-var">DiscrI16</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Int16
forall a. Num a =&gt; Integer -&gt; a
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682966664"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-995"></span><span>              </span><span class="annot"><a href="GHC.Types.Literal.html#LitNumber"><span class="hs-identifier hs-type">LitNumber</span></a></span><span> </span><span class="annot"><span class="annottext">LitNumType
</span><a href="GHC.Types.Literal.html#LitNumInt32"><span class="hs-identifier hs-var">LitNumInt32</span></a></span><span> </span><span id="local-6989586621682966667"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682966667"><span class="hs-identifier hs-var">i</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int32 -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrI32"><span class="hs-identifier hs-var">DiscrI32</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Int32
forall a. Num a =&gt; Integer -&gt; a
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682966667"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-996"></span><span>              </span><span class="annot"><a href="GHC.Types.Literal.html#LitNumber"><span class="hs-identifier hs-type">LitNumber</span></a></span><span> </span><span class="annot"><span class="annottext">LitNumType
</span><a href="GHC.Types.Literal.html#LitNumInt64"><span class="hs-identifier hs-var">LitNumInt64</span></a></span><span> </span><span id="local-6989586621682966670"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682966670"><span class="hs-identifier hs-var">i</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrI64"><span class="hs-identifier hs-var">DiscrI64</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Int64
forall a. Num a =&gt; Integer -&gt; a
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682966670"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-997"></span><span>              </span><span class="annot"><a href="GHC.Types.Literal.html#LitNumber"><span class="hs-identifier hs-type">LitNumber</span></a></span><span> </span><span class="annot"><span class="annottext">LitNumType
</span><a href="GHC.Types.Literal.html#LitNumWord"><span class="hs-identifier hs-var">LitNumWord</span></a></span><span> </span><span id="local-6989586621682966673"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682966673"><span class="hs-identifier hs-var">w</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrW"><span class="hs-identifier hs-var">DiscrW</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Word
forall a. Num a =&gt; Integer -&gt; a
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682966673"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-998"></span><span>              </span><span class="annot"><a href="GHC.Types.Literal.html#LitNumber"><span class="hs-identifier hs-type">LitNumber</span></a></span><span> </span><span class="annot"><span class="annottext">LitNumType
</span><a href="GHC.Types.Literal.html#LitNumWord8"><span class="hs-identifier hs-var">LitNumWord8</span></a></span><span> </span><span id="local-6989586621682966676"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682966676"><span class="hs-identifier hs-var">w</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrW8"><span class="hs-identifier hs-var">DiscrW8</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Word8
forall a. Num a =&gt; Integer -&gt; a
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682966676"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-999"></span><span>              </span><span class="annot"><a href="GHC.Types.Literal.html#LitNumber"><span class="hs-identifier hs-type">LitNumber</span></a></span><span> </span><span class="annot"><span class="annottext">LitNumType
</span><a href="GHC.Types.Literal.html#LitNumWord16"><span class="hs-identifier hs-var">LitNumWord16</span></a></span><span> </span><span id="local-6989586621682966679"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682966679"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrW16"><span class="hs-identifier hs-var">DiscrW16</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Word16
forall a. Num a =&gt; Integer -&gt; a
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682966679"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1000"></span><span>              </span><span class="annot"><a href="GHC.Types.Literal.html#LitNumber"><span class="hs-identifier hs-type">LitNumber</span></a></span><span> </span><span class="annot"><span class="annottext">LitNumType
</span><a href="GHC.Types.Literal.html#LitNumWord32"><span class="hs-identifier hs-var">LitNumWord32</span></a></span><span> </span><span id="local-6989586621682966682"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682966682"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrW32"><span class="hs-identifier hs-var">DiscrW32</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Word32
forall a. Num a =&gt; Integer -&gt; a
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682966682"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1001"></span><span>              </span><span class="annot"><a href="GHC.Types.Literal.html#LitNumber"><span class="hs-identifier hs-type">LitNumber</span></a></span><span> </span><span class="annot"><span class="annottext">LitNumType
</span><a href="GHC.Types.Literal.html#LitNumWord64"><span class="hs-identifier hs-var">LitNumWord64</span></a></span><span> </span><span id="local-6989586621682966685"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682966685"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrW64"><span class="hs-identifier hs-var">DiscrW64</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Word64
forall a. Num a =&gt; Integer -&gt; a
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682966685"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1002"></span><span>              </span><span class="annot"><a href="GHC.Types.Literal.html#LitNumber"><span class="hs-identifier hs-type">LitNumber</span></a></span><span> </span><span class="annot"><span class="annottext">LitNumType
</span><a href="GHC.Types.Literal.html#LitNumBigNat"><span class="hs-identifier hs-var">LitNumBigNat</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621682966688"><span class="hs-identifier hs-var">unsupported</span></a></span><span>
</span><span id="line-1003"></span><span>              </span><span class="annot"><a href="GHC.Types.Literal.html#LitFloat"><span class="hs-identifier hs-type">LitFloat</span></a></span><span> </span><span id="local-6989586621682966690"><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621682966690"><span class="hs-identifier hs-var">r</span></a></span></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Float -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrF"><span class="hs-identifier hs-var">DiscrF</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rational -&gt; Float
forall a. Fractional a =&gt; Rational -&gt; a
</span><span class="hs-identifier hs-var">fromRational</span></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621682966690"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1004"></span><span>              </span><span class="annot"><a href="GHC.Types.Literal.html#LitDouble"><span class="hs-identifier hs-type">LitDouble</span></a></span><span> </span><span id="local-6989586621682966693"><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621682966693"><span class="hs-identifier hs-var">r</span></a></span></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrD"><span class="hs-identifier hs-var">DiscrD</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rational -&gt; Double
forall a. Fractional a =&gt; Rational -&gt; a
</span><span class="hs-identifier hs-var">fromRational</span></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621682966693"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1005"></span><span>              </span><span class="annot"><a href="GHC.Types.Literal.html#LitChar"><span class="hs-identifier hs-type">LitChar</span></a></span><span> </span><span id="local-6989586621682966696"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682966696"><span class="hs-identifier hs-var">i</span></a></span></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrI"><span class="hs-identifier hs-var">DiscrI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Int
</span><span class="hs-identifier hs-var">ord</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682966696"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1006"></span><span>              </span><span class="annot"><a href="GHC.Types.Literal.html#LitString"><span class="hs-identifier hs-type">LitString</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621682966688"><span class="hs-identifier hs-var">unsupported</span></a></span><span>
</span><span id="line-1007"></span><span>              </span><span class="annot"><a href="GHC.Types.Literal.html#LitRubbish"><span class="hs-identifier hs-type">LitRubbish</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621682966688"><span class="hs-identifier hs-var">unsupported</span></a></span><span>
</span><span id="line-1008"></span><span>              </span><span class="annot"><a href="GHC.Types.Literal.html#LitNullAddr"><span class="hs-identifier hs-type">LitNullAddr</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621682966688"><span class="hs-identifier hs-var">unsupported</span></a></span><span>
</span><span id="line-1009"></span><span>              </span><span class="annot"><a href="GHC.Types.Literal.html#LitLabel"><span class="hs-identifier hs-type">LitLabel</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621682966688"><span class="hs-identifier hs-var">unsupported</span></a></span><span>
</span><span id="line-1010"></span><span>              </span><span class="hs-keyword">where</span><span>
</span><span id="line-1011"></span><span>                  </span><span id="local-6989586621682966688"><span class="annot"><span class="annottext">unsupported :: Discr
</span><a href="#local-6989586621682966688"><span class="hs-identifier hs-var hs-var">unsupported</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; Discr
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;schemeE(StgCase).my_discr:&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Literal -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682966655"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1012"></span><span>
</span><span id="line-1013"></span><span>        </span><span id="local-6989586621682966702"><span class="annot"><a href="#local-6989586621682966702"><span class="hs-identifier hs-var hs-var">maybe_ncons</span></a></span></span><span>
</span><span id="line-1014"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682966582"><span class="hs-identifier hs-var">isAlgCase</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1015"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1016"></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682966703"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Core.html#DataAlt"><span class="hs-identifier hs-type">DataAlt</span></a></span><span> </span><span id="local-6989586621682966703"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682966703"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CgStgAlt -&gt; AltCon
forall (pass :: StgPass). GenStgAlt pass -&gt; AltCon
</span><a href="GHC.Stg.Syntax.html#alt_con"><span class="hs-identifier hs-var">alt_con</span></a></span><span> </span><span class="annot"><span class="annottext">(CgStgAlt -&gt; AltCon) -&gt; [CgStgAlt] -&gt; [AltCon]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[CgStgAlt]
</span><a href="#local-6989586621682966554"><span class="hs-identifier hs-var">alts</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1017"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1018"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621682966704"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682966704"><span class="hs-identifier hs-var">dc</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[DataCon]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Int
</span><a href="GHC.Core.TyCon.html#tyConFamilySize"><span class="hs-identifier hs-var">tyConFamilySize</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; TyCon
</span><a href="GHC.Core.DataCon.html#dataConTyCon"><span class="hs-identifier hs-var">dataConTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682966704"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1019"></span><span>
</span><span id="line-1020"></span><span>        </span><span class="hs-comment">-- the bitmap is relative to stack depth d, i.e. before the</span><span>
</span><span id="line-1021"></span><span>        </span><span class="hs-comment">-- BCO, info table and return value are pushed on.</span><span>
</span><span id="line-1022"></span><span>        </span><span class="hs-comment">-- This bit of code is v. similar to buildLivenessMask in CgBindery,</span><span>
</span><span id="line-1023"></span><span>        </span><span class="hs-comment">-- except that here we build the bitmap from the known bindings of</span><span>
</span><span id="line-1024"></span><span>        </span><span class="hs-comment">-- things that are pointers, whereas in CgBindery the code builds the</span><span>
</span><span id="line-1025"></span><span>        </span><span class="hs-comment">-- bitmap from the free slots and unboxed bindings.</span><span>
</span><span id="line-1026"></span><span>        </span><span class="hs-comment">-- (ToDo: merge?)</span><span>
</span><span id="line-1027"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-1028"></span><span>        </span><span class="hs-comment">-- NOTE [7/12/2006] bug #1013, testcase ghci/should_run/ghci002.</span><span>
</span><span id="line-1029"></span><span>        </span><span class="hs-comment">-- The bitmap must cover the portion of the stack up to the sequel only.</span><span>
</span><span id="line-1030"></span><span>        </span><span class="hs-comment">-- Previously we were building a bitmap for the whole depth (d), but we</span><span>
</span><span id="line-1031"></span><span>        </span><span class="hs-comment">-- really want a bitmap up to depth (d-s).  This affects compilation of</span><span>
</span><span id="line-1032"></span><span>        </span><span class="hs-comment">-- case-of-case expressions, which is the only time we can be compiling a</span><span>
</span><span id="line-1033"></span><span>        </span><span class="hs-comment">-- case expression with s /= 0.</span><span>
</span><span id="line-1034"></span><span>
</span><span id="line-1035"></span><span>        </span><span class="hs-comment">-- unboxed tuples get two more words, the second is a pointer (tuple_bco)</span><span>
</span><span id="line-1036"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682966707"><span class="annot"><a href="#local-6989586621682966707"><span class="hs-identifier hs-var">extra_pointers</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966708"><span class="annot"><a href="#local-6989586621682966708"><span class="hs-identifier hs-var">extra_slots</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1037"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="#local-6989586621682966561"><span class="hs-identifier hs-type">ubx_tuple_frame</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><a href="#local-6989586621682966565"><span class="hs-identifier hs-type">profiling</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">3</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- call_info, tuple_BCO, CCCS</span><span>
</span><span id="line-1038"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="#local-6989586621682966561"><span class="hs-identifier hs-type">ubx_tuple_frame</span></a></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- call_info, tuple_BCO</span><span>
</span><span id="line-1039"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">otherwise</span></span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-1040"></span><span>
</span><span id="line-1041"></span><span>        </span><span class="annot"><a href="#local-6989586621682966709"><span class="hs-identifier hs-type">bitmap_size</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a></span><span>
</span><span id="line-1042"></span><span>        </span><span id="local-6989586621682966709"><span class="annot"><a href="#local-6989586621682966709"><span class="hs-identifier hs-var hs-var">bitmap_size</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; WordOff
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682966708"><span class="hs-identifier hs-var">extra_slots</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; WordOff -&gt; WordOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span>
</span><span id="line-1043"></span><span>                      </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#bytesToWords"><span class="hs-identifier hs-var">bytesToWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966557"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966549"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966550"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1044"></span><span>
</span><span id="line-1045"></span><span>        </span><span class="annot"><a href="#local-6989586621682966710"><span class="hs-identifier hs-type">bitmap_size'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-1046"></span><span>        </span><span id="local-6989586621682966710"><span class="annot"><a href="#local-6989586621682966710"><span class="hs-identifier hs-var hs-var">bitmap_size'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966709"><span class="hs-identifier hs-var">bitmap_size</span></a></span><span>
</span><span id="line-1047"></span><span>
</span><span id="line-1048"></span><span>
</span><span id="line-1049"></span><span>        </span><span id="local-6989586621682966711"><span class="annot"><a href="#local-6989586621682966711"><span class="hs-identifier hs-var hs-var">pointers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1050"></span><span>          </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621682966707"><span class="hs-identifier hs-var">extra_pointers</span></a></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Int] -&gt; [Int]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-1051"></span><span>          </span><span class="annot"><span class="annottext">(Int -&gt; Bool) -&gt; [Int] -&gt; [Int]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682966710"><span class="hs-identifier hs-var">bitmap_size'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; [Int] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682966708"><span class="hs-identifier hs-var">extra_slots</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621682966712"><span class="hs-identifier hs-var">rel_slots</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1052"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-1053"></span><span>          </span><span class="hs-comment">-- NB: unboxed tuple cases bind the scrut binder to the same offset</span><span>
</span><span id="line-1054"></span><span>          </span><span class="hs-comment">-- as one of the alt binders, so we have to remove any duplicates here:</span><span>
</span><span id="line-1055"></span><span>          </span><span class="hs-comment">-- 'toAscList' takes care of sorting the result, which was previously done after the application of 'filter'.</span><span>
</span><span id="line-1056"></span><span>          </span><span id="local-6989586621682966712"><span class="annot"><span class="annottext">rel_slots :: [Int]
</span><a href="#local-6989586621682966712"><span class="hs-identifier hs-var hs-var">rel_slots</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntSet -&gt; [Int]
</span><a href="../../containers-0.7-5a8f/src/Data.IntSet.Internal.html#toAscList"><span class="hs-identifier hs-var">IntSet.toAscList</span></a></span><span> </span><span class="annot"><span class="annottext">(IntSet -&gt; [Int]) -&gt; IntSet -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; IntSet
</span><a href="../../containers-0.7-5a8f/src/Data.IntSet.Internal.html#fromList"><span class="hs-identifier hs-var">IntSet.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; IntSet) -&gt; [Int] -&gt; IntSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map Id Int -&gt; [Int]
forall k a. Map k a -&gt; [a]
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#elems"><span class="hs-identifier hs-var">Map.elems</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Id Int -&gt; [Int]) -&gt; Map Id Int -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Id -&gt; ByteOff -&gt; Maybe Int) -&gt; Map Id ByteOff -&gt; Map Id Int
forall k a b. (k -&gt; a -&gt; Maybe b) -&gt; Map k a -&gt; Map k b
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#mapMaybeWithKey"><span class="hs-identifier hs-var">Map.mapMaybeWithKey</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; ByteOff -&gt; Maybe Int
</span><a href="#local-6989586621682966717"><span class="hs-identifier hs-var">spread</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966551"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1057"></span><span>          </span><span id="local-6989586621682966717"><span class="annot"><span class="annottext">spread :: Id -&gt; ByteOff -&gt; Maybe Int
</span><a href="#local-6989586621682966717"><span class="hs-identifier hs-var hs-var">spread</span></a></span></span><span> </span><span id="local-6989586621682966718"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966718"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span id="local-6989586621682966719"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966719"><span class="hs-identifier hs-var">offset</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnboxedTupleType"><span class="hs-identifier hs-var">isUnboxedTupleType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966718"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span>
</span><span id="line-1058"></span><span>                             </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnboxedSumType"><span class="hs-identifier hs-var">isUnboxedSumType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966718"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1059"></span><span>                           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ArgRep -&gt; Bool
</span><a href="GHC.StgToByteCode.html#isFollowableArg"><span class="hs-identifier hs-var">isFollowableArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; Id -&gt; ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#idArgRep"><span class="hs-identifier hs-var">idArgRep</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966557"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966718"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WordOff -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966720"><span class="hs-identifier hs-var">rel_offset</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1060"></span><span>                           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1061"></span><span>                </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682966720"><span class="annot"><span class="annottext">rel_offset :: WordOff
</span><a href="#local-6989586621682966720"><span class="hs-identifier hs-var hs-var">rel_offset</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#bytesToWords"><span class="hs-identifier hs-var">bytesToWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966557"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966549"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966719"><span class="hs-identifier hs-var">offset</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1062"></span><span>
</span><span id="line-1063"></span><span>        </span><span id="local-6989586621682966721"><span class="annot"><a href="#local-6989586621682966721"><span class="hs-identifier hs-var hs-var">bitmap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Int -&gt; [Int] -&gt; [StgWord]
</span><a href="GHC.Data.Bitmap.html#intsToReverseBitmap"><span class="hs-identifier hs-var">intsToReverseBitmap</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966557"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682966710"><span class="hs-identifier hs-var">bitmap_size'</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621682966711"><span class="hs-identifier hs-var">pointers</span></a></span><span>
</span><span id="line-1064"></span><span>
</span><span id="line-1065"></span><span>     </span><span id="local-6989586621682966723"><span class="annot"><a href="#local-6989586621682966723"><span class="hs-identifier hs-var">alt_stuff</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="annot"><a href="#local-6989586621682966584"><span class="hs-identifier hs-type">codeAlt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966554"><span class="hs-identifier hs-type">alts</span></a></span><span>
</span><span id="line-1066"></span><span>     </span><span id="local-6989586621682966724"><span class="annot"><a href="#local-6989586621682966724"><span class="hs-identifier hs-var">alt_final0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#mkMultiBranch"><span class="hs-identifier hs-type">mkMultiBranch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966702"><span class="hs-identifier hs-type">maybe_ncons</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966723"><span class="hs-identifier hs-type">alt_stuff</span></a></span><span>
</span><span id="line-1067"></span><span>
</span><span id="line-1068"></span><span>     </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682966726"><span class="annot"><a href="#local-6989586621682966726"><span class="hs-identifier hs-var hs-var">alt_final</span></a></span></span><span>
</span><span id="line-1069"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682966561"><span class="hs-identifier hs-var">ubx_tuple_frame</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; WordOff -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#SLIDE"><span class="hs-identifier hs-var">SLIDE</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">BCInstr -&gt; OrdList BCInstr -&gt; OrdList BCInstr
forall a. a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-var">`consOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621682966724"><span class="hs-identifier hs-var">alt_final0</span></a></span><span>
</span><span id="line-1070"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621682966724"><span class="hs-identifier hs-var">alt_final0</span></a></span><span>
</span><span id="line-1071"></span><span>
</span><span id="line-1072"></span><span>     </span><span class="hs-keyword">let</span><span>
</span><span id="line-1073"></span><span>         </span><span id="local-6989586621682966728"><span class="annot"><a href="#local-6989586621682966728"><span class="hs-identifier hs-var hs-var">alt_bco_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Name
forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966553"><span class="hs-identifier hs-var">bndr</span></a></span><span>
</span><span id="line-1074"></span><span>         </span><span id="local-6989586621682966729"><span class="annot"><a href="#local-6989586621682966729"><span class="hs-identifier hs-var hs-var">alt_bco</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform
-&gt; Name
-&gt; OrdList BCInstr
-&gt; Either [CgStgAlt] CgStgRhs
-&gt; Int
-&gt; WordOff
-&gt; [StgWord]
-&gt; Bool
-&gt; [FFIInfo]
-&gt; ProtoBCO Name
forall name.
Platform
-&gt; name
-&gt; OrdList BCInstr
-&gt; Either [CgStgAlt] CgStgRhs
-&gt; Int
-&gt; WordOff
-&gt; [StgWord]
-&gt; Bool
-&gt; [FFIInfo]
-&gt; ProtoBCO name
</span><a href="GHC.StgToByteCode.html#mkProtoBCO"><span class="hs-identifier hs-var">mkProtoBCO</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966557"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682966728"><span class="hs-identifier hs-var">alt_bco_name</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621682966726"><span class="hs-identifier hs-var">alt_final</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CgStgAlt] -&gt; Either [CgStgAlt] CgStgRhs
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">[CgStgAlt]
</span><a href="#local-6989586621682966554"><span class="hs-identifier hs-var">alts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1075"></span><span>                       </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-comment">{-no arity-}</span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966709"><span class="hs-identifier hs-var">bitmap_size</span></a></span><span> </span><span class="annot"><span class="annottext">[StgWord]
</span><a href="#local-6989586621682966721"><span class="hs-identifier hs-var">bitmap</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-comment">{-is alts-}</span><span>
</span><span id="line-1076"></span><span>     </span><span id="local-6989586621682966730"><span class="annot"><a href="#local-6989586621682966730"><span class="hs-identifier hs-var">scrut_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-type">schemeE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682966549"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><a href="#local-6989586621682966567"><span class="hs-identifier hs-type">ret_frame_size_b</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><a href="#local-6989586621682966568"><span class="hs-identifier hs-type">save_ccs_size_b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1077"></span><span>                           </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682966549"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><a href="#local-6989586621682966567"><span class="hs-identifier hs-type">ret_frame_size_b</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><a href="#local-6989586621682966568"><span class="hs-identifier hs-type">save_ccs_size_b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1078"></span><span>                           </span><span class="annot"><a href="#local-6989586621682966551"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966552"><span class="hs-identifier hs-type">scrut</span></a></span><span>
</span><span id="line-1079"></span><span>     </span><span id="local-6989586621682966731"><span class="annot"><a href="#local-6989586621682966731"><span class="hs-identifier hs-var">alt_bco'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#emitBc"><span class="hs-identifier hs-type">emitBc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966729"><span class="hs-identifier hs-type">alt_bco</span></a></span><span>
</span><span id="line-1080"></span><span>     </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621682966561"><span class="hs-identifier hs-type">ubx_tuple_frame</span></a></span><span>
</span><span id="line-1081"></span><span>       </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621682966732"><span class="annot"><a href="#local-6989586621682966732"><span class="hs-identifier hs-var">tuple_bco</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#emitBc"><span class="hs-identifier hs-type">emitBc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#tupleBCO"><span class="hs-identifier hs-type">tupleBCO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966557"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966572"><span class="hs-identifier hs-type">call_info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966573"><span class="hs-identifier hs-type">args_offsets</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1082"></span><span>               </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.ByteCode.Instr.html#PUSH_ALTS_TUPLE"><span class="hs-identifier hs-type">PUSH_ALTS_TUPLE</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966731"><span class="hs-identifier hs-type">alt_bco'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966572"><span class="hs-identifier hs-type">call_info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966732"><span class="hs-identifier hs-type">tuple_bco</span></a></span><span>
</span><span id="line-1083"></span><span>                       </span><span class="annot"><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-type">`consOL`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966730"><span class="hs-identifier hs-type">scrut_code</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1084"></span><span>       </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682966734"><span class="annot"><a href="#local-6989586621682966734"><span class="hs-identifier hs-var hs-var">scrut_rep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621682966558"><span class="hs-identifier hs-var">non_void_arg_reps</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1085"></span><span>                  </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#V"><span class="hs-identifier hs-var">V</span></a></span><span>
</span><span id="line-1086"></span><span>                  </span><span class="hs-special">[</span><span id="local-6989586621682966735"><span class="annot"><span class="annottext">ArgRep
</span><a href="#local-6989586621682966735"><span class="hs-identifier hs-var">rep</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="#local-6989586621682966735"><span class="hs-identifier hs-var">rep</span></a></span><span>
</span><span id="line-1087"></span><span>                  </span><span class="annot"><span class="annottext">[ArgRep]
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ArgRep
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;schemeE(StgCase).push_alts&quot;</span></span><span>
</span><span id="line-1088"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.ByteCode.Instr.html#PUSH_ALTS"><span class="hs-identifier hs-type">PUSH_ALTS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966731"><span class="hs-identifier hs-type">alt_bco'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966734"><span class="hs-identifier hs-type">scrut_rep</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-type">`consOL`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966730"><span class="hs-identifier hs-type">scrut_code</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1089"></span><span>
</span><span id="line-1090"></span><span>
</span><span id="line-1091"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-1092"></span><span class="hs-comment">-- Deal with tuples</span><span>
</span><span id="line-1093"></span><span>
</span><span id="line-1094"></span><span class="hs-comment">-- The native calling convention uses registers for tuples, but in the</span><span>
</span><span id="line-1095"></span><span class="hs-comment">-- bytecode interpreter, all values live on the stack.</span><span>
</span><span id="line-1096"></span><span>
</span><span id="line-1097"></span><span class="hs-comment">{- Note [GHCi and native call registers]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The GHCi bytecode interpreter does not have access to the STG registers
that the native calling convention uses for passing arguments. It uses
helper stack frames to move values between the stack and registers.

If only a single register needs to be moved, GHCi uses a specific stack
frame. For example stg_ctoi_R1p saves a heap pointer value from STG register
R1 and stg_ctoi_D1 saves a double precision floating point value from D1.
In the other direction, helpers stg_ret_p and stg_ret_d move a value from
the stack to the R1 and D1 registers, respectively.

When GHCi needs to move more than one register it cannot use a specific
helper frame. It would simply be impossible to create a helper for all
possible combinations of register values. Instead, there are generic helper
stack frames that use a call_info word that describes the active registers
and the number of stack words used by the arguments of a call.

These helper stack frames are currently:

    - stg_ret_t:    return a tuple to the continuation at the top of
                        the stack
    - stg_ctoi_t:   convert a tuple return value to be used in
                        bytecode
    - stg_primcall: call a function


The call_info word contains a bitmap of the active registers
for the call and and a stack offset. The layout is as follows:

  - bit 0-23:  Bitmap of active registers for the call, the
               order corresponds to the list returned by
               allArgRegsCover.
               For example if bit 0 (the least significant bit) is set, the
               first register in the allArgRegsCover
               list is active. Bit 1 for the
               second register in the list and so on.

  - bit 24-31: Unsigned byte indicating the stack offset
               of the continuation in words. For tuple returns
               this is the number of words returned on the
               stack. For primcalls this field is unused, since
               we don't jump to a continuation.

The upper 32 bits on 64 bit platforms are currently unused.

If a register is smaller than a word on the stack (for example a
single precision float on a 64 bit system), then the stack slot
is padded to a whole word.

  Example:

    If a tuple is returned in three registers and an additional two
    words on the stack, then three bits in the register bitmap
    (bits 0-23) would be set. And bit 24-31 would be
    00000010 (two in binary).

    The values on the stack before a call to POP_ARG_REGS would
    be as follows:

      ...
      continuation
      stack_arg_1
      stack_arg_2
      register_arg_3
      register_arg_2
      register_arg_1 &lt;- Sp

    A call to POP_ARG_REGS(call_info) would move register_arg_1
    to the register corresponding to the lowest set bit in the
    call_info word. register_arg_2 would be moved to the register
    corresponding to the second lowest set bit, and so on.

    After POP_ARG_REGS(call_info), the stack pointer Sp points
    to the topmost stack argument, so the stack looks as follows:

      ...
      continuation
      stack_arg_1
      stack_arg_2 &lt;- Sp

    At this point all the arguments are in place and we are ready
    to jump to the continuation, the location (offset from Sp) of
    which is found by inspecting the value of bits 24-31. In this
    case the offset is two words.

On x86_64, the double precision (Dn) and single precision
floating (Fn) point registers overlap, e.g. D1 uses the same
physical register as F1. On this platform, the list returned
by allArgRegsCover contains only entries for the double
precision registers. If an argument is passed in register
Fn, the bit corresponding to Dn should be set.

Note: if anything changes in how registers for native calls overlap,
         make sure to also update GHC.StgToByteCode.layoutNativeCall
-}</span><span>
</span><span id="line-1193"></span><span>
</span><span id="line-1194"></span><span id="local-6989586621682964948"><span class="annot"><a href="GHC.StgToByteCode.html#layoutNativeCall"><span class="hs-identifier hs-type">layoutNativeCall</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.Profile.html#Profile"><span class="hs-identifier hs-type">Profile</span></a></span><span>
</span><span id="line-1195"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#NativeCallType"><span class="hs-identifier hs-type">NativeCallType</span></a></span><span>
</span><span id="line-1196"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span>
</span><span id="line-1197"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682964948"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#PrimRep"><span class="hs-identifier hs-type">PrimRep</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1198"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682964948"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1199"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#NativeCallInfo"><span class="hs-identifier hs-type">NativeCallInfo</span></a></span><span>      </span><span class="hs-comment">-- See Note [GHCi TupleInfo]</span><span>
</span><span id="line-1200"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682964948"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- argument, offset on stack</span><span>
</span><span id="line-1201"></span><span>                    </span><span class="hs-special">)</span></span><span>
</span><span id="line-1202"></span><span id="layoutNativeCall"><span class="annot"><span class="annottext">layoutNativeCall :: forall a.
Profile
-&gt; NativeCallType
-&gt; ByteOff
-&gt; (a -&gt; PrimRep)
-&gt; [a]
-&gt; (NativeCallInfo, [(a, ByteOff)])
</span><a href="GHC.StgToByteCode.html#layoutNativeCall"><span class="hs-identifier hs-var hs-var">layoutNativeCall</span></a></span></span><span> </span><span id="local-6989586621682966750"><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682966750"><span class="hs-identifier hs-var">profile</span></a></span></span><span> </span><span id="local-6989586621682966751"><span class="annot"><span class="annottext">NativeCallType
</span><a href="#local-6989586621682966751"><span class="hs-identifier hs-var">call_type</span></a></span></span><span> </span><span id="local-6989586621682966752"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966752"><span class="hs-identifier hs-var">start_off</span></a></span></span><span> </span><span id="local-6989586621682966753"><span class="annot"><span class="annottext">a -&gt; PrimRep
</span><a href="#local-6989586621682966753"><span class="hs-identifier hs-var">arg_rep</span></a></span></span><span> </span><span id="local-6989586621682966754"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682966754"><span class="hs-identifier hs-var">reps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1203"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682966755"><span class="annot"><span class="annottext">platform :: Platform
</span><a href="#local-6989586621682966755"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Profile -&gt; Platform
</span><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682966750"><span class="hs-identifier hs-var">profile</span></a></span><span>
</span><span id="line-1204"></span><span>      </span><span id="local-6989586621682966756"><span class="annot"><span class="annottext">arg_ty :: a -&gt; CmmType
</span><a href="#local-6989586621682966756"><span class="hs-identifier hs-var hs-var">arg_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; PrimRep -&gt; CmmType
</span><a href="GHC.Cmm.Utils.html#primRepCmmType"><span class="hs-identifier hs-var">primRepCmmType</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966755"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">(PrimRep -&gt; CmmType) -&gt; (a -&gt; PrimRep) -&gt; a -&gt; CmmType
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; PrimRep
</span><a href="#local-6989586621682966753"><span class="hs-identifier hs-var">arg_rep</span></a></span><span>
</span><span id="line-1205"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682966758"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682966758"><span class="hs-identifier hs-var">orig_stk_bytes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966759"><span class="annot"><span class="annottext">[(a, ParamLocation)]
</span><a href="#local-6989586621682966759"><span class="hs-identifier hs-var">pos</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Profile
-&gt; Int
-&gt; Convention
-&gt; (a -&gt; CmmType)
-&gt; [a]
-&gt; (Int, [(a, ParamLocation)])
forall a.
Profile
-&gt; Int
-&gt; Convention
-&gt; (a -&gt; CmmType)
-&gt; [a]
-&gt; (Int, [(a, ParamLocation)])
</span><a href="GHC.Cmm.CallConv.html#assignArgumentsPos"><span class="hs-identifier hs-var">assignArgumentsPos</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682966750"><span class="hs-identifier hs-var">profile</span></a></span><span>
</span><span id="line-1206"></span><span>                                                 </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1207"></span><span>                                                 </span><span class="annot"><span class="annottext">Convention
</span><a href="GHC.Cmm.Node.html#NativeReturn"><span class="hs-identifier hs-var">NativeReturn</span></a></span><span>
</span><span id="line-1208"></span><span>                                                 </span><span class="annot"><span class="annottext">a -&gt; CmmType
</span><a href="#local-6989586621682966756"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-1209"></span><span>                                                 </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682966754"><span class="hs-identifier hs-var">reps</span></a></span><span>
</span><span id="line-1210"></span><span>
</span><span id="line-1211"></span><span>      </span><span class="hs-comment">-- keep the stack parameters in the same place</span><span>
</span><span id="line-1212"></span><span>      </span><span id="local-6989586621682966762"><span class="annot"><span class="annottext">orig_stk_params :: [(a, ByteOff)]
</span><a href="#local-6989586621682966762"><span class="hs-identifier hs-var hs-var">orig_stk_params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682966763"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteOff
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682966764"><span class="hs-identifier hs-var">off</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682966763"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682966763"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.CallConv.html#StackParam"><span class="hs-identifier hs-type">StackParam</span></a></span><span> </span><span id="local-6989586621682966764"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682966764"><span class="hs-identifier hs-var">off</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(a, ParamLocation)]
</span><a href="#local-6989586621682966759"><span class="hs-identifier hs-var">pos</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1213"></span><span>
</span><span id="line-1214"></span><span>      </span><span class="hs-comment">-- sort the register parameters by register and add them to the stack</span><span>
</span><span id="line-1215"></span><span>      </span><span class="annot"><a href="#local-6989586621682966766"><span class="hs-identifier hs-type">regs_order</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map.Map</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Reg.html#GlobalReg"><span class="hs-identifier hs-type">GlobalReg</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-1216"></span><span>      </span><span id="local-6989586621682966766"><span class="annot"><span class="annottext">regs_order :: Map GlobalReg Int
</span><a href="#local-6989586621682966766"><span class="hs-identifier hs-var hs-var">regs_order</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(GlobalReg, Int)] -&gt; Map GlobalReg Int
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">Map.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(GlobalReg, Int)] -&gt; Map GlobalReg Int)
-&gt; [(GlobalReg, Int)] -&gt; Map GlobalReg Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[GlobalReg] -&gt; [Int] -&gt; [(GlobalReg, Int)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; GlobalArgRegs -&gt; [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#allArgRegsCover"><span class="hs-identifier hs-var">allArgRegsCover</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966755"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalArgRegs
</span><a href="GHC.Cmm.Reg.html#SCALAR_ARG_REGS"><span class="hs-identifier hs-var">SCALAR_ARG_REGS</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-1217"></span><span>
</span><span id="line-1218"></span><span>      </span><span class="annot"><a href="#local-6989586621682966769"><span class="hs-identifier hs-type">reg_order</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Reg.html#GlobalReg"><span class="hs-identifier hs-type">GlobalReg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Reg.html#GlobalReg"><span class="hs-identifier hs-type">GlobalReg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1219"></span><span>      </span><span id="local-6989586621682966769"><span class="annot"><span class="annottext">reg_order :: GlobalReg -&gt; (Int, GlobalReg)
</span><a href="#local-6989586621682966769"><span class="hs-identifier hs-var hs-var">reg_order</span></a></span></span><span> </span><span id="local-6989586621682966770"><span class="annot"><span class="annottext">GlobalReg
</span><a href="#local-6989586621682966770"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682966771"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682966771"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GlobalReg -&gt; Map GlobalReg Int -&gt; Maybe Int
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalReg
</span><a href="#local-6989586621682966770"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map GlobalReg Int
</span><a href="#local-6989586621682966766"><span class="hs-identifier hs-var">regs_order</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682966771"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GlobalReg
</span><a href="#local-6989586621682966770"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1220"></span><span>      </span><span class="hs-comment">-- if we don't have a position for a FloatReg then they must be passed</span><span>
</span><span id="line-1221"></span><span>      </span><span class="hs-comment">-- in the equivalent DoubleReg</span><span>
</span><span id="line-1222"></span><span>      </span><span class="annot"><a href="#local-6989586621682966769"><span class="hs-identifier hs-var">reg_order</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Reg.html#FloatReg"><span class="hs-identifier hs-type">FloatReg</span></a></span><span> </span><span id="local-6989586621682966774"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682966774"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalReg -&gt; (Int, GlobalReg)
</span><a href="#local-6989586621682966769"><span class="hs-identifier hs-var">reg_order</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; GlobalReg
</span><a href="GHC.Cmm.Reg.html#DoubleReg"><span class="hs-identifier hs-var">DoubleReg</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682966774"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1223"></span><span>      </span><span class="hs-comment">-- one-tuples can be passed in other registers, but then we don't need</span><span>
</span><span id="line-1224"></span><span>      </span><span class="hs-comment">-- to care about the order</span><span>
</span><span id="line-1225"></span><span>      </span><span class="annot"><a href="#local-6989586621682966769"><span class="hs-identifier hs-var">reg_order</span></a></span><span> </span><span id="local-6989586621682966776"><span class="annot"><span class="annottext">GlobalReg
</span><a href="#local-6989586621682966776"><span class="hs-identifier hs-var">reg</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GlobalReg
</span><a href="#local-6989586621682966776"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1226"></span><span>
</span><span id="line-1227"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682966777"><span class="annot"><span class="annottext">[(Int, GlobalReg)]
</span><a href="#local-6989586621682966777"><span class="hs-identifier hs-var">regs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966778"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682966778"><span class="hs-identifier hs-var">reg_params</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1228"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[((Int, GlobalReg), a)] -&gt; ([(Int, GlobalReg)], [a])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">([((Int, GlobalReg), a)] -&gt; ([(Int, GlobalReg)], [a]))
-&gt; [((Int, GlobalReg), a)] -&gt; ([(Int, GlobalReg)], [a])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(((Int, GlobalReg), a) -&gt; ((Int, GlobalReg), a) -&gt; Ordering)
-&gt; [((Int, GlobalReg), a)] -&gt; [((Int, GlobalReg), a)]
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(((Int, GlobalReg), a) -&gt; (Int, GlobalReg))
-&gt; ((Int, GlobalReg), a) -&gt; ((Int, GlobalReg), a) -&gt; Ordering
forall a b. Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering
</span><span class="hs-identifier hs-var">comparing</span></span><span> </span><span class="annot"><span class="annottext">((Int, GlobalReg), a) -&gt; (Int, GlobalReg)
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span>
</span><span id="line-1229"></span><span>                           </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalReg -&gt; (Int, GlobalReg)
</span><a href="#local-6989586621682966769"><span class="hs-identifier hs-var">reg_order</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalReg
</span><a href="#local-6989586621682966780"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682966781"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682966781"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682966781"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.CallConv.html#RegisterParam"><span class="hs-identifier hs-type">RegisterParam</span></a></span><span> </span><span id="local-6989586621682966780"><span class="annot"><span class="annottext">GlobalReg
</span><a href="#local-6989586621682966780"><span class="hs-identifier hs-var">reg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(a, ParamLocation)]
</span><a href="#local-6989586621682966759"><span class="hs-identifier hs-var">pos</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1230"></span><span>
</span><span id="line-1231"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682966783"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682966783"><span class="hs-identifier hs-var">new_stk_bytes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966784"><span class="annot"><span class="annottext">[(a, ParamLocation)]
</span><a href="#local-6989586621682966784"><span class="hs-identifier hs-var">new_stk_params</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform
-&gt; Int -&gt; (a -&gt; CmmType) -&gt; [a] -&gt; (Int, [(a, ParamLocation)])
forall a.
Platform
-&gt; Int -&gt; (a -&gt; CmmType) -&gt; [a] -&gt; (Int, [(a, ParamLocation)])
</span><a href="GHC.Cmm.CallConv.html#assignStack"><span class="hs-identifier hs-var">assignStack</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966755"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-1232"></span><span>                                                    </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682966758"><span class="hs-identifier hs-var">orig_stk_bytes</span></a></span><span>
</span><span id="line-1233"></span><span>                                                    </span><span class="annot"><span class="annottext">a -&gt; CmmType
</span><a href="#local-6989586621682966756"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-1234"></span><span>                                                    </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682966778"><span class="hs-identifier hs-var">reg_params</span></a></span><span>
</span><span id="line-1235"></span><span>
</span><span id="line-1236"></span><span>      </span><span id="local-6989586621682966786"><span class="annot"><span class="annottext">regs_set :: RegSet GlobalReg
</span><a href="#local-6989586621682966786"><span class="hs-identifier hs-var hs-var">regs_set</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GlobalReg] -&gt; RegSet GlobalReg
forall r. Ord r =&gt; [r] -&gt; RegSet r
</span><a href="GHC.Cmm.Expr.html#mkRegSet"><span class="hs-identifier hs-var">mkRegSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Int, GlobalReg) -&gt; GlobalReg)
-&gt; [(Int, GlobalReg)] -&gt; [GlobalReg]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Int, GlobalReg) -&gt; GlobalReg
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(Int, GlobalReg)]
</span><a href="#local-6989586621682966777"><span class="hs-identifier hs-var">regs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1237"></span><span>
</span><span id="line-1238"></span><span>      </span><span id="local-6989586621682966794"><span class="annot"><span class="annottext">get_byte_off :: (a, ParamLocation) -&gt; (a, b)
</span><a href="#local-6989586621682966794"><span class="hs-identifier hs-var hs-var">get_byte_off</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682966795"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682966795"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.CallConv.html#StackParam"><span class="hs-identifier hs-type">StackParam</span></a></span><span> </span><span id="local-6989586621682966796"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682966796"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682966795"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; b
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682966796"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1239"></span><span>      </span><span class="annot"><a href="#local-6989586621682966794"><span class="hs-identifier hs-var">get_byte_off</span></a></span><span> </span><span class="annot"><span class="annottext">(a, ParamLocation)
</span><span class="hs-identifier">_</span></span><span>                 </span><span class="hs-glyph">=</span><span>
</span><span id="line-1240"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; (a, b)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.StgToByteCode.layoutTuple get_byte_off&quot;</span></span><span>
</span><span id="line-1241"></span><span>
</span><span id="line-1242"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#NativeCallInfo"><span class="hs-identifier hs-type">NativeCallInfo</span></a></span><span>
</span><span id="line-1243"></span><span>         </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nativeCallType :: NativeCallType
</span><a href="GHC.ByteCode.Types.html#nativeCallType"><span class="hs-identifier hs-var">nativeCallType</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NativeCallType
</span><a href="#local-6989586621682966751"><span class="hs-identifier hs-var">call_type</span></a></span><span>
</span><span id="line-1244"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nativeCallSize :: WordOff
</span><a href="GHC.ByteCode.Types.html#nativeCallSize"><span class="hs-identifier hs-var">nativeCallSize</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#bytesToWords"><span class="hs-identifier hs-var">bytesToWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966755"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ByteOff
</span><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-var">ByteOff</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682966783"><span class="hs-identifier hs-var">new_stk_bytes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1245"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nativeCallRegs :: RegSet GlobalReg
</span><a href="GHC.ByteCode.Types.html#nativeCallRegs"><span class="hs-identifier hs-var">nativeCallRegs</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RegSet GlobalReg
</span><a href="#local-6989586621682966786"><span class="hs-identifier hs-var">regs_set</span></a></span><span>
</span><span id="line-1246"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nativeCallStackSpillSize :: WordOff
</span><a href="GHC.ByteCode.Types.html#nativeCallStackSpillSize"><span class="hs-identifier hs-var">nativeCallStackSpillSize</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#bytesToWords"><span class="hs-identifier hs-var">bytesToWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966755"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-1247"></span><span>                                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ByteOff
</span><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-var">ByteOff</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682966758"><span class="hs-identifier hs-var">orig_stk_bytes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1248"></span><span>         </span><span class="hs-special">}</span><span>
</span><span id="line-1249"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">((a, ByteOff) -&gt; (a, ByteOff) -&gt; Ordering)
-&gt; [(a, ByteOff)] -&gt; [(a, ByteOff)]
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((a, ByteOff) -&gt; ByteOff)
-&gt; (a, ByteOff) -&gt; (a, ByteOff) -&gt; Ordering
forall a b. Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering
</span><span class="hs-identifier hs-var">comparing</span></span><span> </span><span class="annot"><span class="annottext">(a, ByteOff) -&gt; ByteOff
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(a, ByteOff)] -&gt; [(a, ByteOff)])
-&gt; [(a, ByteOff)] -&gt; [(a, ByteOff)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1250"></span><span>              </span><span class="annot"><span class="annottext">((a, ByteOff) -&gt; (a, ByteOff)) -&gt; [(a, ByteOff)] -&gt; [(a, ByteOff)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682966801"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682966801"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966802"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966802"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682966801"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966802"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966752"><span class="hs-identifier hs-var">start_off</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1251"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(a, ByteOff)]
</span><a href="#local-6989586621682966762"><span class="hs-identifier hs-var">orig_stk_params</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, ByteOff)] -&gt; [(a, ByteOff)] -&gt; [(a, ByteOff)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">((a, ParamLocation) -&gt; (a, ByteOff))
-&gt; [(a, ParamLocation)] -&gt; [(a, ByteOff)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(a, ParamLocation) -&gt; (a, ByteOff)
forall {b} {a}. Num b =&gt; (a, ParamLocation) -&gt; (a, b)
</span><a href="#local-6989586621682966794"><span class="hs-identifier hs-var">get_byte_off</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, ParamLocation)]
</span><a href="#local-6989586621682966784"><span class="hs-identifier hs-var">new_stk_params</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1252"></span><span>     </span><span class="hs-special">)</span><span>
</span><span id="line-1253"></span><span>
</span><span id="line-1254"></span><span class="hs-comment">{- Note [Return convention for non-tuple values]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The RETURN and ENTER instructions are used to return values. RETURN directly
returns the value at the top of the stack while ENTER evaluates it first (so
RETURN is only used when the result is already known to be evaluated), but the
end result is the same: control returns to the enclosing stack frame with the
result at the top of the stack.

The PUSH_ALTS instruction pushes a two-word stack frame that receives a single
lifted value. Its payload is a BCO that is executed when control returns, with
the stack set up as if a RETURN instruction had just been executed: the returned
value is at the top of the stack, and beneath it is the two-word frame being
returned to. It is the continuation BCO&#8217;s job to pop its own frame off the
stack, so the simplest possible continuation consists of two instructions:

    SLIDE 1 2   -- pop the return frame off the stack, keeping the returned value
    RETURN P    -- return the returned value to our caller

RETURN and PUSH_ALTS are not really instructions but are in fact representation-
polymorphic *families* of instructions indexed by ArgRep. ENTER, however, is a
single real instruction, since it is only used to return lifted values, which
are always pointers.

The RETURN, ENTER, and PUSH_ALTS instructions are only used when the returned
value has nullary or unary representation. Returning/receiving an unboxed
tuple (or, indirectly, an unboxed sum, since unboxed sums have been desugared to
unboxed tuples by Unarise) containing two or more results uses the special
RETURN_TUPLE/PUSH_ALTS_TUPLE instructions, which use a different return
convention. See Note [unboxed tuple bytecodes and tuple_BCO] for details.

Note [unboxed tuple bytecodes and tuple_BCO]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  We have the bytecode instructions RETURN_TUPLE and PUSH_ALTS_TUPLE to
  return and receive arbitrary unboxed tuples, respectively. These
  instructions use the helper data tuple_BCO and call_info.

  The helper data is used to convert tuples between GHCs native calling
  convention (object code), which uses stack and registers, and the bytecode
  calling convention, which only uses the stack. See Note [GHCi TupleInfo]
  for more details.


  Returning a tuple
  =================

  Bytecode that returns a tuple first pushes all the tuple fields followed
  by the appropriate call_info and tuple_BCO onto the stack. It then
  executes the RETURN_TUPLE instruction, which causes the interpreter
  to push stg_ret_t_info to the top of the stack. The stack (growing down)
  then looks as follows:

      ...
      next_frame
      tuple_field_1
      tuple_field_2
      ...
      tuple_field_n
      call_info
      tuple_BCO
      stg_ret_t_info &lt;- Sp

  If next_frame is bytecode, the interpreter will start executing it. If
  it's object code, the interpreter jumps back to the scheduler, which in
  turn jumps to stg_ret_t. stg_ret_t converts the tuple to the native
  calling convention using the description in call_info, and then jumps
  to next_frame.


  Receiving a tuple
  =================

  Bytecode that receives a tuple uses the PUSH_ALTS_TUPLE instruction to
  push a continuation, followed by jumping to the code that produces the
  tuple. The PUSH_ALTS_TUPLE instuction contains three pieces of data:

     * cont_BCO: the continuation that receives the tuple
     * call_info: see below
     * tuple_BCO: see below

  The interpreter pushes these onto the stack when the PUSH_ALTS_TUPLE
  instruction is executed, followed by stg_ctoi_tN_info, with N depending
  on the number of stack words used by the tuple in the GHC native calling
  convention. N is derived from call_info.

  For example if we expect a tuple with three words on the stack, the stack
  looks as follows after PUSH_ALTS_TUPLE:

      ...
      next_frame
      cont_free_var_1
      cont_free_var_2
      ...
      cont_free_var_n
      call_info
      tuple_BCO
      cont_BCO
      stg_ctoi_t3_info &lt;- Sp

  If the tuple is returned by object code, stg_ctoi_t3 will deal with
  adjusting the stack pointer and converting the tuple to the bytecode
  calling convention. See Note [GHCi unboxed tuples stack spills] for more
  details.


  The tuple_BCO
  =============

  The tuple_BCO is a helper bytecode object. Its main purpose is describing
  the contents of the stack frame containing the tuple for the storage
  manager. It contains only instructions to immediately return the tuple
  that is already on the stack.


  The call_info word
  ===================

  The call_info word describes the stack and STG register (e.g. R1..R6,
  D1..D6) usage for the tuple. call_info contains enough information to
  convert the tuple between the stack-only bytecode and stack+registers
  GHC native calling conventions.

  See Note [GHCi and native call registers] for more details of how the
  data is packed in a single word.

 -}</span><span>
</span><span id="line-1379"></span><span>
</span><span id="line-1380"></span><span class="annot"><a href="GHC.StgToByteCode.html#tupleBCO"><span class="hs-identifier hs-type">tupleBCO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#NativeCallInfo"><span class="hs-identifier hs-type">NativeCallInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#PrimRep"><span class="hs-identifier hs-type">PrimRep</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.ByteCode.Types.html#FFIInfo"><span class="hs-identifier hs-type">FFIInfo</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html#ProtoBCO"><span class="hs-identifier hs-type">ProtoBCO</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-1381"></span><span id="tupleBCO"><span class="annot"><span class="annottext">tupleBCO :: Platform
-&gt; NativeCallInfo
-&gt; [(PrimRep, ByteOff)]
-&gt; [FFIInfo]
-&gt; ProtoBCO Name
</span><a href="GHC.StgToByteCode.html#tupleBCO"><span class="hs-identifier hs-var hs-var">tupleBCO</span></a></span></span><span> </span><span id="local-6989586621682966803"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966803"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621682966804"><span class="annot"><span class="annottext">NativeCallInfo
</span><a href="#local-6989586621682966804"><span class="hs-identifier hs-var">args_info</span></a></span></span><span> </span><span id="local-6989586621682966805"><span class="annot"><span class="annottext">[(PrimRep, ByteOff)]
</span><a href="#local-6989586621682966805"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1382"></span><span>  </span><span class="annot"><span class="annottext">Platform
-&gt; Name
-&gt; OrdList BCInstr
-&gt; Either [CgStgAlt] CgStgRhs
-&gt; Int
-&gt; WordOff
-&gt; [StgWord]
-&gt; Bool
-&gt; [FFIInfo]
-&gt; ProtoBCO Name
forall name.
Platform
-&gt; name
-&gt; OrdList BCInstr
-&gt; Either [CgStgAlt] CgStgRhs
-&gt; Int
-&gt; WordOff
-&gt; [StgWord]
-&gt; Bool
-&gt; [FFIInfo]
-&gt; ProtoBCO name
</span><a href="GHC.StgToByteCode.html#mkProtoBCO"><span class="hs-identifier hs-var">mkProtoBCO</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966803"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682966806"><span class="hs-identifier hs-var">invented_name</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621682966807"><span class="hs-identifier hs-var">body_code</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CgStgAlt] -&gt; Either [CgStgAlt] CgStgRhs
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1383"></span><span>             </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-comment">{-no arity-}</span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966808"><span class="hs-identifier hs-var">bitmap_size</span></a></span><span> </span><span class="annot"><span class="annottext">[StgWord]
</span><a href="#local-6989586621682966809"><span class="hs-identifier hs-var">bitmap</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-comment">{-is alts-}</span><span>
</span><span id="line-1384"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1385"></span><span>    </span><span class="hs-comment">{-
      The tuple BCO is never referred to by name, so we can get away
      with using a fake name here. We will need to change this if we want
      to save some memory by sharing the BCO between places that have
      the same tuple shape
    -}</span><span>
</span><span id="line-1391"></span><span>    </span><span id="local-6989586621682966806"><span class="annot"><span class="annottext">invented_name :: Name
</span><a href="#local-6989586621682966806"><span class="hs-identifier hs-var hs-var">invented_name</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; FastString -&gt; Name
</span><a href="GHC.Types.Name.html#mkSystemVarName"><span class="hs-identifier hs-var">mkSystemVarName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Unique
</span><a href="GHC.Builtin.Uniques.html#mkPseudoUniqueE"><span class="hs-identifier hs-var">mkPseudoUniqueE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tuple&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1392"></span><span>
</span><span id="line-1393"></span><span>    </span><span class="hs-comment">-- the first word in the frame is the call_info word,</span><span>
</span><span id="line-1394"></span><span>    </span><span class="hs-comment">-- which is not a pointer</span><span>
</span><span id="line-1395"></span><span>    </span><span id="local-6989586621682966814"><span class="annot"><span class="annottext">nptrs_prefix :: WordOff
</span><a href="#local-6989586621682966814"><span class="hs-identifier hs-var hs-var">nptrs_prefix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WordOff
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1396"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682966808"><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966808"><span class="hs-identifier hs-var">bitmap_size</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966809"><span class="annot"><span class="annottext">[StgWord]
</span><a href="#local-6989586621682966809"><span class="hs-identifier hs-var">bitmap</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform
-&gt; WordOff
-&gt; NativeCallInfo
-&gt; [(PrimRep, ByteOff)]
-&gt; (WordOff, [StgWord])
</span><a href="GHC.StgToByteCode.html#mkStackBitmap"><span class="hs-identifier hs-var">mkStackBitmap</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966803"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966814"><span class="hs-identifier hs-var">nptrs_prefix</span></a></span><span> </span><span class="annot"><span class="annottext">NativeCallInfo
</span><a href="#local-6989586621682966804"><span class="hs-identifier hs-var">args_info</span></a></span><span> </span><span class="annot"><span class="annottext">[(PrimRep, ByteOff)]
</span><a href="#local-6989586621682966805"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1397"></span><span>
</span><span id="line-1398"></span><span>    </span><span id="local-6989586621682966807"><span class="annot"><span class="annottext">body_code :: OrdList BCInstr
</span><a href="#local-6989586621682966807"><span class="hs-identifier hs-var hs-var">body_code</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; WordOff -&gt; OrdList BCInstr
</span><a href="GHC.StgToByteCode.html#mkSlideW"><span class="hs-identifier hs-var">mkSlideW</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><span class="hs-number">1</span></span><span>          </span><span class="hs-comment">-- pop frame header</span><span>
</span><span id="line-1399"></span><span>                </span><span class="annot"><span class="annottext">OrdList BCInstr -&gt; BCInstr -&gt; OrdList BCInstr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span> </span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#RETURN_TUPLE"><span class="hs-identifier hs-var">RETURN_TUPLE</span></a></span><span> </span><span class="hs-comment">-- and add it again</span><span>
</span><span id="line-1400"></span><span>
</span><span id="line-1401"></span><span class="annot"><a href="GHC.StgToByteCode.html#primCallBCO"><span class="hs-identifier hs-type">primCallBCO</span></a></span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#NativeCallInfo"><span class="hs-identifier hs-type">NativeCallInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#PrimRep"><span class="hs-identifier hs-type">PrimRep</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.ByteCode.Types.html#FFIInfo"><span class="hs-identifier hs-type">FFIInfo</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html#ProtoBCO"><span class="hs-identifier hs-type">ProtoBCO</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-1402"></span><span id="primCallBCO"><span class="annot"><span class="annottext">primCallBCO :: Platform
-&gt; NativeCallInfo
-&gt; [(PrimRep, ByteOff)]
-&gt; [FFIInfo]
-&gt; ProtoBCO Name
</span><a href="GHC.StgToByteCode.html#primCallBCO"><span class="hs-identifier hs-var hs-var">primCallBCO</span></a></span></span><span> </span><span id="local-6989586621682966819"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966819"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621682966820"><span class="annot"><span class="annottext">NativeCallInfo
</span><a href="#local-6989586621682966820"><span class="hs-identifier hs-var">args_info</span></a></span></span><span> </span><span id="local-6989586621682966821"><span class="annot"><span class="annottext">[(PrimRep, ByteOff)]
</span><a href="#local-6989586621682966821"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1403"></span><span>  </span><span class="annot"><span class="annottext">Platform
-&gt; Name
-&gt; OrdList BCInstr
-&gt; Either [CgStgAlt] CgStgRhs
-&gt; Int
-&gt; WordOff
-&gt; [StgWord]
-&gt; Bool
-&gt; [FFIInfo]
-&gt; ProtoBCO Name
forall name.
Platform
-&gt; name
-&gt; OrdList BCInstr
-&gt; Either [CgStgAlt] CgStgRhs
-&gt; Int
-&gt; WordOff
-&gt; [StgWord]
-&gt; Bool
-&gt; [FFIInfo]
-&gt; ProtoBCO name
</span><a href="GHC.StgToByteCode.html#mkProtoBCO"><span class="hs-identifier hs-var">mkProtoBCO</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966819"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682966822"><span class="hs-identifier hs-var">invented_name</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621682966823"><span class="hs-identifier hs-var">body_code</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CgStgAlt] -&gt; Either [CgStgAlt] CgStgRhs
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1404"></span><span>             </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-comment">{-no arity-}</span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966824"><span class="hs-identifier hs-var">bitmap_size</span></a></span><span> </span><span class="annot"><span class="annottext">[StgWord]
</span><a href="#local-6989586621682966825"><span class="hs-identifier hs-var">bitmap</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-comment">{-is alts-}</span><span>
</span><span id="line-1405"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1406"></span><span>    </span><span class="hs-comment">{-
      The primcall BCO is never referred to by name, so we can get away
      with using a fake name here. We will need to change this if we want
      to save some memory by sharing the BCO between places that have
      the same tuple shape
    -}</span><span>
</span><span id="line-1412"></span><span>    </span><span id="local-6989586621682966822"><span class="annot"><span class="annottext">invented_name :: Name
</span><a href="#local-6989586621682966822"><span class="hs-identifier hs-var hs-var">invented_name</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; FastString -&gt; Name
</span><a href="GHC.Types.Name.html#mkSystemVarName"><span class="hs-identifier hs-var">mkSystemVarName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Unique
</span><a href="GHC.Builtin.Uniques.html#mkPseudoUniqueE"><span class="hs-identifier hs-var">mkPseudoUniqueE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;primcall&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1413"></span><span>
</span><span id="line-1414"></span><span>    </span><span class="hs-comment">-- The first two words in the frame (after the BCO) are the call_info word</span><span>
</span><span id="line-1415"></span><span>    </span><span class="hs-comment">-- and the pointer to the Cmm function being called. Neither of these is a</span><span>
</span><span id="line-1416"></span><span>    </span><span class="hs-comment">-- pointer that should be followed by the garbage collector.</span><span>
</span><span id="line-1417"></span><span>    </span><span id="local-6989586621682966827"><span class="annot"><span class="annottext">nptrs_prefix :: WordOff
</span><a href="#local-6989586621682966827"><span class="hs-identifier hs-var hs-var">nptrs_prefix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WordOff
</span><span class="hs-number">2</span></span><span>
</span><span id="line-1418"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682966824"><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966824"><span class="hs-identifier hs-var">bitmap_size</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966825"><span class="annot"><span class="annottext">[StgWord]
</span><a href="#local-6989586621682966825"><span class="hs-identifier hs-var">bitmap</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform
-&gt; WordOff
-&gt; NativeCallInfo
-&gt; [(PrimRep, ByteOff)]
-&gt; (WordOff, [StgWord])
</span><a href="GHC.StgToByteCode.html#mkStackBitmap"><span class="hs-identifier hs-var">mkStackBitmap</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966819"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966827"><span class="hs-identifier hs-var">nptrs_prefix</span></a></span><span> </span><span class="annot"><span class="annottext">NativeCallInfo
</span><a href="#local-6989586621682966820"><span class="hs-identifier hs-var">args_info</span></a></span><span> </span><span class="annot"><span class="annottext">[(PrimRep, ByteOff)]
</span><a href="#local-6989586621682966821"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1419"></span><span>
</span><span id="line-1420"></span><span>    </span><span class="hs-comment">-- if the primcall BCO is ever run it's a bug, since the BCO should only</span><span>
</span><span id="line-1421"></span><span>    </span><span class="hs-comment">-- be pushed immediately before running the PRIMCALL bytecode instruction,</span><span>
</span><span id="line-1422"></span><span>    </span><span class="hs-comment">-- which immediately leaves the interpreter to jump to the stg_primcall_info</span><span>
</span><span id="line-1423"></span><span>    </span><span class="hs-comment">-- Cmm function</span><span>
</span><span id="line-1424"></span><span>    </span><span id="local-6989586621682966823"><span class="annot"><span class="annottext">body_code :: OrdList BCInstr
</span><a href="#local-6989586621682966823"><span class="hs-identifier hs-var hs-var">body_code</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">BCInstr -&gt; OrdList BCInstr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#CASEFAIL"><span class="hs-identifier hs-var">CASEFAIL</span></a></span><span>
</span><span id="line-1425"></span><span>
</span><span id="line-1426"></span><span class="hs-comment">-- | Builds a bitmap for a stack layout with a nonpointer prefix followed by</span><span>
</span><span id="line-1427"></span><span class="hs-comment">-- some number of arguments.</span><span>
</span><span id="line-1428"></span><span class="annot"><a href="GHC.StgToByteCode.html#mkStackBitmap"><span class="hs-identifier hs-type">mkStackBitmap</span></a></span><span>
</span><span id="line-1429"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span>
</span><span id="line-1430"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a></span><span>
</span><span id="line-1431"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ The number of nonpointer words that prefix the arguments.</span></span><span>
</span><span id="line-1432"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#NativeCallInfo"><span class="hs-identifier hs-type">NativeCallInfo</span></a></span><span>
</span><span id="line-1433"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#PrimRep"><span class="hs-identifier hs-type">PrimRep</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1434"></span><span>  </span><span class="hs-comment">-- ^ The stack layout of the arguments, where each offset is relative to the</span><span>
</span><span id="line-1435"></span><span>  </span><span class="hs-comment">-- /bottom/ of the stack space they occupy. Their offsets must be word-aligned,</span><span>
</span><span id="line-1436"></span><span>  </span><span class="hs-comment">-- and the list must be sorted in order of ascending offset (i.e. bottom to top).</span><span>
</span><span id="line-1437"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.ByteCode.Types.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Runtime.Heap.Layout.html#StgWord"><span class="hs-identifier hs-type">StgWord</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1438"></span><span id="mkStackBitmap"><span class="annot"><span class="annottext">mkStackBitmap :: Platform
-&gt; WordOff
-&gt; NativeCallInfo
-&gt; [(PrimRep, ByteOff)]
-&gt; (WordOff, [StgWord])
</span><a href="GHC.StgToByteCode.html#mkStackBitmap"><span class="hs-identifier hs-var hs-var">mkStackBitmap</span></a></span></span><span> </span><span id="local-6989586621682966829"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966829"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621682966830"><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966830"><span class="hs-identifier hs-var">nptrs_prefix</span></a></span></span><span> </span><span id="local-6989586621682966831"><span class="annot"><span class="annottext">NativeCallInfo
</span><a href="#local-6989586621682966831"><span class="hs-identifier hs-var">args_info</span></a></span></span><span> </span><span id="local-6989586621682966832"><span class="annot"><span class="annottext">[(PrimRep, ByteOff)]
</span><a href="#local-6989586621682966832"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-1439"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966833"><span class="hs-identifier hs-var">bitmap_size</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[StgWord]
</span><a href="#local-6989586621682966834"><span class="hs-identifier hs-var">bitmap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1440"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1441"></span><span>    </span><span id="local-6989586621682966833"><span class="annot"><span class="annottext">bitmap_size :: WordOff
</span><a href="#local-6989586621682966833"><span class="hs-identifier hs-var hs-var">bitmap_size</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966830"><span class="hs-identifier hs-var">nptrs_prefix</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; WordOff -&gt; WordOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966835"><span class="hs-identifier hs-var">arg_bottom</span></a></span><span>
</span><span id="line-1442"></span><span>    </span><span id="local-6989586621682966834"><span class="annot"><span class="annottext">bitmap :: [StgWord]
</span><a href="#local-6989586621682966834"><span class="hs-identifier hs-var hs-var">bitmap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Int -&gt; [Int] -&gt; [StgWord]
</span><a href="GHC.Data.Bitmap.html#intsToReverseBitmap"><span class="hs-identifier hs-var">intsToReverseBitmap</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966829"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WordOff -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966833"><span class="hs-identifier hs-var">bitmap_size</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621682966836"><span class="hs-identifier hs-var">ptr_offsets</span></a></span><span>
</span><span id="line-1443"></span><span>
</span><span id="line-1444"></span><span>    </span><span id="local-6989586621682966835"><span class="annot"><span class="annottext">arg_bottom :: WordOff
</span><a href="#local-6989586621682966835"><span class="hs-identifier hs-var hs-var">arg_bottom</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NativeCallInfo -&gt; WordOff
</span><a href="GHC.ByteCode.Types.html#nativeCallSize"><span class="hs-identifier hs-var">nativeCallSize</span></a></span><span> </span><span class="annot"><span class="annottext">NativeCallInfo
</span><a href="#local-6989586621682966831"><span class="hs-identifier hs-var">args_info</span></a></span><span>
</span><span id="line-1445"></span><span>    </span><span id="local-6989586621682966836"><span class="annot"><span class="annottext">ptr_offsets :: [Int]
</span><a href="#local-6989586621682966836"><span class="hs-identifier hs-var hs-var">ptr_offsets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Int]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; [Int]) -&gt; [Int] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ByteOff -&gt; Int) -&gt; [ByteOff] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WordOff -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(WordOff -&gt; Int) -&gt; (ByteOff -&gt; WordOff) -&gt; ByteOff -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; WordOff
</span><a href="#local-6989586621682966837"><span class="hs-identifier hs-var">convert_arg_offset</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1446"></span><span>                </span><span class="annot"><span class="annottext">([ByteOff] -&gt; [Int]) -&gt; [ByteOff] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((PrimRep, ByteOff) -&gt; Maybe ByteOff)
-&gt; [(PrimRep, ByteOff)] -&gt; [ByteOff]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">(PrimRep, ByteOff) -&gt; Maybe ByteOff
</span><a href="#local-6989586621682966839"><span class="hs-identifier hs-var">get_ptr_offset</span></a></span><span> </span><span class="annot"><span class="annottext">[(PrimRep, ByteOff)]
</span><a href="#local-6989586621682966832"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1447"></span><span>
</span><span id="line-1448"></span><span>    </span><span class="annot"><a href="#local-6989586621682966839"><span class="hs-identifier hs-type">get_ptr_offset</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#PrimRep"><span class="hs-identifier hs-type">PrimRep</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span>
</span><span id="line-1449"></span><span>    </span><span id="local-6989586621682966839"><span class="annot"><span class="annottext">get_ptr_offset :: (PrimRep, ByteOff) -&gt; Maybe ByteOff
</span><a href="#local-6989586621682966839"><span class="hs-identifier hs-var hs-var">get_ptr_offset</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682966840"><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621682966840"><span class="hs-identifier hs-var">rep</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966841"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966841"><span class="hs-identifier hs-var">byte_offset</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1450"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ArgRep -&gt; Bool
</span><a href="GHC.StgToByteCode.html#isFollowableArg"><span class="hs-identifier hs-var">isFollowableArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; PrimRep -&gt; ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#toArgRep"><span class="hs-identifier hs-var">toArgRep</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966829"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621682966840"><span class="hs-identifier hs-var">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; Maybe ByteOff
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966841"><span class="hs-identifier hs-var">byte_offset</span></a></span><span>
</span><span id="line-1451"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ByteOff
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1452"></span><span>
</span><span id="line-1453"></span><span>    </span><span class="annot"><a href="#local-6989586621682966837"><span class="hs-identifier hs-type">convert_arg_offset</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a></span><span>
</span><span id="line-1454"></span><span>    </span><span id="local-6989586621682966837"><span class="annot"><span class="annottext">convert_arg_offset :: ByteOff -&gt; WordOff
</span><a href="#local-6989586621682966837"><span class="hs-identifier hs-var hs-var">convert_arg_offset</span></a></span></span><span> </span><span id="local-6989586621682966842"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966842"><span class="hs-identifier hs-var">arg_offset</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1455"></span><span>      </span><span class="hs-comment">-- The argument offsets are relative to `arg_bottom`, but</span><span>
</span><span id="line-1456"></span><span>      </span><span class="hs-comment">-- `intsToReverseBitmap` expects offsets from the top, so we need to flip</span><span>
</span><span id="line-1457"></span><span>      </span><span class="hs-comment">-- them around.</span><span>
</span><span id="line-1458"></span><span>      </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966830"><span class="hs-identifier hs-var">nptrs_prefix</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; WordOff -&gt; WordOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966835"><span class="hs-identifier hs-var">arg_bottom</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; WordOff -&gt; WordOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#bytesToWords"><span class="hs-identifier hs-var">bytesToWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966829"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966842"><span class="hs-identifier hs-var">arg_offset</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1459"></span><span>
</span><span id="line-1460"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-1461"></span><span class="hs-comment">-- Deal with a primitive call to native code.</span><span>
</span><span id="line-1462"></span><span>
</span><span id="line-1463"></span><span class="annot"><a href="GHC.StgToByteCode.html#generatePrimCall"><span class="hs-identifier hs-type">generatePrimCall</span></a></span><span>
</span><span id="line-1464"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-type">StackDepth</span></a></span><span>
</span><span id="line-1465"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#Sequel"><span class="hs-identifier hs-type">Sequel</span></a></span><span>
</span><span id="line-1466"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCEnv"><span class="hs-identifier hs-type">BCEnv</span></a></span><span>
</span><span id="line-1467"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.ForeignCall.html#CLabelString"><span class="hs-identifier hs-type">CLabelString</span></a></span><span>          </span><span class="hs-comment">-- where to call</span><span>
</span><span id="line-1468"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Unit"><span class="hs-identifier hs-type">Unit</span></a></span><span>
</span><span id="line-1469"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-1470"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span class="hs-special">]</span><span>              </span><span class="hs-comment">-- args (atoms)</span><span>
</span><span id="line-1471"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span>
</span><span id="line-1472"></span><span id="generatePrimCall"><span class="annot"><span class="annottext">generatePrimCall :: ByteOff
-&gt; ByteOff
-&gt; Map Id ByteOff
-&gt; FastString
-&gt; Maybe (GenUnit UnitId)
-&gt; Type
-&gt; [StgArg]
-&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#generatePrimCall"><span class="hs-identifier hs-var hs-var">generatePrimCall</span></a></span></span><span> </span><span id="local-6989586621682966845"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966845"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682966846"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966846"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682966847"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966847"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621682966848"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682966848"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span id="local-6989586621682966849"><span class="annot"><span class="annottext">Maybe (GenUnit UnitId)
</span><a href="#local-6989586621682966849"><span class="hs-identifier hs-var">_mb_unit</span></a></span></span><span> </span><span id="local-6989586621682966850"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682966850"><span class="hs-identifier hs-var">_result_ty</span></a></span></span><span> </span><span id="local-6989586621682966851"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682966851"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-1473"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1474"></span><span>     </span><span id="local-6989586621682966852"><span class="annot"><a href="#local-6989586621682966852"><span class="hs-identifier hs-var">profile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BcM Profile
</span><a href="GHC.StgToByteCode.html#getProfile"><span class="hs-identifier hs-var">getProfile</span></a></span><span>
</span><span id="line-1475"></span><span>     </span><span class="hs-keyword">let</span><span>
</span><span id="line-1476"></span><span>         </span><span id="local-6989586621682966853"><span class="annot"><a href="#local-6989586621682966853"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Profile -&gt; Platform
</span><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682966852"><span class="hs-identifier hs-var">profile</span></a></span><span>
</span><span id="line-1477"></span><span>
</span><span id="line-1478"></span><span>         </span><span id="local-6989586621682966854"><span class="annot"><a href="#local-6989586621682966854"><span class="hs-identifier hs-var hs-var">non_void</span></a></span></span><span> </span><span class="annot"><span class="annottext">PrimOrVoidRep
</span><a href="GHC.Core.TyCon.html#VoidRep"><span class="hs-identifier hs-var">VoidRep</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1479"></span><span>         </span><span class="annot"><a href="#local-6989586621682966854"><span class="hs-identifier hs-var">non_void</span></a></span><span> </span><span class="annot"><span class="annottext">PrimOrVoidRep
</span><span class="hs-identifier">_</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1480"></span><span>
</span><span id="line-1481"></span><span>         </span><span class="annot"><a href="#local-6989586621682966856"><span class="hs-identifier hs-type">nv_args</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1482"></span><span>         </span><span id="local-6989586621682966856"><span class="annot"><a href="#local-6989586621682966856"><span class="hs-identifier hs-var hs-var">nv_args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(StgArg -&gt; Bool) -&gt; [StgArg] -&gt; [StgArg]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimOrVoidRep -&gt; Bool
</span><a href="#local-6989586621682966854"><span class="hs-identifier hs-var">non_void</span></a></span><span> </span><span class="annot"><span class="annottext">(PrimOrVoidRep -&gt; Bool)
-&gt; (StgArg -&gt; PrimOrVoidRep) -&gt; StgArg -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">StgArg -&gt; PrimOrVoidRep
</span><a href="GHC.Stg.Syntax.html#stgArgRep1"><span class="hs-identifier hs-var">stgArgRep1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682966851"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1483"></span><span>
</span><span id="line-1484"></span><span>         </span><span class="hs-special">(</span><span id="local-6989586621682966858"><span class="annot"><a href="#local-6989586621682966858"><span class="hs-identifier hs-var">args_info</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966859"><span class="annot"><a href="#local-6989586621682966859"><span class="hs-identifier hs-var">args_offsets</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1485"></span><span>              </span><span class="annot"><a href="GHC.StgToByteCode.html#layoutNativeCall"><span class="hs-identifier hs-type">layoutNativeCall</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966852"><span class="hs-identifier hs-type">profile</span></a></span><span>
</span><span id="line-1486"></span><span>                               </span><span class="annot"><a href="GHC.ByteCode.Types.html#NativePrimCall"><span class="hs-identifier hs-type">NativePrimCall</span></a></span><span>
</span><span id="line-1487"></span><span>                               </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-1488"></span><span>                               </span><span class="annot"><a href="GHC.Stg.Syntax.html#stgArgRepU"><span class="hs-identifier hs-type">stgArgRepU</span></a></span><span>
</span><span id="line-1489"></span><span>                               </span><span class="annot"><a href="#local-6989586621682966856"><span class="hs-identifier hs-type">nv_args</span></a></span><span>
</span><span id="line-1490"></span><span>
</span><span id="line-1491"></span><span>         </span><span id="local-6989586621682966861"><span class="annot"><a href="#local-6989586621682966861"><span class="hs-identifier hs-var hs-var">prim_args_offsets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(StgArg -&gt; PrimRep) -&gt; [(StgArg, ByteOff)] -&gt; [(PrimRep, ByteOff)]
forall (f :: * -&gt; *) a c b.
Functor f =&gt;
(a -&gt; c) -&gt; f (a, b) -&gt; f (c, b)
</span><a href="GHC.Utils.Misc.html#mapFst"><span class="hs-identifier hs-var">mapFst</span></a></span><span> </span><span class="annot"><span class="annottext">StgArg -&gt; PrimRep
</span><a href="GHC.Stg.Syntax.html#stgArgRepU"><span class="hs-identifier hs-var">stgArgRepU</span></a></span><span> </span><span class="annot"><span class="annottext">[(StgArg, ByteOff)]
</span><a href="#local-6989586621682966859"><span class="hs-identifier hs-var">args_offsets</span></a></span><span>
</span><span id="line-1492"></span><span>         </span><span id="local-6989586621682966863"><span class="annot"><a href="#local-6989586621682966863"><span class="hs-identifier hs-var hs-var">shifted_args_offsets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ByteOff -&gt; ByteOff) -&gt; [(StgArg, ByteOff)] -&gt; [(StgArg, ByteOff)]
forall (f :: * -&gt; *) b c a.
Functor f =&gt;
(b -&gt; c) -&gt; f (a, b) -&gt; f (a, c)
</span><a href="GHC.Utils.Misc.html#mapSnd"><span class="hs-identifier hs-var">mapSnd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966845"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(StgArg, ByteOff)]
</span><a href="#local-6989586621682966859"><span class="hs-identifier hs-var">args_offsets</span></a></span><span>
</span><span id="line-1493"></span><span>
</span><span id="line-1494"></span><span>         </span><span id="local-6989586621682966865"><span class="annot"><a href="#local-6989586621682966865"><span class="hs-identifier hs-var hs-var">push_target</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; WordOff -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_UBX"><span class="hs-identifier hs-var">PUSH_UBX</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; FunctionOrData -&gt; Literal
</span><a href="GHC.Types.Literal.html#LitLabel"><span class="hs-identifier hs-var">LitLabel</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682966848"><span class="hs-identifier hs-var">target</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionOrData
</span><a href="GHC.Types.Basic.html#IsFunction"><span class="hs-identifier hs-var">IsFunction</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">WordOff
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1495"></span><span>         </span><span id="local-6989586621682966867"><span class="annot"><a href="#local-6989586621682966867"><span class="hs-identifier hs-var hs-var">push_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; WordOff -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_UBX"><span class="hs-identifier hs-var">PUSH_UBX</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; NativeCallInfo -&gt; Literal
</span><a href="GHC.ByteCode.Asm.html#mkNativeCallInfoLit"><span class="hs-identifier hs-var">mkNativeCallInfoLit</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966853"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">NativeCallInfo
</span><a href="#local-6989586621682966858"><span class="hs-identifier hs-var">args_info</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">WordOff
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1496"></span><span>         </span><span class="hs-comment">{-
            compute size to move payload (without stg_primcall_info header)

            size of arguments plus three words for:
                - function pointer to the target
                - call_info word
                - BCO to describe the stack frame
          -}</span><span>
</span><span id="line-1504"></span><span>         </span><span id="local-6989586621682966868"><span class="annot"><a href="#local-6989586621682966868"><span class="hs-identifier hs-var hs-var">szb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; WordOff -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordsToBytes"><span class="hs-identifier hs-var">wordsToBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966853"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NativeCallInfo -&gt; WordOff
</span><a href="GHC.ByteCode.Types.html#nativeCallSize"><span class="hs-identifier hs-var">nativeCallSize</span></a></span><span> </span><span class="annot"><span class="annottext">NativeCallInfo
</span><a href="#local-6989586621682966858"><span class="hs-identifier hs-var">args_info</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; WordOff -&gt; WordOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><span class="hs-number">3</span></span><span class="hs-special">)</span><span>
</span><span id="line-1505"></span><span>         </span><span id="local-6989586621682966869"><span class="annot"><a href="#local-6989586621682966869"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-identifier">_</span></span><span>   </span><span id="local-6989586621682966870"><span class="annot"><span class="annottext">[OrdList BCInstr]
</span><a href="#local-6989586621682966870"><span class="hs-identifier hs-var">pushes</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[OrdList BCInstr] -&gt; BcM [OrdList BCInstr]
forall a. a -&gt; BcM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[OrdList BCInstr] -&gt; [OrdList BCInstr]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[OrdList BCInstr]
</span><a href="#local-6989586621682966870"><span class="hs-identifier hs-var">pushes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1506"></span><span>         </span><span class="annot"><a href="#local-6989586621682966869"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682966871"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966871"><span class="hs-identifier hs-var">dd</span></a></span></span><span> </span><span id="local-6989586621682966872"><span class="annot"><span class="annottext">[OrdList BCInstr]
</span><a href="#local-6989586621682966872"><span class="hs-identifier hs-var">pushes</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682966873"><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621682966873"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966874"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966874"><span class="hs-identifier hs-var">off</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682966875"><span class="annot"><span class="annottext">[(StgArg, ByteOff)]
</span><a href="#local-6989586621682966875"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682966876"><span class="annot"><a href="#local-6989586621682966876"><span class="hs-identifier hs-var">push</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966877"><span class="annot"><a href="#local-6989586621682966877"><span class="hs-identifier hs-var">szb</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; Map Id ByteOff -&gt; StgArg -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushAtom"><span class="hs-identifier hs-var">pushAtom</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966871"><span class="hs-identifier hs-var">dd</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966847"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621682966873"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1507"></span><span>                                          </span><span class="annot"><a href="GHC.Utils.Panic.Plain.html#massert"><span class="hs-identifier hs-type">massert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682966874"><span class="hs-identifier hs-type">off</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="#local-6989586621682966871"><span class="hs-identifier hs-type">dd</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><a href="#local-6989586621682966877"><span class="hs-identifier hs-type">szb</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1508"></span><span>                                          </span><span class="annot"><a href="#local-6989586621682966869"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682966871"><span class="hs-identifier hs-type">dd</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><a href="#local-6989586621682966877"><span class="hs-identifier hs-type">szb</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682966876"><span class="hs-identifier hs-type">push</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><a href="#local-6989586621682966872"><span class="hs-identifier hs-type">pushes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682966875"><span class="hs-identifier hs-type">cs</span></a></span><span>
</span><span id="line-1509"></span><span>     </span><span id="local-6989586621682966878"><span class="annot"><a href="#local-6989586621682966878"><span class="hs-identifier hs-var">push_args</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682966869"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966845"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621682966863"><span class="hs-identifier hs-type">shifted_args_offsets</span></a></span><span>
</span><span id="line-1510"></span><span>     </span><span id="local-6989586621682966879"><span class="annot"><a href="#local-6989586621682966879"><span class="hs-identifier hs-var">args_bco</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#emitBc"><span class="hs-identifier hs-type">emitBc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#primCallBCO"><span class="hs-identifier hs-type">primCallBCO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966853"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966858"><span class="hs-identifier hs-type">args_info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966861"><span class="hs-identifier hs-type">prim_args_offsets</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1511"></span><span>     </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mconcat</span></span><span> </span><span class="annot"><a href="#local-6989586621682966878"><span class="hs-identifier hs-type">push_args</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span>
</span><span id="line-1512"></span><span>              </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682966865"><span class="hs-identifier hs-type">push_target</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-type">`consOL`</span></a></span><span>
</span><span id="line-1513"></span><span>               </span><span class="annot"><a href="#local-6989586621682966867"><span class="hs-identifier hs-type">push_info</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-type">`consOL`</span></a></span><span>
</span><span id="line-1514"></span><span>               </span><span class="annot"><a href="GHC.ByteCode.Instr.html#PUSH_BCO"><span class="hs-identifier hs-type">PUSH_BCO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966879"><span class="hs-identifier hs-type">args_bco</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-type">`consOL`</span></a></span><span>
</span><span id="line-1515"></span><span>               </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#mkSlideB"><span class="hs-identifier hs-type">mkSlideB</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966853"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966868"><span class="hs-identifier hs-type">szb</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682966845"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">-</span></span><span> </span><span class="annot"><a href="#local-6989586621682966846"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-type">`consOL`</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-type">unitOL</span></a></span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html#PRIMCALL"><span class="hs-identifier hs-type">PRIMCALL</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1516"></span><span>
</span><span id="line-1517"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-1518"></span><span class="hs-comment">-- Deal with a CCall.</span><span>
</span><span id="line-1519"></span><span>
</span><span id="line-1520"></span><span class="hs-comment">-- Taggedly push the args onto the stack R-&gt;L,</span><span>
</span><span id="line-1521"></span><span class="hs-comment">-- deferencing ForeignObj#s and adjusting addrs to point to</span><span>
</span><span id="line-1522"></span><span class="hs-comment">-- payloads in Ptr/Byte arrays.  Then, generate the marshalling</span><span>
</span><span id="line-1523"></span><span class="hs-comment">-- (machine) code for the ccall, and create bytecodes to call that and</span><span>
</span><span id="line-1524"></span><span class="hs-comment">-- then return in the right way.</span><span>
</span><span id="line-1525"></span><span>
</span><span id="line-1526"></span><span class="annot"><a href="GHC.StgToByteCode.html#generateCCall"><span class="hs-identifier hs-type">generateCCall</span></a></span><span>
</span><span id="line-1527"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-type">StackDepth</span></a></span><span>
</span><span id="line-1528"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#Sequel"><span class="hs-identifier hs-type">Sequel</span></a></span><span>
</span><span id="line-1529"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCEnv"><span class="hs-identifier hs-type">BCEnv</span></a></span><span>
</span><span id="line-1530"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.ForeignCall.html#CCallSpec"><span class="hs-identifier hs-type">CCallSpec</span></a></span><span>               </span><span class="hs-comment">-- where to call</span><span>
</span><span id="line-1531"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-1532"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span class="hs-special">]</span><span>              </span><span class="hs-comment">-- args (atoms)</span><span>
</span><span id="line-1533"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span>
</span><span id="line-1534"></span><span id="generateCCall"><span class="annot"><span class="annottext">generateCCall :: ByteOff
-&gt; ByteOff
-&gt; Map Id ByteOff
-&gt; CCallSpec
-&gt; Type
-&gt; [StgArg]
-&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#generateCCall"><span class="hs-identifier hs-var hs-var">generateCCall</span></a></span></span><span> </span><span id="local-6989586621682966881"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966881"><span class="hs-identifier hs-var">d0</span></a></span></span><span> </span><span id="local-6989586621682966882"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966882"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682966883"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966883"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.ForeignCall.html#CCallSpec"><span class="hs-identifier hs-type">CCallSpec</span></a></span><span> </span><span id="local-6989586621682966885"><span class="annot"><span class="annottext">CCallTarget
</span><a href="#local-6989586621682966885"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span class="annot"><span class="annottext">CCallConv
</span><a href="GHC.Types.ForeignCall.html#PrimCallConv"><span class="hs-identifier hs-var">PrimCallConv</span></a></span><span> </span><span class="annot"><span class="annottext">Safety
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682966887"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682966887"><span class="hs-identifier hs-var">result_ty</span></a></span></span><span> </span><span id="local-6989586621682966888"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682966888"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-1535"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.ForeignCall.html#StaticTarget"><span class="hs-identifier hs-type">StaticTarget</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682966890"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682966890"><span class="hs-keyword hs-var">label</span></a></span></span><span> </span><span id="local-6989586621682966891"><span class="annot"><span class="annottext">Maybe (GenUnit UnitId)
</span><a href="#local-6989586621682966891"><span class="hs-identifier hs-var">mb_unit</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CCallTarget
</span><a href="#local-6989586621682966885"><span class="hs-identifier hs-var">target</span></a></span><span>
</span><span id="line-1536"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff
-&gt; Map Id ByteOff
-&gt; FastString
-&gt; Maybe (GenUnit UnitId)
-&gt; Type
-&gt; [StgArg]
-&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#generatePrimCall"><span class="hs-identifier hs-var">generatePrimCall</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966881"><span class="hs-identifier hs-var">d0</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966882"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966883"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682966890"><span class="hs-keyword hs-var">label</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (GenUnit UnitId)
</span><a href="#local-6989586621682966891"><span class="hs-identifier hs-var">mb_unit</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682966887"><span class="hs-identifier hs-var">result_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682966888"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1537"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1538"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; BcM (OrdList BCInstr)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.StgToByteCode.generateCCall: primcall convention only supports static targets&quot;</span></span><span>
</span><span id="line-1539"></span><span class="annot"><a href="GHC.StgToByteCode.html#generateCCall"><span class="hs-identifier hs-var">generateCCall</span></a></span><span> </span><span id="local-6989586621682966892"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966892"><span class="hs-identifier hs-var">d0</span></a></span></span><span> </span><span id="local-6989586621682966893"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966893"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682966894"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966894"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.ForeignCall.html#CCallSpec"><span class="hs-identifier hs-type">CCallSpec</span></a></span><span> </span><span id="local-6989586621682966895"><span class="annot"><span class="annottext">CCallTarget
</span><a href="#local-6989586621682966895"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span class="annot"><span class="annottext">CCallConv
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682966896"><span class="annot"><span class="annottext">Safety
</span><a href="#local-6989586621682966896"><span class="hs-identifier hs-var">safety</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682966897"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682966897"><span class="hs-identifier hs-var">result_ty</span></a></span></span><span> </span><span id="local-6989586621682966898"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682966898"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-1540"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1541"></span><span>     </span><span id="local-6989586621682966899"><span class="annot"><a href="#local-6989586621682966899"><span class="hs-identifier hs-var">profile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BcM Profile
</span><a href="GHC.StgToByteCode.html#getProfile"><span class="hs-identifier hs-var">getProfile</span></a></span><span>
</span><span id="line-1542"></span><span>
</span><span id="line-1543"></span><span>     </span><span class="hs-keyword">let</span><span>
</span><span id="line-1544"></span><span>         </span><span id="local-6989586621682966900"><span class="annot"><a href="#local-6989586621682966900"><span class="hs-identifier hs-var hs-var">args_r_to_l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[StgArg] -&gt; [StgArg]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682966898"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1545"></span><span>         </span><span id="local-6989586621682966901"><span class="annot"><a href="#local-6989586621682966901"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Profile -&gt; Platform
</span><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682966899"><span class="hs-identifier hs-var">profile</span></a></span><span>
</span><span id="line-1546"></span><span>         </span><span class="hs-comment">-- useful constants</span><span>
</span><span id="line-1547"></span><span>         </span><span class="annot"><a href="#local-6989586621682966902"><span class="hs-identifier hs-type">addr_size_b</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span>
</span><span id="line-1548"></span><span>         </span><span id="local-6989586621682966902"><span class="annot"><a href="#local-6989586621682966902"><span class="hs-identifier hs-var hs-var">addr_size_b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordSize"><span class="hs-identifier hs-var">wordSize</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966901"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-1549"></span><span>
</span><span id="line-1550"></span><span>         </span><span class="annot"><a href="#local-6989586621682966903"><span class="hs-identifier hs-type">arrayish_rep_hdr_size</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-1551"></span><span>         </span><span id="local-6989586621682966903"><span class="annot"><a href="#local-6989586621682966903"><span class="hs-identifier hs-var hs-var">arrayish_rep_hdr_size</span></a></span></span><span> </span><span id="local-6989586621682966904"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682966904"><span class="hs-identifier hs-var">t</span></a></span></span><span>
</span><span id="line-1552"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682966904"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#arrayPrimTyCon"><span class="hs-identifier hs-var">arrayPrimTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682966904"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#mutableArrayPrimTyCon"><span class="hs-identifier hs-var">mutableArrayPrimTyCon</span></a></span><span>
</span><span id="line-1553"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Profile -&gt; Int
</span><a href="GHC.Runtime.Heap.Layout.html#arrPtrsHdrSize"><span class="hs-identifier hs-var">arrPtrsHdrSize</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682966899"><span class="hs-identifier hs-var">profile</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1554"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682966904"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#smallArrayPrimTyCon"><span class="hs-identifier hs-var">smallArrayPrimTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682966904"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#smallMutableArrayPrimTyCon"><span class="hs-identifier hs-var">smallMutableArrayPrimTyCon</span></a></span><span>
</span><span id="line-1555"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Profile -&gt; Int
</span><a href="GHC.Runtime.Heap.Layout.html#smallArrPtrsHdrSize"><span class="hs-identifier hs-var">smallArrPtrsHdrSize</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682966899"><span class="hs-identifier hs-var">profile</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1556"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682966904"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#byteArrayPrimTyCon"><span class="hs-identifier hs-var">byteArrayPrimTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682966904"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#mutableByteArrayPrimTyCon"><span class="hs-identifier hs-var">mutableByteArrayPrimTyCon</span></a></span><span>
</span><span id="line-1557"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Profile -&gt; Int
</span><a href="GHC.Runtime.Heap.Layout.html#arrWordsHdrSize"><span class="hs-identifier hs-var">arrWordsHdrSize</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621682966899"><span class="hs-identifier hs-var">profile</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1558"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1559"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1560"></span><span>
</span><span id="line-1561"></span><span>         </span><span class="hs-comment">-- Get the args on the stack, with tags and suitably</span><span>
</span><span id="line-1562"></span><span>         </span><span class="hs-comment">-- dereferenced for the CCall.  For each arg, return the</span><span>
</span><span id="line-1563"></span><span>         </span><span class="hs-comment">-- depth to the first word of the bits for that arg, and the</span><span>
</span><span id="line-1564"></span><span>         </span><span class="hs-comment">-- ArgRep of what was actually pushed.</span><span>
</span><span id="line-1565"></span><span>
</span><span id="line-1566"></span><span>         </span><span class="annot"><a href="#local-6989586621682966914"><span class="hs-identifier hs-type">pargs</span></a></span><span>
</span><span id="line-1567"></span><span>             </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#PrimOrVoidRep"><span class="hs-identifier hs-type">PrimOrVoidRep</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1568"></span><span>         </span><span id="local-6989586621682966914"><span class="annot"><a href="#local-6989586621682966914"><span class="hs-identifier hs-var hs-var">pargs</span></a></span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(OrdList BCInstr, PrimOrVoidRep)]
-&gt; BcM [(OrdList BCInstr, PrimOrVoidRep)]
forall a. a -&gt; BcM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1569"></span><span>         </span><span class="annot"><a href="#local-6989586621682966914"><span class="hs-identifier hs-var">pargs</span></a></span><span> </span><span id="local-6989586621682966915"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966915"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682966916"><span class="annot"><span class="annottext">aa :: StgArg
</span><a href="#local-6989586621682966916"><span class="hs-identifier hs-var">aa</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgVarArg"><span class="hs-identifier hs-type">StgVarArg</span></a></span><span> </span><span id="local-6989586621682966917"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966917"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682966918"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682966918"><span class="hs-identifier hs-var">az</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1570"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682966919"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682966919"><span class="hs-identifier hs-var">t</span></a></span></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe TyCon
</span><a href="GHC.Core.Type.html#tyConAppTyCon_maybe"><span class="hs-identifier hs-var">tyConAppTyCon_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682966917"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1571"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682966921"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682966921"><span class="hs-identifier hs-var">hdr_sz</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe Int
</span><a href="#local-6989586621682966903"><span class="hs-identifier hs-var">arrayish_rep_hdr_size</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682966919"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1572"></span><span>            </span><span class="hs-comment">-- Do magic for Ptr/Byte arrays.  Push a ptr to the array on</span><span>
</span><span id="line-1573"></span><span>            </span><span class="hs-comment">-- the stack but then advance it over the headers, so as to</span><span>
</span><span id="line-1574"></span><span>            </span><span class="hs-comment">-- point to the payload.</span><span>
</span><span id="line-1575"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621682966922"><span class="annot"><a href="#local-6989586621682966922"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; [StgArg] -&gt; BcM [(OrdList BCInstr, PrimOrVoidRep)]
</span><a href="#local-6989586621682966914"><span class="hs-identifier hs-var">pargs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966915"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966902"><span class="hs-identifier hs-var">addr_size_b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682966918"><span class="hs-identifier hs-var">az</span></a></span><span>
</span><span id="line-1576"></span><span>                 </span><span class="hs-special">(</span><span id="local-6989586621682966923"><span class="annot"><a href="#local-6989586621682966923"><span class="hs-identifier hs-var">push_fo</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#pushAtom"><span class="hs-identifier hs-type">pushAtom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966915"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966894"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966916"><span class="hs-identifier hs-type">aa</span></a></span><span>
</span><span id="line-1577"></span><span>                 </span><span class="hs-comment">-- The ptr points at the header.  Advance it over the</span><span>
</span><span id="line-1578"></span><span>                 </span><span class="hs-comment">-- header and then pretend this is an Addr#.</span><span>
</span><span id="line-1579"></span><span>                 </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682966924"><span class="annot"><a href="#local-6989586621682966924"><span class="hs-identifier hs-var hs-var">code</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621682966923"><span class="hs-identifier hs-var">push_fo</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr -&gt; BCInstr -&gt; OrdList BCInstr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; Int -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#SWIZZLE"><span class="hs-identifier hs-var">SWIZZLE</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682966921"><span class="hs-identifier hs-var">hdr_sz</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1580"></span><span>                 </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682966924"><span class="hs-identifier hs-type">code</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#NVRep"><span class="hs-identifier hs-type">NVRep</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#AddrRep"><span class="hs-identifier hs-type">AddrRep</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621682966922"><span class="hs-identifier hs-type">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1581"></span><span>         </span><span class="annot"><a href="#local-6989586621682966914"><span class="hs-identifier hs-var">pargs</span></a></span><span> </span><span id="local-6989586621682966928"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966928"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682966929"><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621682966929"><span class="hs-identifier hs-var">aa</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682966930"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621682966930"><span class="hs-identifier hs-var">az</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682966931"><span class="annot"><a href="#local-6989586621682966931"><span class="hs-identifier hs-var">code_a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966932"><span class="annot"><a href="#local-6989586621682966932"><span class="hs-identifier hs-var">sz_a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; Map Id ByteOff -&gt; StgArg -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushAtom"><span class="hs-identifier hs-var">pushAtom</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966928"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682966894"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621682966929"><span class="hs-identifier hs-var">aa</span></a></span><span>
</span><span id="line-1582"></span><span>                               </span><span id="local-6989586621682966933"><span class="annot"><a href="#local-6989586621682966933"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682966914"><span class="hs-identifier hs-type">pargs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682966928"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><a href="#local-6989586621682966932"><span class="hs-identifier hs-type">sz_a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682966930"><span class="hs-identifier hs-type">az</span></a></span><span>
</span><span id="line-1583"></span><span>                               </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682966931"><span class="hs-identifier hs-type">code_a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#stgArgRep1"><span class="hs-identifier hs-type">stgArgRep1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966929"><span class="hs-identifier hs-type">aa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621682966933"><span class="hs-identifier hs-type">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1584"></span><span>
</span><span id="line-1585"></span><span>     </span><span id="local-6989586621682966934"><span class="annot"><a href="#local-6989586621682966934"><span class="hs-identifier hs-var">code_n_reps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682966914"><span class="hs-identifier hs-type">pargs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966892"><span class="hs-identifier hs-type">d0</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966900"><span class="hs-identifier hs-type">args_r_to_l</span></a></span><span>
</span><span id="line-1586"></span><span>     </span><span class="hs-keyword">let</span><span>
</span><span id="line-1587"></span><span>         </span><span class="hs-special">(</span><span id="local-6989586621682966935"><span class="annot"><a href="#local-6989586621682966935"><span class="hs-identifier hs-var">pushs_arg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966936"><span class="annot"><a href="#local-6989586621682966936"><span class="hs-identifier hs-var">a_reps_pushed_r_to_l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">unzip</span></span><span> </span><span class="annot"><a href="#local-6989586621682966934"><span class="hs-identifier hs-type">code_n_reps</span></a></span><span>
</span><span id="line-1588"></span><span>         </span><span id="local-6989586621682966937"><span class="annot"><a href="#local-6989586621682966937"><span class="hs-identifier hs-var hs-var">a_reps_sizeW</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[WordOff] -&gt; WordOff
forall a. Num a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">sum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PrimOrVoidRep -&gt; WordOff) -&gt; [PrimOrVoidRep] -&gt; [WordOff]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; PrimOrVoidRep -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#repSizeWords"><span class="hs-identifier hs-var">repSizeWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966901"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PrimOrVoidRep]
</span><a href="#local-6989586621682966936"><span class="hs-identifier hs-var">a_reps_pushed_r_to_l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1589"></span><span>
</span><span id="line-1590"></span><span>         </span><span id="local-6989586621682966939"><span class="annot"><a href="#local-6989586621682966939"><span class="hs-identifier hs-var hs-var">push_args</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[OrdList BCInstr] -&gt; OrdList BCInstr
forall a. [OrdList a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#concatOL"><span class="hs-identifier hs-var">concatOL</span></a></span><span> </span><span class="annot"><span class="annottext">[OrdList BCInstr]
</span><a href="#local-6989586621682966935"><span class="hs-identifier hs-var">pushs_arg</span></a></span><span>
</span><span id="line-1591"></span><span>         </span><span class="hs-glyph">!</span><span id="local-6989586621682966940"><span class="annot"><a href="#local-6989586621682966940"><span class="hs-identifier hs-var hs-var">d_after_args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966892"><span class="hs-identifier hs-var">d0</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; WordOff -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordsToBytes"><span class="hs-identifier hs-var">wordsToBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966901"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966937"><span class="hs-identifier hs-var">a_reps_sizeW</span></a></span><span>
</span><span id="line-1592"></span><span>         </span><span id="local-6989586621682966941"><span class="annot"><a href="#local-6989586621682966941"><span class="hs-identifier hs-var hs-var">a_reps_pushed_RAW</span></a></span></span><span>
</span><span id="line-1593"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PrimOrVoidRep
</span><a href="GHC.Core.TyCon.html#VoidRep"><span class="hs-identifier hs-var">VoidRep</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682966942"><span class="annot"><span class="annottext">[PrimOrVoidRep]
</span><a href="#local-6989586621682966942"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[PrimOrVoidRep]
</span><a href="#local-6989586621682966936"><span class="hs-identifier hs-var">a_reps_pushed_r_to_l</span></a></span><span>
</span><span id="line-1594"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PrimOrVoidRep] -&gt; [PrimOrVoidRep]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[PrimOrVoidRep]
</span><a href="#local-6989586621682966942"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-1595"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1596"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [PrimOrVoidRep]
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.StgToByteCode.generateCCall: missing or invalid World token?&quot;</span></span><span>
</span><span id="line-1597"></span><span>
</span><span id="line-1598"></span><span>         </span><span class="hs-comment">-- Now: a_reps_pushed_RAW are the reps which are actually on the stack.</span><span>
</span><span id="line-1599"></span><span>         </span><span class="hs-comment">-- push_args is the code to do that.</span><span>
</span><span id="line-1600"></span><span>         </span><span class="hs-comment">-- d_after_args is the stack depth once the args are on.</span><span>
</span><span id="line-1601"></span><span>
</span><span id="line-1602"></span><span>         </span><span class="hs-comment">-- Get the result rep.</span><span>
</span><span id="line-1603"></span><span>         </span><span id="local-6989586621682966943"><span class="annot"><a href="#local-6989586621682966943"><span class="hs-identifier hs-var hs-var">r_rep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; PrimOrVoidRep
</span><a href="GHC.StgToByteCode.html#maybe_getCCallReturnRep"><span class="hs-identifier hs-var">maybe_getCCallReturnRep</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682966897"><span class="hs-identifier hs-var">result_ty</span></a></span><span>
</span><span id="line-1604"></span><span>         </span><span class="hs-comment">{-
         Because the Haskell stack grows down, the a_reps refer to
         lowest to highest addresses in that order.  The args for the call
         are on the stack.  Now push an unboxed Addr# indicating
         the C function to call.  Then push a dummy placeholder for the
         result.  Finally, emit a CCALL insn with an offset pointing to the
         Addr# just pushed, and a literal field holding the mallocville
         address of the piece of marshalling code we generate.
         So, just prior to the CCALL insn, the stack looks like this
         (growing down, as usual):

            &lt;arg_n&gt;
            ...
            &lt;arg_1&gt;
            Addr# address_of_C_fn
            &lt;placeholder-for-result#&gt; (must be an unboxed type)

         The interpreter then calls the marshal code mentioned
         in the CCALL insn, passing it (&amp; &lt;placeholder-for-result#&gt;),
         that is, the addr of the topmost word in the stack.
         When this returns, the placeholder will have been
         filled in.  The placeholder is slid down to the sequel
         depth, and we RETURN.

         This arrangement makes it simple to do f-i-dynamic since the Addr#
         value is the first arg anyway.

         The marshalling code is generated specifically for this
         call site, and so knows exactly the (Haskell) stack
         offsets of the args, fn address and placeholder.  It
         copies the args to the C stack, calls the stacked addr,
         and parks the result back in the placeholder.  The interpreter
         calls it as a normal C call, assuming it has a signature
            void marshal_code ( StgWord* ptr_to_top_of_stack )
         -}</span><span>
</span><span id="line-1639"></span><span>         </span><span class="hs-comment">-- resolve static address</span><span>
</span><span id="line-1640"></span><span>         </span><span class="annot"><a href="#local-6989586621682966945"><span class="hs-identifier hs-type">maybe_static_target</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a></span><span>
</span><span id="line-1641"></span><span>         </span><span id="local-6989586621682966945"><span class="annot"><a href="#local-6989586621682966945"><span class="hs-identifier hs-var hs-var">maybe_static_target</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1642"></span><span>             </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CCallTarget
</span><a href="#local-6989586621682966895"><span class="hs-identifier hs-var">target</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1643"></span><span>                 </span><span class="annot"><span class="annottext">CCallTarget
</span><a href="GHC.Types.ForeignCall.html#DynamicTarget"><span class="hs-identifier hs-var">DynamicTarget</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Literal
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1644"></span><span>                 </span><span class="annot"><a href="GHC.Types.ForeignCall.html#StaticTarget"><span class="hs-identifier hs-type">StaticTarget</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe (GenUnit UnitId)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1645"></span><span>                   </span><span class="annot"><span class="annottext">String -&gt; Maybe Literal
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;generateCCall: unexpected FFI value import&quot;</span></span><span>
</span><span id="line-1646"></span><span>                 </span><span class="annot"><a href="GHC.Types.ForeignCall.html#StaticTarget"><span class="hs-identifier hs-type">StaticTarget</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682966947"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682966947"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (GenUnit UnitId)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1647"></span><span>                   </span><span class="annot"><span class="annottext">Literal -&gt; Maybe Literal
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; FunctionOrData -&gt; Literal
</span><a href="GHC.Types.Literal.html#LitLabel"><span class="hs-identifier hs-var">LitLabel</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682966947"><span class="hs-identifier hs-var">target</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionOrData
</span><a href="GHC.Types.Basic.html#IsFunction"><span class="hs-identifier hs-var">IsFunction</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1648"></span><span>
</span><span id="line-1649"></span><span>     </span><span class="hs-keyword">let</span><span>
</span><span id="line-1650"></span><span>         </span><span id="local-6989586621682966948"><span class="annot"><a href="#local-6989586621682966948"><span class="hs-identifier hs-var hs-var">is_static</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Literal -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe Literal
</span><a href="#local-6989586621682966945"><span class="hs-identifier hs-var">maybe_static_target</span></a></span><span>
</span><span id="line-1651"></span><span>
</span><span id="line-1652"></span><span>         </span><span class="hs-comment">-- Get the arg reps, zapping the leading Addr# in the dynamic case</span><span>
</span><span id="line-1653"></span><span>         </span><span id="local-6989586621682966950"><span class="annot"><a href="#local-6989586621682966950"><span class="hs-identifier hs-var hs-var">a_reps</span></a></span></span><span> </span><span class="hs-comment">--  | trace (showSDoc (ppr a_reps_pushed_RAW)) False = error &quot;???&quot;</span><span>
</span><span id="line-1654"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682966948"><span class="hs-identifier hs-var">is_static</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PrimOrVoidRep]
</span><a href="#local-6989586621682966941"><span class="hs-identifier hs-var">a_reps_pushed_RAW</span></a></span><span>
</span><span id="line-1655"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PrimOrVoidRep
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682966951"><span class="annot"><span class="annottext">[PrimOrVoidRep]
</span><a href="#local-6989586621682966951"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[PrimOrVoidRep]
</span><a href="#local-6989586621682966941"><span class="hs-identifier hs-var">a_reps_pushed_RAW</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PrimOrVoidRep]
</span><a href="#local-6989586621682966951"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-1656"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [PrimOrVoidRep]
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.StgToByteCode.generateCCall: dyn with no args&quot;</span></span><span>
</span><span id="line-1657"></span><span>
</span><span id="line-1658"></span><span>         </span><span class="hs-comment">-- push the Addr#</span><span>
</span><span id="line-1659"></span><span>         </span><span class="hs-special">(</span><span id="local-6989586621682966952"><span class="annot"><a href="#local-6989586621682966952"><span class="hs-identifier hs-var">push_Addr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966953"><span class="annot"><a href="#local-6989586621682966953"><span class="hs-identifier hs-var">d_after_Addr</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1660"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682966954"><span class="annot"><a href="#local-6989586621682966954"><span class="hs-identifier hs-var">machlabel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682966945"><span class="hs-identifier hs-type">maybe_static_target</span></a></span><span>
</span><span id="line-1661"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-type">toOL</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.ByteCode.Instr.html#PUSH_UBX"><span class="hs-identifier hs-type">PUSH_UBX</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966954"><span class="hs-identifier hs-type">machlabel</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682966940"><span class="hs-identifier hs-type">d_after_args</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><a href="#local-6989586621682966902"><span class="hs-identifier hs-type">addr_size_b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1662"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">otherwise</span></span><span> </span><span class="hs-comment">-- is already on the stack</span><span>
</span><span id="line-1663"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-type">nilOL</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682966940"><span class="hs-identifier hs-type">d_after_args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1664"></span><span>
</span><span id="line-1665"></span><span>         </span><span class="hs-comment">-- Push the return placeholder.  For a call returning nothing,</span><span>
</span><span id="line-1666"></span><span>         </span><span class="hs-comment">-- this is a V (tag).</span><span>
</span><span id="line-1667"></span><span>         </span><span id="local-6989586621682966955"><span class="annot"><a href="#local-6989586621682966955"><span class="hs-identifier hs-var hs-var">r_sizeW</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; PrimOrVoidRep -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#repSizeWords"><span class="hs-identifier hs-var">repSizeWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966901"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">PrimOrVoidRep
</span><a href="#local-6989586621682966943"><span class="hs-identifier hs-var">r_rep</span></a></span><span>
</span><span id="line-1668"></span><span>         </span><span id="local-6989586621682966956"><span class="annot"><a href="#local-6989586621682966956"><span class="hs-identifier hs-var hs-var">d_after_r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966953"><span class="hs-identifier hs-var">d_after_Addr</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; WordOff -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordsToBytes"><span class="hs-identifier hs-var">wordsToBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966901"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966955"><span class="hs-identifier hs-var">r_sizeW</span></a></span><span>
</span><span id="line-1669"></span><span>         </span><span id="local-6989586621682966957"><span class="annot"><a href="#local-6989586621682966957"><span class="hs-identifier hs-var hs-var">push_r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PrimOrVoidRep
</span><a href="#local-6989586621682966943"><span class="hs-identifier hs-var">r_rep</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1670"></span><span>                    </span><span class="annot"><span class="annottext">PrimOrVoidRep
</span><a href="GHC.Core.TyCon.html#VoidRep"><span class="hs-identifier hs-var">VoidRep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
forall a. OrdList a
</span><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-var">nilOL</span></a></span><span>
</span><span id="line-1671"></span><span>                    </span><span class="annot"><a href="GHC.Core.TyCon.html#NVRep"><span class="hs-identifier hs-type">NVRep</span></a></span><span> </span><span id="local-6989586621682966958"><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621682966958"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BCInstr -&gt; OrdList BCInstr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Literal -&gt; WordOff -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_UBX"><span class="hs-identifier hs-var">PUSH_UBX</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; PrimRep -&gt; Literal
</span><a href="GHC.StgToByteCode.html#mkDummyLiteral"><span class="hs-identifier hs-var">mkDummyLiteral</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966901"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621682966958"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966955"><span class="hs-identifier hs-var">r_sizeW</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1672"></span><span>
</span><span id="line-1673"></span><span>         </span><span class="hs-comment">-- generate the marshalling code we're going to call</span><span>
</span><span id="line-1674"></span><span>
</span><span id="line-1675"></span><span>         </span><span class="hs-comment">-- Offset of the next stack frame down the stack.  The CCALL</span><span>
</span><span id="line-1676"></span><span>         </span><span class="hs-comment">-- instruction needs to describe the chunk of stack containing</span><span>
</span><span id="line-1677"></span><span>         </span><span class="hs-comment">-- the ccall args to the GC, so it needs to know how large it</span><span>
</span><span id="line-1678"></span><span>         </span><span class="hs-comment">-- is.  See comment in Interpreter.c with the CCALL instruction.</span><span>
</span><span id="line-1679"></span><span>         </span><span id="local-6989586621682966960"><span class="annot"><a href="#local-6989586621682966960"><span class="hs-identifier hs-var hs-var">stk_offset</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#bytesToWords"><span class="hs-identifier hs-var">bytesToWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966901"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966956"><span class="hs-identifier hs-var">d_after_r</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966893"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1680"></span><span>
</span><span id="line-1681"></span><span>     </span><span class="hs-comment">-- the only difference in libffi mode is that we prepare a cif</span><span>
</span><span id="line-1682"></span><span>     </span><span class="hs-comment">-- describing the call type by calling libffi, and we attach the</span><span>
</span><span id="line-1683"></span><span>     </span><span class="hs-comment">-- address of this to the CCALL instruction.</span><span>
</span><span id="line-1684"></span><span>
</span><span id="line-1685"></span><span>
</span><span id="line-1686"></span><span>     </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682966961"><span class="annot"><a href="#local-6989586621682966961"><span class="hs-identifier hs-var hs-var">ffires</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; PrimOrVoidRep -&gt; FFIType
</span><a href="GHC.StgToByteCode.html#primRepToFFIType"><span class="hs-identifier hs-var">primRepToFFIType</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966901"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">PrimOrVoidRep
</span><a href="#local-6989586621682966943"><span class="hs-identifier hs-var">r_rep</span></a></span><span>
</span><span id="line-1687"></span><span>         </span><span id="local-6989586621682966963"><span class="annot"><a href="#local-6989586621682966963"><span class="hs-identifier hs-var hs-var">ffiargs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PrimOrVoidRep -&gt; FFIType) -&gt; [PrimOrVoidRep] -&gt; [FFIType]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; PrimOrVoidRep -&gt; FFIType
</span><a href="GHC.StgToByteCode.html#primRepToFFIType"><span class="hs-identifier hs-var">primRepToFFIType</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966901"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PrimOrVoidRep]
</span><a href="#local-6989586621682966950"><span class="hs-identifier hs-var">a_reps</span></a></span><span>
</span><span id="line-1688"></span><span>     </span><span id="local-6989586621682966964"><span class="annot"><a href="#local-6989586621682966964"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#hscInterp"><span class="hs-identifier hs-type">hscInterp</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#getHscEnv"><span class="hs-identifier hs-type">getHscEnv</span></a></span><span>
</span><span id="line-1689"></span><span>     </span><span id="local-6989586621682966965"><span class="annot"><a href="#local-6989586621682966965"><span class="hs-identifier hs-var">token</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#ioToBc"><span class="hs-identifier hs-type">ioToBc</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#interpCmd"><span class="hs-identifier hs-type">interpCmd</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966964"><span class="hs-identifier hs-type">interp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.Message.html#PrepFFI"><span class="hs-identifier hs-type">PrepFFI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966963"><span class="hs-identifier hs-type">ffiargs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966961"><span class="hs-identifier hs-type">ffires</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1690"></span><span>     </span><span class="annot"><a href="GHC.StgToByteCode.html#recordFFIBc"><span class="hs-identifier hs-type">recordFFIBc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966965"><span class="hs-identifier hs-type">token</span></a></span><span>
</span><span id="line-1691"></span><span>
</span><span id="line-1692"></span><span>     </span><span class="hs-keyword">let</span><span>
</span><span id="line-1693"></span><span>         </span><span class="hs-comment">-- do the call</span><span>
</span><span id="line-1694"></span><span>         </span><span id="local-6989586621682966969"><span class="annot"><a href="#local-6989586621682966969"><span class="hs-identifier hs-var hs-var">do_call</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BCInstr -&gt; OrdList BCInstr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WordOff -&gt; RemotePtr C_ffi_cif -&gt; Word16 -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#CCALL"><span class="hs-identifier hs-var">CCALL</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966960"><span class="hs-identifier hs-var">stk_offset</span></a></span><span> </span><span class="annot"><span class="annottext">RemotePtr C_ffi_cif
</span><a href="#local-6989586621682966965"><span class="hs-identifier hs-var">token</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621682966971"><span class="hs-identifier hs-var">flags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1695"></span><span>           </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682966971"><span class="annot"><span class="annottext">flags :: Word16
</span><a href="#local-6989586621682966971"><span class="hs-identifier hs-var hs-var">flags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Safety
</span><a href="#local-6989586621682966896"><span class="hs-identifier hs-var">safety</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1696"></span><span>                           </span><span class="annot"><span class="annottext">Safety
</span><a href="GHC.Types.ForeignCall.html#PlaySafe"><span class="hs-identifier hs-var">PlaySafe</span></a></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">0x0</span></span><span>
</span><span id="line-1697"></span><span>                           </span><span class="annot"><span class="annottext">Safety
</span><a href="GHC.Types.ForeignCall.html#PlayInterruptible"><span class="hs-identifier hs-var">PlayInterruptible</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">0x1</span></span><span>
</span><span id="line-1698"></span><span>                           </span><span class="annot"><span class="annottext">Safety
</span><a href="GHC.Types.ForeignCall.html#PlayRisky"><span class="hs-identifier hs-var">PlayRisky</span></a></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">0x2</span></span><span>
</span><span id="line-1699"></span><span>
</span><span id="line-1700"></span><span>         </span><span class="hs-comment">-- slide and return</span><span>
</span><span id="line-1701"></span><span>         </span><span id="local-6989586621682966975"><span class="annot"><a href="#local-6989586621682966975"><span class="hs-identifier hs-var hs-var">d_after_r_min_s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#bytesToWords"><span class="hs-identifier hs-var">bytesToWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966901"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966956"><span class="hs-identifier hs-var">d_after_r</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682966893"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1702"></span><span>         </span><span id="local-6989586621682966976"><span class="annot"><a href="#local-6989586621682966976"><span class="hs-identifier hs-var hs-var">wrapup</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; WordOff -&gt; OrdList BCInstr
</span><a href="GHC.StgToByteCode.html#mkSlideW"><span class="hs-identifier hs-var">mkSlideW</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966955"><span class="hs-identifier hs-var">r_sizeW</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966975"><span class="hs-identifier hs-var">d_after_r_min_s</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; WordOff -&gt; WordOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682966955"><span class="hs-identifier hs-var">r_sizeW</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1703"></span><span>                        </span><span class="annot"><span class="annottext">OrdList BCInstr -&gt; BCInstr -&gt; OrdList BCInstr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span> </span><span class="annot"><span class="annottext">ArgRep -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#RETURN"><span class="hs-identifier hs-var">RETURN</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; PrimOrVoidRep -&gt; ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#toArgRepOrV"><span class="hs-identifier hs-var">toArgRepOrV</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966901"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">PrimOrVoidRep
</span><a href="#local-6989586621682966943"><span class="hs-identifier hs-var">r_rep</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1704"></span><span>         </span><span class="hs-comment">--trace (show (arg1_offW, args_offW  ,  (map argRepSizeW a_reps) )) $</span><span>
</span><span id="line-1705"></span><span>     </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-1706"></span><span>         </span><span class="annot"><a href="#local-6989586621682966939"><span class="hs-identifier hs-type">push_args</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span>
</span><span id="line-1707"></span><span>         </span><span class="annot"><a href="#local-6989586621682966952"><span class="hs-identifier hs-type">push_Addr</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966957"><span class="hs-identifier hs-type">push_r</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966969"><span class="hs-identifier hs-type">do_call</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682966976"><span class="hs-identifier hs-type">wrapup</span></a></span><span>
</span><span id="line-1708"></span><span>         </span><span class="hs-special">)</span><span>
</span><span id="line-1709"></span><span>
</span><span id="line-1710"></span><span class="annot"><a href="GHC.StgToByteCode.html#primRepToFFIType"><span class="hs-identifier hs-type">primRepToFFIType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#PrimOrVoidRep"><span class="hs-identifier hs-type">PrimOrVoidRep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.FFI.html#FFIType"><span class="hs-identifier hs-type">FFIType</span></a></span><span>
</span><span id="line-1711"></span><span id="primRepToFFIType"><span class="annot"><span class="annottext">primRepToFFIType :: Platform -&gt; PrimOrVoidRep -&gt; FFIType
</span><a href="GHC.StgToByteCode.html#primRepToFFIType"><span class="hs-identifier hs-var hs-var">primRepToFFIType</span></a></span></span><span> </span><span class="annot"><span class="annottext">Platform
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PrimOrVoidRep
</span><a href="GHC.Core.TyCon.html#VoidRep"><span class="hs-identifier hs-var">VoidRep</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FFIType
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.FFI.html#FFIVoid"><span class="hs-identifier hs-var">FFIVoid</span></a></span><span>
</span><span id="line-1712"></span><span class="annot"><a href="GHC.StgToByteCode.html#primRepToFFIType"><span class="hs-identifier hs-var">primRepToFFIType</span></a></span><span> </span><span id="local-6989586621682966979"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966979"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#NVRep"><span class="hs-identifier hs-type">NVRep</span></a></span><span> </span><span id="local-6989586621682966980"><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621682966980"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1713"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621682966980"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1714"></span><span>     </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#IntRep"><span class="hs-identifier hs-var">IntRep</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FFIType
</span><a href="#local-6989586621682966982"><span class="hs-identifier hs-var">signed_word</span></a></span><span>
</span><span id="line-1715"></span><span>     </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#WordRep"><span class="hs-identifier hs-var">WordRep</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FFIType
</span><a href="#local-6989586621682966984"><span class="hs-identifier hs-var">unsigned_word</span></a></span><span>
</span><span id="line-1716"></span><span>     </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Int8Rep"><span class="hs-identifier hs-var">Int8Rep</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FFIType
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.FFI.html#FFISInt8"><span class="hs-identifier hs-var">FFISInt8</span></a></span><span>
</span><span id="line-1717"></span><span>     </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Word8Rep"><span class="hs-identifier hs-var">Word8Rep</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FFIType
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.FFI.html#FFIUInt8"><span class="hs-identifier hs-var">FFIUInt8</span></a></span><span>
</span><span id="line-1718"></span><span>     </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Int16Rep"><span class="hs-identifier hs-var">Int16Rep</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FFIType
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.FFI.html#FFISInt16"><span class="hs-identifier hs-var">FFISInt16</span></a></span><span>
</span><span id="line-1719"></span><span>     </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Word16Rep"><span class="hs-identifier hs-var">Word16Rep</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FFIType
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.FFI.html#FFIUInt16"><span class="hs-identifier hs-var">FFIUInt16</span></a></span><span>
</span><span id="line-1720"></span><span>     </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Int32Rep"><span class="hs-identifier hs-var">Int32Rep</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FFIType
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.FFI.html#FFISInt32"><span class="hs-identifier hs-var">FFISInt32</span></a></span><span>
</span><span id="line-1721"></span><span>     </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Word32Rep"><span class="hs-identifier hs-var">Word32Rep</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FFIType
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.FFI.html#FFIUInt32"><span class="hs-identifier hs-var">FFIUInt32</span></a></span><span>
</span><span id="line-1722"></span><span>     </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Int64Rep"><span class="hs-identifier hs-var">Int64Rep</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FFIType
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.FFI.html#FFISInt64"><span class="hs-identifier hs-var">FFISInt64</span></a></span><span>
</span><span id="line-1723"></span><span>     </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Word64Rep"><span class="hs-identifier hs-var">Word64Rep</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FFIType
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.FFI.html#FFIUInt64"><span class="hs-identifier hs-var">FFIUInt64</span></a></span><span>
</span><span id="line-1724"></span><span>     </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#AddrRep"><span class="hs-identifier hs-var">AddrRep</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FFIType
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.FFI.html#FFIPointer"><span class="hs-identifier hs-var">FFIPointer</span></a></span><span>
</span><span id="line-1725"></span><span>     </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#FloatRep"><span class="hs-identifier hs-var">FloatRep</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FFIType
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.FFI.html#FFIFloat"><span class="hs-identifier hs-var">FFIFloat</span></a></span><span>
</span><span id="line-1726"></span><span>     </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#DoubleRep"><span class="hs-identifier hs-var">DoubleRep</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FFIType
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.FFI.html#FFIDouble"><span class="hs-identifier hs-var">FFIDouble</span></a></span><span>
</span><span id="line-1727"></span><span>     </span><span class="annot"><a href="GHC.Core.TyCon.html#BoxedRep"><span class="hs-identifier hs-type">BoxedRep</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Levity
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FFIType
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.FFI.html#FFIPointer"><span class="hs-identifier hs-var">FFIPointer</span></a></span><span>
</span><span id="line-1728"></span><span>     </span><span class="annot"><a href="GHC.Core.TyCon.html#VecRep"><span class="hs-identifier hs-type">VecRep</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; FFIType
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;primRepToFFIType&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimRep -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621682966980"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1729"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1730"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682966982"><span class="annot"><span class="annottext">FFIType
</span><a href="#local-6989586621682966982"><span class="hs-identifier hs-var">signed_word</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682966984"><span class="annot"><span class="annottext">FFIType
</span><a href="#local-6989586621682966984"><span class="hs-identifier hs-var">unsigned_word</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; PlatformWordSize
</span><a href="GHC.Platform.html#platformWordSize"><span class="hs-identifier hs-var">platformWordSize</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682966979"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1731"></span><span>       </span><span class="annot"><span class="annottext">PlatformWordSize
</span><a href="GHC.Platform.html#PW4"><span class="hs-identifier hs-var">PW4</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FFIType
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.FFI.html#FFISInt32"><span class="hs-identifier hs-var">FFISInt32</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FFIType
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.FFI.html#FFIUInt32"><span class="hs-identifier hs-var">FFIUInt32</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1732"></span><span>       </span><span class="annot"><span class="annottext">PlatformWordSize
</span><a href="GHC.Platform.html#PW8"><span class="hs-identifier hs-var">PW8</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FFIType
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.FFI.html#FFISInt64"><span class="hs-identifier hs-var">FFISInt64</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FFIType
</span><a href="../../ghci-9.12.2-bd10/src/GHCi.FFI.html#FFIUInt64"><span class="hs-identifier hs-var">FFIUInt64</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1733"></span><span>
</span><span id="line-1734"></span><span class="hs-comment">-- Make a dummy literal, to be used as a placeholder for FFI return</span><span>
</span><span id="line-1735"></span><span class="hs-comment">-- values on the stack.</span><span>
</span><span id="line-1736"></span><span class="annot"><a href="GHC.StgToByteCode.html#mkDummyLiteral"><span class="hs-identifier hs-type">mkDummyLiteral</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#PrimRep"><span class="hs-identifier hs-type">PrimRep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a></span><span>
</span><span id="line-1737"></span><span id="mkDummyLiteral"><span class="annot"><span class="annottext">mkDummyLiteral :: Platform -&gt; PrimRep -&gt; Literal
</span><a href="GHC.StgToByteCode.html#mkDummyLiteral"><span class="hs-identifier hs-var hs-var">mkDummyLiteral</span></a></span></span><span> </span><span id="local-6989586621682967011"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682967011"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621682967012"><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621682967012"><span class="hs-identifier hs-var">pr</span></a></span></span><span>
</span><span id="line-1738"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621682967012"><span class="hs-identifier hs-var">pr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1739"></span><span>        </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#IntRep"><span class="hs-identifier hs-var">IntRep</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Integer -&gt; Literal
</span><a href="GHC.Types.Literal.html#mkLitInt"><span class="hs-identifier hs-var">mkLitInt</span></a></span><span>  </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682967011"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1740"></span><span>        </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#WordRep"><span class="hs-identifier hs-var">WordRep</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Integer -&gt; Literal
</span><a href="GHC.Types.Literal.html#mkLitWord"><span class="hs-identifier hs-var">mkLitWord</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682967011"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1741"></span><span>        </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Int8Rep"><span class="hs-identifier hs-var">Int8Rep</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Literal
</span><a href="GHC.Types.Literal.html#mkLitInt8"><span class="hs-identifier hs-var">mkLitInt8</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1742"></span><span>        </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Word8Rep"><span class="hs-identifier hs-var">Word8Rep</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Literal
</span><a href="GHC.Types.Literal.html#mkLitWord8"><span class="hs-identifier hs-var">mkLitWord8</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1743"></span><span>        </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Int16Rep"><span class="hs-identifier hs-var">Int16Rep</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Literal
</span><a href="GHC.Types.Literal.html#mkLitInt16"><span class="hs-identifier hs-var">mkLitInt16</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1744"></span><span>        </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Word16Rep"><span class="hs-identifier hs-var">Word16Rep</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Literal
</span><a href="GHC.Types.Literal.html#mkLitWord16"><span class="hs-identifier hs-var">mkLitWord16</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1745"></span><span>        </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Int32Rep"><span class="hs-identifier hs-var">Int32Rep</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Literal
</span><a href="GHC.Types.Literal.html#mkLitInt32"><span class="hs-identifier hs-var">mkLitInt32</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1746"></span><span>        </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Word32Rep"><span class="hs-identifier hs-var">Word32Rep</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Literal
</span><a href="GHC.Types.Literal.html#mkLitWord32"><span class="hs-identifier hs-var">mkLitWord32</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1747"></span><span>        </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Int64Rep"><span class="hs-identifier hs-var">Int64Rep</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Literal
</span><a href="GHC.Types.Literal.html#mkLitInt64"><span class="hs-identifier hs-var">mkLitInt64</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1748"></span><span>        </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Word64Rep"><span class="hs-identifier hs-var">Word64Rep</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Literal
</span><a href="GHC.Types.Literal.html#mkLitWord64"><span class="hs-identifier hs-var">mkLitWord64</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1749"></span><span>        </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#AddrRep"><span class="hs-identifier hs-var">AddrRep</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="GHC.Types.Literal.html#LitNullAddr"><span class="hs-identifier hs-var">LitNullAddr</span></a></span><span>
</span><span id="line-1750"></span><span>        </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#DoubleRep"><span class="hs-identifier hs-var">DoubleRep</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Literal
</span><a href="GHC.Types.Literal.html#LitDouble"><span class="hs-identifier hs-var">LitDouble</span></a></span><span> </span><span class="annot"><span class="annottext">Rational
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1751"></span><span>        </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#FloatRep"><span class="hs-identifier hs-var">FloatRep</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Literal
</span><a href="GHC.Types.Literal.html#LitFloat"><span class="hs-identifier hs-var">LitFloat</span></a></span><span> </span><span class="annot"><span class="annottext">Rational
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1752"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCon.html#BoxedRep"><span class="hs-identifier hs-type">BoxedRep</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Levity
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="GHC.Types.Literal.html#LitNullAddr"><span class="hs-identifier hs-var">LitNullAddr</span></a></span><span>
</span><span id="line-1753"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCon.html#VecRep"><span class="hs-identifier hs-type">VecRep</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; Literal
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mkDummyLiteral&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimRep -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621682967012"><span class="hs-identifier hs-var">pr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1754"></span><span>
</span><span id="line-1755"></span><span>
</span><span id="line-1756"></span><span class="hs-comment">-- Convert (eg)</span><span>
</span><span id="line-1757"></span><span class="hs-comment">--     GHC.Prim.Char# -&gt; GHC.Prim.State# GHC.Prim.RealWorld</span><span>
</span><span id="line-1758"></span><span class="hs-comment">--                   -&gt; (# GHC.Prim.State# GHC.Prim.RealWorld, GHC.Prim.Int# #)</span><span>
</span><span id="line-1759"></span><span class="hs-comment">--</span><span>
</span><span id="line-1760"></span><span class="hs-comment">-- to  NVRep IntRep</span><span>
</span><span id="line-1761"></span><span class="hs-comment">-- and check that an unboxed pair is returned wherein the first arg is V'd.</span><span>
</span><span id="line-1762"></span><span class="hs-comment">--</span><span>
</span><span id="line-1763"></span><span class="hs-comment">-- Alternatively, for call-targets returning nothing, convert</span><span>
</span><span id="line-1764"></span><span class="hs-comment">--</span><span>
</span><span id="line-1765"></span><span class="hs-comment">--     GHC.Prim.Char# -&gt; GHC.Prim.State# GHC.Prim.RealWorld</span><span>
</span><span id="line-1766"></span><span class="hs-comment">--                   -&gt; (# GHC.Prim.State# GHC.Prim.RealWorld #)</span><span>
</span><span id="line-1767"></span><span class="hs-comment">--</span><span>
</span><span id="line-1768"></span><span class="hs-comment">-- to  VoidRep</span><span>
</span><span id="line-1769"></span><span>
</span><span id="line-1770"></span><span class="annot"><a href="GHC.StgToByteCode.html#maybe_getCCallReturnRep"><span class="hs-identifier hs-type">maybe_getCCallReturnRep</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#PrimOrVoidRep"><span class="hs-identifier hs-type">PrimOrVoidRep</span></a></span><span>
</span><span id="line-1771"></span><span id="maybe_getCCallReturnRep"><span class="annot"><span class="annottext">maybe_getCCallReturnRep :: Type -&gt; PrimOrVoidRep
</span><a href="GHC.StgToByteCode.html#maybe_getCCallReturnRep"><span class="hs-identifier hs-var hs-var">maybe_getCCallReturnRep</span></a></span></span><span> </span><span id="local-6989586621682967023"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682967023"><span class="hs-identifier hs-var">fn_ty</span></a></span></span><span>
</span><span id="line-1772"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-1773"></span><span>       </span><span class="hs-special">(</span><span id="local-6989586621682967024"><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682967024"><span class="hs-identifier hs-var">_a_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682967025"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682967025"><span class="hs-identifier hs-var">r_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([Scaled Type], Type)
</span><a href="GHC.Core.Type.html#splitFunTys"><span class="hs-identifier hs-var">splitFunTys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="GHC.Core.Type.html#dropForAlls"><span class="hs-identifier hs-var">dropForAlls</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682967023"><span class="hs-identifier hs-var">fn_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1774"></span><span>     </span><span class="hs-keyword">in</span><span>
</span><span id="line-1775"></span><span>       </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; [PrimRep]
Type -&gt; [PrimRep]
</span><a href="GHC.Types.RepType.html#typePrimRep"><span class="hs-identifier hs-var">typePrimRep</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682967025"><span class="hs-identifier hs-var">r_ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1776"></span><span>         </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimOrVoidRep
</span><a href="GHC.Core.TyCon.html#VoidRep"><span class="hs-identifier hs-var">VoidRep</span></a></span><span>
</span><span id="line-1777"></span><span>         </span><span class="hs-special">[</span><span id="local-6989586621682967028"><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621682967028"><span class="hs-identifier hs-var">rep</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; PrimOrVoidRep
</span><a href="GHC.Core.TyCon.html#NVRep"><span class="hs-identifier hs-var">NVRep</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621682967028"><span class="hs-identifier hs-var">rep</span></a></span><span>
</span><span id="line-1778"></span><span>
</span><span id="line-1779"></span><span>                 </span><span class="hs-comment">-- if it was, it would be impossible to create a</span><span>
</span><span id="line-1780"></span><span>                 </span><span class="hs-comment">-- valid return value placeholder on the stack</span><span>
</span><span id="line-1781"></span><span>         </span><span class="annot"><span class="annottext">[PrimRep]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; PrimOrVoidRep
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;maybe_getCCallReturn: can't handle:&quot;</span></span><span>
</span><span id="line-1782"></span><span>                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
</span><a href="GHC.Core.TyCo.Ppr.html#pprType"><span class="hs-identifier hs-var">pprType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682967023"><span class="hs-identifier hs-var">fn_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1783"></span><span>
</span><span id="line-1784"></span><span class="annot"><a href="GHC.StgToByteCode.html#maybe_is_tagToEnum_call"><span class="hs-identifier hs-type">maybe_is_tagToEnum_call</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgExpr"><span class="hs-identifier hs-type">CgStgExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1785"></span><span class="hs-comment">-- Detect and extract relevant info for the tagToEnum kludge.</span><span>
</span><span id="line-1786"></span><span id="maybe_is_tagToEnum_call"><span class="annot"><span class="annottext">maybe_is_tagToEnum_call :: CgStgExpr -&gt; Maybe (Id, [Name])
</span><a href="GHC.StgToByteCode.html#maybe_is_tagToEnum_call"><span class="hs-identifier hs-var hs-var">maybe_is_tagToEnum_call</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgOpApp"><span class="hs-identifier hs-type">StgOpApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgPrimOp"><span class="hs-identifier hs-type">StgPrimOp</span></a></span><span> </span><span class="annot"><span class="annottext">PrimOp
</span><a href="GHC.Builtin.PrimOps.html#TagToEnumOp"><span class="hs-identifier hs-var">TagToEnumOp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgVarArg"><span class="hs-identifier hs-type">StgVarArg</span></a></span><span> </span><span id="local-6989586621682967030"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682967030"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">]</span><span> </span><span id="local-6989586621682967031"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682967031"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1787"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Id, [Name]) -&gt; Maybe (Id, [Name])
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682967030"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Name]
</span><a href="#local-6989586621682967032"><span class="hs-identifier hs-var">extract_constr_Names</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682967031"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1788"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1789"></span><span>    </span><span id="local-6989586621682967032"><span class="annot"><span class="annottext">extract_constr_Names :: Type -&gt; [Name]
</span><a href="#local-6989586621682967032"><span class="hs-identifier hs-var hs-var">extract_constr_Names</span></a></span></span><span> </span><span id="local-6989586621682967038"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682967038"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1790"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682967039"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682967039"><span class="hs-identifier hs-var">rep_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="GHC.Types.RepType.html#unwrapType"><span class="hs-identifier hs-var">unwrapType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682967038"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1791"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682967041"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682967041"><span class="hs-identifier hs-var">tyc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe TyCon
</span><a href="GHC.Core.Type.html#tyConAppTyCon_maybe"><span class="hs-identifier hs-var">tyConAppTyCon_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682967039"><span class="hs-identifier hs-var">rep_ty</span></a></span><span>
</span><span id="line-1792"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isDataTyCon"><span class="hs-identifier hs-var">isDataTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682967041"><span class="hs-identifier hs-var">tyc</span></a></span><span>
</span><span id="line-1793"></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DataCon -&gt; Name) -&gt; [DataCon] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Name) -&gt; (DataCon -&gt; Id) -&gt; DataCon -&gt; Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Id
</span><a href="GHC.Core.DataCon.html#dataConWorkId"><span class="hs-identifier hs-var">dataConWorkId</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [DataCon]
</span><a href="GHC.Core.TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682967041"><span class="hs-identifier hs-var">tyc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1794"></span><span>           </span><span class="hs-comment">-- NOTE: use the worker name, not the source name of</span><span>
</span><span id="line-1795"></span><span>           </span><span class="hs-comment">-- the DataCon.  See &quot;GHC.Core.DataCon&quot; for details.</span><span>
</span><span id="line-1796"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1797"></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; [Name]
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;maybe_is_tagToEnum_call.extract_constr_Ids&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682967038"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1798"></span><span class="annot"><a href="GHC.StgToByteCode.html#maybe_is_tagToEnum_call"><span class="hs-identifier hs-var">maybe_is_tagToEnum_call</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Id, [Name])
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1799"></span><span>
</span><span id="line-1800"></span><span class="hs-comment">{- -----------------------------------------------------------------------------
Note [Implementing tagToEnum#]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
(implement_tagToId arg names) compiles code which takes an argument
'arg', (call it i), and enters the i'th closure in the supplied list
as a consequence.  The [Name] is a list of the constructors of this
(enumeration) type.

The code we generate is this:
                push arg

                TESTEQ_I 0 L1
                  PUSH_G &lt;lbl for first data con&gt;
                  JMP L_Exit

        L1:     TESTEQ_I 1 L2
                  PUSH_G &lt;lbl for second data con&gt;
                  JMP L_Exit
        ...etc...
        Ln:     TESTEQ_I n L_fail
                  PUSH_G &lt;lbl for last data con&gt;
                  JMP L_Exit

        L_fail: CASEFAIL

        L_exit: SLIDE 1 n
                ENTER
-}</span><span>
</span><span id="line-1828"></span><span>
</span><span id="line-1829"></span><span>
</span><span id="line-1830"></span><span class="annot"><a href="GHC.StgToByteCode.html#implement_tagToId"><span class="hs-identifier hs-type">implement_tagToId</span></a></span><span>
</span><span id="line-1831"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-type">StackDepth</span></a></span><span>
</span><span id="line-1832"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#Sequel"><span class="hs-identifier hs-type">Sequel</span></a></span><span>
</span><span id="line-1833"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCEnv"><span class="hs-identifier hs-type">BCEnv</span></a></span><span>
</span><span id="line-1834"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-1835"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1836"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span>
</span><span id="line-1837"></span><span class="hs-comment">-- See Note [Implementing tagToEnum#]</span><span>
</span><span id="line-1838"></span><span id="implement_tagToId"><span class="annot"><span class="annottext">implement_tagToId :: ByteOff
-&gt; ByteOff
-&gt; Map Id ByteOff
-&gt; Id
-&gt; [Name]
-&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#implement_tagToId"><span class="hs-identifier hs-var hs-var">implement_tagToId</span></a></span></span><span> </span><span id="local-6989586621682967045"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967045"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682967046"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967046"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682967047"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682967047"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621682967048"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682967048"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span id="local-6989586621682967049"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682967049"><span class="hs-identifier hs-var">names</span></a></span></span><span>
</span><span id="line-1839"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; BcM (OrdList BCInstr) -&gt; BcM (OrdList BCInstr)
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name] -&gt; Bool
forall (f :: * -&gt; *) a. Foldable f =&gt; f a -&gt; Bool
</span><a href="GHC.Utils.Misc.html#notNull"><span class="hs-identifier hs-var">notNull</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682967049"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(BcM (OrdList BCInstr) -&gt; BcM (OrdList BCInstr))
-&gt; BcM (OrdList BCInstr) -&gt; BcM (OrdList BCInstr)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1840"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682967050"><span class="annot"><a href="#local-6989586621682967050"><span class="hs-identifier hs-var">push_arg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682967051"><span class="annot"><a href="#local-6989586621682967051"><span class="hs-identifier hs-var">arg_bytes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; Map Id ByteOff -&gt; StgArg -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushAtom"><span class="hs-identifier hs-var">pushAtom</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967045"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682967047"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; StgArg
</span><a href="GHC.Stg.Syntax.html#StgVarArg"><span class="hs-identifier hs-var">StgVarArg</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682967048"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1841"></span><span>       </span><span id="local-6989586621682967052"><span class="annot"><a href="#local-6989586621682967052"><span class="hs-identifier hs-var">labels</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#getLabelsBc"><span class="hs-identifier hs-type">getLabelsBc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">genericLength</span></span><span> </span><span class="annot"><a href="#local-6989586621682967049"><span class="hs-identifier hs-type">names</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1842"></span><span>       </span><span id="local-6989586621682967054"><span class="annot"><a href="#local-6989586621682967054"><span class="hs-identifier hs-var">label_fail</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#getLabelBc"><span class="hs-identifier hs-type">getLabelBc</span></a></span><span>
</span><span id="line-1843"></span><span>       </span><span id="local-6989586621682967056"><span class="annot"><a href="#local-6989586621682967056"><span class="hs-identifier hs-var">label_exit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#getLabelBc"><span class="hs-identifier hs-type">getLabelBc</span></a></span><span>
</span><span id="line-1844"></span><span>       </span><span id="local-6989586621682967057"><span class="annot"><a href="#local-6989586621682967057"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-type">getDynFlags</span></a></span><span>
</span><span id="line-1845"></span><span>       </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682967058"><span class="annot"><a href="#local-6989586621682967058"><span class="hs-identifier hs-var hs-var">infos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LocalLabel]
-&gt; [LocalLabel]
-&gt; [Int]
-&gt; [Name]
-&gt; [(LocalLabel, LocalLabel, Int, Name)]
forall a b c d. [a] -&gt; [b] -&gt; [c] -&gt; [d] -&gt; [(a, b, c, d)]
</span><span class="hs-identifier hs-var">zip4</span></span><span> </span><span class="annot"><span class="annottext">[LocalLabel]
</span><a href="#local-6989586621682967052"><span class="hs-identifier hs-var">labels</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LocalLabel] -&gt; [LocalLabel]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><a href="GHC.Prelude.Basic.html#tail"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">[LocalLabel]
</span><a href="#local-6989586621682967052"><span class="hs-identifier hs-var">labels</span></a></span><span> </span><span class="annot"><span class="annottext">[LocalLabel] -&gt; [LocalLabel] -&gt; [LocalLabel]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967054"><span class="hs-identifier hs-var">label_fail</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1846"></span><span>                               </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682967049"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-1847"></span><span>           </span><span id="local-6989586621682967060"><span class="annot"><a href="#local-6989586621682967060"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.DynFlags.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682967057"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1848"></span><span>           </span><span id="local-6989586621682967061"><span class="annot"><a href="#local-6989586621682967061"><span class="hs-identifier hs-var hs-var">steps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((LocalLabel, LocalLabel, Int, Name) -&gt; OrdList BCInstr)
-&gt; [(LocalLabel, LocalLabel, Int, Name)] -&gt; [OrdList BCInstr]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocalLabel
-&gt; (LocalLabel, LocalLabel, Int, Name) -&gt; OrdList BCInstr
</span><a href="#local-6989586621682967062"><span class="hs-identifier hs-var">mkStep</span></a></span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967056"><span class="hs-identifier hs-var">label_exit</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(LocalLabel, LocalLabel, Int, Name)]
</span><a href="#local-6989586621682967058"><span class="hs-identifier hs-var">infos</span></a></span><span>
</span><span id="line-1849"></span><span>           </span><span id="local-6989586621682967063"><span class="annot"><a href="#local-6989586621682967063"><span class="hs-identifier hs-var hs-var">slide_ws</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#bytesToWords"><span class="hs-identifier hs-var">bytesToWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682967060"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967045"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967046"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967051"><span class="hs-identifier hs-var">arg_bytes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1850"></span><span>
</span><span id="line-1851"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682967050"><span class="hs-identifier hs-type">push_arg</span></a></span><span>
</span><span id="line-1852"></span><span>               </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#concatOL"><span class="hs-identifier hs-type">concatOL</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682967061"><span class="hs-identifier hs-type">steps</span></a></span><span>
</span><span id="line-1853"></span><span>               </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-type">toOL</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html#LABEL"><span class="hs-identifier hs-type">LABEL</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682967054"><span class="hs-identifier hs-type">label_fail</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html#CASEFAIL"><span class="hs-identifier hs-type">CASEFAIL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1854"></span><span>                              </span><span class="annot"><a href="GHC.ByteCode.Instr.html#LABEL"><span class="hs-identifier hs-type">LABEL</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682967056"><span class="hs-identifier hs-type">label_exit</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1855"></span><span>               </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#mkSlideW"><span class="hs-identifier hs-type">mkSlideW</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><a href="#local-6989586621682967063"><span class="hs-identifier hs-type">slide_ws</span></a></span><span>
</span><span id="line-1856"></span><span>               </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-type">unitOL</span></a></span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html#ENTER"><span class="hs-identifier hs-type">ENTER</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1857"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1858"></span><span>        </span><span id="local-6989586621682967062"><span class="annot"><span class="annottext">mkStep :: LocalLabel
-&gt; (LocalLabel, LocalLabel, Int, Name) -&gt; OrdList BCInstr
</span><a href="#local-6989586621682967062"><span class="hs-identifier hs-var hs-var">mkStep</span></a></span></span><span> </span><span id="local-6989586621682967065"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967065"><span class="hs-identifier hs-var">l_exit</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682967066"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967066"><span class="hs-identifier hs-var">my_label</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682967067"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967067"><span class="hs-identifier hs-var">next_label</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682967068"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682967068"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682967069"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682967069"><span class="hs-identifier hs-var">name_for_n</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1859"></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[BCInstr] -&gt; OrdList BCInstr
forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#LABEL"><span class="hs-identifier hs-var">LABEL</span></a></span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967066"><span class="hs-identifier hs-var">my_label</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1860"></span><span>                   </span><span class="annot"><span class="annottext">Int -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTEQ_I"><span class="hs-identifier hs-var">TESTEQ_I</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682967068"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967067"><span class="hs-identifier hs-var">next_label</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1861"></span><span>                   </span><span class="annot"><span class="annottext">Name -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_G"><span class="hs-identifier hs-var">PUSH_G</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682967069"><span class="hs-identifier hs-var">name_for_n</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1862"></span><span>                   </span><span class="annot"><span class="annottext">LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#JMP"><span class="hs-identifier hs-var">JMP</span></a></span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967065"><span class="hs-identifier hs-var">l_exit</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1863"></span><span>
</span><span id="line-1864"></span><span>
</span><span id="line-1865"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-1866"></span><span class="hs-comment">-- pushAtom</span><span>
</span><span id="line-1867"></span><span>
</span><span id="line-1868"></span><span class="hs-comment">-- Push an atom onto the stack, returning suitable code &amp; number of</span><span>
</span><span id="line-1869"></span><span class="hs-comment">-- stack words used.</span><span>
</span><span id="line-1870"></span><span class="hs-comment">--</span><span>
</span><span id="line-1871"></span><span class="hs-comment">-- The env p must map each variable to the highest- numbered stack</span><span>
</span><span id="line-1872"></span><span class="hs-comment">-- slot for it.  For example, if the stack has depth 4 and we</span><span>
</span><span id="line-1873"></span><span class="hs-comment">-- tagged-ly push (v :: Int#) on it, the value will be in stack[4],</span><span>
</span><span id="line-1874"></span><span class="hs-comment">-- the tag in stack[5], the stack will have depth 6, and p must map v</span><span>
</span><span id="line-1875"></span><span class="hs-comment">-- to 5 and not to 4.  Stack locations are numbered from zero, so a</span><span>
</span><span id="line-1876"></span><span class="hs-comment">-- depth 6 stack has valid words 0 .. 5.</span><span>
</span><span id="line-1877"></span><span>
</span><span id="line-1878"></span><span class="annot"><a href="GHC.StgToByteCode.html#pushAtom"><span class="hs-identifier hs-type">pushAtom</span></a></span><span>
</span><span id="line-1879"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-type">StackDepth</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCEnv"><span class="hs-identifier hs-type">BCEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1880"></span><span>
</span><span id="line-1881"></span><span class="hs-comment">-- See Note [Empty case alternatives] in GHC.Core</span><span>
</span><span id="line-1882"></span><span class="hs-comment">-- and Note [Bottoming expressions] in GHC.Core.Utils:</span><span>
</span><span id="line-1883"></span><span class="hs-comment">-- The scrutinee of an empty case evaluates to bottom</span><span>
</span><span id="line-1884"></span><span id="pushAtom"><span class="annot"><span class="annottext">pushAtom :: ByteOff
-&gt; Map Id ByteOff -&gt; StgArg -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushAtom"><span class="hs-identifier hs-var hs-var">pushAtom</span></a></span></span><span> </span><span id="local-6989586621682967073"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967073"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682967074"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682967074"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgVarArg"><span class="hs-identifier hs-type">StgVarArg</span></a></span><span> </span><span id="local-6989586621682967075"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682967075"><span class="hs-identifier hs-var">var</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1885"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; [PrimRep]
Type -&gt; [PrimRep]
</span><a href="GHC.Types.RepType.html#typePrimRep"><span class="hs-identifier hs-var">typePrimRep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682967075"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1886"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(OrdList BCInstr, ByteOff) -&gt; BcM (OrdList BCInstr, ByteOff)
forall a. a -&gt; BcM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrdList BCInstr
forall a. OrdList a
</span><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-var">nilOL</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-1887"></span><span>
</span><span id="line-1888"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Id.html#isFCallId"><span class="hs-identifier hs-var">isFCallId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682967075"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-1889"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; BcM (OrdList BCInstr, ByteOff)
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;pushAtom: shouldn't get an FCallId here&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682967075"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1890"></span><span>
</span><span id="line-1891"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682967077"><span class="annot"><span class="annottext">PrimOp
</span><a href="#local-6989586621682967077"><span class="hs-identifier hs-var">primop</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Maybe PrimOp
</span><a href="GHC.Types.Id.html#isPrimOpId_maybe"><span class="hs-identifier hs-var">isPrimOpId_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682967075"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-1892"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1893"></span><span>       </span><span id="local-6989586621682967079"><span class="annot"><a href="#local-6989586621682967079"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.DynFlags.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; Platform) -&gt; BcM DynFlags -&gt; BcM Platform
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">BcM DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1894"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-type">unitOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.ByteCode.Instr.html#PUSH_PRIMOP"><span class="hs-identifier hs-type">PUSH_PRIMOP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682967077"><span class="hs-identifier hs-type">primop</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#wordSize"><span class="hs-identifier hs-type">wordSize</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682967079"><span class="hs-identifier hs-type">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1895"></span><span>
</span><span id="line-1896"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682967081"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967081"><span class="hs-identifier hs-var">d_v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Map Id ByteOff -&gt; Maybe ByteOff
</span><a href="GHC.StgToByteCode.html#lookupBCEnv_maybe"><span class="hs-identifier hs-var">lookupBCEnv_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682967075"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682967074"><span class="hs-identifier hs-var">p</span></a></span><span>  </span><span class="hs-comment">-- var is a local variable</span><span>
</span><span id="line-1897"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621682967082"><span class="annot"><a href="#local-6989586621682967082"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.DynFlags.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; Platform) -&gt; BcM DynFlags -&gt; BcM Platform
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">BcM DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1898"></span><span>
</span><span id="line-1899"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682967083"><span class="annot"><a href="#local-6989586621682967083"><span class="hs-identifier hs-var hs-var">szb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Id -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#idSizeCon"><span class="hs-identifier hs-var">idSizeCon</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682967082"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682967075"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-1900"></span><span>            </span><span class="annot"><a href="#local-6989586621682967085"><span class="hs-identifier hs-type">with_instr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html#BCInstr"><span class="hs-identifier hs-type">BCInstr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.OrdList.html#OrdList"><span class="hs-identifier hs-type">OrdList</span></a></span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html#BCInstr"><span class="hs-identifier hs-type">BCInstr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1901"></span><span>            </span><span id="local-6989586621682967085"><span class="annot"><a href="#local-6989586621682967085"><span class="hs-identifier hs-var hs-var">with_instr</span></a></span></span><span> </span><span id="local-6989586621682967086"><span class="annot"><span class="annottext">ByteOff -&gt; BCInstr
</span><a href="#local-6989586621682967086"><span class="hs-identifier hs-var">instr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1902"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682967087"><span class="annot"><span class="annottext">off_b :: ByteOff
</span><a href="#local-6989586621682967087"><span class="hs-identifier hs-var hs-var">off_b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967073"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967081"><span class="hs-identifier hs-var">d_v</span></a></span><span>
</span><span id="line-1903"></span><span>                </span><span class="annot"><span class="annottext">(OrdList BCInstr, ByteOff) -&gt; BcM (OrdList BCInstr, ByteOff)
forall a. a -&gt; BcM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BCInstr -&gt; OrdList BCInstr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff -&gt; BCInstr
</span><a href="#local-6989586621682967086"><span class="hs-identifier hs-var">instr</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967087"><span class="hs-identifier hs-var">off_b</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordSize"><span class="hs-identifier hs-var">wordSize</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682967082"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1904"></span><span>
</span><span id="line-1905"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682967083"><span class="hs-identifier hs-type">szb</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1906"></span><span>            </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ByteOff -&gt; BCInstr) -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621682967085"><span class="hs-identifier hs-var">with_instr</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH8_W"><span class="hs-identifier hs-var">PUSH8_W</span></a></span><span>
</span><span id="line-1907"></span><span>            </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ByteOff -&gt; BCInstr) -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621682967085"><span class="hs-identifier hs-var">with_instr</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH16_W"><span class="hs-identifier hs-var">PUSH16_W</span></a></span><span>
</span><span id="line-1908"></span><span>            </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">4</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ByteOff -&gt; BCInstr) -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621682967085"><span class="hs-identifier hs-var">with_instr</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH32_W"><span class="hs-identifier hs-var">PUSH32_W</span></a></span><span>
</span><span id="line-1909"></span><span>            </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1910"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682967091"><span class="annot"><span class="annottext">szw :: WordOff
</span><a href="#local-6989586621682967091"><span class="hs-identifier hs-var hs-var">szw</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#bytesToWords"><span class="hs-identifier hs-var">bytesToWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682967082"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967083"><span class="hs-identifier hs-var">szb</span></a></span><span>
</span><span id="line-1911"></span><span>                    </span><span class="hs-glyph">!</span><span id="local-6989586621682967092"><span class="annot"><span class="annottext">off_w :: WordOff
</span><a href="#local-6989586621682967092"><span class="hs-identifier hs-var hs-var">off_w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#bytesToWords"><span class="hs-identifier hs-var">bytesToWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682967082"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967073"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967081"><span class="hs-identifier hs-var">d_v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; WordOff -&gt; WordOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682967091"><span class="hs-identifier hs-var">szw</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; WordOff -&gt; WordOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1912"></span><span>                </span><span class="annot"><span class="annottext">(OrdList BCInstr, ByteOff) -&gt; BcM (OrdList BCInstr, ByteOff)
forall a. a -&gt; BcM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[BCInstr] -&gt; OrdList BCInstr
forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WordOff -&gt; BCInstr -&gt; [BCInstr]
forall i a. Integral i =&gt; i -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">genericReplicate</span></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682967091"><span class="hs-identifier hs-var">szw</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WordOff -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_L"><span class="hs-identifier hs-var">PUSH_L</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682967092"><span class="hs-identifier hs-var">off_w</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1913"></span><span>                              </span><span class="annot"><span class="annottext">Platform -&gt; WordOff -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordsToBytes"><span class="hs-identifier hs-var">wordsToBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682967082"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682967091"><span class="hs-identifier hs-var">szw</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1914"></span><span>        </span><span class="hs-comment">-- d - d_v           offset from TOS to the first slot of the object</span><span>
</span><span id="line-1915"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-1916"></span><span>        </span><span class="hs-comment">-- d - d_v + sz - 1  offset from the TOS of the last slot of the object</span><span>
</span><span id="line-1917"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-1918"></span><span>        </span><span class="hs-comment">-- Having found the last slot, we proceed to copy the right number of</span><span>
</span><span id="line-1919"></span><span>        </span><span class="hs-comment">-- slots on to the top of the stack.</span><span>
</span><span id="line-1920"></span><span>
</span><span id="line-1921"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>  </span><span class="hs-comment">-- var must be a global variable</span><span>
</span><span id="line-1922"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621682967093"><span class="annot"><a href="#local-6989586621682967093"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.DynFlags.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; Platform) -&gt; BcM DynFlags -&gt; BcM Platform
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">BcM DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1923"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682967094"><span class="annot"><a href="#local-6989586621682967094"><span class="hs-identifier hs-var hs-var">szb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Id -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#idSizeCon"><span class="hs-identifier hs-var">idSizeCon</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682967093"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682967075"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-1924"></span><span>        </span><span class="annot"><a href="GHC.Utils.Panic.Plain.html#massert"><span class="hs-identifier hs-type">massert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682967094"><span class="hs-identifier hs-type">szb</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#wordSize"><span class="hs-identifier hs-type">wordSize</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682967093"><span class="hs-identifier hs-type">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1925"></span><span>
</span><span id="line-1926"></span><span>        </span><span class="hs-comment">-- PUSH_G doesn't tag constructors. So we use PACK here</span><span>
</span><span id="line-1927"></span><span>        </span><span class="hs-comment">-- if we are dealing with nullary constructor.</span><span>
</span><span id="line-1928"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Types.Id.html#isDataConWorkId_maybe"><span class="hs-identifier hs-type">isDataConWorkId_maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682967075"><span class="hs-identifier hs-type">var</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1929"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682967095"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682967095"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1930"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; BcM ()
forall (m :: * -&gt; *). (HasCallStack, Applicative m) =&gt; Bool -&gt; m ()
</span><a href="GHC.Utils.Panic.Plain.html#massert"><span class="hs-identifier hs-var">massert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isNullaryRepDataCon"><span class="hs-identifier hs-var">isNullaryRepDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682967095"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1931"></span><span>            </span><span class="annot"><span class="annottext">(OrdList BCInstr, ByteOff) -&gt; BcM (OrdList BCInstr, ByteOff)
forall a. a -&gt; BcM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BCInstr -&gt; OrdList BCInstr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; WordOff -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PACK"><span class="hs-identifier hs-var">PACK</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682967095"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967094"><span class="hs-identifier hs-var">szb</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1932"></span><span>
</span><span id="line-1933"></span><span>          </span><span class="annot"><span class="annottext">Maybe DataCon
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1934"></span><span>            </span><span class="hs-comment">-- see Note [Generating code for top-level string literal bindings]</span><span>
</span><span id="line-1935"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Bool
Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnliftedType"><span class="hs-identifier hs-var">isUnliftedType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682967075"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1936"></span><span>              </span><span class="annot"><span class="annottext">Bool -&gt; BcM ()
forall (m :: * -&gt; *). (HasCallStack, Applicative m) =&gt; Bool -&gt; m ()
</span><a href="GHC.Utils.Panic.Plain.html#massert"><span class="hs-identifier hs-var">massert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682967075"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.Prim.html#addrPrimTy"><span class="hs-identifier hs-var">addrPrimTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1937"></span><span>              </span><span class="annot"><span class="annottext">(OrdList BCInstr, ByteOff) -&gt; BcM (OrdList BCInstr, ByteOff)
forall a. a -&gt; BcM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BCInstr -&gt; OrdList BCInstr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_ADDR"><span class="hs-identifier hs-var">PUSH_ADDR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682967075"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967094"><span class="hs-identifier hs-var">szb</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1938"></span><span>
</span><span id="line-1939"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1940"></span><span>              </span><span class="annot"><span class="annottext">(OrdList BCInstr, ByteOff) -&gt; BcM (OrdList BCInstr, ByteOff)
forall a. a -&gt; BcM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BCInstr -&gt; OrdList BCInstr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_G"><span class="hs-identifier hs-var">PUSH_G</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682967075"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967094"><span class="hs-identifier hs-var">szb</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1941"></span><span>
</span><span id="line-1942"></span><span>
</span><span id="line-1943"></span><span class="annot"><a href="GHC.StgToByteCode.html#pushAtom"><span class="hs-identifier hs-var">pushAtom</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgLitArg"><span class="hs-identifier hs-type">StgLitArg</span></a></span><span> </span><span id="local-6989586621682967098"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682967098"><span class="hs-identifier hs-var">lit</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Literal -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushLiteral"><span class="hs-identifier hs-var">pushLiteral</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682967098"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-1944"></span><span>
</span><span id="line-1945"></span><span class="annot"><a href="GHC.StgToByteCode.html#pushLiteral"><span class="hs-identifier hs-type">pushLiteral</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1946"></span><span id="pushLiteral"><span class="annot"><span class="annottext">pushLiteral :: Bool -&gt; Literal -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushLiteral"><span class="hs-identifier hs-var hs-var">pushLiteral</span></a></span></span><span> </span><span id="local-6989586621682967100"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682967100"><span class="hs-identifier hs-var">padded</span></a></span></span><span> </span><span id="local-6989586621682967101"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682967101"><span class="hs-identifier hs-var">lit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1947"></span><span>  </span><span class="hs-keyword">do</span><span>
</span><span id="line-1948"></span><span>     </span><span id="local-6989586621682967102"><span class="annot"><a href="#local-6989586621682967102"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.DynFlags.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; Platform) -&gt; BcM DynFlags -&gt; BcM Platform
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">BcM DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1949"></span><span>     </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621682967103"><span class="hs-identifier hs-type">code</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#PrimRep"><span class="hs-identifier hs-type">PrimRep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1950"></span><span>         </span><span id="local-6989586621682967103"><span class="annot"><a href="#local-6989586621682967103"><span class="hs-identifier hs-var hs-var">code</span></a></span></span><span> </span><span id="local-6989586621682967104"><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621682967104"><span class="hs-identifier hs-var">rep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1951"></span><span>            </span><span class="annot"><span class="annottext">(OrdList BCInstr, ByteOff) -&gt; BcM (OrdList BCInstr, ByteOff)
forall a. a -&gt; BcM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621682967105"><span class="hs-identifier hs-var">padding_instr</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr -&gt; BCInstr -&gt; OrdList BCInstr
forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span> </span><span class="annot"><span class="annottext">BCInstr
</span><a href="#local-6989586621682967106"><span class="hs-identifier hs-var">instr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967107"><span class="hs-identifier hs-var">size_bytes</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967108"><span class="hs-identifier hs-var">padding_bytes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1952"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-1953"></span><span>            </span><span id="local-6989586621682967107"><span class="annot"><span class="annottext">size_bytes :: ByteOff
</span><a href="#local-6989586621682967107"><span class="hs-identifier hs-var hs-var">size_bytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteOff
</span><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-var">ByteOff</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; ByteOff) -&gt; Int -&gt; ByteOff
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; PrimRep -&gt; Int
</span><a href="GHC.Core.TyCon.html#primRepSizeB"><span class="hs-identifier hs-var">primRepSizeB</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682967102"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621682967104"><span class="hs-identifier hs-var">rep</span></a></span><span>
</span><span id="line-1954"></span><span>
</span><span id="line-1955"></span><span>            </span><span class="hs-comment">-- Here we handle the non-word-width cases specifically since we</span><span>
</span><span id="line-1956"></span><span>            </span><span class="hs-comment">-- must emit different bytecode for them.</span><span>
</span><span id="line-1957"></span><span>
</span><span id="line-1958"></span><span>            </span><span id="local-6989586621682967110"><span class="annot"><span class="annottext">round_to_words :: ByteOff -&gt; ByteOff
</span><a href="#local-6989586621682967110"><span class="hs-identifier hs-var hs-var">round_to_words</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span> </span><span id="local-6989586621682967111"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682967111"><span class="hs-identifier hs-var">bytes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1959"></span><span>              </span><span class="annot"><span class="annottext">Int -&gt; ByteOff
</span><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-var">ByteOff</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; Int -&gt; Int
</span><a href="GHC.Runtime.Heap.Layout.html#roundUpToWords"><span class="hs-identifier hs-var">roundUpToWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682967102"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682967111"><span class="hs-identifier hs-var">bytes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1960"></span><span>
</span><span id="line-1961"></span><span>            </span><span id="local-6989586621682967108"><span class="annot"><span class="annottext">padding_bytes :: ByteOff
</span><a href="#local-6989586621682967108"><span class="hs-identifier hs-var hs-var">padding_bytes</span></a></span></span><span>
</span><span id="line-1962"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682967100"><span class="hs-identifier hs-var">padded</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff
</span><a href="#local-6989586621682967110"><span class="hs-identifier hs-var">round_to_words</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967107"><span class="hs-identifier hs-var">size_bytes</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967107"><span class="hs-identifier hs-var">size_bytes</span></a></span><span>
</span><span id="line-1963"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1964"></span><span>
</span><span id="line-1965"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682967105"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621682967105"><span class="hs-identifier hs-var">padding_instr</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushPadding"><span class="hs-identifier hs-var">pushPadding</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967108"><span class="hs-identifier hs-var">padding_bytes</span></a></span><span>
</span><span id="line-1966"></span><span>
</span><span id="line-1967"></span><span>            </span><span id="local-6989586621682967106"><span class="annot"><span class="annottext">instr :: BCInstr
</span><a href="#local-6989586621682967106"><span class="hs-identifier hs-var hs-var">instr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1968"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967107"><span class="hs-identifier hs-var">size_bytes</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1969"></span><span>                </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">1</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_UBX8"><span class="hs-identifier hs-var">PUSH_UBX8</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682967101"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-1970"></span><span>                </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">2</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_UBX16"><span class="hs-identifier hs-var">PUSH_UBX16</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682967101"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-1971"></span><span>                </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">4</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_UBX32"><span class="hs-identifier hs-var">PUSH_UBX32</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682967101"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-1972"></span><span>                </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; WordOff -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_UBX"><span class="hs-identifier hs-var">PUSH_UBX</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682967101"><span class="hs-identifier hs-var">lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; ByteOff -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#bytesToWords"><span class="hs-identifier hs-var">bytesToWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682967102"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967107"><span class="hs-identifier hs-var">size_bytes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1973"></span><span>
</span><span id="line-1974"></span><span>     </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682967101"><span class="hs-identifier hs-type">lit</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1975"></span><span>        </span><span class="annot"><a href="GHC.Types.Literal.html#LitLabel"><span class="hs-identifier hs-type">LitLabel</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621682967103"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#AddrRep"><span class="hs-identifier hs-var">AddrRep</span></a></span><span>
</span><span id="line-1976"></span><span>        </span><span class="annot"><a href="GHC.Types.Literal.html#LitFloat"><span class="hs-identifier hs-type">LitFloat</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621682967103"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#FloatRep"><span class="hs-identifier hs-var">FloatRep</span></a></span><span>
</span><span id="line-1977"></span><span>        </span><span class="annot"><a href="GHC.Types.Literal.html#LitDouble"><span class="hs-identifier hs-type">LitDouble</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621682967103"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#DoubleRep"><span class="hs-identifier hs-var">DoubleRep</span></a></span><span>
</span><span id="line-1978"></span><span>        </span><span class="annot"><a href="GHC.Types.Literal.html#LitChar"><span class="hs-identifier hs-type">LitChar</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621682967103"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#WordRep"><span class="hs-identifier hs-var">WordRep</span></a></span><span>
</span><span id="line-1979"></span><span>        </span><span class="annot"><span class="annottext">Literal
</span><a href="GHC.Types.Literal.html#LitNullAddr"><span class="hs-identifier hs-var">LitNullAddr</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621682967103"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#AddrRep"><span class="hs-identifier hs-var">AddrRep</span></a></span><span>
</span><span id="line-1980"></span><span>        </span><span class="annot"><a href="GHC.Types.Literal.html#LitString"><span class="hs-identifier hs-type">LitString</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621682967103"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#AddrRep"><span class="hs-identifier hs-var">AddrRep</span></a></span><span>
</span><span id="line-1981"></span><span>        </span><span class="annot"><a href="GHC.Types.Literal.html#LitRubbish"><span class="hs-identifier hs-type">LitRubbish</span></a></span><span> </span><span class="annot"><span class="annottext">TypeOrConstraint
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682967116"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682967116"><span class="hs-identifier hs-var">rep</span></a></span></span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; SDoc -&gt; Type -&gt; [PrimRep]
SDoc -&gt; Type -&gt; [PrimRep]
</span><a href="GHC.Types.RepType.html#runtimeRepPrimRep"><span class="hs-identifier hs-var">runtimeRepPrimRep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;pushLiteral&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682967116"><span class="hs-identifier hs-var">rep</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1982"></span><span>                             </span><span class="hs-special">[</span><span id="local-6989586621682967118"><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621682967118"><span class="hs-identifier hs-var">pr</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621682967103"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621682967118"><span class="hs-identifier hs-var">pr</span></a></span><span>
</span><span id="line-1983"></span><span>                             </span><span class="annot"><span class="annottext">[PrimRep]
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; BcM (OrdList BCInstr, ByteOff)
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;pushLiteral&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Literal -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682967101"><span class="hs-identifier hs-var">lit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1984"></span><span>        </span><span class="annot"><a href="GHC.Types.Literal.html#LitNumber"><span class="hs-identifier hs-type">LitNumber</span></a></span><span> </span><span id="local-6989586621682967119"><span class="annot"><span class="annottext">LitNumType
</span><a href="#local-6989586621682967119"><span class="hs-identifier hs-var">nt</span></a></span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LitNumType
</span><a href="#local-6989586621682967119"><span class="hs-identifier hs-var">nt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1985"></span><span>          </span><span class="annot"><span class="annottext">LitNumType
</span><a href="GHC.Types.Literal.html#LitNumInt"><span class="hs-identifier hs-var">LitNumInt</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621682967103"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#IntRep"><span class="hs-identifier hs-var">IntRep</span></a></span><span>
</span><span id="line-1986"></span><span>          </span><span class="annot"><span class="annottext">LitNumType
</span><a href="GHC.Types.Literal.html#LitNumWord"><span class="hs-identifier hs-var">LitNumWord</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621682967103"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#WordRep"><span class="hs-identifier hs-var">WordRep</span></a></span><span>
</span><span id="line-1987"></span><span>          </span><span class="annot"><span class="annottext">LitNumType
</span><a href="GHC.Types.Literal.html#LitNumInt8"><span class="hs-identifier hs-var">LitNumInt8</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621682967103"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Int8Rep"><span class="hs-identifier hs-var">Int8Rep</span></a></span><span>
</span><span id="line-1988"></span><span>          </span><span class="annot"><span class="annottext">LitNumType
</span><a href="GHC.Types.Literal.html#LitNumWord8"><span class="hs-identifier hs-var">LitNumWord8</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621682967103"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Word8Rep"><span class="hs-identifier hs-var">Word8Rep</span></a></span><span>
</span><span id="line-1989"></span><span>          </span><span class="annot"><span class="annottext">LitNumType
</span><a href="GHC.Types.Literal.html#LitNumInt16"><span class="hs-identifier hs-var">LitNumInt16</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621682967103"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Int16Rep"><span class="hs-identifier hs-var">Int16Rep</span></a></span><span>
</span><span id="line-1990"></span><span>          </span><span class="annot"><span class="annottext">LitNumType
</span><a href="GHC.Types.Literal.html#LitNumWord16"><span class="hs-identifier hs-var">LitNumWord16</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621682967103"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Word16Rep"><span class="hs-identifier hs-var">Word16Rep</span></a></span><span>
</span><span id="line-1991"></span><span>          </span><span class="annot"><span class="annottext">LitNumType
</span><a href="GHC.Types.Literal.html#LitNumInt32"><span class="hs-identifier hs-var">LitNumInt32</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621682967103"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Int32Rep"><span class="hs-identifier hs-var">Int32Rep</span></a></span><span>
</span><span id="line-1992"></span><span>          </span><span class="annot"><span class="annottext">LitNumType
</span><a href="GHC.Types.Literal.html#LitNumWord32"><span class="hs-identifier hs-var">LitNumWord32</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621682967103"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Word32Rep"><span class="hs-identifier hs-var">Word32Rep</span></a></span><span>
</span><span id="line-1993"></span><span>          </span><span class="annot"><span class="annottext">LitNumType
</span><a href="GHC.Types.Literal.html#LitNumInt64"><span class="hs-identifier hs-var">LitNumInt64</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621682967103"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Int64Rep"><span class="hs-identifier hs-var">Int64Rep</span></a></span><span>
</span><span id="line-1994"></span><span>          </span><span class="annot"><span class="annottext">LitNumType
</span><a href="GHC.Types.Literal.html#LitNumWord64"><span class="hs-identifier hs-var">LitNumWord64</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621682967103"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Word64Rep"><span class="hs-identifier hs-var">Word64Rep</span></a></span><span>
</span><span id="line-1995"></span><span>          </span><span class="hs-comment">-- No LitNumBigNat should be left by the time this is called. CorePrep</span><span>
</span><span id="line-1996"></span><span>          </span><span class="hs-comment">-- should have converted them all to a real core representation.</span><span>
</span><span id="line-1997"></span><span>          </span><span class="annot"><span class="annottext">LitNumType
</span><a href="GHC.Types.Literal.html#LitNumBigNat"><span class="hs-identifier hs-var">LitNumBigNat</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; BcM (OrdList BCInstr, ByteOff)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;pushAtom: LitNumBigNat&quot;</span></span><span>
</span><span id="line-1998"></span><span>
</span><span id="line-1999"></span><span class="hs-comment">-- | Push an atom for constructor (i.e., PACK instruction) onto the stack.</span><span>
</span><span id="line-2000"></span><span class="hs-comment">-- This is slightly different to @pushAtom@ due to the fact that we allow</span><span>
</span><span id="line-2001"></span><span class="hs-comment">-- packing constructor fields. See also @mkConAppCode@ and @pushPadding@.</span><span>
</span><span id="line-2002"></span><span class="annot"><a href="GHC.StgToByteCode.html#pushConstrAtom"><span class="hs-identifier hs-type">pushConstrAtom</span></a></span><span>
</span><span id="line-2003"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-type">StackDepth</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCEnv"><span class="hs-identifier hs-type">BCEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2004"></span><span id="pushConstrAtom"><span class="annot"><span class="annottext">pushConstrAtom :: ByteOff
-&gt; Map Id ByteOff -&gt; StgArg -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushConstrAtom"><span class="hs-identifier hs-var hs-var">pushConstrAtom</span></a></span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgLitArg"><span class="hs-identifier hs-type">StgLitArg</span></a></span><span> </span><span id="local-6989586621682967120"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682967120"><span class="hs-identifier hs-var">lit</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Literal -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushLiteral"><span class="hs-identifier hs-var">pushLiteral</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682967120"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-2005"></span><span>
</span><span id="line-2006"></span><span class="annot"><a href="GHC.StgToByteCode.html#pushConstrAtom"><span class="hs-identifier hs-var">pushConstrAtom</span></a></span><span> </span><span id="local-6989586621682967121"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967121"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682967122"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682967122"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621682967123"><span class="annot"><span class="annottext">va :: StgArg
</span><a href="#local-6989586621682967123"><span class="hs-identifier hs-var">va</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgVarArg"><span class="hs-identifier hs-type">StgVarArg</span></a></span><span> </span><span id="local-6989586621682967124"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682967124"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2007"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682967125"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967125"><span class="hs-identifier hs-var">d_v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Map Id ByteOff -&gt; Maybe ByteOff
</span><a href="GHC.StgToByteCode.html#lookupBCEnv_maybe"><span class="hs-identifier hs-var">lookupBCEnv_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682967124"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682967122"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-comment">-- v is a local variable</span><span>
</span><span id="line-2008"></span><span>        </span><span id="local-6989586621682967126"><span class="annot"><a href="#local-6989586621682967126"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.DynFlags.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; Platform) -&gt; BcM DynFlags -&gt; BcM Platform
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">BcM DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-2009"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682967127"><span class="annot"><a href="#local-6989586621682967127"><span class="hs-identifier hs-var hs-var">szb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Id -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#idSizeCon"><span class="hs-identifier hs-var">idSizeCon</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682967126"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682967124"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-2010"></span><span>            </span><span id="local-6989586621682967128"><span class="annot"><a href="#local-6989586621682967128"><span class="hs-identifier hs-var hs-var">done</span></a></span></span><span> </span><span id="local-6989586621682967129"><span class="annot"><span class="annottext">ByteOff -&gt; BCInstr
</span><a href="#local-6989586621682967129"><span class="hs-identifier hs-var">instr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2011"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682967130"><span class="annot"><span class="annottext">off :: ByteOff
</span><a href="#local-6989586621682967130"><span class="hs-identifier hs-var hs-var">off</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967121"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967125"><span class="hs-identifier hs-var">d_v</span></a></span><span>
</span><span id="line-2012"></span><span>                </span><span class="annot"><span class="annottext">(OrdList BCInstr, ByteOff) -&gt; BcM (OrdList BCInstr, ByteOff)
forall a. a -&gt; BcM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BCInstr -&gt; OrdList BCInstr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff -&gt; BCInstr
</span><a href="#local-6989586621682967129"><span class="hs-identifier hs-var">instr</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967130"><span class="hs-identifier hs-var">off</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967127"><span class="hs-identifier hs-var">szb</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2013"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682967127"><span class="hs-identifier hs-type">szb</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2014"></span><span>            </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ByteOff -&gt; BCInstr) -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621682967128"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH8"><span class="hs-identifier hs-var">PUSH8</span></a></span><span>
</span><span id="line-2015"></span><span>            </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ByteOff -&gt; BCInstr) -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621682967128"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH16"><span class="hs-identifier hs-var">PUSH16</span></a></span><span>
</span><span id="line-2016"></span><span>            </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">4</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ByteOff -&gt; BCInstr) -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621682967128"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH32"><span class="hs-identifier hs-var">PUSH32</span></a></span><span>
</span><span id="line-2017"></span><span>            </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; Map Id ByteOff -&gt; StgArg -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushAtom"><span class="hs-identifier hs-var">pushAtom</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967121"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682967122"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621682967123"><span class="hs-identifier hs-var">va</span></a></span><span>
</span><span id="line-2018"></span><span>
</span><span id="line-2019"></span><span class="annot"><a href="GHC.StgToByteCode.html#pushConstrAtom"><span class="hs-identifier hs-var">pushConstrAtom</span></a></span><span> </span><span id="local-6989586621682967134"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967134"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682967135"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682967135"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621682967136"><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621682967136"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; Map Id ByteOff -&gt; StgArg -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushAtom"><span class="hs-identifier hs-var">pushAtom</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967134"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621682967135"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621682967136"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-2020"></span><span>
</span><span id="line-2021"></span><span class="annot"><a href="GHC.StgToByteCode.html#pushPadding"><span class="hs-identifier hs-type">pushPadding</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2022"></span><span id="pushPadding"><span class="annot"><span class="annottext">pushPadding :: ByteOff -&gt; (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushPadding"><span class="hs-identifier hs-var hs-var">pushPadding</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span> </span><span id="local-6989586621682967137"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682967137"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; (OrdList BCInstr, ByteOff) -&gt; (OrdList BCInstr, ByteOff)
forall {t} {b}.
(Eq t, Num t, Num b) =&gt;
t -&gt; (OrdList BCInstr, b) -&gt; (OrdList BCInstr, b)
</span><a href="#local-6989586621682967138"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682967137"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrdList BCInstr
forall a. OrdList a
</span><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-var">nilOL</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-2023"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2024"></span><span>    </span><span id="local-6989586621682967138"><span class="annot"><span class="annottext">go :: t -&gt; (OrdList BCInstr, b) -&gt; (OrdList BCInstr, b)
</span><a href="#local-6989586621682967138"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621682967166"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682967166"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682967167"><span class="annot"><span class="annottext">acc :: (OrdList BCInstr, b)
</span><a href="#local-6989586621682967167"><span class="hs-identifier hs-var">acc</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621682967168"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621682967168"><span class="hs-identifier hs-var">instrs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682967169"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682967169"><span class="hs-identifier hs-var">off</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682967166"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2025"></span><span>        </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(OrdList BCInstr, b)
</span><a href="#local-6989586621682967167"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-2026"></span><span>        </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621682967168"><span class="hs-identifier hs-var">instrs</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr -&gt; OrdList BCInstr -&gt; OrdList BCInstr
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">BCInstr -&gt; OrdList BCInstr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_PAD8"><span class="hs-identifier hs-var">PUSH_PAD8</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682967169"><span class="hs-identifier hs-var">off</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; b -&gt; b
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-2027"></span><span>        </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621682967168"><span class="hs-identifier hs-var">instrs</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr -&gt; OrdList BCInstr -&gt; OrdList BCInstr
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">BCInstr -&gt; OrdList BCInstr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_PAD16"><span class="hs-identifier hs-var">PUSH_PAD16</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682967169"><span class="hs-identifier hs-var">off</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; b -&gt; b
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-2028"></span><span>        </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">3</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">t -&gt; (OrdList BCInstr, b) -&gt; (OrdList BCInstr, b)
</span><a href="#local-6989586621682967138"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t -&gt; (OrdList BCInstr, b) -&gt; (OrdList BCInstr, b)
</span><a href="#local-6989586621682967138"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(OrdList BCInstr, b)
</span><a href="#local-6989586621682967167"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2029"></span><span>        </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">4</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621682967168"><span class="hs-identifier hs-var">instrs</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr -&gt; OrdList BCInstr -&gt; OrdList BCInstr
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">BCInstr -&gt; OrdList BCInstr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_PAD32"><span class="hs-identifier hs-var">PUSH_PAD32</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682967169"><span class="hs-identifier hs-var">off</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; b -&gt; b
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-number">4</span></span><span class="hs-special">)</span><span>
</span><span id="line-2030"></span><span>        </span><span class="annot"><span class="annottext">t
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">t -&gt; (OrdList BCInstr, b) -&gt; (OrdList BCInstr, b)
</span><a href="#local-6989586621682967138"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682967166"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; t
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">4</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t -&gt; (OrdList BCInstr, b) -&gt; (OrdList BCInstr, b)
</span><a href="#local-6989586621682967138"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">(OrdList BCInstr, b)
</span><a href="#local-6989586621682967167"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2031"></span><span>
</span><span id="line-2032"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-2033"></span><span class="hs-comment">-- Given a bunch of alts code and their discrs, do the donkey work</span><span>
</span><span id="line-2034"></span><span class="hs-comment">-- of making a multiway branch using a switch tree.</span><span>
</span><span id="line-2035"></span><span class="hs-comment">-- What a load of hassle!</span><span>
</span><span id="line-2036"></span><span>
</span><span id="line-2037"></span><span class="annot"><a href="GHC.StgToByteCode.html#mkMultiBranch"><span class="hs-identifier hs-type">mkMultiBranch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>      </span><span class="hs-comment">-- # datacons in tycon, if alg alt</span><span>
</span><span id="line-2038"></span><span>                                </span><span class="hs-comment">-- a hint; generates better code</span><span>
</span><span id="line-2039"></span><span>                                </span><span class="hs-comment">-- Nothing is always safe</span><span>
</span><span id="line-2040"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#Discr"><span class="hs-identifier hs-type">Discr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2041"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span>
</span><span id="line-2042"></span><span id="mkMultiBranch"><span class="annot"><span class="annottext">mkMultiBranch :: Maybe Int -&gt; [(Discr, OrdList BCInstr)] -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#mkMultiBranch"><span class="hs-identifier hs-var hs-var">mkMultiBranch</span></a></span></span><span> </span><span id="local-6989586621682967173"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621682967173"><span class="hs-identifier hs-var">maybe_ncons</span></a></span></span><span> </span><span id="local-6989586621682967174"><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
</span><a href="#local-6989586621682967174"><span class="hs-identifier hs-var">raw_ways</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2043"></span><span>     </span><span id="local-6989586621682967175"><span class="annot"><a href="#local-6989586621682967175"><span class="hs-identifier hs-var">lbl_default</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BcM LocalLabel
</span><a href="GHC.StgToByteCode.html#getLabelBc"><span class="hs-identifier hs-var">getLabelBc</span></a></span><span>
</span><span id="line-2044"></span><span>
</span><span id="line-2045"></span><span>     </span><span class="hs-keyword">let</span><span>
</span><span id="line-2046"></span><span>         </span><span class="annot"><a href="#local-6989586621682967176"><span class="hs-identifier hs-type">mkTree</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#Discr"><span class="hs-identifier hs-type">Discr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#Discr"><span class="hs-identifier hs-type">Discr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#Discr"><span class="hs-identifier hs-type">Discr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span>
</span><span id="line-2047"></span><span>         </span><span id="local-6989586621682967176"><span class="annot"><a href="#local-6989586621682967176"><span class="hs-identifier hs-var hs-var">mkTree</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621682967177"><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621682967177"><span class="hs-identifier hs-var">_range_lo</span></a></span></span><span> </span><span id="local-6989586621682967178"><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621682967178"><span class="hs-identifier hs-var">_range_hi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr -&gt; BcM (OrdList BCInstr)
forall a. a -&gt; BcM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BCInstr -&gt; OrdList BCInstr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#JMP"><span class="hs-identifier hs-var">JMP</span></a></span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967175"><span class="hs-identifier hs-var">lbl_default</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2048"></span><span>             </span><span class="hs-comment">-- shouldn't happen?</span><span>
</span><span id="line-2049"></span><span>
</span><span id="line-2050"></span><span>         </span><span class="annot"><a href="#local-6989586621682967176"><span class="hs-identifier hs-var">mkTree</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621682967179"><span class="annot"><span class="annottext">(Discr, OrdList BCInstr)
</span><a href="#local-6989586621682967179"><span class="hs-identifier hs-var">val</span></a></span></span><span class="hs-special">]</span><span> </span><span id="local-6989586621682967180"><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621682967180"><span class="hs-identifier hs-var">range_lo</span></a></span></span><span> </span><span id="local-6989586621682967181"><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621682967181"><span class="hs-identifier hs-var">range_hi</span></a></span></span><span>
</span><span id="line-2051"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621682967180"><span class="hs-identifier hs-var">range_lo</span></a></span><span> </span><span class="annot"><span class="annottext">Discr -&gt; Discr -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621682967181"><span class="hs-identifier hs-var">range_hi</span></a></span><span>
</span><span id="line-2052"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr -&gt; BcM (OrdList BCInstr)
forall a. a -&gt; BcM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Discr, OrdList BCInstr) -&gt; OrdList BCInstr
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">(Discr, OrdList BCInstr)
</span><a href="#local-6989586621682967179"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2053"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
</span><a href="#local-6989586621682967182"><span class="hs-identifier hs-var">defaults</span></a></span><span> </span><span class="hs-comment">-- Note [CASEFAIL]</span><span>
</span><span id="line-2054"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621682967183"><span class="annot"><a href="#local-6989586621682967183"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BcM LocalLabel
</span><a href="GHC.StgToByteCode.html#getLabelBc"><span class="hs-identifier hs-var">getLabelBc</span></a></span><span>
</span><span id="line-2055"></span><span>                 </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682967184"><span class="hs-identifier hs-type">testEQ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fst</span></span><span> </span><span class="annot"><a href="#local-6989586621682967179"><span class="hs-identifier hs-type">val</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682967183"><span class="hs-identifier hs-type">lbl</span></a></span><span>
</span><span id="line-2056"></span><span>                            </span><span class="annot"><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-type">`consOL`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">snd</span></span><span> </span><span class="annot"><a href="#local-6989586621682967179"><span class="hs-identifier hs-type">val</span></a></span><span>
</span><span id="line-2057"></span><span>                            </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.ByteCode.Instr.html#LABEL"><span class="hs-identifier hs-type">LABEL</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682967183"><span class="hs-identifier hs-type">lbl</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-type">`consOL`</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-type">unitOL</span></a></span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html#CASEFAIL"><span class="hs-identifier hs-type">CASEFAIL</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2058"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2059"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr -&gt; BcM (OrdList BCInstr)
forall a. a -&gt; BcM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Discr -&gt; LocalLabel -&gt; BCInstr
</span><a href="#local-6989586621682967184"><span class="hs-identifier hs-var">testEQ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Discr, OrdList BCInstr) -&gt; Discr
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(Discr, OrdList BCInstr)
</span><a href="#local-6989586621682967179"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967175"><span class="hs-identifier hs-var">lbl_default</span></a></span><span> </span><span class="annot"><span class="annottext">BCInstr -&gt; OrdList BCInstr -&gt; OrdList BCInstr
forall a. a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-var">`consOL`</span></a></span><span> </span><span class="annot"><span class="annottext">(Discr, OrdList BCInstr) -&gt; OrdList BCInstr
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">(Discr, OrdList BCInstr)
</span><a href="#local-6989586621682967179"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2060"></span><span>
</span><span id="line-2061"></span><span>            </span><span class="hs-comment">-- Note [CASEFAIL]</span><span>
</span><span id="line-2062"></span><span>            </span><span class="hs-comment">-- ~~~~~~~~~~~~~~~</span><span>
</span><span id="line-2063"></span><span>            </span><span class="hs-comment">-- It may be that this case has no default</span><span>
</span><span id="line-2064"></span><span>            </span><span class="hs-comment">-- branch, but the alternatives are not exhaustive - this</span><span>
</span><span id="line-2065"></span><span>            </span><span class="hs-comment">-- happens for GADT cases for example, where the types</span><span>
</span><span id="line-2066"></span><span>            </span><span class="hs-comment">-- prove that certain branches are impossible.  We could</span><span>
</span><span id="line-2067"></span><span>            </span><span class="hs-comment">-- just assume that the other cases won't occur, but if</span><span>
</span><span id="line-2068"></span><span>            </span><span class="hs-comment">-- this assumption was wrong (because of a bug in GHC)</span><span>
</span><span id="line-2069"></span><span>            </span><span class="hs-comment">-- then the result would be a segfault.  So instead we</span><span>
</span><span id="line-2070"></span><span>            </span><span class="hs-comment">-- emit an explicit test and a CASEFAIL instruction that</span><span>
</span><span id="line-2071"></span><span>            </span><span class="hs-comment">-- causes the interpreter to barf() if it is ever</span><span>
</span><span id="line-2072"></span><span>            </span><span class="hs-comment">-- executed.</span><span>
</span><span id="line-2073"></span><span>
</span><span id="line-2074"></span><span>         </span><span class="annot"><a href="#local-6989586621682967176"><span class="hs-identifier hs-var">mkTree</span></a></span><span> </span><span id="local-6989586621682967185"><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
</span><a href="#local-6989586621682967185"><span class="hs-identifier hs-var">vals</span></a></span></span><span> </span><span id="local-6989586621682967186"><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621682967186"><span class="hs-identifier hs-var">range_lo</span></a></span></span><span> </span><span id="local-6989586621682967187"><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621682967187"><span class="hs-identifier hs-var">range_hi</span></a></span></span><span>
</span><span id="line-2075"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682967188"><span class="annot"><span class="annottext">n :: Int
</span><a href="#local-6989586621682967188"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
</span><a href="#local-6989586621682967185"><span class="hs-identifier hs-var">vals</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-2076"></span><span>                  </span><span class="hs-special">(</span><span id="local-6989586621682967190"><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
</span><a href="#local-6989586621682967190"><span class="hs-identifier hs-var">vals_lo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682967191"><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
</span><a href="#local-6989586621682967191"><span class="hs-identifier hs-var">vals_hi</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; [(Discr, OrdList BCInstr)]
-&gt; ([(Discr, OrdList BCInstr)], [(Discr, OrdList BCInstr)])
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682967188"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
</span><a href="#local-6989586621682967185"><span class="hs-identifier hs-var">vals</span></a></span><span>
</span><span id="line-2077"></span><span>                  </span><span id="local-6989586621682967192"><span class="annot"><span class="annottext">v_mid :: Discr
</span><a href="#local-6989586621682967192"><span class="hs-identifier hs-var hs-var">v_mid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Discr, OrdList BCInstr) -&gt; Discr
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)] -&gt; (Discr, OrdList BCInstr)
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="GHC.Prelude.Basic.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
</span><a href="#local-6989586621682967191"><span class="hs-identifier hs-var">vals_hi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2078"></span><span>              </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2079"></span><span>              </span><span id="local-6989586621682967194"><span class="annot"><a href="#local-6989586621682967194"><span class="hs-identifier hs-var">label_geq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BcM LocalLabel
</span><a href="GHC.StgToByteCode.html#getLabelBc"><span class="hs-identifier hs-var">getLabelBc</span></a></span><span>
</span><span id="line-2080"></span><span>              </span><span id="local-6989586621682967195"><span class="annot"><a href="#local-6989586621682967195"><span class="hs-identifier hs-var">code_lo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682967176"><span class="hs-identifier hs-type">mkTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682967190"><span class="hs-identifier hs-type">vals_lo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682967186"><span class="hs-identifier hs-type">range_lo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682967196"><span class="hs-identifier hs-type">dec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682967192"><span class="hs-identifier hs-type">v_mid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2081"></span><span>              </span><span id="local-6989586621682967197"><span class="annot"><a href="#local-6989586621682967197"><span class="hs-identifier hs-var">code_hi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682967176"><span class="hs-identifier hs-type">mkTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682967191"><span class="hs-identifier hs-type">vals_hi</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682967192"><span class="hs-identifier hs-type">v_mid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682967187"><span class="hs-identifier hs-type">range_hi</span></a></span><span>
</span><span id="line-2082"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682967198"><span class="hs-identifier hs-type">testLT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682967192"><span class="hs-identifier hs-type">v_mid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682967194"><span class="hs-identifier hs-type">label_geq</span></a></span><span>
</span><span id="line-2083"></span><span>                      </span><span class="annot"><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-type">`consOL`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682967195"><span class="hs-identifier hs-type">code_lo</span></a></span><span>
</span><span id="line-2084"></span><span>                      </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span>   </span><span class="annot"><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-type">unitOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.ByteCode.Instr.html#LABEL"><span class="hs-identifier hs-type">LABEL</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682967194"><span class="hs-identifier hs-type">label_geq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2085"></span><span>                      </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span>   </span><span class="annot"><a href="#local-6989586621682967197"><span class="hs-identifier hs-type">code_hi</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2086"></span><span>
</span><span id="line-2087"></span><span>         </span><span id="local-6989586621682967199"><span class="annot"><a href="#local-6989586621682967199"><span class="hs-identifier hs-var hs-var">the_default</span></a></span></span><span>
</span><span id="line-2088"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
</span><a href="#local-6989586621682967182"><span class="hs-identifier hs-var">defaults</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2089"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
forall a. OrdList a
</span><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-var">nilOL</span></a></span><span>
</span><span id="line-2090"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Discr
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682967200"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621682967200"><span class="hs-identifier hs-var">def</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#LABEL"><span class="hs-identifier hs-var">LABEL</span></a></span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967175"><span class="hs-identifier hs-var">lbl_default</span></a></span><span> </span><span class="annot"><span class="annottext">BCInstr -&gt; OrdList BCInstr -&gt; OrdList BCInstr
forall a. a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-var">`consOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621682967200"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-2091"></span><span>                </span><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; OrdList BCInstr
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mkMultiBranch/the_default&quot;</span></span><span>
</span><span id="line-2092"></span><span>     </span><span id="local-6989586621682967201"><span class="annot"><a href="#local-6989586621682967201"><span class="hs-identifier hs-var">instrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682967176"><span class="hs-identifier hs-type">mkTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682967202"><span class="hs-identifier hs-type">notd_ways</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682967203"><span class="hs-identifier hs-type">init_lo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682967204"><span class="hs-identifier hs-type">init_hi</span></a></span><span>
</span><span id="line-2093"></span><span>     </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682967201"><span class="hs-identifier hs-type">instrs</span></a></span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-type">`appOL`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682967199"><span class="hs-identifier hs-type">the_default</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2094"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2095"></span><span>         </span><span class="hs-special">(</span><span id="local-6989586621682967182"><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
</span><a href="#local-6989586621682967182"><span class="hs-identifier hs-var">defaults</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682967205"><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
</span><a href="#local-6989586621682967205"><span class="hs-identifier hs-var">not_defaults</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Discr, OrdList BCInstr) -&gt; Bool)
-&gt; [(Discr, OrdList BCInstr)]
-&gt; ([(Discr, OrdList BCInstr)], [(Discr, OrdList BCInstr)])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">partition</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Discr -&gt; Bool
</span><a href="#local-6989586621682967206"><span class="hs-identifier hs-var">isNoDiscr</span></a></span><span class="annot"><span class="annottext">(Discr -&gt; Bool)
-&gt; ((Discr, OrdList BCInstr) -&gt; Discr)
-&gt; (Discr, OrdList BCInstr)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Discr, OrdList BCInstr) -&gt; Discr
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
</span><a href="#local-6989586621682967174"><span class="hs-identifier hs-var">raw_ways</span></a></span><span>
</span><span id="line-2096"></span><span>         </span><span id="local-6989586621682967202"><span class="annot"><span class="annottext">notd_ways :: [(Discr, OrdList BCInstr)]
</span><a href="#local-6989586621682967202"><span class="hs-identifier hs-var hs-var">notd_ways</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Discr, OrdList BCInstr) -&gt; (Discr, OrdList BCInstr) -&gt; Ordering)
-&gt; [(Discr, OrdList BCInstr)] -&gt; [(Discr, OrdList BCInstr)]
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Discr, OrdList BCInstr) -&gt; Discr)
-&gt; (Discr, OrdList BCInstr) -&gt; (Discr, OrdList BCInstr) -&gt; Ordering
forall a b. Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering
</span><span class="hs-identifier hs-var">comparing</span></span><span> </span><span class="annot"><span class="annottext">(Discr, OrdList BCInstr) -&gt; Discr
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
</span><a href="#local-6989586621682967205"><span class="hs-identifier hs-var">not_defaults</span></a></span><span>
</span><span id="line-2097"></span><span>
</span><span id="line-2098"></span><span>         </span><span id="local-6989586621682967198"><span class="annot"><span class="annottext">testLT :: Discr -&gt; LocalLabel -&gt; BCInstr
</span><a href="#local-6989586621682967198"><span class="hs-identifier hs-var hs-var">testLT</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrI"><span class="hs-identifier hs-type">DiscrI</span></a></span><span> </span><span id="local-6989586621682967232"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682967232"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682967233"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967233"><span class="hs-identifier hs-var">fail_label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTLT_I"><span class="hs-identifier hs-var">TESTLT_I</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682967232"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967233"><span class="hs-identifier hs-var">fail_label</span></a></span><span>
</span><span id="line-2099"></span><span>         </span><span class="annot"><a href="#local-6989586621682967198"><span class="hs-identifier hs-var">testLT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrI8"><span class="hs-identifier hs-type">DiscrI8</span></a></span><span> </span><span id="local-6989586621682967235"><span class="annot"><span class="annottext">Int8
</span><a href="#local-6989586621682967235"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682967236"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967236"><span class="hs-identifier hs-var">fail_label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int8 -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTLT_I8"><span class="hs-identifier hs-var">TESTLT_I8</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int8 -&gt; Int8
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int8
</span><a href="#local-6989586621682967235"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967236"><span class="hs-identifier hs-var">fail_label</span></a></span><span>
</span><span id="line-2100"></span><span>         </span><span class="annot"><a href="#local-6989586621682967198"><span class="hs-identifier hs-var">testLT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrI16"><span class="hs-identifier hs-type">DiscrI16</span></a></span><span> </span><span id="local-6989586621682967238"><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621682967238"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682967239"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967239"><span class="hs-identifier hs-var">fail_label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int16 -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTLT_I16"><span class="hs-identifier hs-var">TESTLT_I16</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int16 -&gt; Int16
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621682967238"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967239"><span class="hs-identifier hs-var">fail_label</span></a></span><span>
</span><span id="line-2101"></span><span>         </span><span class="annot"><a href="#local-6989586621682967198"><span class="hs-identifier hs-var">testLT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrI32"><span class="hs-identifier hs-type">DiscrI32</span></a></span><span> </span><span id="local-6989586621682967241"><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621682967241"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682967242"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967242"><span class="hs-identifier hs-var">fail_label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int32 -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTLT_I32"><span class="hs-identifier hs-var">TESTLT_I32</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int32 -&gt; Int32
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621682967241"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967242"><span class="hs-identifier hs-var">fail_label</span></a></span><span>
</span><span id="line-2102"></span><span>         </span><span class="annot"><a href="#local-6989586621682967198"><span class="hs-identifier hs-var">testLT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrI64"><span class="hs-identifier hs-type">DiscrI64</span></a></span><span> </span><span id="local-6989586621682967244"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621682967244"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682967245"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967245"><span class="hs-identifier hs-var">fail_label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTLT_I64"><span class="hs-identifier hs-var">TESTLT_I64</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64 -&gt; Int64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621682967244"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967245"><span class="hs-identifier hs-var">fail_label</span></a></span><span>
</span><span id="line-2103"></span><span>         </span><span class="annot"><a href="#local-6989586621682967198"><span class="hs-identifier hs-var">testLT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrW"><span class="hs-identifier hs-type">DiscrW</span></a></span><span> </span><span id="local-6989586621682967247"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621682967247"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682967248"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967248"><span class="hs-identifier hs-var">fail_label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTLT_W"><span class="hs-identifier hs-var">TESTLT_W</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621682967247"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967248"><span class="hs-identifier hs-var">fail_label</span></a></span><span>
</span><span id="line-2104"></span><span>         </span><span class="annot"><a href="#local-6989586621682967198"><span class="hs-identifier hs-var">testLT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrW8"><span class="hs-identifier hs-type">DiscrW8</span></a></span><span> </span><span id="local-6989586621682967250"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621682967250"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682967251"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967251"><span class="hs-identifier hs-var">fail_label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTLT_W8"><span class="hs-identifier hs-var">TESTLT_W8</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; Word8
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621682967250"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967251"><span class="hs-identifier hs-var">fail_label</span></a></span><span>
</span><span id="line-2105"></span><span>         </span><span class="annot"><a href="#local-6989586621682967198"><span class="hs-identifier hs-var">testLT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrW16"><span class="hs-identifier hs-type">DiscrW16</span></a></span><span> </span><span id="local-6989586621682967253"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621682967253"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682967254"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967254"><span class="hs-identifier hs-var">fail_label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTLT_W16"><span class="hs-identifier hs-var">TESTLT_W16</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16 -&gt; Word16
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621682967253"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967254"><span class="hs-identifier hs-var">fail_label</span></a></span><span>
</span><span id="line-2106"></span><span>         </span><span class="annot"><a href="#local-6989586621682967198"><span class="hs-identifier hs-var">testLT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrW32"><span class="hs-identifier hs-type">DiscrW32</span></a></span><span> </span><span id="local-6989586621682967256"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682967256"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682967257"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967257"><span class="hs-identifier hs-var">fail_label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTLT_W32"><span class="hs-identifier hs-var">TESTLT_W32</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; Word32
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682967256"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967257"><span class="hs-identifier hs-var">fail_label</span></a></span><span>
</span><span id="line-2107"></span><span>         </span><span class="annot"><a href="#local-6989586621682967198"><span class="hs-identifier hs-var">testLT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrW64"><span class="hs-identifier hs-type">DiscrW64</span></a></span><span> </span><span id="local-6989586621682967259"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682967259"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682967260"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967260"><span class="hs-identifier hs-var">fail_label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTLT_W64"><span class="hs-identifier hs-var">TESTLT_W64</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; Word64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682967259"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967260"><span class="hs-identifier hs-var">fail_label</span></a></span><span>
</span><span id="line-2108"></span><span>         </span><span class="annot"><a href="#local-6989586621682967198"><span class="hs-identifier hs-var">testLT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrF"><span class="hs-identifier hs-type">DiscrF</span></a></span><span> </span><span id="local-6989586621682967262"><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621682967262"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682967263"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967263"><span class="hs-identifier hs-var">fail_label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Float -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTLT_F"><span class="hs-identifier hs-var">TESTLT_F</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621682967262"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967263"><span class="hs-identifier hs-var">fail_label</span></a></span><span>
</span><span id="line-2109"></span><span>         </span><span class="annot"><a href="#local-6989586621682967198"><span class="hs-identifier hs-var">testLT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrD"><span class="hs-identifier hs-type">DiscrD</span></a></span><span> </span><span id="local-6989586621682967265"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621682967265"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682967266"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967266"><span class="hs-identifier hs-var">fail_label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTLT_D"><span class="hs-identifier hs-var">TESTLT_D</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621682967265"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967266"><span class="hs-identifier hs-var">fail_label</span></a></span><span>
</span><span id="line-2110"></span><span>         </span><span class="annot"><a href="#local-6989586621682967198"><span class="hs-identifier hs-var">testLT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrP"><span class="hs-identifier hs-type">DiscrP</span></a></span><span> </span><span id="local-6989586621682967268"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621682967268"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682967269"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967269"><span class="hs-identifier hs-var">fail_label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTLT_P"><span class="hs-identifier hs-var">TESTLT_P</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621682967268"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967269"><span class="hs-identifier hs-var">fail_label</span></a></span><span>
</span><span id="line-2111"></span><span>         </span><span class="annot"><a href="#local-6989586621682967198"><span class="hs-identifier hs-var">testLT</span></a></span><span> </span><span class="annot"><span class="annottext">Discr
</span><a href="GHC.StgToByteCode.html#NoDiscr"><span class="hs-identifier hs-var">NoDiscr</span></a></span><span>    </span><span class="annot"><span class="annottext">LocalLabel
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; BCInstr
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mkMultiBranch NoDiscr&quot;</span></span><span>
</span><span id="line-2112"></span><span>
</span><span id="line-2113"></span><span>         </span><span id="local-6989586621682967184"><span class="annot"><span class="annottext">testEQ :: Discr -&gt; LocalLabel -&gt; BCInstr
</span><a href="#local-6989586621682967184"><span class="hs-identifier hs-var hs-var">testEQ</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrI"><span class="hs-identifier hs-type">DiscrI</span></a></span><span> </span><span id="local-6989586621682967289"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682967289"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682967290"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967290"><span class="hs-identifier hs-var">fail_label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTEQ_I"><span class="hs-identifier hs-var">TESTEQ_I</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682967289"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967290"><span class="hs-identifier hs-var">fail_label</span></a></span><span>
</span><span id="line-2114"></span><span>         </span><span class="annot"><a href="#local-6989586621682967184"><span class="hs-identifier hs-var">testEQ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrI8"><span class="hs-identifier hs-type">DiscrI8</span></a></span><span> </span><span id="local-6989586621682967291"><span class="annot"><span class="annottext">Int8
</span><a href="#local-6989586621682967291"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682967292"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967292"><span class="hs-identifier hs-var">fail_label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int16 -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTEQ_I8"><span class="hs-identifier hs-var">TESTEQ_I8</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int8 -&gt; Int16
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int8
</span><a href="#local-6989586621682967291"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967292"><span class="hs-identifier hs-var">fail_label</span></a></span><span>
</span><span id="line-2115"></span><span>         </span><span class="annot"><a href="#local-6989586621682967184"><span class="hs-identifier hs-var">testEQ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrI16"><span class="hs-identifier hs-type">DiscrI16</span></a></span><span> </span><span id="local-6989586621682967294"><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621682967294"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682967295"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967295"><span class="hs-identifier hs-var">fail_label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int16 -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTEQ_I16"><span class="hs-identifier hs-var">TESTEQ_I16</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int16 -&gt; Int16
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621682967294"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967295"><span class="hs-identifier hs-var">fail_label</span></a></span><span>
</span><span id="line-2116"></span><span>         </span><span class="annot"><a href="#local-6989586621682967184"><span class="hs-identifier hs-var">testEQ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrI32"><span class="hs-identifier hs-type">DiscrI32</span></a></span><span> </span><span id="local-6989586621682967297"><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621682967297"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682967298"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967298"><span class="hs-identifier hs-var">fail_label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int32 -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTEQ_I32"><span class="hs-identifier hs-var">TESTEQ_I32</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int32 -&gt; Int32
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621682967297"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967298"><span class="hs-identifier hs-var">fail_label</span></a></span><span>
</span><span id="line-2117"></span><span>         </span><span class="annot"><a href="#local-6989586621682967184"><span class="hs-identifier hs-var">testEQ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrI64"><span class="hs-identifier hs-type">DiscrI64</span></a></span><span> </span><span id="local-6989586621682967300"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621682967300"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682967301"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967301"><span class="hs-identifier hs-var">fail_label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTEQ_I64"><span class="hs-identifier hs-var">TESTEQ_I64</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64 -&gt; Int64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621682967300"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967301"><span class="hs-identifier hs-var">fail_label</span></a></span><span>
</span><span id="line-2118"></span><span>         </span><span class="annot"><a href="#local-6989586621682967184"><span class="hs-identifier hs-var">testEQ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrW"><span class="hs-identifier hs-type">DiscrW</span></a></span><span> </span><span id="local-6989586621682967303"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621682967303"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682967304"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967304"><span class="hs-identifier hs-var">fail_label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTEQ_W"><span class="hs-identifier hs-var">TESTEQ_W</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621682967303"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967304"><span class="hs-identifier hs-var">fail_label</span></a></span><span>
</span><span id="line-2119"></span><span>         </span><span class="annot"><a href="#local-6989586621682967184"><span class="hs-identifier hs-var">testEQ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrW8"><span class="hs-identifier hs-type">DiscrW8</span></a></span><span> </span><span id="local-6989586621682967306"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621682967306"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682967307"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967307"><span class="hs-identifier hs-var">fail_label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTEQ_W8"><span class="hs-identifier hs-var">TESTEQ_W8</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; Word8
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621682967306"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967307"><span class="hs-identifier hs-var">fail_label</span></a></span><span>
</span><span id="line-2120"></span><span>         </span><span class="annot"><a href="#local-6989586621682967184"><span class="hs-identifier hs-var">testEQ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrW16"><span class="hs-identifier hs-type">DiscrW16</span></a></span><span> </span><span id="local-6989586621682967309"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621682967309"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682967310"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967310"><span class="hs-identifier hs-var">fail_label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTEQ_W16"><span class="hs-identifier hs-var">TESTEQ_W16</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16 -&gt; Word16
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621682967309"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967310"><span class="hs-identifier hs-var">fail_label</span></a></span><span>
</span><span id="line-2121"></span><span>         </span><span class="annot"><a href="#local-6989586621682967184"><span class="hs-identifier hs-var">testEQ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrW32"><span class="hs-identifier hs-type">DiscrW32</span></a></span><span> </span><span id="local-6989586621682967312"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682967312"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682967313"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967313"><span class="hs-identifier hs-var">fail_label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTEQ_W32"><span class="hs-identifier hs-var">TESTEQ_W32</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; Word32
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682967312"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967313"><span class="hs-identifier hs-var">fail_label</span></a></span><span>
</span><span id="line-2122"></span><span>         </span><span class="annot"><a href="#local-6989586621682967184"><span class="hs-identifier hs-var">testEQ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrW64"><span class="hs-identifier hs-type">DiscrW64</span></a></span><span> </span><span id="local-6989586621682967315"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682967315"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682967316"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967316"><span class="hs-identifier hs-var">fail_label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTEQ_W64"><span class="hs-identifier hs-var">TESTEQ_W64</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; Word64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682967315"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967316"><span class="hs-identifier hs-var">fail_label</span></a></span><span>
</span><span id="line-2123"></span><span>         </span><span class="annot"><a href="#local-6989586621682967184"><span class="hs-identifier hs-var">testEQ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrF"><span class="hs-identifier hs-type">DiscrF</span></a></span><span> </span><span id="local-6989586621682967318"><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621682967318"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682967319"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967319"><span class="hs-identifier hs-var">fail_label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Float -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTEQ_F"><span class="hs-identifier hs-var">TESTEQ_F</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621682967318"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967319"><span class="hs-identifier hs-var">fail_label</span></a></span><span>
</span><span id="line-2124"></span><span>         </span><span class="annot"><a href="#local-6989586621682967184"><span class="hs-identifier hs-var">testEQ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrD"><span class="hs-identifier hs-type">DiscrD</span></a></span><span> </span><span id="local-6989586621682967321"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621682967321"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682967322"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967322"><span class="hs-identifier hs-var">fail_label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTEQ_D"><span class="hs-identifier hs-var">TESTEQ_D</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621682967321"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967322"><span class="hs-identifier hs-var">fail_label</span></a></span><span>
</span><span id="line-2125"></span><span>         </span><span class="annot"><a href="#local-6989586621682967184"><span class="hs-identifier hs-var">testEQ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrP"><span class="hs-identifier hs-type">DiscrP</span></a></span><span> </span><span id="local-6989586621682967324"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621682967324"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682967325"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967325"><span class="hs-identifier hs-var">fail_label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTEQ_P"><span class="hs-identifier hs-var">TESTEQ_P</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621682967324"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621682967325"><span class="hs-identifier hs-var">fail_label</span></a></span><span>
</span><span id="line-2126"></span><span>         </span><span class="annot"><a href="#local-6989586621682967184"><span class="hs-identifier hs-var">testEQ</span></a></span><span> </span><span class="annot"><span class="annottext">Discr
</span><a href="GHC.StgToByteCode.html#NoDiscr"><span class="hs-identifier hs-var">NoDiscr</span></a></span><span>    </span><span class="annot"><span class="annottext">LocalLabel
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; BCInstr
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mkMultiBranch NoDiscr&quot;</span></span><span>
</span><span id="line-2127"></span><span>
</span><span id="line-2128"></span><span>         </span><span class="hs-comment">-- None of these will be needed if there are no non-default alts</span><span>
</span><span id="line-2129"></span><span>         </span><span class="hs-special">(</span><span id="local-6989586621682967203"><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621682967203"><span class="hs-identifier hs-var">init_lo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682967204"><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621682967204"><span class="hs-identifier hs-var">init_hi</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
</span><a href="#local-6989586621682967202"><span class="hs-identifier hs-var">notd_ways</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2130"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; (Discr, Discr)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mkMultiBranch: awesome foursome&quot;</span></span><span>
</span><span id="line-2131"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682967327"><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621682967327"><span class="hs-identifier hs-var">discr</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621682967327"><span class="hs-identifier hs-var">discr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2132"></span><span>                </span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrI"><span class="hs-identifier hs-type">DiscrI</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrI"><span class="hs-identifier hs-var">DiscrI</span></a></span><span> </span><span class="annot"><span class="annottext">Int
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">minBound</span></span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">Int -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrI"><span class="hs-identifier hs-var">DiscrI</span></a></span><span> </span><span class="annot"><span class="annottext">Int
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">maxBound</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2133"></span><span>                </span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrI8"><span class="hs-identifier hs-type">DiscrI8</span></a></span><span> </span><span class="annot"><span class="annottext">Int8
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Int8 -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrI8"><span class="hs-identifier hs-var">DiscrI8</span></a></span><span> </span><span class="annot"><span class="annottext">Int8
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">minBound</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int8 -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrI8"><span class="hs-identifier hs-var">DiscrI8</span></a></span><span> </span><span class="annot"><span class="annottext">Int8
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">maxBound</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2134"></span><span>                </span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrI16"><span class="hs-identifier hs-type">DiscrI16</span></a></span><span> </span><span class="annot"><span class="annottext">Int16
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Int16 -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrI16"><span class="hs-identifier hs-var">DiscrI16</span></a></span><span> </span><span class="annot"><span class="annottext">Int16
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">minBound</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int16 -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrI16"><span class="hs-identifier hs-var">DiscrI16</span></a></span><span> </span><span class="annot"><span class="annottext">Int16
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">maxBound</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2135"></span><span>                </span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrI32"><span class="hs-identifier hs-type">DiscrI32</span></a></span><span> </span><span class="annot"><span class="annottext">Int32
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Int32 -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrI32"><span class="hs-identifier hs-var">DiscrI32</span></a></span><span> </span><span class="annot"><span class="annottext">Int32
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">minBound</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int32 -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrI32"><span class="hs-identifier hs-var">DiscrI32</span></a></span><span> </span><span class="annot"><span class="annottext">Int32
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">maxBound</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2136"></span><span>                </span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrI64"><span class="hs-identifier hs-type">DiscrI64</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrI64"><span class="hs-identifier hs-var">DiscrI64</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">minBound</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrI64"><span class="hs-identifier hs-var">DiscrI64</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">maxBound</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2137"></span><span>                </span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrW"><span class="hs-identifier hs-type">DiscrW</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrW"><span class="hs-identifier hs-var">DiscrW</span></a></span><span> </span><span class="annot"><span class="annottext">Word
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">minBound</span></span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">Word -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrW"><span class="hs-identifier hs-var">DiscrW</span></a></span><span> </span><span class="annot"><span class="annottext">Word
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">maxBound</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2138"></span><span>                </span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrW8"><span class="hs-identifier hs-type">DiscrW8</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrW8"><span class="hs-identifier hs-var">DiscrW8</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">minBound</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrW8"><span class="hs-identifier hs-var">DiscrW8</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">maxBound</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2139"></span><span>                </span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrW16"><span class="hs-identifier hs-type">DiscrW16</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrW16"><span class="hs-identifier hs-var">DiscrW16</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">minBound</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrW16"><span class="hs-identifier hs-var">DiscrW16</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">maxBound</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2140"></span><span>                </span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrW32"><span class="hs-identifier hs-type">DiscrW32</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrW32"><span class="hs-identifier hs-var">DiscrW32</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">minBound</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrW32"><span class="hs-identifier hs-var">DiscrW32</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">maxBound</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2141"></span><span>                </span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrW64"><span class="hs-identifier hs-type">DiscrW64</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrW64"><span class="hs-identifier hs-var">DiscrW64</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">minBound</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrW64"><span class="hs-identifier hs-var">DiscrW64</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">maxBound</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2142"></span><span>                </span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrF"><span class="hs-identifier hs-type">DiscrF</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Float -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrF"><span class="hs-identifier hs-var">DiscrF</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621682967330"><span class="hs-identifier hs-var">minF</span></a></span><span class="hs-special">,</span><span>      </span><span class="annot"><span class="annottext">Float -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrF"><span class="hs-identifier hs-var">DiscrF</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621682967331"><span class="hs-identifier hs-var">maxF</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2143"></span><span>                </span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrD"><span class="hs-identifier hs-type">DiscrD</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrD"><span class="hs-identifier hs-var">DiscrD</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621682967332"><span class="hs-identifier hs-var">minD</span></a></span><span class="hs-special">,</span><span>      </span><span class="annot"><span class="annottext">Double -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrD"><span class="hs-identifier hs-var">DiscrD</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621682967333"><span class="hs-identifier hs-var">maxD</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2144"></span><span>                </span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrP"><span class="hs-identifier hs-type">DiscrP</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrP"><span class="hs-identifier hs-var">DiscrP</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621682967334"><span class="hs-identifier hs-var">algMinBound</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrP"><span class="hs-identifier hs-var">DiscrP</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621682967335"><span class="hs-identifier hs-var">algMaxBound</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2145"></span><span>                </span><span class="annot"><span class="annottext">Discr
</span><a href="GHC.StgToByteCode.html#NoDiscr"><span class="hs-identifier hs-var">NoDiscr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; (Discr, Discr)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mkMultiBranch NoDiscr&quot;</span></span><span>
</span><span id="line-2146"></span><span>
</span><span id="line-2147"></span><span>         </span><span class="hs-special">(</span><span id="local-6989586621682967334"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621682967334"><span class="hs-identifier hs-var">algMinBound</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682967335"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621682967335"><span class="hs-identifier hs-var">algMaxBound</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2148"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621682967173"><span class="hs-identifier hs-var">maybe_ncons</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2149"></span><span>                 </span><span class="hs-comment">-- XXX What happens when n == 0?</span><span>
</span><span id="line-2150"></span><span>                 </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682967336"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682967336"><span class="hs-identifier hs-var">n</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word16
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682967336"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Word16 -&gt; Word16
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-2151"></span><span>                 </span><span class="annot"><span class="annottext">Maybe Int
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">minBound</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word16
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">maxBound</span></span><span class="hs-special">)</span><span>
</span><span id="line-2152"></span><span>
</span><span id="line-2153"></span><span>         </span><span id="local-6989586621682967206"><span class="annot"><span class="annottext">isNoDiscr :: Discr -&gt; Bool
</span><a href="#local-6989586621682967206"><span class="hs-identifier hs-var hs-var">isNoDiscr</span></a></span></span><span> </span><span class="annot"><span class="annottext">Discr
</span><a href="GHC.StgToByteCode.html#NoDiscr"><span class="hs-identifier hs-var">NoDiscr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2154"></span><span>         </span><span class="annot"><a href="#local-6989586621682967206"><span class="hs-identifier hs-var">isNoDiscr</span></a></span><span> </span><span class="annot"><span class="annottext">Discr
</span><span class="hs-identifier">_</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2155"></span><span>
</span><span id="line-2156"></span><span>         </span><span id="local-6989586621682967196"><span class="annot"><span class="annottext">dec :: Discr -&gt; Discr
</span><a href="#local-6989586621682967196"><span class="hs-identifier hs-var hs-var">dec</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrI"><span class="hs-identifier hs-type">DiscrI</span></a></span><span> </span><span id="local-6989586621682967343"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682967343"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrI"><span class="hs-identifier hs-var">DiscrI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682967343"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-2157"></span><span>         </span><span class="annot"><a href="#local-6989586621682967196"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrW"><span class="hs-identifier hs-type">DiscrW</span></a></span><span> </span><span id="local-6989586621682967344"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621682967344"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrW"><span class="hs-identifier hs-var">DiscrW</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621682967344"><span class="hs-identifier hs-var">w</span></a></span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-2158"></span><span>         </span><span class="annot"><a href="#local-6989586621682967196"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrP"><span class="hs-identifier hs-type">DiscrP</span></a></span><span> </span><span id="local-6989586621682967345"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621682967345"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrP"><span class="hs-identifier hs-var">DiscrP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621682967345"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Word16 -&gt; Word16 -&gt; Word16
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-2159"></span><span>         </span><span class="annot"><a href="#local-6989586621682967196"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span id="local-6989586621682967346"><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621682967346"><span class="hs-identifier hs-var">other</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621682967346"><span class="hs-identifier hs-var">other</span></a></span><span>         </span><span class="hs-comment">-- not really right, but if you</span><span>
</span><span id="line-2160"></span><span>                </span><span class="hs-comment">-- do cases on floating values, you'll get what you deserve</span><span>
</span><span id="line-2161"></span><span>
</span><span id="line-2162"></span><span>         </span><span class="hs-comment">-- same snotty comment applies to the following</span><span>
</span><span id="line-2163"></span><span>         </span><span class="annot"><a href="#local-6989586621682967330"><span class="hs-identifier hs-type">minF</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682967331"><span class="hs-identifier hs-type">maxF</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span>
</span><span id="line-2164"></span><span>         </span><span class="annot"><a href="#local-6989586621682967332"><span class="hs-identifier hs-type">minD</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682967333"><span class="hs-identifier hs-type">maxD</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-2165"></span><span>         </span><span id="local-6989586621682967330"><span class="annot"><span class="annottext">minF :: Float
</span><a href="#local-6989586621682967330"><span class="hs-identifier hs-var hs-var">minF</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">1.0e37</span></span><span>
</span><span id="line-2166"></span><span>         </span><span id="local-6989586621682967331"><span class="annot"><span class="annottext">maxF :: Float
</span><a href="#local-6989586621682967331"><span class="hs-identifier hs-var hs-var">maxF</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">1.0e37</span></span><span>
</span><span id="line-2167"></span><span>         </span><span id="local-6989586621682967332"><span class="annot"><span class="annottext">minD :: Double
</span><a href="#local-6989586621682967332"><span class="hs-identifier hs-var hs-var">minD</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1.0e308</span></span><span>
</span><span id="line-2168"></span><span>         </span><span id="local-6989586621682967333"><span class="annot"><span class="annottext">maxD :: Double
</span><a href="#local-6989586621682967333"><span class="hs-identifier hs-var hs-var">maxD</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1.0e308</span></span><span>
</span><span id="line-2169"></span><span>
</span><span id="line-2170"></span><span>
</span><span id="line-2171"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-2172"></span><span class="hs-comment">-- Supporting junk for the compilation schemes</span><span>
</span><span id="line-2173"></span><span>
</span><span id="line-2174"></span><span class="hs-comment">-- Describes case alts</span><span>
</span><span id="line-2175"></span><span class="hs-keyword">data</span><span> </span><span id="Discr"><span class="annot"><a href="GHC.StgToByteCode.html#Discr"><span class="hs-identifier hs-var">Discr</span></a></span></span><span>
</span><span id="line-2176"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="DiscrI"><span class="annot"><a href="GHC.StgToByteCode.html#DiscrI"><span class="hs-identifier hs-var">DiscrI</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-2177"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span id="DiscrI8"><span class="annot"><a href="GHC.StgToByteCode.html#DiscrI8"><span class="hs-identifier hs-var">DiscrI8</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int8</span></span><span>
</span><span id="line-2178"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span id="DiscrI16"><span class="annot"><a href="GHC.StgToByteCode.html#DiscrI16"><span class="hs-identifier hs-var">DiscrI16</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int16</span></span><span>
</span><span id="line-2179"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span id="DiscrI32"><span class="annot"><a href="GHC.StgToByteCode.html#DiscrI32"><span class="hs-identifier hs-var">DiscrI32</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int32</span></span><span>
</span><span id="line-2180"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span id="DiscrI64"><span class="annot"><a href="GHC.StgToByteCode.html#DiscrI64"><span class="hs-identifier hs-var">DiscrI64</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int64</span></span><span>
</span><span id="line-2181"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span id="DiscrW"><span class="annot"><a href="GHC.StgToByteCode.html#DiscrW"><span class="hs-identifier hs-var">DiscrW</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span>
</span><span id="line-2182"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span id="DiscrW8"><span class="annot"><a href="GHC.StgToByteCode.html#DiscrW8"><span class="hs-identifier hs-var">DiscrW8</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span>
</span><span id="line-2183"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span id="DiscrW16"><span class="annot"><a href="GHC.StgToByteCode.html#DiscrW16"><span class="hs-identifier hs-var">DiscrW16</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span>
</span><span id="line-2184"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span id="DiscrW32"><span class="annot"><a href="GHC.StgToByteCode.html#DiscrW32"><span class="hs-identifier hs-var">DiscrW32</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word32</span></span><span>
</span><span id="line-2185"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span id="DiscrW64"><span class="annot"><a href="GHC.StgToByteCode.html#DiscrW64"><span class="hs-identifier hs-var">DiscrW64</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-2186"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span id="DiscrF"><span class="annot"><a href="GHC.StgToByteCode.html#DiscrF"><span class="hs-identifier hs-var">DiscrF</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span>
</span><span id="line-2187"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span id="DiscrD"><span class="annot"><a href="GHC.StgToByteCode.html#DiscrD"><span class="hs-identifier hs-var">DiscrD</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-2188"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span id="DiscrP"><span class="annot"><a href="GHC.StgToByteCode.html#DiscrP"><span class="hs-identifier hs-var">DiscrP</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span>
</span><span id="line-2189"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span id="NoDiscr"><span class="annot"><a href="GHC.StgToByteCode.html#NoDiscr"><span class="hs-identifier hs-var">NoDiscr</span></a></span></span><span>
</span><span id="line-2190"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682967348"><span id="local-6989586621682967376"><span class="annot"><span class="annottext">Discr -&gt; Discr -&gt; Bool
(Discr -&gt; Discr -&gt; Bool) -&gt; (Discr -&gt; Discr -&gt; Bool) -&gt; Eq Discr
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Discr -&gt; Discr -&gt; Bool
== :: Discr -&gt; Discr -&gt; Bool
$c/= :: Discr -&gt; Discr -&gt; Bool
/= :: Discr -&gt; Discr -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682967382"><span id="local-6989586621682967417"><span id="local-6989586621682967420"><span id="local-6989586621682967423"><span id="local-6989586621682967426"><span id="local-6989586621682967429"><span id="local-6989586621682967432"><span class="annot"><span class="annottext">Eq Discr
Eq Discr =&gt;
(Discr -&gt; Discr -&gt; Ordering)
-&gt; (Discr -&gt; Discr -&gt; Bool)
-&gt; (Discr -&gt; Discr -&gt; Bool)
-&gt; (Discr -&gt; Discr -&gt; Bool)
-&gt; (Discr -&gt; Discr -&gt; Bool)
-&gt; (Discr -&gt; Discr -&gt; Discr)
-&gt; (Discr -&gt; Discr -&gt; Discr)
-&gt; Ord Discr
Discr -&gt; Discr -&gt; Bool
Discr -&gt; Discr -&gt; Ordering
Discr -&gt; Discr -&gt; Discr
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: Discr -&gt; Discr -&gt; Ordering
compare :: Discr -&gt; Discr -&gt; Ordering
$c&lt; :: Discr -&gt; Discr -&gt; Bool
&lt; :: Discr -&gt; Discr -&gt; Bool
$c&lt;= :: Discr -&gt; Discr -&gt; Bool
&lt;= :: Discr -&gt; Discr -&gt; Bool
$c&gt; :: Discr -&gt; Discr -&gt; Bool
&gt; :: Discr -&gt; Discr -&gt; Bool
$c&gt;= :: Discr -&gt; Discr -&gt; Bool
&gt;= :: Discr -&gt; Discr -&gt; Bool
$cmax :: Discr -&gt; Discr -&gt; Discr
max :: Discr -&gt; Discr -&gt; Discr
$cmin :: Discr -&gt; Discr -&gt; Discr
min :: Discr -&gt; Discr -&gt; Discr
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-2191"></span><span>
</span><span id="line-2192"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#Discr"><span class="hs-identifier hs-type">Discr</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2193"></span><span>   </span><span id="local-6989586621682967476"><span class="annot"><span class="annottext">ppr :: Discr -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrI"><span class="hs-identifier hs-type">DiscrI</span></a></span><span> </span><span id="local-6989586621682967477"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682967477"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc
forall doc. IsLine doc =&gt; Int -&gt; doc
</span><a href="GHC.Utils.Outputable.html#int"><span class="hs-identifier hs-var">int</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682967477"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-2194"></span><span>   </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrI8"><span class="hs-identifier hs-type">DiscrI8</span></a></span><span> </span><span id="local-6989586621682967479"><span class="annot"><span class="annottext">Int8
</span><a href="#local-6989586621682967479"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int8 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int8
</span><a href="#local-6989586621682967479"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2195"></span><span>   </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrI16"><span class="hs-identifier hs-type">DiscrI16</span></a></span><span> </span><span id="local-6989586621682967480"><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621682967480"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int16 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621682967480"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2196"></span><span>   </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrI32"><span class="hs-identifier hs-type">DiscrI32</span></a></span><span> </span><span id="local-6989586621682967481"><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621682967481"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int32 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621682967481"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2197"></span><span>   </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrI64"><span class="hs-identifier hs-type">DiscrI64</span></a></span><span> </span><span id="local-6989586621682967482"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621682967482"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621682967482"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2198"></span><span>   </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrW"><span class="hs-identifier hs-type">DiscrW</span></a></span><span> </span><span id="local-6989586621682967483"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621682967483"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621682967483"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2199"></span><span>   </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrW8"><span class="hs-identifier hs-type">DiscrW8</span></a></span><span> </span><span id="local-6989586621682967484"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621682967484"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621682967484"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2200"></span><span>   </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrW16"><span class="hs-identifier hs-type">DiscrW16</span></a></span><span> </span><span id="local-6989586621682967485"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621682967485"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621682967485"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2201"></span><span>   </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrW32"><span class="hs-identifier hs-type">DiscrW32</span></a></span><span> </span><span id="local-6989586621682967486"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682967486"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682967486"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2202"></span><span>   </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrW64"><span class="hs-identifier hs-type">DiscrW64</span></a></span><span> </span><span id="local-6989586621682967487"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682967487"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682967487"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2203"></span><span>   </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrF"><span class="hs-identifier hs-type">DiscrF</span></a></span><span> </span><span id="local-6989586621682967488"><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621682967488"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Float -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621682967488"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2204"></span><span>   </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrD"><span class="hs-identifier hs-type">DiscrD</span></a></span><span> </span><span id="local-6989586621682967489"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621682967489"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621682967489"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2205"></span><span>   </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrP"><span class="hs-identifier hs-type">DiscrP</span></a></span><span> </span><span id="local-6989586621682967490"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621682967490"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621682967490"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-2206"></span><span>   </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Discr
</span><a href="GHC.StgToByteCode.html#NoDiscr"><span class="hs-identifier hs-var">NoDiscr</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;DEF&quot;</span></span><span>
</span><span id="line-2207"></span><span>
</span><span id="line-2208"></span><span>
</span><span id="line-2209"></span><span class="annot"><a href="GHC.StgToByteCode.html#lookupBCEnv_maybe"><span class="hs-identifier hs-type">lookupBCEnv_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCEnv"><span class="hs-identifier hs-type">BCEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span>
</span><span id="line-2210"></span><span id="lookupBCEnv_maybe"><span class="annot"><span class="annottext">lookupBCEnv_maybe :: Id -&gt; Map Id ByteOff -&gt; Maybe ByteOff
</span><a href="GHC.StgToByteCode.html#lookupBCEnv_maybe"><span class="hs-identifier hs-var hs-var">lookupBCEnv_maybe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Map Id ByteOff -&gt; Maybe ByteOff
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span>
</span><span id="line-2211"></span><span>
</span><span id="line-2212"></span><span class="annot"><a href="GHC.StgToByteCode.html#idSizeW"><span class="hs-identifier hs-type">idSizeW</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a></span><span>
</span><span id="line-2213"></span><span id="idSizeW"><span class="annot"><span class="annottext">idSizeW :: Platform -&gt; Id -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#idSizeW"><span class="hs-identifier hs-var hs-var">idSizeW</span></a></span></span><span> </span><span id="local-6989586621682967491"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682967491"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; WordOff
</span><a href="GHC.ByteCode.Types.html#WordOff"><span class="hs-identifier hs-var">WordOff</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; WordOff) -&gt; (Id -&gt; Int) -&gt; Id -&gt; WordOff
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ArgRep -&gt; Int
</span><a href="GHC.StgToCmm.ArgRep.html#argRepSizeW"><span class="hs-identifier hs-var">argRepSizeW</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682967491"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgRep -&gt; Int) -&gt; (Id -&gt; ArgRep) -&gt; Id -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Id -&gt; ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#idArgRep"><span class="hs-identifier hs-var">idArgRep</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682967491"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-2214"></span><span>
</span><span id="line-2215"></span><span class="annot"><a href="GHC.StgToByteCode.html#idSizeCon"><span class="hs-identifier hs-type">idSizeCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span>
</span><span id="line-2216"></span><span id="idSizeCon"><span class="annot"><span class="annottext">idSizeCon :: Platform -&gt; Id -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#idSizeCon"><span class="hs-identifier hs-var hs-var">idSizeCon</span></a></span></span><span> </span><span id="local-6989586621682967492"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682967492"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621682967493"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682967493"><span class="hs-identifier hs-var">var</span></a></span></span><span>
</span><span id="line-2217"></span><span>  </span><span class="hs-comment">-- unboxed tuple components are padded to word size</span><span>
</span><span id="line-2218"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnboxedTupleType"><span class="hs-identifier hs-var">isUnboxedTupleType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682967493"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span>
</span><span id="line-2219"></span><span>    </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnboxedSumType"><span class="hs-identifier hs-var">isUnboxedSumType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682967493"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2220"></span><span>    </span><span class="annot"><span class="annottext">Platform -&gt; WordOff -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordsToBytes"><span class="hs-identifier hs-var">wordsToBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682967492"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">(WordOff -&gt; ByteOff) -&gt; (Id -&gt; WordOff) -&gt; Id -&gt; ByteOff
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span>
</span><span id="line-2221"></span><span>    </span><span class="annot"><span class="annottext">Int -&gt; WordOff
</span><a href="GHC.ByteCode.Types.html#WordOff"><span class="hs-identifier hs-var">WordOff</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; WordOff) -&gt; (Id -&gt; Int) -&gt; Id -&gt; WordOff
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall a. Num a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">sum</span></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; Int) -&gt; (Id -&gt; [Int]) -&gt; Id -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PrimRep -&gt; Int) -&gt; [PrimRep] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; ArgRep -&gt; Int
</span><a href="GHC.StgToCmm.ArgRep.html#argRepSizeW"><span class="hs-identifier hs-var">argRepSizeW</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682967492"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">(ArgRep -&gt; Int) -&gt; (PrimRep -&gt; ArgRep) -&gt; PrimRep -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; PrimRep -&gt; ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#toArgRep"><span class="hs-identifier hs-var">toArgRep</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682967492"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([PrimRep] -&gt; [Int]) -&gt; (Id -&gt; [PrimRep]) -&gt; Id -&gt; [Int]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span>
</span><span id="line-2222"></span><span>    </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; [PrimRep]
Type -&gt; [PrimRep]
</span><a href="GHC.Types.RepType.html#typePrimRep"><span class="hs-identifier hs-var">typePrimRep</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; [PrimRep]) -&gt; (Id -&gt; Type) -&gt; Id -&gt; [PrimRep]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">(Id -&gt; ByteOff) -&gt; Id -&gt; ByteOff
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682967493"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-2223"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteOff
</span><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-var">ByteOff</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; PrimRep -&gt; Int
</span><a href="GHC.Core.TyCon.html#primRepSizeB"><span class="hs-identifier hs-var">primRepSizeB</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682967492"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; PrimRep
</span><a href="GHC.StgToCmm.Closure.html#idPrimRepU"><span class="hs-identifier hs-var">idPrimRepU</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682967493"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2224"></span><span>
</span><span id="line-2225"></span><span class="annot"><a href="GHC.StgToByteCode.html#repSizeWords"><span class="hs-identifier hs-type">repSizeWords</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#PrimOrVoidRep"><span class="hs-identifier hs-type">PrimOrVoidRep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a></span><span>
</span><span id="line-2226"></span><span id="repSizeWords"><span class="annot"><span class="annottext">repSizeWords :: Platform -&gt; PrimOrVoidRep -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#repSizeWords"><span class="hs-identifier hs-var hs-var">repSizeWords</span></a></span></span><span> </span><span id="local-6989586621682967494"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682967494"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621682967495"><span class="annot"><span class="annottext">PrimOrVoidRep
</span><a href="#local-6989586621682967495"><span class="hs-identifier hs-var">rep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; WordOff
</span><a href="GHC.ByteCode.Types.html#WordOff"><span class="hs-identifier hs-var">WordOff</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; WordOff) -&gt; Int -&gt; WordOff
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ArgRep -&gt; Int
</span><a href="GHC.StgToCmm.ArgRep.html#argRepSizeW"><span class="hs-identifier hs-var">argRepSizeW</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682967494"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; PrimOrVoidRep -&gt; ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#toArgRepOrV"><span class="hs-identifier hs-var">toArgRepOrV</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682967494"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">PrimOrVoidRep
</span><a href="#local-6989586621682967495"><span class="hs-identifier hs-var">rep</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2227"></span><span>
</span><span id="line-2228"></span><span class="annot"><a href="GHC.StgToByteCode.html#isFollowableArg"><span class="hs-identifier hs-type">isFollowableArg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToCmm.ArgRep.html#ArgRep"><span class="hs-identifier hs-type">ArgRep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2229"></span><span id="isFollowableArg"><span class="annot"><span class="annottext">isFollowableArg :: ArgRep -&gt; Bool
</span><a href="GHC.StgToByteCode.html#isFollowableArg"><span class="hs-identifier hs-var hs-var">isFollowableArg</span></a></span></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2230"></span><span class="annot"><a href="GHC.StgToByteCode.html#isFollowableArg"><span class="hs-identifier hs-var">isFollowableArg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2231"></span><span>
</span><span id="line-2232"></span><span class="annot"><span class="hs-comment">-- | Indicate if the calling convention is supported</span></span><span>
</span><span id="line-2233"></span><span class="annot"><a href="GHC.StgToByteCode.html#isSupportedCConv"><span class="hs-identifier hs-type">isSupportedCConv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.ForeignCall.html#CCallSpec"><span class="hs-identifier hs-type">CCallSpec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2234"></span><span id="isSupportedCConv"><span class="annot"><span class="annottext">isSupportedCConv :: CCallSpec -&gt; Bool
</span><a href="GHC.StgToByteCode.html#isSupportedCConv"><span class="hs-identifier hs-var hs-var">isSupportedCConv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.ForeignCall.html#CCallSpec"><span class="hs-identifier hs-type">CCallSpec</span></a></span><span> </span><span class="annot"><span class="annottext">CCallTarget
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682967496"><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621682967496"><span class="hs-identifier hs-var">cconv</span></a></span></span><span> </span><span class="annot"><span class="annottext">Safety
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621682967496"><span class="hs-identifier hs-var">cconv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2235"></span><span>   </span><span class="annot"><span class="annottext">CCallConv
</span><a href="GHC.Types.ForeignCall.html#CCallConv"><span class="hs-identifier hs-var">CCallConv</span></a></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>     </span><span class="hs-comment">-- we explicitly pattern match on every</span><span>
</span><span id="line-2236"></span><span>   </span><span class="annot"><span class="annottext">CCallConv
</span><a href="GHC.Types.ForeignCall.html#StdCallConv"><span class="hs-identifier hs-var">StdCallConv</span></a></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>    </span><span class="hs-comment">-- convention to ensure that a warning</span><span>
</span><span id="line-2237"></span><span>   </span><span class="annot"><span class="annottext">CCallConv
</span><a href="GHC.Types.ForeignCall.html#PrimCallConv"><span class="hs-identifier hs-var">PrimCallConv</span></a></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>     </span><span class="hs-comment">-- is triggered when a new one is added</span><span>
</span><span id="line-2238"></span><span>   </span><span class="annot"><span class="annottext">CCallConv
</span><a href="GHC.Types.ForeignCall.html#JavaScriptCallConv"><span class="hs-identifier hs-var">JavaScriptCallConv</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2239"></span><span>   </span><span class="annot"><span class="annottext">CCallConv
</span><a href="GHC.Types.ForeignCall.html#CApiConv"><span class="hs-identifier hs-var">CApiConv</span></a></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2240"></span><span>
</span><span id="line-2241"></span><span class="hs-comment">-- See bug #10462</span><span>
</span><span id="line-2242"></span><span id="local-6989586621682964984"><span class="annot"><a href="GHC.StgToByteCode.html#unsupportedCConvException"><span class="hs-identifier hs-type">unsupportedCConvException</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621682964984"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2243"></span><span id="unsupportedCConvException"><span class="annot"><span class="annottext">unsupportedCConvException :: forall a. a
</span><a href="GHC.StgToByteCode.html#unsupportedCConvException"><span class="hs-identifier hs-var hs-var">unsupportedCConvException</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GhcException -&gt; a
forall a. GhcException -&gt; a
</span><a href="GHC.Utils.Panic.html#throwGhcException"><span class="hs-identifier hs-var">throwGhcException</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; GhcException
</span><a href="GHC.Utils.Panic.html#ProgramError"><span class="hs-identifier hs-var">ProgramError</span></a></span><span>
</span><span id="line-2244"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Error: bytecode compiler can't handle some foreign calling conventions\n&quot;</span></span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-2245"></span><span>   </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  Workaround: use -fobject-code, or compile this module to .o separately.&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2246"></span><span>
</span><span id="line-2247"></span><span class="annot"><a href="GHC.StgToByteCode.html#mkSlideB"><span class="hs-identifier hs-type">mkSlideB</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html#BCInstr"><span class="hs-identifier hs-type">BCInstr</span></a></span><span>
</span><span id="line-2248"></span><span id="mkSlideB"><span class="annot"><span class="annottext">mkSlideB :: Platform -&gt; ByteOff -&gt; ByteOff -&gt; BCInstr
</span><a href="GHC.StgToByteCode.html#mkSlideB"><span class="hs-identifier hs-var hs-var">mkSlideB</span></a></span></span><span> </span><span id="local-6989586621682967503"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682967503"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621682967504"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967504"><span class="hs-identifier hs-var">nb</span></a></span></span><span> </span><span id="local-6989586621682967505"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967505"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; WordOff -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#SLIDE"><span class="hs-identifier hs-var">SLIDE</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682967506"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682967507"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-2249"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2250"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621682967506"><span class="annot"><span class="annottext">n :: WordOff
</span><a href="#local-6989586621682967506"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#bytesToWords"><span class="hs-identifier hs-var">bytesToWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682967503"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967504"><span class="hs-identifier hs-var">nb</span></a></span><span>
</span><span id="line-2251"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621682967507"><span class="annot"><span class="annottext">d :: WordOff
</span><a href="#local-6989586621682967507"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#bytesToWords"><span class="hs-identifier hs-var">bytesToWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682967503"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967505"><span class="hs-identifier hs-var">db</span></a></span><span>
</span><span id="line-2252"></span><span>
</span><span id="line-2253"></span><span class="annot"><a href="GHC.StgToByteCode.html#mkSlideW"><span class="hs-identifier hs-type">mkSlideW</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#OrdList"><span class="hs-identifier hs-type">OrdList</span></a></span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html#BCInstr"><span class="hs-identifier hs-type">BCInstr</span></a></span><span>
</span><span id="line-2254"></span><span id="mkSlideW"><span class="annot"><span class="annottext">mkSlideW :: WordOff -&gt; WordOff -&gt; OrdList BCInstr
</span><a href="GHC.StgToByteCode.html#mkSlideW"><span class="hs-identifier hs-var hs-var">mkSlideW</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682967508"><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682967508"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682967509"><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682967509"><span class="hs-identifier hs-var">ws</span></a></span></span><span>
</span><span id="line-2255"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682967509"><span class="hs-identifier hs-var">ws</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; WordOff -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><span class="hs-number">0</span></span><span>
</span><span id="line-2256"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
forall a. OrdList a
</span><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-var">nilOL</span></a></span><span>
</span><span id="line-2257"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-2258"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BCInstr -&gt; OrdList BCInstr
forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WordOff -&gt; WordOff -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#SLIDE"><span class="hs-identifier hs-var">SLIDE</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682967508"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">(WordOff -&gt; BCInstr) -&gt; WordOff -&gt; BCInstr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; WordOff
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621682967509"><span class="hs-identifier hs-var">ws</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2259"></span><span>
</span><span id="line-2260"></span><span>
</span><span id="line-2261"></span><span>
</span><span id="line-2262"></span><span class="annot"><a href="GHC.StgToByteCode.html#atomRep"><span class="hs-identifier hs-type">atomRep</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.ArgRep.html#ArgRep"><span class="hs-identifier hs-type">ArgRep</span></a></span><span>
</span><span id="line-2263"></span><span id="atomRep"><span class="annot"><span class="annottext">atomRep :: Platform -&gt; StgArg -&gt; ArgRep
</span><a href="GHC.StgToByteCode.html#atomRep"><span class="hs-identifier hs-var hs-var">atomRep</span></a></span></span><span> </span><span id="local-6989586621682967510"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682967510"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621682967511"><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621682967511"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; PrimOrVoidRep -&gt; ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#toArgRepOrV"><span class="hs-identifier hs-var">toArgRepOrV</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682967510"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StgArg -&gt; PrimOrVoidRep
</span><a href="GHC.Stg.Syntax.html#stgArgRep1"><span class="hs-identifier hs-var">stgArgRep1</span></a></span><span> </span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621682967511"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2264"></span><span>
</span><span id="line-2265"></span><span class="hs-comment">-- | Let szsw be the sizes in bytes of some items pushed onto the stack, which</span><span>
</span><span id="line-2266"></span><span class="hs-comment">-- has initial depth @original_depth@.  Return the values which the stack</span><span>
</span><span id="line-2267"></span><span class="hs-comment">-- environment should map these items to.</span><span>
</span><span id="line-2268"></span><span class="annot"><a href="GHC.StgToByteCode.html#mkStackOffsets"><span class="hs-identifier hs-type">mkStackOffsets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2269"></span><span id="mkStackOffsets"><span class="annot"><span class="annottext">mkStackOffsets :: ByteOff -&gt; [ByteOff] -&gt; [ByteOff]
</span><a href="GHC.StgToByteCode.html#mkStackOffsets"><span class="hs-identifier hs-var hs-var">mkStackOffsets</span></a></span></span><span> </span><span id="local-6989586621682967512"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967512"><span class="hs-identifier hs-var">original_depth</span></a></span></span><span> </span><span id="local-6989586621682967513"><span class="annot"><span class="annottext">[ByteOff]
</span><a href="#local-6989586621682967513"><span class="hs-identifier hs-var">szsb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ByteOff] -&gt; [ByteOff]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><a href="GHC.Prelude.Basic.html#tail"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ByteOff -&gt; ByteOff -&gt; ByteOff)
-&gt; ByteOff -&gt; [ByteOff] -&gt; [ByteOff]
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">scanl'</span></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(+)</span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621682967512"><span class="hs-identifier hs-var">original_depth</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteOff]
</span><a href="#local-6989586621682967513"><span class="hs-identifier hs-var">szsb</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2270"></span><span>
</span><span id="line-2271"></span><span class="annot"><a href="GHC.StgToByteCode.html#typeArgReps"><span class="hs-identifier hs-type">typeArgReps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToCmm.ArgRep.html#ArgRep"><span class="hs-identifier hs-type">ArgRep</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2272"></span><span id="typeArgReps"><span class="annot"><span class="annottext">typeArgReps :: Platform -&gt; Type -&gt; [ArgRep]
</span><a href="GHC.StgToByteCode.html#typeArgReps"><span class="hs-identifier hs-var hs-var">typeArgReps</span></a></span></span><span> </span><span id="local-6989586621682967514"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682967514"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PrimRep -&gt; ArgRep) -&gt; [PrimRep] -&gt; [ArgRep]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; PrimRep -&gt; ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#toArgRep"><span class="hs-identifier hs-var">toArgRep</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682967514"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([PrimRep] -&gt; [ArgRep]) -&gt; (Type -&gt; [PrimRep]) -&gt; Type -&gt; [ArgRep]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; [PrimRep]
Type -&gt; [PrimRep]
</span><a href="GHC.Types.RepType.html#typePrimRep"><span class="hs-identifier hs-var">typePrimRep</span></a></span><span>
</span><span id="line-2273"></span><span>
</span><span id="line-2274"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-2275"></span><span class="hs-comment">-- The bytecode generator's monad</span><span>
</span><span id="line-2276"></span><span>
</span><span id="line-2277"></span><span class="hs-keyword">data</span><span> </span><span id="BcM_State"><span class="annot"><a href="GHC.StgToByteCode.html#BcM_State"><span class="hs-identifier hs-var">BcM_State</span></a></span></span><span>
</span><span id="line-2278"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="BcM_State"><span class="annot"><a href="GHC.StgToByteCode.html#BcM_State"><span class="hs-identifier hs-var">BcM_State</span></a></span></span><span>
</span><span id="line-2279"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="bcm_hsc_env"><span class="annot"><span class="annottext">BcM_State -&gt; HscEnv
</span><a href="GHC.StgToByteCode.html#bcm_hsc_env"><span class="hs-identifier hs-var hs-var">bcm_hsc_env</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-2280"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="thisModule"><span class="annot"><span class="annottext">BcM_State -&gt; Module
</span><a href="GHC.StgToByteCode.html#thisModule"><span class="hs-identifier hs-var hs-var">thisModule</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>          </span><span class="hs-comment">-- current module (for breakpoints)</span><span>
</span><span id="line-2281"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="nextlabel"><span class="annot"><span class="annottext">BcM_State -&gt; Word32
</span><a href="GHC.StgToByteCode.html#nextlabel"><span class="hs-identifier hs-var hs-var">nextlabel</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word32</span></span><span>          </span><span class="hs-comment">-- for generating local labels</span><span>
</span><span id="line-2282"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="ffis"><span class="annot"><span class="annottext">BcM_State -&gt; [FFIInfo]
</span><a href="GHC.StgToByteCode.html#ffis"><span class="hs-identifier hs-var hs-var">ffis</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.ByteCode.Types.html#FFIInfo"><span class="hs-identifier hs-type">FFIInfo</span></a></span><span class="hs-special">]</span><span>       </span><span class="hs-comment">-- ffi info blocks, to free later</span><span>
</span><span id="line-2283"></span><span>                                         </span><span class="hs-comment">-- Should be free()d when it is GCd</span><span>
</span><span id="line-2284"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="modBreaks"><span class="annot"><span class="annottext">BcM_State -&gt; Maybe ModBreaks
</span><a href="GHC.StgToByteCode.html#modBreaks"><span class="hs-identifier hs-var hs-var">modBreaks</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ModBreaks"><span class="hs-identifier hs-type">ModBreaks</span></a></span><span> </span><span class="hs-comment">-- info about breakpoints</span><span>
</span><span id="line-2285"></span><span>
</span><span id="line-2286"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="breakInfo"><span class="annot"><span class="annottext">BcM_State -&gt; IntMap CgBreakInfo
</span><a href="GHC.StgToByteCode.html#breakInfo"><span class="hs-identifier hs-var hs-var">breakInfo</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.IntMap.Internal.html#IntMap"><span class="hs-identifier hs-type">IntMap</span></a></span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#CgBreakInfo"><span class="hs-identifier hs-type">CgBreakInfo</span></a></span><span> </span><span class="hs-comment">-- ^ Info at breakpoint occurrence.</span><span>
</span><span id="line-2287"></span><span>                                            </span><span class="hs-comment">-- Indexed with breakpoint *info* index.</span><span>
</span><span id="line-2288"></span><span>                                            </span><span class="hs-comment">-- See Note [Breakpoint identifiers]</span><span>
</span><span id="line-2289"></span><span>                                            </span><span class="hs-comment">-- in GHC.Types.Breakpoint</span><span>
</span><span id="line-2290"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="breakInfoIdx"><span class="annot"><span class="annottext">BcM_State -&gt; Int
</span><a href="GHC.StgToByteCode.html#breakInfoIdx"><span class="hs-identifier hs-var hs-var">breakInfoIdx</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>              </span><span class="annot"><span class="hs-comment">-- ^ Next index for breakInfo array</span></span><span>
</span><span id="line-2291"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-2292"></span><span>
</span><span id="line-2293"></span><span class="hs-keyword">newtype</span><span> </span><span id="BcM"><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-var">BcM</span></a></span></span><span> </span><span id="local-6989586621682965087"><span class="annot"><a href="#local-6989586621682965087"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="BcM"><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-var">BcM</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#BcM_State"><span class="hs-identifier hs-type">BcM_State</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#BcM_State"><span class="hs-identifier hs-type">BcM_State</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682965087"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682967517"><span id="local-6989586621682967521"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; BcM a -&gt; BcM b)
-&gt; (forall a b. a -&gt; BcM b -&gt; BcM a) -&gt; Functor BcM
forall a b. a -&gt; BcM b -&gt; BcM a
forall a b. (a -&gt; b) -&gt; BcM a -&gt; BcM b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall a b. (a -&gt; b) -&gt; BcM a -&gt; BcM b
fmap :: forall a b. (a -&gt; b) -&gt; BcM a -&gt; BcM b
$c&lt;$ :: forall a b. a -&gt; BcM b -&gt; BcM a
&lt;$ :: forall a b. a -&gt; BcM b -&gt; BcM a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-2294"></span><span>
</span><span id="line-2295"></span><span id="local-6989586621682965061"><span class="annot"><a href="GHC.StgToByteCode.html#ioToBc"><span class="hs-identifier hs-type">ioToBc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682965061"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682965061"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2296"></span><span id="ioToBc"><span class="annot"><span class="annottext">ioToBc :: forall a. IO a -&gt; BcM a
</span><a href="GHC.StgToByteCode.html#ioToBc"><span class="hs-identifier hs-var hs-var">ioToBc</span></a></span></span><span> </span><span id="local-6989586621682967527"><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621682967527"><span class="hs-identifier hs-var">io</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(BcM_State -&gt; IO (BcM_State, a)) -&gt; BcM a
forall r. (BcM_State -&gt; IO (BcM_State, r)) -&gt; BcM r
</span><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-var">BcM</span></a></span><span> </span><span class="annot"><span class="annottext">((BcM_State -&gt; IO (BcM_State, a)) -&gt; BcM a)
-&gt; (BcM_State -&gt; IO (BcM_State, a)) -&gt; BcM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682967528"><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621682967528"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2297"></span><span>  </span><span id="local-6989586621682967529"><span class="annot"><a href="#local-6989586621682967529"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621682967527"><span class="hs-identifier hs-var">io</span></a></span><span>
</span><span id="line-2298"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682967528"><span class="hs-identifier hs-type">st</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682967529"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2299"></span><span>
</span><span id="line-2300"></span><span id="local-6989586621682964830"><span class="annot"><a href="GHC.StgToByteCode.html#runBc"><span class="hs-identifier hs-type">runBc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ModBreaks"><span class="hs-identifier hs-type">ModBreaks</span></a></span><span>
</span><span id="line-2301"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682964830"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-2302"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#BcM_State"><span class="hs-identifier hs-type">BcM_State</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682964830"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-2303"></span><span id="runBc"><span class="annot"><span class="annottext">runBc :: forall r.
HscEnv -&gt; Module -&gt; Maybe ModBreaks -&gt; BcM r -&gt; IO (BcM_State, r)
</span><a href="GHC.StgToByteCode.html#runBc"><span class="hs-identifier hs-var hs-var">runBc</span></a></span></span><span> </span><span id="local-6989586621682967531"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682967531"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682967532"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682967532"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span id="local-6989586621682967533"><span class="annot"><span class="annottext">Maybe ModBreaks
</span><a href="#local-6989586621682967533"><span class="hs-identifier hs-var">modBreaks</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span id="local-6989586621682967534"><span class="annot"><span class="annottext">BcM_State -&gt; IO (BcM_State, r)
</span><a href="#local-6989586621682967534"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2304"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BcM_State -&gt; IO (BcM_State, r)
</span><a href="#local-6989586621682967534"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv
-&gt; Module
-&gt; Word32
-&gt; [FFIInfo]
-&gt; Maybe ModBreaks
-&gt; IntMap CgBreakInfo
-&gt; Int
-&gt; BcM_State
</span><a href="GHC.StgToByteCode.html#BcM_State"><span class="hs-identifier hs-var">BcM_State</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682967531"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682967532"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Maybe ModBreaks
</span><a href="#local-6989586621682967533"><span class="hs-identifier hs-var">modBreaks</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap CgBreakInfo
forall a. IntMap a
</span><a href="../../containers-0.7-5a8f/src/Data.IntMap.Internal.html#empty"><span class="hs-identifier hs-var">IntMap.empty</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-2305"></span><span>
</span><span id="line-2306"></span><span id="local-6989586621682965090"><span id="local-6989586621682965091"><span class="annot"><a href="GHC.StgToByteCode.html#thenBc"><span class="hs-identifier hs-type">thenBc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682965090"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682965090"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682965091"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682965091"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-2307"></span><span id="thenBc"><span class="annot"><span class="annottext">thenBc :: forall a b. BcM a -&gt; (a -&gt; BcM b) -&gt; BcM b
</span><a href="GHC.StgToByteCode.html#thenBc"><span class="hs-identifier hs-var hs-var">thenBc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span id="local-6989586621682967540"><span class="annot"><span class="annottext">BcM_State -&gt; IO (BcM_State, a)
</span><a href="#local-6989586621682967540"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682967541"><span class="annot"><span class="annottext">a -&gt; BcM b
</span><a href="#local-6989586621682967541"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(BcM_State -&gt; IO (BcM_State, b)) -&gt; BcM b
forall r. (BcM_State -&gt; IO (BcM_State, r)) -&gt; BcM r
</span><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-var">BcM</span></a></span><span> </span><span class="annot"><span class="annottext">((BcM_State -&gt; IO (BcM_State, b)) -&gt; BcM b)
-&gt; (BcM_State -&gt; IO (BcM_State, b)) -&gt; BcM b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682967542"><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621682967542"><span class="hs-identifier hs-var">st0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2308"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682967543"><span class="annot"><a href="#local-6989586621682967543"><span class="hs-identifier hs-var">st1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682967544"><span class="annot"><a href="#local-6989586621682967544"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BcM_State -&gt; IO (BcM_State, a)
</span><a href="#local-6989586621682967540"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621682967542"><span class="hs-identifier hs-var">st0</span></a></span><span>
</span><span id="line-2309"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span id="local-6989586621682967545"><span class="annot"><a href="#local-6989586621682967545"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682967541"><span class="hs-identifier hs-type">cont</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682967544"><span class="hs-identifier hs-type">q</span></a></span><span>
</span><span id="line-2310"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682967546"><span class="annot"><a href="#local-6989586621682967546"><span class="hs-identifier hs-var">st2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682967547"><span class="annot"><a href="#local-6989586621682967547"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682967545"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682967543"><span class="hs-identifier hs-type">st1</span></a></span><span>
</span><span id="line-2311"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682967546"><span class="hs-identifier hs-type">st2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682967547"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2312"></span><span>
</span><span id="line-2313"></span><span id="local-6989586621682965094"><span id="local-6989586621682965095"><span class="annot"><a href="GHC.StgToByteCode.html#thenBc_"><span class="hs-identifier hs-type">thenBc_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682965094"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682965095"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682965095"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-2314"></span><span id="thenBc_"><span class="annot"><span class="annottext">thenBc_ :: forall a b. BcM a -&gt; BcM b -&gt; BcM b
</span><a href="GHC.StgToByteCode.html#thenBc_"><span class="hs-identifier hs-var hs-var">thenBc_</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span id="local-6989586621682967552"><span class="annot"><span class="annottext">BcM_State -&gt; IO (BcM_State, a)
</span><a href="#local-6989586621682967552"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span id="local-6989586621682967553"><span class="annot"><span class="annottext">BcM_State -&gt; IO (BcM_State, b)
</span><a href="#local-6989586621682967553"><span class="hs-identifier hs-var">cont</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(BcM_State -&gt; IO (BcM_State, b)) -&gt; BcM b
forall r. (BcM_State -&gt; IO (BcM_State, r)) -&gt; BcM r
</span><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-var">BcM</span></a></span><span> </span><span class="annot"><span class="annottext">((BcM_State -&gt; IO (BcM_State, b)) -&gt; BcM b)
-&gt; (BcM_State -&gt; IO (BcM_State, b)) -&gt; BcM b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682967554"><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621682967554"><span class="hs-identifier hs-var">st0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2315"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682967555"><span class="annot"><a href="#local-6989586621682967555"><span class="hs-identifier hs-var">st1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BcM_State -&gt; IO (BcM_State, a)
</span><a href="#local-6989586621682967552"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621682967554"><span class="hs-identifier hs-var">st0</span></a></span><span>
</span><span id="line-2316"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682967556"><span class="annot"><a href="#local-6989586621682967556"><span class="hs-identifier hs-var">st2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682967557"><span class="annot"><a href="#local-6989586621682967557"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682967553"><span class="hs-identifier hs-type">cont</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682967555"><span class="hs-identifier hs-type">st1</span></a></span><span>
</span><span id="line-2317"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682967556"><span class="hs-identifier hs-type">st2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682967557"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2318"></span><span>
</span><span id="line-2319"></span><span id="local-6989586621682967558"><span class="annot"><a href="GHC.StgToByteCode.html#returnBc"><span class="hs-identifier hs-type">returnBc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621682967558"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682967558"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2320"></span><span id="returnBc"><span class="annot"><span class="annottext">returnBc :: forall a. a -&gt; BcM a
</span><a href="GHC.StgToByteCode.html#returnBc"><span class="hs-identifier hs-var hs-var">returnBc</span></a></span></span><span> </span><span id="local-6989586621682967561"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682967561"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(BcM_State -&gt; IO (BcM_State, a)) -&gt; BcM a
forall r. (BcM_State -&gt; IO (BcM_State, r)) -&gt; BcM r
</span><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-var">BcM</span></a></span><span> </span><span class="annot"><span class="annottext">((BcM_State -&gt; IO (BcM_State, a)) -&gt; BcM a)
-&gt; (BcM_State -&gt; IO (BcM_State, a)) -&gt; BcM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682967562"><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621682967562"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(BcM_State, a) -&gt; IO (BcM_State, a)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621682967562"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682967561"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2321"></span><span>
</span><span id="line-2322"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682967568"><span id="local-6989586621682967572"><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2323"></span><span>    </span><span id="local-6989586621682967575"><span class="annot"><span class="annottext">pure :: forall a. a -&gt; BcM a
</span><span class="hs-identifier hs-var hs-var hs-var">pure</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; BcM a
forall a. a -&gt; BcM a
</span><a href="GHC.StgToByteCode.html#returnBc"><span class="hs-identifier hs-var">returnBc</span></a></span><span>
</span><span id="line-2324"></span><span>    </span><span id="local-6989586621682967577"><span class="annot"><span class="annottext">&lt;*&gt; :: forall a b. BcM (a -&gt; b) -&gt; BcM a -&gt; BcM b
</span><span class="hs-operator hs-var hs-var hs-var">(&lt;*&gt;)</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BcM (a -&gt; b) -&gt; BcM a -&gt; BcM b
forall (m :: * -&gt; *) a b. Monad m =&gt; m (a -&gt; b) -&gt; m a -&gt; m b
</span><span class="hs-identifier hs-var">ap</span></span><span>
</span><span id="line-2325"></span><span>    </span><span id="local-6989586621682967579"><span class="annot"><span class="annottext">*&gt; :: forall a b. BcM a -&gt; BcM b -&gt; BcM b
</span><span class="hs-operator hs-var hs-var hs-var">(*&gt;)</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BcM a -&gt; BcM b -&gt; BcM b
forall a b. BcM a -&gt; BcM b -&gt; BcM b
</span><a href="GHC.StgToByteCode.html#thenBc_"><span class="hs-identifier hs-var">thenBc_</span></a></span><span>
</span><span id="line-2326"></span><span>
</span><span id="line-2327"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682967585"><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2328"></span><span>  </span><span id="local-6989586621682967588"><span class="annot"><span class="annottext">&gt;&gt;= :: forall a b. BcM a -&gt; (a -&gt; BcM b) -&gt; BcM b
</span><span class="hs-operator hs-var hs-var hs-var">(&gt;&gt;=)</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BcM a -&gt; (a -&gt; BcM b) -&gt; BcM b
forall a b. BcM a -&gt; (a -&gt; BcM b) -&gt; BcM b
</span><a href="GHC.StgToByteCode.html#thenBc"><span class="hs-identifier hs-var">thenBc</span></a></span><span>
</span><span id="line-2329"></span><span>  </span><span id="local-6989586621682967590"><span class="annot"><span class="annottext">&gt;&gt; :: forall a b. BcM a -&gt; BcM b -&gt; BcM b
</span><span class="hs-operator hs-var hs-var hs-var">(&gt;&gt;)</span></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BcM a -&gt; BcM b -&gt; BcM b
forall a b. BcM a -&gt; BcM b -&gt; BcM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">(*&gt;)</span></span><span>
</span><span id="line-2330"></span><span>
</span><span id="line-2331"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#HasDynFlags"><span class="hs-identifier hs-type">HasDynFlags</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2332"></span><span>    </span><span id="local-6989586621682967594"><span class="annot"><span class="annottext">getDynFlags :: BcM DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var hs-var hs-var">getDynFlags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(BcM_State -&gt; IO (BcM_State, DynFlags)) -&gt; BcM DynFlags
forall r. (BcM_State -&gt; IO (BcM_State, r)) -&gt; BcM r
</span><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-var">BcM</span></a></span><span> </span><span class="annot"><span class="annottext">((BcM_State -&gt; IO (BcM_State, DynFlags)) -&gt; BcM DynFlags)
-&gt; (BcM_State -&gt; IO (BcM_State, DynFlags)) -&gt; BcM DynFlags
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682967595"><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621682967595"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(BcM_State, DynFlags) -&gt; IO (BcM_State, DynFlags)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621682967595"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BcM_State -&gt; HscEnv
</span><a href="GHC.StgToByteCode.html#bcm_hsc_env"><span class="hs-identifier hs-var">bcm_hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621682967595"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2333"></span><span>
</span><span id="line-2334"></span><span class="annot"><a href="GHC.StgToByteCode.html#getHscEnv"><span class="hs-identifier hs-type">getHscEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-2335"></span><span id="getHscEnv"><span class="annot"><span class="annottext">getHscEnv :: BcM HscEnv
</span><a href="GHC.StgToByteCode.html#getHscEnv"><span class="hs-identifier hs-var hs-var">getHscEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(BcM_State -&gt; IO (BcM_State, HscEnv)) -&gt; BcM HscEnv
forall r. (BcM_State -&gt; IO (BcM_State, r)) -&gt; BcM r
</span><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-var">BcM</span></a></span><span> </span><span class="annot"><span class="annottext">((BcM_State -&gt; IO (BcM_State, HscEnv)) -&gt; BcM HscEnv)
-&gt; (BcM_State -&gt; IO (BcM_State, HscEnv)) -&gt; BcM HscEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682967596"><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621682967596"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(BcM_State, HscEnv) -&gt; IO (BcM_State, HscEnv)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621682967596"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BcM_State -&gt; HscEnv
</span><a href="GHC.StgToByteCode.html#bcm_hsc_env"><span class="hs-identifier hs-var">bcm_hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621682967596"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2336"></span><span>
</span><span id="line-2337"></span><span class="annot"><a href="GHC.StgToByteCode.html#getProfile"><span class="hs-identifier hs-type">getProfile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.Platform.Profile.html#Profile"><span class="hs-identifier hs-type">Profile</span></a></span><span>
</span><span id="line-2338"></span><span id="getProfile"><span class="annot"><span class="annottext">getProfile :: BcM Profile
</span><a href="GHC.StgToByteCode.html#getProfile"><span class="hs-identifier hs-var hs-var">getProfile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Profile
</span><a href="GHC.Driver.DynFlags.html#targetProfile"><span class="hs-identifier hs-var">targetProfile</span></a></span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; Profile) -&gt; BcM DynFlags -&gt; BcM Profile
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">BcM DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-2339"></span><span>
</span><span id="line-2340"></span><span class="annot"><a href="GHC.StgToByteCode.html#emitBc"><span class="hs-identifier hs-type">emitBc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.ByteCode.Types.html#FFIInfo"><span class="hs-identifier hs-type">FFIInfo</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html#ProtoBCO"><span class="hs-identifier hs-type">ProtoBCO</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.ByteCode.Instr.html#ProtoBCO"><span class="hs-identifier hs-type">ProtoBCO</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2341"></span><span id="emitBc"><span class="annot"><span class="annottext">emitBc :: ([FFIInfo] -&gt; ProtoBCO Name) -&gt; BcM (ProtoBCO Name)
</span><a href="GHC.StgToByteCode.html#emitBc"><span class="hs-identifier hs-var hs-var">emitBc</span></a></span></span><span> </span><span id="local-6989586621682967597"><span class="annot"><span class="annottext">[FFIInfo] -&gt; ProtoBCO Name
</span><a href="#local-6989586621682967597"><span class="hs-identifier hs-var">bco</span></a></span></span><span>
</span><span id="line-2342"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(BcM_State -&gt; IO (BcM_State, ProtoBCO Name)) -&gt; BcM (ProtoBCO Name)
forall r. (BcM_State -&gt; IO (BcM_State, r)) -&gt; BcM r
</span><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-var">BcM</span></a></span><span> </span><span class="annot"><span class="annottext">((BcM_State -&gt; IO (BcM_State, ProtoBCO Name))
 -&gt; BcM (ProtoBCO Name))
-&gt; (BcM_State -&gt; IO (BcM_State, ProtoBCO Name))
-&gt; BcM (ProtoBCO Name)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682967598"><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621682967598"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(BcM_State, ProtoBCO Name) -&gt; IO (BcM_State, ProtoBCO Name)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621682967598"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">{</span><span class="annot"><a href="GHC.StgToByteCode.html#ffis"><span class="hs-identifier hs-var">ffis</span></a></span><span class="hs-glyph">=</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[FFIInfo] -&gt; ProtoBCO Name
</span><a href="#local-6989586621682967597"><span class="hs-identifier hs-var">bco</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BcM_State -&gt; [FFIInfo]
</span><a href="GHC.StgToByteCode.html#ffis"><span class="hs-identifier hs-var">ffis</span></a></span><span> </span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621682967598"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2343"></span><span>
</span><span id="line-2344"></span><span class="annot"><a href="GHC.StgToByteCode.html#recordFFIBc"><span class="hs-identifier hs-type">recordFFIBc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.RemoteTypes.html#RemotePtr"><span class="hs-identifier hs-type">RemotePtr</span></a></span><span> </span><span class="annot"><a href="../../ghci-9.12.2-bd10/src/GHCi.FFI.html#C_ffi_cif"><span class="hs-identifier hs-type">C_ffi_cif</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2345"></span><span id="recordFFIBc"><span class="annot"><span class="annottext">recordFFIBc :: RemotePtr C_ffi_cif -&gt; BcM ()
</span><a href="GHC.StgToByteCode.html#recordFFIBc"><span class="hs-identifier hs-var hs-var">recordFFIBc</span></a></span></span><span> </span><span id="local-6989586621682967599"><span class="annot"><span class="annottext">RemotePtr C_ffi_cif
</span><a href="#local-6989586621682967599"><span class="hs-identifier hs-var">a</span></a></span></span><span>
</span><span id="line-2346"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(BcM_State -&gt; IO (BcM_State, ())) -&gt; BcM ()
forall r. (BcM_State -&gt; IO (BcM_State, r)) -&gt; BcM r
</span><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-var">BcM</span></a></span><span> </span><span class="annot"><span class="annottext">((BcM_State -&gt; IO (BcM_State, ())) -&gt; BcM ())
-&gt; (BcM_State -&gt; IO (BcM_State, ())) -&gt; BcM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682967600"><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621682967600"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(BcM_State, ()) -&gt; IO (BcM_State, ())
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621682967600"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">{</span><span class="annot"><a href="GHC.StgToByteCode.html#ffis"><span class="hs-identifier hs-var">ffis</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#FFIInfo"><span class="hs-identifier hs-type">FFIInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682967599"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#ffis"><span class="hs-identifier hs-var">ffis</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682967600"><span class="hs-identifier hs-type">st</span></a></span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2347"></span><span>
</span><span id="line-2348"></span><span class="annot"><a href="GHC.StgToByteCode.html#getLabelBc"><span class="hs-identifier hs-type">getLabelBc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html#LocalLabel"><span class="hs-identifier hs-type">LocalLabel</span></a></span><span>
</span><span id="line-2349"></span><span id="getLabelBc"><span class="annot"><span class="annottext">getLabelBc :: BcM LocalLabel
</span><a href="GHC.StgToByteCode.html#getLabelBc"><span class="hs-identifier hs-var hs-var">getLabelBc</span></a></span></span><span>
</span><span id="line-2350"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(BcM_State -&gt; IO (BcM_State, LocalLabel)) -&gt; BcM LocalLabel
forall r. (BcM_State -&gt; IO (BcM_State, r)) -&gt; BcM r
</span><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-var">BcM</span></a></span><span> </span><span class="annot"><span class="annottext">((BcM_State -&gt; IO (BcM_State, LocalLabel)) -&gt; BcM LocalLabel)
-&gt; (BcM_State -&gt; IO (BcM_State, LocalLabel)) -&gt; BcM LocalLabel
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682967602"><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621682967602"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682967603"><span class="annot"><span class="annottext">nl :: Word32
</span><a href="#local-6989586621682967603"><span class="hs-identifier hs-var hs-var hs-var">nl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BcM_State -&gt; Word32
</span><a href="GHC.StgToByteCode.html#nextlabel"><span class="hs-identifier hs-var">nextlabel</span></a></span><span> </span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621682967602"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-2351"></span><span>                    </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682967603"><span class="hs-identifier hs-var">nl</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Word32
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">maxBound</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2352"></span><span>                        </span><span class="annot"><span class="annottext">String -&gt; IO ()
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getLabelBc: Ran out of labels&quot;</span></span><span>
</span><span id="line-2353"></span><span>                    </span><span class="annot"><span class="annottext">(BcM_State, LocalLabel) -&gt; IO (BcM_State, LocalLabel)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621682967602"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">{</span><span class="annot"><a href="GHC.StgToByteCode.html#nextlabel"><span class="hs-identifier hs-var">nextlabel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682967603"><span class="hs-identifier hs-type">nl</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; LocalLabel
</span><a href="GHC.ByteCode.Instr.html#LocalLabel"><span class="hs-identifier hs-var">LocalLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682967603"><span class="hs-identifier hs-var">nl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2354"></span><span>
</span><span id="line-2355"></span><span class="annot"><a href="GHC.StgToByteCode.html#getLabelsBc"><span class="hs-identifier hs-type">getLabelsBc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word32</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.ByteCode.Instr.html#LocalLabel"><span class="hs-identifier hs-type">LocalLabel</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2356"></span><span id="getLabelsBc"><span class="annot"><span class="annottext">getLabelsBc :: Word32 -&gt; BcM [LocalLabel]
</span><a href="GHC.StgToByteCode.html#getLabelsBc"><span class="hs-identifier hs-var hs-var">getLabelsBc</span></a></span></span><span> </span><span id="local-6989586621682967605"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682967605"><span class="hs-identifier hs-var">n</span></a></span></span><span>
</span><span id="line-2357"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(BcM_State -&gt; IO (BcM_State, [LocalLabel])) -&gt; BcM [LocalLabel]
forall r. (BcM_State -&gt; IO (BcM_State, r)) -&gt; BcM r
</span><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-var">BcM</span></a></span><span> </span><span class="annot"><span class="annottext">((BcM_State -&gt; IO (BcM_State, [LocalLabel])) -&gt; BcM [LocalLabel])
-&gt; (BcM_State -&gt; IO (BcM_State, [LocalLabel])) -&gt; BcM [LocalLabel]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682967606"><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621682967606"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682967607"><span class="annot"><span class="annottext">ctr :: Word32
</span><a href="#local-6989586621682967607"><span class="hs-identifier hs-var hs-var">ctr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BcM_State -&gt; Word32
</span><a href="GHC.StgToByteCode.html#nextlabel"><span class="hs-identifier hs-var">nextlabel</span></a></span><span> </span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621682967606"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-2358"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(BcM_State, [LocalLabel]) -&gt; IO (BcM_State, [LocalLabel])
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621682967606"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">{</span><span class="annot"><a href="GHC.StgToByteCode.html#nextlabel"><span class="hs-identifier hs-var">nextlabel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682967607"><span class="hs-identifier hs-type">ctr</span></a></span><span class="annot"><span class="hs-operator hs-type">+</span></span><span class="annot"><a href="#local-6989586621682967605"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Word32] -&gt; [LocalLabel]
forall a b. Coercible a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">coerce</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682967607"><span class="hs-identifier hs-var">ctr</span></a></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682967607"><span class="hs-identifier hs-var">ctr</span></a></span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Word32
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682967605"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Word32
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2359"></span><span>
</span><span id="line-2360"></span><span class="annot"><a href="GHC.StgToByteCode.html#newBreakInfo"><span class="hs-identifier hs-type">newBreakInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#CgBreakInfo"><span class="hs-identifier hs-type">CgBreakInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-2361"></span><span id="newBreakInfo"><span class="annot"><span class="annottext">newBreakInfo :: CgBreakInfo -&gt; BcM Int
</span><a href="GHC.StgToByteCode.html#newBreakInfo"><span class="hs-identifier hs-var hs-var">newBreakInfo</span></a></span></span><span> </span><span id="local-6989586621682967608"><span class="annot"><span class="annottext">CgBreakInfo
</span><a href="#local-6989586621682967608"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(BcM_State -&gt; IO (BcM_State, Int)) -&gt; BcM Int
forall r. (BcM_State -&gt; IO (BcM_State, r)) -&gt; BcM r
</span><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-var">BcM</span></a></span><span> </span><span class="annot"><span class="annottext">((BcM_State -&gt; IO (BcM_State, Int)) -&gt; BcM Int)
-&gt; (BcM_State -&gt; IO (BcM_State, Int)) -&gt; BcM Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682967609"><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621682967609"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2362"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682967610"><span class="annot"><span class="annottext">ix :: Int
</span><a href="#local-6989586621682967610"><span class="hs-identifier hs-var hs-var">ix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BcM_State -&gt; Int
</span><a href="GHC.StgToByteCode.html#breakInfoIdx"><span class="hs-identifier hs-var">breakInfoIdx</span></a></span><span> </span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621682967609"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-2363"></span><span>      </span><span id="local-6989586621682967611"><span class="annot"><span class="annottext">st' :: BcM_State
</span><a href="#local-6989586621682967611"><span class="hs-identifier hs-var hs-var">st'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621682967609"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-2364"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#breakInfo"><span class="hs-identifier hs-var">breakInfo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.IntMap.Internal.html#insert"><span class="hs-identifier hs-type">IntMap.insert</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682967610"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682967608"><span class="hs-identifier hs-type">info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#breakInfo"><span class="hs-identifier hs-var">breakInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682967609"><span class="hs-identifier hs-type">st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2365"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#breakInfoIdx"><span class="hs-identifier hs-var">breakInfoIdx</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682967610"><span class="hs-identifier hs-type">ix</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span>
</span><span id="line-2366"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-2367"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(BcM_State, Int) -&gt; IO (BcM_State, Int)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621682967611"><span class="hs-identifier hs-var">st'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682967610"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2368"></span><span>
</span><span id="line-2369"></span><span class="annot"><a href="GHC.StgToByteCode.html#getCurrentModule"><span class="hs-identifier hs-type">getCurrentModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-2370"></span><span id="getCurrentModule"><span class="annot"><span class="annottext">getCurrentModule :: BcM Module
</span><a href="GHC.StgToByteCode.html#getCurrentModule"><span class="hs-identifier hs-var hs-var">getCurrentModule</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(BcM_State -&gt; IO (BcM_State, Module)) -&gt; BcM Module
forall r. (BcM_State -&gt; IO (BcM_State, r)) -&gt; BcM r
</span><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-var">BcM</span></a></span><span> </span><span class="annot"><span class="annottext">((BcM_State -&gt; IO (BcM_State, Module)) -&gt; BcM Module)
-&gt; (BcM_State -&gt; IO (BcM_State, Module)) -&gt; BcM Module
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682967613"><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621682967613"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(BcM_State, Module) -&gt; IO (BcM_State, Module)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621682967613"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BcM_State -&gt; Module
</span><a href="GHC.StgToByteCode.html#thisModule"><span class="hs-identifier hs-var">thisModule</span></a></span><span> </span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621682967613"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2371"></span><span>
</span><span id="line-2372"></span><span class="annot"><a href="GHC.StgToByteCode.html#getCurrentModBreaks"><span class="hs-identifier hs-type">getCurrentModBreaks</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ModBreaks"><span class="hs-identifier hs-type">ModBreaks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2373"></span><span id="getCurrentModBreaks"><span class="annot"><span class="annottext">getCurrentModBreaks :: BcM (Maybe ModBreaks)
</span><a href="GHC.StgToByteCode.html#getCurrentModBreaks"><span class="hs-identifier hs-var hs-var">getCurrentModBreaks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(BcM_State -&gt; IO (BcM_State, Maybe ModBreaks))
-&gt; BcM (Maybe ModBreaks)
forall r. (BcM_State -&gt; IO (BcM_State, r)) -&gt; BcM r
</span><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-var">BcM</span></a></span><span> </span><span class="annot"><span class="annottext">((BcM_State -&gt; IO (BcM_State, Maybe ModBreaks))
 -&gt; BcM (Maybe ModBreaks))
-&gt; (BcM_State -&gt; IO (BcM_State, Maybe ModBreaks))
-&gt; BcM (Maybe ModBreaks)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682967614"><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621682967614"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(BcM_State, Maybe ModBreaks) -&gt; IO (BcM_State, Maybe ModBreaks)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621682967614"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BcM_State -&gt; Maybe ModBreaks
</span><a href="GHC.StgToByteCode.html#modBreaks"><span class="hs-identifier hs-var">modBreaks</span></a></span><span> </span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621682967614"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2374"></span><span>
</span><span id="line-2375"></span><span class="annot"><a href="GHC.StgToByteCode.html#tickFS"><span class="hs-identifier hs-type">tickFS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-2376"></span><span id="tickFS"><span class="annot"><span class="annottext">tickFS :: FastString
</span><a href="GHC.StgToByteCode.html#tickFS"><span class="hs-identifier hs-var hs-var">tickFS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ticked&quot;</span></span><span>
</span><span id="line-2377"></span></pre></body></html>