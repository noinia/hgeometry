<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE MultiWayIf #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-incomplete-uni-patterns #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html"><span class="hs-identifier">GHC.Tc.Instance.Class</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-5"></span><span>     </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#matchGlobalInst"><span class="hs-identifier">matchGlobalInst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#matchEqualityInst"><span class="hs-identifier">matchEqualityInst</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-6"></span><span>     </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#ClsInstResult"><span class="hs-identifier">ClsInstResult</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-7"></span><span>     </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#InstanceWhat"><span class="hs-identifier">InstanceWhat</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#safeOverlap"><span class="hs-identifier">safeOverlap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#instanceReturnsDictCon"><span class="hs-identifier">instanceReturnsDictCon</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>     </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#AssocInstInfo"><span class="hs-identifier">AssocInstInfo</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#isNotAssociated"><span class="hs-identifier">isNotAssociated</span></a></span><span>
</span><span id="line-9"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html"><span class="hs-identifier">GHC.Driver.DynFlags</span></a></span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html"><span class="hs-identifier">GHC.Core.TyCo.Rep</span></a></span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html"><span class="hs-identifier">GHC.Tc.Utils.Env</span></a></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html"><span class="hs-identifier">GHC.Tc.Utils.Instantiate</span></a></span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#instDFunType"><span class="hs-identifier">instDFunType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcInstType"><span class="hs-identifier">tcInstType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Typeable.html"><span class="hs-identifier">GHC.Tc.Instance.Typeable</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html"><span class="hs-identifier">GHC.Tc.Utils.TcMType</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html"><span class="hs-identifier">GHC.Tc.Types.Evidence</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html"><span class="hs-identifier">GHC.Tc.Types.Origin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#InstanceWhat"><span class="hs-identifier">InstanceWhat</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SafeOverlapping"><span class="hs-identifier">SafeOverlapping</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html"><span class="hs-identifier">GHC.Tc.Instance.Family</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html#tcGetFamInstEnvs"><span class="hs-identifier">tcGetFamInstEnvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html#tcInstNewTyCon_maybe"><span class="hs-identifier">tcInstNewTyCon_maybe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html#tcLookupDataFamInst"><span class="hs-identifier">tcLookupDataFamInst</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html"><span class="hs-identifier">GHC.Rename.Env</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#addUsedGRE"><span class="hs-identifier">addUsedGRE</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#addUsedDataCons"><span class="hs-identifier">addUsedDataCons</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#DeprecationWarnings"><span class="hs-identifier">DeprecationWarnings</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html"><span class="hs-identifier">GHC.Builtin.Types</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.Prim.html"><span class="hs-identifier">GHC.Builtin.Types.Prim</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.PrimOps.html"><span class="hs-identifier">GHC.Builtin.PrimOps</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Builtin.PrimOps.html#PrimOp"><span class="hs-identifier">PrimOp</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.PrimOps.Ids.html"><span class="hs-identifier">GHC.Builtin.PrimOps.Ids</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Builtin.PrimOps.Ids.html#primOpId"><span class="hs-identifier">primOpId</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.FieldLabel.html"><span class="hs-identifier">GHC.Types.FieldLabel</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html"><span class="hs-identifier">GHC.Types.Name.Reader</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SafeHaskell.html"><span class="hs-identifier">GHC.Types.SafeHaskell</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier">Name</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html"><span class="hs-identifier">GHC.Types.Var.Env</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#VarEnv"><span class="hs-identifier">VarEnv</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.html"><span class="hs-identifier">GHC.Types.Var</span></a></span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html"><span class="hs-identifier">GHC.Core.Predicate</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html"><span class="hs-identifier">GHC.Core.Coercion</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html"><span class="hs-identifier">GHC.Core.InstEnv</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Make.html"><span class="hs-identifier">GHC.Core.Make</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Make.html#mkCharExpr"><span class="hs-identifier">mkCharExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Make.html#mkNaturalExpr"><span class="hs-identifier">mkNaturalExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Make.html#mkStringExprFS"><span class="hs-identifier">mkStringExprFS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Make.html#mkCoreLams"><span class="hs-identifier">mkCoreLams</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Class.html"><span class="hs-identifier">GHC.Core.Class</span></a></span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.html"><span class="hs-identifier">GHC.Core</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.html#Expr"><span class="hs-identifier">Expr</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Closure.html"><span class="hs-identifier">GHC.StgToCmm.Closure</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Closure.html#isSmallFamily"><span class="hs-identifier">isSmallFamily</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#splitAtList"><span class="hs-identifier">splitAtList</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#fstOf3"><span class="hs-identifier">fstOf3</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Warnings.html"><span class="hs-identifier">GHC.Unit.Module.Warnings</span></a></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html"><span class="hs-identifier">GHC.Hs.Extension</span></a></span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html"><span class="hs-identifier">Language.Haskell.Syntax.Basic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#FieldLabelString"><span class="hs-identifier">FieldLabelString</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html"><span class="hs-identifier">GHC.Types.Id.Info</span></a></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html"><span class="hs-identifier">GHC.Tc.Errors.Types</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Functor.html"><span class="hs-identifier">Data.Functor</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="annot"><span class="hs-comment">{- *******************************************************************
*                                                                    *
              A helper for associated types within
              class instance declarations
*                                                                    *
**********************************************************************-}</span></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-comment">-- | Extra information about the parent instance declaration, needed</span><span>
</span><span id="line-80"></span><span class="hs-comment">-- when type-checking associated types. The 'Class' is the enclosing</span><span>
</span><span id="line-81"></span><span class="hs-comment">-- class, the [TyVar] are the /scoped/ type variable of the instance decl.</span><span>
</span><span id="line-82"></span><span class="hs-comment">-- The @VarEnv Type@ maps class variables to their instance types.</span><span>
</span><span id="line-83"></span><span class="hs-keyword">data</span><span> </span><span id="AssocInstInfo"><span class="annot"><a href="GHC.Tc.Instance.Class.html#AssocInstInfo"><span class="hs-identifier hs-var">AssocInstInfo</span></a></span></span><span>
</span><span id="line-84"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="NotAssociated"><span class="annot"><a href="GHC.Tc.Instance.Class.html#NotAssociated"><span class="hs-identifier hs-var">NotAssociated</span></a></span></span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="InClsInst"><span class="annot"><a href="GHC.Tc.Instance.Class.html#InClsInst"><span class="hs-identifier hs-var">InClsInst</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="ai_class"><span class="annot"><span class="annottext">AssocInstInfo -&gt; Class
</span><a href="GHC.Tc.Instance.Class.html#ai_class"><span class="hs-identifier hs-var hs-var">ai_class</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span>
</span><span id="line-86"></span><span>              </span><span class="hs-special">,</span><span> </span><span id="ai_tyvars"><span class="annot"><span class="annottext">AssocInstInfo -&gt; [DFunId]
</span><a href="GHC.Tc.Instance.Class.html#ai_tyvars"><span class="hs-identifier hs-var hs-var">ai_tyvars</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span>      </span><span class="hs-comment">-- ^ The /scoped/ tyvars of the instance</span><span>
</span><span id="line-87"></span><span>                                            </span><span class="hs-comment">-- Why scoped?  See bind_me in</span><span>
</span><span id="line-88"></span><span>                                            </span><span class="hs-comment">-- 'GHC.Tc.Validity.checkConsistentFamInst'</span><span>
</span><span id="line-89"></span><span>              </span><span class="hs-special">,</span><span> </span><span id="ai_inst_env"><span class="annot"><span class="annottext">AssocInstInfo -&gt; VarEnv PredType
</span><a href="GHC.Tc.Instance.Class.html#ai_inst_env"><span class="hs-identifier hs-var hs-var">ai_inst_env</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#VarEnv"><span class="hs-identifier hs-type">VarEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>  </span><span class="hs-comment">-- ^ Maps /class/ tyvars to their instance types</span><span>
</span><span id="line-90"></span><span>                </span><span class="hs-comment">-- See Note [Matching in the consistent-instantiation check]</span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="annot"><a href="GHC.Tc.Instance.Class.html#isNotAssociated"><span class="hs-identifier hs-type">isNotAssociated</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#AssocInstInfo"><span class="hs-identifier hs-type">AssocInstInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-94"></span><span id="isNotAssociated"><span class="annot"><span class="annottext">isNotAssociated :: AssocInstInfo -&gt; Bool
</span><a href="GHC.Tc.Instance.Class.html#isNotAssociated"><span class="hs-identifier hs-var hs-var">isNotAssociated</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Instance.Class.html#NotAssociated"><span class="hs-identifier hs-type">NotAssociated</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-95"></span><span class="annot"><a href="GHC.Tc.Instance.Class.html#isNotAssociated"><span class="hs-identifier hs-var">isNotAssociated</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Instance.Class.html#InClsInst"><span class="hs-identifier hs-type">InClsInst</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="annot"><span class="hs-comment">{- *******************************************************************
*                                                                    *
                       Class lookup
*                                                                    *
**********************************************************************-}</span></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="hs-keyword">data</span><span> </span><span id="ClsInstResult"><span class="annot"><a href="GHC.Tc.Instance.Class.html#ClsInstResult"><span class="hs-identifier hs-var">ClsInstResult</span></a></span></span><span>
</span><span id="line-105"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="NoInstance"><span class="annot"><a href="GHC.Tc.Instance.Class.html#NoInstance"><span class="hs-identifier hs-var">NoInstance</span></a></span></span><span>   </span><span class="hs-comment">-- Definitely no instance</span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="OneInst"><span class="annot"><a href="GHC.Tc.Instance.Class.html#OneInst"><span class="hs-identifier hs-var">OneInst</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="cir_new_theta"><span class="annot"><span class="annottext">ClsInstResult -&gt; [PredType]
</span><a href="GHC.Tc.Instance.Class.html#cir_new_theta"><span class="hs-identifier hs-var hs-var">cir_new_theta</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-108"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="cir_mk_ev"><span class="annot"><span class="annottext">ClsInstResult -&gt; [EvExpr] -&gt; EvTerm
</span><a href="GHC.Tc.Instance.Class.html#cir_mk_ev"><span class="hs-identifier hs-var hs-var">cir_mk_ev</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvExpr"><span class="hs-identifier hs-type">EvExpr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvTerm"><span class="hs-identifier hs-type">EvTerm</span></a></span><span>
</span><span id="line-109"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="cir_canonical"><span class="annot"><span class="annottext">ClsInstResult -&gt; CanonicalEvidence
</span><a href="GHC.Tc.Instance.Class.html#cir_canonical"><span class="hs-identifier hs-var hs-var">cir_canonical</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#CanonicalEvidence"><span class="hs-identifier hs-type">CanonicalEvidence</span></a></span><span>
</span><span id="line-110"></span><span>                  </span><span class="hs-comment">--   cir_canonical=EvCanonical    =&gt; you can specialise on this instance</span><span>
</span><span id="line-111"></span><span>                  </span><span class="hs-comment">--   cir_canonical=EvNonCanonical =&gt; you cannot specialise on this instance</span><span>
</span><span id="line-112"></span><span>                  </span><span class="hs-comment">--                           (its OverlapFlag is NonCanonical)</span><span>
</span><span id="line-113"></span><span>                  </span><span class="hs-comment">-- See Note [Coherence and specialisation: overview]</span><span>
</span><span id="line-114"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="cir_what"><span class="annot"><span class="annottext">ClsInstResult -&gt; InstanceWhat
</span><a href="GHC.Tc.Instance.Class.html#cir_what"><span class="hs-identifier hs-var hs-var">cir_what</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#InstanceWhat"><span class="hs-identifier hs-type">InstanceWhat</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="NotSure"><span class="annot"><a href="GHC.Tc.Instance.Class.html#NotSure"><span class="hs-identifier hs-var">NotSure</span></a></span></span><span>      </span><span class="hs-comment">-- Multiple matches and/or one or more unifiers</span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#ClsInstResult"><span class="hs-identifier hs-type">ClsInstResult</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-119"></span><span>  </span><span id="local-6989586621683036838"><span class="annot"><span class="annottext">ppr :: ClsInstResult -&gt; SDoc
</span><a href="#local-6989586621683036838"><span class="hs-identifier hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="annot"><span class="annottext">ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#NoInstance"><span class="hs-identifier hs-var">NoInstance</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;NoInstance&quot;</span></span><span>
</span><span id="line-120"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#NotSure"><span class="hs-identifier hs-var">NotSure</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;NotSure&quot;</span></span><span>
</span><span id="line-121"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Instance.Class.html#OneInst"><span class="hs-identifier hs-type">OneInst</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cir_new_theta :: ClsInstResult -&gt; [PredType]
</span><a href="GHC.Tc.Instance.Class.html#cir_new_theta"><span class="hs-identifier hs-var">cir_new_theta</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683036841"><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683036841"><span class="hs-identifier hs-var">ev</span></a></span></span><span>
</span><span id="line-122"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cir_what :: ClsInstResult -&gt; InstanceWhat
</span><a href="GHC.Tc.Instance.Class.html#cir_what"><span class="hs-identifier hs-var">cir_what</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683036842"><span class="annot"><span class="annottext">InstanceWhat
</span><a href="#local-6989586621683036842"><span class="hs-identifier hs-var">what</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;OneInst&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[PredType] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683036841"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">InstanceWhat -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceWhat
</span><a href="#local-6989586621683036842"><span class="hs-identifier hs-var">what</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span class="annot"><a href="GHC.Tc.Instance.Class.html#safeOverlap"><span class="hs-identifier hs-type">safeOverlap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#InstanceWhat"><span class="hs-identifier hs-type">InstanceWhat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-126"></span><span id="safeOverlap"><span class="annot"><span class="annottext">safeOverlap :: InstanceWhat -&gt; Bool
</span><a href="GHC.Tc.Instance.Class.html#safeOverlap"><span class="hs-identifier hs-var hs-var">safeOverlap</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#TopLevInstance"><span class="hs-identifier hs-type">TopLevInstance</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">iw_safe_over :: InstanceWhat -&gt; Bool
</span><a href="GHC.Tc.Types.Origin.html#iw_safe_over"><span class="hs-identifier hs-var">iw_safe_over</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683036847"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683036847"><span class="hs-identifier hs-var">so</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683036847"><span class="hs-identifier hs-var">so</span></a></span><span>
</span><span id="line-127"></span><span class="annot"><a href="GHC.Tc.Instance.Class.html#safeOverlap"><span class="hs-identifier hs-var">safeOverlap</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceWhat
</span><span class="hs-identifier">_</span></span><span>                                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span class="annot"><a href="GHC.Tc.Instance.Class.html#instanceReturnsDictCon"><span class="hs-identifier hs-type">instanceReturnsDictCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#InstanceWhat"><span class="hs-identifier hs-type">InstanceWhat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-130"></span><span class="hs-comment">-- See Note [Solved dictionaries] in GHC.Tc.Solver.InertSet</span><span>
</span><span id="line-131"></span><span id="instanceReturnsDictCon"><span class="annot"><span class="annottext">instanceReturnsDictCon :: InstanceWhat -&gt; Bool
</span><a href="GHC.Tc.Instance.Class.html#instanceReturnsDictCon"><span class="hs-identifier hs-var hs-var">instanceReturnsDictCon</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#TopLevInstance"><span class="hs-identifier hs-type">TopLevInstance</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-132"></span><span class="annot"><a href="GHC.Tc.Instance.Class.html#instanceReturnsDictCon"><span class="hs-identifier hs-var">instanceReturnsDictCon</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceWhat
</span><a href="GHC.Tc.Types.Origin.html#BuiltinInstance"><span class="hs-identifier hs-var">BuiltinInstance</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-133"></span><span class="annot"><a href="GHC.Tc.Instance.Class.html#instanceReturnsDictCon"><span class="hs-identifier hs-var">instanceReturnsDictCon</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#BuiltinTypeableInstance"><span class="hs-identifier hs-type">BuiltinTypeableInstance</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-134"></span><span class="annot"><a href="GHC.Tc.Instance.Class.html#instanceReturnsDictCon"><span class="hs-identifier hs-var">instanceReturnsDictCon</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceWhat
</span><a href="GHC.Tc.Types.Origin.html#BuiltinEqInstance"><span class="hs-identifier hs-var">BuiltinEqInstance</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-135"></span><span class="annot"><a href="GHC.Tc.Instance.Class.html#instanceReturnsDictCon"><span class="hs-identifier hs-var">instanceReturnsDictCon</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceWhat
</span><a href="GHC.Tc.Types.Origin.html#LocalInstance"><span class="hs-identifier hs-var">LocalInstance</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span class="annot"><a href="GHC.Tc.Instance.Class.html#matchGlobalInst"><span class="hs-identifier hs-type">matchGlobalInst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span>
</span><span id="line-138"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>      </span><span class="hs-comment">-- True &lt;=&gt; caller is the short-cut solver</span><span>
</span><span id="line-139"></span><span>                             </span><span class="hs-comment">-- See Note [Shortcut solving: overlap]</span><span>
</span><span id="line-140"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#ClsInstResult"><span class="hs-identifier hs-type">ClsInstResult</span></a></span><span>
</span><span id="line-141"></span><span class="hs-comment">-- Precondition: Class does not satisfy GHC.Core.Predicate.isEqualityClass</span><span>
</span><span id="line-142"></span><span class="hs-comment">-- (That is handled by a separate code path: see GHC.Tc.Solver.Dict.solveDict,</span><span>
</span><span id="line-143"></span><span class="hs-comment">--  which calls solveEqualityDict for equality classes.)</span><span>
</span><span id="line-144"></span><span id="matchGlobalInst"><span class="annot"><span class="annottext">matchGlobalInst :: DynFlags -&gt; Bool -&gt; Class -&gt; [PredType] -&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#matchGlobalInst"><span class="hs-identifier hs-var hs-var">matchGlobalInst</span></a></span></span><span> </span><span id="local-6989586621683036852"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683036852"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621683036853"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683036853"><span class="hs-identifier hs-var">short_cut</span></a></span></span><span> </span><span id="local-6989586621683036854"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683036854"><span class="hs-identifier hs-var">clas</span></a></span></span><span> </span><span id="local-6989586621683036855"><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683036855"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-145"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036856"><span class="hs-identifier hs-var">cls_name</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#knownNatClassName"><span class="hs-identifier hs-var">knownNatClassName</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool -&gt; Class -&gt; [PredType] -&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#matchKnownNat"><span class="hs-identifier hs-var">matchKnownNat</span></a></span><span>    </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683036852"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683036853"><span class="hs-identifier hs-var">short_cut</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683036854"><span class="hs-identifier hs-var">clas</span></a></span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683036855"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-146"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036856"><span class="hs-identifier hs-var">cls_name</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#knownSymbolClassName"><span class="hs-identifier hs-var">knownSymbolClassName</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool -&gt; Class -&gt; [PredType] -&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#matchKnownSymbol"><span class="hs-identifier hs-var">matchKnownSymbol</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683036852"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683036853"><span class="hs-identifier hs-var">short_cut</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683036854"><span class="hs-identifier hs-var">clas</span></a></span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683036855"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-147"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036856"><span class="hs-identifier hs-var">cls_name</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#knownCharClassName"><span class="hs-identifier hs-var">knownCharClassName</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool -&gt; Class -&gt; [PredType] -&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#matchKnownChar"><span class="hs-identifier hs-var">matchKnownChar</span></a></span><span>   </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683036852"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683036853"><span class="hs-identifier hs-var">short_cut</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683036854"><span class="hs-identifier hs-var">clas</span></a></span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683036855"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-148"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Class -&gt; Bool
</span><a href="GHC.Core.Predicate.html#isCTupleClass"><span class="hs-identifier hs-var">isCTupleClass</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683036854"><span class="hs-identifier hs-var">clas</span></a></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class -&gt; [PredType] -&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#matchCTuple"><span class="hs-identifier hs-var">matchCTuple</span></a></span><span>                       </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683036854"><span class="hs-identifier hs-var">clas</span></a></span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683036855"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-149"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036856"><span class="hs-identifier hs-var">cls_name</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#typeableClassName"><span class="hs-identifier hs-var">typeableClassName</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class -&gt; [PredType] -&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#matchTypeable"><span class="hs-identifier hs-var">matchTypeable</span></a></span><span>                     </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683036854"><span class="hs-identifier hs-var">clas</span></a></span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683036855"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-150"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036856"><span class="hs-identifier hs-var">cls_name</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#withDictClassName"><span class="hs-identifier hs-var">withDictClassName</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PredType] -&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#matchWithDict"><span class="hs-identifier hs-var">matchWithDict</span></a></span><span>                          </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683036855"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-151"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036856"><span class="hs-identifier hs-var">cls_name</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#dataToTagClassName"><span class="hs-identifier hs-var">dataToTagClassName</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class -&gt; [PredType] -&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#matchDataToTag"><span class="hs-identifier hs-var">matchDataToTag</span></a></span><span>                    </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683036854"><span class="hs-identifier hs-var">clas</span></a></span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683036855"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036856"><span class="hs-identifier hs-var">cls_name</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#hasFieldClassName"><span class="hs-identifier hs-var">hasFieldClassName</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool -&gt; Class -&gt; [PredType] -&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#matchHasField"><span class="hs-identifier hs-var">matchHasField</span></a></span><span>    </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683036852"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683036853"><span class="hs-identifier hs-var">short_cut</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683036854"><span class="hs-identifier hs-var">clas</span></a></span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683036855"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-153"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683036856"><span class="hs-identifier hs-var">cls_name</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#unsatisfiableClassName"><span class="hs-identifier hs-var">unsatisfiableClassName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClsInstResult -&gt; TcM ClsInstResult
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#NoInstance"><span class="hs-identifier hs-var">NoInstance</span></a></span><span> </span><span class="hs-comment">-- See (B) in Note [Implementation of Unsatisfiable constraints] in GHC.Tc.Errors</span><span>
</span><span id="line-154"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool -&gt; Class -&gt; [PredType] -&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#matchInstEnv"><span class="hs-identifier hs-var">matchInstEnv</span></a></span><span>     </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683036852"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683036853"><span class="hs-identifier hs-var">short_cut</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683036854"><span class="hs-identifier hs-var">clas</span></a></span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683036855"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-156"></span><span>    </span><span id="local-6989586621683036856"><span class="annot"><span class="annottext">cls_name :: Name
</span><a href="#local-6989586621683036856"><span class="hs-identifier hs-var hs-var">cls_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class -&gt; Name
</span><a href="GHC.Core.Class.html#className"><span class="hs-identifier hs-var">className</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683036854"><span class="hs-identifier hs-var">clas</span></a></span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="annot"><span class="hs-comment">{- ********************************************************************
*                                                                     *
                   Looking in the instance environment
*                                                                     *
***********************************************************************-}</span></span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span class="annot"><a href="GHC.Tc.Instance.Class.html#matchInstEnv"><span class="hs-identifier hs-type">matchInstEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#ClsInstResult"><span class="hs-identifier hs-type">ClsInstResult</span></a></span><span>
</span><span id="line-167"></span><span id="matchInstEnv"><span class="annot"><span class="annottext">matchInstEnv :: DynFlags -&gt; Bool -&gt; Class -&gt; [PredType] -&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#matchInstEnv"><span class="hs-identifier hs-var hs-var">matchInstEnv</span></a></span></span><span> </span><span id="local-6989586621683036876"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683036876"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621683036877"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683036877"><span class="hs-identifier hs-var">short_cut_solver</span></a></span></span><span> </span><span id="local-6989586621683036878"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683036878"><span class="hs-identifier hs-var">clas</span></a></span></span><span> </span><span id="local-6989586621683036879"><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683036879"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-168"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683036880"><span class="annot"><a href="#local-6989586621683036880"><span class="hs-identifier hs-var">instEnvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM InstEnvs
</span><a href="GHC.Tc.Utils.Env.html#tcGetInstEnvs"><span class="hs-identifier hs-var">tcGetInstEnvs</span></a></span><span>
</span><span id="line-169"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683036882"><span class="annot"><a href="#local-6989586621683036882"><span class="hs-identifier hs-var hs-var">safeOverlapCheck</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SafeHaskellMode
</span><a href="GHC.Driver.DynFlags.html#safeHaskell"><span class="hs-identifier hs-var">safeHaskell</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683036876"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode -&gt; [SafeHaskellMode] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Types.SafeHaskell.html#Sf_Safe"><span class="hs-identifier hs-var">Sf_Safe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Types.SafeHaskell.html#Sf_Trustworthy"><span class="hs-identifier hs-var">Sf_Trustworthy</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-170"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621683036887"><span class="annot"><a href="#local-6989586621683036887"><span class="hs-identifier hs-var">matches</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683036888"><span class="annot"><a href="#local-6989586621683036888"><span class="hs-identifier hs-var">unify</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683036889"><span class="annot"><a href="#local-6989586621683036889"><span class="hs-identifier hs-var">unsafeOverlaps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#lookupInstEnv"><span class="hs-identifier hs-type">lookupInstEnv</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="annot"><a href="#local-6989586621683036880"><span class="hs-identifier hs-type">instEnvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683036878"><span class="hs-identifier hs-type">clas</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683036879"><span class="hs-identifier hs-type">tys</span></a></span><span>
</span><span id="line-171"></span><span>              </span><span id="local-6989586621683036891"><span class="annot"><a href="#local-6989586621683036891"><span class="hs-identifier hs-var hs-var">safeHaskFail</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683036882"><span class="hs-identifier hs-var">safeOverlapCheck</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[InstMatch] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[InstMatch]
</span><a href="#local-6989586621683036889"><span class="hs-identifier hs-var">unsafeOverlaps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;matchInstEnv&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-173"></span><span>            </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;goal:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683036878"><span class="hs-identifier hs-type">clas</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683036879"><span class="hs-identifier hs-type">tys</span></a></span><span>
</span><span id="line-174"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;matches:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683036887"><span class="hs-identifier hs-type">matches</span></a></span><span>
</span><span id="line-175"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;unify:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683036888"><span class="hs-identifier hs-type">unify</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-176"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683036887"><span class="hs-identifier hs-type">matches</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683036888"><span class="hs-identifier hs-type">unify</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683036891"><span class="hs-identifier hs-type">safeHaskFail</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span>            </span><span class="hs-comment">-- Nothing matches</span><span>
</span><span id="line-179"></span><span>            </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#NoUnifiers"><span class="hs-identifier hs-type">NoUnifiers</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;matchClass not matching&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PredType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683036897"><span class="hs-identifier hs-var">pred</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">InstEnv -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InstEnvs -&gt; InstEnv
</span><a href="GHC.Core.InstEnv.html#ie_local"><span class="hs-identifier hs-var">ie_local</span></a></span><span> </span><span class="annot"><span class="annottext">InstEnvs
</span><a href="#local-6989586621683036880"><span class="hs-identifier hs-var">instEnvs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>                      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">ClsInstResult -&gt; TcM ClsInstResult
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#NoInstance"><span class="hs-identifier hs-var">NoInstance</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span>            </span><span class="hs-comment">-- A single match (&amp; no safe haskell failure)</span><span>
</span><span id="line-184"></span><span>            </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span id="local-6989586621683036900"><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621683036900"><span class="hs-identifier hs-var">ispec</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683036901"><span class="annot"><span class="annottext">[DFunInstType]
</span><a href="#local-6989586621683036901"><span class="hs-identifier hs-var">inst_tys</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#NoUnifiers"><span class="hs-identifier hs-type">NoUnifiers</span></a></span><span> </span><span id="local-6989586621683036902"><span class="annot"><span class="annottext">CanonicalEvidence
</span><a href="#local-6989586621683036902"><span class="hs-identifier hs-var">canonical</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683036877"><span class="hs-identifier hs-var">short_cut_solver</span></a></span><span>      </span><span class="hs-comment">-- Called from the short-cut solver</span><span>
</span><span id="line-186"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ClsInst -&gt; Bool
</span><a href="GHC.Core.InstEnv.html#isOverlappable"><span class="hs-identifier hs-var">isOverlappable</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621683036900"><span class="hs-identifier hs-var">ispec</span></a></span><span>
</span><span id="line-187"></span><span>                </span><span class="hs-comment">-- If the instance has OVERLAPPABLE or OVERLAPS or INCOHERENT</span><span>
</span><span id="line-188"></span><span>                </span><span class="hs-comment">-- then don't let the short-cut solver choose it, because a</span><span>
</span><span id="line-189"></span><span>                </span><span class="hs-comment">-- later instance might overlap it.  #14434 is an example</span><span>
</span><span id="line-190"></span><span>                </span><span class="hs-comment">-- See Note [Shortcut solving: overlap]</span><span>
</span><span id="line-191"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;matchClass: ignoring overlappable&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PredType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683036897"><span class="hs-identifier hs-var">pred</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>                      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">ClsInstResult -&gt; TcM ClsInstResult
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#NotSure"><span class="hs-identifier hs-var">NotSure</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-195"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683036904"><span class="annot"><span class="annottext">dfun_id :: DFunId
</span><a href="#local-6989586621683036904"><span class="hs-identifier hs-var hs-var hs-var">dfun_id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClsInst -&gt; DFunId
</span><a href="GHC.Core.InstEnv.html#instanceDFunId"><span class="hs-identifier hs-var">instanceDFunId</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621683036900"><span class="hs-identifier hs-var">ispec</span></a></span><span>
</span><span id="line-196"></span><span>                            </span><span id="local-6989586621683036906"><span class="annot"><span class="annottext">warn :: Maybe (WarningTxt GhcRn)
</span><a href="#local-6989586621683036906"><span class="hs-identifier hs-var hs-var hs-var">warn</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClsInst -&gt; Maybe (WarningTxt GhcRn)
</span><a href="GHC.Core.InstEnv.html#instanceWarning"><span class="hs-identifier hs-var">instanceWarning</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621683036900"><span class="hs-identifier hs-var">ispec</span></a></span><span>
</span><span id="line-197"></span><span>                      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;matchClass success&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcRn ()) -&gt; SDoc -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-198"></span><span>                        </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dict&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">PredType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683036897"><span class="hs-identifier hs-var">pred</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CanonicalEvidence -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CanonicalEvidence
</span><a href="#local-6989586621683036902"><span class="hs-identifier hs-var">canonical</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-199"></span><span>                              </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;witness&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DFunId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621683036904"><span class="hs-identifier hs-var">dfun_id</span></a></span><span>
</span><span id="line-200"></span><span>                                             </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">PredType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DFunId -&gt; PredType
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621683036904"><span class="hs-identifier hs-var">dfun_id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-201"></span><span>                                </span><span class="hs-comment">-- Record that this dfun is needed</span><span>
</span><span id="line-202"></span><span>                      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; CanonicalEvidence
-&gt; DFunId
-&gt; [DFunInstType]
-&gt; Maybe (WarningTxt GhcRn)
-&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#match_one"><span class="hs-identifier hs-var">match_one</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[InstMatch] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[InstMatch]
</span><a href="#local-6989586621683036889"><span class="hs-identifier hs-var">unsafeOverlaps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CanonicalEvidence
</span><a href="#local-6989586621683036902"><span class="hs-identifier hs-var">canonical</span></a></span><span> </span><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621683036904"><span class="hs-identifier hs-var">dfun_id</span></a></span><span> </span><span class="annot"><span class="annottext">[DFunInstType]
</span><a href="#local-6989586621683036901"><span class="hs-identifier hs-var">inst_tys</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (WarningTxt GhcRn)
</span><a href="#local-6989586621683036906"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span>            </span><span class="hs-comment">-- More than one matches (or Safe Haskell fail!). Defer any</span><span>
</span><span id="line-205"></span><span>            </span><span class="hs-comment">-- reactions of a multitude until we learn more about the reagent</span><span>
</span><span id="line-206"></span><span>            </span><span class="annot"><span class="annottext">([InstMatch], PotentialUnifiers, Bool)
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;matchClass multiple matches, deferring choice&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcRn ()) -&gt; SDoc -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-207"></span><span>                        </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dict&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">PredType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683036897"><span class="hs-identifier hs-var">pred</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-208"></span><span>                              </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;matches&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[InstMatch] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[InstMatch]
</span><a href="#local-6989586621683036887"><span class="hs-identifier hs-var">matches</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-209"></span><span>                      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">ClsInstResult -&gt; TcM ClsInstResult
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#NotSure"><span class="hs-identifier hs-var">NotSure</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-210"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-211"></span><span>     </span><span id="local-6989586621683036897"><span class="annot"><span class="annottext">pred :: PredType
</span><a href="#local-6989586621683036897"><span class="hs-identifier hs-var hs-var">pred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class -&gt; [PredType] -&gt; PredType
</span><a href="GHC.Core.Predicate.html#mkClassPred"><span class="hs-identifier hs-var">mkClassPred</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683036878"><span class="hs-identifier hs-var">clas</span></a></span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683036879"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-212"></span><span>
</span><span id="line-213"></span><span class="annot"><a href="GHC.Tc.Instance.Class.html#match_one"><span class="hs-identifier hs-type">match_one</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SafeOverlapping"><span class="hs-identifier hs-type">SafeOverlapping</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#CanonicalEvidence"><span class="hs-identifier hs-type">CanonicalEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#DFunId"><span class="hs-identifier hs-type">DFunId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.InstEnv.html#DFunInstType"><span class="hs-identifier hs-type">DFunInstType</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-214"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.Warnings.html#WarningTxt"><span class="hs-identifier hs-type">WarningTxt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#ClsInstResult"><span class="hs-identifier hs-type">ClsInstResult</span></a></span><span>
</span><span id="line-215"></span><span id="match_one"><span class="annot"><span class="annottext">match_one :: Bool
-&gt; CanonicalEvidence
-&gt; DFunId
-&gt; [DFunInstType]
-&gt; Maybe (WarningTxt GhcRn)
-&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#match_one"><span class="hs-identifier hs-var hs-var">match_one</span></a></span></span><span> </span><span id="local-6989586621683036911"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683036911"><span class="hs-identifier hs-var">so</span></a></span></span><span> </span><span id="local-6989586621683036912"><span class="annot"><span class="annottext">CanonicalEvidence
</span><a href="#local-6989586621683036912"><span class="hs-identifier hs-var">canonical</span></a></span></span><span> </span><span id="local-6989586621683036913"><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621683036913"><span class="hs-identifier hs-var">dfun_id</span></a></span></span><span> </span><span id="local-6989586621683036914"><span class="annot"><span class="annottext">[DFunInstType]
</span><a href="#local-6989586621683036914"><span class="hs-identifier hs-var">mb_inst_tys</span></a></span></span><span> </span><span id="local-6989586621683036915"><span class="annot"><span class="annottext">Maybe (WarningTxt GhcRn)
</span><a href="#local-6989586621683036915"><span class="hs-identifier hs-var">warn</span></a></span></span><span>
</span><span id="line-216"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;match_one&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DFunId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621683036913"><span class="hs-identifier hs-var">dfun_id</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[DFunInstType] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[DFunInstType]
</span><a href="#local-6989586621683036914"><span class="hs-identifier hs-var">mb_inst_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683036916"><span class="annot"><a href="#local-6989586621683036916"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683036917"><span class="annot"><a href="#local-6989586621683036917"><span class="hs-identifier hs-var">theta</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DFunId -&gt; [DFunInstType] -&gt; TcM ([PredType], [PredType])
</span><a href="GHC.Tc.Utils.Instantiate.html#instDFunType"><span class="hs-identifier hs-var">instDFunType</span></a></span><span> </span><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621683036913"><span class="hs-identifier hs-var">dfun_id</span></a></span><span> </span><span class="annot"><span class="annottext">[DFunInstType]
</span><a href="#local-6989586621683036914"><span class="hs-identifier hs-var">mb_inst_tys</span></a></span><span>
</span><span id="line-218"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;match_one 2&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683036913"><span class="hs-identifier hs-type">dfun_id</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683036916"><span class="hs-identifier hs-type">tys</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683036917"><span class="hs-identifier hs-type">theta</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#OneInst"><span class="hs-identifier hs-type">OneInst</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#cir_new_theta"><span class="hs-identifier hs-var">cir_new_theta</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683036917"><span class="hs-identifier hs-type">theta</span></a></span><span>
</span><span id="line-220"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#cir_mk_ev"><span class="hs-identifier hs-var">cir_mk_ev</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#evDFunApp"><span class="hs-identifier hs-type">evDFunApp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683036913"><span class="hs-identifier hs-type">dfun_id</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683036916"><span class="hs-identifier hs-type">tys</span></a></span><span>
</span><span id="line-221"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#cir_canonical"><span class="hs-identifier hs-var">cir_canonical</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683036912"><span class="hs-identifier hs-type">canonical</span></a></span><span>
</span><span id="line-222"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#cir_what"><span class="hs-identifier hs-var">cir_what</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#TopLevInstance"><span class="hs-identifier hs-type">TopLevInstance</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#iw_dfun_id"><span class="hs-identifier hs-var">iw_dfun_id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683036913"><span class="hs-identifier hs-type">dfun_id</span></a></span><span>
</span><span id="line-223"></span><span>                                                             </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#iw_safe_over"><span class="hs-identifier hs-var">iw_safe_over</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683036911"><span class="hs-identifier hs-type">so</span></a></span><span>
</span><span id="line-224"></span><span>                                                             </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#iw_warn"><span class="hs-identifier hs-var">iw_warn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683036915"><span class="hs-identifier hs-type">warn</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span class="hs-comment">{- Note [Shortcut solving: overlap]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose we have
  instance {-# OVERLAPPABLE #-} C a where ...
and we are typechecking
  f :: C a =&gt; a -&gt; a
  f = e  -- Gives rise to [W] C a

We don't want to solve the wanted constraint with the overlappable
instance; rather we want to use the supplied (C a)! That was the whole
point of it being overlappable!  #14434 wwas an example.

Alas even if the instance has no overlap flag, thus
  instance C a where ...
there is nothing to stop it being overlapped. GHC provides no way to
declare an instance as &quot;final&quot; so it can't be overlapped.  But really
only final instances are OK for short-cut solving.  Sigh. #15135
was a puzzling example.
-}</span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span class="annot"><span class="hs-comment">{- ********************************************************************
*                                                                     *
                   Class lookup for CTuples
*                                                                     *
***********************************************************************-}</span></span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span class="annot"><a href="GHC.Tc.Instance.Class.html#matchCTuple"><span class="hs-identifier hs-type">matchCTuple</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#ClsInstResult"><span class="hs-identifier hs-type">ClsInstResult</span></a></span><span>
</span><span id="line-255"></span><span id="matchCTuple"><span class="annot"><span class="annottext">matchCTuple :: Class -&gt; [PredType] -&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#matchCTuple"><span class="hs-identifier hs-var hs-var">matchCTuple</span></a></span></span><span> </span><span id="local-6989586621683036921"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683036921"><span class="hs-identifier hs-var">clas</span></a></span></span><span> </span><span id="local-6989586621683036922"><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683036922"><span class="hs-identifier hs-var">tys</span></a></span></span><span>   </span><span class="hs-comment">-- (isCTupleClass clas) holds</span><span>
</span><span id="line-256"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClsInstResult -&gt; TcM ClsInstResult
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Instance.Class.html#OneInst"><span class="hs-identifier hs-type">OneInst</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cir_new_theta :: [PredType]
</span><a href="GHC.Tc.Instance.Class.html#cir_new_theta"><span class="hs-identifier hs-var">cir_new_theta</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683036922"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-257"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cir_mk_ev :: [EvExpr] -&gt; EvTerm
</span><a href="GHC.Tc.Instance.Class.html#cir_mk_ev"><span class="hs-identifier hs-var">cir_mk_ev</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EvExpr] -&gt; EvTerm
</span><a href="#local-6989586621683036923"><span class="hs-identifier hs-var">tuple_ev</span></a></span><span>
</span><span id="line-258"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cir_canonical :: CanonicalEvidence
</span><a href="GHC.Tc.Instance.Class.html#cir_canonical"><span class="hs-identifier hs-var">cir_canonical</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CanonicalEvidence
</span><a href="GHC.Core.InstEnv.html#EvCanonical"><span class="hs-identifier hs-var">EvCanonical</span></a></span><span>
</span><span id="line-259"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cir_what :: InstanceWhat
</span><a href="GHC.Tc.Instance.Class.html#cir_what"><span class="hs-identifier hs-var">cir_what</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InstanceWhat
</span><a href="GHC.Tc.Types.Origin.html#BuiltinInstance"><span class="hs-identifier hs-var">BuiltinInstance</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span>            </span><span class="hs-comment">-- The dfun *is* the data constructor!</span><span>
</span><span id="line-261"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-262"></span><span>     </span><span id="local-6989586621683036925"><span class="annot"><span class="annottext">data_con :: DataCon
</span><a href="#local-6989586621683036925"><span class="hs-identifier hs-var hs-var">data_con</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; DataCon
</span><a href="GHC.Core.TyCon.html#tyConSingleDataCon"><span class="hs-identifier hs-var">tyConSingleDataCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; TyCon
</span><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier hs-var">classTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683036921"><span class="hs-identifier hs-var">clas</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>     </span><span id="local-6989586621683036923"><span class="annot"><span class="annottext">tuple_ev :: [EvExpr] -&gt; EvTerm
</span><a href="#local-6989586621683036923"><span class="hs-identifier hs-var hs-var">tuple_ev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DFunId -&gt; [PredType] -&gt; [EvExpr] -&gt; EvTerm
</span><a href="GHC.Tc.Types.Evidence.html#evDFunApp"><span class="hs-identifier hs-var">evDFunApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; DFunId
</span><a href="GHC.Core.DataCon.html#dataConWrapId"><span class="hs-identifier hs-var">dataConWrapId</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683036925"><span class="hs-identifier hs-var">data_con</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683036922"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span class="annot"><span class="hs-comment">{- ********************************************************************
*                                                                     *
                   Class lookup for Literals
*                                                                     *
***********************************************************************-}</span></span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span class="hs-comment">{-
Note [KnownNat &amp; KnownSymbol and EvLit]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
A part of the type-level literals implementation are the classes
&quot;KnownNat&quot; and &quot;KnownSymbol&quot;, which provide a &quot;smart&quot; constructor for
defining singleton values.  Here is the key stuff from GHC.TypeNats

  class KnownNat (n :: Nat) where
    natSing :: SNat n

  newtype SNat (n :: Nat) = SNat Natural

Conceptually, this class has infinitely many instances:

  instance KnownNat 0       where natSing = SNat 0
  instance KnownNat 1       where natSing = SNat 1
  instance KnownNat 2       where natSing = SNat 2
  ...

In practice, we solve `KnownNat` predicates in the type-checker (see
`matchKnownNat` in this module) because we can't have infinitely many
instances.  The evidence (aka &quot;dictionary&quot;) for `KnownNat` is of the
form `EvLit (EvNum n)`.

We make the following assumptions about dictionaries in GHC:
  1. The &quot;dictionary&quot; for classes with a single method---like `KnownNat`---is
     a newtype for the type of the method, so using a evidence amounts
     to a coercion, and
  2. Newtypes use the same representation as their definition types.

So, the evidence for `KnownNat` is just a value of the representation type,
wrapped in two newtype constructors: one to make it into a `SNat` value,
and another to make it into a `KnownNat` dictionary.

Also note that `natSing` and `SNat` are never actually exposed from the
library---they are just an implementation detail.  Instead, users see
a more convenient function, defined in terms of `natSing`:

  natVal :: KnownNat n =&gt; proxy n -&gt; Natural

The reason we don't use this directly in the class is that it is simpler
and more efficient to pass around a Natural rather than an entire function,
especially when the `KnownNat` evidence is packaged up in an existential.

The story for kind `Symbol` is analogous:
  * class KnownSymbol
  * newtype SSymbol
  * Evidence: a Core literal (e.g. mkNaturalExpr)


Note [Fabricating Evidence for Literals in Backpack]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Let `T` be a type of kind `Nat`. When solving for a purported instance
of `KnownNat T`, ghc tries to resolve the type `T` to an integer `n`,
in which case the evidence `EvLit (EvNum n)` is generated on the
fly. It might appear that this is sufficient as users cannot define
their own instances of `KnownNat`. However, for backpack module this
would not work (see issue #15379). Consider the signature `Abstract`

&gt; signature Abstract where
&gt;   data T :: Nat
&gt;   instance KnownNat T

and a module `Util` that depends on it:

&gt; module Util where
&gt;  import Abstract
&gt;  printT :: IO ()
&gt;  printT = do print $ natVal (Proxy :: Proxy T)

Clearly, we need to &quot;use&quot; the dictionary associated with `KnownNat T`
in the module `Util`, but it is too early for the compiler to produce
a real dictionary as we still have not fixed what `T` is. Only when we
mixin a concrete module

&gt; module Concrete where
&gt;   type T = 42

do we really get hold of the underlying integer. So the strategy that
we follow is the following

1. If T is indeed available as a type alias for an integer constant,
   generate the dictionary on the fly, failing which

2. Look up the type class environment for the evidence.

Finally actual code gets generate for Util only when a module like
Concrete gets &quot;mixed-in&quot; in place of the signature Abstract. As a
result all things, including the typeclass instances, in Concrete gets
reexported. So `KnownNat` gets resolved the normal way post-Backpack.

A similar generation works for `KnownSymbol` as well

-}</span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span class="annot"><a href="GHC.Tc.Instance.Class.html#matchKnownNat"><span class="hs-identifier hs-type">matchKnownNat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span>
</span><span id="line-368"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>      </span><span class="hs-comment">-- True &lt;=&gt; caller is the short-cut solver</span><span>
</span><span id="line-369"></span><span>                           </span><span class="hs-comment">-- See Note [Shortcut solving: overlap]</span><span>
</span><span id="line-370"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#ClsInstResult"><span class="hs-identifier hs-type">ClsInstResult</span></a></span><span>
</span><span id="line-371"></span><span id="matchKnownNat"><span class="annot"><span class="annottext">matchKnownNat :: DynFlags -&gt; Bool -&gt; Class -&gt; [PredType] -&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#matchKnownNat"><span class="hs-identifier hs-var hs-var">matchKnownNat</span></a></span></span><span> </span><span id="local-6989586621683036929"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683036929"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683036930"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683036930"><span class="hs-identifier hs-var">clas</span></a></span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621683036931"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683036931"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- clas = KnownNat</span><span>
</span><span id="line-372"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683036932"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621683036932"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PredType -&gt; Maybe Integer
</span><a href="GHC.Core.Type.html#isNumLitTy"><span class="hs-identifier hs-var">isNumLitTy</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683036931"><span class="hs-identifier hs-var">ty</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class -&gt; PredType -&gt; EvExpr -&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#makeLitDict"><span class="hs-identifier hs-var">makeLitDict</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683036930"><span class="hs-identifier hs-var">clas</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683036931"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; Integer -&gt; EvExpr
</span><a href="GHC.Core.Make.html#mkNaturalExpr"><span class="hs-identifier hs-var">mkNaturalExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.DynFlags.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683036929"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621683036932"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-373"></span><span class="annot"><a href="GHC.Tc.Instance.Class.html#matchKnownNat"><span class="hs-identifier hs-var">matchKnownNat</span></a></span><span> </span><span id="local-6989586621683036936"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683036936"><span class="hs-identifier hs-var">df</span></a></span></span><span> </span><span id="local-6989586621683036937"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683036937"><span class="hs-identifier hs-var">sc</span></a></span></span><span> </span><span id="local-6989586621683036938"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683036938"><span class="hs-identifier hs-var">clas</span></a></span></span><span> </span><span id="local-6989586621683036939"><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683036939"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool -&gt; Class -&gt; [PredType] -&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#matchInstEnv"><span class="hs-identifier hs-var">matchInstEnv</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683036936"><span class="hs-identifier hs-var">df</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683036937"><span class="hs-identifier hs-var">sc</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683036938"><span class="hs-identifier hs-var">clas</span></a></span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683036939"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-374"></span><span> </span><span class="hs-comment">-- See Note [Fabricating Evidence for Literals in Backpack] for why</span><span>
</span><span id="line-375"></span><span> </span><span class="hs-comment">-- this lookup into the instance environment is required.</span><span>
</span><span id="line-376"></span><span>
</span><span id="line-377"></span><span class="annot"><a href="GHC.Tc.Instance.Class.html#matchKnownSymbol"><span class="hs-identifier hs-type">matchKnownSymbol</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span>
</span><span id="line-378"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>      </span><span class="hs-comment">-- True &lt;=&gt; caller is the short-cut solver</span><span>
</span><span id="line-379"></span><span>                              </span><span class="hs-comment">-- See Note [Shortcut solving: overlap]</span><span>
</span><span id="line-380"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#ClsInstResult"><span class="hs-identifier hs-type">ClsInstResult</span></a></span><span>
</span><span id="line-381"></span><span id="matchKnownSymbol"><span class="annot"><span class="annottext">matchKnownSymbol :: DynFlags -&gt; Bool -&gt; Class -&gt; [PredType] -&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#matchKnownSymbol"><span class="hs-identifier hs-var hs-var">matchKnownSymbol</span></a></span></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683036940"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683036940"><span class="hs-identifier hs-var">clas</span></a></span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621683036941"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683036941"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- clas = KnownSymbol</span><span>
</span><span id="line-382"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683036942"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683036942"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PredType -&gt; Maybe FastString
</span><a href="GHC.Core.Type.html#isStrLitTy"><span class="hs-identifier hs-var">isStrLitTy</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683036941"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-383"></span><span>        </span><span id="local-6989586621683036944"><span class="annot"><a href="#local-6989586621683036944"><span class="hs-identifier hs-var">et</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; IOEnv (Env TcGblEnv TcLclEnv) EvExpr
forall (m :: * -&gt; *). MonadThings m =&gt; FastString -&gt; m EvExpr
</span><a href="GHC.Core.Make.html#mkStringExprFS"><span class="hs-identifier hs-var">mkStringExprFS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683036942"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-384"></span><span>        </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#makeLitDict"><span class="hs-identifier hs-type">makeLitDict</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683036940"><span class="hs-identifier hs-type">clas</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683036941"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683036944"><span class="hs-identifier hs-type">et</span></a></span><span>
</span><span id="line-385"></span><span class="annot"><a href="GHC.Tc.Instance.Class.html#matchKnownSymbol"><span class="hs-identifier hs-var">matchKnownSymbol</span></a></span><span> </span><span id="local-6989586621683036945"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683036945"><span class="hs-identifier hs-var">df</span></a></span></span><span> </span><span id="local-6989586621683036946"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683036946"><span class="hs-identifier hs-var">sc</span></a></span></span><span> </span><span id="local-6989586621683036947"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683036947"><span class="hs-identifier hs-var">clas</span></a></span></span><span> </span><span id="local-6989586621683036948"><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683036948"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool -&gt; Class -&gt; [PredType] -&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#matchInstEnv"><span class="hs-identifier hs-var">matchInstEnv</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683036945"><span class="hs-identifier hs-var">df</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683036946"><span class="hs-identifier hs-var">sc</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683036947"><span class="hs-identifier hs-var">clas</span></a></span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683036948"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-386"></span><span> </span><span class="hs-comment">-- See Note [Fabricating Evidence for Literals in Backpack] for why</span><span>
</span><span id="line-387"></span><span> </span><span class="hs-comment">-- this lookup into the instance environment is required.</span><span>
</span><span id="line-388"></span><span>
</span><span id="line-389"></span><span class="annot"><a href="GHC.Tc.Instance.Class.html#matchKnownChar"><span class="hs-identifier hs-type">matchKnownChar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span>
</span><span id="line-390"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>      </span><span class="hs-comment">-- True &lt;=&gt; caller is the short-cut solver</span><span>
</span><span id="line-391"></span><span>                              </span><span class="hs-comment">-- See Note [Shortcut solving: overlap]</span><span>
</span><span id="line-392"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#ClsInstResult"><span class="hs-identifier hs-type">ClsInstResult</span></a></span><span>
</span><span id="line-393"></span><span id="matchKnownChar"><span class="annot"><span class="annottext">matchKnownChar :: DynFlags -&gt; Bool -&gt; Class -&gt; [PredType] -&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#matchKnownChar"><span class="hs-identifier hs-var hs-var">matchKnownChar</span></a></span></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683036949"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683036949"><span class="hs-identifier hs-var">clas</span></a></span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621683036950"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683036950"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- clas = KnownChar</span><span>
</span><span id="line-394"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683036951"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621683036951"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PredType -&gt; Maybe Char
</span><a href="GHC.Core.Type.html#isCharLitTy"><span class="hs-identifier hs-var">isCharLitTy</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683036950"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class -&gt; PredType -&gt; EvExpr -&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#makeLitDict"><span class="hs-identifier hs-var">makeLitDict</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683036949"><span class="hs-identifier hs-var">clas</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683036950"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; EvExpr
</span><a href="GHC.Core.Make.html#mkCharExpr"><span class="hs-identifier hs-var">mkCharExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621683036951"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-395"></span><span class="annot"><a href="GHC.Tc.Instance.Class.html#matchKnownChar"><span class="hs-identifier hs-var">matchKnownChar</span></a></span><span> </span><span id="local-6989586621683036953"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683036953"><span class="hs-identifier hs-var">df</span></a></span></span><span> </span><span id="local-6989586621683036954"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683036954"><span class="hs-identifier hs-var">sc</span></a></span></span><span> </span><span id="local-6989586621683036955"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683036955"><span class="hs-identifier hs-var">clas</span></a></span></span><span> </span><span id="local-6989586621683036956"><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683036956"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool -&gt; Class -&gt; [PredType] -&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#matchInstEnv"><span class="hs-identifier hs-var">matchInstEnv</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683036953"><span class="hs-identifier hs-var">df</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683036954"><span class="hs-identifier hs-var">sc</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683036955"><span class="hs-identifier hs-var">clas</span></a></span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683036956"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-396"></span><span> </span><span class="hs-comment">-- See Note [Fabricating Evidence for Literals in Backpack] for why</span><span>
</span><span id="line-397"></span><span> </span><span class="hs-comment">-- this lookup into the instance environment is required.</span><span>
</span><span id="line-398"></span><span>
</span><span id="line-399"></span><span class="annot"><a href="GHC.Tc.Instance.Class.html#makeLitDict"><span class="hs-identifier hs-type">makeLitDict</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvExpr"><span class="hs-identifier hs-type">EvExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#ClsInstResult"><span class="hs-identifier hs-type">ClsInstResult</span></a></span><span>
</span><span id="line-400"></span><span class="hs-comment">-- makeLitDict adds a coercion that will convert the literal into a dictionary</span><span>
</span><span id="line-401"></span><span class="hs-comment">-- of the appropriate type.  See Note [KnownNat &amp; KnownSymbol and EvLit].</span><span>
</span><span id="line-402"></span><span class="hs-comment">-- The coercion happens in 2 steps:</span><span>
</span><span id="line-403"></span><span class="hs-comment">--</span><span>
</span><span id="line-404"></span><span class="hs-comment">--     Integer -&gt; SNat n     -- representation of literal to singleton</span><span>
</span><span id="line-405"></span><span class="hs-comment">--     SNat n  -&gt; KnownNat n -- singleton to dictionary</span><span>
</span><span id="line-406"></span><span class="hs-comment">--</span><span>
</span><span id="line-407"></span><span class="hs-comment">--     The process is mirrored for Symbols:</span><span>
</span><span id="line-408"></span><span class="hs-comment">--     String    -&gt; SSymbol n</span><span>
</span><span id="line-409"></span><span class="hs-comment">--     SSymbol n -&gt; KnownSymbol n</span><span>
</span><span id="line-410"></span><span id="makeLitDict"><span class="annot"><span class="annottext">makeLitDict :: Class -&gt; PredType -&gt; EvExpr -&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#makeLitDict"><span class="hs-identifier hs-var hs-var">makeLitDict</span></a></span></span><span> </span><span id="local-6989586621683036957"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683036957"><span class="hs-identifier hs-var">clas</span></a></span></span><span> </span><span id="local-6989586621683036958"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683036958"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683036959"><span class="annot"><span class="annottext">EvExpr
</span><a href="#local-6989586621683036959"><span class="hs-identifier hs-var">et</span></a></span></span><span>
</span><span id="line-411"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PredType
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683036960"><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621683036960"><span class="hs-identifier hs-var">co_dict</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [PredType] -&gt; Maybe (PredType, TcCoercion)
</span><a href="GHC.Tc.Instance.Family.html#tcInstNewTyCon_maybe"><span class="hs-identifier hs-var">tcInstNewTyCon_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; TyCon
</span><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier hs-var">classTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683036957"><span class="hs-identifier hs-var">clas</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683036958"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-412"></span><span>          </span><span class="hs-comment">-- co_dict :: KnownNat n ~ SNat n</span><span>
</span><span id="line-413"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span> </span><span id="local-6989586621683036961"><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621683036961"><span class="hs-identifier hs-var">meth</span></a></span></span><span> </span><span class="hs-special">]</span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Class -&gt; [DFunId]
</span><a href="GHC.Core.Class.html#classMethods"><span class="hs-identifier hs-var">classMethods</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683036957"><span class="hs-identifier hs-var">clas</span></a></span><span>
</span><span id="line-414"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683036963"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683036963"><span class="hs-identifier hs-var">tcRep</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PredType -&gt; Maybe TyCon
</span><a href="GHC.Core.Type.html#tyConAppTyCon_maybe"><span class="hs-identifier hs-var">tyConAppTyCon_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DFunId -&gt; PredType
</span><a href="GHC.Core.Predicate.html#classMethodTy"><span class="hs-identifier hs-var">classMethodTy</span></a></span><span> </span><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621683036961"><span class="hs-identifier hs-var">meth</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-415"></span><span>                    </span><span class="hs-comment">-- If the method type is forall n. KnownNat n =&gt; SNat n</span><span>
</span><span id="line-416"></span><span>                    </span><span class="hs-comment">-- then tcRep is SNat</span><span>
</span><span id="line-417"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PredType
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683036966"><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621683036966"><span class="hs-identifier hs-var">co_rep</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [PredType] -&gt; Maybe (PredType, TcCoercion)
</span><a href="GHC.Tc.Instance.Family.html#tcInstNewTyCon_maybe"><span class="hs-identifier hs-var">tcInstNewTyCon_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683036963"><span class="hs-identifier hs-var">tcRep</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683036958"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-418"></span><span>          </span><span class="hs-comment">-- SNat n ~ Integer</span><span>
</span><span id="line-419"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683036967"><span class="annot"><span class="annottext">ev_tm :: EvTerm
</span><a href="#local-6989586621683036967"><span class="hs-identifier hs-var hs-var">ev_tm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvExpr -&gt; TcCoercion -&gt; EvTerm
</span><a href="GHC.Tc.Types.Evidence.html#mkEvCast"><span class="hs-identifier hs-var">mkEvCast</span></a></span><span> </span><span class="annot"><span class="annottext">EvExpr
</span><a href="#local-6989586621683036959"><span class="hs-identifier hs-var">et</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcCoercion -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; TcCoercion -&gt; TcCoercion -&gt; TcCoercion
TcCoercion -&gt; TcCoercion -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621683036960"><span class="hs-identifier hs-var">co_dict</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621683036966"><span class="hs-identifier hs-var">co_rep</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-420"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClsInstResult -&gt; TcM ClsInstResult
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ClsInstResult -&gt; TcM ClsInstResult)
-&gt; ClsInstResult -&gt; TcM ClsInstResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#OneInst"><span class="hs-identifier hs-type">OneInst</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cir_new_theta :: [PredType]
</span><a href="GHC.Tc.Instance.Class.html#cir_new_theta"><span class="hs-identifier hs-var">cir_new_theta</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-421"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cir_mk_ev :: [EvExpr] -&gt; EvTerm
</span><a href="GHC.Tc.Instance.Class.html#cir_mk_ev"><span class="hs-identifier hs-var">cir_mk_ev</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">[EvExpr]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621683036967"><span class="hs-identifier hs-var">ev_tm</span></a></span><span>
</span><span id="line-422"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cir_canonical :: CanonicalEvidence
</span><a href="GHC.Tc.Instance.Class.html#cir_canonical"><span class="hs-identifier hs-var">cir_canonical</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CanonicalEvidence
</span><a href="GHC.Core.InstEnv.html#EvCanonical"><span class="hs-identifier hs-var">EvCanonical</span></a></span><span>
</span><span id="line-423"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cir_what :: InstanceWhat
</span><a href="GHC.Tc.Instance.Class.html#cir_what"><span class="hs-identifier hs-var">cir_what</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InstanceWhat
</span><a href="GHC.Tc.Types.Origin.html#BuiltinInstance"><span class="hs-identifier hs-var">BuiltinInstance</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-424"></span><span>
</span><span id="line-425"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-426"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM ClsInstResult
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;makeLitDict&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcM ClsInstResult) -&gt; SDoc -&gt; TcM ClsInstResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-427"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Unexpected evidence for&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; Name
</span><a href="GHC.Core.Class.html#className"><span class="hs-identifier hs-var">className</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683036957"><span class="hs-identifier hs-var">clas</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-428"></span><span>      </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DFunId -&gt; SDoc) -&gt; [DFunId] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PredType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">(PredType -&gt; SDoc) -&gt; (DFunId -&gt; PredType) -&gt; DFunId -&gt; SDoc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">DFunId -&gt; PredType
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; [DFunId]
</span><a href="GHC.Core.Class.html#classMethods"><span class="hs-identifier hs-var">classMethods</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683036957"><span class="hs-identifier hs-var">clas</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-429"></span><span>
</span><span id="line-430"></span><span class="annot"><span class="hs-comment">{- ********************************************************************
*                                                                     *
                   Class lookup for WithDict
*                                                                     *
***********************************************************************-}</span></span><span>
</span><span id="line-435"></span><span>
</span><span id="line-436"></span><span class="hs-comment">-- See Note [withDict]</span><span>
</span><span id="line-437"></span><span class="annot"><a href="GHC.Tc.Instance.Class.html#matchWithDict"><span class="hs-identifier hs-type">matchWithDict</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#ClsInstResult"><span class="hs-identifier hs-type">ClsInstResult</span></a></span><span>
</span><span id="line-438"></span><span id="matchWithDict"><span class="annot"><span class="annottext">matchWithDict :: [PredType] -&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#matchWithDict"><span class="hs-identifier hs-var hs-var">matchWithDict</span></a></span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621683036973"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683036973"><span class="hs-identifier hs-var">cls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683036974"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683036974"><span class="hs-identifier hs-var">mty</span></a></span></span><span class="hs-special">]</span><span>
</span><span id="line-439"></span><span>    </span><span class="hs-comment">-- Check that cls is a class constraint `C t_1 ... t_n`, where</span><span>
</span><span id="line-440"></span><span>    </span><span class="hs-comment">-- `dict_tc = C` and `dict_args = t_1 ... t_n`.</span><span>
</span><span id="line-441"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683036975"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683036975"><span class="hs-identifier hs-var">dict_tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683036976"><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683036976"><span class="hs-identifier hs-var">dict_args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; PredType -&gt; Maybe (TyCon, [PredType])
PredType -&gt; Maybe (TyCon, [PredType])
</span><a href="GHC.Core.Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683036973"><span class="hs-identifier hs-var">cls</span></a></span><span>
</span><span id="line-442"></span><span>    </span><span class="hs-comment">-- Check that C is a class of the form</span><span>
</span><span id="line-443"></span><span>    </span><span class="hs-comment">-- `class C a_1 ... a_n where op :: meth_ty`</span><span>
</span><span id="line-444"></span><span>    </span><span class="hs-comment">-- and in that case let</span><span>
</span><span id="line-445"></span><span>    </span><span class="hs-comment">-- co :: C t1 ..tn ~R# inst_meth_ty</span><span>
</span><span id="line-446"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683036978"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683036978"><span class="hs-identifier hs-var">inst_meth_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683036979"><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621683036979"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [PredType] -&gt; Maybe (PredType, TcCoercion)
</span><a href="GHC.Tc.Instance.Family.html#tcInstNewTyCon_maybe"><span class="hs-identifier hs-var">tcInstNewTyCon_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683036975"><span class="hs-identifier hs-var">dict_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683036976"><span class="hs-identifier hs-var">dict_args</span></a></span><span>
</span><span id="line-447"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683036980"><span class="annot"><a href="#local-6989586621683036980"><span class="hs-identifier hs-var">sv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FastString
-&gt; PredType -&gt; PredType -&gt; IOEnv (Env TcGblEnv TcLclEnv) DFunId
forall (m :: * -&gt; *).
MonadUnique m =&gt;
FastString -&gt; PredType -&gt; PredType -&gt; m DFunId
</span><a href="GHC.Types.Id.html#mkSysLocalM"><span class="hs-identifier hs-var">mkSysLocalM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;withDict_s&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683036974"><span class="hs-identifier hs-var">mty</span></a></span><span>
</span><span id="line-448"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683036984"><span class="annot"><a href="#local-6989586621683036984"><span class="hs-identifier hs-var">k</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Types.Id.html#mkSysLocalM"><span class="hs-identifier hs-type">mkSysLocalM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-type">fsLit</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;withDict_k&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-type">ManyTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#mkInvisFunTy"><span class="hs-identifier hs-type">mkInvisFunTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683036973"><span class="hs-identifier hs-type">cls</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Types.Prim.html#openAlphaTy"><span class="hs-identifier hs-type">openAlphaTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-449"></span><span>
</span><span id="line-450"></span><span>       </span><span class="hs-comment">-- Given co2 : mty ~N# inst_meth_ty, construct the method of</span><span>
</span><span id="line-451"></span><span>       </span><span class="hs-comment">-- the WithDict dictionary:</span><span>
</span><span id="line-452"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-453"></span><span>       </span><span class="hs-comment">--   \@(r :: RuntimeRep) @(a :: TYPE r) (sv :: mty) (k :: cls =&gt; a) -&gt;</span><span>
</span><span id="line-454"></span><span>       </span><span class="hs-comment">--     k (sv |&gt; (sub co ; sym co2))</span><span>
</span><span id="line-455"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683036987"><span class="annot"><a href="#local-6989586621683036987"><span class="hs-identifier hs-var hs-var">evWithDict</span></a></span></span><span> </span><span id="local-6989586621683036988"><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621683036988"><span class="hs-identifier hs-var">co2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-456"></span><span>               </span><span class="annot"><span class="annottext">[DFunId] -&gt; EvExpr -&gt; EvExpr
</span><a href="GHC.Core.Make.html#mkCoreLams"><span class="hs-identifier hs-var">mkCoreLams</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">DFunId
</span><a href="GHC.Builtin.Types.Prim.html#runtimeRep1TyVar"><span class="hs-identifier hs-var">runtimeRep1TyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DFunId
</span><a href="GHC.Builtin.Types.Prim.html#openAlphaTyVar"><span class="hs-identifier hs-var">openAlphaTyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621683036980"><span class="hs-identifier hs-var">sv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621683036984"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(EvExpr -&gt; EvExpr) -&gt; EvExpr -&gt; EvExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-457"></span><span>                 </span><span class="annot"><span class="annottext">DFunId -&gt; EvExpr
forall b. DFunId -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621683036984"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-458"></span><span>                   </span><span class="annot"><span class="annottext">EvExpr -&gt; EvExpr -&gt; EvExpr
forall b. Expr b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#App"><span class="hs-operator hs-var">`App`</span></a></span><span>
</span><span id="line-459"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DFunId -&gt; EvExpr
forall b. DFunId -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621683036980"><span class="hs-identifier hs-var">sv</span></a></span><span> </span><span class="annot"><span class="annottext">EvExpr -&gt; TcCoercion -&gt; EvExpr
forall b. Expr b -&gt; TcCoercion -&gt; Expr b
</span><a href="GHC.Core.html#Cast"><span class="hs-operator hs-var">`Cast`</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; TcCoercion -&gt; TcCoercion -&gt; TcCoercion
TcCoercion -&gt; TcCoercion -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; TcCoercion -&gt; TcCoercion
TcCoercion -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkSubCo"><span class="hs-identifier hs-var">mkSubCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621683036988"><span class="hs-identifier hs-var">co2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcCoercion -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621683036979"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-460"></span><span>
</span><span id="line-461"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683036995"><span class="annot"><a href="#local-6989586621683036995"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcLookupTyCon"><span class="hs-identifier hs-type">tcLookupTyCon</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#withDictClassName"><span class="hs-identifier hs-type">withDictClassName</span></a></span><span>
</span><span id="line-462"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683036997"><span class="annot"><a href="#local-6989586621683036997"><span class="hs-identifier hs-var">withdict_data_con</span></a></span></span><span>
</span><span id="line-463"></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#tyConSingleDataCon_maybe"><span class="hs-identifier hs-type">tyConSingleDataCon_maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683036995"><span class="hs-identifier hs-type">tc</span></a></span><span>    </span><span class="hs-comment">-- &quot;Data constructor&quot;</span><span>
</span><span id="line-464"></span><span>                                                  </span><span class="hs-comment">-- for WithDict</span><span>
</span><span id="line-465"></span><span>             </span><span id="local-6989586621683036999"><span class="annot"><a href="#local-6989586621683036999"><span class="hs-identifier hs-var hs-var">mk_ev</span></a></span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621683037000"><span class="annot"><span class="annottext">EvExpr
</span><a href="#local-6989586621683037000"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [PredType] -&gt; [EvExpr] -&gt; EvTerm
</span><a href="GHC.Tc.Types.Evidence.html#evDataConApp"><span class="hs-identifier hs-var">evDataConApp</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683036997"><span class="hs-identifier hs-var">withdict_data_con</span></a></span><span>
</span><span id="line-466"></span><span>                            </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683036973"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683036974"><span class="hs-identifier hs-var">mty</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcCoercion -&gt; EvExpr
</span><a href="#local-6989586621683036987"><span class="hs-identifier hs-var">evWithDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvTerm -&gt; TcCoercion
</span><a href="GHC.Tc.Types.Evidence.html#evTermCoercion"><span class="hs-identifier hs-var">evTermCoercion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvExpr -&gt; EvTerm
</span><a href="GHC.Tc.Types.Evidence.html#EvExpr"><span class="hs-identifier hs-var">EvExpr</span></a></span><span> </span><span class="annot"><span class="annottext">EvExpr
</span><a href="#local-6989586621683037000"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-467"></span><span>             </span><span class="annot"><a href="#local-6989586621683036999"><span class="hs-identifier hs-var">mk_ev</span></a></span><span> </span><span id="local-6989586621683037004"><span class="annot"><span class="annottext">[EvExpr]
</span><a href="#local-6989586621683037004"><span class="hs-identifier hs-var">e</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; EvTerm
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;matchWithDict&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[EvExpr] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[EvExpr]
</span><a href="#local-6989586621683037004"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-468"></span><span>
</span><span id="line-469"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#OneInst"><span class="hs-identifier hs-type">OneInst</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#cir_new_theta"><span class="hs-identifier hs-var">cir_new_theta</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.Coercion.html#mkPrimEqPred"><span class="hs-identifier hs-type">mkPrimEqPred</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683036974"><span class="hs-identifier hs-type">mty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683036978"><span class="hs-identifier hs-type">inst_meth_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-470"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#cir_mk_ev"><span class="hs-identifier hs-var">cir_mk_ev</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683036999"><span class="hs-identifier hs-type">mk_ev</span></a></span><span>
</span><span id="line-471"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#cir_canonical"><span class="hs-identifier hs-var">cir_canonical</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#EvNonCanonical"><span class="hs-identifier hs-type">EvNonCanonical</span></a></span><span> </span><span class="hs-comment">-- See (WD6) in Note [withDict]</span><span>
</span><span id="line-472"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#cir_what"><span class="hs-identifier hs-var">cir_what</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#BuiltinInstance"><span class="hs-identifier hs-type">BuiltinInstance</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-473"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-474"></span><span>
</span><span id="line-475"></span><span class="annot"><a href="GHC.Tc.Instance.Class.html#matchWithDict"><span class="hs-identifier hs-var">matchWithDict</span></a></span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-476"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClsInstResult -&gt; TcM ClsInstResult
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#NoInstance"><span class="hs-identifier hs-var">NoInstance</span></a></span><span>
</span><span id="line-477"></span><span>
</span><span id="line-478"></span><span class="hs-comment">{-
Note [withDict]
~~~~~~~~~~~~~~~
The class `WithDict` is defined as:

    class WithDict cls meth where
        withDict :: forall {rr :: RuntimeRep} (r :: TYPE rr). meth -&gt; (cls =&gt; r) -&gt; r

This class is special, like `Typeable`: GHC automatically solves
for instances of `WithDict`, users cannot write their own.

It is used to implement a primitive that we cannot define in Haskell
but we can write in Core.

`WithDict` is used to create dictionaries for classes with a single method.
Consider a class like this:

   class C a where
     f :: T a

We can use `withDict` to cast values of type `T a` into dictionaries for `C a`.
To do this, we can define a function like this in the library:

  withT :: T a -&gt; (C a =&gt; b) -&gt; b
  withT t k = withDict @(C a) @(T a) t k

Here:

* The `cls` in `withDict` is instantiated to `C a`.

* The `meth` in `withDict` is instantiated to `T a`.
  The definition of `T` itself is irrelevant, only that `C a` is a class
  with a single method of type `T a`.

* The `r` in `withDict` is instantiated to `b`.

For any single-method class C:
   class C a1 .. an where op :: meth_ty

The solver will solve the constraint `WithDict (C t1 .. tn) mty`
as if the following instance declaration existed:

instance (mty ~# inst_meth_ty) =&gt; WithDict (C t1..tn) mty where
  withDict = \@{rr} @(r :: TYPE rr) (sv :: mty) (k :: C t1..tn =&gt; r) -&gt;
    k (sv |&gt; (sub co2 ; sym co))

That is, it matches on the first (constraint) argument of C; if C is
a single-method class, the instance &quot;fires&quot; and emits an equality
constraint `mty ~ inst_meth_ty`, where `inst_meth_ty` is `meth_ty[ti/ai]`.
The coercion `co2` witnesses the equality `mty ~ inst_meth_ty`.

The coercion `co` is a newtype coercion that coerces from `C t1 ... tn`
to `inst_meth_ty`.
This coercion is guaranteed to exist by virtue of the fact that
C is a class with exactly one method and no superclasses, so it
is treated like a newtype when compiled to Core.

The condition that `C` is a single-method class is implemented in the
guards of matchWithDict's definition.
If the conditions are not held, the rewriting will not fire,
and we'll report an unsolved constraint.

Some further observations about `withDict`:

(WD1) The `cls` in the type of withDict must be explicitly instantiated with
      visible type application, as invoking `withDict` would be ambiguous
      otherwise.

      For examples of how `withDict` is used in the `base` library, see `withSNat`
      in GHC.TypeNats, as well as `withSChar` and `withSSymbol` in GHC.TypeLits.

(WD2) The `r` is representation-polymorphic, to support things like
      `withTypeable` in `Data.Typeable.Internal`.

(WD3) As an alternative to `withDict`, one could define functions like `withT`
      above in terms of `unsafeCoerce`. This is more error-prone, however.

(WD4) In order to define things like `withKnownNat` below:

        withKnownNat :: SNat n -&gt; (KnownNat n =&gt; r) -&gt; r

      `withDict` needs to be instantiated with `Any`, like so:

        withKnownNat = withDict @(KnownNat Any) @(SNat Any) @r

      The use of `Any` is explained in Note [NOINLINE withSomeSNat] in
      base:GHC.TypeNats.

(WD5) In earlier implementations, `withDict` was implemented as an identifier
      with special handling during either constant-folding or desugaring.
      The current approach is more robust: previously, the type of `withDict`
      did not have a type-class constraint and was overly polymorphic.
      See #19915.

(WD6) In fact, we desugar `withDict @cls @mty @{rr} @r` to

         \@(r :: RuntimeRep) @(a :: TYPE r) (sv :: mty) (k :: cls =&gt; a) -&gt;
           k (sv |&gt; (sub co2 ; sym co)))

      That is, we cast the method using a coercion, and apply k to
      it. Moreover, we mark the evidence as non-canonical, resulting in
      the use of the 'nospec' magicId (see Note [nospecId magic] in
      GHC.Types.Id.Make) to ensure that the typeclass specialiser
      doesn't incorrectly common-up distinct evidence terms. This is
      super important! Suppose we have calls

          withDict A k
          withDict B k

      where k1, k2 :: C T -&gt; blah.  If we desugared withDict naively, we'd get

          k (A |&gt; co1)
          k (B |&gt; co2)

      and the Specialiser would assume that those arguments (of type `C T`) are
      the same. It would then specialise `k` for that type, and then call the same,
      specialised function from both call sites.  #21575 is a concrete case in point.

      To avoid this, we need to stop the typeclass specialiser from seeing this
      structure, by using nospec. This function is inlined only in CorePrep; crucially
      this means that it still appears in interface files, so that the desugaring of
      withDict remains opaque to the typeclass specialiser across modules.
      This means the specialiser will always see instead:

          nospec @(cls =&gt; a) k (A |&gt; co1)
          nospec @(cls =&gt; a) k (B |&gt; co2)

      Why does this work? Recall that nospec is not an overloaded function;
      it has the type

        nospec :: forall a. a -&gt; a

      This means that there is nothing for the specialiser to do with function calls
      such as

        nospec @(cls =&gt; a) k (A |&gt; co)

      as the specialiser only looks at calls of the form `f dict` for an
      overloaded function `f` (e.g. with a type such as `f :: Eq a =&gt; ...`).

      See test-case T21575b.



Note [DataToTag overview]
~~~~~~~~~~~~~~~~~~~~~~~~~
Class `DataToTag` is defined like this, in GHC.Magic:

  type DataToTag :: forall {lev :: Levity}.
                    TYPE (BoxedRep lev) -&gt; Constraint
  class DataToTag a where
     dataToTag# :: a -&gt; Int#

`dataToTag#`, evaluates its argument and returns the index of the data
constructor used to build that argument.  Clearly, `dataToTag#` cannot
work on /any/ type, only on data types, hence the type-class constraint.

Users cannot define instances of `DataToTag`
(see `GHC.Tc.Validity.check_special_inst_head`).
Instead, GHC's constraint solver has built-in solving behaviour,
 implemented in `GHC.Tc.Instance.Class.matchGlobalInst`.

(#20441: This common handling of special typeclasses is a bit of a
mess and could use some love, and a dedicated Note.)

GHC solves a wanted constraint `DataToTag @{lev} dty`
when all of the following conditions are met:

C1: `dty` is an algebraic data type, i.e. `dty` matches any of:
       * a &quot;data&quot; declaration,
       * a &quot;data instance&quot; declaration,
       * a boxed tuple type
      &quot;type data&quot; declarations are NOT included; see also wrinkle W2c
      of Note [Type data declarations] in GHC.Rename.Module.
      (In principle we could accept newtypes that wrap algebraic data
      types, but we do not do so.)

C2: All of the constructors of that &quot;data&quot; or &quot;data instance&quot;
      declaration are in scope.  Otherwise, `dataToTag#` could be
      used to peek behind the curtain when used with an abstract
      data type whose constructors are intentionally hidden.

C3: `lev` is statically known, either Lifted or Unlifted:
      Otherwise the argument to `dataToTag#` would be
      representation-polymorphic and we couldn't do anything
      with it without Core Lint rightfully complaining.
      This guarantees invariant (DTT1) below.

It would be possible for GHC to generate custom code for each type, like
this:

   instance DataToTag [a] where
     dataToTag# []    = 0#
     dataToTag# (_:_) = 1#

But, to avoid all this boilerplate code, and improve optimisation opportunities,
GHC generates instances like this:

   instance DataToTag [a] where
     dataToTag# = dataToTagSmall#

using one of two dedicated primops: `dataToTagSmall#` and `dataToTagLarge#`.
(Why two primops? What's the difference? See wrinkles DTW4 and DTW5.)
Both primops have the following over-polymorphic type:

  dataToTagLarge# :: forall {l::levity} (a::TYPE (BoxedRep l)). a -&gt; Int#

Every call to either primop that we generate should look like
(dataToTagSmall# @{lev} @ty) with two type arguments that satisfy
these conditions:

(DTT1) `lev` is concrete (either lifted or unlifted), not polymorphic.
   This is an invariant--we must satisfy this or Core Lint will complain.
   (This falls under situation 1 in GHC.Core.Lint's
   Note [Linting representation-polymorphic builtins].)

(DTT2) `ty` is always headed by a TyCon corresponding to one of the following:
   * A boxed tuple
   * A &quot;data&quot; declaration (but NOT a &quot;type data&quot; declaration)
   * The /representation type/ for a &quot;data instance&quot; declaration
     (but NOT the data family TyCon itself)

   This ensures that the DataCons associated with `ty` are easily
   accessible and safe to use in Core without running afoul of
   invariant I1 from Note [Type data declarations] in
   GHC.Rename.Module.  See Note [caseRules for dataToTag] in
   GHC.Core.Opt.ConstantFold for why this matters.

   While wrinkle DTW7 is unresolved, this cannot be a true invariant.
   But with a little effort we can ensure that every primop
   call we generate in a DataToTag instance satisfies this condition.

(DTT3) If the TyCon in wrinkle DTT2 is a &quot;large data type&quot; with more
   constructors than fit in pointer tags on the target, then the
   primop must be dataToTagLarge# and not dataToTagSmall#.
   Otherwise, the primop must be dataToTagSmall# and not dataToTagLarge#.
   (See wrinkles DTW4 and DTW5.)

These two primops have special handling in several parts of
the compiler:

H1. They have a couple of built-in rewrite rules, implemented in
    GHC.Core.Opt.ConstantFold.dataToTagRule

H2. The simplifier rewrites most case expressions scrutinizing their results.
    See Note [caseRules for dataToTag] in GHC.Core.Opt.ConstantFold.

H3. Each evaluates its argument.  But we want to omit this eval when the
    actual argument is already evaluated and properly tagged.  To do this,

    * We have a special case in GHC.Stg.InferTags.Rewrite.rewriteOpApp
      ensuring that any inferred tag information on the argument is
      retained until code generation.

    * We generate code via special cases in GHC.StgToCmm.Expr.cgExpr
      instead of with the other primops in GHC.StgToCmm.Prim.emitPrimOp;
      tag info is not readily available in the latter function.
      (Wrinkle DTW4 describes what we generate after the eval.)

Wrinkles:

(DTW1) To guarantee (DTT2) we need to take care with data families.
  Consider  data family D a
            data instance D (Either p q) = D1 | D2 p q
  To solve the constraint
     [W] DataToTag (D (Either t1 t2))
  GHC uses the built-in instance
     instance DataToTag (D (Either p q)) where
        dataToTag# x = dataToTagSmall# @Lifted @(R:DEither p q)
                                       (x |&gt; sym (ax:DEither p q))
  where `ax:DEither` is the axiom arising from the `data instance`:
    ax:DEither p q :: D (Either p q) ~ R:DEither p q

  Notice that we cast `x` before giving it to `dataToTagSmall#`, so
  that (DTT2) is satisfied.

(DTW2) Suppose we have module A (T(..)) where { data T = TCon }
  and in module B, the constraint `DataToTag T` is needed. Per
  condition C2, we only solve this constraint if `TCon` is in
  scope.  So we had better not later report a warning about the
  import of `TCon` being unused in module B!

  To avoid this simply call `addUsedDataCons` when creating a built-in
  DataToTag instance.

(DTW3) Similar to DTW2, consider this example:

    {-# LANGUAGE MagicHash #-}
    module A (X(X2, X3), g) where
    -- see also testsuite/tests/warnings/should_compile/DataToTagWarnings.hs
    import GHC.Exts (dataToTag#, Int#)
    data X = X1 | X2 | X3 | X4
    g :: X -&gt; Int#
    g X2 = 12#
    g v = dataToTag# v

  QUESTION: What warnings should be emitted with -Wunused-top-binds?

  The X1 and X4 constructors are used only in the solving of a
  `DataToTag X` constraint in the second equation for `g`.  But if
  these constructors were just removed, they would not be needed for
  the solving of that `DataToTag X` constraint!  So for now we take
  the stance that both X1 and X4 should be reported as unused.

  It's not entirely clear if this is the right behavior:
  Notice that removing X1 changes the value of `g X3` from 2# to 1#.
  (Removing X4 causes no observable change in behavior.)
  But this is a very obscure program!  The current &quot;warn about both&quot;
  approach is not obviously wrong, either, and is consistent with the
  behavior of derived Ix instances.

  To get these warnings, we do nothing; in particular we do not call
  keepAlive on the constructor names.
  (Contrast with Note [Unused name reporting and HasField].)

(DTW4) Why have two primops, `dataToTagSmall#` and `dataToTagLarge#`?
  The way tag information is stored at runtime is described in
  Note [Tagging big families] in GHC.StgToCmm.Expr.  In particular,
  for &quot;big data types&quot; we must consult the heap object's info table at
  least in the mAX_PTR_TAG case, while for &quot;small data types&quot; we can
  always just examine the tag bits on the pointer itself. So:

  * dataToTagSmall# consults the tag bits in the pointer, ignoring the
    info table.  It should, therefore, be used only for data type with
    few enough constructors that the tag always fits in the pointer.

  * dataToTagLarge# also consults the tag bits in the pointer, but
    must fall back to examining the info table whenever those tag
    bits are equal to mAX_PTR_TAG.

  One could imagine having one primop with a small/large tag, or just
  the data type width, but the PrimOp data type is not currently set
  up for that.  Looking at the type information on the argument during
  code generation is also possible, but would be less reliable.
  Remember: type information is not always preserved in STG.

(DTW5) How do the two primops differ in their semantics?  We consider
  a call `dataToTagSmall# x` to result in undefined behavior whenever
  the target supports pointer tagging but the actual constructor index
  for `x` is too large to fit in the pointer's tag bits.  Otherwise,
  `dataToTagSmall#` behaves identically to `dataToTagLarge#`.

  This allows the rewrites performed in GHC.Core.Opt.ConstantFold to
  safely treat `dataToTagSmall#` identically to `dataToTagLarge#`:
  the allowed program behaviors for the former is always a superset of
  the allowed program behaviors for the latter.

  This undefined behavior is only observable if a user writes a
  wrongly-sized primop call.  The calls we generate are properly-sized
  (condition DTT3 above) so that the type system protects us.

(DTW6) We make no promises about the primops used to implement
  DataToTag instances.  Changes to GHC's representation of algebraic
  data types at runtime may force us to redesign these primops.
  Indeed, accommodating such changes without breaking users of the
  original (no longer existing) &quot;dataToTag#&quot; primop is one of the
  main reasons the DataToTag class exists!

  In particular, our current two primop implementations (as described
  in wrinkle DTW4) are adequate for every DataToTag instance only
  because every Haskell-land data constructor use gets translated to
  its own &quot;real&quot; heap or static data object at runtime and the index
  of that constructor is always exposed via pointer tagging and via
  the object's info table.

(DTW7) Currently, the generated module GHC.PrimopWrappers in ghc-prim
  contains the following non-sense definitions:

    {-# NOINLINE dataToTagSmall# #-}
    dataToTagSmall# :: a_levpoly -&gt; Int#
    dataToTagSmall# a1 = GHC.Prim.dataToTagSmall# a1
    {-# NOINLINE dataToTagLarge# #-}
    dataToTagLarge# :: a_levpoly -&gt; Int#
    dataToTagLarge# a1 = GHC.Prim.dataToTagLarge# a1

  Why do these exist? GHCi uses these symbols for... something.  There
  is on-going work to get rid of them.  See also #24169, #20155, and !6245.
  Their continued existence makes it difficult to do several nice things:

   * As explained in DTW6, the dataToTag# primops are very internal.
     We would like to hide them from GHC.Prim entirely to prevent
     their mis-use, but doing so would cause GHC.PrimopWrappers to
     fail to compile.

   * The primops are applied at the (confusingly monomorphic) type
     variable `a_levpoly` in the above definitions.  In particular,
     they do not satisfy conditions DTT2 and DTT3 above.  We would
     very much like these conditions to be invariants, but while
     GHC.PrimopWrappers breaks them we cannot do so.  (The code that
     would check these invariants in Core Lint exists but remains
     commented out for now.)

   * This in turn means that `GHC.Core.Opt.ConstantFold.caseRules`
     must check for condition DTT2 before doing the work described in
     Note [caseRules for dataToTag].

   * Likewise, wrinkle DTW5 is only necessary because condition DTT3
     is not an invariant.  Otherwise, invoking the currently-specified
     undefined behavior of `dataToTagSmall# @ty` would require passing it
     an argument which will not really have type `ty` at runtime.  And
     evaluating such an expression is always undefined behavior anyway!



Historical note:
During its time as a primop, `dataToTag#` underwent several changes,
mostly relating to under what circumstances it evaluates its argument.
Today, that story is simple: A dataToTag primop always evaluates its
argument, unless tag inference determines the argument was already
evaluated and correctly tagged.  Getting here was a long journey, with
many similarities to the story behind Note [Strict Field Invariant] in
GHC.Stg.InferTags.  See also #15696.

-}</span><span>
</span><span id="line-892"></span><span>
</span><span id="line-893"></span><span>
</span><span id="line-894"></span><span class="annot"><span class="hs-comment">{- ********************************************************************
*                                                                     *
                   Class lookup for DataToTag
*                                                                     *
***********************************************************************-}</span></span><span>
</span><span id="line-899"></span><span>
</span><span id="line-900"></span><span class="annot"><a href="GHC.Tc.Instance.Class.html#matchDataToTag"><span class="hs-identifier hs-type">matchDataToTag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#ClsInstResult"><span class="hs-identifier hs-type">ClsInstResult</span></a></span><span>
</span><span id="line-901"></span><span class="hs-comment">-- See Note [DataToTag overview]</span><span>
</span><span id="line-902"></span><span id="matchDataToTag"><span class="annot"><span class="annottext">matchDataToTag :: Class -&gt; [PredType] -&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#matchDataToTag"><span class="hs-identifier hs-var hs-var">matchDataToTag</span></a></span></span><span> </span><span id="local-6989586621683037007"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683037007"><span class="hs-identifier hs-var">dataToTagClass</span></a></span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621683037008"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037008"><span class="hs-identifier hs-var">levity</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683037009"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037009"><span class="hs-identifier hs-var">dty</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-903"></span><span>  </span><span id="local-6989586621683037010"><span class="annot"><a href="#local-6989586621683037010"><span class="hs-identifier hs-var">famEnvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM FamInstEnvs
</span><a href="GHC.Tc.Instance.Family.html#tcGetFamInstEnvs"><span class="hs-identifier hs-var">tcGetFamInstEnvs</span></a></span><span>
</span><span id="line-904"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621683037011"><span class="annot"><a href="#local-6989586621683037011"><span class="hs-identifier hs-var">gbl_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683037012"><span class="annot"><a href="#local-6989586621683037012"><span class="hs-identifier hs-var">_lcl_env</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getEnvs"><span class="hs-identifier hs-type">getEnvs</span></a></span><span>
</span><span id="line-905"></span><span>  </span><span id="local-6989586621683037014"><span class="annot"><a href="#local-6989586621683037014"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#getPlatform"><span class="hs-identifier hs-type">getPlatform</span></a></span><span>
</span><span id="line-906"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Core.Type.html#isConcreteType"><span class="hs-identifier hs-type">isConcreteType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037008"><span class="hs-identifier hs-type">levity</span></a></span><span> </span><span class="hs-comment">-- condition C3</span><span>
</span><span id="line-907"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683037017"><span class="annot"><a href="#local-6989586621683037017"><span class="hs-identifier hs-var">rawTyCon</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683037018"><span class="annot"><a href="#local-6989586621683037018"><span class="hs-identifier hs-var">rawTyConArgs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Core.Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-type">tcSplitTyConApp_maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037009"><span class="hs-identifier hs-type">dty</span></a></span><span>
</span><span id="line-908"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683037019"><span class="annot"><a href="#local-6989586621683037019"><span class="hs-identifier hs-var">repTyCon</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683037020"><span class="annot"><a href="#local-6989586621683037020"><span class="hs-identifier hs-var">repArgs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683037021"><span class="annot"><a href="#local-6989586621683037021"><span class="hs-identifier hs-var">repCo</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-909"></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html#tcLookupDataFamInst"><span class="hs-identifier hs-type">tcLookupDataFamInst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037010"><span class="hs-identifier hs-type">famEnvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037017"><span class="hs-identifier hs-type">rawTyCon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037018"><span class="hs-identifier hs-type">rawTyConArgs</span></a></span><span>
</span><span id="line-910"></span><span>
</span><span id="line-911"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#isTypeDataTyCon"><span class="hs-identifier hs-type">isTypeDataTyCon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037019"><span class="hs-identifier hs-type">repTyCon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-912"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683037023"><span class="annot"><a href="#local-6989586621683037023"><span class="hs-identifier hs-var">constrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#tyConAlgDataCons_maybe"><span class="hs-identifier hs-type">tyConAlgDataCons_maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037019"><span class="hs-identifier hs-type">repTyCon</span></a></span><span>
</span><span id="line-913"></span><span>         </span><span class="hs-comment">-- condition C1</span><span>
</span><span id="line-914"></span><span>
</span><span id="line-915"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span>  </span><span id="local-6989586621683037025"><span class="annot"><a href="#local-6989586621683037025"><span class="hs-identifier hs-var hs-var">rdr_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; GlobalRdrEnv
</span><a href="GHC.Tc.Types.html#tcg_rdr_env"><span class="hs-identifier hs-var">tcg_rdr_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683037011"><span class="hs-identifier hs-var">gbl_env</span></a></span><span>
</span><span id="line-916"></span><span>            </span><span id="local-6989586621683037027"><span class="annot"><a href="#local-6989586621683037027"><span class="hs-identifier hs-var hs-var">inScope</span></a></span></span><span> </span><span id="local-6989586621683037028"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683037028"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (GlobalRdrEltX GREInfo) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (GlobalRdrEltX GREInfo) -&gt; Bool)
-&gt; Maybe (GlobalRdrEltX GREInfo) -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; Name -&gt; Maybe (GlobalRdrEltX GREInfo)
forall info.
Outputable info =&gt;
GlobalRdrEnvX info -&gt; Name -&gt; Maybe (GlobalRdrEltX info)
</span><a href="GHC.Types.Name.Reader.html#lookupGRE_Name"><span class="hs-identifier hs-var">lookupGRE_Name</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683037025"><span class="hs-identifier hs-var">rdr_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Maybe (GlobalRdrEltX GREInfo))
-&gt; Name -&gt; Maybe (GlobalRdrEltX GREInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Name
</span><a href="GHC.Core.DataCon.html#dataConName"><span class="hs-identifier hs-var">dataConName</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683037028"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-917"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">all</span></span><span> </span><span class="annot"><a href="#local-6989586621683037027"><span class="hs-identifier hs-type">inScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037023"><span class="hs-identifier hs-type">constrs</span></a></span><span> </span><span class="hs-comment">-- condition C2</span><span>
</span><span id="line-918"></span><span>
</span><span id="line-919"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span>  </span><span id="local-6989586621683037033"><span class="annot"><a href="#local-6989586621683037033"><span class="hs-identifier hs-var hs-var">repTy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [PredType] -&gt; PredType
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683037019"><span class="hs-identifier hs-var">repTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683037020"><span class="hs-identifier hs-var">repArgs</span></a></span><span>
</span><span id="line-920"></span><span>            </span><span id="local-6989586621683037035"><span class="annot"><a href="#local-6989586621683037035"><span class="hs-identifier hs-var hs-var">numConstrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Int
</span><a href="GHC.Core.TyCon.html#tyConFamilySize"><span class="hs-identifier hs-var">tyConFamilySize</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683037019"><span class="hs-identifier hs-var">repTyCon</span></a></span><span>
</span><span id="line-921"></span><span>            </span><span class="hs-glyph">!</span><span id="local-6989586621683037037"><span class="annot"><a href="#local-6989586621683037037"><span class="hs-identifier hs-var hs-var">whichOp</span></a></span></span><span> </span><span class="hs-comment">-- see wrinkle DTW4</span><span>
</span><span id="line-922"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Int -&gt; Bool
</span><a href="GHC.StgToCmm.Closure.html#isSmallFamily"><span class="hs-identifier hs-var">isSmallFamily</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621683037014"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683037035"><span class="hs-identifier hs-var">numConstrs</span></a></span><span>
</span><span id="line-923"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; DFunId
</span><a href="GHC.Builtin.PrimOps.Ids.html#primOpId"><span class="hs-identifier hs-var">primOpId</span></a></span><span> </span><span class="annot"><span class="annottext">PrimOp
</span><a href="GHC.Builtin.PrimOps.html#DataToTagSmallOp"><span class="hs-identifier hs-var">DataToTagSmallOp</span></a></span><span>
</span><span id="line-924"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-925"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; DFunId
</span><a href="GHC.Builtin.PrimOps.Ids.html#primOpId"><span class="hs-identifier hs-var">primOpId</span></a></span><span> </span><span class="annot"><span class="annottext">PrimOp
</span><a href="GHC.Builtin.PrimOps.html#DataToTagLargeOp"><span class="hs-identifier hs-var">DataToTagLargeOp</span></a></span><span>
</span><span id="line-926"></span><span>
</span><span id="line-927"></span><span>            </span><span class="hs-comment">-- See wrinkle DTW1; we must apply the underlying</span><span>
</span><span id="line-928"></span><span>            </span><span class="hs-comment">-- operation at the representation type and cast it</span><span>
</span><span id="line-929"></span><span>            </span><span id="local-6989586621683037040"><span class="annot"><a href="#local-6989586621683037040"><span class="hs-identifier hs-var hs-var">methodRep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DFunId -&gt; EvExpr
forall b. DFunId -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621683037037"><span class="hs-identifier hs-var">whichOp</span></a></span><span> </span><span class="annot"><span class="annottext">EvExpr -&gt; EvExpr -&gt; EvExpr
forall b. Expr b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#App"><span class="hs-operator hs-var">`App`</span></a></span><span> </span><span class="annot"><span class="annottext">PredType -&gt; EvExpr
forall b. PredType -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037008"><span class="hs-identifier hs-var">levity</span></a></span><span> </span><span class="annot"><span class="annottext">EvExpr -&gt; EvExpr -&gt; EvExpr
forall b. Expr b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#App"><span class="hs-operator hs-var">`App`</span></a></span><span> </span><span class="annot"><span class="annottext">PredType -&gt; EvExpr
forall b. PredType -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037033"><span class="hs-identifier hs-var">repTy</span></a></span><span>
</span><span id="line-930"></span><span>            </span><span id="local-6989586621683037042"><span class="annot"><a href="#local-6989586621683037042"><span class="hs-identifier hs-var hs-var">methodCo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
-&gt; FunTyFlag
-&gt; TcCoercion
-&gt; TcCoercion
-&gt; TcCoercion
-&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkFunCo"><span class="hs-identifier hs-var">mkFunCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span>
</span><span id="line-931"></span><span>                               </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="GHC.Types.Var.html#FTF_T_T"><span class="hs-identifier hs-var">FTF_T_T</span></a></span><span>
</span><span id="line-932"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PredType -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-933"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcCoercion -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621683037021"><span class="hs-identifier hs-var">repCo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-934"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; PredType -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="GHC.Builtin.Types.Prim.html#intPrimTy"><span class="hs-identifier hs-var">intPrimTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-935"></span><span>            </span><span id="local-6989586621683037049"><span class="annot"><a href="#local-6989586621683037049"><span class="hs-identifier hs-var hs-var">dataToTagDataCon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; DataCon
</span><a href="GHC.Core.TyCon.html#tyConSingleDataCon"><span class="hs-identifier hs-var">tyConSingleDataCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; TyCon
</span><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier hs-var">classTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683037007"><span class="hs-identifier hs-var">dataToTagClass</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-936"></span><span>            </span><span id="local-6989586621683037050"><span class="annot"><a href="#local-6989586621683037050"><span class="hs-identifier hs-var hs-var">mk_ev</span></a></span></span><span> </span><span class="annot"><span class="annottext">[EvExpr]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [PredType] -&gt; [EvExpr] -&gt; EvTerm
</span><a href="GHC.Tc.Types.Evidence.html#evDataConApp"><span class="hs-identifier hs-var">evDataConApp</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683037049"><span class="hs-identifier hs-var">dataToTagDataCon</span></a></span><span>
</span><span id="line-937"></span><span>                                   </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037008"><span class="hs-identifier hs-var">levity</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037009"><span class="hs-identifier hs-var">dty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-938"></span><span>                                   </span><span class="hs-special">[</span><span class="annot"><span class="annottext">EvExpr
</span><a href="#local-6989586621683037040"><span class="hs-identifier hs-var">methodRep</span></a></span><span> </span><span class="annot"><span class="annottext">EvExpr -&gt; TcCoercion -&gt; EvExpr
forall b. Expr b -&gt; TcCoercion -&gt; Expr b
</span><a href="GHC.Core.html#Cast"><span class="hs-operator hs-var">`Cast`</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621683037042"><span class="hs-identifier hs-var">methodCo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-939"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#addUsedDataCons"><span class="hs-identifier hs-type">addUsedDataCons</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037025"><span class="hs-identifier hs-type">rdr_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037019"><span class="hs-identifier hs-type">repTyCon</span></a></span><span> </span><span class="hs-comment">-- See wrinkles DTW2 and DTW3</span><span>
</span><span id="line-940"></span><span>          </span><span class="annot"><span class="hs-operator hs-type">$&gt;</span></span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#OneInst"><span class="hs-identifier hs-type">OneInst</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#cir_new_theta"><span class="hs-identifier hs-var">cir_new_theta</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- (Ignore stupid theta.)</span><span>
</span><span id="line-941"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#cir_mk_ev"><span class="hs-identifier hs-var">cir_mk_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683037050"><span class="hs-identifier hs-type">mk_ev</span></a></span><span>
</span><span id="line-942"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#cir_canonical"><span class="hs-identifier hs-var">cir_canonical</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#EvCanonical"><span class="hs-identifier hs-type">EvCanonical</span></a></span><span>
</span><span id="line-943"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#cir_what"><span class="hs-identifier hs-var">cir_what</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#BuiltinInstance"><span class="hs-identifier hs-type">BuiltinInstance</span></a></span><span>
</span><span id="line-944"></span><span>                     </span><span class="hs-special">}</span><span>
</span><span id="line-945"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#NoInstance"><span class="hs-identifier hs-type">NoInstance</span></a></span><span>
</span><span id="line-946"></span><span>
</span><span id="line-947"></span><span class="annot"><a href="GHC.Tc.Instance.Class.html#matchDataToTag"><span class="hs-identifier hs-var">matchDataToTag</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClsInstResult -&gt; TcM ClsInstResult
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#NoInstance"><span class="hs-identifier hs-var">NoInstance</span></a></span><span>
</span><span id="line-948"></span><span>
</span><span id="line-949"></span><span>
</span><span id="line-950"></span><span>
</span><span id="line-951"></span><span class="annot"><span class="hs-comment">{- ********************************************************************
*                                                                     *
                   Class lookup for Typeable
*                                                                     *
***********************************************************************-}</span></span><span>
</span><span id="line-956"></span><span>
</span><span id="line-957"></span><span class="hs-comment">-- | Assumes that we've checked that this is the 'Typeable' class,</span><span>
</span><span id="line-958"></span><span class="hs-comment">-- and it was applied to the correct argument.</span><span>
</span><span id="line-959"></span><span class="annot"><a href="GHC.Tc.Instance.Class.html#matchTypeable"><span class="hs-identifier hs-type">matchTypeable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#ClsInstResult"><span class="hs-identifier hs-type">ClsInstResult</span></a></span><span>
</span><span id="line-960"></span><span id="matchTypeable"><span class="annot"><span class="annottext">matchTypeable :: Class -&gt; [PredType] -&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#matchTypeable"><span class="hs-identifier hs-var hs-var">matchTypeable</span></a></span></span><span> </span><span id="local-6989586621683037052"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683037052"><span class="hs-identifier hs-var">clas</span></a></span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621683037053"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037053"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683037054"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037054"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- clas = Typeable</span><span>
</span><span id="line-961"></span><span>  </span><span class="hs-comment">-- Forall types: see Note [No Typeable for polytypes or qualified types]</span><span>
</span><span id="line-962"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PredType -&gt; Bool
</span><a href="GHC.Core.Type.html#isForAllTy"><span class="hs-identifier hs-var">isForAllTy</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037053"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClsInstResult -&gt; TcM ClsInstResult
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#NoInstance"><span class="hs-identifier hs-var">NoInstance</span></a></span><span>
</span><span id="line-963"></span><span>
</span><span id="line-964"></span><span>  </span><span class="hs-comment">-- Functions; but only with a visible argment</span><span>
</span><span id="line-965"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683037056"><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621683037056"><span class="hs-identifier hs-var">af</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683037057"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037057"><span class="hs-identifier hs-var">mult</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683037058"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037058"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683037059"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037059"><span class="hs-identifier hs-var">ret</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PredType -&gt; Maybe (FunTyFlag, PredType, PredType, PredType)
</span><a href="GHC.Core.Type.html#splitFunTy_maybe"><span class="hs-identifier hs-var">splitFunTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037054"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-966"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">FunTyFlag -&gt; Bool
</span><a href="GHC.Types.Var.html#isVisibleFunArg"><span class="hs-identifier hs-var">isVisibleFunArg</span></a></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621683037056"><span class="hs-identifier hs-var">af</span></a></span><span>
</span><span id="line-967"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Class
-&gt; PredType
-&gt; PredType
-&gt; PredType
-&gt; PredType
-&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#doFunTy"><span class="hs-identifier hs-var">doFunTy</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683037052"><span class="hs-identifier hs-var">clas</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037054"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037057"><span class="hs-identifier hs-var">mult</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037058"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037059"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-968"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">ClsInstResult -&gt; TcM ClsInstResult
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#NoInstance"><span class="hs-identifier hs-var">NoInstance</span></a></span><span>
</span><span id="line-969"></span><span>      </span><span class="hs-comment">-- 'else' case: qualified types like (Num a =&gt; blah) are not typeable</span><span>
</span><span id="line-970"></span><span>      </span><span class="hs-comment">-- see Note [No Typeable for polytypes or qualified types]</span><span>
</span><span id="line-971"></span><span>
</span><span id="line-972"></span><span>  </span><span class="hs-comment">-- Now cases that do work</span><span>
</span><span id="line-973"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037053"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; PredType -&gt; PredType -&gt; Bool
PredType -&gt; PredType -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="GHC.Builtin.Types.html#naturalTy"><span class="hs-identifier hs-var">naturalTy</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; PredType -&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#doTyLit"><span class="hs-identifier hs-var">doTyLit</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#knownNatClassName"><span class="hs-identifier hs-var">knownNatClassName</span></a></span><span>         </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037054"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-974"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037053"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; PredType -&gt; PredType -&gt; Bool
PredType -&gt; PredType -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="GHC.Builtin.Types.html#typeSymbolKind"><span class="hs-identifier hs-var">typeSymbolKind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; PredType -&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#doTyLit"><span class="hs-identifier hs-var">doTyLit</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#knownSymbolClassName"><span class="hs-identifier hs-var">knownSymbolClassName</span></a></span><span>      </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037054"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-975"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037053"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; PredType -&gt; PredType -&gt; Bool
PredType -&gt; PredType -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="GHC.Builtin.Types.html#charTy"><span class="hs-identifier hs-var">charTy</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; PredType -&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#doTyLit"><span class="hs-identifier hs-var">doTyLit</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#knownCharClassName"><span class="hs-identifier hs-var">knownCharClassName</span></a></span><span>        </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037054"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-976"></span><span>
</span><span id="line-977"></span><span>  </span><span class="hs-comment">-- TyCon applied to its kind args</span><span>
</span><span id="line-978"></span><span>  </span><span class="hs-comment">-- No special treatment of Type and Constraint; they get distinct TypeReps</span><span>
</span><span id="line-979"></span><span>  </span><span class="hs-comment">-- see wrinkle (W4) of Note [Type and Constraint are not apart]</span><span>
</span><span id="line-980"></span><span>  </span><span class="hs-comment">--     in GHC.Builtin.Types.Prim.</span><span>
</span><span id="line-981"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683037068"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683037068"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683037069"><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683037069"><span class="hs-identifier hs-var">ks</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; PredType -&gt; Maybe (TyCon, [PredType])
PredType -&gt; Maybe (TyCon, [PredType])
</span><a href="GHC.Core.Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037054"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-comment">-- See Note [Typeable (T a b c)]</span><span>
</span><span id="line-982"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [PredType] -&gt; Bool
</span><a href="GHC.Tc.Instance.Class.html#onlyNamedBndrsApplied"><span class="hs-identifier hs-var">onlyNamedBndrsApplied</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683037068"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683037069"><span class="hs-identifier hs-var">ks</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class -&gt; PredType -&gt; TyCon -&gt; [PredType] -&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#doTyConApp"><span class="hs-identifier hs-var">doTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683037052"><span class="hs-identifier hs-var">clas</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037054"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683037068"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683037069"><span class="hs-identifier hs-var">ks</span></a></span><span>
</span><span id="line-983"></span><span>
</span><span id="line-984"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683037073"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037073"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683037074"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037074"><span class="hs-identifier hs-var">kt</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PredType -&gt; Maybe (PredType, PredType)
</span><a href="GHC.Core.Type.html#splitAppTy_maybe"><span class="hs-identifier hs-var">splitAppTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037054"><span class="hs-identifier hs-var">t</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class -&gt; PredType -&gt; PredType -&gt; PredType -&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#doTyApp"><span class="hs-identifier hs-var">doTyApp</span></a></span><span>    </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683037052"><span class="hs-identifier hs-var">clas</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037054"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037073"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037074"><span class="hs-identifier hs-var">kt</span></a></span><span>
</span><span id="line-985"></span><span>
</span><span id="line-986"></span><span class="annot"><a href="GHC.Tc.Instance.Class.html#matchTypeable"><span class="hs-identifier hs-var">matchTypeable</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClsInstResult -&gt; TcM ClsInstResult
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#NoInstance"><span class="hs-identifier hs-var">NoInstance</span></a></span><span>
</span><span id="line-987"></span><span>
</span><span id="line-988"></span><span class="annot"><span class="hs-comment">-- | Representation for a type @ty@ of the form @arg -&gt; ret@.</span></span><span>
</span><span id="line-989"></span><span class="annot"><a href="GHC.Tc.Instance.Class.html#doFunTy"><span class="hs-identifier hs-type">doFunTy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#ClsInstResult"><span class="hs-identifier hs-type">ClsInstResult</span></a></span><span>
</span><span id="line-990"></span><span id="doFunTy"><span class="annot"><span class="annottext">doFunTy :: Class
-&gt; PredType
-&gt; PredType
-&gt; PredType
-&gt; PredType
-&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#doFunTy"><span class="hs-identifier hs-var hs-var">doFunTy</span></a></span></span><span> </span><span id="local-6989586621683037078"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683037078"><span class="hs-identifier hs-var">clas</span></a></span></span><span> </span><span id="local-6989586621683037079"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037079"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683037080"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037080"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span id="local-6989586621683037081"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037081"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span> </span><span id="local-6989586621683037082"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037082"><span class="hs-identifier hs-var">ret_ty</span></a></span></span><span>
</span><span id="line-991"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClsInstResult -&gt; TcM ClsInstResult
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ClsInstResult -&gt; TcM ClsInstResult)
-&gt; ClsInstResult -&gt; TcM ClsInstResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#OneInst"><span class="hs-identifier hs-type">OneInst</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cir_new_theta :: [PredType]
</span><a href="GHC.Tc.Instance.Class.html#cir_new_theta"><span class="hs-identifier hs-var">cir_new_theta</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683037083"><span class="hs-identifier hs-var">preds</span></a></span><span>
</span><span id="line-992"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cir_mk_ev :: [EvExpr] -&gt; EvTerm
</span><a href="GHC.Tc.Instance.Class.html#cir_mk_ev"><span class="hs-identifier hs-var">cir_mk_ev</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EvExpr] -&gt; EvTerm
</span><a href="#local-6989586621683037084"><span class="hs-identifier hs-var">mk_ev</span></a></span><span>
</span><span id="line-993"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cir_canonical :: CanonicalEvidence
</span><a href="GHC.Tc.Instance.Class.html#cir_canonical"><span class="hs-identifier hs-var">cir_canonical</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CanonicalEvidence
</span><a href="GHC.Core.InstEnv.html#EvCanonical"><span class="hs-identifier hs-var">EvCanonical</span></a></span><span>
</span><span id="line-994"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cir_what :: InstanceWhat
</span><a href="GHC.Tc.Instance.Class.html#cir_what"><span class="hs-identifier hs-var">cir_what</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InstanceWhat
</span><a href="GHC.Tc.Types.Origin.html#BuiltinInstance"><span class="hs-identifier hs-var">BuiltinInstance</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-995"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-996"></span><span>    </span><span id="local-6989586621683037083"><span class="annot"><span class="annottext">preds :: [PredType]
</span><a href="#local-6989586621683037083"><span class="hs-identifier hs-var hs-var">preds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PredType -&gt; PredType) -&gt; [PredType] -&gt; [PredType]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; PredType -&gt; PredType
</span><a href="GHC.Tc.Instance.Class.html#mk_typeable_pred"><span class="hs-identifier hs-var">mk_typeable_pred</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683037078"><span class="hs-identifier hs-var">clas</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037080"><span class="hs-identifier hs-var">mult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037081"><span class="hs-identifier hs-var">arg_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037082"><span class="hs-identifier hs-var">ret_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-997"></span><span>    </span><span id="local-6989586621683037084"><span class="annot"><span class="annottext">mk_ev :: [EvExpr] -&gt; EvTerm
</span><a href="#local-6989586621683037084"><span class="hs-identifier hs-var hs-var">mk_ev</span></a></span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621683037086"><span class="annot"><span class="annottext">EvExpr
</span><a href="#local-6989586621683037086"><span class="hs-identifier hs-var">mult_ev</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683037087"><span class="annot"><span class="annottext">EvExpr
</span><a href="#local-6989586621683037087"><span class="hs-identifier hs-var">arg_ev</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683037088"><span class="annot"><span class="annottext">EvExpr
</span><a href="#local-6989586621683037088"><span class="hs-identifier hs-var">ret_ev</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PredType -&gt; EvTypeable -&gt; EvTerm
</span><a href="GHC.Tc.Types.Evidence.html#evTypeable"><span class="hs-identifier hs-var">evTypeable</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037079"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">(EvTypeable -&gt; EvTerm) -&gt; EvTypeable -&gt; EvTerm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-998"></span><span>                        </span><span class="annot"><span class="annottext">EvTerm -&gt; EvTerm -&gt; EvTerm -&gt; EvTypeable
</span><a href="GHC.Tc.Types.Evidence.html#EvTypeableTrFun"><span class="hs-identifier hs-var">EvTypeableTrFun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvExpr -&gt; EvTerm
</span><a href="GHC.Tc.Types.Evidence.html#EvExpr"><span class="hs-identifier hs-var">EvExpr</span></a></span><span> </span><span class="annot"><span class="annottext">EvExpr
</span><a href="#local-6989586621683037086"><span class="hs-identifier hs-var">mult_ev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvExpr -&gt; EvTerm
</span><a href="GHC.Tc.Types.Evidence.html#EvExpr"><span class="hs-identifier hs-var">EvExpr</span></a></span><span> </span><span class="annot"><span class="annottext">EvExpr
</span><a href="#local-6989586621683037087"><span class="hs-identifier hs-var">arg_ev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvExpr -&gt; EvTerm
</span><a href="GHC.Tc.Types.Evidence.html#EvExpr"><span class="hs-identifier hs-var">EvExpr</span></a></span><span> </span><span class="annot"><span class="annottext">EvExpr
</span><a href="#local-6989586621683037088"><span class="hs-identifier hs-var">ret_ev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-999"></span><span>    </span><span class="annot"><a href="#local-6989586621683037084"><span class="hs-identifier hs-var">mk_ev</span></a></span><span> </span><span class="annot"><span class="annottext">[EvExpr]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; EvTerm
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.Tc.Instance.Class.doFunTy&quot;</span></span><span>
</span><span id="line-1000"></span><span>
</span><span id="line-1001"></span><span>
</span><span id="line-1002"></span><span class="hs-comment">-- | Representation for type constructor applied to some kinds.</span><span>
</span><span id="line-1003"></span><span class="hs-comment">-- 'onlyNamedBndrsApplied' has ensured that this application results in a type</span><span>
</span><span id="line-1004"></span><span class="hs-comment">-- of monomorphic kind (e.g. all kind variables have been instantiated).</span><span>
</span><span id="line-1005"></span><span class="annot"><a href="GHC.Tc.Instance.Class.html#doTyConApp"><span class="hs-identifier hs-type">doTyConApp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#ClsInstResult"><span class="hs-identifier hs-type">ClsInstResult</span></a></span><span>
</span><span id="line-1006"></span><span id="doTyConApp"><span class="annot"><span class="annottext">doTyConApp :: Class -&gt; PredType -&gt; TyCon -&gt; [PredType] -&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#doTyConApp"><span class="hs-identifier hs-var hs-var">doTyConApp</span></a></span></span><span> </span><span id="local-6989586621683037093"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683037093"><span class="hs-identifier hs-var">clas</span></a></span></span><span> </span><span id="local-6989586621683037094"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037094"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683037095"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683037095"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621683037096"><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683037096"><span class="hs-identifier hs-var">kind_args</span></a></span></span><span>
</span><span id="line-1007"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Tc.Instance.Typeable.html#tyConIsTypeable"><span class="hs-identifier hs-var">tyConIsTypeable</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683037095"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1008"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClsInstResult -&gt; TcM ClsInstResult
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ClsInstResult -&gt; TcM ClsInstResult)
-&gt; ClsInstResult -&gt; TcM ClsInstResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#OneInst"><span class="hs-identifier hs-type">OneInst</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cir_new_theta :: [PredType]
</span><a href="GHC.Tc.Instance.Class.html#cir_new_theta"><span class="hs-identifier hs-var">cir_new_theta</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PredType -&gt; PredType) -&gt; [PredType] -&gt; [PredType]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; PredType -&gt; PredType
</span><a href="GHC.Tc.Instance.Class.html#mk_typeable_pred"><span class="hs-identifier hs-var">mk_typeable_pred</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683037093"><span class="hs-identifier hs-var">clas</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683037096"><span class="hs-identifier hs-var">kind_args</span></a></span><span>
</span><span id="line-1009"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cir_mk_ev :: [EvExpr] -&gt; EvTerm
</span><a href="GHC.Tc.Instance.Class.html#cir_mk_ev"><span class="hs-identifier hs-var">cir_mk_ev</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EvExpr] -&gt; EvTerm
</span><a href="#local-6989586621683037098"><span class="hs-identifier hs-var">mk_ev</span></a></span><span>
</span><span id="line-1010"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cir_canonical :: CanonicalEvidence
</span><a href="GHC.Tc.Instance.Class.html#cir_canonical"><span class="hs-identifier hs-var">cir_canonical</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CanonicalEvidence
</span><a href="GHC.Core.InstEnv.html#EvCanonical"><span class="hs-identifier hs-var">EvCanonical</span></a></span><span>
</span><span id="line-1011"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cir_what :: InstanceWhat
</span><a href="GHC.Tc.Instance.Class.html#cir_what"><span class="hs-identifier hs-var">cir_what</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; InstanceWhat
</span><a href="GHC.Tc.Types.Origin.html#BuiltinTypeableInstance"><span class="hs-identifier hs-var">BuiltinTypeableInstance</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683037095"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1012"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1013"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClsInstResult -&gt; TcM ClsInstResult
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#NoInstance"><span class="hs-identifier hs-var">NoInstance</span></a></span><span>
</span><span id="line-1014"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1015"></span><span>    </span><span id="local-6989586621683037098"><span class="annot"><span class="annottext">mk_ev :: [EvExpr] -&gt; EvTerm
</span><a href="#local-6989586621683037098"><span class="hs-identifier hs-var hs-var">mk_ev</span></a></span></span><span> </span><span id="local-6989586621683037099"><span class="annot"><span class="annottext">[EvExpr]
</span><a href="#local-6989586621683037099"><span class="hs-identifier hs-var">kinds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PredType -&gt; EvTypeable -&gt; EvTerm
</span><a href="GHC.Tc.Types.Evidence.html#evTypeable"><span class="hs-identifier hs-var">evTypeable</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037094"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">(EvTypeable -&gt; EvTerm) -&gt; EvTypeable -&gt; EvTerm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [EvTerm] -&gt; EvTypeable
</span><a href="GHC.Tc.Types.Evidence.html#EvTypeableTyCon"><span class="hs-identifier hs-var">EvTypeableTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683037095"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EvExpr -&gt; EvTerm) -&gt; [EvExpr] -&gt; [EvTerm]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">EvExpr -&gt; EvTerm
</span><a href="GHC.Tc.Types.Evidence.html#EvExpr"><span class="hs-identifier hs-var">EvExpr</span></a></span><span> </span><span class="annot"><span class="annottext">[EvExpr]
</span><a href="#local-6989586621683037099"><span class="hs-identifier hs-var">kinds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1016"></span><span>
</span><span id="line-1017"></span><span class="hs-comment">-- | Representation for TyCon applications of a concrete kind. We just use the</span><span>
</span><span id="line-1018"></span><span class="hs-comment">-- kind itself, but first we must make sure that we've instantiated all kind-</span><span>
</span><span id="line-1019"></span><span class="hs-comment">-- polymorphism, but no more.</span><span>
</span><span id="line-1020"></span><span class="annot"><a href="GHC.Tc.Instance.Class.html#onlyNamedBndrsApplied"><span class="hs-identifier hs-type">onlyNamedBndrsApplied</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#KindOrType"><span class="hs-identifier hs-type">KindOrType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1021"></span><span id="onlyNamedBndrsApplied"><span class="annot"><span class="annottext">onlyNamedBndrsApplied :: TyCon -&gt; [PredType] -&gt; Bool
</span><a href="GHC.Tc.Instance.Class.html#onlyNamedBndrsApplied"><span class="hs-identifier hs-var hs-var">onlyNamedBndrsApplied</span></a></span></span><span> </span><span id="local-6989586621683037102"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683037102"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621683037103"><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683037103"><span class="hs-identifier hs-var">ks</span></a></span></span><span>
</span><span id="line-1022"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TyConBinder -&gt; Bool) -&gt; [TyConBinder] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">TyConBinder -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isNamedTyConBinder"><span class="hs-identifier hs-var">isNamedTyConBinder</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621683037105"><span class="hs-identifier hs-var">used_bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-1023"></span><span>   </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TyConBinder -&gt; Bool) -&gt; [TyConBinder] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="annot"><span class="annottext">TyConBinder -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isNamedTyConBinder"><span class="hs-identifier hs-var">isNamedTyConBinder</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621683037107"><span class="hs-identifier hs-var">leftover_bndrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1024"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1025"></span><span>   </span><span id="local-6989586621683037108"><span class="annot"><span class="annottext">bndrs :: [TyConBinder]
</span><a href="#local-6989586621683037108"><span class="hs-identifier hs-var hs-var">bndrs</span></a></span></span><span>                        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [TyConBinder]
</span><a href="GHC.Core.TyCon.html#tyConBinders"><span class="hs-identifier hs-var">tyConBinders</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683037102"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1026"></span><span>   </span><span class="hs-special">(</span><span id="local-6989586621683037105"><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621683037105"><span class="hs-identifier hs-var">used_bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683037107"><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621683037107"><span class="hs-identifier hs-var">leftover_bndrs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PredType] -&gt; [TyConBinder] -&gt; ([TyConBinder], [TyConBinder])
forall b a. [b] -&gt; [a] -&gt; ([a], [a])
</span><a href="GHC.Utils.Misc.html#splitAtList"><span class="hs-identifier hs-var">splitAtList</span></a></span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683037103"><span class="hs-identifier hs-var">ks</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621683037108"><span class="hs-identifier hs-var">bndrs</span></a></span><span>
</span><span id="line-1027"></span><span>
</span><span id="line-1028"></span><span class="annot"><a href="GHC.Tc.Instance.Class.html#doTyApp"><span class="hs-identifier hs-type">doTyApp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#KindOrType"><span class="hs-identifier hs-type">KindOrType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#ClsInstResult"><span class="hs-identifier hs-type">ClsInstResult</span></a></span><span>
</span><span id="line-1029"></span><span class="hs-comment">-- Representation for an application of a type to a type-or-kind.</span><span>
</span><span id="line-1030"></span><span class="hs-comment">--  This may happen when the type expression starts with a type variable.</span><span>
</span><span id="line-1031"></span><span class="hs-comment">--  Example (ignoring kind parameter):</span><span>
</span><span id="line-1032"></span><span class="hs-comment">--    Typeable (f Int Char)                      --&gt;</span><span>
</span><span id="line-1033"></span><span class="hs-comment">--    (Typeable (f Int), Typeable Char)          --&gt;</span><span>
</span><span id="line-1034"></span><span class="hs-comment">--    (Typeable f, Typeable Int, Typeable Char)  --&gt; (after some simp. steps)</span><span>
</span><span id="line-1035"></span><span class="hs-comment">--    Typeable f</span><span>
</span><span id="line-1036"></span><span id="doTyApp"><span class="annot"><span class="annottext">doTyApp :: Class -&gt; PredType -&gt; PredType -&gt; PredType -&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#doTyApp"><span class="hs-identifier hs-var hs-var">doTyApp</span></a></span></span><span> </span><span id="local-6989586621683037110"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683037110"><span class="hs-identifier hs-var">clas</span></a></span></span><span> </span><span id="local-6989586621683037111"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037111"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621683037112"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037112"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621683037113"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037113"><span class="hs-identifier hs-var">tk</span></a></span></span><span>
</span><span id="line-1037"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PredType -&gt; Bool
</span><a href="GHC.Core.Type.html#isForAllTy"><span class="hs-identifier hs-var">isForAllTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; PredType -&gt; PredType
PredType -&gt; PredType
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037112"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1038"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClsInstResult -&gt; TcM ClsInstResult
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#NoInstance"><span class="hs-identifier hs-var">NoInstance</span></a></span><span> </span><span class="hs-comment">-- We can't solve until we know the ctr.</span><span>
</span><span id="line-1039"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1040"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClsInstResult -&gt; TcM ClsInstResult
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ClsInstResult -&gt; TcM ClsInstResult)
-&gt; ClsInstResult -&gt; TcM ClsInstResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#OneInst"><span class="hs-identifier hs-type">OneInst</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cir_new_theta :: [PredType]
</span><a href="GHC.Tc.Instance.Class.html#cir_new_theta"><span class="hs-identifier hs-var">cir_new_theta</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PredType -&gt; PredType) -&gt; [PredType] -&gt; [PredType]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; PredType -&gt; PredType
</span><a href="GHC.Tc.Instance.Class.html#mk_typeable_pred"><span class="hs-identifier hs-var">mk_typeable_pred</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683037110"><span class="hs-identifier hs-var">clas</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037112"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037113"><span class="hs-identifier hs-var">tk</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1041"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cir_mk_ev :: [EvExpr] -&gt; EvTerm
</span><a href="GHC.Tc.Instance.Class.html#cir_mk_ev"><span class="hs-identifier hs-var">cir_mk_ev</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EvExpr] -&gt; EvTerm
</span><a href="#local-6989586621683037115"><span class="hs-identifier hs-var">mk_ev</span></a></span><span>
</span><span id="line-1042"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cir_canonical :: CanonicalEvidence
</span><a href="GHC.Tc.Instance.Class.html#cir_canonical"><span class="hs-identifier hs-var">cir_canonical</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CanonicalEvidence
</span><a href="GHC.Core.InstEnv.html#EvCanonical"><span class="hs-identifier hs-var">EvCanonical</span></a></span><span>
</span><span id="line-1043"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cir_what :: InstanceWhat
</span><a href="GHC.Tc.Instance.Class.html#cir_what"><span class="hs-identifier hs-var">cir_what</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InstanceWhat
</span><a href="GHC.Tc.Types.Origin.html#BuiltinInstance"><span class="hs-identifier hs-var">BuiltinInstance</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1044"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1045"></span><span>    </span><span id="local-6989586621683037115"><span class="annot"><span class="annottext">mk_ev :: [EvExpr] -&gt; EvTerm
</span><a href="#local-6989586621683037115"><span class="hs-identifier hs-var hs-var">mk_ev</span></a></span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621683037116"><span class="annot"><span class="annottext">EvExpr
</span><a href="#local-6989586621683037116"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683037117"><span class="annot"><span class="annottext">EvExpr
</span><a href="#local-6989586621683037117"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PredType -&gt; EvTypeable -&gt; EvTerm
</span><a href="GHC.Tc.Types.Evidence.html#evTypeable"><span class="hs-identifier hs-var">evTypeable</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037111"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">(EvTypeable -&gt; EvTerm) -&gt; EvTypeable -&gt; EvTerm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EvTerm -&gt; EvTerm -&gt; EvTypeable
</span><a href="GHC.Tc.Types.Evidence.html#EvTypeableTyApp"><span class="hs-identifier hs-var">EvTypeableTyApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvExpr -&gt; EvTerm
</span><a href="GHC.Tc.Types.Evidence.html#EvExpr"><span class="hs-identifier hs-var">EvExpr</span></a></span><span> </span><span class="annot"><span class="annottext">EvExpr
</span><a href="#local-6989586621683037116"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvExpr -&gt; EvTerm
</span><a href="GHC.Tc.Types.Evidence.html#EvExpr"><span class="hs-identifier hs-var">EvExpr</span></a></span><span> </span><span class="annot"><span class="annottext">EvExpr
</span><a href="#local-6989586621683037117"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1046"></span><span>    </span><span class="annot"><a href="#local-6989586621683037115"><span class="hs-identifier hs-var">mk_ev</span></a></span><span> </span><span class="annot"><span class="annottext">[EvExpr]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; EvTerm
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;doTyApp&quot;</span></span><span>
</span><span id="line-1047"></span><span>
</span><span id="line-1048"></span><span>
</span><span id="line-1049"></span><span class="hs-comment">-- Emit a `Typeable` constraint for the given type.</span><span>
</span><span id="line-1050"></span><span class="annot"><a href="GHC.Tc.Instance.Class.html#mk_typeable_pred"><span class="hs-identifier hs-type">mk_typeable_pred</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a></span><span>
</span><span id="line-1051"></span><span id="mk_typeable_pred"><span class="annot"><span class="annottext">mk_typeable_pred :: Class -&gt; PredType -&gt; PredType
</span><a href="GHC.Tc.Instance.Class.html#mk_typeable_pred"><span class="hs-identifier hs-var hs-var">mk_typeable_pred</span></a></span></span><span> </span><span id="local-6989586621683037119"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683037119"><span class="hs-identifier hs-var">clas</span></a></span></span><span> </span><span id="local-6989586621683037120"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037120"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class -&gt; [PredType] -&gt; PredType
</span><a href="GHC.Core.Predicate.html#mkClassPred"><span class="hs-identifier hs-var">mkClassPred</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683037119"><span class="hs-identifier hs-var">clas</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; PredType -&gt; PredType
PredType -&gt; PredType
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037120"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037120"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1052"></span><span>
</span><span id="line-1053"></span><span>  </span><span class="hs-comment">-- Typeable is implied by KnownNat/KnownSymbol. In the case of a type literal</span><span>
</span><span id="line-1054"></span><span>  </span><span class="hs-comment">-- we generate a sub-goal for the appropriate class.</span><span>
</span><span id="line-1055"></span><span>  </span><span class="hs-comment">-- See Note [Typeable for Nat and Symbol]</span><span>
</span><span id="line-1056"></span><span class="annot"><a href="GHC.Tc.Instance.Class.html#doTyLit"><span class="hs-identifier hs-type">doTyLit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#ClsInstResult"><span class="hs-identifier hs-type">ClsInstResult</span></a></span><span>
</span><span id="line-1057"></span><span id="doTyLit"><span class="annot"><span class="annottext">doTyLit :: Name -&gt; PredType -&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#doTyLit"><span class="hs-identifier hs-var hs-var">doTyLit</span></a></span></span><span> </span><span id="local-6989586621683037121"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683037121"><span class="hs-identifier hs-var">kc</span></a></span></span><span> </span><span id="local-6989586621683037122"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037122"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683037123"><span class="annot"><a href="#local-6989586621683037123"><span class="hs-identifier hs-var">kc_clas</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Class
</span><a href="GHC.Tc.Utils.Env.html#tcLookupClass"><span class="hs-identifier hs-var">tcLookupClass</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683037121"><span class="hs-identifier hs-var">kc</span></a></span><span>
</span><span id="line-1058"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683037125"><span class="annot"><a href="#local-6989586621683037125"><span class="hs-identifier hs-var hs-var">kc_pred</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class -&gt; [PredType] -&gt; PredType
</span><a href="GHC.Core.Predicate.html#mkClassPred"><span class="hs-identifier hs-var">mkClassPred</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683037123"><span class="hs-identifier hs-var">kc_clas</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037122"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1059"></span><span>                        </span><span id="local-6989586621683037126"><span class="annot"><a href="#local-6989586621683037126"><span class="hs-identifier hs-var hs-var">mk_ev</span></a></span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621683037127"><span class="annot"><span class="annottext">EvExpr
</span><a href="#local-6989586621683037127"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PredType -&gt; EvTypeable -&gt; EvTerm
</span><a href="GHC.Tc.Types.Evidence.html#evTypeable"><span class="hs-identifier hs-var">evTypeable</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037122"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">(EvTypeable -&gt; EvTerm) -&gt; EvTypeable -&gt; EvTerm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EvTerm -&gt; EvTypeable
</span><a href="GHC.Tc.Types.Evidence.html#EvTypeableTyLit"><span class="hs-identifier hs-var">EvTypeableTyLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvExpr -&gt; EvTerm
</span><a href="GHC.Tc.Types.Evidence.html#EvExpr"><span class="hs-identifier hs-var">EvExpr</span></a></span><span> </span><span class="annot"><span class="annottext">EvExpr
</span><a href="#local-6989586621683037127"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1060"></span><span>                        </span><span class="annot"><a href="#local-6989586621683037126"><span class="hs-identifier hs-var">mk_ev</span></a></span><span> </span><span class="annot"><span class="annottext">[EvExpr]
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; EvTerm
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;doTyLit&quot;</span></span><span>
</span><span id="line-1061"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Instance.Class.html#OneInst"><span class="hs-identifier hs-type">OneInst</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#cir_new_theta"><span class="hs-identifier hs-var">cir_new_theta</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683037125"><span class="hs-identifier hs-type">kc_pred</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1062"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#cir_mk_ev"><span class="hs-identifier hs-var">cir_mk_ev</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683037126"><span class="hs-identifier hs-type">mk_ev</span></a></span><span>
</span><span id="line-1063"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#cir_canonical"><span class="hs-identifier hs-var">cir_canonical</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#EvCanonical"><span class="hs-identifier hs-type">EvCanonical</span></a></span><span>
</span><span id="line-1064"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#cir_what"><span class="hs-identifier hs-var">cir_what</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#BuiltinInstance"><span class="hs-identifier hs-type">BuiltinInstance</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1065"></span><span>
</span><span id="line-1066"></span><span class="hs-comment">{- Note [Typeable (T a b c)]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

For type applications we always decompose using binary application,
via doTyApp (building a TrApp), until we get to a *kind* instantiation
(building a TrTyCon).  We detect a pure kind instantiation using
`onlyNamedBndrsApplied`.

Example: Proxy :: forall k. k -&gt; *

  To solve Typeable (Proxy @(* -&gt; *) Maybe) we

  - First decompose with doTyApp (onlyNamedBndrsApplied is False)
    to get (Typeable (Proxy @(* -&gt; *))) and Typeable Maybe.
    This step returns a TrApp.

  - Then solve (Typeable (Proxy @(* -&gt; *))) with doTyConApp
    (onlyNamedBndrsApplied is True).
    This step returns a TrTyCon

  So the TypeRep we build is
    TrApp (TrTyCon (&quot;Proxy&quot; @(*-&gt;*))) (TrTyCon &quot;Maybe&quot;)

Notice also that TYPE and CONSTRAINT are distinct so, in effect, we
allow (Typeable TYPE) and (Typeable CONSTRAINT), giving disinct TypeReps.
This is very important: we may want to get a TypeRep for a kind like
   Type -&gt; Constraint

If we attempt to short-cut by solving it all at once, via
doTyConApp

(this note is sadly truncated FIXME)


Note [No Typeable for polytypes or qualified types]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We do not support impredicative typeable, such as
   Typeable (forall a. a-&gt;a)
   Typeable (Eq a =&gt; a -&gt; a)
   Typeable (() =&gt; Int)
   Typeable (((),()) =&gt; Int)

See #9858.  For forall's the case is clear: we simply don't have
a TypeRep for them.  For qualified but not polymorphic types, like
(Eq a =&gt; a -&gt; a), things are murkier.  But:

 * We don't need a TypeRep for these things.  TypeReps are for
   monotypes only.

 * Perhaps we could treat `=&gt;` as another type constructor for `Typeable`
   purposes, and thus support things like `Eq Int =&gt; Int`, however,
   at the current state of affairs this would be an odd exception as
   no other class works with impredicative types.
   For now we leave it off, until we have a better story for impredicativity.


Note [Typeable for Nat and Symbol]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We have special Typeable instances for Nat and Symbol.  Roughly we
have this instance, implemented here by doTyLit:
      instance KnownNat n =&gt; Typeable (n :: Nat) where
         typeRep = typeNatTypeRep @n
where
   Data.Typeable.Internal.typeNatTypeRep :: KnownNat a =&gt; TypeRep a

Ultimately typeNatTypeRep uses 'natSing' from KnownNat to get a
runtime value 'n'; it turns it into a string with 'show' and uses
that to whiz up a TypeRep TyCon for 'n', with mkTypeLitTyCon.
See #10348.

Because of this rule it's inadvisable (see #15322) to have a constraint
    f :: (Typeable (n :: Nat)) =&gt; blah
in a function signature; it gives rise to overlap problems just as
if you'd written
    f :: Eq [a] =&gt; blah
-}</span><span>
</span><span id="line-1142"></span><span>
</span><span id="line-1143"></span><span class="annot"><span class="hs-comment">{- ********************************************************************
*                                                                     *
                   Class lookup for lifted equality
*                                                                     *
***********************************************************************-}</span></span><span>
</span><span id="line-1148"></span><span>
</span><span id="line-1149"></span><span class="hs-comment">-- See also Note [The equality types story] in GHC.Builtin.Types.Prim</span><span>
</span><span id="line-1150"></span><span class="annot"><a href="GHC.Tc.Instance.Class.html#matchEqualityInst"><span class="hs-identifier hs-type">matchEqualityInst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1151"></span><span class="hs-comment">-- Precondition: `cls` satisfies GHC.Core.Predicate.isEqualityClass</span><span>
</span><span id="line-1152"></span><span class="hs-comment">-- See Note [Solving equality classes] in GHC.Tc.Solver.Dict</span><span>
</span><span id="line-1153"></span><span id="matchEqualityInst"><span class="annot"><span class="annottext">matchEqualityInst :: Class -&gt; [PredType] -&gt; (DataCon, Role, PredType, PredType)
</span><a href="GHC.Tc.Instance.Class.html#matchEqualityInst"><span class="hs-identifier hs-var hs-var">matchEqualityInst</span></a></span></span><span> </span><span id="local-6989586621683037129"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683037129"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span id="local-6989586621683037130"><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683037130"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-1154"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683037129"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">Class -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#eqTyConKey"><span class="hs-identifier hs-var">eqTyConKey</span></a></span><span>  </span><span class="hs-comment">-- Solves (t1 ~ t2)</span><span>
</span><span id="line-1155"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PredType
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621683037133"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037133"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683037134"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037134"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683037130"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1156"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon
</span><a href="GHC.Builtin.Types.html#eqDataCon"><span class="hs-identifier hs-var">eqDataCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037133"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037134"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1157"></span><span>
</span><span id="line-1158"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683037129"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">Class -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#heqTyConKey"><span class="hs-identifier hs-var">heqTyConKey</span></a></span><span> </span><span class="hs-comment">-- Solves (t1 ~~ t2)</span><span>
</span><span id="line-1159"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PredType
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">PredType
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621683037138"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037138"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621683037139"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037139"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683037130"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1160"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon
</span><a href="GHC.Builtin.Types.html#heqDataCon"><span class="hs-identifier hs-var">heqDataCon</span></a></span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037138"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037139"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1161"></span><span>
</span><span id="line-1162"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683037129"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">Class -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#coercibleTyConKey"><span class="hs-identifier hs-var">coercibleTyConKey</span></a></span><span>  </span><span class="hs-comment">-- Solves (Coercible t1 t2)</span><span>
</span><span id="line-1163"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PredType
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683037142"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037142"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683037143"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037143"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683037130"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1164"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon
</span><a href="GHC.Builtin.Types.html#coercibleDataCon"><span class="hs-identifier hs-var">coercibleDataCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037142"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037143"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1165"></span><span>
</span><span id="line-1166"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>  </span><span class="hs-comment">-- Does not satisfy the precondition</span><span>
</span><span id="line-1167"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; (DataCon, Role, PredType, PredType)
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;matchEqualityInst&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PredType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; [PredType] -&gt; PredType
</span><a href="GHC.Core.Predicate.html#mkClassPred"><span class="hs-identifier hs-var">mkClassPred</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683037129"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683037130"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1168"></span><span>
</span><span id="line-1169"></span><span>
</span><span id="line-1170"></span><span class="annot"><span class="hs-comment">{- ********************************************************************
*                                                                     *
              Class lookup for overloaded record fields
*                                                                     *
***********************************************************************-}</span></span><span>
</span><span id="line-1175"></span><span>
</span><span id="line-1176"></span><span class="hs-comment">{-
Note [HasField instances]
~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose we have

    data T y = MkT { foo :: [y] }

and `foo` is in scope.  Then GHC will automatically solve a constraint like

    HasField &quot;foo&quot; (T Int) b

by emitting a new wanted

    T alpha -&gt; [alpha] ~# T Int -&gt; b

and building a HasField dictionary out of the selector function `foo`,
appropriately cast.

The HasField class is defined (in GHC.Records) thus:

    type HasField :: forall {k} {r_rep} {a_rep} . k -&gt; TYPE r_rep -&gt; TYPE a_rep -&gt; Constraint
    class HasField x r a | x r -&gt; a where
      getField :: r -&gt; a

Since this is a one-method class, it is represented as a newtype.
Hence we can solve `HasField &quot;foo&quot; (T Int) b` by taking an expression
of type `T Int -&gt; b` and casting it using the newtype coercion.
Note that

    foo :: forall y . T y -&gt; [y]

so the expression we construct is

    foo @alpha |&gt; co

where

    co :: (T alpha -&gt; [alpha]) ~# HasField &quot;foo&quot; (T Int) b

is built from

    co1 :: (T alpha -&gt; [alpha]) ~# (T Int -&gt; b)

which is the new wanted, and

    co2 :: (T Int -&gt; b) ~# HasField &quot;foo&quot; (T Int) b

which can be derived from the newtype coercion.

If `foo` is not in scope, or has a higher-rank or existentially
quantified type, then the constraint is not solved automatically, but
may be solved by a user-supplied HasField instance.  Similarly, if we
encounter a HasField constraint where the field is not a literal
string, or does not belong to the type, then we fall back on the
normal constraint solver behaviour.


Note [Unused name reporting and HasField]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When a HasField constraint is solved by the type-checker, we must record a use
of the corresponding field name, as otherwise it might be reported as unused.
See #19213.  We need to call keepAlive to add the name to the tcg_keep set,
which accumulates names used by the constraint solver, as described by
Note [Tracking unused binding and imports] in GHC.Tc.Types.

We need to call addUsedGRE as well because there may be a deprecation warning on
the field, which will be reported by addUsedGRE.  But calling addUsedGRE without
keepAlive is not enough, because the field might be defined locally, and
addUsedGRE extends tcg_used_gres with imported GREs only.
-}</span><span>
</span><span id="line-1246"></span><span>
</span><span id="line-1247"></span><span class="hs-comment">-- See Note [HasField instances]</span><span>
</span><span id="line-1248"></span><span class="annot"><a href="GHC.Tc.Instance.Class.html#matchHasField"><span class="hs-identifier hs-type">matchHasField</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#ClsInstResult"><span class="hs-identifier hs-type">ClsInstResult</span></a></span><span>
</span><span id="line-1249"></span><span id="matchHasField"><span class="annot"><span class="annottext">matchHasField :: DynFlags -&gt; Bool -&gt; Class -&gt; [PredType] -&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#matchHasField"><span class="hs-identifier hs-var hs-var">matchHasField</span></a></span></span><span> </span><span id="local-6989586621683037145"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683037145"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621683037146"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683037146"><span class="hs-identifier hs-var">short_cut</span></a></span></span><span> </span><span id="local-6989586621683037147"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683037147"><span class="hs-identifier hs-var">clas</span></a></span></span><span> </span><span id="local-6989586621683037148"><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683037148"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-1250"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683037149"><span class="annot"><a href="#local-6989586621683037149"><span class="hs-identifier hs-var">fam_inst_envs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM FamInstEnvs
</span><a href="GHC.Tc.Instance.Family.html#tcGetFamInstEnvs"><span class="hs-identifier hs-var">tcGetFamInstEnvs</span></a></span><span>
</span><span id="line-1251"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683037150"><span class="annot"><a href="#local-6989586621683037150"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getGlobalRdrEnv"><span class="hs-identifier hs-type">getGlobalRdrEnv</span></a></span><span>
</span><span id="line-1252"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683037148"><span class="hs-identifier hs-type">tys</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1253"></span><span>           </span><span class="hs-comment">-- We are matching HasField {k} {r_rep} {a_rep} x r a...</span><span>
</span><span id="line-1254"></span><span>           </span><span class="hs-special">[</span><span id="local-6989586621683037152"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037152"><span class="hs-identifier hs-var">_k_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683037153"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037153"><span class="hs-identifier hs-var">_r_rep</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683037154"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037154"><span class="hs-identifier hs-var">_a_rep</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683037155"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037155"><span class="hs-identifier hs-var">x_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683037156"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037156"><span class="hs-identifier hs-var">r_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683037157"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037157"><span class="hs-identifier hs-var">a_ty</span></a></span></span><span class="hs-special">]</span><span>
</span><span id="line-1255"></span><span>               </span><span class="hs-comment">-- x should be a literal string</span><span>
</span><span id="line-1256"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683037158"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683037158"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PredType -&gt; Maybe FastString
</span><a href="GHC.Core.Type.html#isStrLitTy"><span class="hs-identifier hs-var">isStrLitTy</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037155"><span class="hs-identifier hs-var">x_ty</span></a></span><span>
</span><span id="line-1257"></span><span>               </span><span class="hs-comment">-- r should be an applied type constructor</span><span>
</span><span id="line-1258"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683037159"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683037159"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683037160"><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683037160"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; PredType -&gt; Maybe (TyCon, [PredType])
PredType -&gt; Maybe (TyCon, [PredType])
</span><a href="GHC.Core.Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037156"><span class="hs-identifier hs-var">r_ty</span></a></span><span>
</span><span id="line-1259"></span><span>               </span><span class="hs-comment">-- use representation tycon (if data family); it has the fields</span><span>
</span><span id="line-1260"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683037161"><span class="annot"><span class="annottext">r_tc :: TyCon
</span><a href="#local-6989586621683037161"><span class="hs-identifier hs-var hs-var">r_tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TyCon, [PredType], TcCoercion) -&gt; TyCon
forall a b c. (a, b, c) -&gt; a
</span><a href="GHC.Utils.Misc.html#fstOf3"><span class="hs-identifier hs-var">fstOf3</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FamInstEnvs
-&gt; TyCon -&gt; [PredType] -&gt; (TyCon, [PredType], TcCoercion)
</span><a href="GHC.Tc.Instance.Family.html#tcLookupDataFamInst"><span class="hs-identifier hs-var">tcLookupDataFamInst</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621683037149"><span class="hs-identifier hs-var">fam_inst_envs</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683037159"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683037160"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1261"></span><span>               </span><span class="hs-comment">-- x should be a field of r</span><span>
</span><span id="line-1262"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683037162"><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621683037162"><span class="hs-identifier hs-var">fl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FieldLabelString -&gt; TyCon -&gt; Maybe FieldLabel
</span><a href="GHC.Core.TyCon.html#lookupTyConFieldLabel"><span class="hs-identifier hs-var">lookupTyConFieldLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; FieldLabelString
</span><a href="Language.Haskell.Syntax.Basic.html#FieldLabelString"><span class="hs-identifier hs-var">FieldLabelString</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683037158"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683037161"><span class="hs-identifier hs-var">r_tc</span></a></span><span>
</span><span id="line-1263"></span><span>               </span><span class="hs-comment">-- the field selector should be in scope</span><span>
</span><span id="line-1264"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683037165"><span class="annot"><span class="annottext">GlobalRdrEltX GREInfo
</span><a href="#local-6989586621683037165"><span class="hs-identifier hs-var">gre</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; FieldLabel -&gt; Maybe (GlobalRdrEltX GREInfo)
</span><a href="GHC.Types.Name.Reader.html#lookupGRE_FieldLabel"><span class="hs-identifier hs-var">lookupGRE_FieldLabel</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683037150"><span class="hs-identifier hs-var">rdr_env</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621683037162"><span class="hs-identifier hs-var">fl</span></a></span><span>
</span><span id="line-1265"></span><span>
</span><span id="line-1266"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683037167"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621683037167"><span class="hs-identifier hs-var hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; Name
</span><a href="GHC.Types.FieldLabel.html#flSelector"><span class="hs-identifier hs-var">flSelector</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621683037162"><span class="hs-identifier hs-var">fl</span></a></span><span>
</span><span id="line-1267"></span><span>                   </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683037169"><span class="annot"><a href="#local-6989586621683037169"><span class="hs-identifier hs-var">sel_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) DFunId
</span><a href="GHC.Tc.Utils.Env.html#tcLookupId"><span class="hs-identifier hs-var">tcLookupId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683037167"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1268"></span><span>                   </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683037171"><span class="annot"><a href="#local-6989586621683037171"><span class="hs-identifier hs-var">tv_prs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683037172"><span class="annot"><a href="#local-6989586621683037172"><span class="hs-identifier hs-var">preds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683037173"><span class="annot"><a href="#local-6989586621683037173"><span class="hs-identifier hs-var">sel_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcInstType"><span class="hs-identifier hs-type">tcInstType</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVars"><span class="hs-identifier hs-type">newMetaTyVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037169"><span class="hs-identifier hs-type">sel_id</span></a></span><span>
</span><span id="line-1269"></span><span>
</span><span id="line-1270"></span><span>                         </span><span class="hs-comment">-- The first new wanted constraint equates the actual</span><span>
</span><span id="line-1271"></span><span>                         </span><span class="hs-comment">-- type of the selector with the type (r -&gt; a) within</span><span>
</span><span id="line-1272"></span><span>                         </span><span class="hs-comment">-- the HasField x r a dictionary.  The preds will</span><span>
</span><span id="line-1273"></span><span>                         </span><span class="hs-comment">-- typically be empty, but if the datatype has a</span><span>
</span><span id="line-1274"></span><span>                         </span><span class="hs-comment">-- &quot;stupid theta&quot; then we have to include it here.</span><span>
</span><span id="line-1275"></span><span>                   </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683037175"><span class="annot"><a href="#local-6989586621683037175"><span class="hs-identifier hs-var hs-var">theta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PredType -&gt; PredType -&gt; PredType
</span><a href="GHC.Core.Coercion.html#mkPrimEqPred"><span class="hs-identifier hs-var">mkPrimEqPred</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037173"><span class="hs-identifier hs-var">sel_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; PredType -&gt; PredType -&gt; PredType
PredType -&gt; PredType -&gt; PredType
</span><a href="GHC.Core.TyCo.Rep.html#mkVisFunTyMany"><span class="hs-identifier hs-var">mkVisFunTyMany</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037156"><span class="hs-identifier hs-var">r_ty</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621683037157"><span class="hs-identifier hs-var">a_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PredType -&gt; [PredType] -&gt; [PredType]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683037172"><span class="hs-identifier hs-var">preds</span></a></span><span>
</span><span id="line-1276"></span><span>
</span><span id="line-1277"></span><span>                         </span><span class="hs-comment">-- Use the equality proof to cast the selector Id to</span><span>
</span><span id="line-1278"></span><span>                         </span><span class="hs-comment">-- type (r -&gt; a), then use the newtype coercion to cast</span><span>
</span><span id="line-1279"></span><span>                         </span><span class="hs-comment">-- it to a HasField dictionary.</span><span>
</span><span id="line-1280"></span><span>                         </span><span id="local-6989586621683037177"><span class="annot"><a href="#local-6989586621683037177"><span class="hs-identifier hs-var hs-var">mk_ev</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683037178"><span class="annot"><span class="annottext">EvExpr
</span><a href="#local-6989586621683037178"><span class="hs-identifier hs-var">ev1</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683037179"><span class="annot"><span class="annottext">[EvExpr]
</span><a href="#local-6989586621683037179"><span class="hs-identifier hs-var">evs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DFunId -&gt; [PredType] -&gt; [EvExpr] -&gt; EvExpr
</span><a href="GHC.Tc.Types.Evidence.html#evSelector"><span class="hs-identifier hs-var">evSelector</span></a></span><span> </span><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621683037169"><span class="hs-identifier hs-var">sel_id</span></a></span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683037181"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[EvExpr]
</span><a href="#local-6989586621683037179"><span class="hs-identifier hs-var">evs</span></a></span><span> </span><span class="annot"><span class="annottext">EvExpr -&gt; TcCoercion -&gt; EvTerm
</span><a href="GHC.Tc.Types.Evidence.html#evCast"><span class="hs-operator hs-var">`evCast`</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621683037183"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1281"></span><span>                           </span><span class="hs-keyword">where</span><span>
</span><span id="line-1282"></span><span>                             </span><span id="local-6989586621683037183"><span class="annot"><span class="annottext">co :: TcCoercion
</span><a href="#local-6989586621683037183"><span class="hs-identifier hs-var hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; TcCoercion -&gt; TcCoercion
TcCoercion -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkSubCo"><span class="hs-identifier hs-var">mkSubCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvTerm -&gt; TcCoercion
</span><a href="GHC.Tc.Types.Evidence.html#evTermCoercion"><span class="hs-identifier hs-var">evTermCoercion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvExpr -&gt; EvTerm
</span><a href="GHC.Tc.Types.Evidence.html#EvExpr"><span class="hs-identifier hs-var">EvExpr</span></a></span><span> </span><span class="annot"><span class="annottext">EvExpr
</span><a href="#local-6989586621683037178"><span class="hs-identifier hs-var">ev1</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1283"></span><span>                                      </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; TcCoercion -&gt; TcCoercion -&gt; TcCoercion
TcCoercion -&gt; TcCoercion -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-operator hs-var">`mkTransCo`</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621683037184"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-1284"></span><span>                         </span><span class="annot"><a href="#local-6989586621683037177"><span class="hs-identifier hs-var">mk_ev</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; EvTerm
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;matchHasField.mk_ev&quot;</span></span><span>
</span><span id="line-1285"></span><span>
</span><span id="line-1286"></span><span>                         </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683037184"><span class="annot"><a href="#local-6989586621683037184"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html#tcInstNewTyCon_maybe"><span class="hs-identifier hs-type">tcInstNewTyCon_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier hs-var">classTyCon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037147"><span class="hs-identifier hs-type">clas</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1287"></span><span>                                                              </span><span class="annot"><a href="#local-6989586621683037148"><span class="hs-identifier hs-type">tys</span></a></span><span>
</span><span id="line-1288"></span><span>
</span><span id="line-1289"></span><span>                         </span><span id="local-6989586621683037181"><span class="annot"><a href="#local-6989586621683037181"><span class="hs-identifier hs-var hs-var">tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[DFunId] -&gt; [PredType]
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Name, DFunId) -&gt; DFunId) -&gt; [(Name, DFunId)] -&gt; [DFunId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Name, DFunId) -&gt; DFunId
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(Name, DFunId)]
</span><a href="#local-6989586621683037171"><span class="hs-identifier hs-var">tv_prs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1290"></span><span>
</span><span id="line-1291"></span><span>                     </span><span class="hs-comment">-- The selector must not be &quot;naughty&quot; (i.e. the field</span><span>
</span><span id="line-1292"></span><span>                     </span><span class="hs-comment">-- cannot have an existentially quantified type), and</span><span>
</span><span id="line-1293"></span><span>                     </span><span class="hs-comment">-- it must not be higher-rank.</span><span>
</span><span id="line-1294"></span><span>                   </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.html#isNaughtyRecordSelector"><span class="hs-identifier hs-type">isNaughtyRecordSelector</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037169"><span class="hs-identifier hs-type">sel_id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><a href="GHC.Core.Type.html#isTauTy"><span class="hs-identifier hs-type">isTauTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037173"><span class="hs-identifier hs-type">sel_ty</span></a></span><span>
</span><span id="line-1295"></span><span>                     </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- See Note [Unused name reporting and HasField]</span><span>
</span><span id="line-1296"></span><span>                               </span><span class="annot"><a href="GHC.Rename.Env.html#addUsedGRE"><span class="hs-identifier hs-type">addUsedGRE</span></a></span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#AllDeprecationWarnings"><span class="hs-identifier hs-type">AllDeprecationWarnings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037165"><span class="hs-identifier hs-type">gre</span></a></span><span>
</span><span id="line-1297"></span><span>                             </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#keepAlive"><span class="hs-identifier hs-type">keepAlive</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037167"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-1298"></span><span>                             </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">snd</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html#sel_cons"><span class="hs-identifier hs-var">sel_cons</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#idDetails"><span class="hs-identifier hs-type">idDetails</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037169"><span class="hs-identifier hs-type">sel_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1299"></span><span>                                 </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addDiagnostic"><span class="hs-identifier hs-type">addDiagnostic</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnHasFieldResolvedIncomplete"><span class="hs-identifier hs-type">TcRnHasFieldResolvedIncomplete</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037167"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-1300"></span><span>                                 </span><span class="hs-comment">-- Only emit an incomplete selector warning if it's an implicit instance</span><span>
</span><span id="line-1301"></span><span>                                 </span><span class="hs-comment">-- See Note [Detecting incomplete record selectors] in GHC.HsToCore.Pmc</span><span>
</span><span id="line-1302"></span><span>                             </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#OneInst"><span class="hs-identifier hs-type">OneInst</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#cir_new_theta"><span class="hs-identifier hs-var">cir_new_theta</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683037175"><span class="hs-identifier hs-type">theta</span></a></span><span>
</span><span id="line-1303"></span><span>                                              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#cir_mk_ev"><span class="hs-identifier hs-var">cir_mk_ev</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683037177"><span class="hs-identifier hs-type">mk_ev</span></a></span><span>
</span><span id="line-1304"></span><span>                                              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#cir_canonical"><span class="hs-identifier hs-var">cir_canonical</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#EvCanonical"><span class="hs-identifier hs-type">EvCanonical</span></a></span><span>
</span><span id="line-1305"></span><span>                                              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#cir_what"><span class="hs-identifier hs-var">cir_what</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#BuiltinInstance"><span class="hs-identifier hs-type">BuiltinInstance</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1306"></span><span>                     </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#matchInstEnv"><span class="hs-identifier hs-type">matchInstEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037145"><span class="hs-identifier hs-type">dflags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037146"><span class="hs-identifier hs-type">short_cut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037147"><span class="hs-identifier hs-type">clas</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683037148"><span class="hs-identifier hs-type">tys</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1307"></span><span>
</span><span id="line-1308"></span><span>           </span><span class="annot"><span class="annottext">[PredType]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool -&gt; Class -&gt; [PredType] -&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#matchInstEnv"><span class="hs-identifier hs-var">matchInstEnv</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683037145"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683037146"><span class="hs-identifier hs-var">short_cut</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621683037147"><span class="hs-identifier hs-var">clas</span></a></span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621683037148"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1309"></span></pre></body></html>